var er=Object.defineProperty;var Vi=s=>{throw TypeError(s)};var tr=(s,e,i)=>e in s?er(s,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[e]=i;var ei=(s,e,i)=>tr(s,typeof e!="symbol"?e+"":e,i),ir=(s,e,i)=>e.has(s)||Vi("Cannot "+i);var Ui=(s,e,i)=>e.has(s)?Vi("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,i);var Li=(s,e,i)=>(ir(s,e,"access private method"),i);import{ag as containsExtent,ah as forEachCorner,ai as extendFlatCoordinates,aj as intersects$1,ak as intersectsSegment,al as createEmpty,am as getTopLeft,an as createOrUpdate$2,ao as clamp$1,ap as ceil,aq as floor,ar as get$3,as as METERS_PER_UNIT,at as getHeight,au as getWidth,av as containsCoordinate,aw as getCorner,ax as modulo,ay as buffer,az as equivalent$1,aA as transformExtent,aB as getIntersection,aC as fromUserResolution,aD as fromUserExtent,aE as toUserExtent,aF as createOrUpdateFromFlatCoordinates,aG as lerp,aH as squaredSegmentDistance,aI as createOrUpdateEmpty,aJ as returnOrUpdate,aK as getTransform,aL as getCenter,aM as closestSquaredDistanceXY,aN as extend$4,aO as squaredDistance,aP as createOrUpdateFromCoordinate,aQ as containsXY,aR as isEmpty$1,aS as offset,aT as equals$1,aU as wrapAndSliceX,aV as transform$1,aW as getPointResolution,aX as solveLinearSystem,aY as createTransformFromCoordinateTransform,aZ as getTopRight,a_ as getBottomRight,a$ as getBottomLeft,b0 as getArea,b1 as boundingExtent,b2 as extendCoordinate,b3 as getForViewAndSize,b4 as round,b5 as scale$3,b6 as rotate$1,b7 as toRadians,b8 as toFixed,b9 as coordinateRelationship,ba as Relationship,bb as clone$1,bc as getTransformFromProjections,bd as getUserProjection,be as wrapX$1,bf as wrapX$2,bg as createProjection,bh as fromUserCoordinate,bi as add$1,bj as toUserCoordinate,bk as equals$2,bl as disableCoordinateWarning,bm as distance,bn as squaredDistance$1,bo as closestOnSegment,bp as squaredDistanceToSegment,bq as commonjsGlobal,g as getDefaultExportFromCjs$1,br as getRotatedViewport,bs as applyTransform,bt as Projection$1,bu as warn,bv as identityTransform,bw as fromLonLat,bx as addProjection,by as get$4,bz as addEquivalentProjections,bA as addCoordinateTransforms,bB as getArea$1,bC as getDistance,bD as scaleFromCenter,b as useMapStore,r as ref$1,ac as provide,t as onMounted,f as createElementBlock,o as openBlock,j as renderSlot,x as inject,bE as toLonLat,bF as defineStore,d as computed,X as distExports$1,bG as onBeforeUpdate,T as onUpdated,bH as onUnmounted,a3 as useMatchMedia,S as watch,C as push$1,E as t$1,u as useServiceStore,Z as useEulerian,$ as useRouter,L as createBlock,l as withCtx,i as createBaseVNode,q as unref,a2 as DsfrModal_default,ae as useBaseUrl,k as createVNode,B as DsfrButtonGroup_default,n as createTextVNode,N as Fragment,s as useDomStore,h as createCommentVNode,bI as useControls,bJ as useControlsExtensionPosition,bK as toRaw,Q as renderList,_ as _export_sfc,bL as withAsyncContext}from"./index-lPksJ3TU.js";function padNumber(s,e,i){const n=""+s;let o=n.indexOf(".");return o=o===-1?n.length:o,o>e?n:new Array(1+e-o).join("0")+n}function compareVersions(s,e){const i=(""+s).split("."),n=(""+e).split(".");for(let o=0;o<Math.max(i.length,n.length);o++){const l=parseInt(i[o]||"0",10),c=parseInt(n[o]||"0",10);if(l>c)return 1;if(c>l)return-1}return 0}function clear$1(s){for(const e in s)delete s[e]}function isEmpty(s){let e;for(e in s)return!1;return!e}const version$2="1.0.0-beta.7",Pkg$1={version:version$2},MapEventType={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},ObjectEventType={PROPERTYCHANGE:"propertychange"},EventType={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class Disposable{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function binarySearch$1(s,e,i){let n,o;i=i||ascending;let l=0,c=s.length,u=!1;for(;l<c;)n=l+(c-l>>1),o=+i(s[n],e),o<0?l=n+1:(c=n,u=!o);return u?l:~l}function ascending(s,e){return s>e?1:s<e?-1:0}function descending(s,e){return s<e?1:s>e?-1:0}function linearFindNearest(s,e,i){if(s[0]<=e)return 0;const n=s.length;if(e<=s[n-1])return n-1;if(typeof i=="function"){for(let o=1;o<n;++o){const l=s[o];if(l===e)return o;if(l<e)return i(e,s[o-1],l)>0?o-1:o}return n-1}if(i>0){for(let o=1;o<n;++o)if(s[o]<e)return o-1;return n-1}if(i<0){for(let o=1;o<n;++o)if(s[o]<=e)return o;return n-1}for(let o=1;o<n;++o){if(s[o]==e)return o;if(s[o]<e)return s[o-1]-e<e-s[o]?o-1:o}return n-1}function reverseSubArray(s,e,i){for(;e<i;){const n=s[e];s[e]=s[i],s[i]=n,++e,--i}}function extend$3(s,e){const i=Array.isArray(e)?e:[e],n=i.length;for(let o=0;o<n;o++)s[s.length]=i[o]}function equals(s,e){const i=s.length;if(i!==e.length)return!1;for(let n=0;n<i;n++)if(s[n]!==e[n])return!1;return!0}function isSorted(s,e,i){const n=e||ascending;return s.every(function(o,l){if(l===0)return!0;const c=n(s[l-1],o);return!(c>0||c===0)})}function TRUE(){return!0}function FALSE(){return!1}function VOID(){}function memoizeOne(s){let e,i,n;return function(){const o=Array.prototype.slice.call(arguments);return(!i||this!==n||!equals(o,i))&&(n=this,i=o,e=s.apply(this,arguments)),e}}function toPromise(s){function e(){let i;try{i=s()}catch(n){return Promise.reject(n)}return i instanceof Promise?i:Promise.resolve(i)}return e()}class BaseEvent{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class Target extends Disposable{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,i){if(!e||!i)return;const n=this.listeners_||(this.listeners_={}),o=n[e]||(n[e]=[]);o.includes(i)||o.push(i)}dispatchEvent(e){const i=typeof e=="string",n=i?e:e.type,o=this.listeners_&&this.listeners_[n];if(!o)return;const l=i?new BaseEvent(e):e;l.target||(l.target=this.eventTarget_||this);const c=this.dispatching_||(this.dispatching_={}),u=this.pendingRemovals_||(this.pendingRemovals_={});n in c||(c[n]=0,u[n]=0),++c[n];let h;for(let f=0,g=o.length;f<g;++f)if("handleEvent"in o[f]?h=o[f].handleEvent(l):h=o[f].call(this,l),h===!1||l.propagationStopped){h=!1;break}if(--c[n]===0){let f=u[n];for(delete u[n];f--;)this.removeEventListener(n,VOID);delete c[n]}return h}disposeInternal(){this.listeners_&&clear$1(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,i){if(!this.listeners_)return;const n=this.listeners_[e];if(!n)return;const o=n.indexOf(i);o!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(n[o]=VOID,++this.pendingRemovals_[e]):(n.splice(o,1),n.length===0&&delete this.listeners_[e]))}}function listen(s,e,i,n,o){if(o){const c=i;i=function(u){return s.removeEventListener(e,i),c.call(n??this,u)}}else n&&n!==s&&(i=i.bind(n));const l={target:s,type:e,listener:i};return s.addEventListener(e,i),l}function listenOnce(s,e,i,n){return listen(s,e,i,n,!0)}function unlistenByKey(s){s&&s.target&&(s.target.removeEventListener(s.type,s.listener),clear$1(s))}class Observable extends Target{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(EventType.CHANGE)}getRevision(){return this.revision_}onInternal(e,i){if(Array.isArray(e)){const n=e.length,o=new Array(n);for(let l=0;l<n;++l)o[l]=listen(this,e[l],i);return o}return listen(this,e,i)}onceInternal(e,i){let n;if(Array.isArray(e)){const o=e.length;n=new Array(o);for(let l=0;l<o;++l)n[l]=listenOnce(this,e[l],i)}else n=listenOnce(this,e,i);return i.ol_key=n,n}unInternal(e,i){const n=i.ol_key;if(n)unByKey(n);else if(Array.isArray(e))for(let o=0,l=e.length;o<l;++o)this.removeEventListener(e[o],i);else this.removeEventListener(e,i)}}Observable.prototype.on;Observable.prototype.once;Observable.prototype.un;function unByKey(s){if(Array.isArray(s))for(let e=0,i=s.length;e<i;++e)unlistenByKey(s[e]);else unlistenByKey(s)}function abstract(){throw new Error("Unimplemented abstract method.")}let uidCounter_$1=0;function getUid(s){return s.ol_uid||(s.ol_uid=String(++uidCounter_$1))}class ObjectEvent extends BaseEvent{constructor(e,i,n){super(e),this.key=i,this.oldValue=n}}class BaseObject extends Observable{constructor(e){super(),this.on,this.once,this.un,getUid(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let i;return this.values_&&this.values_.hasOwnProperty(e)&&(i=this.values_[e]),i}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,i){let n;n=`change:${e}`,this.hasListener(n)&&this.dispatchEvent(new ObjectEvent(n,e,i)),n=ObjectEventType.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new ObjectEvent(n,e,i))}addChangeListener(e,i){this.addEventListener(`change:${e}`,i)}removeChangeListener(e,i){this.removeEventListener(`change:${e}`,i)}set(e,i,n){const o=this.values_||(this.values_={});if(n)o[e]=i;else{const l=o[e];o[e]=i,l!==i&&this.notify(e,l)}}setProperties(e,i){for(const n in e)this.set(n,e[n],i)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,i){if(this.values_&&e in this.values_){const n=this.values_[e];delete this.values_[e],isEmpty(this.values_)&&(this.values_=null),i||this.notify(e,n)}}}const CLASS_HIDDEN="ol-hidden",CLASS_SELECTABLE="ol-selectable",CLASS_UNSELECTABLE="ol-unselectable",CLASS_UNSUPPORTED="ol-unsupported",CLASS_CONTROL="ol-control",CLASS_COLLAPSED="ol-collapsed",fontRegEx=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),fontRegExMatchIndex=["style","variant","weight","size","lineHeight","family"],fontWeights$1={normal:400,bold:700},getFontParameters=function(s){const e=s.match(fontRegEx);if(!e)return null;const i={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let n=0,o=fontRegExMatchIndex.length;n<o;++n){const l=e[n+1];l!==void 0&&(i[fontRegExMatchIndex[n]]=typeof l=="string"?l.trim():l)}return isNaN(Number(i.weight))&&i.weight in fontWeights$1&&(i.weight=fontWeights$1[i.weight]),i.families=i.family.split(/,\s?/).map(n=>n.trim().replace(/^['"]|['"]$/g,"")),i},ua=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",SAFARI=ua.includes("safari")&&!ua.includes("chrom");SAFARI&&(ua.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(ua));const WEBKIT=ua.includes("webkit")&&!ua.includes("edge"),MAC=ua.includes("macintosh"),DEVICE_PIXEL_RATIO=typeof devicePixelRatio<"u"?devicePixelRatio:1,WORKER_OFFSCREEN_CANVAS=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,IMAGE_DECODE=typeof Image<"u"&&Image.prototype.decode,CREATE_IMAGE_BITMAP=typeof createImageBitmap=="function",PASSIVE_EVENT_LISTENERS=(function(){let s=!1;try{const e=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return s})();function createCanvasContext2D(s,e,i,n){let o;return i&&i.length?o=i.shift():WORKER_OFFSCREEN_CANVAS?o=new class extends OffscreenCanvas{constructor(){super(...arguments);ei(this,"style",{})}}(s??300,e??150):o=document.createElement("canvas"),s&&(o.width=s),e&&(o.height=e),o.getContext("2d",n)}let sharedCanvasContext;function getSharedCanvasContext2D(){return sharedCanvasContext||(sharedCanvasContext=createCanvasContext2D(1,1)),sharedCanvasContext}function releaseCanvas(s){const e=s.canvas;e.width=1,e.height=1,s.clearRect(0,0,1,1)}function outerWidth(s){let e=s.offsetWidth;const i=getComputedStyle(s);return e+=parseInt(i.marginLeft,10)+parseInt(i.marginRight,10),e}function outerHeight(s){let e=s.offsetHeight;const i=getComputedStyle(s);return e+=parseInt(i.marginTop,10)+parseInt(i.marginBottom,10),e}function replaceNode(s,e){const i=e.parentNode;i&&i.replaceChild(s,e)}function removeChildren(s){for(;s.lastChild;)s.lastChild.remove()}function replaceChildren(s,e){const i=s.childNodes;for(let n=0;;++n){const o=i[n],l=e[n];if(!o&&!l)break;if(o!==l){if(!o){s.appendChild(l);continue}if(!l){s.removeChild(o),--n;continue}s.insertBefore(l,o)}}}function createMockDiv(){return new Proxy({childNodes:[],appendChild:function(e){return this.childNodes.push(e),e},remove:function(){},removeChild:function(e){const i=this.childNodes.indexOf(e);if(i===-1)throw new Error("Node to remove was not found");return this.childNodes.splice(i,1),e},insertBefore:function(e,i){const n=this.childNodes.indexOf(i);if(n===-1)throw new Error("Reference node not found");return this.childNodes.splice(n,0,e),e},style:{}},{get(e,i,n){return i==="firstElementChild"?e.childNodes.length>0?e.childNodes[0]:null:Reflect.get(e,i,n)}})}function isCanvas(s){return typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas}const Property$4={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Overlay extends BaseObject{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+CLASS_SELECTABLE,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(Property$4.ELEMENT,this.handleElementChanged),this.addChangeListener(Property$4.MAP,this.handleMapChanged),this.addChangeListener(Property$4.OFFSET,this.handleOffsetChanged),this.addChangeListener(Property$4.POSITION,this.handlePositionChanged),this.addChangeListener(Property$4.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(Property$4.ELEMENT)}getId(){return this.id}getMap(){return this.get(Property$4.MAP)||null}getOffset(){return this.get(Property$4.OFFSET)}getPosition(){return this.get(Property$4.POSITION)}getPositioning(){return this.get(Property$4.POSITIONING)}handleElementChanged(){removeChildren(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){var i;this.mapPostrenderListenerKey&&((i=this.element)==null||i.remove(),unlistenByKey(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=listen(e,MapEventType.POSTRENDER,this.render,this),this.updatePixelPosition();const n=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?n.insertBefore(this.element,n.childNodes[0]||null):n.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(Property$4.ELEMENT,e)}setMap(e){this.set(Property$4.MAP,e)}setOffset(e){this.set(Property$4.OFFSET,e)}setPosition(e){this.set(Property$4.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const i=this.getMap();if(!i||!i.getTargetElement()||!this.get(Property$4.POSITION))return;const n=this.getRect(i.getTargetElement(),i.getSize()),o=this.getElement(),l=this.getRect(o,[outerWidth(o),outerHeight(o)]);e=e||{};const c=e.margin===void 0?20:e.margin;if(!containsExtent(n,l)){const u=l[0]-n[0],h=n[2]-l[2],f=l[1]-n[1],g=n[3]-l[3],H=[0,0];if(u<0?H[0]=u-c:h<0&&(H[0]=Math.abs(h)+c),f<0?H[1]=f-c:g<0&&(H[1]=Math.abs(g)+c),H[0]!==0||H[1]!==0){const Y=i.getView().getCenterInternal(),ee=i.getPixelFromCoordinateInternal(Y);if(!ee)return;const te=[ee[0]+H[0],ee[1]+H[1]],xe=e.animation||{};i.getView().animateInternal({center:i.getCoordinateFromPixelInternal(te),duration:xe.duration,easing:xe.easing})}}}getRect(e,i){const n=e.getBoundingClientRect(),o=n.left+window.pageXOffset,l=n.top+window.pageYOffset;return[o,l,o+i[0],l+i[1]]}setPositioning(e){this.set(Property$4.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),i=this.getPosition();if(!e||!e.isRendered()||!i){this.setVisible(!1);return}const n=e.getPixelFromCoordinate(i),o=e.getSize();this.updateRenderedPosition(n,o)}updateRenderedPosition(e,i){const n=this.element.style,o=this.getOffset(),l=this.getPositioning();this.setVisible(!0);const c=`${e[0]+o[0]}px`,u=`${e[1]+o[1]}px`;let h="0%",f="0%";l=="bottom-right"||l=="center-right"||l=="top-right"?h="-100%":(l=="bottom-center"||l=="center-center"||l=="top-center")&&(h="-50%"),l=="bottom-left"||l=="bottom-center"||l=="bottom-right"?f="-100%":(l=="center-left"||l=="center-center"||l=="center-right")&&(f="-50%");const g=`translate(${h}, ${f}) translate(${c}, ${u})`;this.rendered.transform_!=g&&(this.rendered.transform_=g,n.transform=g)}getOptions(){return this.options}}const TileState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function easeIn(s){return Math.pow(s,3)}function easeOut(s){return 1-easeIn(1-s)}function inAndOut(s){return 3*s*s-2*s*s*s}function linear(s){return s}class Tile extends Target{constructor(e,i,n){super(),n=n||{},this.tileCoord=e,this.state=i,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(EventType.CHANGE)}release(){this.setState(TileState.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==TileState.EMPTY){if(this.state!==TileState.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}}load(){abstract()}getAlpha(e,i){if(!this.transition_)return 1;let n=this.transitionStarts_[e];if(!n)n=i,this.transitionStarts_[e]=n;else if(n===-1)return 1;const o=i-n+1e3/60;return o>=this.transition_?1:easeIn(o/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}const canvasPool$2=[];class VectorRenderTile extends Tile{constructor(e,i,n,o,l){super(e,i,{transition:0}),this.context_=null,this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=o.bind(void 0,this),this.removeSourceTiles_=l,this.wrappedTileCoord=n}getContext(){return this.context_||(this.context_=createCanvasContext2D(1,1,canvasPool$2)),this.context_}hasContext(){return!!this.context_}getImage(){return this.hasContext()?this.getContext().canvas:null}getReplayState(e){const i=getUid(e);return i in this.replayState_||(this.replayState_[i]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[i]}load(){this.getSourceTiles()}release(){this.context_&&(releaseCanvas(this.context_),canvasPool$2.push(this.context_.canvas),this.context_=null),this.removeSourceTiles_(this),this.sourceTiles.length=0,super.release()}}let VectorTile$1=class extends Tile{constructor(e,i,n,o,l,c){super(e,i,c),this.extent=null,this.format_=o,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=l,this.url_=n,this.key=n}getTileUrl(){return this.url_}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==TileState.IDLE&&(this.setState(TileState.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,i){this.setFeatures(e)}onError(){this.setState(TileState.ERROR)}setFeatures(e){this.features_=e,this.setState(TileState.LOADED)}setLoader(e){this.loader_=e}},withCredentials=!1;function loadFeaturesXhr(s,e,i,n,o,l,c){const u=new XMLHttpRequest;u.open("GET",typeof s=="function"?s(i,n,o):s,!0),e.getType()=="arraybuffer"&&(u.responseType="arraybuffer"),u.withCredentials=withCredentials,u.onload=function(h){if(!u.status||u.status>=200&&u.status<300){const f=e.getType();try{let g;f=="text"||f=="json"?g=u.responseText:f=="xml"?g=u.responseXML||u.responseText:f=="arraybuffer"&&(g=u.response),g?l(e.readFeatures(g,{extent:i,featureProjection:o}),e.readProjection(g)):c()}catch{c()}}else c()},u.onerror=c,u.send()}function xhr(s,e){return function(i,n,o,l,c){loadFeaturesXhr(s,e,i,n,o,(u,h)=>{this.addFeatures(u),l!==void 0&&l(u)},()=>{this.changed(),c!==void 0&&c()})}}function hasArea(s){return s[0]>0&&s[1]>0}function scale$2(s,e,i){return i===void 0&&(i=[0,0]),i[0]=s[0]*e+.5|0,i[1]=s[1]*e+.5|0,i}function toSize(s,e){return Array.isArray(s)?s:(e===void 0?e=[s,s]:(e[0]=s,e[1]=s),e)}class TileRange{constructor(e,i,n,o){this.minX=e,this.maxX=i,this.minY=n,this.maxY=o}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,i){return this.minX<=e&&e<=this.maxX&&this.minY<=i&&i<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function createOrUpdate$1(s,e,i,n,o){return o!==void 0?(o.minX=s,o.maxX=e,o.minY=i,o.maxY=n,o):new TileRange(s,e,i,n)}function assert(s,e){if(!s)throw new Error(e)}function linearRingContainsExtent(s,e,i,n,o){return!forEachCorner(o,function(c){return!linearRingContainsXY(s,e,i,n,c[0],c[1])})}function linearRingContainsXY(s,e,i,n,o,l){let c=0,u=s[i-n],h=s[i-n+1];for(;e<i;e+=n){const f=s[e],g=s[e+1];h<=l?g>l&&(f-u)*(l-h)-(o-u)*(g-h)>0&&c++:g<=l&&(f-u)*(l-h)-(o-u)*(g-h)<0&&c--,u=f,h=g}return c!==0}function linearRingsContainsXY(s,e,i,n,o,l){if(i.length===0||!linearRingContainsXY(s,e,i[0],n,o,l))return!1;for(let c=1,u=i.length;c<u;++c)if(linearRingContainsXY(s,i[c-1],i[c],n,o,l))return!1;return!0}function linearRingssContainsXY(s,e,i,n,o,l){if(i.length===0)return!1;for(let c=0,u=i.length;c<u;++c){const h=i[c];if(linearRingsContainsXY(s,e,h,n,o,l))return!0;e=h[h.length-1]}return!1}function forEach(s,e,i,n,o){let l;for(e+=n;e<i;e+=n)if(l=o(s.slice(e-n,e),s.slice(e,e+n)),l)return l;return!1}function intersectsLineString(s,e,i,n,o,l){return l=l??extendFlatCoordinates(createEmpty(),s,e,i,n),intersects$1(o,l)?l[0]>=o[0]&&l[2]<=o[2]||l[1]>=o[1]&&l[3]<=o[3]?!0:forEach(s,e,i,n,function(c,u){return intersectsSegment(o,c,u)}):!1}function intersectsLineStringArray(s,e,i,n,o){for(let l=0,c=i.length;l<c;++l){if(intersectsLineString(s,e,i[l],n,o))return!0;e=i[l]}return!1}function intersectsLinearRing(s,e,i,n,o){return!!(intersectsLineString(s,e,i,n,o)||linearRingContainsXY(s,e,i,n,o[0],o[1])||linearRingContainsXY(s,e,i,n,o[0],o[3])||linearRingContainsXY(s,e,i,n,o[2],o[1])||linearRingContainsXY(s,e,i,n,o[2],o[3]))}function intersectsLinearRingArray(s,e,i,n,o){if(!intersectsLinearRing(s,e,i[0],n,o))return!1;if(i.length===1)return!0;for(let l=1,c=i.length;l<c;++l)if(linearRingContainsExtent(s,i[l-1],i[l],n,o)&&!intersectsLineString(s,i[l-1],i[l],n,o))return!1;return!0}function intersectsLinearRingMultiArray(s,e,i,n,o){for(let l=0,c=i.length;l<c;++l){const u=i[l];if(intersectsLinearRingArray(s,e,u,n,o))return!0;e=u[u.length-1]}return!1}function createOrUpdate(s,e,i,n){return n!==void 0?(n[0]=s,n[1]=e,n[2]=i,n):[s,e,i]}function getKeyZXY(s,e,i){return s+"/"+e+"/"+i}function getCacheKey$1(s,e,i,n,o){return`${getUid(s)},${e},${getKeyZXY(i,n,o)}`}function hash(s){return hashZXY(s[0],s[1],s[2])}function hashZXY(s,e,i){return(e<<s)+i}function withinExtentAndZ(s,e){const i=s[0],n=s[1],o=s[2];if(e.getMinZoom()>i||i>e.getMaxZoom())return!1;const l=e.getFullTileRange(i);return l?l.containsXY(n,o):!0}const DEFAULT_MAX_ZOOM=42,DEFAULT_TILE_SIZE=256,tmpTileCoord=[0,0,0],DECIMALS$1=5;class TileGrid{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,assert(isSorted(this.resolutions_,(o,l)=>l-o),"`resolutions` must be sorted in descending order");let i;if(!e.origins){for(let o=0,l=this.resolutions_.length-1;o<l;++o)if(!i)i=this.resolutions_[o]/this.resolutions_[o+1];else if(this.resolutions_[o]/this.resolutions_[o+1]!==i){i=void 0;break}}this.zoomFactor_=i,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,assert(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=e.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=getTopLeft(n)),assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,assert(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:DEFAULT_TILE_SIZE,assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((o,l)=>{const c=new TileRange(Math.min(0,o[0]),Math.max(o[0]-1,-1),Math.min(0,o[1]),Math.max(o[1]-1,-1));if(n){const u=this.getTileRangeForExtentAndZ(n,l);c.minX=Math.max(u.minX,c.minX),c.maxX=Math.min(u.maxX,c.maxX),c.minY=Math.max(u.minY,c.minY),c.maxY=Math.min(u.maxY,c.maxY)}return c}):n&&this.calculateTileRanges_(n)}forEachTileCoord(e,i,n){const o=this.getTileRangeForExtentAndZ(e,i);for(let l=o.minX,c=o.maxX;l<=c;++l)for(let u=o.minY,h=o.maxY;u<=h;++u)n([i,l,u])}forEachTileCoordParentTileRange(e,i,n,o){let l,c,u,h=null,f=e[0]-1;for(this.zoomFactor_===2?(c=e[1],u=e[2]):h=this.getTileCoordExtent(e,o);f>=this.minZoom;){if(c!==void 0&&u!==void 0?(c=Math.floor(c/2),u=Math.floor(u/2),l=createOrUpdate$1(c,c,u,u,n)):l=this.getTileRangeForExtentAndZ(h,f,n),i(f,l))return!0;--f}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,i,n){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const l=e[1]*2,c=e[2]*2;return createOrUpdate$1(l,l+1,c,c+1,i)}const o=this.getTileCoordExtent(e,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,e[0]+1,i)}return null}getTileRangeForTileCoordAndZ(e,i,n){if(i>this.maxZoom||i<this.minZoom)return null;const o=e[0],l=e[1],c=e[2];if(i===o)return createOrUpdate$1(l,c,l,c,n);if(this.zoomFactor_){const h=Math.pow(this.zoomFactor_,i-o),f=Math.floor(l*h),g=Math.floor(c*h);if(i<o)return createOrUpdate$1(f,f,g,g,n);const H=Math.floor(h*(l+1))-1,Y=Math.floor(h*(c+1))-1;return createOrUpdate$1(f,H,g,Y,n)}const u=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(u,i,n)}getTileRangeForExtentAndZ(e,i,n){this.getTileCoordForXYAndZ_(e[0],e[3],i,!1,tmpTileCoord);const o=tmpTileCoord[1],l=tmpTileCoord[2];this.getTileCoordForXYAndZ_(e[2],e[1],i,!0,tmpTileCoord);const c=tmpTileCoord[1],u=tmpTileCoord[2];return createOrUpdate$1(o,c,l,u,n)}getTileCoordCenter(e){const i=this.getOrigin(e[0]),n=this.getResolution(e[0]),o=toSize(this.getTileSize(e[0]),this.tmpSize_);return[i[0]+(e[1]+.5)*o[0]*n,i[1]-(e[2]+.5)*o[1]*n]}getTileCoordExtent(e,i){const n=this.getOrigin(e[0]),o=this.getResolution(e[0]),l=toSize(this.getTileSize(e[0]),this.tmpSize_),c=n[0]+e[1]*l[0]*o,u=n[1]-(e[2]+1)*l[1]*o,h=c+l[0]*o,f=u+l[1]*o;return createOrUpdate$2(c,u,h,f,i)}getTileCoordForCoordAndResolution(e,i,n){return this.getTileCoordForXYAndResolution_(e[0],e[1],i,!1,n)}getTileCoordForXYAndResolution_(e,i,n,o,l){const c=this.getZForResolution(n),u=n/this.getResolution(c),h=this.getOrigin(c),f=toSize(this.getTileSize(c),this.tmpSize_);let g=u*(e-h[0])/n/f[0],H=u*(h[1]-i)/n/f[1];return o?(g=ceil(g,DECIMALS$1)-1,H=ceil(H,DECIMALS$1)-1):(g=floor(g,DECIMALS$1),H=floor(H,DECIMALS$1)),createOrUpdate(c,g,H,l)}getTileCoordForXYAndZ_(e,i,n,o,l){const c=this.getOrigin(n),u=this.getResolution(n),h=toSize(this.getTileSize(n),this.tmpSize_);let f=(e-c[0])/u/h[0],g=(c[1]-i)/u/h[1];return o?(f=ceil(f,DECIMALS$1)-1,g=ceil(g,DECIMALS$1)-1):(f=floor(f,DECIMALS$1),g=floor(g,DECIMALS$1)),createOrUpdate(n,f,g,l)}getTileCoordForCoordAndZ(e,i,n){return this.getTileCoordForXYAndZ_(e[0],e[1],i,!1,n)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,i){const n=linearFindNearest(this.resolutions_,e,i||0);return clamp$1(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,i){return intersectsLinearRing(i,0,i.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const i=this.resolutions_.length,n=new Array(i);for(let o=this.minZoom;o<i;++o)n[o]=this.getTileRangeForExtentAndZ(e,o);this.fullTileRanges_=n}}class WMTSTileGrid extends TileGrid{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}function getForProjection(s){let e=s.getDefaultTileGrid();return e||(e=createForProjection(s),s.setDefaultTileGrid(e)),e}function wrapX(s,e,i){const n=e[0],o=s.getTileCoordCenter(e),l=extentFromProjection(i);if(!containsCoordinate(l,o)){const c=getWidth(l),u=Math.ceil((l[0]-o[0])/c);return o[0]+=c*u,s.getTileCoordForCoordAndZ(o,n)}return e}function createForExtent(s,e,i,n){n=n!==void 0?n:"top-left";const o=resolutionsFromExtent(s,e,i);return new TileGrid({extent:s,origin:getCorner(s,n),resolutions:o,tileSize:i})}function createXYZ(s){const e=s||{},i=e.extent||get$3("EPSG:3857").getExtent(),n={extent:i,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:resolutionsFromExtent(i,e.maxZoom,e.tileSize,e.maxResolution)};return new TileGrid(n)}function resolutionsFromExtent(s,e,i,n){e=e!==void 0?e:DEFAULT_MAX_ZOOM,i=toSize(i!==void 0?i:DEFAULT_TILE_SIZE);const o=getHeight(s),l=getWidth(s);n=n>0?n:Math.max(l/i[0],o/i[1]);const c=e+1,u=new Array(c);for(let h=0;h<c;++h)u[h]=n/Math.pow(2,h);return u}function createForProjection(s,e,i,n){const o=extentFromProjection(s);return createForExtent(o,e,i,n)}function extentFromProjection(s){s=get$3(s);let e=s.getExtent();if(!e){const i=180*METERS_PER_UNIT.degrees/s.getMetersPerUnit();e=createOrUpdate$2(-i,-i,i,i)}return e}function appendParams(s,e){const i=[];Object.keys(e).forEach(function(o){e[o]!==null&&e[o]!==void 0&&i.push(o+"="+encodeURIComponent(e[o]))});const n=i.join("&");return s=s.replace(/[?&]$/,""),s+=s.includes("?")?"&":"?",s+n}const zRegEx=/\{z\}/g,xRegEx=/\{x\}/g,yRegEx=/\{y\}/g,dashYRegEx=/\{-y\}/g;function renderXYZTemplate(s,e,i,n,o){return s.replace(zRegEx,e.toString()).replace(xRegEx,i.toString()).replace(yRegEx,n.toString()).replace(dashYRegEx,function(){if(o===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(o-n).toString()})}function expandUrl(s){const e=[];let i=/\{([a-z])-([a-z])\}/.exec(s);if(i){const n=i[1].charCodeAt(0),o=i[2].charCodeAt(0);let l;for(l=n;l<=o;++l)e.push(s.replace(i[0],String.fromCharCode(l)));return e}if(i=/\{(\d+)-(\d+)\}/.exec(s),i){const n=parseInt(i[2],10);for(let o=parseInt(i[1],10);o<=n;o++)e.push(s.replace(i[0],o.toString()));return e}return e.push(s),e}function createFromTemplate(s,e){return(function(i,n,o){if(!i)return;let l;const c=i[0];if(e){const u=e.getFullTileRange(c);u&&(l=u.getHeight()-1)}return renderXYZTemplate(s,c,i[1],i[2],l)})}function createFromTemplates(s,e){const i=s.length,n=new Array(i);for(let o=0;o<i;++o)n[o]=createFromTemplate(s[o],e);return createFromTileUrlFunctions(n)}function createFromTileUrlFunctions(s){return s.length===1?s[0]:(function(e,i,n){if(!e)return;const o=hash(e),l=modulo(o,s.length);return s[l](e,i,n)})}class Source extends BaseObject{constructor(e){super(),this.projection=get$3(e.projection),this.attributions_=adaptAttributions(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible??!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const i=this;this.viewPromise_=new Promise(function(n,o){i.viewResolver=n,i.viewRejector=o})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=adaptAttributions(e),this.changed()}setState(e){this.state_=e,this.changed()}}function adaptAttributions(s){return s?typeof s=="function"?s:(Array.isArray(s)||(s=[s]),e=>s):null}class TileSource extends Source{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const i=[256,256];this.tileGrid&&toSize(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),i),this.tmpSize=[0,0],this.key_=e.key||getUid(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){const i=e?this.getTileGridForProjection(e):this.tileGrid;return i?i.getResolutions():null}getTile(e,i,n,o,l,c){return abstract()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:getForProjection(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,i,n){const o=this.getTileGridForProjection(n),l=this.getTilePixelRatio(i),c=toSize(o.getTileSize(e),this.tmpSize);return l==1?c:scale$2(c,l,this.tmpSize)}getTileCoordForTileUrlFunction(e,i){const n=i!==void 0?i:this.getProjection(),o=i!==void 0?this.getTileGridForProjection(n):this.tileGrid||this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(e=wrapX(o,e,n)),withinExtentAndZ(e,o)?e:null}clear(){}refresh(){this.clear(),super.refresh()}}class TileSourceEvent extends BaseEvent{constructor(e,i){super(e),this.tile=i}}const TileEventType={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class UrlTile extends TileSource{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===UrlTile.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const i=e.target,n=getUid(i),o=i.getState();let l;o==TileState.LOADING?(this.tileLoadingKeys_[n]=!0,l=TileEventType.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],l=o==TileState.ERROR?TileEventType.TILELOADERROR:o==TileState.LOADED?TileEventType.TILELOADEND:void 0),l!=null&&this.dispatchEvent(new TileSourceEvent(l,i))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,i){this.tileUrlFunction=e,typeof i<"u"?this.setKey(i):this.changed()}setUrl(e){const i=expandUrl(e);this.urls=i,this.setUrls(i)}setUrls(e){this.urls=e;const i=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(createFromTemplates(e,this.tileGrid),i):this.setKey(i)}tileUrlFunction(e,i,n){}}class VectorTile extends UrlTile{constructor(e){const i=e.projection||"EPSG:3857",n=e.extent||extentFromProjection(i),o=e.tileGrid||createXYZ({extent:n,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,projection:i,state:e.state,tileGrid:o,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:defaultLoadFunction,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.tileKeysBySourceTileUrl_={},this.sourceTiles_={},this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:VectorTile$1,this.tileGrids_={}}getOverlaps(){return this.overlaps_}getSourceTiles(e,i,n){if(n.getState()===TileState.IDLE){n.setState(TileState.LOADING);const o=n.wrappedTileCoord,l=this.getTileGridForProjection(i);let c=l.getTileCoordExtent(o);const u=o[0],h=l.getResolution(u);buffer(c,-h,c);const f=this.projection;i&&this.projection&&!equivalent$1(i,f)&&(c=transformExtent(c,i,f));const g=this.tileGrid,H=g.getExtent();H&&getIntersection(c,H,c);let Y=h;i&&f&&!equivalent$1(i,f)&&(Y=h/f.getMetersPerUnit()/i.getMetersPerUnit());const ee=g.getZForResolution(Y,this.zDirection);g.forEachTileCoord(c,ee,te=>{const xe=this.tileUrlFunction(te,e,i);this.sourceTiles_[xe]||(this.sourceTiles_[xe]=new this.tileClass(te,xe?TileState.IDLE:TileState.EMPTY,xe,this.format_,this.tileLoadFunction));const ne=this.sourceTiles_[xe];n.sourceTiles.push(ne),this.tileKeysBySourceTileUrl_[xe]||(this.tileKeysBySourceTileUrl_[xe]=[]),this.tileKeysBySourceTileUrl_[xe].push(n.getKey());const et=ne.getState();if(et<TileState.LOADED){const tt=it=>{this.handleTileChange(it);const rt=ne.getState();if(rt===TileState.LOADED||rt===TileState.ERROR){const nt=ne.getKey();nt in n.errorTileKeys?ne.getState()===TileState.LOADED&&delete n.errorTileKeys[nt]:n.loadingSourceTiles--,rt===TileState.ERROR?n.errorTileKeys[nt]=!0:ne.removeEventListener(EventType.CHANGE,tt),n.loadingSourceTiles===0&&n.setState(isEmpty(n.errorTileKeys)?TileState.LOADED:TileState.ERROR)}};ne.addEventListener(EventType.CHANGE,tt),n.loadingSourceTiles++}et===TileState.IDLE&&(ne.extent=g.getTileCoordExtent(te),ne.projection=this.projection,ne.resolution=g.getResolution(te[0]),ne.load())}),n.loadingSourceTiles||n.setState(n.sourceTiles.some(te=>te.getState()===TileState.ERROR)?TileState.ERROR:TileState.LOADED)}return n.sourceTiles}removeSourceTiles(e){const i=e.getKey(),n=e.sourceTiles;for(let o=0,l=n.length;o<l;++o){const c=n[o].getTileUrl();if(!this.tileKeysBySourceTileUrl_[c])return;const u=this.tileKeysBySourceTileUrl_[c].indexOf(i);u!==-1&&(this.tileKeysBySourceTileUrl_[c].splice(u,1),this.tileKeysBySourceTileUrl_[c].length===0&&(delete this.tileKeysBySourceTileUrl_[c],delete this.sourceTiles_[c]))}}getTile(e,i,n,o,l){const c=[e,i,n];let u=this.getTileCoordForTileUrlFunction(c,l);const h=this.getTileGrid().getExtent(),f=this.projection,g=this.getTileGridForProjection(l);if(u&&h){const ee=g.getTileCoordExtent(u);buffer(ee,-g.getResolution(e),ee),intersects$1(h,!l||!f||equivalent$1(l,f)?ee:transformExtent(ee,l,f))||(u=null)}let H=!0;if(u!==null){const ee=this.tileGrid,te=g.getResolution(e);let xe=te;l&&f&&!equivalent$1(l,f)&&(xe=te/f.getMetersPerUnit()/l.getMetersPerUnit());const ne=ee.getZForResolution(xe,1),et=g.getTileCoordExtent(u);buffer(et,-te,et),ee.forEachTileCoord(!l||!f||equivalent$1(l,f)?et:transformExtent(et,l,f),ne,tt=>{H=H&&!this.tileUrlFunction(tt,o,f)})}const Y=new VectorRenderTile(c,H?TileState.EMPTY:TileState.IDLE,u,this.getSourceTiles.bind(this,o,l),this.removeSourceTiles.bind(this));return Y.key=this.getKey(),Y}getTileGridForProjection(e){const i=e.getCode();let n=this.tileGrids_[i];if(!n){const o=this.projection;if(o!==null&&!equivalent$1(o,e))return getForProjection(e);const l=this.tileGrid,c=l.getResolutions().slice(),u=c.map(function(g,H){return l.getOrigin(H)}),h=c.map(function(g,H){return l.getTileSize(H)}),f=DEFAULT_MAX_ZOOM+1;for(let g=c.length;g<f;++g)c.push(c[g-1]/2),u.push(u[g-1]),h.push(h[g-1]);n=new TileGrid({extent:l.getExtent(),origins:u,resolutions:c,tileSizes:h}),this.tileGrids_[i]=n}return n}getTilePixelRatio(e){return e}getTilePixelSize(e,i,n){const o=this.getTileGridForProjection(n),l=toSize(o.getTileSize(e),this.tmpSize);return[Math.round(l[0]*i),Math.round(l[1]*i)]}setOverlaps(e){this.overlaps_=e,this.changed()}}function defaultLoadFunction(s,e){s.setLoader(function(i,n,o){loadFeaturesXhr(e,s.getFormat(),i,n,o,s.onLoad.bind(s),s.onError.bind(s))})}const CollectionEventType={ADD:"add",REMOVE:"remove"},Property$3={LENGTH:"length"};class CollectionEvent extends BaseEvent{constructor(e,i,n){super(e),this.element=i,this.index=n}}class Collection extends BaseObject{constructor(e,i){if(super(),this.on,this.once,this.un,i=i||{},this.unique_=!!i.unique,this.array_=e??[],this.unique_)for(let n=1,o=this.array_.length;n<o;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let i=0,n=e.length;i<n;++i)this.push(e[i]);return this}forEach(e){const i=this.array_;for(let n=0,o=i.length;n<o;++n)e(i[n],n,i)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(Property$3.LENGTH)}insertAt(e,i){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(i),this.array_.splice(e,0,i),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,i,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){const i=this.getLength();return this.insertAt(i,e),this.getLength()}remove(e){const i=this.array_;for(let n=0,o=i.length;n<o;++n)if(i[n]===e)return this.removeAt(n)}removeAt(e){if(e<0||e>=this.getLength())return;const i=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,i,e)),i}setAt(e,i){const n=this.getLength();if(e>=n){this.insertAt(e,i);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(i,e);const o=this.array_[e];this.array_[e]=i,this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,o,e)),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,i,e))}updateLength_(){this.set(Property$3.LENGTH,this.array_.length)}assertUnique_(e,i){const n=this.array_;for(let o=0,l=n.length;o<l;++o)if(n[o]===e&&o!==i)throw new Error("Duplicate item added to a unique collection")}}function all$1(s,e){return[[-1/0,-1/0,1/0,1/0]]}function bbox(s,e){return[s]}function tile(s){return(function(e,i,n){const o=s.getZForResolution(fromUserResolution(i)),l=s.getTileRangeForExtentAndZ(fromUserExtent(e),o),c=[],u=[o,0,0];for(u[1]=l.minX;u[1]<=l.maxX;++u[1])for(u[2]=l.minY;u[2]<=l.maxY;++u[2])c.push(toUserExtent(s.getTileCoordExtent(u)));return c})}class Feature extends BaseObject{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const i=e;this.setGeometry(i)}else{const i=e;this.setProperties(i)}}clone(){const e=new Feature(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const i=this.getGeometry();i&&e.setGeometry(i.clone());const n=this.getStyle();return n&&e.setStyle(n),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(unlistenByKey(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=listen(e,EventType.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?createStyleFunction(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function createStyleFunction(s){if(typeof s=="function")return s;let e;return Array.isArray(s)?e=s:(assert(typeof s.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[s]),function(){return e}}function linearRingss$1(s,e,i,n){const o=[];let l=createEmpty();for(let c=0,u=i.length;c<u;++c){const h=i[c];l=createOrUpdateFromFlatCoordinates(s,e,h[0],n),o.push((l[0]+l[2])/2,(l[1]+l[3])/2),e=h[h.length-1]}return o}function getInteriorPointOfArray(s,e,i,n,o,l,c){let u,h,f,g,H,Y,ee;const te=o[l+1],xe=[];for(let tt=0,it=i.length;tt<it;++tt){const rt=i[tt];for(g=s[rt-n],Y=s[rt-n+1],u=e;u<rt;u+=n)H=s[u],ee=s[u+1],(te<=Y&&ee<=te||Y<=te&&te<=ee)&&(f=(te-Y)/(ee-Y)*(H-g)+g,xe.push(f)),g=H,Y=ee}let ne=NaN,et=-1/0;for(xe.sort(ascending),g=xe[0],u=1,h=xe.length;u<h;++u){H=xe[u];const tt=Math.abs(H-g);tt>et&&(f=(g+H)/2,linearRingsContainsXY(s,e,i,n,f,te)&&(ne=f,et=tt)),g=H}return isNaN(ne)&&(ne=o[l]),c?(c.push(ne,te,et),c):[ne,te,et]}function getInteriorPointsOfMultiArray(s,e,i,n,o){let l=[];for(let c=0,u=i.length;c<u;++c){const h=i[c];l=getInteriorPointOfArray(s,e,h,n,o,2*c,l),e=h[h.length-1]}return l}function interpolatePoint(s,e,i,n,o,l,c){let u,h;const f=(i-e)/n;if(f===1)u=e;else if(f===2)u=e,h=o;else if(f!==0){let g=s[e],H=s[e+1],Y=0;const ee=[0];for(let ne=e+n;ne<i;ne+=n){const et=s[ne],tt=s[ne+1];Y+=Math.sqrt((et-g)*(et-g)+(tt-H)*(tt-H)),ee.push(Y),g=et,H=tt}const te=o*Y,xe=binarySearch$1(ee,te);xe<0?(h=(te-ee[-xe-2])/(ee[-xe-1]-ee[-xe-2]),u=e+(-xe-2)*n):u=e+xe*n}c=c>1?c:2,l=l||new Array(c);for(let g=0;g<c;++g)l[g]=u===void 0?NaN:h===void 0?s[u+g]:lerp(s[u+g],s[u+n+g],h);return l}function lineStringCoordinateAtM(s,e,i,n,o,l){if(i==e)return null;let c;if(o<s[e+n-1])return l?(c=s.slice(e,e+n),c[n-1]=o,c):null;if(s[i-1]<o)return l?(c=s.slice(i-n,i),c[n-1]=o,c):null;if(o==s[e+n-1])return s.slice(e,e+n);let u=e/n,h=i/n;for(;u<h;){const Y=u+h>>1;o<s[(Y+1)*n-1]?h=Y:u=Y+1}const f=s[u*n-1];if(o==f)return s.slice((u-1)*n,(u-1)*n+n);const g=s[(u+1)*n-1],H=(o-f)/(g-f);c=[];for(let Y=0;Y<n-1;++Y)c.push(lerp(s[(u-1)*n+Y],s[u*n+Y],H));return c.push(o),c}function lineStringsCoordinateAtM(s,e,i,n,o,l,c){if(c)return lineStringCoordinateAtM(s,e,i[i.length-1],n,o,l);let u;if(o<s[n-1])return l?(u=s.slice(0,n),u[n-1]=o,u):null;if(s[s.length-1]<o)return l?(u=s.slice(s.length-n),u[n-1]=o,u):null;for(let h=0,f=i.length;h<f;++h){const g=i[h];if(e!=g){if(o<s[e+n-1])return null;if(o<=s[g-1])return lineStringCoordinateAtM(s,e,g,n,o,!1);e=g}}return null}function coordinates(s,e,i,n){for(;e<i-n;){for(let o=0;o<n;++o){const l=s[e+o];s[e+o]=s[i-n+o],s[i-n+o]=l}e+=n,i-=n}}function linearRingIsClockwise(s,e,i,n){let o=0,l=s[i-n],c=s[i-n+1];for(;e<i;e+=n){const u=s[e],h=s[e+1];o+=(u-l)*(h+c),l=u,c=h}return o===0?void 0:o>0}function linearRingsAreOriented(s,e,i,n,o){o=o!==void 0?o:!1;for(let l=0,c=i.length;l<c;++l){const u=i[l],h=linearRingIsClockwise(s,e,u,n);if(l===0){if(o&&h||!o&&!h)return!1}else if(o&&!h||!o&&h)return!1;e=u}return!0}function linearRingssAreOriented(s,e,i,n,o){for(let l=0,c=i.length;l<c;++l){const u=i[l];if(!linearRingsAreOriented(s,e,u,n,o))return!1;u.length&&(e=u[u.length-1])}return!0}function orientLinearRings(s,e,i,n,o){o=o!==void 0?o:!1;for(let l=0,c=i.length;l<c;++l){const u=i[l],h=linearRingIsClockwise(s,e,u,n);(l===0?o&&h||!o&&!h:o&&!h||!o&&h)&&coordinates(s,e,u,n),e=u}return e}function orientLinearRingsArray(s,e,i,n,o){for(let l=0,c=i.length;l<c;++l)e=orientLinearRings(s,e,i[l],n,o);return e}function inflateEnds(s,e){const i=[];let n=0,o=0,l;for(let c=0,u=e.length;c<u;++c){const h=e[c],f=linearRingIsClockwise(s,n,h,2);if(l===void 0&&(l=f),f===l)i.push(e.slice(o,c+1));else{if(i.length===0)continue;i[i.length-1].push(e[o])}o=c+1,n=h}return i}function douglasPeucker(s,e,i,n,o,l,c){const u=(i-e)/n;if(u<3){for(;e<i;e+=n)l[c++]=s[e],l[c++]=s[e+1];return c}const h=new Array(u);h[0]=1,h[u-1]=1;const f=[e,i-n];let g=0;for(;f.length>0;){const H=f.pop(),Y=f.pop();let ee=0;const te=s[Y],xe=s[Y+1],ne=s[H],et=s[H+1];for(let tt=Y+n;tt<H;tt+=n){const it=s[tt],rt=s[tt+1],nt=squaredSegmentDistance(it,rt,te,xe,ne,et);nt>ee&&(g=tt,ee=nt)}ee>o&&(h[(g-e)/n]=1,Y+n<g&&f.push(Y,g),g+n<H&&f.push(g,H))}for(let H=0;H<u;++H)h[H]&&(l[c++]=s[e+H*n],l[c++]=s[e+H*n+1]);return c}function douglasPeuckerArray(s,e,i,n,o,l,c,u){for(let h=0,f=i.length;h<f;++h){const g=i[h];c=douglasPeucker(s,e,g,n,o,l,c),u.push(c),e=g}return c}function snap(s,e){return e*Math.round(s/e)}function quantize(s,e,i,n,o,l,c){if(e==i)return c;let u=snap(s[e],o),h=snap(s[e+1],o);e+=n,l[c++]=u,l[c++]=h;let f,g;do if(f=snap(s[e],o),g=snap(s[e+1],o),e+=n,e==i)return l[c++]=f,l[c++]=g,c;while(f==u&&g==h);for(;e<i;){const H=snap(s[e],o),Y=snap(s[e+1],o);if(e+=n,H==f&&Y==g)continue;const ee=f-u,te=g-h,xe=H-u,ne=Y-h;if(ee*ne==te*xe&&(ee<0&&xe<ee||ee==xe||ee>0&&xe>ee)&&(te<0&&ne<te||te==ne||te>0&&ne>te)){f=H,g=Y;continue}l[c++]=f,l[c++]=g,u=f,h=g,f=H,g=Y}return l[c++]=f,l[c++]=g,c}function quantizeArray(s,e,i,n,o,l,c,u){for(let h=0,f=i.length;h<f;++h){const g=i[h];c=quantize(s,e,g,n,o,l,c),u.push(c),e=g}return c}function quantizeMultiArray(s,e,i,n,o,l,c,u){for(let h=0,f=i.length;h<f;++h){const g=i[h],H=[];c=quantizeArray(s,e,g,n,o,l,c,H),u.push(H),e=g[g.length-1]}return c}function transform2D(s,e,i,n,o,l,c){l=l||[],c=c||2;let u=0;for(let h=e;h<i;h+=n){const f=s[h],g=s[h+1];l[u++]=o[0]*f+o[2]*g+o[4],l[u++]=o[1]*f+o[3]*g+o[5];for(let H=2;H<c;H++)l[u++]=s[h+H]}return l&&l.length!=u&&(l.length=u),l}function rotate(s,e,i,n,o,l,c){c=c||[];const u=Math.cos(o),h=Math.sin(o),f=l[0],g=l[1];let H=0;for(let Y=e;Y<i;Y+=n){const ee=s[Y]-f,te=s[Y+1]-g;c[H++]=f+ee*u-te*h,c[H++]=g+ee*h+te*u;for(let xe=Y+2;xe<Y+n;++xe)c[H++]=s[xe]}return c&&c.length!=H&&(c.length=H),c}function scale$1(s,e,i,n,o,l,c,u){u=u||[];const h=c[0],f=c[1];let g=0;for(let H=e;H<i;H+=n){const Y=s[H]-h,ee=s[H+1]-f;u[g++]=h+o*Y,u[g++]=f+l*ee;for(let te=H+2;te<H+n;++te)u[g++]=s[te]}return u&&u.length!=g&&(u.length=g),u}function translate$1(s,e,i,n,o,l,c){c=c||[];let u=0;for(let h=e;h<i;h+=n){c[u++]=s[h]+o,c[u++]=s[h+1]+l;for(let f=h+2;f<h+n;++f)c[u++]=s[f]}return c&&c.length!=u&&(c.length=u),c}const tmp_=new Array(6);function create(){return[1,0,0,1,0,0]}function reset(s){return set(s,1,0,0,1,0,0)}function multiply(s,e){const i=s[0],n=s[1],o=s[2],l=s[3],c=s[4],u=s[5],h=e[0],f=e[1],g=e[2],H=e[3],Y=e[4],ee=e[5];return s[0]=i*h+o*f,s[1]=n*h+l*f,s[2]=i*g+o*H,s[3]=n*g+l*H,s[4]=i*Y+o*ee+c,s[5]=n*Y+l*ee+u,s}function set(s,e,i,n,o,l,c){return s[0]=e,s[1]=i,s[2]=n,s[3]=o,s[4]=l,s[5]=c,s}function setFromArray(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[4]=e[4],s[5]=e[5],s}function apply(s,e){const i=e[0],n=e[1];return e[0]=s[0]*i+s[2]*n+s[4],e[1]=s[1]*i+s[3]*n+s[5],e}function scale(s,e,i){return multiply(s,set(tmp_,e,0,0,i,0,0))}function translate(s,e,i){return multiply(s,set(tmp_,1,0,0,1,e,i))}function compose(s,e,i,n,o,l,c,u){const h=Math.sin(l),f=Math.cos(l);return s[0]=n*f,s[1]=o*h,s[2]=-n*h,s[3]=o*f,s[4]=c*n*f-u*n*h+e,s[5]=c*o*h+u*o*f+i,s}function makeInverse(s,e){const i=determinant(e);assert(i!==0,"Transformation matrix cannot be inverted");const n=e[0],o=e[1],l=e[2],c=e[3],u=e[4],h=e[5];return s[0]=c/i,s[1]=-o/i,s[2]=-l/i,s[3]=n/i,s[4]=(l*h-c*u)/i,s[5]=-(n*h-o*u)/i,s}function determinant(s){return s[0]*s[3]-s[1]*s[2]}const matrixPrecision=[1e5,1e5,1e5,1e5,2,2];function toString$1(s){return"matrix("+s.join(", ")+")"}function fromString$1(s){return s.substring(7,s.length-1).split(",").map(parseFloat)}function equivalent(s,e){const i=fromString$1(s),n=fromString$1(e);for(let o=0;o<6;++o)if(Math.round((i[o]-n[o])*matrixPrecision[o])!==0)return!1;return!0}const tmpTransform$1=create(),tmpPoint=[NaN,NaN];class Geometry extends BaseObject{constructor(){super(),this.extent_=createEmpty(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=memoizeOne((e,i,n)=>{if(!n)return this.getSimplifiedGeometry(i);const o=this.clone();return o.applyTransform(n),o.getSimplifiedGeometry(i)})}simplifyTransformed(e,i){return this.simplifyTransformedInternal(this.getRevision(),e,i)}clone(){return abstract()}closestPointXY(e,i,n,o){return abstract()}containsXY(e,i){return this.closestPointXY(e,i,tmpPoint,Number.MIN_VALUE)===0}getClosestPoint(e,i){return i=i||[NaN,NaN],this.closestPointXY(e[0],e[1],i,1/0),i}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return abstract()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const i=this.computeExtent(this.extent_);(isNaN(i[0])||isNaN(i[1]))&&createOrUpdateEmpty(i),this.extentRevision_=this.getRevision()}return returnOrUpdate(this.extent_,e)}rotate(e,i){abstract()}scale(e,i,n){abstract()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return abstract()}getType(){return abstract()}applyTransform(e){abstract()}intersectsExtent(e){return abstract()}translate(e,i){abstract()}transform(e,i){const n=get$3(e),o=n.getUnits()=="tile-pixels"?function(l,c,u){const h=n.getExtent(),f=n.getWorldExtent(),g=getHeight(f)/getHeight(h);compose(tmpTransform$1,f[0],f[3],g,-g,0,0,0);const H=transform2D(l,0,l.length,u,tmpTransform$1,c),Y=getTransform(n,i);return Y?Y(H,H,u):H}:getTransform(n,i);return this.applyTransform(o),this}}class SimpleGeometry extends Geometry{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return createOrUpdateFromFlatCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return abstract()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const i=this.getSimplifiedGeometryInternal(e);return i.getFlatCoordinates().length<this.flatCoordinates.length?i:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,i){this.stride=getStrideForLayout(e),this.layout=e,this.flatCoordinates=i}setCoordinates(e,i){abstract()}setLayout(e,i,n){let o;if(e)o=getStrideForLayout(e);else{for(let l=0;l<n;++l){if(i.length===0){this.layout="XY",this.stride=2;return}i=i[0]}o=i.length,e=getLayoutForStride(o)}this.layout=e,this.stride=o}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(e,i){const n=this.getFlatCoordinates();if(n){const o=this.getStride();rotate(n,0,n.length,o,e,i,n),this.changed()}}scale(e,i,n){i===void 0&&(i=e),n||(n=getCenter(this.getExtent()));const o=this.getFlatCoordinates();if(o){const l=this.getStride();scale$1(o,0,o.length,l,e,i,n,o),this.changed()}}translate(e,i){const n=this.getFlatCoordinates();if(n){const o=this.getStride();translate$1(n,0,n.length,o,e,i,n),this.changed()}}}function getLayoutForStride(s){let e;return s==2?e="XY":s==3?e="XYZ":s==4&&(e="XYZM"),e}function getStrideForLayout(s){let e;return s=="XY"?e=2:s=="XYZ"||s=="XYM"?e=3:s=="XYZM"&&(e=4),e}function transformGeom2D(s,e,i){const n=s.getFlatCoordinates();if(!n)return null;const o=s.getStride();return transform2D(n,0,n.length,o,e,i)}function deflateCoordinate(s,e,i,n){for(let o=0,l=i.length;o<l;++o)s[e++]=i[o];return e}function deflateCoordinates(s,e,i,n){for(let o=0,l=i.length;o<l;++o){const c=i[o];for(let u=0;u<n;++u)s[e++]=c[u]}return e}function deflateCoordinatesArray(s,e,i,n,o){o=o||[];let l=0;for(let c=0,u=i.length;c<u;++c){const h=deflateCoordinates(s,e,i[c],n);o[l++]=h,e=h}return o.length=l,o}function deflateMultiCoordinatesArray(s,e,i,n,o){o=o||[];let l=0;for(let c=0,u=i.length;c<u;++c){const h=deflateCoordinatesArray(s,e,i[c],n,o[l]);h.length===0&&(h[0]=e),o[l++]=h,e=h[h.length-1]}return o.length=l,o}class Circle extends SimpleGeometry{constructor(e,i,n){super(),n!==void 0&&i===void 0?this.setFlatCoordinates(n,e):(i=i||0,this.setCenterAndRadius(e,i,n))}clone(){const e=new Circle(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,i,n,o){const l=this.flatCoordinates,c=e-l[0],u=i-l[1],h=c*c+u*u;if(h<o){if(h===0)for(let f=0;f<this.stride;++f)n[f]=l[f];else{const f=this.getRadius()/Math.sqrt(h);n[0]=l[0]+f*c,n[1]=l[1]+f*u;for(let g=2;g<this.stride;++g)n[g]=l[g]}return n.length=this.stride,h}return o}containsXY(e,i){const n=this.flatCoordinates,o=e-n[0],l=i-n[1];return o*o+l*l<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const i=this.flatCoordinates,n=i[this.stride]-i[0];return createOrUpdate$2(i[0]-n,i[1]-n,i[0]+n,i[1]+n,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],i=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+i*i}getType(){return"Circle"}intersectsExtent(e){const i=this.getExtent();if(intersects$1(e,i)){const n=this.getCenter();return e[0]<=n[0]&&e[2]>=n[0]||e[1]<=n[1]&&e[3]>=n[1]?!0:forEachCorner(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const i=this.stride,n=this.flatCoordinates[i]-this.flatCoordinates[0],o=e.slice();o[i]=o[0]+n;for(let l=1;l<i;++l)o[i+l]=e[l];this.setFlatCoordinates(this.layout,o),this.changed()}setCenterAndRadius(e,i,n){this.setLayout(n,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const o=this.flatCoordinates;let l=deflateCoordinate(o,0,e,this.stride);o[l++]=o[0]+i;for(let c=1,u=this.stride;c<u;++c)o[l++]=o[c];o.length=l,this.changed()}getCoordinates(){return null}setCoordinates(e,i){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,i){const n=this.getCenter(),o=this.getStride();this.setCenter(rotate(n,0,n.length,o,e,i,n)),this.changed()}}Circle.prototype.transform;class GeometryCollection extends Geometry{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(unlistenByKey),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)this.changeEventsKeys_.push(listen(e[i],EventType.CHANGE,this.changed,this))}clone(){const e=new GeometryCollection(cloneGeometries(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,i,n,o){if(o<closestSquaredDistanceXY(this.getExtent(),e,i))return o;const l=this.geometries_;for(let c=0,u=l.length;c<u;++c)o=l[c].closestPointXY(e,i,n,o);return o}containsXY(e,i){const n=this.geometries_;for(let o=0,l=n.length;o<l;++o)if(n[o].containsXY(e,i))return!0;return!1}computeExtent(e){createOrUpdateEmpty(e);const i=this.geometries_;for(let n=0,o=i.length;n<o;++n)extend$4(e,i[n].getExtent());return e}getGeometries(){return cloneGeometries(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const i=this.geometries_;for(let n=0,o=i.length;n<o;++n)i[n].getType()===this.getType()?e=e.concat(i[n].getGeometriesArrayRecursive()):e.push(i[n]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const i=[],n=this.geometries_;let o=!1;for(let l=0,c=n.length;l<c;++l){const u=n[l],h=u.getSimplifiedGeometry(e);i.push(h),h!==u&&(o=!0)}return o?new GeometryCollection(i):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){const i=this.geometries_;for(let n=0,o=i.length;n<o;++n)if(i[n].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,i){const n=this.geometries_;for(let o=0,l=n.length;o<l;++o)n[o].rotate(e,i);this.changed()}scale(e,i,n){n||(n=getCenter(this.getExtent()));const o=this.geometries_;for(let l=0,c=o.length;l<c;++l)o[l].scale(e,i,n);this.changed()}setGeometries(e){this.setGeometriesArray(cloneGeometries(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const i=this.geometries_;for(let n=0,o=i.length;n<o;++n)i[n].applyTransform(e);this.changed()}translate(e,i){const n=this.geometries_;for(let o=0,l=n.length;o<l;++o)n[o].translate(e,i);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function cloneGeometries(s){return s.map(e=>e.clone())}function linearRing(s,e,i,n){let o=0;const l=s[i-n],c=s[i-n+1];let u=0,h=0;for(;e<i;e+=n){const f=s[e]-l,g=s[e+1]-c;o+=h*f-u*g,u=f,h=g}return o/2}function linearRings(s,e,i,n){let o=0;for(let l=0,c=i.length;l<c;++l){const u=i[l];o+=linearRing(s,e,u,n),e=u}return o}function linearRingss(s,e,i,n){let o=0;for(let l=0,c=i.length;l<c;++l){const u=i[l];o+=linearRings(s,e,u,n),e=u[u.length-1]}return o}function assignClosest(s,e,i,n,o,l,c){const u=s[e],h=s[e+1],f=s[i]-u,g=s[i+1]-h;let H;if(f===0&&g===0)H=e;else{const Y=((o-u)*f+(l-h)*g)/(f*f+g*g);if(Y>1)H=i;else if(Y>0){for(let ee=0;ee<n;++ee)c[ee]=lerp(s[e+ee],s[i+ee],Y);c.length=n;return}else H=e}for(let Y=0;Y<n;++Y)c[Y]=s[H+Y];c.length=n}function maxSquaredDelta(s,e,i,n,o){let l=s[e],c=s[e+1];for(e+=n;e<i;e+=n){const u=s[e],h=s[e+1],f=squaredDistance(l,c,u,h);f>o&&(o=f),l=u,c=h}return o}function arrayMaxSquaredDelta(s,e,i,n,o){for(let l=0,c=i.length;l<c;++l){const u=i[l];o=maxSquaredDelta(s,e,u,n,o),e=u}return o}function multiArrayMaxSquaredDelta(s,e,i,n,o){for(let l=0,c=i.length;l<c;++l){const u=i[l];o=arrayMaxSquaredDelta(s,e,u,n,o),e=u[u.length-1]}return o}function assignClosestPoint(s,e,i,n,o,l,c,u,h,f,g){if(e==i)return f;let H,Y;if(o===0){if(Y=squaredDistance(c,u,s[e],s[e+1]),Y<f){for(H=0;H<n;++H)h[H]=s[e+H];return h.length=n,Y}return f}g=g||[NaN,NaN];let ee=e+n;for(;ee<i;)if(assignClosest(s,ee-n,ee,n,c,u,g),Y=squaredDistance(c,u,g[0],g[1]),Y<f){for(f=Y,H=0;H<n;++H)h[H]=g[H];h.length=n,ee+=n}else ee+=n*Math.max((Math.sqrt(Y)-Math.sqrt(f))/o|0,1);if(l&&(assignClosest(s,i-n,e,n,c,u,g),Y=squaredDistance(c,u,g[0],g[1]),Y<f)){for(f=Y,H=0;H<n;++H)h[H]=g[H];h.length=n}return f}function assignClosestArrayPoint(s,e,i,n,o,l,c,u,h,f,g){g=g||[NaN,NaN];for(let H=0,Y=i.length;H<Y;++H){const ee=i[H];f=assignClosestPoint(s,e,ee,n,o,l,c,u,h,f,g),e=ee}return f}function assignClosestMultiArrayPoint(s,e,i,n,o,l,c,u,h,f,g){g=g||[NaN,NaN];for(let H=0,Y=i.length;H<Y;++H){const ee=i[H];f=assignClosestArrayPoint(s,e,ee,n,o,l,c,u,h,f,g),e=ee[ee.length-1]}return f}function inflateCoordinates(s,e,i,n,o){o=o!==void 0?o:[];let l=0;for(let c=e;c<i;c+=n)o[l++]=s.slice(c,c+n);return o.length=l,o}function inflateCoordinatesArray(s,e,i,n,o){o=o!==void 0?o:[];let l=0;for(let c=0,u=i.length;c<u;++c){const h=i[c];o[l++]=inflateCoordinates(s,e,h,n,o[l]),e=h}return o.length=l,o}function inflateMultiCoordinatesArray(s,e,i,n,o){o=o!==void 0?o:[];let l=0;for(let c=0,u=i.length;c<u;++c){const h=i[c];o[l++]=h.length===1&&h[0]===e?[]:inflateCoordinatesArray(s,e,h,n,o[l]),e=h[h.length-1]}return o.length=l,o}class LinearRing extends SimpleGeometry{constructor(e,i){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,i!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(i,e):this.setCoordinates(e,i)}clone(){return new LinearRing(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,i,n,o){return o<closestSquaredDistanceXY(this.getExtent(),e,i)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,i,n,o))}getArea(){return linearRing(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const i=[];return i.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,i,0),new LinearRing(i,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,i){this.setLayout(i,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,e,this.stride),this.changed()}}function lineStringLength(s,e,i,n){let o=s[e],l=s[e+1],c=0;for(let u=e+n;u<i;u+=n){const h=s[u],f=s[u+1];c+=Math.sqrt((h-o)*(h-o)+(f-l)*(f-l)),o=h,l=f}return c}class LineString extends SimpleGeometry{constructor(e,i){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,i!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(i,e):this.setCoordinates(e,i)}appendCoordinate(e){extend$3(this.flatCoordinates,e),this.changed()}clone(){const e=new LineString(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,i,n,o){return o<closestSquaredDistanceXY(this.getExtent(),e,i)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,i,n,o))}forEachSegment(e){return forEach(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,i){return this.layout!="XYM"&&this.layout!="XYZM"?null:(i=i!==void 0?i:!1,lineStringCoordinateAtM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,i))}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,i){return interpolatePoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,i,this.stride)}getLength(){return lineStringLength(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const i=[];return i.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,i,0),new LineString(i,"XY")}getType(){return"LineString"}intersectsExtent(e){return intersectsLineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,this.getExtent())}setCoordinates(e,i){this.setLayout(i,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,e,this.stride),this.changed()}}class MultiLineString extends SimpleGeometry{constructor(e,i,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,i);else if(i!==void 0&&n)this.setFlatCoordinates(i,e),this.ends_=n;else{const o=e,l=[],c=[];for(let h=0,f=o.length;h<f;++h){const g=o[h];extend$3(l,g.getFlatCoordinates()),c.push(l.length)}const u=o.length===0?this.getLayout():o[0].getLayout();this.setFlatCoordinates(u,l),this.ends_=c}}appendLineString(e){extend$3(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new MultiLineString(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,i,n,o){return o<closestSquaredDistanceXY(this.getExtent(),e,i)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,i,n,o))}getCoordinateAtM(e,i,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(i=i!==void 0?i:!1,n=n!==void 0?n:!1,lineStringsCoordinateAtM(this.flatCoordinates,0,this.ends_,this.stride,e,i,n))}getCoordinates(){return inflateCoordinatesArray(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new LineString(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,i=this.ends_,n=this.layout,o=[];let l=0;for(let c=0,u=i.length;c<u;++c){const h=i[c],f=new LineString(e.slice(l,h),n);o.push(f),l=h}return o}getLength(){const e=this.ends_;let i=0,n=0;for(let o=0,l=e.length;o<l;++o)n+=lineStringLength(this.flatCoordinates,i,e[o],this.stride),i=e[o];return n}getFlatMidpoints(){const e=[],i=this.flatCoordinates;let n=0;const o=this.ends_,l=this.stride;for(let c=0,u=o.length;c<u;++c){const h=o[c],f=interpolatePoint(i,n,h,l,.5);extend$3(e,f),n=h}return e}getSimplifiedGeometryInternal(e){const i=[],n=[];return i.length=douglasPeuckerArray(this.flatCoordinates,0,this.ends_,this.stride,e,i,0,n),new MultiLineString(i,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(e){return intersectsLineStringArray(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,i){this.setLayout(i,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=deflateCoordinatesArray(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}let Point$1=class qi extends SimpleGeometry{constructor(e,i){super(),this.setCoordinates(e,i)}clone(){const e=new qi(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,i,n,o){const l=this.flatCoordinates,c=squaredDistance(e,i,l[0],l[1]);if(c<o){const u=this.stride;for(let h=0;h<u;++h)n[h]=l[h];return n.length=u,c}return o}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return createOrUpdateFromCoordinate(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return containsXY(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinate(this.flatCoordinates,0,e,this.stride),this.changed()}};class MultiPoint extends SimpleGeometry{constructor(e,i){super(),i&&!Array.isArray(e[0])?this.setFlatCoordinates(i,e):this.setCoordinates(e,i)}appendPoint(e){extend$3(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){const e=new MultiPoint(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,i,n,o){if(o<closestSquaredDistanceXY(this.getExtent(),e,i))return o;const l=this.flatCoordinates,c=this.stride;for(let u=0,h=l.length;u<h;u+=c){const f=squaredDistance(e,i,l[u],l[u+1]);if(f<o){o=f;for(let g=0;g<c;++g)n[g]=l[u+g];n.length=c}}return o}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const i=this.flatCoordinates.length/this.stride;return e<0||i<=e?null:new Point$1(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,i=this.layout,n=this.stride,o=[];for(let l=0,c=e.length;l<c;l+=n){const u=new Point$1(e.slice(l,l+n),i);o.push(u)}return o}getType(){return"MultiPoint"}intersectsExtent(e){const i=this.flatCoordinates,n=this.stride;for(let o=0,l=i.length;o<l;o+=n){const c=i[o],u=i[o+1];if(containsXY(e,c,u))return!0}return!1}setCoordinates(e,i){this.setLayout(i,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,e,this.stride),this.changed()}}class Polygon extends SimpleGeometry{constructor(e,i,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,i!==void 0&&n?(this.setFlatCoordinates(i,e),this.ends_=n):this.setCoordinates(e,i)}appendLinearRing(e){this.flatCoordinates?extend$3(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Polygon(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,i,n,o){return o<closestSquaredDistanceXY(this.getExtent(),e,i)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,i,n,o))}containsXY(e,i){return linearRingsContainsXY(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,i)}getArea(){return linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let i;return e!==void 0?(i=this.getOrientedFlatCoordinates().slice(),orientLinearRings(i,0,this.ends_,this.stride,e)):i=this.flatCoordinates,inflateCoordinatesArray(i,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=getCenter(this.getExtent());this.flatInteriorPoint_=getInteriorPointOfArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Point$1(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new LinearRing(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,i=this.flatCoordinates,n=this.ends_,o=[];let l=0;for(let c=0,u=n.length;c<u;++c){const h=n[c],f=new LinearRing(i.slice(l,h),e);o.push(f),l=h}return o}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;linearRingsAreOriented(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=orientLinearRings(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const i=[],n=[];return i.length=quantizeArray(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),i,0,n),new Polygon(i,"XY",n)}getType(){return"Polygon"}intersectsExtent(e){return intersectsLinearRingArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,i){this.setLayout(i,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=deflateCoordinatesArray(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function circular(s,e,i,n){i=i||32;const o=[];for(let l=0;l<i;++l)extend$3(o,offset(s,e,2*Math.PI*l/i,n));return o.push(o[0],o[1]),new Polygon(o,"XY",[o.length])}function fromExtent(s){if(isEmpty$1(s))throw new Error("Cannot create polygon from empty extent");const e=s[0],i=s[1],n=s[2],o=s[3],l=[e,i,e,o,n,o,n,i,e,i];return new Polygon(l,"XY",[l.length])}class MultiPolygon extends SimpleGeometry{constructor(e,i,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(e[0])){const o=e,l=[],c=[];for(let u=0,h=o.length;u<h;++u){const f=o[u],g=l.length,H=f.getEnds();for(let Y=0,ee=H.length;Y<ee;++Y)H[Y]+=g;extend$3(l,f.getFlatCoordinates()),c.push(H)}i=o.length===0?this.getLayout():o[0].getLayout(),e=l,n=c}i!==void 0&&n?(this.setFlatCoordinates(i,e),this.endss_=n):this.setCoordinates(e,i)}appendPolygon(e){let i;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),i=e.getEnds().slice(),this.endss_.push();else{const n=this.flatCoordinates.length;extend$3(this.flatCoordinates,e.getFlatCoordinates()),i=e.getEnds().slice();for(let o=0,l=i.length;o<l;++o)i[o]+=n}this.endss_.push(i),this.changed()}clone(){const e=this.endss_.length,i=new Array(e);for(let o=0;o<e;++o)i[o]=this.endss_[o].slice();const n=new MultiPolygon(this.flatCoordinates.slice(),this.layout,i);return n.applyProperties(this),n}closestPointXY(e,i,n,o){return o<closestSquaredDistanceXY(this.getExtent(),e,i)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(multiArrayMaxSquaredDelta(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestMultiArrayPoint(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,i,n,o))}containsXY(e,i){return linearRingssContainsXY(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,i)}getArea(){return linearRingss(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let i;return e!==void 0?(i=this.getOrientedFlatCoordinates().slice(),orientLinearRingsArray(i,0,this.endss_,this.stride,e)):i=this.flatCoordinates,inflateMultiCoordinatesArray(i,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=linearRingss$1(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=getInteriorPointsOfMultiArray(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new MultiPoint(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;linearRingssAreOriented(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=orientLinearRingsArray(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const i=[],n=[];return i.length=quantizeMultiArray(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),i,0,n),new MultiPolygon(i,"XY",n)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let i;if(e===0)i=0;else{const l=this.endss_[e-1];i=l[l.length-1]}const n=this.endss_[e].slice(),o=n[n.length-1];if(i!==0)for(let l=0,c=n.length;l<c;++l)n[l]-=i;return new Polygon(this.flatCoordinates.slice(i,o),this.layout,n)}getPolygons(){const e=this.layout,i=this.flatCoordinates,n=this.endss_,o=[];let l=0;for(let c=0,u=n.length;c<u;++c){const h=n[c].slice(),f=h[h.length-1];if(l!==0)for(let H=0,Y=h.length;H<Y;++H)h[H]-=l;const g=new Polygon(i.slice(l,f),e,h);o.push(g),l=f}return o}getType(){return"MultiPolygon"}intersectsExtent(e){return intersectsLinearRingMultiArray(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,i){this.setLayout(i,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=deflateMultiCoordinatesArray(this.flatCoordinates,0,e,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const o=n[n.length-1];this.flatCoordinates.length=o.length===0?0:o[o.length-1]}this.changed()}}const tmpTransform=create();class RenderFeature{constructor(e,i,n,o,l,c){this.styleFunction,this.extent_,this.id_=c,this.type_=e,this.flatCoordinates_=i,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=l,this.squaredTolerance_,this.stride_=o,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?createOrUpdateFromCoordinate(this.flatCoordinates_):createOrUpdateFromFlatCoordinates(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=getCenter(this.getExtent());this.flatInteriorPoints_=getInteriorPointOfArray(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=inflateEnds(this.flatCoordinates_,this.ends_),i=linearRingss$1(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=getInteriorPointsOfMultiArray(this.flatCoordinates_,0,e,2,i)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=interpolatePoint(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let i=0;const n=this.ends_;for(let o=0,l=n.length;o<l;++o){const c=n[o],u=interpolatePoint(e,i,c,2,.5);extend$3(this.flatMidpoints_,u),i=c}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,i){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=get$3(e);const i=e.getExtent(),n=e.getWorldExtent();if(i&&n){const o=getHeight(n)/getHeight(i);compose(tmpTransform,n[0],n[3],o,-o,0,0,0),transform2D(this.flatCoordinates_,0,this.flatCoordinates_.length,2,tmpTransform,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var e;return new RenderFeature(this.type_,this.flatCoordinates_.slice(),(e=this.ends_)==null?void 0:e.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=memoizeOne((e,i)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),i&&this.simplifiedGeometry_.applyTransform(i);const n=this.simplifiedGeometry_.getFlatCoordinates();let o;switch(this.type_){case"LineString":n.length=douglasPeucker(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,n,0),o=[n.length];break;case"MultiLineString":o=[],n.length=douglasPeuckerArray(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,n,0,o);break;case"Polygon":o=[],n.length=quantizeArray(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),n,0,o);break}return o&&(this.simplifiedGeometry_=new RenderFeature(this.type_,n,o,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}RenderFeature.prototype.getFlatCoordinates=RenderFeature.prototype.getOrientedFlatCoordinates;function quickselect(s,e,i=0,n=s.length-1,o=defaultCompare){for(;n>i;){if(n-i>600){const h=n-i+1,f=e-i+1,g=Math.log(h),H=.5*Math.exp(2*g/3),Y=.5*Math.sqrt(g*H*(h-H)/h)*(f-h/2<0?-1:1),ee=Math.max(i,Math.floor(e-f*H/h+Y)),te=Math.min(n,Math.floor(e+(h-f)*H/h+Y));quickselect(s,e,ee,te,o)}const l=s[e];let c=i,u=n;for(swap(s,i,e),o(s[n],l)>0&&swap(s,i,n);c<u;){for(swap(s,c,u),c++,u--;o(s[c],l)<0;)c++;for(;o(s[u],l)>0;)u--}o(s[i],l)===0?swap(s,i,u):(u++,swap(s,u,n)),u<=e&&(i=u+1),e<=u&&(n=u-1)}}function swap(s,e,i){const n=s[e];s[e]=s[i],s[i]=n}function defaultCompare(s,e){return s<e?-1:s>e?1:0}let RBush$1=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let i=this.data;const n=[];if(!intersects(e,i))return n;const o=this.toBBox,l=[];for(;i;){for(let c=0;c<i.children.length;c++){const u=i.children[c],h=i.leaf?o(u):u;intersects(e,h)&&(i.leaf?n.push(u):contains$1(e,h)?this._all(u,n):l.push(u))}i=l.pop()}return n}collides(e){let i=this.data;if(!intersects(e,i))return!1;const n=[];for(;i;){for(let o=0;o<i.children.length;o++){const l=i.children[o],c=i.leaf?this.toBBox(l):l;if(intersects(e,c)){if(i.leaf||contains$1(e,c))return!0;n.push(l)}}i=n.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let n=0;n<e.length;n++)this.insert(e[n]);return this}let i=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=i;else if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){const n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=createNode([]),this}remove(e,i){if(!e)return this;let n=this.data;const o=this.toBBox(e),l=[],c=[];let u,h,f;for(;n||l.length;){if(n||(n=l.pop(),h=l[l.length-1],u=c.pop(),f=!0),n.leaf){const g=findItem(e,n.children,i);if(g!==-1)return n.children.splice(g,1),l.push(n),this._condense(l),this}!f&&!n.leaf&&contains$1(n,o)?(l.push(n),c.push(u),u=0,h=n,n=n.children[0]):h?(u++,n=h.children[u],f=!1):n=null}return this}toBBox(e){return e}compareMinX(e,i){return e.minX-i.minX}compareMinY(e,i){return e.minY-i.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,i){const n=[];for(;e;)e.leaf?i.push(...e.children):n.push(...e.children),e=n.pop();return i}_build(e,i,n,o){const l=n-i+1;let c=this._maxEntries,u;if(l<=c)return u=createNode(e.slice(i,n+1)),calcBBox(u,this.toBBox),u;o||(o=Math.ceil(Math.log(l)/Math.log(c)),c=Math.ceil(l/Math.pow(c,o-1))),u=createNode([]),u.leaf=!1,u.height=o;const h=Math.ceil(l/c),f=h*Math.ceil(Math.sqrt(c));multiSelect(e,i,n,f,this.compareMinX);for(let g=i;g<=n;g+=f){const H=Math.min(g+f-1,n);multiSelect(e,g,H,h,this.compareMinY);for(let Y=g;Y<=H;Y+=h){const ee=Math.min(Y+h-1,H);u.children.push(this._build(e,Y,ee,o-1))}}return calcBBox(u,this.toBBox),u}_chooseSubtree(e,i,n,o){for(;o.push(i),!(i.leaf||o.length-1===n);){let l=1/0,c=1/0,u;for(let h=0;h<i.children.length;h++){const f=i.children[h],g=bboxArea(f),H=enlargedArea(e,f)-g;H<c?(c=H,l=g<l?g:l,u=f):H===c&&g<l&&(l=g,u=f)}i=u||i.children[0]}return i}_insert(e,i,n){const o=n?e:this.toBBox(e),l=[],c=this._chooseSubtree(o,this.data,i,l);for(c.children.push(e),extend$2(c,o);i>=0&&l[i].children.length>this._maxEntries;)this._split(l,i),i--;this._adjustParentBBoxes(o,l,i)}_split(e,i){const n=e[i],o=n.children.length,l=this._minEntries;this._chooseSplitAxis(n,l,o);const c=this._chooseSplitIndex(n,l,o),u=createNode(n.children.splice(c,n.children.length-c));u.height=n.height,u.leaf=n.leaf,calcBBox(n,this.toBBox),calcBBox(u,this.toBBox),i?e[i-1].children.push(u):this._splitRoot(n,u)}_splitRoot(e,i){this.data=createNode([e,i]),this.data.height=e.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)}_chooseSplitIndex(e,i,n){let o,l=1/0,c=1/0;for(let u=i;u<=n-i;u++){const h=distBBox(e,0,u,this.toBBox),f=distBBox(e,u,n,this.toBBox),g=intersectionArea(h,f),H=bboxArea(h)+bboxArea(f);g<l?(l=g,o=u,c=H<c?H:c):g===l&&H<c&&(c=H,o=u)}return o||n-i}_chooseSplitAxis(e,i,n){const o=e.leaf?this.compareMinX:compareNodeMinX,l=e.leaf?this.compareMinY:compareNodeMinY,c=this._allDistMargin(e,i,n,o),u=this._allDistMargin(e,i,n,l);c<u&&e.children.sort(o)}_allDistMargin(e,i,n,o){e.children.sort(o);const l=this.toBBox,c=distBBox(e,0,i,l),u=distBBox(e,n-i,n,l);let h=bboxMargin(c)+bboxMargin(u);for(let f=i;f<n-i;f++){const g=e.children[f];extend$2(c,e.leaf?l(g):g),h+=bboxMargin(c)}for(let f=n-i-1;f>=i;f--){const g=e.children[f];extend$2(u,e.leaf?l(g):g),h+=bboxMargin(u)}return h}_adjustParentBBoxes(e,i,n){for(let o=n;o>=0;o--)extend$2(i[o],e)}_condense(e){for(let i=e.length-1,n;i>=0;i--)e[i].children.length===0?i>0?(n=e[i-1].children,n.splice(n.indexOf(e[i]),1)):this.clear():calcBBox(e[i],this.toBBox)}};function findItem(s,e,i){if(!i)return e.indexOf(s);for(let n=0;n<e.length;n++)if(i(s,e[n]))return n;return-1}function calcBBox(s,e){distBBox(s,0,s.children.length,e,s)}function distBBox(s,e,i,n,o){o||(o=createNode(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let l=e;l<i;l++){const c=s.children[l];extend$2(o,s.leaf?n(c):c)}return o}function extend$2(s,e){return s.minX=Math.min(s.minX,e.minX),s.minY=Math.min(s.minY,e.minY),s.maxX=Math.max(s.maxX,e.maxX),s.maxY=Math.max(s.maxY,e.maxY),s}function compareNodeMinX(s,e){return s.minX-e.minX}function compareNodeMinY(s,e){return s.minY-e.minY}function bboxArea(s){return(s.maxX-s.minX)*(s.maxY-s.minY)}function bboxMargin(s){return s.maxX-s.minX+(s.maxY-s.minY)}function enlargedArea(s,e){return(Math.max(e.maxX,s.maxX)-Math.min(e.minX,s.minX))*(Math.max(e.maxY,s.maxY)-Math.min(e.minY,s.minY))}function intersectionArea(s,e){const i=Math.max(s.minX,e.minX),n=Math.max(s.minY,e.minY),o=Math.min(s.maxX,e.maxX),l=Math.min(s.maxY,e.maxY);return Math.max(0,o-i)*Math.max(0,l-n)}function contains$1(s,e){return s.minX<=e.minX&&s.minY<=e.minY&&e.maxX<=s.maxX&&e.maxY<=s.maxY}function intersects(s,e){return e.minX<=s.maxX&&e.minY<=s.maxY&&e.maxX>=s.minX&&e.maxY>=s.minY}function createNode(s){return{children:s,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(s,e,i,n,o){const l=[e,i];for(;l.length;){if(i=l.pop(),e=l.pop(),i-e<=n)continue;const c=e+Math.ceil((i-e)/n/2)*n;quickselect(s,c,e,i,o),l.push(e,c,c,i)}}class RBush{constructor(e){this.rbush_=new RBush$1(e),this.items_={}}insert(e,i){const n={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:i};this.rbush_.insert(n),this.items_[getUid(i)]=n}load(e,i){const n=new Array(i.length);for(let o=0,l=i.length;o<l;o++){const c=e[o],u=i[o],h={minX:c[0],minY:c[1],maxX:c[2],maxY:c[3],value:u};n[o]=h,this.items_[getUid(u)]=h}this.rbush_.load(n)}remove(e){const i=getUid(e),n=this.items_[i];return delete this.items_[i],this.rbush_.remove(n)!==null}update(e,i){const n=this.items_[getUid(i)],o=[n.minX,n.minY,n.maxX,n.maxY];equals$1(o,e)||(this.remove(i),this.insert(e,i))}getAll(){return this.rbush_.all().map(function(i){return i.value})}getInExtent(e){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(i).map(function(o){return o.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,i){return this.forEach_(this.getInExtent(e),i)}forEach_(e,i){let n;for(let o=0,l=e.length;o<l;o++)if(n=i(e[o]),n)return n;return n}isEmpty(){return isEmpty(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const i=this.rbush_.toJSON();return createOrUpdate$2(i.minX,i.minY,i.maxX,i.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const i in e.items_)this.items_[i]=e.items_[i]}}const VectorEventType={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class VectorSourceEvent extends BaseEvent{constructor(e,i,n){super(e),this.feature=i,this.features=n}}class VectorSource extends Source{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=VOID,this.format_=e.format||null,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(assert(this.format_,"`format` must be set when `url` is set"),this.loader_=xhr(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:all$1;const i=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=i?new RBush:null,this.loadedExtentsRtree_=new RBush,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,o;Array.isArray(e.features)?o=e.features:e.features&&(n=e.features,o=n.getArray()),!i&&n===void 0&&(n=new Collection(o)),o!==void 0&&this.addFeaturesInternal(o),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const i=getUid(e);if(!this.addToIndex_(i,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(i,e);const n=e.getGeometry();if(n){const o=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(o,e)}else this.nullGeometryFeatures_[i]=e;this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,e))}setupChangeEvents_(e,i){i instanceof RenderFeature||(this.featureChangeKeys_[e]=[listen(i,EventType.CHANGE,this.handleFeatureChange_,this),listen(i,ObjectEventType.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,i){let n=!0;if(i.getId()!==void 0){const o=String(i.getId());if(!(o in this.idIndex_))this.idIndex_[o]=i;else if(i instanceof RenderFeature){const l=this.idIndex_[o];l instanceof RenderFeature?Array.isArray(l)?l.push(i):this.idIndex_[o]=[l,i]:n=!1}else n=!1}return n&&(assert(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=i),n}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const i=[],n=[],o=[];for(let l=0,c=e.length;l<c;l++){const u=e[l],h=getUid(u);this.addToIndex_(h,u)&&n.push(u)}for(let l=0,c=n.length;l<c;l++){const u=n[l],h=getUid(u);this.setupChangeEvents_(h,u);const f=u.getGeometry();if(f){const g=f.getExtent();i.push(g),o.push(u)}else this.nullGeometryFeatures_[h]=u}if(this.featuresRtree_&&this.featuresRtree_.load(i,o),this.hasListener(VectorEventType.ADDFEATURE))for(let l=0,c=n.length;l<c;l++)this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,n[l]))}bindFeaturesCollection_(e){let i=!1;this.addEventListener(VectorEventType.ADDFEATURE,function(n){i||(i=!0,e.push(n.feature),i=!1)}),this.addEventListener(VectorEventType.REMOVEFEATURE,function(n){i||(i=!0,e.remove(n.feature),i=!1)}),e.addEventListener(CollectionEventType.ADD,n=>{i||(i=!0,this.addFeature(n.element),i=!1)}),e.addEventListener(CollectionEventType.REMOVE,n=>{i||(i=!0,this.removeFeature(n.element),i=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(unlistenByKey);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(n=>{this.removeFeatureInternal(n)});for(const n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const i=new VectorSourceEvent(VectorEventType.CLEAR);this.dispatchEvent(i),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,i){const n=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(n,function(o){const l=o.getGeometry();if(l instanceof RenderFeature||l.intersectsCoordinate(e))return i(o)})}forEachFeatureInExtent(e,i){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,i);this.featuresCollection_&&this.featuresCollection_.forEach(i)}forEachFeatureIntersectingExtent(e,i){return this.forEachFeatureInExtent(e,function(n){const o=n.getGeometry();if(o instanceof RenderFeature||o.intersectsExtent(e)){const l=i(n);if(l)return l}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),isEmpty(this.nullGeometryFeatures_)||extend$3(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const i=[];return this.forEachFeatureAtCoordinateDirect(e,function(n){i.push(n)}),i}getFeaturesInExtent(e,i){if(this.featuresRtree_){if(!(i&&i.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const o=wrapAndSliceX(e,i);return[].concat(...o.map(l=>this.featuresRtree_.getInExtent(l)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,i){const n=e[0],o=e[1];let l=null;const c=[NaN,NaN];let u=1/0;const h=[-1/0,-1/0,1/0,1/0];return i=i||TRUE,this.featuresRtree_.forEachInExtent(h,function(f){if(i(f)){const g=f.getGeometry(),H=u;if(u=g instanceof RenderFeature?0:g.closestPointXY(n,o,c,u),u<H){l=f;const Y=Math.sqrt(u);h[0]=n-Y,h[1]=o-Y,h[2]=n+Y,h[3]=o+Y}}}),l}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const i=this.idIndex_[e.toString()];return i!==void 0?i:null}getFeatureByUid(e){const i=this.uidIndex_[e];return i!==void 0?i:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const i=e.target,n=getUid(i),o=i.getGeometry();if(!o)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(i),this.nullGeometryFeatures_[n]=i);else{const c=o.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(c,i)):this.featuresRtree_&&this.featuresRtree_.update(c,i)}const l=i.getId();if(l!==void 0){const c=l.toString();this.idIndex_[c]!==i&&(this.removeFromIdIndex_(i),this.idIndex_[c]=i)}else this.removeFromIdIndex_(i),this.uidIndex_[n]=i;this.changed(),this.dispatchEvent(new VectorSourceEvent(VectorEventType.CHANGEFEATURE,i))}hasFeature(e){const i=e.getId();return i!==void 0?i in this.idIndex_:getUid(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&isEmpty(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,i,n){const o=this.loadedExtentsRtree_,l=this.strategy_(e,i,n);for(let c=0,u=l.length;c<u;++c){const h=l[c];o.forEachInExtent(h,function(g){return containsExtent(g.extent,h)})||(++this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADSTART)),this.loader_.call(this,h,i,n,g=>{--this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADEND,void 0,g))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADERROR))}),o.insert(h,{extent:h.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const i=this.loadedExtentsRtree_,n=i.forEachInExtent(e,function(o){if(equals$1(o.extent,e))return o});n&&i.remove(n)}removeFeatures(e){let i=!1;for(let n=0,o=e.length;n<o;++n)i=this.removeFeatureInternal(e[n])||i;i&&this.changed()}removeFeature(e){if(!e)return;this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const i=getUid(e);if(!(i in this.uidIndex_))return!1;i in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[i]:this.featuresRtree_&&this.featuresRtree_.remove(e);const n=this.featureChangeKeys_[i];n==null||n.forEach(unlistenByKey),delete this.featureChangeKeys_[i];const o=e.getId();if(o!==void 0){const l=o.toString(),c=this.idIndex_[l];c===e?delete this.idIndex_[l]:Array.isArray(c)&&(c.splice(c.indexOf(e),1),c.length===1&&(this.idIndex_[l]=c[0]))}return delete this.uidIndex_[i],this.hasListener(VectorEventType.REMOVEFEATURE)&&this.dispatchEvent(new VectorSourceEvent(VectorEventType.REMOVEFEATURE,e)),!0}removeFromIdIndex_(e){for(const i in this.idIndex_)if(this.idIndex_[i]===e){delete this.idIndex_[i];break}}setLoader(e){this.loader_=e}setUrl(e){assert(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(xhr(e,this.format_))}setOverlaps(e){this.overlaps_=e,this.changed()}}let brokenDiagonalRendering_;const canvasPool$1=[];function drawTestTriangle(s,e,i,n,o){s.beginPath(),s.moveTo(0,0),s.lineTo(e,i),s.lineTo(n,o),s.closePath(),s.save(),s.clip(),s.fillRect(0,0,Math.max(e,n)+1,Math.max(i,o)),s.restore()}function verifyBrokenDiagonalRendering(s,e){return Math.abs(s[e*4]-210)>2||Math.abs(s[e*4+3]-.75*255)>2}function isBrokenDiagonalRendering(){if(brokenDiagonalRendering_===void 0){const s=createCanvasContext2D(6,6,canvasPool$1);s.globalCompositeOperation="lighter",s.fillStyle="rgba(210, 0, 0, 0.75)",drawTestTriangle(s,4,5,4,0),drawTestTriangle(s,4,5,0,5);const e=s.getImageData(0,0,3,3).data;brokenDiagonalRendering_=verifyBrokenDiagonalRendering(e,0)||verifyBrokenDiagonalRendering(e,4)||verifyBrokenDiagonalRendering(e,8),releaseCanvas(s),canvasPool$1.push(s.canvas)}return brokenDiagonalRendering_}function calculateSourceResolution(s,e,i,n){const o=transform$1(i,e,s);let l=getPointResolution(e,n,i);const c=e.getMetersPerUnit();c!==void 0&&(l*=c);const u=s.getMetersPerUnit();u!==void 0&&(l/=u);const h=s.getExtent();if(!h||containsCoordinate(h,o)){const f=getPointResolution(s,l,o)/l;isFinite(f)&&f>0&&(l/=f)}return l}function calculateSourceExtentResolution(s,e,i,n){const o=getCenter(i);let l=calculateSourceResolution(s,e,o,n);return(!isFinite(l)||l<=0)&&forEachCorner(i,function(c){return l=calculateSourceResolution(s,e,c,n),isFinite(l)&&l>0}),l}function render(s,e,i,n,o,l,c,u,h,f,g,H,Y,ee){const te=createCanvasContext2D(Math.round(i*s),Math.round(i*e),canvasPool$1);if(H||(te.imageSmoothingEnabled=!1),h.length===0)return te.canvas;te.scale(i,i);function xe(nt){return Math.round(nt*i)/i}te.globalCompositeOperation="lighter";const ne=createEmpty();h.forEach(function(nt,st,at){extend$4(ne,nt.extent)});let et;const tt=i/n,it=(H?1:1+Math.pow(2,-24))/tt;if(!Y||h.length!==1||f!==0){if(et=createCanvasContext2D(Math.round(getWidth(ne)*tt),Math.round(getHeight(ne)*tt),canvasPool$1),H||(et.imageSmoothingEnabled=!1),o&&ee){const nt=(o[0]-ne[0])*tt,st=-(o[3]-ne[3])*tt,at=getWidth(o)*tt,ot=getHeight(o)*tt;et.rect(nt,st,at,ot),et.clip()}h.forEach(function(nt,st,at){if(nt.image.width>0&&nt.image.height>0){if(nt.clipExtent){et.save();const pt=(nt.clipExtent[0]-ne[0])*tt,yt=-(nt.clipExtent[3]-ne[3])*tt,mt=getWidth(nt.clipExtent)*tt,St=getHeight(nt.clipExtent)*tt;et.rect(H?pt:Math.round(pt),H?yt:Math.round(yt),H?mt:Math.round(pt+mt)-Math.round(pt),H?St:Math.round(yt+St)-Math.round(yt)),et.clip()}const ot=(nt.extent[0]-ne[0])*tt,ct=-(nt.extent[3]-ne[3])*tt,ht=getWidth(nt.extent)*tt,ut=getHeight(nt.extent)*tt;et.drawImage(nt.image,f,f,nt.image.width-2*f,nt.image.height-2*f,H?ot:Math.round(ot),H?ct:Math.round(ct),H?ht:Math.round(ot+ht)-Math.round(ot),H?ut:Math.round(ct+ut)-Math.round(ct)),nt.clipExtent&&et.restore()}})}const rt=getTopLeft(c);return u.getTriangles().forEach(function(nt,st,at){const ot=nt.source,ct=nt.target;let ht=ot[0][0],ut=ot[0][1],pt=ot[1][0],yt=ot[1][1],mt=ot[2][0],St=ot[2][1];const Pt=xe((ct[0][0]-rt[0])/l),Rt=xe(-(ct[0][1]-rt[1])/l),Lt=xe((ct[1][0]-rt[0])/l),Nt=xe(-(ct[1][1]-rt[1])/l),vt=xe((ct[2][0]-rt[0])/l),Et=xe(-(ct[2][1]-rt[1])/l),Ct=ht,_t=ut;ht=0,ut=0,pt-=Ct,yt-=_t,mt-=Ct,St-=_t;const dt=[[pt,yt,0,0,Lt-Pt],[mt,St,0,0,vt-Pt],[0,0,pt,yt,Nt-Rt],[0,0,mt,St,Et-Rt]],ft=solveLinearSystem(dt);if(!ft)return;if(te.save(),te.beginPath(),isBrokenDiagonalRendering()||!H){te.moveTo(Lt,Nt);const Gt=4,Ft=Pt-Lt,Ht=Rt-Nt;for(let Mt=0;Mt<Gt;Mt++)te.lineTo(Lt+xe((Mt+1)*Ft/Gt),Nt+xe(Mt*Ht/(Gt-1))),Mt!=Gt-1&&te.lineTo(Lt+xe((Mt+1)*Ft/Gt),Nt+xe((Mt+1)*Ht/(Gt-1)));te.lineTo(vt,Et)}else te.moveTo(Lt,Nt),te.lineTo(Pt,Rt),te.lineTo(vt,Et);te.clip(),te.transform(ft[0],ft[2],ft[1],ft[3],Pt,Rt),te.translate(ne[0]-Ct,ne[3]-_t);let bt;if(et)bt=et.canvas,te.scale(it,-it);else{const Gt=h[0],Ft=Gt.extent;bt=Gt.image,te.scale(getWidth(Ft)/bt.width,-getHeight(Ft)/bt.height)}te.drawImage(bt,0,0),te.restore()}),et&&(releaseCanvas(et),canvasPool$1.push(et.canvas)),g&&(te.save(),te.globalCompositeOperation="source-over",te.strokeStyle="black",te.lineWidth=1,u.getTriangles().forEach(function(nt,st,at){const ot=nt.target,ct=(ot[0][0]-rt[0])/l,ht=-(ot[0][1]-rt[1])/l,ut=(ot[1][0]-rt[0])/l,pt=-(ot[1][1]-rt[1])/l,yt=(ot[2][0]-rt[0])/l,mt=-(ot[2][1]-rt[1])/l;te.beginPath(),te.moveTo(ut,pt),te.lineTo(ct,ht),te.lineTo(yt,mt),te.closePath(),te.stroke()}),te.restore()),te.canvas}const ImageState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class ImageWrapper extends Target{constructor(e,i,n,o){super(),this.extent=e,this.pixelRatio_=n,this.resolution=i,this.state=typeof o=="function"?ImageState.IDLE:o,this.image_=null,this.loader=typeof o=="function"?o:null}changed(){this.dispatchEvent(EventType.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==ImageState.IDLE&&this.loader){this.state=ImageState.LOADING,this.changed();const e=this.getResolution(),i=Array.isArray(e)?e[0]:e;toPromise(()=>this.loader(this.getExtent(),i,this.getPixelRatio())).then(n=>{"image"in n&&(this.image_=n.image),"extent"in n&&(this.extent=n.extent),"resolution"in n&&(this.resolution=n.resolution),"pixelRatio"in n&&(this.pixelRatio_=n.pixelRatio),(n instanceof HTMLImageElement||CREATE_IMAGE_BITMAP&&n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement)&&(this.image_=n),this.state=ImageState.LOADED}).catch(n=>{this.state=ImageState.ERROR,console.error(n)}).finally(()=>this.changed())}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}}function listenImage(s,e,i){const n=s;let o=!0,l=!1,c=!1;const u=[listenOnce(n,EventType.LOAD,function(){c=!0,l||e()})];return n.src&&IMAGE_DECODE?(l=!0,n.decode().then(function(){o&&e()}).catch(function(h){o&&(c?e():i())})):u.push(listenOnce(n,EventType.ERROR,i)),function(){o=!1,u.forEach(unlistenByKey)}}function load(s,e){return new Promise((i,n)=>{function o(){c(),i(s)}function l(){c(),n(new Error("Image load error"))}function c(){s.removeEventListener("load",o),s.removeEventListener("error",l)}s.addEventListener("load",o),s.addEventListener("error",l)})}function decodeFallback(s,e){return e&&(s.src=e),s.src&&IMAGE_DECODE?new Promise((i,n)=>s.decode().then(()=>i(s)).catch(o=>s.complete&&s.width?i(s):n(o))):load(s)}function decode$1(s,e){return e&&(s.src=e),s.src&&IMAGE_DECODE&&CREATE_IMAGE_BITMAP?s.decode().then(()=>createImageBitmap(s)).catch(i=>{if(s.complete&&s.width)return s;throw i}):decodeFallback(s)}class ImageTile extends Tile{constructor(e,i,n,o,l,c){super(e,i,c),this.crossOrigin_=o,this.src_=n,this.key=n,this.image_,WORKER_OFFSCREEN_CANVAS?this.image_=new OffscreenCanvas(1,1):(this.image_=new Image,o!==null&&(this.image_.crossOrigin=o)),this.unlisten_=null,this.tileLoadFunction_=l}getImage(){return this.image_}setImage(e){this.image_=e,this.state=TileState.LOADED,this.unlistenImage_(),this.changed()}getCrossOrigin(){return this.crossOrigin_}handleImageError_(){this.state=TileState.ERROR,this.unlistenImage_(),this.image_=getBlankImage(),this.changed()}handleImageLoad_(){if(WORKER_OFFSCREEN_CANVAS)this.state=TileState.LOADED;else{const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=TileState.LOADED:this.state=TileState.EMPTY}this.unlistenImage_(),this.changed()}load(){this.state==TileState.ERROR&&(this.state=TileState.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==TileState.IDLE&&(this.state=TileState.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=listenImage(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function getBlankImage(){const s=createCanvasContext2D(1,1);return s.fillStyle="rgba(0,0,0,0)",s.fillRect(0,0,1,1),s.canvas}const MAX_SUBDIVISION=10,MAX_TRIANGLE_WIDTH=.25;class Triangulation{constructor(e,i,n,o,l,c,u){this.sourceProj_=e,this.targetProj_=i;let h={};const f=u?createTransformFromCoordinateTransform(it=>apply(u,transform$1(it,this.targetProj_,this.sourceProj_))):getTransform(this.targetProj_,this.sourceProj_);this.transformInv_=function(it){const rt=it[0]+"/"+it[1];return h[rt]||(h[rt]=f(it)),h[rt]},this.maxSourceExtent_=o,this.errorThresholdSquared_=l*l,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!o&&!!this.sourceProj_.getExtent()&&getWidth(o)>=getWidth(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?getWidth(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?getWidth(this.targetProj_.getExtent()):null;const g=getTopLeft(n),H=getTopRight(n),Y=getBottomRight(n),ee=getBottomLeft(n),te=this.transformInv_(g),xe=this.transformInv_(H),ne=this.transformInv_(Y),et=this.transformInv_(ee),tt=MAX_SUBDIVISION+(c?Math.max(0,Math.ceil(Math.log2(getArea(n)/(c*c*256*256)))):0);if(this.addQuad_(g,H,Y,ee,te,xe,ne,et,tt),this.wrapsXInSource_){let it=1/0;this.triangles_.forEach(function(rt,nt,st){it=Math.min(it,rt.source[0][0],rt.source[1][0],rt.source[2][0])}),this.triangles_.forEach(rt=>{if(Math.max(rt.source[0][0],rt.source[1][0],rt.source[2][0])-it>this.sourceWorldWidth_/2){const nt=[[rt.source[0][0],rt.source[0][1]],[rt.source[1][0],rt.source[1][1]],[rt.source[2][0],rt.source[2][1]]];nt[0][0]-it>this.sourceWorldWidth_/2&&(nt[0][0]-=this.sourceWorldWidth_),nt[1][0]-it>this.sourceWorldWidth_/2&&(nt[1][0]-=this.sourceWorldWidth_),nt[2][0]-it>this.sourceWorldWidth_/2&&(nt[2][0]-=this.sourceWorldWidth_);const st=Math.min(nt[0][0],nt[1][0],nt[2][0]);Math.max(nt[0][0],nt[1][0],nt[2][0])-st<this.sourceWorldWidth_/2&&(rt.source=nt)}})}h={}}addTriangle_(e,i,n,o,l,c){this.triangles_.push({source:[o,l,c],target:[e,i,n]})}addQuad_(e,i,n,o,l,c,u,h,f){const g=boundingExtent([l,c,u,h]),H=this.sourceWorldWidth_?getWidth(g)/this.sourceWorldWidth_:null,Y=this.sourceWorldWidth_,ee=this.sourceProj_.canWrapX()&&H>.5&&H<1;let te=!1;if(f>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const ne=boundingExtent([e,i,n,o]);te=getWidth(ne)/this.targetWorldWidth_>MAX_TRIANGLE_WIDTH||te}!ee&&this.sourceProj_.isGlobal()&&H&&(te=H>MAX_TRIANGLE_WIDTH||te)}if(!te&&this.maxSourceExtent_&&isFinite(g[0])&&isFinite(g[1])&&isFinite(g[2])&&isFinite(g[3])&&!intersects$1(g,this.maxSourceExtent_))return;let xe=0;if(!te&&(!isFinite(l[0])||!isFinite(l[1])||!isFinite(c[0])||!isFinite(c[1])||!isFinite(u[0])||!isFinite(u[1])||!isFinite(h[0])||!isFinite(h[1]))){if(f>0)te=!0;else if(xe=(!isFinite(l[0])||!isFinite(l[1])?8:0)+(!isFinite(c[0])||!isFinite(c[1])?4:0)+(!isFinite(u[0])||!isFinite(u[1])?2:0)+(!isFinite(h[0])||!isFinite(h[1])?1:0),xe!=1&&xe!=2&&xe!=4&&xe!=8)return}if(f>0){if(!te){const ne=[(e[0]+n[0])/2,(e[1]+n[1])/2],et=this.transformInv_(ne);let tt;ee?tt=(modulo(l[0],Y)+modulo(u[0],Y))/2-modulo(et[0],Y):tt=(l[0]+u[0])/2-et[0];const it=(l[1]+u[1])/2-et[1];te=tt*tt+it*it>this.errorThresholdSquared_}if(te){if(Math.abs(e[0]-n[0])<=Math.abs(e[1]-n[1])){const ne=[(i[0]+n[0])/2,(i[1]+n[1])/2],et=this.transformInv_(ne),tt=[(o[0]+e[0])/2,(o[1]+e[1])/2],it=this.transformInv_(tt);this.addQuad_(e,i,ne,tt,l,c,et,it,f-1),this.addQuad_(tt,ne,n,o,it,et,u,h,f-1)}else{const ne=[(e[0]+i[0])/2,(e[1]+i[1])/2],et=this.transformInv_(ne),tt=[(n[0]+o[0])/2,(n[1]+o[1])/2],it=this.transformInv_(tt);this.addQuad_(e,ne,tt,o,l,et,it,h,f-1),this.addQuad_(ne,i,n,tt,et,c,u,it,f-1)}return}}if(ee){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(xe&11)==0&&this.addTriangle_(e,n,o,l,u,h),(xe&14)==0&&this.addTriangle_(e,n,i,l,u,c),xe&&((xe&13)==0&&this.addTriangle_(i,o,e,c,h,l),(xe&7)==0&&this.addTriangle_(i,o,n,c,h,u))}calculateSourceExtent(){const e=createEmpty();return this.triangles_.forEach(function(i,n,o){const l=i.source;extendCoordinate(e,l[0]),extendCoordinate(e,l[1]),extendCoordinate(e,l[2])}),e}getTriangles(){return this.triangles_}}const ERROR_THRESHOLD=.5;class ReprojTile extends Tile{constructor(e,i,n,o,l,c,u,h,f,g,H,Y){super(l,TileState.IDLE,Y),this.renderEdges_=H!==void 0?H:!1,this.pixelRatio_=u,this.gutter_=h,this.canvas_=null,this.sourceTileGrid_=i,this.targetTileGrid_=o,this.wrappedTileCoord_=c||l,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;const ee=o.getTileCoordExtent(this.wrappedTileCoord_),te=this.targetTileGrid_.getExtent();let xe=this.sourceTileGrid_.getExtent();const ne=te?getIntersection(ee,te):ee;if(getArea(ne)===0){this.state=TileState.EMPTY;return}const et=e.getExtent();et&&(xe?xe=getIntersection(xe,et):xe=et);const tt=o.getResolution(this.wrappedTileCoord_[0]),it=calculateSourceExtentResolution(e,n,ne,tt);if(!isFinite(it)||it<=0){this.state=TileState.EMPTY;return}const rt=g!==void 0?g:ERROR_THRESHOLD;if(this.triangulation_=new Triangulation(e,n,ne,xe,it*rt,tt),this.triangulation_.getTriangles().length===0){this.state=TileState.EMPTY;return}this.sourceZ_=i.getZForResolution(it);let nt=this.triangulation_.calculateSourceExtent();if(xe&&(e.canWrapX()?(nt[1]=clamp$1(nt[1],xe[1],xe[3]),nt[3]=clamp$1(nt[3],xe[1],xe[3])):nt=getIntersection(nt,xe)),!getArea(nt))this.state=TileState.EMPTY;else{let st=0,at=0;e.canWrapX()&&(st=getWidth(et),at=Math.floor((nt[0]-et[0])/st)),wrapAndSliceX(nt.slice(),e,!0).forEach(ct=>{const ht=i.getTileRangeForExtentAndZ(ct,this.sourceZ_);for(let ut=ht.minX;ut<=ht.maxX;ut++)for(let pt=ht.minY;pt<=ht.maxY;pt++){const yt=f(this.sourceZ_,ut,pt,u);if(yt){const mt=at*st;this.sourceTiles_.push({tile:yt,offset:mt})}}++at}),this.sourceTiles_.length===0&&(this.state=TileState.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(i=>{var o;const n=i.tile;if(n&&n.getState()==TileState.LOADED){const l=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);l[0]+=i.offset,l[2]+=i.offset;const c=(o=this.clipExtent_)==null?void 0:o.slice();c&&(c[0]+=i.offset,c[2]+=i.offset),e.push({extent:l,clipExtent:c,image:n.getImage()})}}),this.sourceTiles_.length=0,e.length===0)this.state=TileState.ERROR;else{const i=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(i),o=typeof n=="number"?n:n[0],l=typeof n=="number"?n:n[1],c=this.targetTileGrid_.getResolution(i),u=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=render(o,l,this.pixelRatio_,u,this.sourceTileGrid_.getExtent(),c,h,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=TileState.LOADED}this.changed()}load(){if(this.state==TileState.IDLE){this.state=TileState.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:i})=>{const n=i.getState();if(n==TileState.IDLE||n==TileState.LOADING){e++;const o=listen(i,EventType.CHANGE,l=>{const c=i.getState();(c==TileState.LOADED||c==TileState.ERROR||c==TileState.EMPTY)&&(unlistenByKey(o),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(o)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:i},n,o){i.getState()==TileState.IDLE&&i.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(unlistenByKey),this.sourcesListenerKeys_=null}release(){this.canvas_&&(releaseCanvas(this.canvas_.getContext("2d")),canvasPool$1.push(this.canvas_),this.canvas_=null),super.release()}}class TileImage extends UrlTile{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:defaultTileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:ImageTile,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!equivalent$1(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){const i=this.getProjection();if(this.tileGrid&&(!i||equivalent$1(i,e)))return this.tileGrid;const n=getUid(e);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=getForProjection(e)),this.tileGridForProjection[n]}createTile_(e,i,n,o,l,c){const u=[e,i,n],h=this.getTileCoordForTileUrlFunction(u,l),f=h?this.tileUrlFunction(h,o,l):void 0,g=new this.tileClass(u,f!==void 0?TileState.IDLE:TileState.EMPTY,f!==void 0?f:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return g.key=c,g.addEventListener(EventType.CHANGE,this.handleTileChange.bind(this)),g}getTile(e,i,n,o,l,c){const u=this.getProjection();if(!u||!l||equivalent$1(u,l))return this.getTileInternal(e,i,n,o,u||l);const h=[e,i,n],f=this.getKey(),g=this.getTileGridForProjection(u),H=this.getTileGridForProjection(l),Y=this.getTileCoordForTileUrlFunction(h,l),ee=new ReprojTile(u,g,l,H,h,Y,this.getTilePixelRatio(o),this.getGutter(),(te,xe,ne,et)=>this.getTileInternal(te,xe,ne,et,u,c),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return ee.key=f,ee}getTileInternal(e,i,n,o,l,c){const u=this.getKey(),h=getCacheKey$1(this,u,e,i,n);if(c&&c.containsKey(h))return c.get(h);const f=this.createTile_(e,i,n,o,l,u);return c==null||c.set(h,f),f}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,i){const n=get$3(e);if(n){const o=getUid(n);o in this.tileGridForProjection||(this.tileGridForProjection[o]=i)}}}function defaultTileLoadFunction(s,e){if(WORKER_OFFSCREEN_CANVAS){const i=s.getCrossOrigin();let n="same-origin",o="same-origin";i==="anonymous"||i===""?(n="cors",o="omit"):i==="use-credentials"&&(n="cors",o="include"),fetch(e,{mode:n,credentials:o}).then(l=>{if(!l.ok)throw new Error(`HTTP ${l.status}`);return l.blob()}).then(l=>createImageBitmap(l)).then(l=>{var h;const c=s.getImage();c.width=l.width,c.height=l.height,c.getContext("2d").drawImage(l,0,0),(h=l.close)==null||h.call(l),c.dispatchEvent(new Event("load"))}).catch(()=>{s.getImage().dispatchEvent(new Event("error"))});return}s.getImage().src=e}function fromResolutionLike(s){return Array.isArray(s)?Math.min(...s):s}class ReprojImage extends ImageWrapper{constructor(e,i,n,o,l,c,u){let h=e.getExtent();h&&e.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);let f=i.getExtent();f&&i.canWrapX()&&(f=f.slice(),f[0]=-1/0,f[2]=1/0);const g=f?getIntersection(n,f):n,H=getCenter(g),Y=calculateSourceResolution(e,i,H,o),ee=ERROR_THRESHOLD,te=new Triangulation(e,i,g,h,Y*ee,o),xe=te.calculateSourceExtent(),ne=isEmpty$1(xe)?null:c(xe,Y,l),et=ne?ImageState.IDLE:ImageState.EMPTY,tt=ne?ne.getPixelRatio():1;super(n,o,tt,et),this.targetProj_=i,this.maxSourceExtent_=h,this.triangulation_=te,this.targetResolution_=o,this.targetExtent_=n,this.sourceImage_=ne,this.sourcePixelRatio_=tt,this.interpolate_=u,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==ImageState.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==ImageState.LOADED){const i=getWidth(this.targetExtent_)/this.targetResolution_,n=getHeight(this.targetExtent_)/this.targetResolution_;this.canvas_=render(i,n,this.sourcePixelRatio_,fromResolutionLike(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==ImageState.IDLE){this.state=ImageState.LOADING,this.changed();const e=this.sourceImage_.getState();e==ImageState.LOADED||e==ImageState.ERROR?this.reproject_():(this.sourceListenerKey_=listen(this.sourceImage_,EventType.CHANGE,i=>{const n=this.sourceImage_.getState();(n==ImageState.LOADED||n==ImageState.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){unlistenByKey(this.sourceListenerKey_),this.sourceListenerKey_=null}}const DECIMALS=4,ImageSourceEventType={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class ImageSourceEvent extends BaseEvent{constructor(e,i){super(e),this.image=i}}class ImageSource extends Source{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const i=this.getResolutions();if(i){const n=linearFindNearest(i,e,0);e=i[n]}return e}getImage(e,i,n,o){const l=this.getProjection();if(!l||!o||equivalent$1(l,o))return l&&(o=l),this.getImageInternal(e,i,n,o);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&equivalent$1(this.reprojectedImage_.getProjection(),o)&&this.reprojectedImage_.getResolution()==i&&equals$1(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new ReprojImage(l,o,e,i,n,(c,u,h)=>this.getImageInternal(c,u,h,l),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,i,n,o){if(this.loader){const l=getRequestExtent(e,i,n,1),c=this.findNearestResolution(i);if(this.image&&(this.static_||this.wantedProjection_===o&&(this.wantedExtent_&&containsExtent(this.wantedExtent_,l)||containsExtent(this.image.getExtent(),l))&&(this.wantedResolution_&&fromResolutionLike(this.wantedResolution_)===c||fromResolutionLike(this.image.getResolution())===c)))return this.image;this.wantedProjection_=o,this.wantedExtent_=l,this.wantedResolution_=c,this.image=new ImageWrapper(l,c,n,this.loader),this.image.addEventListener(EventType.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const i=e.target;let n;switch(i.getState()){case ImageState.LOADING:this.loading=!0,n=ImageSourceEventType.IMAGELOADSTART;break;case ImageState.LOADED:this.loading=!1,n=ImageSourceEventType.IMAGELOADEND;break;case ImageState.ERROR:this.loading=!1,n=ImageSourceEventType.IMAGELOADERROR;break;default:return}this.hasListener(n)&&this.dispatchEvent(new ImageSourceEvent(n,i))}}function defaultImageLoadFunction(s,e){s.getImage().src=e}function getRequestExtent(s,e,i,n){const o=e/i,l=getCenter(s),c=ceil(getWidth(s)/o,DECIMALS),u=ceil(getHeight(s)/o,DECIMALS),h=ceil((n-1)*c/2,DECIMALS),f=c+2*h,g=ceil((n-1)*u/2,DECIMALS),H=u+2*g;return getForViewAndSize(l,o,0,[f,H])}const DEFAULT_VERSION="1.3.0",GETFEATUREINFO_IMAGE_SIZE=[101,101];function getRequestUrl(s,e,i,n,o){o.WIDTH=i[0],o.HEIGHT=i[1];const l=n.getAxisOrientation(),c=compareVersions(o.VERSION,"1.3")>=0;o[c?"CRS":"SRS"]=n.getCode();const u=c&&l.startsWith("ne")?[e[1],e[0],e[3],e[2]]:e;return o.BBOX=u.join(","),appendParams(s,o)}function getImageSrc(s,e,i,n,o,l,c){l=Object.assign({REQUEST:"GetMap"},l);const u=e/i,h=[round(getWidth(s)/u,DECIMALS),round(getHeight(s)/u,DECIMALS)];if(i!=1)switch(c){case"geoserver":const g=90*i+.5|0;"FORMAT_OPTIONS"in l?l.FORMAT_OPTIONS+=";dpi:"+g:l.FORMAT_OPTIONS="dpi:"+g;break;case"mapserver":l.MAP_RESOLUTION=90*i;break;case"carmentaserver":case"qgis":l.DPI=90*i;break;default:throw new Error("Unknown `serverType` configured")}return getRequestUrl(o,s,h,n,l)}function getRequestParams(s,e){return Object.assign({REQUEST:e,SERVICE:"WMS",VERSION:DEFAULT_VERSION,FORMAT:"image/png",STYLES:"",TRANSPARENT:"TRUE"},s)}function createLoader(s){const e=s.hidpi===void 0?!0:s.hidpi,i=get$3(s.projection||"EPSG:3857"),n=s.ratio||1.5,o=s.load||decode$1,l=s.crossOrigin??null;return(c,u,h)=>{c=getRequestExtent(c,u,h,n),h!=1&&(!e||s.serverType===void 0)&&(h=1);const f=getImageSrc(c,u,h,i,s.url,getRequestParams(s.params,"GetMap"),s.serverType),g=new Image;return g.crossOrigin=l,o(g,f).then(H=>({image:H,extent:c,pixelRatio:h}))}}function getFeatureInfoUrl(s,e,i){if(s.url===void 0)return;const n=get$3(s.projection||"EPSG:3857"),o=getForViewAndSize(e,i,0,GETFEATUREINFO_IMAGE_SIZE),l={QUERY_LAYERS:s.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(l,getRequestParams(s.params,"GetFeatureInfo"),s.params);const c=floor((e[0]-o[0])/i,DECIMALS),u=floor((o[3]-e[1])/i,DECIMALS),h=compareVersions(l.VERSION,"1.3")>=0;return l[h?"I":"X"]=c,l[h?"J":"Y"]=u,getRequestUrl(s.url,o,GETFEATUREINFO_IMAGE_SIZE,n,l)}function getLegendUrl(s,e){if(s.url===void 0)return;const i={SERVICE:"WMS",VERSION:DEFAULT_VERSION,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(e!==void 0){const n=get$3(s.projection||"EPSG:3857").getMetersPerUnit()||1,o=28e-5;i.SCALE=e*n/o}if(Object.assign(i,s.params),s.params!==void 0&&i.LAYER===void 0){const n=i.LAYERS;if(!(!Array.isArray(n)||n.length!==1))return;i.LAYER=n}return appendParams(s.url,i)}class TileWMS extends TileImage{constructor(e){e=e||{};const i=Object.assign({},e.params);super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.params_=i,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=createEmpty(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,i,n,o){const l=get$3(n),c=this.getProjection()||l;let u=this.getTileGrid();u||(u=this.getTileGridForProjection(c));const h=transform$1(e,l,c),f=calculateSourceResolution(c,l,e,i),g=u.getZForResolution(f,this.zDirection),H=u.getResolution(g),Y=u.getTileCoordForCoordAndZ(h,g);if(u.getResolutions().length<=Y[0])return;let ee=u.getTileCoordExtent(Y,this.tmpExtent_);const te=this.gutter_;te!==0&&(ee=buffer(ee,H*te,ee));const xe={QUERY_LAYERS:this.params_.LAYERS};Object.assign(xe,getRequestParams(this.params_,"GetFeatureInfo"),o);const ne=Math.floor((h[0]-ee[0])/H),et=Math.floor((ee[3]-h[1])/H);return xe[this.v13_?"I":"X"]=ne,xe[this.v13_?"J":"Y"]=et,this.getRequestUrl_(Y,ee,1,c||l,xe)}getLegendUrl(e,i){if(this.urls[0]===void 0)return;const n={SERVICE:"WMS",VERSION:DEFAULT_VERSION,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(i===void 0||i.LAYER===void 0){const o=this.params_.LAYERS;if(!(!Array.isArray(o)||o.length===1))return;n.LAYER=o}if(e!==void 0){const o=this.getProjection()?this.getProjection().getMetersPerUnit():1,l=28e-5;n.SCALE=e*o/l}return Object.assign(n,i),appendParams(this.urls[0],n)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,i,n,o,l){const c=this.urls;if(!c)return;let u;if(c.length==1)u=c[0];else{const h=modulo(hash(e),c.length);u=c[h]}return getImageSrc(i,(this.tileGrid||this.getTileGridForProjection(o)).getResolution(e[0]),n,o,u,l,this.serverType_)}getTilePixelRatio(e){return!this.hidpi_||this.serverType_===void 0?1:e}getKeyForParams_(){let e=0;const i=[];for(const n in this.params_)i[e++]=n+"-"+this.params_[n];return i.join("/")}setParams_(e){this.params_=e,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(e){this.setParams_(Object.assign({},e))}updateParams(e){this.setParams_(Object.assign(this.params_,e))}updateV13_(){const e=this.params_.VERSION||DEFAULT_VERSION;this.v13_=compareVersions(e,"1.3")>=0}tileUrlFunction(e,i,n){let o=this.getTileGrid();if(o||(o=this.getTileGridForProjection(n)),o.getResolutions().length<=e[0])return;i!=1&&(!this.hidpi_||this.serverType_===void 0)&&(i=1);const l=o.getResolution(e[0]);let c=o.getTileCoordExtent(e,this.tmpExtent_);const u=this.gutter_;u!==0&&(c=buffer(c,l*u,c));const h=Object.assign({},getRequestParams(this.params_,"GetMap"));return this.getRequestUrl_(e,c,i,n,h)}}let WMTS$1=class extends TileImage{constructor(e){const i=e.requestEncoding!==void 0?e.requestEncoding:"KVP",n=e.tileGrid;let o=e.urls;o===void 0&&e.url!==void 0&&(o=expandUrl(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:o,wrapX:e.wrapX!==void 0?e.wrapX:!1,transition:e.transition,zDirection:e.zDirection}),this.version_=e.version!==void 0?e.version:"1.0.0",this.format_=e.format!==void 0?e.format:"image/jpeg",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=i,this.setKey(this.getKeyForDimensions_()),o&&o.length>0&&(this.tileUrlFunction=createFromTileUrlFunctions(o.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const i=e.join(`
`);this.setTileUrlFunction(createFromTileUrlFunctions(e.map(this.createFromWMTSTemplate.bind(this))),i)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const i in this.dimensions_)e.push(i+"-"+this.dimensions_[i]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const i=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};i=="KVP"&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=i=="KVP"?appendParams(e,n):e.replace(/\{(\w+?)\}/g,function(c,u){return u.toLowerCase()in n?n[u.toLowerCase()]:c});const o=this.tileGrid,l=this.dimensions_;return(function(c,u,h){if(!c)return;const f={TileMatrix:o.getMatrixId(c[0]),TileCol:c[1],TileRow:c[2]};Object.assign(f,l);let g=e;return i=="KVP"?g=appendParams(g,f):g=g.replace(/\{(\w+?)\}/g,function(H,Y){return encodeURIComponent(f[Y])}),g})}};class ImageWMS extends ImageSource{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:defaultImageLoadFunction,this.params_=Object.assign({},e.params),this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,i,n,o){const l=get$3(n),c=this.getProjection();c&&c!==l&&(i=calculateSourceResolution(c,l,e,i),e=transform$1(e,l,c));const u={url:this.url_,params:{...this.params_,...o},projection:c||l};return getFeatureInfoUrl(u,e,i)}getLegendUrl(e,i){return getLegendUrl({url:this.url_,params:{...this.params_,...i}},e)}getParams(){return this.params_}getImageInternal(e,i,n,o){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==o)&&(this.loaderProjection_=o,this.loader=createLoader({crossOrigin:this.crossOrigin_,params:this.params_,projection:o,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(l,c)=>(this.image.setImage(l),this.imageLoadFunction_(this.image,c),decode$1(l))})),super.getImageInternal(e,i,n,o))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}const MapBrowserEventType={SINGLECLICK:"singleclick",CLICK:EventType.CLICK,DBLCLICK:EventType.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},InteractionProperty={ACTIVE:"active"};class Interaction extends BaseObject{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(InteractionProperty.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(InteractionProperty.ACTIVE,e)}setMap(e){this.map_=e}}function pan(s,e,i){const n=s.getCenterInternal();if(n){const o=[n[0]+e[0],n[1]+e[1]];s.animateInternal({duration:i!==void 0?i:250,easing:linear,center:s.getConstrainedCenter(o)})}}function zoomByDelta(s,e,i,n){const o=s.getZoom();if(o===void 0)return;const l=s.getConstrainedZoom(o+e),c=s.getResolutionForZoom(l);s.getAnimating()&&s.cancelAnimations(),s.animate({resolution:c,anchor:i,duration:n!==void 0?n:250,easing:easeOut})}class DoubleClickZoom extends Interaction{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let i=!1;if(e.type==MapBrowserEventType.DBLCLICK){const n=e.originalEvent,o=e.map,l=e.coordinate,c=n.shiftKey?-this.delta_:this.delta_,u=o.getView();zoomByDelta(u,c,l,this.duration_),n.preventDefault(),i=!0}return!i}}function all(s){const e=arguments;return function(i){let n=!0;for(let o=0,l=e.length;o<l&&(n=n&&e[o](i),!!n);++o);return n}}const altKeyOnly=function(s){const e=s.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},altShiftKeysOnly=function(s){const e=s.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},focus=function(s){const e=s.map.getTargetElement(),i=e.getRootNode(),n=s.map.getOwnerDocument().activeElement;return i instanceof ShadowRoot?i.host.contains(n):e.contains(n)},focusWithTabindex=function(s){const e=s.map.getTargetElement(),i=e.getRootNode();return(i instanceof ShadowRoot?i.host:e).hasAttribute("tabindex")?focus(s):!0},always$1=TRUE,mouseActionButton=function(s){const e=s.originalEvent;return"pointerId"in e&&e.button==0&&!(WEBKIT&&MAC&&e.ctrlKey)},never=FALSE,pointerMove=function(s){return s.type=="pointermove"},singleClick=function(s){return s.type==MapBrowserEventType.SINGLECLICK},noModifierKeys=function(s){const e=s.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},platformModifierKey=function(s){const e=s.originalEvent;return MAC?e.metaKey:e.ctrlKey},shiftKeyOnly=function(s){const e=s.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},targetNotEditable=function(s){const e=s.originalEvent,i=e.target.tagName;return i!=="INPUT"&&i!=="SELECT"&&i!=="TEXTAREA"&&!e.target.isContentEditable},mouseOnly=function(s){const e=s.originalEvent;return"pointerId"in e&&e.pointerType=="mouse"},primaryAction=function(s){const e=s.originalEvent;return"pointerId"in e&&e.isPrimary&&e.button===0};class RenderBox extends Disposable{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,i=this.endPixel_,n="px",o=this.element_.style;o.left=Math.min(e[0],i[0])+n,o.top=Math.min(e[1],i[1])+n,o.width=Math.abs(i[0]-e[0])+n,o.height=Math.abs(i[1]-e[1])+n}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const i=this.element_.style;i.left="inherit",i.top="inherit",i.width="inherit",i.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,i){this.startPixel_=e,this.endPixel_=i,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const e=this.startPixel_,i=this.endPixel_,o=[e,[e[0],i[1]],i,[i[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);o[4]=o[0].slice(),this.geometry_?this.geometry_.setCoordinates([o]):this.geometry_=new Polygon([o])}getGeometry(){return this.geometry_}}class PointerInteraction extends Interaction{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let i=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==MapBrowserEventType.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==MapBrowserEventType.POINTERUP){const n=this.handleUpEvent(e);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(e.type==MapBrowserEventType.POINTERDOWN){const n=this.handleDownEvent(e);this.handlingDownUpSequence=n,i=this.stopDown(n)}else e.type==MapBrowserEventType.POINTERMOVE&&this.handleMoveEvent(e);return!i}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function centroid(s){const e=s.length;let i=0,n=0;for(let o=0;o<e;o++)i+=s[o].clientX,n+=s[o].clientY;return{clientX:i/e,clientY:n/e}}const DragBoxEventType={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class DragBoxEvent extends BaseEvent{constructor(e,i,n){super(e),this.coordinate=i,this.mapBrowserEvent=n}}class DragBox extends PointerInteraction{constructor(e){super(),this.on,this.once,this.un,e=e??{},this.box_=new RenderBox(e.className||"ol-dragbox"),this.minArea_=e.minArea??64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition??mouseActionButton,this.boxEndCondition_=e.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(e,i,n){const o=n[0]-i[0],l=n[1]-i[1];return o*o+l*l>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXDRAG,e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;const i=this.boxEndCondition_(e,this.startPixel_,e.pixel);return i&&this.onBoxEnd(e),this.dispatchEvent(new DragBoxEvent(i?DragBoxEventType.BOXEND:DragBoxEventType.BOXCANCEL,e.coordinate,e)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(e)}setMap(e){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(e)}}class DragPan extends PointerInteraction{constructor(e){super({stopDown:FALSE}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const i=e.condition?e.condition:all(noModifierKeys,primaryAction);this.condition_=e.onFocusOnly?all(focusWithTabindex,i):i,this.noKinetic_=!1}handleDragEvent(e){const i=e.map;this.panning_||(this.panning_=!0,i.getView().beginInteraction());const n=this.targetPointers,o=i.getEventPixel(centroid(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(o[0],o[1]),this.lastCentroid){const l=[this.lastCentroid[0]-o[0],o[1]-this.lastCentroid[1]],u=e.map.getView();scale$3(l,u.getResolution()),rotate$1(l,u.getRotation()),u.adjustCenterInternal(l)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=o,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()}handleUpEvent(e){const i=e.map,n=i.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const o=this.kinetic_.getDistance(),l=this.kinetic_.getAngle(),c=n.getCenterInternal(),u=i.getPixelFromCoordinateInternal(c),h=i.getCoordinateFromPixelInternal([u[0]-o*Math.cos(l),u[1]-o*Math.sin(l)]);n.animateInternal({center:n.getConstrainedCenter(h),duration:500,easing:easeOut})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const n=e.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}function disable(s){if(s!==void 0)return 0}function none$1(s){if(s!==void 0)return s}function createSnapToN(s){const e=2*Math.PI/s;return(function(i,n){if(n)return i;if(i!==void 0)return i=Math.floor(i/e+.5)*e,i})}function createSnapToZero(s){const e=toRadians(5);return(function(i,n){return n||i===void 0?i:Math.abs(i)<=e?0:i})}class DragRotate extends PointerInteraction{constructor(e){e=e||{},super({stopDown:FALSE}),this.condition_=e.condition?e.condition:altShiftKeysOnly,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!mouseOnly(e))return;const i=e.map,n=i.getView();if(n.getConstraints().rotation===disable)return;const o=i.getSize(),l=e.pixel,c=Math.atan2(o[1]/2-l[1],l[0]-o[0]/2);if(this.lastAngle_!==void 0){const u=c-this.lastAngle_;n.adjustRotationInternal(-u)}this.lastAngle_=c}handleUpEvent(e){return mouseOnly(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return mouseOnly(e)&&mouseActionButton(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class DragZoom extends DragBox{constructor(e){e=e||{};const i=e.condition?e.condition:shiftKeyOnly;super({condition:i,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const n=this.getMap().getView();let o=this.getGeometry();if(this.out_){const l=n.rotatedExtentForGeometry(o),c=n.getResolutionForExtentInternal(l),u=n.getResolution()/c;o=o.clone(),o.scale(u*u)}n.fitInternal(o,{duration:this.duration_,easing:easeOut})}}class MapEvent extends BaseEvent{constructor(e,i,n){super(e),this.map=i,this.frameState=n!==void 0?n:null}}class MapBrowserEvent extends MapEvent{constructor(e,i,n,o,l,c){super(e,i,l),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=o!==void 0?o:!1,this.activePointers=c}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const ViewHint={ANIMATING:0,INTERACTING:1},RenderEventType={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},NO_COLOR=[NaN,NaN,NaN,0];let colorParseContext;function getColorParseContext(){return colorParseContext||(colorParseContext=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),colorParseContext}const rgbModernRegEx=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,rgbLegacyAbsoluteRegEx=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,rgbLegacyPercentageRegEx=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,hexRegEx=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function toColorComponent(s,e){return s.endsWith("%")?Number(s.substring(0,s.length-1))/e:Number(s)}function throwInvalidColor(s){throw new Error('failed to parse "'+s+'" as color')}function parseRgba(s){if(s.toLowerCase().startsWith("rgb")){const l=s.match(rgbLegacyAbsoluteRegEx)||s.match(rgbModernRegEx)||s.match(rgbLegacyPercentageRegEx);if(l){const c=l[4],u=100/255;return[clamp$1(toColorComponent(l[1],u)+.5|0,0,255),clamp$1(toColorComponent(l[2],u)+.5|0,0,255),clamp$1(toColorComponent(l[3],u)+.5|0,0,255),c!==void 0?clamp$1(toColorComponent(c,100),0,1):1]}throwInvalidColor(s)}if(s.startsWith("#")){if(hexRegEx.test(s)){const l=s.substring(1),c=l.length<=4?1:2,u=[0,0,0,255];for(let h=0,f=l.length;h<f;h+=c){let g=parseInt(l.substring(h,h+c),16);c===1&&(g+=g<<4),u[h/c]=g}return u[3]=u[3]/255,u}throwInvalidColor(s)}const e=getColorParseContext();e.fillStyle="#abcdef";let i=e.fillStyle;e.fillStyle=s,e.fillStyle===i&&(e.fillStyle="#fedcba",i=e.fillStyle,e.fillStyle=s,e.fillStyle===i&&throwInvalidColor(s));const n=e.fillStyle;if(n.startsWith("#")||n.startsWith("rgba"))return parseRgba(n);e.clearRect(0,0,1,1),e.fillRect(0,0,1,1);const o=Array.from(e.getImageData(0,0,1,1).data);return o[3]=toFixed(o[3]/255,3),o}function asString(s){return typeof s=="string"?s:toString(s)}const MAX_CACHE_SIZE=1024,cache={};let cacheSize=0;function withAlpha(s){if(s.length===4)return s;const e=s.slice();return e[3]=1,e}function b1(s){return s>.0031308?Math.pow(s,1/2.4)*269.025-14.025:s*3294.6}function b2(s){return s>.2068965?Math.pow(s,3):(s-4/29)*(108/841)}function a1(s){return s>10.314724?Math.pow((s+14.025)/269.025,2.4):s/3294.6}function a2(s){return s>.0088564?Math.pow(s,1/3):s/(108/841)+4/29}function rgbaToLcha(s){const e=a1(s[0]),i=a1(s[1]),n=a1(s[2]),o=a2(e*.222488403+i*.716873169+n*.06060791),l=500*(a2(e*.452247074+i*.399439023+n*.148375274)-o),c=200*(o-a2(e*.016863605+i*.117638439+n*.865350722)),u=Math.atan2(c,l)*(180/Math.PI);return[116*o-16,Math.sqrt(l*l+c*c),u<0?u+360:u,s[3]]}function lchaToRgba(s){const e=(s[0]+16)/116,i=s[1],n=s[2]*Math.PI/180,o=b2(e),l=b2(e+i/500*Math.cos(n)),c=b2(e-i/200*Math.sin(n)),u=b1(l*3.021973625-o*1.617392459-c*.404875592),h=b1(l*-.943766287+o*1.916279586+c*.027607165),f=b1(l*.069407491-o*.22898585+c*1.159737864);return[clamp$1(u+.5|0,0,255),clamp$1(h+.5|0,0,255),clamp$1(f+.5|0,0,255),s[3]]}function fromString(s){if(s==="none")return NO_COLOR;if(cache.hasOwnProperty(s))return cache[s];if(cacheSize>=MAX_CACHE_SIZE){let i=0;for(const n in cache)(i++&3)===0&&(delete cache[n],--cacheSize)}const e=parseRgba(s);e.length!==4&&throwInvalidColor(s);for(const i of e)isNaN(i)&&throwInvalidColor(s);return cache[s]=e,++cacheSize,e}function asArray(s){return Array.isArray(s)?s:fromString(s)}function toString(s){let e=s[0];e!=(e|0)&&(e=e+.5|0);let i=s[1];i!=(i|0)&&(i=i+.5|0);let n=s[2];n!=(n|0)&&(n=n+.5|0);const o=s[3]===void 0?1:Math.round(s[3]*1e3)/1e3;return"rgba("+e+","+i+","+n+","+o+")"}class IconImageCache{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const i in this.cache_){const n=this.cache_[i];(e++&3)===0&&!n.hasListener()&&(delete this.cache_[i],delete this.patternCache_[i],--this.cacheSize_)}}}get(e,i,n){const o=getCacheKey(e,i,n);return o in this.cache_?this.cache_[o]:null}getPattern(e,i,n){const o=getCacheKey(e,i,n);return o in this.patternCache_?this.patternCache_[o]:null}set(e,i,n,o,l){const c=getCacheKey(e,i,n),u=c in this.cache_;this.cache_[c]=o,l&&(o.getImageState()===ImageState.IDLE&&o.load(),o.getImageState()===ImageState.LOADING?o.ready().then(()=>{this.patternCache_[c]=getSharedCanvasContext2D().createPattern(o.getImage(1),"repeat")}):this.patternCache_[c]=getSharedCanvasContext2D().createPattern(o.getImage(1),"repeat")),u||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function getCacheKey(s,e,i){const n=i?asArray(i):"null";return e+":"+s+":"+n}const shared=new IconImageCache;let taintedTestContext=null;class IconImage extends Target{constructor(e,i,n,o,l){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=n,this.canvas_={},this.color_=l,this.imageState_=o===void 0?ImageState.IDLE:o,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=i,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===ImageState.LOADED){taintedTestContext||(taintedTestContext=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0})),taintedTestContext.drawImage(this.image_,0,0);try{taintedTestContext.getImageData(0,0,1,1),this.tainted_=!1}catch{taintedTestContext=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(EventType.CHANGE)}handleImageError_(){this.imageState_=ImageState.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=ImageState.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],i=this.size_[1],n=createCanvasContext2D(e,i);n.fillRect(0,0,e,i),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===ImageState.IDLE){this.image_||this.initializeImage_(),this.imageState_=ImageState.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&decodeFallback(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==ImageState.LOADED)return;const i=this.image_,n=createCanvasContext2D(Math.ceil(i.width*e),Math.ceil(i.height*e)),o=n.canvas;n.scale(e,e),n.drawImage(i,0,0),n.globalCompositeOperation="multiply",n.fillStyle=asString(this.color_),n.fillRect(0,0,o.width/e,o.height/e),n.globalCompositeOperation="destination-in",n.drawImage(i,0,0),this.canvas_[e]=o}ready(){return this.ready_||(this.ready_=new Promise(e=>{if(this.imageState_===ImageState.LOADED||this.imageState_===ImageState.ERROR)e();else{const i=()=>{(this.imageState_===ImageState.LOADED||this.imageState_===ImageState.ERROR)&&(this.removeEventListener(EventType.CHANGE,i),e())};this.addEventListener(EventType.CHANGE,i)}})),this.ready_}}function get$2(s,e,i,n,o,l){let c=e===void 0?void 0:shared.get(e,i,o);return c||(c=new IconImage(s,s&&"src"in s?s.src||void 0:e,i,n,o),shared.set(e,i,o,c,l)),l&&c&&!shared.getPattern(e,i,o)&&shared.set(e,i,o,c,l),c}function asColorLike(s){return s?Array.isArray(s)?toString(s):typeof s=="object"&&"src"in s?asCanvasPattern(s):s:null}function asCanvasPattern(s){if(!s.offset||!s.size)return shared.getPattern(s.src,"anonymous",s.color);const e=s.src+":"+s.offset,i=shared.getPattern(e,void 0,s.color);if(i)return i;const n=shared.get(s.src,"anonymous",null);if(n.getImageState()!==ImageState.LOADED)return null;const o=createCanvasContext2D(s.size[0],s.size[1]);return o.drawImage(n.getImage(1),s.offset[0],s.offset[1],s.size[0],s.size[1],0,0,s.size[0],s.size[1]),get$2(o.canvas,e,void 0,ImageState.LOADED,s.color,!0),shared.getPattern(e,void 0,s.color)}class VectorContext{drawCustom(e,i,n,o,l){}drawGeometry(e){}setStyle(e){}drawCircle(e,i,n){}drawFeature(e,i,n){}drawGeometryCollection(e,i,n){}drawLineString(e,i,n){}drawMultiLineString(e,i,n){}drawMultiPoint(e,i,n){}drawMultiPolygon(e,i,n){}drawPoint(e,i,n){}drawPolygon(e,i,n){}drawText(e,i,n){}setFillStrokeStyle(e,i){}setImageStyle(e,i){}setTextStyle(e,i){}}const defaultFont="10px sans-serif",defaultFillStyle="#000",defaultLineCap="round",defaultLineDash=[],defaultLineDashOffset=0,defaultLineJoin="round",defaultMiterLimit=10,defaultStrokeStyle="#000",defaultTextAlign="center",defaultTextBaseline="middle",defaultPadding=[0,0,0,0],defaultLineWidth=1,checkedFonts=new BaseObject;let measureContext$1=null,measureFont;const textHeights={},genericFontFamilies=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"]);function getFontKey(s,e,i){return`${s} ${e} 16px "${i}"`}const registerFont=(function(){let e,i;async function n(l){await i.ready;const c=await i.load(l);if(c.length===0)return!1;const u=getFontParameters(l),h=u.families[0].toLowerCase(),f=u.weight;return c.some(g=>{const H=g.family.replace(/^['"]|['"]$/g,"").toLowerCase(),Y=fontWeights$1[g.weight]||g.weight;return H===h&&g.style===u.style&&Y==f})}async function o(){await i.ready;let l=!0;const c=checkedFonts.getProperties(),u=Object.keys(c).filter(h=>c[h]<100);for(let h=u.length-1;h>=0;--h){const f=u[h];let g=c[f];g<100&&(await n(f)?(clear$1(textHeights),checkedFonts.set(f,100)):(g+=10,checkedFonts.set(f,g,!0),g<100&&(l=!1)))}e=void 0,l||(e=setTimeout(o,100))}return async function(l){i||(i=WORKER_OFFSCREEN_CANVAS?self.fonts:document.fonts);const c=getFontParameters(l);if(!c)return;const u=c.families;let h=!1;for(const f of u){if(genericFontFamilies.has(f))continue;const g=getFontKey(c.style,c.weight,f);checkedFonts.get(g)===void 0&&(checkedFonts.set(g,0,!0),h=!0)}h&&(clearTimeout(e),e=setTimeout(o,100))}})(),measureTextHeight=(function(){let s;return function(e){let i=textHeights[e];if(i==null){if(WORKER_OFFSCREEN_CANVAS){const n=getFontParameters(e),o=measureText$1(e,"g");i=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(o.actualBoundingBoxAscent+o.actualBoundingBoxDescent)}else s||(s=document.createElement("div"),s.innerHTML="M",s.style.minHeight="0",s.style.maxHeight="none",s.style.height="auto",s.style.padding="0",s.style.border="none",s.style.position="absolute",s.style.display="block",s.style.left="-99999px"),s.style.font=e,document.body.appendChild(s),i=s.offsetHeight,document.body.removeChild(s);textHeights[e]=i}return i}})();function measureText$1(s,e){return measureContext$1||(measureContext$1=createCanvasContext2D(1,1)),s!=measureFont&&(measureContext$1.font=s,measureFont=measureContext$1.font),measureContext$1.measureText(e)}function measureTextWidth(s,e){return measureText$1(s,e).width}function measureAndCacheTextWidth(s,e,i){if(e in i)return i[e];const n=e.split(`
`).reduce((o,l)=>Math.max(o,measureTextWidth(s,l)),0);return i[e]=n,n}function getTextDimensions(s,e){const i=[],n=[],o=[];let l=0,c=0,u=0,h=0;for(let f=0,g=e.length;f<=g;f+=2){const H=e[f];if(H===`
`||f===g){l=Math.max(l,c),o.push(c),c=0,u+=h,h=0;continue}const Y=e[f+1]||s.font,ee=measureTextWidth(Y,H);i.push(ee),c+=ee;const te=measureTextHeight(Y);n.push(te),h=Math.max(h,te)}return{width:l,height:u,widths:i,heights:n,lineWidths:o}}function drawImageOrLabel(s,e,i,n,o,l,c,u,h,f,g){s.save(),i!==1&&(s.globalAlpha===void 0?s.globalAlpha=H=>H.globalAlpha*=i:s.globalAlpha*=i),e&&s.transform.apply(s,e),n.contextInstructions?(s.translate(h,f),s.scale(g[0],g[1]),executeLabelInstructions(n,s)):g[0]<0||g[1]<0?(s.translate(h,f),s.scale(g[0],g[1]),s.drawImage(n,o,l,c,u,0,0,c,u)):s.drawImage(n,o,l,c,u,h,f,c*g[0],u*g[1]),s.restore()}function executeLabelInstructions(s,e){const i=s.contextInstructions;for(let n=0,o=i.length;n<o;n+=2)Array.isArray(i[n+1])?e[i[n]].apply(e,i[n+1]):e[i[n]]=i[n+1]}const Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},fillInstruction=[Instruction.FILL],strokeInstruction=[Instruction.STROKE],beginPathInstruction=[Instruction.BEGIN_PATH],closePathInstruction=[Instruction.CLOSE_PATH];class CanvasBuilder extends VectorContext{constructor(e,i,n,o){super(),this.tolerance=e,this.maxExtent=i,this.pixelRatio=o,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const i=this.pixelRatio;return i==1?e:e.map(function(n){return n*i})}appendFlatPointCoordinates(e,i){const n=this.getBufferedMaxExtent(),o=this.tmpCoordinate_,l=this.coordinates;let c=l.length;for(let u=0,h=e.length;u<h;u+=i)o[0]=e[u],o[1]=e[u+1],containsCoordinate(n,o)&&(l[c++]=o[0],l[c++]=o[1]);return c}appendFlatLineCoordinates(e,i,n,o,l,c){const u=this.coordinates;let h=u.length;const f=this.getBufferedMaxExtent();c&&(i+=o);let g=e[i],H=e[i+1];const Y=this.tmpCoordinate_;let ee=!0,te,xe,ne;for(te=i+o;te<n;te+=o)Y[0]=e[te],Y[1]=e[te+1],ne=coordinateRelationship(f,Y),ne!==xe?(ee&&(u[h++]=g,u[h++]=H,ee=!1),u[h++]=Y[0],u[h++]=Y[1]):ne===Relationship.INTERSECTING?(u[h++]=Y[0],u[h++]=Y[1],ee=!1):ee=!0,g=Y[0],H=Y[1],xe=ne;return(l&&ee||te===i+o)&&(u[h++]=g,u[h++]=H),h}drawCustomCoordinates_(e,i,n,o,l){for(let c=0,u=n.length;c<u;++c){const h=n[c],f=this.appendFlatLineCoordinates(e,i,h,o,!1,!1);l.push(f),i=h}return i}drawCustom(e,i,n,o,l){this.beginGeometry(e,i,l);const c=e.getType(),u=e.getStride(),h=this.coordinates.length;let f,g,H,Y,ee;switch(c){case"MultiPolygon":f=e.getOrientedFlatCoordinates(),Y=[];const te=e.getEndss();ee=0;for(let xe=0,ne=te.length;xe<ne;++xe){const et=[];ee=this.drawCustomCoordinates_(f,ee,te[xe],u,et),Y.push(et)}this.instructions.push([Instruction.CUSTOM,h,Y,e,n,inflateMultiCoordinatesArray,l]),this.hitDetectionInstructions.push([Instruction.CUSTOM,h,Y,e,o||n,inflateMultiCoordinatesArray,l]);break;case"Polygon":case"MultiLineString":H=[],f=c=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),ee=this.drawCustomCoordinates_(f,0,e.getEnds(),u,H),this.instructions.push([Instruction.CUSTOM,h,H,e,n,inflateCoordinatesArray,l]),this.hitDetectionInstructions.push([Instruction.CUSTOM,h,H,e,o||n,inflateCoordinatesArray,l]);break;case"LineString":case"Circle":f=e.getFlatCoordinates(),g=this.appendFlatLineCoordinates(f,0,f.length,u,!1,!1),this.instructions.push([Instruction.CUSTOM,h,g,e,n,inflateCoordinates,l]),this.hitDetectionInstructions.push([Instruction.CUSTOM,h,g,e,o||n,inflateCoordinates,l]);break;case"MultiPoint":f=e.getFlatCoordinates(),g=this.appendFlatPointCoordinates(f,u),g>h&&(this.instructions.push([Instruction.CUSTOM,h,g,e,n,inflateCoordinates,l]),this.hitDetectionInstructions.push([Instruction.CUSTOM,h,g,e,o||n,inflateCoordinates,l]));break;case"Point":f=e.getFlatCoordinates(),this.coordinates.push(f[0],f[1]),g=this.coordinates.length,this.instructions.push([Instruction.CUSTOM,h,g,e,n,void 0,l]),this.hitDetectionInstructions.push([Instruction.CUSTOM,h,g,e,o||n,void 0,l]);break}this.endGeometry(i)}beginGeometry(e,i,n){this.beginGeometryInstruction1_=[Instruction.BEGIN_GEOMETRY,i,0,e,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Instruction.BEGIN_GEOMETRY,i,0,e,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let i;const n=e.length;let o,l,c=-1;for(i=0;i<n;++i)o=e[i],l=o[0],l==Instruction.END_GEOMETRY?c=i:l==Instruction.BEGIN_GEOMETRY&&(o[2]=i,reverseSubArray(this.hitDetectionInstructions,c,i),c=-1)}fillStyleToState(e,i={}){if(e){const n=e.getColor();i.fillPatternScale=n&&typeof n=="object"&&"src"in n?this.pixelRatio:1,i.fillStyle=asColorLike(n||defaultFillStyle)}else i.fillStyle=void 0;return i}strokeStyleToState(e,i={}){if(e){const n=e.getColor();i.strokeStyle=asColorLike(n||defaultStrokeStyle);const o=e.getLineCap();i.lineCap=o!==void 0?o:defaultLineCap;const l=e.getLineDash();i.lineDash=l?l.slice():defaultLineDash;const c=e.getLineDashOffset();i.lineDashOffset=c||defaultLineDashOffset;const u=e.getLineJoin();i.lineJoin=u!==void 0?u:defaultLineJoin;const h=e.getWidth();i.lineWidth=h!==void 0?h:defaultLineWidth;const f=e.getMiterLimit();i.miterLimit=f!==void 0?f:defaultMiterLimit,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0;return i}setFillStrokeStyle(e,i){const n=this.state;this.fillStyleToState(e,n),this.strokeStyleToState(i,n)}createFill(e){const i=e.fillStyle,n=[Instruction.SET_FILL_STYLE,i];return typeof i!="string"&&n.push(e.fillPatternScale),n}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[Instruction.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash?this.applyPixelRatio(e.lineDash):null,e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,i){const n=e.fillStyle;(typeof n!="string"||e.currentFillStyle!=n)&&(this.instructions.push(i.call(this,e)),e.currentFillStyle=n)}updateStrokeStyle(e,i){const n=e.strokeStyle,o=e.lineCap,l=e.lineDash,c=e.lineDashOffset,u=e.lineJoin,h=e.lineWidth,f=e.miterLimit;(e.currentStrokeStyle!=n||e.currentLineCap!=o||l!=e.currentLineDash&&!equals(e.currentLineDash,l)||e.currentLineDashOffset!=c||e.currentLineJoin!=u||e.currentLineWidth!=h||e.currentMiterLimit!=f)&&(i.call(this,e),e.currentStrokeStyle=n,e.currentLineCap=o,e.currentLineDash=l,e.currentLineDashOffset=c,e.currentLineJoin=u,e.currentLineWidth=h,e.currentMiterLimit=f)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const i=[Instruction.END_GEOMETRY,e];this.instructions.push(i),this.hitDetectionInstructions.push(i)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=clone$1(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;buffer(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class CanvasImageBuilder extends CanvasBuilder{constructor(e,i,n,o){super(e,i,n,o),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,i,n){if(!this.image_||this.maxExtent&&!containsCoordinate(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,i,n);const o=e.getFlatCoordinates(),l=e.getStride(),c=this.coordinates.length,u=this.appendFlatPointCoordinates(o,l);this.instructions.push([Instruction.DRAW_IMAGE,c,u,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,c,u,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(i)}drawMultiPoint(e,i,n){if(!this.image_)return;this.beginGeometry(e,i,n);const o=e.getFlatCoordinates(),l=[];for(let h=0,f=o.length;h<f;h+=e.getStride())(!this.maxExtent||containsCoordinate(this.maxExtent,o.slice(h,h+2)))&&l.push(o[h],o[h+1]);const c=this.coordinates.length,u=this.appendFlatPointCoordinates(l,2);this.instructions.push([Instruction.DRAW_IMAGE,c,u,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,c,u,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(i)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,i){const n=e.getAnchor(),o=e.getSize(),l=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=o[1],this.opacity_=e.getOpacity(),this.originX_=l[0],this.originY_=l[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=o[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=i}}class CanvasLineStringBuilder extends CanvasBuilder{constructor(e,i,n,o){super(e,i,n,o)}drawFlatCoordinates_(e,i,n,o){const l=this.coordinates.length,c=this.appendFlatLineCoordinates(e,i,n,o,!1,!1),u=[Instruction.MOVE_TO_LINE_TO,l,c];return this.instructions.push(u),this.hitDetectionInstructions.push(u),n}drawLineString(e,i,n){const o=this.state,l=o.strokeStyle,c=o.lineWidth;if(l===void 0||c===void 0)return;this.updateStrokeStyle(o,this.applyStroke),this.beginGeometry(e,i,n),this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,defaultLineDash,defaultLineDashOffset],beginPathInstruction);const u=e.getFlatCoordinates(),h=e.getStride();this.drawFlatCoordinates_(u,0,u.length,h),this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(i)}drawMultiLineString(e,i,n){const o=this.state,l=o.strokeStyle,c=o.lineWidth;if(l===void 0||c===void 0)return;this.updateStrokeStyle(o,this.applyStroke),this.beginGeometry(e,i,n),this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,defaultLineDash,defaultLineDashOffset],beginPathInstruction);const u=e.getEnds(),h=e.getFlatCoordinates(),f=e.getStride();let g=0;for(let H=0,Y=u.length;H<Y;++H)g=this.drawFlatCoordinates_(h,g,u[H],f);this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(i)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(strokeInstruction),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(strokeInstruction),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(beginPathInstruction)}}class CanvasPolygonBuilder extends CanvasBuilder{constructor(e,i,n,o){super(e,i,n,o)}drawFlatCoordinatess_(e,i,n,o){const l=this.state,c=l.fillStyle!==void 0,u=l.strokeStyle!==void 0,h=n.length;this.instructions.push(beginPathInstruction),this.hitDetectionInstructions.push(beginPathInstruction);for(let f=0;f<h;++f){const g=n[f],H=this.coordinates.length,Y=this.appendFlatLineCoordinates(e,i,g,o,!0,!u),ee=[Instruction.MOVE_TO_LINE_TO,H,Y];this.instructions.push(ee),this.hitDetectionInstructions.push(ee),u&&(this.instructions.push(closePathInstruction),this.hitDetectionInstructions.push(closePathInstruction)),i=g}return c&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),u&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),i}drawCircle(e,i,n){const o=this.state,l=o.fillStyle,c=o.strokeStyle;if(l===void 0&&c===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,i,n),o.fillStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),o.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,defaultLineDash,defaultLineDashOffset]);const u=e.getFlatCoordinates(),h=e.getStride(),f=this.coordinates.length;this.appendFlatLineCoordinates(u,0,u.length,h,!1,!1);const g=[Instruction.CIRCLE,f];this.instructions.push(beginPathInstruction,g),this.hitDetectionInstructions.push(beginPathInstruction,g),o.fillStyle!==void 0&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),o.strokeStyle!==void 0&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),this.endGeometry(i)}drawPolygon(e,i,n){const o=this.state,l=o.fillStyle,c=o.strokeStyle;if(l===void 0&&c===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,i,n),o.fillStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),o.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,defaultLineDash,defaultLineDashOffset]);const u=e.getEnds(),h=e.getOrientedFlatCoordinates(),f=e.getStride();this.drawFlatCoordinatess_(h,0,u,f),this.endGeometry(i)}drawMultiPolygon(e,i,n){const o=this.state,l=o.fillStyle,c=o.strokeStyle;if(l===void 0&&c===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,i,n),o.fillStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),o.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,defaultLineDash,defaultLineDashOffset]);const u=e.getEndss(),h=e.getOrientedFlatCoordinates(),f=e.getStride();let g=0;for(let H=0,Y=u.length;H<Y;++H)g=this.drawFlatCoordinatess_(h,g,u[H],f);this.endGeometry(i)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const i=this.coordinates;for(let n=0,o=i.length;n<o;++n)i[n]=snap(i[n],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;this.updateFillStyle(e,this.createFill),this.updateStrokeStyle(e,this.applyStroke)}}function lineChunk(s,e,i,n,o){const l=[];let c=i,u=0,h=e.slice(i,2);for(;u<s&&c+o<n;){const[f,g]=h.slice(-2),H=e[c+o],Y=e[c+o+1],ee=Math.sqrt((H-f)*(H-f)+(Y-g)*(Y-g));if(u+=ee,u>=s){const te=(s-u+ee)/ee,xe=lerp(f,H,te),ne=lerp(g,Y,te);h.push(xe,ne),l.push(h),h=[xe,ne],u==s&&(c+=o),u=0}else if(u<s)h.push(e[c+o],e[c+o+1]),c+=o;else{const te=ee-u,xe=lerp(f,H,te/ee),ne=lerp(g,Y,te/ee);h.push(xe,ne),l.push(h),h=[xe,ne],u=0,c+=o}}return u>0&&l.push(h),l}function matchingChunk(s,e,i,n,o){let l=i,c=i,u=0,h=0,f=i,g,H,Y,ee,te,xe,ne,et,tt,it;for(H=i;H<n;H+=o){const rt=e[H],nt=e[H+1];te!==void 0&&(tt=rt-te,it=nt-xe,ee=Math.sqrt(tt*tt+it*it),ne!==void 0&&(h+=Y,g=Math.acos((ne*tt+et*it)/(Y*ee)),g>s&&(h>u&&(u=h,l=f,c=H),h=0,f=H-o)),Y=ee,ne=tt,et=it),te=rt,xe=nt}return h+=ee,h>u?[f,H]:[l,c]}const TEXT_ALIGN={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class CanvasTextBuilder extends CanvasBuilder{constructor(e,i,n,o){super(e,i,n,o),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[defaultFillStyle]={fillStyle:defaultFillStyle},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,i,n){const o=this.textFillState_,l=this.textStrokeState_,c=this.textState_;if(this.text_===""||!c||!o&&!l)return;const u=this.coordinates;let h=u.length;const f=e.getType();let g=null,H=e.getStride();if(c.placement==="line"&&(f=="LineString"||f=="MultiLineString"||f=="Polygon"||f=="MultiPolygon")){if(!intersects$1(this.maxExtent,e.getExtent()))return;let Y;if(g=e.getFlatCoordinates(),f=="LineString")Y=[g.length];else if(f=="MultiLineString")Y=e.getEnds();else if(f=="Polygon")Y=e.getEnds().slice(0,1);else if(f=="MultiPolygon"){const ne=e.getEndss();Y=[];for(let et=0,tt=ne.length;et<tt;++et)Y.push(ne[et][0])}this.beginGeometry(e,i,n);const ee=c.repeat,te=ee?void 0:c.textAlign;let xe=0;for(let ne=0,et=Y.length;ne<et;++ne){let tt;ee?tt=lineChunk(ee*this.resolution,g,xe,Y[ne],H):tt=[g.slice(xe,Y[ne])];for(let it=0,rt=tt.length;it<rt;++it){const nt=tt[it];let st=0,at=nt.length;if(te==null){const ct=matchingChunk(c.maxAngle,nt,0,nt.length,2);st=ct[0],at=ct[1]}for(let ct=st;ct<at;ct+=H)u.push(nt[ct],nt[ct+1]);const ot=u.length;xe=Y[ne],this.drawChars_(h,ot),h=ot}}this.endGeometry(i)}else{let Y=c.overflow?null:[];switch(f){case"Point":case"MultiPoint":g=e.getFlatCoordinates();break;case"LineString":g=e.getFlatMidpoint();break;case"Circle":g=e.getCenter();break;case"MultiLineString":g=e.getFlatMidpoints(),H=2;break;case"Polygon":g=e.getFlatInteriorPoint(),c.overflow||Y.push(g[2]/this.resolution),H=3;break;case"MultiPolygon":const rt=e.getFlatInteriorPoints();g=[];for(let nt=0,st=rt.length;nt<st;nt+=3)c.overflow||Y.push(rt[nt+2]/this.resolution),g.push(rt[nt],rt[nt+1]);if(g.length===0)return;H=2;break}const ee=this.appendFlatPointCoordinates(g,H);if(ee===h)return;if(Y&&(ee-h)/2!==g.length/H){let rt=h/2;Y=Y.filter((nt,st)=>{const at=u[(rt+st)*2]===g[st*H]&&u[(rt+st)*2+1]===g[st*H+1];return at||--rt,at})}this.saveTextStates_();const te=c.backgroundFill?this.createFill(this.fillStyleToState(c.backgroundFill)):null,xe=c.backgroundStroke?this.createStroke(this.strokeStyleToState(c.backgroundStroke)):null;this.beginGeometry(e,i,n);let ne=c.padding;if(ne!=defaultPadding&&(c.scale[0]<0||c.scale[1]<0)){let rt=c.padding[0],nt=c.padding[1],st=c.padding[2],at=c.padding[3];c.scale[0]<0&&(nt=-nt,at=-at),c.scale[1]<0&&(rt=-rt,st=-st),ne=[rt,nt,st,at]}const et=this.pixelRatio;this.instructions.push([Instruction.DRAW_IMAGE,h,ee,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,ne==defaultPadding?defaultPadding:ne.map(function(rt){return rt*et}),te,xe,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,Y]);const tt=1/et,it=te?te.slice(0):null;it&&(it[1]=defaultFillStyle),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,h,ee,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[tt,tt],NaN,this.declutterMode_,this.declutterImageWithText_,ne,it,xe,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?defaultFillStyle:this.fillKey_,this.textOffsetX_,this.textOffsetY_,Y]),this.endGeometry(i)}}saveTextStates_(){const e=this.textStrokeState_,i=this.textState_,n=this.textFillState_,o=this.strokeKey_;e&&(o in this.strokeStates||(this.strokeStates[o]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const l=this.textKey_;l in this.textStates||(this.textStates[l]={font:i.font,textAlign:i.textAlign||defaultTextAlign,justify:i.justify,textBaseline:i.textBaseline||defaultTextBaseline,scale:i.scale});const c=this.fillKey_;n&&(c in this.fillStates||(this.fillStates[c]={fillStyle:n.fillStyle}))}drawChars_(e,i){const n=this.textStrokeState_,o=this.textState_,l=this.strokeKey_,c=this.textKey_,u=this.fillKey_;this.saveTextStates_();const h=this.pixelRatio,f=TEXT_ALIGN[o.textBaseline],g=this.textOffsetY_*h,H=this.text_,Y=n?n.lineWidth*Math.abs(o.scale[0])/2:0;this.instructions.push([Instruction.DRAW_CHARS,e,i,f,o.overflow,u,o.maxAngle,h,g,l,Y*h,H,c,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([Instruction.DRAW_CHARS,e,i,f,o.overflow,u&&defaultFillStyle,o.maxAngle,h,g,l,Y*h,H,c,1/h,this.declutterMode_,this.textKeepUpright_])}setTextStyle(e,i){let n,o,l;if(!e)this.text_="";else{const c=e.getFill();c?(o=this.textFillState_,o||(o={},this.textFillState_=o),o.fillStyle=asColorLike(c.getColor()||defaultFillStyle)):(o=null,this.textFillState_=o);const u=e.getStroke();if(!u)l=null,this.textStrokeState_=l;else{l=this.textStrokeState_,l||(l={},this.textStrokeState_=l);const xe=u.getLineDash(),ne=u.getLineDashOffset(),et=u.getWidth(),tt=u.getMiterLimit();l.lineCap=u.getLineCap()||defaultLineCap,l.lineDash=xe?xe.slice():defaultLineDash,l.lineDashOffset=ne===void 0?defaultLineDashOffset:ne,l.lineJoin=u.getLineJoin()||defaultLineJoin,l.lineWidth=et===void 0?defaultLineWidth:et,l.miterLimit=tt===void 0?defaultMiterLimit:tt,l.strokeStyle=asColorLike(u.getColor()||defaultStrokeStyle)}n=this.textState_;const h=e.getFont()||defaultFont;registerFont(h);const f=e.getScaleArray();n.overflow=e.getOverflow(),n.font=h,n.maxAngle=e.getMaxAngle(),n.placement=e.getPlacement(),n.textAlign=e.getTextAlign(),n.repeat=e.getRepeat(),n.justify=e.getJustify(),n.textBaseline=e.getTextBaseline()||defaultTextBaseline,n.backgroundFill=e.getBackgroundFill(),n.backgroundStroke=e.getBackgroundStroke(),n.padding=e.getPadding()||defaultPadding,n.scale=f===void 0?[1,1]:f;const g=e.getOffsetX(),H=e.getOffsetY(),Y=e.getRotateWithView(),ee=e.getKeepUpright(),te=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=g===void 0?0:g,this.textOffsetY_=H===void 0?0:H,this.textRotateWithView_=Y===void 0?!1:Y,this.textKeepUpright_=ee===void 0?!0:ee,this.textRotation_=te===void 0?0:te,this.strokeKey_=l?(typeof l.strokeStyle=="string"?l.strokeStyle:getUid(l.strokeStyle))+l.lineCap+l.lineDashOffset+"|"+l.lineWidth+l.lineJoin+l.miterLimit+"["+l.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=o&&o.fillStyle?typeof o.fillStyle=="string"?o.fillStyle:"|"+getUid(o.fillStyle):""}this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=i}}const BATCH_CONSTRUCTORS={Circle:CanvasPolygonBuilder,Default:CanvasBuilder,Image:CanvasImageBuilder,LineString:CanvasLineStringBuilder,Polygon:CanvasPolygonBuilder,Text:CanvasTextBuilder};class BuilderGroup{constructor(e,i,n,o){this.tolerance_=e,this.maxExtent_=i,this.pixelRatio_=o,this.resolution_=n,this.buildersByZIndex_={}}finish(){const e={};for(const i in this.buildersByZIndex_){e[i]=e[i]||{};const n=this.buildersByZIndex_[i];for(const o in n){const l=n[o].finish();e[i][o]=l}}return e}getBuilder(e,i){const n=e!==void 0?e.toString():"0";let o=this.buildersByZIndex_[n];o===void 0&&(o={},this.buildersByZIndex_[n]=o);let l=o[i];if(l===void 0){const c=BATCH_CONSTRUCTORS[i];l=new c(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),o[i]=l}return l}}function drawTextOnPath(s,e,i,n,o,l,c,u,h,f,g,H,Y=!0){let ee=s[e],te=s[e+1],xe=0,ne=0,et=0,tt=0;function it(){xe=ee,ne=te,e+=n,ee=s[e],te=s[e+1],tt+=et,et=Math.sqrt((ee-xe)*(ee-xe)+(te-ne)*(te-ne))}do it();while(e<i-n&&tt+et<l);let rt=et===0?0:(l-tt)/et;const nt=lerp(xe,ee,rt),st=lerp(ne,te,rt),at=e-n,ot=tt,ct=l+u*h(f,o,g);for(;e<i-n&&tt+et<ct;)it();rt=et===0?0:(ct-tt)/et;const ht=lerp(xe,ee,rt),ut=lerp(ne,te,rt);let pt=!1;if(Y)if(H){const Rt=[nt,st,ht,ut];rotate(Rt,0,4,2,H,Rt,Rt),pt=Rt[0]>Rt[2]}else pt=nt>ht;const yt=Math.PI,mt=[],St=at+n===e;e=at,et=0,tt=ot,ee=s[e],te=s[e+1];let Pt;if(St){it(),Pt=Math.atan2(te-ne,ee-xe),pt&&(Pt+=Pt>0?-yt:yt);const Rt=(ht+nt)/2,Lt=(ut+st)/2;return mt[0]=[Rt,Lt,(ct-l)/2,Pt,o],mt}o=o.replace(/\n/g," ");for(let Rt=0,Lt=o.length;Rt<Lt;){it();let Nt=Math.atan2(te-ne,ee-xe);if(pt&&(Nt+=Nt>0?-yt:yt),Pt!==void 0){let ft=Nt-Pt;if(ft+=ft>yt?-2*yt:ft<-yt?2*yt:0,Math.abs(ft)>c)return null}Pt=Nt;const vt=Rt;let Et=0;for(;Rt<Lt;++Rt){const ft=pt?Lt-Rt-1:Rt,bt=u*h(f,o[ft],g);if(e+n<i&&tt+et<l+Et+bt/2)break;Et+=bt}if(Rt===vt)continue;const Ct=pt?o.substring(Lt-vt,Lt-Rt):o.substring(vt,Rt);rt=et===0?0:(l+Et/2-tt)/et;const _t=lerp(xe,ee,rt),dt=lerp(ne,te,rt);mt.push([_t,dt,Et/2,Nt,Ct]),l+=Et}return mt}class ZIndexContext{constructor(){ei(this,"pushMethodArgs_",(...e)=>(this.push_(e),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(getSharedCanvasContext2D(),{get:(e,i)=>{if(typeof getSharedCanvasContext2D()[i]=="function")return this.push_(i),this.pushMethodArgs_},set:(e,i,n)=>(this.push_(i,n),!0)})}push_(...e){const i=this.instructions_,n=this.zIndex+this.offset_;i[n]||(i[n]=[]),i[n].push(...e)}pushFunction(e){this.push_(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach(i=>{for(let n=0,o=i.length;n<o;++n){const l=i[n];if(typeof l=="function"){l(e);continue}const c=i[++n];if(typeof e[l]=="function")e[l](...c);else{if(typeof c=="function"){e[l]=c(e);continue}e[l]=c}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const tmpExtent=createEmpty(),p1=[],p2=[],p3=[],p4=[];function getDeclutterBox(s){return s[3].declutterBox}const rtlRegEx=new RegExp("[-----]");function horizontalTextAlign(s,e){return e==="start"?e=rtlRegEx.test(s)?"right":"left":e==="end"&&(e=rtlRegEx.test(s)?"left":"right"),TEXT_ALIGN[e]}function createTextChunks(s,e,i){return i>0&&s.push(`
`,""),s.push(e,""),s}function richTextToPlainText(s,e,i){return i%2===0&&(s+=e),s}class Executor{constructor(e,i,n,o,l){this.overlaps=n,this.pixelRatio=i,this.resolution=e,this.alignAndScaleFill_,this.instructions=o.instructions,this.coordinates=o.coordinates,this.coordinateCache_={},this.renderedTransform_=create(),this.hitDetectionInstructions=o.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=o.fillStates||{},this.strokeStates=o.strokeStates||{},this.textStates=o.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=l?new ZIndexContext:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,i,n,o){const l=e+i+n+o;if(this.labels_[l])return this.labels_[l];const c=o?this.strokeStates[o]:null,u=n?this.fillStates[n]:null,h=this.textStates[i],f=this.pixelRatio,g=[h.scale[0]*f,h.scale[1]*f],H=h.justify?TEXT_ALIGN[h.justify]:horizontalTextAlign(Array.isArray(e)?e[0]:e,h.textAlign||defaultTextAlign),Y=o&&c.lineWidth?c.lineWidth:0,ee=Array.isArray(e)?e:String(e).split(`
`).reduce(createTextChunks,[]),{width:te,height:xe,widths:ne,heights:et,lineWidths:tt}=getTextDimensions(h,ee),it=te+Y,rt=[],nt=(it+2)*g[0],st=(xe+Y)*g[1],at={width:nt<0?Math.floor(nt):Math.ceil(nt),height:st<0?Math.floor(st):Math.ceil(st),contextInstructions:rt};(g[0]!=1||g[1]!=1)&&rt.push("scale",g),o&&(rt.push("strokeStyle",c.strokeStyle),rt.push("lineWidth",Y),rt.push("lineCap",c.lineCap),rt.push("lineJoin",c.lineJoin),rt.push("miterLimit",c.miterLimit),rt.push("setLineDash",[c.lineDash]),rt.push("lineDashOffset",c.lineDashOffset)),n&&rt.push("fillStyle",u.fillStyle),rt.push("textBaseline","middle"),rt.push("textAlign","center");const ot=.5-H;let ct=H*it+ot*Y;const ht=[],ut=[];let pt=0,yt=0,mt=0,St=0,Pt;for(let Rt=0,Lt=ee.length;Rt<Lt;Rt+=2){const Nt=ee[Rt];if(Nt===`
`){yt+=pt,pt=0,ct=H*it+ot*Y,++St;continue}const vt=ee[Rt+1]||h.font;vt!==Pt&&(o&&ht.push("font",vt),n&&ut.push("font",vt),Pt=vt),pt=Math.max(pt,et[mt]);const Et=[Nt,ct+ot*ne[mt]+H*(ne[mt]-tt[St]),.5*(Y+pt)+yt];ct+=ne[mt],o&&ht.push("strokeText",Et),n&&ut.push("fillText",Et),++mt}return Array.prototype.push.apply(rt,ht),Array.prototype.push.apply(rt,ut),this.labels_[l]=at,at}replayTextBackground_(e,i,n,o,l,c,u){e.beginPath(),e.moveTo.apply(e,i),e.lineTo.apply(e,n),e.lineTo.apply(e,o),e.lineTo.apply(e,l),e.lineTo.apply(e,i),c&&(this.alignAndScaleFill_=c[2],e.fillStyle=c[1],this.fill_(e)),u&&(this.setStrokeStyle_(e,u),e.stroke())}calculateImageOrLabelDimensions_(e,i,n,o,l,c,u,h,f,g,H,Y,ee,te,xe,ne){u*=Y[0],h*=Y[1];let et=n-u,tt=o-h;const it=l+f>e?e-f:l,rt=c+g>i?i-g:c,nt=te[3]+it*Y[0]+te[1],st=te[0]+rt*Y[1]+te[2],at=et-te[3],ot=tt-te[0];(xe||H!==0)&&(p1[0]=at,p4[0]=at,p1[1]=ot,p2[1]=ot,p2[0]=at+nt,p3[0]=p2[0],p3[1]=ot+st,p4[1]=p3[1]);let ct;return H!==0?(ct=compose(create(),n,o,1,1,H,-n,-o),apply(ct,p1),apply(ct,p2),apply(ct,p3),apply(ct,p4),createOrUpdate$2(Math.min(p1[0],p2[0],p3[0],p4[0]),Math.min(p1[1],p2[1],p3[1],p4[1]),Math.max(p1[0],p2[0],p3[0],p4[0]),Math.max(p1[1],p2[1],p3[1],p4[1]),tmpExtent)):createOrUpdate$2(Math.min(at,at+nt),Math.min(ot,ot+st),Math.max(at,at+nt),Math.max(ot,ot+st),tmpExtent),ee&&(et=Math.round(et),tt=Math.round(tt)),{drawImageX:et,drawImageY:tt,drawImageW:it,drawImageH:rt,originX:f,originY:g,declutterBox:{minX:tmpExtent[0],minY:tmpExtent[1],maxX:tmpExtent[2],maxY:tmpExtent[3],value:ne},canvasTransform:ct,scale:Y}}replayImageOrLabel_(e,i,n,o,l,c,u){const h=!!(c||u),f=o.declutterBox,g=u?u[2]*o.scale[0]/2:0;return f.minX-g<=i[0]&&f.maxX+g>=0&&f.minY-g<=i[1]&&f.maxY+g>=0&&(h&&this.replayTextBackground_(e,p1,p2,p3,p4,c,u),drawImageOrLabel(e,o.canvasTransform,l,n,o.originX,o.originY,o.drawImageW,o.drawImageH,o.drawImageX,o.drawImageY,o.scale)),!0}fill_(e){const i=this.alignAndScaleFill_;if(i){const n=apply(this.renderedTransform_,[0,0]),o=512*this.pixelRatio;e.save(),e.translate(n[0]%o,n[1]%o),i!==1&&e.scale(i,i),e.rotate(this.viewRotation_)}e.fill(),i&&e.restore()}setStrokeStyle_(e,i){e.strokeStyle=i[1],i[1]&&(e.lineWidth=i[2],e.lineCap=i[3],e.lineJoin=i[4],e.miterLimit=i[5],e.lineDashOffset=i[7],e.setLineDash(i[6]))}drawLabelWithPointPlacement_(e,i,n,o){const l=this.textStates[i],c=this.createLabel(e,i,o,n),u=this.strokeStates[n],h=this.pixelRatio,f=horizontalTextAlign(Array.isArray(e)?e[0]:e,l.textAlign||defaultTextAlign),g=TEXT_ALIGN[l.textBaseline||defaultTextBaseline],H=u&&u.lineWidth?u.lineWidth:0,Y=c.width/h-2*l.scale[0],ee=f*Y+2*(.5-f)*H,te=g*c.height/h+2*(.5-g)*H;return{label:c,anchorX:ee,anchorY:te}}execute_(e,i,n,o,l,c,u,h){const f=this.zIndexContext_;let g;this.pixelCoordinates_&&equals(n,this.renderedTransform_)?g=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),g=transform2D(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),setFromArray(this.renderedTransform_,n));let H=0;const Y=o.length;let ee=0,te,xe,ne,et,tt,it,rt,nt,st,at,ot,ct,ht,ut=0,pt=0;const yt=this.coordinateCache_,mt=this.viewRotation_,St=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,Pt={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:mt},Rt=this.instructions!=o||this.overlaps?0:200;let Lt,Nt,vt,Et;for(;H<Y;){const Ct=o[H];switch(Ct[0]){case Instruction.BEGIN_GEOMETRY:Lt=Ct[1],Et=Ct[3],Lt.getGeometry()?u!==void 0&&!intersects$1(u,Et.getExtent())?H=Ct[2]+1:++H:H=Ct[2],f&&(f.zIndex=Ct[4]);break;case Instruction.BEGIN_PATH:ut>Rt&&(this.fill_(e),ut=0),pt>Rt&&(e.stroke(),pt=0),!ut&&!pt&&(e.beginPath(),tt=NaN,it=NaN),++H;break;case Instruction.CIRCLE:ee=Ct[1];const dt=g[ee],ft=g[ee+1],bt=g[ee+2],Gt=g[ee+3],Ft=bt-dt,Ht=Gt-ft,Mt=Math.sqrt(Ft*Ft+Ht*Ht);e.moveTo(dt+Mt,ft),e.arc(dt,ft,Mt,0,2*Math.PI,!0),++H;break;case Instruction.CLOSE_PATH:e.closePath(),++H;break;case Instruction.CUSTOM:ee=Ct[1],te=Ct[2];const It=Ct[3],xt=Ct[4],Tt=Ct[5];Pt.geometry=It,Pt.feature=Lt,H in yt||(yt[H]=[]);const Ut=yt[H];Tt?Tt(g,ee,te,2,Ut):(Ut[0]=g[ee],Ut[1]=g[ee+1],Ut.length=2),f&&(f.zIndex=Ct[6]),xt(Ut,Pt),++H;break;case Instruction.DRAW_IMAGE:ee=Ct[1],te=Ct[2],st=Ct[3],xe=Ct[4],ne=Ct[5];let Dt=Ct[6];const $t=Ct[7],Zt=Ct[8],Kt=Ct[9],qt=Ct[10];let Xt=Ct[11];const zt=Ct[12];let ai=Ct[13];et=Ct[14]||"declutter";const wt=Ct[15];if(!st&&Ct.length>=20){at=Ct[19],ot=Ct[20],ct=Ct[21],ht=Ct[22];const di=this.drawLabelWithPointPlacement_(at,ot,ct,ht);st=di.label,Ct[3]=st;const xi=Ct[23];xe=(di.anchorX-xi)*this.pixelRatio,Ct[4]=xe;const Ei=Ct[24];ne=(di.anchorY-Ei)*this.pixelRatio,Ct[5]=ne,Dt=st.height,Ct[6]=Dt,ai=st.width,Ct[13]=ai}let Ot;Ct.length>25&&(Ot=Ct[25]);let kt,Bt,jt;Ct.length>17?(kt=Ct[16],Bt=Ct[17],jt=Ct[18]):(kt=defaultPadding,Bt=null,jt=null),qt&&St?Xt+=mt:!qt&&!St&&(Xt-=mt);let Wt=0;for(;ee<te;ee+=2){if(Ot&&Ot[Wt++]<ai/this.pixelRatio)continue;const di=this.calculateImageOrLabelDimensions_(st.width,st.height,g[ee],g[ee+1],ai,Dt,xe,ne,Zt,Kt,Xt,zt,l,kt,!!Bt||!!jt,Lt),xi=[e,i,st,di,$t,Bt,jt];if(h){let Ei,Si,Qt;if(wt){const li=te-ee;if(!wt[li]){wt[li]={args:xi,declutterMode:et};continue}const mi=wt[li];Ei=mi.args,Si=mi.declutterMode,delete wt[li],Qt=getDeclutterBox(Ei)}let vi,Pi;if(Ei&&(Si!=="declutter"||!h.collides(Qt))&&(vi=!0),(et!=="declutter"||!h.collides(di.declutterBox))&&(Pi=!0),Si==="declutter"&&et==="declutter"){const li=vi&&Pi;vi=li,Pi=li}vi&&(Si!=="none"&&h.insert(Qt),this.replayImageOrLabel_.apply(this,Ei)),Pi&&(et!=="none"&&h.insert(di.declutterBox),this.replayImageOrLabel_.apply(this,xi))}else this.replayImageOrLabel_.apply(this,xi)}++H;break;case Instruction.DRAW_CHARS:const Vt=Ct[1],Yt=Ct[2],ti=Ct[3],ni=Ct[4];ht=Ct[5];const ui=Ct[6],ci=Ct[7],hi=Ct[8];ct=Ct[9];const si=Ct[10];at=Ct[11],Array.isArray(at)&&(at=at.reduce(richTextToPlainText,"")),ot=Ct[12];const Jt=[Ct[13],Ct[13]];et=Ct[14]||"declutter";const oi=Ct[15],ri=this.textStates[ot],ii=ri.font,pi=[ri.scale[0]*ci,ri.scale[1]*ci];let Ci;ii in this.widths_?Ci=this.widths_[ii]:(Ci={},this.widths_[ii]=Ci);const gi=lineStringLength(g,Vt,Yt,2),_i=Math.abs(pi[0])*measureAndCacheTextWidth(ii,at,Ci);if(ni||_i<=gi){const di=this.textStates[ot].textAlign,xi=(gi-_i)*horizontalTextAlign(at,di),Ei=drawTextOnPath(g,Vt,Yt,2,at,xi,ui,Math.abs(pi[0]),measureAndCacheTextWidth,ii,Ci,St?0:this.viewRotation_,oi);e:if(Ei){const Si=[];let Qt,vi,Pi,li,mi;if(ct)for(Qt=0,vi=Ei.length;Qt<vi;++Qt){mi=Ei[Qt],Pi=mi[4],li=this.createLabel(Pi,ot,"",ct),xe=mi[2]+(pi[0]<0?-si:si),ne=ti*li.height+(.5-ti)*2*si*pi[1]/pi[0]-hi;const Ii=this.calculateImageOrLabelDimensions_(li.width,li.height,mi[0],mi[1],li.width,li.height,xe,ne,0,0,mi[3],Jt,!1,defaultPadding,!1,Lt);if(h&&et==="declutter"&&h.collides(Ii.declutterBox))break e;Si.push([e,i,li,Ii,1,null,null])}if(ht)for(Qt=0,vi=Ei.length;Qt<vi;++Qt){mi=Ei[Qt],Pi=mi[4],li=this.createLabel(Pi,ot,ht,""),xe=mi[2],ne=ti*li.height-hi;const Ii=this.calculateImageOrLabelDimensions_(li.width,li.height,mi[0],mi[1],li.width,li.height,xe,ne,0,0,mi[3],Jt,!1,defaultPadding,!1,Lt);if(h&&et==="declutter"&&h.collides(Ii.declutterBox))break e;Si.push([e,i,li,Ii,1,null,null])}h&&et!=="none"&&h.load(Si.map(getDeclutterBox));for(let Ii=0,Gi=Si.length;Ii<Gi;++Ii)this.replayImageOrLabel_.apply(this,Si[Ii])}}++H;break;case Instruction.END_GEOMETRY:if(c!==void 0){Lt=Ct[1];const di=c(Lt,Et,et);if(di)return di}++H;break;case Instruction.FILL:Rt?ut++:this.fill_(e),++H;break;case Instruction.MOVE_TO_LINE_TO:for(ee=Ct[1],te=Ct[2],Nt=g[ee],vt=g[ee+1],e.moveTo(Nt,vt),tt=Nt+.5|0,it=vt+.5|0,ee+=2;ee<te;ee+=2)Nt=g[ee],vt=g[ee+1],rt=Nt+.5|0,nt=vt+.5|0,(ee==te-2||rt!==tt||nt!==it)&&(e.lineTo(Nt,vt),tt=rt,it=nt);++H;break;case Instruction.SET_FILL_STYLE:this.alignAndScaleFill_=Ct[2],ut&&(this.fill_(e),ut=0,pt&&(e.stroke(),pt=0)),e.fillStyle=Ct[1],++H;break;case Instruction.SET_STROKE_STYLE:pt&&(e.stroke(),pt=0),this.setStrokeStyle_(e,Ct),++H;break;case Instruction.STROKE:Rt?pt++:e.stroke(),++H;break;default:++H;break}}ut&&this.fill_(e),pt&&e.stroke()}execute(e,i,n,o,l,c){this.viewRotation_=o,this.execute_(e,i,n,this.instructions,l,void 0,void 0,c)}executeHitDetection(e,i,n,o,l){return this.viewRotation_=n,this.execute_(e,[e.canvas.width,e.canvas.height],i,this.hitDetectionInstructions,!0,o,l)}}const ALL=["Polygon","Circle","LineString","Image","Text","Default"],DECLUTTER=["Image","Text"],NON_DECLUTTER=ALL.filter(s=>!DECLUTTER.includes(s));class ExecutorGroup{constructor(e,i,n,o,l,c,u){this.maxExtent_=e,this.overlaps_=o,this.pixelRatio_=n,this.resolution_=i,this.renderBuffer_=c,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=create(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(l,u)}clip(e,i){const n=this.getClipCoords(i);e.beginPath(),e.moveTo(n[0],n[1]),e.lineTo(n[2],n[3]),e.lineTo(n[4],n[5]),e.lineTo(n[6],n[7]),e.clip()}createExecutors_(e,i){for(const n in e){let o=this.executorsByZIndex_[n];o===void 0&&(o={},this.executorsByZIndex_[n]=o);const l=e[n];for(const c in l){const u=l[c];o[c]=new Executor(this.resolution_,this.pixelRatio_,this.overlaps_,u,i)}}}hasExecutors(e){for(const i in this.executorsByZIndex_){const n=this.executorsByZIndex_[i];for(let o=0,l=e.length;o<l;++o)if(e[o]in n)return!0}return!1}forEachFeatureAtCoordinate(e,i,n,o,l,c){o=Math.round(o);const u=o*2+1,h=compose(this.hitDetectionTransform_,o+.5,o+.5,1/i,-1/i,-n,-e[0],-e[1]),f=!this.hitDetectionContext_;f&&(this.hitDetectionContext_=createCanvasContext2D(u,u));const g=this.hitDetectionContext_;g.canvas.width!==u||g.canvas.height!==u?(g.canvas.width=u,g.canvas.height=u):f||g.clearRect(0,0,u,u);let H;this.renderBuffer_!==void 0&&(H=createEmpty(),extendCoordinate(H,e),buffer(H,i*(this.renderBuffer_+o),H));const Y=getPixelIndexArray(o);let ee;function te(nt,st,at){const ot=g.getImageData(0,0,u,u).data;for(let ct=0,ht=Y.length;ct<ht;ct++)if(ot[Y[ct]]>0){if(!c||at==="none"||ee!=="Image"&&ee!=="Text"||c.includes(nt)){const ut=(Y[ct]-3)/4,pt=o-ut%u,yt=o-(ut/u|0),mt=l(nt,st,pt*pt+yt*yt);if(mt)return mt}g.clearRect(0,0,u,u);break}}const xe=Object.keys(this.executorsByZIndex_).map(Number);xe.sort(ascending);let ne,et,tt,it,rt;for(ne=xe.length-1;ne>=0;--ne){const nt=xe[ne].toString();for(tt=this.executorsByZIndex_[nt],et=ALL.length-1;et>=0;--et)if(ee=ALL[et],it=tt[ee],it!==void 0&&(rt=it.executeHitDetection(g,h,n,te,H),rt))return rt}}getClipCoords(e){const i=this.maxExtent_;if(!i)return null;const n=i[0],o=i[1],l=i[2],c=i[3],u=[n,o,n,c,l,c,l,o];return transform2D(u,0,8,2,e,u),u}isEmpty(){return isEmpty(this.executorsByZIndex_)}execute(e,i,n,o,l,c,u){const h=Object.keys(this.executorsByZIndex_).map(Number);h.sort(u?descending:ascending),c=c||ALL;const f=ALL.length;for(let g=0,H=h.length;g<H;++g){const Y=h[g].toString(),ee=this.executorsByZIndex_[Y];for(let te=0,xe=c.length;te<xe;++te){const ne=c[te],et=ee[ne];if(et!==void 0){const tt=u===null?void 0:et.getZIndexContext(),it=tt?tt.getContext():e,rt=this.maxExtent_&&ne!=="Image"&&ne!=="Text";if(rt&&(it.save(),this.clip(it,n)),!tt||ne==="Text"||ne==="Image"?et.execute(it,i,n,o,l,u):tt.pushFunction(nt=>et.execute(nt,i,n,o,l,u)),rt&&it.restore(),tt){tt.offset();const nt=h[g]*f+ALL.indexOf(ne);this.deferredZIndexContexts_[nt]||(this.deferredZIndexContexts_[nt]=[]),this.deferredZIndexContexts_[nt].push(tt)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const e=this.deferredZIndexContexts_,i=Object.keys(e).map(Number).sort(ascending);for(let n=0,o=i.length;n<o;++n)e[i[n]].forEach(l=>{l.draw(this.renderedContext_),l.clear()}),e[i[n]].length=0}}const circlePixelIndexArrayCache={};function getPixelIndexArray(s){if(circlePixelIndexArrayCache[s]!==void 0)return circlePixelIndexArrayCache[s];const e=s*2+1,i=s*s,n=new Array(i+1);for(let l=0;l<=s;++l)for(let c=0;c<=s;++c){const u=l*l+c*c;if(u>i)break;let h=n[u];h||(h=[],n[u]=h),h.push(((s+l)*e+(s+c))*4+3),l>0&&h.push(((s-l)*e+(s+c))*4+3),c>0&&(h.push(((s+l)*e+(s-c))*4+3),l>0&&h.push(((s-l)*e+(s-c))*4+3))}const o=[];for(let l=0,c=n.length;l<c;++l)n[l]&&o.push(...n[l]);return circlePixelIndexArrayCache[s]=o,o}class ImageStyle{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=toSize(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new ImageStyle({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return abstract()}getImage(e){return abstract()}getHitDetectionImage(){return abstract()}getPixelRatio(e){return 1}getImageState(){return abstract()}getImageSize(){return abstract()}getOrigin(){return abstract()}getSize(){return abstract()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=toSize(e)}listenImageChange(e){abstract()}load(){abstract()}unlistenImageChange(e){abstract()}ready(){return Promise.resolve()}}class RegularShape extends ImageStyle{constructor(e){super({opacity:1,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius=e.radius,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?ImageState.LOADING:ImageState.LOADED,this.imageState_===ImageState.LOADING&&this.ready().then(()=>this.imageState_=ImageState.LOADED),this.render()}clone(){const e=this.getScale(),i=new RegularShape({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return i.setOpacity(this.getOpacity()),i}getAnchor(){const e=this.size_,i=this.getDisplacement(),n=this.getScaleArray();return[e[0]/2-i[0]/n[0],e[1]/2+i[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){var l,c;const i=(l=this.fill_)==null?void 0:l.getKey(),n=`${e},${this.angle_},${this.radius},${this.radius2_},${this.points_},${i}`+Object.values(this.renderOptions_).join(",");let o=(c=shared.get(n,null,null))==null?void 0:c.getImage(1);if(!o){const u=this.renderOptions_,h=Math.ceil(u.size*e),f=createCanvasContext2D(h,h);this.draw_(u,f,e),o=f.canvas,shared.set(n,null,null,new IconImage(o,void 0,null,ImageState.LOADED,null))}return o}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,i,n){if(i===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return i;let o=this.radius,l=this.radius2_===void 0?o:this.radius2_;if(o<l){const st=o;o=l,l=st}const c=this.radius2_===void 0?this.points_:this.points_*2,u=2*Math.PI/c,h=l*Math.sin(u),f=Math.sqrt(l*l-h*h),g=o-f,H=Math.sqrt(h*h+g*g),Y=H/h;if(e==="miter"&&Y<=n)return Y*i;const ee=i/2/Y,te=i/2*(g/H),ne=Math.sqrt((o+ee)*(o+ee)+te*te)-o;if(this.radius2_===void 0||e==="bevel")return ne*2;const et=o*Math.sin(u),tt=Math.sqrt(o*o-et*et),it=l-tt,nt=Math.sqrt(et*et+it*it)/et;if(nt<=n){const st=nt*i/2-l-o;return 2*Math.max(ne,st)}return ne*2}createRenderOptions(){let e=defaultLineCap,i=defaultLineJoin,n=0,o=null,l=0,c,u=0;this.stroke_&&(c=asColorLike(this.stroke_.getColor()??defaultStrokeStyle),u=this.stroke_.getWidth()??defaultLineWidth,o=this.stroke_.getLineDash(),l=this.stroke_.getLineDashOffset()??0,i=this.stroke_.getLineJoin()??defaultLineJoin,e=this.stroke_.getLineCap()??defaultLineCap,n=this.stroke_.getMiterLimit()??defaultMiterLimit);const h=this.calculateLineJoinSize_(i,u,n),f=Math.max(this.radius,this.radius2_||0),g=Math.ceil(2*f+h);return{strokeStyle:c,strokeWidth:u,size:g,lineCap:e,lineDash:o,lineDashOffset:l,lineJoin:i,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,i,n){if(i.scale(n,n),i.translate(e.size/2,e.size/2),this.createPath_(i),this.fill_){let o=this.fill_.getColor();o===null&&(o=defaultFillStyle),i.fillStyle=asColorLike(o),i.fill()}e.strokeStyle&&(i.strokeStyle=e.strokeStyle,i.lineWidth=e.strokeWidth,e.lineDash&&(i.setLineDash(e.lineDash),i.lineDashOffset=e.lineDashOffset),i.lineCap=e.lineCap,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit,i.stroke())}createHitDetectionCanvas_(e){let i;if(this.fill_){let n=this.fill_.getColor(),o=0;typeof n=="string"&&(n=asArray(n)),n===null?o=1:Array.isArray(n)&&(o=n.length===4?n[3]:1),o===0&&(i=createCanvasContext2D(e.size,e.size),this.drawHitDetectionCanvas_(e,i))}return i?i.canvas:this.getImage(1)}createPath_(e){let i=this.points_;const n=this.radius;if(i===1/0)e.arc(0,0,n,0,2*Math.PI);else{const o=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(i*=2);const l=this.angle_-Math.PI/2,c=2*Math.PI/i;for(let u=0;u<i;u++){const h=l+u*c,f=u%2===0?n:o;e.lineTo(f*Math.cos(h),f*Math.sin(h))}e.closePath()}}drawHitDetectionCanvas_(e,i){i.translate(e.size/2,e.size/2),this.createPath_(i),i.fillStyle=defaultFillStyle,i.fill(),e.strokeStyle&&(i.strokeStyle=e.strokeStyle,i.lineWidth=e.strokeWidth,e.lineDash&&(i.setLineDash(e.lineDash),i.lineDashOffset=e.lineDashOffset),i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit,i.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class CircleStyle extends RegularShape{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),i=new CircleStyle({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return i.setOpacity(this.getOpacity()),i}setRadius(e){this.radius=e,this.render()}}class Fill{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,e.color!==void 0&&this.setColor(e.color)}clone(){const e=this.getColor();return new Fill({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(e!==null&&typeof e=="object"&&"src"in e){const i=get$2(null,e.src,"anonymous",void 0,e.offset?null:e.color?e.color:null,!(e.offset&&e.size));i.ready().then(()=>{this.patternImage_=null}),i.getImageState()===ImageState.IDLE&&i.load(),i.getImageState()===ImageState.LOADING&&(this.patternImage_=i)}this.color_=e}getKey(){const e=this.getColor();return e?e instanceof CanvasPattern||e instanceof CanvasGradient?getUid(e):typeof e=="object"&&"src"in e?e.src+":"+e.offset:asArray(e).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function calculateScale(s,e,i,n){return i!==void 0&&n!==void 0?[i/s,n/e]:i!==void 0?i/s:n!==void 0?n/e:1}class Icon extends ImageStyle{constructor(e){e=e||{};const i=e.opacity!==void 0?e.opacity:1,n=e.rotation!==void 0?e.rotation:0,o=e.scale!==void 0?e.scale:1,l=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:i,rotation:n,scale:o,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:l,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const c=e.img!==void 0?e.img:null;let u=e.src;assert(!(u!==void 0&&c),"`image` and `src` cannot be provided at the same time"),(u===void 0||u.length===0)&&c&&(u=c.src||getUid(c)),assert(u!==void 0&&u.length>0,"A defined and non-empty `src` or `image` must be provided"),assert(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let h;if(e.src!==void 0?h=ImageState.IDLE:c!==void 0&&("complete"in c?c.complete?h=c.src?ImageState.LOADED:ImageState.IDLE:h=ImageState.LOADING:h=ImageState.LOADED),this.color_=e.color!==void 0?asArray(e.color):null,this.iconImage_=get$2(c,u,this.crossOrigin_,h,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,this.initialOptions_,e.width!==void 0||e.height!==void 0){let f,g;if(e.size)[f,g]=e.size;else{const H=this.getImage(1);if(H.width&&H.height)f=H.width,g=H.height;else if(H instanceof HTMLImageElement){this.initialOptions_=e;const Y=()=>{if(this.unlistenImageChange(Y),!this.initialOptions_)return;const ee=this.iconImage_.getSize();this.setScale(calculateScale(ee[0],ee[1],e.width,e.height))};this.listenImageChange(Y);return}}f!==void 0&&this.setScale(calculateScale(f,g,e.width,e.height))}}clone(){let e,i,n;return this.initialOptions_?(i=this.initialOptions_.width,n=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new Icon({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:i,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const o=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!o)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=o[0]),this.anchorYUnits_=="fraction"&&(e[1]*=o[1])}if(this.anchorOrigin_!="top-left"){if(!o)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+o[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+o[1])}this.normalizedAnchor_=e}const i=this.getDisplacement(),n=this.getScaleArray();return[e[0]-i[0]/n[0],e[1]+i[1]/n[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const i=this.getSize(),n=this.iconImage_.getSize();if(!i||!n)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=n[0]-i[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=n[1]-i[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}setSrc(e){this.iconImage_=get$2(null,e,this.crossOrigin_,ImageState.IDLE,this.color_)}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==ImageState.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==ImageState.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(EventType.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(EventType.CHANGE,e)}ready(){return this.iconImage_.ready()}}class Stroke{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new Stroke({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}let Style$1=class Yi{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=defaultGeometryFunction,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new Yi({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(i){return i.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=defaultGeometryFunction,this.geometry_=e}setZIndex(e){this.zIndex_=e}};function toFunction(s){let e;if(typeof s=="function")e=s;else{let i;Array.isArray(s)?i=s:(assert(typeof s.getZIndex=="function","Expected an `Style` or an array of `Style`"),i=[s]),e=function(){return i}}return e}let defaultStyles=null;function createDefaultStyle(s,e){if(!defaultStyles){const i=new Fill({color:"rgba(255,255,255,0.4)"}),n=new Stroke({color:"#3399CC",width:1.25});defaultStyles=[new Style$1({image:new CircleStyle({fill:i,stroke:n,radius:5}),fill:i,stroke:n})]}return defaultStyles}function createEditingStyle(){const s={},e=[255,255,255,1],i=[0,153,255,1],n=3;return s.Polygon=[new Style$1({fill:new Fill({color:[255,255,255,.5]})})],s.MultiPolygon=s.Polygon,s.LineString=[new Style$1({stroke:new Stroke({color:e,width:n+2})}),new Style$1({stroke:new Stroke({color:i,width:n})})],s.MultiLineString=s.LineString,s.Circle=s.Polygon.concat(s.LineString),s.Point=[new Style$1({image:new CircleStyle({radius:n*2,fill:new Fill({color:i}),stroke:new Stroke({color:e,width:n/2})}),zIndex:1/0})],s.MultiPoint=s.Point,s.GeometryCollection=s.Polygon.concat(s.LineString,s.Point),s}function defaultGeometryFunction(s){return s.getGeometry()}const DEFAULT_FILL_COLOR="#333";class Text{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.keepUpright_=e.keepUpright,this.scale_=e.scale,this.scaleArray_=toSize(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new Fill({color:DEFAULT_FILL_COLOR}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new Text({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()instanceof Fill?this.getFill().clone():this.getFill(),stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setKeepUpright(e){this.keepUpright_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=toSize(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}class CanvasImmediateRenderer extends VectorContext{constructor(e,i,n,o,l,c,u){super(),this.context_=e,this.pixelRatio_=i,this.extent_=n,this.transform_=o,this.transformRotation_=o?toFixed(Math.atan2(o[1],o[0]),10):0,this.viewRotation_=l,this.squaredTolerance_=c,this.userTransform_=u,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=create()}drawImages_(e,i,n,o){if(!this.image_)return;const l=transform2D(e,i,n,o,this.transform_,this.pixelCoordinates_),c=this.context_,u=this.tmpLocalTransform_,h=c.globalAlpha;this.imageOpacity_!=1&&(c.globalAlpha=h*this.imageOpacity_);let f=this.imageRotation_;this.transformRotation_===0&&(f-=this.viewRotation_),this.imageRotateWithView_&&(f+=this.viewRotation_);for(let g=0,H=l.length;g<H;g+=2){const Y=l[g]-this.imageAnchorX_,ee=l[g+1]-this.imageAnchorY_;if(f!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const te=Y+this.imageAnchorX_,xe=ee+this.imageAnchorY_;compose(u,te,xe,1,1,f,-te,-xe),c.save(),c.transform.apply(c,u),c.translate(te,xe),c.scale(this.imageScale_[0],this.imageScale_[1]),c.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),c.restore()}else c.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,Y,ee,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(c.globalAlpha=h)}drawText_(e,i,n,o){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const l=transform2D(e,i,n,o,this.transform_,this.pixelCoordinates_),c=this.context_;let u=this.textRotation_;for(this.transformRotation_===0&&(u-=this.viewRotation_),this.textRotateWithView_&&(u+=this.viewRotation_);i<n;i+=o){const h=l[i]+this.textOffsetX_,f=l[i+1]+this.textOffsetY_;u!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(c.save(),c.translate(h-this.textOffsetX_,f-this.textOffsetY_),c.rotate(u),c.translate(this.textOffsetX_,this.textOffsetY_),c.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&c.strokeText(this.text_,0,0),this.textFillState_&&c.fillText(this.text_,0,0),c.restore()):(this.textStrokeState_&&c.strokeText(this.text_,h,f),this.textFillState_&&c.fillText(this.text_,h,f))}}moveToLineTo_(e,i,n,o,l){const c=this.context_,u=transform2D(e,i,n,o,this.transform_,this.pixelCoordinates_);c.moveTo(u[0],u[1]);let h=u.length;l&&(h-=2);for(let f=2;f<h;f+=2)c.lineTo(u[f],u[f+1]);return l&&c.closePath(),n}drawRings_(e,i,n,o){for(let l=0,c=n.length;l<c;++l)i=this.moveToLineTo_(e,i,n[l],o,!0);return i}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const i=transformGeom2D(e,this.transform_,this.pixelCoordinates_),n=i[2]-i[0],o=i[3]-i[1],l=Math.sqrt(n*n+o*o),c=this.context_;c.beginPath(),c.arc(i[0],i[1],l,0,2*Math.PI),this.fillState_&&c.fill(),this.strokeState_&&c.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,i){const n=i.getGeometryFunction()(e);n&&(this.setStyle(i),this.drawGeometry(n))}drawGeometryCollection(e){const i=e.getGeometriesArray();for(let n=0,o=i.length;n<o;++n)this.drawGeometry(i[n])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const i=e.getFlatCoordinates(),n=e.getStride();this.image_&&this.drawImages_(i,0,i.length,n),this.text_!==""&&this.drawText_(i,0,i.length,n)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const i=e.getFlatCoordinates(),n=e.getStride();this.image_&&this.drawImages_(i,0,i.length,n),this.text_!==""&&this.drawText_(i,0,i.length,n)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=e.getFlatCoordinates();i.beginPath(),this.moveToLineTo_(n,0,n.length,e.getStride(),!1),i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoint();this.drawText_(i,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const i=e.getExtent();if(intersects$1(this.extent_,i)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,o=e.getFlatCoordinates();let l=0;const c=e.getEnds(),u=e.getStride();n.beginPath();for(let h=0,f=c.length;h<f;++h)l=this.moveToLineTo_(o,l,c[h],u,!1);n.stroke()}if(this.text_!==""){const n=e.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const i=this.context_;i.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&i.fill(),this.strokeState_&&i.stroke()}if(this.text_!==""){const i=e.getFlatInteriorPoint();this.drawText_(i,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=e.getOrientedFlatCoordinates();let o=0;const l=e.getEndss(),c=e.getStride();i.beginPath();for(let u=0,h=l.length;u<h;++u){const f=l[u];o=this.drawRings_(n,o,f,c)}this.fillState_&&i.fill(),this.strokeState_&&i.stroke()}if(this.text_!==""){const i=e.getFlatInteriorPoints();this.drawText_(i,0,i.length,2)}}}setContextFillState_(e){const i=this.context_,n=this.contextFillState_;n?n.fillStyle!=e.fillStyle&&(n.fillStyle=e.fillStyle,i.fillStyle=e.fillStyle):(i.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const i=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=e.lineCap&&(n.lineCap=e.lineCap,i.lineCap=e.lineCap),equals(n.lineDash,e.lineDash)||i.setLineDash(n.lineDash=e.lineDash),n.lineDashOffset!=e.lineDashOffset&&(n.lineDashOffset=e.lineDashOffset,i.lineDashOffset=e.lineDashOffset),n.lineJoin!=e.lineJoin&&(n.lineJoin=e.lineJoin,i.lineJoin=e.lineJoin),n.lineWidth!=e.lineWidth&&(n.lineWidth=e.lineWidth,i.lineWidth=e.lineWidth),n.miterLimit!=e.miterLimit&&(n.miterLimit=e.miterLimit,i.miterLimit=e.miterLimit),n.strokeStyle!=e.strokeStyle&&(n.strokeStyle=e.strokeStyle,i.strokeStyle=e.strokeStyle)):(i.lineCap=e.lineCap,i.setLineDash(e.lineDash),i.lineDashOffset=e.lineDashOffset,i.lineJoin=e.lineJoin,i.lineWidth=e.lineWidth,i.miterLimit=e.miterLimit,i.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const i=this.context_,n=this.contextTextState_,o=e.textAlign?e.textAlign:defaultTextAlign;n?(n.font!=e.font&&(n.font=e.font,i.font=e.font),n.textAlign!=o&&(n.textAlign=o,i.textAlign=o),n.textBaseline!=e.textBaseline&&(n.textBaseline=e.textBaseline,i.textBaseline=e.textBaseline)):(i.font=e.font,i.textAlign=o,i.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:o,textBaseline:e.textBaseline})}setFillStrokeStyle(e,i){if(!e)this.fillState_=null;else{const n=e.getColor();this.fillState_={fillStyle:asColorLike(n||defaultFillStyle)}}if(!i)this.strokeState_=null;else{const n=i.getColor(),o=i.getLineCap(),l=i.getLineDash(),c=i.getLineDashOffset(),u=i.getLineJoin(),h=i.getWidth(),f=i.getMiterLimit(),g=l||defaultLineDash;this.strokeState_={lineCap:o!==void 0?o:defaultLineCap,lineDash:this.pixelRatio_===1?g:g.map(H=>H*this.pixelRatio_),lineDashOffset:(c||defaultLineDashOffset)*this.pixelRatio_,lineJoin:u!==void 0?u:defaultLineJoin,lineWidth:(h!==void 0?h:defaultLineWidth)*this.pixelRatio_,miterLimit:f!==void 0?f:defaultMiterLimit,strokeStyle:asColorLike(n||defaultStrokeStyle)}}}setImageStyle(e){let i;if(!e||!(i=e.getSize())){this.image_=null;return}const n=e.getPixelRatio(this.pixelRatio_),o=e.getAnchor(),l=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=o[0]*n,this.imageAnchorY_=o[1]*n,this.imageHeight_=i[1]*n,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=l[0],this.imageOriginY_=l[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const c=e.getScaleArray();this.imageScale_=[c[0]*this.pixelRatio_/n,c[1]*this.pixelRatio_/n],this.imageWidth_=i[0]*n}setTextStyle(e){if(!e)this.text_="";else{const i=e.getFill();if(!i)this.textFillState_=null;else{const ee=i.getColor();this.textFillState_={fillStyle:asColorLike(ee||defaultFillStyle)}}const n=e.getStroke();if(!n)this.textStrokeState_=null;else{const ee=n.getColor(),te=n.getLineCap(),xe=n.getLineDash(),ne=n.getLineDashOffset(),et=n.getLineJoin(),tt=n.getWidth(),it=n.getMiterLimit();this.textStrokeState_={lineCap:te!==void 0?te:defaultLineCap,lineDash:xe||defaultLineDash,lineDashOffset:ne||defaultLineDashOffset,lineJoin:et!==void 0?et:defaultLineJoin,lineWidth:tt!==void 0?tt:defaultLineWidth,miterLimit:it!==void 0?it:defaultMiterLimit,strokeStyle:asColorLike(ee||defaultStrokeStyle)}}const o=e.getFont(),l=e.getOffsetX(),c=e.getOffsetY(),u=e.getRotateWithView(),h=e.getRotation(),f=e.getScaleArray(),g=e.getText(),H=e.getTextAlign(),Y=e.getTextBaseline();this.textState_={font:o!==void 0?o:defaultFont,textAlign:H!==void 0?H:defaultTextAlign,textBaseline:Y!==void 0?Y:defaultTextBaseline},this.text_=g!==void 0?Array.isArray(g)?g.reduce((ee,te,xe)=>ee+=xe%2?" ":te,""):g:"",this.textOffsetX_=l!==void 0?this.pixelRatio_*l:0,this.textOffsetY_=c!==void 0?this.pixelRatio_*c:0,this.textRotateWithView_=u!==void 0?u:!1,this.textRotation_=h!==void 0?h:0,this.textScale_=[this.pixelRatio_*f[0],this.pixelRatio_*f[1]]}}}const HIT_DETECT_RESOLUTION=.5;function createHitDetectionImageData(s,e,i,n,o,l,c,u,h){const f=h?toUserExtent(o):o,g=s[0]*HIT_DETECT_RESOLUTION,H=s[1]*HIT_DETECT_RESOLUTION,Y=createCanvasContext2D(g,H);Y.imageSmoothingEnabled=!1;const ee=Y.canvas,te=new CanvasImmediateRenderer(Y,HIT_DETECT_RESOLUTION,o,null,c,u,h?getTransformFromProjections(getUserProjection(),h):null),xe=i.length,ne=Math.floor((256*256*256-1)/xe),et={};for(let it=1;it<=xe;++it){const rt=i[it-1],nt=rt.getStyleFunction()||n;if(!nt)continue;let st=nt(rt,l);if(!st)continue;Array.isArray(st)||(st=[st]);const ot=(it*ne).toString(16).padStart(7,"#00000");for(let ct=0,ht=st.length;ct<ht;++ct){const ut=st[ct],pt=ut.getGeometryFunction()(rt);if(!pt||!intersects$1(f,pt.getExtent()))continue;const yt=ut.clone(),mt=yt.getFill();mt&&mt.setColor(ot);const St=yt.getStroke();St&&(St.setColor(ot),St.setLineDash(null)),yt.setText(void 0);const Pt=ut.getImage();if(Pt){const vt=Pt.getImageSize();if(!vt)continue;const Et=createCanvasContext2D(vt[0],vt[1],void 0,{alpha:!1}),Ct=Et.canvas;Et.fillStyle=ot,Et.fillRect(0,0,Ct.width,Ct.height),yt.setImage(new Icon({img:Ct,anchor:Pt.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:Pt.getOrigin(),opacity:1,size:Pt.getSize(),scale:Pt.getScale(),rotation:Pt.getRotation(),rotateWithView:Pt.getRotateWithView()}))}const Rt=yt.getZIndex()||0;let Lt=et[Rt];Lt||(Lt={},et[Rt]=Lt,Lt.Polygon=[],Lt.Circle=[],Lt.LineString=[],Lt.Point=[]);const Nt=pt.getType();if(Nt==="GeometryCollection"){const vt=pt.getGeometriesArrayRecursive();for(let Et=0,Ct=vt.length;Et<Ct;++Et){const _t=vt[Et];Lt[_t.getType().replace("Multi","")].push(_t,yt)}}else Lt[Nt.replace("Multi","")].push(pt,yt)}}const tt=Object.keys(et).map(Number).sort(ascending);for(let it=0,rt=tt.length;it<rt;++it){const nt=et[tt[it]];for(const st in nt){const at=nt[st];for(let ot=0,ct=at.length;ot<ct;ot+=2){te.setStyle(at[ot+1]);for(let ht=0,ut=e.length;ht<ut;++ht)te.setTransform(e[ht]),te.drawGeometry(at[ot])}}}return Y.getImageData(0,0,ee.width,ee.height)}function hitDetect(s,e,i){const n=[];if(i){const o=Math.floor(Math.round(s[0])*HIT_DETECT_RESOLUTION),l=Math.floor(Math.round(s[1])*HIT_DETECT_RESOLUTION),c=(clamp$1(o,0,i.width-1)+clamp$1(l,0,i.height-1)*i.width)*4,u=i.data[c],h=i.data[c+1],g=i.data[c+2]+256*(h+256*u),H=Math.floor((256*256*256-1)/e.length);g&&g%H===0&&n.push(e[g/H-1])}return n}const SIMPLIFY_TOLERANCE=.5,GEOMETRY_RENDERERS={Point:renderPointGeometry,LineString:renderLineStringGeometry,Polygon:renderPolygonGeometry,MultiPoint:renderMultiPointGeometry,MultiLineString:renderMultiLineStringGeometry,MultiPolygon:renderMultiPolygonGeometry,GeometryCollection:renderGeometryCollectionGeometry,Circle:renderCircleGeometry};function defaultOrder(s,e){return parseInt(getUid(s),10)-parseInt(getUid(e),10)}function getSquaredTolerance(s,e){const i=getTolerance(s,e);return i*i}function getTolerance(s,e){return SIMPLIFY_TOLERANCE*s/e}function renderCircleGeometry(s,e,i,n,o){const l=i.getFill(),c=i.getStroke();if(l||c){const h=s.getBuilder(i.getZIndex(),"Circle");h.setFillStrokeStyle(l,c),h.drawCircle(e,n,o)}const u=i.getText();if(u&&u.getText()){const h=s.getBuilder(i.getZIndex(),"Text");h.setTextStyle(u),h.drawText(e,n)}}function renderFeature$1(s,e,i,n,o,l,c,u){const h=[],f=i.getImage();if(f){let Y=!0;const ee=f.getImageState();ee==ImageState.LOADED||ee==ImageState.ERROR?Y=!1:ee==ImageState.IDLE&&f.load(),Y&&h.push(f.ready())}const g=i.getFill();g&&g.loading()&&h.push(g.ready());const H=h.length>0;return H&&Promise.all(h).then(()=>o(null)),renderFeatureInternal(s,e,i,n,l,c,u),H}function renderFeatureInternal(s,e,i,n,o,l,c){const u=i.getGeometryFunction()(e);if(!u)return;const h=u.simplifyTransformed(n,o);if(i.getRenderer())renderGeometry(s,h,i,e,c);else{const g=GEOMETRY_RENDERERS[h.getType()];g(s,h,i,e,c,l)}}function renderGeometry(s,e,i,n,o){if(e.getType()=="GeometryCollection"){const c=e.getGeometries();for(let u=0,h=c.length;u<h;++u)renderGeometry(s,c[u],i,n,o);return}s.getBuilder(i.getZIndex(),"Default").drawCustom(e,n,i.getRenderer(),i.getHitDetectionRenderer(),o)}function renderGeometryCollectionGeometry(s,e,i,n,o,l){const c=e.getGeometriesArray();let u,h;for(u=0,h=c.length;u<h;++u){const f=GEOMETRY_RENDERERS[c[u].getType()];f(s,c[u],i,n,o,l)}}function renderLineStringGeometry(s,e,i,n,o){const l=i.getStroke();if(l){const u=s.getBuilder(i.getZIndex(),"LineString");u.setFillStrokeStyle(null,l),u.drawLineString(e,n,o)}const c=i.getText();if(c&&c.getText()){const u=s.getBuilder(i.getZIndex(),"Text");u.setTextStyle(c),u.drawText(e,n,o)}}function renderMultiLineStringGeometry(s,e,i,n,o){const l=i.getStroke();if(l){const u=s.getBuilder(i.getZIndex(),"LineString");u.setFillStrokeStyle(null,l),u.drawMultiLineString(e,n,o)}const c=i.getText();if(c&&c.getText()){const u=s.getBuilder(i.getZIndex(),"Text");u.setTextStyle(c),u.drawText(e,n,o)}}function renderMultiPolygonGeometry(s,e,i,n,o){const l=i.getFill(),c=i.getStroke();if(c||l){const h=s.getBuilder(i.getZIndex(),"Polygon");h.setFillStrokeStyle(l,c),h.drawMultiPolygon(e,n,o)}const u=i.getText();if(u&&u.getText()){const h=s.getBuilder(i.getZIndex(),"Text");h.setTextStyle(u),h.drawText(e,n,o)}}function renderPointGeometry(s,e,i,n,o,l){const c=i.getImage(),u=i.getText(),h=u&&u.getText(),f=l&&c&&h?{}:void 0;if(c){if(c.getImageState()!=ImageState.LOADED)return;const g=s.getBuilder(i.getZIndex(),"Image");g.setImageStyle(c,f),g.drawPoint(e,n,o)}if(h){const g=s.getBuilder(i.getZIndex(),"Text");g.setTextStyle(u,f),g.drawText(e,n,o)}}function renderMultiPointGeometry(s,e,i,n,o,l){const c=i.getImage(),u=c&&c.getOpacity()!==0,h=i.getText(),f=h&&h.getText(),g=l&&u&&f?{}:void 0;if(u){if(c.getImageState()!=ImageState.LOADED)return;const H=s.getBuilder(i.getZIndex(),"Image");H.setImageStyle(c,g),H.drawMultiPoint(e,n,o)}if(f){const H=s.getBuilder(i.getZIndex(),"Text");H.setTextStyle(h,g),H.drawText(e,n,o)}}function renderPolygonGeometry(s,e,i,n,o){const l=i.getFill(),c=i.getStroke();if(l||c){const h=s.getBuilder(i.getZIndex(),"Polygon");h.setFillStrokeStyle(l,c),h.drawPolygon(e,n,o)}const u=i.getText();if(u&&u.getText()){const h=s.getBuilder(i.getZIndex(),"Text");h.setTextStyle(u),h.drawText(e,n,o)}}class RenderEvent extends BaseEvent{constructor(e,i,n,o){super(e),this.inversePixelTransform=i,this.frameState=n,this.context=o}}const maxStaleKeys=5;class LayerRenderer extends Observable{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.staleKeys_=new Array,this.maxStaleKeys=maxStaleKeys}getStaleKeys(){return this.staleKeys_}prependStaleKey(e){this.staleKeys_.unshift(e),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(e){return abstract()}getData(e){return null}prepareFrame(e){return abstract()}renderFrame(e,i){return abstract()}forEachFeatureAtCoordinate(e,i,n,o,l){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const i=e.target;(i.getState()===ImageState.LOADED||i.getState()===ImageState.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let i=e.getState();return i!=ImageState.LOADED&&i!=ImageState.ERROR&&e.addEventListener(EventType.CHANGE,this.boundHandleImageChange_),i==ImageState.IDLE&&(e.load(),i=e.getState()),i==ImageState.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}renderDeferred(e){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const canvasPool=[];let pixelContext=null;function createPixelContext(){pixelContext=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0})}class CanvasLayerRenderer extends LayerRenderer{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=create(),this.pixelTransform=create(),this.inversePixelTransform=create(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(e,i,n){pixelContext||createPixelContext(),pixelContext.clearRect(0,0,1,1);let o;try{pixelContext.drawImage(e,i,n,1,1,0,0,1,1),o=pixelContext.getImageData(0,0,1,1).data}catch{return pixelContext=null,null}return o}getBackground(e){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(e.viewState.resolution)),n||void 0}useContainer(e,i,n){const o=this.getLayer().getClassName();let l,c;if(e&&e.className===o&&(!n||e&&e.style.backgroundColor&&equals(asArray(e.style.backgroundColor),asArray(n)))){const u=e.firstElementChild;isCanvas(u)&&(c=u.getContext("2d"))}if(c&&equivalent(c.canvas.style.transform,i)?(this.container=e,this.context=c,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){l=WORKER_OFFSCREEN_CANVAS?createMockDiv():document.createElement("div"),l.className=o;let u=l.style;u.position="absolute",u.width="100%",u.height="100%",c=createCanvasContext2D();const h=c.canvas;l.appendChild(h),u=h.style,u.position="absolute",u.left="0",u.transformOrigin="top left",this.container=l,this.context=c}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(e,i,n){const o=getTopLeft(n),l=getTopRight(n),c=getBottomRight(n),u=getBottomLeft(n);apply(i.coordinateToPixelTransform,o),apply(i.coordinateToPixelTransform,l),apply(i.coordinateToPixelTransform,c),apply(i.coordinateToPixelTransform,u);const h=this.inversePixelTransform;apply(h,o),apply(h,l),apply(h,c),apply(h,u),e.save(),e.beginPath(),e.moveTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(l[0]),Math.round(l[1])),e.lineTo(Math.round(c[0]),Math.round(c[1])),e.lineTo(Math.round(u[0]),Math.round(u[1])),e.clip()}prepareContainer(e,i){const n=e.extent,o=e.viewState.resolution,l=e.viewState.rotation,c=e.pixelRatio,u=Math.round(getWidth(n)/o*c),h=Math.round(getHeight(n)/o*c);compose(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/c,1/c,l,-u/2,-h/2),makeInverse(this.inversePixelTransform,this.pixelTransform);const f=toString$1(this.pixelTransform);if(this.useContainer(i,f,this.getBackground(e)),!this.containerReused){const g=this.context.canvas;g.width!=u||g.height!=h?(g.width=u,g.height=h):this.context.clearRect(0,0,u,h),f!==g.style.transform&&(g.style.transform=f)}}dispatchRenderEvent_(e,i,n){const o=this.getLayer();if(o.hasListener(e)){const l=new RenderEvent(e,this.inversePixelTransform,n,i);o.dispatchEvent(l)}}preRender(e,i){this.frameState=i,!i.declutter&&this.dispatchRenderEvent_(RenderEventType.PRERENDER,e,i)}postRender(e,i){i.declutter||this.dispatchRenderEvent_(RenderEventType.POSTRENDER,e,i)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new ZIndexContext),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(RenderEventType.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(RenderEventType.POSTRENDER,this.context,e))}getRenderTransform(e,i,n,o,l,c,u){const h=l/2,f=c/2,g=o/i,H=-g,Y=-e[0]+u,ee=-e[1];return compose(this.tempTransform,h,f,g,H,-n,Y,ee)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class CanvasVectorLayerRenderer extends CanvasLayerRenderer{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=createEmpty(),this.wrappedRenderedExtent_=createEmpty(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,i,n){const o=i.extent,l=i.viewState,c=l.center,u=l.resolution,h=l.projection,f=l.rotation,g=h.getExtent(),H=this.getLayer().getSource(),Y=this.getLayer().getDeclutter(),ee=i.pixelRatio,te=i.viewHints,xe=!(te[ViewHint.ANIMATING]||te[ViewHint.INTERACTING]),ne=this.context,et=Math.round(getWidth(o)/u*ee),tt=Math.round(getHeight(o)/u*ee),it=H.getWrapX()&&h.canWrapX(),rt=it?getWidth(g):null,nt=it?Math.ceil((o[2]-g[2])/rt)+1:1;let st=it?Math.floor((o[0]-g[0])/rt):0;do{let at=this.getRenderTransform(c,u,0,ee,et,tt,st*rt);i.declutter&&(at=at.slice(0)),e.execute(ne,[ne.canvas.width,ne.canvas.height],at,f,xe,n===void 0?ALL:n?DECLUTTER:NON_DECLUTTER,n?Y&&i.declutter[Y]:void 0)}while(++st<nt)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=createCanvasContext2D(this.context.canvas.width,this.context.canvas.height,canvasPool))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,releaseCanvas(this.context),canvasPool.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,i){const n=e.layerStatesArray[e.layerIndex];this.opacity_=n.opacity;const o=e.viewState;this.prepareContainer(e,i);const l=this.context,c=this.replayGroup_;let u=c&&!c.isEmpty();if(!u&&!(this.getLayer().hasListener(RenderEventType.PRERENDER)||this.getLayer().hasListener(RenderEventType.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(l,e),o.projection,this.clipped_=!1,u&&n.extent&&this.clipping){const h=fromUserExtent(n.extent);u=intersects$1(h,e.extent),this.clipped_=u&&!containsExtent(h,e.extent),this.clipped_&&this.clipUnrotated(l,e,h)}return u&&this.renderWorlds(c,e,this.getLayer().getDeclutter()?!1:void 0),!e.declutter&&this.clipped_&&l.restore(),this.postRender(l,e),this.renderedRotation_!==o.rotation&&(this.renderedRotation_=o.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(i=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=this.frameState.size.slice(),o=this.renderedCenter_,l=this.renderedResolution_,c=this.renderedRotation_,u=this.renderedProjection_,h=this.wrappedRenderedExtent_,f=this.getLayer(),g=[],H=n[0]*HIT_DETECT_RESOLUTION,Y=n[1]*HIT_DETECT_RESOLUTION;g.push(this.getRenderTransform(o,l,c,HIT_DETECT_RESOLUTION,H,Y,0).slice());const ee=f.getSource(),te=u.getExtent();if(ee.getWrapX()&&u.canWrapX()&&!containsExtent(te,h)){let xe=h[0];const ne=getWidth(te);let et=0,tt;for(;xe<te[0];)--et,tt=ne*et,g.push(this.getRenderTransform(o,l,c,HIT_DETECT_RESOLUTION,H,Y,tt).slice()),xe+=ne;for(et=0,xe=h[2];xe>te[2];)++et,tt=ne*et,g.push(this.getRenderTransform(o,l,c,HIT_DETECT_RESOLUTION,H,Y,tt).slice()),xe-=ne}this.hitDetectionImageData_=createHitDetectionImageData(n,g,this.renderedFeatures_,f.getStyleFunction(),h,l,c,getSquaredTolerance(l,this.renderedPixelRatio_),null)}i(hitDetect(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,i,n,o,l){var Y,ee;if(!this.replayGroup_)return;const c=i.viewState.resolution,u=i.viewState.rotation,h=this.getLayer(),f={},g=function(te,xe,ne){const et=getUid(te),tt=f[et];if(tt){if(tt!==!0&&ne<tt.distanceSq){if(ne===0)return f[et]=!0,l.splice(l.lastIndexOf(tt),1),o(te,h,xe);tt.geometry=xe,tt.distanceSq=ne}}else{if(ne===0)return f[et]=!0,o(te,h,xe);l.push(f[et]={feature:te,layer:h,geometry:xe,distanceSq:ne,callback:o})}},H=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,c,u,n,g,H?(ee=(Y=i.declutter)==null?void 0:Y[H])==null?void 0:ee.all().map(te=>te.value):null)}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const i=this.getLayer(),n=i.getSource();if(!n)return!1;const o=e.viewHints[ViewHint.ANIMATING],l=e.viewHints[ViewHint.INTERACTING],c=i.getUpdateWhileAnimating(),u=i.getUpdateWhileInteracting();if(this.ready&&!c&&o||!u&&l)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const h=e.extent,f=e.viewState,g=f.projection,H=f.resolution,Y=e.pixelRatio,ee=i.getRevision(),te=i.getRenderBuffer();let xe=i.getRenderOrder();xe===void 0&&(xe=defaultOrder);const ne=f.center.slice(),et=buffer(h,te*H),tt=et.slice(),it=[et.slice()],rt=g.getExtent();if(n.getWrapX()&&g.canWrapX()&&!containsExtent(rt,e.extent)){const mt=getWidth(rt),St=Math.max(getWidth(et)/2,mt);et[0]=rt[0]-St,et[2]=rt[2]+St,wrapX$1(ne,g);const Pt=wrapX$2(it[0],g);Pt[0]<rt[0]&&Pt[2]<rt[2]?it.push([Pt[0]+mt,Pt[1],Pt[2]+mt,Pt[3]]):Pt[0]>rt[0]&&Pt[2]>rt[2]&&it.push([Pt[0]-mt,Pt[1],Pt[2]-mt,Pt[3]])}if(this.ready&&this.renderedResolution_==H&&this.renderedRevision_==ee&&this.renderedRenderOrder_==xe&&this.renderedFrameDeclutter_===!!e.declutter&&containsExtent(this.wrappedRenderedExtent_,et))return equals(this.renderedExtent_,tt)||(this.hitDetectionImageData_=null,this.renderedExtent_=tt),this.renderedCenter_=ne,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const nt=new BuilderGroup(getTolerance(H,Y),et,H,Y);let st;for(let mt=0,St=it.length;mt<St;++mt)n.loadFeatures(it[mt],H,g);const at=getSquaredTolerance(H,Y);let ot=!0;const ct=(mt,St)=>{let Pt;const Rt=mt.getStyleFunction()||i.getStyleFunction();if(Rt&&(Pt=Rt(mt,H)),Pt){const Lt=this.renderFeature(mt,at,Pt,nt,st,this.getLayer().getDeclutter(),St);ot=ot&&!Lt}},ht=toUserExtent(et),ut=n.getFeaturesInExtent(ht);xe&&ut.sort(xe);for(let mt=0,St=ut.length;mt<St;++mt)ct(ut[mt],mt);this.renderedFeatures_=ut,this.ready=ot;const pt=nt.finish(),yt=new ExecutorGroup(et,H,Y,n.getOverlaps(),pt,i.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=H,this.renderedRevision_=ee,this.renderedRenderOrder_=xe,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=tt,this.wrappedRenderedExtent_=et,this.renderedCenter_=ne,this.renderedProjection_=g,this.renderedPixelRatio_=Y,this.replayGroup_=yt,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,i,n,o,l,c,u){if(!n)return!1;let h=!1;if(Array.isArray(n))for(let f=0,g=n.length;f<g;++f)h=renderFeature$1(o,e,n[f],i,this.boundHandleStyleImageChange_,l,c,u)||h;else h=renderFeature$1(o,e,n,i,this.boundHandleStyleImageChange_,l,c,u);return h}}let numTypes=0;const BooleanType$1=1<<numTypes++,NumberType$1=1<<numTypes++,StringType$1=1<<numTypes++,ColorType$1=1<<numTypes++,NumberArrayType$1=1<<numTypes++,SizeType=1<<numTypes++,AnyType=Math.pow(2,numTypes)-1,typeNames={[BooleanType$1]:"boolean",[NumberType$1]:"number",[StringType$1]:"string",[ColorType$1]:"color",[NumberArrayType$1]:"number[]",[SizeType]:"size"},namedTypes=Object.keys(typeNames).map(Number).sort(ascending);function isSpecific(s){return s in typeNames}function typeName(s){const e=[];for(const i of namedTypes)includesType(s,i)&&e.push(typeNames[i]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function includesType(s,e){return(s&e)===e}function isType(s,e){return s===e}class LiteralExpression{constructor(e,i){if(!isSpecific(e))throw new Error(`literal expressions must have a specific type, got ${typeName(e)}`);this.type=e,this.value=i}}class CallExpression{constructor(e,i,...n){this.type=e,this.operator=i,this.args=n}}function newParsingContext(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function parse$2(s,e,i){switch(typeof s){case"boolean":{if(isType(e,StringType$1))return new LiteralExpression(StringType$1,s?"true":"false");if(!includesType(e,BooleanType$1))throw new Error(`got a boolean, but expected ${typeName(e)}`);return new LiteralExpression(BooleanType$1,s)}case"number":{if(isType(e,SizeType))return new LiteralExpression(SizeType,toSize(s));if(isType(e,BooleanType$1))return new LiteralExpression(BooleanType$1,!!s);if(isType(e,StringType$1))return new LiteralExpression(StringType$1,s.toString());if(!includesType(e,NumberType$1))throw new Error(`got a number, but expected ${typeName(e)}`);return new LiteralExpression(NumberType$1,s)}case"string":{if(isType(e,ColorType$1))return new LiteralExpression(ColorType$1,fromString(s));if(isType(e,BooleanType$1))return new LiteralExpression(BooleanType$1,!!s);if(!includesType(e,StringType$1))throw new Error(`got a string, but expected ${typeName(e)}`);return new LiteralExpression(StringType$1,s)}}if(!Array.isArray(s))throw new Error("expression must be an array or a primitive value");if(s.length===0)throw new Error("empty expression");if(typeof s[0]=="string")return parseCallExpression(s,e,i);for(const n of s)if(typeof n!="number")throw new Error("expected an array of numbers");if(isType(e,SizeType)){if(s.length!==2)throw new Error(`expected an array of two values for a size, got ${s.length}`);return new LiteralExpression(SizeType,s)}if(isType(e,ColorType$1)){if(s.length===3)return new LiteralExpression(ColorType$1,[...s,1]);if(s.length===4)return new LiteralExpression(ColorType$1,s);throw new Error(`expected an array of 3 or 4 values for a color, got ${s.length}`)}if(!includesType(e,NumberArrayType$1))throw new Error(`got an array of numbers, but expected ${typeName(e)}`);return new LiteralExpression(NumberArrayType$1,s)}const Ops={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},parsers={[Ops.Get]:createCallExpressionParser(hasArgsCount(1,1/0),withGetArgs),[Ops.Var]:createCallExpressionParser(hasArgsCount(1,1),withVarArgs),[Ops.Has]:createCallExpressionParser(hasArgsCount(1,1/0),withGetArgs),[Ops.Id]:createCallExpressionParser(usesFeatureId,withNoArgs),[Ops.Concat]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfType(StringType$1)),[Ops.GeometryType]:createCallExpressionParser(usesGeometryType,withNoArgs),[Ops.LineMetric]:createCallExpressionParser(withNoArgs),[Ops.Resolution]:createCallExpressionParser(usesMapState,withNoArgs),[Ops.Zoom]:createCallExpressionParser(usesMapState,withNoArgs),[Ops.Time]:createCallExpressionParser(usesMapState,withNoArgs),[Ops.Any]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfType(BooleanType$1)),[Ops.All]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfType(BooleanType$1)),[Ops.Not]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(BooleanType$1)),[Ops.Equal]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(AnyType)),[Ops.NotEqual]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(AnyType)),[Ops.GreaterThan]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.GreaterThanOrEqualTo]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.LessThan]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.LessThanOrEqualTo]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.Multiply]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfReturnType),[Ops.Coalesce]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfReturnType),[Ops.Divide]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.Add]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfType(NumberType$1)),[Ops.Subtract]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.Clamp]:createCallExpressionParser(hasArgsCount(3,3),withArgsOfType(NumberType$1)),[Ops.Mod]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.Pow]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.Abs]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Floor]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Ceil]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Round]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Sin]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Cos]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Atan]:createCallExpressionParser(hasArgsCount(1,2),withArgsOfType(NumberType$1)),[Ops.Sqrt]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Match]:createCallExpressionParser(hasArgsCount(4,1/0),hasEvenArgs,withMatchArgs),[Ops.Between]:createCallExpressionParser(hasArgsCount(3,3),withArgsOfType(NumberType$1)),[Ops.Interpolate]:createCallExpressionParser(hasArgsCount(6,1/0),hasEvenArgs,withInterpolateArgs),[Ops.Case]:createCallExpressionParser(hasArgsCount(3,1/0),hasOddArgs,withCaseArgs),[Ops.In]:createCallExpressionParser(hasArgsCount(2,2),withInArgs),[Ops.Number]:createCallExpressionParser(hasArgsCount(1,1/0),withArgsOfType(AnyType)),[Ops.String]:createCallExpressionParser(hasArgsCount(1,1/0),withArgsOfType(AnyType)),[Ops.Array]:createCallExpressionParser(hasArgsCount(1,1/0),withArgsOfType(NumberType$1)),[Ops.Color]:createCallExpressionParser(hasArgsCount(1,4),withArgsOfType(NumberType$1)),[Ops.Band]:createCallExpressionParser(hasArgsCount(1,3),withArgsOfType(NumberType$1)),[Ops.Palette]:createCallExpressionParser(hasArgsCount(2,2),withPaletteArgs),[Ops.ToString]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(BooleanType$1|NumberType$1|StringType$1|ColorType$1))};function withGetArgs(s,e,i){const n=s.length-1,o=new Array(n);for(let l=0;l<n;++l){const c=s[l+1];switch(typeof c){case"number":{o[l]=new LiteralExpression(NumberType$1,c);break}case"string":{o[l]=new LiteralExpression(StringType$1,c);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${c}`)}l===0&&i.properties.add(String(c))}return o}function withVarArgs(s,e,i){const n=s[1];if(typeof n!="string")throw new Error("expected a string argument for var operation");return i.variables.add(n),[new LiteralExpression(StringType$1,n)]}function usesFeatureId(s,e,i){i.featureId=!0}function usesGeometryType(s,e,i){i.geometryType=!0}function usesMapState(s,e,i){i.mapState=!0}function withNoArgs(s,e,i){const n=s[0];if(s.length!==1)throw new Error(`expected no arguments for ${n} operation`);return[]}function hasArgsCount(s,e){return function(i,n,o){const l=i[0],c=i.length-1;if(s===e){if(c!==s){const u=s===1?"":"s";throw new Error(`expected ${s} argument${u} for ${l}, got ${c}`)}}else if(c<s||c>e){const u=e===1/0?`${s} or more`:`${s} to ${e}`;throw new Error(`expected ${u} arguments for ${l}, got ${c}`)}}}function withArgsOfReturnType(s,e,i){const n=s.length-1,o=new Array(n);for(let l=0;l<n;++l){const c=parse$2(s[l+1],e,i);o[l]=c}return o}function withArgsOfType(s){return function(e,i,n){const o=e.length-1,l=new Array(o);for(let c=0;c<o;++c){const u=parse$2(e[c+1],s,n);l[c]=u}return l}}function hasOddArgs(s,e,i){const n=s[0],o=s.length-1;if(o%2===0)throw new Error(`expected an odd number of arguments for ${n}, got ${o} instead`)}function hasEvenArgs(s,e,i){const n=s[0],o=s.length-1;if(o%2===1)throw new Error(`expected an even number of arguments for operation ${n}, got ${o} instead`)}function withMatchArgs(s,e,i){const n=s.length-1,o=StringType$1|NumberType$1|BooleanType$1,l=parse$2(s[1],o,i),c=parse$2(s[s.length-1],e,i),u=new Array(n-2);for(let h=0;h<n-2;h+=2){try{const f=parse$2(s[h+2],l.type,i);u[h]=f}catch(f){throw new Error(`failed to parse argument ${h+1} of match expression: ${f.message}`)}try{const f=parse$2(s[h+3],c.type,i);u[h+1]=f}catch(f){throw new Error(`failed to parse argument ${h+2} of match expression: ${f.message}`)}}return[l,...u,c]}function withInterpolateArgs(s,e,i){const n=s[1];let o;switch(n[0]){case"linear":o=1;break;case"exponential":const h=n[1];if(typeof h!="number"||h<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(h)} instead`);o=h;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(n)}`)}const l=new LiteralExpression(NumberType$1,o);let c;try{c=parse$2(s[2],NumberType$1,i)}catch(h){throw new Error(`failed to parse argument 1 in interpolate expression: ${h.message}`)}const u=new Array(s.length-3);for(let h=0;h<u.length;h+=2){try{const f=parse$2(s[h+3],NumberType$1,i);u[h]=f}catch(f){throw new Error(`failed to parse argument ${h+2} for interpolate expression: ${f.message}`)}try{const f=parse$2(s[h+4],e,i);u[h+1]=f}catch(f){throw new Error(`failed to parse argument ${h+3} for interpolate expression: ${f.message}`)}}return[l,c,...u]}function withCaseArgs(s,e,i){const n=parse$2(s[s.length-1],e,i),o=new Array(s.length-1);for(let l=0;l<o.length-1;l+=2){try{const c=parse$2(s[l+1],BooleanType$1,i);o[l]=c}catch(c){throw new Error(`failed to parse argument ${l} of case expression: ${c.message}`)}try{const c=parse$2(s[l+2],n.type,i);o[l+1]=c}catch(c){throw new Error(`failed to parse argument ${l+1} of case expression: ${c.message}`)}}return o[o.length-1]=n,o}function withInArgs(s,e,i){let n=s[2];if(!Array.isArray(n))throw new Error('the second argument for the "in" operator must be an array');let o;if(typeof n[0]=="string"){if(n[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(n[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');n=n[1],o=StringType$1}else o=NumberType$1;const l=new Array(n.length);for(let u=0;u<l.length;u++)try{const h=parse$2(n[u],o,i);l[u]=h}catch(h){throw new Error(`failed to parse haystack item ${u} for "in" expression: ${h.message}`)}return[parse$2(s[1],o,i),...l]}function withPaletteArgs(s,e,i){let n;try{n=parse$2(s[1],NumberType$1,i)}catch(c){throw new Error(`failed to parse first argument in palette expression: ${c.message}`)}const o=s[2];if(!Array.isArray(o))throw new Error("the second argument of palette must be an array");const l=new Array(o.length);for(let c=0;c<l.length;c++){let u;try{u=parse$2(o[c],ColorType$1,i)}catch(h){throw new Error(`failed to parse color at index ${c} in palette expression: ${h.message}`)}if(!(u instanceof LiteralExpression))throw new Error(`the palette color at index ${c} must be a literal value`);l[c]=u}return[n,...l]}function createCallExpressionParser(...s){return function(e,i,n){const o=e[0];let l;for(let c=0;c<s.length;c++){const u=s[c](e,i,n);if(c==s.length-1){if(!u)throw new Error("expected last argument validator to return the parsed args");l=u}}return new CallExpression(i,o,...l)}}function parseCallExpression(s,e,i){const n=s[0],o=parsers[n];if(!o)throw new Error(`unknown operator: ${n}`);return o(s,e,i)}function computeGeometryType(s){if(!s)return"";const e=s.getType();switch(e){case"Point":case"LineString":case"Polygon":return e;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return e.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return computeGeometryType(s.getGeometries()[0]);default:return""}}function newEvaluationContext(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function buildExpression(s,e,i){const n=parse$2(s,e,i);return compileExpression(n)}function compileExpression(s,e){if(s instanceof LiteralExpression){if(s.type===ColorType$1&&typeof s.value=="string"){const n=fromString(s.value);return function(){return n}}return function(){return s.value}}const i=s.operator;switch(i){case Ops.Number:case Ops.String:case Ops.Coalesce:return compileAssertionExpression(s);case Ops.Get:case Ops.Var:case Ops.Has:return compileAccessorExpression(s);case Ops.Id:return n=>n.featureId;case Ops.GeometryType:return n=>n.geometryType;case Ops.Concat:{const n=s.args.map(o=>compileExpression(o));return o=>"".concat(...n.map(l=>l(o).toString()))}case Ops.Resolution:return n=>n.resolution;case Ops.Any:case Ops.All:case Ops.Between:case Ops.In:case Ops.Not:return compileLogicalExpression(s);case Ops.Equal:case Ops.NotEqual:case Ops.LessThan:case Ops.LessThanOrEqualTo:case Ops.GreaterThan:case Ops.GreaterThanOrEqualTo:return compileComparisonExpression(s);case Ops.Multiply:case Ops.Divide:case Ops.Add:case Ops.Subtract:case Ops.Clamp:case Ops.Mod:case Ops.Pow:case Ops.Abs:case Ops.Floor:case Ops.Ceil:case Ops.Round:case Ops.Sin:case Ops.Cos:case Ops.Atan:case Ops.Sqrt:return compileNumericExpression(s);case Ops.Case:return compileCaseExpression(s);case Ops.Match:return compileMatchExpression(s);case Ops.Interpolate:return compileInterpolateExpression(s);case Ops.ToString:return compileConvertExpression(s);default:throw new Error(`Unsupported operator ${i}`)}}function compileAssertionExpression(s,e){const i=s.operator,n=s.args.length,o=new Array(n);for(let l=0;l<n;++l)o[l]=compileExpression(s.args[l]);switch(i){case Ops.Coalesce:return l=>{for(let c=0;c<n;++c){const u=o[c](l);if(typeof u<"u"&&u!==null)return u}throw new Error("Expected one of the values to be non-null")};case Ops.Number:case Ops.String:return l=>{for(let c=0;c<n;++c){const u=o[c](l);if(typeof u===i)return u}throw new Error(`Expected one of the values to be a ${i}`)};default:throw new Error(`Unsupported assertion operator ${i}`)}}function compileAccessorExpression(s,e){const n=s.args[0].value;switch(s.operator){case Ops.Get:return o=>{const l=s.args;let c=o.properties[n];for(let u=1,h=l.length;u<h;++u){const g=l[u].value;c=c[g]}return c};case Ops.Var:return o=>o.variables[n];case Ops.Has:return o=>{const l=s.args;if(!(n in o.properties))return!1;let c=o.properties[n];for(let u=1,h=l.length;u<h;++u){const g=l[u].value;if(!c||!Object.hasOwn(c,g))return!1;c=c[g]}return!0};default:throw new Error(`Unsupported accessor operator ${s.operator}`)}}function compileComparisonExpression(s,e){const i=s.operator,n=compileExpression(s.args[0]),o=compileExpression(s.args[1]);switch(i){case Ops.Equal:return l=>n(l)===o(l);case Ops.NotEqual:return l=>n(l)!==o(l);case Ops.LessThan:return l=>n(l)<o(l);case Ops.LessThanOrEqualTo:return l=>n(l)<=o(l);case Ops.GreaterThan:return l=>n(l)>o(l);case Ops.GreaterThanOrEqualTo:return l=>n(l)>=o(l);default:throw new Error(`Unsupported comparison operator ${i}`)}}function compileLogicalExpression(s,e){const i=s.operator,n=s.args.length,o=new Array(n);for(let l=0;l<n;++l)o[l]=compileExpression(s.args[l]);switch(i){case Ops.Any:return l=>{for(let c=0;c<n;++c)if(o[c](l))return!0;return!1};case Ops.All:return l=>{for(let c=0;c<n;++c)if(!o[c](l))return!1;return!0};case Ops.Between:return l=>{const c=o[0](l),u=o[1](l),h=o[2](l);return c>=u&&c<=h};case Ops.In:return l=>{const c=o[0](l);for(let u=1;u<n;++u)if(c===o[u](l))return!0;return!1};case Ops.Not:return l=>!o[0](l);default:throw new Error(`Unsupported logical operator ${i}`)}}function compileNumericExpression(s,e){const i=s.operator,n=s.args.length,o=new Array(n);for(let l=0;l<n;++l)o[l]=compileExpression(s.args[l]);switch(i){case Ops.Multiply:return l=>{let c=1;for(let u=0;u<n;++u)c*=o[u](l);return c};case Ops.Divide:return l=>o[0](l)/o[1](l);case Ops.Add:return l=>{let c=0;for(let u=0;u<n;++u)c+=o[u](l);return c};case Ops.Subtract:return l=>o[0](l)-o[1](l);case Ops.Clamp:return l=>{const c=o[0](l),u=o[1](l);if(c<u)return u;const h=o[2](l);return c>h?h:c};case Ops.Mod:return l=>o[0](l)%o[1](l);case Ops.Pow:return l=>Math.pow(o[0](l),o[1](l));case Ops.Abs:return l=>Math.abs(o[0](l));case Ops.Floor:return l=>Math.floor(o[0](l));case Ops.Ceil:return l=>Math.ceil(o[0](l));case Ops.Round:return l=>Math.round(o[0](l));case Ops.Sin:return l=>Math.sin(o[0](l));case Ops.Cos:return l=>Math.cos(o[0](l));case Ops.Atan:return n===2?l=>Math.atan2(o[0](l),o[1](l)):l=>Math.atan(o[0](l));case Ops.Sqrt:return l=>Math.sqrt(o[0](l));default:throw new Error(`Unsupported numeric operator ${i}`)}}function compileCaseExpression(s,e){const i=s.args.length,n=new Array(i);for(let o=0;o<i;++o)n[o]=compileExpression(s.args[o]);return o=>{for(let l=0;l<i-1;l+=2)if(n[l](o))return n[l+1](o);return n[i-1](o)}}function compileMatchExpression(s,e){const i=s.args.length,n=new Array(i);for(let o=0;o<i;++o)n[o]=compileExpression(s.args[o]);return o=>{const l=n[0](o);for(let c=1;c<i-1;c+=2)if(l===n[c](o))return n[c+1](o);return n[i-1](o)}}function compileInterpolateExpression(s,e){const i=s.args.length,n=new Array(i);for(let o=0;o<i;++o)n[o]=compileExpression(s.args[o]);return o=>{const l=n[0](o),c=n[1](o);let u,h;for(let f=2;f<i;f+=2){const g=n[f](o);let H=n[f+1](o);const Y=Array.isArray(H);if(Y&&(H=withAlpha(H)),g>=c)return f===2?H:Y?interpolateColor(l,c,u,h,g,H):interpolateNumber$1(l,c,u,h,g,H);u=g,h=H}return h}}function compileConvertExpression(s,e){const i=s.operator,n=s.args.length,o=new Array(n);for(let l=0;l<n;++l)o[l]=compileExpression(s.args[l]);switch(i){case Ops.ToString:return l=>{const c=o[0](l);return s.args[0].type===ColorType$1?toString(c):c.toString()};default:throw new Error(`Unsupported convert operator ${i}`)}}function interpolateNumber$1(s,e,i,n,o,l){const c=o-i;if(c===0)return n;const u=e-i,h=s===1?u/c:(Math.pow(s,u)-1)/(Math.pow(s,c)-1);return n+h*(l-n)}function interpolateColor(s,e,i,n,o,l){if(o-i===0)return n;const u=rgbaToLcha(n),h=rgbaToLcha(l);let f=h[2]-u[2];f>180?f-=360:f<-180&&(f+=360);const g=[interpolateNumber$1(s,e,i,u[0],o,h[0]),interpolateNumber$1(s,e,i,u[1],o,h[1]),u[2]+interpolateNumber$1(s,e,i,0,o,f),interpolateNumber$1(s,e,i,n[3],o,l[3])];return lchaToRgba(g)}function always(s){return!0}function rulesToStyleFunction(s){const e=newParsingContext(),i=buildRuleSet(s,e),n=newEvaluationContext();return function(o,l){if(n.properties=o.getPropertiesInternal(),n.resolution=l,e.featureId){const c=o.getId();c!==void 0?n.featureId=c:n.featureId=null}return e.geometryType&&(n.geometryType=computeGeometryType(o.getGeometry())),i(n)}}function flatStylesToStyleFunction(s){const e=newParsingContext(),i=s.length,n=new Array(i);for(let c=0;c<i;++c)n[c]=buildStyle(s[c],e);const o=newEvaluationContext(),l=new Array(i);return function(c,u){if(o.properties=c.getPropertiesInternal(),o.resolution=u,e.featureId){const f=c.getId();f!==void 0?o.featureId=f:o.featureId=null}let h=0;for(let f=0;f<i;++f){const g=n[f](o);g&&(l[h]=g,h+=1)}return l.length=h,l}}function buildRuleSet(s,e){const i=s.length,n=new Array(i);for(let o=0;o<i;++o){const l=s[o],c="filter"in l?buildExpression(l.filter,BooleanType$1,e):always;let u;if(Array.isArray(l.style)){const h=l.style.length;u=new Array(h);for(let f=0;f<h;++f)u[f]=buildStyle(l.style[f],e)}else u=[buildStyle(l.style,e)];n[o]={filter:c,styles:u}}return function(o){const l=[];let c=!1;for(let u=0;u<i;++u){const h=n[u].filter;if(h(o)&&!(s[u].else&&c)){c=!0;for(const f of n[u].styles){const g=f(o);g&&l.push(g)}}}return l}}function buildStyle(s,e){const i=buildFill(s,"",e),n=buildStroke(s,"",e),o=buildText(s,e),l=buildImage(s,e),c=numberEvaluator(s,"z-index",e);if(!i&&!n&&!o&&!l&&!isEmpty(s))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(s));const u=new Style$1;return function(h){let f=!0;if(i){const g=i(h);g&&(f=!1),u.setFill(g)}if(n){const g=n(h);g&&(f=!1),u.setStroke(g)}if(o){const g=o(h);g&&(f=!1),u.setText(g)}if(l){const g=l(h);g&&(f=!1),u.setImage(g)}return c&&u.setZIndex(c(h)),f?null:u}}function buildFill(s,e,i){let n;if(e+"fill-pattern-src"in s)n=patternEvaluator(s,e+"fill-",i);else{if(s[e+"fill-color"]==="none")return l=>null;n=colorLikeEvaluator(s,e+"fill-color",i)}if(!n)return null;const o=new Fill;return function(l){const c=n(l);return c===NO_COLOR?null:(o.setColor(c),o)}}function buildStroke(s,e,i){const n=numberEvaluator(s,e+"stroke-width",i),o=colorLikeEvaluator(s,e+"stroke-color",i);if(!n&&!o)return null;const l=stringEvaluator(s,e+"stroke-line-cap",i),c=stringEvaluator(s,e+"stroke-line-join",i),u=numberArrayEvaluator(s,e+"stroke-line-dash",i),h=numberEvaluator(s,e+"stroke-line-dash-offset",i),f=numberEvaluator(s,e+"stroke-miter-limit",i),g=new Stroke;return function(H){if(o){const Y=o(H);if(Y===NO_COLOR)return null;g.setColor(Y)}if(n&&g.setWidth(n(H)),l){const Y=l(H);if(Y!=="butt"&&Y!=="round"&&Y!=="square")throw new Error("Expected butt, round, or square line cap");g.setLineCap(Y)}if(c){const Y=c(H);if(Y!=="bevel"&&Y!=="round"&&Y!=="miter")throw new Error("Expected bevel, round, or miter line join");g.setLineJoin(Y)}return u&&g.setLineDash(u(H)),h&&g.setLineDashOffset(h(H)),f&&g.setMiterLimit(f(H)),g}}function buildText(s,e){const i="text-",n=stringEvaluator(s,i+"value",e);if(!n)return null;const o=buildFill(s,i,e),l=buildFill(s,i+"background-",e),c=buildStroke(s,i,e),u=buildStroke(s,i+"background-",e),h=stringEvaluator(s,i+"font",e),f=numberEvaluator(s,i+"max-angle",e),g=numberEvaluator(s,i+"offset-x",e),H=numberEvaluator(s,i+"offset-y",e),Y=booleanEvaluator(s,i+"overflow",e),ee=stringEvaluator(s,i+"placement",e),te=numberEvaluator(s,i+"repeat",e),xe=sizeLikeEvaluator(s,i+"scale",e),ne=booleanEvaluator(s,i+"rotate-with-view",e),et=numberEvaluator(s,i+"rotation",e),tt=stringEvaluator(s,i+"align",e),it=stringEvaluator(s,i+"justify",e),rt=stringEvaluator(s,i+"baseline",e),nt=booleanEvaluator(s,i+"keep-upright",e),st=numberArrayEvaluator(s,i+"padding",e),at=optionalDeclutterMode(s,i+"declutter-mode"),ot=new Text({declutterMode:at});return function(ct){if(ot.setText(n(ct)),o&&ot.setFill(o(ct)),l&&ot.setBackgroundFill(l(ct)),c&&ot.setStroke(c(ct)),u&&ot.setBackgroundStroke(u(ct)),h&&ot.setFont(h(ct)),f&&ot.setMaxAngle(f(ct)),g&&ot.setOffsetX(g(ct)),H&&ot.setOffsetY(H(ct)),Y&&ot.setOverflow(Y(ct)),ee){const ht=ee(ct);if(ht!=="point"&&ht!=="line")throw new Error("Expected point or line for text-placement");ot.setPlacement(ht)}if(te&&ot.setRepeat(te(ct)),xe&&ot.setScale(xe(ct)),ne&&ot.setRotateWithView(ne(ct)),et&&ot.setRotation(et(ct)),tt){const ht=tt(ct);if(ht!=="left"&&ht!=="center"&&ht!=="right"&&ht!=="end"&&ht!=="start")throw new Error("Expected left, right, center, start, or end for text-align");ot.setTextAlign(ht)}if(it){const ht=it(ct);if(ht!=="left"&&ht!=="right"&&ht!=="center")throw new Error("Expected left, right, or center for text-justify");ot.setJustify(ht)}if(rt){const ht=rt(ct);if(ht!=="bottom"&&ht!=="top"&&ht!=="middle"&&ht!=="alphabetic"&&ht!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");ot.setTextBaseline(ht)}return st&&ot.setPadding(st(ct)),nt&&ot.setKeepUpright(nt(ct)),ot}}function buildImage(s,e){return"icon-src"in s?buildIcon(s,e):"shape-points"in s?buildShape(s,e):"circle-radius"in s?buildCircle(s,e):null}function buildIcon(s,e){const i="icon-",n=i+"src",o=requireString(s[n],n),l=coordinateEvaluator(s,i+"anchor",e),c=sizeLikeEvaluator(s,i+"scale",e),u=numberEvaluator(s,i+"opacity",e),h=coordinateEvaluator(s,i+"displacement",e),f=numberEvaluator(s,i+"rotation",e),g=booleanEvaluator(s,i+"rotate-with-view",e),H=optionalIconOrigin(s,i+"anchor-origin"),Y=optionalIconAnchorUnits(s,i+"anchor-x-units"),ee=optionalIconAnchorUnits(s,i+"anchor-y-units"),te=optionalColorLike(s,i+"color"),xe=optionalString(s,i+"cross-origin"),ne=optionalNumberArray(s,i+"offset"),et=optionalIconOrigin(s,i+"offset-origin"),tt=optionalNumber(s,i+"width"),it=optionalNumber(s,i+"height"),rt=optionalSize(s,i+"size"),nt=optionalDeclutterMode(s,i+"declutter-mode"),st=new Icon({src:o,anchorOrigin:H,anchorXUnits:Y,anchorYUnits:ee,color:te,crossOrigin:xe,offset:ne,offsetOrigin:et,height:it,width:tt,size:rt,declutterMode:nt});return function(at){return u&&st.setOpacity(u(at)),h&&st.setDisplacement(h(at)),f&&st.setRotation(f(at)),g&&st.setRotateWithView(g(at)),c&&st.setScale(c(at)),l&&st.setAnchor(l(at)),st}}function buildShape(s,e){const i="shape-",n=i+"points",o=i+"radius",l=requireNumber(s[n],n),c=requireNumber(s[o],o),u=buildFill(s,i,e),h=buildStroke(s,i,e),f=sizeLikeEvaluator(s,i+"scale",e),g=coordinateEvaluator(s,i+"displacement",e),H=numberEvaluator(s,i+"rotation",e),Y=booleanEvaluator(s,i+"rotate-with-view",e),ee=optionalNumber(s,i+"radius2"),te=optionalNumber(s,i+"angle"),xe=optionalDeclutterMode(s,i+"declutter-mode"),ne=new RegularShape({points:l,radius:c,radius2:ee,angle:te,declutterMode:xe});return function(et){return u&&ne.setFill(u(et)),h&&ne.setStroke(h(et)),g&&ne.setDisplacement(g(et)),H&&ne.setRotation(H(et)),Y&&ne.setRotateWithView(Y(et)),f&&ne.setScale(f(et)),ne}}function buildCircle(s,e){const i="circle-",n=buildFill(s,i,e),o=buildStroke(s,i,e),l=numberEvaluator(s,i+"radius",e),c=sizeLikeEvaluator(s,i+"scale",e),u=coordinateEvaluator(s,i+"displacement",e),h=numberEvaluator(s,i+"rotation",e),f=booleanEvaluator(s,i+"rotate-with-view",e),g=optionalDeclutterMode(s,i+"declutter-mode"),H=new CircleStyle({radius:5,declutterMode:g});return function(Y){return l&&H.setRadius(l(Y)),n&&H.setFill(n(Y)),o&&H.setStroke(o(Y)),u&&H.setDisplacement(u(Y)),h&&H.setRotation(h(Y)),f&&H.setRotateWithView(f(Y)),c&&H.setScale(c(Y)),H}}function numberEvaluator(s,e,i){if(!(e in s))return;const n=buildExpression(s[e],NumberType$1,i);return function(o){return requireNumber(n(o),e)}}function stringEvaluator(s,e,i){if(!(e in s))return null;const n=buildExpression(s[e],StringType$1,i);return function(o){return requireString(n(o),e)}}function patternEvaluator(s,e,i){const n=stringEvaluator(s,e+"pattern-src",i),o=sizeEvaluator(s,e+"pattern-offset",i),l=sizeEvaluator(s,e+"pattern-size",i),c=colorLikeEvaluator(s,e+"color",i);return function(u){return{src:n(u),offset:o&&o(u),size:l&&l(u),color:c&&c(u)}}}function booleanEvaluator(s,e,i){if(!(e in s))return null;const n=buildExpression(s[e],BooleanType$1,i);return function(o){const l=n(o);if(typeof l!="boolean")throw new Error(`Expected a boolean for ${e}`);return l}}function colorLikeEvaluator(s,e,i){if(!(e in s))return null;const n=buildExpression(s[e],ColorType$1,i);return function(o){return requireColorLike(n(o),e)}}function numberArrayEvaluator(s,e,i){if(!(e in s))return null;const n=buildExpression(s[e],NumberArrayType$1,i);return function(o){return requireNumberArray(n(o),e)}}function coordinateEvaluator(s,e,i){if(!(e in s))return null;const n=buildExpression(s[e],NumberArrayType$1,i);return function(o){const l=requireNumberArray(n(o),e);if(l.length!==2)throw new Error(`Expected two numbers for ${e}`);return l}}function sizeEvaluator(s,e,i){if(!(e in s))return null;const n=buildExpression(s[e],NumberArrayType$1,i);return function(o){return requireSize(n(o),e)}}function sizeLikeEvaluator(s,e,i){if(!(e in s))return null;const n=buildExpression(s[e],NumberArrayType$1|NumberType$1,i);return function(o){return requireSizeLike(n(o),e)}}function optionalNumber(s,e){const i=s[e];if(i!==void 0){if(typeof i!="number")throw new Error(`Expected a number for ${e}`);return i}}function optionalSize(s,e){const i=s[e];if(i!==void 0){if(typeof i=="number")return toSize(i);if(!Array.isArray(i))throw new Error(`Expected a number or size array for ${e}`);if(i.length!==2||typeof i[0]!="number"||typeof i[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return i}}function optionalString(s,e){const i=s[e];if(i!==void 0){if(typeof i!="string")throw new Error(`Expected a string for ${e}`);return i}}function optionalIconOrigin(s,e){const i=s[e];if(i!==void 0){if(i!=="bottom-left"&&i!=="bottom-right"&&i!=="top-left"&&i!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return i}}function optionalIconAnchorUnits(s,e){const i=s[e];if(i!==void 0){if(i!=="pixels"&&i!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return i}}function optionalNumberArray(s,e){const i=s[e];if(i!==void 0)return requireNumberArray(i,e)}function optionalDeclutterMode(s,e){const i=s[e];if(i!==void 0){if(typeof i!="string")throw new Error(`Expected a string for ${e}`);if(i!=="declutter"&&i!=="obstacle"&&i!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return i}}function optionalColorLike(s,e){const i=s[e];if(i!==void 0)return requireColorLike(i,e)}function requireNumberArray(s,e){if(!Array.isArray(s))throw new Error(`Expected an array for ${e}`);const i=s.length;for(let n=0;n<i;++n)if(typeof s[n]!="number")throw new Error(`Expected an array of numbers for ${e}`);return s}function requireString(s,e){if(typeof s!="string")throw new Error(`Expected a string for ${e}`);return s}function requireNumber(s,e){if(typeof s!="number")throw new Error(`Expected a number for ${e}`);return s}function requireColorLike(s,e){if(typeof s=="string")return s;const i=requireNumberArray(s,e),n=i.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return i}function requireSize(s,e){const i=requireNumberArray(s,e);if(i.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return i}function requireSizeLike(s,e){return typeof s=="number"?s:requireSize(s,e)}const ViewProperty={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function createExtent(s,e,i){return(function(n,o,l,c,u){if(!n)return;if(!o&&!e)return n;const h=e?0:l[0]*o,f=e?0:l[1]*o,g=u?u[0]:0,H=u?u[1]:0;let Y=s[0]+h/2+g,ee=s[2]-h/2+g,te=s[1]+f/2+H,xe=s[3]-f/2+H;Y>ee&&(Y=(ee+Y)/2,ee=Y),te>xe&&(te=(xe+te)/2,xe=te);let ne=clamp$1(n[0],Y,ee),et=clamp$1(n[1],te,xe);if(c&&i&&o){const tt=30*o;ne+=-tt*Math.log(1+Math.max(0,Y-n[0])/tt)+tt*Math.log(1+Math.max(0,n[0]-ee)/tt),et+=-tt*Math.log(1+Math.max(0,te-n[1])/tt)+tt*Math.log(1+Math.max(0,n[1]-xe)/tt)}return[ne,et]})}function none(s){return s}function getViewportClampedResolution(s,e,i,n){const o=getWidth(e)/i[0],l=getHeight(e)/i[1];return n?Math.min(s,Math.max(o,l)):Math.min(s,Math.min(o,l))}function getSmoothClampedResolution(s,e,i){let n=Math.min(s,e);const o=50;return n*=Math.log(1+o*Math.max(0,s/e-1))/o+1,i&&(n=Math.max(n,i),n/=Math.log(1+o*Math.max(0,i/s-1))/o+1),clamp$1(n,i/2,e*2)}function createSnapToResolutions(s,e,i,n){return e=e!==void 0?e:!0,(function(o,l,c,u){if(o!==void 0){const h=s[0],f=s[s.length-1],g=i?getViewportClampedResolution(h,i,c,n):h;if(u)return e?getSmoothClampedResolution(o,g,f):clamp$1(o,f,g);const H=Math.min(g,o),Y=Math.floor(linearFindNearest(s,H,l));return s[Y]>g&&Y<s.length-1?s[Y+1]:s[Y]}})}function createSnapToPower(s,e,i,n,o,l){return n=n!==void 0?n:!0,i=i!==void 0?i:0,(function(c,u,h,f){if(c!==void 0){const g=o?getViewportClampedResolution(e,o,h,l):e;if(f)return n?getSmoothClampedResolution(c,g,i):clamp$1(c,i,g);const H=1e-9,Y=Math.ceil(Math.log(e/g)/Math.log(s)-H),ee=-u*(.5-H)+.5,te=Math.min(g,c),xe=Math.floor(Math.log(e/te)/Math.log(s)+ee),ne=Math.max(Y,xe),et=e/Math.pow(s,ne);return clamp$1(et,i,g)}})}function createMinMaxResolution(s,e,i,n,o){return i=i!==void 0?i:!0,(function(l,c,u,h){if(l!==void 0){const f=n?getViewportClampedResolution(s,n,u,o):s;return!i||!h?clamp$1(l,e,f):getSmoothClampedResolution(l,f,e)}})}const DEFAULT_MIN_ZOOM=0;class View extends BaseObject{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=createProjection(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&disableCoordinateWarning(),e.center&&(e.center=fromUserCoordinate(e.center,this.projection_)),e.extent&&(e.extent=fromUserExtent(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const i=Object.assign({},e);for(const u in ViewProperty)delete i[u];this.setProperties(i,!0);const n=createResolutionConstraint(e);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=n.minZoom;const o=createCenterConstraint(e),l=n.constraint,c=createRotationConstraint(e);this.constraints_={center:o,resolution:l,rotation:c},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let i=this.padding_;this.padding_=e;const n=this.getCenterInternal();if(n){const o=e||[0,0,0,0];i=i||[0,0,0,0];const l=this.getResolution(),c=l/2*(o[3]-i[3]+i[1]-o[1]),u=l/2*(o[0]-i[0]+i[2]-o[2]);this.setCenterInternal([n[0]+c,n[1]-u])}}getUpdatedOptions_(e){const i=this.getProperties();return i.resolution!==void 0?i.resolution=this.getResolution():i.zoom=this.getZoom(),i.center=this.getCenterInternal(),i.rotation=this.getRotation(),Object.assign({},i,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const i=new Array(arguments.length);for(let n=0;n<i.length;++n){let o=arguments[n];o.center&&(o=Object.assign({},o),o.center=fromUserCoordinate(o.center,this.getProjection())),o.anchor&&(o=Object.assign({},o),o.anchor=fromUserCoordinate(o.anchor,this.getProjection())),i[n]=o}this.animateInternal.apply(this,i)}animateInternal(e){let i=arguments.length,n;i>1&&typeof arguments[i-1]=="function"&&(n=arguments[i-1],--i);let o=0;for(;o<i&&!this.isDef();++o){const g=arguments[o];g.center&&this.setCenterInternal(g.center),g.zoom!==void 0?this.setZoom(g.zoom):g.resolution&&this.setResolution(g.resolution),g.rotation!==void 0&&this.setRotation(g.rotation)}if(o===i){n&&animationCallback(n,!0);return}let l=Date.now(),c=this.targetCenter_.slice(),u=this.targetResolution_,h=this.targetRotation_;const f=[];for(;o<i;++o){const g=arguments[o],H={start:l,complete:!1,anchor:g.anchor,duration:g.duration!==void 0?g.duration:1e3,easing:g.easing||inAndOut,callback:n};if(g.center&&(H.sourceCenter=c,H.targetCenter=g.center.slice(),c=H.targetCenter),g.zoom!==void 0?(H.sourceResolution=u,H.targetResolution=this.getResolutionForZoom(g.zoom),u=H.targetResolution):g.resolution&&(H.sourceResolution=u,H.targetResolution=g.resolution,u=H.targetResolution),g.rotation!==void 0){H.sourceRotation=h;const Y=modulo(g.rotation-h+Math.PI,2*Math.PI)-Math.PI;H.targetRotation=h+Y,h=H.targetRotation}isNoopAnimation(H)?H.complete=!0:l+=H.duration,f.push(H)}this.animations_.push(f),this.setHint(ViewHint.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ViewHint.ANIMATING]>0}getInteracting(){return this.hints_[ViewHint.INTERACTING]>0}cancelAnimations(){this.setHint(ViewHint.ANIMATING,-this.hints_[ViewHint.ANIMATING]);let e;for(let i=0,n=this.animations_.length;i<n;++i){const o=this.animations_[i];if(o[0].callback&&animationCallback(o[0].callback,!1),!e)for(let l=0,c=o.length;l<c;++l){const u=o[l];if(!u.complete){e=u.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let i=!1;for(let n=this.animations_.length-1;n>=0;--n){const o=this.animations_[n];let l=!0;for(let c=0,u=o.length;c<u;++c){const h=o[c];if(h.complete)continue;const f=e-h.start;let g=h.duration>0?f/h.duration:1;g>=1?(h.complete=!0,g=1):l=!1;const H=h.easing(g);if(h.sourceCenter){const Y=h.sourceCenter[0],ee=h.sourceCenter[1],te=h.targetCenter[0],xe=h.targetCenter[1];this.nextCenter_=h.targetCenter;const ne=Y+H*(te-Y),et=ee+H*(xe-ee);this.targetCenter_=[ne,et]}if(h.sourceResolution&&h.targetResolution){const Y=H===1?h.targetResolution:h.sourceResolution+H*(h.targetResolution-h.sourceResolution);if(h.anchor){const ee=this.getViewportSize_(this.getRotation()),te=this.constraints_.resolution(Y,0,ee,!0);this.targetCenter_=this.calculateCenterZoom(te,h.anchor)}this.nextResolution_=h.targetResolution,this.targetResolution_=Y,this.applyTargetState_(!0)}if(h.sourceRotation!==void 0&&h.targetRotation!==void 0){const Y=H===1?modulo(h.targetRotation+Math.PI,2*Math.PI)-Math.PI:h.sourceRotation+H*(h.targetRotation-h.sourceRotation);if(h.anchor){const ee=this.constraints_.rotation(Y,!0);this.targetCenter_=this.calculateCenterRotate(ee,h.anchor)}this.nextRotation_=h.targetRotation,this.targetRotation_=Y}if(this.applyTargetState_(!0),i=!0,!h.complete)break}if(l){this.animations_[n]=null,this.setHint(ViewHint.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const c=o[0].callback;c&&animationCallback(c,!0)}}this.animations_=this.animations_.filter(Boolean),i&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,i){let n;const o=this.getCenterInternal();return o!==void 0&&(n=[o[0]-i[0],o[1]-i[1]],rotate$1(n,e-this.getRotation()),add$1(n,i)),n}calculateCenterZoom(e,i){let n;const o=this.getCenterInternal(),l=this.getResolution();if(o!==void 0&&l!==void 0){const c=i[0]-e*(i[0]-o[0])/l,u=i[1]-e*(i[1]-o[1])/l;n=[c,u]}return n}getViewportSize_(e){const i=this.viewportSize_;if(e){const n=i[0],o=i[1];return[Math.abs(n*Math.cos(e))+Math.abs(o*Math.sin(e)),Math.abs(n*Math.sin(e))+Math.abs(o*Math.cos(e))]}return i}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&toUserCoordinate(e,this.getProjection())}getCenterInternal(){return this.get(ViewProperty.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const i=this.calculateExtentInternal(e);return toUserExtent(i,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const i=this.getCenterInternal();assert(i,"The view center is not defined");const n=this.getResolution();assert(n!==void 0,"The view resolution is not defined");const o=this.getRotation();return assert(o!==void 0,"The view rotation is not defined"),getForViewAndSize(i,n,o,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(ViewProperty.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,i){return this.getResolutionForExtentInternal(fromUserExtent(e,this.getProjection()),i)}getResolutionForExtentInternal(e,i){i=i||this.getViewportSizeMinusPadding_();const n=getWidth(e)/i[0],o=getHeight(e)/i[1];return Math.max(n,o)}getResolutionForValueFunction(e){e=e||2;const i=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,o=Math.log(i/n)/Math.log(e);return(function(l){return i/Math.pow(e,l*o)})}getRotation(){return this.get(ViewProperty.ROTATION)}getValueForResolutionFunction(e){const i=Math.log(e||2),n=this.getConstrainedResolution(this.maxResolution_),o=this.minResolution_,l=Math.log(n/o)/i;return(function(c){return Math.log(n/c)/i/l})}getViewportSizeMinusPadding_(e){let i=this.getViewportSize_(e);const n=this.padding_;return n&&(i=[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]),i}getState(){const e=this.getProjection(),i=this.getResolution(),n=this.getRotation();let o=this.getCenterInternal();const l=this.padding_;if(l){const c=this.getViewportSizeMinusPadding_();o=calculateCenterOn(o,this.getViewportSize_(),[c[0]/2+l[3],c[1]/2+l[0]],i,n)}return{center:o.slice(0),projection:e!==void 0?e:null,resolution:i,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const i=this.getResolution();return i!==void 0&&(e=this.getZoomForResolution(i)),e}getZoomForResolution(e){let i=this.minZoom_||0,n,o;if(this.resolutions_){const l=linearFindNearest(this.resolutions_,e,1);i=l,n=this.resolutions_[l],l==this.resolutions_.length-1?o=2:o=n/this.resolutions_[l+1]}else n=this.maxResolution_,o=this.zoomFactor_;return i+Math.log(n/e)/Math.log(o)}getResolutionForZoom(e){var i;if((i=this.resolutions_)!=null&&i.length){if(this.resolutions_.length===1)return this.resolutions_[0];const n=clamp$1(Math.floor(e),0,this.resolutions_.length-2),o=this.resolutions_[n]/this.resolutions_[n+1];return this.resolutions_[n]/Math.pow(o,clamp$1(e-n,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,i){let n;if(assert(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){assert(!isEmpty$1(e),"Cannot fit empty extent provided as `geometry`");const o=fromUserExtent(e,this.getProjection());n=fromExtent(o)}else if(e.getType()==="Circle"){const o=fromUserExtent(e.getExtent(),this.getProjection());n=fromExtent(o),n.rotate(this.getRotation(),getCenter(o))}else n=e;this.fitInternal(n,i)}rotatedExtentForGeometry(e){const i=this.getRotation(),n=Math.cos(i),o=Math.sin(-i),l=e.getFlatCoordinates(),c=e.getStride();let u=1/0,h=1/0,f=-1/0,g=-1/0;for(let H=0,Y=l.length;H<Y;H+=c){const ee=l[H]*n-l[H+1]*o,te=l[H]*o+l[H+1]*n;u=Math.min(u,ee),h=Math.min(h,te),f=Math.max(f,ee),g=Math.max(g,te)}return[u,h,f,g]}fitInternal(e,i){i=i||{};let n=i.size;n||(n=this.getViewportSizeMinusPadding_());const o=i.padding!==void 0?i.padding:[0,0,0,0],l=i.nearest!==void 0?i.nearest:!1;let c;i.minResolution!==void 0?c=i.minResolution:i.maxZoom!==void 0?c=this.getResolutionForZoom(i.maxZoom):c=0;const u=this.rotatedExtentForGeometry(e);let h=this.getResolutionForExtentInternal(u,[n[0]-o[1]-o[3],n[1]-o[0]-o[2]]);h=isNaN(h)?c:Math.max(h,c),h=this.getConstrainedResolution(h,l?0:1);const f=this.getRotation(),g=Math.sin(f),H=Math.cos(f),Y=getCenter(u);Y[0]+=(o[1]-o[3])/2*h,Y[1]+=(o[0]-o[2])/2*h;const ee=Y[0]*H-Y[1]*g,te=Y[1]*H+Y[0]*g,xe=this.getConstrainedCenter([ee,te],h),ne=i.callback?i.callback:VOID;i.duration!==void 0?this.animateInternal({resolution:h,center:xe,duration:i.duration,easing:i.easing},ne):(this.targetResolution_=h,this.targetCenter_=xe,this.applyTargetState_(!1,!0),animationCallback(ne,!0))}centerOn(e,i,n){this.centerOnInternal(fromUserCoordinate(e,this.getProjection()),i,n)}centerOnInternal(e,i,n){this.setCenterInternal(calculateCenterOn(e,i,n,this.getResolution(),this.getRotation()))}calculateCenterShift(e,i,n,o){let l;const c=this.padding_;if(c&&e){const u=this.getViewportSizeMinusPadding_(-n),h=calculateCenterOn(e,o,[u[0]/2+c[3],u[1]/2+c[0]],i,n);l=[e[0]-h[0],e[1]-h[1]]}return l}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const i=toUserCoordinate(this.targetCenter_,this.getProjection());this.setCenter([i[0]+e[0],i[1]+e[1]])}adjustCenterInternal(e){const i=this.targetCenter_;this.setCenterInternal([i[0]+e[0],i[1]+e[1]])}adjustResolution(e,i){i=i&&fromUserCoordinate(i,this.getProjection()),this.adjustResolutionInternal(e,i)}adjustResolutionInternal(e,i){const n=this.getAnimating()||this.getInteracting(),o=this.getViewportSize_(this.getRotation()),l=this.constraints_.resolution(this.targetResolution_*e,0,o,n);i&&(this.targetCenter_=this.calculateCenterZoom(l,i)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,i){this.adjustResolution(Math.pow(this.zoomFactor_,-e),i)}adjustRotation(e,i){i&&(i=fromUserCoordinate(i,this.getProjection())),this.adjustRotationInternal(e,i)}adjustRotationInternal(e,i){const n=this.getAnimating()||this.getInteracting(),o=this.constraints_.rotation(this.targetRotation_+e,n);i&&(this.targetCenter_=this.calculateCenterRotate(o,i)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&fromUserCoordinate(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,i){return this.hints_[e]+=i,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,i){const n=this.getAnimating()||this.getInteracting()||i,o=this.constraints_.rotation(this.targetRotation_,n),l=this.getViewportSize_(o),c=this.constraints_.resolution(this.targetResolution_,0,l,n),u=this.constraints_.center(this.targetCenter_,c,l,n,this.calculateCenterShift(this.targetCenter_,c,o,l));this.get(ViewProperty.ROTATION)!==o&&this.set(ViewProperty.ROTATION,o),this.get(ViewProperty.RESOLUTION)!==c&&(this.set(ViewProperty.RESOLUTION,c),this.set("zoom",this.getZoom(),!0)),(!u||!this.get(ViewProperty.CENTER)||!equals$2(this.get(ViewProperty.CENTER),u))&&this.set(ViewProperty.CENTER,u),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,i,n){e=e!==void 0?e:200;const o=i||0,l=this.constraints_.rotation(this.targetRotation_),c=this.getViewportSize_(l),u=this.constraints_.resolution(this.targetResolution_,o,c),h=this.constraints_.center(this.targetCenter_,u,c,!1,this.calculateCenterShift(this.targetCenter_,u,l,c));if(e===0&&!this.cancelAnchor_){this.targetResolution_=u,this.targetRotation_=l,this.targetCenter_=h,this.applyTargetState_();return}n=n||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==u||this.getRotation()!==l||!this.getCenterInternal()||!equals$2(this.getCenterInternal(),h))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:l,center:h,resolution:u,duration:e,easing:easeOut,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ViewHint.INTERACTING,1)}endInteraction(e,i,n){n=n&&fromUserCoordinate(n,this.getProjection()),this.endInteractionInternal(e,i,n)}endInteractionInternal(e,i,n){this.getInteracting()&&(this.setHint(ViewHint.INTERACTING,-1),this.resolveConstraints(e,i,n))}getConstrainedCenter(e,i){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,i||this.getResolution(),n)}getConstrainedZoom(e,i){const n=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(n,i))}getConstrainedResolution(e,i){i=i||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,i,n)}}function animationCallback(s,e){setTimeout(function(){s(e)},0)}function createCenterConstraint(s){if(s.extent!==void 0){const i=s.smoothExtentConstraint!==void 0?s.smoothExtentConstraint:!0;return createExtent(s.extent,s.constrainOnlyCenter,i)}const e=createProjection(s.projection,"EPSG:3857");if(s.multiWorld!==!0&&e.isGlobal()){const i=e.getExtent().slice();return i[0]=-1/0,i[2]=1/0,createExtent(i,!1,!1)}return none}function createResolutionConstraint(s){let e,i,n,c=s.minZoom!==void 0?s.minZoom:DEFAULT_MIN_ZOOM,u=s.maxZoom!==void 0?s.maxZoom:28;const h=s.zoomFactor!==void 0?s.zoomFactor:2,f=s.multiWorld!==void 0?s.multiWorld:!1,g=s.smoothResolutionConstraint!==void 0?s.smoothResolutionConstraint:!0,H=s.showFullExtent!==void 0?s.showFullExtent:!1,Y=createProjection(s.projection,"EPSG:3857"),ee=Y.getExtent();let te=s.constrainOnlyCenter,xe=s.extent;if(!f&&!xe&&Y.isGlobal()&&(te=!1,xe=ee),s.resolutions!==void 0){const ne=s.resolutions;i=ne[c],n=ne[u]!==void 0?ne[u]:ne[ne.length-1],s.constrainResolution?e=createSnapToResolutions(ne,g,!te&&xe,H):e=createMinMaxResolution(i,n,g,!te&&xe,H)}else{const et=(ee?Math.max(getWidth(ee),getHeight(ee)):360*METERS_PER_UNIT.degrees/Y.getMetersPerUnit())/DEFAULT_TILE_SIZE/Math.pow(2,DEFAULT_MIN_ZOOM),tt=et/Math.pow(2,28-DEFAULT_MIN_ZOOM);i=s.maxResolution,i!==void 0?c=0:i=et/Math.pow(h,c),n=s.minResolution,n===void 0&&(s.maxZoom!==void 0?s.maxResolution!==void 0?n=i/Math.pow(h,u):n=et/Math.pow(h,u):n=tt),u=c+Math.floor(Math.log(i/n)/Math.log(h)),n=i/Math.pow(h,u-c),s.constrainResolution?e=createSnapToPower(h,i,n,g,!te&&xe,H):e=createMinMaxResolution(i,n,g,!te&&xe,H)}return{constraint:e,maxResolution:i,minResolution:n,minZoom:c,zoomFactor:h}}function createRotationConstraint(s){if(s.enableRotation!==void 0?s.enableRotation:!0){const i=s.constrainRotation;return i===void 0||i===!0?createSnapToZero():i===!1?none$1:typeof i=="number"?createSnapToN(i):none$1}return disable}function isNoopAnimation(s){return!(s.sourceCenter&&s.targetCenter&&!equals$2(s.sourceCenter,s.targetCenter)||s.sourceResolution!==s.targetResolution||s.sourceRotation!==s.targetRotation)}function calculateCenterOn(s,e,i,n,o){const l=Math.cos(-o);let c=Math.sin(-o),u=s[0]*l-s[1]*c,h=s[1]*l+s[0]*c;u+=(e[0]/2-i[0])*n,h+=(i[1]-e[1]/2)*n,c=-c;const f=u*l-h*c,g=h*l+u*c;return[f,g]}const LayerProperty={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class BaseLayer extends BaseObject{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const i=Object.assign({},e);typeof e.properties=="object"&&(delete i.properties,Object.assign(i,e.properties)),i[LayerProperty.OPACITY]=e.opacity!==void 0?e.opacity:1,assert(typeof i[LayerProperty.OPACITY]=="number","Layer opacity must be a number"),i[LayerProperty.VISIBLE]=e.visible!==void 0?e.visible:!0,i[LayerProperty.Z_INDEX]=e.zIndex,i[LayerProperty.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,i[LayerProperty.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,i[LayerProperty.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,i[LayerProperty.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=i.className!==void 0?i.className:"ol-layer",delete i.className,this.setProperties(i),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const i=this.state_||{layer:this,managed:e===void 0?!0:e},n=this.getZIndex();return i.opacity=clamp$1(Math.round(this.getOpacity()*100)/100,0,1),i.visible=this.getVisible(),i.extent=this.getExtent(),i.zIndex=n===void 0&&!i.managed?1/0:n,i.maxResolution=this.getMaxResolution(),i.minResolution=Math.max(this.getMinResolution(),0),i.minZoom=this.getMinZoom(),i.maxZoom=this.getMaxZoom(),this.state_=i,i}getLayersArray(e){return abstract()}getLayerStatesArray(e){return abstract()}getExtent(){return this.get(LayerProperty.EXTENT)}getMaxResolution(){return this.get(LayerProperty.MAX_RESOLUTION)}getMinResolution(){return this.get(LayerProperty.MIN_RESOLUTION)}getMinZoom(){return this.get(LayerProperty.MIN_ZOOM)}getMaxZoom(){return this.get(LayerProperty.MAX_ZOOM)}getOpacity(){return this.get(LayerProperty.OPACITY)}getSourceState(){return abstract()}getVisible(){return this.get(LayerProperty.VISIBLE)}getZIndex(){return this.get(LayerProperty.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(LayerProperty.EXTENT,e)}setMaxResolution(e){this.set(LayerProperty.MAX_RESOLUTION,e)}setMinResolution(e){this.set(LayerProperty.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(LayerProperty.MAX_ZOOM,e)}setMinZoom(e){this.set(LayerProperty.MIN_ZOOM,e)}setOpacity(e){assert(typeof e=="number","Layer opacity must be a number"),this.set(LayerProperty.OPACITY,e)}setVisible(e){this.set(LayerProperty.VISIBLE,e)}setZIndex(e){this.set(LayerProperty.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}let Layer$1=class extends BaseLayer{constructor(e){const i=Object.assign({},e);delete i.source,super(i),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(LayerProperty.SOURCE,this.handleSourcePropertyChange_);const n=e.source?e.source:null;this.setSource(n)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(LayerProperty.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(unlistenByKey(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=listen(e,EventType.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let i;const n=this.getMapInternal();!e&&n&&(e=n.getView()),e instanceof View?i={viewState:e.getState(),extent:e.calculateExtent()}:i=e,!i.layerStatesArray&&n&&(i.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let o;if(i.layerStatesArray){if(o=i.layerStatesArray.find(c=>c.layer===this),!o)return!1}else o=this.getLayerState();const l=this.getExtent();return inView(o,i.viewState)&&(!l||intersects$1(l,i.extent))}getAttributions(e){var l;if(!this.isVisible(e))return[];const i=(l=this.getSource())==null?void 0:l.getAttributions();if(!i)return[];const n=e instanceof View?e.getViewStateAndExtent():e;let o=i(n);return Array.isArray(o)||(o=[o]),o}render(e,i){const n=this.getRenderer();return n.prepareFrame(e)?(this.rendered=!0,n.renderFrame(e,i)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,i){}renderDeferred(e){const i=this.getRenderer();i&&i.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(LayerProperty.MAP,e)}getMapInternal(){return this.get(LayerProperty.MAP)}setMap(e){this.mapPrecomposeKey_&&(unlistenByKey(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(unlistenByKey(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=listen(e,RenderEventType.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=listen(this,EventType.CHANGE,e.render,e),this.changed())}handlePrecompose_(e){const i=e.frameState.layerStatesArray,n=this.getLayerState(!1);assert(!i.some(o=>o.layer===n.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),i.push(n)}setSource(e){this.set(LayerProperty.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}};function inView(s,e){if(!s.visible)return!1;const i=e.resolution;if(i<s.minResolution||i>=s.maxResolution)return!1;const n=e.zoom;return n>s.minZoom&&n<=s.maxZoom}const Property$2={RENDER_ORDER:"renderOrder"};class BaseVectorLayer extends Layer$1{constructor(e){e=e||{};const i=Object.assign({},e);delete i.style,delete i.renderBuffer,delete i.updateWhileAnimating,delete i.updateWhileInteracting,super(i),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Property$2.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,i){const n=this.getDeclutter();n in e.declutter||(e.declutter[n]=new RBush$1(9)),this.getRenderer().renderDeclutter(e,i)}setRenderOrder(e){this.set(Property$2.RENDER_ORDER,e)}setStyle(e){this.style_=e===void 0?createDefaultStyle:e;const i=toStyleLike(e);this.styleFunction_=e===null?void 0:toFunction(i),this.changed()}setDeclutter(e){this.declutter_=e?String(e):void 0,this.changed()}}function toStyleLike(s){if(s===void 0)return createDefaultStyle;if(!s)return null;if(typeof s=="function"||s instanceof Style$1)return s;if(!Array.isArray(s))return flatStylesToStyleFunction([s]);if(s.length===0)return[];const e=s.length,i=s[0];if(i instanceof Style$1){const o=new Array(e);for(let l=0;l<e;++l){const c=s[l];if(!(c instanceof Style$1))throw new Error("Expected a list of style instances");o[l]=c}return o}if("style"in i){const o=new Array(e);for(let l=0;l<e;++l){const c=s[l];if(!("style"in c))throw new Error("Expected a list of rules with a style property");o[l]=c}return rulesToStyleFunction(o)}return flatStylesToStyleFunction(s)}class VectorLayer extends BaseVectorLayer{constructor(e){super(e)}createRenderer(){return new CanvasVectorLayerRenderer(this)}}function getCoordinate(s,e){const i=s.length;return e<0?s[e+i]:e>=i?s[e-i]:s[e]}function interpolateCoordinate(s,e){const i=s.length;let n=Math.floor(e);const o=e-n;n>=i?n-=i:n<0&&(n+=i);let l=n+1;l>=i&&(l-=i);const c=s[n],u=c[0],h=c[1],f=s[l],g=f[0]-u,H=f[1]-h;return[u+g*o,h+H*o]}const sharedUpdateInfo={index:-1,endIndex:NaN,closestTargetDistance:1/0};function getTraceTargetUpdate(s,e,i,n){const o=s[0],l=s[1];let c=1/0,u=-1,h=NaN;for(let H=0;H<e.targets.length;++H){const Y=e.targets[H],ee=Y.coordinates;let te=1/0,xe;for(let ne=0;ne<ee.length-1;++ne){const et=ee[ne],tt=ee[ne+1],it=getPointSegmentRelationship(o,l,et,tt);it.squaredDistance<te&&(te=it.squaredDistance,xe=ne+it.along)}te<c&&(c=te,Y.ring&&e.targetIndex===H&&(Y.endIndex>Y.startIndex?xe<Y.startIndex&&(xe+=ee.length):Y.endIndex<Y.startIndex&&xe>Y.startIndex&&(xe-=ee.length)),h=xe,u=H)}const f=e.targets[u];let g=f.ring;if(e.targetIndex===u&&g){const H=interpolateCoordinate(f.coordinates,h),Y=i.getPixelFromCoordinate(H),ee=i.getPixelFromCoordinate(e.startCoord);distance(Y,ee)>n&&(g=!1)}if(g){const H=f.coordinates,Y=H.length,ee=f.startIndex,te=h;if(ee<te){const xe=getCumulativeSquaredDistance(H,ee,te);getCumulativeSquaredDistance(H,ee,te-Y)<xe&&(h-=Y)}else{const xe=getCumulativeSquaredDistance(H,ee,te);getCumulativeSquaredDistance(H,ee,te+Y)<xe&&(h+=Y)}}return sharedUpdateInfo.index=u,sharedUpdateInfo.endIndex=h,sharedUpdateInfo.closestTargetDistance=c,sharedUpdateInfo}function getTraceTargets(s,e){const i=[];for(let n=0;n<e.length;++n){const l=e[n].getGeometry();appendGeometryTraceTargets(s,l,i)}return i}function appendGeometryTraceTargets(s,e,i){if(e instanceof LineString){appendTraceTarget(s,e.getCoordinates(),!1,i);return}if(e instanceof MultiLineString){const n=e.getCoordinates();for(let o=0,l=n.length;o<l;++o)appendTraceTarget(s,n[o],!1,i);return}if(e instanceof Polygon){const n=e.getCoordinates();for(let o=0,l=n.length;o<l;++o)appendTraceTarget(s,n[o],!0,i);return}if(e instanceof MultiPolygon){const n=e.getCoordinates();for(let o=0,l=n.length;o<l;++o){const c=n[o];for(let u=0,h=c.length;u<h;++u)appendTraceTarget(s,c[u],!0,i)}return}if(e instanceof GeometryCollection){const n=e.getGeometries();for(let o=0;o<n.length;++o)appendGeometryTraceTargets(s,n[o],i);return}}function appendTraceTarget(s,e,i,n){const o=s[0],l=s[1];for(let c=0,u=e.length-1;c<u;++c){const h=e[c],f=e[c+1],g=getPointSegmentRelationship(o,l,h,f);if(g.squaredDistance===0){const H=c+g.along;n.push({coordinates:e,ring:i,startIndex:H,endIndex:H});return}}}function getSquaredDistance(s,e){return squaredDistance(s[0],s[1],e[0],e[1])}function getCumulativeSquaredDistance(s,e,i){let n,o;e<i?(n=e,o=i):(n=i,o=e);const l=Math.ceil(n),c=Math.floor(o);if(l>c){const h=interpolateCoordinate(s,n),f=interpolateCoordinate(s,o);return getSquaredDistance(h,f)}let u=0;if(n<l){const h=interpolateCoordinate(s,n),f=getCoordinate(s,l);u+=getSquaredDistance(h,f)}if(c<o){const h=getCoordinate(s,c),f=interpolateCoordinate(s,o);u+=getSquaredDistance(h,f)}for(let h=l;h<c-1;++h){const f=getCoordinate(s,h),g=getCoordinate(s,h+1);u+=getSquaredDistance(f,g)}return u}const sharedRel={along:0,squaredDistance:0};function getPointSegmentRelationship(s,e,i,n){const o=i[0],l=i[1],c=n[0],u=n[1],h=c-o,f=u-l;let g=0,H=o,Y=l;return(h!==0||f!==0)&&(g=clamp$1(((s-o)*h+(e-l)*f)/(h*h+f*f),0,1),H+=h*g,Y+=f*g),sharedRel.along=g,sharedRel.squaredDistance=toFixed(squaredDistance(s,e,H,Y),10),sharedRel}const DrawEventType={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class DrawEvent extends BaseEvent{constructor(e,i){super(e),this.feature=i}}class Draw extends PointerInteraction{constructor(e){const i=e;i.stopDown||(i.stopDown=FALSE),super(i),this.on,this.once,this.un,this.options_=e,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=getMode(this.type_),this.stopClick_=!!e.stopClick,this.ignoreNextUpEvent_=!1,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:TRUE,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let n=e.geometryFunction;if(!n){const o=this.mode_;if(o==="Circle")n=(l,c,u)=>{const h=c||new Circle([NaN,NaN]),f=fromUserCoordinate(l[0]),g=squaredDistance$1(f,fromUserCoordinate(l[l.length-1]));return h.setCenterAndRadius(f,Math.sqrt(g),this.geometryLayout_),h};else{let l;o==="Point"?l=Point$1:o==="LineString"?l=LineString:o==="Polygon"&&(l=Polygon),n=(c,u,h)=>(u?o==="Polygon"?c[0].length?u.setCoordinates([c[0].concat([c[0][0]])],this.geometryLayout_):u.setCoordinates([],this.geometryLayout_):u.setCoordinates(c,this.geometryLayout_):u=new l(c,this.geometryLayout_),u)}}this.geometryFunction_=n,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:getDefaultStyleFunction$2(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:noModifierKeys,this.freehandCondition_,e.freehand?this.freehandCondition_=always$1:this.freehandCondition_=e.freehandCondition?e.freehandCondition:shiftKeyOnly,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(InteractionProperty.ACTIVE,this.updateState_)}setTrace(e){let i;e?e===!0?i=always$1:i=e:i=never,this.traceCondition_=i}setMap(e){super.setMap(e),this.updateState_()}setFreehand(e){this.freehand_=e,this.freehand_?this.freehandCondition_=always$1:this.freehandCondition_=this.options_&&this.options_.freehandCondition?this.options_.freehandCondition:shiftKeyOnly}getOverlay(){return this.overlay_}getFreehand(){return this.freehand_}handleEvent(e){e.originalEvent.type===EventType.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let i=e.type===MapBrowserEventType.POINTERMOVE,n=!0;return!this.freehand_&&this.lastDragTime_&&e.type===MapBrowserEventType.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,i=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===MapBrowserEventType.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),n=!1):this.freehand_&&e.type===MapBrowserEventType.POINTERDOWN?n=!1:i&&this.getPointerCount()<2?(n=e.type===MapBrowserEventType.POINTERMOVE,n&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===MapBrowserEventType.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===MapBrowserEventType.DBLCLICK&&(n=!1),super.handleEvent(e)&&n}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new MapBrowserEvent(MapBrowserEventType.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const i=this.getMap(),n=i.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),o=i.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),l=boundingExtent([n,o]),c=this.traceSource_.getFeaturesInExtent(l);if(c.length===0)return;const u=getTraceTargets(e.coordinate,c);u.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:u,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,i){const n=e.startIndex<=e.endIndex,o=e.startIndex<=i;n===o?n&&i>e.endIndex||!n&&i<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,i):(n&&i<e.endIndex||!n&&i>e.endIndex)&&this.removeTracedCoordinates_(i,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,i))}removeTracedCoordinates_(e,i){if(e===i)return;let n=0;if(e<i){const o=Math.ceil(e);let l=Math.floor(i);l===i&&(l-=1),n=l-o+1}else{const o=Math.floor(e);let l=Math.ceil(i);l===i&&(l+=1),n=o-l+1}n>0&&this.removeLastPoints_(n)}addTracedCoordinates_(e,i,n){if(i===n)return;const o=[];if(i<n){const l=Math.ceil(i);let c=Math.floor(n);c===n&&(c-=1);for(let u=l;u<=c;++u)o.push(getCoordinate(e.coordinates,u))}else{const l=Math.floor(i);let c=Math.ceil(n);c===n&&(c+=1);for(let u=l;u>=c;--u)o.push(getCoordinate(e.coordinates,u))}o.length&&this.appendCoordinates(o)}updateTrace_(e){const i=this.traceState_;if(!i.active)return;if(i.targetIndex===-1){const u=e.map.getPixelFromCoordinate(i.startCoord);if(distance(u,e.pixel)<this.snapTolerance_)return}const n=getTraceTargetUpdate(e.coordinate,i,this.getMap(),this.snapTolerance_);if(i.targetIndex!==n.index){if(i.targetIndex!==-1){const h=i.targets[i.targetIndex];this.removeTracedCoordinates_(h.startIndex,h.endIndex)}const u=i.targets[n.index];this.addTracedCoordinates_(u,u.startIndex,n.endIndex)}else{const u=i.targets[i.targetIndex];this.addOrRemoveTracedCoordinates_(u,n.endIndex)}i.targetIndex=n.index;const o=i.targets[i.targetIndex];o.endIndex=n.endIndex;const l=interpolateCoordinate(o.coordinates,o.endIndex),c=this.getMap().getPixelFromCoordinate(l);e.coordinate=l,e.pixel=[Math.round(c[0]),Math.round(c[1])]}handleDragEvent(e){this.ignoreNextUpEvent_=!0,super.handleDragEvent(e)}handleUpEvent(e){let i=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const n=this.traceState_.active;if(this.ignoreNextUpEvent_||this.toggleTraceState_(e),this.shouldHandle_){const o=!this.finishCoordinate_;o&&this.startDrawing_(e.coordinate),!o&&this.freehand_?this.finishDrawing():!this.freehand_&&(!o||this.mode_==="Point")&&(this.atFinish_(e.pixel,n)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),i=!1}else this.freehand_&&this.abortDrawing()}return this.ignoreNextUpEvent_=!1,!i&&this.stopClick_&&e.preventDefault(),i}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const i=this.downPx_,n=e.pixel,o=i[0]-n[0],l=i[1]-n[1],c=o*o+l*l;if(this.shouldHandle_=this.freehand_?c>this.squaredClickTolerance_:c<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,i){let n=!1;if(this.sketchFeature_){let o=!1,l=[this.finishCoordinate_];const c=this.mode_;if(c==="Point")n=!0;else if(c==="Circle")n=this.sketchCoords_.length===2;else if(c==="LineString")o=!i&&this.sketchCoords_.length>this.minPoints_;else if(c==="Polygon"){const u=this.sketchCoords_;o=u[0].length>this.minPoints_,l=[u[0][0],u[0][u[0].length-2]],i?l=[u[0][0]]:l=[u[0][0],u[0][u[0].length-2]]}if(o){const u=this.getMap();for(let h=0,f=l.length;h<f;h++){const g=l[h],H=u.getPixelFromCoordinate(g),Y=e[0]-H[0],ee=e[1]-H[1],te=this.freehand_?1:this.snapTolerance_;if(n=Math.sqrt(Y*Y+ee*ee)<=te,n){this.finishCoordinate_=g;break}}}}return n}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new Feature(new Point$1(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new Feature);const i=e.getLinearRing(0);let n=this.sketchLine_.getGeometry();n?(n.setFlatCoordinates(i.getLayout(),i.getFlatCoordinates()),n.changed()):(n=new LineString(i.getFlatCoordinates(),i.getLayout()),this.sketchLine_.setGeometry(n))}startDrawing_(e){const i=this.getMap().getView().getProjection(),n=getStrideForLayout(this.geometryLayout_);for(;e.length<n;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Feature(new LineString(this.sketchLineCoords_)));const o=this.geometryFunction_(this.sketchCoords_,void 0,i);this.sketchFeature_=new Feature,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(o),this.updateSketchFeatures_(),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const i=this.getMap(),n=this.sketchFeature_.getGeometry(),o=i.getView().getProjection(),l=getStrideForLayout(this.geometryLayout_);let c,u;for(;e.length<l;)e.push(0);this.mode_==="Point"?u=this.sketchCoords_:this.mode_==="Polygon"?(c=this.sketchCoords_[0],u=c[c.length-1],this.atFinish_(i.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(c=this.sketchCoords_,u=c[c.length-1]),u[0]=e[0],u[1]=e[1],this.geometryFunction_(this.sketchCoords_,n,o),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),n.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(n):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const i=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection();let o,l;const c=this.mode_;return c==="LineString"||c==="Circle"?(this.finishCoordinate_=e.slice(),l=this.sketchCoords_,l.length>=this.maxPoints_&&(this.freehand_?l.pop():o=!0),l.push(e.slice()),this.geometryFunction_(l,i,n)):c==="Polygon"&&(l=this.sketchCoords_[0],l.length>=this.maxPoints_&&(this.freehand_?l.pop():o=!0),l.push(e.slice()),o&&(this.finishCoordinate_=l[0]),this.geometryFunction_(this.sketchCoords_,i,n)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),o?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const i=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection(),o=this.mode_;for(let l=0;l<e;++l){let c;if(o==="LineString"||o==="Circle"){if(c=this.sketchCoords_,c.splice(-2,1),c.length>=2){this.finishCoordinate_=c[c.length-2].slice();const u=this.finishCoordinate_.slice();c[c.length-1]=u,this.createOrUpdateSketchPoint_(u)}this.geometryFunction_(c,i,n),i.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(i)}else if(o==="Polygon"){c=this.sketchCoords_[0],c.splice(-2,1);const u=this.sketchLine_.getGeometry();if(c.length>=2){const h=c[c.length-2].slice();c[c.length-1]=h,this.createOrUpdateSketchPoint_(h)}u.setCoordinates(c),this.geometryFunction_(this.sketchCoords_,i,n)}if(c.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let i=this.sketchCoords_;const n=e.getGeometry(),o=this.getMap().getView().getProjection();return this.mode_==="LineString"?(i.pop(),this.geometryFunction_(i,n,o)):this.mode_==="Polygon"&&(i[0].pop(),this.geometryFunction_(i,n,o),i=n.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new MultiPoint([i])):this.type_==="MultiLineString"?e.setGeometry(new MultiLineString([i])):this.type_==="MultiPolygon"&&e.setGeometry(new MultiPolygon([i])),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new DrawEvent(DrawEventType.DRAWABORT,e))}appendCoordinates(e){const i=this.mode_,n=!this.sketchFeature_;n&&this.startDrawing_(e[0]);let o;if(i==="LineString"||i==="Circle")o=this.sketchCoords_;else if(i==="Polygon")o=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;n&&o.shift(),o.pop();for(let c=0;c<e.length;c++)this.addToDrawing_(e[c]);const l=e[e.length-1];this.sketchFeature_=this.addToDrawing_(l),this.modifyDrawing_(l)}extend(e){const n=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=n.getCoordinates();const o=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=o.slice(),this.sketchCoords_.push(o.slice()),this.sketchPoint_=new Feature(new Point$1(o)),this.updateSketchFeatures_(),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const i=this.overlay_.getSource();i.clear(!0),i.addFeatures(e)}updateState_(){const e=this.getMap(),i=this.getActive();(!e||!i)&&this.abortDrawing(),this.overlay_.setMap(i?e:null)}}function getDefaultStyleFunction$2(){const s=createEditingStyle();return function(e,i){return s[e.getGeometry().getType()]}}function getMode(s){switch(s){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+s)}}const Key={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class KeyboardPan extends Interaction{constructor(e){super(),e=e||{},this.defaultCondition_=function(i){return noModifierKeys(i)&&targetNotEditable(i)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let i=!1;if(e.type==EventType.KEYDOWN){const n=e.originalEvent,o=n.key;if(this.condition_(e)&&(o==Key.DOWN||o==Key.LEFT||o==Key.RIGHT||o==Key.UP)){const c=e.map.getView(),u=c.getResolution()*this.pixelDelta_;let h=0,f=0;o==Key.DOWN?f=-u:o==Key.LEFT?h=-u:o==Key.RIGHT?h=u:f=u;const g=[h,f];rotate$1(g,c.getRotation()),pan(c,g,this.duration_),n.preventDefault(),i=!0}}return!i}}class KeyboardZoom extends Interaction{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(i){return!platformModifierKey(i)&&targetNotEditable(i)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let i=!1;if(e.type==EventType.KEYDOWN||e.type==EventType.KEYPRESS){const n=e.originalEvent,o=n.key;if(this.condition_(e)&&(o==="+"||o==="-")){const l=e.map,c=o==="+"?this.delta_:-this.delta_,u=l.getView();zoomByDelta(u,c,void 0,this.duration_),n.preventDefault(),i=!0}}return!i}}const CIRCLE_CENTER_INDEX=0,CIRCLE_CIRCUMFERENCE_INDEX=1,tempExtent=[0,0,0,0],tempSegment=[],ModifyEventType={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};function getCoordinatesArray(s,e,i){let n;switch(e){case"LineString":n=s;break;case"MultiLineString":case"Polygon":n=s[i[0]];break;case"MultiPolygon":n=s[i[1]][i[0]];break}return n}class ModifyEvent extends BaseEvent{constructor(e,i,n){super(e),this.features=i,this.mapBrowserEvent=n}}class Modify extends PointerInteraction{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:primaryAction,this.defaultDeleteCondition_=function(n){return altKeyOnly(n)&&singleClick(n)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:always$1,this.vertexFeature_=null,this.vertexSegments_=null,this.lastCoordinate_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new RBush,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:getDefaultStyleFunction$1(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.traceSource_=e.traceSource||e.source||null,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSegments_=null,this.hitDetection_=null;let i;if(e.features?i=e.features:e.source&&(this.source_=e.source,i=new Collection(this.source_.getFeatures()),this.source_.addEventListener(VectorEventType.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(VectorEventType.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!i)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=i,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(CollectionEventType.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(CollectionEventType.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}setTrace(e){let i;e?e===!0?i=always$1:i=e:i=never,this.traceCondition_=i}addFeature_(e){const i=e.getGeometry();if(i){const o=this.SEGMENT_WRITERS_[i.getType()];o&&o(e,i)}const n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastCoordinate_),e.addEventListener(EventType.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,i){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Collection;const n=this.featuresBeingModified_.getArray();for(let o=0,l=i.length;o<l;++o){const c=i[o].feature;c&&!n.includes(c)&&this.featuresBeingModified_.push(c)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(EventType.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const i=this.rBush_,n=[];i.forEach(function(o){e===o.feature&&n.push(o)});for(let o=n.length-1;o>=0;--o){const l=n[o];for(let c=this.dragSegments_.length-1;c>=0;--c)this.dragSegments_[c][0]===l&&this.dragSegments_.splice(c,1);i.remove(l)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const i=e.target;this.removeFeature_(i),this.addFeature_(i)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,i){const n=i.getCoordinates(),o={feature:e,geometry:i,segment:[n,n]};this.rBush_.insert(i.getExtent(),o)}writeMultiPointGeometry_(e,i){const n=i.getCoordinates();for(let o=0,l=n.length;o<l;++o){const c=n[o],u={feature:e,geometry:i,depth:[o],index:o,segment:[c,c]};this.rBush_.insert(i.getExtent(),u)}}writeLineStringGeometry_(e,i){const n=i.getCoordinates();for(let o=0,l=n.length-1;o<l;++o){const c=n.slice(o,o+2),u={feature:e,geometry:i,index:o,segment:c};this.rBush_.insert(boundingExtent(c),u)}}writeMultiLineStringGeometry_(e,i){const n=i.getCoordinates();for(let o=0,l=n.length;o<l;++o){const c=n[o];for(let u=0,h=c.length-1;u<h;++u){const f=c.slice(u,u+2),g={feature:e,geometry:i,depth:[o],index:u,segment:f};this.rBush_.insert(boundingExtent(f),g)}}}writePolygonGeometry_(e,i){const n=i.getCoordinates();for(let o=0,l=n.length;o<l;++o){const c=n[o];for(let u=0,h=c.length-1;u<h;++u){const f=c.slice(u,u+2),g={feature:e,geometry:i,depth:[o],index:u,segment:f};this.rBush_.insert(boundingExtent(f),g)}}}writeMultiPolygonGeometry_(e,i){const n=i.getCoordinates();for(let o=0,l=n.length;o<l;++o){const c=n[o];for(let u=0,h=c.length;u<h;++u){const f=c[u];for(let g=0,H=f.length-1;g<H;++g){const Y=f.slice(g,g+2),ee={feature:e,geometry:i,depth:[u,o],index:g,segment:Y};this.rBush_.insert(boundingExtent(Y),ee)}}}}writeCircleGeometry_(e,i){const n=i.getCenter(),o={feature:e,geometry:i,index:CIRCLE_CENTER_INDEX,segment:[n,n]},l={feature:e,geometry:i,index:CIRCLE_CIRCUMFERENCE_INDEX,segment:[n,n]},c=[o,l];o.featureSegments=c,l.featureSegments=c,this.rBush_.insert(createOrUpdateFromCoordinate(n),o);let u=i;this.rBush_.insert(u.getExtent(),l)}writeGeometryCollectionGeometry_(e,i){const n=i.getGeometriesArray();for(let o=0;o<n.length;++o){const l=n[o],c=this.SEGMENT_WRITERS_[l.getType()];c(e,l)}}createOrUpdateVertexFeature_(e,i,n,o){let l=this.vertexFeature_;return l?l.getGeometry().setCoordinates(e):(l=new Feature(new Point$1(e)),this.vertexFeature_=l,this.overlay_.getSource().addFeature(l)),l.set("features",i),l.set("geometries",n),l.set("existing",o),l}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let i;return!e.map.getView().getInteracting()&&e.type==MapBrowserEventType.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=MapBrowserEventType.SINGLECLICK||!this.ignoreNextSingleClick_?i=this.removePoint():i=!0),e.type==MapBrowserEventType.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!i}findInsertVerticesAndUpdateDragSegments_(e){if(this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null,!this.vertexFeature_)return;this.getMap().getView().getProjection();const n=[],o=this.vertexFeature_.getGeometry().getCoordinates(),l=boundingExtent([o]),c=this.rBush_.getInExtent(l),u={};c.sort(compareIndexes);for(let h=0,f=c.length;h<f;++h){const g=c[h],H=g.segment;let Y=getUid(g.geometry);const ee=g.depth;if(ee&&(Y+="-"+ee.join("-")),u[Y]||(u[Y]=new Array(2)),g.geometry.getType()==="Circle"&&g.index===CIRCLE_CIRCUMFERENCE_INDEX){const te=closestOnSegmentData(e,g);equals$2(te,o)&&!u[Y][0]&&(this.dragSegments_.push([g,0]),u[Y][0]=g);continue}if(equals$2(H[0],o)&&!u[Y][0]){this.dragSegments_.push([g,0]),u[Y][0]=g;continue}if(equals$2(H[1],o)&&!u[Y][1]){if(u[Y][0]&&u[Y][0].index===0){let te=g.geometry.getCoordinates();switch(g.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":te=te[ee[1]];case"Polygon":if(g.index!==te[ee[0]].length-2)continue;break}}this.dragSegments_.push([g,1]),u[Y][1]=g;continue}getUid(H)in this.vertexSegments_&&!u[Y][0]&&!u[Y][1]&&n.push(g)}return n}deactivateTrace_(){this.traceState_={active:!1}}updateTrace_(e){const i=this.traceState_;if(!i.active)return;if(i.targetIndex===-1){const l=e.map.getPixelFromCoordinate(i.startCoord);if(distance(l,e.pixel)<this.pixelTolerance_)return}const n=getTraceTargetUpdate(e.coordinate,i,e.map,this.pixelTolerance_);if(i.targetIndex===-1&&Math.sqrt(n.closestTargetDistance)/e.map.getView().getResolution()>this.pixelTolerance_)return;if(i.targetIndex!==n.index){if(i.targetIndex!==-1){const c=i.targets[i.targetIndex];this.removeTracedCoordinates_(c.startIndex,c.endIndex)}else for(const c of this.traceSegments_){const u=c[0],h=u.geometry,f=c[1],g=h.getCoordinates();getCoordinatesArray(g,h.getType(),u.depth).splice(u.index+f,1),h.setCoordinates(g),f===0&&(u.index-=1)}const l=i.targets[n.index];this.addTracedCoordinates_(l,l.startIndex,n.endIndex)}else{const l=i.targets[i.targetIndex];this.addOrRemoveTracedCoordinates_(l,n.endIndex)}i.targetIndex=n.index;const o=i.targets[i.targetIndex];o.endIndex=n.endIndex}getTraceCandidates_(e){const i=this.getMap(),n=this.pixelTolerance_,o=i.getCoordinateFromPixel([e.pixel[0]-n,e.pixel[1]+n]),l=i.getCoordinateFromPixel([e.pixel[0]+n,e.pixel[1]-n]),c=boundingExtent([o,l]);return this.traceSource_.getFeaturesInExtent(c)}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_(),this.traceSegments_=null;return}const i=this.getTraceCandidates_(e);if(i.length===0)return;const n=getTraceTargets(e.coordinate,i);n.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:n,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,i){const n=e.startIndex<=e.endIndex,o=e.startIndex<=i;n===o?n&&i>e.endIndex||!n&&i<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,i):(n&&i<e.endIndex||!n&&i>e.endIndex)&&this.removeTracedCoordinates_(i,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,i))}removeTracedCoordinates_(e,i){if(e===i)return;let n=0;if(e<i){const o=Math.ceil(e);let l=Math.floor(i);l===i&&(l-=1),n=l-o+1}else{const o=Math.floor(e);let l=Math.ceil(i);l===i&&(l+=1),n=o-l+1}if(n>0)for(const o of this.traceSegments_){const l=o[0],c=l.geometry,u=o[1];let h=o[0].index+1;u===1&&(h-=n);const f=c.getCoordinates();getCoordinatesArray(f,c.getType(),l.depth).splice(h,n),c.setCoordinates(f),u===1&&(l.index-=n)}}addTracedCoordinates_(e,i,n){if(i===n)return;const o=[];if(i<n){const l=Math.ceil(i);let c=Math.floor(n);c===n&&(c-=1);for(let u=l;u<=c;++u)o.push(getCoordinate(e.coordinates,u))}else{const l=Math.floor(i);let c=Math.ceil(n);c===n&&(c+=1);for(let u=l;u>=c;--u)o.push(getCoordinate(e.coordinates,u))}if(o.length)for(const l of this.traceSegments_){const c=l[0],u=c.geometry,h=l[1],f=c.index+1;h===0&&o.reverse();const g=u.getCoordinates();getCoordinatesArray(g,u.getType(),c.depth).splice(f,0,...o),u.setCoordinates(g),h===1&&(c.index+=o.length)}}updateGeometry_(e,i){const n=i[0],o=n.depth;let l;const c=n.segment,u=n.geometry,h=i[1];for(;e.length<u.getStride();)e.push(c[h][e.length]);switch(u.getType()){case"Point":l=e,c[0]=e,c[1]=e;break;case"MultiPoint":l=u.getCoordinates(),l[n.index]=e,c[0]=e,c[1]=e;break;case"LineString":l=u.getCoordinates(),l[n.index+h]=e,c[h]=e;break;case"MultiLineString":l=u.getCoordinates(),l[o[0]][n.index+h]=e,c[h]=e;break;case"Polygon":l=u.getCoordinates(),l[o[0]][n.index+h]=e,c[h]=e;break;case"MultiPolygon":l=u.getCoordinates(),l[o[1]][o[0]][n.index+h]=e,c[h]=e;break;case"Circle":const f=u;if(c[0]=e,c[1]=e,n.index===CIRCLE_CENTER_INDEX)this.changingFeature_=!0,f.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0,this.getMap().getView().getProjection();let g=distance(fromUserCoordinate(f.getCenter()),fromUserCoordinate(e));f.setRadius(g),this.changingFeature_=!1}break}l&&this.setGeometryCoordinates_(u,l)}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([c])=>c));const i=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],n=[],o=[],l=this.traceState_.active&&!this.traceSegments_?this.traceState_.startCoord:null;if(l){this.traceSegments_=[];for(const c of this.dragSegments_){const u=c[0];distance(closestOnSegment(l,u.segment),l)/e.map.getView().getResolution()<1&&this.traceSegments_.push(c)}}for(let c=0,u=this.dragSegments_.length;c<u;++c){const h=this.dragSegments_[c],f=h[0],g=f.feature;n.includes(g)||n.push(g);const H=f.geometry;o.includes(H)||o.push(H),this.updateGeometry_(i,h)}this.updateTrace_(e),this.createOrUpdateVertexFeature_(i,n,o,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const i=e.coordinate,n=this.findInsertVerticesAndUpdateDragSegments_(i);if(n!=null&&n.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,n),this.vertexFeature_)){const o=this.vertexFeature_.getGeometry().getCoordinates();for(let l=n.length-1;l>=0;--l)this.insertVertex_(n[l],o);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let i=this.dragSegments_.length-1;i>=0;--i){const n=this.dragSegments_[i][0],o=n.geometry;if(o.getType()==="Circle"){const l=o,c=l.getCenter(),u=n.featureSegments[0],h=n.featureSegments[1];u.segment[0]=c,u.segment[1]=c,h.segment[0]=c,h.segment[1]=c,this.rBush_.update(createOrUpdateFromCoordinate(c),u);let f=l;this.rBush_.update(f.getExtent(),h)}else this.rBush_.update(boundingExtent(n.segment),n)}return this.featuresBeingModified_&&(this.toggleTraceState_(e),this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastCoordinate_=e.coordinate,this.handlePointerAtPixel_(this.lastCoordinate_)}handlePointerAtPixel_(e){const i=this.getMap(),n=i.getPixelFromCoordinate(e);i.getView().getProjection();const o=function(u,h){return projectedDistanceToSegmentDataSquared(e,u)-projectedDistanceToSegmentDataSquared(e,h)};let l,c;if(this.hitDetection_){const u=typeof this.hitDetection_=="object"?h=>h===this.hitDetection_:void 0;i.forEachFeatureAtPixel(n,(h,f,g)=>{g&&g.getType()==="Point"&&(g=new Point$1(toUserCoordinate(g.getCoordinates())));const H=g||h.getGeometry();if(H&&H.getType()==="Point"&&h instanceof Feature&&this.features_.getArray().includes(h)){c=H;const Y=h.getGeometry().getFlatCoordinates().slice(0,2);l=[{feature:h,geometry:c,segment:[Y,Y]}]}return!0},{layerFilter:u})}if(!l){const u=fromUserExtent(createOrUpdateFromCoordinate(e,tempExtent)),h=i.getView().getResolution()*this.pixelTolerance_,f=toUserExtent(buffer(u,h,tempExtent));l=this.rBush_.getInExtent(f)}if(l&&l.length>0){const u=l.sort(o)[0],h=u.segment;let f=closestOnSegmentData(e,u);const g=i.getPixelFromCoordinate(f);let H=distance(n,g);if(c||H<=this.pixelTolerance_){const Y={};if(Y[getUid(h)]=!0,this.snapToPointer_||(this.delta_[0]=f[0]-e[0],this.delta_[1]=f[1]-e[1]),u.geometry.getType()==="Circle"&&u.index===CIRCLE_CIRCUMFERENCE_INDEX)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(f,[u.feature],[u.geometry],this.snappedToVertex_);else{const ee=i.getPixelFromCoordinate(h[0]),te=i.getPixelFromCoordinate(h[1]),xe=squaredDistance$1(g,ee),ne=squaredDistance$1(g,te);if(H=Math.sqrt(Math.min(xe,ne)),this.snappedToVertex_=H<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(f=xe>ne?h[1]:h[0]),this.createOrUpdateVertexFeature_(f,[u.feature],[u.geometry],this.snappedToVertex_);const et={};et[getUid(u.geometry)]=!0;for(let tt=1,it=l.length;tt<it;++tt){const rt=l[tt].segment;if(equals$2(h[0],rt[0])&&equals$2(h[1],rt[1])||equals$2(h[0],rt[1])&&equals$2(h[1],rt[0])){const nt=getUid(l[tt].geometry);nt in et||(et[nt]=!0,Y[getUid(rt)]=!0)}else break}}this.vertexSegments_=Y;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,i){const n=e.segment,o=e.feature,l=e.geometry,c=e.depth,u=e.index;let h;for(;i.length<l.getStride();)i.push(0);switch(l.getType()){case"MultiLineString":h=l.getCoordinates(),h[c[0]].splice(u+1,0,i);break;case"Polygon":h=l.getCoordinates(),h[c[0]].splice(u+1,0,i);break;case"MultiPolygon":h=l.getCoordinates(),h[c[1]][c[0]].splice(u+1,0,i);break;case"LineString":h=l.getCoordinates(),h.splice(u+1,0,i);break;default:return!1}this.setGeometryCoordinates_(l,h);const f=this.rBush_;f.remove(e),this.updateSegmentIndices_(l,u,c,1);const g={segment:[n[0],i],feature:o,geometry:l,depth:c,index:u};f.insert(boundingExtent(g.segment),g),this.dragSegments_.push([g,1]);const H={segment:[i,n[1]],feature:o,geometry:l,depth:c,index:u+1};return f.insert(boundingExtent(H.segment),H),this.dragSegments_.push([H,0]),!0}updatePointer_(e){var i;return e&&this.findInsertVerticesAndUpdateDragSegments_(e),(i=this.vertexFeature_)==null?void 0:i.getGeometry().getCoordinates()}getPoint(){var i;const e=(i=this.vertexFeature_)==null?void 0:i.getGeometry().getCoordinates();return e?toUserCoordinate(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(n=>n.getType()==="Circle"||n.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(boundingExtent([e])).some(({segment:n})=>equals$2(n[0],e)||equals$2(n[1],e))}removePoint(e){if(e&&(e=fromUserCoordinate(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=MapBrowserEventType.POINTERDRAG){const i=this.lastPointerEvent_;this.willModifyFeatures_(i,this.dragSegments_.map(([o])=>o));const n=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYEND,this.featuresBeingModified_,i)),this.featuresBeingModified_=null,n}return!1}removeVertex_(){const e=this.dragSegments_,i={};let n=!1,o,l,c,u,h,f,g,H,Y,ee,te;for(h=e.length-1;h>=0;--h)c=e[h],ee=c[0],te=getUid(ee.feature),ee.depth&&(te+="-"+ee.depth.join("-")),te in i||(i[te]={}),c[1]===0?(i[te].right=ee,i[te].index=ee.index):c[1]==1&&(i[te].left=ee,i[te].index=ee.index+1);for(te in i){switch(Y=i[te].right,g=i[te].left,f=i[te].index,H=f-1,g!==void 0?ee=g:ee=Y,H<0&&(H=0),u=ee.geometry,l=u.getCoordinates(),o=l,n=!1,u.getType()){case"MultiLineString":l[ee.depth[0]].length>2&&(l[ee.depth[0]].splice(f,1),n=!0);break;case"LineString":l.length>2&&(l.splice(f,1),n=!0);break;case"MultiPolygon":o=o[ee.depth[1]];case"Polygon":o=o[ee.depth[0]],o.length>4&&(f==o.length-1&&(f=0),o.splice(f,1),n=!0,f===0&&(o.pop(),o.push(o[0]),H=o.length-1));break}if(n){this.setGeometryCoordinates_(u,l);const xe=[];if(g!==void 0&&(this.rBush_.remove(g),xe.push(g.segment[0])),Y!==void 0&&(this.rBush_.remove(Y),xe.push(Y.segment[1])),g!==void 0&&Y!==void 0){const ne={depth:ee.depth,feature:ee.feature,geometry:ee.geometry,index:H,segment:xe};this.rBush_.insert(boundingExtent(ne.segment),ne)}this.updateSegmentIndices_(u,f,ee.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return n}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(n=>n.getType()==="Circle"||n.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(boundingExtent([e])).some(({segment:n})=>!(equals$2(n[0],e)||equals$2(n[1],e)))}insertPoint(e){var o;const i=e?fromUserCoordinate(e,this.getMap().getView().getProjection()):(o=this.vertexFeature_)==null?void 0:o.getGeometry().getCoordinates();return i?this.findInsertVerticesAndUpdateDragSegments_(i).reduce((l,c)=>l||this.insertVertex_(c,i),!1):!1}setGeometryCoordinates_(e,i){this.changingFeature_=!0,e.setCoordinates(i),this.changingFeature_=!1}updateSegmentIndices_(e,i,n,o){this.rBush_.forEachInExtent(e.getExtent(),function(l){l.geometry===e&&(n===void 0||l.depth===void 0||equals(l.depth,n))&&l.index>i&&(l.index+=o)})}}function compareIndexes(s,e){return s.index-e.index}function projectedDistanceToSegmentDataSquared(s,e,i){const n=e.geometry;if(n.getType()==="Circle"){let l=n;if(e.index===CIRCLE_CIRCUMFERENCE_INDEX){const c=squaredDistance$1(l.getCenter(),fromUserCoordinate(s)),u=Math.sqrt(c)-l.getRadius();return u*u}}const o=fromUserCoordinate(s);return tempSegment[0]=fromUserCoordinate(e.segment[0]),tempSegment[1]=fromUserCoordinate(e.segment[1]),squaredDistanceToSegment(o,tempSegment)}function closestOnSegmentData(s,e,i){const n=e.geometry;if(n.getType()==="Circle"&&e.index===CIRCLE_CIRCUMFERENCE_INDEX)return toUserCoordinate(n.getClosestPoint(fromUserCoordinate(s)));const o=fromUserCoordinate(s);return tempSegment[0]=fromUserCoordinate(e.segment[0]),tempSegment[1]=fromUserCoordinate(e.segment[1]),toUserCoordinate(closestOnSegment(o,tempSegment))}function getDefaultStyleFunction$1(){const s=createEditingStyle();return function(e,i){return s.Point}}const DELTA_LINE_MULTIPLIER=40,DELTA_PAGE_MULTIPLIER=300;class MouseWheelZoom extends Interaction{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const i=e.condition?e.condition:always$1;this.condition_=e.onFocusOnly?all(focusWithTabindex,i):i,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(e){if(!this.condition_(e)||e.type!==EventType.WHEEL)return!0;const n=e.map,o=e.originalEvent;o.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.pixel);let l=o.deltaY;switch(o.deltaMode){case WheelEvent.DOM_DELTA_LINE:l*=DELTA_LINE_MULTIPLIER;break;case WheelEvent.DOM_DELTA_PAGE:l*=DELTA_PAGE_MULTIPLIER;break}if(l===0)return!1;this.lastDelta_=l;const c=Date.now();this.startTime_===void 0&&(this.startTime_=c),(!this.mode_||c-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(l)<4?"trackpad":"wheel");const u=n.getView();if(this.mode_==="trackpad"&&!(u.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(u.getAnimating()&&u.cancelAnimations(),u.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),u.adjustZoom(-l/this.deltaPerZoom_,this.lastAnchor_?n.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=c,!1;this.totalDelta_+=l;const h=Math.max(this.timeout_-(c-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),h),!1}handleWheelZoom_(e){const i=e.getView();i.getAnimating()&&i.cancelAnimations();let n=-clamp$1(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(i.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),zoomByDelta(i,n,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class PinchRotate extends PointerInteraction{constructor(e){e=e||{};const i=e;i.stopDown||(i.stopDown=FALSE),super(i),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let i=0;const n=this.targetPointers[0],o=this.targetPointers[1],l=Math.atan2(o.clientY-n.clientY,o.clientX-n.clientX);if(this.lastAngle_!==void 0){const h=l-this.lastAngle_;this.rotationDelta_+=h,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),i=h}this.lastAngle_=l;const c=e.map,u=c.getView();u.getConstraints().rotation!==disable&&(this.anchor_=c.getCoordinateFromPixelInternal(c.getEventPixel(centroid(this.targetPointers))),this.rotating_&&(c.render(),u.adjustRotationInternal(i,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const i=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||i.getView().beginInteraction(),!0}return!1}}class PinchZoom extends PointerInteraction{constructor(e){e=e||{};const i=e;i.stopDown||(i.stopDown=FALSE),super(i),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let i=1;const n=this.targetPointers[0],o=this.targetPointers[1],l=n.clientX-o.clientX,c=n.clientY-o.clientY,u=Math.sqrt(l*l+c*c);this.lastDistance_!==void 0&&(i=this.lastDistance_/u),this.lastDistance_=u;const h=e.map,f=h.getView();i!=1&&(this.lastScaleDelta_=i),this.anchor_=h.getCoordinateFromPixelInternal(h.getEventPixel(centroid(this.targetPointers))),h.render(),f.adjustResolutionInternal(i,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const n=e.map.getView(),o=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,o),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const i=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||i.getView().beginInteraction(),!0}return!1}}const SelectEventType={SELECT:"select"};class SelectEvent extends BaseEvent{constructor(e,i,n,o){super(e),this.selected=i,this.deselected=n,this.mapBrowserEvent=o}}const originalFeatureStyles={};class Select extends Interaction{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:singleClick,this.addCondition_=e.addCondition?e.addCondition:never,this.removeCondition_=e.removeCondition?e.removeCondition:never,this.toggleCondition_=e.toggleCondition?e.toggleCondition:shiftKeyOnly,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:TRUE,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:getDefaultStyleFunction(),this.features_=e.features||new Collection;let i;if(e.layers)if(typeof e.layers=="function")i=e.layers;else{const n=e.layers;i=function(o){return n.includes(o)}}else i=TRUE;this.layerFilter_=i,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,i){this.featureLayerAssociation_[getUid(e)]=i}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[getUid(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(CollectionEventType.ADD,this.boundAddFeature_),this.features_.addEventListener(CollectionEventType.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(CollectionEventType.ADD,this.boundAddFeature_),this.features_.removeEventListener(CollectionEventType.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const i=e.element;if(this.style_&&this.applySelectedStyle_(i),!this.getLayer(i)){const n=this.findLayerOfFeature_(i);n&&this.addFeatureLayerAssociation_(i,n)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}findLayerOfFeature_(e){return this.getMap().getAllLayers().find(function(n){if(n instanceof VectorLayer&&n.getSource()&&n.getSource().hasFeature(e))return n})}getStyle(){return this.style_}applySelectedStyle_(e){const i=getUid(e);i in originalFeatureStyles||(originalFeatureStyles[i]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const i=this.getMap().getInteractions().getArray();for(let o=i.length-1;o>=0;--o){const l=i[o];if(l!==this&&l instanceof Select&&l.getStyle()&&l.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(l.getStyle());return}}const n=getUid(e);e.setStyle(originalFeatureStyles[n]),delete originalFeatureStyles[n]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[getUid(e)]}selectFeatureInternal_(e,i,n){if(!(e instanceof Feature)||!this.filter_(e,i))return;const o=this.getFeatures();return o.getArray().includes(e)||(this.addFeatureLayerAssociation_(e,i),o.push(e),n==null||n.push(e)),e}selectFeature(e){const i=this.findLayerOfFeature_(e);if(!this.layerFilter_(i))return!1;const n=this.selectFeatureInternal_(e,i);return n&&this.dispatchEvent(new SelectEvent(SelectEventType.SELECT,[n],[],void 0)),!!n}removeFeatureInternal_(e,i){const n=this.getFeatures();if(!(!(e instanceof Feature)||!n.getArray().includes(e)))return n.remove(e),this.removeFeatureLayerAssociation_(e),i==null||i.push(e),e}deselectFeature(e){const i=this.removeFeatureInternal_(e);return i&&this.dispatchEvent(new SelectEvent(SelectEventType.SELECT,[],[i],void 0)),!!i}toggleFeature(e){this.deselectFeature(e)||this.selectFeature(e)}clearSelection(){clear$1(this.featureLayerAssociation_);const e=this.getFeatures(),i=e.getArray().slice();e.clear(),i.length!==0&&this.dispatchEvent(new SelectEvent(SelectEventType.SELECT,[],i,void 0))}handleEvent(e){if(!this.condition_(e))return!0;const i=this.addCondition_(e),n=this.removeCondition_(e),o=this.toggleCondition_(e),l=!i&&!n&&!o,c=e.map,u=this.getFeatures(),h=[],f=[];if(l){let g=!1;c.forEachFeatureAtPixel(e.pixel,(H,Y)=>{if(g=!0,!!this.selectFeatureInternal_(H,Y,f))return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let H=u.getLength()-1;H>=0;--H){const Y=u.item(H);(f.length>0&&!f.includes(Y)||!g)&&this.removeFeatureInternal_(Y,h)}}else c.forEachFeatureAtPixel(e.pixel,(g,H)=>{let Y;if((n||o)&&(Y=this.removeFeatureInternal_(g,h)),(i||o)&&!Y&&(Y=this.selectFeatureInternal_(g,H,f)),!!Y)return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});return(f.length>0||h.length>0)&&this.dispatchEvent(new SelectEvent(SelectEventType.SELECT,f,h,e)),!0}}function getDefaultStyleFunction(){const s=createEditingStyle();return extend$3(s.Polygon,s.LineString),extend$3(s.GeometryCollection,s.LineString),function(e){return e.getGeometry()?s[e.getGeometry().getType()]:null}}class Kinetic{constructor(e,i,n){this.decay_=e,this.minVelocity_=i,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,i){this.points_.push(e,i,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,i=this.points_.length-3;if(this.points_[i+2]<e)return!1;let n=i-3;for(;n>0&&this.points_[n+2]>e;)n-=3;const o=this.points_[i+2]-this.points_[n+2];if(o<1e3/60)return!1;const l=this.points_[i]-this.points_[n],c=this.points_[i+1]-this.points_[n+1];return this.angle_=Math.atan2(c,l),this.initialVelocity_=Math.sqrt(l*l+c*c)/o,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}function defaults$3(s){s=s||{};const e=new Collection,i=new Kinetic(-.005,.05,100);return(s.altShiftDragRotate!==void 0?s.altShiftDragRotate:!0)&&e.push(new DragRotate),(s.doubleClickZoom!==void 0?s.doubleClickZoom:!0)&&e.push(new DoubleClickZoom({delta:s.zoomDelta,duration:s.zoomDuration})),(s.dragPan!==void 0?s.dragPan:!0)&&e.push(new DragPan({onFocusOnly:s.onFocusOnly,kinetic:i})),(s.pinchRotate!==void 0?s.pinchRotate:!0)&&e.push(new PinchRotate),(s.pinchZoom!==void 0?s.pinchZoom:!0)&&e.push(new PinchZoom({duration:s.zoomDuration})),(s.keyboard!==void 0?s.keyboard:!0)&&(e.push(new KeyboardPan),e.push(new KeyboardZoom({delta:s.zoomDelta,duration:s.zoomDuration}))),(s.mouseWheelZoom!==void 0?s.mouseWheelZoom:!0)&&e.push(new MouseWheelZoom({onFocusOnly:s.onFocusOnly,duration:s.zoomDuration})),(s.shiftDragZoom!==void 0?s.shiftDragZoom:!0)&&e.push(new DragZoom({duration:s.zoomDuration})),e}var loglevel$1={exports:{}},loglevel=loglevel$1.exports,hasRequiredLoglevel;function requireLoglevel(){return hasRequiredLoglevel||(hasRequiredLoglevel=1,(function(s){(function(e,i){s.exports?s.exports=i():e.log=i()})(loglevel,function(){var e=function(){},i="undefined",n=typeof window!==i&&typeof window.navigator!==i&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"],l={},c=null;function u(xe,ne){var et=xe[ne];if(typeof et.bind=="function")return et.bind(xe);try{return Function.prototype.bind.call(et,xe)}catch{return function(){return Function.prototype.apply.apply(et,[xe,arguments])}}}function h(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function f(xe){return xe==="debug"&&(xe="log"),typeof console===i?!1:xe==="trace"&&n?h:console[xe]!==void 0?u(console,xe):console.log!==void 0?u(console,"log"):e}function g(){for(var xe=this.getLevel(),ne=0;ne<o.length;ne++){var et=o[ne];this[et]=ne<xe?e:this.methodFactory(et,xe,this.name)}if(this.log=this.debug,typeof console===i&&xe<this.levels.SILENT)return"No console available for logging"}function H(xe){return function(){typeof console!==i&&(g.call(this),this[xe].apply(this,arguments))}}function Y(xe,ne,et){return f(xe)||H.apply(this,arguments)}function ee(xe,ne){var et=this,tt,it,rt,nt="loglevel";typeof xe=="string"?nt+=":"+xe:typeof xe=="symbol"&&(nt=void 0);function st(ut){var pt=(o[ut]||"silent").toUpperCase();if(!(typeof window===i||!nt)){try{window.localStorage[nt]=pt;return}catch{}try{window.document.cookie=encodeURIComponent(nt)+"="+pt+";"}catch{}}}function at(){var ut;if(!(typeof window===i||!nt)){try{ut=window.localStorage[nt]}catch{}if(typeof ut===i)try{var pt=window.document.cookie,yt=encodeURIComponent(nt),mt=pt.indexOf(yt+"=");mt!==-1&&(ut=/^([^;]+)/.exec(pt.slice(mt+yt.length+1))[1])}catch{}return et.levels[ut]===void 0&&(ut=void 0),ut}}function ot(){if(!(typeof window===i||!nt)){try{window.localStorage.removeItem(nt)}catch{}try{window.document.cookie=encodeURIComponent(nt)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function ct(ut){var pt=ut;if(typeof pt=="string"&&et.levels[pt.toUpperCase()]!==void 0&&(pt=et.levels[pt.toUpperCase()]),typeof pt=="number"&&pt>=0&&pt<=et.levels.SILENT)return pt;throw new TypeError("log.setLevel() called with invalid level: "+ut)}et.name=xe,et.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},et.methodFactory=ne||Y,et.getLevel=function(){return rt??it??tt},et.setLevel=function(ut,pt){return rt=ct(ut),pt!==!1&&st(rt),g.call(et)},et.setDefaultLevel=function(ut){it=ct(ut),at()||et.setLevel(ut,!1)},et.resetLevel=function(){rt=null,ot(),g.call(et)},et.enableAll=function(ut){et.setLevel(et.levels.TRACE,ut)},et.disableAll=function(ut){et.setLevel(et.levels.SILENT,ut)},et.rebuild=function(){if(c!==et&&(tt=ct(c.getLevel())),g.call(et),c===et)for(var ut in l)l[ut].rebuild()},tt=ct(c?c.getLevel():"WARN");var ht=at();ht!=null&&(rt=ct(ht)),g.call(et)}c=new ee,c.getLogger=function(ne){if(typeof ne!="symbol"&&typeof ne!="string"||ne==="")throw new TypeError("You must supply a name when creating a logger.");var et=l[ne];return et||(et=l[ne]=new ee(ne,c.methodFactory)),et};var te=typeof window!==i?window.log:void 0;return c.noConflict=function(){return typeof window!==i&&window.log===c&&(window.log=te),c},c.getLoggers=function(){return l},c.default=c,c})})(loglevel$1)),loglevel$1.exports}var loglevelExports=requireLoglevel(),LoggerByDefault$1={getLogger:function(s){if(typeof e>"u"){var e={};e.env={VERBOSE:!1}}e.env.VERBOSE?loglevelExports.enableAll():loglevelExports.disableAll();var i=s||"default";return loglevelExports.getLogger(i)}},MessagesResources={PARAM_MISSING:"Parameter(s) '%var%' missing",PARAM_EMPTY:"Parameter(s) '%var%' empty",PARAM_TYPE:"Wrong type(s) for parameter(s) '%var%'",PARAM_FORMAT:"Parameter(s) '%var%' not correctly formatted",PARAM_NOT_SUPPORT:"Value(s) for parameter(s) '%var%' not supported",PARAM_NOT_SUPPORT_NODEJS:"Value(s) for parameter(s) '%var%' not supported to NodeJS",PARAM_UNKNOWN:"Value(s) for parameter(s) '%var%' unknown",SERVICE_REQUEST_BUILD:"An error occurred during the request building of the service",SERVICE_REQUEST_EMPTY:"The request sent to the service is empty",SERVICE_RESPONSE_EXCEPTION:"The service returned an exception : '%var%'",SERVICE_RESPONSE_EXCEPTION_2:"The service returned an exception",SERVICE_RESPONSE_ANALYSE:"An error occurred while parsing the response '%var%' of the service",SERVICE_RESPONSE_ANALYSE_2:"An unknown error occurred while parsing the response",SERVICE_RESPONSE_EMPTY:"The response of the service is empty",SERVICE_RESPONSE_EMPTY_2:"The response from the service could not be analyzed or is empty",SERVICE_RESPONSE_FORMAT:"The format of the service response is not supported (handled format(s) : '%var%')",SERVICE_RESPONSE_FORMAT_2:"The format of the service response is not supported",SERVICE_RESPONSE_FORMAT_3:"No suggestion matching the search",CLASS_CONSTRUCTOR:"'%var%' constructor cannot be called as a function.",getMessage:function(s,e){if(Object.keys(arguments).length===0)return"Message indefined !";var i=Array.prototype.slice.call(arguments),n=i.shift(),o=i,l=this[n];try{Array.isArray(o)&&o.length>0?l=l.replace("%var%",o.join(" - ")):l=l.replace("%var%","%var% (not specified)")}catch{}return l}},Helper$1={normalyzeParameters:function(s){var e=null;if(s){var i=[];for(var n in s)if(s.hasOwnProperty(n)){var o=s[n];o||(o=""),i.push(n+"="+o)}e=i.join("&")}return e},normalyzeUrl:function(s,e,i){var n=s;if(s){if(s.split("?").length-1>=2){var o=s.search(/\?/)+1;n=s.substring(0,o)+s.slice(o).replace(/\?/g,"&")}var l=s.indexOf("?");l===-1&&(n+="?"),l!==-1&&l!==s.length-1&&(n+="&")}return e&&(typeof e=="string"?(e=e.replace("?",""),n+=e):n+=this.normalyzeParameters(e)),i&&(n=encodeURIComponent(n)),n},indent:function(s,e){var i=s||0;return new Array(i+1).join("	")+e}};function commonjsRequire(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var es6Promise$1={exports:{}};/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var es6Promise=es6Promise$1.exports,hasRequiredEs6Promise;function requireEs6Promise(){return hasRequiredEs6Promise||(hasRequiredEs6Promise=1,(function(s,e){(function(i,n){s.exports=n()})(es6Promise,(function(){function i(wt){var Ot=typeof wt;return wt!==null&&(Ot==="object"||Ot==="function")}function n(wt){return typeof wt=="function"}var o=void 0;Array.isArray?o=Array.isArray:o=function(wt){return Object.prototype.toString.call(wt)==="[object Array]"};var l=o,c=0,u=void 0,h=void 0,f=function(Ot,kt){st[c]=Ot,st[c+1]=kt,c+=2,c===2&&(h?h(at):ct())};function g(wt){h=wt}function H(wt){f=wt}var Y=typeof window<"u"?window:void 0,ee=Y||{},te=ee.MutationObserver||ee.WebKitMutationObserver,xe=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",ne=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function et(){return function(){return process.nextTick(at)}}function tt(){return typeof u<"u"?function(){u(at)}:nt()}function it(){var wt=0,Ot=new te(at),kt=document.createTextNode("");return Ot.observe(kt,{characterData:!0}),function(){kt.data=wt=++wt%2}}function rt(){var wt=new MessageChannel;return wt.port1.onmessage=at,function(){return wt.port2.postMessage(0)}}function nt(){var wt=setTimeout;return function(){return wt(at,1)}}var st=new Array(1e3);function at(){for(var wt=0;wt<c;wt+=2){var Ot=st[wt],kt=st[wt+1];Ot(kt),st[wt]=void 0,st[wt+1]=void 0}c=0}function ot(){try{var wt=Function("return this")().require("vertx");return u=wt.runOnLoop||wt.runOnContext,tt()}catch{return nt()}}var ct=void 0;xe?ct=et():te?ct=it():ne?ct=rt():Y===void 0&&typeof commonjsRequire=="function"?ct=ot():ct=nt();function ht(wt,Ot){var kt=this,Bt=new this.constructor(yt);Bt[pt]===void 0&&Tt(Bt);var jt=kt._state;if(jt){var Wt=arguments[jt-1];f(function(){return Ht(jt,Bt,Wt,kt._result)})}else Gt(kt,Bt,wt,Ot);return Bt}function ut(wt){var Ot=this;if(wt&&typeof wt=="object"&&wt.constructor===Ot)return wt;var kt=new Ot(yt);return _t(kt,wt),kt}var pt=Math.random().toString(36).substring(2);function yt(){}var mt=void 0,St=1,Pt=2;function Rt(){return new TypeError("You cannot resolve a promise with itself")}function Lt(){return new TypeError("A promises callback cannot return that same promise.")}function Nt(wt,Ot,kt,Bt){try{wt.call(Ot,kt,Bt)}catch(jt){return jt}}function vt(wt,Ot,kt){f(function(Bt){var jt=!1,Wt=Nt(kt,Ot,function(Vt){jt||(jt=!0,Ot!==Vt?_t(Bt,Vt):ft(Bt,Vt))},function(Vt){jt||(jt=!0,bt(Bt,Vt))},"Settle: "+(Bt._label||" unknown promise"));!jt&&Wt&&(jt=!0,bt(Bt,Wt))},wt)}function Et(wt,Ot){Ot._state===St?ft(wt,Ot._result):Ot._state===Pt?bt(wt,Ot._result):Gt(Ot,void 0,function(kt){return _t(wt,kt)},function(kt){return bt(wt,kt)})}function Ct(wt,Ot,kt){Ot.constructor===wt.constructor&&kt===ht&&Ot.constructor.resolve===ut?Et(wt,Ot):kt===void 0?ft(wt,Ot):n(kt)?vt(wt,Ot,kt):ft(wt,Ot)}function _t(wt,Ot){if(wt===Ot)bt(wt,Rt());else if(i(Ot)){var kt=void 0;try{kt=Ot.then}catch(Bt){bt(wt,Bt);return}Ct(wt,Ot,kt)}else ft(wt,Ot)}function dt(wt){wt._onerror&&wt._onerror(wt._result),Ft(wt)}function ft(wt,Ot){wt._state===mt&&(wt._result=Ot,wt._state=St,wt._subscribers.length!==0&&f(Ft,wt))}function bt(wt,Ot){wt._state===mt&&(wt._state=Pt,wt._result=Ot,f(dt,wt))}function Gt(wt,Ot,kt,Bt){var jt=wt._subscribers,Wt=jt.length;wt._onerror=null,jt[Wt]=Ot,jt[Wt+St]=kt,jt[Wt+Pt]=Bt,Wt===0&&wt._state&&f(Ft,wt)}function Ft(wt){var Ot=wt._subscribers,kt=wt._state;if(Ot.length!==0){for(var Bt=void 0,jt=void 0,Wt=wt._result,Vt=0;Vt<Ot.length;Vt+=3)Bt=Ot[Vt],jt=Ot[Vt+kt],Bt?Ht(kt,Bt,jt,Wt):jt(Wt);wt._subscribers.length=0}}function Ht(wt,Ot,kt,Bt){var jt=n(kt),Wt=void 0,Vt=void 0,Yt=!0;if(jt){try{Wt=kt(Bt)}catch(ti){Yt=!1,Vt=ti}if(Ot===Wt){bt(Ot,Lt());return}}else Wt=Bt;Ot._state!==mt||(jt&&Yt?_t(Ot,Wt):Yt===!1?bt(Ot,Vt):wt===St?ft(Ot,Wt):wt===Pt&&bt(Ot,Wt))}function Mt(wt,Ot){try{Ot(function(Bt){_t(wt,Bt)},function(Bt){bt(wt,Bt)})}catch(kt){bt(wt,kt)}}var It=0;function xt(){return It++}function Tt(wt){wt[pt]=It++,wt._state=void 0,wt._result=void 0,wt._subscribers=[]}function Ut(){return new Error("Array Methods must be provided an Array")}var Dt=(function(){function wt(Ot,kt){this._instanceConstructor=Ot,this.promise=new Ot(yt),this.promise[pt]||Tt(this.promise),l(kt)?(this.length=kt.length,this._remaining=kt.length,this._result=new Array(this.length),this.length===0?ft(this.promise,this._result):(this.length=this.length||0,this._enumerate(kt),this._remaining===0&&ft(this.promise,this._result))):bt(this.promise,Ut())}return wt.prototype._enumerate=function(kt){for(var Bt=0;this._state===mt&&Bt<kt.length;Bt++)this._eachEntry(kt[Bt],Bt)},wt.prototype._eachEntry=function(kt,Bt){var jt=this._instanceConstructor,Wt=jt.resolve;if(Wt===ut){var Vt=void 0,Yt=void 0,ti=!1;try{Vt=kt.then}catch(ui){ti=!0,Yt=ui}if(Vt===ht&&kt._state!==mt)this._settledAt(kt._state,Bt,kt._result);else if(typeof Vt!="function")this._remaining--,this._result[Bt]=kt;else if(jt===zt){var ni=new jt(yt);ti?bt(ni,Yt):Ct(ni,kt,Vt),this._willSettleAt(ni,Bt)}else this._willSettleAt(new jt(function(ui){return ui(kt)}),Bt)}else this._willSettleAt(Wt(kt),Bt)},wt.prototype._settledAt=function(kt,Bt,jt){var Wt=this.promise;Wt._state===mt&&(this._remaining--,kt===Pt?bt(Wt,jt):this._result[Bt]=jt),this._remaining===0&&ft(Wt,this._result)},wt.prototype._willSettleAt=function(kt,Bt){var jt=this;Gt(kt,void 0,function(Wt){return jt._settledAt(St,Bt,Wt)},function(Wt){return jt._settledAt(Pt,Bt,Wt)})},wt})();function $t(wt){return new Dt(this,wt).promise}function Zt(wt){var Ot=this;return l(wt)?new Ot(function(kt,Bt){for(var jt=wt.length,Wt=0;Wt<jt;Wt++)Ot.resolve(wt[Wt]).then(kt,Bt)}):new Ot(function(kt,Bt){return Bt(new TypeError("You must pass an array to race."))})}function Kt(wt){var Ot=this,kt=new Ot(yt);return bt(kt,wt),kt}function qt(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Xt(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var zt=(function(){function wt(Ot){this[pt]=xt(),this._result=this._state=void 0,this._subscribers=[],yt!==Ot&&(typeof Ot!="function"&&qt(),this instanceof wt?Mt(this,Ot):Xt())}return wt.prototype.catch=function(kt){return this.then(null,kt)},wt.prototype.finally=function(kt){var Bt=this,jt=Bt.constructor;return n(kt)?Bt.then(function(Wt){return jt.resolve(kt()).then(function(){return Wt})},function(Wt){return jt.resolve(kt()).then(function(){throw Wt})}):Bt.then(kt,kt)},wt})();zt.prototype.then=ht,zt.all=$t,zt.race=Zt,zt.resolve=ut,zt.reject=Kt,zt._setScheduler=g,zt._setAsap=H,zt._asap=f;function ai(){var wt=void 0;if(typeof commonjsGlobal<"u")wt=commonjsGlobal;else if(typeof self<"u")wt=self;else try{wt=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var Ot=wt.Promise;if(Ot){var kt=null;try{kt=Object.prototype.toString.call(Ot.resolve())}catch{}if(kt==="[object Promise]"&&!Ot.cast)return}wt.Promise=zt}return zt.polyfill=ai,zt.Promise=zt,zt}))})(es6Promise$1)),es6Promise$1.exports}var es6PromiseExports=requireEs6Promise();const ES6Promise=getDefaultExportFromCjs$1(es6PromiseExports);var XHR={call:function(s){var e=LoggerByDefault$1.getLogger("XHR");if(e.trace("[XHR::call()]"),ES6Promise.polyfill(),!s.url)throw new Error("missing parameter : url is not defined !");if(!s.method)throw new Error("missing parameter : method is not defined !");s.format||(s.format="text");var i={};switch(i.url=s.url,i.data=s.data?s.data:null,i.method=s.method,i.timeOut=s.timeOut||0,i.scope=s.scope||this,i.proxy=s.proxy||null,i.content=s.content||null,i.headers=s.headers||{referer:"http://localhost"},s.method){case"DELETE":case"GET":break;case"PUT":case"POST":i.content=s.content?s.content:"application/x-www-form-urlencoded",i.headers=s.headers?s.headers:{referer:"http://localhost"};break;case"HEAD":case"OPTIONS":throw new Error("HTTP method not yet supported !");default:throw new Error("HTTP method unknown !")}switch(s.format){case"text":this.__call(i).then(function(n){e.trace(n),s.onResponse.call(this,n)}).catch(function(n){s.onFailure.call(this,n)});break;case"json":this.__callJSON(i).then(function(n){e.trace(n),s.onResponse.call(this,n)}).catch(function(n){s.onFailure.call(this,n)});break;case"xml":this.__callXML(i).then(function(n){e.trace(n),s.onResponse.call(this,n)}).catch(function(n){s.onFailure.call(this,n)});break;default:throw new Error("This output Format is not yet supported !")}},__call:function(s){var e=LoggerByDefault$1.getLogger("XHR");e.trace("[XHR::__call()]");var i=new Promise(function(n,o){var l=s.method==="POST"||s.method==="PUT"?1:0;s.data&&(typeof s.data=="object"&&Object.keys(s.data).length||typeof s.data=="string"&&s.data.length)&&!l&&(s.url=Helper$1.normalyzeUrl(s.url,s.data)),e.trace("URL = ",s.url);var c=null;if(typeof window>"u"){var u=require("node-fetch"),h={headers:{Referer:"https://localhost"}};return s.data&&typeof s.data=="string"&&l&&(h={method:s.method,body:s.data,headers:{"Content-Type":s.content,Referer:"https://localhost"}}),u(s.url,h).then(function(Y){if(Y.ok)n(Y.text());else{var ee="Errors Occured on Http Request (status : '"+Y.statusText+"' | url : '"+Y.url+"')",te=Y.status;o({message:ee,status:te})}}).catch(function(Y){o({message:Y,status:-1})})}else if(window.XMLHttpRequest){e.trace("XMLHttpRequest"),c=new XMLHttpRequest,c.open(s.method,s.url,!0),c.overrideMimeType=s.content;var f=null;s.timeOut>0&&(e.trace("XHR - TimeOut actif !"),f=window.setTimeout(function(){var Y="TimeOut Occured on Http Request with XMLHttpRequest !";o({message:Y,status:-1})},s.timeOut)),l&&(e.trace("data = ",s.data),c.setRequestHeader("Content-type",s.content)),c.onerror=function(Y){console.log(Y),o(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},c.ontimeout=function(Y){console.log(Y),o(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},c.onreadystatechange=function(Y){if(c.readyState===4)if(c.status===200)window.clearTimeout(f),n(c.response);else{var ee="Errors Occured on Http Request (status : '"+Y.target.statusText+"' | url : '"+Y.target.responseURL+"' | response : '"+Y.target.response+"')",te=Y.target.status;o({message:ee,status:te})}};var g=s.data&&l?s.data:null;c.send(g)}else if(window.XDomainRequest){e.trace("XDomainRequest"),c=new XDomainRequest,c.open(s.method,s.url),c.overrideMimeType=s.content,s.timeOut>0&&(c.timeout=s.timeout,e.trace("XHR - TimeOut actif !")),l&&c.setRequestHeader("Content-type",s.content),c.onerror=function(){o(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},c.ontimeout=function(){o(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},c.onload=function(Y){if(c.status===200)n(c.responseText);else{var ee="Errors Occured on Http Request (status : '"+Y.target.statusText+"' | url : '"+Y.target.responseURL+"')",te=Y.target.status;o({message:ee,status:te})}};var H=s.data&&l?s.data:null;c.send(H)}else throw new Error("CORS not supported")});return i},__callJSON:function(s){return this.__call(s).then(JSON.parse).catch(function(e){console.log("_callJSON failed on : ",s.url,e)})},__callXML:function(s){return this.__call(s).then(function(e){var i;if(typeof window>"u"){var n=require("@xmldom/xmldom").DOMParser;i=new n().parseFromString(e,"text/xml")}else if(window.DOMParser){var o=new window.DOMParser;i=o.parseFromString(e,"text/xml")}else i=new window.ActiveXObject("Microsoft.XMLDOM"),i.async=!1,i.loadXML(e);return i}).catch(function(e){console.log("__callXML failed on : ",s.url,e)})}},JSONP={uuid:(function(){var s=Math.floor(Date.now());return function(){return s++}})(),call:function(s){var e=LoggerByDefault$1.getLogger("JSONP");if(e.trace("[JSONP::call ()]"),!s)throw e.error("missing parameter : options !"),new Error("missing parameter : options !");if(!s.url)throw e.error("missing parameter : options.url !"),new Error("missing parameter : options.url !");if(s.timeOut||(e.info("setting 'options.timeOut' default value"),s.timeOut=0),!s.onResponse)throw e.error("missing parameter : options.onResponse !"),new Error("missing parameter : options.onResponse !");var i=typeof s.callbackSuffix=="string"?s.callbackSuffix:this.uuid(),n=!1,o=!1,l=s.url.indexOf("callback=");if(l!==-1){n=!0;var c=s.url.indexOf("&",l);c===-1&&(c=s.url.length);var u=s.url.substring(l+9,c);u&&(o=!0,s.callbackName=u,e.info("setting 'options.callbackName' value ("+s.callbackName+") from 'options.url' parameter"))}if(!n){var h=s.url.indexOf("?");h===-1?s.url=s.url+"?callback=":h===s.url.length?s.url=s.url+"callback=":s.url=s.url+"&callback=",e.info("setting callback default key in 'options.url' : "+s.url)}var f=s.callbackName?!0:o;if(o||(s.callbackName||(e.info("setting 'options.callbackName' default value"),s.callbackName="callback",(i||i==="")&&(s.callbackName+=i)),s.url=s.url.replace("callback=","callback="+s.callbackName),e.info("setting callback function name in 'options.url' : "+s.url)),s.onTimeOut||(e.info("setting 'options.onTimeOut' default value"),s.onTimeOut=function(){console.log("TimeOut while invoking url : "+s.url)}),!f){var g=this,H=null;s.timeOut>0&&(H=window.setTimeout(function(){window[s.callbackName]=function(){},s.onTimeOut(),g._deleteScript(i)},s.timeOut)),window[s.callbackName]=function(Y){window.clearTimeout(H),s.onResponse(Y),g._deleteScript(i)}}this._createScript(i,s.url)},_createScript:function(s,e){var i,n=document.getElementById("results"+s);i=document.createElement("script"),i.setAttribute("type","text/javascript"),i.setAttribute("src",e),i.setAttribute("charset","UTF-8"),i.setAttribute("id","results"+s),i.setAttribute("async","true");var o=document.documentElement||document.getElementsByTagName("head")[0];n===null?o.appendChild(i):o.replaceChild(i,n)},_deleteScript:function(s){var e=document.getElementById("results"+s);if(e){var i=e.parentNode||document.documentElement;if(!i)return;i.removeChild(e)}}},Protocol={send:function(s){var e=s||{method:"GET",protocol:"XHR",timeOut:0,format:null,wrap:!0,nocache:!0,output:"json",callback:null,callbackSuffix:null};if(typeof window>"u"&&s.protocol==="JSONP"){console.log("Value (s) for parameter (s) 'protocol=JSONP (instead use XHR)' not supported to NodeJS");return}if(s.protocol==="XHR"||s.format==="json"?e.wrap=!1:s.protocol==="JSONP"&&s.format==="xml"&&(e.wrap=!0),e.callback=null,e.output=e.wrap?"json":null,e.wrap){var i={};i.output=e.output,i.callback=e.callback,delete i.callback,e.url=Helper$1.normalyzeUrl(s.url,i)}switch(e.protocol){case"XHR":s.method==="GET"&&s.nocache&&(e.url=Helper$1.normalyzeUrl(e.url,{t:new Date().getTime()})),XHR.call(e);break;case"JSONP":e.data&&(e.url=Helper$1.normalyzeUrl(e.url,e.data)),JSONP.call(e);break;default:throw new Error("protocol not supported (XHR|JSONP) !")}}};function ErrorService(s){if(!(this instanceof ErrorService))throw new TypeError("ErrorService constructor cannot be called as a function.");var e=s;typeof s=="string"||s instanceof String?(this.message=s,this.status=-1,this.type=ErrorService.TYPE_UNKERR):(this.message=e.message||"undefined!?",this.type=e.type,this.status=e.status||-1),this.name="ErrorService",this.stack=new Error().stack}ErrorService.TYPE_SRVERR="SERVICE_ERROR";ErrorService.TYPE_USEERR="USAGE_ERROR";ErrorService.TYPE_UNKERR="UNKNOWN_ERROR";ErrorService.prototype=Object.create(Error.prototype,{constructor:{value:ErrorService,writable:!0,configurable:!0}});const version$1="3.4.6",date="19/12/2024",Pkg={version:version$1,date};function CommonService(s){if(!(this instanceof CommonService))throw new TypeError(MessagesResources.getMessage("CLASS_CONSTRUCTOR"));this.logger=LoggerByDefault$1.getLogger("CommonService"),this.logger.trace("[Constructeur CommonService (options)]"),this.options={protocol:"XHR",ssl:!0,proxyURL:"",callbackSuffix:null,httpMethod:"GET",timeOut:0,rawResponse:!1,scope:this,onSuccess:function(n){console.log("onSuccess - la reponse est la suivante : ",n)},onFailure:function(n){n.status===200||!n.status?console.log("onFailure : ",n.message):console.log("onFailure - Erreur (",n.status,") : ",n.message)}};for(var e in s)s.hasOwnProperty(e)&&(this.options[e]=s[e]);this.options.rawResponse&&!this.options.onSuccess&&(this.options.onSuccess=function(n){console.log("onSuccess - la rponse brute du service est la suivante : ",n)});var i=this.options.onSuccess!==null&&typeof this.options.onSuccess=="function";if(!i)throw new Error(MessagesResources.getMessage("PARAM_MISSING","onSuccess()"));switch(this.options.httpMethod=typeof s.httpMethod=="string"?s.httpMethod.toUpperCase():"GET",this.options.httpMethod){case"POST":case"GET":break;case"PUT":case"DELETE":case"HEAD":case"OPTIONS":throw new Error(MessagesResources.getMessage("PARAM_NOT_SUPPORT","httpMethod"));default:throw new Error(MessagesResources.getMessage("PARAM_UNKNOWN","httpMethod"))}switch(this.options.protocol=typeof s.protocol=="string"?s.protocol.toUpperCase():"XHR",this.options.protocol){case"JSONP":case"XHR":break;default:throw new Error(MessagesResources.getMessage("PARAM_UNKNOWN","protocol"))}if(typeof window>"u"&&this.options.protocol==="JSONP")throw new Error(MessagesResources.getMessage("PARAM_NOT_SUPPORT_NODEJS","protocol=JSONP (instead use XHR)"));this.options.protocol==="JSONP"&&(this.options.httpMethod="GET"),this.options.nocache=s.nocache||!1,this.options.outputFormat=null,this.request=null,this.response=null}CommonService.prototype={constructor:CommonService,call:function(){this.logger.trace("CommonService::call ()");var s=this;function e(){this.logger.trace("CommonService::run ()"),this.buildRequest.call(s,l,i)}e.call(s);function i(c){this.logger.trace("CommonService::onBuildRequest : ",c),this.callService.call(s,l,n)}function n(c){this.logger.trace("CommonService::onCallService : ",c),this.analyzeResponse.call(s,l,o)}function o(c){if(this.logger.trace("CommonService::onAnalyzeResponse : ",c),c)this.options.onSuccess.call(this,c);else return l.call(this,new ErrorService("Analyse de la reponse en chec !?"))}function l(c){this.logger.trace("CommonService::onError()");var u=c;u instanceof ErrorService||(u=new ErrorService(c.message)),this.options.onFailure.call(this,u)}},buildRequest:function(s,e){this.logger.error("overwritten method !"),s&&s.call(this,"This method must be overwritten !"),e.call(this,"This method must be overwritten !")},callService:function(s,e){var i=null,n=this.request,o=!!(this.options.proxyURL&&this.options.protocol==="XHR"),l={"gp-access-lib":Pkg.version};this.options.apiKey&&(l.apiKey=this.options.apiKey),this.options.serverUrl=Helper$1.normalyzeUrl(this.options.serverUrl,l,!1),o&&(this.options.httpMethod==="GET"&&(i=this.options.proxyURL+Helper$1.normalyzeUrl(this.options.serverUrl,this.request,!0),n=null),this.options.httpMethod==="POST"&&(i=this.options.proxyURL+Helper$1.normalyzeUrl(this.options.serverUrl,null,!0),n=this.request));var c=this,u={url:i||this.options.serverUrl,method:this.options.httpMethod,protocol:this.options.protocol,timeOut:this.options.timeOut||0,format:this.options.outputFormat,nocache:this.options.nocache||!1,wrap:this.options.protocol!=="XHR",callbackSuffix:this.options.callbackSuffix,data:n,headers:null,content:this.options.contentType||"application/xml",scope:this.options.scope||this,onResponse:function(h){c.logger.trace("callService::onResponse()");var f=null;if(c.options.protocol==="XHR"&&(c.logger.trace("Response XHR",h),f=h),c.options.protocol==="JSONP")if(c.logger.trace("Response JSON",h),h)if(h.http)if(h.http.status!==200){s.call(c,new ErrorService({status:h.http.status,message:h.http.error,type:ErrorService.TYPE_SRVERR}));return}else f=h.xml,c.options.rawResponse&&(f=h);else f=h;else{s.call(c,new ErrorService("Le contenu de la reponse est vide !?"));return}if(typeof c.options.onBeforeParse=="function"){var g=c.options.onBeforeParse(f);typeof g=="string"&&(f=g)}c.response=f,e.call(c,f)},onFailure:function(h){c.logger.trace("callService::onFailure()"),h.type=ErrorService.TYPE_SRVERR,s.call(c,new ErrorService(h))},onTimeOut:function(){c.logger.trace("callService::onTimeOut()"),s.call(c,new ErrorService("TimeOut!"))}};Protocol.send(u)},analyzeResponse:function(s,e){this.logger.error("overwritten method !"),s&&s.call(this,"This method must be overwritten !"),e.call(this,"This method must be overwritten !")}};var DefaultUrlService={ssl:!0,newUrl:function(s){var e="data.geopf.fr",i;return DefaultUrlService.ssl===!1?i="http://":i="https://",i+e+s},Alti:{new_key:{"elevation-json":"/altimetrie/1.0/calcul/alti/rest/elevation.json","elevation-xml":"/altimetrie/1.0/calcul/alti/rest/elevation.xml","profil-json":"/altimetrie/1.0/calcul/alti/rest/elevationLine.json","profil-xml":"/altimetrie/1.0/calcul/alti/rest/elevationLine.xml"},newUrl:function(){return{"elevation-json":DefaultUrlService.newUrl(this.new_key["elevation-json"]),"elevation-xml":DefaultUrlService.newUrl(this.new_key["elevation-xml"]),"profil-json":DefaultUrlService.newUrl(this.new_key["profil-json"]),"profil-xml":DefaultUrlService.newUrl(this.new_key["profil-xml"])}}},ProcessIsoCurve:{new_key:"/navigation/isochrone",newUrl:function(){return DefaultUrlService.newUrl(this.new_key)}},Config:{_key:"https://raw.githubusercontent.com/IGNF/geoportal-configuration/new-url/dist/",url:function(s){Array.isArray(s)||(s=s.split(","));for(var e=[],i=0;i<s.length;i++)e[i]=this._key+s[i]+"Config.json";return e}},AutoComplete:{new_key:"/geocodage/completion",newUrl:function(){return DefaultUrlService.newUrl(this.new_key)}},ReverseGeocode:{new_key:"/geocodage/reverse",newUrl:function(){return DefaultUrlService.newUrl(this.new_key)}},Geocode:{new_key:"/geocodage/search",newUrl:function(){return DefaultUrlService.newUrl(this.new_key)}},Route:{new_key:"/navigation/itineraire",newUrl:function(){return DefaultUrlService.newUrl(this.new_key)}}};function ConfigInterface(){if(!(this instanceof ConfigInterface))throw new TypeError("ConfigInterface constructor cannot be called as a function.");this.generalOptions={apiKeys:{},title:null,defaultGMLGFIStyle:null,theme:null,wgs84Resolutions:[]},this.layers={},this.tileMatrixSets={}}ConfigInterface.prototype={constructor:ConfigInterface,isKeyConfLoaded:function(s){if(s)return!!this.generalOptions.apiKeys[s]},getLayersId:function(s){return this.generalOptions.apiKeys[s]},getLayerId:function(s,e){if(!(!s||!e)){var i=null;if(this.layers){var n=this.layers;for(var o in n)if(n.hasOwnProperty(o)){var l=o.split("$");if(s===l[0]&&l[1]){var c=l[1].split(":"),u=l[1].split(";");if(u[1]===e.toUpperCase()){i=o;break}if(c[2]===e.toUpperCase()){i=o;break}}}}if(i)return i}},getLayersConf:function(s){var e={},i=this.getLayersId(s);if(i)for(var n=0;n<i.length;n++){var o=i[n];e[o]=this.layers[o]}return e},getLayerConf:function(s){if(this.layers)return this.layers[s]},getLayerParams:function(s,e){var i={};if((e==="WMS"||Object.keys(this.tileMatrixSets).length!==0)&&Object.keys(this.layers).length!==0){var n=this.getLayerId(s,e);if(n){var o=this.getLayerConf(n),l=this.getLayerKey(n);if(l.length===0)return;for(var c=0;c<l.length;c++)o.serviceParams.serverUrl[l[c]]&&(i.url=o.serviceParams.serverUrl[l[c]]);if(e!=="WFS"&&(/\/v\//.test(i.url)?i.styles=" ":i.styles=o.styles[0].name),i.version=o.serviceParams.version,i.format=o.formats&&o.formats.length?o.formats[0].name:"",i.projection=o.defaultProjection,i.minScale=o.globalConstraint.minScaleDenominator,i.maxScale=o.globalConstraint.maxScaleDenominator,i.extent=o.globalConstraint.bbox,i.legends=o.legends,i.title=o.title,i.description=o.description,e==="WMS"&&(i.metadata=o.metadata),o.wmtsOptions){i.tileMatrixSetLimits=o.wmtsOptions.tileMatrixSetLimits;var u=o.wmtsOptions.tileMatrixSetLink;if(u){i.TMSLink=u;var h=this.getTMSConf(u);i.matrixIds=Object.keys(h.tileMatrices),i.tileMatrices=h.tileMatrices,i.nativeResolutions=h.nativeResolutions||this.getTMSConf("PM").nativeResolutions}}}}return i},getLayerKey:function(s){var e=[];if(this.generalOptions&&this.generalOptions.apiKeys&&Object.keys(this.generalOptions.apiKeys).length!==0){var i=this.generalOptions.apiKeys;for(var n in i){var o=i[n];o.forEach(function(l){l===s&&e.push(n)})}}return e},getTileMatrixSets:function(){return this.tileMatrixSets},getTMSConf:function(s){if(this.tileMatrixSets)return this.tileMatrixSets[s]},getGlobalConstraints:function(s){var e={};if(s){var i=this.getLayerConf(s);e.projection=i.defaultProjection,e.minScale=i.globalConstraint.minScaleDenominator,e.maxScale=i.globalConstraint.maxScaleDenominator,e.extent=i.globalConstraint.bbox}return e}};function Config$1(s){if(!(this instanceof Config$1))throw new TypeError(MessagesResources.getMessage("CLASS_CONSTRUCTOR","Config"));this.CLASSNAME="Config",this.logger=LoggerByDefault$1.getLogger("Gp.Config"),this.logger.trace("[Constructeur Config (options)]");var e=s.onSuccess!==null&&typeof s.onSuccess=="function";if(!e)throw new Error(MessagesResources.getMessage("PARAM_MISSING","onSuccess()"));!s.apiKey&&!s.customConfigFile&&(s.apiKey="full"),this.options={},this.options.onSuccess=s.onSuccess,this.options.onFailure=s.onFailure,this.options.sync=s.sync||!1,this.options.listConfigUrls=s.customConfigFile?[s.customConfigFile]:Array.isArray(s.apiKey)?DefaultUrlService.Config.url(s.apiKey):DefaultUrlService.Config.url(s.apiKey.split(","))}Config$1.prototype=Object.create(CommonService.prototype,{});Config$1.prototype.constructor=Config$1;Config$1.prototype.buildRequest=function(s,e){if(this.listConfigUrls=this.options.listConfigUrls,!this.listConfigUrls){s.call(this,new Error("url by default not found !"));return}e.call(this,this.listConfigUrls)};Config$1.prototype.callService=function(s,e){this.options.sync?__callServiceSync.call(this,s,e):__callService.call(this,s,e)};var __callService=function(s,e){this.listConfigResults=[];let i=null;if(typeof window>"u"){var n=require("node-fetch");i=n}else i=window.fetch;var o=c=>i(c,{credentials:"same-origin"}).then(u=>{if(u.ok)return u.json().then(h=>h).catch(h=>{throw new Error("Exception Json : "+h)});throw new Error("Exception HTTP : "+u.status+" (status code) !")}).catch(u=>new Promise((h,f)=>{f(u)})),l=[];for(let c=0;c<this.listConfigUrls.length;c++){const u=this.listConfigUrls[c];l.push(o(u))}Promise.all(l).then(c=>{if(!c)throw new Error("results config empty !?");c.forEach(u=>{this.listConfigResults.push(u)})}).then(()=>{e.call(this,this.listConfigResults)}).catch(c=>{s.call(this,c)})},__callServiceSync=function(s,e){this.listConfigResults=[];for(var i=0;i<this.listConfigUrls.length;i++){const o=this.listConfigUrls[i],l=new XMLHttpRequest;if(l.open("GET",o,!1),l.send(null),l.status===200){var n=JSON.parse(l.responseText);this.listConfigResults.push(n)}}this.listConfigResults.length!==0?e.call(this,this.listConfigResults):s.call(this,new Error("..."))};Config$1.prototype.analyzeResponse=function(s,e){var i=function(u){for(var h={},f={},g={},H=0;H<u.length;H++){if(!u[H].generalOptions||!u[H].layers)return;f={...f,...u[H].generalOptions.apiKeys},h={...h,...u[H].layers},g={...g,...u[H].tileMatrixSets}}var Y={generalOptions:{apiKeys:f},layers:h,tileMatrixSets:g};return Y},n=i(this.listConfigResults);if(!n){s.call(this,new Error("configuration structure not conforme !"));return}var o=new ConfigInterface;Object.assign(o,n);var l=typeof window<"u"?window:{};if(l.Gp||(l.Gp={}),l.Gp.Config){Object.assign(l.Gp.Config,o);for(var c in o)l.Gp.Config[c]=o[c]}else l.Gp.Config=o;e.call(this,l.Gp.Config)};function AltiRequest(s){if(!(this instanceof AltiRequest))throw new TypeError("AltiRequest constructor cannot be called as a function.");this.logger=LoggerByDefault$1.getLogger(),this.logger.trace("[Constructeur AltiRequest ()]"),this.options=s||{},this.positions=this.options.positions||[],this.delimiter=this.options.delimiter||"|",this.indent=this.options.indent||!1,this.crs=this.options.crs||"CRS:84",this.format=this.options.format||"json",this.resource=this.options.resource,this.measures=this.options.measures||!1}AltiRequest.CLASSNAME="AltiRequest";AltiRequest.prototype={constructor:AltiRequest,setPositions:function(s){for(var e=[],i=0;i<s.length;i++){var n=s[i];n.lon&&n.lat&&e.push(n)}this.positions=e},getPositions:function(s){if(!s)return this.positions;var e=this.positions.length-1;return s>e||s<e?(this.logger.warn("index out of range !"),this.positions):this.positions[s]},addPositions:function(s){for(var e=0;e<s.length;e++){var i=s[e];i.lon&&i.lat&&this.positions.push(s[e])}},getLon:function(){for(var s=[],e=0;e<this.positions.length;e++)s.push(this.positions[e].lon);return this.logger.trace(s),s.join(this.delimiter)},getLat:function(){for(var s=[],e=0;e<this.positions.length;e++)s.push(this.positions[e].lat);return this.logger.trace(s),s.join(this.delimiter)}};AltiRequest.prototype.getData=function(){var s=[];return s.push({k:"lon",v:this.getLon()}),s.push({k:"lat",v:this.getLat()}),s.push({k:"delimiter",v:this.delimiter}),s.push({k:"indent",v:this.indent}),s.push({k:"crs",v:this.crs}),s.push({k:"format",v:this.format}),s};function AltiElevationRequest(s){if(!(this instanceof AltiElevationRequest))throw new TypeError("AltiElevationRequest constructor cannot be called as a function.");this.CLASSNAME="AltiElevationRequest",AltiRequest.apply(this,arguments),this.logger=LoggerByDefault$1.getLogger(),this.logger.trace("[Constructeur AltiElevationRequest ()]"),this.zonly=this.options.zonly||!1}AltiElevationRequest.prototype=Object.create(AltiRequest.prototype,{zonly:{get:function(){return this._zonly},set:function(s){this._zonly=s}}});AltiElevationRequest.prototype.constructor=AltiElevationRequest;AltiElevationRequest.prototype.getData=function(){var s=[];return s.push({k:"lon",v:this.getLon()}),s.push({k:"lat",v:this.getLat()}),s.push({k:"indent",v:this.indent}),s.push({k:"crs",v:this.crs}),s.push({k:"zonly",v:this.zonly}),s.push({k:"format",v:this.format}),s.push({k:"resource",v:this.resource}),s};function AltiProfilRequest(s){if(!(this instanceof AltiProfilRequest))throw new TypeError("AltiProfilRequest constructor cannot be called as a function.");this.CLASSNAME="AltiProfilRequest",AltiRequest.apply(this,arguments),this.logger=LoggerByDefault$1.getLogger(),this.logger.trace("[Constructeur AltiProfilRequest ()]"),this.sampling=this.options.sampling||3}AltiProfilRequest.prototype=Object.create(AltiRequest.prototype,{sampling:{get:function(){return this._sampling},set:function(s){this._sampling=s}}});AltiProfilRequest.prototype.constructor=AltiProfilRequest;AltiProfilRequest.prototype.getData=function(){var s=[];return s.push({k:"lon",v:this.getLon()}),s.push({k:"lat",v:this.getLat()}),s.push({k:"indent",v:this.indent}),s.push({k:"crs",v:this.crs}),s.push({k:"sampling",v:this.sampling}),s.push({k:"format",v:this.format}),s.push({k:"resource",v:this.resource}),s};function AltiRequestREST(s){if(this.logger=LoggerByDefault$1.getLogger("AltiRequestREST"),this.logger.trace("[Constructeur AltiRequestREST ()]"),!(this instanceof AltiRequestREST))throw new TypeError("AltiRequestREST constructor cannot be called as a function.");if(this.options=s||{},!this.options)throw new Error(MessagesResources.getMessage("PARAM_EMPTY","options"));if(!this.options.type)throw new Error(MessagesResources.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));switch(this.DataObject=null,this.options.type){case"Elevation":this.DataObject=new AltiElevationRequest(this.options.param);break;case"Profil":this.DataObject=new AltiProfilRequest(this.options.param);break;default:throw new Error(MessagesResources.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}this.method=this.options.method||"GET"}AltiRequestREST.prototype={requestString:null,constructor:AltiRequestREST,template:{get:{value:"lon=__LON__&lat=__LAT__&indent=__INDENT__&crs='__CRS__'&resource=__RESOURCE__&measures=__MEASURES__",input:{point:"&zonly=__ZONLY__",profil:"&sampling=__SAMPLING__"}},post:{value:`lon=__LON__
lat=__LAT__
indent=__INDENT__
crs='__CRS__'
resource='__RESOURCE__'
measures='__MEASURES__'
`,input:{point:`zonly=__ZONLY__
`,profil:"sampling=__SAMPLING__"}}},processRequestString:function(){this.logger.trace("AltiRequestREST::processRequestString ()");var s="";return this.method==="POST"?s=this.template.post.value:this.method==="GET"&&(s=this.template.get.value),s=s.replace(/__LON__/g,this.DataObject.getLon()),s=s.replace(/__LAT__/g,this.DataObject.getLat()),s=s.replace(/__INDENT__/g,this.DataObject.indent),s=s.replace(/__CRS__/g,this.DataObject.crs),s=s.replace(/__RESOURCE__/g,this.DataObject.resource),s=s.replace(/__MEASURES__/g,this.DataObject.measures),s=s+this.__addDataInputs(),this.logger.trace("traduction tmpl",s),this.requestString=s,this.requestString},__addDataInputs:function(){this.logger.trace("AltiRequestREST::addDataInput ()");var s;if(this.method==="POST")s=this.template.post;else if(this.method==="GET")s=this.template.get;else throw new Error("No other HTTP method supported by the service !");var e=null;if(this.DataObject.CLASSNAME==="AltiElevationRequest")return e=s.input.point,e.replace(/__ZONLY__/g,this.DataObject.zonly.toString());if(this.DataObject.CLASSNAME==="AltiProfilRequest")return e=s.input.profil,e.replace(/__SAMPLING__/g,this.DataObject.sampling);throw new Error("No other object supported than elevation or profil !?")}};function WPS(s){if(this.logger=LoggerByDefault$1.getLogger(),this.logger.trace("[Constructeur WPS()]"),!(this instanceof WPS))throw new TypeError("WPS constructor cannot be called as a function.");if(this.options=s||{},this.DataObject=this.options.data,!this.DataObject)throw new TypeError("This data object is not defined !");this.paramservice=this.options.param.service||"WPS",this.paramversion=this.options.param.version||"1.0.0",this.paramidentifier=this.options.param.identifier||"gs:WPS",this.paramrawdataoutput=this.options.param.rawdataoutput||"result",this.paramrequest=this.options.param.request||"Execute",this.method=this.options.method||"GET"}WPS.prototype={requestString:null,constructor:WPS,template:{get:{value:"service=__SERVICE__&version=__VERSION__&rawdataoutput=__RAWDATAOUTPUT__&identifier=__IDENTIFIER__&request=__REQUEST__&datainputs=<!-- __DATAINPUTS__ -->",input:"__KEY__=__DATA__"},post:{value:'<?xml version="1.0" encoding="UTF-8"?><wps:__REQUEST__ version="__VERSION__" service="__SERVICE__" __NAMESPACE__ __SCHEMALOCATION__><ows:Identifier>__IDENTIFIER__</ows:Identifier><wps:DataInputs><!-- __DATAINPUTS__ --></wps:DataInputs><wps:ResponseForm><wps:RawDataOutput><ows:Identifier>__RAWDATAOUTPUT__</ows:Identifier></wps:RawDataOutput></wps:ResponseForm></wps:__REQUEST__>',input:"<wps:Input><ows:Identifier>__KEY__</ows:Identifier><wps:Data><wps:LiteralData>__DATA__</wps:LiteralData></wps:Data></wps:Input>"}},namespaceByDefault:function(){var s=['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns="http://www.opengis.net/wps/1.0.0"','xmlns:wfs="http://www.opengis.net/wfs"','xmlns:wps="http://www.opengis.net/wps/1.0.0"','xmlns:ows="http://www.opengis.net/ows/1.1"','xmlns:gml="http://www.opengis.net/gml"','xmlns:ogc="http://www.opengis.net/ogc"','xmlns:wcs="http://www.opengis.net/wcs/1.1.1"','xmlns:xlink="http://www.w3.org/1999/xlink"'];return s.join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd"'},processRequestString:function(){this.logger.trace("WPS::processRequestString ()");var s="";if(this.method==="POST")s=this.template.post.value;else if(this.method==="GET")s=this.template.get.value;else return this.logger.error("No other method supported by the service !"),!1;return s=s.replace(/__SERVICE__/g,this.paramservice),s=s.replace(/__VERSION__/g,this.paramversion),s=s.replace(/__RAWDATAOUTPUT__/g,this.paramrawdataoutput),s=s.replace(/__IDENTIFIER__/g,this.paramidentifier),s=s.replace(/__REQUEST__/g,this.paramrequest),this.method==="POST"&&(s=s.replace(/__NAMESPACE__/g,this.namespaceByDefault),s=s.replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault)),s=s.replace(/<!-- __DATAINPUTS__ -->/g,this.__addDataInputs()),s?(this.requestString=s,this.logger.trace("traduction tmpl",s),!0):(this.logger.warn("traduction tmpl : empty request !?"),!1)},__addDataInputs:function(){this.logger.trace("WPS::__addDataInputs ()");for(var s=this.method==="GET"?this.template.get.input:this.template.post.input,e=this.method==="GET"?";":"",i="",n=this,o=this.DataObject.getData(),l=0;l<o.length;l++)(function(c){e&&(e=c===o.length-1?"":";"),i=i.concat(n.__addDataInput(s,o[c].k,o[c].v),e)})(l);return i},__addDataInput:function(s,e,i){var n=s;return n=n.replace(/__KEY__/g,e),n=n.replace(/__DATA__/g,i),n},setMethod:function(s){s==="GET"||s==="POST"?this.method=s:this.logger.warn("support only GET and POST method !")},getMethod:function(){return this.method}};var AltiRequestWPS={build:function(s){var e=LoggerByDefault$1.getLogger("AltiRequestWPS");if(e.trace(["AltiRequestWPS::build()"]),!s)throw new Error(MessagesResources.getMessage("PARAM_EMPTY","options"));if(!s.type)throw new Error(MessagesResources.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));var i=null;switch(s.type){case"Elevation":s.wps.identifier="gs:WPSElevation",i=new AltiElevationRequest(s.param);break;case"Profil":s.wps.identifier="gs:WPSLineElevation",i=new AltiProfilRequest(s.param);break;default:throw new Error(MessagesResources.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}var n={data:i,method:s.method,param:s.wps},o=new WPS(n);if(!o.processRequestString())throw new Error("Enable to process request !");return o.requestString}},AltiRequestFactory={build:function(s){var e=LoggerByDefault$1.getLogger("AltiRequestFactory");e.trace(["AltiRequestFactory::build()"]);var i=null,n={type:s.sampling?"Profil":"Elevation",method:s.httpMethod,param:{positions:null,delimiter:null,indent:null,crs:null,format:null,sampling:null,zonly:null,measures:null}};n.param.positions=s.positions,n.param.format=s.outputFormat,n.param.sampling=s.sampling,n.param.zonly=s.zonly,n.param.measures=s.measures,n.param.resource=s.resource;var o=s.onError!==null&&typeof s.onError=="function",l=s.onSuccess!==null&&typeof s.onSuccess=="function",c=null;switch(s.api){case"REST":var u=new AltiRequestREST(n);if(!u.processRequestString()){if(c="Error in process request (rest) !",o){s.onError.call(s.scope,new ErrorService(c));return}throw new Error(c)}i=u.requestString;break;case"WPS":if(n.wps={service:null,version:null,identifier:null,rawdataoutput:null,request:null},i=AltiRequestWPS.build(n),!i){if(c="Error in process request (wps) !",o){s.onError.call(s.scope,new ErrorService(c));return}throw new Error(c)}break;default:if(c="Type of API is not supported by service (REST or WPS) !",o){s.onError.call(s.scope,new ErrorService(c));return}throw new Error(c)}return l&&s.onSuccess.call(s.scope,i),i}};function XML$1(s){if(!(this instanceof XML$1))throw new TypeError("XML constructor cannot be called as a function.");this.logger=LoggerByDefault$1.getLogger(),this.logger.trace("[Constructeur XML ()]"),this.xmlString=null,this.xmlDoc=null,this.reader=null,s&&(s.xmlString&&typeof s.xmlString=="string"&&(this.xmlString=s.xmlString,this.xmlDoc=__getXMLDOC(s.xmlString)),s.reader&&this.setReader(s.reader))}XML$1.prototype={constructor:XML$1,getXMLString:function(){return this.xmlString},setXMLString:function(s){s&&typeof s=="string"&&(this.xmlString=s,this.xmlDoc=__getXMLDOC(s))},getReader:function(){return this.reader},setReader:function(s){s&&s.read&&typeof s.read=="function"&&(this.reader=s)},getXMLDoc:function(){return this.xmlDoc},setXMLDoc:function(s){this.xmlDoc=s},parse:function(){if(!this.xmlDoc&&this.xmlString&&(this.xmlDoc=__getXMLDOC(this.xmlString)),this.xmlDoc){var s=__getRootNode(this.xmlDoc);if(s){var e;return this.reader&&this.reader.read?e=this.reader.read(s):(e={},e[s.nodeName]=__readDefault(s)),e}else return{}}}};function __getXMLDOC(s){if(typeof window>"u"){var e=require("@xmldom/xmldom").DOMParser;return new e().parseFromString(s,"text/xml")}else{var i,n,o="Erreur lors du parsing de la rponse du service : XML non conforme";if(window.ActiveXObject){n=new window.ActiveXObject("Microsoft.XMLDOM"),n.async=!1,n.loadXML(s);var l=n.parseError;if(l.errorCode)throw l.line&&l.linepos&&(o+="( ligne "+l.line+", colonne "+l.linepos),l.reason&&(o+=":  "+l.reason+")"),new Error(o);return n}else if(window.DOMParser){i=new window.DOMParser;try{n=i.parseFromString(s,"text/xml")}catch(f){throw f.message==="SyntaxError"?new Error(o):new Error("Erreur lors du parsing de la rponse du service : "+f.message)}if(n.getElementsByTagName("parsererror").length>0)for(var c=n.getElementsByTagName("parsererror"),u=0;u<c.length;u++){var h=c[u].innerHTML;if(h.indexOf("Huge input lookup")===-1)throw o+="("+h+")",new Error(o)}else if(!n.documentElement)throw new Error(o);return n}else throw new Error("Incompatible DOM Parser pour ce navigateur !")}}function __getRootNode(s){var e;return s.nodeType===9?e=s.documentElement:s.nodeType===1&&(e=s),e}function __readDefault(s){var e={};if(s.attributes.length>0){var i=__getAttributes(s);e.attributes=i}if(s.hasChildNodes()){for(var n={},o,l=s.childNodes,c=0;c<l.length;c++)if(o=l[c],o.nodeType===3)e.textContent=o.nodeValue;else if(o.nodeType===1)if(n=__readDefault(o),!e[o.nodeName])e[o.nodeName]=n;else{if(!Array.isArray(e[o.nodeName])){var u=e[o.nodeName];e[o.nodeName]=[],e[o.nodeName].push(u)}e[o.nodeName].push(n)}}return e}function __getAttributes(s){if(s.attributes.length>0){for(var e={},i=s.attributes,n=0;n<i.length;n++){var o=i[n];e[o.nodeName]=o.nodeValue}return e}}function AltiResponse(){if(!(this instanceof AltiResponse))throw new TypeError("AltiResponse constructor cannot be called as a function.");this.elevations=[]}AltiResponse.prototype={constructor:AltiResponse};function Elevation(){if(!(this instanceof Elevation))throw new TypeError("Elevation constructor cannot be called as a function.");this.z=null}Elevation.prototype={constructor:Elevation};function Measure(){if(!(this instanceof Measure))throw new TypeError("Measure constructor cannot be called as a function.");this.source_name=null,this.source_measure=null,this.z=null,this.acc=null}Measure.prototype={constructor:Measure};var AltiResponseReader={};AltiResponseReader.READERS={elevations:function(s){var e=new AltiResponse;if(s.hasChildNodes())for(var i=s.childNodes,n,o,l=0;l<i.length;l++)n=i[l],AltiResponseReader.READERS[n.nodeName]&&(o=AltiResponseReader.READERS[n.nodeName](n),e.elevations.push(o));return e},elevation:function(s){var e=new Elevation;if(s.hasChildNodes())for(var i=s.childNodes,n,o=0;o<i.length;o++)n=i[o],AltiResponseReader.READERS[n.nodeName]&&AltiResponseReader.READERS[n.nodeName](n,e);return e},lat:function(s,e){var i=s.firstChild;if(i&&i.nodeType===3)e.lat=parseFloat(i.nodeValue);else throw new Error("Erreur dans la lecture de la rponse du service : latitude attendue mais absente")},lon:function(s,e){var i=s.firstChild;if(i&&i.nodeType===3)e.lon=parseFloat(i.nodeValue);else throw new Error("Erreur dans la lecture de la rponse du service : longitude attendue mais absente")},z:function(s,e){var i=s.firstChild;if(i&&i.nodeType===3)if(e)e.z=parseFloat(i.nodeValue);else return e=new Elevation,e.z=parseFloat(i.nodeValue),e;else throw new Error("Erreur dans la lecture de la rponse du service : altitude attendue mais absente")},acc:function(s,e){var i=s.firstChild;if(i&&i.nodeType===3)e.acc=parseFloat(i.nodeValue);else throw new Error("Erreur dans la lecture de la rponse du service : prcision (acc) attendue mais absente")},source_name:function(s,e){var i=s.firstChild;if(i&&i.nodeType===3)e.source_name=i.nodeValue;else throw new Error("Erreur dans la lecture de la rponse du service : source_name attendue mais absente")},source_measure:function(s,e){var i=s.firstChild;if(i&&i.nodeType===3)e.source_measure=i.nodeValue;else throw new Error("Erreur dans la lecture de la rponse du service : source_measure attendue mais absente")},measures:function(s,e){e.measures=[];var i;if(s.hasChildNodes())for(var n=s.childNodes,o,l,c=0;c<n.length;c++){i=new Measure,o=n[c],l=o.childNodes;for(var u=0;u<l.length;u++)if(AltiResponseReader.READERS[l[u].nodeName])AltiResponseReader.READERS[l[u].nodeName](l[u],i);else throw new Error("Erreur dans la lecture de la rponse du service : measures attendues mais absentes");e.measures.push(i)}},exceptionreport:function(s){var e={};if(s.hasChildNodes())for(var i=s.childNodes,n,o=0;o<i.length;o++)n=i[o],n.nodeName==="Exception"&&(e.exceptionReport=AltiResponseReader.READERS.exception(n));return e},exception:function(s){var e={},i=s.getAttribute("exceptionCode");i&&(e.exceptionCode=i);var n=s.firstChild;return n&&n.nodeType===3&&(e.exception=n.nodeValue),e},error:function(s){var e={error:{}};if(s.hasChildNodes())for(var i=s.childNodes,n,o=0;o<i.length;o++){n=i[o];var l;n.nodeType===1&&n.nodeName==="code"&&(l=n.firstChild,l&&l.nodeType===3&&(e.error.code=l.nodeValue)),n.nodeType===1&&n.nodeName==="description"&&(l=n.firstChild,l&&l.nodeType===3&&(e.error.description=l.nodeValue))}return e}};AltiResponseReader.read=function(s){if(s.nodeName==="elevations"){var e=AltiResponseReader.READERS.elevations(s);return e}else if(s.nodeName==="ExceptionReport"){var i=AltiResponseReader.READERS.exceptionreport(s);return i}else if(s.nodeName==="error"){var n=AltiResponseReader.READERS.error(s);return n}else throw new Error("Erreur lors de la lecture de la rponse : elle n'est pas au format attendu.")};var AltiResponseFactory={build:function(s){var e=LoggerByDefault$1.getLogger("AltiResponseFactory");e.trace(["AltiResponseFactory::build()"]);var i=null;if(s.response)if(s.rawResponse)e.trace("analyze response : raw"),i=s.response;else{switch(s.outputFormat){case"xml":e.trace("analyze response : xml");try{var n=new XML$1({reader:AltiResponseReader});if(typeof s.response=="string"?n.setXMLString(s.response):n.setXMLDoc(s.response),i=n.parse(),!i)throw new Error(MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(H){var o=H.message;s.onError.call(s.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",o),status:200,type:ErrorService.TYPE_SRVERR}));return}break;case"json":e.trace("analyze response : json"),e.trace("analyze response : ",typeof s.response);var l=null;if(typeof s.response=="string"?l=JSON.parse(s.response):l=s.response,l&&l.error){s.onError.call(s.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",l.error.description),status:200,type:ErrorService.TYPE_SRVERR}));return}if(l){var c=l.elevations,u=new AltiResponse,h;if(Array.isArray(c)&&c.length)for(var f=0;f<c.length;f++)h=new Elevation,typeof c[f]=="object"?(c[f].lon&&(h.lon=c[f].lon),c[f].lat&&(h.lat=c[f].lat),c[f].z&&(h.z=c[f].z),c[f].acc&&(h.acc=c[f].acc),c[f].measures&&(h.measures=c[f].measures)):typeof c[f]=="number"&&(h.z=c[f]),Array.isArray(u.elevations)&&u.elevations.push(h);i=u}if(!i){s.onError.call(s.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:ErrorService.TYPE_UNKERR,status:-1}));return}break;default:s.onError.call(s.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_FORMAT_2"),type:ErrorService.TYPE_UNKERR,status:-1}));return}if(i.exceptionReport){s.onError.call(s.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",i.exceptionReport),type:ErrorService.TYPE_SRVERR,status:200}));return}else if(i.error){var g=i.error.description;s.onError.call(s.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",g),type:ErrorService.TYPE_SRVERR,status:200}));return}}else{s.onError.call(s.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")));return}s.onSuccess.call(s.scope,i)}};function Alti(s){if(!(this instanceof Alti))throw new TypeError(MessagesResources.getMessage("CLASS_CONSTRUCTOR","Alti"));if(this.CLASSNAME="Alti",CommonService.apply(this,arguments),this.logger=LoggerByDefault$1.getLogger("Gp.Services.Alti"),this.logger.trace("[Constructeur Alti (options)]"),!s.positions)throw new Error(MessagesResources.getMessage("PARAM_MISSING","positions"));if(s.positions.length===0)throw new Error(MessagesResources.getMessage("PARAM_EMPTY","positions"));if(this.options.positions=s.positions,this.options.outputFormat=typeof s.outputFormat=="string"?s.outputFormat.toLowerCase():"xml",this.options.resource=s.resource||"ign_rge_alti_wld",this.options.sampling=s.sampling||null,this.options.api=typeof s.api=="string"?s.api.toUpperCase():"REST",this.options.api==="REST"&&(this.options.httpMethod="GET"),this.options.zonly=s.zonly||!1,this.options.measures=s.measures||!1,!this.options.serverUrl){var e=DefaultUrlService.Alti.newUrl(),i=null;switch(this.options.api){case"WPS":i=e.wps;break;case"REST":var n=(s.sampling?"profil":"elevation")+"-"+this.options.outputFormat;i=e[n];break;default:throw new Error(MessagesResources.getMessage("PARAM_UNKNOWN","api"))}if(!i)throw new Error("Url by default not found !");this.options.serverUrl=i,this.logger.trace("Server URL by default : "+this.options.serverUrl)}var o=this.options.serverUrl.lastIndexOf(".");if(o!==-1){var l=this.options.serverUrl.substring(o+1);if(l&&l.length<5)switch(this.logger.trace("Server Extension URL : "+l),l.toLowerCase()){case"json":case"xml":this.options.outputFormat=l.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}Alti.prototype=Object.create(CommonService.prototype,{});Alti.prototype.constructor=Alti;Alti.prototype.buildRequest=function(s,e){var i={httpMethod:this.options.httpMethod,onSuccess:function(n){this.request=n,e.call(this,this.request)},onError:s,scope:this,resource:this.options.resource,positions:this.options.positions,outputFormat:this.options.outputFormat,sampling:this.options.sampling,api:this.options.api,zonly:this.options.zonly,measures:this.options.measures};AltiRequestFactory.build(i)};Alti.prototype.analyzeResponse=function(s,e){if(this.response){var i={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:s,onSuccess:e,scope:this};AltiResponseFactory.build(i)}else s.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")))};function GeocodeParamREST(s){if(!(this instanceof GeocodeParamREST))throw new TypeError("GeocodeParamREST constructor cannot be called as a function.");if(this.logger=LoggerByDefault$1.getLogger(),this.logger.trace("[Constructeur GeocodeParamREST ()]"),this.options=s||{},!this.options.geocodeMethod||this.options.geocodeMethod!=="search"&&this.options.geocodeMethod!=="reverse")throw new Error("Error geocodeMethod not valid");this.geocodeMethod=this.options.geocodeMethod,this.query=typeof this.options<"u"?this.options.query:null,this.searchGeometry=this.options.searchGeometry||null,this.index=this.options.index||null,this.lon=this.options.position&&this.options.position.lon?this.options.position.lon:null,this.lat=this.options.position&&this.options.position.lat?this.options.position.lat:null,this.maxResp=this.options.maxResp||null,this.returnTrueGeometry=this.options.returnTrueGeometry||null,this.filters=this.options.filters||{}}GeocodeParamREST.CLASSNAME="GeocodeParamREST";GeocodeParamREST.prototype={constructor:GeocodeParamREST,getFilters:function(){var s={};for(var e in this.filters)this.filters.hasOwnProperty(e)&&(s[e]=this.filters[e]);return s},getIndex:function(){return this.index===void 0?null:this.index==="StreetAddress"?"address":this.index==="CadastralParcel"?"parcel":this.index==="PositionOfInterest"?"poi":this.index==="location"?"location":this.index},getSearchGeometry:function(){return JSON.stringify(this.searchGeometry)}};GeocodeParamREST.prototype.getParams=function(){var s=[];this.geocodeMethod==="search"&&s.push({k:"q",v:this.query}),this.index&&s.push({k:"index",v:this.getIndex()}),this.geocodeMethod==="reverse"&&this.searchGeometry&&s.push({k:"searchgeom",v:this.getSearchGeometry()}),this.lon&&this.lat&&(s.push({k:"lon",v:this.lon}),s.push({k:"lat",v:this.lat})),this.maxResp&&s.push({k:"limit",v:this.maxResp}),this.returnTrueGeometry&&s.push({k:"returntruegeometry",v:this.returnTrueGeometry});const e=this.getFilters();for(var i in e)s.push({k:i,v:e[i]});return s};function GeocodeRequestREST(s){if(this.logger=LoggerByDefault$1.getLogger("GeocodeRequestREST"),this.logger.trace("[Constructeur GeocodeRequestREST ()]"),!(this instanceof GeocodeRequestREST))throw new TypeError("GeocodeRequestREST constructor cannot be called as a function.");if(!s)throw new Error(MessagesResources.getMessage("PARAM_EMPTY","options"));this.settings=s}GeocodeRequestREST.prototype={requestString:null,constructor:GeocodeRequestREST,processRequestString:function(){var s="";const i=new GeocodeParamREST(this.settings).getParams();for(var n=0;n<i.length;n++){var o=i[n];s&&(s+="&"),s+=o.k+"="+o.v}if(!this.settings.geocodeMethod||this.settings.geocodeMethod!=="search"&&this.settings.geocodeMethod!=="reverse")throw new Error("Error geocodeMethod not valid");return this.requestString="?"+s,this.logger.trace(this.requestString),this.requestString}};var GeocodeRequestFactory={build:function(s){var e=LoggerByDefault$1.getLogger("GeocodeRequestFactory");e.trace(["GeocodeRequestFactory::build()"]);var i=s||{},n=new GeocodeRequestREST(i);if(!n.processRequestString())throw new Error("Error process request (rest) !");var o=n.requestString;return e.trace(o),o}};function GeocodeResponse(){if(!(this instanceof GeocodeResponse))throw new TypeError("GeocodeResponse constructor cannot be called as a function.");this.locations=[]}GeocodeResponse.prototype={constructor:GeocodeResponse};function GeocodedLocation(){if(!(this instanceof GeocodedLocation))throw new TypeError("GeocodedLocation constructor cannot be called as a function.");this.position=null,this.matchType=null,this.placeAttributes={},this.type=null,this.accuracy=null,this.CLASSNAME="GeocodedLocation"}GeocodedLocation.prototype={constructor:GeocodedLocation};function GeocodeResponseParser(){if(!(this instanceof GeocodeResponseParser))throw new TypeError("GeocodeResponseParser constructor cannot be called as a function.")}GeocodeResponseParser.prototype={constructor:GeocodeResponseParser,parse:function(s){var e=new GeocodeResponse;const i=JSON.parse(s);if(i.type==="FeatureCollection")for(var n=0;n<i.features.length;++n)_parseFeature(i.features[n],e);else if(i.type==="Feature")_parseFeature(i,e);else{if(i.type==="SERVICE_ERROR")return _parseError(i);var o=MessagesResources.getMessage("SERVICE_RESPONSE_ANALYSE",i.type);throw new ErrorService({message:o,type:ErrorService.TYPE_UNKERR,status:200})}return e}};function _parseFeature(s,e){var i=new GeocodedLocation;if(s.geometry&&s.geometry.type==="Point"&&(i.position={lon:s.geometry.coordinates[0],lat:s.geometry.coordinates[1]}),s.properties){for(var n in s.properties)n==="score"?i.accuracy=s.properties[n]:n==="_type"?s.properties[n]==="address"?i.type="StreetAddress":s.properties[n]==="poi"?i.type="PositionOfInterest":(s.properties[n]==="parcel"||s.properties[n]==="cadastral")&&(i.type="CadastralParcel"):i.placeAttributes[n]=s.properties[n];s.properties._type==="address"&&(i.matchType=s.properties.number!==void 0&&s.properties.number!==null?"street number":"street")}e.locations.push(i)}function _parseError(s){return{exceptionReport:s}}var GeocodeReponseFactory={build:function(s){var e=null;if(s.response)if(s.rawResponse)e=s.response;else{try{if(e=new GeocodeResponseParser().parse(s.response),!e)throw new Error("L'analyse de la rponse du service !?")}catch(n){var i=n.message;typeof s.response=="string"?i+="('"+s.response+"')":i+="('"+s.response.documentElement.innerHTML+"')",s.onError.call(s.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_ANALYSE",i),type:ErrorService.TYPE_UNKERR,status:-1}));return}if(e.exceptionReport){s.onError.call(s.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",e.exceptionReport),type:ErrorService.TYPE_SRVERR,status:200}));return}}else{s.onError.call(s.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY"),type:ErrorService.TYPE_SRVERR,status:-1}));return}s.onSuccess.call(s.scope,e)}};function Geocode(s){if(!(this instanceof Geocode))throw new TypeError(MessagesResources.getMessage("CLASS_CONSTRUCTOR","Geocode"));this.CLASSNAME="Geocode",this.logger=LoggerByDefault$1.getLogger("Gp.Services.Geocode"),this.logger.trace("[Constructeur Geocode (options)]");var e=this.patchOptionConvertor(s);if(e.serverUrl||(e.serverUrl=DefaultUrlService.Geocode.newUrl()),CommonService.apply(this,[e]),!e.hasOwnProperty("query"))throw new Error(MessagesResources.getMessage("PARAM_MISSING","query"));if(this.options.query=e.query,e.index||(this.options.index=e.index="StreetAddress"),e.filters)for(var i=Object.keys(e.filters),n=0;n<i.length;n++){var o=i[n];(typeof e.filters[o]>"u"||typeof e.filters[o]=="object"&&Object.keys(e.filters[o]).length===0||typeof e.filters[o]=="string"&&e.filters[o].length===0||Array.isArray(e.filters[o])&&e.filters[o].length===0)&&delete this.options.filters[o]}this.options.index=e.index||"StreetAddress",this.options.maximumResponses=e.maximumResponses||20}Geocode.prototype=Object.create(CommonService.prototype,{});Geocode.prototype.constructor=Geocode;Geocode.prototype.patchOptionConvertor=function(s){const e=s;return e.hasOwnProperty("location")&&(this.logger.warn("The parameter 'location' is deprecated"),e.query||(e.query=e.location),delete e.location),e.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),e.filters||(e.filters=e.filterOptions,e.filters.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),e.index||(Array.isArray(e.filters.type)&&e.filters.type.length>0?e.index=e.filters.type[0]:e.index=e.filters.type),delete e.filters.type),e.filters.bbox&&(this.logger.warn("The parameter 'filterOptions.bbox' is deprecated"),delete e.filters.bbox)),delete e.filterOptions),e.position&&(e.position.x&&(this.logger.warn("The parameter 'position.x' is deprecated"),e.position.lon||(e.position.lon=e.position.x),delete e.position.x),e.position.y&&(this.logger.warn("The parameter 'position.y' is deprecated"),e.position.lat||(e.position.lat=e.position.y),delete e.position.y)),e.returnFreeForm&&(this.logger.warn("The parameter 'returnFreeForm' is deprecated"),delete e.returnFreeForm),e.srs&&(this.logger.warn("The parameter 'srs' is deprecated"),delete e.srs),e};Geocode.prototype.buildRequest=function(s,e){var i={httpMethod:this.options.httpMethod,geocodeMethod:"search",query:this.options.query,index:this.options.index,returnTrueGeometry:this.options.returnTrueGeometry,position:this.options.position,maxResp:this.options.maximumResponses,filters:this.options.filters};this.request=GeocodeRequestFactory.build(i),this.request?e.call(this,this.request):s.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_REQUEST_BUILD")))};Geocode.prototype.analyzeResponse=function(s,e){if(this.response){var i={response:this.response,rawResponse:this.options.rawResponse,onError:s,onSuccess:e,scope:this};GeocodeReponseFactory.build(i)}else s.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")))};function ReverseGeocode$1(s){if(!(this instanceof ReverseGeocode$1))throw new TypeError(MessagesResources.getMessage("CLASS_CONSTRUCTOR","ReverseGeocode"));this.CLASSNAME="ReverseGeocode",this.logger=LoggerByDefault$1.getLogger("Gp.Services.ReverseGeocode"),this.logger.trace("[Constructeur ReverseGeocode (options)]");var e=this.patchOptionConvertor(s);if(e.serverUrl||(e.serverUrl=DefaultUrlService.ReverseGeocode.newUrl()),CommonService.apply(this,[e]),e.searchGeometry)this.options.searchGeometry=e.searchGeometry;else if(!e.position)throw new Error(MessagesResources.getMessage("PARAM_MISSING","searchGeometry"));if(e.index||(this.options.index=e.index="StreetAddress"),e.filters)for(var i=Object.keys(e.filters),n=0;n<i.length;n++){var o=i[n];(typeof e.filters[o]>"u"||typeof e.filters[o]=="object"&&Object.keys(e.filters[o]).length===0||typeof e.filters[o]=="string"&&e.filters[o].length===0||Array.isArray(e.filters[o])&&e.filters[o].length===0)&&delete this.options.filters[o]}this.options.position=e.position,this.options.index=e.index||"StreetAddress",this.options.maximumResponses=e.maximumResponses||20}ReverseGeocode$1.prototype=Object.create(CommonService.prototype,{});ReverseGeocode$1.prototype.constructor=ReverseGeocode$1;ReverseGeocode$1.prototype.patchOptionConvertor=function(s){var e=s;return e.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),e.filterOptions.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),e.index||(Array.isArray(e.filterOptions.type)&&e.filterOptions.type.length>0?e.index=e.filterOptions.type[0]:e.index=e.filterOptions.type),delete e.filterOptions.type),e.filterOptions.bbox&&(this.logger.warn("The parameter 'filterOptions.bbox' is deprecated"),e.searchGeometry||(e.searchGeometry=this.bbox2Json(e.filterOptions.bbox)),delete e.filterOptions.bbox),e.filterOptions.circle&&(this.logger.warn("The parameter 'filterOptions.circle' is deprecated"),e.searchGeometry||(e.searchGeometry=this.circle2Json(e.filterOptions.circle)),delete e.filterOptions.circle),e.filterOptions.polygon&&(this.logger.warn("The parameter 'filterOptions.polygon' is deprecated"),e.searchGeometry||(e.searchGeometry=this.polygon2Json(e.filterOptions.polygon)),delete e.filterOptions.polygon),!e.filters&&Object.keys(e.filterOptions).length>0&&(e.filters=e.filterOptions),delete e.filterOptions),e.position&&(e.position.x&&(this.logger.warn("The parameter 'position.x' is deprecated"),e.position.lon||(e.position.lon=e.position.x),delete e.position.x),e.position.y&&(this.logger.warn("The parameter 'position.y' is deprecated"),e.position.lat||(e.position.lat=e.position.y),delete e.position.y)),e.srs&&(this.logger.warn("The parameter 'srs' is deprecated"),delete e.srs),e};ReverseGeocode$1.prototype.buildRequest=function(s,e){var i={httpMethod:this.options.httpMethod,geocodeMethod:"reverse",searchGeometry:this.options.searchGeometry,index:this.options.index,position:this.options.position,returnTrueGeometry:this.options.returnTrueGeometry,maxResp:this.options.maximumResponses,filters:this.options.filters};this.request=GeocodeRequestFactory.build(i),this.request?e.call(this,this.request):s.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_REQUEST_BUILD")))};ReverseGeocode$1.prototype.analyzeResponse=function(s,e){if(this.response){var i={response:this.response,rawResponse:this.options.rawResponse,onError:s,onSuccess:e,scope:this};GeocodeReponseFactory.build(i)}else s.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")))};ReverseGeocode$1.prototype.bbox2Json=function(s){return{type:"Polygon",coordinates:[[[s.left,s.top],[s.right,s.top],[s.right,s.bottom],[s.left,s.bottom],[s.left,s.top]]]}};ReverseGeocode$1.prototype.circle2Json=function(s){return{type:"Circle",radius:s.radius,coordinates:[s.x,s.y]}};ReverseGeocode$1.prototype.polygon2Json=function(s){for(var e={type:"Polygon",coordinates:[[]]},i=0;i<s.length;++i)e.coordinates[0].push([s[i].x,s[i].y]);return e};ReverseGeocode$1.geoEPSG=["EPSG:4326"];function AutoCompleteResponse(){if(!(this instanceof AutoCompleteResponse))throw new TypeError("AutoCompleteResponse constructor cannot be called as a function.");this.suggestedLocations=[]}AutoCompleteResponse.prototype={constructor:AutoCompleteResponse};function SuggestedLocation(){if(!(this instanceof SuggestedLocation))throw new TypeError("SuggestedLocation constructor cannot be called as a function.");this.type=null,this.position={x:null,y:null},this.commune=null,this.fullText=null,this.postalCode=null,this.classification=null,this.street=null,this.poi=null,this.kind=null}SuggestedLocation.prototype={constructor:SuggestedLocation};var AutoCompleteResponseFactory={build:function(s){var e=LoggerByDefault$1.getLogger("AutoCompleteResponseFactory");e.trace(["AutoCompleteResponseFactory::build()"]);var i=null;if(s.response)if(s.rawResponse)e.trace("analyze response : raw"),i=s.response;else{var n=null;if(typeof s.response=="string"?n=JSON.parse(s.response):n=s.response,n){if(n.error){s.onError.call(s.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",n.error.description),status:n.error.code,type:ErrorService.TYPE_SRVERR}));return}if(i=new AutoCompleteResponse,n.results&&Array.isArray(n.results))for(var o=null,l=0;l<n.results.length;l++){var c=n.results[l];o=new SuggestedLocation,c&&(c.country==="StreetAddress"?(o.street=c.street,o.type="StreetAddress"):c.country==="PositionOfInterest"&&(o.poi=c.street,o.type="PositionOfInterest",o.poiType=c.poiType),o.position&&(o.position.x=c.x,o.position.y=c.y),o.kind=c.kind,o.commune=c.city,o.fullText=c.fulltext,o.postalCode=c.zipcode,o.classification=c.classification),i.suggestedLocations.push(o)}else{s.onError.call(s.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_FORMAT_3")));return}if(!i.suggestedLocations.length){s.onError.call(s.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_FORMAT_3")));return}}if(!i){s.onError.call(s.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:ErrorService.TYPE_UNKERR,status:-1}));return}if(i.exceptionReport){s.onError.call(s.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",i.exceptionReport),type:ErrorService.TYPE_SRVERR,status:200}));return}}else{s.onError.call(s.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")));return}s.onSuccess.call(s.scope,i)}};function AutoComplete(s){if(!(this instanceof AutoComplete))throw new TypeError(MessagesResources.getMessage("CLASS_CONSTRUCTOR","AutoComplete"));this.CLASSNAME="AutoComplete",this.logger=LoggerByDefault$1.getLogger("Gp.Services.AutoComplete"),this.logger.trace("[Constructeur AutoComplete (options)]");var e=this.patchOptionConvertor(s);if(e.serverUrl||(e.serverUrl=DefaultUrlService.AutoComplete.newUrl()),CommonService.apply(this,arguments),!e.text)throw new Error(MessagesResources.getMessage("PARAM_MISSING","text"));this.options.text=e.text,e.type||(e.type=["StreetAddress,PositionOfInterest"]),this.options.type=e.type,this.options.territory=e.terr||"",this.options.maximumResponses=e.maximumResponses||10,this.options.protocol==="XHR"&&this.options.httpMethod==="POST"&&(this.logger.warn("Le service ne gre pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"json"}AutoComplete.prototype=Object.create(CommonService.prototype,{});AutoComplete.prototype.constructor=AutoComplete;AutoComplete.prototype.patchOptionConvertor=function(s){const e=s;return e.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),e.filterOptions.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),e.type||(e.type=e.filterOptions.type)),e.filterOptions.territory&&(this.logger.warn("The parameter 'filterOptions.territory' is deprecated"),e.terr||(e.terr=e.filterOptions.territory)),delete e.filterOptions),e};AutoComplete.prototype.buildRequest=function(s,e){var i="";this.options.territory&&(i=this.options.territory);var n="";this.options.type&&(n=this.options.type.join(",")),this.request=Helper$1.normalyzeParameters({text:encodeURIComponent(this.options.text),type:n,terr:i,maximumResponses:this.options.maximumResponses}),this.request?e.call(this,this.request):s.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_REQUEST_BUILD")))};AutoComplete.prototype.analyzeResponse=function(s,e){if(this.response){var i={response:this.response,rawResponse:this.options.rawResponse,onSuccess:e,onError:s,scope:this};AutoCompleteResponseFactory.build(i)}else s.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")))};function RouteParamREST(s){if(!(this instanceof RouteParamREST))throw new TypeError("RouteParamREST constructor cannot be called as a function.");this.logger=LoggerByDefault$1.getLogger(),this.logger.trace("[Constructeur RouteParamREST ()]"),this.options=s||{},this.resource=this.options.resource,this.start=this.options.startPoint.x+","+this.options.startPoint.y,this.end=this.options.endPoint.x+","+this.options.endPoint.y,this.intermediates=this.options.viaPoints,this.profile=this.options.graph,this.crs=this.options.srs,this.constraints=this.options.constraints,this.optimization=this.options.routePreference,this.getSteps=this.options.geometryInInstructions?"true":"false",this.distanceUnit=this.options.distanceUnit,this.timeUnit=this.options.timeUnit,this.waysAttributes=this.options.waysAttributes}RouteParamREST.CLASSNAME="RouteParamREST";RouteParamREST.prototype={constructor:RouteParamREST,getIntermediates:function(){var s=[];if(this.intermediates.length!==0)for(var e=0;e<this.intermediates.length;e++){var i=this.intermediates[e];s.push(i.x+","+i.y)}return s.join("|")},getWaysAttributes:function(){return this.waysAttributes.join("|")},getProfile:function(){return this.profile},getDistanceUnit:function(){return this.distanceUnit==="m"?"meter":this.distanceUnit==="km"?"kilometer":""},getOptimization:function(){return this.optimization?this.optimization:""},getConstraints:function(){var s=[];if(this.constraints.length!==0)for(var e=0;e<this.constraints.length;e++)s.push(JSON.stringify(this.constraints[e]));return s.join("|")}};RouteParamREST.prototype.getParams=function(){var s=[];return s.push({k:"resource",v:this.resource}),s.push({k:"start",v:this.start}),s.push({k:"end",v:this.end}),s.push({k:"geometryFormat",v:"geojson"}),this.optimization&&s.push({k:"optimization",v:this.getOptimization()}),this.intermediates&&s.push({k:"intermediates",v:this.getIntermediates()}),this.profile&&s.push({k:"profile",v:this.getProfile()}),this.constraints&&s.push({k:"constraints",v:this.getConstraints()}),this.crs&&s.push({k:"crs",v:this.crs}),this.distanceUnit&&s.push({k:"distanceUnit",v:this.getDistanceUnit()}),this.timeUnit&&s.push({k:"timeUnit",v:this.timeUnit}),this.waysAttributes&&s.push({k:"waysAttributes",v:this.getWaysAttributes()}),s};function RouteRequestREST(s){if(this.logger=LoggerByDefault$1.getLogger("RouteRequestREST"),this.logger.trace("[Constructeur RouteRequestREST ()]"),!(this instanceof RouteRequestREST))throw new TypeError("RouteRequestREST constructor cannot be called as a function.");if(!s)throw new Error(MessagesResources.getMessage("PARAM_EMPTY","options"));this.settings=s}RouteRequestREST.prototype={requestString:null,constructor:RouteRequestREST,processRequestString:function(){this.logger.warn(" PROTOTYPE !");for(var s=new RouteParamREST(this.settings),e=s.getParams(),i="",n=0;n<e.length;n++){var o=e[n];i&&(i+="&"),i+=o.k+"="+o.v}return this.logger.trace(i),this.requestString=i,this.requestString}};var RouteRequestFactory={build:function(s){var e=LoggerByDefault$1.getLogger("RouteRequestFactory");e.trace(["RouteRequestFactory::build()"]);var i=null,n=s||{},o=s.onError!==null&&typeof s.onError=="function",l=null,c=new RouteRequestREST(n);if(!c.processRequestString()){if(l="Error process request (rest) !",o){s.onError.call(s.scope,new ErrorService(l));return}throw new Error(l)}return i=c.requestString,i}};function RouteResponse(){if(!(this instanceof RouteResponse))throw new TypeError("RouteResponse constructor cannot be called as a function.");this.totalTime=null,this.totalDistance=null,this.bbox={left:null,right:null,top:null,bottom:null},this.routeGeometry=null,this.routeInstructions=[]}RouteResponse.prototype={constructor:RouteResponse};function RouteInstruction(){if(!(this instanceof RouteInstruction))throw new TypeError("RouteInstruction constructor cannot be called as a function.");this.duration=null,this.distance=null,this.code=null,this.instruction=null,this.geometry=null}RouteInstruction.prototype={constructor:RouteInstruction};var RouteResponseFactory={build:function(s){var e=LoggerByDefault$1.getLogger("RouteResponseFactory");e.trace("RouteResponseFactory::build()");var i=null;if(s.response)if(s.rawResponse)e.trace("analyze response : raw"),i=s.response;else{e.trace("analyze response : json");var n;if(typeof s.response=="string"?n=JSON.parse(s.response):n=s.response,n){if(n.message){s.onError.call(s.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",n.message)));return}var o=[],l=[],c=[];if(i=new RouteResponse,i.hasOwnProperty("totalTime")&&(i.totalTime=parseFloat(n.duration)),i.hasOwnProperty("totalDistance")&&(i.totalDistance=parseFloat(n.distance)),i.hasOwnProperty("bbox")&&(i.bbox.left=parseFloat(n.bbox[0]),i.bbox.bottom=parseFloat(n.bbox[1]),i.bbox.right=parseFloat(n.bbox[2]),i.bbox.top=parseFloat(n.bbox[3])),i.hasOwnProperty("routeGeometry")&&!s.geometryInInstructions&&(i.routeGeometry=n.geometry),i.hasOwnProperty("routeInstructions")&&s.geometryInInstructions){var u=n.portions,h;if(Array.isArray(u)&&u.length)for(h=0;h<u.length;h++)o.push(u[h]);if(o.length)for(h=0;h<o.length;h++)l.push(o[h].steps);if(l.length)for(h=0;h<l.length;h++)c=c.concat(l[h]);c.forEach(function(f){switch(i.routeInstructions.push(new RouteInstruction),i.routeInstructions[i.routeInstructions.length-1].duration=f.duration,i.routeInstructions[i.routeInstructions.length-1].distance=f.distance,i.routeInstructions[i.routeInstructions.length-1].code="",i.routeInstructions[i.routeInstructions.length-1].instruction="",i.routeInstructions[i.routeInstructions.length-1].geometry=f.geometry,f.name==="Valeur non renseigne"&&(f.name=""),f.instruction.type){case"turn":i.routeInstructions[i.routeInstructions.length-1].instruction+="Tourner";break;case"new name":i.routeInstructions[i.routeInstructions.length-1].instruction+="Continuer tout droit";break;case"depart":i.routeInstructions[i.routeInstructions.length-1].instruction+="Dpart";break;case"arrive":i.routeInstructions[i.routeInstructions.length-1].instruction+="Arrive";break;case"merge":i.routeInstructions[i.routeInstructions.length-1].instruction+="Rejoindre";break;case"ramp":i.routeInstructions[i.routeInstructions.length-1].instruction+="Prendre la bretelle";break;case"on ramp":i.routeInstructions[i.routeInstructions.length-1].instruction+="Prendre la bretelle";break;case"off ramp":i.routeInstructions[i.routeInstructions.length-1].instruction+="Prendre la sortie";break;case"fork":i.routeInstructions[i.routeInstructions.length-1].instruction+="Sur la bifurcation, prendre";break;case"end of road":i.routeInstructions[i.routeInstructions.length-1].instruction+=" la fin de la route, prendre";break;case"use lane":i.routeInstructions[i.routeInstructions.length-1].instruction+="Utiliser la file";break;case"continue":i.routeInstructions[i.routeInstructions.length-1].instruction+="Continuer";break;case"roundabout":i.routeInstructions[i.routeInstructions.length-1].instruction+="Au rond-point";break;case"rotary":i.routeInstructions[i.routeInstructions.length-1].instruction+="Au rond-point";break;case"roundabout turn":i.routeInstructions[i.routeInstructions.length-1].instruction+="Au rond point, tourner";break;case"notification":i.routeInstructions[i.routeInstructions.length-1].instruction+="";break;default:i.routeInstructions[i.routeInstructions.length-1].instruction+="?"+f.instruction.type+"?";break}if(f.instruction.modifier)switch(f.instruction.modifier){case"uturn":i.routeInstructions[i.routeInstructions.length-1].instruction="Faire demi-tour";break;case"sharp right":i.routeInstructions[i.routeInstructions.length-1].instruction+=" compltement  droite";break;case"right":i.routeInstructions[i.routeInstructions.length-1].instruction+="  droite";break;case"slight right":i.routeInstructions[i.routeInstructions.length-1].instruction+=" lgrement  droite";break;case"straight":i.routeInstructions[i.routeInstructions.length-1].instruction="Continuer tout droit";break;case"slight left":i.routeInstructions[i.routeInstructions.length-1].instruction+=" lgrement  gauche";break;case"left":i.routeInstructions[i.routeInstructions.length-1].instruction+="  gauche";break;case"sharp left":i.routeInstructions[i.routeInstructions.length-1].instruction+=" compltement  gauche";break;default:i.routeInstructions[i.routeInstructions.length-1].instruction+=" ?"+f.instruction.modifier+"?";break}f.instruction.exit&&(i.routeInstructions[i.routeInstructions.length-1].instruction+=`${f.instruction.exit}e sortie`),f.attributes.name&&((f.attributes.name.nom_1_droite||f.attributes.name.toponyme)&&(i.routeInstructions[i.routeInstructions.length-1].instruction+=" sur"),f.attributes.name.nom_1_droite&&(i.routeInstructions[i.routeInstructions.length-1].instruction+=` ${f.attributes.name.nom_1_droite}`),f.attributes.name.toponyme&&(i.routeInstructions[i.routeInstructions.length-1].instruction+=` ${f.attributes.name.toponyme}`))})}}if(!i){s.onError.call(s.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_ANALYSE","json")));return}if(i.exceptionReport){s.onError.call(s.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION_2")));return}}else{s.onError.call(s.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")));return}s.onSuccess.call(s.scope,i)}};function Route$1(s){if(!(this instanceof Route$1))throw new TypeError(MessagesResources.getMessage("CLASS_CONSTRUCTOR","Route"));if(this.CLASSNAME="Route",CommonService.apply(this,arguments),this.logger=LoggerByDefault$1.getLogger("Gp.Services.Route"),this.logger.trace("[Constructeur Route (options)]"),!s.startPoint)throw new Error(MessagesResources.getMessage("PARAM_MISSING","startPoint"));if(s.startPoint.x===null)throw new Error(MessagesResources.getMessage("PARAM_MISSING","startPoint.x"));if(s.startPoint.y===null)throw new Error(MessagesResources.getMessage("PARAM_MISSING","startPoint.y"));if(!s.endPoint)throw new Error(MessagesResources.getMessage("PARAM_MISSING","endPoint"));if(s.endPoint.x===null)throw new Error(MessagesResources.getMessage("PARAM_MISSING","endPoint.x"));if(s.endPoint.y===null)throw new Error(MessagesResources.getMessage("PARAM_MISSING","endPoint.y"));if(s.outputFormat&&s.outputFormat!=="json"&&this.logger.warn("options.outputFormat could only be json"),this.options.outputFormat="json",this.options.resource=s.resource||"bdtopo-osrm",this.options.startPoint=s.startPoint,this.options.endPoint=s.endPoint,this.options.viaPoints=s.viaPoints||[],this.options.routePreference=s.routePreference||"fastest",s.graph?(s.graph==="Voiture"&&(this.options.graph="car"),s.graph==="Pieton"&&(this.options.graph="pedestrian")):this.options.graph="car",this.options.constraints=[],s.constraints)if(Array.isArray(s.constraints))for(var e=0;e<s.constraints.length;e++)this.options.constraints.push(s.constraints[e]);else throw new Error(MessagesResources.getMessage("PARAM_TYPE","constraints"));var i={},n={},o={};if(s.exclusions&&s.exclusions.length!==0){this.logger.warn("options.exclusions is DEPRECATED !!");for(var l=0;l<s.exclusions.length;l++){if(typeof s.exclusions[l]=="string")s.exclusions[l]=s.exclusions[l].toLowerCase();else continue;s.exclusions[l]==="toll"&&(o.constraintType="banned",o.key="wayType",o.operator="=",o.value="autoroute",this.options.constraints.push(o)),s.exclusions[l]==="tunnel"&&(i.constraintType="banned",i.key="wayType",i.operator="=",i.value="tunnel",this.options.constraints.push(i)),s.exclusions[l]==="bridge"&&(n.constraintType="banned",n.key="wayType",n.operator="=",n.value="pont",this.options.constraints.push(n))}}if(this.options.geometryInInstructions=s.geometryInInstructions||!1,this.options.provideBbox=s.provideBbox||!0,this.options.distanceUnit=s.distanceUnit||"m",this.options.timeUnit=s.timeUnit||"second",this.options.expectedStartTime=null,this.options.srs=s.srs||"EPSG:4326",this.options.waysAttributes=s.waysAttributes||[],!this.options.serverUrl){var c=DefaultUrlService.Route.newUrl();if(!c)throw new Error("Url by default not found !");this.options.serverUrl=c,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}}Route$1.prototype=Object.create(CommonService.prototype,{});Route$1.prototype.constructor=Route$1;Route$1.prototype.buildRequest=function(s,e){var i={resource:this.options.resource,startPoint:this.options.startPoint,endPoint:this.options.endPoint,viaPoints:this.options.viaPoints,provideBbox:this.options.provideBbox,constraints:this.options.constraints,distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,graph:this.options.graph,geometryInInstructions:this.options.geometryInInstructions,routePreference:this.options.routePreference,srs:this.options.srs,waysAttributes:this.options.waysAttributes};this.request=RouteRequestFactory.build(i),this.request?e.call(this,this.request):s.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_REQUEST_BUILD")))};Route$1.prototype.analyzeResponse=function(s,e){if(this.response){var i={distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:s,onSuccess:e,scope:this,geometryInInstructions:this.options.geometryInInstructions};RouteResponseFactory.build(i)}else s.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")))};function ProcessIsoCurveParam(s){if(!(this instanceof ProcessIsoCurveParam))throw new TypeError("ProcessIsoCurveParam constructor cannot be called as a function.");this.logger=LoggerByDefault$1.getLogger(),this.logger.trace("[Constructeur ProcessIsoCurveParam ()]"),this.options=s||{},this.id=this.options.id,this.resource=this.options.resource,this.point=this.options.position,this.crs=this.options.srs,this.profile=this.options.graph,this.constraints=this.options.constraints,this.reverse=this.options.reverse,this.timeUnit=this.options.timeUnit,this.distanceUnit=this.options.distanceUnit,this.options.method==="distance"?(this.costType="distance",this.costValue=this.options.distance,this.distanceUnit==="m"&&this.costValue>=5e4&&(this.distanceUnit="km",this.costValue/=1e3)):(this.costType="time",this.costValue=this.options.time)}ProcessIsoCurveParam.CLASSNAME="ProcessIsoCurveParam";ProcessIsoCurveParam.prototype={constructor:ProcessIsoCurveParam,getLocation:function(){return this.point.x+","+this.point.y},getDistanceUnit:function(){return this.distanceUnit==="m"?"meter":this.distanceUnit==="km"?"kilometer":""},getConstraints:function(){var s=[];if(this.constraints.length!==0)for(var e=0;e<this.constraints.length;e++)s.push(JSON.stringify(this.constraints[e]));return s.join("|")},getDirection:function(){return this.reverse?"arrival":"departure"}};ProcessIsoCurveParam.prototype.getParams=function(){var s=[];return s.push({k:"resource",v:this.resource}),s.push({k:"point",v:this.getLocation()}),s.push({k:"direction",v:this.getDirection()}),s.push({k:"costType",v:this.costType}),s.push({k:"costValue",v:this.costValue}),s.push({k:"profile",v:this.profile}),s.push({k:"timeUnit",v:this.timeUnit}),s.push({k:"distanceUnit",v:this.getDistanceUnit()}),this.crs&&s.push({k:"crs",v:this.crs}),this.constraints&&s.push({k:"constraints",v:this.getConstraints()}),s};function ProcessIsoCurveRequest(s){if(this.logger=LoggerByDefault$1.getLogger("ProcessIsoCurveRequest"),this.logger.trace("[Constructeur ProcessIsoCurveRequest ()]"),!(this instanceof ProcessIsoCurveRequest))throw new TypeError("ProcessIsoCurveRequest constructor cannot be called as a function.");if(!s)throw new Error(MessagesResources.getMessage("PARAM_EMPTY","options"));this.settings=s,this.mode=this.settings.httpMethod||"GET"}ProcessIsoCurveRequest.prototype={requestString:null,constructor:ProcessIsoCurveRequest,processRequestString:function(){var s="",e=0;switch(this.mode){case"GET":this.logger.trace("Process GET Request");var i=new ProcessIsoCurveParam(this.settings),n=i.getParams();for(e=0;e<n.length;e++){var o=n[e];s&&(s+="&"),s+=o.k+"="+o.v}break;case"POST":this.logger.trace("Process POST Request");var l={};l.resource=this.settings.resource,l.point=this.settings.position.x+","+this.settings.position.y,this.settings.method==="distance"?(l.costType="distance",l.costValue=this.settings.distance):(l.costType="time",l.costValue=this.settings.time),l.profile=this.settings.graph,this.settings.reverse?l.direction="arrival":l.direction="departure",l.constraints=this.settings.constraints,l.distanceUnit=this.settings.distanceUnit,l.timeUnit=this.settings.timeUnit,l.crs=this.settings.srs,s=JSON.stringify(l);break;default:this.logger.error("No other HTTP method supported by the service !")}return this.logger.trace(s),this.requestString=s,this.requestString}};function ProcessIsoCurveResponse(){if(!(this instanceof ProcessIsoCurveResponse))throw new TypeError("ProcessIsoCurveResponse constructor cannot be called as a function.");this.message=null,this.id=null,this.location={},this.location.x=null,this.location.y=null,this.srs=null,this.geometry=null,this.time=null,this.distance=null}ProcessIsoCurveResponse.prototype={constructor:ProcessIsoCurveResponse};var ProcessIsoCurveResponseFactory={build:function(s){var e=LoggerByDefault$1.getLogger("ProcessIsoCurveResponseFactory");e.trace(["ProcessIsoCurveResponseFactory::build()"]);var i=null;if(s.response)if(s.rawResponse)e.trace("analyze response : raw"),i=s.response;else{e.trace("analyze response : json");var n;if(typeof s.response=="string"?n=JSON.parse(s.response):n=s.response,i=new ProcessIsoCurveResponse,n){n.costType==="distance"?(i.time="",i.distance=n.costValue):(i.time=n.costValue,i.distance=""),i.message="",i.id="",i.srs=n.crs,i.geometry=n.geometry;var o=n.point.split(",");i.location&&(i.location.x=o[0],i.location.y=o[1])}else{s.onError.call(s.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_ANALYSE",s.response)));return}if(i.exceptionReport){s.onError.call(s.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",i.exceptionReport),type:ErrorService.TYPE_SRVERR,status:200}));return}}else{s.onError.call(s.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")));return}s.onSuccess.call(s.scope,i)}};function ProcessIsoCurve(s){if(!(this instanceof ProcessIsoCurve))throw new TypeError(MessagesResources.getMessage("CLASS_CONSTRUCTOR","ProcessIsoCurve"));if(this.CLASSNAME="ProcessIsoCurve",CommonService.apply(this,arguments),this.logger=LoggerByDefault$1.getLogger("Gp.Services.ProcessIsoCurve"),this.logger.trace("[Constructeur ProcessIsoCurve (options)]"),!s.position)throw new Error(MessagesResources.getMessage("PARAM_MISSING","position"));if(s.position.x===null)throw new Error(MessagesResources.getMessage("PARAM_MISSING","position.x"));if(s.position.y===null)throw new Error(MessagesResources.getMessage("PARAM_MISSING","position.y"));if(!s.time&&!s.distance)throw new Error("Parameter (s) 'distance' missing. Parameter time to calculate an isochrone, parameter distance for an isodistance");if(!s.time&&s.distance&&(this.options.method="distance",this.options.time&&delete this.options.time),s.time&&!s.distance&&(this.options.method="time",this.options.distance&&delete this.options.distance),this.options.method=this.options.method||"time",this.options.resource=s.resource||"bdtopo-valhalla",this.options.exclusions=s.exclusions||[],this.options.reverse=s.reverse||!1,this.options.srs=s.srs||"EPSG:4326",this.options.distanceUnit=s.distanceUnit||"m",this.options.timeUnit=s.timeUnit||"second",s.smoothing&&this.logger.warn("options.smoothing is DEPRECATED"),this.options.smoothing=!1,s.holes&&this.logger.warn("options.holes is DEPRECATED"),this.options.holes=!1,s.graph?(s.graph==="Voiture"&&(this.options.graph="car"),s.graph==="Pieton"&&(this.options.graph="pedestrian")):this.options.graph="car",this.options.constraints=[],s.constraints)if(Array.isArray(s.constraints))for(var e=0;e<s.constraints.length;e++)this.options.constraints.push(s.constraints[e]);else throw new Error(MessagesResources.getMessage("PARAM_TYPE","constraints"));var i={},n={},o={};if(s.exclusions&&s.exclusions.length!==0){this.logger.warn("options.exclusions is DEPRECATED !!");for(var l=0;l<s.exclusions.length;l++){if(typeof s.exclusions[l]=="string")s.exclusions[l]=s.exclusions[l].toLowerCase();else continue;s.exclusions[l]==="toll"&&(o.constraintType="banned",o.key="wayType",o.operator="=",o.value="autoroute",this.options.constraints.push(o)),s.exclusions[l]==="tunnel"&&(i.constraintType="banned",i.key="wayType",i.operator="=",i.value="tunnel",this.options.constraints.push(i)),s.exclusions[l]==="bridge"&&(n.constraintType="banned",n.key="wayType",n.operator="=",n.value="pont",this.options.constraints.push(n))}}if(this.options.outputFormat=typeof s.outputFormat=="string"?s.outputFormat.toLowerCase():"json",s.outputFormat&&s.outputFormat!=="json")throw new Error(MessagesResources.getMessage("PARAM_NOT_SUPPORT","outputFormat"));if(this.options.outputFormat="json",!this.options.serverUrl){var c=DefaultUrlService.ProcessIsoCurve.newUrl();if(!c)throw new Error("Url by default not found !");this.options.serverUrl=c,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}}ProcessIsoCurve.prototype=Object.create(CommonService.prototype,{});ProcessIsoCurve.prototype.constructor=ProcessIsoCurve;ProcessIsoCurve.prototype.buildRequest=function(s,e){try{var i=new ProcessIsoCurveRequest(this.options);if(!i.processRequestString())throw new Error(MessagesResources.getMessage("SERVICE_REQUEST_BUILD"));this.request=i.requestString}catch(n){s.call(this,new ErrorService(n.message));return}e.call(this,this.request)};ProcessIsoCurve.prototype.analyzeResponse=function(s,e){if(this.response){var i={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onSuccess:e,onError:s,scope:this};ProcessIsoCurveResponseFactory.build(i)}else s.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")))};var Services={getConfig:function(s){var e=new Config$1(s);e.call()},getAltitude:function(s){var e=new Alti(s);e.call()},geocode:function(s){var e=new Geocode(s);e.call()},reverseGeocode:function(s){var e=new ReverseGeocode$1(s);e.call()},autoComplete:function(s){var e=new AutoComplete(s);e.call()},route:function(s){var e=new Route$1(s);e.call()},isoCurve:function(s){var e=new ProcessIsoCurve(s);e.call()}};const servicesVersion=Pkg.version,servicesDate=Pkg.date;var Gp={};Gp.servicesVersion=servicesVersion;Gp.servicesDate=servicesDate;Gp.Protocols={};Gp.Protocols.XHR=XHR;Gp.Services=Services;Gp.Services.DefaultUrl=DefaultUrlService;Gp.Services.AltiResponse=AltiResponse;Gp.Services.Alti={};Gp.Services.Alti.Elevation=Elevation;Gp.Services.AutoCompleteResponse=AutoCompleteResponse;Gp.Services.AutoComplete={};Gp.Services.AutoComplete.SuggestedLocation=SuggestedLocation;Gp.Services.Config=Config$1;Gp.Services.IsoCurveResponse=ProcessIsoCurveResponse;Gp.Services.RouteResponse=RouteResponse;Gp.Services.Route={};Gp.Services.Route.RouteInstruction=RouteInstruction;Gp.Error=ErrorService;Gp.Helper=Helper$1;var LoggerByDefault={getLogger:function(s){if(typeof e>"u"){var e={};e.env={VERBOSE:!1}}e.env.VERBOSE?loglevelExports.enableAll():loglevelExports.disableAll();var i=s||"default";return loglevelExports.getLogger(i)},disableAll:function(){var s=loglevelExports.getLoggers();for(const e in s)Object.hasOwnProperty.call(s,e)&&s[e].disableAll()},enableAll:function(){var s=loglevelExports.getLoggers();for(const e in s)Object.hasOwnProperty.call(s,e)&&s[e].enableAll()}};window.Gp&&(window.Gp.Logger=LoggerByDefault);var ProxyUtils={proxifyUrl:function(s,e){var i=LoggerByDefault.getLogger("proxifyUrl");if(!e||!e.hasOwnProperty("proxyUrl")||e.proxyUrl===null||e.proxyUrl.trim().length===0)return s;if(e.noProxyDomains&&Array.isArray(e.noProxyDomains)&&e.noProxyDomains.length>0){for(var n in e.noProxyDomains)if(i.trace("[ProxyUtils] proxifyUrl : analyzing "+e.noProxyDomains[n]),s.indexOf(e.noProxyDomains[n])!==-1)return i.info("[ProxyUtils] proxifyUrl : "+s+" found in noProxyDomains list ("+e.noProxyDomains[n]+")."),s}return e.proxyUrl+encodeURIComponent(s)}},logger$H=LoggerByDefault.getLogger("GfiUtils"),Gfi={getLayerFormat:function(s){var e=typeof s.getType=="function"?s.getType():null,i=s.getSource();if(e){if(e==="VECTOR"||e==="VECTOR_TILE")return"vector";if(e==="TILE")return i.tileGrid?"wmts":"wms";if(e==="IMAGE")return"wms"}else{if(i instanceof TileWMS||i instanceof ImageWMS)return"wms";if(i instanceof WMTS$1)return"wmts";if(i instanceof VectorSource||i instanceof VectorTile)return"vector"}return"unknown"},displayInfo:function(s,e,i,n,o){if(logger$H.trace("[Gfi] : displayInfo..."),n||(n="text/html"),i!==null){var l=null,c=null,u=i;u=u.replace(/\n/g,""),u=u.replace(/(>)\s*(<)/g,"$1$2");var h=typeof window<"u"?window:null;if(typeof exports=="object"&&window===null){var f=require("@xmldom/xmldom").DOMParser;c=new f,l=c.parseFromString(u,n)}else if(h.DOMParser)c=new h.DOMParser,l=c.parseFromString(u,n);else if(h.ActiveXObject)l=new h.ActiveXObject("Microsoft.XMLDOM"),l.async=!1,l.loadXML(u);else return logger$H.log("Incompatible environment for DOM Parser !"),!1;var g=l.getElementsByTagName("body");if(g&&g.length===1&&!g[0].hasChildNodes())return!1;var H=document.createElement("div");H.className="gp-feature-info-div";var Y=document.createElement("button");Y.className="gp-styling-button closer",Y.onclick=function(){return s.featuresOverlay&&(s.removeOverlay(s.featuresOverlay),s.featuresOverlay=null),!1};var ee=document.createElement("div");return ee.className="gp-features-content-div",ee.innerHTML=i,H.appendChild(ee),H.appendChild(Y),s.featuresOverlay&&(s.removeOverlay(s.featuresOverlay),s.featuresOverlay=null),s.featuresOverlay=new Overlay({element:H,autoPan:o.autoPan,autoPanAnimation:o.autoPanAnimation,autoPanMargin:o.autoPanMargin,positioning:"bottom-center",insertFirst:!1,stopEvent:!0}),s.addOverlay(s.featuresOverlay),s.featuresOverlay.setPosition(e),s.featuresOverlay.render(),!0}},features2html:function(s,e){var i=document.createElement("div");return e.forEach(function(n){var o=n.getProperties();if(o.hasOwnProperty("render"))i.insertAdjacentHTML("beforeend",o.render);else{if(o.hasOwnProperty("name")){var l=document.createElement("div");l.className="gp-att-name-div",l.insertAdjacentHTML("afterbegin",o.name),i.appendChild(l)}if(o.hasOwnProperty("description")){var c=document.createElement("div");c.className="gp-att-description-div",c.insertAdjacentHTML("afterbegin",o.description),i.appendChild(c)}var u=null,h=!1,f=null,g=null,H=null,Y=["fill","fill-opacity","label-stroke","stroke","stroke-opacity","stroke-width","marker-symbol","marker-color","marker-size","geometry","value","name","description","styleUrl","extensionsNode_","icon"];for(u in o)if(o[u]!==void 0&&Y.indexOf(u)===-1){h||(f=document.createElement("div"),f.className="gp-att-others-div",g=document.createElement("ul"),h=!0),H=document.createElement("li");var ee=document.createElement("span");ee.className="gp-attname-others-span",ee.appendChild(document.createTextNode(u+" : ")),H.appendChild(ee),H.appendChild(document.createTextNode(o[u])),g.appendChild(H)}g&&(f.appendChild(g),i.appendChild(f))}},s),i.hasChildNodes()||(i=null),i},layerGetFeatureAtCoordinates:function(s,e,i){var n=s.getPixelFromCoordinate(i);return s.hasFeatureAtPixel(n,function(o){return o===e})},displayVectorFeatureInfo:function(s,e,i,n){var o=s.getPixelFromCoordinate(e),l=[];if(s.forEachFeatureAtPixel(o,function(u,h){(!i||i.indexOf(h)>-1)&&l.push(u)}),l.length===0)return!1;var c=this.features2html(s,l);return c===null?!1:(this.displayInfo(s,e,c.innerHTML,"text/html",n),!0)},displayFeatureInfo:function(s,e,i,n,o){for(var l={},c=0;c<i.length;c++){var u=i[c],h=u.obj.getZIndex();l[h]||(l[h]=[]),l[h].push(u)}var f=[],g=Object.keys(l);g.sort(function(at,ot){return ot-at});for(var H=0;H<g.length;H++)for(var Y=g[H],ee=0;ee<l[Y].length;++ee){var te=l[Y][ee].obj,xe=l[Y][ee].infoFormat||"text/html",ne=!0;if(te.minResolution&&te.minResolution>s.getResolution()&&(ne=!1),ne&&te.maxResolution&&te.maxResolution<s.getResolution()&&(ne=!1),te.getVisible()&&ne){var et=this.getLayerFormat(te);if(et==="vector"){this.layerGetFeatureAtCoordinates(s,te,e)&&f.push({format:et,scope:this,coordinate:e});continue}else if(et!=="wms"&&et!=="wmts"){logger$H.log("[ERROR] DisplayFeatureInfo - layer format '"+et+"' not allowed");continue}var tt=s.getView().getResolution(),it=null;et==="wmts"?it=te.getSource().getFeatureInfoUrl.call(te.getSource(),e,tt,s.getView().getProjection(),{INFOFORMAT:xe}):it=te.getSource().getFeatureInfoUrl.call(te.getSource(),e,tt,s.getView().getProjection(),{INFO_FORMAT:xe}),f.push({format:xe,url:ProxyUtils.proxifyUrl(it,n),scope:this,coordinate:e})}}var rt=null;function nt(at,ot,ct){if(at.length===0)return;var ht=0;function ut(pt){ht++,pt||ht===at.length?ct():ot(at[ht],ut)}ot(at[0],ut)}var st=this;nt(f,function(at,ot){if(at.format==="vector"){if(!rt){rt=[];for(var ct=0;ct<g.length;ct++)for(var ht=g[ct],ut=0;ut<l[ht].length;++ut)rt.push(l[ht][ut].obj)}ot(at.scope.displayVectorFeatureInfo(s,at.coordinate,rt,o))}else Gp.Protocols.XHR.call({url:at.url,method:"GET",scope:at.scope,onResponse:function(pt){var yt=!1;(pt.trim().length===0||pt.indexOf("ServiceExceptionReport")!==-1||pt.indexOf("java.lang.NullPointerException")!==-1||pt.indexOf("java.lang.OutOfMemoryError")!==-1||pt.indexOf("not queryable")!==-1)&&(yt=!0);var mt=!yt&&st.displayInfo(s,at.coordinate,pt,"text/html",o);ot(mt)},onFailure:function(pt){logger$H.log(pt),ot(!1)}})},function(){logger$H.trace("Finish sync to GFI !")})},getPosition:function(s,e){if(s.coordinate)return s.coordinate;var i=[0,0];if(s.offsetX||s.offsetY)i[0]=s.offsetX,i[1]=s.offsetY;else if(s.pointerType==="touch"){var n=s.pointers[0];i[0]=n.pageX,i[1]=n.pageY}var o=e.getCoordinateFromPixel(i);return o},onDisplayFeatureInfo:function(s,e){if(e.isActive()){logger$H.trace(s);var i=e.getMap();if(s.type==="contextmenu"||s.type==="dblclick")s.preventDefault();else if(s.type==="singleclick"){for(var n=i.getInteractions().getArray(),o=0;o<n.length;o++)if(n[o].getActive()&&(n[o]instanceof Select||n[o]instanceof Modify||n[o]instanceof Draw))return}var l={};e._proxyUrl&&(l.proxyUrl=e._proxyUrl),e._noProxyDomains&&(l.noProxyDomains=e._noProxyDomains);var c={};e._autoPan&&(c.autoPan=e._autoPan),e._autoPanAnimation&&(c.autoPanAnimation=e._autoPanAnimation),e._autoPanMargin&&(c.autoPanMargin=e._autoPanMargin);for(var u=[],h=0;h<e._layers.length;++h){var f=e._layers[h].event?e._layers[h].event:e._defaultEvent;if(f===s.type){var g=u.push(e._layers[h])-1;u[g].infoFormat||(u[g].infoFormat=e._defaultInfoFormat)}}var H=this.getPosition(s,i);this.displayFeatureInfo(i,H,u,l,c)}}};window.ol&&(window.ol.gp?window.ol.gp.GfiUtils=Gfi:window.ol.gp={GfiUtils:Gfi});class Control extends BaseObject{constructor(e){super();const i=e.element;i&&!e.target&&!i.style.pointerEvents&&(i.style.pointerEvents="auto"),this.element=i||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){var e;(e=this.element)==null||e.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(e){var i;this.map_&&((i=this.element)==null||i.remove());for(let n=0,o=this.listenerKeys.length;n<o;++n)unlistenByKey(this.listenerKeys[n]);if(this.listenerKeys.length=0,this.map_=e,e){const n=this.target_??e.getOverlayContainerStopEvent();this.element&&n.appendChild(this.element),this.render!==VOID&&this.listenerKeys.push(listen(e,MapEventType.POSTRENDER,this.render,this)),e.render()}}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}let uidCounter_=0;var Helper={detectSupport:function(){var s=!0,e=window.navigator.userAgent.toLowerCase();return(e.indexOf("iphone")!==-1||e.indexOf("ipod")!==-1||e.indexOf("ipad")!==-1||e.indexOf("android")!==-1||e.indexOf("mobile")!==-1||e.indexOf("blackberry")!==-1||e.indexOf("tablet")!==-1||e.indexOf("phone")!==-1||e.indexOf("touch")!==-1)&&(s=!1),(e.indexOf("msie")!==-1||e.indexOf("trident")!==-1)&&(s=!0),s},assign:function(s,e){s=s||{};for(var i in e)e.hasOwnProperty(i)&&(s[i]=e[i]);return s},mergeParams:function(s,e,i){if(!(typeof s>"u"||typeof e>"u")){typeof i>"u"&&(i=!0);for(var n in e)e.hasOwnProperty(n)&&(typeof e[n]=="object"?s.hasOwnProperty(n)?this.mergeParams(s[n],e[n],i):s[n]=e[n]:s.hasOwnProperty(n)?i&&(s[n]=e[n]):s[n]=e[n])}},getUid:function(s,e){return e&&e.id?e.id:s+ ++uidCounter_}},logger$G=LoggerByDefault.getLogger("interactions"),Interactions={_extensions:["Measures","ElevationPath","Drawing"],_options:{current:null,clean:null},unset:function(s,e){logger$G.trace("unset()");var i={};Helper.mergeParams(i,this._options),Helper.mergeParams(i,e);for(var n=s.getInteractions().getArray(),o=0;o<n.length;o++)if(n[o].getActive()&&(n[o]instanceof Draw||n[o]instanceof Select||n[o]instanceof Modify)){var l=n[o].getProperties(),c=l.name;if(typeof c<"u"&&this._extensions.indexOf(c)>-1){if(i.current&&i.current===c)continue;n[o].setActive(!1);var u=l.source;if(typeof u<"u"&&u instanceof Control){for(var h in i)if(i.hasOwnProperty(h)){if(h==="current")continue;if(typeof u[h]=="function"){var f=Array.isArray(i[h])?i[h]:[i[h]];u[h].apply(u,f)}}}}else n[o].setActive(!1)}}},Marker={lightOrange:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAgCAYAAAC/40AfAAASf3pUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHjapZpptuO4DYX/cxVZAsEBIJfD8ZzsIMvPB8mvpq5OupN6Xc8uW5Yo4OIOdIfzr3/e8A/+lNo1lGpNu2rkT+mlp8GTFt8/4/ktsTy/nz85f96Tn18P6fN6TLzkB30ObPo5/ut1+XaC92HwrP5worY+b8yf3+jlc/72y4k+F8q+Il/F/pyof06U0/uGfE4w3tuK2pv9eAvzvI/7607a+zf4r/tVE3sffv13Maq3K9fJKZ0sOfL7U6ycsv/NIQ+eVH6nXDhQsj3P31fssxIK8rs6ffvTWdH1pZbfHvRTV749+6Vbnwpwa790q6TPIfmXIuu3x9++HqT+vitP6X+4cmmfZ+nn10eVz4p+qf5T/Lvbfe6ZuxhFKbV+burrFp9nHDe5hF+6BZamdEfBUOPRfzo/jZtfQGHHFSc/S7ok2nWlyJYhV87zuGSxxJJOSMaTlFbKz4stW+ppZe9f8R+5yXLPOze6uJ62l5y+rUWey/a4wnO1xpW3cGgSTiZ85G//hL/7gXt9FES8luOtFetKyYvNMrxz/pvD6IjcT1HrU+Cvn1//eF8zHaxeZR+Rzqnne4r5NvPFVn4anTmw8vjOoNj+nIAScenKYiTTAbomuYpKtJRMhEI2GjRYus/MpANSa9osMpWcld605JfmIybPoakmXg68DpnRiZqVOWt0aNCsUir4sdLA0Ki5llqrVqut9jo0a9GqqqZOisOylWDV1MyadRstt9Jq02attd5GTz1DmhBpt95672NwzcGZB58eHDDGTDPPMmuYOm222edYwGeVVZcuW231NXbaecMfW7fttvseRw5QOuXUo8dOO/2MC9RuDrfcevXabbff8a1rn7b+4edvdE0+XUtPp/xA+9Y1XjX7OoU4nVTvGQ1LoQgdN28BgE7es9iklOSd857FDv3lmlhk9Z5t8Y7RwXIk1StfvQvp7ah37v/qW7DyU9/S/9q54K37m537Y99+17XtJLyejr1T6EWNmenjmJEa/zGtf3wMnycdEnrmgScKh+W2rFIB58FVtiU7CVaLdS1hHXPoPkvVW5b2oXDBZM5kyN7VVS1pzsLdAoljo1+6tE5b+ciweuqaTNwEgrpb3atwvSOzw3Aa7Git98o4VD3nq3Nz/50yiEw9MXMCh+hOfU+a3euZl0IjZX1tW/VQIF0lHO5kjFqF2hvlvCOvrEi+yhlzzHKu6fCXapZzFpUqw+TMUoU1TrM8K8eEt2CcvwpvlcXjErqqEPqJVIoz1cQ7CdQOB0qqW1QrkrCsK6Afva0R7pobdpd7pG47/Z7UpwDkCm4ql9Y8G2Oi4+S0rJ3LiVdtruM9Jb1Ja6ESIbdenfb7pXSsmRIcyTStcG9xoGh7gbLD1W/ra462dTTubFKUsWyMLTThhmZUszvGdgZEZizn7D1Pvb3VmlkuoOsHSOIrxmpt0EbpgB81ynTMBlDt4TB1Vq5U0EsVt3mfgfWpNiTznwumVxaPWHprbym/Svr9MfzZG/QkgrS9IGdlYQ6i4zdpbQ/m9sbCKqv0ZKwrI5D8c+V9b9uzAIzM/Z4lm07xdl/X4aOlTekLNI+orHQcAKRJpdnQM8CoBLRYV9plleJl8yJpa3OPe+a+2ljD2pnF7GnxzrzWZijn2Ke3SytrYTJHl3CK9lQgFlNNC3tc+vJx88VLOxAB9avWjwIU0L+9m61oK7lrkrd4DEFof16knx/5sM6pOzqQ89r9dFase7a2kvXApdQOnAIH5T1mG+BM+ikt1QrNMltZKx0fC2XliVbK2enAuDk5P93TQXSY4nS4IchETYYPGGuNXfPJe8dboIixZ13bJ3mSES4KnZel1RgaaOZA8OcESKbuDaQOmjUXww93t1szsyHSFGynylw7HKfe096ywI75p6qE/1AWLgx4tMx14z2j6kyisec64EDuBCwwy/Hkm8cNzHK6iw7YiNbnVQpjdjOH0neUT9rCo7fozG2DjiOBKQKQC/0ivclYZtIwF7fDPLR2xsKkM0cZc3h3ubjIPgBmOYr3S+fTa5Zz1mfVLToJjbVH2GgN1DhKaQuluyAVe7PRRMRsWBqIgqYBoNC+NuDliY1RKG/iF5V5dztbGlQLAybsk82qaE3fzPS1zo1n5ygmKC4wsUvbiNBGerilBnJoSE4DG6x13BXWzXBv4vYFstG1VoOoC6oGPXX/UIRoN9Ib52D6Juin06jZss0ksVys5ZihjGxtMgDdLmq0EzXjzAC3GYCBXfJmwiQVEFzdurMKcZKkpyctqt0wSD0I04f4UnjXutEEdDzPuPOKKFPiKejaATr81NlRGzDe3HRwNPkVbr8UG4ZhJjM8BolsXMthNArGnMEfadoZhuRvosTdXPLOb6A0JOrIp3/hv06r4ESq1wpWZVzvZn6y/7vgYoE/RL0HgLxUNSFWB62gtiN2hhEcIbWpICkUOvvAoA/4gwScv+C0v8MJXQ+Nhqg1bgvZyqdP8vWsKBV8RUCGpsq1Orzz87Z547iFBkQcRUQrWKA86w2AavJxAguRhd6xoAOTYog6816YrroLXcGYxwUwoyFHxbtxwRY8c6zO2TQAYZkL53DIRQdBfHU1oxhJNzYpyVhcSYrFDSNPjwSTWZx0C7pf0DkOS8j9rA2q42RUpIpREda6Y4OVDMScySKSXydzjIPsENagrkkhcCt4BqZhB/N2onoPdi7ctdN3/3Qrd4qgPo8DCaYdnU9QE0W7h/vF5XGz3/AdFCBL/iqDfzDxQUSMGzfioPgJEvYDInjPyQaugchuEgbt4iCQY5ZDnwpnKTiqgj3mLhg1NCq+QwLyYPY43chRPVrq0WriYlciCNXr9VZ3eICCMIBS4nhvGEAIw0qEhaAkDex6p7qYKmQHB1AbnfAkxigx1QyOzGYXWYL/CubfGEbWGIDhxA3eiL9PpQDHRUgAbReX0ZAINyI0tQyUgcVzKFiDBOCFjXMlQ6QIYkMb7saZZliZxQwEHn7o2G6Dw8gKBXCjW9HZ5/SKXUR+OGGzMloZaAvkmmvAMyBcC4kU4YA7WToAmhlidyGKa0VSxUljYxnPcmeRgXsRbqRzbRBckHloBPPrw4Zr9/nkeMzb5VrMpFf9AdVcbrK+uoGUwtqrX/d3dJMJxvohLt7qvV04IsR7p1zM26eJ1/k1x//g+d/H8D4BAfSL+aSxxKRFa8VwUdeY6QURKy/NDAFrToKxoZTYfM331eZeAgxflY4XBZ69YaDqBP0056yGHyqnI9Rm+K1p4rSSFV9wIQGusB4PwEsdXUP9DnZtZ94jN0xuBSPBvXtoV2+0IasUFkXDKp3lXoDfe5DX9kLTOsqO9cOHgM9dqcdiEIusVMgFQy508wSbpxADbn2mkuCEx6EsXBGIAZaI1QujONgyMWaU1cti1qaQEDl1Vj7vsZFkI2m+A1t7/N49QJhK5OIUe/mWkE5sXwYa+J+lLKYCuDVajRjq3pAsYg3SQnkfQcb5LTz7xuPjv3k+dmCWUDi39Gl2ps4dXcYVJ+59d99wRJHQ9LtAD2XCRjYYkN8YUkIsrfFM5Bua5BDFyIKdxluACNO7zFkGegGi99np8n9j/ehWp2oYY4SOQWj9XHz1WcHWQL0BTYasCIpgkjyEg2C5TjD10bCGFz/PM8b5+O4Qk/m+Q5382uG5+CN3633jvfzjO4W5+TohQ8+pxIiNEfMI6VGFDe3Vd7VByDt4j0ebGrIEM2FxoZRLB0ld8XEkKBgMwyDC7QsJysobUBnjBgjRwxnsynv/tfjqx2VNJC2GPT4rjSDBV4jDl/3nVG6B+hHJ/bY9TyerWAXsIZHtzugCQWRAOXCVZl5Xxtv3fWErmHaDtJp8l2EikIXuKSylj/uCveU2fazmTH53yCEnm+KTd2E8hu4qTrIvHDJGlUkZS4IXFcPl7A8fAbrNqGf3Qh0xQTZ0SOsbIwDBLK/x9DWhsopPIiRsgHCMYjfP9wzMjbM37G0lr8B9aaI3NOogBL6Xs2HMOSH289KUQKo/Buvw+9qVTK6UUwqBuBPJFVPro5AfXk+Hn4zJjMj3RBR5J8BC2PqEG63CIG16OTfx+pr5fu30UWcS0DFuDuKHtdFjnLuM6psYkD2+oF5CjVvhS0CnoHwa/WNusfqXim5qQpjM1ZuFIjyYKi4vxKw4DZoiVeu6o4ZKaXzoURuq4nOHt6Fa9ATnU7ncxo7g6UE+0kYg8fExDzwLcq3ErIGXRo5wH+cRiu336mjg3/3hG2IT6ohLvVXuTCXB0dhTZ+++gRgyV/xAITch2WCqEVVrzPAxLgXRI1voOfSbmnM3/CXgYh8rPhxfDFL225b2jePCd7J7H2GzAwgjZgFyJj8SfsUItFBpFvCwUUQDA4ArY0Ch61SNvFZ8rw4vVhHyw5p9f3bEFDt1PjrID05RjBzVgqbJUJXSLARoRkQCNSZf5olAkobc12LqI73yrQJsCI4mLYS/rubukwKjPDlOFkPFgSrnRyNwuAcbiRm94aPI9zdmLUkujYQqcYLjaGRIFnZ9jYRcLJlv/hX30BiQgE6j5A+dU2RwwDKwGdzTAYnH2f2ctN0O7I1HTtBURMBcroAlYgjM8GYBFvPdA+imolWmjWHi4gzYfRqHKRuMrUQIsUDygBhBxs1jo+CJ/IRoNDEAuvemMJCC/Xg00L/U+v7I1Ly3qnhB/Jnv36SmOB4fM0A35hihOAcqHpM4x/zAdUx8e02G/BVzGxEpEBsqKathzVgltlb3EfNtLcNVGPPt0TpvbA+eMs3SfMcK04ln8fXDhgIiSOwUm4lj8jugXZhmRg6AHMb9gijciwnTDnNhKBXDI9m3iD38ciZ0YLpbxWho2ISpAY66Q2ZZgwv9YyzHM2QkASaOBrCM9OP4q+8xXnvSaycEuDbB4cHeJeEM08EstvvA765nu7r4RjF5YxNiO742DawE9XUMghITWK87c1sOWHBLFCdbxFqYR1wcoI8cBOX6jFuFBLCGvrO4QGX1bQxLMyX1IOX6X7bSfq7geCNzFbDeFfsL4sAm9acvxwtCFjQCGbaQ5SXYzrfVaxzOdTr6hCG35oVdOc2NjGrlX48wehxksic+UH1zZFGbgTZ0K7g4w03xafwEKo3qmAT1ovmmWMLjkxQfaNJsfbCSfP/Bjam3D72Oor77aumCQix5g05JlNJPOM40mKCcXes2BgAqwbwjX9C6YD5GLvF1Btsafh9ONbfSezJDaSKHSLBCtccxqI9oQpBKdPOW8ElM6cLAUEp480Jj9F8ZWZlutjwrw34IF3Ru/nXGEPVdmdKGfy3h2xPSckwZ++JVZyTNxYgPu4Xr7t9dEwC884PvdGPaUoDyS8JT24R1WOfECBGsahPUmDtm+cTW6WDpaAjUzlyS1kncYJEIDAiZyxN0E5/siGdvg+9mUv9KxWpkpJZHQvPvaxZnxBcgaAiXh+X94PwInyIy3xvwy/LG3eRYB/K+3Rv/0tbkr5t1/t2Cf/2ywR63xthCV3sBUwghIvm+R2nAiiQx9m1ALsHxHN59A48pBKgBad+otn9vQ+k4H3eDprO46VGMaI8i2WtEMWRIDaGfMTZn+VEuSgW8+gwAObmZIcwd38EfjH/1vT7fEMfSUMtuvYNP3y02Lp8384OnnB5SE3yl2JVLXkupN8SeLMR0edpWPOdiYAzEoLsnU06ADN0M4jS0g3qw/pl6ie/3qbB8IAwhZKSSWdYi2UeyRcdX7oYRIJHqRg3ohnS35cvNC0hB48rizpKbfgIpJ4K8UTXsMyPJS8f3molSYALLgj3yJXXfIQUczfMrnTGm9vXmbqT9Cxm1gL0Av0xdB/GsoGePVRtqwDiU7NkOC5OoSHUj2313k5QM26h2luk7Bj3ZCNe/pU0Qy4KK4CUIssMEE7uGyWV2uHjb+uw+wh8kX2daUJevGzUyICdt1kJizKnhNN9fJdvgDiNkP/wLw3jTrngRHBUjR54lJbBuOeAjo47O6yybKKQ1+BYN9E7SdXSh7kg7fhkCp+XcFTAgpvpIdDeDnincsPl3LFAaQHpywRwhptNoKXGKHlun1+/eKorKDU6M+vPdy4TRM3hBqOByFyqMtsOze740DPsC8pAEAoG/Lv5/CMA8eARSjpFJ/D3fpm7bv13y/1/gYgKdVn1LkvDNrMDBe5OOZLrnE6TOLjSDqjEAmIBNMzyKH+RuFd8whbrQq0Eg9sSGkBz/Ho6Yxe0G6mANNHo8de/ikteZX99WyNEZrVJf5T6opO+8RJLMjhgqGLMdsOXbSlqCutkhdPhvUMPc/H7Tgqm9nnHDvwF6YngoNZcUVAAAAYRpQ0NQSUNDIHByb2ZpbGUAAHicfZE9SMNAHMVfU0tFKh3sUMUhQ3WyICriqFUoQoVSK7TqYHLpFzRpSFJcHAXXgoMfi1UHF2ddHVwFQfADxNXFSdFFSvxfUmgR48FxP97de9y9A4RmlalmzzigapaRSSbEXH5VDL4igCjCGERIYqY+l06n4Dm+7uHj612cZ3mf+3P0KwWTAT6ReJbphkW8QTy9aemc94kjrCwpxOfEYwZdkPiR67LLb5xLDgs8M2JkM/PEEWKx1MVyF7OyoRJPEccUVaN8IeeywnmLs1qts/Y9+QtDBW1lmes0h5HEIpaQhggZdVRQhYU4rRopJjK0n/DwDzn+NLlkclXAyLGAGlRIjh/8D353axYnJ9ykUAIIvNj2xwgQ3AVaDdv+Prbt1gngfwautI6/1gRmPklvdLTYERDeBi6uO5q8B1zuANEnXTIkR/LTFIpF4P2MvikPDNwCfWtub+19nD4AWeoqdQMcHAKjJcpe93h3b3dv/55p9/cDPGdykYtTXU4AAA0aaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA0LjQuMC1FeGl2MiI+CiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICB4bWxuczpHSU1QPSJodHRwOi8vd3d3LmdpbXAub3JnL3htcC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgeG1wTU06RG9jdW1lbnRJRD0iZ2ltcDpkb2NpZDpnaW1wOjkyYWVkNjM2LWY3MDMtNDAzOC1hNzM4LWZiYzYxYzZlMTljNCIKICAgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5NWMzZWI3NC0zYWRmLTRkYzUtOWZjZS1iODQ4NTc3Nzg4ODQiCiAgIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo0NjI3ZDg3NC1lZDIyLTRiZTUtYTlkNS00NDlmMzVhZDIxYzgiCiAgIGRjOkZvcm1hdD0iaW1hZ2UvcG5nIgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJMaW51eCIKICAgR0lNUDpUaW1lU3RhbXA9IjE2ODQ5NDE5Mjc4OTUzMDYiCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4zMCIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgeG1wOkNyZWF0b3JUb29sPSJHSU1QIDIuMTAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDphM2U3ZWQ1MS0xNTI4LTRhYjAtODVjOS0zNzNkNzgxZGM2ZmMiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoTGludXgpIgogICAgICBzdEV2dDp3aGVuPSIyMDIzLTA1LTI0VDE3OjI1OjI3KzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PofUkY4AAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAADdcAAA3XAUIom3gAAAAHdElNRQfnBRgPGRuA4VZTAAAFcElEQVRYw82YW2xbVRaGv7XP8bHjXByHQkNhWigdVX1AikRBMBoQ8wASl4fRqPDAAxIPKAVxeRqQRohHBEVCaoGKUBCl4qHcNKCZVKMRRQxtgTaACLRKqlwB14NzM2ni2D2XvXjgBFXQOnFiA1uy/HB89u9/7bX+vf4l1HnpK57hTNCE0AzqAS5gAAuEID5KiWSiLPf4tp7YUjcSu4yLZzdi2IJyNXANcBlwAdAKzAHTwDhwDKEPywC+GZWHbPi7IKOvZIWguAnlr8BtwJ+AxDJeDYCPgF6Ed0hkh+Weov5mZLTHJMDeBjwYk0itYJtKTOpZML3SbYNfnYz2SBr0buARYENcFytdFvga2AGyT7p14Vcjoz3ShOgdKDuAi+pUewpMIDyCypvSreWGk9HdroOEV2F4A1hfTxGJCX2D5U7U/UzuD6NaXq49NRJhBsOjwMVLEtE4gaL4W5cV3IsxPEoizDT0ZLTHcSH6M/BWLLlVwpQKuPzhb+i8sRkv04Y/e5rvPigxtnM9trKU2k0D28A5LN3RsmXbrbFOU8DtQLpqfJqu97nh6TydmzvwWpOI8VDbxqbrkmz62yk+/Ps6yoe8KkeV/hHHfgrMNyrNEkBX1SAktgRs3T7ApV1rSWayiEkDLmLSJDNZLu1ay9btAyS2BEsEuWuZ99WKyRhgHeCcn8wGw/qbOnAS3jmfOwmP9Td1kNhQDduJcUwjyciS0RJXMMkWkPPUo/z4XFxZRhZII8mEwFCsT+f5xXTE7FAOteduItVaZodyhNPVZDeKccJGkxmsChIMOvTt6aRSzIP+7A9rRKWYp29PJ8GgsyqcVauZSADaj+IDTecWvBlD4e01HKjM07XtOOuuy+A2X0BYmib/8SxfvLWRYm8LdqZaCvkI/SDBci6nld0ze7KCLa4F3gSurR4MB5x1FnMhiCeor9hJiPKmWpbGp3EU2IbJFuTe5XfStbczLxgP7K0IPcCFDWhnJoFuMAek2/oNbWdku/WxHATejT1JPZcPvINysFYiK+gAFkXTK6H+MyhXADeseJ9fmrVDM6X080/+p1M2/yFsD1zjEIauEeMAqNpQE16oaKiqwfjYeLk+fuYl10HDq7DsBTavxs8o6FzFKez/dM3rLx9LjUyVxcb7yVkfzmpXFbACJURHIxgyxkyu1ml6qL0Z4YX4xl7Jfrrgm9Ov9bX/e++x1tHCgkQ11lgELGA4sBp3iHRbH5GDwJPAFLXo6KJnDmTh/aG2w2/3t47VSGQxs1zAE9U2s9pEjx3hXuBloCa7G1rxv8o3f/7SkUz/UFFWMqGRWMpHAqsDbl00KGotIXM7MawF7gKSS5oJJRospI7v+rD96Ikp8aV2EgrkVPW4OnIy6SVL9ZubvZgyaOVyYDfwl2oNqVWiXNEb231oTe+/BrzvK9Gy01MFyoiOKzIEmqsEfjGf/39U1yHgosJFUXhlFMl+z9E/nkvhVNHZsjux+9Caf77RnyzMBaJLmW4RrWAlB3Y4Uh13HLOA4wQjo6O2IRPNxVV4JuG5Et2SSelzjtFLzsZQ0NIZ8/2rx7K9+/paxqbKvyh4Bc4AFQxzau23Dow7FS+nHmfEUz05OqINH8+evXJPJVOuE93XkY4eSziaXcQpB2b+vZNt7+/8IPPl2OxPRMJ4dDsLzIho3hpzamJ6aqJ0ei6qtZAasmZ2OS1RyOMd6egBIzSFVoKj4y1Hnvhv+8cD02ZOkEmgIKITVnXKWDs1ksvNrgbTbRSZ46cypY50aWcllIsyKXvr8GTyi9f6WvePFGVQhO8EPW2NzI+OfV2pF2bDTgbg8D/aJeVUspd1BK3/G24u7/skO3+iYP3h3LdhI/B+AGodUpo8WKwoAAAAAElFTkSuQmCC",darkOrange:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAgCAYAAAC/40AfAAAStXpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHjapZpplmO5boT/cxVeAkeQWA4H8BzvwMv3B0pV7qou26/tyk5JeXXFAQgEIqgO9h//fsO/8a/2KKG2PkRFIv+qVs2TFyN+/s33mGJ9j+9fKd/30q/XQ/5ej5lLftP3xiHf+39cTz8H+DxNXrW/DDT294316xtav+OP3wb6TlR8Rb6K8x1IvwOV/HkjfQeYn21F0dH/uoVln+fzYyfj8xv84f6ISf88/f537UTvNOYpOVtJJfL4DVbJxX9LKJMXjcdcKjem0t/r9q7/2BIB+VOcfv5TVnR9qfWPN/2SlZ+vfsvWNwJs7bds1fy9pfwWZPn5/MfrIbU/Z+WF/i8z1/F9lX+9nkpKnxX9Fv0X/HvGfXtmF7MKoZbvpn5s8b3ivsUUPvUILE3IjoChwbP/KD+DzW+gcOKOi5+dNGXSdVNNJ810k73nnTZLrNlC7rzIeefyLo7Ss+ZdPH/Vf9LNvWg5ZZDL/dJeS/65lvSm1bjDm20w80ncmhODJT7yj3/CP/3AvV4KBHi81KdPfnP2YLMMz5w/chsZSfcb1PYC/OPn93+e10IGm0fZS0QZen2GWC39FxOUl+jCjY3nTw2mfr4DECKmbiwGBNRE1lJpSVLsOfeUCOQgQZOle80sMpBay4dF5lqKkJuRfWo+0tO7NbfM5cB1yIxMtCLU2SBDk2TV2sBPrwMMzVZaba1J6200bVOKVGki0sVJcfbSa+itS+99dO1zlFFHGzL6GEPH1KwF0mwq2nWo6pzMORl58unJDXOuvMqqq4Ulq6+xdM0NfHbdbcvue2zd8+RTDvxx5PQzjp5pyYCSVWsm1m2Y2rxA7ZZw621Xbr/j6p0/s/ZN699+/kHW0jdr+WXKb+w/s8bV3n8MkZxOmueMhOVQExnvngIAnT1ncaRas2fOcxYV+ists8jmOTvJM0YGq6XcbvqRu5A/GfXM/b/yFnr9JW/5/5q54Kn7h5n7e97+lLXjJLxfxj5V+BiwUH3cM/PgP6r178/h+2IWNXr3IZDKnG1YHtrtFtaVWu1ilevx7tYtr7VXOy3nSum0NHSeHSC4lcbIFUozk32J9iFdrXthMcaFq0z0Wlp6+qg7HfZer+Z0+zpjlQ5fRmKkS8fOua1j1CP7llovW7E816hHdHtUrZ5+oz0IDLDFuIMOT2Rma2CHreke6c5TYFqCY9puXmPuPRcL6KvoarLOvlBpNrRL37lJbySs733aav2UesPNIHA2O7WlZr3tW+ML4QSvXKsuLPpsgL0u/mbyXnZpdPGZjOttnz2khypsW2Jt5Fozqdl8qnedcofdunR20BHbANt15T1WAltjrZ53p6nfQqC6rqBWe6l0nMIi9+69RD0LYHu7WZT7SBuQzttKZNQmaIJGvHZZtrsC2T07siMATFvb7ja2C4/eLpMY6Y3jssO25l3SrxyZyBE7R4kTA+Zia60CIJVPnhkqFFtZ7lbmX7OMuH2OHEEBv42VEN66HZf+st21L32sSZIpaVIuvZie0Ge0B9BFHxzfMMd/8DzkZjNwFFdW4zWFApTWlpP3vCOzxUm1FWKkBtHMW+zI2iReZFFt7DcKsCld21qB8OQjdRDXQhXmKB1CEcC+q2c0bT7SjLbfG228GPk7hRnhmQNmEQOdQj6htHgI3AZ5KV/KSy5Qvz4ukCY1hWWM0YhnSa3Uk9dmzdAdoeYHkiPXuQbNHUoZk0+U1KEXyZnw7UUCFyAmnmlQI1tjE1u3fEp+abX5p+r/Iz2QS1Kc9umzQg1lt3Lhw1NuHXclsLDiGHcfUBnKZe/sIx0kz6JICFA+2cTpDpqVDFCytG0wMyxRxibwdjZ7Il4ytbdVoBED6TSBNCbLX7lBnKTOUXZxF2o2nAngN2KboX6uU13NKlAVjWsOwqVSAwGjKo22ARgudUtcr3jbr7JqqgS73qGbknEAGrMVbrKz7oxe06mx+Z3Ct8DT//JMvxjD+NC4EX461F1OUiEZ9Fo6PQak4+Q9cFXp/RXYwfqdetl701wUChFKMN42b+9HHuVV8vC2TBo2vXVGDSCqz6sQl2sSK9HIcSu0Boa7ZhMwb2bxhfVtCl19V/kBwlpSpmxq7XRkqEtPSbqTM/gr6VupkEZLO4fWYHXTxiKN58CCXNsCME6+O0Pc7LgEgroA87HqGzRqHg7g1iwoZdilXwZ1KQgjzcFdjZZAWs+iOv16vVkgmkBYdJF2PuA6s/DJnibdlxZzJwDhCu6LAGRQmeH6TpWowl4bxmBRWhagC2iAc05T0HOmEgY2Au9Qj3bpoMwJCCe7bsTXYPTvhMNbNy35wNACBQfebVUHW6cb07j9jtu4NhM6gGYFw2/BSEz7shWMncc+X1RAvc6jEiaCB4r2pC2MMTlBMZVELQMZ8sm87CGvc2yZLlbHzL5AGkM370hIm3UtpL4vKf2U9EEeSP1X6XGmaf1u5kU+BYRD0+6xqOhky2zr/PWGv79/S1EEBfVpo592XV3EGVjeB2AddoXuX/mwwVzp5WiI5K2oRm6nfGNeDSKS00DeGClvsFMQXpYCssEzwwNTL5wNayGwm/Z/EJA80jz7ukpsB3THWulMHV13IAfym+m+VAleRFOX4kRD6SEbCCQl4mKfAWCOJhC9AtoeUZMtbl7SD8aBayBoffyKhlwj0/zovihoCM2J6cwrkAYIoUEAvaO8n82lBUATNBjkBuFAz2jX69Gii1xgw/YFTl9mr6KFjXbxEih0lDTYKeQDaGlYWEA21FAdcME9yQnMc3hDivcvCX9w+QmbsVAVDI0MBeQQnLNu/lxhFsL3+SBgK+Gf4ebcDyzS32AR/jFu+gc3v8IG6fcDNwhHF3qHHr2JKxWOxa4GvSBc5MDZFQxAfgK1S3NJHLvz9aTBQRjBdTjkIZooUtwD+YcX9bWmaXD04mOOlQcfkghzo2hSvcz6GCkT/9bCKBEhhWrfyE6KFNm7EVoFtQCBILKAYro1Ge9EBFtVWGDZhCwaHNAQyAnJH8MtiKZVBxYBAYpEVEJZkQkoCMNQb2xFRX4AJ8iqpu7AqLZ9YXR/yB6mA/BBYR6iTfPcvZZ4yvTwcA3VjiY/9MkL6fVUNBu690BZQJXyQOShufFPKAW2dg6qJaPqaRfwIi2p+/pxEpdcokQK3RHJqILUAfKsNV1uRStfGq4e8Or4COhH4vE/IvJ3PCqY/hWNgDH8y2hcU3c+NAb0VY2If0FNd5zlrVtbph0h75BRgNL7LH/ePtT7LAouIZ6E5v/6rFs9Yo8NQaluBzGOrKGMHVkrFJe+bVOGy7B/GAhBBjJg75Wx8G/e6RgXkjmsCy14jXxw+63UNLEr04kNyoc4BNw3rJ0r0a7S3L/ebkgoIU3XOR/oYyHZFn+IkR8FYWQQfYgUa8hjrIJMUtkPsgHxr191N/JPtdzzIlqomkJs0dZIJ0rB1wCVQlNSLeBzyAw6N4vEM1B34oIfH5zBSOXNT4Mp+a8iHItfoMZdELWsAuILvO7QH/VNQo6rWzx9o4niuNx/Alw25XGqqBW8GS0x0TSN1TcuirqCbick1OFedZ+IZm00BUGeI6Iw5+7wwDNekAElOjrPoEAQ7vlaLndsJwZlnb25zTqYKdmUHgoVoW/TbQoQRyzdJ6egYhzH0x7R4sddUrh0GdT7wJTo0UAhkp5zgScViyGnkayJFFkIPW9+h05xySh/5Sdw8JFU/JvgRGjuWkxoyPeWx5SFsobrf+Nz3o0uOrgyBhFBfZHXtly3UTF9g4+Bw4iobQRTCahTcObjlt7co60nhwsZBdPNRKhMbYcFF39nVRsJk77A2qiMd8yPxDQUc8qtLjMhaH6n4s/cxkTEKvwwky/eF/Bx3lD7/INVCN8X0LRRg/vNekelk+FYGNfdY8IvYHUQXnZN7B5cyj2zAWqmX/idg86erDH7wYsiP5GtFcqPFEfCn70MQZ7AFbbod2La6ap4VgiTKoVgGoaku4ZMKOzW+TVv1V7KG4HMipBvtHCASd/Jxc+astMWOkDIOk0ZW1vOVZT5PrWESpfBRY423JcjvphjR0FHIPgorIt1VCrZGzjsbhQQ5EDFYudxaui3LJk1YPxw5fQVGo1+Gp47uF9F+R+dGKUKbcEHMIR1Cdk7Iu02D0X1WK4R4+7apqMdkDdMookuMgfea/phsvh3H8go/AOWFZZiQWWFjHhGiqSCUySO9FC6wXN41dWxHwSYPTG2l6cpDTYLzeNgMRqHoqKfdoJN53Syk04No6vmpGJKrscZchpwv8fe+U9EdomvwN1Pxh3Mi6LVtAFtaQitxVbBbSWOWKFnwA4suZPO5n+75os4exayDhZ83KN+ZnjdpGdaHAvut4Y5n/LGW7RKye3E/CiA5Qt87ANeWC14hAhGfLUIVEg+1oduAjaf1Apo9P/W9KFvcN2jEGpgDBoLPJz/puvRFGyNlWOhEhtxu9DRKNV0ozFB9xP1Y3WUTfFGRM+1om4xKgHeKeGMB2oEFje6CDRa0cBIJz/FchGAmHATTihQBojPgf5160WbqQpsN1IgDWFfup1Yd4KzMXjXpZQlbpWOIE+U1UkKqT+bTyXjre0dZ1U/Tft64hr/65nghzq2nw+q0zs0kw+2aMCBLR3UZZ2IMJQz0sUD0Zz9E5YS4vfmQTy2lwziI7RSITFofBE5qbGwBD/NOE8rUi/gqnk3AjzIJef0w/4+X58ISyh8hDQEQu1npzAGoCHoSE8IzskbcY76Wl9z/8HWH/JLInx7oUFd7APzRdOjJQgM7vYYyUTSucMPiunOIMij04t9FLqfV/81VuGXoH0VLjIL+d/84G/gxPMp3vAuQo6OFxH+Ha5Cd7k5Ue8bNUtwn1txU2cWDOIUJOeC7JSST8MPjXZVVAP9TEmddbQdoQX64PA08TZsxi82SzY2G95A/0CUbjSKwxIiq610mIy9IJmmH7AOQFE9KJQe8pgxyi4EAM6mC1HLSsshbMJO1Pzgjj6DWb906nvgnn7xBgoPQENyHul725zomKKEDXMMs0A/AitvQzdvNDVvmDMo5BCJd6e14c2Vhr4GmYGAzVHUq3+TMEv207ca/HAPoda7Vcyklg77X+9nFfXgehp7dyraEC1HyG8FTlOyOsSRlbGgWSjAFHCnAnfDZ2jq/NqAkGzsQETfUyaHlZXL6ogHrTopSECq09eoP4llyTvWC24H4NTNJhpcpAhXq09Wt+GYbnul7vb+nbF/TL0r9NcFqh8PrYoK2OHRb3QHiysgU2DERaHhACp967hQTKgmcN2JWUreSXNZHUshBZOCLnI7GlCFKArV+U7Vp94l5xB9MgRbH2gYGQOZOj46DQeF3tG9hrDU9mQOThdP8mTNfCrnwJwISKQPnT0uR7VNigXpWiEFP0Lxr98KaVRvvbFK9W99yFLG00LSEBRM6N9hdpSdn1v1xajAaNI5aoM1RvOvbtFmReiHev0we/lXd/QOdgDhk35za4XWdq2Kq0CLNKSaZSMmiFa3b52utEkcBgkaBtPuvCgUnUfhvWgjBioKqFKmzXuYpxTl/eQshPPO2ShJRza2dD8dmfb8nMrEf/mI9cczhuFgqAQhsyhVlS50UbeZhXJw12E90H4zEaXeyEpzm1hL9S8p8IDmB3Uoe0SMkyiamhaFiUZRkxc/jhjIoYNyQNaQfNBIVzUIyF2vZUKndnGxeMRUKB8atHpXwjJENI834Aua3xE9HrDApxJwLZAABnp544Cu6gTzDanTXSRBCgWnZa1TIFQX/aCR3IJnEahlwKxX5PoZ2xzJv1FDSTHR2I/yJ5bIE+PfISQqkGpHdqMYFqq1uu8F/1n8izQPIr5lhztexUKSUDfKYvHn8KA6E7wzR1wtru04SeGJVKUgRZzL9yofVU7H6QEpk7p/0zasYFQpSSG90K2fcl64K5m79bFoTBb91AYHjv+/uSLhYRe6bvajej/vvKkVHJ0TPF4buZAoev8WpEDemJctMADcTzd4GkafL0juiyEKwG0XETEBfR4bioCLBmZlDprvZuGtR/zHJPHinE9Ok5/YQ3yYCfrV8iOC1oAVOgDBDksbjH9wOmwIuBPo5icdgiwS1wbND9YU/UHbRZBMgo0IV1jpSUKhQlaYrnkehdAkrI/jgs7JwVWXutTfHbKGdLO6gSFyCyp2j738tB41BgTSDRFYZZQCTKx0bOZkVEiuHFbhtecqYjkv107p0VeeJ6GFqZ+UMrS5tr5BQKz3toOfxbe3a1dtvW+oRnvdOiOWQK+fRFWJgk9hWwgNBvX6peddODKw713i8VM+1Bw+zzXE80FMMd0LY9XoxN0P/Nty75bP4xRkTPHvFMwzuwKeBW3l38aB4uaPlBEG8s8HGwhv/x9y/hPOIdIfHx3GqQAAAYRpQ0NQSUNDIHByb2ZpbGUAAHicfZE9SMNQFIVPU0tFKh3sUMQhQ3WyIFrEUatQhAqhVmjVweSlf9CkJUlxcRRcCw7+LFYdXJx1dXAVBMEfEFcXJ0UXKfG+pNAixgeX93HeO4f77gOEVpVpZt8EoOmWkUklxVx+VQy+IoAowlQJmZn1OUlKw3N93cPH97s4z/K+9+caVAsmA3wi8SyrGxbxBvH0plXnvE8cYWVZJT4nHjeoQeJHrisuv3EuOSzwzIiRzcwTR4jFUg8rPczKhkacII6pmk75Qs5llfMWZ63aYJ0++QtDBX1lmetUI0hhEUuQIEJBAxVUYSFOu06KiQydJz38w45fIpdCrgoYORZQgwbZ8YP/we/ZmsWpSTcplAQCL7b9MQoEd4F207a/j227fQL4n4ErveuvtYCZT9KbXS12BIS3gYvrrqbsAZc7QPSpLhuyI/mphGIReD+jb8oDQ7fAwJo7t845Th+ALM0qfQMcHAJjJcpe93h3f+/c/r3Tmd8PnXByuOaabnkAAA0aaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA0LjQuMC1FeGl2MiI+CiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICB4bWxuczpHSU1QPSJodHRwOi8vd3d3LmdpbXAub3JnL3htcC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgeG1wTU06RG9jdW1lbnRJRD0iZ2ltcDpkb2NpZDpnaW1wOjIxNDZjMzUzLWIxZjItNGVjOC04NzQ3LTIwMGEyYWExM2ViMyIKICAgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo2NGViNmI2Ni03Y2I2LTRkZGUtYTI3OS01MGY0ZWFiZGFhODAiCiAgIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1ODRhM2VjZC1kNGFmLTQ3NjItYjA1ZS04ODk2MGQ4ZTk0Y2MiCiAgIGRjOkZvcm1hdD0iaW1hZ2UvcG5nIgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJMaW51eCIKICAgR0lNUDpUaW1lU3RhbXA9IjE2ODQ5NDE5MDM3ODI2MTQiCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4zMCIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgeG1wOkNyZWF0b3JUb29sPSJHSU1QIDIuMTAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoxYzNjOGRkZi1kMjVkLTQ4YzQtYTAwYS0yMmU3ZDYwMzg1YjYiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoTGludXgpIgogICAgICBzdEV2dDp3aGVuPSIyMDIzLTA1LTI0VDE3OjI1OjAzKzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PuhCAHgAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAADdcAAA3XAUIom3gAAAAHdElNRQfnBRgPGQOTjc4FAAAFdklEQVRYw82YW2gcZRTHf+eb2dlkc9lsrFYr2notfSgWxKKiog8VvIFI9UFQEaWtYPFJfREfRRSEeqlttViLD/WGisYXrShWpfWC1WpSN5eN3cZumkuTzWY3c/mOD9lI0WSTTXbVA8M8zMz3n//5zvl/5xyhxqb3ewYvaERpAvUAFzCABUIQH6GAHyvKa76tJbbUjMRW4+LbC7GsQbgCWA+sAs4AWoA8MAxkgEMo32LoxDO98oIN/xdk9IGUYEYvRrgduAW4Gogt4NMA+BroQHkfm+qW3aP6n5HRTSYG9hZga5lEwyKWKZVJvQCmQ3bZ4F8no5skAXov8BiwspwXizUL9APPgOyVXTr5r5HRzdKI1TsRngHOqlHuKTCI8hhG3padWqw7GX3IddDwcixvAefXUkTKhH7HcBfifi8vh1E1H1cfGkGYxPI4cM68RGw5zf3y3S7IuedgeZwgTNZ1Z3Sz46LRNcA7Zcmd25yGgPWP/M7q65toTLZSHBvn6OcFDm07n6g0n9oNAxsR54DsjBYs2251QWAbgFuBREX/tF3rc9+zA6xa3U5jSxwxHmpbueyqOOvvOM7rj67g1JfedFTNagngVtR+B0zUK8xiwLqKTmhcE3Dblk4uXbecRDKFmATgIiZBIpni0nXLuW1LJ41rgnmcvG6B59WiyRhgBeDM+UZipWHthnbcmDf7b8Y81m5oJ7GyErZTxjH1JCPzesu4ghtvBpkjH2X6uXFlAVEg9SMjhEAamFsyp4Yjcuks1s6uXdZacuksU8OVZDcC0mW8OpFRQqBruvqdwwpdDh+9cjaF0QHQv/2wRhRGB6afdzkVkKZxtDoyVaqZBKCHEXygcXafjhi63l3G9tIEGzYe4ZKrksSbzmCqMEz6mzE+eedC+juaiUYqhZCPchgkqKB4SzxntqQEO7oceBu4srIzHIitsMTOBOMJ1leCkxAMmEpRWt6Vg8BGTConOxZeSVdfzmwxHmpvRtkJnFmHcuYksBkxH8tO69e1nJEd1sdhP/BBuUippfnA+3jsr5ZI9TnzV33mFcB/DuEi4LpFr/PPZu3LkanES08fOltWnxe2Ba5xCEPXiHEAVG2oMS9UNFTVINOXKdamn3nQdSC8HMMeYPVS+hkFzQdObl9m2Zu7+xt6hkKx5fXktGumdNXyZQUKiPZGkDbGnFxqp+kh9kaUHeUTezHr6WRkxt/oa/toT39Lby6QqMoci4BJDB8vpTtEdlkflf3A08AQ1ejoTM8cyeRnudYD72Zb+qokMhNZLuCJaqtZaqDLLi0i7EHYDVTV7oZW/J9PNf3wanfycLoki5nQSFnKewKrnW5NNMhtKRDlt6EsB+4G4vM2/UrUNd5w5Pl028FfiuJL9SQUyKrqEXXkaNyLF2o3N9vUYKB0AbAduKFSQWqVKFv0+rYfXdbx4aB3qqQLDk8VKCKaUSQNmi0F/ujAwB9RTYeAMwoXabg2QvZ5jl4ym8Ip6FjgDm7/bdl7bw3Ec/lItEJyWyAS0RJWsmC7I9WM45hJHCfo6e21dZlozlju3pjnSnRT0tMXHdFzT8dQ0EJoTr2eSXXs7W/uG/pnwiswBZQw5NXaYw5knJKXVY8p8VSP9vZo3cezp1v2nniDK9FD7V70RMxoaganGJmJT0+0frbtt+RPfVN/EQnLo9sxYEREB6wxxweHhwYL4/mo2kSqi43c5zRH8GS7Fz1shMZQJTg41PzVU7+2fdNZNHlBTgI5ER20qkPG2qGebHZsSTpULzJH8slCe6ywrWTlrGTM3tw9Ef/xjUzLvp6idIlwQtBxa2Sit6+/VCvMuu0MwIE726RBSqlViaDli6Gm4t6e1MQveet3Z4+F9cD7Ewo4WRJBbaaSAAAAAElFTkSuQmCC",red:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAgCAYAAAC/40AfAAATbHpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHjapZppchuxEUb/4xQ5AvYGjgOgG1W5QY6f10NKtmW5EieiTVLDIQbo5VswCvavf97wD37qyD3UJqPP3iM/ddaZF29GfP2s5znF+jw/P6W8P0u/Hg/5fTxmDvlJ7xNHf5//cTx9DvB6WbxrPw00zvuD/esHs77HH18Gel+o+Ix8FvoeaL4HKvn1QXoPsF7Lin0O+XkJ216v+rGS8fof/Ol+xEReL19/r0L0tHGdkrOVVCLP72CVXPx/CWXxpvGcS+XEVOR5H3mu5SMmBOS7OH3+TGZ0far125N+ycrnuy/ZekeApX3JVs3vU8qXIPfP12+Ph9S+z8oT+p+uXMf7Xf71+NgpvWb0JfpP8K+O+6yZVazaCXV/L+ozak9Srm4u4Zcegal1stOpocGrPyaPweIPpaDxxM3jpJky6bqpJk0r3WTP60mHKdZsIQtvcj65PAdHkTzzKZ6/6o90s5RZtAxyeZ6015I/55Key854wnO1wZU1cWpODJb4yl8/wt9+4V5vBQI8ntSnV35z9mAzDc+cP3MaGUn3HdT2BPjj8fXH81rIYPMoe4tMht6vIXZLP5CgPIkunNh4ffVgEn0PQIi4dGMyqZABspZKSz1FyVlSIpCDBC2m7j2zyUBqLSuTzLWUTm5G9kvzFUnPqbllDgeOA2ZkopVOnw0ytEhWrY36kTqoodVKq6213qSNNtvqpdfeeu/SHRSXFKlBmnQRGTJljTLqaKMPGWPMsWaeBdBss0+ZY865FtdcjLz49uKEtXbeZdfdwu5b9thzr0P5nHra6UfOOPMszVoU/NCuokOnLktGKVm1Zt3Ehk1bl1K7Jdx62+1X7rjzrs+svdP62+MvspbeWctPpvxE+cwaR0U+hkgOJ81zRsJyqImMi6eAgs6eszhSrdkz5zmLE/grLTPJ5jnT5Bkjg9VSbjd95C7kV0Y9c/9X3oLUX/KW/9fMBU/dX2bu97x9lzV1ED5Pxl5d6EGNhe7jnJUH/+jW31/D+83KPiEmlrd0ZremEblUT7eZm0BzexaimmXYgubnuEPvkbQGa9wthiOWrraVZNfSbR0D3dM5e18pXeZJJmnLWKdvldHSuKUOsxOt3bbTboUw2gyslJWdOaVdy9qByFHOHqbkHGo8yhf7pMzaZaS57phW01Jel0mrG5SmjUNddDez7oydWuXyM2lNdiFWXboPJVg7FGLzCt/lNwpH8zahiOZobe1kVcJOl4zlA+HOkZfx6ZCqda7d110dOqk5j555J51FiWZST5Qtdd1klCVRBYFSJPLQBhVUm0uIVsH9rLkAPGR3mNdLnms6F9jxCstcglo/til6U1v7hJm27l3rQ7HE7SzZVqiFqgKlzQ0BSa17KIOX6mWnnHzLOfToTkNLH9lgkXjuufNIsdmoM5nGyaSbACl51ihnS4t7TBrI9uikqdFIpLPGdaGkO4e2QBHMZEe8Ls6U6DWk+dBZ9VLGu98lM11aIjXjakwmrUP6KF24IvLlTbBSMKXAz7ibZFg6JtIZFqmoicKJlpnItETwSSfBphrjGTYkkzzqgArxS9wA7/o/amHMG4VpUQ4naZO6llRb63b19J1i3g9Lqy/ptx4Jf2yej95JmyqnPp40nD1FZ6eEE5GkmCLLXyizGgweEiqMDJ59WrKiWnajjLNcFMFdh/WCApcKnDU3Ymiqex46z4jy0O5rCny1U8sU44naDrlFlpBoiqK2FSlQEkHj0YlVtbmq2OSJIt9n3XKPnkuWEFrHx1cmu67wCdWWb26RPgIq6cbWQSCh7ae1mavXCLiYj//UCeia5L5SWHfOUy1nmsah0qgDFAnlMSvhAGM7iEUB9aZX4xO7Zb2Agc/b+D4UPt78/jq64wBC6Jaup8vuDiT7JCo/slSKKILbA1xMusPOqh2o3McIKmivFJLa3bxx2ChgFek5k49tFcrJazxJPZAlqmxVaMSQfstACssdyhDQIDJr+rfDSzfXCzFsBrte200pvE5xAkmDNjbIohNm5klmgx9YnSeanMqY5A/FTwObIRibOeDRqguEXKfVlYUsDBao9WTlykDd1C2A/6v6HDLrn8L19fWACeBm7jfSqwkmzehsIIaOBraQNtfrp43aAEzqpEvhK1NPFeC4qG2jkWBXunMnuOISRcCYsAdsF3O7fUNnujpInQp4DZ8KwV2FmvtIOsh0MU0/t5EmSrcCsRpAyod4KFVKDYGfrdIxkSyVp42oJ1W+RLmRdmi0Esc0V7UIzJJ//A+4FBq6GJDSNahvqK0ceqdOtLOlCY7I3aUpxTsUdtOZL6m/rVwjKAPk2qwfngswTfY1DlqXBA1y3zIyIc/qRPHoW5SIy37KpWFJjHxD3I6/c2bOA3y2hQ4pYTZgbjokXWhk5NuoOmZiZwI/XVUnUEJFcawCmm1Ta/tw3ZnakHNtNGbUWEmVz6sXlxuq5lNV4lOqIJuQU5QHEMeyooAIrnXphlkdMea0QBdhgMjIKxu4ijyOJsAkNkSA4nW3zegoRhLwGvsiwsZFjaA+vJ+Pgl41LFqKTBzKJzeY4y4K5XoNc7nis0wgQnLKo12glDFaehPgz6/h64EaExPNTwJAe1DE3wFUMBxd4DV7naTKl3PCl5MMxeG/EgQoy39r+w5UIWwAZ7wmNqNo/ZhYKgiEmkMjJViEcWAN4ggPgzAdfloCgu4iHEgRDTcRcXnedsSBlODF7lLlgOpER4KNup9IZKHakS9TXDhct95PHzZaH3cFI3KsEcHSDhw4pxZUZEFXqYrF0L1DQXjKGS3CVVwx8nDWQ8lEU9eXCBiEat99LPSlgWplOVQDS2NDg3WSNSQYde+YyYCuVZNkYNUgND126YEyidh4loQEG2DBs/cx8KWQNz0yTgqCTkMLmclevB/oQSuswMNCWvYAHh277jmLiswGO2w9Q1IplD35KTr5Hkwr71QA1z9KYTfXDe9ie6JJUVGMgMsSH6YhBvcTN5Z+bw/6BkhdiOf4X0Pk+Qpv4YVvn/BmtOy3CPg+A8gw+v/J82EJl0ikfsma0i508WtNQFu6GJ5nsZ7sTacCgBfB1FmObYVEFLW3GkrRWXPP3mc5A+7fEinK4mqRU5D8gGpdNjZaTx7lfU3nAo5S7q6ZuzncQWjEbqGSyCJeBLuCbu5dB2B0NAvwQyBz0dO4KqIKUmzL6q2DRavRClhgVIC4xaAFJtpuxYBysKndvZhDL1fAUIGdSPVI1pj/IDsdOKzaO8oQp+O6V3E/4NI4XnZr1TBg9+zyic6BWbfzLUlOLB6VgvGd9dJlG2R3DQsnLrRb6tTGFEK3xB7SD1RT3S59Z7c2jisR42rokoQEIGggP4WMs4k1IYD3cOfVdnNjhiKwU8dM8YaSfVVYkKt2aOTuqsgBZY7jUazQPnqrocQgNSYPRF9E+SvLGIzVnyRDRzT5U7xUMb2wAFgAhqoHIja8Y7WQRurG2vHdnqeq6N53vShmnb5r4SmYj8L506vjGsLOMErgHKOchXNdCpdq3QKvrjCj24kXD1E11zUiyyQP1MMjC1GiLD4NtFbhbGXGdkY8i7TXDL5BETfhadPCzeugxtwL4lmKYfiQ+XpIzLxwA9hIky+ggMIqYFfDmiPa8AX7XMRUP+GAPciSQmZh4Q3ckRH3wIhZAsCijAbKl3J+pBtLw3pYK7n4IYHuIwk8Qdyjb+veV3i3lQFXjE95i470ifEZ34URpc53BJVKlIXJwbJgCB41Ag71DFpSqxtLXgf2MW3cvBmvhAaOZEiIFY4AVBNM8UITXn7AS1iF7J6pAoWAjmh4y5Wmx51o7qBVgkfol4MYBDQ6qnu60cLlwDyLZYLAnBUqs8u49IqKPjh1RKKDN4iOh8DC90kXJ3xR8Z3IXSKZY8wTHxaiwMkIazyh4r9Gh4PQgzQ5mi1l/HgDodGAEMOgPtzPUKjxDvqs3BfQ2QO0J2IC73XMhu3pL5h3OK0uF1GF9tgFiBzAEbEjPTfS0cXuhVAaV2toiWcgvopYcMpGI0r0rdl00vNRBbx+vXb6+do4CCDx7s8BhYZKAbGVsYEF33o6xfVwbB6PDhm42oxaeA0Pis6BgJjTlTqIdcdjI5CuK9YAEKmrYea3ZUCxeBgkMLVzXT48dD4WLX4TigKZ1x4yfWTZoIw5Yfj9Abj/j9QD9LCQRHR8r8ZAtosh4YsTZzwE6+t04rsoc2+g1h5gIHF4+O1J7Vg+NGbz7SfwOlPzvqVFhJCQ4mnAXHYqSrG5AGNBbEqAGmFR7CdXyA2PXUBbZDh04fz6OMUM3MHoVfGpA62Ch3LlCzVgC7l8h8oDzdHdYxXflJvm2zGM3fYpvodExdcdIZQVxzzLN/gLhzHDXBEgfgFpqgumRYc6Z2AyvCqVChakJ3UFShQaws6WkvrLRGBZ2vdBDT8fmO5ZrS1WV7AY6aEvuGNBCy6dENU+H7cj+IjURXxTlPiK5oBpiACdbw2ydEwhPeXgVeb0ZnPzCSk4aFIe3c7D+pQqdIRsEnklqk/0kTRiCrR5Cwx7NlvcKcK/+C842Hscz4SUBV8uHsfcFaHWDgNiVHyPq2tg2I0GwSGsCArBXY9aaonlIA/89/xSTMxu0YksrZC3USmjxhTd1OydAjy7HAWjs35LiSTJJGK+1fLY/jYha/Vtoc6KLD7NAwjBqov6ivQQKv+1N5Lit2LeX0kyrAOWwx4Y324Y6Ta1Pfe28KB+o20SyxGKged8rR68DLyOIPFZ8CylJuyKu1OIFtC7cUjNvv1wXNFyGgVX0BpryQgwPEYaTYyRPB4XzBaiaPdjDIqGRRW4knDdjsiAkxdzpWuOpxqgQMMzl0uLjOmW/UD7ziKzeymC3sVo9mXbwe1RmQix8c2+EFYJ2pqhsAx6apOdEn2fGXY9rvHJmE1Ae+fyqD0sH6o6dwh1wtUz6c6+XccvEf4MCg1gEJAu+DwazG+DVNf1RCkDYkgs37VXmFBbf21t9YRme7YS1HcXi284Q9kfNGWse323t0VlvTrImQsPsQe6oMLeHd2EbPNN6ub3aUuCjRDEcgcWHxX+kvCkf/xHvW1E1jcoJZxauvcKydiCv48V37kWZQxtw4qJNODPVsIU+R44zQtroi0Be+hQX63ZyRriAqWJJEBGzKI6HJPsdjpG3Vc3onja7pSJW3QaDu/lW8PjGISJQeEi9QZyj2GseK/BcVrkzo6CmB6a4tMCg2mQY5Ir7qkXBGGv51Yy496L2SD5l4UJHQG9D4NFJC5gLAA8HHMB1ULcWPqjb/FcfCK03wHQM64NAO9+x/lQNAHAAX2YIPJ5gjLOmy259gcgyvU7L8idDkJ2yr1iWAUkKo7aIk9uF+QrKQAFiq4u8yDdIZJNQ+Ts+x2oKKSDb5VtVDdyAHQi/ANtRPG4NK/Z8W1ilCdNK4egJtQD80GKITglgrcAvDm7GAgUvenMrdOOvrlEwcpEut/RfSe/eJeHm6vvwhdX3gi1lwnEsNAm/jZX13mIJM+UrhGdBlhhvig38IwcJ8W9zsAUzqpRN4VOZ6jfC6b+sS/Y0+VtHOmH6PwKZYMjbnwus9HtO0/IURgRkxFYTHJapCqYIzWFN4BpySEpeKAeD6PzeaflxfmdVkq7ynBzOtqlqAW/BkrR0Y7mINvwbWv4iO6GSDPJHdmbG+xH+UW+DEnHia4hqdQ2ohfBna6CR8CN+u0CFILsuJOLZ99dv72NlBM1hBDGM8IP5TFZ/QAQhDXKyVAIySckQWg/67gP6hDcqVNQlTt3Z3Bp5Ksj2JAxfs+OKrZqmi8nKzhDDVK6ie+cEli83+7BM4qzhKseI23xey7482t4xHg1VjMBA+zFo89895p+Rfr4Ni6Ek+j4+ayNAovkBd00m7iCQrQSvXB97wCkxqsPopP00DnR7zRQIHs2uowUsjA8dPG/jrjS/UYoEgyM9Xs/FSUpLaAjORmgMNyebyyd3G82egkJ4rfESLTf/Lfie7SAK4GFZyh/GrsDyRW3gxoNiJjVkPK++Ygp9T1h3BB4xirxqpZXj7YAtoUcBcCwBRv9j0xh9EFhGOyOMwoO4rmNW/1GTWx0/FnUAZN0P19SxougYiS7BzkOfe63MH3Nd29lMhC6UvG0g7Pwn4sCXag3v1t6XXfn5RrBnc4hwNv3CiYVAk75nhTtZy6QhgFusIEE1Gf1sTiISULf0Q1Ukd8PtZuzAzk1bA2fbRAJUoZT0iWiKGNFpKKLerkngI3DN5P83tEsCCValn5tCSSoAFZ8NE5iZCGOFvnI2+fc0hSMyOP6hgheBC/JqM0XtzPY4ff3CcRZGFPQp+eT9FGVEXZAx5l6MPfTxBAh6p9mAdsCes1v4slb46vGhDSdrI7iP3whocfnC9FXoxzU/6gk3T51NDqRmqXEDBZpfvMByw0xUJeUSzQ5viPcMHg1uzxlzOnc9szCN1b5NBH44/uD8eVHwoMzBAdw5t/eZ7uSp4CG3yd2DETwEdbr9O8QEP3Wg28roCeRYRkHdKL6HzKxMGDwGRf0vRjBi75j7X6nFNW/ckp20Z7t7ZL6fRp0CBMDCbLfwU4hteMuyDWR35qZvpvj1ZDwnfkxnjWhUnmmRRqK67v2d+On/kdI/wa+GQTprDiGjAAAAYRpQ0NQSUNDIHByb2ZpbGUAAHicfZE9SMNAHMVfU0tFKh0MUsQhQ3WyICriqFUoQoVQK7TqYD76BU0akhQXR8G14ODHYtXBxVlXB1dBEPwAcXVxUnSREv+XFFrEeHDcj3f3HnfvAK5ZVTSrZxzQdNvMpJJCLr8qhF8RQgxR8BiUFMuYE8U0fMfXPQJsvUuwLP9zf45+tWApQEAgnlUM0ybeIJ7etA3G+8S8UpZU4nPiMZMuSPzIdNnjN8YllzmWyZvZzDwxTyyUuljuYqVsasRTxHFV0ymfy3msMt5irFXrSvue7IWRgr6yzHSaw0hhEUsQIUBGHRVUYSNBq06KhQztJ338Q65fJJdMrgoUciygBg2S6wf7g9/dWsXJCS8pkgRCL47zMQKEd4FWw3G+jx2ndQIEn4ErveOvNYGZT9IbHS1+BES3gYvrjibvAZc7QOzJkEzJlYI0uWIReD+jb8oDA7dA35rXW3sfpw9AlrpK3wAHh8BoibLXfd7d293bv2fa/f0ASM5yljz/NiUAAA0aaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA0LjQuMC1FeGl2MiI+CiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICB4bWxuczpHSU1QPSJodHRwOi8vd3d3LmdpbXAub3JnL3htcC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgeG1wTU06RG9jdW1lbnRJRD0iZ2ltcDpkb2NpZDpnaW1wOmI5YjA2YTAwLWZkOTQtNDc5MC1hNzIzLTlkMGUwNGRiNTRlNyIKICAgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo1MTQ3ZGU5Yi1kOTA0LTRlNWYtYjIyYy0wZmMzOGRmMWI3ZGEiCiAgIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo4YzBjNTI2YS1lYTkyLTQxYWItODM5Yy05OWFhYTM0YjdlYzciCiAgIGRjOkZvcm1hdD0iaW1hZ2UvcG5nIgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJMaW51eCIKICAgR0lNUDpUaW1lU3RhbXA9IjE2ODQ5NDE2NDAxNTU0MjYiCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4zMCIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgeG1wOkNyZWF0b3JUb29sPSJHSU1QIDIuMTAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDowMjQ4MDc5ZS1kMTYyLTQxZmItOGViYS1lMzY2NTRiNGRjMjYiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoTGludXgpIgogICAgICBzdEV2dDp3aGVuPSIyMDIzLTA1LTI0VDE3OjIwOjQwKzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PkaovgIAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAADdcAAA3XAUIom3gAAAAHdElNRQfnBRgPFCiKn0kIAAAFfUlEQVRYw82YTWxc1RXHf+e+N2/GH+Px2IEEV02AgqIsIkwgoYS2ahepVGCBUOiCRRdsAAnECthErBBCICGFj4gqRQqBRSABUrVm1URtCSATJ5ASZCPHH0kGgx1/xJl5nvH7uIcFY4iIM/GzZyhHenqL994993/u+f/fOUeos+nNnkHCJoQWRD0UFzCARYhQCVB8NFWWTwNbT99SNxC3GZfIXg9sADYDWxCuRekEskARYQplFPgEOAr045ph6bXRzwKM3pEX5mduQLkHuAvYCqSW8GkIfAT0IBwknT8lH87o/w2M3mpSqL0LeLQKIrOMZSpVUC8hpkf6bPiTg9FbpBn0L8ATwLoqL5ZrFjgNPAeyV47p3E8GRjdLE6r3oTwHXF0n7ikwgfAEIvvlqJYbDkY3uw4a3YLyNrC2niJSBXQG4c+Ie0yORnGSj5OnRhzlUJ4ErrkikBAoAjPVe7ik4F6D8iRxlGvoyegmx4X4NwgHgM6a8fUyIfc8doZbf99Ca66N0uwF+v7tc3DnWoJK6gqep1C2g3NEjsdLlm03GXSbAe4GmmvGZ91vA3Y8P8aN6ztoyaYxxsPaNrbcnmbbvV/x9ONdnPnA+w71otaMcDfYPqDUmDQTUgjdNYPQsSHkgYf62di9mmwujzHNgIsxzWRzeTZ2r+aBh/rp2BDWDLLQjSzpf7VMMIpB6QKcy77Tuc6wdVsHbspbfJspj63bOuhcV8u3g9KFJtufWQbHakfLdQUv3YrI4qwQ+e65616Jr6mknE4KJgIGgctLZnEq5vRgAWsXLyKttZweLFCcqiW7cdVP1DgwQoQwUNPJxIDDG7vXMDszBvqjDWvM7MwYb+xew8SAUzNowgCSDEwyNVMJQU8AAdC06DvBtOG/76xirlLi3u0nufn2HJmWTir+FJ9+PMu7B66nr6eVYLpWCgUoJ0DCGoq3wv/MbXkhmlkN7Ad+XTMY4kBTl6XlKnA8IQ4U/xyUx8wlB3ZpKvcC23Hz49K79Ep6GeWM8VB7J8pfgasaUM6cAx5EzPvSZ4OGljNy1AYIh4C/L6lASWYBcBCHQ0mBJOfM94rk+WjwAsKvgN8te51LK7kPpm3zK89OrZH1v4zaQ9c4RJFrxDgAqjbSlBcpGqlqODoyWq5TP1OtnoU9wPqV9DMKWlRnfJ+/6q3XKpmhSRVbXU8uuhb6Hq1eVsBHdDiGQWPMuZV1mpuMB/aPCK8CXcsMjs6pufCm3/7PPZXs8LhKnJBjMTCH4f2VdIfIcRsgcgh4FpgkiY4u9Mwqc4fn2468M58dSQhkIbNcwBPVNrPSRJdjWgb2AK8BidrdSCX4PGw5/re53IlBK8uZ0EhVyodCq/1uXTTIzfrExZ0oq4H7gfQSmv54IMqcfNFv7/0ilkCSg1CgoKon1ZEv017ar9/cbEvGEFeuQ9mF8IdaBamFuBB7I7tKq3r+EXjnK0tPTxUoIzqqyCBooRIGM2NjX8d1HQIuKFys0cYY2eeJ3riYwinorHUndvmr3nt7Pj1eVNEa5LZALKIVrBTAnopVRx3HzOE44dDwsG3IRHPBxrtTnkv8p5yjLzvoLy72oaC+mvOvz+V79pZbRyYvJbwC80AFQ1GtPevAqFPxCuoxL57ql8ND2vDx7MVW2JTOuMQPdxDvSInmF/yU1ZT+Nd92eGcp97+RH4BE1XHHLDAtomPWmK8mpiYn/AvFOCmRGmLTm53WOOKpDhM/YqApQsLe+dYPnym1f9xvTVGQc8C4iE5Y1Ulj7eRQoTC7Ih1qFJiTQc7vwN9ZUbk6Z+ydp6L0Z2+Ws/uGrAyI8I2gF6yR0vDI6Uq9fDbsZACO3NQuGa3kr3XC7H+ClvJeP1/6IrbBqbNno0b4+xbMlmARngcRbAAAAABJRU5ErkJggg==",turquoiseBlue:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAgCAYAAAC/40AfAAAQDHpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHjapZlrciO5joX/cxWzhCRB8LEckiAjZgez/PnAlD1drrpxu+/YUZJKSmWSwMF5pMP+n/8+4b/4yTHmkLW20kt5+Mk99zR40Z73Z9zH+OT7eH9EPp/FX98P6fP+k3jLD/oc2Mrn+K/34/cJ3qfBK/3Lidr6fDB//aDnz/nbjxN9LiS+Il+FfU7UPyeS9H4QPycY77ae0lv96xbmfp/tayft/Rf84XzVpL5PP/+fK9Uz5TqS0pYoD4+fYkkS/ydBBi+UxySZA6PU9/V9LJ+VUJA/1en7p7Oi40vNfzzol658v/rRrU8F2NqPbuX0OUR+FLl8P//x/RD1z125pf/LlXP7vEq/vr/k2e+KflT/Fv9YO3fP7GLkQqnLZ1NfW7yvOG5yCb90Cyyt0J0ChhrP/tv5bWx+AQV71jP5XbHHRLtOzNHiiCfu+7ziYok57ZAqL1JaSe6bTWrqifXSv+y/8aQqXUwaXVy37VnS91rivWx/VrhXa1zZIoemyMkiX/nHv+GffuEcH4UYvZbjrRXrSsmLzTK8c/7IYXQknk9R9Rb46/fnj/dV6KB6lX1EOqee7ymmxv9jArmNFg5Unt8ZjNU+J6BEXFpZTBQ6QNeiaCzxqSlVCEpSo0GDpfvMTDoQVZOxyJRFCr1pyS/NV2q8hyZNvB14HzKjEyqFOWt0aNCsnBX81NzA0FDRrKpFqzbtOoqUXLSUUouT4qhSc6haS6211V5Hk5abttJqa6230VMXSFN76bW33vsYXHNw5sG3BweMMdOUmaeGWWadbfY5FvBZeekqq662+hqWTAz+sGLVmnUbO26gtPPWXXbdbfc9DlA7Ek4+esqpp51+xnfXPm397fcfdC1+upZup/zA+t013q316xTR6US9ZzQshRzpePUWAOjkPXtazDl557xnT4f+RBOLVO+ZRe8YHcw7Jj3xq3chvR31zv2/+hZq/qVv6T/tXPDW/cPO/d63P3XNnITX7dg7hV7UR5g+Pt9tpDZc7H57Dl8vmBBZjQJKZuNivLe6qJ0KRa10Ri3sSNYUdlTSNhm2fHrW3q2WHUz5Uoy2+qhR1zpd42Kfqyg8pnJK5+GxtfY5jWIPR8pZTsbIJJvx55WD1SrglQsUYzWZesXZ6EkvyWy2BWNz5ii8eI4Oy0Oimkb6skc7bSy6pxpOdJYYfF/3mc9YVbJGen163LX5y4iCvNVAAtgR2sr6lTeca5byylbY04Zy0lkYmkRfF1ReNGUqriVaiyxjp7FhRh2DtvV1qia+03tuAKqzuDlD4XICE9HCqRXrsGVorgIPmcFOOteac6Su7GnsGruyokw9o4BjmR0ARLQ/jwP6BpXm2fXsKYML5BPnaTWtkxc79oIWNTBfe9+FB/A3Oe2s0XJfVYMAPuF6JY3l7goPEzen6iXzT9eoNnwSlc5YYkriFIq5D4N668YUQbg5qBuit6R/55niMfQdTow+0WNvrlaf1sLs3mChUH0c5PChozp06pmlnrJKn4+UbX1r7SOmvPuc0vZs2/wMjDgk0VtYqxjIM1dYscoJtGQYvTb2n5n30Tkf6BursV16Av77ZMB90ucZjDxYsOCHFZuw/1vDvlhJ2YKlPEbd6M9gX8Of00jJTeEY176YG8UDIkBnDqWu7YSyZCM+pjMmOzPXqic9Xsw0s7SV/vW4vs+h3T69/xsRhPcJA/Sdzz51OUPUep69F73eWyzNJidiM5NDYiJEZ04GNnB1WcvGinPN48iEv549+ZStTUt7SN8AY5cIG9bWk7bOPPaUgcRz+LSVmWDI8kBTtZh2O42TplnioNGx7n0YJGe0/MGpMZq1AeLCRxkQIcHZWtMZWkOYa88AP85ZhWvSFmu7zEatE3LewfssC3ZnGhI96iseCHaPafkLlUH/LhpjPVm8LgypZPNX44wGO2V4BWJzCQCLcAzitjMDL/VsLue27FlaJ3tjC3UIVH0aX20MX/5u6a6/UK2/lR05de6JOMTWtzzmBhEZYzQ5Tc+QRtkKC9YEqcF9A/RZKmUGwysy8sNYYWlXNWiILrihT3uAes1rQlP7OTTjHJGzo8IDA+YjV1BReKcFo2UGWgBGbZy/l2nQtwGauIVsUNEpOtFTNdaky7kYApqIyuqMhM7HAEsYYApVU0e+i1uMrCdDT3PpQT+o20OXgEPZwBKiy8REeBwv22wNhA5Bw0S4okzNG35mqDMMaVTl0jZunyl6QV/5IMFkSB8EhX0DGTOBi1E3FHh6YICd/fbZ4/06lbX8tzHBVIELRJmYhTI5dvUigxWcYq4Df0CDx70vPGi03hkp6OEsbTWM9+TQzpH22dKT0T0MjdSiEHJh5OJZggTYdLMzQTrDW3BGMmGpBZcF9X0z4AtKWwK71Mlw8mpfgj5HYVNo7UEJEzPBtxjkTEBt6xiDdAYsVyTggptVFBK7tJCwXhycUQBHmk9VZ/3J+pb3qKMXk1kDsJQHfRGmOO1mD64WS8OJ0Eeqv1D4zfekuw8Alrkkx9LjBMkc3TpyalBHtw5Xm1+VDScVdJByj0tUsFq2crIXUjrAbSZdLdHUDWjevuKdTvvuH+xOA8I2f1EAKCEsU6bqJ4QXzzao7UMTENho75h6mPnDc/jLGx7P0oco6u9EYdiMpB/YXNQAhxc37C0AG5j2d1zgmN99oAv7G39lrE2WwVFQSAFzbnfZdi/BBwI23hOlS9XNbWHOC2yaHOWQ9oTRCrS1eQCsRiZNyb0OeIoHcMQ9FRzlZgfXBoPgG/YqcPO5y4YO8EsTN94fJ4UOxYCqOfjFF1d8ImG042Oa7BbE+CgSfPkaACzizdHSzO8HQQSivWFjk/uYPAm08ML0Oxlj5EZNYNeJky5h4/oWxdnIP68xUhgQCmDb/TYGDPUfczW4nmnWYhgam4adQQ9nq24MODXIPlg1aQgIBmG4KYBBB/XDdGW3ZoYLVazkgYAIVFTlwK4oWesYQAwzSyS9Bwwc9beJo2LIKe9nhuPWn5j7E+S+ARf+NuJ+AI5xvnBboOjArMH78+INjoT6cnMQWNkJokBBi1tjvoBTcpOw0GLGKTvF6zLyB5RSqzEiWyhCQviNkiMvIpQOx4LrwlWnOuDTzs49wpNvcMOgHkfsdhrCByEJeJQAQAYxI/9cPgrQYWbsg7iGRgjlDKlb4Xckeidy0ioTqwt/kXRC58hFGsNjt4ovxYBjL5W8R/hT7XnW99wkrPYXxgYc+FmK293mkftBSbYluHaDfDay1ODagSwdcVET7CMc1zkXWy7L8wYA5IChD6II2pNLesCUUOmHHDST05V6iKiQq8PmoDmMeNcbZK6FWBVCpawscajPgdd3bJw/1UBI8UH1ysPGVCYlDDnj6tmki5t/5Jb7oL554rFh39P35a524lgrMIZUxqLORIcNkO7x/RXcZPyxGhIwZcMpmacKIm3vHoF2AEv6TCwP0XopjZ/uAeBiPC7ChlawzcowIPcoBGrObFFLl9TmbeE0fk8y/Abey4xQX2OPm2TjWefgu434eMCaE7EJlhrXcpAJ5sr1MLB+qkP21oEJngtlRWw20WXjJTHJfIOMRjlLYYc7ERNIxcL2ngjaKRDb3zm4D0JVkQ76ZejoBgasfHm8w+27PrWH/0ZoMvZ9PDrgEzzjEkOQzDnJbkQI1HJBrBNpg1bh54gCP57oSZoZzBG/1hJscm+5OwOcymQAn3kqafWSBWYU7/MR/H/57Gk5ne7UuGEn0+RqeW0SRBrZ8rM2bkQBoHtdbCbaCiHS3GevBXYqChEHkZM98k4io4Fq0ihehV0el5yi7vcsRCzHvmBbM4Oo4a4x9YohJUqwb6FgdoRVVSNIMP8kIi3drSHjMD0erTpCd1qn2+IAyR4Xn+OxoVV4EW9CcmBAS3FzARHEKOWgUXZ3TSn9Bpt/xqxBOeJI1a6CyMAwjRiF3/e/JahO+ALcwOUv1OKf3VvwF9jMhkhgPI3gb9uQQhJJzbXjfvMaxLbtaRxOwNgCb3X4uRYOiz7osgKpTT2ZiC2mA9JthP7l4XQXDvNIZH6Nx/1KvNcgGfl9pfVeY7x3uIN7qsn6VckwqA/DCE/hAwWjS0bT5PMFh6KIU2K5UgGJ/Ix+4YFxAUUpGO0Me16HlBLJ7N7AQusY3EcIWpSY/uKmPCBwIAFCvQYH4Sq0P7IYOMwnxzWcdIWHncQITB62vKWGnQbwwIIh89FHLkkihUyJojCjWwnCoSMnqNp+Ch1HL15exsqP9K8hT6ZgXSU7pmveB8AGGhsxIxlEyHRUR3cGFd8hfjvtNrz92ygnOfjoHMkd29zd1JwEFSO/SCM5lh17sqkGRs7usAhuExZRQktLhdkDmdiGOJg1RK3xBb/1jrvVxQA0D7/QbBloVoU3K/pM/Ohk1Qaj8QVcNmkrI0FV3QSH6Dcw8A5GhK24M4zXqUJ92Tk05ARIVVudK89Xbcltox5yHiNKxriMivWDmO/UTi/bMKIGLoOeM0TEp1z9htwS1HXZ5c5l8EYb+G+mFgEnw/UmWgJenLHN08Coma6DCSK7em/xWlxCM3XiubnDtT08jiIgBFVwljwbIIS6gjMmRtygIiwfowtA/G9kD21jsjGMrXa/fSBQYuxsTByznPXeSirOK3q7VisGrAOqjgQwRMAcYSSn5ERQfKN0QqVcZ5YyKPgX9sls0HlmaeJ8KromfhsYSNjoiZHmlExMo4iwUqrYCl+y3HtnfmNQi9f5yJWlV4OH5YUc0dd7/39TXvB8ovgND7Sdo/e9twbhx/fmZU7YeMcrEsCM0TDfzGyM9AxM+IgMBLI9JsPKaY+TeInkhPeW30IgFsQJbPrUODmW2UTFoTGuACs4sW1K0akJGvg1Cf/+ZtHnmbX67RbAU2uwXvYoDS8GzzKM5LRNYql+H/NQs4gJEjDb88GPp/sXRsyH39RdW+vohMhra6bf0T0EU4pL1EBKRvV8yMCw/e5BHtJwrJAeico3PhZTupL9jk71O511WcC+53vPadEifNmqD/6+Ca1a+B57arkpfxFk/S4oBApPH1aOizMC7lK/D7cCm8Gpmdv8LMsTKPbUoy1mXBbBt/uYUu7kt8X4iEBJVtkKezRr12rliBml/GgfMnphhinBrj0+tkwZfgmFOlagbcwpjomMXOgZY+i+WTBVpb6OMbB3ZnOgIMktAhxTMxLpZXCJvwYdgJdOAiLLEXEflQefJrV5ANNaUX5MRN1kPYPqoWe/TcPEkUmoDPyNRmNehZrh+bo7Yohe/P4KKbNMwW7XxCDD7hYmLI3RhiJ8hjBiC6vitzy3/9nFcwD2X+tecsqjzW1bh3oWs0z623xJIO5TgydMFMUaXh1X4RiCLcheaIZHJKDKqm4NMcBcTmjxGP3GAdIIVtIepjocEsqDaI07Tyi2npk9YovfGDpzY4E8CST/O91aOT5FPS24MRIS9Ze+hF+Ehmaa/4H7fwGCg3GYVGiblAAAAYRpQ0NQSUNDIHByb2ZpbGUAAHicfZE9SMNQFIVPW0tFKx3sUMQhQ3WyICriqFUoQoVQK7TqYPLSP2jSkKS4OAquBQd/FqsOLs66OrgKguAPiKuLk6KLlHhfUmgR44PL+zjvncN99wH+ZpWpZs84oGqWkUklhVx+VQi9IogYIlT9EjP1OVFMw3N93cPH97sEz/K+9+caUAomA3wC8SzTDYt4g3h609I57xNHWVlSiM+JxwxqkPiR67LLb5xLDvt5ZtTIZuaJo8RCqYvlLmZlQyWeIo4rqkb5/pzLCuctzmq1ztp98heGC9rKMtephpHCIpYgQoCMOiqowkKCdo0UExk6T3r4hxy/SC6ZXBUwciygBhWS4wf/g9+zNYuTE25SOAkEX2z7YwQI7QKthm1/H9t26wQIPANXWsdfawIzn6Q3Olr8CIhsAxfXHU3eAy53gNiTLhmSIwWo/MUi8H5G35QHBm+BvjV3bu1znD4AWZpV+gY4OARGS5S97vHu3u65/XunPb8fN2tyj8UDOK0AAA0aaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA0LjQuMC1FeGl2MiI+CiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICB4bWxuczpHSU1QPSJodHRwOi8vd3d3LmdpbXAub3JnL3htcC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgeG1wTU06RG9jdW1lbnRJRD0iZ2ltcDpkb2NpZDpnaW1wOjEwNGNlNWFhLTE1YzctNGI4Yi1iOGU1LTFmYWQyNWFiYzBhZCIKICAgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpkNDMyZTY1Zi0xOThhLTQxM2EtYWYyMy1jNzhlNzczNGRlN2QiCiAgIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoyNzExODVkMi03MWZiLTRhZDMtYTJmMi1iNjM3OWU3MDc1OTEiCiAgIGRjOkZvcm1hdD0iaW1hZ2UvcG5nIgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJMaW51eCIKICAgR0lNUDpUaW1lU3RhbXA9IjE2ODQ5NDE4NjYyMzgzMjQiCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4zMCIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgeG1wOkNyZWF0b3JUb29sPSJHSU1QIDIuMTAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo1NGFiYzNkYS1lZWJiLTRlZjctYjdjNS04ZDRjODY5OGVjODMiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoTGludXgpIgogICAgICBzdEV2dDp3aGVuPSIyMDIzLTA1LTI0VDE3OjI0OjI2KzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/Pj0tlUwAAAAJcEhZcwAADdcAAA3XAUIom3gAAAAHdElNRQfnBRgPGBru/VeEAAAABmJLR0QA/wD/AP+gvaeTAAAFO0lEQVRYw9WYe2xTVRzHTx97dYS5B1UHa+/tY12dDoOKWyIGlfgHkCkSNTHGwHxA3NiAP/A5x4CMKEzdYL29YyAyBxKQZbI+NvYIaowaH9Ogi2GRbGjcFrbBNrq2a2/9nq5LCFnbbfSOeZJPTs/t6Tm/7/39zu+cU0IiXc7WSImNX0BsZiVYAhigmah5tHklsZrjSYtJSuZtaeSiiJU3gHUwfC9oARfBIHBP1DzaPH1eRuzmp0E6aTgSNX9EWMwSvOkMGPgG+CpguG8a0H7nA78zkMYqye0V0lYXDSHrYUw7cE5TxM04/b+38+vJ+RPRt0eIjVeAAhhyCQizFDKJEBjndaCY49Di4+CRlzFxfwSE3Ciol9i4DSBujoRUy7HIszFxdwSF3CioBy8qm1g5ufhirHwyJqwHrrDGWTlg8hFL1URN2+EF0XFPkyYuSWwhUVgnT2CygXBG3dFcM7bz1/au1u7OK9/93eWidUlHe1dCc810EsUAsXOPQZCI3rGZ6Wb4EXAEM0SCUFnZduz6T/09l4bHXYOCz+f0+XxeWg+7XYM/4vnKtlqHJHSIOrAHlYMFYmawRNCKycaDGZLVfMRdf/nPDpfXM+abotDnpy93dtzXfNgdZg+im2uimJ6h66UTeIMZsrat1jvkdPRRb/imLt4hl6N3DfqFEIPvOMzDJYspJsWfbUKEyFNttcKoyzkKo4UgYoRRt3OE9guT1br984nsmQ7gCWbIipaj4xeu9v/hFQTPlG7B89+u9v9O+4UQQ8f/BSlaVM8kgBOhji4p9mpvwQ+Wfwddjp6bQw2u8g44HT3535/tTUa/0Eccvg4sFDE1m2PBZkx2LVRqVcLQvG/PDDX1/tVxze38x+UZH6O1He28b764qgwtxOcf327eBGLFE9NikiD3qzDZhVBJgCJH3KubDnkfbD4s5Jw74qM1bcvDnxq8/vHt1SrS9InIJ2m7OQ4UYsKhCB9lJqHj0gPsHJzPvsS9w8rRRPDptI40M8PlH9fOJ5M5K008rsZmIwi5gc4QN9Zja8zn+5epch9PTFepU1iGuVunVqeyS9g0iv8zy96l0WiSjIsXx28iJEJhaONkMGB5YP14bkmI1SzIz1T0pRa9VKnNzCjUMcwWUAS2BtgWYLJN+xTo1OyrOhW7xsAwqnSGkd3i+uGjkT5Xw6DLt3AdEKQNB4YXbdtwQpuVuRtG7pwhxWA7vJgRib0nDuSDvtkIkjYcHE3aVWjRLL9/zyyETPK2Vq3OidAaOhiPDLcbxo3MRIik0eReWPnO15pHHiqbpYhS6hkNw7wAz0To6GM5hAzH3wkDa6b7x4bEwnkUfMnP6idX7Nex7GxElIDNerV6hU6jSdbp9RHck2w0w/FaGGoJm7KtnCfmWNlF1fOrK3Q6bekMRFABO7QM8yxewFLUi+5JSxPpAmcxy0gjt1Rytir4NcHKCfJTH/al5j1j1hr0pWEML55YD+x2GP6cVqNZZjQYEvUsG4vP4v8jKju5L1p6qnytxGKa6qogyOorBpVbXvxMe69xdxABb9I0DAGvIIRWp7NsBsJIoWVZKfaXuf+jMKp2b6z8+Adb4aErNwpCCh5J2pnfoH0ga08g7invBfaQjXjjuQifhyEgLdNolJP5UqR17y+QnSwvk1i565OZK6F8RzubvWwvDH8LvKZnmHXY8HKws+sNLJtI5muJ/7hYElOzJ1V+fN9R7CVDClPJOVXuqo06vS4HQjTwgDKDZRXk/1JiD7wrieFLk6T1lczCXUVK7aPZinS9XrTw+Q+Tql7SUmvGuQAAAABJRU5ErkJggg==",defaultOffset:[-25.5,-32]};const XML_SCHEMA_INSTANCE_URI="http://www.w3.org/2001/XMLSchema-instance";function createElementNS(s,e){return getDocument().createElementNS(s,e)}function getAllTextContent(s,e){return getAllTextContent_(s,e,[]).join("")}function getAllTextContent_(s,e,i){if(s.nodeType==Node.CDATA_SECTION_NODE||s.nodeType==Node.TEXT_NODE)i.push(s.nodeValue);else{let n;for(n=s.firstChild;n;n=n.nextSibling)getAllTextContent_(n,e,i)}return i}function isDocument(s){return"documentElement"in s}function parse$1(s){return new DOMParser().parseFromString(s,"application/xml")}function makeArrayExtender(s,e){return(function(i,n){const o=s.call(e??this,i,n);if(o!==void 0){const l=n[n.length-1];extend$3(l,o)}})}function makeArrayPusher(s,e){return(function(i,n){const o=s.call(e??this,i,n);o!==void 0&&n[n.length-1].push(o)})}function makeReplacer(s,e){return(function(i,n){const o=s.call(this,i,n);o!==void 0&&(n[n.length-1]=o)})}function makeObjectPropertyPusher(s,e,i){return(function(n,o){const l=s.call(this,n,o);if(l!==void 0){const c=o[o.length-1],u=n.localName;let h;u in c?h=c[u]:(h=[],c[u]=h),h.push(l)}})}function makeObjectPropertySetter(s,e,i){return(function(n,o){const l=s.call(this,n,o);if(l!==void 0){const c=o[o.length-1],u=e!==void 0?e:n.localName;c[u]=l}})}function makeChildAppender(s,e){return(function(i,n,o){s.call(this,i,n,o),o[o.length-1].node.appendChild(i)})}function makeArraySerializer(s,e){let i,n;return function(o,l,c){if(i===void 0){i={};const u={};u[o.localName]=s,i[o.namespaceURI]=u,n=makeSimpleNodeFactory(o.localName)}serialize(i,n,l,c)}}function makeSimpleNodeFactory(s,e){return(function(i,n,o){const c=n[n.length-1].node;let u=s;u===void 0&&(u=o);const h=c.namespaceURI;return createElementNS(h,u)})}const OBJECT_PROPERTY_NODE_FACTORY=makeSimpleNodeFactory();function makeSequence(s,e){const i=e.length,n=new Array(i);for(let o=0;o<i;++o)n[o]=s[e[o]];return n}function makeStructureNS(s,e,i){i=i!==void 0?i:{};let n,o;for(n=0,o=s.length;n<o;++n)i[s[n]]=e;return i}function parseNode(s,e,i,n){let o;for(o=e.firstElementChild;o;o=o.nextElementSibling){const l=s[o.namespaceURI];if(l!==void 0){const c=l[o.localName];c!==void 0&&c.call(n,o,i)}}}function pushParseAndPop(s,e,i,n,o){return n.push(s),parseNode(e,i,n,o),n.pop()}function serialize(s,e,i,n,o,l){const c=(o!==void 0?o:i).length;let u,h;for(let f=0;f<c;++f)u=i[f],u!==void 0&&(h=e.call(l,u,n,o!==void 0?o[f]:void 0),h!==void 0&&s[h.namespaceURI][h.localName].call(l,h,u,n))}function pushSerializeAndPop(s,e,i,n,o,l,c){return o.push(s),serialize(e,i,n,o,l,c),o.pop()}let xmlSerializer_;function getXMLSerializer(){return xmlSerializer_===void 0&&typeof XMLSerializer<"u"&&(xmlSerializer_=new XMLSerializer),xmlSerializer_}let document_;function getDocument(){return document_===void 0&&typeof document<"u"&&(document_=document.implementation.createDocument("","",null)),document_}class FeatureFormat{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Feature,this.supportedMediaTypes=null}getReadOptions(e,i){if(i){let n=i.dataProjection?get$3(i.dataProjection):this.readProjection(e);i.extent&&n&&n.getUnits()==="tile-pixels"&&(n=get$3(n),n.setWorldExtent(i.extent)),i={dataProjection:n,featureProjection:i.featureProjection}}return this.adaptOptions(i)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return abstract()}readFeature(e,i){return abstract()}readFeatures(e,i){return abstract()}readGeometry(e,i){return abstract()}readProjection(e){return abstract()}writeFeature(e,i){return abstract()}writeFeatures(e,i){return abstract()}writeGeometry(e,i){return abstract()}}function transformGeometryWithOptions(s,e,i){const n=i?get$3(i.featureProjection):null,o=i?get$3(i.dataProjection):null;let l=s;if(n&&o&&!equivalent$1(n,o)){e&&(l=s.clone());const c=e?n:o,u=e?o:n;c.getUnits()==="tile-pixels"?l.transform(c,u):l.applyTransform(getTransform(c,u))}if(e&&i&&i.decimals!==void 0){const c=Math.pow(10,i.decimals),u=function(h){for(let f=0,g=h.length;f<g;++f)h[f]=Math.round(h[f]*c)/c;return h};l===s&&(l=s.clone()),l.applyTransform(u)}return l}const GeometryConstructor={Point:Point$1,LineString,Polygon,MultiPoint,MultiLineString,MultiPolygon};function orientFlatCoordinates(s,e,i){return Array.isArray(e[0])?(linearRingssAreOriented(s,0,e,i)||(s=s.slice(),orientLinearRingsArray(s,0,e,i)),s):(linearRingsAreOriented(s,0,e,i)||(s=s.slice(),orientLinearRings(s,0,e,i)),s)}function createRenderFeature(s,e){var l;const i=s.geometry;if(!i)return[];if(Array.isArray(i))return i.map(c=>createRenderFeature({...s,geometry:c})).flat();const n=i.type==="MultiPolygon"?"Polygon":i.type;if(n==="GeometryCollection"||n==="Circle")throw new Error("Unsupported geometry type: "+n);const o=i.layout.length;return transformGeometryWithOptions(new RenderFeature(n,n==="Polygon"?orientFlatCoordinates(i.flatCoordinates,i.ends,o):i.flatCoordinates,(l=i.ends)==null?void 0:l.flat(),o,s.properties||{},s.id).enableSimplifyTransformed(),!1,e)}function createGeometry(s,e){if(!s)return null;if(Array.isArray(s)){const n=s.map(o=>createGeometry(o,e));return new GeometryCollection(n)}const i=GeometryConstructor[s.type];return transformGeometryWithOptions(new i(s.flatCoordinates,s.layout||"XY",s.ends),!1,e)}class XMLFeature extends FeatureFormat{constructor(){super(),this.xmlSerializer_=getXMLSerializer()}getType(){return"xml"}readFeature(e,i){if(!e)return null;if(typeof e=="string"){const n=parse$1(e);return this.readFeatureFromDocument(n,i)}return isDocument(e)?this.readFeatureFromDocument(e,i):this.readFeatureFromNode(e,i)}readFeatureFromDocument(e,i){const n=this.readFeaturesFromDocument(e,i);return n.length>0?n[0]:null}readFeatureFromNode(e,i){return null}readFeatures(e,i){if(!e)return[];if(typeof e=="string"){const n=parse$1(e);return this.readFeaturesFromDocument(n,i)}return isDocument(e)?this.readFeaturesFromDocument(e,i):this.readFeaturesFromNode(e,i)}readFeaturesFromDocument(e,i){const n=[];for(let o=e.firstChild;o;o=o.nextSibling)o.nodeType==Node.ELEMENT_NODE&&extend$3(n,this.readFeaturesFromNode(o,i));return n}readFeaturesFromNode(e,i){return abstract()}readGeometry(e,i){if(!e)return null;if(typeof e=="string"){const n=parse$1(e);return this.readGeometryFromDocument(n,i)}return isDocument(e)?this.readGeometryFromDocument(e,i):this.readGeometryFromNode(e,i)}readGeometryFromDocument(e,i){return null}readGeometryFromNode(e,i){return null}readProjection(e){if(!e)return null;if(typeof e=="string"){const i=parse$1(e);return this.readProjectionFromDocument(i)}return isDocument(e)?this.readProjectionFromDocument(e):this.readProjectionFromNode(e)}readProjectionFromDocument(e){return this.dataProjection}readProjectionFromNode(e){return this.dataProjection}writeFeature(e,i){const n=this.writeFeatureNode(e,i);return this.xmlSerializer_.serializeToString(n)}writeFeatureNode(e,i){return null}writeFeatures(e,i){const n=this.writeFeaturesNode(e,i);return this.xmlSerializer_.serializeToString(n)}writeFeaturesNode(e,i){return null}writeGeometry(e,i){const n=this.writeGeometryNode(e,i);return this.xmlSerializer_.serializeToString(n)}writeGeometryNode(e,i){return null}}function readBoolean(s){const e=getAllTextContent(s,!1);return readBooleanString(e)}function readBooleanString(s){const e=/^\s*(true|1)|(false|0)\s*$/.exec(s);if(e)return e[1]!==void 0||!1}function readDateTime(s){const e=getAllTextContent(s,!1),i=Date.parse(e);return isNaN(i)?void 0:i/1e3}function readDecimal(s){const e=getAllTextContent(s,!1);return readDecimalString(e)}function readDecimalString(s){const e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(s);if(e)return parseFloat(e[1])}function readPositiveInteger(s){const e=getAllTextContent(s,!1);return readNonNegativeIntegerString(e)}function readNonNegativeIntegerString(s){const e=/^\s*(\d+)\s*$/.exec(s);if(e)return parseInt(e[1],10)}function readString(s){return getAllTextContent(s,!1).trim()}function writeBooleanTextNode(s,e){writeStringTextNode(s,e?"1":"0")}function writeCDATASection(s,e){s.appendChild(getDocument().createCDATASection(e))}function writeDateTimeTextNode(s,e){const i=new Date(e*1e3),n=i.getUTCFullYear()+"-"+padNumber(i.getUTCMonth()+1,2)+"-"+padNumber(i.getUTCDate(),2)+"T"+padNumber(i.getUTCHours(),2)+":"+padNumber(i.getUTCMinutes(),2)+":"+padNumber(i.getUTCSeconds(),2)+"Z";s.appendChild(getDocument().createTextNode(n))}function writeDecimalTextNode(s,e){const i=e.toPrecision();s.appendChild(getDocument().createTextNode(i))}function writeNonNegativeIntegerTextNode(s,e){const i=e.toString();s.appendChild(getDocument().createTextNode(i))}const whiteSpaceStart=/^\s/,whiteSpaceEnd=/\s$/,cdataCharacters=/(\n|\t|\r|<|&| {2})/;function writeStringTextNode(s,e){typeof e=="string"&&(whiteSpaceStart.test(e)||whiteSpaceEnd.test(e)||cdataCharacters.test(e))?e.split("]]>").forEach((i,n,o)=>{n<o.length-1&&(i+="]]"),n>0&&(i=">"+i),writeCDATASection(s,i)}):s.appendChild(getDocument().createTextNode(e))}const GX_NAMESPACE_URIS=["http://www.google.com/kml/ext/2.2"],NAMESPACE_URIS$4=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],SCHEMA_LOCATION$1="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",ICON_ANCHOR_UNITS_MAP={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},PLACEMARK_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{ExtendedData:extendedDataParser,Region:regionParser,MultiGeometry:makeObjectPropertySetter(readMultiGeometry,"geometry"),LineString:makeObjectPropertySetter(readLineString,"geometry"),LinearRing:makeObjectPropertySetter(readLinearRing,"geometry"),Point:makeObjectPropertySetter(readPoint,"geometry"),Polygon:makeObjectPropertySetter(readPolygon,"geometry"),Style:makeObjectPropertySetter(readStyle$2),StyleMap:placemarkStyleMapParser,address:makeObjectPropertySetter(readString),description:makeObjectPropertySetter(readString),name:makeObjectPropertySetter(readString),open:makeObjectPropertySetter(readBoolean),phoneNumber:makeObjectPropertySetter(readString),styleUrl:makeObjectPropertySetter(readStyleURL),visibility:makeObjectPropertySetter(readBoolean)},makeStructureNS(GX_NAMESPACE_URIS,{MultiTrack:makeObjectPropertySetter(readGxMultiTrack,"geometry"),Track:makeObjectPropertySetter(readGxTrack,"geometry")})),NETWORK_LINK_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{ExtendedData:extendedDataParser,Region:regionParser,Link:linkParser,address:makeObjectPropertySetter(readString),description:makeObjectPropertySetter(readString),name:makeObjectPropertySetter(readString),open:makeObjectPropertySetter(readBoolean),phoneNumber:makeObjectPropertySetter(readString),visibility:makeObjectPropertySetter(readBoolean)}),LINK_PARSERS$1=makeStructureNS(NAMESPACE_URIS$4,{href:makeObjectPropertySetter(readURI)}),CAMERA_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{Altitude:makeObjectPropertySetter(readDecimal),Longitude:makeObjectPropertySetter(readDecimal),Latitude:makeObjectPropertySetter(readDecimal),Tilt:makeObjectPropertySetter(readDecimal),AltitudeMode:makeObjectPropertySetter(readString),Heading:makeObjectPropertySetter(readDecimal),Roll:makeObjectPropertySetter(readDecimal)}),REGION_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{LatLonAltBox:latLonAltBoxParser,Lod:lodParser}),KML_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["Document","Placemark"]),KML_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{Document:makeChildAppender(writeDocument),Placemark:makeChildAppender(writePlacemark)});let DEFAULT_COLOR,DEFAULT_FILL_STYLE=null,DEFAULT_IMAGE_STYLE_ANCHOR,DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS,DEFAULT_IMAGE_STYLE_SIZE,DEFAULT_IMAGE_STYLE_SRC,DEFAULT_IMAGE_STYLE=null,DEFAULT_NO_IMAGE_STYLE,DEFAULT_STROKE_STYLE=null,DEFAULT_TEXT_STROKE_STYLE,DEFAULT_TEXT_STYLE=null,DEFAULT_STYLE$1=null,DEFAULT_STYLE_ARRAY=null;function scaleForSize(s){return 32/Math.min(s[0],s[1])}function createStyleDefaults(){DEFAULT_COLOR=[255,255,255,1],DEFAULT_FILL_STYLE=new Fill({color:DEFAULT_COLOR}),DEFAULT_IMAGE_STYLE_ANCHOR=[20,2],DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS="pixels",DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS="pixels",DEFAULT_IMAGE_STYLE_SIZE=[64,64],DEFAULT_IMAGE_STYLE_SRC="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",DEFAULT_IMAGE_STYLE=new Icon({anchor:DEFAULT_IMAGE_STYLE_ANCHOR,anchorOrigin:"bottom-left",anchorXUnits:DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,anchorYUnits:DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS,crossOrigin:"anonymous",rotation:0,scale:scaleForSize(DEFAULT_IMAGE_STYLE_SIZE),size:DEFAULT_IMAGE_STYLE_SIZE,src:DEFAULT_IMAGE_STYLE_SRC}),DEFAULT_NO_IMAGE_STYLE="NO_IMAGE",DEFAULT_STROKE_STYLE=new Stroke({color:DEFAULT_COLOR,width:1}),DEFAULT_TEXT_STROKE_STYLE=new Stroke({color:[51,51,51,1],width:2}),DEFAULT_TEXT_STYLE=new Text({font:"bold 16px Helvetica",fill:DEFAULT_FILL_STYLE,stroke:DEFAULT_TEXT_STROKE_STYLE,scale:.8}),DEFAULT_STYLE$1=new Style$1({fill:DEFAULT_FILL_STYLE,image:DEFAULT_IMAGE_STYLE,text:DEFAULT_TEXT_STYLE,stroke:DEFAULT_STROKE_STYLE,zIndex:0}),DEFAULT_STYLE_ARRAY=[DEFAULT_STYLE$1]}let TEXTAREA;function defaultIconUrlFunction(s){return s}let KML$1=class extends XMLFeature{constructor(e){super(),e=e||{},DEFAULT_STYLE_ARRAY||createStyleDefaults(),this.dataProjection=get$3("EPSG:4326"),this.defaultStyle_=e.defaultStyle?e.defaultStyle:DEFAULT_STYLE_ARRAY,this.extractStyles_=e.extractStyles!==void 0?e.extractStyles:!0,this.writeStyles_=e.writeStyles!==void 0?e.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=e.showPointNames!==void 0?e.showPointNames:!0,this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",this.iconUrlFunction_=e.iconUrlFunction?e.iconUrlFunction:defaultIconUrlFunction,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(e,i){const n=makeStructureNS(NAMESPACE_URIS$4,{Document:makeArrayExtender(this.readDocumentOrFolder_,this),Folder:makeArrayExtender(this.readDocumentOrFolder_,this),Placemark:makeArrayPusher(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),o=pushParseAndPop([],n,e,i,this);if(o)return o}readPlacemark_(e,i){const n=pushParseAndPop({geometry:null},PLACEMARK_PARSERS,e,i,this);if(!n)return;const o=new Feature,l=e.getAttribute("id");l!==null&&o.setId(l);const c=i[0],u=n.geometry;if(u&&transformGeometryWithOptions(u,!1,c),o.setGeometry(u),delete n.geometry,this.extractStyles_){const h=n.Style,f=n.styleUrl,g=createFeatureStyleFunction(h,f,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);o.setStyle(g)}return delete n.Style,o.setProperties(n,!0),o}readSharedStyle_(e,i){const n=e.getAttribute("id");if(n!==null){const o=readStyle$2.call(this,e,i);if(o){let l,c=e.baseURI;(!c||c=="about:blank")&&(c=window.location.href),c?l=new URL("#"+n,c).href:l="#"+n,this.sharedStyles_[l]=o}}}readSharedStyleMap_(e,i){const n=e.getAttribute("id");if(n===null)return;const o=readStyleMapValue.call(this,e,i);if(!o)return;let l,c=e.baseURI;(!c||c=="about:blank")&&(c=window.location.href),c?l=new URL("#"+n,c).href:l="#"+n,this.sharedStyles_[l]=o}readFeatureFromNode(e,i){if(!NAMESPACE_URIS$4.includes(e.namespaceURI))return null;const n=this.readPlacemark_(e,[this.getReadOptions(e,i)]);return n||null}readFeaturesFromNode(e,i){if(!NAMESPACE_URIS$4.includes(e.namespaceURI))return[];let n;const o=e.localName;if(o=="Document"||o=="Folder")return n=this.readDocumentOrFolder_(e,[this.getReadOptions(e,i)]),n||[];if(o=="Placemark"){const l=this.readPlacemark_(e,[this.getReadOptions(e,i)]);return l?[l]:[]}if(o=="kml"){n=[];for(let l=e.firstElementChild;l;l=l.nextElementSibling){const c=this.readFeaturesFromNode(l,i);c&&extend$3(n,c)}return n}return[]}readName(e){if(e){if(typeof e=="string"){const i=parse$1(e);return this.readNameFromDocument(i)}return isDocument(e)?this.readNameFromDocument(e):this.readNameFromNode(e)}}readNameFromDocument(e){for(let i=e.firstChild;i;i=i.nextSibling)if(i.nodeType==Node.ELEMENT_NODE){const n=this.readNameFromNode(i);if(n)return n}}readNameFromNode(e){for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(NAMESPACE_URIS$4.includes(i.namespaceURI)&&i.localName=="name")return readString(i);for(let i=e.firstElementChild;i;i=i.nextElementSibling){const n=i.localName;if(NAMESPACE_URIS$4.includes(i.namespaceURI)&&(n=="Document"||n=="Folder"||n=="Placemark"||n=="kml")){const o=this.readNameFromNode(i);if(o)return o}}}readNetworkLinks(e){const i=[];if(typeof e=="string"){const n=parse$1(e);extend$3(i,this.readNetworkLinksFromDocument(n))}else isDocument(e)?extend$3(i,this.readNetworkLinksFromDocument(e)):extend$3(i,this.readNetworkLinksFromNode(e));return i}readNetworkLinksFromDocument(e){const i=[];for(let n=e.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&extend$3(i,this.readNetworkLinksFromNode(n));return i}readNetworkLinksFromNode(e){const i=[];for(let n=e.firstElementChild;n;n=n.nextElementSibling)if(NAMESPACE_URIS$4.includes(n.namespaceURI)&&n.localName=="NetworkLink"){const o=pushParseAndPop({},NETWORK_LINK_PARSERS,n,[]);i.push(o)}for(let n=e.firstElementChild;n;n=n.nextElementSibling){const o=n.localName;NAMESPACE_URIS$4.includes(n.namespaceURI)&&(o=="Document"||o=="Folder"||o=="kml")&&extend$3(i,this.readNetworkLinksFromNode(n))}return i}readRegion(e){const i=[];if(typeof e=="string"){const n=parse$1(e);extend$3(i,this.readRegionFromDocument(n))}else isDocument(e)?extend$3(i,this.readRegionFromDocument(e)):extend$3(i,this.readRegionFromNode(e));return i}readRegionFromDocument(e){const i=[];for(let n=e.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&extend$3(i,this.readRegionFromNode(n));return i}readRegionFromNode(e){const i=[];for(let n=e.firstElementChild;n;n=n.nextElementSibling)if(NAMESPACE_URIS$4.includes(n.namespaceURI)&&n.localName=="Region"){const o=pushParseAndPop({},REGION_PARSERS,n,[]);i.push(o)}for(let n=e.firstElementChild;n;n=n.nextElementSibling){const o=n.localName;NAMESPACE_URIS$4.includes(n.namespaceURI)&&(o=="Document"||o=="Folder"||o=="kml")&&extend$3(i,this.readRegionFromNode(n))}return i}readCamera(e){const i=[];if(typeof e=="string"){const n=parse$1(e);extend$3(i,this.readCameraFromDocument(n))}else isDocument(e)?extend$3(i,this.readCameraFromDocument(e)):extend$3(i,this.readCameraFromNode(e));return i}readCameraFromDocument(e){const i=[];for(let n=e.firstChild;n;n=n.nextSibling)n.nodeType===Node.ELEMENT_NODE&&extend$3(i,this.readCameraFromNode(n));return i}readCameraFromNode(e){const i=[];for(let n=e.firstElementChild;n;n=n.nextElementSibling)if(NAMESPACE_URIS$4.includes(n.namespaceURI)&&n.localName==="Camera"){const o=pushParseAndPop({},CAMERA_PARSERS,n,[]);i.push(o)}for(let n=e.firstElementChild;n;n=n.nextElementSibling){const o=n.localName;NAMESPACE_URIS$4.includes(n.namespaceURI)&&(o==="Document"||o==="Folder"||o==="Placemark"||o==="kml")&&extend$3(i,this.readCameraFromNode(n))}return i}writeFeaturesNode(e,i){i=this.adaptOptions(i);const n=createElementNS(NAMESPACE_URIS$4[4],"kml"),o="http://www.w3.org/2000/xmlns/";n.setAttributeNS(o,"xmlns:gx",GX_NAMESPACE_URIS[0]),n.setAttributeNS(o,"xmlns:xsi",XML_SCHEMA_INSTANCE_URI),n.setAttributeNS(XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",SCHEMA_LOCATION$1);const l={node:n},c={};e.length>1?c.Document=e:e.length==1&&(c.Placemark=e[0]);const u=KML_SEQUENCE[n.namespaceURI],h=makeSequence(c,u);return pushSerializeAndPop(l,KML_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,h,[i],u,this),n}};function createNameStyleFunction(s,e){const i=[0,0];let n="start";const o=s.getImage();if(o){const u=o.getSize();if(u&&u.length==2){const h=o.getScaleArray(),f=o.getAnchor();i[0]=h[0]*(u[0]-f[0]),i[1]=h[1]*(u[1]/2-f[1]),n="left"}}let l=s.getText();return l?(l=l.clone(),l.setFont(l.getFont()||DEFAULT_TEXT_STYLE.getFont()),l.setScale(l.getScale()||DEFAULT_TEXT_STYLE.getScale()),l.setFill(l.getFill()||DEFAULT_TEXT_STYLE.getFill()),l.setStroke(l.getStroke()||DEFAULT_TEXT_STROKE_STYLE)):l=DEFAULT_TEXT_STYLE.clone(),l.setText(e),l.setOffsetX(i[0]),l.setOffsetY(i[1]),l.setTextAlign(n),new Style$1({image:o,text:l})}function createFeatureStyleFunction(s,e,i,n,o){return(function(l,c){let u=o,h="",f=[];if(u){const H=l.getGeometry();if(H)if(H instanceof GeometryCollection)f=H.getGeometriesArrayRecursive().filter(function(Y){const ee=Y.getType();return ee==="Point"||ee==="MultiPoint"}),u=f.length>0;else{const Y=H.getType();u=Y==="Point"||Y==="MultiPoint"}}u&&(h=l.get("name"),u=u&&!!h,u&&/&[^&]+;/.test(h)&&(TEXTAREA||(TEXTAREA=document.createElement("textarea")),TEXTAREA.innerHTML=h,h=TEXTAREA.value));let g=i;if(s?g=s:e&&(g=findStyle(e,i,n)),u){const H=createNameStyleFunction(g[0],h);if(f.length>0){H.setGeometry(new GeometryCollection(f));const Y=new Style$1({geometry:g[0].getGeometry(),image:null,fill:g[0].getFill(),stroke:g[0].getStroke(),text:null});return[H,Y].concat(g.slice(1))}return H}return g})}function findStyle(s,e,i){return Array.isArray(s)?s:typeof s=="string"?findStyle(i[s],e,i):e}function readColor(s){const e=getAllTextContent(s,!1),i=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(i){const n=i[1];return[parseInt(n.substr(6,2),16),parseInt(n.substr(4,2),16),parseInt(n.substr(2,2),16),parseInt(n.substr(0,2),16)/255]}}function readFlatCoordinates(s){let e=getAllTextContent(s,!1);const i=[];e=e.replace(/\s*,\s*/g,",");const n=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let o;for(;o=n.exec(e);){const l=parseFloat(o[1]),c=parseFloat(o[2]),u=o[3]?parseFloat(o[3]):0;i.push(l,c,u),e=e.substr(o[0].length)}if(e==="")return i}function readURI(s){const e=getAllTextContent(s,!1).trim();let i=s.baseURI;return(!i||i=="about:blank")&&(i=window.location.href),i?new URL(e,i).href:e}function readStyleURL(s){const e=getAllTextContent(s,!1).trim().replace(/^(?!.*#)/,"#");let i=s.baseURI;return(!i||i=="about:blank")&&(i=window.location.href),i?new URL(e,i).href:e}function readVec2(s){const e=s.getAttribute("xunits"),i=s.getAttribute("yunits");let n;return e!=="insetPixels"?i!=="insetPixels"?n="bottom-left":n="top-left":i!=="insetPixels"?n="bottom-right":n="top-right",{x:parseFloat(s.getAttribute("x")),xunits:ICON_ANCHOR_UNITS_MAP[e],y:parseFloat(s.getAttribute("y")),yunits:ICON_ANCHOR_UNITS_MAP[i],origin:n}}function readScale(s){return readDecimal(s)}const STYLE_MAP_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{Pair:pairDataParser});function readStyleMapValue(s,e){return pushParseAndPop(void 0,STYLE_MAP_PARSERS,s,e,this)}const ICON_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{Icon:makeObjectPropertySetter(readIcon),color:makeObjectPropertySetter(readColor),heading:makeObjectPropertySetter(readDecimal),hotSpot:makeObjectPropertySetter(readVec2),scale:makeObjectPropertySetter(readScale)});function iconStyleParser(s,e){const i=pushParseAndPop({},ICON_STYLE_PARSERS,s,e);if(!i)return;const n=e[e.length-1],o="Icon"in i?i.Icon:{},l=!("Icon"in i)||Object.keys(o).length>0;let c;const u=o.href;u?c=u:l&&(c=DEFAULT_IMAGE_STYLE_SRC);let h,f,g,H="bottom-left";const Y=i.hotSpot;Y?(h=[Y.x,Y.y],f=Y.xunits,g=Y.yunits,H=Y.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(c)&&(c.includes("pushpin")?(h=DEFAULT_IMAGE_STYLE_ANCHOR,f=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,g=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS):c.includes("arrow-reverse")?(h=[54,42],f=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,g=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS):c.includes("paddle")&&(h=[32,1],f=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,g=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS));let ee;const te=o.x,xe=o.y;te!==void 0&&xe!==void 0&&(ee=[te,xe]);let ne;const et=o.w,tt=o.h;et!==void 0&&tt!==void 0&&(ne=[et,tt]);let it;const rt=i.heading;rt!==void 0&&(it=toRadians(rt));const nt=i.scale,st=i.color;if(l){c==DEFAULT_IMAGE_STYLE_SRC&&(ne=DEFAULT_IMAGE_STYLE_SIZE);const at=new Icon({anchor:h,anchorOrigin:H,anchorXUnits:f,anchorYUnits:g,crossOrigin:this.crossOrigin_,offset:ee,offsetOrigin:"bottom-left",rotation:it,scale:nt,size:ne,src:this.iconUrlFunction_(c),color:st}),ot=at.getScaleArray()[0],ct=at.getSize();if(ct===null){const ht=at.getImageState();if(ht===ImageState.IDLE||ht===ImageState.LOADING){const ut=function(){const pt=at.getImageState();if(!(pt===ImageState.IDLE||pt===ImageState.LOADING)){const yt=at.getSize();if(yt&&yt.length==2){const mt=scaleForSize(yt);at.setScale(ot*mt)}at.unlistenImageChange(ut)}};at.listenImageChange(ut),ht===ImageState.IDLE&&at.load()}}else if(ct.length==2){const ht=scaleForSize(ct);at.setScale(ot*ht)}n.imageStyle=at}else n.imageStyle=DEFAULT_NO_IMAGE_STYLE}const LABEL_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{color:makeObjectPropertySetter(readColor),scale:makeObjectPropertySetter(readScale)});function labelStyleParser(s,e){const i=pushParseAndPop({},LABEL_STYLE_PARSERS,s,e);if(!i)return;const n=e[e.length-1],o=new Text({fill:new Fill({color:"color"in i?i.color:DEFAULT_COLOR}),scale:i.scale});n.textStyle=o}const LINE_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{color:makeObjectPropertySetter(readColor),width:makeObjectPropertySetter(readDecimal)});function lineStyleParser(s,e){const i=pushParseAndPop({},LINE_STYLE_PARSERS,s,e);if(!i)return;const n=e[e.length-1],o=new Stroke({color:"color"in i?i.color:DEFAULT_COLOR,width:"width"in i?i.width:1});n.strokeStyle=o}const POLY_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{color:makeObjectPropertySetter(readColor),fill:makeObjectPropertySetter(readBoolean),outline:makeObjectPropertySetter(readBoolean)});function polyStyleParser(s,e){const i=pushParseAndPop({},POLY_STYLE_PARSERS,s,e);if(!i)return;const n=e[e.length-1],o=new Fill({color:"color"in i?i.color:DEFAULT_COLOR});n.fillStyle=o;const l=i.fill;l!==void 0&&(n.fill=l);const c=i.outline;c!==void 0&&(n.outline=c)}const FLAT_LINEAR_RING_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{coordinates:makeReplacer(readFlatCoordinates)});function readFlatLinearRing(s,e){return pushParseAndPop(null,FLAT_LINEAR_RING_PARSERS,s,e)}function gxCoordParser(s,e){const n=e[e.length-1].coordinates,o=getAllTextContent(s,!1),c=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(o);if(c){const u=parseFloat(c[1]),h=parseFloat(c[2]),f=parseFloat(c[3]);n.push([u,h,f])}else n.push([])}const GX_MULTITRACK_GEOMETRY_PARSERS=makeStructureNS(GX_NAMESPACE_URIS,{Track:makeArrayPusher(readGxTrack)});function readGxMultiTrack(s,e){const i=pushParseAndPop([],GX_MULTITRACK_GEOMETRY_PARSERS,s,e);if(i)return new MultiLineString(i)}const GX_TRACK_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{when:whenParser},makeStructureNS(GX_NAMESPACE_URIS,{coord:gxCoordParser}));function readGxTrack(s,e){const i=pushParseAndPop({coordinates:[],whens:[]},GX_TRACK_PARSERS,s,e);if(!i)return;const n=[],o=i.coordinates,l=i.whens;for(let c=0,u=Math.min(o.length,l.length);c<u;++c)o[c].length==3&&n.push(o[c][0],o[c][1],o[c][2],l[c]);return new LineString(n,"XYZM")}const ICON_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{href:makeObjectPropertySetter(readURI)},makeStructureNS(GX_NAMESPACE_URIS,{x:makeObjectPropertySetter(readDecimal),y:makeObjectPropertySetter(readDecimal),w:makeObjectPropertySetter(readDecimal),h:makeObjectPropertySetter(readDecimal)}));function readIcon(s,e){const i=pushParseAndPop({},ICON_PARSERS,s,e);return i||null}const GEOMETRY_FLAT_COORDINATES_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{coordinates:makeReplacer(readFlatCoordinates)});function readFlatCoordinatesFromNode(s,e){return pushParseAndPop(null,GEOMETRY_FLAT_COORDINATES_PARSERS,s,e)}const EXTRUDE_AND_ALTITUDE_MODE_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{extrude:makeObjectPropertySetter(readBoolean),tessellate:makeObjectPropertySetter(readBoolean),altitudeMode:makeObjectPropertySetter(readString)});function readLineString(s,e){const i=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,s,e),n=readFlatCoordinatesFromNode(s,e);if(n){const o=new LineString(n,"XYZ");return o.setProperties(i,!0),o}}function readLinearRing(s,e){const i=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,s,e),n=readFlatCoordinatesFromNode(s,e);if(n){const o=new Polygon(n,"XYZ",[n.length]);return o.setProperties(i,!0),o}}const MULTI_GEOMETRY_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{LineString:makeArrayPusher(readLineString),LinearRing:makeArrayPusher(readLinearRing),MultiGeometry:makeArrayPusher(readMultiGeometry),Point:makeArrayPusher(readPoint),Polygon:makeArrayPusher(readPolygon)});function readMultiGeometry(s,e){const i=pushParseAndPop([],MULTI_GEOMETRY_PARSERS,s,e);if(!i)return null;if(i.length===0)return new GeometryCollection(i);let n,o=!0;const l=i[0].getType();let c;for(let u=1,h=i.length;u<h;++u)if(c=i[u],c.getType()!=l){o=!1;break}if(o){let u,h;if(l=="Point"){const f=i[0];u=f.getLayout(),h=f.getFlatCoordinates();for(let g=1,H=i.length;g<H;++g)c=i[g],extend$3(h,c.getFlatCoordinates());n=new MultiPoint(h,u),setCommonGeometryProperties(n,i)}else if(l=="LineString")n=new MultiLineString(i),setCommonGeometryProperties(n,i);else if(l=="Polygon")n=new MultiPolygon(i),setCommonGeometryProperties(n,i);else if(l=="GeometryCollection"||l.startsWith("Multi"))n=new GeometryCollection(i);else throw new Error("Unknown geometry type found")}else n=new GeometryCollection(i);return n}function readPoint(s,e){const i=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,s,e),n=readFlatCoordinatesFromNode(s,e);if(n){const o=new Point$1(n,"XYZ");return o.setProperties(i,!0),o}}const FLAT_LINEAR_RINGS_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{innerBoundaryIs:innerBoundaryIsParser,outerBoundaryIs:outerBoundaryIsParser});function readPolygon(s,e){const i=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,s,e),n=pushParseAndPop([null],FLAT_LINEAR_RINGS_PARSERS,s,e);if(n&&n[0]){const o=n[0],l=[o.length];for(let u=1,h=n.length;u<h;++u)extend$3(o,n[u]),l.push(o.length);const c=new Polygon(o,"XYZ",l);return c.setProperties(i,!0),c}}const STYLE_PARSERS$2=makeStructureNS(NAMESPACE_URIS$4,{IconStyle:iconStyleParser,LabelStyle:labelStyleParser,LineStyle:lineStyleParser,PolyStyle:polyStyleParser});function readStyle$2(s,e){const i=pushParseAndPop({},STYLE_PARSERS$2,s,e,this);if(!i)return null;let n="fillStyle"in i?i.fillStyle:DEFAULT_FILL_STYLE;const o=i.fill;o!==void 0&&!o&&(n=null);let l;"imageStyle"in i?i.imageStyle!=DEFAULT_NO_IMAGE_STYLE&&(l=i.imageStyle):l=DEFAULT_IMAGE_STYLE;const c="textStyle"in i?i.textStyle:DEFAULT_TEXT_STYLE,u="strokeStyle"in i?i.strokeStyle:DEFAULT_STROKE_STYLE,h=i.outline;return h!==void 0&&!h?[new Style$1({geometry:function(f){const g=f.getGeometry(),H=g.getType();if(H==="GeometryCollection"){const Y=g;return new GeometryCollection(Y.getGeometriesArrayRecursive().filter(function(ee){const te=ee.getType();return te!=="Polygon"&&te!=="MultiPolygon"}))}if(H!=="Polygon"&&H!=="MultiPolygon")return g},fill:n,image:l,stroke:u,text:c,zIndex:void 0}),new Style$1({geometry:function(f){const g=f.getGeometry(),H=g.getType();if(H==="GeometryCollection"){const Y=g;return new GeometryCollection(Y.getGeometriesArrayRecursive().filter(function(ee){const te=ee.getType();return te==="Polygon"||te==="MultiPolygon"}))}if(H==="Polygon"||H==="MultiPolygon")return g},fill:n,stroke:null,zIndex:void 0})]:[new Style$1({fill:n,image:l,stroke:u,text:c,zIndex:void 0})]}function setCommonGeometryProperties(s,e){const i=e.length,n=new Array(e.length),o=new Array(e.length),l=new Array(e.length);let c,u,h;c=!1,u=!1,h=!1;for(let f=0;f<i;++f){const g=e[f];n[f]=g.get("extrude"),o[f]=g.get("tessellate"),l[f]=g.get("altitudeMode"),c=c||n[f]!==void 0,u=u||o[f]!==void 0,h=h||l[f]}c&&s.set("extrude",n),u&&s.set("tessellate",o),h&&s.set("altitudeMode",l)}const DATA_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{displayName:makeObjectPropertySetter(readString),value:makeObjectPropertySetter(readString)});function dataParser(s,e){const i=s.getAttribute("name");parseNode(DATA_PARSERS,s,e);const n=e[e.length-1];i&&n.displayName?n[i]={value:n.value,displayName:n.displayName,toString:function(){return n.value}}:i!==null?n[i]=n.value:n.displayName!==null&&(n[n.displayName]=n.value),delete n.value}const EXTENDED_DATA_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{Data:dataParser,SchemaData:schemaDataParser});function extendedDataParser(s,e){parseNode(EXTENDED_DATA_PARSERS,s,e)}function regionParser(s,e){parseNode(REGION_PARSERS,s,e)}const PAIR_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{Style:makeObjectPropertySetter(readStyle$2),key:makeObjectPropertySetter(readString),styleUrl:makeObjectPropertySetter(readStyleURL)});function pairDataParser(s,e){const i=pushParseAndPop({},PAIR_PARSERS,s,e,this);if(!i)return;const n=i.key;if(n&&n=="normal"){const o=i.styleUrl;o&&(e[e.length-1]=o);const l=i.Style;l&&(e[e.length-1]=l)}}function placemarkStyleMapParser(s,e){const i=readStyleMapValue.call(this,s,e);if(!i)return;const n=e[e.length-1];if(Array.isArray(i))n.Style=i;else if(typeof i=="string")n.styleUrl=i;else throw new Error("`styleMapValue` has an unknown type")}const SCHEMA_DATA_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{SimpleData:simpleDataParser});function schemaDataParser(s,e){parseNode(SCHEMA_DATA_PARSERS,s,e)}function simpleDataParser(s,e){const i=s.getAttribute("name");if(i!==null){const n=readString(s),o=e[e.length-1];o[i]=n}}const LAT_LON_ALT_BOX_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{altitudeMode:makeObjectPropertySetter(readString),minAltitude:makeObjectPropertySetter(readDecimal),maxAltitude:makeObjectPropertySetter(readDecimal),north:makeObjectPropertySetter(readDecimal),south:makeObjectPropertySetter(readDecimal),east:makeObjectPropertySetter(readDecimal),west:makeObjectPropertySetter(readDecimal)});function latLonAltBoxParser(s,e){const i=pushParseAndPop({},LAT_LON_ALT_BOX_PARSERS,s,e);if(!i)return;const n=e[e.length-1],o=[parseFloat(i.west),parseFloat(i.south),parseFloat(i.east),parseFloat(i.north)];n.extent=o,n.altitudeMode=i.altitudeMode,n.minAltitude=parseFloat(i.minAltitude),n.maxAltitude=parseFloat(i.maxAltitude)}const LOD_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{minLodPixels:makeObjectPropertySetter(readDecimal),maxLodPixels:makeObjectPropertySetter(readDecimal),minFadeExtent:makeObjectPropertySetter(readDecimal),maxFadeExtent:makeObjectPropertySetter(readDecimal)});function lodParser(s,e){const i=pushParseAndPop({},LOD_PARSERS,s,e);if(!i)return;const n=e[e.length-1];n.minLodPixels=parseFloat(i.minLodPixels),n.maxLodPixels=parseFloat(i.maxLodPixels),n.minFadeExtent=parseFloat(i.minFadeExtent),n.maxFadeExtent=parseFloat(i.maxFadeExtent)}const INNER_BOUNDARY_IS_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{LinearRing:makeArrayPusher(readFlatLinearRing)});function innerBoundaryIsParser(s,e){const i=pushParseAndPop([],INNER_BOUNDARY_IS_PARSERS,s,e);i.length>0&&e[e.length-1].push(...i)}const OUTER_BOUNDARY_IS_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{LinearRing:makeReplacer(readFlatLinearRing)});function outerBoundaryIsParser(s,e){const i=pushParseAndPop(void 0,OUTER_BOUNDARY_IS_PARSERS,s,e);if(i){const n=e[e.length-1];n[0]=i}}function linkParser(s,e){parseNode(LINK_PARSERS$1,s,e)}function whenParser(s,e){const n=e[e.length-1].whens,o=getAllTextContent(s,!1),l=Date.parse(o);n.push(isNaN(l)?0:l)}function writeColorTextNode(s,e){const i=asArray(e),o=[(i.length==4?i[3]:1)*255,i[2],i[1],i[0]];for(let l=0;l<4;++l){const c=Math.floor(o[l]).toString(16);o[l]=c.length==1?"0"+c:c}writeStringTextNode(s,o.join(""))}function writeCoordinatesTextNode(s,e,i){const n=i[i.length-1],o=n.layout,l=n.stride;let c;if(o=="XY"||o=="XYM")c=2;else if(o=="XYZ"||o=="XYZM")c=3;else throw new Error("Invalid geometry layout");const u=e.length;let h="";if(u>0){h+=e[0];for(let f=1;f<c;++f)h+=","+e[f];for(let f=l;f<u;f+=l){h+=" "+e[f];for(let g=1;g<c;++g)h+=","+e[f+g]}}writeStringTextNode(s,h)}const EXTENDEDDATA_NODE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{Data:makeChildAppender(writeDataNode),value:makeChildAppender(writeDataNodeValue),displayName:makeChildAppender(writeDataNodeName)});function writeDataNode(s,e,i){s.setAttribute("name",e.name);const n={node:s},o=e.value;typeof o=="object"?(o!==null&&o.displayName&&pushSerializeAndPop(n,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[o.displayName],i,["displayName"]),o!==null&&o.value&&pushSerializeAndPop(n,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[o.value],i,["value"])):pushSerializeAndPop(n,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[o],i,["value"])}function writeDataNodeName(s,e){writeStringTextNode(s,e)}function writeDataNodeValue(s,e){writeStringTextNode(s,e)}const DOCUMENT_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{Placemark:makeChildAppender(writePlacemark)}),DOCUMENT_NODE_FACTORY=function(s,e,i){const n=e[e.length-1].node;return createElementNS(n.namespaceURI,"Placemark")};function writeDocument(s,e,i){pushSerializeAndPop({node:s},DOCUMENT_SERIALIZERS,DOCUMENT_NODE_FACTORY,e,i,void 0,this)}const DATA_NODE_FACTORY=makeSimpleNodeFactory("Data");function writeExtendedData(s,e,i){const n={node:s},o=e.names,l=e.values,c=o.length;for(let u=0;u<c;u++)pushSerializeAndPop(n,EXTENDEDDATA_NODE_SERIALIZERS,DATA_NODE_FACTORY,[{name:o[u],value:l[u]}],i)}const ICON_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["href"],makeStructureNS(GX_NAMESPACE_URIS,["x","y","w","h"])),ICON_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{href:makeChildAppender(writeStringTextNode)},makeStructureNS(GX_NAMESPACE_URIS,{x:makeChildAppender(writeDecimalTextNode),y:makeChildAppender(writeDecimalTextNode),w:makeChildAppender(writeDecimalTextNode),h:makeChildAppender(writeDecimalTextNode)})),GX_NODE_FACTORY=function(s,e,i){return createElementNS(GX_NAMESPACE_URIS[0],"gx:"+i)};function writeIcon(s,e,i){const n={node:s},o=i[i.length-1].node;let l=ICON_SEQUENCE[o.namespaceURI],c=makeSequence(e,l);pushSerializeAndPop(n,ICON_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,c,i,l),l=ICON_SEQUENCE[GX_NAMESPACE_URIS[0]],c=makeSequence(e,l),pushSerializeAndPop(n,ICON_SERIALIZERS,GX_NODE_FACTORY,c,i,l)}const ICON_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["scale","heading","Icon","color","hotSpot"]),ICON_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{Icon:makeChildAppender(writeIcon),color:makeChildAppender(writeColorTextNode),heading:makeChildAppender(writeDecimalTextNode),hotSpot:makeChildAppender(writeVec2),scale:makeChildAppender(writeScaleTextNode)});function writeIconStyle(s,e,i){const n={node:s},o={},l=e.getSrc(),c=e.getSize(),u=e.getImageSize(),h={href:l};if(c){h.w=c[0],h.h=c[1];const ne=e.getAnchor(),et=e.getOrigin();if(et&&u&&et[0]!==0&&et[1]!==c[1]&&(h.x=et[0],h.y=u[1]-(et[1]+c[1])),ne&&(ne[0]!==c[0]/2||ne[1]!==c[1]/2)){const tt={x:ne[0],xunits:"pixels",y:c[1]-ne[1],yunits:"pixels"};o.hotSpot=tt}}o.Icon=h;let f=e.getScaleArray()[0],g=c;if(g===null&&(g=DEFAULT_IMAGE_STYLE_SIZE),g.length==2){const ne=scaleForSize(g);f=f/ne}f!==1&&(o.scale=f);const H=e.getRotation();H!==0&&(o.heading=H);const Y=e.getColor();Y&&(o.color=Y);const ee=i[i.length-1].node,te=ICON_STYLE_SEQUENCE[ee.namespaceURI],xe=makeSequence(o,te);pushSerializeAndPop(n,ICON_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,xe,i,te)}const LABEL_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["color","scale"]),LABEL_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{color:makeChildAppender(writeColorTextNode),scale:makeChildAppender(writeScaleTextNode)});function writeLabelStyle(s,e,i){const n={node:s},o={},l=e.getFill();l&&(o.color=l.getColor());const c=e.getScale();c&&c!==1&&(o.scale=c);const u=i[i.length-1].node,h=LABEL_STYLE_SEQUENCE[u.namespaceURI],f=makeSequence(o,h);pushSerializeAndPop(n,LABEL_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,f,i,h)}const LINE_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["color","width"]),LINE_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{color:makeChildAppender(writeColorTextNode),width:makeChildAppender(writeDecimalTextNode)});function writeLineStyle(s,e,i){const n={node:s},o={color:e.getColor(),width:Number(e.getWidth())||1},l=i[i.length-1].node,c=LINE_STYLE_SEQUENCE[l.namespaceURI],u=makeSequence(o,c);pushSerializeAndPop(n,LINE_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,u,i,c)}const GEOMETRY_TYPE_TO_NODENAME$1={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},GEOMETRY_NODE_FACTORY=function(s,e,i){if(s){const n=e[e.length-1].node;return createElementNS(n.namespaceURI,GEOMETRY_TYPE_TO_NODENAME$1[s.getType()])}},POINT_NODE_FACTORY=makeSimpleNodeFactory("Point"),LINE_STRING_NODE_FACTORY=makeSimpleNodeFactory("LineString"),LINEAR_RING_NODE_FACTORY=makeSimpleNodeFactory("LinearRing"),POLYGON_NODE_FACTORY=makeSimpleNodeFactory("Polygon"),MULTI_GEOMETRY_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{LineString:makeChildAppender(writePrimitiveGeometry),Point:makeChildAppender(writePrimitiveGeometry),Polygon:makeChildAppender(writePolygon),GeometryCollection:makeChildAppender(writeMultiGeometry)});function writeMultiGeometry(s,e,i){const n={node:s},o=e.getType();let l=[],c;if(o==="GeometryCollection")e.getGeometriesArrayRecursive().forEach(function(u){const h=u.getType();if(h==="MultiPoint")l=l.concat(u.getPoints());else if(h==="MultiLineString")l=l.concat(u.getLineStrings());else if(h==="MultiPolygon")l=l.concat(u.getPolygons());else if(h==="Point"||h==="LineString"||h==="Polygon")l.push(u);else throw new Error("Unknown geometry type")}),c=GEOMETRY_NODE_FACTORY;else if(o==="MultiPoint")l=e.getPoints(),c=POINT_NODE_FACTORY;else if(o==="MultiLineString")l=e.getLineStrings(),c=LINE_STRING_NODE_FACTORY;else if(o==="MultiPolygon")l=e.getPolygons(),c=POLYGON_NODE_FACTORY;else throw new Error("Unknown geometry type");pushSerializeAndPop(n,MULTI_GEOMETRY_SERIALIZERS,c,l,i)}const BOUNDARY_IS_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{LinearRing:makeChildAppender(writePrimitiveGeometry)});function writeBoundaryIs(s,e,i){pushSerializeAndPop({node:s},BOUNDARY_IS_SERIALIZERS,LINEAR_RING_NODE_FACTORY,[e],i)}const PLACEMARK_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{ExtendedData:makeChildAppender(writeExtendedData),MultiGeometry:makeChildAppender(writeMultiGeometry),LineString:makeChildAppender(writePrimitiveGeometry),LinearRing:makeChildAppender(writePrimitiveGeometry),Point:makeChildAppender(writePrimitiveGeometry),Polygon:makeChildAppender(writePolygon),Style:makeChildAppender(writeStyle),address:makeChildAppender(writeStringTextNode),description:makeChildAppender(writeStringTextNode),name:makeChildAppender(writeStringTextNode),open:makeChildAppender(writeBooleanTextNode),phoneNumber:makeChildAppender(writeStringTextNode),styleUrl:makeChildAppender(writeStringTextNode),visibility:makeChildAppender(writeBooleanTextNode)}),PLACEMARK_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),EXTENDEDDATA_NODE_FACTORY=makeSimpleNodeFactory("ExtendedData");function writePlacemark(s,e,i){const n={node:s};e.getId()&&s.setAttribute("id",e.getId());const o=e.getProperties(),l={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};l[e.getGeometryName()]=1;const c=Object.keys(o||{}).sort().filter(function(ee){return!l[ee]}),u=e.getStyleFunction();if(u){const ee=u(e,0);if(ee){const te=Array.isArray(ee)?ee:[ee];let xe=te;if(e.getGeometry()&&(xe=te.filter(function(ne){const et=ne.getGeometryFunction()(e);if(et){const tt=et.getType();return tt==="GeometryCollection"?et.getGeometriesArrayRecursive().filter(function(it){const rt=it.getType();return rt==="Point"||rt==="MultiPoint"}).length:tt==="Point"||tt==="MultiPoint"}})),this.writeStyles_){let ne=te,et=te;e.getGeometry()&&(ne=te.filter(function(tt){const it=tt.getGeometryFunction()(e);if(it){const rt=it.getType();return rt==="GeometryCollection"?it.getGeometriesArrayRecursive().filter(function(nt){const st=nt.getType();return st==="LineString"||st==="MultiLineString"}).length:rt==="LineString"||rt==="MultiLineString"}}),et=te.filter(function(tt){const it=tt.getGeometryFunction()(e);if(it){const rt=it.getType();return rt==="GeometryCollection"?it.getGeometriesArrayRecursive().filter(function(nt){const st=nt.getType();return st==="Polygon"||st==="MultiPolygon"}).length:rt==="Polygon"||rt==="MultiPolygon"}})),o.Style={pointStyles:xe,lineStyles:ne,polyStyles:et}}if(xe.length&&o.name===void 0){const ne=xe[0].getText();ne&&(o.name=ne.getText())}}}const h=i[i.length-1].node,f=PLACEMARK_SEQUENCE[h.namespaceURI],g=makeSequence(o,f);if(pushSerializeAndPop(n,PLACEMARK_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,g,i,f),c.length>0){const ee=makeSequence(o,c);pushSerializeAndPop(n,PLACEMARK_SERIALIZERS,EXTENDEDDATA_NODE_FACTORY,[{names:c,values:ee}],i)}const H=i[0];let Y=e.getGeometry();Y&&(Y=transformGeometryWithOptions(Y,!0,H)),pushSerializeAndPop(n,PLACEMARK_SERIALIZERS,GEOMETRY_NODE_FACTORY,[Y],i)}const PRIMITIVE_GEOMETRY_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["extrude","tessellate","altitudeMode","coordinates"]),PRIMITIVE_GEOMETRY_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{extrude:makeChildAppender(writeBooleanTextNode),tessellate:makeChildAppender(writeBooleanTextNode),altitudeMode:makeChildAppender(writeStringTextNode),coordinates:makeChildAppender(writeCoordinatesTextNode)});function writePrimitiveGeometry(s,e,i){const n=e.getFlatCoordinates(),o={node:s};o.layout=e.getLayout(),o.stride=e.getStride();const l=e.getProperties();l.coordinates=n;const c=i[i.length-1].node,u=PRIMITIVE_GEOMETRY_SEQUENCE[c.namespaceURI],h=makeSequence(l,u);pushSerializeAndPop(o,PRIMITIVE_GEOMETRY_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,h,i,u)}const POLY_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["color","fill","outline"]),POLYGON_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{outerBoundaryIs:makeChildAppender(writeBoundaryIs),innerBoundaryIs:makeChildAppender(writeBoundaryIs)}),INNER_BOUNDARY_NODE_FACTORY=makeSimpleNodeFactory("innerBoundaryIs"),OUTER_BOUNDARY_NODE_FACTORY=makeSimpleNodeFactory("outerBoundaryIs");function writePolygon(s,e,i){const n=e.getLinearRings(),o=n.shift(),l={node:s};pushSerializeAndPop(l,POLYGON_SERIALIZERS,INNER_BOUNDARY_NODE_FACTORY,n,i),pushSerializeAndPop(l,POLYGON_SERIALIZERS,OUTER_BOUNDARY_NODE_FACTORY,[o],i)}const POLY_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{color:makeChildAppender(writeColorTextNode),fill:makeChildAppender(writeBooleanTextNode),outline:makeChildAppender(writeBooleanTextNode)});function writePolyStyle(s,e,i){const n={node:s},o=e.getFill(),l=e.getStroke(),c={color:o?o.getColor():void 0,fill:o?void 0:!1,outline:l?void 0:!1},u=i[i.length-1].node,h=POLY_STYLE_SEQUENCE[u.namespaceURI],f=makeSequence(c,h);pushSerializeAndPop(n,POLY_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,f,i,h)}function writeScaleTextNode(s,e){writeDecimalTextNode(s,Math.round(e*1e6)/1e6)}const STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{IconStyle:makeChildAppender(writeIconStyle),LabelStyle:makeChildAppender(writeLabelStyle),LineStyle:makeChildAppender(writeLineStyle),PolyStyle:makeChildAppender(writePolyStyle)});function writeStyle(s,e,i){const n={node:s},o={};if(e.pointStyles.length){const h=e.pointStyles[0].getText();h&&(o.LabelStyle=h);const f=e.pointStyles[0].getImage();f&&typeof f.getSrc=="function"&&(o.IconStyle=f)}if(e.lineStyles.length){const h=e.lineStyles[0].getStroke();h&&(o.LineStyle=h)}if(e.polyStyles.length){const h=e.polyStyles[0].getStroke();h&&!o.LineStyle&&(o.LineStyle=h),o.PolyStyle=e.polyStyles[0]}const l=i[i.length-1].node,c=STYLE_SEQUENCE[l.namespaceURI],u=makeSequence(o,c);pushSerializeAndPop(n,STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,u,i,c)}function writeVec2(s,e){s.setAttribute("x",String(e.x)),s.setAttribute("y",String(e.y)),s.setAttribute("xunits",e.xunits),s.setAttribute("yunits",e.yunits)}var ColorUtils={hex:function(s){if(s>255)throw new Error("'"+s+"'' is greater than 255(0xff);");var e=Number(s).toString(16);return("0"+e).slice(-2)},num:function(s){return parseInt(s,16)},arrayToRgba:function(s){if(!Array.isArray(s))throw new Error("Not an array !");var e=s[0],i=s[1],n=s[2],o=s[3]||1,l="rgba("+e+", "+i+", "+n+", "+parseFloat(o)+")";return l},arrayToHex:function(s){if(!Array.isArray(s))throw new Error("Not an array !");var e=s[0],i=s[1],n=s[2],o=s[3],l=[this.hex(e),this.hex(i),this.hex(n)],c={};return c.hex="#"+l.join(""),o&&(c.opacity=parseFloat(o)),c},rgbaToHex:function(s){var e=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(0?.?\d+)\s*)?\)/,i=e.exec(s);if(!i)throw new Error("Invalid format: "+s);var n=i[1],o=i[2],l=i[3],c=i[4],u=[this.hex(n),this.hex(o),this.hex(l)],h={};return h.hex="#"+u.join(""),c&&(h.opacity=parseFloat(c)),h},hexToRgba:function(s,e){var i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;if(!s)throw new Error("Invalid format");s=s.replace(i,function(l,c,u,h){return c+c+u+u+h+h});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);n=n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null;var o=n?"rgba("+n.r+", "+n.g+", "+n.b+", "+e+")":null;return o},isHex:function(s){if(!s||s.charAt(0)!=="#")return!1;var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,i=e.exec(s);return!!i},isRGB:function(s){if(!s)return!1;var e=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(0?.?\d+)\s*)?\)/,i=e.exec(s);return!!i}},logger$F=LoggerByDefault.getLogger("styling");Feature.prototype.setPropertyFill=function(){var s=this.getStyle();if(s&&!(Array.isArray(s)&&s.length===0)){var e=s.getFill();if(e){var i=e.getColor();if(Array.isArray(i)){var n="rgba(";n+=i[0]+",",n+=i[1]+",",n+=i[2]+",",n+=i[3]+")",i=n}if(ColorUtils.isRGB(i)){var o=ColorUtils.rgbaToHex(i);this.set("fill",o.hex),this.set("fill-opacity",o.opacity)}else this.set("fill",i),this.set("fill-opacity",1)}}};Feature.prototype.setPropertyStroke=function(){var s=this.getStyle();if(s&&!(Array.isArray(s)&&s.length===0)){var e=s.getStroke();if(e){var i=e.getColor();if(Array.isArray(i)){var n="rgba(";n+=i[0]+",",n+=i[1]+",",n+=i[2]+",",n+=i[3]+")",i=n}if(ColorUtils.isRGB(i)){var o=ColorUtils.rgbaToHex(i);this.set("stroke",o.hex),this.set("stroke-opacity",o.opacity)}else this.set("stroke",i),this.set("stroke-opacity",1);this.set("stroke-width",e.getWidth())}}};Feature.prototype.setPropertyLabel=function(){var s=this.getStyle();if(s&&!(Array.isArray(s)&&s.length===0)){var e=this.get("name")!==void 0,i=s.getText();if(i&&e){var n=s.getText().getFill();if(n){var o=n.getColor();if(Array.isArray(o)){var l="rgba(";l+=o[0]+",",l+=o[1]+",",l+=o[2]+",",l+=o[3]+")",o=l}if(ColorUtils.isRGB(o)){var c=ColorUtils.rgbaToHex(o);this.set("label-fill",c.hex),this.set("label-fill-opacity",c.opacity)}else this.set("label-fill",o),this.set("label-fill-opacity",1)}var u=s.getText().getStroke();if(u){var h=u.getColor();if(Array.isArray(h)){var f="rgba(";f+=h[0]+",",f+=h[1]+",",f+=h[2]+",",f+=h[3]+")",h=f}if(ColorUtils.isRGB(h)){var g=ColorUtils.rgbaToHex(h);this.set("label-stroke",g.hex),this.set("label-stroke-opacity",g.opacity)}else this.set("label-stroke",h),this.set("label-stroke-opacity",1);this.set("label-stroke-width",u.getWidth())}this.set("label-font",s.getText().getFont()||Styling.DEFAULT_TEXT.font),this.set("label-textAlign",s.getText().getTextAlign()||Styling.DEFAULT_TEXT.textAlign)}}};Feature.prototype.setPropertyMarker=function(){var s=this.getStyle();if(s&&!(Array.isArray(s)&&s.length===0)){var e=s.getImage();if(e)if(e instanceof Icon){var i=e.getColor();if(Array.isArray(i)){var n="rgba(";n+=i[0]+",",n+=i[1]+",",n+=i[2]+",",n+=i[3]+")",i=n}if(i){var o=ColorUtils.rgbaToHex(i);this.set("marker-color",o.hex)}var l=e.getScale();switch(Math.round(l*2)/2){case 0:case .5:this.set("marker-size","small");break;case 1:this.set("marker-size","medium");break;case 1.5:case 2:this.set("marker-size","large");break}var c=e.getSrc();c&&this.set("marker-symbol",c),this.unset("circle-fill"),this.unset("circle-fill-opacity"),this.unset("circle-stroke"),this.unset("circle-stroke-width"),this.unset("circle-stroke-opacity"),this.unset("circle-radius")}else{var u=e.getFill();if(u){var h=u.getColor();if(Array.isArray(h)){var f="rgba(";f+=h[0]+",",f+=h[1]+",",f+=h[2]+",",f+=h[3]+")",h=f}if(ColorUtils.isRGB(h)){var g=ColorUtils.rgbaToHex(h);this.set("circle-fill",g.hex),this.set("circle-fill-opacity",g.opacity)}else this.set("circle-fill",h),this.set("circle-fill-opacity",1)}var H=e.getStroke();if(H){var Y=H.getColor();if(Array.isArray(Y)){var ee="rgba(";ee+=Y[0]+",",ee+=Y[1]+",",ee+=Y[2]+",",ee+=Y[3]+")",Y=ee}if(ColorUtils.isRGB(Y)){var te=ColorUtils.rgbaToHex(Y);this.set("circle-stroke",te.hex),this.set("circle-stroke-opacity",te.opacity)}else this.set("circle-stroke",Y),this.set("circle-stroke-opacity",1);this.set("circle-stroke-width",H.getWidth())}var xe=e.getRadius();this.set("circle-radius",xe)}}};var Styling={APPLY_CONVERT_GEOM_GPX:!0,DEFAULT_ICON:{src:Marker.lightOrange,anchor:[.5,1],scale:1},DEFAULT_CIRCLE:{radius:10,fill:{opacity:1,color:[0,0,0,1]},stroke:{width:1,opacity:1,color:[0,0,0,1]}},DEFAULT_STROKE:{width:5,opacity:1,color:[250,250,250,1]},DEFAULT_FILL:{opacity:1,color:[0,0,0,1]},DEFAULT_TEXT:{font:"16px sans",textAlign:"left",stroke:{color:[250,250,250,1],width:5,opactity:1},fill:{opacity:1,color:[0,0,0,1]}},getListTags:function(){return["type","fill","fill-opacity","stroke","stroke-opacity","stroke-width","circle-fill","circle-fill-opacity","circle-stroke","circle-stroke-opacity","circle-stroke-width","circle-radius","marker-symbol","marker-color","marker-size","label-fill","label-fill-opacity","label-stroke","label-stroke-width","label-stroke-opacity","label-font","label-textAlign"]},defineStyleFromProperties:function(s){var e=null,i={},n=null;if(s.get("marker-color")||s.get("marker-size")||s.get("marker-symbol")){n={},n.src=this.DEFAULT_ICON.src,n.anchor=this.DEFAULT_ICON.anchor;var o=s.get("marker-symbol");o&&o.search("data:image/png;base64")!==-1&&(n.src=o);var l=s.get("marker-color");ColorUtils.isHex(l)&&(n.color=ColorUtils.hexToRgba(l,1));var c=s.get("marker-size");if(c)switch(c){case"small":n.scale=.5;break;case"medium":n.scale=1;break;case"large":n.scale=1.5;break;default:n.scale=this.DEFAULT_ICON.scale;break}}var u=null;(s.get("stroke")||s.get("stroke-opacity")||s.get("stroke-width"))&&(u={},u.color=ColorUtils.hexToRgba(s.get("stroke"),+s.get("stroke-opacity")||this.DEFAULT_STROKE.opacity),u.width=+s.get("stroke-width")||this.DEFAULT_STROKE.width);var h=null;(s.get("fill")||s.get("fill-opacity"))&&(h={},h.color=ColorUtils.hexToRgba(s.get("fill"),+s.get("fill-opacity")||this.DEFAULT_FILL.opacity));var f=null,g=null,H=s.get("name")!=="";H&&((s.get("label-fill")||s.get("label-fill-opacity"))&&(g={},g.color=ColorUtils.hexToRgba(s.get("label-fill"),+s.get("label-fill-opacity")||this.DEFAULT_TEXT.fill.opacity)),(s.get("label-stroke")||s.get("label-stroke-opacity")||s.get("label-stroke-width"))&&(f={},f.color=ColorUtils.hexToRgba(s.get("label-stroke"),+s.get("label-stroke-opacity")||this.DEFAULT_TEXT.stroke.opacity),f.width=+s.get("label-stroke-width")||this.DEFAULT_TEXT.stroke.width));var Y=s.get("circle-radius")||this.DEFAULT_CIRCLE.radius,ee=null;(s.get("circle-stroke")||s.get("circle-stroke-opacity")||s.get("circle-stroke-width"))&&(ee={},ee.color=ColorUtils.hexToRgba(s.get("circle-stroke"),+s.get("circle-stroke-opacity")||this.DEFAULT_CIRCLE.stroke.opacity),ee.width=+s.get("circle-stroke-width")||this.DEFAULT_CIRCLE.stroke.width);var te=null;if((s.get("circle-fill")||s.get("circle-fill-opacity"))&&(te={},te.color=ColorUtils.hexToRgba(s.get("circle-fill"),+s.get("circle-fill-opacity")||this.DEFAULT_CIRCLE.fill.opacity)),s.getGeometry()){var xe=s.getGeometry().getType();switch(xe){case"Circle":case"Point":case"MultiPoint":var ne=!1,et={};if(ee&&(et.stroke=new Stroke(ee)),te&&(et.fill=new Fill(te)),Object.keys(et).length!==0&&(ne=!0,et.radius=+Y,i.image=new CircleStyle(et)),n&&(i.image=new Icon(n)),H){var tt={};if(f&&(tt.stroke=new Stroke(f)),g&&(tt.fill=new Fill(g)),Object.keys(tt).length!==0)tt.text=s.get("name"),tt.textAlign=s.get("label-textAlign")||this.DEFAULT_TEXT.textAlign,tt.font=s.get("label-font")||this.DEFAULT_TEXT.font,i.text=new Text(Object.assign({},this.DEFAULT_TEXT,tt));else if(n||ne){var it=new Text(Object.assign({},this.DEFAULT_TEXT,{fill:new Fill(this.DEFAULT_TEXT.fill),stroke:new Stroke(this.DEFAULT_TEXT.stroke)}));if(it){var rt=it.clone();rt.setText(s.get("name")),i.text=rt}}}break;case"Polygon":case"MultiPolygon":u&&(i.stroke=new Stroke(u)),h&&(i.fill=new Fill(h));break;case"LineString":case"MultiLineString":if(u&&(i.stroke=new Stroke(u)),this.APPLY_CONVERT_GEOM_GPX&&h){var nt=s.get("type");if(nt&&(nt==="Polygon"||nt==="MultiPolygon")){i.fill=new Fill(h);var st=s.clone(),at=xe==="LineString"?Polygon:MultiPolygon;s.setGeometry(new at([st.getGeometry().getCoordinates()]))}}break}}return Object.keys(i).length!==0&&(e=new Style$1(i)),e},defineStyleFunctionByDefault:function(s){if(!s)return[];if(Object.keys(s).length===0)return[];var e=(i,n)=>{if(i.getGeometry()){var o=null,l=i.getGeometry().getType();switch(l){case"Point":case"MultiPoint":var c={};if(s.getImage()&&(c.image=s.getImage()),s.getText()&&i.get("name")){var u=s.getText().clone();u.setText(i.get("name")),c.text=u}o=new Style$1(c);break;case"Circle":var h={},f={};if(s.getFill()&&(f.fill=s.getFill()),s.getStroke()&&(f.stroke=s.getStroke()),s.getText()&&i.get("name")){var g=s.getText().clone();g.setText(i.get("name")),h.text=g}Object.keys(f).length!==0&&(f.radius=3,h.image=new CircleStyle(f)),o=new Style$1(h);break;case"Polygon":case"MultiPolygon":var H={};s.getFill()&&(H.fill=s.getFill()),s.getStroke()&&(H.stroke=s.getStroke()),o=new Style$1(H);break;case"LineString":case"LinearRing":case"MultiLineString":var Y={};s.getStroke()&&(Y.stroke=s.getStroke()),o=new Style$1(Y);break}return[o]}};return e},definePropertiesFromStyleByType:function(s){if(s.getGeometry()){var e=s.getGeometry().getType();switch(e){case"Point":case"MultiPoint":s.setPropertyMarker(),s.setPropertyLabel();break;case"LineString":case"MultiLineString":s.setPropertyStroke();break;case"Polygon":case"MultiPolygon":s.setPropertyStroke(),s.setPropertyFill();break}}},definePropertiesFromStyle:function(s){var e=s.getStyle()||s.getStyleFunction();if(e){if(typeof e=="function"){var i=e.call(this,s,0);if(i&&i.length!==0)e=Array.isArray(i)?i[0]:i,s.setStyle(e);else return}this.definePropertiesFromStyleByType(s)}},defineTagFromStyle:function(s,e){return logger$F.trace("todo..."),null}},logger$E=LoggerByDefault.getLogger("parser"),Parser$1={parse:function(s){var e=null,i=null,n=typeof window<"u"?window:null;if(typeof exports=="object"&&window===null){var o=require("@xmldom/xmldom").DOMParser;i=new o,e=i.parseFromString(s,"text/xml")}else n.DOMParser?(i=new n.DOMParser,e=i.parseFromString(s,"text/xml")):n.ActiveXObject?(e=new n.ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.loadXML(s)):logger$E.log("Incompatible environment for DOM Parser !");var l=e.querySelector("parsererror");return l?(console.error(l),null):(logger$E.trace(e),e)},toString:function(s){var e=new XMLSerializer,i=e.serializeToString(s);return logger$E.trace(i),i},format:function(s){var e=/(>)\s*(<)(\/*)/g,i=/ *(.*) +\n/g,n=/(<.+>)(.+\n)/g;s=s.replace(e,`$1
$2$3`).replace(i,`$1
`).replace(n,`$1
$2`);for(var o="",l=s.split(`
`),c=0,u="other",h={"single->single":0,"single->closing":-1,"single->opening":0,"single->other":0,"closing->single":0,"closing->closing":-1,"closing->opening":0,"closing->other":0,"opening->single":1,"opening->closing":0,"opening->opening":1,"opening->other":1,"other->single":0,"other->closing":-1,"other->opening":0,"other->other":0},f=0;f<l.length;f++){var g=l[f],H=!!g.match(/<.+\/>/),Y=!!g.match(/<\/.+>/),ee=!!g.match(/<[^!].*>/),te=H?"single":Y?"closing":ee?"opening":"other",xe=u+"->"+te;u=te;var ne="";c+=h[xe];for(var et=0;et<c;et++)ne+="	";xe==="opening->closing"?o=o.substr(0,o.length-1)+g+`
`:o+=ne+g+`
`}return logger$E.trace(o),o}},logger$D=LoggerByDefault.getLogger("extended KML format");class KML extends KML$1{constructor(e){if(super(e),!(this instanceof KML))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return e=e||{},this.source=null,this.extensions=e.extensions||null,e.defaultStyle&&!Array.isArray(e.defaultStyle)&&(e.defaultStyle=[e.defaultStyle]),(e.defaultStyle===null||typeof e.defaultStyle>"u")&&(e.defaultStyle=[]),this}_processKml(e,i,n){for(var o=e.nodeName==="#document"?e.childNodes[0].childNodes:e.childNodes,l=o,c=0;c<o.length;c++){const Gt=o[c];if(Gt.nodeName==="Document"){l=Gt.childNodes;break}if(Gt.nodeName==="Placemark"){l=[Gt];break}}for(var u={},h=-1,f=0;f<l.length;f++){var g=l[f];switch(g.nodeName){case"Style":var H=g.attributes[0];if(H&&H.nodeName==="id"){var Y=H.nodeValue,ee=g;u[Y]=ee}break;case"Placemark":h++;for(var te=g.childNodes,xe=!1,ne=!1,et=!1,tt=null,it=null,rt=null,nt=g,st=0;st<te.length;st++)switch(te[st].nodeName){case"Polygon":et=!0;break;case"LineString":ne=!0;break;case"Point":xe=!0;break;case"Style":it=te[st],tt=te[st].childNodes;break;case"styleUrl":var at=te[st].textContent.slice(1);u[at]&&(tt=u[at].childNodes);break;case"ExtendedData":rt=te[st].childNodes;break;case"name":nt=null;break}if(rt){logger$D.log("ExtendedData :",rt);var ot=n.extendedData;ot&&typeof ot=="function"&&ot(i[h],rt)}if(nt){logger$D.log("Name :",nt);var ct=n.nameData;ct&&typeof ct=="function"&&ct(i[h],nt)}if(xe&&tt&&tt.length!==0){for(var ht=null,ut=null,pt=0;pt<tt.length;pt++)switch(tt[pt].nodeName){case"LabelStyle":ht=tt[pt];break;case"IconStyle":ut=tt[pt];break}var yt=i[h].getProperties().name,mt=i[h].getProperties().description,St=yt||mt;if(logger$D.trace(St),!ut&&ht){var Pt=n.labelStyle;Pt&&typeof Pt=="function"&&Pt(i[h],ht)}else if(ut&&!ht){var Rt=n.iconStyle;Rt&&typeof Rt=="function"&&Rt(i[h],ut)}else if(ut&&ht){var Lt=n.iconLabelStyle;Lt&&typeof Lt=="function"&&Lt(i[h],ut,ht)}}else{var Nt=i[h],vt=Nt.getStyle();if(vt&&typeof vt=="function"){var Et=vt.call(this,Nt,0);Et&&Et.length!==0&&(vt=Et[0])}if(et){var Ct=n.polygonStyle;Ct&&typeof Ct=="function"&&Ct(i[h],tt)}if(ne){var _t=n.lineStringStyle;_t&&typeof _t=="function"&&_t(i[h],tt)}if(xe&&vt){var dt=vt.getImage();if(dt&&dt instanceof CircleStyle){var ft=n.circleStyle;ft&&typeof ft=="function"&&ft(i[h],it)}else if(dt&&dt instanceof Icon){var bt=n.pointStyle;bt&&typeof bt=="function"&&bt(i[h],it)}}}break;default:logger$D.trace("tag is not processing !")}}}writeFeatures(e,i){logger$D.log("overload : ol.format.KML.writeFeatures");var n=super.writeFeaturesNode(e,i);if(n===null)return null;this.hasOwnProperty("extensions")&&this._writeRootExtensions(n,this.extensions);var o=this._writeExtendStylesFeatures(n,e,i),l=Parser$1.format(o);return l===""?null:l}_writeExtendStylesFeatures(e,i,n){function o(ee,te){var xe=ee.toString(16);xe.charAt(0)==="#"&&(xe=xe.slice(1)),te=te||1,te=parseInt(te*255,10),te=te.toString(16);var ne=te;return ne=ne+xe.substr(4,2),ne=ne+xe.substr(2,2),ne=ne+xe.substr(0,2),ne.toLowerCase()}var l=function(ee,te){if(logger$D.trace("label with style :",te),!!ee&&ee.getStyle()instanceof Style$1){var xe=ee.getStyle().getText();if(!xe)return;var ne="Sans",et="16px",tt=xe.getFont();if(tt){var it=tt.split(" ",2);et=it[0],ne=it[1]}var rt=ee.getStyle().getText().getStroke();if(!rt)return;if(rt instanceof Stroke){var nt=o("#FFFFFF"),st=rt.getColor();if(Array.isArray(st)){var at="rgba(";at+=st[0]+",",at+=st[1]+",",at+=st[2]+",",at+=st[3]+")",st=at}if(ColorUtils.isRGB(st)){var ot=ColorUtils.rgbaToHex(st);nt=o(ot.hex,ot.opacity)}else nt=o(st);var ct=rt.getWidth()||"0",ht="1";if(te&&te.getElementsByTagName("LabelStyleSimpleExtensionGroup").length===0){var ut=document.createElementNS(e.namespaceURI,"LabelStyleSimpleExtensionGroup");ut.setAttribute("fontSize",et),ut.setAttribute("fontFamily",ne),ut.setAttribute("haloColor",nt),ut.setAttribute("haloRadius",ct),ut.setAttribute("haloOpacity",ht),te.appendChild(ut)}}var pt=ee.getStyle().getImage();if(!pt)return;if(pt instanceof CircleStyle){var yt=null,mt=null;if(pt.getStroke()){if(mt=pt.getStroke().getWidth(),yt=pt.getStroke().getColor(),Array.isArray(yt)){var St="rgba(";St+=yt[0]+",",St+=yt[1]+",",St+=yt[2]+",",St+=yt[3]+")",yt=St}if(ColorUtils.isRGB(yt)){var Pt=ColorUtils.rgbaToHex(yt);yt=o(Pt.hex,Pt.opacity)}else yt=o(yt)}var Rt=null;if(pt.getFill()){if(Rt=pt.getFill().getColor(),Array.isArray(Rt)){var Lt="rgba(";Lt+=Rt[0]+",",Lt+=Rt[1]+",",Lt+=Rt[2]+",",Lt+=Rt[3]+")",Rt=Lt}if(ColorUtils.isRGB(Rt)){var Nt=ColorUtils.rgbaToHex(Rt);Rt=o(Nt.hex,Nt.opacity)}else Rt=o(Rt)}if(te&&te.getElementsByTagName("ObjectSimpleExtensionGroup").length===0){var vt=document.createElementNS(e.namespaceURI,"ObjectSimpleExtensionGroup");vt.setAttribute("type","circle"),vt.setAttribute("radius",pt.getRadius()),vt.setAttribute("fillColor",Rt),vt.setAttribute("strokeColor",yt),vt.setAttribute("strokeWidth",mt),te.appendChild(vt)}}}},c=function(ee,te){if(logger$D.trace("marker with style (hotspot):",te),!!ee&&ee.getStyle()instanceof Style$1){var xe=ee.getStyle().getImage();if(!xe)return;if(xe instanceof Icon){var ne=0,et=0,tt="pixels",it="pixels",rt=xe.getSize(),nt=xe.getAnchor();if(nt.length&&(ne=nt[0],et=nt[1],it==="fraction"?et=et===1?0:1-et:et=it==="pixels"&&et===rt[1]?0:rt[1]-et),te&&te.getElementsByTagName("hotSpot").length===0){var st=document.createElementNS(e.namespaceURI,"hotSpot");st.setAttribute("x",ne),st.setAttribute("y",et),st.setAttribute("xunits",tt),st.setAttribute("yunits",it),te.appendChild(st)}}}},u=function(ee,te){if(ee&&ee.getStyle()instanceof Style$1){var xe=ee.getStyle().getImage();if(!xe)return;if(xe instanceof CircleStyle){var ne=null,et=null;if(xe.getStroke()){if(et=xe.getStroke().getWidth(),ne=xe.getStroke().getColor(),Array.isArray(ne)){var tt="rgba(";tt+=ne[0]+",",tt+=ne[1]+",",tt+=ne[2]+",",tt+=ne[3]+")",ne=tt}if(ColorUtils.isRGB(ne)){var it=ColorUtils.rgbaToHex(ne);ne=o(it.hex,it.opacity)}else ne=o(ne)}var rt=null;if(xe.getFill()){if(rt=xe.getFill().getColor(),Array.isArray(rt)){var nt="rgba(";nt+=rt[0]+",",nt+=rt[1]+",",nt+=rt[2]+",",nt+=rt[3]+")",rt=nt}if(ColorUtils.isRGB(rt)){var st=ColorUtils.rgbaToHex(rt);rt=o(st.hex,st.opacity)}else rt=o(rt)}if(te&&te.getElementsByTagName("ObjectSimpleExtensionGroup").length===0){var at=document.createElementNS(e.namespaceURI,"LabelStyle"),ot=document.createElementNS(e.namespaceURI,"ObjectSimpleExtensionGroup");ot.setAttribute("type","circle"),ot.setAttribute("radius",xe.getRadius()),ot.setAttribute("fillColor",rt),ot.setAttribute("strokeColor",ne),ot.setAttribute("strokeWidth",et),at.appendChild(ot),te.appendChild(at)}}}},h=function(ee,te){},f=function(ee,te,xe){logger$D.trace("write an icon with a label"),c(ee,te),l(ee,xe)},g=function(ee,te){for(var xe=0;xe<te.length;xe++){var ne=te[xe];if(ne.nodeName==="name")return}var et=ee.getProperties().name;if(et){var tt=document.createElement("name");tt.innerHTML=et,te.appendChild(tt)}},H=function(ee,te){if(te&&te.length){for(var xe=[],ne=0;ne<te.length;ne++){const tt=te[ne];if(tt.nodeName==="Data"){var et=tt.getAttribute("name");Styling.getListTags().includes(et)&&xe.push(tt)}}xe&&xe.length&&xe.forEach(tt=>{tt.remove()})}};this._processKml(e,i,{labelStyle:l,iconStyle:c,iconLabelStyle:f,circleStyle:u,pointStyle:h,nameData:g,extendedData:H});var Y=Parser$1.toString(e);return Y||null}_writeRootExtensions(e,i){var n=document.createElementNS(e.namespaceURI,"ExtendedData");for(const u in i)if(Object.hasOwnProperty.call(i,u)){const h=i[u];var o=document.createElementNS(e.namespaceURI,"Data");o.setAttribute("name",u);var l=document.createTextNode(JSON.stringify(h));o.appendChild(l),n.appendChild(o)}var c=e.firstChild;e.insertBefore(n,c)}readFeatures(e,i){logger$D.log("overload : ol.format.KML.readFeatures"),typeof e=="string"?this.source=Parser$1.parse(e):e!==null&&(this.source=e);var n=this._readExtendStylesFeatures(e,i);return logger$D.trace("Styles tendus",n),n.forEach(o=>{Styling.definePropertiesFromStyle(o)}),n}_readExtendStylesFeatures(e,i){var n=super.readFeatures(e,i),o=null,l="";if(typeof e=="string"?l=e:l=e.documentElement.outerHTML,l=l.replace(/\n/g,""),l=l.replace(/(>)\s*(<)/g,"$1$2"),o=Parser$1.parse(l),o===null)return n;function c(Y){var ee="";ee=ee+Y.substr(6,2),ee=ee+Y.substr(4,2),ee=ee+Y.substr(2,2);for(var te=parseInt(ee,16).toString(16),xe="",ne=te.length||0,et=0;et<6-ne;et++)xe+="0";return te="#"+xe+te,te}var u=function(Y,ee){if(logger$D.trace("label with style :",ee),!!Y){for(var te=Y.getProperties().name,xe=c("ff000000"),ne="#FFFFFF",et=0,tt="Sans",it="16px",rt=null,nt=5,st="#000000",at="#ffffff",ot=1,ct=!1,ht=!1,ut=ee.childNodes,pt=0;pt<ut.length;pt++)switch(ut[pt].nodeName){case"scale":break;case"colorMode":break;case"color":xe=c(ut[pt].textContent);break;case"LabelStyleSimpleExtensionGroup":ct=!0;for(var yt=ut[pt].attributes,mt=0;mt<yt.length;mt++)switch(yt[mt].nodeName){case"fontFamily":tt=yt[mt].nodeValue;break;case"fontSize":it=yt[mt].nodeValue;break;case"haloColor":ne=c(yt[mt].nodeValue);break;case"haloRadius":et=parseInt(yt[mt].nodeValue,10);break}break;case"ObjectSimpleExtensionGroup":ht=!0;for(var St=ut[pt].attributes,Pt=0;Pt<St.length;Pt++)switch(St[Pt].nodeName){case"type":rt=St[Pt].nodeValue;break;case"radius":nt=parseInt(St[Pt].nodeValue,10);break;case"fillColor":var Rt=St[Pt].nodeValue,Lt=Math.round(ColorUtils.num(Rt.substr(0,2))/255*10)/10,Nt=c(Rt);st=ColorUtils.hexToRgba(Nt,Lt);break;case"strokeColor":var vt=St[Pt].nodeValue,Et=Math.round(ColorUtils.num(vt.substr(0,2))/255*10)/10,Ct=c(vt);at=ColorUtils.hexToRgba(Ct,Et);break;case"strokeWidth":ot=parseInt(St[Pt].nodeValue,10);break}break}var _t=null;ht&&rt==="circle"?_t=new CircleStyle({radius:nt,fill:new Fill({color:st}),stroke:new Stroke({color:at,width:ot})}):ct&&(_t=new Icon({src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNiYAAAAAkAAxkR2eQAAAAASUVORK5CYII=",size:[51,38],anchor:[25.5,38],anchorOrigin:"top-left",anchorXUnits:"pixels",anchorYUnits:"pixels"})),Y.setStyle(new Style$1({image:_t,text:new Text({font:it+" "+tt,textAlign:"left",text:te,fill:new Fill({color:xe}),stroke:new Stroke({color:ne,width:et})})}))}},h=function(Y,ee){logger$D.trace("hotspot :",ee);for(var te=null,xe=null,ne=c("ffffffff"),et=!1,tt=51,it=38,rt=!1,nt=25.5,st="pixels",at=38,ot="pixels",ct=ee.childNodes,ht=!1,ut=0;ut<ct.length;ut++)switch(ct[ut].nodeName){case"Icon":ht=!0;for(var pt=ct[ut].childNodes,yt=0;yt<pt.length;yt++)switch(pt[yt].nodeName){case"href":te=pt[yt].textContent;break;case"gx:w":et=!0,tt=parseFloat(pt[yt].textContent);break;case"gx:h":et=!0,it=parseFloat(pt[yt].textContent);break}break;case"hotSpot":rt=!0;for(var mt=ct[ut].attributes,St=0;St<mt.length;St++)switch(mt[St].nodeName){case"x":nt=parseFloat(mt[St].nodeValue);break;case"y":at=parseFloat(mt[St].nodeValue);break;case"yunits":st=mt[St].nodeValue;break;case"xunits":ot=mt[St].nodeValue;break}break;case"scale":xe=parseFloat(ct[ut].textContent);break;case"color":ne=c(ct[ut].textContent);break}var Pt=null;if(ht){var Rt={src:te||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNiYAAAAAkAAxkR2eQAAAAASUVORK5CYII=",color:ne,crossOrigin:"anonymous",scale:xe||1};et&&Helper.mergeParams(Rt,{size:[tt,it]}),rt&&Helper.mergeParams(Rt,{anchor:[nt,at],anchorOrigin:"bottom-left",anchorXUnits:st||"pixels",anchorYUnits:ot||"pixels"}),Pt=new Icon(Rt)}var Lt=Y.getStyleFunction();if(Lt){var Nt=Lt(Y,0);if(Nt&&!Array.isArray(Nt)&&(Nt=[Nt]),Nt&&Nt.length!==0){var vt=Nt.length===1?Nt[0]:Nt[Nt.length-1];Y.setStyle(new Style$1({image:Pt,text:vt.getText()}))}}},f=function(Y,ee){if(logger$D.trace("extendData :",ee),!!Y){for(var te={},xe=Y.get("name")||"",ne=Y.get("description")||"",et=null,tt=0;tt<ee.length;tt++){var it=ee[tt],rt=it.attributes[0],nt=it.childNodes;if(rt.nodeName==="name")switch(rt.nodeValue){case"label":xe=it.textContent,te.name=xe;break;case"title":case"attributetitle":for(var st=0;st<nt.length;st++)nt[st].nodeName==="value"&&(et=nt[st].textContent);break;default:te[rt.nodeValue]=it.textContent;break}}et&&(ne=ne?et+" : "+ne:et,te.description=ne),Object.keys(te).length&&Y.setProperties(te,!0)}},g=function(Y,ee,te){logger$D.trace("display icon and label"),u(Y,te),h(Y,ee)},H=function(Y,ee){};return this._processKml(o,n,{lineStringStyle:H,polygonStyle:H,pointStyle:H,labelStyle:this.showPointNames_?u:null,iconStyle:h,iconLabelStyle:this.showPointNames_?g:h,extendedData:f}),n}readRootExtensions(e){for(var i={},n=this.source.nodeName==="#document"?this.source.childNodes[0]:this.source,o=n.childNodes,l=0;l<o.length;l++){var c=o[l];if(c.nodeName==="ExtendedData")for(var u=c.childNodes,h=0;h<u.length;h++){var f=u[h];if(f.nodeName==="Data"){var g=f.attributes[0];if(g&&g.nodeName==="name"&&g.nodeValue===e){i=JSON.parse(f.textContent);break}}}}return i}}window.ol&&window.ol.format&&(window.ol.format.KMLExtended=KML);const NAMESPACE_URIS$3=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],SCHEMA_LOCATION="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",FEATURE_READER={rte:readRte,trk:readTrk,wpt:readWpt},GPX_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{rte:makeArrayPusher(readRte),trk:makeArrayPusher(readTrk),wpt:makeArrayPusher(readWpt)}),LINK_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{text:makeObjectPropertySetter(readString,"linkText"),type:makeObjectPropertySetter(readString,"linkType")}),AUTHOR_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{name:makeObjectPropertySetter(readString),email:parseEmail,link:parseLink}),METADATA_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{name:makeObjectPropertySetter(readString),desc:makeObjectPropertySetter(readString),author:makeObjectPropertySetter(readAuthor),copyright:makeObjectPropertySetter(readCopyright),link:parseLink,time:makeObjectPropertySetter(readDateTime),keywords:makeObjectPropertySetter(readString),bounds:parseBounds,extensions:parseExtensions}),COPYRIGHT_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{year:makeObjectPropertySetter(readPositiveInteger),license:makeObjectPropertySetter(readString)}),GPX_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$3,{rte:makeChildAppender(writeRte),trk:makeChildAppender(writeTrk),wpt:makeChildAppender(writeWpt)});let GPX$1=class extends XMLFeature{constructor(e){super(),e=e||{},this.dataProjection=get$3("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let i=0,n=e.length;i<n;++i){const o=e[i];if(this.readExtensions_){const l=o.get("extensionsNode_")||null;this.readExtensions_(o,l)}o.set("extensionsNode_",void 0)}}readMetadata(e){return e?typeof e=="string"?this.readMetadataFromDocument(parse$1(e)):isDocument(e)?this.readMetadataFromDocument(e):this.readMetadataFromNode(e):null}readMetadataFromDocument(e){for(let i=e.firstChild;i;i=i.nextSibling)if(i.nodeType===Node.ELEMENT_NODE){const n=this.readMetadataFromNode(i);if(n)return n}return null}readMetadataFromNode(e){if(!NAMESPACE_URIS$3.includes(e.namespaceURI))return null;for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(NAMESPACE_URIS$3.includes(i.namespaceURI)&&i.localName==="metadata")return pushParseAndPop({},METADATA_PARSERS,i,[]);return null}readFeatureFromNode(e,i){if(!NAMESPACE_URIS$3.includes(e.namespaceURI))return null;const n=FEATURE_READER[e.localName];if(!n)return null;const o=n(e,[this.getReadOptions(e,i)]);return o?(this.handleReadExtensions_([o]),o):null}readFeaturesFromNode(e,i){if(!NAMESPACE_URIS$3.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const n=pushParseAndPop([],GPX_PARSERS,e,[this.getReadOptions(e,i)]);return n?(this.handleReadExtensions_(n),n):[]}return[]}writeFeaturesNode(e,i){i=this.adaptOptions(i);const n=createElementNS("http://www.topografix.com/GPX/1/1","gpx");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",XML_SCHEMA_INSTANCE_URI),n.setAttributeNS(XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",SCHEMA_LOCATION),n.setAttribute("version","1.1"),n.setAttribute("creator","OpenLayers"),pushSerializeAndPop({node:n},GPX_SERIALIZERS,GPX_NODE_FACTORY,e,[i]),n}};const RTE_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{name:makeObjectPropertySetter(readString),cmt:makeObjectPropertySetter(readString),desc:makeObjectPropertySetter(readString),src:makeObjectPropertySetter(readString),link:parseLink,number:makeObjectPropertySetter(readPositiveInteger),extensions:parseExtensions,type:makeObjectPropertySetter(readString),rtept:parseRtePt}),RTEPT_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{ele:makeObjectPropertySetter(readDecimal),time:makeObjectPropertySetter(readDateTime)}),TRK_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{name:makeObjectPropertySetter(readString),cmt:makeObjectPropertySetter(readString),desc:makeObjectPropertySetter(readString),src:makeObjectPropertySetter(readString),link:parseLink,number:makeObjectPropertySetter(readPositiveInteger),type:makeObjectPropertySetter(readString),extensions:parseExtensions,trkseg:parseTrkSeg}),TRKSEG_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{trkpt:parseTrkPt}),TRKPT_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{ele:makeObjectPropertySetter(readDecimal),time:makeObjectPropertySetter(readDateTime)}),WPT_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{ele:makeObjectPropertySetter(readDecimal),time:makeObjectPropertySetter(readDateTime),magvar:makeObjectPropertySetter(readDecimal),geoidheight:makeObjectPropertySetter(readDecimal),name:makeObjectPropertySetter(readString),cmt:makeObjectPropertySetter(readString),desc:makeObjectPropertySetter(readString),src:makeObjectPropertySetter(readString),link:parseLink,sym:makeObjectPropertySetter(readString),type:makeObjectPropertySetter(readString),fix:makeObjectPropertySetter(readString),sat:makeObjectPropertySetter(readPositiveInteger),hdop:makeObjectPropertySetter(readDecimal),vdop:makeObjectPropertySetter(readDecimal),pdop:makeObjectPropertySetter(readDecimal),ageofdgpsdata:makeObjectPropertySetter(readDecimal),dgpsid:makeObjectPropertySetter(readPositiveInteger),extensions:parseExtensions}),LINK_SEQUENCE=["text","type"],LINK_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$3,{text:makeChildAppender(writeStringTextNode),type:makeChildAppender(writeStringTextNode)}),RTE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$3,["name","cmt","desc","src","link","number","type","rtept"]),RTE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$3,{name:makeChildAppender(writeStringTextNode),cmt:makeChildAppender(writeStringTextNode),desc:makeChildAppender(writeStringTextNode),src:makeChildAppender(writeStringTextNode),link:makeChildAppender(writeLink),number:makeChildAppender(writeNonNegativeIntegerTextNode),type:makeChildAppender(writeStringTextNode),rtept:makeArraySerializer(makeChildAppender(writeWptType))}),RTEPT_TYPE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$3,["ele","time"]),TRK_SEQUENCE=makeStructureNS(NAMESPACE_URIS$3,["name","cmt","desc","src","link","number","type","trkseg"]),TRK_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$3,{name:makeChildAppender(writeStringTextNode),cmt:makeChildAppender(writeStringTextNode),desc:makeChildAppender(writeStringTextNode),src:makeChildAppender(writeStringTextNode),link:makeChildAppender(writeLink),number:makeChildAppender(writeNonNegativeIntegerTextNode),type:makeChildAppender(writeStringTextNode),trkseg:makeArraySerializer(makeChildAppender(writeTrkSeg))}),TRKSEG_NODE_FACTORY=makeSimpleNodeFactory("trkpt"),TRKSEG_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$3,{trkpt:makeChildAppender(writeWptType)}),WPT_TYPE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$3,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),WPT_TYPE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$3,{ele:makeChildAppender(writeDecimalTextNode),time:makeChildAppender(writeDateTimeTextNode),magvar:makeChildAppender(writeDecimalTextNode),geoidheight:makeChildAppender(writeDecimalTextNode),name:makeChildAppender(writeStringTextNode),cmt:makeChildAppender(writeStringTextNode),desc:makeChildAppender(writeStringTextNode),src:makeChildAppender(writeStringTextNode),link:makeChildAppender(writeLink),sym:makeChildAppender(writeStringTextNode),type:makeChildAppender(writeStringTextNode),fix:makeChildAppender(writeStringTextNode),sat:makeChildAppender(writeNonNegativeIntegerTextNode),hdop:makeChildAppender(writeDecimalTextNode),vdop:makeChildAppender(writeDecimalTextNode),pdop:makeChildAppender(writeDecimalTextNode),ageofdgpsdata:makeChildAppender(writeDecimalTextNode),dgpsid:makeChildAppender(writeNonNegativeIntegerTextNode)}),GEOMETRY_TYPE_TO_NODENAME={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function GPX_NODE_FACTORY(s,e,i){const n=s.getGeometry();if(n){const o=GEOMETRY_TYPE_TO_NODENAME[n.getType()];if(o){const l=e[e.length-1].node;return createElementNS(l.namespaceURI,o)}}}function appendCoordinate(s,e,i,n){return s.push(parseFloat(i.getAttribute("lon")),parseFloat(i.getAttribute("lat"))),"ele"in n?(s.push(n.ele),delete n.ele,e.hasZ=!0):s.push(0),"time"in n?(s.push(n.time),delete n.time,e.hasM=!0):s.push(0),s}function applyLayoutOptions(s,e,i){let n="XY",o=2;if(s.hasZ&&s.hasM?(n="XYZM",o=4):s.hasZ?(n="XYZ",o=3):s.hasM&&(n="XYM",o=3),o!==4){for(let l=0,c=e.length/4;l<c;l++)e[l*o]=e[l*4],e[l*o+1]=e[l*4+1],s.hasZ&&(e[l*o+2]=e[l*4+2]),s.hasM&&(e[l*o+2]=e[l*4+3]);if(e.length=e.length/4*o,i)for(let l=0,c=i.length;l<c;l++)i[l]=i[l]/4*o}return n}function readAuthor(s,e){const i=pushParseAndPop({},AUTHOR_PARSERS,s,e);if(i)return i}function readCopyright(s,e){const i=pushParseAndPop({},COPYRIGHT_PARSERS,s,e);if(i){const n=s.getAttribute("author");return n!==null&&(i.author=n),i}}function parseBounds(s,e){const i=e[e.length-1],n=s.getAttribute("minlat"),o=s.getAttribute("minlon"),l=s.getAttribute("maxlat"),c=s.getAttribute("maxlon");o!==null&&n!==null&&c!==null&&l!==null&&(i.bounds=[[parseFloat(o),parseFloat(n)],[parseFloat(c),parseFloat(l)]])}function parseEmail(s,e){const i=e[e.length-1],n=s.getAttribute("id"),o=s.getAttribute("domain");n!==null&&o!==null&&(i.email=`${n}@${o}`)}function parseLink(s,e){const i=e[e.length-1],n=s.getAttribute("href");n!==null&&(i.link=n),parseNode(LINK_PARSERS,s,e)}function parseExtensions(s,e){const i=e[e.length-1];i.extensionsNode_=s}function parseRtePt(s,e){const i=pushParseAndPop({},RTEPT_PARSERS,s,e);if(i){const n=e[e.length-1],o=n.flatCoordinates,l=n.layoutOptions;appendCoordinate(o,l,s,i)}}function parseTrkPt(s,e){const i=pushParseAndPop({},TRKPT_PARSERS,s,e);if(i){const n=e[e.length-1],o=n.flatCoordinates,l=n.layoutOptions;appendCoordinate(o,l,s,i)}}function parseTrkSeg(s,e){const i=e[e.length-1];parseNode(TRKSEG_PARSERS,s,e);const n=i.flatCoordinates;i.ends.push(n.length)}function readRte(s,e){const i=e[0],n=pushParseAndPop({flatCoordinates:[],layoutOptions:{}},RTE_PARSERS,s,e);if(!n)return;const o=n.flatCoordinates;delete n.flatCoordinates;const l=n.layoutOptions;delete n.layoutOptions;const c=applyLayoutOptions(l,o),u=new LineString(o,c);transformGeometryWithOptions(u,!1,i);const h=new Feature(u);return h.setProperties(n,!0),h}function readTrk(s,e){const i=e[0],n=pushParseAndPop({flatCoordinates:[],ends:[],layoutOptions:{}},TRK_PARSERS,s,e);if(!n)return;const o=n.flatCoordinates;delete n.flatCoordinates;const l=n.ends;delete n.ends;const c=n.layoutOptions;delete n.layoutOptions;const u=applyLayoutOptions(c,o,l),h=new MultiLineString(o,u,l);transformGeometryWithOptions(h,!1,i);const f=new Feature(h);return f.setProperties(n,!0),f}function readWpt(s,e){const i=e[0],n=pushParseAndPop({},WPT_PARSERS,s,e);if(!n)return;const o={},l=appendCoordinate([],o,s,n),c=applyLayoutOptions(o,l),u=new Point$1(l,c);transformGeometryWithOptions(u,!1,i);const h=new Feature(u);return h.setProperties(n,!0),h}function writeLink(s,e,i){s.setAttribute("href",e);const o=i[i.length-1].properties,l=[o.linkText,o.linkType];pushSerializeAndPop({node:s},LINK_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,l,i,LINK_SEQUENCE)}function writeWptType(s,e,i){const n=i[i.length-1],l=n.node.namespaceURI,c=n.properties;switch(s.setAttributeNS(null,"lat",String(e[1])),s.setAttributeNS(null,"lon",String(e[0])),n.geometryLayout){case"XYZM":e[3]!==0&&(c.time=e[3]);case"XYZ":e[2]!==0&&(c.ele=e[2]);break;case"XYM":e[2]!==0&&(c.time=e[2]);break}const h=s.nodeName=="rtept"?RTEPT_TYPE_SEQUENCE[l]:WPT_TYPE_SEQUENCE[l],f=makeSequence(c,h);pushSerializeAndPop({node:s,properties:c},WPT_TYPE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,f,i,h)}function writeRte(s,e,i){const n=i[0],o=e.getProperties(),l={node:s};l.properties=o;const c=e.getGeometry();if(c.getType()=="LineString"){const g=transformGeometryWithOptions(c,!0,n);l.geometryLayout=g.getLayout(),o.rtept=g.getCoordinates()}const u=i[i.length-1].node,h=RTE_SEQUENCE[u.namespaceURI],f=makeSequence(o,h);pushSerializeAndPop(l,RTE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,f,i,h)}function writeTrk(s,e,i){const n=i[0],o=e.getProperties(),l={node:s};l.properties=o;const c=e.getGeometry();if(c.getType()=="MultiLineString"){const g=transformGeometryWithOptions(c,!0,n);o.trkseg=g.getLineStrings()}const u=i[i.length-1].node,h=TRK_SEQUENCE[u.namespaceURI],f=makeSequence(o,h);pushSerializeAndPop(l,TRK_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,f,i,h)}function writeTrkSeg(s,e,i){const n={node:s};n.geometryLayout=e.getLayout(),n.properties={},pushSerializeAndPop(n,TRKSEG_SERIALIZERS,TRKSEG_NODE_FACTORY,e.getCoordinates(),i)}function writeWpt(s,e,i){const n=i[0],o=i[i.length-1];o.properties=e.getProperties();const l=e.getGeometry();if(l.getType()=="Point"){const c=transformGeometryWithOptions(l,!0,n);o.geometryLayout=c.getLayout(),writeWptType(s,c.getCoordinates(),i)}}class GPX extends GPX$1{constructor(e){if(super(e),!(this instanceof GPX))throw new TypeError("ERROR CLASS_CONSTRUCTOR");if(this.options=e||{},this.options.readExtensions&&typeof this.options.readExtensions=="function"){var i=this.options.readExtensions;this.options.readExtensions=function(n,o){this.readExtensions(n,o),i.call(this,n,o)}}else this.options.readExtensions=this.readExtensions;return(this.options.defaultStyle===null||typeof this.options.defaultStyle>"u")&&(this.options.defaultStyle={}),this.source=null,this}readFeatures(e,i){var n=super.readFeatures(e,i);typeof e=="string"?this.source=Parser$1.parse(e):e!==null&&(this.source=e);var o=this;return n.forEach(function(l,c,u){l.setId(c+1);var h=l.getProperties().desc;h&&l.setProperties({description:h});var f=l.getStyleFunction();if(!f){var g=Styling.defineStyleFunctionByDefault(o.options.defaultStyle);g&&l.setStyle(g)}}),n}writeFeatures(e,i){if(e.forEach(function(h,f,g){var H=h.getProperties().description;H&&h.setProperties({desc:H}),Styling.definePropertiesFromStyle(h);var Y=h.getGeometry().getType();if(Y==="Polygon"){var ee=h.clone();ee.set("type",Y),ee.setGeometry(new LineString(h.getGeometry().getCoordinates())),e.push(ee),g.splice(f,1)}else if(Y==="MultiPolygon"){var te=h.clone();te.set("type",Y),te.setGeometry(new MultiLineString(h.getGeometry().getCoordinates())),e.push(te),g.splice(f,1)}}),this.options.orderBy!==void 0){var n=this.options.orderBy;if(n){var o=function(h,f){var g=h.get(n)||0,H=f.get(n)||0;return g.toString().localeCompare(H.toString(),void 0,{numeric:!0})};e.sort(o)}}var l=super.writeFeaturesNode(e,i);if(l===null)return null;this.options.hasOwnProperty("extensions")&&this.writeRootExtensions_(l,this.options.extensions),this.processExtensions_(l,e,{extensions:this.writeExtensions_});var c=Parser$1.toString(l);if(!c)return null;var u=Parser$1.format(c);return u===""?null:u}readExtensions(e,i){var n=i;if(!i){var o=e.getProperties();for(const h in o)if(Object.hasOwnProperty.call(o,h)){const f=o[h];if(f instanceof Node){n=f;break}}}if(!n){console.warn("node not found !");return}for(var l=0;l<n.childNodes.length;l++){var c=n.childNodes[l];c.nodeType===1&&e.set(c.nodeName,c.textContent)}Styling.APPLY_CONVERT_GEOM_GPX=!0;var u=Styling.defineStyleFromProperties(e);u&&e.setStyle(u)}readRootExtensions(e){for(var i={},n=this.source.childNodes[0],o=n.childNodes,l=0;l<o.length;l++){var c=o[l];if(c.nodeName==="metadata")for(var u=c.childNodes,h=0;h<u.length;h++){var f=u[h];if(f.nodeName==="extensions")for(var g=f.childNodes,H=0;H<g.length;H++){var Y=g[H];if(Y.nodeName==="data"){var ee=Y.attributes[0];if(ee&&ee.nodeName==="name"&&ee.nodeValue===e){i=JSON.parse(Y.textContent);break}}}}}return i}writeRootExtensions_(e,i,n){var o=document.createElement("metadata"),l=document.createElement("extensions");function c(g,H){for(const tt in H)if(Object.hasOwnProperty.call(H,tt)){var Y=H[tt]||"",ee=document.createElement(tt);if(typeof Y=="string"||typeof Y=="number")ee.innerHTML=Y,g.appendChild(ee);else if(Y instanceof Array){ee.setAttribute("type","array"),ee.setAttribute("index",Y.length);for(let it=0;it<Y.length;it++){var te=Y[it]||"",xe=document.createElement("value");if(typeof te=="string"||typeof te=="number")xe.innerHTML=te,ee.appendChild(xe);else if(te instanceof Array){xe.setAttribute("type","array"),xe.setAttribute("index",te.length);for(let rt=0;rt<te.length;rt++){var ne=te[rt]||"",et=document.createElement("value");(typeof ne=="string"||typeof ne=="number")&&(et.innerHTML=ne,xe.appendChild(et))}ee.appendChild(xe)}else te instanceof Object&&ee.appendChild(c(xe,te))}g.appendChild(ee)}else Y instanceof Object&&g.appendChild(c(ee,Y))}return g}if(n)c(l,i);else for(const g in i)if(Object.hasOwnProperty.call(i,g)){const H=i[g];var u=document.createElement("data");u.setAttribute("name",g);var h=document.createTextNode(JSON.stringify(H));u.appendChild(h),l.appendChild(u)}o.appendChild(l);var f=e.firstChild;e.insertBefore(o,f)}writeExtensions_(e,i){var n=document.createElementNS(i.parentNode.namespaceURI,"extensions");Styling.getListTags().forEach(o=>{if(e.get(o)){var l=document.createElementNS(i.parentNode.namespaceURI,o);l.innerHTML=e.get(o),n.appendChild(l)}}),i.appendChild(n)}processExtensions_(e,i,n){for(var o=-1,l=e.childNodes,c=0;c<l.length;c++){var u=l[c];switch(u.nodeName){case"wpt":case"rte":case"trk":o++;var h=i[o],f=h.getStyle();if(f){var g=n.extensions;g&&typeof g=="function"&&g(h,u)}break;case"metadata":break;default:console.warn("nodename unknown :",u.nodeName);break}}}}window.ol&&window.ol.format&&(window.ol.format.GPXExtended=GPX);class JSONFeature extends FeatureFormat{constructor(){super()}getType(){return"json"}readFeature(e,i){return this.readFeatureFromObject(getObject(e),this.getReadOptions(e,i))}readFeatures(e,i){return this.readFeaturesFromObject(getObject(e),this.getReadOptions(e,i))}readFeatureFromObject(e,i){return abstract()}readFeaturesFromObject(e,i){return abstract()}readGeometry(e,i){return this.readGeometryFromObject(getObject(e),this.getReadOptions(e,i))}readGeometryFromObject(e,i){return abstract()}readProjection(e){return this.readProjectionFromObject(getObject(e))}readProjectionFromObject(e){return abstract()}writeFeature(e,i){return JSON.stringify(this.writeFeatureObject(e,i))}writeFeatureObject(e,i){return abstract()}writeFeatures(e,i){return JSON.stringify(this.writeFeaturesObject(e,i))}writeFeaturesObject(e,i){return abstract()}writeGeometry(e,i){return JSON.stringify(this.writeGeometryObject(e,i))}writeGeometryObject(e,i){return abstract()}}function getObject(s){if(typeof s=="string"){const e=JSON.parse(s);return e||null}return s!==null?s:null}let GeoJSON$1=class extends JSONFeature{constructor(e){e=e||{},super(),this.dataProjection=get$3(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=get$3(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,i){let n=null;e.type==="Feature"?n=e:n={type:"Feature",geometry:e,properties:null};const o=readGeometryInternal(n.geometry);if(this.featureClass===RenderFeature)return createRenderFeature({geometry:o,id:n.id,properties:n.properties},i);const l=new Feature;return this.geometryName_?l.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&l.setGeometryName(n.geometry_name),l.setGeometry(createGeometry(o,i)),"id"in n&&l.setId(n.id),n.properties&&l.setProperties(n.properties,!0),l}readFeaturesFromObject(e,i){const n=e;let o=null;if(n.type==="FeatureCollection"){const l=e;o=[];const c=l.features;for(let u=0,h=c.length;u<h;++u){const f=this.readFeatureFromObject(c[u],i);f&&o.push(f)}}else o=[this.readFeatureFromObject(e,i)];return o.flat()}readGeometryFromObject(e,i){return readGeometry(e,i)}readProjectionFromObject(e){const i=e.crs;let n;if(i)if(i.type=="name")n=get$3(i.properties.name);else if(i.type==="EPSG")n=get$3("EPSG:"+i.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(e,i){i=this.adaptOptions(i);const n={type:"Feature",geometry:null,properties:null},o=e.getId();if(o!==void 0&&(n.id=o),!e.hasProperties())return n;const l=e.getProperties(),c=e.getGeometry();return c&&(n.geometry=writeGeometry(c,i),delete l[e.getGeometryName()]),isEmpty(l)||(n.properties=l),n}writeFeaturesObject(e,i){i=this.adaptOptions(i);const n=[];for(let o=0,l=e.length;o<l;++o)n.push(this.writeFeatureObject(e[o],i));return{type:"FeatureCollection",features:n}}writeGeometryObject(e,i){return writeGeometry(e,this.adaptOptions(i))}};function readGeometryInternal(s,e){if(!s)return null;let i;switch(s.type){case"Point":{i=readPointGeometry(s);break}case"LineString":{i=readLineStringGeometry(s);break}case"Polygon":{i=readPolygonGeometry(s);break}case"MultiPoint":{i=readMultiPointGeometry(s);break}case"MultiLineString":{i=readMultiLineStringGeometry(s);break}case"MultiPolygon":{i=readMultiPolygonGeometry(s);break}case"GeometryCollection":{i=readGeometryCollectionGeometry(s);break}default:throw new Error("Unsupported GeoJSON type: "+s.type)}return i}function readGeometry(s,e){const i=readGeometryInternal(s);return createGeometry(i,e)}function readGeometryCollectionGeometry(s,e){return s.geometries.map(function(n){return readGeometryInternal(n)})}function readPointGeometry(s){const e=s.coordinates;return{type:"Point",flatCoordinates:e,layout:getLayoutForStride(e.length)}}function readLineStringGeometry(s){var n;const e=s.coordinates,i=e.flat();return{type:"LineString",flatCoordinates:i,ends:[i.length],layout:getLayoutForStride(((n=e[0])==null?void 0:n.length)||2)}}function readMultiLineStringGeometry(s){var l,c;const e=s.coordinates,i=((c=(l=e[0])==null?void 0:l[0])==null?void 0:c.length)||2,n=[],o=deflateCoordinatesArray(n,0,e,i);return{type:"MultiLineString",flatCoordinates:n,ends:o,layout:getLayoutForStride(i)}}function readMultiPointGeometry(s){var i;const e=s.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:getLayoutForStride(((i=e[0])==null?void 0:i.length)||2)}}function readMultiPolygonGeometry(s){var l,c;const e=s.coordinates,i=[],n=((c=(l=e[0])==null?void 0:l[0])==null?void 0:c[0].length)||2,o=deflateMultiCoordinatesArray(i,0,e,n);return{type:"MultiPolygon",flatCoordinates:i,ends:o,layout:getLayoutForStride(n)}}function readPolygonGeometry(s){var l,c;const e=s.coordinates,i=[],n=(c=(l=e[0])==null?void 0:l[0])==null?void 0:c.length,o=deflateCoordinatesArray(i,0,e,n);return{type:"Polygon",flatCoordinates:i,ends:o,layout:getLayoutForStride(n)}}function writeGeometry(s,e){s=transformGeometryWithOptions(s,!0,e);const i=s.getType();let n;switch(i){case"Point":{n=writePointGeometry(s);break}case"LineString":{n=writeLineStringGeometry(s);break}case"Polygon":{n=writePolygonGeometry(s,e);break}case"MultiPoint":{n=writeMultiPointGeometry(s);break}case"MultiLineString":{n=writeMultiLineStringGeometry(s);break}case"MultiPolygon":{n=writeMultiPolygonGeometry(s,e);break}case"GeometryCollection":{n=writeGeometryCollectionGeometry(s,e);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+i)}return n}function writeGeometryCollectionGeometry(s,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:s.getGeometriesArray().map(function(n){return writeGeometry(n,e)})}}function writeLineStringGeometry(s,e){return{type:"LineString",coordinates:s.getCoordinates()}}function writeMultiLineStringGeometry(s,e){return{type:"MultiLineString",coordinates:s.getCoordinates()}}function writeMultiPointGeometry(s,e){return{type:"MultiPoint",coordinates:s.getCoordinates()}}function writeMultiPolygonGeometry(s,e){let i;return e&&(i=e.rightHanded),{type:"MultiPolygon",coordinates:s.getCoordinates(i)}}function writePointGeometry(s,e){return{type:"Point",coordinates:s.getCoordinates()}}function writePolygonGeometry(s,e){let i;return e&&(i=e.rightHanded),{type:"Polygon",coordinates:s.getCoordinates(i)}}class GeoJSON extends GeoJSON$1{constructor(e){if(super(e),!(this instanceof GeoJSON))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.options=e||{},(this.options.defaultStyle===null||typeof this.options.defaultStyle>"u")&&(this.options.defaultStyle={}),this.source=null,this}readFeatures(e,i){var n=super.readFeatures(e,i);return typeof e=="string"?this.source=JSON.parse(e):e!==null&&(this.source=e),n.forEach(o=>{var l=o.getStyleFunction();if(l){var c=l.call(this,o,0);c&&c.length!==0&&o.setStyle(c[0])}else{var u=Styling.defineStyleFromProperties(o);if(u)o.setStyle(u);else{var h=Styling.defineStyleFunctionByDefault(this.options.defaultStyle);h&&(o.setStyle(h),Styling.definePropertiesFromStyle(o))}}}),n}writeFeatures(e,i){e.forEach(function(o){Styling.definePropertiesFromStyle(o)});var n=this.writeFeaturesObject(e,i);return this.options.hasOwnProperty("extensions")&&Object.assign(n,this.options.extensions),JSON.stringify(n)}readRootExtensions(e){return this.source[e]}}window.ol&&window.ol.format&&(window.ol.format.GeoJSONExtended=GeoJSON);class WMTS extends WMTS$1{constructor(e){super(e)}getFeatureInfoUrl(e,i,n,o){var l=this.options&&this.options.tilePixelRatio?this.options.tilePixelRatio:1,c=this.tileGrid,u=this.tileGrid.getTileCoordForCoordAndResolution(e,i),h=function(it,rt,nt){var st=[0,0,0],at=createEmpty(),ot=it[1],ct=it[2],ht=rt.getTileCoordExtent(it),ut=nt.getExtent();if(ut!=null&&nt.isGlobal()){var pt=Math.ceil(getWidth(ut)/getWidth(ht));ot=ot%pt,st[0]=it[0],st[1]=ot,st[2]=it[2],ht=rt.getTileCoordExtent(st,at)}return intersects$1(ht,ut)?[it[0],ot,ct]:null},f=c.getTileCoordExtent(u),g=h(u,c,n);if(!(c.getResolutions().length<=u[0])){var H=c.getResolution(u[0]),Y=c.getMatrixIds()[u[0]],ee={SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetFeatureInfo",LAYER:this.getLayer(),TILECOL:g[1],TILEROW:g[2],TILEMATRIX:Y,TILEMATRIXSET:this.getMatrixSet(),FORMAT:this.getFormat()||"image/png",STYLE:this.getStyle()||"normal"};Helper.assign(ee,o);var te=Math.floor((e[0]-f[0])/(H/l)),xe=Math.floor((f[3]-e[1])/(H/l)),ne=c.getTileSize(u[0]);te=Math.min(te,(ne[0]|ne)-1),xe=Math.max(xe,0),ee.I=te,ee.J=xe;var et=this.urls[0],tt=Gp.Helper.normalyzeUrl(et,ee);return tt}}}window.ol&&window.ol.source&&(window.ol.source.WMTSExtended=WMTS);var LayerUtils={getZoomLevelFromScaleDenominator:function(s,e){var i={};switch(e){case"EPSG:2154":i={0:104579.224549894,1:52277.5323537905,2:26135.4870785954,3:13066.8913818,4:6533.2286041135,5:3266.5595244627,6:1633.2660045974,7:816.629554986,8:408.3139146768,9:204.1567415109,10:102.0783167832,11:51.0391448966,12:25.5195690743,13:12.7597836936,14:6.379891636,15:3.1899457653,16:1.5949728695,17:.7974864315,18:.3987432149,19:.1993716073,20:.0996858037,21:.0498429018};break;default:i={0:156543.033928041,1:78271.51696402048,2:39135.758482010235,3:19567.87924100512,4:9783.93962050256,5:4891.96981025128,6:2445.98490512564,7:1222.99245256282,8:611.49622628141,9:305.7481131407048,10:152.8740565703525,11:76.43702828517624,12:38.21851414258813,13:19.10925707129406,14:9.554628535647032,15:4.777314267823516,16:2.388657133911758,17:1.194328566955879,18:.5971642834779395,19:.2985821417389697,20:.1492910708694849,21:.0746455354347424};break}var n=s*28e-5;for(var o in i)if(i.hasOwnProperty(o)&&i[o]<=n)return o=parseInt(o,10),o;return 0},getAttributions:function(s){var e=s.zoom,i=[];if(s.originators!=null&&s.visibility)for(var n,o=0,l=s.originators.length;o<l;o++){n=!0;for(var c=s.originators[o],u=s.originators[o].constraints||[],h=0,f=u.length;h<f;h++){var g=u[h];n=!0;var H=this.getZoomLevelFromScaleDenominator(g.maxScaleDenominator,s.crs),Y=this.getZoomLevelFromScaleDenominator(g.minScaleDenominator,s.crs)||21;H&&H>e&&(n=!1),n&&Y&&Y<e&&(n=!1);var ee=g.bbox;if(n&&ee){n=!1;var te=s.extent;if(te){var xe=[ee.top,ee.left,ee.bottom,ee.right];if(this.intersects(te,xe)){n=!0;break}}}}if(n){var ne=c.logo,et=c.url,tt=c.name?c.name:"",it=c.attribution,rt=document.createElement("div");rt.className="gp-control-attribution";var nt=null;nt=document.createElement("a"),nt.className="gp-control-attribution-link",nt.target="_blank",rt.appendChild(nt),et&&(nt.href=et);var st=!!ne,at=null;st?(at=document.createElement("img"),nt?(at.className="gp-control-attribution-image",nt.appendChild(at)):(at.className="",rt.appendChild(at)),at.src=ne,at.title=it||tt,at.style.height="30px",at.style.width="30px"):tt?nt.textContent=tt:it?nt.textContent=it:et?nt.textContent=et:nt.textContent="",i.push(rt.innerHTML+" ")}}return i},intersects:function(s,e){var i=s[1]<=e[3]&&e[1]<=s[3],n=s[2]<=e[0]&&e[2]<=s[0];return i&&n}},Config={configuration:{},isConfigLoaded:function(){if(this.configuration&&Object.keys(this.configuration).length!==0)return!0;var s=typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{};return s.Gp&&s.Gp.Config&&s.Gp.Config.layers&&Object.keys(s.Gp.Config.layers).length!==0?(this.configuration=s.Gp.Config,!0):!1}};LoggerByDefault.getLogger("sourcewmts");class SourceWMTS extends WMTS{constructor(e){if(!e.layer)throw new Error("ERROR PARAM_MISSING : layer");if(typeof e.layer!="string")throw new Error("ERROR WRONG TYPE : layer");typeof e.ssl>"u"&&(e.ssl=!0);var i=e.configuration,n=i?i.params:null,o=e.apiKey;if(!i){if(!Config.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers.");var l=Config.configuration.getLayerId(e.layer,"WMTS");if(!l)throw new Error(`ERROR : WMTS Layer ID ${e.layer} cannot be found in Geoportal Configuration. Make sure that this resource is included in your contract key.`);if(i=Config.configuration.getLayerConf(l),!i)throw new Error("ERROR : WMTS Layer configuration cannot be found in Geoportal.");o=Config.configuration.getLayerKey(l)[0],n=Config.configuration.getLayerParams(e.layer,"WMTS")}var c=e.ssl===!1?"http://":"https://",u={"gp-ol-ext":Pkg$1.olExtVersion||Pkg$1.version};if(n.url.includes("/private/")){var h=e.apiKey||o;if(!h)throw new Error("ERROR : WMS Layer apiKey cannot be found in Geoportal Configuration.");u.apikey=h}var f={url:Gp.Helper.normalyzeUrl(n.url.replace(/(http|https):\/\//,c),u,!1),version:n.version,style:n.styles,format:n.format,projection:n.projection,maxZoom:LayerUtils.getZoomLevelFromScaleDenominator(n.minScale),layer:e.layer,matrixSet:n.TMSLink,tileGrid:new WMTSTileGrid({resolutions:n.nativeResolutions,matrixIds:n.matrixIds,origin:[Object.values(n.tileMatrices)[0].topLeftCorner.x,Object.values(n.tileMatrices)[0].topLeftCorner.y]}),crossOrigin:"anonymous"};return Helper.mergeParams(f,e.olParams),e.olParams&&!n.originators&&(n.originators=e.olParams.attributions),super(f),this._originators=n.originators,this._legends=e.legends||n.legends,this._metadata=e.metadata||n.metadata,this._description=e.description||n.description,this._title=e.title||n.title,this._quicklookUrl=e.quicklookUrl||n.quicklookUrl,this.name=e.layer,this.service="WMTS",this}}window.ol&&window.ol.source&&(window.ol.source.GeoportalWMTS=SourceWMTS);LoggerByDefault.getLogger("sourcewms");class SourceWMS extends TileWMS{constructor(e){if(!e.layer)throw new Error("ERROR PARAM_MISSING : layer");if(typeof e.layer!="string")throw new Error("ERROR WRONG TYPE : layer");typeof e.ssl>"u"&&(e.ssl=!0);var i=e.configuration,n=i?i.params:null,o=e.apiKey;if(!i){if(!Config.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers.");var l=Config.configuration.getLayerId(e.layer,"WMS");if(!l)throw new Error(`ERROR : WMS Layer ID ${e.layer} cannot be found in Geoportal Configuration. Make sure that this resource is included in your contract key.`);if(i=Config.configuration.getLayerConf(l),!i)throw new Error("ERROR : WMS Layer configuration cannot be found in Geoportal.");o=Config.configuration.getLayerKey(l)[0],n=Config.configuration.getLayerParams(e.layer,"WMS")}var c=e.ssl===!1?"http://":"https://",u={"gp-ol-ext":Pkg$1.olExtVersion||Pkg$1.version};if(n.url.includes("/private/")){var h=e.apiKey||o;if(!h)throw new Error("ERROR : WMS Layer apiKey cannot be found in Geoportal Configuration.");u.apikey=h}var f={url:Gp.Helper.normalyzeUrl(n.url.replace(/(http|https):\/\//,c),u,!1),params:{SERVICE:"WMS",LAYERS:e.layer,VERSION:n.version,STYLES:n.styles,FORMAT:n.format},crossOrigin:"anonymous"};return Helper.mergeParams(f,e.olParams),e.olParams&&!n.originators&&(n.originators=e.olParams.attributions),super(f),this._originators=n.originators,this._legends=e.legends||n.legends,this._metadata=e.metadata||n.metadata,this._title=e.title||n.title,this._description=e.description||n.description,this._quicklookUrl=e.quicklookUrl||n.quicklookUrl,this.name=e.layer,this.service="WMS",this}}window.ol&&window.ol.source&&(window.ol.source.GeoportalWMS=SourceWMS);LoggerByDefault.getLogger("sourcewfs");class SourceWFS extends VectorSource{constructor(e){if(!e.layer)throw new Error("ERROR PARAM_MISSING : layer");if(typeof e.layer!="string")throw new Error("ERROR WRONG TYPE : layer");typeof e.ssl>"u"&&(e.ssl=!0);var i=e.configuration,n=i?i.params:null,o=e.apiKey;if(!i){if(!Config.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers.");var l=Config.configuration.getLayerId(e.layer,"WFS");if(!l)throw new Error(`ERROR : WFS Layer ID ${e.layer} cannot be found in Geoportal Configuration. Make sure that this resource is included in your contract key.`);if(i=Config.configuration.getLayerConf(l),!i)throw new Error("ERROR : WFS Layer configuration cannot be found in Geoportal.");o=Config.configuration.getLayerKey(l)[0],n=Config.configuration.getLayerParams(e.layer,"WFS")}var c=e.ssl===!1?"http://":"https://",u={"gp-ol-ext":Pkg$1.olExtVersion||Pkg$1.version};if(n.url.includes("/private/")){var h=e.apiKey||o;if(!h)throw new Error("ERROR : WFS Layer apiKey cannot be found in Geoportal Configuration.");u.apikey=h}var f=(H,Y,ee,te,xe)=>{const ne=new XMLHttpRequest;ne.open("POST",Y);const et=function(){H.removeLoadedExtent(ee),xe()};ne.onerror=et,ne.onload=function(){if(ne.status==200){var tt=JSON.parse(ne.responseText);const it=H.getFormat().readFeatures(tt);if(H.addFeatures(it),te(it),tt.links)for(let rt=0;rt<tt.links.length;rt++){const nt=tt.links[rt];nt.rel==="next"&&f(H,nt.href,ee,te,xe)}}else et()},ne.send()},g={format:new GeoJSON$1,loader:function(H,Y,ee,te,xe){var ne=this;const et=e.maxFeatures,tt=e.layer,it=ee.getCode(),rt=Gp.Helper.normalyzeUrl(n.url.replace(/(http|https):\/\//,c),u,!1)+"&SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&typename="+tt+"&outputFormat=application/json&srsname="+it+"&bbox="+H.join(",")+","+it+"&maxFeatures="+et+"&count="+et+"&startIndex=0";f(ne,rt,H,te,xe)},strategy:tile(createXYZ({minZoom:e.olParams.minZoom||15,maxZoom:e.olParams.maxZoom||21,tileSize:512})),crossOrigin:"anonymous"};return Helper.mergeParams(g,e.olParams),e.olParams&&!n.originators&&(n.originators=e.olParams.attributions),super(g),this._originators=n.originators,this._legends=e.legends||n.legends,this._metadata=e.metadata||n.metadata,this._title=e.title||n.title,this._description=e.description||n.description,this._quicklookUrl=e.quicklookUrl||n.quicklookUrl,this.name=e.layer,this.service="WFS",this}}window.ol&&window.ol.source&&(window.ol.source.GeoportalWFS=SourceWFS);function asImageLike(s){return s instanceof Image||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageBitmap?s:null}const disposedError=new Error("disposed"),defaultSize=[256,256];class DataTile extends Tile{constructor(e){const i=TileState.IDLE;super(e.tileCoord,i,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=asImageLike(this.data_);return e?[e.width,e.height]:defaultSize}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==TileState.IDLE&&this.state!==TileState.ERROR)return;this.state=TileState.LOADING,this.changed();const e=this;this.loader_().then(function(i){e.data_=i,e.state=TileState.LOADED,e.changed()}).catch(function(i){e.error_=i,e.state=TileState.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(disposedError),this.controller_=null),super.disposeInternal()}}class LRUCache{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof Disposable&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let i=this.oldest_;for(;i;)e(i.value_,i.key_,this),i=i.newer}get(e,i){const n=this.entries_[e];return assert(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(e){const i=this.entries_[e];return assert(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_?(this.newest_=i.older,this.newest_&&(this.newest_.newer=null)):i===this.oldest_?(this.oldest_=i.newer,this.oldest_&&(this.oldest_.older=null)):(i.newer.older=i.older,i.older.newer=i.newer),delete this.entries_[e],--this.count_,i.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let i=0,n;for(n=this.newest_;n;n=n.older)e[i++]=n.key_;return e}getValues(){const e=new Array(this.count_);let i=0,n;for(n=this.newest_;n;n=n.older)e[i++]=n.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){var i;return(i=this.entries_[e])==null?void 0:i.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,i){this.get(e),this.entries_[e].value_=i}set(e,i){assert(!(e in this.entries_),"Tried to set a value for a key that is used already");const n={key_:e,newer:null,older:this.newest_,value_:i};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[e]=n,++this.count_}setSize(e){this.highWaterMark=e}}function addTileToLookup(s,e,i){if(!(i in s))return s[i]=new Set([e]),!0;const n=s[i],o=n.has(e);return o||n.add(e),!o}function removeTileFromLookup(s,e,i){const n=s[i];return n?n.delete(e):!1}function getRenderExtent(s,e){const i=s.layerStatesArray[s.layerIndex];i.extent&&(e=getIntersection(e,fromUserExtent(i.extent,s.viewState.projection)));const n=i.layer.getRenderSource();if(!n.getWrapX()){const o=n.getTileGridForProjection(s.viewState.projection).getExtent();o&&(e=getIntersection(e,o))}return e}class CanvasTileLayerRenderer extends CanvasLayerRenderer{constructor(e,i){super(e),i=i||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=createEmpty(),this.tempTileRange_=new TileRange(0,0,0,0),this.tempTileCoord_=createOrUpdate(0,0,0);const n=i.cacheSize!==void 0?i.cacheSize:512;this.tileCache_=new LRUCache(n),this.sourceTileCache_=null,this.maxStaleKeys=n*.5}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||(this.sourceTileCache_=new LRUCache(512)),this.sourceTileCache_}getOrCreateTile(e,i,n,o){const l=this.tileCache_,u=this.getLayer().getSource(),h=getCacheKey$1(u,u.getKey(),e,i,n);let f;if(l.containsKey(h))f=l.get(h);else{const g=o.viewState.projection,H=u.getProjection();if(f=u.getTile(e,i,n,o.pixelRatio,g,!H||equivalent$1(H,g)?void 0:this.getSourceTileCache()),!f)return null;l.set(h,f)}return f}getTile(e,i,n,o){const l=this.getOrCreateTile(e,i,n,o);return l||null}getData(e){const i=this.frameState;if(!i)return null;const n=this.getLayer(),o=apply(i.pixelToCoordinateTransform,e.slice()),l=n.getExtent();if(l&&!containsCoordinate(l,o))return null;const c=i.viewState,u=n.getRenderSource(),h=u.getTileGridForProjection(c.projection),f=u.getTilePixelRatio(i.pixelRatio);for(let g=h.getZForResolution(c.resolution);g>=h.getMinZoom();--g){const H=h.getTileCoordForCoordAndZ(o,g),Y=this.getTile(g,H[1],H[2],i);if(!Y||Y.getState()!==TileState.LOADED)continue;const ee=h.getOrigin(g),te=toSize(h.getTileSize(g)),xe=h.getResolution(g);let ne;if(Y instanceof ImageTile||Y instanceof ReprojTile)ne=Y.getImage();else if(Y instanceof DataTile){if(ne=asImageLike(Y.getData()),!ne)continue}else continue;const et=Math.floor(f*((o[0]-ee[0])/xe-H[1]*te[0])),tt=Math.floor(f*((ee[1]-o[1])/xe-H[2]*te[1])),it=Math.round(f*u.getGutterForProjection(c.projection));return this.getImageData(ne,et+it,tt+it)}return null}prepareFrame(e){var o;this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const i=this.getLayer().getSource();if(!i)return!1;const n=i.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==n&&(this.renderedSourceRevision_=n,this.renderedSourceKey_===i.getKey()&&(this.tileCache_.clear(),(o=this.sourceTileCache_)==null||o.clear())):this.renderedSourceRevision_=n,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(e,i,n,o,l){const c=e.viewState,u=this.getLayer(),h=u.getRenderSource(),f=h.getTileGridForProjection(c.projection),g=getUid(h);g in e.wantedTiles||(e.wantedTiles[g]={});const H=e.wantedTiles[g],Y=u.getMapInternal(),ee=Math.max(n-l,f.getMinZoom(),f.getZForResolution(Math.min(u.getMaxResolution(),Y?Y.getView().getResolutionForZoom(Math.max(u.getMinZoom(),0)):f.getResolution(0)),h.zDirection)),te=c.rotation,xe=te?getRotatedViewport(c.center,c.resolution,te,e.size):void 0;for(let ne=n;ne>=ee;--ne){const et=f.getTileRangeForExtentAndZ(i,ne,this.tempTileRange_),tt=f.getResolution(ne);for(let it=et.minX;it<=et.maxX;++it)for(let rt=et.minY;rt<=et.maxY;++rt){if(te&&!f.tileCoordIntersectsViewport([ne,it,rt],xe))continue;const nt=this.getTile(ne,it,rt,e);if(!nt||!addTileToLookup(o,nt,ne))continue;const at=nt.getKey();if(H[at]=!0,nt.getState()===TileState.IDLE&&!e.tileQueue.isKeyQueued(at)){const ot=createOrUpdate(ne,it,rt,this.tempTileCoord_);e.tileQueue.enqueue([nt,g,f.getTileCoordCenter(ot),tt])}}}}findStaleTile_(e,i){const n=this.tileCache_,o=e[0],l=e[1],c=e[2],u=this.getStaleKeys();for(let h=0;h<u.length;++h){const f=getCacheKey$1(this.getLayer().getSource(),u[h],o,l,c);if(n.containsKey(f)){const g=n.peek(f);if(g.getState()===TileState.LOADED)return g.endTransition(getUid(this)),addTileToLookup(i,g,o),!0}}return!1}findAltTiles_(e,i,n,o){const l=e.getTileRangeForTileCoordAndZ(i,n,this.tempTileRange_);if(!l)return!1;let c=!0;const u=this.tileCache_,h=this.getLayer().getRenderSource(),f=h.getKey();for(let g=l.minX;g<=l.maxX;++g)for(let H=l.minY;H<=l.maxY;++H){const Y=getCacheKey$1(h,f,n,g,H);let ee=!1;if(u.containsKey(Y)){const te=u.peek(Y);te.getState()===TileState.LOADED&&(addTileToLookup(o,te,n),ee=!0)}ee||(c=!1)}return c}renderFrame(e,i){this.renderComplete=!0;const n=e.layerStatesArray[e.layerIndex],o=e.viewState,l=o.projection,c=o.resolution,u=o.center,h=e.pixelRatio,f=this.getLayer(),g=f.getSource(),H=g.getTileGridForProjection(l),Y=H.getZForResolution(c,g.zDirection),ee=H.getResolution(Y),te=g.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==te&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=te):this.renderedSourceKey_=te;let xe=e.extent;const ne=g.getTilePixelRatio(h);this.prepareContainer(e,i);const et=this.context.canvas.width,tt=this.context.canvas.height,it=n.extent&&fromUserExtent(n.extent);it&&(xe=getIntersection(xe,fromUserExtent(n.extent)));const rt=ee*et/2/ne,nt=ee*tt/2/ne,st=[u[0]-rt,u[1]-nt,u[0]+rt,u[1]+nt],at={};this.renderedTiles.length=0;const ot=f.getPreload();if(e.nextExtent&&this.enqueueTilesForNextExtent()){const Lt=H.getZForResolution(o.nextResolution,g.zDirection),Nt=getRenderExtent(e,e.nextExtent);this.enqueueTiles(e,Nt,Lt,at,ot)}const ct=getRenderExtent(e,xe);if(this.enqueueTiles(e,ct,Y,at,0),ot>0&&setTimeout(()=>{this.enqueueTiles(e,ct,Y-1,at,ot-1)},0),!(Y in at))return this.container;const ht=getUid(this),ut=e.time;for(const Lt of at[Y]){const Nt=Lt.getState();if(Nt===TileState.EMPTY)continue;const vt=Lt.tileCoord;if(Nt===TileState.LOADED&&Lt.getAlpha(ht,ut)===1){Lt.endTransition(ht);continue}if(Nt!==TileState.ERROR&&(this.renderComplete=!1),this.findStaleTile_(vt,at)){removeTileFromLookup(at,Lt,Y),e.animate=!0;continue}if(this.findAltTiles_(H,vt,Y+1,at))continue;const _t=H.getMinZoom();for(let dt=Y-1;dt>=_t&&!this.findAltTiles_(H,vt,dt,at);--dt);}const pt=ee/c*h/ne,yt=this.getRenderContext(e);compose(this.tempTransform,et/2,tt/2,pt,pt,0,-et/2,-tt/2),n.extent&&this.clipUnrotated(yt,e,it),g.getInterpolate()||(yt.imageSmoothingEnabled=!1),this.preRender(yt,e);const mt=Object.keys(at).map(Number);mt.sort(ascending);let St;const Pt=[],Rt=[];for(let Lt=mt.length-1;Lt>=0;--Lt){const Nt=mt[Lt],vt=g.getTilePixelSize(Nt,h,l),Ct=H.getResolution(Nt)/ee,_t=vt[0]*Ct*pt,dt=vt[1]*Ct*pt,ft=H.getTileCoordForCoordAndZ(getTopLeft(st),Nt),bt=H.getTileCoordExtent(ft),Gt=apply(this.tempTransform,[ne*(bt[0]-st[0])/ee,ne*(st[3]-bt[3])/ee]),Ft=ne*g.getGutterForProjection(l);for(const Ht of at[Nt]){if(Ht.getState()!==TileState.LOADED)continue;const Mt=Ht.tileCoord,It=ft[1]-Mt[1],xt=Math.round(Gt[0]-(It-1)*_t),Tt=ft[2]-Mt[2],Ut=Math.round(Gt[1]-(Tt-1)*dt),Dt=Math.round(Gt[0]-It*_t),$t=Math.round(Gt[1]-Tt*dt),Zt=xt-Dt,Kt=Ut-$t,qt=mt.length===1;let Xt=!1;St=[Dt,$t,Dt+Zt,$t,Dt+Zt,$t+Kt,Dt,$t+Kt];for(let zt=0,ai=Pt.length;zt<ai;++zt)if(!qt&&Nt<Rt[zt]){const wt=Pt[zt];intersects$1([Dt,$t,Dt+Zt,$t+Kt],[wt[0],wt[3],wt[4],wt[7]])&&(Xt||(yt.save(),Xt=!0),yt.beginPath(),yt.moveTo(St[0],St[1]),yt.lineTo(St[2],St[3]),yt.lineTo(St[4],St[5]),yt.lineTo(St[6],St[7]),yt.moveTo(wt[6],wt[7]),yt.lineTo(wt[4],wt[5]),yt.lineTo(wt[2],wt[3]),yt.lineTo(wt[0],wt[1]),yt.clip())}Pt.push(St),Rt.push(Nt),this.drawTile(Ht,e,Dt,$t,Zt,Kt,Ft,qt),Xt&&yt.restore(),this.renderedTiles.unshift(Ht),this.updateUsedTiles(e.usedTiles,g,Ht)}}if(this.renderedResolution=ee,this.extentChanged=!this.renderedExtent_||!equals$1(this.renderedExtent_,st),this.renderedExtent_=st,this.renderedPixelRatio=h,this.postRender(this.context,e),n.extent&&yt.restore(),yt.imageSmoothingEnabled=!0,this.renderComplete){const Lt=(Nt,vt)=>{var dt;const Et=getUid(g),Ct=vt.wantedTiles[Et],_t=Ct?Object.keys(Ct).length:0;this.updateCacheSize(_t),this.tileCache_.expireCache(),(dt=this.sourceTileCache_)==null||dt.expireCache()};e.postRenderFunctions.push(Lt)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,i,n,o,l,c,u,h){let f;if(e instanceof DataTile){if(f=asImageLike(e.getData()),!f)throw new Error("Rendering array data is not yet supported")}else f=this.getTileImage(e);if(!f)return;const g=this.getRenderContext(i),H=getUid(this),Y=i.layerStatesArray[i.layerIndex],ee=Y.opacity*(h?e.getAlpha(H,i.time):1),te=ee!==g.globalAlpha;te&&(g.save(),g.globalAlpha=ee),g.drawImage(f,u,u,f.width-2*u,f.height-2*u,n,o,l,c),te&&g.restore(),ee!==Y.opacity?i.animate=!0:h&&e.endTransition(H)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,i,n){const o=getUid(i);o in e||(e[o]={}),e[o][n.getKey()]=!0}}const TileProperty={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class BaseTileLayer extends Layer$1{constructor(e){e=e||{};const i=Object.assign({},e),n=e.cacheSize;delete e.cacheSize,delete i.preload,delete i.useInterimTilesOnError,super(i),this.on,this.once,this.un,this.cacheSize_=n,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(TileProperty.PRELOAD)}setPreload(e){this.set(TileProperty.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}class TileLayer extends BaseTileLayer{constructor(e){super(e)}createRenderer(){return new CanvasTileLayerRenderer(this,{cacheSize:this.getCacheSize()})}}class LayerWMTS extends TileLayer{constructor(e){if(!e.layer)throw new Error("ERROR PARAM_MISSING : layer");if(typeof e.layer!="string")throw new Error("ERROR WRONG TYPE : layer");typeof e.ssl>"u"&&(e.ssl=!0);var i=e.configuration;if(!i){if(!Config.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers.");var n=Config.configuration.getLayerId(e.layer,"WMTS");if(i=Config.configuration.getLayerConf(n),!i)throw new Error("ERROR : Layer ID not found into the catalogue !?")}var o;e.olParams&&e.olParams.sourceParams&&(o=e.olParams.sourceParams);var l=new SourceWMTS({layer:e.layer,configuration:e.configuration,ssl:e.ssl,apiKey:e.apiKey,olParams:o}),c={source:l};if(l.getLayer()!==void 0&&i.globalConstraint){var u=[i.globalConstraint.bbox.left,i.globalConstraint.bbox.bottom,i.globalConstraint.bbox.right,i.globalConstraint.bbox.top];c.extent=transformExtent(u,"EPSG:4326",i.globalConstraint.projection||"EPSG:3857");var h;typeof i.globalConstraint.projection=="string"?h=get$3(i.globalConstraint.projection):h=get$3("EPSG:3857"),h&&h.getUnits()&&(h.getUnits()==="m"?(c.minResolution=(i.globalConstraint.minScaleDenominator-1)*28e-5,c.maxResolution=(i.globalConstraint.maxScaleDenominator+1)*28e-5):h.getUnits()==="degrees"&&(c.minResolution=(i.globalConstraint.minScaleDenominator-1)*28e-5*180/(Math.PI*6378137),c.maxResolution=(i.globalConstraint.maxScaleDenominator+1)*28e-5*180/(Math.PI*6378137)))}return Helper.mergeParams(c,e.olParams),super(c),this.name=e.layer,this.service="WMTS",this.config=i,this}getConfiguration(){return this.config}getLegends(){return this.getSource()._legends}getMetadata(){return this.getSource()._metadata}getDescription(){return this.getSource()._description}getTitle(){return this.getSource()._title}getQuicklookUrl(){return this.getSource()._quicklookUrl}getOriginators(){return this.getSource()._originators}}window.ol&&window.ol.layer&&(window.ol.layer.GeoportalWMTS=LayerWMTS);class LayerWMS extends TileLayer{constructor(e){if(!e.layer)throw new Error("ERROR PARAM_MISSING : layer");if(typeof e.layer!="string")throw new Error("ERROR WRONG TYPE : layer");typeof e.ssl>"u"&&(e.ssl=!0);var i=e.configuration;if(!i){if(!Config.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers.");var n=Config.configuration.getLayerId(e.layer,"WMS");if(i=Config.configuration.getLayerConf(n),!i)throw new Error("ERROR : Layer ID not found into the catalogue !?")}var o;e.olParams&&e.olParams.sourceParams&&(o=e.olParams.sourceParams);var l=new SourceWMS({layer:e.layer,configuration:e.configuration,ssl:e.ssl,apiKey:e.apiKey,olParams:o}),c={source:l};if(l.getParams().LAYERS!==void 0&&o&&o.projection){var u=[i.globalConstraint.bbox.left,i.globalConstraint.bbox.bottom,i.globalConstraint.bbox.right,i.globalConstraint.bbox.top];c.extent=transformExtent(u,"EPSG:4326",o.projection);var h;typeof o.projection=="string"?h=get$3(o.projection):typeof o.projection=="object"&&o.projection.getCode()&&(h=get$3(o.projection.getCode())),h&&h.getUnits()&&(h.getUnits()==="m"?(c.minResolution=(i.globalConstraint.minScaleDenominator-1)*28e-5,c.maxResolution=(i.globalConstraint.maxScaleDenominator+1)*28e-5):h.getUnits()==="degrees"&&(c.minResolution=(i.globalConstraint.minScaleDenominator-1)*28e-5*180/(Math.PI*6378137),c.maxResolution=(i.globalConstraint.maxScaleDenominator+1)*28e-5*180/(Math.PI*6378137)))}return Helper.mergeParams(c,e.olParams),super(c),this.name=e.layer,this.service="WMS",this.config=i,this}getConfiguration(){return this.config}getLegends(){return this.getSource()._legends}getMetadata(){return this.getSource()._metadata}getDescription(){return this.getSource()._description}getTitle(){return this.getSource()._title}getQuicklookUrl(){return this.getSource()._quicklookUrl}getOriginators(){return this.getSource()._originators}}window.ol&&window.ol.layer&&(window.ol.layer.GeoportalWMS=LayerWMS);const MAXFEATURES=500,MINZOOMDEFAULT=15,MAXZOOMDEFAULT=21,STYLEBYDEFAULT=new Style$1({stroke:new Stroke({color:"rgba(0, 0, 255, 1.0)",width:2}),fill:new Fill({color:"rgba(0, 0, 255, 0.5)"})});class LayerWFS extends VectorLayer{constructor(e){if(!e.layer)throw new Error("ERROR PARAM_MISSING : layer");if(typeof e.layer!="string")throw new Error("ERROR WRONG TYPE : layer");typeof e.ssl>"u"&&(e.ssl=!0);var i=e.configuration;if(!i){if(!Config.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers.");var n=Config.configuration.getLayerId(e.layer,"WFS");if(i=Config.configuration.getLayerConf(n),!i)throw new Error("ERROR : Layer ID not found into the catalogue !?")}var o;e.olParams&&e.olParams.sourceParams&&(o=e.olParams.sourceParams);var l=new SourceWFS({layer:e.layer,configuration:e.configuration,maxFeatures:e.maxFeatures||MAXFEATURES,ssl:e.ssl,apiKey:e.apiKey,olParams:o||{minZoom:MINZOOMDEFAULT,maxZoom:MAXZOOMDEFAULT}}),c={source:l};return e.olParams?Helper.mergeParams({minZoom:MINZOOMDEFAULT,maxZoom:MAXZOOMDEFAULT,style:STYLEBYDEFAULT},e.olParams):e.olParams={minZoom:MINZOOMDEFAULT,maxZoom:MAXZOOMDEFAULT,style:STYLEBYDEFAULT},Helper.mergeParams(c,e.olParams),super(c),this.name=e.layer,this.service="WFS",this.config=i,this}getConfiguration(){return this.config}getLegends(){return this.getSource()._legends}getMetadata(){return this.getSource()._metadata}getDescription(){return this.getSource()._description}getTitle(){return this.getSource()._title}getQuicklookUrl(){return this.getSource()._quicklookUrl}getOriginators(){return this.getSource()._originators}}window.ol&&window.ol.layer&&(window.ol.layer.GeoportalWFS=LayerWFS);const IMAGE_REPLAYS={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},VECTOR_REPLAYS={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class CanvasVectorTileLayerRenderer extends CanvasTileLayerRenderer{constructor(e,i){super(e,i),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=create(),this.tileClipContexts_=null}enqueueTilesForNextExtent(){return this.getLayer().getRenderMode()!=="vector"}drawTile(e,i,n,o,l,c,u,h){this.updateExecutorGroup_(e,i.pixelRatio,i.viewState.projection),this.tileImageNeedsRender_(e)&&this.renderTileImage_(e,i),super.drawTile(e,i,n,o,l,c,u,h)}getTile(e,i,n,o){const l=this.getOrCreateTile(e,i,n,o);if(!l)return null;const c=o.viewState,u=c.resolution,h=o.viewHints,f=this.getLayer().getSource(),g=f.getTileGridForProjection(c.projection),H=!(h[ViewHint.ANIMATING]||h[ViewHint.INTERACTING]),Y=g.getZForResolution(u,f.zDirection)===e;return H&&Y?l.wantedResolution=u:l.wantedResolution||(l.wantedResolution=g.getResolution(e)),l}prepareFrame(e){const i=this.getLayer().getRevision();return this.renderedLayerRevision_!==i&&(this.renderedLayerRevision_=i,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,i,n){const o=this.getLayer(),l=o.getRevision(),c=o.getRenderOrder()||null,u=e.wantedResolution,h=e.getReplayState(o);if(!h.dirty&&h.renderedResolution===u&&h.renderedRevision==l&&h.renderedRenderOrder==c)return;const f=o.getSource(),g=!!o.getDeclutter(),H=f.getTileGrid(),ee=f.getTileGridForProjection(n).getTileCoordExtent(e.wrappedTileCoord),te=f.getSourceTiles(i,n,e),xe=getUid(o);delete e.hitDetectionImageData[xe],e.executorGroups[xe]=[],h.dirty=!1;for(let ne=0,et=te.length;ne<et;++ne){const tt=te[ne];if(tt.getState()!=TileState.LOADED)continue;const it=f.getProjection(),rt=tt.tileCoord;let nt=H.getTileCoordExtent(rt);n&&it&&!equivalent$1(n,it)&&(nt=transformExtent(nt,it,n,32));const st=getIntersection(ee,nt),at=buffer(st,o.getRenderBuffer()*u,this.tempExtent),ot=equals$1(nt,st)?null:at,ct=new BuilderGroup(0,st,u,i),ht=getSquaredTolerance(u,i),ut=function(Pt,Rt){let Lt;const Nt=Pt.getStyleFunction()||o.getStyleFunction();if(Nt&&(Lt=Nt(Pt,u)),Lt){const vt=this.renderFeature(Pt,ht,Lt,ct,g,Rt);h.dirty=h.dirty||vt}},pt=tt.getFeatures();c&&c!==h.renderedRenderOrder&&pt.sort(c);for(let Pt=0,Rt=pt.length;Pt<Rt;++Pt){let Lt=pt[Pt];n&&tt.projection&&!equivalent$1(n,tt.projection)&&(Lt=Lt.clone(),Lt.getGeometry().applyTransform(getTransform(tt.projection,n))),(!ot||intersects$1(ot,Lt.getGeometry().getExtent()))&&ut.call(this,Lt,Pt)}const yt=ct.finish(),mt=o.getRenderMode()!=="vector"&&g&&te.length===1?null:st,St=new ExecutorGroup(mt,u,i,f.getOverlaps(),yt,o.getRenderBuffer(),!0);e.executorGroups[xe].push(St)}h.renderedRevision=l,h.renderedRenderOrder=c,h.renderedResolution=u}forEachFeatureAtCoordinate(e,i,n,o,l){var it,rt;const c=i.viewState.resolution,u=i.viewState.rotation;n=n??0;const h=this.getLayer(),g=h.getSource().getTileGridForProjection(i.viewState.projection),H=boundingExtent([e]);buffer(H,c*n,H);const Y={},ee=function(nt,st,at){let ot=nt.getId();ot===void 0&&(ot=getUid(nt));const ct=Y[ot];if(ct){if(ct!==!0&&at<ct.distanceSq){if(at===0)return Y[ot]=!0,l.splice(l.lastIndexOf(ct),1),o(nt,h,st);ct.geometry=st,ct.distanceSq=at}}else{if(at===0)return Y[ot]=!0,o(nt,h,st);l.push(Y[ot]={feature:nt,layer:h,geometry:st,distanceSq:at,callback:o})}},te=this.renderedTiles,xe=getUid(h),ne=h.getDeclutter(),et=ne?(rt=(it=i.declutter)==null?void 0:it[ne])==null?void 0:rt.all().map(nt=>nt.value):null;let tt;e:for(let nt=0,st=te.length;nt<st;++nt){const at=te[nt],ot=g.getTileCoordExtent(at.wrappedTileCoord);if(!intersects$1(ot,H))continue;const ct=at.executorGroups[xe];for(let ht=0,ut=ct.length;ht<ut;++ht)if(tt=ct[ht].forEachFeatureAtCoordinate(e,c,u,n,ee,et),tt)break e}return tt}getFeatures(e){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((i,n)=>{const o=this.getLayer(),l=o.getSource(),c=this.renderedProjection,u=c.getExtent(),h=this.renderedResolution,f=l.getTileGridForProjection(c),g=apply(this.renderedPixelToCoordinateTransform_,e.slice()),H=f.getTileCoordForCoordAndResolution(g,h).toString(),Y=this.renderedTiles.find(it=>it.tileCoord.toString()===H&&it.getState()===TileState.LOADED);if(!Y||Y.loadingSourceTiles>0){i([]);return}l.getWrapX()&&c.canWrapX()&&!containsExtent(u,f.getTileCoordExtent(Y.tileCoord))&&wrapX$1(g,c);const ee=getUid(o),te=f.getTileCoordExtent(Y.wrappedTileCoord),xe=getTopLeft(te),ne=[(g[0]-xe[0])/h,(xe[1]-g[1])/h],et=Y.getSourceTiles().reduce((it,rt)=>it.concat(rt.getFeatures()),[]);let tt=Y.hitDetectionImageData[ee];if(!tt){const it=toSize(f.getTileSize(f.getZForResolution(h,l.zDirection))),rt=this.renderedRotation_,nt=[this.getRenderTransform(f.getTileCoordCenter(Y.wrappedTileCoord),h,0,HIT_DETECT_RESOLUTION,it[0]*HIT_DETECT_RESOLUTION,it[1]*HIT_DETECT_RESOLUTION,0)];tt=createHitDetectionImageData(it,nt,et,o.getStyleFunction(),f.getTileCoordExtent(Y.wrappedTileCoord),Y.getReplayState(o).renderedResolution,rt),Y.hitDetectionImageData[ee]=tt}i(hitDetect(ne,et,tt))})}getFeaturesInExtent(e){const i=[],n=this.getTileCache();if(n.getCount()===0)return i;const l=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),c=l.getZForResolution(this.renderedResolution),u={};return n.forEach(h=>{if(h.tileCoord[0]!==c||h.getState()!==TileState.LOADED)return;const f=h.getSourceTiles();for(let g=0,H=f.length;g<H;++g){const Y=f[g],ee=Y.getKey();if(ee in u)continue;u[ee]=!0;const te=Y.tileCoord;if(intersects$1(e,l.getTileCoordExtent(te))){const xe=Y.getFeatures();if(xe)for(let ne=0,et=xe.length;ne<et;++ne){const tt=xe[ne],it=tt.getGeometry();intersects$1(e,it.getExtent())&&i.push(tt)}}}}),i}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,i){var Y;const n=this.context,o=n.globalAlpha;n.globalAlpha=i.opacity;const l=e.viewHints,c=!(l[ViewHint.ANIMATING]||l[ViewHint.INTERACTING]),u=[this.context.canvas.width,this.context.canvas.height],h=this.getLayer().getDeclutter(),f=h?(Y=e.declutter)==null?void 0:Y[h]:void 0,g=getUid(this.getLayer()),H=this.renderedTiles;for(let ee=0,te=H.length;ee<te;++ee){const xe=H[ee],ne=xe.executorGroups[g];if(ne)for(let et=ne.length-1;et>=0;--et)ne[et].execute(this.context,u,this.getTileRenderTransform(xe,e),e.viewState.rotation,c,DECLUTTER,f)}n.globalAlpha=o}renderDeferredInternal(e){const i=this.renderedTiles,n=getUid(this.getLayer()),o=i.reduce((h,f,g)=>(f.executorGroups[n].forEach(H=>h.push({executorGroup:H,index:g})),h),[]),l=o.map(({executorGroup:h})=>h.getDeferredZIndexContexts()),c={};for(let h=0,f=o.length;h<f;++h){const g=o[h].executorGroup.getDeferredZIndexContexts();for(const H in g)c[H]=!0}Object.keys(c).map(Number).sort(ascending).forEach(h=>{l.forEach((f,g)=>{f[h]&&(f[h].forEach(H=>{const{executorGroup:Y,index:ee}=o[g],te=Y.getRenderedContext(),xe=te.globalAlpha;te.globalAlpha=this.renderedOpacity_;const ne=this.tileClipContexts_[ee];ne&&ne.draw(te),H.draw(te),ne&&te.restore(),te.globalAlpha=xe,H.clear()}),f[h].length=0)})})}getTileRenderTransform(e,i){const n=i.pixelRatio,o=i.viewState,l=o.center,c=o.resolution,u=o.rotation,h=i.size,f=Math.round(h[0]*n),g=Math.round(h[1]*n),Y=this.getLayer().getSource().getTileGridForProjection(i.viewState.projection),ee=e.tileCoord,te=Y.getTileCoordExtent(e.wrappedTileCoord),xe=Y.getTileCoordExtent(ee,this.tempExtent)[0]-te[0];return multiply(scale(this.inversePixelTransform.slice(),1/n,1/n),this.getRenderTransform(l,c,u,n,f,g,xe))}postRender(e,i){var nt;const n=i.viewHints,o=!(n[ViewHint.ANIMATING]||n[ViewHint.INTERACTING]);this.renderedPixelToCoordinateTransform_=i.pixelToCoordinateTransform.slice(),this.renderedRotation_=i.viewState.rotation,this.renderedOpacity_=i.layerStatesArray[i.layerIndex].opacity;const l=this.getLayer(),c=l.getRenderMode(),u=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;const h=l.getDeclutter(),f=h?VECTOR_REPLAYS[c].filter(st=>!DECLUTTER.includes(st)):VECTOR_REPLAYS[c],g=i.viewState,H=g.rotation,Y=l.getSource(),te=Y.getTileGridForProjection(g.projection).getZForResolution(g.resolution,Y.zDirection),xe=this.renderedTiles,ne=[],et=[],tt=[],it=getUid(l);let rt=!0;for(let st=xe.length-1;st>=0;--st){const at=xe[st];rt=rt&&!at.getReplayState(l).dirty;const ot=at.executorGroups[it].filter(St=>St.hasExecutors(f));if(ot.length===0)continue;const ct=this.getTileRenderTransform(at,i),ht=at.tileCoord[0];let ut=!1;const pt=ot[0].getClipCoords(ct);let yt=e,mt;if(pt){mt=new ZIndexContext,yt=mt.getContext();for(let St=0,Pt=ne.length;St<Pt;++St)if(te!==ht&&ht<et[St]){const Rt=ne[St];intersects$1([pt[0],pt[3],pt[4],pt[7]],[Rt[0],Rt[3],Rt[4],Rt[7]])&&(ut||(yt.save(),ut=!0),yt.beginPath(),yt.moveTo(pt[0],pt[1]),yt.lineTo(pt[2],pt[3]),yt.lineTo(pt[4],pt[5]),yt.lineTo(pt[6],pt[7]),yt.moveTo(Rt[6],Rt[7]),yt.lineTo(Rt[4],Rt[5]),yt.lineTo(Rt[2],Rt[3]),yt.lineTo(Rt[0],Rt[1]),yt.clip())}ne.push(pt),et.push(ht)}for(let St=0,Pt=ot.length;St<Pt;++St)ot[St].execute(e,[e.canvas.width,e.canvas.height],ct,H,o,f,(nt=i.declutter)==null?void 0:nt[h]);ut&&(yt===e?yt.restore():tt[st]=mt)}e.globalAlpha=u,this.ready=rt,this.tileClipContexts_=tt,i.declutter||this.renderDeferredInternal(i),super.postRender(e,i)}renderFeature(e,i,n,o,l,c){if(!n)return!1;let u=!1;if(Array.isArray(n))for(let h=0,f=n.length;h<f;++h)u=renderFeature$1(o,e,n[h],i,this.boundHandleStyleImageChange_,void 0,l,c)||u;else u=renderFeature$1(o,e,n,i,this.boundHandleStyleImageChange_,void 0,l,c);return u}tileImageNeedsRender_(e){const i=this.getLayer();if(i.getRenderMode()==="vector")return!1;const n=e.getReplayState(i),o=i.getRevision(),l=e.wantedResolution;return n.renderedTileResolution!==l||n.renderedTileRevision!==o}renderTileImage_(e,i){const n=this.getLayer(),o=e.getReplayState(n),l=n.getRevision(),c=e.executorGroups[getUid(n)];o.renderedTileRevision=l;const u=e.wrappedTileCoord,h=u[0],f=n.getSource();let g=i.pixelRatio;const Y=i.viewState.projection,ee=f.getTileGridForProjection(Y),te=ee.getResolution(e.tileCoord[0]),xe=i.pixelRatio/e.wantedResolution*te,ne=ee.getResolution(h),et=e.getContext();g=Math.round(Math.max(g,xe/g));const tt=f.getTilePixelSize(h,g,Y);et.canvas.width=tt[0],et.canvas.height=tt[1];const it=g/xe;if(it!==1){const at=reset(this.tmpTransform_);scale(at,it,it),et.setTransform.apply(et,at)}const rt=ee.getTileCoordExtent(u,this.tempExtent),nt=xe/ne,st=reset(this.tmpTransform_);scale(st,nt,-nt),translate(st,-rt[0],-rt[3]);for(let at=0,ot=c.length;at<ot;++at)c[at].execute(et,[et.canvas.width*it,et.canvas.height*it],st,0,!0,IMAGE_REPLAYS[n.getRenderMode()],null);o.renderedTileResolution=e.wantedResolution}}class VectorTileLayer extends BaseVectorLayer{constructor(e){e=e||{};const i=Object.assign({},e);delete i.preload;const n=e.cacheSize===void 0?0:e.cacheSize;delete e.cacheSize,delete i.useInterimTilesOnError,super(i),this.on,this.once,this.un,this.cacheSize_=n;const o=e.renderMode||"hybrid";assert(o=="hybrid"||o=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=o,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new CanvasVectorTileLayerRenderer(this,{cacheSize:this.cacheSize_})}getFeatures(e){return super.getFeatures(e)}getFeaturesInExtent(e){return this.getRenderer().getFeaturesInExtent(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(TileProperty.PRELOAD)}getUseInterimTilesOnError(){return this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(TileProperty.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR,e)}}function jsonp(s,e,i,n){const o=document.createElement("script"),l="olc_"+getUid(e);function c(){delete window[l],o.parentNode.removeChild(o)}o.async=!0,o.src=s+(s.includes("?")?"&":"?")+"callback="+l;const u=setTimeout(function(){c(),i&&i()},1e4);window[l]=function(h){clearTimeout(u),c(),e(h)},document.head.appendChild(o)}class TileJSON extends TileImage{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:get$3("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)jsonp(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const i=new XMLHttpRequest;i.addEventListener("load",this.onXHRLoad_.bind(this)),i.addEventListener("error",this.onXHRError_.bind(this)),i.open("GET",e.url),i.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const i=e.target;if(!i.status||i.status>=200&&i.status<300){let n;try{n=JSON.parse(i.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const i=get$3("EPSG:4326"),n=this.getProjection();let o;if(e.bounds!==void 0){const f=getTransformFromProjections(i,n);o=applyTransform(e.bounds,f)}const l=extentFromProjection(n),c=e.minzoom||0,u=e.maxzoom||22,h=createXYZ({extent:l,maxZoom:u,minZoom:c,tileSize:this.tileSize_});if(this.tileGrid=h,this.tileUrlFunction=createFromTemplates(e.tiles,h),e.attribution&&!this.getAttributions()){const f=o!==void 0?o:l;this.setAttributions(function(g){return intersects$1(f,g.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}const SHIFT_LEFT_32=65536*65536,SHIFT_RIGHT_32=1/SHIFT_LEFT_32,TEXT_DECODER_MIN_LENGTH=12,utf8TextDecoder=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),PBF_VARINT=0,PBF_FIXED64=1,PBF_BYTES=2,PBF_FIXED32=5;class Pbf{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,i,n=this.length){for(;this.pos<n;){const o=this.readVarint(),l=o>>3,c=this.pos;this.type=o&7,e(l,i,this),this.pos===c&&this.skip(o)}return i}readMessage(e,i){return this.readFields(e,i,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*SHIFT_LEFT_32;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*SHIFT_LEFT_32;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const i=this.buf;let n,o;return o=i[this.pos++],n=o&127,o<128||(o=i[this.pos++],n|=(o&127)<<7,o<128)||(o=i[this.pos++],n|=(o&127)<<14,o<128)||(o=i[this.pos++],n|=(o&127)<<21,o<128)?n:(o=i[this.pos],n|=(o&15)<<28,readVarintRemainder(n,e,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2===1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,i=this.pos;return this.pos=e,e-i>=TEXT_DECODER_MIN_LENGTH&&utf8TextDecoder?utf8TextDecoder.decode(this.buf.subarray(i,e)):readUtf8(this.buf,i,e)}readBytes(){const e=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,e);return this.pos=e,i}readPackedVarint(e=[],i){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readVarint(i));return e}readPackedSVarint(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===PBF_BYTES?this.readVarint()+this.pos:this.pos+1}skip(e){const i=e&7;if(i===PBF_VARINT)for(;this.buf[this.pos++]>127;);else if(i===PBF_BYTES)this.pos=this.readVarint()+this.pos;else if(i===PBF_FIXED32)this.pos+=4;else if(i===PBF_FIXED64)this.pos+=8;else throw new Error(`Unimplemented type: ${i}`)}writeTag(e,i){this.writeVarint(e<<3|i)}realloc(e){let i=this.length||16;for(;i<this.pos+e;)i*=2;if(i!==this.length){const n=new Uint8Array(i);n.set(this.buf),this.buf=n,this.dataView=new DataView(n.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*SHIFT_RIGHT_32),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*SHIFT_RIGHT_32),!0),this.pos+=8}writeVarint(e){if(e=+e||0,e>268435455||e<0){writeBigVarint(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))}writeSVarint(e){this.writeVarint(e<0?-e*2-1:e*2)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(e.length*4),this.pos++;const i=this.pos;this.pos=writeUtf8(this.buf,e,this.pos);const n=this.pos-i;n>=128&&makeRoomForExtraLength(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const i=e.length;this.writeVarint(i),this.realloc(i);for(let n=0;n<i;n++)this.buf[this.pos++]=e[n]}writeRawMessage(e,i){this.pos++;const n=this.pos;e(i,this);const o=this.pos-n;o>=128&&makeRoomForExtraLength(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o}writeMessage(e,i,n){this.writeTag(e,PBF_BYTES),this.writeRawMessage(i,n)}writePackedVarint(e,i){i.length&&this.writeMessage(e,writePackedVarint,i)}writePackedSVarint(e,i){i.length&&this.writeMessage(e,writePackedSVarint,i)}writePackedBoolean(e,i){i.length&&this.writeMessage(e,writePackedBoolean,i)}writePackedFloat(e,i){i.length&&this.writeMessage(e,writePackedFloat,i)}writePackedDouble(e,i){i.length&&this.writeMessage(e,writePackedDouble,i)}writePackedFixed32(e,i){i.length&&this.writeMessage(e,writePackedFixed32,i)}writePackedSFixed32(e,i){i.length&&this.writeMessage(e,writePackedSFixed32,i)}writePackedFixed64(e,i){i.length&&this.writeMessage(e,writePackedFixed64,i)}writePackedSFixed64(e,i){i.length&&this.writeMessage(e,writePackedSFixed64,i)}writeBytesField(e,i){this.writeTag(e,PBF_BYTES),this.writeBytes(i)}writeFixed32Field(e,i){this.writeTag(e,PBF_FIXED32),this.writeFixed32(i)}writeSFixed32Field(e,i){this.writeTag(e,PBF_FIXED32),this.writeSFixed32(i)}writeFixed64Field(e,i){this.writeTag(e,PBF_FIXED64),this.writeFixed64(i)}writeSFixed64Field(e,i){this.writeTag(e,PBF_FIXED64),this.writeSFixed64(i)}writeVarintField(e,i){this.writeTag(e,PBF_VARINT),this.writeVarint(i)}writeSVarintField(e,i){this.writeTag(e,PBF_VARINT),this.writeSVarint(i)}writeStringField(e,i){this.writeTag(e,PBF_BYTES),this.writeString(i)}writeFloatField(e,i){this.writeTag(e,PBF_FIXED32),this.writeFloat(i)}writeDoubleField(e,i){this.writeTag(e,PBF_FIXED64),this.writeDouble(i)}writeBooleanField(e,i){this.writeVarintField(e,+i)}}function readVarintRemainder(s,e,i){const n=i.buf;let o,l;if(l=n[i.pos++],o=(l&112)>>4,l<128||(l=n[i.pos++],o|=(l&127)<<3,l<128)||(l=n[i.pos++],o|=(l&127)<<10,l<128)||(l=n[i.pos++],o|=(l&127)<<17,l<128)||(l=n[i.pos++],o|=(l&127)<<24,l<128)||(l=n[i.pos++],o|=(l&1)<<31,l<128))return toNum(s,o,e);throw new Error("Expected varint not more than 10 bytes")}function toNum(s,e,i){return i?e*4294967296+(s>>>0):(e>>>0)*4294967296+(s>>>0)}function writeBigVarint(s,e){let i,n;if(s>=0?(i=s%4294967296|0,n=s/4294967296|0):(i=~(-s%4294967296),n=~(-s/4294967296),i^4294967295?i=i+1|0:(i=0,n=n+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),writeBigVarintLow(i,n,e),writeBigVarintHigh(n,e)}function writeBigVarintLow(s,e,i){i.buf[i.pos++]=s&127|128,s>>>=7,i.buf[i.pos++]=s&127|128,s>>>=7,i.buf[i.pos++]=s&127|128,s>>>=7,i.buf[i.pos++]=s&127|128,s>>>=7,i.buf[i.pos]=s&127}function writeBigVarintHigh(s,e){const i=(s&7)<<4;e.buf[e.pos++]|=i|((s>>>=3)?128:0),s&&(e.buf[e.pos++]=s&127|((s>>>=7)?128:0),s&&(e.buf[e.pos++]=s&127|((s>>>=7)?128:0),s&&(e.buf[e.pos++]=s&127|((s>>>=7)?128:0),s&&(e.buf[e.pos++]=s&127|((s>>>=7)?128:0),s&&(e.buf[e.pos++]=s&127)))))}function makeRoomForExtraLength(s,e,i){const n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));i.realloc(n);for(let o=i.pos-1;o>=s;o--)i.buf[o+n]=i.buf[o]}function writePackedVarint(s,e){for(let i=0;i<s.length;i++)e.writeVarint(s[i])}function writePackedSVarint(s,e){for(let i=0;i<s.length;i++)e.writeSVarint(s[i])}function writePackedFloat(s,e){for(let i=0;i<s.length;i++)e.writeFloat(s[i])}function writePackedDouble(s,e){for(let i=0;i<s.length;i++)e.writeDouble(s[i])}function writePackedBoolean(s,e){for(let i=0;i<s.length;i++)e.writeBoolean(s[i])}function writePackedFixed32(s,e){for(let i=0;i<s.length;i++)e.writeFixed32(s[i])}function writePackedSFixed32(s,e){for(let i=0;i<s.length;i++)e.writeSFixed32(s[i])}function writePackedFixed64(s,e){for(let i=0;i<s.length;i++)e.writeFixed64(s[i])}function writePackedSFixed64(s,e){for(let i=0;i<s.length;i++)e.writeSFixed64(s[i])}function readUtf8(s,e,i){let n="",o=e;for(;o<i;){const l=s[o];let c=null,u=l>239?4:l>223?3:l>191?2:1;if(o+u>i)break;let h,f,g;u===1?l<128&&(c=l):u===2?(h=s[o+1],(h&192)===128&&(c=(l&31)<<6|h&63,c<=127&&(c=null))):u===3?(h=s[o+1],f=s[o+2],(h&192)===128&&(f&192)===128&&(c=(l&15)<<12|(h&63)<<6|f&63,(c<=2047||c>=55296&&c<=57343)&&(c=null))):u===4&&(h=s[o+1],f=s[o+2],g=s[o+3],(h&192)===128&&(f&192)===128&&(g&192)===128&&(c=(l&15)<<18|(h&63)<<12|(f&63)<<6|g&63,(c<=65535||c>=1114112)&&(c=null))),c===null?(c=65533,u=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|c&1023),n+=String.fromCharCode(c),o+=u}return n}function writeUtf8(s,e,i){for(let n=0,o,l;n<e.length;n++){if(o=e.charCodeAt(n),o>55295&&o<57344)if(l)if(o<56320){s[i++]=239,s[i++]=191,s[i++]=189,l=o;continue}else o=l-55296<<10|o-56320|65536,l=null;else{o>56319||n+1===e.length?(s[i++]=239,s[i++]=191,s[i++]=189):l=o;continue}else l&&(s[i++]=239,s[i++]=191,s[i++]=189,l=null);o<128?s[i++]=o:(o<2048?s[i++]=o>>6|192:(o<65536?s[i++]=o>>12|224:(s[i++]=o>>18|240,s[i++]=o>>12&63|128),s[i++]=o>>6&63|128),s[i++]=o&63|128)}return i}class MVT extends FeatureFormat{constructor(e){super(),e=e||{},this.dataProjection=new Projection$1({code:"",units:"tile-pixels"}),this.featureClass=e.featureClass?e.featureClass:RenderFeature,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,i,n,o){e.pos=i.geometry;const l=e.readVarint()+e.pos;let c=1,u=0,h=0,f=0,g=0,H=0;for(;e.pos<l;){if(!u){const Y=e.readVarint();c=Y&7,u=Y>>3}if(u--,c===1||c===2)h+=e.readSVarint(),f+=e.readSVarint(),c===1&&g>H&&(o.push(g),H=g),n.push(h,f),g+=2;else if(c===7)g>H&&(n.push(n[H],n[H+1]),g+=2);else throw new Error("Invalid command found in the PBF")}g>H&&(o.push(g),H=g)}createFeature_(e,i,n){const o=i.type;if(o===0)return null;let l;const c=i.properties;let u;this.idProperty_?(u=c[this.idProperty_],delete c[this.idProperty_]):u=i.id,c[this.layerName_]=i.layer.name;const h=[],f=[];this.readRawGeometry_(e,i,h,f);const g=getGeometryType(o,f.length);if(this.featureClass===RenderFeature)l=new this.featureClass(g,h,f,2,c,u),l.transform(n.dataProjection);else{let H;if(g=="Polygon"){const te=inflateEnds(h,f);H=te.length>1?new MultiPolygon(h,"XY",te):new Polygon(h,"XY",f)}else H=g==="Point"?new Point$1(h,"XY"):g==="LineString"?new LineString(h,"XY"):g==="MultiPoint"?new MultiPoint(h,"XY"):g==="MultiLineString"?new MultiLineString(h,"XY",f):null;const Y=this.featureClass;l=new Y,this.geometryName_&&l.setGeometryName(this.geometryName_);const ee=transformGeometryWithOptions(H,!1,n);l.setGeometry(ee),u!==void 0&&l.setId(u),l.setProperties(c,!0)}return l}getType(){return"arraybuffer"}readFeatures(e,i){const n=this.layers_;i=this.adaptOptions(i);const o=get$3(i.dataProjection);o.setWorldExtent(i.extent),i.dataProjection=o;const l=new Pbf(e),c=l.readFields(layersPBFReader,{}),u=[];for(const h in c){if(n&&!n.includes(h))continue;const f=c[h],g=f?[0,0,f.extent,f.extent]:null;o.setExtent(g);for(let H=0,Y=f.length;H<Y;++H){const ee=readRawFeature(l,f,H),te=this.createFeature_(l,ee,i);te!==null&&u.push(te)}}return u}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}}function layersPBFReader(s,e,i){if(s===3){const n={keys:[],values:[],features:[]},o=i.readVarint()+i.pos;i.readFields(layerPBFReader,n,o),n.length=n.features.length,n.length&&(e[n.name]=n)}}function layerPBFReader(s,e,i){if(s===15)e.version=i.readVarint();else if(s===1)e.name=i.readString();else if(s===5)e.extent=i.readVarint();else if(s===2)e.features.push(i.pos);else if(s===3)e.keys.push(i.readString());else if(s===4){let n=null;const o=i.readVarint()+i.pos;for(;i.pos<o;)s=i.readVarint()>>3,n=s===1?i.readString():s===2?i.readFloat():s===3?i.readDouble():s===4?i.readVarint64():s===5?i.readVarint():s===6?i.readSVarint():s===7?i.readBoolean():null;e.values.push(n)}}function featurePBFReader(s,e,i){if(s==1)e.id=i.readVarint();else if(s==2){const n=i.readVarint()+i.pos;for(;i.pos<n;){const o=e.layer.keys[i.readVarint()],l=e.layer.values[i.readVarint()];e.properties[o]=l}}else s==3?e.type=i.readVarint():s==4&&(e.geometry=i.pos)}function readRawFeature(s,e,i){s.pos=e.features[i];const n=s.readVarint()+s.pos,o={layer:e,type:0,properties:{}};return s.readFields(featurePBFReader,o,n),o}function getGeometryType(s,e){let i;return s===1?i=e===1?"Point":"MultiPoint":s===2?i=e===1?"LineString":"MultiLineString":s===3&&(i="Polygon"),i}var $version=8,$root={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources={"*":{type:"source"}},source=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter={type:"array",value:"*"},filter_operator={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function_stop={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression$1={type:"array",value:"*",minimum:1},light={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},paint_line={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_background={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},promoteId={"*":{type:"string"}},v8Spec={$version,$root,sources,source,source_vector,source_raster,source_raster_dem,source_geojson,source_video,source_image,layer,layout,layout_background,layout_fill,layout_circle,layout_heatmap,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line,layout_symbol,layout_raster,layout_hillshade,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter,filter_operator,geometry_type,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop,expression:expression$1,light,sky,terrain,projection,paint,paint_fill,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line,paint_circle,paint_heatmap,paint_symbol,paint_raster,paint_hillshade,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background,transition,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId};const refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function deref(s,e){const i={};for(const n in s)n!=="ref"&&(i[n]=s[n]);return refProperties.forEach(n=>{n in e&&(i[n]=e[n])}),i}function derefLayers(s){s=s.slice();const e=Object.create(null);for(let i=0;i<s.length;i++)e[s[i].id]=s[i];for(let i=0;i<s.length;i++)"ref"in s[i]&&(s[i]=deref(s[i],e[s[i].ref]));return s}class ExpressionParsingError extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Scope{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[n,o]of i)this.bindings[n]=o}concat(e){return new Scope(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}const NullType={kind:"null"},NumberType={kind:"number"},StringType={kind:"string"},BooleanType={kind:"boolean"},ColorType={kind:"color"},ProjectionDefinitionType={kind:"projectionDefinition"},ObjectType={kind:"object"},ValueType={kind:"value"},ErrorType={kind:"error"},CollatorType={kind:"collator"},FormattedType={kind:"formatted"},PaddingType={kind:"padding"},ColorArrayType={kind:"colorArray"},NumberArrayType={kind:"numberArray"},ResolvedImageType={kind:"resolvedImage"},VariableAnchorOffsetCollectionType={kind:"variableAnchorOffsetCollection"};function array(s,e){return{kind:"array",itemType:s,N:e}}function typeToString(s){if(s.kind==="array"){const e=typeToString(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}else return s.kind}const valueMemberTypes=[NullType,NumberType,StringType,BooleanType,ColorType,ProjectionDefinitionType,FormattedType,ObjectType,array(ValueType),PaddingType,NumberArrayType,ColorArrayType,ResolvedImageType,VariableAnchorOffsetCollectionType];function checkSubtype(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!checkSubtype(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const i of valueMemberTypes)if(!checkSubtype(i,e))return null}}return`Expected ${typeToString(s)} but found ${typeToString(e)} instead.`}function isValidType(s,e){return e.some(i=>i.kind===s.kind)}function isValidNativeType(s,e){return e.some(i=>i==="null"?s===null:i==="array"?Array.isArray(s):i==="object"?s&&!Array.isArray(s)&&typeof s=="object":i===typeof s)}function verifyType(s,e){return s.kind==="array"&&e.kind==="array"?s.itemType.kind===e.itemType.kind&&typeof s.N=="number":s.kind===e.kind}const Xn=.96422,Yn=1,Zn=.82521,t0=4/29,t1=6/29,t2=3*t1*t1,t3=t1*t1*t1,deg2rad$1=Math.PI/180,rad2deg=180/Math.PI;function constrainAngle(s){return s=s%360,s<0&&(s+=360),s}function rgbToLab([s,e,i,n]){s=rgb2xyz(s),e=rgb2xyz(e),i=rgb2xyz(i);let o,l;const c=xyz2lab((.2225045*s+.7168786*e+.0606169*i)/Yn);s===e&&e===i?o=l=c:(o=xyz2lab((.4360747*s+.3850649*e+.1430804*i)/Xn),l=xyz2lab((.0139322*s+.0971045*e+.7141733*i)/Zn));const u=116*c-16;return[u<0?0:u,500*(o-c),200*(c-l),n]}function rgb2xyz(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function xyz2lab(s){return s>t3?Math.pow(s,1/3):s/t2+t0}function labToRgb([s,e,i,n]){let o=(s+16)/116,l=isNaN(e)?o:o+e/500,c=isNaN(i)?o:o-i/200;return o=Yn*lab2xyz(o),l=Xn*lab2xyz(l),c=Zn*lab2xyz(c),[xyz2rgb(3.1338561*l-1.6168667*o-.4906146*c),xyz2rgb(-.9787684*l+1.9161415*o+.033454*c),xyz2rgb(.0719453*l-.2289914*o+1.4052427*c),n]}function xyz2rgb(s){return s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055,s<0?0:s>1?1:s}function lab2xyz(s){return s>t1?s*s*s:t2*(s-t0)}function rgbToHcl(s){const[e,i,n,o]=rgbToLab(s),l=Math.sqrt(i*i+n*n);return[Math.round(l*1e4)?constrainAngle(Math.atan2(n,i)*rad2deg):NaN,l,e,o]}function hclToRgb([s,e,i,n]){return s=isNaN(s)?0:s*deg2rad$1,labToRgb([i,Math.cos(s)*e,Math.sin(s)*e,n])}function hslToRgb([s,e,i,n]){s=constrainAngle(s),e/=100,i/=100;function o(l){const c=(l+s/30)%12,u=e*Math.min(i,1-i);return i-u*Math.max(-1,Math.min(c-3,9-c,1))}return[o(0),o(8),o(4),n]}const hasOwnProperty=Object.hasOwn||function(e,i){return Object.prototype.hasOwnProperty.call(e,i)};function getOwn(s,e){return hasOwnProperty(s,e)?s[e]:void 0}function parseCssColor(s){if(s=s.toLowerCase().trim(),s==="transparent")return[0,0,0,0];const e=getOwn(namedColors,s);if(e){const[o,l,c]=e;return[o/255,l/255,c/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const l=s.length<6?1:2;let c=1;return[parseHex(s.slice(c,c+=l)),parseHex(s.slice(c,c+=l)),parseHex(s.slice(c,c+=l)),parseHex(s.slice(c,c+l)||"ff")]}if(s.startsWith("rgb")){const o=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,l=s.match(o);if(l){const[c,u,h,f,g,H,Y,ee,te,xe,ne,et]=l,tt=[f||" ",Y||" ",xe].join("");if(tt==="  "||tt==="  /"||tt===",,"||tt===",,,"){const it=[h,H,te].join(""),rt=it==="%%%"?100:it===""?255:0;if(rt){const nt=[clamp(+u/rt,0,1),clamp(+g/rt,0,1),clamp(+ee/rt,0,1),ne?parseAlpha(+ne,et):1];if(validateNumbers(nt))return nt}}return}}const i=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,n=s.match(i);if(n){const[o,l,c,u,h,f,g,H,Y]=n,ee=[c||" ",h||" ",g].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const te=[+l,clamp(+u,0,100),clamp(+f,0,100),H?parseAlpha(+H,Y):1];if(validateNumbers(te))return hslToRgb(te)}}}function parseHex(s){return parseInt(s.padEnd(2,s),16)/255}function parseAlpha(s,e){return clamp(e?s/100:s,0,1)}function clamp(s,e,i){return Math.min(Math.max(e,s),i)}function validateNumbers(s){return!s.some(Number.isNaN)}const namedColors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function interpolateNumber(s,e,i){return s+i*(e-s)}function interpolateArray(s,e,i){return s.map((n,o)=>interpolateNumber(n,e[o],i))}class Color{constructor(e,i,n,o=1,l=!0){this.r=e,this.g=i,this.b=n,this.a=o,l||(this.r*=o,this.g*=o,this.b*=o,o||this.overwriteGetter("rgb",[e,i,n,o]))}static parse(e){if(e instanceof Color)return e;if(typeof e!="string")return;const i=parseCssColor(e);if(i)return new Color(...i,!1)}get rgb(){const{r:e,g:i,b:n,a:o}=this,l=o||1/0;return this.overwriteGetter("rgb",[e/l,i/l,n/l,o])}get hcl(){return this.overwriteGetter("hcl",rgbToHcl(this.rgb))}get lab(){return this.overwriteGetter("lab",rgbToLab(this.rgb))}overwriteGetter(e,i){return Object.defineProperty(this,e,{value:i}),i}toString(){const[e,i,n,o]=this.rgb;return`rgba(${[e,i,n].map(l=>Math.round(l*255)).join(",")},${o})`}static interpolate(e,i,n,o="rgb"){switch(o){case"rgb":{const[l,c,u,h]=interpolateArray(e.rgb,i.rgb,n);return new Color(l,c,u,h,!1)}case"hcl":{const[l,c,u,h]=e.hcl,[f,g,H,Y]=i.hcl;let ee,te;if(!isNaN(l)&&!isNaN(f)){let it=f-l;f>l&&it>180?it-=360:f<l&&l-f>180&&(it+=360),ee=l+n*it}else isNaN(l)?isNaN(f)?ee=NaN:(ee=f,(u===1||u===0)&&(te=g)):(ee=l,(H===1||H===0)&&(te=c));const[xe,ne,et,tt]=hclToRgb([ee,te??interpolateNumber(c,g,n),interpolateNumber(u,H,n),interpolateNumber(h,Y,n)]);return new Color(xe,ne,et,tt,!1)}case"lab":{const[l,c,u,h]=labToRgb(interpolateArray(e.lab,i.lab,n));return new Color(l,c,u,h,!1)}}}}Color.black=new Color(0,0,0,1);Color.white=new Color(1,1,1,1);Color.transparent=new Color(0,0,0,0);Color.red=new Color(1,0,0,1);class Collator{constructor(e,i,n){e?this.sensitivity=i?"variant":"case":this.sensitivity=i?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const VERTICAL_ALIGN_OPTIONS=["bottom","center","top"];class FormattedSection{constructor(e,i,n,o,l,c){this.text=e,this.image=i,this.scale=n,this.fontStack=o,this.textColor=l,this.verticalAlign=c}}class Formatted{constructor(e){this.sections=e}static fromString(e){return new Formatted([new FormattedSection(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Formatted?e:Formatted.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Padding{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Padding)return e;if(typeof e=="number")return new Padding([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const i of e)if(typeof i!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]];break}return new Padding(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,n){return new Padding(interpolateArray(e.values,i.values,n))}}class NumberArray{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof NumberArray)return e;if(typeof e=="number")return new NumberArray([e]);if(Array.isArray(e)){for(const i of e)if(typeof i!="number")return;return new NumberArray(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,n){return new NumberArray(interpolateArray(e.values,i.values,n))}}class ColorArray{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ColorArray)return e;if(typeof e=="string"){const n=Color.parse(e);return n?new ColorArray([n]):void 0}if(!Array.isArray(e))return;const i=[];for(const n of e){if(typeof n!="string")return;const o=Color.parse(n);if(!o)return;i.push(o)}return new ColorArray(i)}toString(){return JSON.stringify(this.values)}static interpolate(e,i,n,o="rgb"){const l=[];if(e.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let c=0;c<e.values.length;c++)l.push(Color.interpolate(e.values[c],i.values[c],n,o));return new ColorArray(l)}}class RuntimeError extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const anchors=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class VariableAnchorOffsetCollection{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof VariableAnchorOffsetCollection)return e;if(!(!Array.isArray(e)||e.length<1||e.length%2!==0)){for(let i=0;i<e.length;i+=2){const n=e[i],o=e[i+1];if(typeof n!="string"||!anchors.has(n)||!Array.isArray(o)||o.length!==2||typeof o[0]!="number"||typeof o[1]!="number")return}return new VariableAnchorOffsetCollection(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,n){const o=e.values,l=i.values;if(o.length!==l.length)throw new RuntimeError(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${i.toString()}`);const c=[];for(let u=0;u<o.length;u+=2){if(o[u]!==l[u])throw new RuntimeError(`Cannot interpolate values containing mismatched anchors. from[${u}]: ${o[u]}, to[${u}]: ${l[u]}`);c.push(o[u]);const[h,f]=o[u+1],[g,H]=l[u+1];c.push([interpolateNumber(h,g,n),interpolateNumber(f,H,n)])}return new VariableAnchorOffsetCollection(c)}}class ResolvedImage{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ResolvedImage({name:e,available:!1}):null}}class ProjectionDefinition{constructor(e,i,n){this.from=e,this.to=i,this.transition=n}static interpolate(e,i,n){return new ProjectionDefinition(e,i,n)}static parse(e){if(e instanceof ProjectionDefinition)return e;if(Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number")return new ProjectionDefinition(e[0],e[1],e[2]);if(typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number")return new ProjectionDefinition(e.from,e.to,e.transition);if(typeof e=="string")return new ProjectionDefinition(e,e,1)}}function validateRGBA(s,e,i,n){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?typeof n>"u"||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[s,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[s,e,i,n]:[s,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function isValue(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof ProjectionDefinition||s instanceof Color||s instanceof Collator||s instanceof Formatted||s instanceof Padding||s instanceof NumberArray||s instanceof ColorArray||s instanceof VariableAnchorOffsetCollection||s instanceof ResolvedImage)return!0;if(Array.isArray(s)){for(const e of s)if(!isValue(e))return!1;return!0}else if(typeof s=="object"){for(const e in s)if(!isValue(s[e]))return!1;return!0}else return!1}function typeOf(s){if(s===null)return NullType;if(typeof s=="string")return StringType;if(typeof s=="boolean")return BooleanType;if(typeof s=="number")return NumberType;if(s instanceof Color)return ColorType;if(s instanceof ProjectionDefinition)return ProjectionDefinitionType;if(s instanceof Collator)return CollatorType;if(s instanceof Formatted)return FormattedType;if(s instanceof Padding)return PaddingType;if(s instanceof NumberArray)return NumberArrayType;if(s instanceof ColorArray)return ColorArrayType;if(s instanceof VariableAnchorOffsetCollection)return VariableAnchorOffsetCollectionType;if(s instanceof ResolvedImage)return ResolvedImageType;if(Array.isArray(s)){const e=s.length;let i;for(const n of s){const o=typeOf(n);if(!i)i=o;else{if(i===o)continue;i=ValueType;break}}return array(i||ValueType,e)}else return ObjectType}function valueToString(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof Color||s instanceof ProjectionDefinition||s instanceof Formatted||s instanceof Padding||s instanceof NumberArray||s instanceof ColorArray||s instanceof VariableAnchorOffsetCollection||s instanceof ResolvedImage?s.toString():JSON.stringify(s)}class Literal{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!isValue(e[1]))return i.error("invalid value");const n=e[1];let o=typeOf(n);const l=i.expectedType;return o.kind==="array"&&o.N===0&&l&&l.kind==="array"&&(typeof l.N!="number"||l.N===0)&&(o=l),new Literal(o,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const types$1$1={string:StringType,number:NumberType,boolean:BooleanType,object:ObjectType};class Assertion{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let n=1,o;const l=e[0];if(l==="array"){let u;if(e.length>2){const f=e[1];if(typeof f!="string"||!(f in types$1$1)||f==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);u=types$1$1[f],n++}else u=ValueType;let h;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);h=e[2],n++}o=array(u,h)}else{if(!types$1$1[l])throw new Error(`Types doesn't contain name = ${l}`);o=types$1$1[l]}const c=[];for(;n<e.length;n++){const u=i.parse(e[n],n,ValueType);if(!u)return null;c.push(u)}return new Assertion(o,c)}evaluate(e){for(let i=0;i<this.args.length;i++){const n=this.args[i].evaluate(e);if(checkSubtype(this.type,typeOf(n))){if(i===this.args.length-1)throw new RuntimeError(`Expected value to be of type ${typeToString(this.type)}, but found ${typeToString(typeOf(n))} instead.`)}else return n}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const types$2={"to-boolean":BooleanType,"to-color":ColorType,"to-number":NumberType,"to-string":StringType};class Coercion{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const n=e[0];if(!types$2[n])throw new Error(`Can't parse ${n} as it is not part of the known types`);if((n==="to-boolean"||n==="to-string")&&e.length!==2)return i.error("Expected one argument.");const o=types$2[n],l=[];for(let c=1;c<e.length;c++){const u=i.parse(e[c],c,ValueType);if(!u)return null;l.push(u)}return new Coercion(o,l)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let i,n;for(const o of this.args){if(i=o.evaluate(e),n=null,i instanceof Color)return i;if(typeof i=="string"){const l=e.parseColor(i);if(l)return l}else if(Array.isArray(i)&&(i.length<3||i.length>4?n=`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:n=validateRGBA(i[0],i[1],i[2],i[3]),!n))return new Color(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new RuntimeError(n||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const n of this.args){i=n.evaluate(e);const o=Padding.parse(i);if(o)return o}throw new RuntimeError(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(const n of this.args){i=n.evaluate(e);const o=NumberArray.parse(i);if(o)return o}throw new RuntimeError(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(const n of this.args){i=n.evaluate(e);const o=ColorArray.parse(i);if(o)return o}throw new RuntimeError(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const n of this.args){i=n.evaluate(e);const o=VariableAnchorOffsetCollection.parse(i);if(o)return o}throw new RuntimeError(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const n of this.args){if(i=n.evaluate(e),i===null)return 0;const o=Number(i);if(!isNaN(o))return o}throw new RuntimeError(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return Formatted.fromString(valueToString(this.args[0].evaluate(e)));case"resolvedImage":return ResolvedImage.fromString(valueToString(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return valueToString(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const geometryTypes=["Unknown","Point","LineString","Polygon"];class EvaluationContext{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?geometryTypes[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let i=this._parseColorCache.get(e);return i||(i=Color.parse(e),this._parseColorCache.set(e,i)),i}}class ParsingContext{constructor(e,i,n=[],o,l=new Scope,c=[]){this.registry=e,this.path=n,this.key=n.map(u=>`[${u}]`).join(""),this.scope=l,this.errors=c,this.expectedType=o,this._isConstant=i}parse(e,i,n,o,l={}){return i?this.concat(i,n,o)._parse(e,l):this._parse(e,l)}_parse(e,i){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function n(o,l,c){return c==="assert"?new Assertion(l,[o]):c==="coerce"?new Coercion(l,[o]):o}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const o=e[0];if(typeof o!="string")return this.error(`Expression name must be a string, but found ${typeof o} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const l=this.registry[o];if(l){let c=l.parse(e,this);if(!c)return null;if(this.expectedType){const u=this.expectedType,h=c.type;if((u.kind==="string"||u.kind==="number"||u.kind==="boolean"||u.kind==="object"||u.kind==="array")&&h.kind==="value")c=n(c,u,i.typeAnnotation||"assert");else if(u.kind==="projectionDefinition"&&["string","array"].includes(h.kind)||["color","formatted","resolvedImage"].includes(u.kind)&&["value","string"].includes(h.kind)||["padding","numberArray"].includes(u.kind)&&["value","number","array"].includes(h.kind)||u.kind==="colorArray"&&["value","string","array"].includes(h.kind)||u.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(h.kind))c=n(c,u,i.typeAnnotation||"coerce");else if(this.checkSubtype(u,h))return null}if(!(c instanceof Literal)&&c.type.kind!=="resolvedImage"&&this._isConstant(c)){const u=new EvaluationContext;try{c=new Literal(c.type,c.evaluate(u))}catch(h){return this.error(h.message),null}}return c}return this.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,i,n){const o=typeof e=="number"?this.path.concat(e):this.path,l=n?this.scope.concat(n):this.scope;return new ParsingContext(this.registry,this._isConstant,o,i||null,l,this.errors)}error(e,...i){const n=`${this.key}${i.map(o=>`[${o}]`).join("")}`;this.errors.push(new ExpressionParsingError(n,e))}checkSubtype(e,i){const n=checkSubtype(e,i);return n&&this.error(n),n}}class Let{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let l=1;l<e.length-1;l+=2){const c=e[l];if(typeof c!="string")return i.error(`Expected string, but found ${typeof c} instead.`,l);if(/[^a-zA-Z0-9_]/.test(c))return i.error("Variable names must contain only alphanumeric characters or '_'.",l);const u=i.parse(e[l+1],l+1);if(!u)return null;n.push([c,u])}const o=i.parse(e[e.length-1],e.length-1,i.expectedType,n);return o?new Let(n,o):null}outputDefined(){return this.result.outputDefined()}}class Var{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const n=e[1];return i.scope.has(n)?new Var(n,i.scope.get(n)):i.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class At{constructor(e,i,n){this.type=e,this.index=i,this.input=n}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,NumberType),o=i.parse(e[2],2,array(i.expectedType||ValueType));if(!n||!o)return null;const l=o.type;return new At(l.itemType,n,o)}evaluate(e){const i=this.index.evaluate(e),n=this.input.evaluate(e);if(i<0)throw new RuntimeError(`Array index out of bounds: ${i} < 0.`);if(i>=n.length)throw new RuntimeError(`Array index out of bounds: ${i} > ${n.length-1}.`);if(i!==Math.floor(i))throw new RuntimeError(`Array index must be an integer, but found ${i} instead.`);return n[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class In{constructor(e,i){this.type=BooleanType,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,ValueType),o=i.parse(e[2],2,ValueType);return!n||!o?null:isValidType(n.type,[BooleanType,StringType,NumberType,NullType,ValueType])?new In(n,o):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${typeToString(n.type)} instead`)}evaluate(e){const i=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!isValidNativeType(i,["boolean","string","number","null"]))throw new RuntimeError(`Expected first argument to be of type boolean, string, number or null, but found ${typeToString(typeOf(i))} instead.`);if(!isValidNativeType(n,["string","array"]))throw new RuntimeError(`Expected second argument to be of type array or string, but found ${typeToString(typeOf(n))} instead.`);return n.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class IndexOf{constructor(e,i,n){this.type=NumberType,this.needle=e,this.haystack=i,this.fromIndex=n}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,ValueType),o=i.parse(e[2],2,ValueType);if(!n||!o)return null;if(!isValidType(n.type,[BooleanType,StringType,NumberType,NullType,ValueType]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${typeToString(n.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,NumberType);return l?new IndexOf(n,o,l):null}else return new IndexOf(n,o)}evaluate(e){const i=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!isValidNativeType(i,["boolean","string","number","null"]))throw new RuntimeError(`Expected first argument to be of type boolean, string, number or null, but found ${typeToString(typeOf(i))} instead.`);let o;if(this.fromIndex&&(o=this.fromIndex.evaluate(e)),isValidNativeType(n,["string"])){const l=n.indexOf(i,o);return l===-1?-1:[...n.slice(0,l)].length}else{if(isValidNativeType(n,["array"]))return n.indexOf(i,o);throw new RuntimeError(`Expected second argument to be of type array or string, but found ${typeToString(typeOf(n))} instead.`)}}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Match{constructor(e,i,n,o,l,c){this.inputType=e,this.type=i,this.input=n,this.cases=o,this.outputs=l,this.otherwise=c}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return i.error("Expected an even number of arguments.");let n,o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const l={},c=[];for(let f=2;f<e.length-1;f+=2){let g=e[f];const H=e[f+1];Array.isArray(g)||(g=[g]);const Y=i.concat(f);if(g.length===0)return Y.error("Expected at least one branch label.");for(const te of g){if(typeof te!="number"&&typeof te!="string")return Y.error("Branch labels must be numbers or strings.");if(typeof te=="number"&&Math.abs(te)>Number.MAX_SAFE_INTEGER)return Y.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof te=="number"&&Math.floor(te)!==te)return Y.error("Numeric branch labels must be integer values.");if(!n)n=typeOf(te);else if(Y.checkSubtype(n,typeOf(te)))return null;if(typeof l[String(te)]<"u")return Y.error("Branch labels must be unique.");l[String(te)]=c.length}const ee=i.parse(H,f,o);if(!ee)return null;o=o||ee.type,c.push(ee)}const u=i.parse(e[1],1,ValueType);if(!u)return null;const h=i.parse(e[e.length-1],e.length-1,o);return!h||u.type.kind!=="value"&&i.concat(1).checkSubtype(n,u.type)?null:new Match(n,o,u,l,c,h)}evaluate(e){const i=this.input.evaluate(e);return(typeOf(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Case{constructor(e,i,n){this.type=e,this.branches=i,this.otherwise=n}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return i.error("Expected an odd number of arguments.");let n;i.expectedType&&i.expectedType.kind!=="value"&&(n=i.expectedType);const o=[];for(let c=1;c<e.length-1;c+=2){const u=i.parse(e[c],c,BooleanType);if(!u)return null;const h=i.parse(e[c+1],c+1,n);if(!h)return null;o.push([u,h]),n=n||h.type}const l=i.parse(e[e.length-1],e.length-1,n);if(!l)return null;if(!n)throw new Error("Can't infer output type");return new Case(n,o,l)}evaluate(e){for(const[i,n]of this.branches)if(i.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,n]of this.branches)e(i),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}}class Slice{constructor(e,i,n,o){this.type=e,this.input=i,this.beginIndex=n,this.endIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,ValueType),o=i.parse(e[2],2,NumberType);if(!n||!o)return null;if(!isValidType(n.type,[array(ValueType),StringType,ValueType]))return i.error(`Expected first argument to be of type array or string, but found ${typeToString(n.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,NumberType);return l?new Slice(n.type,n,o,l):null}else return new Slice(n.type,n,o)}evaluate(e){const i=this.input.evaluate(e),n=this.beginIndex.evaluate(e);let o;if(this.endIndex&&(o=this.endIndex.evaluate(e)),isValidNativeType(i,["string"]))return[...i].slice(n,o).join("");if(isValidNativeType(i,["array"]))return i.slice(n,o);throw new RuntimeError(`Expected first argument to be of type array or string, but found ${typeToString(typeOf(i))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function findStopLessThanOrEqualTo(s,e){const i=s.length-1;let n=0,o=i,l=0,c,u;for(;n<=o;)if(l=Math.floor((n+o)/2),c=s[l],u=s[l+1],c<=e){if(l===i||e<u)return l;n=l+1}else if(c>e)o=l-1;else throw new RuntimeError("Input is not a number.");return 0}class Step{constructor(e,i,n){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[o,l]of n)this.labels.push(o),this.outputs.push(l)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return i.error("Expected an even number of arguments.");const n=i.parse(e[1],1,NumberType);if(!n)return null;const o=[];let l=null;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);for(let c=1;c<e.length;c+=2){const u=c===1?-1/0:e[c],h=e[c+1],f=c,g=c+1;if(typeof u!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(o.length&&o[o.length-1][0]>=u)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',f);const H=i.parse(h,g,l);if(!H)return null;l=l||H.type,o.push([u,H])}return new Step(l,n,o)}evaluate(e){const i=this.labels,n=this.outputs;if(i.length===1)return n[0].evaluate(e);const o=this.input.evaluate(e);if(o<=i[0])return n[0].evaluate(e);const l=i.length;if(o>=i[l-1])return n[l-1].evaluate(e);const c=findStopLessThanOrEqualTo(i,o);return n[c].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function getDefaultExportFromCjs(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var unitbezier,hasRequiredUnitbezier;function requireUnitbezier(){if(hasRequiredUnitbezier)return unitbezier;hasRequiredUnitbezier=1,unitbezier=s;function s(e,i,n,o){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(o-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=n,this.p2y=o}return s.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,o=0;o<8;o++){var l=this.sampleCurveX(n)-e;if(Math.abs(l)<i)return n;var c=this.sampleCurveDerivativeX(n);if(Math.abs(c)<1e-6)break;n=n-l/c}var u=0,h=1;for(n=e,o=0;o<20&&(l=this.sampleCurveX(n),!(Math.abs(l-e)<i));o++)e>l?u=n:h=n,n=(h-u)*.5+u;return n},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},unitbezier}var unitbezierExports=requireUnitbezier(),UnitBezier=getDefaultExportFromCjs(unitbezierExports);class Interpolate{constructor(e,i,n,o,l){this.type=e,this.operator=i,this.interpolation=n,this.input=o,this.labels=[],this.outputs=[];for(const[c,u]of l)this.labels.push(c),this.outputs.push(u)}static interpolationFactor(e,i,n,o){let l=0;if(e.name==="exponential")l=exponentialInterpolation(i,e.base,n,o);else if(e.name==="linear")l=exponentialInterpolation(i,1,n,o);else if(e.name==="cubic-bezier"){const c=e.controlPoints;l=new UnitBezier(c[0],c[1],c[2],c[3]).solve(exponentialInterpolation(i,1,n,o))}return l}static parse(e,i){let[n,o,l,...c]=e;if(!Array.isArray(o)||o.length===0)return i.error("Expected an interpolation type expression.",1);if(o[0]==="linear")o={name:"linear"};else if(o[0]==="exponential"){const f=o[1];if(typeof f!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);o={name:"exponential",base:f}}else if(o[0]==="cubic-bezier"){const f=o.slice(1);if(f.length!==4||f.some(g=>typeof g!="number"||g<0||g>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);o={name:"cubic-bezier",controlPoints:f}}else return i.error(`Unknown interpolation type ${String(o[0])}`,1,0);if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return i.error("Expected an even number of arguments.");if(l=i.parse(l,2,NumberType),!l)return null;const u=[];let h=null;(n==="interpolate-hcl"||n==="interpolate-lab")&&i.expectedType!=ColorArrayType?h=ColorType:i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);for(let f=0;f<c.length;f+=2){const g=c[f],H=c[f+1],Y=f+3,ee=f+4;if(typeof g!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Y);if(u.length&&u[u.length-1][0]>=g)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Y);const te=i.parse(H,ee,h);if(!te)return null;h=h||te.type,u.push([g,te])}return!verifyType(h,NumberType)&&!verifyType(h,ProjectionDefinitionType)&&!verifyType(h,ColorType)&&!verifyType(h,PaddingType)&&!verifyType(h,NumberArrayType)&&!verifyType(h,ColorArrayType)&&!verifyType(h,VariableAnchorOffsetCollectionType)&&!verifyType(h,array(NumberType))?i.error(`Type ${typeToString(h)} is not interpolatable.`):new Interpolate(h,n,o,l,u)}evaluate(e){const i=this.labels,n=this.outputs;if(i.length===1)return n[0].evaluate(e);const o=this.input.evaluate(e);if(o<=i[0])return n[0].evaluate(e);const l=i.length;if(o>=i[l-1])return n[l-1].evaluate(e);const c=findStopLessThanOrEqualTo(i,o),u=i[c],h=i[c+1],f=Interpolate.interpolationFactor(this.interpolation,o,u,h),g=n[c].evaluate(e),H=n[c+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return interpolateNumber(g,H,f);case"color":return Color.interpolate(g,H,f);case"padding":return Padding.interpolate(g,H,f);case"colorArray":return ColorArray.interpolate(g,H,f);case"numberArray":return NumberArray.interpolate(g,H,f);case"variableAnchorOffsetCollection":return VariableAnchorOffsetCollection.interpolate(g,H,f);case"array":return interpolateArray(g,H,f);case"projectionDefinition":return ProjectionDefinition.interpolate(g,H,f)}case"interpolate-hcl":switch(this.type.kind){case"color":return Color.interpolate(g,H,f,"hcl");case"colorArray":return ColorArray.interpolate(g,H,f,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Color.interpolate(g,H,f,"lab");case"colorArray":return ColorArray.interpolate(g,H,f,"lab")}}}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function exponentialInterpolation(s,e,i,n){const o=n-i,l=s-i;return o===0?0:e===1?l/o:(Math.pow(e,l)-1)/(Math.pow(e,o)-1)}class Coalesce{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let n=null;const o=i.expectedType;o&&o.kind!=="value"&&(n=o);const l=[];for(const u of e.slice(1)){const h=i.parse(u,1+l.length,n,void 0,{typeAnnotation:"omit"});if(!h)return null;n=n||h.type,l.push(h)}if(!n)throw new Error("No output type");return o&&l.some(u=>checkSubtype(o,u.type))?new Coalesce(ValueType,l):new Coalesce(n,l)}evaluate(e){let i=null,n=0,o;for(const l of this.args)if(n++,i=l.evaluate(e),i&&i instanceof ResolvedImage&&!i.available&&(o||(o=i.name),i=null,n===this.args.length&&(i=o)),i!==null)break;return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function isComparableType(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function eq(s,e,i){return e===i}function neq(s,e,i){return e!==i}function lt(s,e,i){return e<i}function gt(s,e,i){return e>i}function lteq(s,e,i){return e<=i}function gteq(s,e,i){return e>=i}function eqCollate(s,e,i,n){return n.compare(e,i)===0}function neqCollate(s,e,i,n){return!eqCollate(s,e,i,n)}function ltCollate(s,e,i,n){return n.compare(e,i)<0}function gtCollate(s,e,i,n){return n.compare(e,i)>0}function lteqCollate(s,e,i,n){return n.compare(e,i)<=0}function gteqCollate(s,e,i,n){return n.compare(e,i)>=0}function makeComparison(s,e,i){const n=s!=="=="&&s!=="!=";return class Xi{constructor(l,c,u){this.type=BooleanType,this.lhs=l,this.rhs=c,this.collator=u,this.hasUntypedArgument=l.type.kind==="value"||c.type.kind==="value"}static parse(l,c){if(l.length!==3&&l.length!==4)return c.error("Expected two or three arguments.");const u=l[0];let h=c.parse(l[1],1,ValueType);if(!h)return null;if(!isComparableType(u,h.type))return c.concat(1).error(`"${u}" comparisons are not supported for type '${typeToString(h.type)}'.`);let f=c.parse(l[2],2,ValueType);if(!f)return null;if(!isComparableType(u,f.type))return c.concat(2).error(`"${u}" comparisons are not supported for type '${typeToString(f.type)}'.`);if(h.type.kind!==f.type.kind&&h.type.kind!=="value"&&f.type.kind!=="value")return c.error(`Cannot compare types '${typeToString(h.type)}' and '${typeToString(f.type)}'.`);n&&(h.type.kind==="value"&&f.type.kind!=="value"?h=new Assertion(f.type,[h]):h.type.kind!=="value"&&f.type.kind==="value"&&(f=new Assertion(h.type,[f])));let g=null;if(l.length===4){if(h.type.kind!=="string"&&f.type.kind!=="string"&&h.type.kind!=="value"&&f.type.kind!=="value")return c.error("Cannot use collator to compare non-string types.");if(g=c.parse(l[3],3,CollatorType),!g)return null}return new Xi(h,f,g)}evaluate(l){const c=this.lhs.evaluate(l),u=this.rhs.evaluate(l);if(n&&this.hasUntypedArgument){const h=typeOf(c),f=typeOf(u);if(h.kind!==f.kind||!(h.kind==="string"||h.kind==="number"))throw new RuntimeError(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${h.kind}, ${f.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const h=typeOf(c),f=typeOf(u);if(h.kind!=="string"||f.kind!=="string")return e(l,c,u)}return this.collator?i(l,c,u,this.collator.evaluate(l)):e(l,c,u)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}}}const Equals=makeComparison("==",eq,eqCollate),NotEquals=makeComparison("!=",neq,neqCollate),LessThan=makeComparison("<",lt,ltCollate),GreaterThan=makeComparison(">",gt,gtCollate),LessThanOrEqual=makeComparison("<=",lteq,lteqCollate),GreaterThanOrEqual=makeComparison(">=",gteq,gteqCollate);class CollatorExpression{constructor(e,i,n){this.type=CollatorType,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return i.error("Collator options argument must be an object.");const o=i.parse(n["case-sensitive"]===void 0?!1:n["case-sensitive"],1,BooleanType);if(!o)return null;const l=i.parse(n["diacritic-sensitive"]===void 0?!1:n["diacritic-sensitive"],1,BooleanType);if(!l)return null;let c=null;return n.locale&&(c=i.parse(n.locale,1,StringType),!c)?null:new CollatorExpression(o,l,c)}evaluate(e){return new Collator(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class NumberFormat{constructor(e,i,n,o,l){this.type=StringType,this.number=e,this.locale=i,this.currency=n,this.minFractionDigits=o,this.maxFractionDigits=l}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const n=i.parse(e[1],1,NumberType);if(!n)return null;const o=e[2];if(typeof o!="object"||Array.isArray(o))return i.error("NumberFormat options argument must be an object.");let l=null;if(o.locale&&(l=i.parse(o.locale,1,StringType),!l))return null;let c=null;if(o.currency&&(c=i.parse(o.currency,1,StringType),!c))return null;let u=null;if(o["min-fraction-digits"]&&(u=i.parse(o["min-fraction-digits"],1,NumberType),!u))return null;let h=null;return o["max-fraction-digits"]&&(h=i.parse(o["max-fraction-digits"],1,NumberType),!h)?null:new NumberFormat(n,l,c,u,h)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class FormatExpression{constructor(e){this.type=FormattedType,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return i.error("First argument must be an image or text section.");const o=[];let l=!1;for(let c=1;c<=e.length-1;++c){const u=e[c];if(l&&typeof u=="object"&&!Array.isArray(u)){l=!1;let h=null;if(u["font-scale"]&&(h=i.parse(u["font-scale"],1,NumberType),!h))return null;let f=null;if(u["text-font"]&&(f=i.parse(u["text-font"],1,array(StringType)),!f))return null;let g=null;if(u["text-color"]&&(g=i.parse(u["text-color"],1,ColorType),!g))return null;let H=null;if(u["vertical-align"]){if(typeof u["vertical-align"]=="string"&&!VERTICAL_ALIGN_OPTIONS.includes(u["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${u["vertical-align"]}' instead.`);if(H=i.parse(u["vertical-align"],1,StringType),!H)return null}const Y=o[o.length-1];Y.scale=h,Y.font=f,Y.textColor=g,Y.verticalAlign=H}else{const h=i.parse(e[c],1,ValueType);if(!h)return null;const f=h.type.kind;if(f!=="string"&&f!=="value"&&f!=="null"&&f!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,o.push({content:h,scale:null,font:null,textColor:null,verticalAlign:null})}}return new FormatExpression(o)}evaluate(e){const i=n=>{const o=n.content.evaluate(e);return typeOf(o)===ResolvedImageType?new FormattedSection("",o,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(e):null):new FormattedSection(valueToString(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null,n.verticalAlign?n.verticalAlign.evaluate(e):null)};return new Formatted(this.sections.map(i))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor),i.verticalAlign&&e(i.verticalAlign)}outputDefined(){return!1}}class ImageExpression{constructor(e){this.type=ResolvedImageType,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const n=i.parse(e[1],1,StringType);return n?new ImageExpression(n):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),n=ResolvedImage.fromString(i);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(i)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}}class Length{constructor(e){this.type=NumberType,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=i.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${typeToString(n.type)} instead.`):new Length(n):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new RuntimeError(`Expected value to be of type string or array, but found ${typeToString(typeOf(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const EXTENT=8192;function getTileCoordinates(s,e){const i=mercatorXfromLng(s[0]),n=mercatorYfromLat(s[1]),o=Math.pow(2,e.z);return[Math.round(i*o*EXTENT),Math.round(n*o*EXTENT)]}function getLngLatFromTileCoord(s,e){const i=Math.pow(2,e.z),n=(s[0]/EXTENT+e.x)/i,o=(s[1]/EXTENT+e.y)/i;return[lngFromMercatorXfromLng(n),latFromMercatorY(o)]}function mercatorXfromLng(s){return(180+s)/360}function lngFromMercatorXfromLng(s){return s*360-180}function mercatorYfromLat(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function latFromMercatorY(s){return 360/Math.PI*Math.atan(Math.exp((180-s*360)*Math.PI/180))-90}function updateBBox(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function boxWithinBox(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function rayIntersect(s,e,i){return e[1]>s[1]!=i[1]>s[1]&&s[0]<(i[0]-e[0])*(s[1]-e[1])/(i[1]-e[1])+e[0]}function pointOnBoundary(s,e,i){const n=s[0]-e[0],o=s[1]-e[1],l=s[0]-i[0],c=s[1]-i[1];return n*c-l*o===0&&n*l<=0&&o*c<=0}function segmentIntersectSegment(s,e,i,n){const o=[e[0]-s[0],e[1]-s[1]],l=[n[0]-i[0],n[1]-i[1]];return perp(l,o)===0?!1:!!(twoSided(s,e,i,n)&&twoSided(i,n,s,e))}function lineIntersectPolygon(s,e,i){for(const n of i)for(let o=0;o<n.length-1;++o)if(segmentIntersectSegment(s,e,n[o],n[o+1]))return!0;return!1}function pointWithinPolygon(s,e,i=!1){let n=!1;for(const o of e)for(let l=0;l<o.length-1;l++){if(pointOnBoundary(s,o[l],o[l+1]))return i;rayIntersect(s,o[l],o[l+1])&&(n=!n)}return n}function pointWithinPolygons(s,e){for(const i of e)if(pointWithinPolygon(s,i))return!0;return!1}function lineStringWithinPolygon(s,e){for(const i of s)if(!pointWithinPolygon(i,e))return!1;for(let i=0;i<s.length-1;++i)if(lineIntersectPolygon(s[i],s[i+1],e))return!1;return!0}function lineStringWithinPolygons(s,e){for(const i of e)if(lineStringWithinPolygon(s,i))return!0;return!1}function perp(s,e){return s[0]*e[1]-s[1]*e[0]}function twoSided(s,e,i,n){const o=s[0]-i[0],l=s[1]-i[1],c=e[0]-i[0],u=e[1]-i[1],h=n[0]-i[0],f=n[1]-i[1],g=o*f-h*l,H=c*f-h*u;return g>0&&H<0||g<0&&H>0}function getTilePolygon(s,e,i){const n=[];for(let o=0;o<s.length;o++){const l=[];for(let c=0;c<s[o].length;c++){const u=getTileCoordinates(s[o][c],i);updateBBox(e,u),l.push(u)}n.push(l)}return n}function getTilePolygons(s,e,i){const n=[];for(let o=0;o<s.length;o++){const l=getTilePolygon(s[o],e,i);n.push(l)}return n}function updatePoint(s,e,i,n){if(s[0]<i[0]||s[0]>i[2]){const o=n*.5;let l=s[0]-i[0]>o?-n:i[0]-s[0]>o?n:0;l===0&&(l=s[0]-i[2]>o?-n:i[2]-s[0]>o?n:0),s[0]+=l}updateBBox(e,s)}function resetBBox(s){s[0]=s[1]=1/0,s[2]=s[3]=-1/0}function getTilePoints(s,e,i,n){const o=Math.pow(2,n.z)*EXTENT,l=[n.x*EXTENT,n.y*EXTENT],c=[];for(const u of s)for(const h of u){const f=[h.x+l[0],h.y+l[1]];updatePoint(f,e,i,o),c.push(f)}return c}function getTileLines(s,e,i,n){const o=Math.pow(2,n.z)*EXTENT,l=[n.x*EXTENT,n.y*EXTENT],c=[];for(const u of s){const h=[];for(const f of u){const g=[f.x+l[0],f.y+l[1]];updateBBox(e,g),h.push(g)}c.push(h)}if(e[2]-e[0]<=o/2){resetBBox(e);for(const u of c)for(const h of u)updatePoint(h,e,i,o)}return c}function pointsWithinPolygons(s,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],o=s.canonicalID();if(e.type==="Polygon"){const l=getTilePolygon(e.coordinates,n,o),c=getTilePoints(s.geometry(),i,n,o);if(!boxWithinBox(i,n))return!1;for(const u of c)if(!pointWithinPolygon(u,l))return!1}if(e.type==="MultiPolygon"){const l=getTilePolygons(e.coordinates,n,o),c=getTilePoints(s.geometry(),i,n,o);if(!boxWithinBox(i,n))return!1;for(const u of c)if(!pointWithinPolygons(u,l))return!1}return!0}function linesWithinPolygons(s,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],o=s.canonicalID();if(e.type==="Polygon"){const l=getTilePolygon(e.coordinates,n,o),c=getTileLines(s.geometry(),i,n,o);if(!boxWithinBox(i,n))return!1;for(const u of c)if(!lineStringWithinPolygon(u,l))return!1}if(e.type==="MultiPolygon"){const l=getTilePolygons(e.coordinates,n,o),c=getTileLines(s.geometry(),i,n,o);if(!boxWithinBox(i,n))return!1;for(const u of c)if(!lineStringWithinPolygons(u,l))return!1}return!0}class Within{constructor(e,i){this.type=BooleanType,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(isValue(e[1])){const n=e[1];if(n.type==="FeatureCollection"){const o=[];for(const l of n.features){const{type:c,coordinates:u}=l.geometry;c==="Polygon"&&o.push(u),c==="MultiPolygon"&&o.push(...u)}if(o.length){const l={type:"MultiPolygon",coordinates:o};return new Within(n,l)}}else if(n.type==="Feature"){const o=n.geometry.type;if(o==="Polygon"||o==="MultiPolygon")return new Within(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new Within(n,n)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return pointsWithinPolygons(e,this.geometries);if(e.geometryType()==="LineString")return linesWithinPolygons(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class TinyQueue{constructor(e=[],i=(n,o)=>n<o?-1:n>o?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:n}=this,o=i[e];for(;e>0;){const l=e-1>>1,c=i[l];if(n(o,c)>=0)break;i[e]=c,e=l}i[e]=o}_down(e){const{data:i,compare:n}=this,o=this.length>>1,l=i[e];for(;e<o;){let c=(e<<1)+1;const u=c+1;if(u<this.length&&n(i[u],i[c])<0&&(c=u),n(i[c],l)>=0)break;i[e]=i[c],e=c}i[e]=l}}function classifyRings(s,e){if(s.length<=1)return[s];const n=[];let o,l;for(const c of s){const u=calculateSignedArea(c);u!==0&&(c.area=Math.abs(u),l===void 0&&(l=u<0),l===u<0?(o&&n.push(o),o=[c]):o.push(c))}return o&&n.push(o),n}function calculateSignedArea(s){let e=0;for(let i=0,n=s.length,o=n-1,l,c;i<n;o=i++)l=s[i],c=s[o],e+=(c.x-l.x)*(l.y+c.y);return e}const RE=6378.137,FE=1/298.257223563,E2=FE*(2-FE),RAD=Math.PI/180;class CheapRuler{constructor(e){const i=RAD*RE*1e3,n=Math.cos(e*RAD),o=1/(1-E2*(1-n*n)),l=Math.sqrt(o);this.kx=i*l*n,this.ky=i*l*o*(1-E2)}distance(e,i){const n=this.wrap(e[0]-i[0])*this.kx,o=(e[1]-i[1])*this.ky;return Math.sqrt(n*n+o*o)}pointOnLine(e,i){let n=1/0,o,l,c,u;for(let h=0;h<e.length-1;h++){let f=e[h][0],g=e[h][1],H=this.wrap(e[h+1][0]-f)*this.kx,Y=(e[h+1][1]-g)*this.ky,ee=0;(H!==0||Y!==0)&&(ee=(this.wrap(i[0]-f)*this.kx*H+(i[1]-g)*this.ky*Y)/(H*H+Y*Y),ee>1?(f=e[h+1][0],g=e[h+1][1]):ee>0&&(f+=H/this.kx*ee,g+=Y/this.ky*ee)),H=this.wrap(i[0]-f)*this.kx,Y=(i[1]-g)*this.ky;const te=H*H+Y*Y;te<n&&(n=te,o=f,l=g,c=h,u=ee)}return{point:[o,l],index:c,t:Math.max(0,Math.min(1,u))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}const MinPointsSize=100,MinLinePointsSize=50;function compareDistPair(s,e){return e[0]-s[0]}function getRangeSize(s){return s[1]-s[0]+1}function isRangeSafe(s,e){return s[1]>=s[0]&&s[1]<e}function splitRange(s,e){if(s[0]>s[1])return[null,null];const i=getRangeSize(s);if(e){if(i===2)return[s,null];const o=Math.floor(i/2);return[[s[0],s[0]+o],[s[0]+o,s[1]]]}if(i===1)return[s,null];const n=Math.floor(i/2)-1;return[[s[0],s[0]+n],[s[0]+n+1,s[1]]]}function getBBox(s,e){if(!isRangeSafe(e,s.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let n=e[0];n<=e[1];++n)updateBBox(i,s[n]);return i}function getPolygonBBox(s){const e=[1/0,1/0,-1/0,-1/0];for(const i of s)for(const n of i)updateBBox(e,n);return e}function isValidBBox(s){return s[0]!==-1/0&&s[1]!==-1/0&&s[2]!==1/0&&s[3]!==1/0}function bboxToBBoxDistance(s,e,i){if(!isValidBBox(s)||!isValidBBox(e))return NaN;let n=0,o=0;return s[2]<e[0]&&(n=e[0]-s[2]),s[0]>e[2]&&(n=s[0]-e[2]),s[1]>e[3]&&(o=s[1]-e[3]),s[3]<e[1]&&(o=e[1]-s[3]),i.distance([0,0],[n,o])}function pointToLineDistance(s,e,i){const n=i.pointOnLine(e,s);return i.distance(s,n.point)}function segmentToSegmentDistance(s,e,i,n,o){const l=Math.min(pointToLineDistance(s,[i,n],o),pointToLineDistance(e,[i,n],o)),c=Math.min(pointToLineDistance(i,[s,e],o),pointToLineDistance(n,[s,e],o));return Math.min(l,c)}function lineToLineDistance(s,e,i,n,o){if(!(isRangeSafe(e,s.length)&&isRangeSafe(n,i.length)))return 1/0;let c=1/0;for(let u=e[0];u<e[1];++u){const h=s[u],f=s[u+1];for(let g=n[0];g<n[1];++g){const H=i[g],Y=i[g+1];if(segmentIntersectSegment(h,f,H,Y))return 0;c=Math.min(c,segmentToSegmentDistance(h,f,H,Y,o))}}return c}function pointsToPointsDistance(s,e,i,n,o){if(!(isRangeSafe(e,s.length)&&isRangeSafe(n,i.length)))return NaN;let c=1/0;for(let u=e[0];u<=e[1];++u)for(let h=n[0];h<=n[1];++h)if(c=Math.min(c,o.distance(s[u],i[h])),c===0)return c;return c}function pointToPolygonDistance(s,e,i){if(pointWithinPolygon(s,e,!0))return 0;let n=1/0;for(const o of e){const l=o[0],c=o[o.length-1];if(l!==c&&(n=Math.min(n,pointToLineDistance(s,[c,l],i)),n===0))return n;const u=i.pointOnLine(o,s);if(n=Math.min(n,i.distance(s,u.point)),n===0)return n}return n}function lineToPolygonDistance(s,e,i,n){if(!isRangeSafe(e,s.length))return NaN;for(let l=e[0];l<=e[1];++l)if(pointWithinPolygon(s[l],i,!0))return 0;let o=1/0;for(let l=e[0];l<e[1];++l){const c=s[l],u=s[l+1];for(const h of i)for(let f=0,g=h.length,H=g-1;f<g;H=f++){const Y=h[H],ee=h[f];if(segmentIntersectSegment(c,u,Y,ee))return 0;o=Math.min(o,segmentToSegmentDistance(c,u,Y,ee,n))}}return o}function polygonIntersect(s,e){for(const i of s)for(const n of i)if(pointWithinPolygon(n,e,!0))return!0;return!1}function polygonToPolygonDistance(s,e,i,n=1/0){const o=getPolygonBBox(s),l=getPolygonBBox(e);if(n!==1/0&&bboxToBBoxDistance(o,l,i)>=n)return n;if(boxWithinBox(o,l)){if(polygonIntersect(s,e))return 0}else if(polygonIntersect(e,s))return 0;let c=1/0;for(const u of s)for(let h=0,f=u.length,g=f-1;h<f;g=h++){const H=u[g],Y=u[h];for(const ee of e)for(let te=0,xe=ee.length,ne=xe-1;te<xe;ne=te++){const et=ee[ne],tt=ee[te];if(segmentIntersectSegment(H,Y,et,tt))return 0;c=Math.min(c,segmentToSegmentDistance(H,Y,et,tt,i))}}return c}function updateQueue(s,e,i,n,o,l){if(!l)return;const c=bboxToBBoxDistance(getBBox(n,l),o,i);c<e&&s.push([c,l,[0,0]])}function updateQueueTwoSets(s,e,i,n,o,l,c){if(!l||!c)return;const u=bboxToBBoxDistance(getBBox(n,l),getBBox(o,c),i);u<e&&s.push([u,l,c])}function pointsToPolygonDistance(s,e,i,n,o=1/0){let l=Math.min(n.distance(s[0],i[0][0]),o);if(l===0)return l;const c=new TinyQueue([[0,[0,s.length-1],[0,0]]],compareDistPair),u=getPolygonBBox(i);for(;c.length>0;){const h=c.pop();if(h[0]>=l)continue;const f=h[1],g=e?MinLinePointsSize:MinPointsSize;if(getRangeSize(f)<=g){if(!isRangeSafe(f,s.length))return NaN;if(e){const H=lineToPolygonDistance(s,f,i,n);if(isNaN(H)||H===0)return H;l=Math.min(l,H)}else for(let H=f[0];H<=f[1];++H){const Y=pointToPolygonDistance(s[H],i,n);if(l=Math.min(l,Y),l===0)return 0}}else{const H=splitRange(f,e);updateQueue(c,l,n,s,u,H[0]),updateQueue(c,l,n,s,u,H[1])}}return l}function pointSetToPointSetDistance(s,e,i,n,o,l=1/0){let c=Math.min(l,o.distance(s[0],i[0]));if(c===0)return c;const u=new TinyQueue([[0,[0,s.length-1],[0,i.length-1]]],compareDistPair);for(;u.length>0;){const h=u.pop();if(h[0]>=c)continue;const f=h[1],g=h[2],H=e?MinLinePointsSize:MinPointsSize,Y=n?MinLinePointsSize:MinPointsSize;if(getRangeSize(f)<=H&&getRangeSize(g)<=Y){if(!isRangeSafe(f,s.length)&&isRangeSafe(g,i.length))return NaN;let ee;if(e&&n)ee=lineToLineDistance(s,f,i,g,o),c=Math.min(c,ee);else if(e&&!n){const te=s.slice(f[0],f[1]+1);for(let xe=g[0];xe<=g[1];++xe)if(ee=pointToLineDistance(i[xe],te,o),c=Math.min(c,ee),c===0)return c}else if(!e&&n){const te=i.slice(g[0],g[1]+1);for(let xe=f[0];xe<=f[1];++xe)if(ee=pointToLineDistance(s[xe],te,o),c=Math.min(c,ee),c===0)return c}else ee=pointsToPointsDistance(s,f,i,g,o),c=Math.min(c,ee)}else{const ee=splitRange(f,e),te=splitRange(g,n);updateQueueTwoSets(u,c,o,s,i,ee[0],te[0]),updateQueueTwoSets(u,c,o,s,i,ee[0],te[1]),updateQueueTwoSets(u,c,o,s,i,ee[1],te[0]),updateQueueTwoSets(u,c,o,s,i,ee[1],te[1])}}return c}function pointToGeometryDistance(s,e){const i=s.geometry(),n=i.flat().map(c=>getLngLatFromTileCoord([c.x,c.y],s.canonical));if(i.length===0)return NaN;const o=new CheapRuler(n[0][1]);let l=1/0;for(const c of e){switch(c.type){case"Point":l=Math.min(l,pointSetToPointSetDistance(n,!1,[c.coordinates],!1,o,l));break;case"LineString":l=Math.min(l,pointSetToPointSetDistance(n,!1,c.coordinates,!0,o,l));break;case"Polygon":l=Math.min(l,pointsToPolygonDistance(n,!1,c.coordinates,o,l));break}if(l===0)return l}return l}function lineStringToGeometryDistance(s,e){const i=s.geometry(),n=i.flat().map(c=>getLngLatFromTileCoord([c.x,c.y],s.canonical));if(i.length===0)return NaN;const o=new CheapRuler(n[0][1]);let l=1/0;for(const c of e){switch(c.type){case"Point":l=Math.min(l,pointSetToPointSetDistance(n,!0,[c.coordinates],!1,o,l));break;case"LineString":l=Math.min(l,pointSetToPointSetDistance(n,!0,c.coordinates,!0,o,l));break;case"Polygon":l=Math.min(l,pointsToPolygonDistance(n,!0,c.coordinates,o,l));break}if(l===0)return l}return l}function polygonToGeometryDistance(s,e){const i=s.geometry();if(i.length===0||i[0].length===0)return NaN;const n=classifyRings(i).map(c=>c.map(u=>u.map(h=>getLngLatFromTileCoord([h.x,h.y],s.canonical)))),o=new CheapRuler(n[0][0][0][1]);let l=1/0;for(const c of e)for(const u of n){switch(c.type){case"Point":l=Math.min(l,pointsToPolygonDistance([c.coordinates],!1,u,o,l));break;case"LineString":l=Math.min(l,pointsToPolygonDistance(c.coordinates,!0,u,o,l));break;case"Polygon":l=Math.min(l,polygonToPolygonDistance(u,c.coordinates,o,l));break}if(l===0)return l}return l}function toSimpleGeometry(s){return s.type==="MultiPolygon"?s.coordinates.map(e=>({type:"Polygon",coordinates:e})):s.type==="MultiLineString"?s.coordinates.map(e=>({type:"LineString",coordinates:e})):s.type==="MultiPoint"?s.coordinates.map(e=>({type:"Point",coordinates:e})):[s]}class Distance{constructor(e,i){this.type=NumberType,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(isValue(e[1])){const n=e[1];if(n.type==="FeatureCollection")return new Distance(n,n.features.map(o=>toSimpleGeometry(o.geometry)).flat());if(n.type==="Feature")return new Distance(n,toSimpleGeometry(n.geometry));if("type"in n&&"coordinates"in n)return new Distance(n,toSimpleGeometry(n))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return pointToGeometryDistance(e,this.geometries);if(e.geometryType()==="LineString")return lineStringToGeometryDistance(e,this.geometries);if(e.geometryType()==="Polygon")return polygonToGeometryDistance(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class GlobalState{constructor(e){this.type=ValueType,this.key=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=e[1];return n==null?i.error("Global state property must be defined."):typeof n!="string"?i.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new GlobalState(n)}evaluate(e){var i;const n=(i=e.globals)===null||i===void 0?void 0:i.globalState;return!n||Object.keys(n).length===0?null:getOwn(n,this.key)}eachChild(){}outputDefined(){return!1}}const expressions$1={"==":Equals,"!=":NotEquals,">":GreaterThan,"<":LessThan,">=":GreaterThanOrEqual,"<=":LessThanOrEqual,array:Assertion,at:At,boolean:Assertion,case:Case,coalesce:Coalesce,collator:CollatorExpression,format:FormatExpression,image:ImageExpression,in:In,"index-of":IndexOf,interpolate:Interpolate,"interpolate-hcl":Interpolate,"interpolate-lab":Interpolate,length:Length,let:Let,literal:Literal,match:Match,number:Assertion,"number-format":NumberFormat,object:Assertion,slice:Slice,step:Step,string:Assertion,"to-boolean":Coercion,"to-color":Coercion,"to-number":Coercion,"to-string":Coercion,var:Var,within:Within,distance:Distance,"global-state":GlobalState};class CompoundExpression{constructor(e,i,n,o){this.name=e,this.type=i,this._evaluate=n,this.args=o}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,i){const n=e[0],o=CompoundExpression.definitions[n];if(!o)return i.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const l=Array.isArray(o)?o[0]:o.type,c=Array.isArray(o)?[[o[1],o[2]]]:o.overloads,u=c.filter(([f])=>!Array.isArray(f)||f.length===e.length-1);let h=null;for(const[f,g]of u){h=new ParsingContext(i.registry,isExpressionConstant,i.path,null,i.scope);const H=[];let Y=!1;for(let ee=1;ee<e.length;ee++){const te=e[ee],xe=Array.isArray(f)?f[ee-1]:f.type,ne=h.parse(te,1+H.length,xe);if(!ne){Y=!0;break}H.push(ne)}if(!Y){if(Array.isArray(f)&&f.length!==H.length){h.error(`Expected ${f.length} arguments, but found ${H.length} instead.`);continue}for(let ee=0;ee<H.length;ee++){const te=Array.isArray(f)?f[ee]:f.type,xe=H[ee];h.concat(ee+1).checkSubtype(te,xe.type)}if(h.errors.length===0)return new CompoundExpression(n,l,g,H)}}if(u.length===1)i.errors.push(...h.errors);else{const g=(u.length?u:c).map(([Y])=>stringifySignature(Y)).join(" | "),H=[];for(let Y=1;Y<e.length;Y++){const ee=i.parse(e[Y],1+H.length);if(!ee)return null;H.push(typeToString(ee.type))}i.error(`Expected arguments of type ${g}, but found (${H.join(", ")}) instead.`)}return null}static register(e,i){CompoundExpression.definitions=i;for(const n in i)e[n]=CompoundExpression}}function rgba(s,[e,i,n,o]){e=e.evaluate(s),i=i.evaluate(s),n=n.evaluate(s);const l=o?o.evaluate(s):1,c=validateRGBA(e,i,n,l);if(c)throw new RuntimeError(c);return new Color(e/255,i/255,n/255,l,!1)}function has(s,e){return s in e}function get$1(s,e){const i=e[s];return typeof i>"u"?null:i}function binarySearch(s,e,i,n){for(;i<=n;){const o=i+n>>1;if(e[o]===s)return!0;e[o]>s?n=o-1:i=o+1}return!1}function varargs(s){return{type:s}}CompoundExpression.register(expressions$1,{error:[ErrorType,[StringType],(s,[e])=>{throw new RuntimeError(e.evaluate(s))}],typeof:[StringType,[ValueType],(s,[e])=>typeToString(typeOf(e.evaluate(s)))],"to-rgba":[array(NumberType,4),[ColorType],(s,[e])=>{const[i,n,o,l]=e.evaluate(s).rgb;return[i*255,n*255,o*255,l]}],rgb:[ColorType,[NumberType,NumberType,NumberType],rgba],rgba:[ColorType,[NumberType,NumberType,NumberType,NumberType],rgba],has:{type:BooleanType,overloads:[[[StringType],(s,[e])=>has(e.evaluate(s),s.properties())],[[StringType,ObjectType],(s,[e,i])=>has(e.evaluate(s),i.evaluate(s))]]},get:{type:ValueType,overloads:[[[StringType],(s,[e])=>get$1(e.evaluate(s),s.properties())],[[StringType,ObjectType],(s,[e,i])=>get$1(e.evaluate(s),i.evaluate(s))]]},"feature-state":[ValueType,[StringType],(s,[e])=>get$1(e.evaluate(s),s.featureState||{})],properties:[ObjectType,[],s=>s.properties()],"geometry-type":[StringType,[],s=>s.geometryType()],id:[ValueType,[],s=>s.id()],zoom:[NumberType,[],s=>s.globals.zoom],"heatmap-density":[NumberType,[],s=>s.globals.heatmapDensity||0],elevation:[NumberType,[],s=>s.globals.elevation||0],"line-progress":[NumberType,[],s=>s.globals.lineProgress||0],accumulated:[ValueType,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[NumberType,varargs(NumberType),(s,e)=>{let i=0;for(const n of e)i+=n.evaluate(s);return i}],"*":[NumberType,varargs(NumberType),(s,e)=>{let i=1;for(const n of e)i*=n.evaluate(s);return i}],"-":{type:NumberType,overloads:[[[NumberType,NumberType],(s,[e,i])=>e.evaluate(s)-i.evaluate(s)],[[NumberType],(s,[e])=>-e.evaluate(s)]]},"/":[NumberType,[NumberType,NumberType],(s,[e,i])=>e.evaluate(s)/i.evaluate(s)],"%":[NumberType,[NumberType,NumberType],(s,[e,i])=>e.evaluate(s)%i.evaluate(s)],ln2:[NumberType,[],()=>Math.LN2],pi:[NumberType,[],()=>Math.PI],e:[NumberType,[],()=>Math.E],"^":[NumberType,[NumberType,NumberType],(s,[e,i])=>Math.pow(e.evaluate(s),i.evaluate(s))],sqrt:[NumberType,[NumberType],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[NumberType,[NumberType],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[NumberType,[NumberType],(s,[e])=>Math.log(e.evaluate(s))],log2:[NumberType,[NumberType],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[NumberType,[NumberType],(s,[e])=>Math.sin(e.evaluate(s))],cos:[NumberType,[NumberType],(s,[e])=>Math.cos(e.evaluate(s))],tan:[NumberType,[NumberType],(s,[e])=>Math.tan(e.evaluate(s))],asin:[NumberType,[NumberType],(s,[e])=>Math.asin(e.evaluate(s))],acos:[NumberType,[NumberType],(s,[e])=>Math.acos(e.evaluate(s))],atan:[NumberType,[NumberType],(s,[e])=>Math.atan(e.evaluate(s))],min:[NumberType,varargs(NumberType),(s,e)=>Math.min(...e.map(i=>i.evaluate(s)))],max:[NumberType,varargs(NumberType),(s,e)=>Math.max(...e.map(i=>i.evaluate(s)))],abs:[NumberType,[NumberType],(s,[e])=>Math.abs(e.evaluate(s))],round:[NumberType,[NumberType],(s,[e])=>{const i=e.evaluate(s);return i<0?-Math.round(-i):Math.round(i)}],floor:[NumberType,[NumberType],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[NumberType,[NumberType],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[BooleanType,[StringType,ValueType],(s,[e,i])=>s.properties()[e.value]===i.value],"filter-id-==":[BooleanType,[ValueType],(s,[e])=>s.id()===e.value],"filter-type-==":[BooleanType,[StringType],(s,[e])=>s.geometryType()===e.value],"filter-<":[BooleanType,[StringType,ValueType],(s,[e,i])=>{const n=s.properties()[e.value],o=i.value;return typeof n==typeof o&&n<o}],"filter-id-<":[BooleanType,[ValueType],(s,[e])=>{const i=s.id(),n=e.value;return typeof i==typeof n&&i<n}],"filter->":[BooleanType,[StringType,ValueType],(s,[e,i])=>{const n=s.properties()[e.value],o=i.value;return typeof n==typeof o&&n>o}],"filter-id->":[BooleanType,[ValueType],(s,[e])=>{const i=s.id(),n=e.value;return typeof i==typeof n&&i>n}],"filter-<=":[BooleanType,[StringType,ValueType],(s,[e,i])=>{const n=s.properties()[e.value],o=i.value;return typeof n==typeof o&&n<=o}],"filter-id-<=":[BooleanType,[ValueType],(s,[e])=>{const i=s.id(),n=e.value;return typeof i==typeof n&&i<=n}],"filter->=":[BooleanType,[StringType,ValueType],(s,[e,i])=>{const n=s.properties()[e.value],o=i.value;return typeof n==typeof o&&n>=o}],"filter-id->=":[BooleanType,[ValueType],(s,[e])=>{const i=s.id(),n=e.value;return typeof i==typeof n&&i>=n}],"filter-has":[BooleanType,[ValueType],(s,[e])=>e.value in s.properties()],"filter-has-id":[BooleanType,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[BooleanType,[array(StringType)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[BooleanType,[array(ValueType)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[BooleanType,[StringType,array(ValueType)],(s,[e,i])=>i.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[BooleanType,[StringType,array(ValueType)],(s,[e,i])=>binarySearch(s.properties()[e.value],i.value,0,i.value.length-1)],all:{type:BooleanType,overloads:[[[BooleanType,BooleanType],(s,[e,i])=>e.evaluate(s)&&i.evaluate(s)],[varargs(BooleanType),(s,e)=>{for(const i of e)if(!i.evaluate(s))return!1;return!0}]]},any:{type:BooleanType,overloads:[[[BooleanType,BooleanType],(s,[e,i])=>e.evaluate(s)||i.evaluate(s)],[varargs(BooleanType),(s,e)=>{for(const i of e)if(i.evaluate(s))return!0;return!1}]]},"!":[BooleanType,[BooleanType],(s,[e])=>!e.evaluate(s)],"is-supported-script":[BooleanType,[StringType],(s,[e])=>{const i=s.globals&&s.globals.isSupportedScript;return i?i(e.evaluate(s)):!0}],upcase:[StringType,[StringType],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[StringType,[StringType],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[StringType,varargs(ValueType),(s,e)=>e.map(i=>valueToString(i.evaluate(s))).join("")],"resolved-locale":[StringType,[CollatorType],(s,[e])=>e.evaluate(s).resolvedLocale()]});function stringifySignature(s){return Array.isArray(s)?`(${s.map(typeToString).join(", ")})`:`(${typeToString(s.type)}...)`}function isExpressionConstant(s){if(s instanceof Var)return isExpressionConstant(s.boundExpression);if(s instanceof CompoundExpression&&s.name==="error")return!1;if(s instanceof CollatorExpression)return!1;if(s instanceof Within)return!1;if(s instanceof Distance)return!1;if(s instanceof GlobalState)return!1;const e=s instanceof Coercion||s instanceof Assertion;let i=!0;return s.eachChild(n=>{e?i=i&&isExpressionConstant(n):i=i&&n instanceof Literal}),i?isFeatureConstant(s)&&isGlobalPropertyConstant(s,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function isFeatureConstant(s){if(s instanceof CompoundExpression){if(s.name==="get"&&s.args.length===1)return!1;if(s.name==="feature-state")return!1;if(s.name==="has"&&s.args.length===1)return!1;if(s.name==="properties"||s.name==="geometry-type"||s.name==="id")return!1;if(/^filter-/.test(s.name))return!1}if(s instanceof Within||s instanceof Distance)return!1;let e=!0;return s.eachChild(i=>{e&&!isFeatureConstant(i)&&(e=!1)}),e}function isStateConstant(s){if(s instanceof CompoundExpression&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(i=>{e&&!isStateConstant(i)&&(e=!1)}),e}function isGlobalPropertyConstant(s,e){if(s instanceof CompoundExpression&&e.indexOf(s.name)>=0)return!1;let i=!0;return s.eachChild(n=>{i&&!isGlobalPropertyConstant(n,e)&&(i=!1)}),i}function success(s){return{result:"success",value:s}}function error(s){return{result:"error",value:s}}function supportsPropertyExpression(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function supportsZoomExpression(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function supportsInterpolation(s){return!!s.expression&&s.expression.interpolated}function isFunction$1(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)&&typeOf(s)===ObjectType}class StyleExpression{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new EvaluationContext,this._defaultValue=i?getDefaultValue(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,n,o,l,c){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=n,this._evaluator.canonical=o,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=c,this.expression.evaluate(this._evaluator)}evaluate(e,i,n,o,l,c){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=n||null,this._evaluator.canonical=o,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=c||null;try{const u=this.expression.evaluate(this._evaluator);if(u==null||typeof u=="number"&&u!==u)return this._defaultValue;if(this._enumValues&&!(u in this._enumValues))throw new RuntimeError(`Expected value to be one of ${Object.keys(this._enumValues).map(h=>JSON.stringify(h)).join(", ")}, but found ${JSON.stringify(u)} instead.`);return u}catch(u){return this._warningHistory[u.message]||(this._warningHistory[u.message]=!0,typeof console<"u"&&console.warn(u.message)),this._defaultValue}}}function isExpression(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in expressions$1}function createExpression(s,e){const i=new ParsingContext(expressions$1,isExpressionConstant,[],e?getExpectedType(e):void 0),n=i.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?success(new StyleExpression(n,e)):error(i.errors)}class ZoomConstantExpression{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!isStateConstant(i.expression),this.globalStateRefs=findGlobalStateRefs(i.expression)}evaluateWithoutErrorHandling(e,i,n,o,l,c){return this._styleExpression.evaluateWithoutErrorHandling(e,i,n,o,l,c)}evaluate(e,i,n,o,l,c){return this._styleExpression.evaluate(e,i,n,o,l,c)}}class ZoomDependentExpression{constructor(e,i,n,o){this.kind=e,this.zoomStops=n,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!isStateConstant(i.expression),this.globalStateRefs=findGlobalStateRefs(i.expression),this.interpolationType=o}evaluateWithoutErrorHandling(e,i,n,o,l,c){return this._styleExpression.evaluateWithoutErrorHandling(e,i,n,o,l,c)}evaluate(e,i,n,o,l,c){return this._styleExpression.evaluate(e,i,n,o,l,c)}interpolationFactor(e,i,n){return this.interpolationType?Interpolate.interpolationFactor(this.interpolationType,e,i,n):0}}function createPropertyExpression(s,e){const i=createExpression(s,e);if(i.result==="error")return i;const n=i.value.expression,o=isFeatureConstant(n);if(!o&&!supportsPropertyExpression(e))return error([new ExpressionParsingError("","data expressions not supported")]);const l=isGlobalPropertyConstant(n,["zoom"]);if(!l&&!supportsZoomExpression(e))return error([new ExpressionParsingError("","zoom expressions not supported")]);const c=findZoomCurve(n);if(!c&&!l)return error([new ExpressionParsingError("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(c instanceof ExpressionParsingError)return error([c]);if(c instanceof Interpolate&&!supportsInterpolation(e))return error([new ExpressionParsingError("",'"interpolate" expressions cannot be used with this property')]);if(!c)return success(o?new ZoomConstantExpression("constant",i.value):new ZoomConstantExpression("source",i.value));const u=c instanceof Interpolate?c.interpolation:void 0;return success(o?new ZoomDependentExpression("camera",i.value,c.labels,u):new ZoomDependentExpression("composite",i.value,c.labels,u))}function findZoomCurve(s){let e=null;if(s instanceof Let)e=findZoomCurve(s.result);else if(s instanceof Coalesce){for(const i of s.args)if(e=findZoomCurve(i),e)break}else(s instanceof Step||s instanceof Interpolate)&&s.input instanceof CompoundExpression&&s.input.name==="zoom"&&(e=s);return e instanceof ExpressionParsingError||s.eachChild(i=>{const n=findZoomCurve(i);n instanceof ExpressionParsingError?e=n:!e&&n?e=new ExpressionParsingError("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new ExpressionParsingError("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function findGlobalStateRefs(s,e=new Set){return s instanceof GlobalState&&e.add(s.key),s.eachChild(i=>{findGlobalStateRefs(i,e)}),e}function getExpectedType(s){const e={color:ColorType,string:StringType,number:NumberType,enum:StringType,boolean:BooleanType,formatted:FormattedType,padding:PaddingType,numberArray:NumberArrayType,colorArray:ColorArrayType,projectionDefinition:ProjectionDefinitionType,resolvedImage:ResolvedImageType,variableAnchorOffsetCollection:VariableAnchorOffsetCollectionType};return s.type==="array"?array(e[s.value]||ValueType,s.length):e[s.type]}function getDefaultValue(s){if(s.type==="color"&&isFunction$1(s.default))return new Color(0,0,0,0);switch(s.type){case"color":return Color.parse(s.default)||null;case"padding":return Padding.parse(s.default)||null;case"numberArray":return NumberArray.parse(s.default)||null;case"colorArray":return ColorArray.parse(s.default)||null;case"variableAnchorOffsetCollection":return VariableAnchorOffsetCollection.parse(s.default)||null;case"projectionDefinition":return ProjectionDefinition.parse(s.default)||null;default:return s.default===void 0?null:s.default}}function isExpressionFilter(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!isExpressionFilter(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const filterSpec={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function featureFilter(s){if(s==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};isExpressionFilter(s)||(s=convertFilter$1(s));const e=createExpression(s,filterSpec);if(e.result==="error")throw new Error(e.value.map(i=>`${i.key}: ${i.message}`).join(", "));{const i=geometryNeeded(s);return{filter:(n,o,l)=>e.value.evaluate(n,o,{},l),needGeometry:i,getGlobalStateRefs:()=>findGlobalStateRefs(e.value.expression)}}}function compare(s,e){return s<e?-1:s>e?1:0}function geometryNeeded(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let e=1;e<s.length;e++)if(geometryNeeded(s[e]))return!0;return!1}function convertFilter$1(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?convertComparisonOp$1(s[1],s[2],"=="):e==="!="?convertNegation(convertComparisonOp$1(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?convertComparisonOp$1(s[1],s[2],e):e==="any"?convertDisjunctionOp(s.slice(1)):e==="all"?["all"].concat(s.slice(1).map(convertFilter$1)):e==="none"?["all"].concat(s.slice(1).map(convertFilter$1).map(convertNegation)):e==="in"?convertInOp$1(s[1],s.slice(2)):e==="!in"?convertNegation(convertInOp$1(s[1],s.slice(2))):e==="has"?convertHasOp$1(s[1]):e==="!has"?convertNegation(convertHasOp$1(s[1])):!0}function convertComparisonOp$1(s,e,i){switch(s){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,s,e]}}function convertDisjunctionOp(s){return["any"].concat(s.map(convertFilter$1))}function convertInOp$1(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",s,["literal",e.sort(compare)]]:["filter-in-small",s,["literal",e]]}}function convertHasOp$1(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function convertNegation(s){return["!",s]}function convertLiteral(s){return typeof s=="object"?["literal",s]:s}function convertFunction(s,e){let i=s.stops;if(!i)return convertIdentityFunction(s,e);const n=i&&typeof i[0][0]=="object",o=n||s.property!==void 0,l=n||!o;return i=i.map(c=>!o&&e.tokens&&typeof c[1]=="string"?[c[0],convertTokenString(c[1])]:[c[0],convertLiteral(c[1])]),n?convertZoomAndPropertyFunction(s,e,i):l?convertZoomFunction(s,e,i):convertPropertyFunction(s,e,i)}function convertIdentityFunction(s,e){const i=["get",s.property];if(s.default===void 0)return e.type==="string"?["string",i]:i;if(e.type==="enum")return["match",i,Object.keys(e.values),i,s.default];{const n=[e.type==="color"?"to-color":e.type,i,convertLiteral(s.default)];return e.type==="array"&&n.splice(1,0,e.value,e.length||null),n}}function getInterpolateOperator(s){switch(s.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function convertZoomAndPropertyFunction(s,e,i){const n={},o={},l=[];for(let u=0;u<i.length;u++){const h=i[u],f=h[0].zoom;n[f]===void 0&&(n[f]={zoom:f,type:s.type,property:s.property,default:s.default},o[f]=[],l.push(f)),o[f].push([h[0].value,h[1]])}if(getFunctionType({},e)==="exponential"){const u=[getInterpolateOperator(s),["linear"],["zoom"]];for(const h of l){const f=convertPropertyFunction(n[h],e,o[h]);appendStopPair(u,h,f,!1)}return u}else{const u=["step",["zoom"]];for(const h of l){const f=convertPropertyFunction(n[h],e,o[h]);appendStopPair(u,h,f,!0)}return fixupDegenerateStepCurve(u),u}}function coalesce(s,e){if(s!==void 0)return s;if(e!==void 0)return e}function getFallback(s,e){const i=convertLiteral(coalesce(s.default,e.default));return i===void 0&&e.type==="resolvedImage"?"":i}function convertPropertyFunction(s,e,i){const n=getFunctionType(s,e),o=["get",s.property];if(n==="categorical"&&typeof i[0][0]=="boolean"){const l=["case"];for(const c of i)l.push(["==",o,c[0]],c[1]);return l.push(getFallback(s,e)),l}else if(n==="categorical"){const l=["match",o];for(const c of i)appendStopPair(l,c[0],c[1],!1);return l.push(getFallback(s,e)),l}else if(n==="interval"){const l=["step",["number",o]];for(const c of i)appendStopPair(l,c[0],c[1],!0);return fixupDegenerateStepCurve(l),s.default===void 0?l:["case",["==",["typeof",o],"number"],l,convertLiteral(s.default)]}else if(n==="exponential"){const l=s.base!==void 0?s.base:1,c=[getInterpolateOperator(s),l===1?["linear"]:["exponential",l],["number",o]];for(const u of i)appendStopPair(c,u[0],u[1],!1);return s.default===void 0?c:["case",["==",["typeof",o],"number"],c,convertLiteral(s.default)]}else throw new Error(`Unknown property function type ${n}`)}function convertZoomFunction(s,e,i,n=["zoom"]){const o=getFunctionType(s,e);let l,c=!1;if(o==="interval")l=["step",n],c=!0;else if(o==="exponential"){const u=s.base!==void 0?s.base:1;l=[getInterpolateOperator(s),u===1?["linear"]:["exponential",u],n]}else throw new Error(`Unknown zoom function type "${o}"`);for(const u of i)appendStopPair(l,u[0],u[1],c);return fixupDegenerateStepCurve(l),l}function fixupDegenerateStepCurve(s){s[0]==="step"&&s.length===3&&(s.push(0),s.push(s[3]))}function appendStopPair(s,e,i,n){s.length>3&&e===s[s.length-2]||(n&&s.length===2||s.push(e),s.push(i))}function getFunctionType(s,e){return s.type?s.type:e.expression.interpolated?"exponential":"interval"}function convertTokenString(s){const e=["concat"],i=/{([^{}]+)}/g;let n=0;for(let o=i.exec(s);o!==null;o=i.exec(s)){const l=s.slice(n,i.lastIndex-o[0].length);n=i.lastIndex,l.length>0&&e.push(l),e.push(["get",o[1]])}if(e.length===1)return s;if(n<s.length)e.push(s.slice(n));else if(e.length===2)return["to-string",e[1]];return e}const v8=v8Spec;var fontWeights={thin:100,hairline:100,"ultra-light":200,"extra-light":200,light:300,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,"extra-bold":800,"ultra-bold":800,heavy:900,black:900,"heavy-black":900,fat:900,poster:900,"ultra-black":950,"extra-black":950},sp=" ",italicRE=/(italic|oblique)$/i,fontCache={};function mb2css(s,e,i){var n=fontCache[s];if(!n){Array.isArray(s)||(s=[s]);for(var o=400,l="normal",c=[],u,h,f=0,g=s.length;f<g;++f){var H=s[f],Y=H.split(" "),ee=Y[Y.length-1].toLowerCase();ee=="normal"||ee=="italic"||ee=="oblique"?(l=h?l:ee,h=!0,Y.pop(),ee=Y[Y.length-1].toLowerCase()):italicRE.test(ee)&&(ee=ee.replace(italicRE,""),l=h?l:Y[Y.length-1].replace(ee,""),h=!0);for(var te in fontWeights){var xe=Y.length>1?Y[Y.length-2].toLowerCase():"";if(ee==te||ee==te.replace("-","")||xe+"-"+ee==te){o=u?o:fontWeights[te],Y.pop(),xe&&te.startsWith(xe)&&Y.pop();break}}!u&&typeof ee=="number"&&(o=ee,u=!0);var ne=Y.join(sp).replace("Klokantech Noto Sans","Noto Sans").replace("DIN Pro","Barlow").replace("Arial Unicode MS","Arial");ne.indexOf(sp)!==-1&&(ne='"'+ne+'"'),c.push(ne)}n=fontCache[s]=[l,o,c]}return n[0]+sp+n[1]+sp+e+"px"+(i?"/"+i:"")+sp+n[2]}const PointerEventType={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"};class MapBrowserEventHandler extends Target{constructor(e,i){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=i===void 0?1:i,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=listen(n,PointerEventType.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=listen(n,PointerEventType.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(EventType.TOUCHMOVE,this.boundHandleTouchMove_,PASSIVE_EVENT_LISTENERS?{passive:!1}:!1)}emulateClick_(e){let i=new MapBrowserEvent(MapBrowserEventType.CLICK,this.map_,e);this.dispatchEvent(i),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,i=new MapBrowserEvent(MapBrowserEventType.DBLCLICK,this.map_,e),this.dispatchEvent(i)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new MapBrowserEvent(MapBrowserEventType.SINGLECLICK,this.map_,e);this.dispatchEvent(n)},250)}updateActivePointers_(e){const i=e,n=i.pointerId;if(i.type==MapBrowserEventType.POINTERUP||i.type==MapBrowserEventType.POINTERCANCEL){delete this.trackedTouches_[n];for(const o in this.trackedTouches_)if(this.trackedTouches_[o].target!==i.target){delete this.trackedTouches_[o];break}}else(i.type==MapBrowserEventType.POINTERDOWN||i.type==MapBrowserEventType.POINTERMOVE)&&(this.trackedTouches_[n]=i);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const i=new MapBrowserEvent(MapBrowserEventType.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(i),this.emulateClicks_&&!i.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const i=new MapBrowserEvent(MapBrowserEventType.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(i),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(listen(n,MapBrowserEventType.POINTERMOVE,this.handlePointerMove_,this),listen(n,MapBrowserEventType.POINTERUP,this.handlePointerUp_,this),listen(this.element_,MapBrowserEventType.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(listen(this.element_.getRootNode(),MapBrowserEventType.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const i=new MapBrowserEvent(MapBrowserEventType.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(i)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const i=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new MapBrowserEvent(MapBrowserEventType.POINTERMOVE,this.map_,e,i))}handleTouchMove_(e){const i=this.originalPointerMoveEvent_;(!i||i.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(unlistenByKey(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(EventType.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(unlistenByKey(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const MapProperty={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},DROP=1/0;class PriorityQueue{constructor(e,i){this.priorityFunction_=e,this.keyFunction_=i,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,clear$1(this.queuedElements_)}dequeue(){const e=this.elements_,i=this.priorities_,n=e[0];e.length==1?(e.length=0,i.length=0):(e[0]=e.pop(),i[0]=i.pop(),this.siftUp_(0));const o=this.keyFunction_(n);return delete this.queuedElements_[o],n}enqueue(e){assert(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const i=this.priorityFunction_(e);return i!=DROP?(this.elements_.push(e),this.priorities_.push(i),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const i=this.elements_,n=this.priorities_,o=i.length,l=i[e],c=n[e],u=e;for(;e<o>>1;){const h=this.getLeftChildIndex_(e),f=this.getRightChildIndex_(e),g=f<o&&n[f]<n[h]?f:h;i[e]=i[g],n[e]=n[g],e=g}i[e]=l,n[e]=c,this.siftDown_(u,e)}siftDown_(e,i){const n=this.elements_,o=this.priorities_,l=n[i],c=o[i];for(;i>e;){const u=this.getParentIndex_(i);if(o[u]>c)n[i]=n[u],o[i]=o[u],i=u;else break}n[i]=l,o[i]=c}reprioritize(){const e=this.priorityFunction_,i=this.elements_,n=this.priorities_;let o=0;const l=i.length;let c,u,h;for(u=0;u<l;++u)c=i[u],h=e(c),h==DROP?delete this.queuedElements_[this.keyFunction_(c)]:(n[o]=h,i[o++]=c);i.length=o,n.length=o,this.heapify_()}}class TileQueue extends PriorityQueue{constructor(e,i){super(n=>e.apply(null,n),n=>n[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=i,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const i=super.enqueue(e);return i&&e[0].addEventListener(EventType.CHANGE,this.boundHandleTileChange_),i}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const i=e.target,n=i.getState();if(n===TileState.LOADED||n===TileState.ERROR||n===TileState.EMPTY){n!==TileState.ERROR&&i.removeEventListener(EventType.CHANGE,this.boundHandleTileChange_);const o=i.getKey();o in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[o],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,i){let n=0;for(;this.tilesLoading_<e&&n<i&&this.getCount()>0;){const o=this.dequeue()[0],l=o.getKey();o.getState()===TileState.IDLE&&!(l in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[l]=!0,++this.tilesLoading_,++n,o.load())}}}function getTilePriority(s,e,i,n,o){if(!s||!(i in s.wantedTiles)||!s.wantedTiles[i][e.getKey()])return DROP;const l=s.viewState.center,c=n[0]-l[0],u=n[1]-l[1];return 65536*Math.log(o)+Math.sqrt(c*c+u*u)/o}class Attribution extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=e.attributions;const i=e.className!==void 0?e.className:"ol-attribution",n=e.tipLabel!==void 0?e.tipLabel:"Attributions",o=e.expandClassName!==void 0?e.expandClassName:i+"-expand",l=e.collapseLabel!==void 0?e.collapseLabel:"",c=e.collapseClassName!==void 0?e.collapseClassName:i+"-collapse";typeof l=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=l,this.collapseLabel_.className=c):this.collapseLabel_=l;const u=e.label!==void 0?e.label:"i";typeof u=="string"?(this.label_=document.createElement("span"),this.label_.textContent=u,this.label_.className=o):this.label_=u;const h=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(h),this.toggleButton_.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1);const f=i+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" "+CLASS_COLLAPSED:"")+(this.collapsible_?"":" ol-uncollapsible"),g=this.element;g.className=f,g.appendChild(this.toggleButton_),g.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const i=this.getMap().getAllLayers(),n=new Set(i.flatMap(o=>o.getAttributions(e)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(o=>n.add(o)):n.add(this.attributions_)),!this.overrideCollapsible_){const o=!i.some(l=>{var c;return((c=l.getSource())==null?void 0:c.getAttributionsCollapsible())===!1});this.setCollapsible(o)}return Array.from(n)}async updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const i=await Promise.all(this.collectSourceAttributions_(e).map(o=>toPromise(()=>o))),n=i.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!equals(i,this.renderedAttributions_)){removeChildren(this.ulElement_);for(let o=0,l=i.length;o<l;++o){const c=document.createElement("li");c.innerHTML=i[o],this.ulElement_.appendChild(c)}this.renderedAttributions_=i}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(CLASS_COLLAPSED),this.collapsed_?replaceNode(this.collapseLabel_,this.label_):replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class Rotate extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const i=e.className!==void 0?e.className:"ol-rotate",n=e.label!==void 0?e.label:"",o=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=o,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(o));const l=e.tipLabel?e.tipLabel:"Reset rotation",c=document.createElement("button");c.className=i+"-reset",c.setAttribute("type","button"),c.title=l,c.appendChild(this.label_),c.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1);const u=i+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,h=this.element;h.className=u,h.appendChild(c),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(CLASS_HIDDEN)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const i=this.getMap().getView();if(!i)return;const n=i.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?i.animate({rotation:0,duration:this.duration_,easing:easeOut}):i.setRotation(0))}render(e){const i=e.frameState;if(!i)return;const n=i.viewState.rotation;if(n!=this.rotation_){const o="rotate("+n+"rad)";if(this.autoHide_){const l=this.element.classList.contains(CLASS_HIDDEN);!l&&n===0?this.element.classList.add(CLASS_HIDDEN):l&&n!==0&&this.element.classList.remove(CLASS_HIDDEN)}this.label_.style.transform=o}this.rotation_=n}}class Zoom extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const i=e.className!==void 0?e.className:"ol-zoom",n=e.delta!==void 0?e.delta:1,o=e.zoomInClassName!==void 0?e.zoomInClassName:i+"-in",l=e.zoomOutClassName!==void 0?e.zoomOutClassName:i+"-out",c=e.zoomInLabel!==void 0?e.zoomInLabel:"+",u=e.zoomOutLabel!==void 0?e.zoomOutLabel:"",h=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",f=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",g=document.createElement("button");g.className=o,g.setAttribute("type","button"),g.title=h,g.appendChild(typeof c=="string"?document.createTextNode(c):c),g.addEventListener(EventType.CLICK,this.handleClick_.bind(this,n),!1);const H=document.createElement("button");H.className=l,H.setAttribute("type","button"),H.title=f,H.appendChild(typeof u=="string"?document.createTextNode(u):u),H.addEventListener(EventType.CLICK,this.handleClick_.bind(this,-n),!1);const Y=i+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,ee=this.element;ee.className=Y,ee.appendChild(g),ee.appendChild(H),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,i){i.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const n=this.getMap().getView();if(!n)return;const o=n.getZoom();if(o!==void 0){const l=n.getConstrainedZoom(o+e);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:l,duration:this.duration_,easing:easeOut})):n.setZoom(l)}}}function defaults$2(s){s=s||{};const e=new Collection;return(s.zoom!==void 0?s.zoom:!0)&&e.push(new Zoom(s.zoomOptions)),(s.rotate!==void 0?s.rotate:!0)&&e.push(new Rotate(s.rotateOptions)),(s.attribution!==void 0?s.attribution:!0)&&e.push(new Attribution(s.attributionOptions)),e}const GroupEventType={ADDLAYER:"addlayer",REMOVELAYER:"removelayer"};class GroupEvent extends BaseEvent{constructor(e,i){super(e),this.layer=i}}const Property$1={LAYERS:"layers"};class LayerGroup extends BaseLayer{constructor(e){e=e||{};const i=Object.assign({},e);delete i.layers;let n=e.layers;super(i),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Property$1.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new Collection(n.slice(),{unique:!0}):assert(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new Collection(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(unlistenByKey),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(listen(e,CollectionEventType.ADD,this.handleLayersAdd_,this),listen(e,CollectionEventType.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(unlistenByKey);clear$1(this.listenerKeys_);const i=e.getArray();for(let n=0,o=i.length;n<o;n++){const l=i[n];this.registerLayerListeners_(l),this.dispatchEvent(new GroupEvent(GroupEventType.ADDLAYER,l))}this.changed()}registerLayerListeners_(e){const i=[listen(e,ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),listen(e,EventType.CHANGE,this.handleLayerChange_,this)];e instanceof LayerGroup&&i.push(listen(e,GroupEventType.ADDLAYER,this.handleLayerGroupAdd_,this),listen(e,GroupEventType.REMOVELAYER,this.handleLayerGroupRemove_,this)),this.listenerKeys_[getUid(e)]=i}handleLayerGroupAdd_(e){this.dispatchEvent(new GroupEvent(GroupEventType.ADDLAYER,e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new GroupEvent(GroupEventType.REMOVELAYER,e.layer))}handleLayersAdd_(e){const i=e.element;this.registerLayerListeners_(i),this.dispatchEvent(new GroupEvent(GroupEventType.ADDLAYER,i)),this.changed()}handleLayersRemove_(e){const i=e.element,n=getUid(i);this.listenerKeys_[n].forEach(unlistenByKey),delete this.listenerKeys_[n],this.dispatchEvent(new GroupEvent(GroupEventType.REMOVELAYER,i)),this.changed()}getLayers(){return this.get(Property$1.LAYERS)}setLayers(e){const i=this.getLayers();if(i){const n=i.getArray();for(let o=0,l=n.length;o<l;++o)this.dispatchEvent(new GroupEvent(GroupEventType.REMOVELAYER,n[o]))}this.set(Property$1.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(i){i.getLayersArray(e)}),e}getLayerStatesArray(e){const i=e!==void 0?e:[],n=i.length;this.getLayers().forEach(function(c){c.getLayerStatesArray(i)});const o=this.getLayerState();let l=o.zIndex;!e&&o.zIndex===void 0&&(l=0);for(let c=n,u=i.length;c<u;c++){const h=i[c];h.opacity*=o.opacity,h.visible=h.visible&&o.visible,h.maxResolution=Math.min(h.maxResolution,o.maxResolution),h.minResolution=Math.max(h.minResolution,o.minResolution),h.minZoom=Math.max(h.minZoom,o.minZoom),h.maxZoom=Math.min(h.maxZoom,o.maxZoom),o.extent!==void 0&&(h.extent!==void 0?h.extent=getIntersection(h.extent,o.extent):h.extent=o.extent),h.zIndex===void 0&&(h.zIndex=l)}return i}getSourceState(){return"ready"}}class MapRenderer extends Disposable{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,i){abstract()}calculateMatrices2D(e){const i=e.viewState,n=e.coordinateToPixelTransform,o=e.pixelToCoordinateTransform;compose(n,e.size[0]/2,e.size[1]/2,1/i.resolution,-1/i.resolution,-i.rotation,-i.center[0],-i.center[1]),makeInverse(o,n)}forEachFeatureAtCoordinate(e,i,n,o,l,c,u,h){let f;const g=i.viewState;function H(rt,nt,st,at){return l.call(c,nt,rt?st:null,at)}const Y=g.projection,ee=wrapX$1(e.slice(),Y),te=[[0,0]];if(Y.canWrapX()&&o){const rt=Y.getExtent(),nt=getWidth(rt);te.push([-nt,0],[nt,0])}const xe=i.layerStatesArray,ne=xe.length,et=[],tt=[];for(let rt=0;rt<te.length;rt++)for(let nt=ne-1;nt>=0;--nt){const st=xe[nt],at=st.layer;if(at.hasRenderer()&&inView(st,g)&&u.call(h,at)){const ot=at.getRenderer(),ct=at.getSource();if(ot&&ct){const ht=ct.getWrapX()?ee:e,ut=H.bind(null,st.managed);tt[0]=ht[0]+te[rt][0],tt[1]=ht[1]+te[rt][1],f=ot.forEachFeatureAtCoordinate(tt,i,n,ut,et)}if(f)return f}}if(et.length===0)return;const it=1/et.length;return et.forEach((rt,nt)=>rt.distanceSq+=nt*it),et.sort((rt,nt)=>rt.distanceSq-nt.distanceSq),et.some(rt=>f=rt.callback(rt.feature,rt.layer,rt.geometry)),f}hasFeatureAtCoordinate(e,i,n,o,l,c){return this.forEachFeatureAtCoordinate(e,i,n,o,TRUE,this,l,c)!==void 0}getMap(){return this.map_}renderFrame(e){abstract()}scheduleExpireIconCache(e){shared.canExpireCache()&&e.postRenderFunctions.push(expireIconCache)}}function expireIconCache(s,e){shared.expire()}class CompositeMapRenderer extends MapRenderer{constructor(e){super(e),this.fontChangeListenerKey_=listen(checkedFonts,ObjectEventType.PROPERTYCHANGE,e.redrawText,e),this.element_=WORKER_OFFSCREEN_CANVAS?createMockDiv():document.createElement("div");const i=this.element_.style;i.position="absolute",i.width="100%",i.height="100%",i.zIndex="0",this.element_.className=CLASS_UNSELECTABLE+" ol-layers";const n=e.getViewport();n&&n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,i){const n=this.getMap();if(n.hasListener(e)){const o=new RenderEvent(e,void 0,i);n.dispatchEvent(o)}}disposeInternal(){unlistenByKey(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(RenderEventType.PRECOMPOSE,e);const i=e.layerStatesArray.sort((f,g)=>f.zIndex-g.zIndex);i.some(f=>f.layer instanceof BaseVectorLayer&&f.layer.getDeclutter())&&(e.declutter={});const o=e.viewState;this.children_.length=0;const l=[];let c=null;for(let f=0,g=i.length;f<g;++f){const H=i[f];e.layerIndex=f;const Y=H.layer,ee=Y.getSourceState();if(!inView(H,o)||ee!="ready"&&ee!="undefined"){Y.unrender();continue}const te=Y.render(e,c);te&&(te!==c&&(this.children_.push(te),c=te),l.push(H))}this.declutter(e,l),replaceChildren(this.element_,this.children_);const h=this.getMap().getTargetElement();if(isCanvas(h)){const f=h.getContext("2d");for(const g of this.children_){const H=g.firstElementChild||g,Y=g.style.backgroundColor;if(Y&&(!isCanvas(H)||H.width>0)&&(f.fillStyle=Y,f.fillRect(0,0,h.width,h.height)),isCanvas(H)&&H.width>0){const ee=g.style.opacity||H.style.opacity;f.globalAlpha=ee===""?1:Number(ee);const te=H.style.transform;if(te)f.setTransform(...fromString$1(te));else{const xe=parseFloat(H.style.width)/H.width,ne=parseFloat(H.style.height)/H.height;f.setTransform(xe,0,0,ne,0,0)}f.drawImage(H,0,0)}}f.globalAlpha=1,f.setTransform(1,0,0,1,0,0)}this.dispatchRenderEvent(RenderEventType.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,i){if(e.declutter){for(let n=i.length-1;n>=0;--n){const o=i[n],l=o.layer;l.getDeclutter()&&l.renderDeclutter(e,o)}i.forEach(n=>n.layer.renderDeferred(e))}}}function removeLayerMapProperty(s){if(s instanceof Layer$1){s.setMapInternal(null);return}s instanceof LayerGroup&&s.getLayers().forEach(removeLayerMapProperty)}function setLayerMapProperty(s,e){if(s instanceof Layer$1){s.setMapInternal(e);return}if(s instanceof LayerGroup){const i=s.getLayers().getArray();for(let n=0,o=i.length;n<o;++n)setLayerMapProperty(i[n],e)}}let Map$1=class extends BaseObject{constructor(e){super(),e=e||{},this.on,this.once,this.un;const i=createOptionsInternal(e);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:DEVICE_PIXEL_RATIO,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=create(),this.pixelToCoordinateTransform_=create(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,WORKER_OFFSCREEN_CANVAS||(this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_)),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=i.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,WORKER_OFFSCREEN_CANVAS||(this.resizeObserver_=new ResizeObserver(()=>this.updateSize())),this.controls=i.controls||(WORKER_OFFSCREEN_CANVAS?new Collection:defaults$2()),this.interactions=i.interactions||(WORKER_OFFSCREEN_CANVAS?new Collection:defaults$3({onFocusOnly:!0})),this.overlays_=i.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new TileQueue(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(MapProperty.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(MapProperty.VIEW,this.handleViewChanged_),this.addChangeListener(MapProperty.SIZE,this.handleSizeChanged_),this.addChangeListener(MapProperty.TARGET,this.handleTargetChanged_),this.setProperties(i.values);const n=this;e.view&&!(e.view instanceof View)&&e.view.then(function(o){n.setView(new View(o))}),this.controls.addEventListener(CollectionEventType.ADD,o=>{o.element.setMap(this)}),this.controls.addEventListener(CollectionEventType.REMOVE,o=>{o.element.setMap(null)}),this.interactions.addEventListener(CollectionEventType.ADD,o=>{o.element.setMap(this)}),this.interactions.addEventListener(CollectionEventType.REMOVE,o=>{o.element.setMap(null)}),this.overlays_.addEventListener(CollectionEventType.ADD,o=>{this.addOverlayInternal_(o.element)}),this.overlays_.addEventListener(CollectionEventType.REMOVE,o=>{const l=o.element.getId();l!==void 0&&delete this.overlayIdIndex_[l.toString()],o.element.setMap(null)}),this.controls.forEach(o=>{o.setMap(this)}),this.interactions.forEach(o=>{o.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){setLayerMapProperty(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const i=e.getId();i!==void 0&&(this.overlayIdIndex_[i.toString()]=e),e.setMap(this)}disposeInternal(){var e;this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),(e=this.resizeObserver_)==null||e.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,i,n){if(!this.frameState_||!this.renderer_)return;const o=this.getCoordinateFromPixelInternal(e);n=n!==void 0?n:{};const l=n.hitTolerance!==void 0?n.hitTolerance:0,c=n.layerFilter!==void 0?n.layerFilter:TRUE,u=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(o,this.frameState_,l,u,i,null,c,null)}getFeaturesAtPixel(e,i){const n=[];return this.forEachFeatureAtPixel(e,function(o){n.push(o)},i),n}getAllLayers(){const e=[];function i(n){n.forEach(function(o){o instanceof LayerGroup?i(o.getLayers()):e.push(o)})}return i(this.getLayers()),e}hasFeatureAtPixel(e,i){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const o=i.layerFilter!==void 0?i.layerFilter:TRUE,l=i.hitTolerance!==void 0?i.hitTolerance:0,c=i.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,l,c,o,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const n=this.viewport_.getBoundingClientRect(),o=this.getSize(),l=n.width/o[0],c=n.height/o[1],u="changedTouches"in e?e.changedTouches[0]:e;return[(u.clientX-n.left)/l,(u.clientY-n.top)/c]}getTarget(){return this.get(MapProperty.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return toUserCoordinate(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const i=this.frameState_;return i?apply(i.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const i=this.overlayIdIndex_[e.toString()];return i!==void 0?i:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(MapProperty.LAYERGROUP)}setLayers(e){const i=this.getLayerGroup();if(e instanceof Collection){i.setLayers(e);return}const n=i.getLayers();n.clear(),n.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let i=0,n=e.length;i<n;++i){const o=e[i];if(!o.visible)continue;const l=o.layer.getRenderer();if(l&&!l.ready)return!0;const c=o.layer.getSource();if(c&&c.loading)return!0}return!1}getPixelFromCoordinate(e){const i=fromUserCoordinate(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(i)}getPixelFromCoordinateInternal(e){const i=this.frameState_;return i?apply(i.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(MapProperty.SIZE)}getView(){return this.get(MapProperty.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,i,n,o){return getTilePriority(this.frameState_,e,i,n,o)}handleBrowserEvent(e,i){i=i||e.type;const n=new MapBrowserEvent(i,this,e);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(e){if(!this.frameState_)return;const i=e.originalEvent,n=i.type;if(n===PointerEventType.POINTERDOWN||n===EventType.WHEEL||n===EventType.KEYDOWN){const o=this.getOwnerDocument(),l=this.viewport_.getRootNode?this.viewport_.getRootNode():o,c=i.target,u=l instanceof ShadowRoot?l.host===c?l.host.ownerDocument:l:l===o?o.documentElement:l;if(this.overlayContainerStopEvent_.contains(c)||!u.contains(c))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const o=this.getInteractions().getArray().slice();for(let l=o.length-1;l>=0;l--){const c=o[l];if(c.getMap()!==this||!c.getActive()||!this.getTargetElement())continue;if(!c.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,i=this.tileQueue_;if(!i.isEmpty()){let o=this.maxTilesLoading_,l=o;if(e){const c=e.viewHints;if(c[ViewHint.ANIMATING]||c[ViewHint.INTERACTING]){const u=Date.now()-e.time>8;o=u?0:8,l=u?0:2}}i.getTilesLoading()<o&&(i.reprioritize(),i.loadMoreTiles(o,l))}e&&this.renderer_&&!e.animate&&(this.renderComplete_?(this.hasListener(RenderEventType.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(RenderEventType.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new MapEvent(MapEventType.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new MapEvent(MapEventType.LOADSTART,this,e))));const n=this.postRenderFunctions_;if(e)for(let o=0,l=n.length;o<l;++o)n[o](this,e);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){var n,o;if(this.mapBrowserEventHandler_){for(let l=0,c=this.targetChangeHandlerKeys_.length;l<c;++l)unlistenByKey(this.targetChangeHandlerKeys_[l]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(EventType.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(EventType.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_&&!isCanvas(this.targetElement_)){(n=this.resizeObserver_)==null||n.unobserve(this.targetElement_);const l=this.targetElement_.getRootNode();l instanceof ShadowRoot&&this.resizeObserver_.unobserve(l.host),this.setSize(void 0)}const e=this.getTarget(),i=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=i,!i)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{if(isCanvas(i)||i.appendChild(this.viewport_),this.renderer_||(this.renderer_=new CompositeMapRenderer(this)),!isCanvas(i)){this.mapBrowserEventHandler_=new MapBrowserEventHandler(this,this.moveTolerance_);for(const c in MapBrowserEventType)this.mapBrowserEventHandler_.addEventListener(MapBrowserEventType[c],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(EventType.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(EventType.WHEEL,this.boundHandleBrowserEvent_,PASSIVE_EVENT_LISTENERS?{passive:!1}:!1);let l;if(this.keyboardEventTarget_)l=this.keyboardEventTarget_;else{const c=i.getRootNode();l=c instanceof ShadowRoot?c.host:i}if(this.targetChangeHandlerKeys_=[listen(l,EventType.KEYDOWN,this.handleBrowserEvent,this),listen(l,EventType.KEYPRESS,this.handleBrowserEvent,this)],i instanceof HTMLElement){const c=i.getRootNode();c instanceof ShadowRoot&&this.resizeObserver_.observe(c.host),(o=this.resizeObserver_)==null||o.observe(i)}}this.updateSize()}}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(unlistenByKey(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(unlistenByKey(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=listen(e,ObjectEventType.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=listen(e,EventType.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(unlistenByKey),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new GroupEvent("addlayer",e)),this.layerGroupPropertyListenerKeys_=[listen(e,ObjectEventType.PROPERTYCHANGE,this.render,this),listen(e,EventType.CHANGE,this.render,this),listen(e,"addlayer",this.handleLayerAdd_,this),listen(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;const e=this.frameState_.layerStatesArray;for(let i=0,n=e.length;i<n;++i){const o=e[i].layer;o.hasRenderer()&&o.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){removeLayerMapProperty(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const i=this.getSize(),n=this.getView(),o=this.frameState_;let l=null;if(i!==void 0&&hasArea(i)&&n&&n.isDef()){const c=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),u=n.getState();if(l={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:getForViewAndSize(u.center,u.resolution,u.rotation,i),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:i,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:u,viewHints:c,wantedTiles:{},mapId:getUid(this),renderTargets:{}},u.nextCenter&&u.nextResolution){const h=isNaN(u.nextRotation)?u.rotation:u.nextRotation;l.nextExtent=getForViewAndSize(u.nextCenter,u.nextResolution,h,i)}}this.frameState_=l,this.renderer_.renderFrame(l),l&&(l.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,l.postRenderFunctions),o&&(!this.previousExtent_||!isEmpty$1(this.previousExtent_)&&!equals$1(l.extent,this.previousExtent_))&&(this.dispatchEvent(new MapEvent(MapEventType.MOVESTART,this,o)),this.previousExtent_=createOrUpdateEmpty(this.previousExtent_)),this.previousExtent_&&!l.viewHints[ViewHint.ANIMATING]&&!l.viewHints[ViewHint.INTERACTING]&&!equals$1(l.extent,this.previousExtent_)&&(this.dispatchEvent(new MapEvent(MapEventType.MOVEEND,this,l)),clone$1(l.extent,this.previousExtent_))),this.dispatchEvent(new MapEvent(MapEventType.POSTRENDER,this,l)),this.renderComplete_=(this.hasListener(MapEventType.LOADSTART)||this.hasListener(MapEventType.LOADEND)||this.hasListener(RenderEventType.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const i=this.getLayerGroup();i&&this.handleLayerRemove_(new GroupEvent("removelayer",i)),this.set(MapProperty.LAYERGROUP,e)}setSize(e){this.set(MapProperty.SIZE,e)}setTarget(e){this.set(MapProperty.TARGET,e)}setView(e){if(!e||e instanceof View){this.set(MapProperty.VIEW,e);return}this.set(MapProperty.VIEW,new View);const i=this;e.then(function(n){i.setView(new View(n))})}updateSize(){const e=this.getTargetElement();let i;if(e){let o,l;if(isCanvas(e))o=e.width,l=e.height;else{const c=getComputedStyle(e);o=e.offsetWidth-parseFloat(c.borderLeftWidth)-parseFloat(c.paddingLeft)-parseFloat(c.paddingRight)-parseFloat(c.borderRightWidth),l=e.offsetHeight-parseFloat(c.borderTopWidth)-parseFloat(c.paddingTop)-parseFloat(c.paddingBottom)-parseFloat(c.borderBottomWidth)}!isNaN(o)&&!isNaN(l)&&(i=[Math.max(0,o),Math.max(0,l)],!hasArea(i)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&warn("No map visible because the map container's width or height are 0."))}const n=this.getSize();i&&(!n||!equals(i,n))&&(this.setSize(i),this.updateViewportSize_(i))}updateViewportSize_(e){const i=this.getView();i&&i.setViewportSize(e)}};function createOptionsInternal(s){let e=null;s.keyboardEventTarget!==void 0&&(e=typeof s.keyboardEventTarget=="string"?document.getElementById(s.keyboardEventTarget):s.keyboardEventTarget);const i={},n=s.layers&&typeof s.layers.getLayers=="function"?s.layers:new LayerGroup({layers:s.layers});i[MapProperty.LAYERGROUP]=n,i[MapProperty.TARGET]=s.target,i[MapProperty.VIEW]=s.view instanceof View?s.view:new View;let o;s.controls!==void 0&&(Array.isArray(s.controls)?o=new Collection(s.controls.slice()):(assert(typeof s.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),o=s.controls));let l;s.interactions!==void 0&&(Array.isArray(s.interactions)?l=new Collection(s.interactions.slice()):(assert(typeof s.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),l=s.interactions));let c;return s.overlays!==void 0?Array.isArray(s.overlays)?c=new Collection(s.overlays.slice()):(assert(typeof s.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),c=s.overlays):c=new Collection,{controls:o,interactions:l,keyboardEventTarget:e,overlays:c,values:i}}const Property={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},GeolocationErrorType={ERROR:"error"};class GeolocationError extends BaseEvent{constructor(e){super(GeolocationErrorType.ERROR),this.code=e.code,this.message=e.message}}class Geolocation extends BaseObject{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=identityTransform,this.watchId_=void 0,this.addChangeListener(Property.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(Property.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=getTransformFromProjections(get$3("EPSG:4326"),e),this.position_&&this.set(Property.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const i=e.coords;this.set(Property.ACCURACY,i.accuracy),this.set(Property.ALTITUDE,i.altitude===null?void 0:i.altitude),this.set(Property.ALTITUDE_ACCURACY,i.altitudeAccuracy===null?void 0:i.altitudeAccuracy),this.set(Property.HEADING,i.heading===null?void 0:toRadians(i.heading)),this.position_?(this.position_[0]=i.longitude,this.position_[1]=i.latitude):this.position_=[i.longitude,i.latitude];const n=this.transform_(this.position_);this.set(Property.POSITION,n.slice()),this.set(Property.SPEED,i.speed===null?void 0:i.speed);const o=circular(this.position_,i.accuracy);o.applyTransform(this.transform_),this.set(Property.ACCURACY_GEOMETRY,o),this.changed()}positionError_(e){this.dispatchEvent(new GeolocationError(e))}getAccuracy(){return this.get(Property.ACCURACY)}getAccuracyGeometry(){return this.get(Property.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(Property.ALTITUDE)}getAltitudeAccuracy(){return this.get(Property.ALTITUDE_ACCURACY)}getHeading(){return this.get(Property.HEADING)}getPosition(){return this.get(Property.POSITION)}getProjection(){return this.get(Property.PROJECTION)}getSpeed(){return this.get(Property.SPEED)}getTracking(){return this.get(Property.TRACKING)}getTrackingOptions(){return this.get(Property.TRACKING_OPTIONS)}setProjection(e){this.set(Property.PROJECTION,get$3(e))}setTracking(e){this.set(Property.TRACKING,e)}setTrackingOptions(e){this.set(Property.TRACKING_OPTIONS,e)}}const mapboxBaseUrl="https://api.mapbox.com";function getMapboxPath(s){const e="mapbox://";return s.indexOf(e)!==0?"":s.slice(e.length)}function normalizeSpriteDefinition(s,e,i){if(typeof s=="string")return[{id:"default",url:normalizeSpriteUrl(s,e,i)}];for(const n of s)n.url=normalizeSpriteUrl(n.url,e,i);return s}function normalizeSpriteUrl(s,e,i){const n=getMapboxPath(s);if(!n)return decodeURI(new URL(s,i).href);const o="sprites/";if(n.indexOf(o)!==0)throw new Error(`unexpected sprites url: ${s}`);const l=n.slice(o.length);return`${mapboxBaseUrl}/styles/v1/${l}/sprite?access_token=${e}`}function normalizeStyleUrl(s,e){const i=getMapboxPath(s);if(!i)return decodeURI(new URL(s,location.href).href);const n="styles/";if(i.indexOf(n)!==0)throw new Error(`unexpected style url: ${s}`);const o=i.slice(n.length);return`${mapboxBaseUrl}/styles/v1/${o}?&access_token=${e}`}const mapboxSubdomains=["a","b","c","d"];function normalizeSourceUrl(s,e,i,n){const o=new URL(s,n||location.href),l=getMapboxPath(s);if(!l)return e?(o.searchParams.has(i)||o.searchParams.set(i,e),[decodeURI(o.href)]):[decodeURI(o.href)];if(l==="mapbox.satellite"){const c=window.devicePixelRatio>=1.5?"@2x":"";return[`https://api.mapbox.com/v4/${l}/{z}/{x}/{y}${c}.webp?access_token=${e}`]}return mapboxSubdomains.map(c=>`https://${c}.tiles.mapbox.com/v4/${l}/{z}/{x}/{y}.vector.pbf?access_token=${e}`)}const emptyObj=Object.freeze({}),functionCacheByStyleId={},filterCacheByStyleId={};let styleId=0;function getStyleId(s){return s.id||(s.id=styleId++),s.id}function getStyleFunctionKey(s,e){return getStyleId(s)+"."+getUid(e)}function getFunctionCache(s){let e=functionCacheByStyleId[s.id];return e||(e={},functionCacheByStyleId[getStyleId(s)]=e),e}function getFilterCache(s){let e=filterCacheByStyleId[s.id];return e||(e={},filterCacheByStyleId[getStyleId(s)]=e),e}function deg2rad(s){return s*Math.PI/180}const defaultResolutions=(function(){const s=[];for(let e=78271.51696402048;s.length<=24;e/=2)s.push(e);return s})();function createCanvas(s,e){if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof OffscreenCanvas<"u")return new OffscreenCanvas(s,e);const i=document.createElement("canvas");return i.width=s,i.height=e,i}function getZoomForResolution(s,e){let i=0;const n=e.length;for(;i<n;++i)if(e[i]<s&&i+1<n){const l=e[i]/e[i+1];return i+Math.log(e[i]/s)/Math.log(l)}return n-1}function getResolutionForZoom(s,e){const i=Math.floor(s),n=Math.pow(2,s-i);return e[i]/n}const pendingRequests={};function fetchResource(s,e,i={},n){if(e in pendingRequests)return n&&(n.url=pendingRequests[e][0].url),pendingRequests[e][1];const o=i.transformRequest&&i.transformRequest(e,s)||e,l=function(h){return delete pendingRequests[e],Promise.reject(new Error("Error fetching source "+e))},c=function(h){return delete pendingRequests[e],h.ok?h.json():Promise.reject(new Error("Error fetching source "+e))},u=toPromise(()=>o).then(h=>h instanceof Response?(n&&(n.url=h.url),c(h)):(h instanceof Request||(h=new Request(h)),h.headers.get("Accept")||h.headers.set("Accept","application/json"),n&&(n.url=h.url),fetch(h).then(c).catch(l))).catch(l);return pendingRequests[e]=[o,u],u}function getGlStyle(s,e){if(typeof s=="string")if(s.trim().startsWith("{"))try{const i=JSON.parse(s);return Promise.resolve(i)}catch(i){return Promise.reject(i)}else return s=normalizeStyleUrl(s,e.accessToken),fetchResource("Style",s,e);else return Promise.resolve(s)}const tilejsonCache={};function getTileJson(s,e,i={}){const n=[e,JSON.stringify(s)].toString();let o=tilejsonCache[n];if(!o||i.transformRequest){let l;i.transformRequest&&(l=(u,h)=>{const f=i.transformRequest&&i.transformRequest(h,"Tiles")||h;if(u instanceof VectorTile$1)u.setLoader((g,H,Y)=>{const ee=function(te){te.arrayBuffer().then(xe=>{const et=u.getFormat().readFeatures(xe,{extent:g,featureProjection:Y});u.setFeatures(et)})};toPromise(()=>f).then(te=>{if(te instanceof Response)return ee(te);fetch(te).then(ee).catch(xe=>u.setState(TileState.ERROR))}).catch(te=>u.setState(TileState.ERROR))});else{const g=u.getImage();toPromise(()=>f).then(H=>{if(typeof H=="string"){g.src=H;return}const Y=ee=>ee.blob().then(te=>{const xe=URL.createObjectURL(te);g.addEventListener("load",()=>URL.revokeObjectURL(xe)),g.addEventListener("error",()=>URL.revokeObjectURL(xe)),g.src=xe});if(H instanceof Response)return Y(H);fetch(H).then(Y).catch(ee=>u.setState(TileState.ERROR))}).catch(H=>u.setState(TileState.ERROR))}});const c=s.url;if(c&&!s.tiles){const u=normalizeSourceUrl(c,i.accessToken,i.accessTokenParam||"access_token",e||location.href);if(c.startsWith("mapbox://"))o=Promise.resolve({tileJson:Object.assign({},s,{url:void 0,tiles:u}),tileLoadFunction:l});else{const h={};o=fetchResource("Source",u[0],i,h).then(function(f){return f.tiles=f.tiles.map(function(g){return f.scheme==="tms"&&(g=g.replace("{y}","{-y}")),normalizeSourceUrl(g,i.accessToken,i.accessTokenParam||"access_token",h.url)[0]}),Promise.resolve({tileJson:f,tileLoadFunction:l})})}}else s.tiles?(s=Object.assign({},s,{tiles:s.tiles.map(function(u){return s.scheme==="tms"&&(u=u.replace("{y}","{-y}")),normalizeSourceUrl(u,i.accessToken,i.accessTokenParam||"access_token",e||location.href)[0]})}),o=Promise.resolve({tileJson:Object.assign({},s),tileLoadFunction:l})):o=Promise.reject(new Error("source has no `tiles` nor `url`"));tilejsonCache[n]=o}return o}function drawIconHalo(s,e,i,n){const o=[2*i*e.pixelRatio+e.width,2*i*e.pixelRatio+e.height],l=createCanvas(o[0],o[1]),c=l.getContext("2d");c.drawImage(s,e.x,e.y,e.width,e.height,i*e.pixelRatio,i*e.pixelRatio,e.width,e.height);const u=c.getImageData(0,0,o[0],o[1]);c.globalCompositeOperation="destination-over",c.fillStyle=`rgba(${n.r*255},${n.g*255},${n.b*255},${n.a})`;const h=u.data;for(let f=0,g=u.width;f<g;++f)for(let H=0,Y=u.height;H<Y;++H){const ee=(H*g+f)*4;h[ee+3]>0&&c.arc(f,H,i*e.pixelRatio,0,2*Math.PI)}return c.fill(),l}function smoothstep(s,e,i){const n=Math.max(0,Math.min(1,(i-s)/(e-s)));return n*n*(3-2*n)}function drawSDF(s,e,i){const n=createCanvas(e.width,e.height),o=n.getContext("2d");o.drawImage(s,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const l=o.getImageData(0,0,e.width,e.height),c=l.data;for(let u=0,h=l.width;u<h;++u)for(let f=0,g=l.height;f<g;++f){const H=(f*h+u)*4,Y=c[H+3]/255,ee=.75,te=.1,xe=smoothstep(ee-te,ee+te,Y);xe>0?(c[H+0]=Math.round(255*i.r*xe),c[H+1]=Math.round(255*i.g*xe),c[H+2]=Math.round(255*i.b*xe),c[H+3]=Math.round(255*xe)):c[H+3]=0}return o.putImageData(l,0,0),n}const hairSpacePool=Array(256).join("");function applyLetterSpacing(s,e){if(e>=.05){let i="";const n=s.split(`
`),o=hairSpacePool.slice(0,Math.round(e/.1));for(let l=0,c=n.length;l<c;++l)l>0&&(i+=`
`),i+=n[l].split("").join(o);return i}return s}let measureContext;function getMeasureContext(){return measureContext||(measureContext=createCanvas(1,1).getContext("2d")),measureContext}function measureText(s,e){return getMeasureContext().measureText(s).width+(s.length-1)*e}const measureCache={};function wrapText(s,e,i,n){if(s.indexOf(`
`)!==-1){const c=s.split(`
`),u=[];for(let h=0,f=c.length;h<f;++h)u.push(wrapText(c[h],e,i,n));return u.join(`
`)}const o=i+","+e+","+s+","+n;let l=measureCache[o];if(!l){const c=s.split(" ");if(c.length>1){const u=getMeasureContext();u.font=e;const f=u.measureText("M").width*i;let g="";const H=[];for(let Y=0,ee=c.length;Y<ee;++Y){const te=c[Y],xe=g+(g?" ":"")+te;measureText(xe,n)<=f?g=xe:(g&&H.push(g),g=te)}g&&H.push(g);for(let Y=0,ee=H.length;Y<ee&&ee>1;++Y){const te=H[Y];if(measureText(te,n)<f*.35){const xe=Y>0?measureText(H[Y-1],n):1/0,ne=Y<ee-1?measureText(H[Y+1],n):1/0;H.splice(Y,1),ee-=1,xe<ne?(H[Y-1]+=" "+te,Y-=1):H[Y]=te+" "+H[Y]}}for(let Y=0,ee=H.length-1;Y<ee;++Y){const te=H[Y],xe=H[Y+1];if(measureText(te,n)>f*.7&&measureText(xe,n)<f*.6){const ne=te.split(" "),et=ne.pop();measureText(et,n)<f*.2&&(H[Y]=ne.join(" "),H[Y+1]=et+" "+xe),ee-=1}}l=H.join(`
`)}else l=s;l=applyLetterSpacing(l,n),measureCache[o]=l}return l}const fontFamilyRegEx=/font-family: ?([^;]*);/,stripQuotesRegEx=/("|')/g;let loadedFontFamilies;function hasFontFamily(s){if(!loadedFontFamilies){loadedFontFamilies={};const e=document.styleSheets;for(let i=0,n=e.length;i<n;++i){const o=e[i];try{const l=o.rules||o.cssRules;if(l)for(let c=0,u=l.length;c<u;++c){const h=l[c];if(h.type==5){const f=h.cssText.match(fontFamilyRegEx);loadedFontFamilies[f[1].replace(stripQuotesRegEx,"")]=!0}}}catch{}}}return s in loadedFontFamilies}const processedFontFamilies={};function getFonts(s,e="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){const i=s.toString();if(i in processedFontFamilies)return processedFontFamilies[i];const n=[];for(let o=0,l=s.length;o<l;++o){s[o]=s[o].replace("Arial Unicode MS","Arial");const c=s[o],u=mb2css(c,1);registerFont(u);const h=u.split(" ");n.push([h.slice(3).join(" ").replace(/"/g,""),h[1],h[0]])}for(let o=0,l=n.length;o<l;++o){const c=n[o],u=c[0];if(!hasFontFamily(u)&&checkedFonts.get(`${c[2]}
${c[1]} 
${u}`)!==100){const h=e.replace("{font-family}",u.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",u.replace(/ /g,"+")).replace("{fontweight}",c[1]).replace("{-fontstyle}",c[2].replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",c[2]);if(!document.querySelector('link[href="'+h+'"]')){const f=document.createElement("link");f.href=h,f.rel="stylesheet",document.head.appendChild(f)}}}return processedFontFamilies[i]=s,s}const types$1={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},anchor={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},expressionData=function(s,e){const i=createPropertyExpression(s,e);if(i.result==="error")throw new Error(i.value.map(n=>`${n.key}: ${n.message}`).join(", "));return i.value},cameraObj={zoom:0,distanceFromCenter:0};CompoundExpression.register(expressions$1,{...CompoundExpression.definitions,pitch:[{kind:"number"},[],s=>cameraObj.pitch||90],"distance-from-center":[{kind:"number"},[],s=>cameraObj.distanceFromCenter||0]});let renderFeatureCoordinates,renderFeature;function getValue(s,e,i,n,o,l){const c=s.id;o||(o={},console.warn("No functionCache provided to getValue()")),o[c]||(o[c]={});const u=o[c];if(!u[i]){let h=(s[e]||emptyObj)[i];const f=v8[`${e}_${s.type}`][i];h===void 0&&(h=f.default);let g=isExpression(h);if(!g&&isFunction$1(h)&&(h=convertFunction(h,f),g=!0),g){const H=expressionData(h,f);u[i]=H.evaluate.bind(H)}else f.type=="color"&&(h=Color.parse(h)),u[i]=function(){return h}}return u[i](cameraObj,n,l)}function getDeclutterMode(s,e,i,n){return getValue(s,"layout",`${i}-allow-overlap`,e,n)?getValue(s,"layout",`${i}-ignore-placement`,e,n)?"none":"obstacle":"declutter"}function evaluateFilter(s,e,i,n){if(n||console.warn("No filterCache provided to evaluateFilter()"),!(s in n))try{n[s]=featureFilter(e).filter}catch(o){console.warn("Filter will evaluate to false: "+o.message),n[s]=function(){return!1}}return n[s](cameraObj,i)}function colorWithOpacity(s,e){if(s){if(s.a===0||e===0)return;const i=s.a;return e=e===void 0?1:e,i===0?"transparent":"rgba("+Math.round(s.r*255/i)+","+Math.round(s.g*255/i)+","+Math.round(s.b*255/i)+","+i*e+")"}return s}const templateRegEx=/\{[^{}}]*\}/g;function fromTemplate(s,e){return s.replace(templateRegEx,function(i){return e[i.slice(1,-1)]||""})}function getSpriteImageForIcon(s,e){let i=s.split(":")[0];return i===s&&(i="default"),e[i]}const styleFunctionArgs={};function stylefunction(s,e,i,n=defaultResolutions,o=void 0,l=void 0,c=void 0,u=void 0){if(typeof e=="string"&&(e=JSON.parse(e)),e.version!=8)throw new Error("glStyle version 8 required.");styleFunctionArgs[getStyleFunctionKey(e,s)]=Array.from(arguments);const h={};(typeof l=="string"||l instanceof Request||l instanceof Response||l instanceof Promise)&&(l={default:l});for(const nt in l){const st=l[nt];toPromise(()=>st).then(async at=>{let ot;if(typeof Image<"u"){const ct=new Image;if(typeof at=="string")ct.crossOrigin="anonymous",ct.src=at;else{let ht;at instanceof Request?ht=await fetch(at):at instanceof Response&&(ht=at);const ut=await ht.blob();ot=URL.createObjectURL(ut),ct.src=ot}ct.addEventListener("load",function ht(){ct.removeEventListener("load",ht),h[nt]={image:ct,size:[ct.width,ct.height]},s.changed(),ot&&URL.revokeObjectURL(ot)}),ct.addEventListener("error",function ht(){URL.revokeObjectURL(ot),ct.removeEventListener("error",ht)})}else if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){const ct=self;ct.postMessage({action:"loadImage",src:at}),ct.addEventListener("message",function(ut){ut.data.action==="imageLoaded"&&ut.data.src===at&&(h[nt]={image:ut.data.image,size:[ut.data.image.width,ut.data.image.height]})})}})}const f=derefLayers(e.layers),g={},H=[],Y={},ee={},te=getFunctionCache(e),xe=getFilterCache(e);let ne;for(let nt=0,st=f.length;nt<st;++nt){const at=f[nt],ot=at.id;if(typeof i=="string"&&at.source==i||Array.isArray(i)&&i.indexOf(ot)!==-1){const ct=at["source-layer"];if(ne){if(at.source!==ne)throw new Error(`Layer "${ot}" does not use source "${ne}`)}else{ne=at.source;const ut=e.sources[ne];if(!ut)throw new Error(`Source "${ne}" is not defined`);const pt=ut.type;if(pt!=="vector"&&pt!=="geojson")throw new Error(`Source "${ne}" is not of type "vector" or "geojson", but "${pt}"`)}let ht=g[ct];ht||(ht=[],g[ct]=ht),ht.push({layer:at,index:nt}),H.push(ot)}}const et=new Stroke,tt=new Fill,it=[],rt=function(nt,st,at){const ot=nt.getProperties(),ct=g[ot.layer];if(!ct)return;let ht=n.indexOf(st);ht==-1&&(ht=getZoomForResolution(st,n)),cameraObj.zoom=ht,cameraObj.distanceFromCenter=0;const ut=nt.getGeometry(),pt=types$1[ut.getType()],yt=s.get("map");if(yt&&yt instanceof Map$1&&pt===1){const Rt=yt.getSize();if(Rt){const Lt=yt.getView().getCenter(),Nt=getCenter(ut.getExtent());cameraObj.distanceFromCenter=distance(Lt,Nt)/st/Rt[1]}}const mt={id:nt.getId(),properties:ot,type:pt},St=s.get("mapbox-featurestate")[nt.getId()];let Pt=-1;for(let Rt=0,Lt=ct.length;Rt<Lt;++Rt){const Nt=ct[Rt],vt=Nt.layer,Et=vt.id;if(at!==void 0&&at!==Et)continue;const Ct=vt.layout||emptyObj,_t=vt.paint||emptyObj;if(Ct.visibility==="none"||"minzoom"in vt&&ht<vt.minzoom||"maxzoom"in vt&&ht>=vt.maxzoom)continue;const dt=vt.filter;if(!dt||evaluateFilter(Et,dt,mt,xe)){let ft,bt,Gt,Ft,Ht,Mt;const It=Nt.index;if(pt==3&&(vt.type=="fill"||vt.type=="fill-extrusion"))if(bt=getValue(vt,"paint",vt.type+"-opacity",mt,te,St),vt.type+"-pattern"in _t){const Ot=getValue(vt,"paint",vt.type+"-pattern",mt,te,St);if(Ot){const kt=typeof Ot=="string"?fromTemplate(Ot,ot):Ot.toString(),Bt=getSpriteImageForIcon(kt,h);if(o&&o[kt]&&Bt){++Pt,Mt=it[Pt],(!Mt||!Mt.getFill()||Mt.getStroke()||Mt.getText())&&(Mt=new Style$1({fill:new Fill}),it[Pt]=Mt),Gt=Mt.getFill(),Mt.setZIndex(It);const jt=kt+"."+bt;let Wt=ee[jt];if(!Wt){const Vt=o[kt],Yt=createCanvas(Vt.width,Vt.height),ti=Yt.getContext("2d");ti.globalAlpha=bt,ti.drawImage(Bt.image,Vt.x,Vt.y,Vt.width,Vt.height,0,0,Vt.width,Vt.height),Wt=ti.createPattern(Yt,"repeat"),ee[jt]=Wt}Gt.setColor(Wt)}}}else ft=colorWithOpacity(getValue(vt,"paint",vt.type+"-color",mt,te,St),bt),vt.type+"-outline-color"in _t&&(Ht=colorWithOpacity(getValue(vt,"paint",vt.type+"-outline-color",mt,te,St),bt)),Ht||(Ht=ft),(ft||Ht)&&(++Pt,Mt=it[Pt],(!Mt||ft&&!Mt.getFill()||!ft&&Mt.getFill()||Ht&&!Mt.getStroke()||!Ht&&Mt.getStroke()||Mt.getText())&&(Mt=new Style$1({fill:ft?new Fill:void 0,stroke:Ht?new Stroke:void 0}),it[Pt]=Mt),ft&&(Gt=Mt.getFill(),Gt.setColor(ft)),Ht&&(Ft=Mt.getStroke(),Ft.setColor(Ht),Ft.setWidth(.5)),Mt.setZIndex(It));if(pt!=1&&vt.type=="line"){"line-pattern"in _t?ft=void 0:ft=colorWithOpacity(getValue(vt,"paint","line-color",mt,te,St),getValue(vt,"paint","line-opacity",mt,te,St));const Ot=getValue(vt,"paint","line-width",mt,te,St);ft&&Ot>0&&(++Pt,Mt=it[Pt],(!Mt||!Mt.getStroke()||Mt.getFill()||Mt.getText())&&(Mt=new Style$1({stroke:new Stroke}),it[Pt]=Mt),Ft=Mt.getStroke(),Ft.setLineCap(getValue(vt,"layout","line-cap",mt,te,St)),Ft.setLineJoin(getValue(vt,"layout","line-join",mt,te,St)),Ft.setMiterLimit(getValue(vt,"layout","line-miter-limit",mt,te,St)),Ft.setColor(ft),Ft.setWidth(Ot),Ft.setLineDash(_t["line-dasharray"]?getValue(vt,"paint","line-dasharray",mt,te,St).map(function(kt){return kt*Ot}):null),Mt.setZIndex(It))}let xt=!1,Tt=null,Ut=0,Dt,$t,Zt;if((pt==1||pt==2)&&"icon-image"in Ct){const Ot=getValue(vt,"layout","icon-image",mt,te,St);if(Ot){Dt=typeof Ot=="string"?fromTemplate(Ot,ot):Ot.toString();let kt;const Bt=u?u(s,Dt):void 0,jt=getSpriteImageForIcon(Dt,h);if(o&&o[Dt]&&jt||Bt){const Wt=getValue(vt,"layout","icon-rotation-alignment",mt,te,St);if(pt==2){const Vt=nt.getGeometry();if(Vt.getFlatMidpoint||Vt.getFlatMidpoints){const Yt=Vt.getExtent();if(Math.sqrt(Math.max(Math.pow((Yt[2]-Yt[0])/st,2),Math.pow((Yt[3]-Yt[1])/st,2)))>150){const ni=Vt.getType()==="MultiLineString"?Vt.getFlatMidpoints():Vt.getFlatMidpoint();if(renderFeature||(renderFeatureCoordinates=[NaN,NaN],renderFeature=new RenderFeature("Point",renderFeatureCoordinates,[],2,{},void 0)),kt=renderFeature,renderFeatureCoordinates[0]=ni[0],renderFeatureCoordinates[1]=ni[1],getValue(vt,"layout","symbol-placement",mt,te,St)==="line"&&Wt==="map"){const ci=Vt.getStride(),hi=Vt.getFlatCoordinates();for(let si=0,Jt=hi.length-ci;si<Jt;si+=ci){const oi=hi[si],ri=hi[si+1],ii=hi[si+ci],pi=hi[si+ci+1],Ci=Math.min(oi,ii),gi=Math.max(oi,ii),_i=ni[0],di=ni[1],xi=(pi-ri)*(_i-oi)-(ii-oi)*(di-ri);if(Math.abs(xi)<.001&&_i<=gi&&_i>=Ci){Ut=Math.atan2(ri-pi,ii-oi);break}}}}}}if(pt!==2||kt){const Vt=getValue(vt,"layout","icon-size",mt,te,St),Yt=_t["icon-color"]!==void 0?getValue(vt,"paint","icon-color",mt,te,St):null;if(!Yt||Yt.a!==0){const ti=getValue(vt,"paint","icon-halo-color",mt,te,St),ni=getValue(vt,"paint","icon-halo-width",mt,te,St);let ui=`${Dt}.${Vt}.${ni}.${ti}`;if(Yt!==null&&(ui+=`.${Yt}`),$t=Y[ui],!$t){const ci=getDeclutterMode(vt,mt,"icon",te);let hi;"icon-offset"in Ct&&(hi=getValue(vt,"layout","icon-offset",mt,te,St).slice(0),hi[0]*=Vt,hi[1]*=-Vt);let si=Yt?[Yt.r*255,Yt.g*255,Yt.b*255,Yt.a]:void 0;if(Bt){const Jt={color:si,rotateWithView:Wt==="map",displacement:hi,declutterMode:ci,scale:Vt};typeof Bt=="string"?Jt.src=Bt:(Jt.img=Bt,Jt.imgSize=[Bt.width,Bt.height]),$t=new Icon(Jt)}else{const Jt=o[Dt];let oi,ri,ii;if(ni)Jt.sdf?(oi=drawIconHalo(drawSDF(jt.image,Jt,Yt||[0,0,0,1]),{x:0,y:0,width:Jt.width,height:Jt.height,pixelRatio:Jt.pixelRatio},ni,ti),si=void 0):oi=drawIconHalo(jt.image,Jt,ni,ti);else{if(Jt.sdf&&!jt.unSDFed){const pi=drawSDF(jt.image,{x:0,y:0,width:jt.size[0],height:jt.size[1]},{r:1,g:1,b:1});jt.image=pi,jt.unSDFed=!0}oi=jt.image,ri=[Jt.width,Jt.height],ii=[Jt.x,Jt.y]}$t=new Icon({color:si,img:oi,imgSize:jt.size,size:ri,offset:ii,rotateWithView:Wt==="map",scale:Vt/Jt.pixelRatio,displacement:hi,declutterMode:ci})}Y[ui]=$t}}$t&&(++Pt,Mt=it[Pt],(!Mt||!Mt.getImage()||Mt.getFill()||Mt.getStroke())&&(Mt=new Style$1,it[Pt]=Mt),Mt.setGeometry(kt),$t.setRotation(Ut+deg2rad(getValue(vt,"layout","icon-rotate",mt,te,St))),$t.setOpacity(getValue(vt,"paint","icon-opacity",mt,te,St)),$t.setAnchor(anchor[getValue(vt,"layout","icon-anchor",mt,te,St)]),Mt.setImage($t),Tt=Mt.getText(),Mt.setText(void 0),Mt.setZIndex(It),xt=!0,Zt=!1)}else Zt=!0}}}if(pt==1&&vt.type==="circle"){++Pt,Mt=it[Pt],(!Mt||!Mt.getImage()||Mt.getFill()||Mt.getStroke())&&(Mt=new Style$1,it[Pt]=Mt);const Ot="circle-radius"in _t?getValue(vt,"paint","circle-radius",mt,te,St):5,kt=colorWithOpacity(getValue(vt,"paint","circle-stroke-color",mt,te,St),getValue(vt,"paint","circle-stroke-opacity",mt,te,St)),Bt=getValue(vt,"paint","circle-translate",mt,te,St),jt=colorWithOpacity(getValue(vt,"paint","circle-color",mt,te,St),getValue(vt,"paint","circle-opacity",mt,te,St)),Wt=getValue(vt,"paint","circle-stroke-width",mt,te,St),Vt=Ot+"."+kt+"."+jt+"."+Wt+"."+Bt[0]+"."+Bt[1];$t=Y[Vt],$t||($t=new CircleStyle({radius:Ot,displacement:[Bt[0],-Bt[1]],stroke:kt&&Wt>0?new Stroke({width:Wt,color:kt}):void 0,fill:jt?new Fill({color:jt}):void 0,declutterMode:"none"}),Y[Vt]=$t),Mt.setImage($t),Tt=Mt.getText(),Mt.setText(void 0),Mt.setGeometry(void 0),Mt.setZIndex(It),xt=!0}let Kt,qt,Xt,zt,ai,wt;if("text-field"in Ct){zt=Math.round(getValue(vt,"layout","text-size",mt,te,St));const Ot=getValue(vt,"layout","text-font",mt,te,St);Xt=getValue(vt,"layout","text-line-height",mt,te,St),qt=mb2css(c?c(Ot,e.metadata?e.metadata["ol:webfonts"]:void 0):Ot,zt,Xt),qt.includes("sans-serif")||(qt+=",sans-serif"),ai=getValue(vt,"layout","text-letter-spacing",mt,te,St),wt=getValue(vt,"layout","text-max-width",mt,te,St);const kt=getValue(vt,"layout","text-field",mt,te,St);typeof kt=="object"&&kt.sections?kt.sections.length===1?Kt=kt.toString():Kt=kt.sections.reduce((Bt,jt,Wt)=>{const Vt=jt.fontStack?jt.fontStack.split(","):Ot,Yt=mb2css(c?c(Vt):Vt,zt*(jt.scale||1),Xt);let ti=jt.text;if(ti===`
`)return Bt.push(`
`,""),Bt;if(pt==2)return Bt.push(applyLetterSpacing(ti,ai),Yt),Bt;ti=wrapText(ti,Yt,wt,ai).split(`
`);for(let ni=0,ui=ti.length;ni<ui;++ni)ni>0&&Bt.push(`
`,""),Bt.push(ti[ni],Yt);return Bt},[]):Kt=fromTemplate(kt,ot).trim(),bt=getValue(vt,"paint","text-opacity",mt,te,St)}if(Kt&&bt&&!Zt){xt||(++Pt,Mt=it[Pt],(!Mt||!Mt.getText()||Mt.getFill()||Mt.getStroke())&&(Mt=new Style$1,it[Pt]=Mt),Mt.setImage(void 0),Mt.setGeometry(void 0));const Ot=getDeclutterMode(vt,mt,"text",te);Mt.getText()||Mt.setText(Tt),Tt=Mt.getText(),(!Tt||"getDeclutterMode"in Tt&&Tt.getDeclutterMode()!==Ot)&&(Tt=new Text({padding:[2,2,2,2],declutterMode:Ot}),Mt.setText(Tt));const kt=getValue(vt,"layout","text-transform",mt,te,St);kt=="uppercase"?Kt=Array.isArray(Kt)?Kt.map((ii,pi)=>pi%2?ii:ii.toUpperCase()):Kt.toUpperCase():kt=="lowercase"&&(Kt=Array.isArray(Kt)?Kt.map((ii,pi)=>pi%2?ii:ii.toLowerCase()):Kt.toLowerCase());const Bt=Array.isArray(Kt)?Kt:pt==2?applyLetterSpacing(Kt,ai):wrapText(Kt,qt,wt,ai);if(Tt.setText(Bt),Tt.setFont(qt),Tt.setRotation(deg2rad(getValue(vt,"layout","text-rotate",mt,te,St))),typeof Tt.setKeepUpright=="function"){const ii=getValue(vt,"layout","text-keep-upright",mt,te,St);Tt.setKeepUpright(ii)}const jt=getValue(vt,"layout","text-anchor",mt,te,St),Wt=xt||pt==1?"point":getValue(vt,"layout","symbol-placement",mt,te,St);let Vt;if(Wt==="line-center"?(Tt.setPlacement("line"),Vt="center"):Tt.setPlacement(Wt),Wt==="line"&&typeof Tt.setRepeat=="function"){const ii=getValue(vt,"layout","symbol-spacing",mt,te,St);Tt.setRepeat(ii*2)}Tt.setOverflow(Wt==="point");let Yt=getValue(vt,"paint","text-halo-width",mt,te,St);const ti=getValue(vt,"layout","text-offset",mt,te,St),ni=getValue(vt,"paint","text-translate",mt,te,St);let ui=0,ci=0;if(Wt=="point"){Vt="center",jt.indexOf("left")!==-1?(Vt="left",ci=Yt):jt.indexOf("right")!==-1&&(Vt="right",ci=-Yt);const ii=getValue(vt,"layout","text-rotation-alignment",mt,te,St);Tt.setRotateWithView(ii=="map")}else Tt.setMaxAngle(deg2rad(getValue(vt,"layout","text-max-angle",mt,te,St))*Kt.length/Bt.length),Tt.setRotateWithView(!1);Tt.setTextAlign(Vt);let hi="middle";jt.indexOf("bottom")==0?(hi="bottom",ui=-Yt-.5*(Xt-1)*zt):jt.indexOf("top")==0&&(hi="top",ui=Yt+.5*(Xt-1)*zt),Tt.setTextBaseline(hi);const si=getValue(vt,"layout","text-justify",mt,te,St);Tt.setJustify(si==="auto"?void 0:si),Tt.setOffsetX(ti[0]*zt+ci+ni[0]),Tt.setOffsetY(ti[1]*zt+ui+ni[1]),tt.setColor(colorWithOpacity(getValue(vt,"paint","text-color",mt,te,St),bt)),Tt.setFill(tt);const Jt=colorWithOpacity(getValue(vt,"paint","text-halo-color",mt,te,St),bt);if(Jt&&Yt>0){et.setColor(Jt),Yt*=2;const ii=.5*zt;et.setWidth(Yt<=ii?Yt:ii),Tt.setStroke(et)}else Tt.setStroke(void 0);const oi=getValue(vt,"layout","text-padding",mt,te,St),ri=Tt.getPadding();oi!==ri[0]&&(ri[0]=oi,ri[1]=oi,ri[2]=oi,ri[3]=oi),Mt.setZIndex(It)}}}if(Pt>-1)return it.length=Pt+1,it};return s.setStyle(rt),s.set("mapbox-layers",H),s.set("mapbox-source",ne),s.set("mapbox-featurestate",s.get("mapbox-featurestate")||{}),rt}function getTileResolutions(s,e=512){return s.getExtent()?createXYZ({extent:s.getExtent(),tileSize:e,maxZoom:22}).getResolutions():defaultResolutions}function completeOptions(s,e){return e.accessToken||(e=Object.assign({},e),new URL(s).searchParams.forEach((n,o)=>{e.accessToken=n,e.accessTokenParam=o})),e}function applyStyle(s,e,i="",n={},o=void 0){let l,c,u,h,f=!0;return typeof i!="string"&&!Array.isArray(i)?(u=i,h=u.source||u.layers,n=u):h=i,typeof n=="string"?(l=n,u={}):(l=n.styleUrl,u=n),u.updateSource===!1&&(f=!1),o||(o=u.resolutions),!l&&typeof e=="string"&&!e.trim().startsWith("{")&&(l=e),l&&(l=l.startsWith("data:")?location.href:normalizeStyleUrl(l,u.accessToken),u=completeOptions(l,u)),new Promise(function(g,H){getGlStyle(e,u).then(function(Y){if(Y.version!=8)return H(new Error("glStyle version 8 required."));if(!(s instanceof VectorLayer||s instanceof VectorTileLayer))return H(new Error("Can only apply to VectorLayer or VectorTileLayer"));const ee=s instanceof VectorTileLayer?"vector":"geojson";if(h?Array.isArray(h)?c=Y.layers.find(function(rt){return rt.id===h[0]}).source:c=h:(c=Y.layers.find(function(rt){return rt.source&&Y.sources[rt.source].type===ee}).source,h=c),!c)return H(new Error(`No ${ee} source found in the glStyle.`));function te(){if(!f)return Promise.resolve();if(s instanceof VectorTileLayer)return setupVectorSource(Y.sources[c],l,u).then(function(at){const ot=s.getSource();ot?at!==ot&&(ot.setTileUrlFunction(at.getTileUrlFunction()),typeof ot.setUrls=="function"&&typeof at.getUrls=="function"&&ot.setUrls(at.getUrls()),ot.format_||(ot.format_=at.format_),ot.getAttributions()||ot.setAttributions(at.getAttributions()),ot.getTileLoadFunction()===defaultLoadFunction&&ot.setTileLoadFunction(at.getTileLoadFunction()),equivalent$1(ot.getProjection(),at.getProjection())&&(ot.tileGrid=at.getTileGrid())):s.setSource(at);const ct=s.getSource().getTileGrid();!isFinite(s.getMaxResolution())&&!isFinite(s.getMinZoom())&&ct.getMinZoom()>0&&s.setMaxResolution(getResolutionForZoom(Math.max(0,ct.getMinZoom()-1e-12),ct.getResolutions()))});const rt=Y.sources[c];let nt=s.getSource();(!nt||nt.get("mapbox-source")!==rt)&&(nt=setupGeoJSONSource(rt,l,u));const st=s.getSource();return st?nt!==st&&(st.getAttributions()||st.setAttributions(nt.getAttributions()),st.format_||(st.format_=nt.getFormat()),st.url_=nt.getUrl()):s.setSource(nt),Promise.resolve()}let xe,ne;const et={},tt={};function it(){if(!ne&&(!Y.sprite||et)){if(u.projection&&!o){const nt=get$3(u.projection).getUnits();nt!=="m"&&(o=defaultResolutions.map(st=>st/METERS_PER_UNIT[nt]))}ne=stylefunction(s,Y,h,o,et,tt,(rt,nt=u.webfonts)=>getFonts(rt,nt),u.getImage),s.getStyle()?te().then(g).catch(H):H(new Error(`Nothing to show for source [${c}]`))}else ne?(s.setStyle(ne),te().then(g).catch(H)):H(new Error("Something went wrong trying to apply style."))}if(Y.sprite){const rt=normalizeSpriteDefinition(Y.sprite,u.accessToken,l||location.href);xe=window.devicePixelRatio>=1.5?.5:1;const nt=xe==.5?"@2x":"";Promise.all(rt.map(function(st){const at=new URL(st.url);let ot=at.origin+at.pathname+nt+".json"+at.search;return new Promise(function(ct,ht){fetchResource("Sprite",ot,u).then(ct).catch(function(ut){ot=at.origin+at.pathname+".json"+at.search,fetchResource("Sprite",ot,u).then(ct).catch(ht)})}).then(function(ct){ct===void 0&&H(new Error("No sprites found."));let ht;if(ht=at.origin+at.pathname+nt+".png"+at.search,u.transformRequest){const ut=u.transformRequest(ht,"SpriteImage")||ht;(ut instanceof Request||ut instanceof Promise)&&(ht=ut)}tt[st.id]=ht;for(const ut in ct){const pt=st.id=="default"?ut:`${st.id}:${ut}`;et[pt]=ct[ut]}}).catch(function(ct){H(new Error(`Sprites cannot be loaded: ${ot}: ${ct.message}`))})})).then(it).catch(H)}else it()}).catch(H)})}function extentFromTileJSON(s,e){const i=s.bounds;if(i){const n=fromLonLat([i[0],i[1]],e),o=fromLonLat([i[2],i[3]],e);return[n[0],n[1],o[0],o[1]]}return get$3(e).getExtent()}function sourceOptionsFromTileJSON(s,e,i){const n=new TileJSON({tileJSON:e,tileSize:s.tileSize||e.tileSize||512}),o=n.getTileJSON(),l=n.getTileGrid(),c=get$3(i.projection||"EPSG:3857"),u=extentFromTileJSON(o,c),h=c.getExtent(),f=o.minzoom||0,g=o.maxzoom||22,H={attributions:n.getAttributions(),projection:c,tileGrid:new TileGrid({origin:h?getTopLeft(h):l.getOrigin(0),extent:u||l.getExtent(),minZoom:f,resolutions:getTileResolutions(c,e.tileSize).slice(0,g+1),tileSize:l.getTileSize(0)})};return Array.isArray(o.tiles)?H.urls=o.tiles:H.url=o.tiles,H}function setupVectorSource(s,e,i){return new Promise(function(n,o){getTileJson(s,e,i).then(function({tileJson:l,tileLoadFunction:c}){const u=sourceOptionsFromTileJSON(s,l,i);u.tileLoadFunction=c,u.format=new MVT;const h=new VectorTile(u);h.set("mapbox-source",s),n(h)}).catch(o)})}function getBboxTemplate(s){return`{bbox-${(s?s.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function setupGeoJSONSource(s,e,i){const n=i.projection?new GeoJSON$1({dataProjection:i.projection}):new GeoJSON$1,o=s.data,l={};if(typeof o=="string"){const[u]=normalizeSourceUrl(o,i.accessToken,i.accessTokenParam||"access_token",e||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(u)){const f=(H,Y,ee)=>{const te=getBboxTemplate(ee);return u.replace(te,`${H.join(",")}`)},g=new VectorSource({attributions:s.attribution,format:n,loader:(H,Y,ee,te,xe)=>{const ne=typeof f=="function"?f(H,Y,ee):f;fetchResource("GeoJSON",ne,i).then(et=>{const tt=g.getFormat().readFeatures(et,{featureProjection:ee});g.addFeatures(tt),te(tt)}).catch(et=>{g.removeLoadedExtent(H),xe()})},strategy:bbox});return g.set("mapbox-source",s),g}const h=new VectorSource({attributions:s.attribution,format:n,url:u,loader:(f,g,H,Y,ee)=>{fetchResource("GeoJSON",u,i).then(te=>{const xe=h.getFormat().readFeatures(te,{featureProjection:H});h.addFeatures(xe),Y(xe)}).catch(te=>{h.removeLoadedExtent(f),ee()})}});return h}l.features=n.readFeatures(o,{featureProjection:"EPSG:3857"});const c=new VectorSource(Object.assign({attributions:s.attribution,format:n},l));return c.set("mapbox-source",s),c}function updateMapboxLayer(s,e){const i=s.get("mapbox-style"),n=i.layers,o=n.findIndex(function(u){return u.id===e.id});if(o===-1)throw new Error(`Layer with id "${e.id}" not found.`);if(n[o].source!==e.source)throw new Error("Updated layer and previous version must use the same source.");delete getFunctionCache(i)[e.id],delete getFilterCache(i)[e.id],n[o]=e;const c=styleFunctionArgs[getStyleFunctionKey(s.get("mapbox-style"),getLayer(s,e.id))];c?stylefunction.apply(void 0,c):getLayer(s,e.id).changed()}function getLayer(s,e){const i=s.getLayers().getArray();for(let n=0,o=i.length;n<o;++n){const l=i[n].get("mapbox-layers");if(l&&l.indexOf(e)!==-1)return i[n]}}class LayerMapBox extends VectorTileLayer{constructor(e,i){if(!e.layer)throw new Error("ERROR PARAM_MISSING : layer");if(typeof e.layer!="string")throw new Error("ERROR WRONG TYPE : layer");typeof e.ssl>"u"&&(e.ssl=!0);var n=e.ssl===!1?"http://":"https://",o=e.configuration;if(!o){if(!Config.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers.");var l=e.layer+"$GEOPORTAIL:GPP:TMS";if(o=Config.configuration.getLayerConf(l),!o)throw new Error("ERROR : Layer ID not found into the catalogue !?")}for(var c=null,u="",h=e.style,f=0;f<o.styles.length;f++){var g=o.styles[f];if(h&&g.name===h){c=g.url,u=g.title;break}else if(!h&&g.current){h=g.name,c=g.url,u=g.title;break}}if(!c)throw new Error("ERROR : Style URL not found !?");c.replace(/(http|https):\/\//,n);var H=new VectorTile({state:"loading",format:new MVT});H._originators=o.originators,H._legends=o.legends,H._metadata=o.metadata,H._description=o.description,H._title=o.title+" ("+u+")",H._quicklookUrl=o.quicklookUrl;var Y={source:H};return Helper.mergeParams(Y,i),e.olParams&&!o.originators&&(H._originators=e.olParams.attributions),super(Y),this.name=e.layer,this.service="TMS",this.protocol=n,this.sourceId=e.source,this.styleUrl=c,this.styleName=h,this.config=o,this.setStyleMapBox(),this}setStyleMapBox(){var e=this;fetch(this.styleUrl,{credentials:"same-origin"}).then(function(i){i.ok&&i.json().then(function(n){e.onStyleMapBoxLoad(n)})}).catch(function(i){e.onStyleMapBoxError(i)})}onStyleMapBoxLoad(e){this.sourceId||(this.sourceId=Object.keys(e.sources)[0]);var i=e.sources[this.sourceId];if(!i){this.onStyleMapBoxError({message:"ERROR : Source ID not found !? !"});return}if(i.type!=="vector"){this.onStyleMapBoxError({message:"ERROR : Source TYPE not permitted !"});return}var n=this.getSource();if(i.url){i.url.replace(/(http|https):\/\//,this.protocol);var o=new TileJSON({url:i.url}),l=this,c=o.on("change",function(){if(o.getState()==="ready"){var h=o.getTileJSON();if(!h)return;l.set("mapbox-extensions",h);for(var f=Array.isArray(h.tiles)?h.tiles:[h.tiles],g=0;g<i.tiles.length;g++)f[g].replace(/(http|https):\/\//,this.protocol);n.setUrls(f),unByKey(c)}})}if(i.tiles){for(var u=0;u<i.tiles.length;u++)i.tiles[u].replace(/(http|https):\/\//,this.protocol);n.setUrls(i.tiles)}applyStyle(this,e,this.sourceId).then(()=>{n.setState("ready"),this.set("mapbox-styles",e)}).then(()=>{this.dispatchEvent({type:"mapbox:style:loaded",style:this.styleUrl,name:this.styleName})}).catch(h=>{this.onStyleMapBoxError(h)})}onStyleMapBoxError(e){var i=this.getSource();i.setState("error"),console.error(e.message)}getConfiguration(){return this.config}getLegends(){return this.getSource()._legends}getMetadata(){return this.getSource()._metadata}getDescription(){return this.getSource()._description}getTitle(){return this.getSource()._title}getQuicklookUrl(){return this.getSource()._quicklookUrl}getOriginators(){return this.getSource()._originators}}window.ol&&window.ol.layer&&(window.ol.layer.GeoportalMapBox=LayerMapBox);const exceptions=["GPoverviewMap","GPfullScreen"];function getSameSideOpenedPanel(s,e){var i=[...exceptions,e],n=[];if(s&&s.includes("left")){var o=document.getElementById("position-container-bottom-left"),l=document.getElementById("position-container-top-left");n=[...o.children,...l.children]}if(s&&s.includes("right")){var c=document.getElementById("position-container-bottom-right"),u=document.getElementById("position-container-top-right");n=[...c.children,...u.children]}return n.filter(h=>{var f=h.id.match(/(\w+)-[0-9]+/)[1],g=i.includes(f),H=h.getElementsByTagName("button")[0].getAttribute("aria-pressed");if(H==="true"&&!g)return h})}var PanelManager=function(s,e){var i=getSameSideOpenedPanel(s,e);i.length>0&&i[0].getElementsByTagName("button")[0].click()},Widget={onPanelOpen:function(){PanelManager(this.options.position,this.element.id.match(/(\w+)-[0-9]+/)[1])}},checkDsfr=function(){var s=getComputedStyle(document.documentElement),e=s.getPropertyValue("--blue-france-sun-113-625");return e!==""};class ControlExtended extends Control{constructor(e){e=e||{},super({element:e.element,target:e.target,render:e.render}),e&&e.listable?this.listable=!0:this.listable=!1,e&&e.description?this.description=e.description:this.description=""}setPosition(e){if(this.getMap()){var i=new PositionFactory(this);i.set(e)}}updatePosition(e){if(this.getMap()){var i=new PositionFactory(this);i.update(e)}}}const ANCHORS=["top-left","top-right","bottom-left","bottom-right"];var bi,Ki,Oi,Bi;class PositionFactory{constructor(e){Ui(this,bi);return this.caller=e,this.container=null,Li(this,bi,Oi).call(this,"top-left"),Li(this,bi,Oi).call(this,"top-right"),Li(this,bi,Oi).call(this,"bottom-left"),Li(this,bi,Oi).call(this,"bottom-right"),this}set(e){ANCHORS.includes(e.toLowerCase())&&(Li(this,bi,Bi).call(this,e,!1),e.includes("bottom")?this.container.children["position-container-"+e].prepend(this.caller.element):this.container.children["position-container-"+e].appendChild(this.caller.element))}update(e){ANCHORS.includes(e.toLowerCase())&&Li(this,bi,Bi).call(this,e,!0)}}bi=new WeakSet,Ki=function(e){var i=this.container.children["position-container-"+e];return!!i},Oi=function(e){if(this.container=this.caller.getMap().getOverlayContainerStopEvent(),!Li(this,bi,Ki).call(this,e)){var i=document.createElement("div");i.id="position-container-"+e,i.className="position position-container-"+e,this.container.appendChild(i)}},Bi=function(e,i){var n=this;const o=g=>{var H=n.container.children["position-container-"+g];return H.children.length},l=g=>{var H=n.container.children["position-container-"+g],Y=H.offsetWidth;return Y},c=g=>{var H=n.container.children["position-container-"+g],Y=H.offsetHeight;if(i){g.includes("top")&&(Y=0);for(let ee=0;ee<H.children.length;ee++){if(H.children[ee].id===n.caller.element.id){Y=g.includes("bottom")?Y-n.caller.element.offsetHeight:Y*-1;break}Y-=H.children[ee].offsetHeight}}return Y},u=g=>{g.style.top="unset",g.style.bottom="unset",g.style.left="unset",g.style.right="unset"};u(this.caller.element),this.caller.element.style.position="unset";var h=Array.from(this.caller.element.getElementsByClassName("GPpanel"));if(h.length!==0){var f=0;h.forEach(g=>{if(g.nodeName.toLowerCase()==="dialog"){switch(u(g),e.toLowerCase()){case"top-left":checkDsfr()?g.style.top="0px":g.style.top=o(e)?c(e)+"px":"0px",g.style.left=l(e)+f+"px";break;case"bottom-left":checkDsfr()?g.style.top="0px":g.style.bottom=o(e)?c(e)+"px":"0px",g.style.left=l(e)+f+"px";break;case"top-right":checkDsfr()?g.style.top="0px":g.style.top=o(e)?c(e)+"px":"0px",g.style.right=l(e)+f+"px";break;case"bottom-right":checkDsfr()?g.style.top="0px":g.style.bottom=o(e)?c(e)+"px":"0px",g.style.right=l(e)+f+"px";break}f+=g.offsetWidth}})}};var SelectorID={generate:(function(){var s=Math.floor(Date.now());return function(){return s++}})(),name:function(s){var e=null,i=s.lastIndexOf("-");return i===-1?e=s:e=s.substring(0,i),e},index:function(s){var e=null,i=this.name(s),n=i.lastIndexOf("_");return n!==-1&&(e=i.substring(n+1)),e},uuid:function(s){var e=null,i=s.lastIndexOf("-");return i!==-1&&(e=parseInt(s.substring(i+1),10)),e}},ToolTips={id:"gpf-tooltips-html",init:function(s={}){if(document.getElementById(this.id))return;const e=document.createElement("div");e.id=this.id,Object.assign(e.style,s),document.body.appendChild(e)},active:function(s){var e=this,i=s.getAttribute("data-tooltip");i&&(s.addEventListener("mouseenter",n=>{var o=document.getElementById(e.id);if(!o)return;o.innerHTML=i;const l=s.getBoundingClientRect();o.style.top=`${l.top-o.offsetHeight-10}px`,o.style.left=`${l.left+l.width/2}px`,o.style.transform="translateX(-50%)",o.style.opacity="1"}),s.addEventListener("mouseleave",()=>{var n=document.getElementById(e.id);n&&(n.style.opacity="0")}))}};/**!
 * Sortable 1.15.3
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function ownKeys(s,e){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(s,o).enumerable})),i.push.apply(i,n)}return i}function _objectSpread2(s){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?ownKeys(Object(i),!0).forEach(function(n){_defineProperty(s,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(function(n){Object.defineProperty(s,n,Object.getOwnPropertyDescriptor(i,n))})}return s}function _typeof(s){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof=function(e){return typeof e}:_typeof=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(s)}function _defineProperty(s,e,i){return e in s?Object.defineProperty(s,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[e]=i,s}function _extends(){return _extends=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(s[n]=i[n])}return s},_extends.apply(this,arguments)}function _objectWithoutPropertiesLoose(s,e){if(s==null)return{};var i={},n=Object.keys(s),o,l;for(l=0;l<n.length;l++)o=n[l],!(e.indexOf(o)>=0)&&(i[o]=s[o]);return i}function _objectWithoutProperties(s,e){if(s==null)return{};var i=_objectWithoutPropertiesLoose(s,e),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(s);for(o=0;o<l.length;o++)n=l[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(s,n)&&(i[n]=s[n])}return i}var version="1.15.3";function userAgent(s){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(s)}var IE11OrLess=userAgent(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Edge=userAgent(/Edge/i),FireFox=userAgent(/firefox/i),Safari=userAgent(/safari/i)&&!userAgent(/chrome/i)&&!userAgent(/android/i),IOS=userAgent(/iP(ad|od|hone)/i),ChromeForAndroid=userAgent(/chrome/i)&&userAgent(/android/i),captureMode={capture:!1,passive:!1};function on(s,e,i){s.addEventListener(e,i,!IE11OrLess&&captureMode)}function off(s,e,i){s.removeEventListener(e,i,!IE11OrLess&&captureMode)}function matches(s,e){if(e){if(e[0]===">"&&(e=e.substring(1)),s)try{if(s.matches)return s.matches(e);if(s.msMatchesSelector)return s.msMatchesSelector(e);if(s.webkitMatchesSelector)return s.webkitMatchesSelector(e)}catch{return!1}return!1}}function getParentOrHost(s){return s.host&&s!==document&&s.host.nodeType?s.host:s.parentNode}function closest(s,e,i,n){if(s){i=i||document;do{if(e!=null&&(e[0]===">"?s.parentNode===i&&matches(s,e):matches(s,e))||n&&s===i)return s;if(s===i)break}while(s=getParentOrHost(s))}return null}var R_SPACE=/\s+/g;function toggleClass(s,e,i){if(s&&e)if(s.classList)s.classList[i?"add":"remove"](e);else{var n=(" "+s.className+" ").replace(R_SPACE," ").replace(" "+e+" "," ");s.className=(n+(i?" "+e:"")).replace(R_SPACE," ")}}function css(s,e,i){var n=s&&s.style;if(n){if(i===void 0)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(s,""):s.currentStyle&&(i=s.currentStyle),e===void 0?i:i[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=i+(typeof i=="string"?"":"px")}}function matrix(s,e){var i="";if(typeof s=="string")i=s;else do{var n=css(s,"transform");n&&n!=="none"&&(i=n+" "+i)}while(!e&&(s=s.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(i)}function find(s,e,i){if(s){var n=s.getElementsByTagName(e),o=0,l=n.length;if(i)for(;o<l;o++)i(n[o],o);return n}return[]}function getWindowScrollingElement(){var s=document.scrollingElement;return s||document.documentElement}function getRect(s,e,i,n,o){if(!(!s.getBoundingClientRect&&s!==window)){var l,c,u,h,f,g,H;if(s!==window&&s.parentNode&&s!==getWindowScrollingElement()?(l=s.getBoundingClientRect(),c=l.top,u=l.left,h=l.bottom,f=l.right,g=l.height,H=l.width):(c=0,u=0,h=window.innerHeight,f=window.innerWidth,g=window.innerHeight,H=window.innerWidth),(e||i)&&s!==window&&(o=o||s.parentNode,!IE11OrLess))do if(o&&o.getBoundingClientRect&&(css(o,"transform")!=="none"||i&&css(o,"position")!=="static")){var Y=o.getBoundingClientRect();c-=Y.top+parseInt(css(o,"border-top-width")),u-=Y.left+parseInt(css(o,"border-left-width")),h=c+l.height,f=u+l.width;break}while(o=o.parentNode);if(n&&s!==window){var ee=matrix(o||s),te=ee&&ee.a,xe=ee&&ee.d;ee&&(c/=xe,u/=te,H/=te,g/=xe,h=c+g,f=u+H)}return{top:c,left:u,bottom:h,right:f,width:H,height:g}}}function isScrolledPast(s,e,i){for(var n=getParentAutoScrollElement(s,!0),o=getRect(s)[e];n;){var l=getRect(n)[i],c=void 0;if(c=o>=l,!c)return n;if(n===getWindowScrollingElement())break;n=getParentAutoScrollElement(n,!1)}return!1}function getChild(s,e,i,n){for(var o=0,l=0,c=s.children;l<c.length;){if(c[l].style.display!=="none"&&c[l]!==Sortable.ghost&&(n||c[l]!==Sortable.dragged)&&closest(c[l],i.draggable,s,!1)){if(o===e)return c[l];o++}l++}return null}function lastChild(s,e){for(var i=s.lastElementChild;i&&(i===Sortable.ghost||css(i,"display")==="none"||e&&!matches(i,e));)i=i.previousElementSibling;return i||null}function index(s,e){var i=0;if(!s||!s.parentNode)return-1;for(;s=s.previousElementSibling;)s.nodeName.toUpperCase()!=="TEMPLATE"&&s!==Sortable.clone&&(!e||matches(s,e))&&i++;return i}function getRelativeScrollOffset(s){var e=0,i=0,n=getWindowScrollingElement();if(s)do{var o=matrix(s),l=o.a,c=o.d;e+=s.scrollLeft*l,i+=s.scrollTop*c}while(s!==n&&(s=s.parentNode));return[e,i]}function indexOfObject(s,e){for(var i in s)if(s.hasOwnProperty(i)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===s[i][n])return Number(i)}return-1}function getParentAutoScrollElement(s,e){if(!s||!s.getBoundingClientRect)return getWindowScrollingElement();var i=s,n=!1;do if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var o=css(i);if(i.clientWidth<i.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||i.clientHeight<i.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!i.getBoundingClientRect||i===document.body)return getWindowScrollingElement();if(n||e)return i;n=!0}}while(i=i.parentNode);return getWindowScrollingElement()}function extend$1(s,e){if(s&&e)for(var i in e)e.hasOwnProperty(i)&&(s[i]=e[i]);return s}function isRectEqual(s,e){return Math.round(s.top)===Math.round(e.top)&&Math.round(s.left)===Math.round(e.left)&&Math.round(s.height)===Math.round(e.height)&&Math.round(s.width)===Math.round(e.width)}var _throttleTimeout;function throttle(s,e){return function(){if(!_throttleTimeout){var i=arguments,n=this;i.length===1?s.call(n,i[0]):s.apply(n,i),_throttleTimeout=setTimeout(function(){_throttleTimeout=void 0},e)}}}function cancelThrottle(){clearTimeout(_throttleTimeout),_throttleTimeout=void 0}function scrollBy(s,e,i){s.scrollLeft+=e,s.scrollTop+=i}function clone(s){var e=window.Polymer,i=window.jQuery||window.Zepto;return e&&e.dom?e.dom(s).cloneNode(!0):i?i(s).clone(!0)[0]:s.cloneNode(!0)}function getChildContainingRectFromElement(s,e,i){var n={};return Array.from(s.children).forEach(function(o){var l,c,u,h;if(!(!closest(o,e.draggable,s,!1)||o.animated||o===i)){var f=getRect(o);n.left=Math.min((l=n.left)!==null&&l!==void 0?l:1/0,f.left),n.top=Math.min((c=n.top)!==null&&c!==void 0?c:1/0,f.top),n.right=Math.max((u=n.right)!==null&&u!==void 0?u:-1/0,f.right),n.bottom=Math.max((h=n.bottom)!==null&&h!==void 0?h:-1/0,f.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var expando="Sortable"+new Date().getTime();function AnimationStateManager(){var s=[],e;return{captureAnimationState:function(){if(s=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(o){if(!(css(o,"display")==="none"||o===Sortable.ghost)){s.push({target:o,rect:getRect(o)});var l=_objectSpread2({},s[s.length-1].rect);if(o.thisAnimationDuration){var c=matrix(o,!0);c&&(l.top-=c.f,l.left-=c.e)}o.fromRect=l}})}},addAnimationState:function(n){s.push(n)},removeAnimationState:function(n){s.splice(indexOfObject(s,{target:n}),1)},animateAll:function(n){var o=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var l=!1,c=0;s.forEach(function(u){var h=0,f=u.target,g=f.fromRect,H=getRect(f),Y=f.prevFromRect,ee=f.prevToRect,te=u.rect,xe=matrix(f,!0);xe&&(H.top-=xe.f,H.left-=xe.e),f.toRect=H,f.thisAnimationDuration&&isRectEqual(Y,H)&&!isRectEqual(g,H)&&(te.top-H.top)/(te.left-H.left)===(g.top-H.top)/(g.left-H.left)&&(h=calculateRealTime(te,Y,ee,o.options)),isRectEqual(H,g)||(f.prevFromRect=g,f.prevToRect=H,h||(h=o.options.animation),o.animate(f,te,H,h)),h&&(l=!0,c=Math.max(c,h),clearTimeout(f.animationResetTimer),f.animationResetTimer=setTimeout(function(){f.animationTime=0,f.prevFromRect=null,f.fromRect=null,f.prevToRect=null,f.thisAnimationDuration=null},h),f.thisAnimationDuration=h)}),clearTimeout(e),l?e=setTimeout(function(){typeof n=="function"&&n()},c):typeof n=="function"&&n(),s=[]},animate:function(n,o,l,c){if(c){css(n,"transition",""),css(n,"transform","");var u=matrix(this.el),h=u&&u.a,f=u&&u.d,g=(o.left-l.left)/(h||1),H=(o.top-l.top)/(f||1);n.animatingX=!!g,n.animatingY=!!H,css(n,"transform","translate3d("+g+"px,"+H+"px,0)"),this.forRepaintDummy=repaint(n),css(n,"transition","transform "+c+"ms"+(this.options.easing?" "+this.options.easing:"")),css(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){css(n,"transition",""),css(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},c)}}}}function repaint(s){return s.offsetWidth}function calculateRealTime(s,e,i,n){return Math.sqrt(Math.pow(e.top-s.top,2)+Math.pow(e.left-s.left,2))/Math.sqrt(Math.pow(e.top-i.top,2)+Math.pow(e.left-i.left,2))*n.animation}var plugins=[],defaults$1={initializeByDefault:!0},PluginManager={mount:function(e){for(var i in defaults$1)defaults$1.hasOwnProperty(i)&&!(i in e)&&(e[i]=defaults$1[i]);plugins.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),plugins.push(e)},pluginEvent:function(e,i,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var l=e+"Global";plugins.forEach(function(c){i[c.pluginName]&&(i[c.pluginName][l]&&i[c.pluginName][l](_objectSpread2({sortable:i},n)),i.options[c.pluginName]&&i[c.pluginName][e]&&i[c.pluginName][e](_objectSpread2({sortable:i},n)))})},initializePlugins:function(e,i,n,o){plugins.forEach(function(u){var h=u.pluginName;if(!(!e.options[h]&&!u.initializeByDefault)){var f=new u(e,i,e.options);f.sortable=e,f.options=e.options,e[h]=f,_extends(n,f.defaults)}});for(var l in e.options)if(e.options.hasOwnProperty(l)){var c=this.modifyOption(e,l,e.options[l]);typeof c<"u"&&(e.options[l]=c)}},getEventProperties:function(e,i){var n={};return plugins.forEach(function(o){typeof o.eventProperties=="function"&&_extends(n,o.eventProperties.call(i[o.pluginName],e))}),n},modifyOption:function(e,i,n){var o;return plugins.forEach(function(l){e[l.pluginName]&&l.optionListeners&&typeof l.optionListeners[i]=="function"&&(o=l.optionListeners[i].call(e[l.pluginName],n))}),o}};function dispatchEvent(s){var e=s.sortable,i=s.rootEl,n=s.name,o=s.targetEl,l=s.cloneEl,c=s.toEl,u=s.fromEl,h=s.oldIndex,f=s.newIndex,g=s.oldDraggableIndex,H=s.newDraggableIndex,Y=s.originalEvent,ee=s.putSortable,te=s.extraEventProperties;if(e=e||i&&i[expando],!!e){var xe,ne=e.options,et="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!IE11OrLess&&!Edge?xe=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(xe=document.createEvent("Event"),xe.initEvent(n,!0,!0)),xe.to=c||i,xe.from=u||i,xe.item=o||i,xe.clone=l,xe.oldIndex=h,xe.newIndex=f,xe.oldDraggableIndex=g,xe.newDraggableIndex=H,xe.originalEvent=Y,xe.pullMode=ee?ee.lastPutMode:void 0;var tt=_objectSpread2(_objectSpread2({},te),PluginManager.getEventProperties(n,e));for(var it in tt)xe[it]=tt[it];i&&i.dispatchEvent(xe),ne[et]&&ne[et].call(e,xe)}}var _excluded=["evt"],pluginEvent=function(e,i){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=n.evt,l=_objectWithoutProperties(n,_excluded);PluginManager.pluginEvent.bind(Sortable)(e,i,_objectSpread2({dragEl,parentEl,ghostEl,rootEl,nextEl,lastDownEl,cloneEl,cloneHidden,dragStarted:moved,putSortable,activeSortable:Sortable.active,originalEvent:o,oldIndex,oldDraggableIndex,newIndex,newDraggableIndex,hideGhostForTarget:_hideGhostForTarget,unhideGhostForTarget:_unhideGhostForTarget,cloneNowHidden:function(){cloneHidden=!0},cloneNowShown:function(){cloneHidden=!1},dispatchSortableEvent:function(u){_dispatchEvent({sortable:i,name:u,originalEvent:o})}},l))};function _dispatchEvent(s){dispatchEvent(_objectSpread2({putSortable,cloneEl,targetEl:dragEl,rootEl,oldIndex,oldDraggableIndex,newIndex,newDraggableIndex},s))}var dragEl,parentEl,ghostEl,rootEl,nextEl,lastDownEl,cloneEl,cloneHidden,oldIndex,newIndex,oldDraggableIndex,newDraggableIndex,activeGroup,putSortable,awaitingDragStarted=!1,ignoreNextClick=!1,sortables=[],tapEvt,touchEvt,lastDx,lastDy,tapDistanceLeft,tapDistanceTop,moved,lastTarget,lastDirection,pastFirstInvertThresh=!1,isCircumstantialInvert=!1,targetMoveDistance,ghostRelativeParent,ghostRelativeParentInitialScroll=[],_silent=!1,savedInputChecked=[],documentExists=typeof document<"u",PositionGhostAbsolutely=IOS,CSSFloatProperty=Edge||IE11OrLess?"cssFloat":"float",supportDraggable=documentExists&&!ChromeForAndroid&&!IOS&&"draggable"in document.createElement("div"),supportCssPointerEvents=(function(){if(documentExists){if(IE11OrLess)return!1;var s=document.createElement("x");return s.style.cssText="pointer-events:auto",s.style.pointerEvents==="auto"}})(),_detectDirection=function(e,i){var n=css(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),l=getChild(e,0,i),c=getChild(e,1,i),u=l&&css(l),h=c&&css(c),f=u&&parseInt(u.marginLeft)+parseInt(u.marginRight)+getRect(l).width,g=h&&parseInt(h.marginLeft)+parseInt(h.marginRight)+getRect(c).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(l&&u.float&&u.float!=="none"){var H=u.float==="left"?"left":"right";return c&&(h.clear==="both"||h.clear===H)?"vertical":"horizontal"}return l&&(u.display==="block"||u.display==="flex"||u.display==="table"||u.display==="grid"||f>=o&&n[CSSFloatProperty]==="none"||c&&n[CSSFloatProperty]==="none"&&f+g>o)?"vertical":"horizontal"},_dragElInRowColumn=function(e,i,n){var o=n?e.left:e.top,l=n?e.right:e.bottom,c=n?e.width:e.height,u=n?i.left:i.top,h=n?i.right:i.bottom,f=n?i.width:i.height;return o===u||l===h||o+c/2===u+f/2},_detectNearestEmptySortable=function(e,i){var n;return sortables.some(function(o){var l=o[expando].options.emptyInsertThreshold;if(!(!l||lastChild(o))){var c=getRect(o),u=e>=c.left-l&&e<=c.right+l,h=i>=c.top-l&&i<=c.bottom+l;if(u&&h)return n=o}}),n},_prepareGroup=function(e){function i(l,c){return function(u,h,f,g){var H=u.options.group.name&&h.options.group.name&&u.options.group.name===h.options.group.name;if(l==null&&(c||H))return!0;if(l==null||l===!1)return!1;if(c&&l==="clone")return l;if(typeof l=="function")return i(l(u,h,f,g),c)(u,h,f,g);var Y=(c?u:h).options.group.name;return l===!0||typeof l=="string"&&l===Y||l.join&&l.indexOf(Y)>-1}}var n={},o=e.group;(!o||_typeof(o)!="object")&&(o={name:o}),n.name=o.name,n.checkPull=i(o.pull,!0),n.checkPut=i(o.put),n.revertClone=o.revertClone,e.group=n},_hideGhostForTarget=function(){!supportCssPointerEvents&&ghostEl&&css(ghostEl,"display","none")},_unhideGhostForTarget=function(){!supportCssPointerEvents&&ghostEl&&css(ghostEl,"display","")};documentExists&&!ChromeForAndroid&&document.addEventListener("click",function(s){if(ignoreNextClick)return s.preventDefault(),s.stopPropagation&&s.stopPropagation(),s.stopImmediatePropagation&&s.stopImmediatePropagation(),ignoreNextClick=!1,!1},!0);var nearestEmptyInsertDetectEvent=function(e){if(dragEl){e=e.touches?e.touches[0]:e;var i=_detectNearestEmptySortable(e.clientX,e.clientY);if(i){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=i,n.preventDefault=void 0,n.stopPropagation=void 0,i[expando]._onDragOver(n)}}},_checkOutsideTargetEl=function(e){dragEl&&dragEl.parentNode[expando]._isOutsideThisEl(e.target)};function Sortable(s,e){if(!(s&&s.nodeType&&s.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(s));this.el=s,this.options=e=_extends({},e),s[expando]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(s.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return _detectDirection(s,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(c,u){c.setData("Text",u.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:Sortable.supportPointer!==!1&&"PointerEvent"in window&&!Safari,emptyInsertThreshold:5};PluginManager.initializePlugins(this,s,i);for(var n in i)!(n in e)&&(e[n]=i[n]);_prepareGroup(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:supportDraggable,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?on(s,"pointerdown",this._onTapStart):(on(s,"mousedown",this._onTapStart),on(s,"touchstart",this._onTapStart)),this.nativeDraggable&&(on(s,"dragover",this),on(s,"dragenter",this)),sortables.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),_extends(this,AnimationStateManager())}Sortable.prototype={constructor:Sortable,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(lastTarget=null)},_getDirection:function(e,i){return typeof this.options.direction=="function"?this.options.direction.call(this,e,i,dragEl):this.options.direction},_onTapStart:function(e){if(e.cancelable){var i=this,n=this.el,o=this.options,l=o.preventOnFilter,c=e.type,u=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,h=(u||e).target,f=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||h,g=o.filter;if(_saveInputCheckedState(n),!dragEl&&!(/mousedown|pointerdown/.test(c)&&e.button!==0||o.disabled)&&!f.isContentEditable&&!(!this.nativeDraggable&&Safari&&h&&h.tagName.toUpperCase()==="SELECT")&&(h=closest(h,o.draggable,n,!1),!(h&&h.animated)&&lastDownEl!==h)){if(oldIndex=index(h),oldDraggableIndex=index(h,o.draggable),typeof g=="function"){if(g.call(this,e,h,this)){_dispatchEvent({sortable:i,rootEl:f,name:"filter",targetEl:h,toEl:n,fromEl:n}),pluginEvent("filter",i,{evt:e}),l&&e.cancelable&&e.preventDefault();return}}else if(g&&(g=g.split(",").some(function(H){if(H=closest(f,H.trim(),n,!1),H)return _dispatchEvent({sortable:i,rootEl:H,name:"filter",targetEl:h,fromEl:n,toEl:n}),pluginEvent("filter",i,{evt:e}),!0}),g)){l&&e.cancelable&&e.preventDefault();return}o.handle&&!closest(f,o.handle,n,!1)||this._prepareDragStart(e,u,h)}}},_prepareDragStart:function(e,i,n){var o=this,l=o.el,c=o.options,u=l.ownerDocument,h;if(n&&!dragEl&&n.parentNode===l){var f=getRect(n);if(rootEl=l,dragEl=n,parentEl=dragEl.parentNode,nextEl=dragEl.nextSibling,lastDownEl=n,activeGroup=c.group,Sortable.dragged=dragEl,tapEvt={target:dragEl,clientX:(i||e).clientX,clientY:(i||e).clientY},tapDistanceLeft=tapEvt.clientX-f.left,tapDistanceTop=tapEvt.clientY-f.top,this._lastX=(i||e).clientX,this._lastY=(i||e).clientY,dragEl.style["will-change"]="all",h=function(){if(pluginEvent("delayEnded",o,{evt:e}),Sortable.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!FireFox&&o.nativeDraggable&&(dragEl.draggable=!0),o._triggerDragStart(e,i),_dispatchEvent({sortable:o,name:"choose",originalEvent:e}),toggleClass(dragEl,c.chosenClass,!0)},c.ignore.split(",").forEach(function(g){find(dragEl,g.trim(),_disableDraggable)}),on(u,"dragover",nearestEmptyInsertDetectEvent),on(u,"mousemove",nearestEmptyInsertDetectEvent),on(u,"touchmove",nearestEmptyInsertDetectEvent),on(u,"mouseup",o._onDrop),on(u,"touchend",o._onDrop),on(u,"touchcancel",o._onDrop),FireFox&&this.nativeDraggable&&(this.options.touchStartThreshold=4,dragEl.draggable=!0),pluginEvent("delayStart",this,{evt:e}),c.delay&&(!c.delayOnTouchOnly||i)&&(!this.nativeDraggable||!(Edge||IE11OrLess))){if(Sortable.eventCanceled){this._onDrop();return}on(u,"mouseup",o._disableDelayedDrag),on(u,"touchend",o._disableDelayedDrag),on(u,"touchcancel",o._disableDelayedDrag),on(u,"mousemove",o._delayedDragTouchMoveHandler),on(u,"touchmove",o._delayedDragTouchMoveHandler),c.supportPointer&&on(u,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(h,c.delay)}else h()}},_delayedDragTouchMoveHandler:function(e){var i=e.touches?e.touches[0]:e;Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){dragEl&&_disableDraggable(dragEl),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;off(e,"mouseup",this._disableDelayedDrag),off(e,"touchend",this._disableDelayedDrag),off(e,"touchcancel",this._disableDelayedDrag),off(e,"mousemove",this._delayedDragTouchMoveHandler),off(e,"touchmove",this._delayedDragTouchMoveHandler),off(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,i){i=i||e.pointerType=="touch"&&e,!this.nativeDraggable||i?this.options.supportPointer?on(document,"pointermove",this._onTouchMove):i?on(document,"touchmove",this._onTouchMove):on(document,"mousemove",this._onTouchMove):(on(dragEl,"dragend",this),on(rootEl,"dragstart",this._onDragStart));try{document.selection?_nextTick(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,i){if(awaitingDragStarted=!1,rootEl&&dragEl){pluginEvent("dragStarted",this,{evt:i}),this.nativeDraggable&&on(document,"dragover",_checkOutsideTargetEl);var n=this.options;!e&&toggleClass(dragEl,n.dragClass,!1),toggleClass(dragEl,n.ghostClass,!0),Sortable.active=this,e&&this._appendGhost(),_dispatchEvent({sortable:this,name:"start",originalEvent:i})}else this._nulling()},_emulateDragOver:function(){if(touchEvt){this._lastX=touchEvt.clientX,this._lastY=touchEvt.clientY,_hideGhostForTarget();for(var e=document.elementFromPoint(touchEvt.clientX,touchEvt.clientY),i=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(touchEvt.clientX,touchEvt.clientY),e!==i);)i=e;if(dragEl.parentNode[expando]._isOutsideThisEl(e),i)do{if(i[expando]){var n=void 0;if(n=i[expando]._onDragOver({clientX:touchEvt.clientX,clientY:touchEvt.clientY,target:e,rootEl:i}),n&&!this.options.dragoverBubble)break}e=i}while(i=getParentOrHost(i));_unhideGhostForTarget()}},_onTouchMove:function(e){if(tapEvt){var i=this.options,n=i.fallbackTolerance,o=i.fallbackOffset,l=e.touches?e.touches[0]:e,c=ghostEl&&matrix(ghostEl,!0),u=ghostEl&&c&&c.a,h=ghostEl&&c&&c.d,f=PositionGhostAbsolutely&&ghostRelativeParent&&getRelativeScrollOffset(ghostRelativeParent),g=(l.clientX-tapEvt.clientX+o.x)/(u||1)+(f?f[0]-ghostRelativeParentInitialScroll[0]:0)/(u||1),H=(l.clientY-tapEvt.clientY+o.y)/(h||1)+(f?f[1]-ghostRelativeParentInitialScroll[1]:0)/(h||1);if(!Sortable.active&&!awaitingDragStarted){if(n&&Math.max(Math.abs(l.clientX-this._lastX),Math.abs(l.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(ghostEl){c?(c.e+=g-(lastDx||0),c.f+=H-(lastDy||0)):c={a:1,b:0,c:0,d:1,e:g,f:H};var Y="matrix(".concat(c.a,",").concat(c.b,",").concat(c.c,",").concat(c.d,",").concat(c.e,",").concat(c.f,")");css(ghostEl,"webkitTransform",Y),css(ghostEl,"mozTransform",Y),css(ghostEl,"msTransform",Y),css(ghostEl,"transform",Y),lastDx=g,lastDy=H,touchEvt=l}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!ghostEl){var e=this.options.fallbackOnBody?document.body:rootEl,i=getRect(dragEl,!0,PositionGhostAbsolutely,!0,e),n=this.options;if(PositionGhostAbsolutely){for(ghostRelativeParent=e;css(ghostRelativeParent,"position")==="static"&&css(ghostRelativeParent,"transform")==="none"&&ghostRelativeParent!==document;)ghostRelativeParent=ghostRelativeParent.parentNode;ghostRelativeParent!==document.body&&ghostRelativeParent!==document.documentElement?(ghostRelativeParent===document&&(ghostRelativeParent=getWindowScrollingElement()),i.top+=ghostRelativeParent.scrollTop,i.left+=ghostRelativeParent.scrollLeft):ghostRelativeParent=getWindowScrollingElement(),ghostRelativeParentInitialScroll=getRelativeScrollOffset(ghostRelativeParent)}ghostEl=dragEl.cloneNode(!0),toggleClass(ghostEl,n.ghostClass,!1),toggleClass(ghostEl,n.fallbackClass,!0),toggleClass(ghostEl,n.dragClass,!0),css(ghostEl,"transition",""),css(ghostEl,"transform",""),css(ghostEl,"box-sizing","border-box"),css(ghostEl,"margin",0),css(ghostEl,"top",i.top),css(ghostEl,"left",i.left),css(ghostEl,"width",i.width),css(ghostEl,"height",i.height),css(ghostEl,"opacity","0.8"),css(ghostEl,"position",PositionGhostAbsolutely?"absolute":"fixed"),css(ghostEl,"zIndex","100000"),css(ghostEl,"pointerEvents","none"),Sortable.ghost=ghostEl,e.appendChild(ghostEl),css(ghostEl,"transform-origin",tapDistanceLeft/parseInt(ghostEl.style.width)*100+"% "+tapDistanceTop/parseInt(ghostEl.style.height)*100+"%")}},_onDragStart:function(e,i){var n=this,o=e.dataTransfer,l=n.options;if(pluginEvent("dragStart",this,{evt:e}),Sortable.eventCanceled){this._onDrop();return}pluginEvent("setupClone",this),Sortable.eventCanceled||(cloneEl=clone(dragEl),cloneEl.removeAttribute("id"),cloneEl.draggable=!1,cloneEl.style["will-change"]="",this._hideClone(),toggleClass(cloneEl,this.options.chosenClass,!1),Sortable.clone=cloneEl),n.cloneId=_nextTick(function(){pluginEvent("clone",n),!Sortable.eventCanceled&&(n.options.removeCloneOnHide||rootEl.insertBefore(cloneEl,dragEl),n._hideClone(),_dispatchEvent({sortable:n,name:"clone"}))}),!i&&toggleClass(dragEl,l.dragClass,!0),i?(ignoreNextClick=!0,n._loopId=setInterval(n._emulateDragOver,50)):(off(document,"mouseup",n._onDrop),off(document,"touchend",n._onDrop),off(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",l.setData&&l.setData.call(n,o,dragEl)),on(document,"drop",n),css(dragEl,"transform","translateZ(0)")),awaitingDragStarted=!0,n._dragStartId=_nextTick(n._dragStarted.bind(n,i,e)),on(document,"selectstart",n),moved=!0,Safari&&css(document.body,"user-select","none")},_onDragOver:function(e){var i=this.el,n=e.target,o,l,c,u=this.options,h=u.group,f=Sortable.active,g=activeGroup===h,H=u.sort,Y=putSortable||f,ee,te=this,xe=!1;if(_silent)return;function ne(Lt,Nt){pluginEvent(Lt,te,_objectSpread2({evt:e,isOwner:g,axis:ee?"vertical":"horizontal",revert:c,dragRect:o,targetRect:l,canSort:H,fromSortable:Y,target:n,completed:tt,onMove:function(Et,Ct){return _onMove(rootEl,i,dragEl,o,Et,getRect(Et),e,Ct)},changed:it},Nt))}function et(){ne("dragOverAnimationCapture"),te.captureAnimationState(),te!==Y&&Y.captureAnimationState()}function tt(Lt){return ne("dragOverCompleted",{insertion:Lt}),Lt&&(g?f._hideClone():f._showClone(te),te!==Y&&(toggleClass(dragEl,putSortable?putSortable.options.ghostClass:f.options.ghostClass,!1),toggleClass(dragEl,u.ghostClass,!0)),putSortable!==te&&te!==Sortable.active?putSortable=te:te===Sortable.active&&putSortable&&(putSortable=null),Y===te&&(te._ignoreWhileAnimating=n),te.animateAll(function(){ne("dragOverAnimationComplete"),te._ignoreWhileAnimating=null}),te!==Y&&(Y.animateAll(),Y._ignoreWhileAnimating=null)),(n===dragEl&&!dragEl.animated||n===i&&!n.animated)&&(lastTarget=null),!u.dragoverBubble&&!e.rootEl&&n!==document&&(dragEl.parentNode[expando]._isOutsideThisEl(e.target),!Lt&&nearestEmptyInsertDetectEvent(e)),!u.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),xe=!0}function it(){newIndex=index(dragEl),newDraggableIndex=index(dragEl,u.draggable),_dispatchEvent({sortable:te,name:"change",toEl:i,newIndex,newDraggableIndex,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=closest(n,u.draggable,i,!0),ne("dragOver"),Sortable.eventCanceled)return xe;if(dragEl.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||te._ignoreWhileAnimating===n)return tt(!1);if(ignoreNextClick=!1,f&&!u.disabled&&(g?H||(c=parentEl!==rootEl):putSortable===this||(this.lastPutMode=activeGroup.checkPull(this,f,dragEl,e))&&h.checkPut(this,f,dragEl,e))){if(ee=this._getDirection(e,n)==="vertical",o=getRect(dragEl),ne("dragOverValid"),Sortable.eventCanceled)return xe;if(c)return parentEl=rootEl,et(),this._hideClone(),ne("revert"),Sortable.eventCanceled||(nextEl?rootEl.insertBefore(dragEl,nextEl):rootEl.appendChild(dragEl)),tt(!0);var rt=lastChild(i,u.draggable);if(!rt||_ghostIsLast(e,ee,this)&&!rt.animated){if(rt===dragEl)return tt(!1);if(rt&&i===e.target&&(n=rt),n&&(l=getRect(n)),_onMove(rootEl,i,dragEl,o,n,l,e,!!n)!==!1)return et(),rt&&rt.nextSibling?i.insertBefore(dragEl,rt.nextSibling):i.appendChild(dragEl),parentEl=i,it(),tt(!0)}else if(rt&&_ghostIsFirst(e,ee,this)){var nt=getChild(i,0,u,!0);if(nt===dragEl)return tt(!1);if(n=nt,l=getRect(n),_onMove(rootEl,i,dragEl,o,n,l,e,!1)!==!1)return et(),i.insertBefore(dragEl,nt),parentEl=i,it(),tt(!0)}else if(n.parentNode===i){l=getRect(n);var st=0,at,ot=dragEl.parentNode!==i,ct=!_dragElInRowColumn(dragEl.animated&&dragEl.toRect||o,n.animated&&n.toRect||l,ee),ht=ee?"top":"left",ut=isScrolledPast(n,"top","top")||isScrolledPast(dragEl,"top","top"),pt=ut?ut.scrollTop:void 0;lastTarget!==n&&(at=l[ht],pastFirstInvertThresh=!1,isCircumstantialInvert=!ct&&u.invertSwap||ot),st=_getSwapDirection(e,n,l,ee,ct?1:u.swapThreshold,u.invertedSwapThreshold==null?u.swapThreshold:u.invertedSwapThreshold,isCircumstantialInvert,lastTarget===n);var yt;if(st!==0){var mt=index(dragEl);do mt-=st,yt=parentEl.children[mt];while(yt&&(css(yt,"display")==="none"||yt===ghostEl))}if(st===0||yt===n)return tt(!1);lastTarget=n,lastDirection=st;var St=n.nextElementSibling,Pt=!1;Pt=st===1;var Rt=_onMove(rootEl,i,dragEl,o,n,l,e,Pt);if(Rt!==!1)return(Rt===1||Rt===-1)&&(Pt=Rt===1),_silent=!0,setTimeout(_unsilent,30),et(),Pt&&!St?i.appendChild(dragEl):n.parentNode.insertBefore(dragEl,Pt?St:n),ut&&scrollBy(ut,0,pt-ut.scrollTop),parentEl=dragEl.parentNode,at!==void 0&&!isCircumstantialInvert&&(targetMoveDistance=Math.abs(at-getRect(n)[ht])),it(),tt(!0)}if(i.contains(dragEl))return tt(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){off(document,"mousemove",this._onTouchMove),off(document,"touchmove",this._onTouchMove),off(document,"pointermove",this._onTouchMove),off(document,"dragover",nearestEmptyInsertDetectEvent),off(document,"mousemove",nearestEmptyInsertDetectEvent),off(document,"touchmove",nearestEmptyInsertDetectEvent)},_offUpEvents:function(){var e=this.el.ownerDocument;off(e,"mouseup",this._onDrop),off(e,"touchend",this._onDrop),off(e,"pointerup",this._onDrop),off(e,"touchcancel",this._onDrop),off(document,"selectstart",this)},_onDrop:function(e){var i=this.el,n=this.options;if(newIndex=index(dragEl),newDraggableIndex=index(dragEl,n.draggable),pluginEvent("drop",this,{evt:e}),parentEl=dragEl&&dragEl.parentNode,newIndex=index(dragEl),newDraggableIndex=index(dragEl,n.draggable),Sortable.eventCanceled){this._nulling();return}awaitingDragStarted=!1,isCircumstantialInvert=!1,pastFirstInvertThresh=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),_cancelNextTick(this.cloneId),_cancelNextTick(this._dragStartId),this.nativeDraggable&&(off(document,"drop",this),off(i,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Safari&&css(document.body,"user-select",""),css(dragEl,"transform",""),e&&(moved&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),ghostEl&&ghostEl.parentNode&&ghostEl.parentNode.removeChild(ghostEl),(rootEl===parentEl||putSortable&&putSortable.lastPutMode!=="clone")&&cloneEl&&cloneEl.parentNode&&cloneEl.parentNode.removeChild(cloneEl),dragEl&&(this.nativeDraggable&&off(dragEl,"dragend",this),_disableDraggable(dragEl),dragEl.style["will-change"]="",moved&&!awaitingDragStarted&&toggleClass(dragEl,putSortable?putSortable.options.ghostClass:this.options.ghostClass,!1),toggleClass(dragEl,this.options.chosenClass,!1),_dispatchEvent({sortable:this,name:"unchoose",toEl:parentEl,newIndex:null,newDraggableIndex:null,originalEvent:e}),rootEl!==parentEl?(newIndex>=0&&(_dispatchEvent({rootEl:parentEl,name:"add",toEl:parentEl,fromEl:rootEl,originalEvent:e}),_dispatchEvent({sortable:this,name:"remove",toEl:parentEl,originalEvent:e}),_dispatchEvent({rootEl:parentEl,name:"sort",toEl:parentEl,fromEl:rootEl,originalEvent:e}),_dispatchEvent({sortable:this,name:"sort",toEl:parentEl,originalEvent:e})),putSortable&&putSortable.save()):newIndex!==oldIndex&&newIndex>=0&&(_dispatchEvent({sortable:this,name:"update",toEl:parentEl,originalEvent:e}),_dispatchEvent({sortable:this,name:"sort",toEl:parentEl,originalEvent:e})),Sortable.active&&((newIndex==null||newIndex===-1)&&(newIndex=oldIndex,newDraggableIndex=oldDraggableIndex),_dispatchEvent({sortable:this,name:"end",toEl:parentEl,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){pluginEvent("nulling",this),rootEl=dragEl=parentEl=ghostEl=nextEl=cloneEl=lastDownEl=cloneHidden=tapEvt=touchEvt=moved=newIndex=newDraggableIndex=oldIndex=oldDraggableIndex=lastTarget=lastDirection=putSortable=activeGroup=Sortable.dragged=Sortable.ghost=Sortable.clone=Sortable.active=null,savedInputChecked.forEach(function(e){e.checked=!0}),savedInputChecked.length=lastDx=lastDy=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":dragEl&&(this._onDragOver(e),_globalDragOver(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],i,n=this.el.children,o=0,l=n.length,c=this.options;o<l;o++)i=n[o],closest(i,c.draggable,this.el,!1)&&e.push(i.getAttribute(c.dataIdAttr)||_generateId(i));return e},sort:function(e,i){var n={},o=this.el;this.toArray().forEach(function(l,c){var u=o.children[c];closest(u,this.options.draggable,o,!1)&&(n[l]=u)},this),i&&this.captureAnimationState(),e.forEach(function(l){n[l]&&(o.removeChild(n[l]),o.appendChild(n[l]))}),i&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,i){return closest(e,i||this.options.draggable,this.el,!1)},option:function(e,i){var n=this.options;if(i===void 0)return n[e];var o=PluginManager.modifyOption(this,e,i);typeof o<"u"?n[e]=o:n[e]=i,e==="group"&&_prepareGroup(n)},destroy:function(){pluginEvent("destroy",this);var e=this.el;e[expando]=null,off(e,"mousedown",this._onTapStart),off(e,"touchstart",this._onTapStart),off(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(off(e,"dragover",this),off(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(i){i.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),sortables.splice(sortables.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!cloneHidden){if(pluginEvent("hideClone",this),Sortable.eventCanceled)return;css(cloneEl,"display","none"),this.options.removeCloneOnHide&&cloneEl.parentNode&&cloneEl.parentNode.removeChild(cloneEl),cloneHidden=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(cloneHidden){if(pluginEvent("showClone",this),Sortable.eventCanceled)return;dragEl.parentNode==rootEl&&!this.options.group.revertClone?rootEl.insertBefore(cloneEl,dragEl):nextEl?rootEl.insertBefore(cloneEl,nextEl):rootEl.appendChild(cloneEl),this.options.group.revertClone&&this.animate(dragEl,cloneEl),css(cloneEl,"display",""),cloneHidden=!1}}};function _globalDragOver(s){s.dataTransfer&&(s.dataTransfer.dropEffect="move"),s.cancelable&&s.preventDefault()}function _onMove(s,e,i,n,o,l,c,u){var h,f=s[expando],g=f.options.onMove,H;return window.CustomEvent&&!IE11OrLess&&!Edge?h=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(h=document.createEvent("Event"),h.initEvent("move",!0,!0)),h.to=e,h.from=s,h.dragged=i,h.draggedRect=n,h.related=o||e,h.relatedRect=l||getRect(e),h.willInsertAfter=u,h.originalEvent=c,s.dispatchEvent(h),g&&(H=g.call(f,h,c)),H}function _disableDraggable(s){s.draggable=!1}function _unsilent(){_silent=!1}function _ghostIsFirst(s,e,i){var n=getRect(getChild(i.el,0,i.options,!0)),o=getChildContainingRectFromElement(i.el,i.options,ghostEl),l=10;return e?s.clientX<o.left-l||s.clientY<n.top&&s.clientX<n.right:s.clientY<o.top-l||s.clientY<n.bottom&&s.clientX<n.left}function _ghostIsLast(s,e,i){var n=getRect(lastChild(i.el,i.options.draggable)),o=getChildContainingRectFromElement(i.el,i.options,ghostEl),l=10;return e?s.clientX>o.right+l||s.clientY>n.bottom&&s.clientX>n.left:s.clientY>o.bottom+l||s.clientX>n.right&&s.clientY>n.top}function _getSwapDirection(s,e,i,n,o,l,c,u){var h=n?s.clientY:s.clientX,f=n?i.height:i.width,g=n?i.top:i.left,H=n?i.bottom:i.right,Y=!1;if(!c){if(u&&targetMoveDistance<f*o){if(!pastFirstInvertThresh&&(lastDirection===1?h>g+f*l/2:h<H-f*l/2)&&(pastFirstInvertThresh=!0),pastFirstInvertThresh)Y=!0;else if(lastDirection===1?h<g+targetMoveDistance:h>H-targetMoveDistance)return-lastDirection}else if(h>g+f*(1-o)/2&&h<H-f*(1-o)/2)return _getInsertDirection(e)}return Y=Y||c,Y&&(h<g+f*l/2||h>H-f*l/2)?h>g+f/2?1:-1:0}function _getInsertDirection(s){return index(dragEl)<index(s)?1:-1}function _generateId(s){for(var e=s.tagName+s.className+s.src+s.href+s.textContent,i=e.length,n=0;i--;)n+=e.charCodeAt(i);return n.toString(36)}function _saveInputCheckedState(s){savedInputChecked.length=0;for(var e=s.getElementsByTagName("input"),i=e.length;i--;){var n=e[i];n.checked&&savedInputChecked.push(n)}}function _nextTick(s){return setTimeout(s,0)}function _cancelNextTick(s){return clearTimeout(s)}documentExists&&on(document,"touchmove",function(s){(Sortable.active||awaitingDragStarted)&&s.cancelable&&s.preventDefault()});Sortable.utils={on,off,css,find,is:function(e,i){return!!closest(e,i,e,!1)},extend:extend$1,throttle,closest,toggleClass,clone,index,nextTick:_nextTick,cancelNextTick:_cancelNextTick,detectDirection:_detectDirection,getChild,expando};Sortable.get=function(s){return s[expando]};Sortable.mount=function(){for(var s=arguments.length,e=new Array(s),i=0;i<s;i++)e[i]=arguments[i];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(Sortable.utils=_objectSpread2(_objectSpread2({},Sortable.utils),n.utils)),PluginManager.mount(n)})};Sortable.create=function(s,e){return new Sortable(s,e)};Sortable.version=version;var autoScrolls=[],scrollEl,scrollRootEl,scrolling=!1,lastAutoScrollX,lastAutoScrollY,touchEvt$1,pointerElemChangedInterval;function AutoScrollPlugin(){function s(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return s.prototype={dragStarted:function(i){var n=i.originalEvent;this.sortable.nativeDraggable?on(document,"dragover",this._handleAutoScroll):this.options.supportPointer?on(document,"pointermove",this._handleFallbackAutoScroll):n.touches?on(document,"touchmove",this._handleFallbackAutoScroll):on(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(i){var n=i.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?off(document,"dragover",this._handleAutoScroll):(off(document,"pointermove",this._handleFallbackAutoScroll),off(document,"touchmove",this._handleFallbackAutoScroll),off(document,"mousemove",this._handleFallbackAutoScroll)),clearPointerElemChangedInterval(),clearAutoScrolls(),cancelThrottle()},nulling:function(){touchEvt$1=scrollRootEl=scrollEl=scrolling=pointerElemChangedInterval=lastAutoScrollX=lastAutoScrollY=null,autoScrolls.length=0},_handleFallbackAutoScroll:function(i){this._handleAutoScroll(i,!0)},_handleAutoScroll:function(i,n){var o=this,l=(i.touches?i.touches[0]:i).clientX,c=(i.touches?i.touches[0]:i).clientY,u=document.elementFromPoint(l,c);if(touchEvt$1=i,n||this.options.forceAutoScrollFallback||Edge||IE11OrLess||Safari){autoScroll(i,this.options,u,n);var h=getParentAutoScrollElement(u,!0);scrolling&&(!pointerElemChangedInterval||l!==lastAutoScrollX||c!==lastAutoScrollY)&&(pointerElemChangedInterval&&clearPointerElemChangedInterval(),pointerElemChangedInterval=setInterval(function(){var f=getParentAutoScrollElement(document.elementFromPoint(l,c),!0);f!==h&&(h=f,clearAutoScrolls()),autoScroll(i,o.options,f,n)},10),lastAutoScrollX=l,lastAutoScrollY=c)}else{if(!this.options.bubbleScroll||getParentAutoScrollElement(u,!0)===getWindowScrollingElement()){clearAutoScrolls();return}autoScroll(i,this.options,getParentAutoScrollElement(u,!1),!1)}}},_extends(s,{pluginName:"scroll",initializeByDefault:!0})}function clearAutoScrolls(){autoScrolls.forEach(function(s){clearInterval(s.pid)}),autoScrolls=[]}function clearPointerElemChangedInterval(){clearInterval(pointerElemChangedInterval)}var autoScroll=throttle(function(s,e,i,n){if(e.scroll){var o=(s.touches?s.touches[0]:s).clientX,l=(s.touches?s.touches[0]:s).clientY,c=e.scrollSensitivity,u=e.scrollSpeed,h=getWindowScrollingElement(),f=!1,g;scrollRootEl!==i&&(scrollRootEl=i,clearAutoScrolls(),scrollEl=e.scroll,g=e.scrollFn,scrollEl===!0&&(scrollEl=getParentAutoScrollElement(i,!0)));var H=0,Y=scrollEl;do{var ee=Y,te=getRect(ee),xe=te.top,ne=te.bottom,et=te.left,tt=te.right,it=te.width,rt=te.height,nt=void 0,st=void 0,at=ee.scrollWidth,ot=ee.scrollHeight,ct=css(ee),ht=ee.scrollLeft,ut=ee.scrollTop;ee===h?(nt=it<at&&(ct.overflowX==="auto"||ct.overflowX==="scroll"||ct.overflowX==="visible"),st=rt<ot&&(ct.overflowY==="auto"||ct.overflowY==="scroll"||ct.overflowY==="visible")):(nt=it<at&&(ct.overflowX==="auto"||ct.overflowX==="scroll"),st=rt<ot&&(ct.overflowY==="auto"||ct.overflowY==="scroll"));var pt=nt&&(Math.abs(tt-o)<=c&&ht+it<at)-(Math.abs(et-o)<=c&&!!ht),yt=st&&(Math.abs(ne-l)<=c&&ut+rt<ot)-(Math.abs(xe-l)<=c&&!!ut);if(!autoScrolls[H])for(var mt=0;mt<=H;mt++)autoScrolls[mt]||(autoScrolls[mt]={});(autoScrolls[H].vx!=pt||autoScrolls[H].vy!=yt||autoScrolls[H].el!==ee)&&(autoScrolls[H].el=ee,autoScrolls[H].vx=pt,autoScrolls[H].vy=yt,clearInterval(autoScrolls[H].pid),(pt!=0||yt!=0)&&(f=!0,autoScrolls[H].pid=setInterval((function(){n&&this.layer===0&&Sortable.active._onTouchMove(touchEvt$1);var St=autoScrolls[this.layer].vy?autoScrolls[this.layer].vy*u:0,Pt=autoScrolls[this.layer].vx?autoScrolls[this.layer].vx*u:0;typeof g=="function"&&g.call(Sortable.dragged.parentNode[expando],Pt,St,s,touchEvt$1,autoScrolls[this.layer].el)!=="continue"||scrollBy(autoScrolls[this.layer].el,Pt,St)}).bind({layer:H}),24))),H++}while(e.bubbleScroll&&Y!==h&&(Y=getParentAutoScrollElement(Y,!1)));scrolling=f}},30),drop=function(e){var i=e.originalEvent,n=e.putSortable,o=e.dragEl,l=e.activeSortable,c=e.dispatchSortableEvent,u=e.hideGhostForTarget,h=e.unhideGhostForTarget;if(i){var f=n||l;u();var g=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:i,H=document.elementFromPoint(g.clientX,g.clientY);h(),f&&!f.el.contains(H)&&(c("spill"),this.onSpill({dragEl:o,putSortable:n}))}};function Revert(){}Revert.prototype={startIndex:null,dragStart:function(e){var i=e.oldDraggableIndex;this.startIndex=i},onSpill:function(e){var i=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=getChild(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(i,o):this.sortable.el.appendChild(i),this.sortable.animateAll(),n&&n.animateAll()},drop};_extends(Revert,{pluginName:"revertOnSpill"});function Remove(){}Remove.prototype={onSpill:function(e){var i=e.dragEl,n=e.putSortable,o=n||this.sortable;o.captureAnimationState(),i.parentNode&&i.parentNode.removeChild(i),o.animateAll()},drop};_extends(Remove,{pluginName:"removeOnSpill"});Sortable.mount(new AutoScrollPlugin);Sortable.mount(Remove,Revert);var LayerSwitcherDOM={_createDraggableElement:function(s,e){let i=[".GPtitle"];checkDsfr()&&i.push(".GPlayerDragNDrop"),navigator.userAgent.match(/chrome|chromium|crios/i),e._sortables=[],i.forEach(n=>{const o=Sortable.create(s,{handle:n,dataIdAttr:"data-sortable-id",draggable:".draggable-layer",ghostClass:"GPghostLayer",animation:200,onEnd:function(l){e._onEndDragAndDropLayerClick(l)}});e._sortables.push(o)})},_moveElement:function(s,e){const i=this._sortables[0];if(["up","down"].includes(e)==!1||typeof s.dataset.sortableId>"u")return!1;let n=s.dataset.sortableId,o=i.toArray(),l=o.indexOf(n);return o.splice(l,1),e=="down"?o.splice(l+1,0,n):e=="up"&&o.splice(l-1,0,n),i.sort(o,!0),this._onEndDragAndDropLayerClick({newIndex:o.indexOf(n)}),!0},_onMoveElement:function(s,e){if(["Enter","Space"].includes(e.code)){const i=s?"up":"down",n=s?"down":"up";e.stopPropagation(),e.preventDefault(),this._moveElement(e.currentTarget.closest(".draggable-layer"),i),window.getComputedStyle(e.currentTarget).visibility=="hidden"?e.currentTarget.parentNode.querySelector(`[data-direction=${n}]`).focus():e.currentTarget.focus()}},_addUID:function(s){var e=this._uid?s+"-"+this._uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPlayerSwitcher"),s.className="GPwidget gpf-widget gpf-mobile-fullscreen gpf-widget-button",s},_createMainLayersShowElement:function(){var s=document.createElement("input");return s.id=this._addUID("GPshowLayersList"),s.type="checkbox",s},_createMainLayersElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPlayersList"),s.className="GPpanel gpf-panel fr-modal",s},_createMainLayersDivElement:function(){var s=document.createElement("div");return s.className="GPpanelBody gpf-panel__body_ls fr-modal__body",s},_createMainLayerListElement:function(){var s=document.createElement("div");return s.className="GPLayerListBody",s.setAttribute("role","list"),s},_createMainPictoElement:function(){var s=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowLayersListPicto"),e.classList.add("GPshowOpen","GPshowAdvancedToolPicto","GPshowLayersListPicto"),e.classList.add("gpf-btn","gpf-btn--tertiary","gpf-btn-icon","gpf-btn-icon-layerswitcher"),e.classList.add("fr-btn","fr-btn--tertiary"),e.htmlFor=this._addUID("GPshowLayersList"),e.setAttribute("aria-label","Afficher/masquer le gestionnaire de couches"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),document.getElementById(s._addUID("GPshowLayersList")).checked=o,document.getElementById(s._addUID("GPshowLayersList")).checked&&(document.getElementById(s._addUID("GPlayerInfoPanel")).classList.remove("GPlayerInfoPanelOpened","gpf-visible"),document.getElementById(s._addUID("GPlayerInfoPanel")).classList.add("GPlayerInfoPanelClosed","gpf-hidden"),document.getElementById(s._addUID("GPlayerStylePanel")).classList.add("GPlayerStylePanelClosed","gpf-hidden"),document.getElementById(s._addUID("GPlayerStylePanel")).classList.remove("GPlayerStylePanelOpened","gpf-visible")),s.onShowLayerSwitcherClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),document.getElementById(s._addUID("GPshowLayersList")).checked&&(document.getElementById(s._addUID("GPlayerInfoPanel")).classList.remove("GPlayerInfoPanelOpened","gpf-visible"),document.getElementById(s._addUID("GPlayerInfoPanel")).classList.add("GPlayerInfoPanelClosed","gpf-hidden"),document.getElementById(s._addUID("GPlayerStylePanel")).classList.add("GPlayerStylePanelClosed","gpf-hidden"),document.getElementById(s._addUID("GPlayerStylePanel")).classList.remove("GPlayerStylePanelOpened","gpf-visible")),s.onShowLayerSwitcherClick(n)}),e},_createMainCounterLayersElement:function(){var s=document.createElement("span");return s.id=this._addUID("GPlayerCounter"),s.className="GPlayerCounter",s.innerHTML="0",s},_createMainInfoElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPlayerInfoPanel"),s.className="GPpanel GPlayerInfoPanelClosed gpf-panel fr-modal",s},_createMainInfoDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__body fr-modal__body",s},_createMainStyleElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPlayerStylePanel"),s.className="GPpanel GPlayerStylePanelClosed gpf-panel fr-modal",s},_createMainStyleDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__body fr-modal__body",s},_createLayersPanelHeaderElement:function(){var s=document.createElement("div");return s.className="GPpanelHeader gpf-panel__header_ls",s},_createLayersPanelIconElement:function(){var s=document.createElement("label");return s.className="GPpanelIcon gpf-btn-header gpf-btn-icon-layers",s.title="Couches",s},_createLayersPanelTitleElement:function(){var s=document.createElement("div");return s.className="GPpanelTitle gpf-panel__title_ls",s.id=this._addUID("GPlayersHeaderTitle"),s.innerHTML="Couches",s},_createLayersPanelCloseElement:function(){var s=this,e=document.createElement("button");e.id=this._addUID("GPlayersPanelClose"),e.className="GPpanelClose GPlayersPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",e.title="Fermer le panneau";var i=document.createElement("span");return i.className="GPelementHidden gpf-visible fr-mx-1w",i.innerText="Fermer",e.appendChild(i),e.addEventListener?e.addEventListener("click",function(){document.getElementById(s._addUID("GPshowLayersListPicto")).click()},!1):e.attachEvent&&e.attachEvent("onclick",function(){document.getElementById(s._addUID("GPshowLayersListPicto")).click()}),e},_createHeaderButtonsDivElement:function(){var s=document.createElement("div");return s.className="GPbodyHeader",s.id=this._addUID("GPbodyHeader"),s},_createButtonsGroupElement:function(s){s=s||{};let e=s.className?s.className:"",i=s.left?"left":"right",n="";switch(s.size=s.size?s.size:"",s.size.toLowerCase()){case"sm":n="fr-btns-group--sm";break;case"lg":n="fr-btns-group--lg";break}var o=document.createElement("div");o.className=`${e} GPbtnsGroup GPbtnsGroup--${i} fr-btns-group fr-btns-group--${i} fr-btns-group--inline-reverse fr-btns-group--inline ${n} fr-btns-group--icon-left`;let l=s.id!==null?`${e}_ID_${s.id}`:e;return o.id=this._addUID(l),o},_createButtonHeaderElement:function(s){let e=document.createElement("button");if(e.className="fr-btn fr-btn--tertiary gpf-btn ",s.className&&(e.className+=s.className),s.icon&&(e.className+=s.icon),s.label&&(e.innerHTML=s.label),s.title&&(e.title=s.title,e.ariaLabel=s.title),e.id=s.id?s.id:this._addUID("GPtools-"+s.label.toLowerCase()),s.attributes)for(const n in s.attributes){if(!Object.hasOwn(s.attributes,n))continue;const o=s.attributes[n];e.setAttribute(n,o)}let i=this;return e.addEventListener("click",n=>{i._onClickHeaderButtons(n,s.label,s.cb)}),e},_createContainerLayerElement:function(s,e){var i=document.createElement("div");return i.id=this._addUID("GPlayerSwitcher_ID_"+s.id),i.className="GPlayerSwitcher_layer gpf-panel__content fr-modal__content draggable-layer",i.appendChild(this._createBasicToolElement(s,e)),i.appendChild(this._createAdvancedToolDivElement(s)),i.setAttribute("tabindex",0),i.setAttribute("role","listitem"),["click","keydown"].forEach(n=>{i.addEventListener(n,o=>{this._onSelectLayer(o)})}),i},_createBasicToolElement:function(s,e){var i=document.createElement("div");return i.id=this._addUID("GPbasicTools_ID_"+s.id),i.className="GPlayerBasicTools",i.appendChild(this._createBasicToolButtons(s)),i.appendChild(this._createBasicToolTitleElement(s,e)),s.draggable&&i.appendChild(this._createDragNDropElement(s)),i},_createBasicToolButtons:function(s){let e=document.createElement("div");return e.id=this._addUID("GPbasicToolButtons_ID_"+s.id),e.className="GPbasicToolButtons",e.appendChild(this._createAdvancedToolShowElement(s)),e.appendChild(this._createVisibilityElement(s)),s.deletable&&e.appendChild(this._createDeleteElement(s.id)),e},_createBasicToolTitleElement:function(s,e){let i=document.createElement("div");return i.id=this._addUID("GPtitle_ID_"+s.id),i.className="GPtitle",i.appendChild(this._createLayerThumbnailElement(s)),i.appendChild(this._createLayerNameDivElement(s,e)),i},_createLayerNameDivElement:function(s,e){let i=document.createElement("div");return i.id=this._addUID("GPlayerTitle_ID_"+s.id),i.className="GPlayerTitle",i.appendChild(this._createLayerNameElement(s,e)),i.appendChild(this._createLayerProducerElement(s,e)),i},_createLayerThumbnailElement:function(s){let e=document.createElement("img");return e.id=this._addUID("GPtitleImage_ID_"+s.id),e.className="GPtitleImage GPtitleDefaultImage",e.alt="",s.thumbnail&&typeof s.thumbnail=="string"&&s.thumbnail!=="default"&&(e.classList.remove("GPtitleDefaultImage"),e.src=s.thumbnail),e},_createLayerNameElement:function(s,e){var i=document.createElement("div");return i.id=this._addUID("GPname_ID_"+s.id),i.className="GPlayerName",i.title=s.description||s.title,e&&(i.dataset.tooltip=s.description||s.title,ToolTips.active(i),i.title=s.name),i.innerHTML=s.title,s.layer.config&&s.layer.config.serviceParams.id==="GPP:TMS"&&(i.innerHTML=s.description),i},_createLayerProducerElement:function(s,e){let i=document.createElement("div");return i.id=this._addUID("GPlayerProducer_ID_"+s.id),i.className="GPlayerProducer",i.innerHTML=s.producer,e&&(i.dataset.tooltip=s.producer,ToolTips.active(i)),i},_createDragNDropElement:function(s){let e=document.createElement("div");e.id=this._addUID("GPdragndropPicto_ID_"+s.id),e.className="GPelementHidden GPlayerDragNDrop gpf-btn gpf-btn-icon-ls-draggable gpf-btn--tertiary",e.title="Deplacer la couche";let i=this,n=document.createElement("div");n.className="keyboard-navigation";let o=document.createElement("span");o.tabIndex=0,o.dataset.direction="up",o.title=o.ariaLabel="Dplacer la couche vers le haut",o.className="fr-icon-arrow-up-line fr-icon--sm",o.onkeydown=this._onMoveElement.bind(this,!0);let l=document.createElement("span");return l.tabIndex=0,l.dataset.direction="down",l.title=l.ariaLabel="Dplacer la couche vers le bas",l.className="fr-icon-arrow-down-line fr-icon--sm",l.onkeydown=this._onMoveElement.bind(this,!1),n.appendChild(l),n.appendChild(o),e.appendChild(n),e.addEventListener?e.addEventListener("click",function(c){i._onStartDragAndDropLayerClick(c)}):e.attachEvent&&e.attachEvent("onclick",function(c){i._onStartDragAndDropLayerClick(c)}),e},_createVisibilityElement:function(s){var e=typeof s.visibility<"u"?s.visibility:!0;let i=document.createElement("button");i.id=this._addUID("GPvisibilityPicto_ID_"+s.id);let n="gpf-btn-icon-ls-visibility gpf-btn-icon";checkDsfr()&&(n=e?"fr-icon-eye-line":"fr-icon-eye-off-line"),i.className=`GPlayerVisibility gpf-btn ${n} fr-btn fr-btn--sm gpf-btn--tertiary fr-btn--tertiary-no-outline`,i.title="Afficher/masquer la couche",i.setAttribute("tabindex","0"),i.setAttribute("aria-pressed",e),i.setAttribute("type","button");var o=this;let l=function(c){var u=c.target.ariaPressed==="true";c.target.setAttribute("aria-pressed",!u),checkDsfr()&&(i.classList.toggle("fr-icon-eye-off-line",u),i.classList.toggle("fr-icon-eye-line",!u)),o._onVisibilityLayerClick(c)};return i.addEventListener?i.addEventListener("click",l):i.attachEvent&&i.attachEvent("onclick",l),i},_createAdvancedToolShowElement:function(s){let e=document.createElement("button");e.id=this._addUID("GPshowAdvancedTools_ID_"+s.id),e.className="GPshowAdvancedToolPicto GPshowMoreOptionsImage GPshowMoreOptions GPshowLayerAdvancedTools gpf-btn fr-icon-arrow-down-s-line fr-btn--sm fr-btn--tertiary-no-outline",e.title="Plus d'outils",e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button");let i=this;const n=o=>{let l=o.target.ariaPressed==="true";o.target.setAttribute("aria-pressed",!l);let c=document.getElementById(i._addUID("GPadvancedTools_ID_"+s.id));l?(c.classList.replace("GPelementVisible","GPelementHidden"),c.classList.replace("gpf-visible","gpf-hidden")):(c.classList.replace("GPelementHidden","GPelementVisible"),c.classList.replace("gpf-hidden","gpf-visible"))};return e.addEventListener?e.addEventListener("click",n):e.attachEvent&&e.attachEvent("onclick",n),e},_createAdvancedToolDivElement:function(s){let e=document.createElement("div");e.id=this._addUID("GPadvancedTools_ID_"+s.id),e.className="GPelementHidden GPlayerAdvancedTools gpf-hidden";let i=document.createElement("div");i.id=this._addUID("GPopacityContainer_ID_"+s.id),i.className="GPopacityContainer";let n=this._createOpacityElement(s.id,s.opacity);for(let l=0;l<n.length;l++)i.appendChild(n[l]);e.appendChild(i);let o=this._createButtonsGroupElement({className:"GPAdvancedToolBtnsGroup",id:s.id,left:!0,size:"sm"});if(s.advancedTools&&s.advancedTools instanceof Array){const l=this.constructor.switcherButtons;if(!s.advancedTools.length)return;s.advancedTools.forEach(c=>{const u=c.key;if(u&&Object.values(l).includes(u)){let h;switch(u){case l.INFO:h=this._createInformationElement;break;case l.EDIT:h=this._createEditionElement;break;case l.GREYSCALE:h=this._createGreyscaleElement;break;case l.EXTENT:h=this._createExtentElement;break}typeof h=="function"&&o.appendChild(h.call(this,s,c))}else c&&o.appendChild(this._createAdvancedToolElement(s,c))}),e.appendChild(o)}else checkDsfr()?(o.appendChild(this._createInformationElement(s,{})),o.appendChild(this._createEditionElement(s,{})),o.appendChild(this._createGreyscaleElement(s,{})),o.appendChild(this._createExtentElement(s,{}))):(o.appendChild(this._createInformationElement(s,{})),o.appendChild(this._createGreyscaleElement(s,{}))),e.appendChild(o);return e},_setAdvancedToolOptions:function(s,e,i=!0){if(!s)return;let n;e.label?n=e.label.toLowerCase().replaceAll(" ","-"):n=e.icon;const o=`gpf-btn-icon-ls-tools-${n}`;if(e.className&&(s.className+=` ${e.className} `),e.icon&&this._setButtonIconStyle(s,o,e.icon),e.label&&(s.innerHTML=e.label),e.title&&(s.title=e.title,s.ariaLabel=e.title),e.attributes)for(const c in e.attributes){if(!Object.hasOwn(e.attributes,c))continue;const u=e.attributes[c];s.setAttribute(c,u)}s.setAttribute("tabindex","0"),s.setAttribute("type","button");let l=this;return i&&s.addEventListener("click",c=>{l._onClickAdvancedToolsMore(c,e.label,e.cb)}),s},_setButtonIconStyle:function(s,e,i){let n=!1;const o=/(\.|\\)/;if(i&&(i.startsWith("<svg")?(i="data:image/svg+xml;base64,"+btoa(i),n=!0):o.test(i)?n=!0:s.className+=i),n&&(s.classList.add(e),!document.querySelector(`style[data-injected="${e.toLowerCase()}"]`))){const l=document.createElement("style");l.dataset.injected=e.toLowerCase(),l.textContent=`
                    .${e.toLowerCase()}::before {
                        width: 100%;
                        height: 100%;
                        -webkit-mask-image: url('${i}');
                        -webkit-mask-repeat: no-repeat;
                        -webkit-mask-position: center;

                        mask-image: url('${i}');
                        mask-repeat: no-repeat;
                        mask-position: center;
                    }
                `,document.head.appendChild(l)}},_createDeleteElement:function(s){let e=document.createElement("button");e.id=this._addUID("GPremove_ID_"+s);let i="gpf-btn-icon-ls-remove gpf-btn-icon";checkDsfr()&&(i="fr-icon-delete-line"),e.className=`GPlayerRemove gpf-btn ${i} fr-btn fr-btn--sm gpf-btn--tertiary fr-btn--tertiary-no-outline`,e.title="Supprimer la couche",e.layerId=s,e.setAttribute("tabindex","0"),e.setAttribute("type","button");var n=this;return e.addEventListener?e.addEventListener("click",function(o){n._onDropLayerClick(o)}):e.attachEvent&&e.attachEvent("onclick",function(o){n._onDropLayerClick(o)}),e},_createEditionElement:function(s,e){let i=s.id,n=s.editable,o=s.layer.config&&s.layer.config.serviceParams.id==="GPP:TMS",l=o?s.layer.config.styles:null,c=document.createElement("button");c.id=this._addUID("GPedit_ID_"+i),c.layerId=i;let u="gpf-btn-icon-ls-edit gpf-btn-icon",h;checkDsfr()&&(u="fr-icon-pencil-line",h="Style");let f="GPlayerEdit gpf-btn gpf-btn--tertiary fr-btn fr-btn--tertiary-no-outline";const g={icon:u,label:h},H=Helper.assign(g,e);H.className=f,e&&e.className&&(H.className+=` ${e.className}`),this._setAdvancedToolOptions(c,H,!1),(!n||o&&l.length===1)&&(c.disabled=!0);let Y=this;return o&&l.length>1?c.addEventListener?c.addEventListener("click",function(ee){Y._onEditLayerStyleClick(ee,l)}):c.attachEvent&&c.attachEvent("onclick",function(ee){Y._onEditLayerStyleClick(ee,l)}):c.addEventListener?c.addEventListener("click",function(ee){Y._onEditLayerClick(ee)}):c.attachEvent&&c.attachEvent("onclick",function(ee){Y._onEditLayerClick(ee)}),c},_createInformationElement:function(s,e){let i=s.id,n=s.title,o=s.description,l=document.createElement("button");l.id=this._addUID("GPinfo_ID_"+i),l.layerId=i;let c="gpf-btn-icon-ls-info gpf-btn-icon",u;checkDsfr()&&(c="fr-icon-information-line",u="Infos");let h="GPlayerInfo GPlayerInfoClosed gpf-btn gpf-btn--tertiary fr-btn fr-btn--tertiary-no-outline";const f={icon:c,label:u},g=Helper.assign(f,e);g.className=h,e&&e.className&&(g.className+=` ${e.className}`),this._setAdvancedToolOptions(l,g,!1),(!n||!o)&&(l.disabled=!0);var H=this;return l.addEventListener?l.addEventListener("click",function(Y){H._onOpenLayerInfoClick(Y)}):l.attachEvent&&l.attachEvent("onclick",function(Y){H._onOpenLayerInfoClick(Y)}),l},_createGreyscaleElement:function(s,e){let i=s.id,n=s.grayable,o=s.grayscale;e=e||{};var l=typeof o<"u"?o:!1;let c=document.createElement("button");c.id=this._addUID("GPgreyscale_ID_"+i),c.layerId=i;let u="gpf-btn-icon-ls-greyscale gpf-btn-icon",h;checkDsfr()&&(u="fr-icon-contrast-line",h="Noir et blanc");let f="GPlayerGreyscale GPlayerGreyscaleOff gpf-btn gpf-btn--tertiary fr-btn fr-btn--tertiary-no-outline";const g={icon:u,label:h},H=Helper.assign(g,e);H.className=f,e&&e.className&&(H.className+=` ${e.className}`),this._setAdvancedToolOptions(c,H,!1),l&&c.classList.replace("GPlayerGreyscaleOff","GPlayerGreyscaleOn"),c.setAttribute("aria-pressed",l),n||(c.disabled=!0);var Y=this;return c.addEventListener?c.addEventListener("click",function(ee){var te=ee.target.ariaPressed==="true";ee.target.setAttribute("aria-pressed",!te),Y._onToggleLayerGreyscaleClick(ee)}):c.attachEvent&&c.attachEvent("onclick",function(ee){var te=ee.target.ariaPressed==="true";ee.target.setAttribute("aria-pressed",!te),Y._onToggleLayerGreyscaleClick(ee)}),c},_createOpacityElement:function(s,e){var i=[],n=document.createElement("div");n.id=this._addUID("GPopacity_ID_"+s),n.className="GPlayerOpacity fr-range fr-range--sm",n.dataset.frJsRange="true",n.title="Opacit";var o=typeof e<"u"?e:1;o=Math.round(o*100),n.style.setProperty("--progress-right",o+"%");var l=document.createElement("input");l.id=this._addUID("GPopacityValueDiv_ID_"+s),l.type="range",l.value=o,l.ariaLabel="Opacit";var c=this;l.addEventListener?l.addEventListener("change",function(f){c._onChangeLayerOpacity(f)}):l.attachEvent&&l.attachEvent("onchange",function(f){c._onChangeLayerOpacity(f)}),l.addEventListener?l.addEventListener("input",function(f){c._onChangeLayerOpacity(f)}):l.attachEvent&&l.attachEvent("oninput",function(f){c._onChangeLayerOpacity(f)}),n.appendChild(l);var u=document.createElement("div");u.id=this._addUID("GPopacityValueDiv_ID_"+s),u.className="GPlayerOpacityValue";var h=document.createElement("span");return h.id=this._addUID("GPopacityValue_ID_"+s),h.className="gpf-range__output fr-range__output gpf-visible",h.innerHTML=o+"%",u.appendChild(h),i.push(n),i.push(u),i},_createExtentElement:function(s,e){let i=s.id,n=document.createElement("button");n.id=this._addUID("GPextent_ID_"+i),n.layerId=i,e=e||{};let o="gpf-btn-icon-ls-extent gpf-btn-icon",l;checkDsfr()&&(o="fr-icon-zoom-in-line",l="Recentrer");let c="GPelementHidden GPlayerExtent gpf-btn--tertiary gpf-btn fr-btn fr-btn--tertiary-no-outline";const u={icon:o,label:l},h=Helper.assign(u,e);h.className=c,e&&e.className&&(h.className+=` ${e.className}`),this._setAdvancedToolOptions(n,h,!1),n.setAttribute("aria-pressed",!0);var f=this;return n.addEventListener?n.addEventListener("click",function(g){var H=g.target.ariaPressed==="true";g.target.setAttribute("aria-pressed",!H),f._onZoomToExtentClick(g)}):n.attachEvent&&n.attachEvent("onclick",function(g){var H=g.target.ariaPressed==="true";g.target.setAttribute("aria-pressed",!H),f._onZoomToExtentClick(g)}),n},_createAdvancedToolElement:function(s,e){let i=s.id,n=document.createElement("button");const o=e.label.toLowerCase().replaceAll(" ","-");n.id=this._addUID("GPtools-"+o+"_ID_"+i),n.layerId=i,e=e||{};let l=e.icon,c;checkDsfr()&&(c=e.label);let u="GPlayerTools gpf-btn gpf-btn--tertiary fr-btn fr-btn--tertiary-no-outline";const h={icon:l,label:c},f=Helper.assign(h,e);if(f.className=u,e&&e.className&&(f.className+=` ${e.className}`),this._setAdvancedToolOptions(n,f,!1),Object.assign(n.style,e.styles),e.accepted&&e.accepted.length){const H=s.layer,Y=H.constructor.name;let ee=!0;for(const te of e.accepted)if(typeof te=="string"&&te===Y||te.prototype instanceof BaseLayer&&H instanceof te){ee=!1;break}n.disabled=ee}var g=this;return n.addEventListener?n.addEventListener("click",H=>{g._onClickAdvancedToolsMore(H,e.label,e.cb)}):n.attachEvent&&n.attachEvent("onclick",H=>{g._onClickAdvancedToolsMore(H,e.label,e.cb)}),n},_createContainerLayerInfoElement:function(s){var e=document.createElement("div"),i=document.createElement("div");i.className="gpf-panel__header_ls",e.appendChild(i);var n=document.createElement("label");n.className="GPlayerInfo gpf-btn-header gpf-btn-icon-ls-info",n.title="Informations",i.appendChild(n);var o=document.createElement("div");o.id=this._addUID("GPlayerInfoTitle"),o.innerHTML=s.title,o.className="gpf-panel__title_ls",i.appendChild(o);var l=document.createElement("button");l.id=this._addUID("GPlayerInfoClose"),l.className="GPpanelClose GPlayersPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",l.title="Fermer la fentre";var c=this,u=function(){document.getElementById(c._addUID("GPlayerInfoPanel")).classList.add("GPlayerInfoPanelClosed","gpf-hidden"),document.getElementById(c._addUID("GPlayerInfoPanel")).classList.remove("GPlayerInfoPanelOpened","gpf-visible"),document.getElementById(s.id).classList.add("GPlayerInfoClosed"),document.getElementById(s.id).classList.remove("GPlayerInfoOpened")};l.addEventListener?l.addEventListener("click",u):l.attachEvent&&l.attachEvent("onclick",u),this.addEventListener("layerswitcher:remove",yt=>{parseInt(s.id.split("-")[0].split("GPinfo_ID_")[1])===yt.layer.id&&(document.getElementById(c._addUID("GPlayerInfoPanel")).classList.add("GPlayerInfoPanelClosed","gpf-hidden"),document.getElementById(c._addUID("GPlayerInfoPanel")).classList.remove("GPlayerInfoPanelOpened","gpf-visible"))}),i.appendChild(l),e.appendChild(i);var h=document.createElement("div");if(h.id=this._addUID("GPlayerInfoContent"),h.className="gpf-panel__content fr-modal__content",e.appendChild(h),s.quicklookUrl){var f=document.createElement("div");f.id=this._addUID("GPlayerInfoQuicklook"),f.title="Afficher un aperu de la couche";var g=document.createElement("a");g.href=s.quicklookUrl,g.appendChild(f),h.appendChild(g)}var H=document.createElement("div");if(H.id=this._addUID("GPlayerInfoDescription"),H.innerHTML=s.description,h.appendChild(H),s.metadata){var Y=document.createElement("div");Y.id=this._addUID("GPlayerInfoMetadata");var ee=document.createElement("div");ee.className="GPlayerInfoSubtitle",ee.innerHTML="Mtadonnes",Y.appendChild(ee);for(var te=0;te<s.metadata.length;te++){var xe=s.metadata[te].url,ne=document.createElement("div");ne.className="GPlayerInfoLink";var et=document.createElement("a");et.href=xe,et.innerHTML=xe,ne.appendChild(et),Y.appendChild(ne)}s.metadata.length!==0&&h.appendChild(Y)}if(s.legends){var tt=document.createElement("div");tt.id=this._addUID("GPlayerInfoLegend");var it=document.createElement("div");it.className="GPlayerInfoSubtitle",it.innerHTML="Lgende",tt.appendChild(it);for(var rt={},nt=s.maxScaleDenominator||56e7,st=0;st<s.legends.length;st++){var at=s.legends[st].minScaleDenominator;if(at){var ot=at.toString();at=Math.round(parseInt(ot.substring(0,3),10)/10)*Math.pow(10,ot.length-2)}else at=270;rt[at]=s.legends[st]}for(var ct in rt)if(rt.hasOwnProperty(ct)){var ht=rt[ct].url;if(typeof ht=="string"&&ht.toLowerCase().indexOf("nolegend.jpg")===-1){var ut=document.createElement("div");ut.className="GPlayerInfoLink",nt=rt[ct].maxScaleDenominator||nt;var pt=document.createElement("a");pt.className="fr-link",pt.href=ht,pt.target="_blank",pt.innerHTML="Du 1/"+ct+" au 1/"+nt,ut.appendChild(pt),tt.appendChild(ut)}else delete rt[ct]}Object.keys(rt).length!==0&&h.appendChild(tt)}return e},_createContainerLayerStyleElement:function(s){var e=document.createElement("div"),i=document.createElement("div");i.className="gpf-panel__header_ls",e.appendChild(i);var n=document.createElement("label");n.className="GPlayerStyle gpf-btn-header gpf-btn-icon-ls-info",n.title="Informations",i.appendChild(n);var o=document.createElement("div");o.id=this._addUID("GPlayerStyleTitle"),o.innerHTML="Options de style",o.className="gpf-panel__title_ls",i.appendChild(o);var l=document.createElement("button");l.id=this._addUID("GPlayerStyleClose"),l.className="GPpanelClose GPlayersPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",l.title="Fermer la fentre";var c=this,u=function(){document.getElementById(c._addUID("GPlayerStylePanel")).classList.add("GPlayerStylePanelClosed","gpf-hidden"),document.getElementById(c._addUID("GPlayerStylePanel")).classList.remove("GPlayerStylePanelOpened","gpf-visible"),document.getElementById(s.div).classList.add("GPlayerStyleClosed"),document.getElementById(s.div).classList.remove("GPlayerStyleOpened")};l.addEventListener?l.addEventListener("click",u):l.attachEvent&&l.attachEvent("onclick",u),this.addEventListener("layerswitcher:remove",te=>{parseInt(s.id.split("-")[0].split("GPinfo_ID_")[1])===te.layer.id&&(document.getElementById(c._addUID("GPlayerStylePanel")).classList.add("GPlayerStylePanelClosed","gpf-hidden"),document.getElementById(c._addUID("GPlayerStylePanel")).classList.remove("GPlayerStylePanelOpened","gpf-visible"))}),i.appendChild(l),e.appendChild(i);var h=document.createElement("div");h.id=this._addUID("GPlayerStyleContent"),h.className="gpf-panel__content fr-modal__content",e.appendChild(h);var f=document.createElement("div");f.id=this._addUID("GPlayerStyleList");const g=/^([0-9a-f]{8}(-[0-9a-f]{4}){3}-[0-9a-f]{12}_)/i;for(let te=0;te<s.styles.length;te++){var H=s.styles[te],o=H.title?H.title:H.name;o=o.replace(g,"");var Y=document.createElement("div");Y.className="gpf-flex gpf-radio-group fr-radio-group fr-my-1w";var ee=document.createElement("input");ee.type="radio",ee.name=this._addUID("styleradio_ID_"+s.id),ee.id=this._addUID("styleradio_"+H.name+"_ID_"+s.id),ee.value=H.url,ee.dataset.name=H.name;var n=document.createElement("label");n.className="gpf-label fr-label",n.innerText=o,n.htmlFor=this._addUID("styleradio_"+H.name+"_ID_"+s.id),Y.appendChild(ee),Y.appendChild(n),f.appendChild(Y),s.layerInfo.layer.styleUrl===H.url&&(ee.checked=!0),ee.addEventListener("change",et=>{c._onChangeStyleLayerClick(et)})}return h.appendChild(f),e}},logger$C=LoggerByDefault.getLogger("layerswitcher");const Fi=class Fi extends ControlExtended{constructor(e){e=e||{};var i=e.options||{},n=e.layers||[];if(super(i),!(this instanceof Fi))throw new TypeError("ERROR CLASS_CONSTRUCTOR");if(!Array.isArray(n))throw new Error("ERROR WRONG_TYPE : layers should be an array");if(typeof i!="object")throw new Error("ERROR WRONG_TYPE : options should be an object");return this.CLASSNAME="LayerSwitcher",this._initialize(i,n),this.container=this._initContainer(i),this.element?this.element.appendChild(this.container):this.element=this.container,this}setMap(e){if(e)this._addMapLayers(e),this.collapsed||this._showLayerSwitcherButton.setAttribute("aria-pressed",!0),this._listeners.onMoveListener=e.on("moveend",()=>this._onMapMoveEnd(e)),this._listeners.onAddListener=e.getLayers().on("add",n=>{logger$C.debug("LayerSwitcher:onAddListener",n);var o=n.element,l;o.hasOwnProperty("gpLayerId")?l=o.gpLayerId:(l=this._layerId,o.gpLayerId=l,this._layerId++),this._layers[l]||this.addLayer(o)}),this._listeners.onRemoveListener=e.getLayers().on("remove",n=>{logger$C.debug("LayerSwitcher:onRemoveListener",n);var o=n.element,l=o.gpLayerId;this._layers[l]&&this.removeLayer(o)});else{unByKey(this._listeners.onMoveListener),unByKey(this._listeners.onAddListener),unByKey(this._listeners.onRemoveListener);for(var i=this._layersOrder.length-1;i>=0;i--);}super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter"),this.options.allowTooltips&&ToolTips.init()}addLayer(e,i){var n=this.getMap();if(i=i||e.config||{},!e){logger$C.log("[ERROR] LayerSwitcher:addLayer - missing layer parameter");return}var o=e.gpLayerId;if(typeof o>"u"){logger$C.trace("[WARN] LayerSwitcher:addLayer - configuration cannot be set for this layer (layer id not found)",e);return}var l=!1;if(n.getLayers().forEach(it=>{it.gpLayerId===o&&(l=!0)}),!l){logger$C.log("[ERROR] LayerSwitcher:addLayer - configuration cannot be set for ",e," layer (layer is not in map.getLayers() )");return}if(this._layers[o]){for(var te in i)i.hasOwnProperty(te)&&(this._layers[o][te]=i[te]);if(i.title){var xe=document.getElementById(this._addUID("GPname_ID_"+o));xe&&(xe.innerHTML=i.title,xe.title=i.description||i.title)}if(i.producer){let it=document.getElementById(this._addUID("GPlayerProducer_ID_"+o));it?it.innerHTML=i.producer:this.setLayerProducer(o,i.producer)}var ne=document.getElementById(this._addUID("GPinfo_ID_"+o));if(!document.getElementById(this._addUID("GPinfo_ID_"+o))&&i.description){var et=document.getElementById(this._addUID("GPadvancedTools_ID_"+o));et&&et.appendChild(this._createInformationElement({id:o}))}ne&&ne.className==="GPlayerInfoOpened"&&document.getElementById(this._addUID("GPlayerInfoPanel")).classList.add("GPlayerInfoPanelClosed","gpf-hidden")}else{var c=this.getLayerInfo(e)||{},u=e.getOpacity(),h=e.getVisible(),f=e.get("grayscale"),g=e.get("locked"),H=this.isInRange(e,n),Y={layer:e,id:o,name:e.name,service:e.service,type:"",opacity:u??1,visibility:h??!0,grayscale:f,locked:g,inRange:H??!0,producer:i.producer!=null?i.producer:c._producer||null,title:i.title!=null?i.title:c._title||o,thumbnail:i.thumbnail!=null?i.thumbnail:c._thumbnail||null,description:i.description||c._description||null,legends:i.legends||c._legends||[],metadata:i.metadata||c._metadata||[],quicklookUrl:i.quicklookUrl||c._quicklookUrl||null};this._layers[o]=Y;var ee=this._createLayerDiv(Y);this._layers[o].div=ee,e.getZIndex&&e.getZIndex()!==0&&typeof e.getZIndex()<"u"||e._forceNullzIndex?this._updateLayersOrder():(this._layersOrder.unshift(Y),this._lastZIndex++,e.setZIndex(this._lastZIndex),ee.dataset.sortableId=this._layerId,this._layerListContainer.insertBefore(ee,this._layerListContainer.firstChild)),this._listeners.updateLayerOpacity=e.on("change:opacity",it=>this._updateLayerOpacity(it)),this._listeners.updateLayerVisibility=e.on("change:visible",it=>this._updateLayerVisibility(it)),this._listeners.updateLayerGrayScale=e.on("change:grayscale",it=>this._updateLayerGrayScale(it)),this._listeners.updateLayerLocked=e.on("change:locked",it=>this._updateLayerLocked(it)),this._listeners.updateProperties=e.on("propertychange",it=>this._updateGenericProperty(it)),this._layers[o].onZIndexChangeEvent==null&&(this._layers[o].onZIndexChangeEvent=e.on("change:zIndex",()=>this._updateLayersOrder()))}this._updateLayerCounter();var tt=this;setTimeout(()=>{tt._updateLayerGrayScale({target:{gpLayerId:o}})},0),this.dispatchEvent({type:this.ADD_LAYER_EVENT,layer:this._layers[o]})}removeLayer(e){if(e){unByKey(this._listeners.updateLayerOpacity),unByKey(this._listeners.updateLayerVisibility),unByKey(this._listeners.updateLayerGrayScale),unByKey(this._listeners.updateLayerLocked),unByKey(this._listeners.updateProperties),logger$C.trace(e);var i=e.gpLayerId,n=document.getElementById(this._addUID("GPinfo_ID_"+i));n&&n.className==="GPlayerInfoOpened"&&document.getElementById(this._addUID("GPlayerInfoPanel")).classList.add("GPlayerInfoPanelClosed","gpf-hidden");var o=document.getElementById(this._addUID("GPedit_ID_"+i));o&&o.classList.contains("GPlayerStyleOpened")&&document.getElementById(this._addUID("GPlayerStylePanel")).classList.add("GPlayerStylePanelClosed","gpf-hidden");var l=document.getElementById(this._addUID("GPlayerSwitcher_ID_"+i));l&&this._layerListContainer.removeChild(l);var c=Math.abs(e.getZIndex()-this._lastZIndex);this._layersOrder.splice(c,1),this._lastZIndex--;for(var u=this._layersOrder,h=0;h<u.length;h++)u[h].layer.setZIndex(this._lastZIndex-h);this.dispatchEvent({type:this.REMOVE_LAYER_EVENT,layer:this._layers[i]}),e===this.getSelectedLayer()&&this.setSelectedLayer(),delete this._layers[i],this._updateLayerCounter()}}lockLayer(e,i){if(e){var n=e.gpLayerId,o=document.getElementById(this._addUID("GPlayerSwitcher_ID_"+n));o&&(i?o.setAttribute("disabled",!0):o.removeAttribute("disabled")),e.set("locked",i),this.dispatchEvent({type:this.LOCK_LAYER_EVENT,layer:this._layers[n],locked:i})}}setCollapsed(e){if(e===void 0){logger$C.log("[ERROR] LayerSwitcher:setCollapsed - missing collapsed parameter");return}var i=!document.getElementById(this._addUID("GPshowLayersList")).checked;e&&i||!e&&!i||(i||(document.getElementById(this._addUID("GPlayerInfoPanel")).classList.add("GPlayerInfoPanelClosed","gpf-hidden"),document.getElementById(this._addUID("GPlayerStylePanel")).classList.add("GPlayerStylePanelClosed","gpf-hidden")),document.getElementById(this._addUID("GPshowLayersList")).checked=!e)}getCollapsed(){return this.collapsed}setRemovable(e,i){if(e){var n=e.gpLayerId;if(n==null){logger$C.log("[LayerSwitcher:setRemovable] layer should be added to map before calling setRemovable method");return}var o=document.getElementById(this._addUID("GPremove_ID_"+n));o&&(i===!1?o.style.display="none":i===!0&&(o.style.display="block"))}}getContainer(){return this.container}forget(){unByKey(this._listeners.onAddListener)}listen(){var e=this.getMap();e&&(this._listeners.onAddListener=e.getLayers().on("add",i=>{logger$C.debug("LayerSwitcher:onAddListener",i);var n=i.element,o;n.hasOwnProperty("gpLayerId")?o=n.gpLayerId:(o=this._layerId,n.gpLayerId=o,this._layerId++),this._layers[o]||this.addLayer(n)}))}_initialize(e,i){this.options={id:"",collapsed:!0,draggable:!1,counter:!1,panel:!1,gutter:!1,allowEdit:!0,allowGrayScale:!0,allowDraggable:!0,allowDelete:!0,allowTooltips:!1,headerButtons:[],advancedTools:null},Helper.assign(this.options,e),this.options.layers=i,this._uid=this.options.id||SelectorID.generate(),this._layers={},this._layersOrder=[],this._layersIndex={},this._lastZIndex=0,this._layerId=0,this.collapsed=this.options.collapsed!==void 0?this.options.collapsed:!0,this._layerListContainer=null,this._listeners={};for(var n=0;n<i.length;n++){var o=i[n].layer;if(o){var l;o.hasOwnProperty("gpLayerId")?l=o.gpLayerId:(l=this._layerId,o.gpLayerId=l,this._layerId++);var c=i[n].config||{},u=this.getLayerInfo(o),h=o.getOpacity(),f=o.getVisible(),g=o.get("grayscale"),H={layer:o,id:l,name:o.name,service:o.service,opacity:h??1,visibility:f??!0,grayscale:g,title:c.title||u._title,description:c.description||u._description,legends:c.legends||u._legends,metadata:c.metadata||u._metadata,quicklookUrl:c.quicklookUrl||u._quicklookUrl,thumbnail:c.thumbnail||u._thumbnail,producer:c.producer||u._producer};this._layers[l]=H}}this._layerListContainer=null,this._layerSwitcherCounter=null,this._showLayerSwitcherButton=null,this.PROPERTY_CHANGE_EVENT="layerswitcher:propertychange",this.ADD_LAYER_EVENT="layerswitcher:add",this.REMOVE_LAYER_EVENT="layerswitcher:remove",this.LOCK_LAYER_EVENT="layerswitcher:lock",this.EXTENT_LAYER_EVENT="layerswitcher:extent",this.EDIT_LAYER_EVENT="layerswitcher:edit",this.CUSTOM_LAYER_EVENT="layerswitcher:custom",this.HEADER_BUTTON_EVENT="layerswitcher:header:button",this.CHANGE_LAYER_OPACITY_EVENT="layerswitcher:change:opacity",this.CHANGE_LAYER_VISIBILITY_EVENT="layerswitcher:change:visibility",this.CHANGE_LAYER_GRAYSCALE_EVENT="layerswitcher:change:grayscale",this.CHANGE_LAYER_LOCKED_EVENT="layerswitcher:change:locked",this.CHANGE_LAYER_SELECTED_EVENT="layerswitcher:change:selected"}_initContainer(){var e=this._createMainContainerElement(),i=this._createMainLayersShowElement();e.appendChild(i),this.collapsed?this.collapsed=!0:(i.checked="checked",this.collapsed=!1);var n=this,o=function(tt){this.collapsed=!tt.target.checked,this.dispatchEvent("change:collapsed")};i.addEventListener("click",function(tt){o.call(n,tt)});var l=this._showLayerSwitcherButton=this._createMainPictoElement();if(e.appendChild(l),e.classList.add("GplayerSwitcher-counterRemoved"),this.options.counter){e.classList.remove("GplayerSwitcher-counterRemoved"),e.classList.add("GplayerSwitcher-counterAdded");var c=this._layerSwitcherCounter=this._createMainCounterLayersElement();l.appendChild(c)}var u=this._createMainLayersElement();if(e.appendChild(u),this.options.panel){var h=this._createLayersPanelHeaderElement();u.appendChild(h);var f=this._createLayersPanelIconElement();h.appendChild(f);var g=this._createLayersPanelTitleElement();h.appendChild(g);var H=this._createLayersPanelCloseElement();h.appendChild(H)}var Y=this._createMainLayersDivElement();if(u.appendChild(Y),this.options.headerButtons.length){let tt=this._createHeaderButtonsDivElement(),it=this._createButtonsGroupElement({className:"GPbodyHeaderBtnsGroup",size:"sm"});this.options.headerButtons.forEach(rt=>{let nt=this._createButtonHeaderElement(rt);it.appendChild(nt)}),tt.appendChild(it),Y.appendChild(tt)}var ee=this._layerListContainer=this._createMainLayerListElement();Y.appendChild(ee),this._createDraggableElement(ee,this);var te=this._createMainInfoElement(),xe=this._createMainInfoDivElement();te.appendChild(xe),e.appendChild(te);var ne=this._createMainStyleElement(),et=this._createMainStyleDivElement();return ne.appendChild(et),e.appendChild(ne),e}_addMapLayers(e){this._layersIndex={},e.getLayers().forEach(h=>{var f=null;h.hasOwnProperty("gpLayerId")?f=h.gpLayerId:(f=this._layerId,h.gpLayerId=f,this._layerId++);var g=this.getLayerInfo(h)||{};if(this._layers[f])this._layers[f].opacity=h.getOpacity(),this._layers[f].visibility=h.getVisible(),this._layers[f].grayscale=h.get("grayscale"),this._layers[f].locked=h.get("locked"),this._layers[f].inRange=this.isInRange(h,e);else{var H=h.getOpacity(),Y=h.getVisible(),ee=h.get("grayscale"),te=h.get("locked"),xe=this.isInRange(h,e),ne={layer:h,id:f,name:h.name,service:h.service,opacity:H??1,visibility:Y??!0,grayscale:ee,locked:te,inRange:xe??!0,producer:g._producer||null,thumbnail:g._thumbnail||null,title:g._title||f,description:g._description||null,legends:g._legends||[],metadata:g._metadata||[],quicklookUrl:g._quicklookUrl||null};this._layers[f]=ne}this._updateLayerCounter(),this._listeners.updateLayerOpacity=h.on("change:opacity",it=>this._updateLayerOpacity(it)),this._listeners.updateLayerVisibility=h.on("change:visible",it=>this._updateLayerVisibility(it)),this._listeners.updateLayerGrayScale=h.on("change:grayscale",it=>this._updateLayerGrayScale(it)),this._listeners.updateLayerLocked=h.on("change:locked",it=>this._updateLayerLocked(it)),this._listeners.updateProperties=h.on("propertychange",it=>this._updateGenericProperty(it));var et=this;if(setTimeout(()=>{et._updateLayerGrayScale({target:{gpLayerId:f}})},0),h.getZIndex!==void 0){var tt=h.getZIndex()||0;(!this._layersIndex[tt]||!Array.isArray(this._layersIndex[tt]))&&(this._layersIndex[tt]=[]),this._layersIndex[tt].push(this._layers[f])}});for(var i in this._layersIndex)if(this._layersIndex.hasOwnProperty(i))for(var n=this._layersIndex[i],o=0;o<n.length;o++)this._layersOrder.unshift(n[o]),this._lastZIndex++,n[o].layer.setZIndex(this._lastZIndex),this._layers[n[o].layer.gpLayerId].onZIndexChangeEvent==null&&(this._layers[n[o].layer.gpLayerId].onZIndexChangeEvent=n[o].layer.on("change:zIndex",()=>this._updateLayersOrder()));for(var l=0;l<this._layersOrder.length;l++){var c=this._layersOrder[l],u=this._createLayerDiv(c);u.dataset.sortableId=c.id,this._layerListContainer.querySelector("#"+u.id)||this._layerListContainer.appendChild(u),this._layers[c.id].div=u}}_createLayerDiv(e){var i=e.legends&&e.legends.length!==0,n=e.metadata&&e.metadata.length!==0,o=e.quicklookUrl;(i||n||o)&&(e.displayInformationElement=!0),e.editable=!1,this.options.allowEdit&&(e.layer instanceof VectorLayer||e.layer instanceof VectorTileLayer)&&(e.editable=!0),e.grayable=!1,this.options.allowGrayScale&&(e.layer instanceof TileLayer||e.layer instanceof VectorTileLayer)&&(e.grayable=!0),e.draggable=!1,this.options.allowDraggable&&(e.draggable=!0),e.deletable=!1,this.options.allowDelete&&(e.deletable=!0),e.advancedTools=this.options.advancedTools;var l=this._createContainerLayerElement(e,this.options.allowTooltips);return e.inRange||l.classList.add("outOfRange"),l}onShowLayerSwitcherClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen();var i=this._showLayerSwitcherButton.ariaPressed;this.collapsed=i!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position)}_updateLayerCounter(){this._layerSwitcherCounter&&(this._layerSwitcherCounter.innerHTML=Object.keys(this._layers).length)}_onChangeLayerOpacity(e){e.target.parentNode.style.setProperty("--progress-right",e.target.value+"%");var i=e.target.id,n=SelectorID.index(i),o=this._layers[n].layer,l=e.target.value,c=document.getElementById(this._addUID("GPopacityValue_ID_"+n));c.innerHTML=l+"%",o.setOpacity(l/100)}_updateLayerOpacity(e){var i=e.target.getOpacity();i>1&&(i=1),i<0&&(i=0);var n=e.target.gpLayerId,o=document.getElementById(this._addUID("GPopacityValueDiv_ID_"+n));o&&(o.value=Math.round(i*100));var l=document.getElementById(this._addUID("GPopacityValue_ID_"+n));l&&(l.innerHTML=Math.round(i*100)+"%"),this.dispatchEvent({type:this.CHANGE_LAYER_OPACITY_EVENT,opacity:i,layer:this._layers[n]})}_onVisibilityLayerClick(e){var i=e.target.id,n=SelectorID.index(i),o=this._layers[n].layer;o.setVisible(e.target.ariaPressed==="true")}_updateLayerVisibility(e){var i=e.target.getVisible(),n=e.target.gpLayerId,o=document.getElementById(this._addUID("GPvisibilityPicto_ID_"+n));o&&(o.ariaPressed=i),this.dispatchEvent({type:this.CHANGE_LAYER_VISIBILITY_EVENT,visibility:i,layer:this._layers[n]})}_onChangeStyleLayerClick(e){var i=e.target.id,l=SelectorID.index(i),n=this._layers[l].layer;n.set("grayscale",!1);var o=e.target.id,l=SelectorID.index(o),c=document.getElementById(this._addUID("GPgreyscale_ID_"+l));c&&(c.classList.add("GPlayerGreyscaleOff"),c.classList.remove("GPlayerGreyscaleOn")),n.styleUrl=e.target.value,n.styleName=e.target.dataset.name,n.setStyleMapBox(),this.dispatchEvent({type:"layerswitcher:change:style",name:n.styleName,url:n.styleUrl,layer:this._layers[l]})}_updateLayersOrder(){var e=this.getMap();if(e){this._layersIndex={};var i,n;e.getLayers().forEach(f=>{n=f.gpLayerId,unByKey(this._layers[n].onZIndexChangeEvent),this._layers[n].onZIndexChangeEvent=null,i=null,f.getZIndex!==void 0&&(i=f.getZIndex(),(!this._layersIndex[i]||!Array.isArray(this._layersIndex[i]))&&(this._layersIndex[i]=[]),this._layersIndex[i].push(this._layers[n]))}),this._lastZIndex=0,this._layersOrder=[];for(var o in this._layersIndex)if(this._layersIndex.hasOwnProperty(o))for(var l=this._layersIndex[o],c=0;c<l.length;c++)this._layersOrder.unshift(l[c]),this._lastZIndex++,this._layers[l[c].layer.gpLayerId].onZIndexChangeEvent==null&&(this._layers[l[c].layer.gpLayerId].onZIndexChangeEvent=l[c].layer.on("change:zIndex",()=>this._updateLayersOrder()));if(this._layerListContainer){for(let f=0;f<this._layerListContainer.childNodes.length;f++){const g=this._layerListContainer.childNodes[f];g.id!==""&&g.remove()}for(var u=0;u<this._layersOrder.length;u++){var h=this._layersOrder[u];this._layerListContainer.appendChild(h.div)}}else logger$C.log("[ol.control.LayerSwitcher] _updateLayersOrder : layer list container not found to update layers order ?!")}}_onOpenLayerInfoClick(e){var i=e.target.id,n=SelectorID.index(i),o=this._layers[n],l,c,u=document.getElementById(e.target.id);if(u.classList.contains("GPlayerInfoOpened")){u.classList.remove("GPlayerInfoOpened"),u.classList.add("GPlayerInfoClosed"),l=document.getElementById(this._addUID("GPlayerInfoPanel")),l.classList.remove("GPlayerInfoPanelOpened","gpf-visible"),l.classList.add("GPlayerInfoPanelClosed","gpf-hidden"),c=document.getElementById(this._addUID("GPlayerInfoContent")),c&&c.parentNode.remove();return}u.classList.contains("GPlayerInfoClosed")&&(u.classList.remove("GPlayerInfoClosed"),u.classList.add("GPlayerInfoOpened")),l=document.getElementById(this._addUID("GPlayerInfoPanel")),l.classList.remove("GPlayerInfoPanelClosed","gpf-hidden"),l.classList.add("GPlayerInfoPanelOpened","gpf-visible"),c=document.getElementById(this._addUID("GPlayerInfoContent")),c&&c.parentNode.remove();var h={id:i,title:o.title,description:o.description,quicklookUrl:o.quicklookUrl,metadata:o.metadata,legends:o.legends},f=o.layer.getMaxResolution();f===1/0?h._maxScaleDenominator=56e7:h._maxScaleDenominator=Math.round(f/28e-5);var g=this._createContainerLayerInfoElement(h);l.firstChild.appendChild(g)}_onEditLayerStyleClick(e,i){var n=e.target.id,o=SelectorID.index(n),l=this._layers[o],c,u,h=document.getElementById(e.target.id);if(h.classList.contains("GPlayerStyleOpened")){h.classList.remove("GPlayerStyleOpened"),h.classList.add("GPlayerStyleClosed"),c=document.getElementById(this._addUID("GPlayerStylePanel")),c.classList.remove("GPlayerStylePanelOpened","gpf-visible"),c.classList.add("GPlayerStylePanelClosed","gpf-hidden"),u=document.getElementById(this._addUID("GPlayerStyleContent")),u&&u.parentNode.remove();return}h.classList.contains("GPlayerStyleClosed")&&(h.classList.remove("GPlayerStyleClosed"),h.classList.add("GPlayerStyleOpened")),c=document.getElementById(this._addUID("GPlayerStylePanel")),c.classList.remove("GPlayerStylePanelClosed","gpf-hidden"),c.classList.add("GPlayerStylePanelOpened","gpf-visible"),u=document.getElementById(this._addUID("GPlayerStyleContent")),u&&u.parentNode.remove();var f={id:o,div:n,styles:i,layerInfo:l},g=l.layer.getMaxResolution();g===1/0?f._maxScaleDenominator=56e7:f._maxScaleDenominator=Math.round(g/28e-5);var H=this._createContainerLayerStyleElement(f);c.firstChild.appendChild(H)}_onDropLayerClick(e){var i=e.target.id,n=SelectorID.index(i),o=this._layers[n].layer;this.getMap().getLayers().remove(o)}_onEditLayerClick(e){var i=e.target.id,n=SelectorID.index(i),o=this._layers[n],l=this._layers[n].layer;this.dispatchEvent({type:this.EDIT_LAYER_EVENT,layer:l,options:o})}_onEndDragAndDropLayerClick(e){logger$C.trace(e);var i=this.getMap(),n=document.querySelectorAll("div.GPlayerSwitcher_layer"),o=n.length;this._layersOrder=[];for(var l=0;l<n.length;l++){var c=n[l].id,u=SelectorID.index(c),h=this._layers[u].layer;unByKey(this._layers[u].onZIndexChangeEvent),this._layers[u].onZIndexChangeEvent=null,h.setZIndex&&(h.setZIndex(o),this._layersOrder.push(this._layers[u]),o--),this._layers[u].onZIndexChangeEvent==null&&(this._layers[u].onZIndexChangeEvent=h.on("change:zIndex",()=>this._updateLayersOrder()))}i.updateSize(),this.dispatchEvent({type:"layerswitcher:change:position",position:e.newIndex,layer:this._layersOrder[e.newIndex],layers:this._layersOrder})}_onStartDragAndDropLayerClick(e){logger$C.debug(e)}_updateLayerGrayScale(e){function i(ne){ne.crossOrigin="anonymous";var et=document.createElement("canvas"),tt=et.getContext("2d");ne.width=ne.width||256,ne.height=ne.height||256,et.width=ne.width,et.height=ne.height,tt.drawImage(ne,0,0);for(var it=tt.getImageData(0,0,ne.width,ne.height),rt=it.data,nt=0;nt<rt.length;nt+=4){var st=(rt[nt]+rt[nt+1]+rt[nt+2])/3;rt[nt]=st,rt[nt+1]=st,rt[nt+2]=st}return tt.putImageData(it,0,0),et.toDataURL()}function n(ne,et){var tt=i(ne);ne.src="",ne.src=tt}function o(ne){ne.image.getImage().crossOrigin="Anonymous"}function l(ne){ne.tile.getImage().crossOrigin="Anonymous"}function c(ne){n(ne.image.getImage(),ne.target)}function u(ne){n(ne.tile.getImage(),ne.target)}function h(ne){if(!ne||typeof ne!="string"||!ne.startsWith("#"))return ne;const et=parseInt(ne.slice(1,3),16),tt=parseInt(ne.slice(3,5),16),it=parseInt(ne.slice(5,7),16),nt=Math.round(.3*et+.59*tt+.11*it).toString(16).padStart(2,"0");return`#${nt}${nt}${nt}`}async function f(ne){var et=await H(ne);et.layers.forEach(tt=>{tt.paint&&Object.keys(tt.paint).forEach(it=>{let rt=tt.paint[it];if(Array.isArray(rt)&&rt[0]==="interpolate"&&rt[2]==="zoom")for(let nt=4;nt<rt.length;nt+=2)rt[nt]=h(rt[nt]);else if(Array.isArray(rt)&&rt[0]==="step")for(let nt=2;nt<rt.length;nt+=2)rt[nt]=h(rt[nt]);else if(rt instanceof Object&&rt.stops)for(let nt=0;nt<rt.stops.length;nt+=1)rt.stops[nt][1]=h(rt.stops[nt][1]);else tt.paint[it]=h(rt)})}),applyStyle(ne,et)}async function g(ne){var et=await H(ne);applyStyle(ne,et)}async function H(ne){return await(await fetch(ne.styleUrl)).json()}var Y=e.target.gpLayerId,ee=this._layers[Y].layer,te=ee.getSource();if(!(te instanceof ImageSource||te instanceof TileWMS||te instanceof WMTS$1||te instanceof VectorTile)){console.warn("Greyscale only implemented for raster and vector tiles");return}var xe=ee.get("grayscale");xe?te instanceof VectorTile?f(ee):te instanceof ImageSource?(te.loadstartListenerKey=te.on("imageloadstart",o),te.loadendListenerKey=te.on("imageloadend",c)):(te.loadstartListenerKey=te.on("tileloadstart",l),te.loadendListenerKey=te.on("tileloadend",u)):te instanceof VectorTile?g(ee):(unByKey(te.loadstartListenerKey),unByKey(te.loadendListenerKey),te.loadstartListenerKey=null,te.loadendListenerKey=null),te instanceof VectorTile||te.refresh(),this.dispatchEvent({type:this.CHANGE_LAYER_GRAYSCALE_EVENT,grayscale:xe,layer:this._layers[Y]})}_onToggleLayerGreyscaleClick(e){console.trace(e);var i=e.target.id,n=SelectorID.index(i),o=this._layers[n].layer,l=!0;e.target.classList.contains("GPlayerGreyscaleOff")?(e.target.classList.remove("GPlayerGreyscaleOff"),e.target.classList.add("GPlayerGreyscaleOn")):(e.target.classList.add("GPlayerGreyscaleOff"),e.target.classList.remove("GPlayerGreyscaleOn"),l=!1),o.set("grayscale",l)}_updateLayerLocked(e){var i=e.target.gpLayerId,n=this._layers[i].layer,o=n.get("locked"),l=document.getElementById(this._addUID("GPlayerSwitcher_ID_"+i));l&&(o?l.setAttribute("disabled",!0):l.removeAttribute("disabled")),this.dispatchEvent({type:this.CHANGE_LAYER_LOCKED_EVENT,locked:o,layer:this._layers[i]})}_updateGenericProperty(e){var i=e.target.gpLayerId,n=this._layers[i].layer,o=n.get(e.key);switch(e.key){case"title":this._layers[i].title=o;var l=document.getElementById(this._addUID("GPname_ID_"+i));l&&(l.innerHTML=o,l.title=o);break;case"description":this._layers[i].description=o;var l=document.getElementById(this._addUID("GPname_ID_"+i));l&&(l.title=o);break;case"producer":this._layers[i].producer=o;var c=document.getElementById(this._addUID("GPlayerProducer_ID_"+i));c&&(c.innerHTML=o);break}this.dispatchEvent({type:this.PROPERTY_CHANGE_EVENT,key:e.key,value:o,layer:this._layers[i]})}_onToggleLayerLockedClick(e){var i=e.target.id,n=SelectorID.index(i),o=this._layers[n].layer,l=e.target.ariaPressed==="true";o.set("locked",l)}_onZoomToExtentClick(e){logger$C.debug(e);var i=e.target.id,n=SelectorID.index(i),o=this._layers[n],l=null,c=null,u=this.getMap();if(o.layer.hasOwnProperty("gpResultLayerId")&&(o.layer.gpResultLayerId.split(":")[0]==="layerimport"||o.layer.gpResultLayerId.split(":")[0]==="drawing"||o.layer.gpResultLayerId.split(":")[0]==="compute"||o.layer.gpResultLayerId.split(":")[0]==="bookmark")){if(u.getView()&&u.getSize()){var h=o.layer.getExtent();if(!h){var f=o.layer.getSource();f&&f.getExtent?h=f.getExtent():h=f.getTileGrid().getExtent()}h&&h[0]!==1/0&&u.getView().fit(h,u.getSize())}}else try{if(!Config.isConfigLoaded())throw"ERROR : contract key configuration has to be loaded to load Geoportal layers.";var g=o.layer.name||o.layer.getSource().name,H=o.layer.service||o.layer.getSource().service,Y=Config.configuration.getLayerId(g,H);if(!Y)throw"ERROR : Layer ID not found into the catalogue !?";var ee=Config.configuration.getGlobalConstraints(Y);if(ee){if(!u||!u.getView())return;var te=u.getView(),xe=te.getProjection(),ne=[ee.extent.left,ee.extent.bottom,ee.extent.right,ee.extent.top],et=ee.crs;et||(et="EPSG:4326"),l=transformExtent(ne,et,xe),l&&te.fit(l)}}catch(tt){c=tt}this.dispatchEvent({type:this.EXTENT_LAYER_EVENT,extent:l,layer:o,error:c})}_onClickAdvancedToolsMore(e,i,n){var o=e.target.id,l=SelectorID.index(o),c=this._layers[l],u=this._layers[l].layer;if(n){n(e,this,u,c);return}this.dispatchEvent({type:this.CUSTOM_LAYER_EVENT,action:i,layer:u,options:c})}_onClickHeaderButtons(e,i,n){if(n){n(e,this);return}this.dispatchEvent({type:this.HEADER_BUTTON_EVENT,action:i})}_onSelectLayer(e){if(e.type!=="keydown"||["Enter","Space"].includes(e.code)&&e.target.id.startsWith("GPlayerSwitcher_ID_")){const n=e.target.id,o=SelectorID.index(n);if(this._layers[o]){const c=this._layers[o].layer;c!==this.getSelectedLayer()&&this.setSelectedLayer(c,!0)}}}getSelectedLayer(){return this.selectedLayer}setSelectedLayer(e,i){let n=this.getSelectedLayer();if(e===n&&n&&n.get("selected")!==i?(e.set("selected",i),this.selectedLayer=null):!e&&n?(n.set("selected",!1),this.selectedLayer=null):(e.set("selected",!!i),i?this.selectedLayer=e:this.selectedLayer=null,n&&n.set("selected",!1)),this.getSelectedLayer()){const o=this._layers[this.getSelectedLayer().gpLayerId].div;o.ariaCurrent=!0}if(n){const o=this._layers[n.gpLayerId].div;o.ariaCurrent=!1}this.dispatchEvent({type:this.CHANGE_LAYER_SELECTED_EVENT,layer:this.getSelectedLayer(),previous:n})}_onMapMoveEnd(e){e.getLayers().forEach(i=>{var n=i.gpLayerId;if(this._layers[n]){var o=this._layers[n],l;if(this.isInRange(i,e)&&!o.inRange){o.inRange=!0,l=document.getElementById(this._addUID("GPlayerSwitcher_ID_"+n)),l.classList.remove("outOfRange");var c=this.getLayerInfo(i),u=c._title,h=c._description,f=document.getElementById(this._addUID("GPname_ID_"+n));f&&(f.title=h||u)}else!this.isInRange(i,e)&&o.inRange&&(o.inRange=!1,l=document.getElementById(this._addUID("GPlayerSwitcher_ID_"+n)),l.classList.add("outOfRange"))}})}getLayerDOMId(e){var i=null;return this.getMap().getLayers().forEach(n=>{n===e&&(i=n.hasOwnProperty("gpLayerId")?n.gpLayerId:null)}),i!==null?this._addUID("GPlayerSwitcher_ID_"+i):null}isInRange(e,i){if(i){var n=e.gpLayerId,o=document.getElementById(this._addUID("GPname_ID_"+n)),l=i.getView().getResolution();if(l>e.getMaxResolution()||l<e.getMinResolution()){var c="Cette couche n'est pas visible  ce niveau de zoom";return o&&(o.title=c),!1}var u=i.getView().calculateExtent(i.getSize()),h=e.getExtent();if(h&&!intersects$1(u,h)){var c="Cette couche n'est pas visible  cet endroit";return o&&(o.title=c),!1}return!0}}getLayerInfo(e){var i={};if(e.getProperties!==void 0&&e.getSource!==void 0){var n=e.getProperties(),o=n.source;o&&(i._title=o._title||n.title||n.id||"",i._description=o._description||n.description||"",i._producer=o._producer||n.producer||"",i._thumbnail=o._thumbnail||n.thumbnail||"",i._quicklookUrl=o._quicklookUrl||n.quicklookUrl||"",i._metadata=o._metadata||n.metadata||[],i._legends=o._legends||n.legends||[])}return i}setLayerProducer(e,i){let n=e.gpLayerId,o=this._layers[n].div;if(o){let l=o.querySelector(".GPlayerTitle");if(l.childElementCount===2&&l.querySelector(".GPlayerProducer").remove(),i){let c=this._createLayerProducerElement({producer:i},this.options.allowTooltips);l.appendChild(c)}}}};ei(Fi,"switcherButtons",{INFO:"info",EDIT:"edition",GREYSCALE:"greyscale",EXTENT:"extent"});let LayerSwitcher=Fi;Object.assign(LayerSwitcher.prototype,LayerSwitcherDOM);Object.assign(LayerSwitcher.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.LayerSwitcher=LayerSwitcher);LoggerByDefault.getLogger("draggable");var Draggable={dragElement:function(s,e,i){let n=0,o=0,l=0,c=0,u=0,h=0;e?e.addEventListener("mousedown",H,!0):s.addEventListener("mousedown",H,!0);var f,g={bottom:0,left:0,right:0,top:0};function H(te){te=te||window.event,te.preventDefault(),n=te.clientX,o=te.clientY,f=s.getBoundingClientRect();const xe=i.getBoundingClientRect();g={bottom:xe.bottom,left:xe.left,right:xe.right,top:xe.top},document.addEventListener("mouseup",Y,!0),document.addEventListener("mousemove",ee,!0)}function Y(){u-=l,h-=c,document.removeEventListener("mouseup",Y,!0),document.removeEventListener("mousemove",ee,!0)}function ee(te){te=te||window.event;let xe=te.clientX,ne=te.clientY,et=l,tt=c;l=n-xe,c=o-ne;var it=f.left-l,rt=f.top-c;if(it<g.left||rt<g.top||it+f.width>g.right||rt+f.height>g.bottom)l=et,c=tt;else{let nt=u-l,st=h-c;s.style.transform="translate("+nt+"px,"+st+"px)"}}}};class AsyncData{constructor(e){this.data=e,this.subscribers=[]}subscribe(e){if(typeof e!="function")throw new Error("Callback must be a function");this.subscribers.push(e)}async set(e,i){this.data[e]=i;const n=this.subscribers.map(async o=>{await o(e,i)});await Promise.allSettled(n)}get(e){return this.data[e]}}var GetFeatureInfoDOM={_addUID:function(s){var e=this.uid?s+"-"+this.uid:s;return e},stringToHTML:function(s){var e=function(){if(!window.DOMParser)return!1;var l=new DOMParser;try{l.parseFromString("x","text/html")}catch{return!1}return!0};if(e()){var i=new DOMParser,n=i.parseFromString(s,"text/html");return n.body}var o=document.createElement("div");return o.innerHTML=s,o},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPgetFeatureInfo"),s.className="GPgetFeatureInfo gpf-widget gpf-widget-button gpf-mobile-fullscreen",s},_createShowGetFeatureInfoPictoElement:function(){var s=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPgetFeatureInfoPicto"),e.classList.add("GPshowOpen","GPshowAdvancedToolPicto","GPgetFeatureInfoPicto"),e.classList.add("gpf-btn","gpf-btn--tertiary","gpf-btn-icon","gpf-btn-icon-getfeatureinfo"),e.classList.add("fr-btn","fr-btn--tertiary"),e.setAttribute("aria-label","Activer/dsactiver l'interrogation des couches"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowGetFeatureInfoClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowGetFeatureInfoClick(n)}),e},_createGetFeatureInfoPanelElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPgetFeatureInfoPanel"),s.className="GPpanel gpf-panel fr-modal",s},_createGetFeatureInfoPanelDivElement:function(){var s=document.createElement("div");return s.className="GPpanelBody fr-modal__body",s},_createGetFeatureInfoPanelHeaderElement:function(){var s=document.createElement("div");return s.className="GPpanelHeader gpf-panel__header_gfi",s},_createGetFeatureInfoPanelIconElement:function(){var s=document.createElement("label");return s.className="GPpanelIcon gpf-btn-header_gfi gpf-btn-icon-header_gfi",s.title="Get Feature Info",s},_createGetFeatureInfoPanelTitleElement:function(){var s=document.createElement("div");return s.className="GPpanelTitle gpf-panel__title_gfi fr-modal__title",s.innerHTML="Infos sur les couches",s},_createGetFeatureInfoPanelCloseElement:function(){var s=this,e=document.createElement("button");e.className="GPpanelClose GPcloseGetFeatureInfo gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline",e.title="Fermer le panneau",e.addEventListener?e.addEventListener("click",function(n){e.setAttribute("aria-pressed",!1),s.onCloseGetFeatureInfoClick()},!1):e.attachEvent&&e.attachEvent("onclick",function(n){e.setAttribute("aria-pressed",!1),s.onCloseGetFeatureInfoClick()});var i=document.createElement("span");return i.className="GPelementHidden gpf-visible",i.innerText="Fermer",e.appendChild(i),e},_createGetFeatureInfoWaitingDiv:function(){var s=`
        <div class="waiting-div-container"><div class="lds-ring"><div></div><div></div><div></div><div></div></div><div>
        `;return s},_createGetFeatureInfoNoData:function(s){var e=document.createElement("div");return e.className="GPgetFeatureInfoNoData fr-py-2w fr-px-2w",console.log(this.stringToHTML(s)),e.insertAdjacentHTML("beforeend",s),e},_createGetFeatureInfoAccordionGroup:function(){var s=document.createElement("div");return s.id=this._addUID("GPgetFeatureInfoAccordionGroup"),s.className="GPgetFeatureInfoAccordionGroup fr-accordions-group",s},_createGetFeatureInfoLayerAccordion:function(s){var e=this.stringToHTML(`
            <section class="fr-accordion">
                <h3 class="fr-accordion__title">
                    <button class="GPgfiLayerButton fr-accordion__btn" aria-expanded="false" aria-controls="accordion-${s}">
                        <span class="GPshowGfiLayerFeature"></span>
                        <span id="gfiLayerName">${s}</span>
                    </button>
                </h3>
                <div class="fr-collapse GPgetFeatureInfoAccordionContent GPelementHidden" id="accordion-${s}" style="margin:unset;">
                    ${this._createGetFeatureInfoWaitingDiv()}
                </div>
            </section>
        `),i=e.firstChild,n=i.querySelector("button, button.fr-accordion__btn");return n.addEventListener("click",o=>{o.currentTarget.ariaExpanded=o.currentTarget.ariaExpanded!=="true";var l=document.getElementById(o.currentTarget.getAttribute("aria-controls"));o.currentTarget.ariaExpanded==="true"?(l.classList.add("fr-collapse--expanded"),l.classList.remove("GPelementHidden"),requestAnimationFrame(()=>{n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})})):(l.classList.remove("fr-collapse--expanded"),l.classList.add("GPelementHidden"))}),i}},logger$B=LoggerByDefault.getLogger("getFeatureInfo");class GetFeatureInfo extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof GetFeatureInfo))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="GetFeatureInfo",this.initialize(e),this.container=this.initContainer(),this.element?this.element.appendChild(this.container):this.element=this.container,this}setMap(e){e?(this.draggable&&Draggable.dragElement(this.panelGetFeatureInfoContainer,this.panelGetFeatureInfoHeaderContainer,e.getTargetElement()),this.collapsed||this.buttonGetFeatureInfoShow.setAttribute("aria-pressed",!0),this.auto&&this.addEventsListeners(e)):this.auto&&this.removeEventsListeners(),super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.element.classList.add("gpf-button-no-gutter")}initialize(e){this.uid=e.id||SelectorID.generate(),this.options={collapsed:!0,draggable:!1,auto:!0},Helper.assign(this.options,e),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this.noDataMessage=this.options.noDataMessage,this.auto=this.options.auto,this.buttonGetFeatureInfoShow=null,this.panelGetFeatureInfoContainer=null,this.getFeatureInfoPanelDiv=null,this.panelGetFeatureInfoHeaderContainer=null,this.buttonGetFeatureInfoClose=null,this.getFeatureInfoAccordionGroup=null,this.panelGetFeatureInfoEntriesContainer=null,this.noDataMessageDiv=null,this.eventsListeners=[],this.pixel=[],this.coordinates=[],this.layers=[],this.res=null}initContainer(){var e=this._createMainContainerElement(),i=this.buttonGetFeatureInfoShow=this._createShowGetFeatureInfoPictoElement();e.appendChild(i);var n=this.panelGetFeatureInfoContainer=this._createGetFeatureInfoPanelElement(),o=this.getFeatureInfoPanelDiv=this._createGetFeatureInfoPanelDivElement();n.appendChild(o);var l=this.panelGetFeatureInfoHeaderContainer=this._createGetFeatureInfoPanelHeaderElement(),c=this._createGetFeatureInfoPanelIconElement();l.appendChild(c);var u=this._createGetFeatureInfoPanelTitleElement();l.appendChild(u);var h=this.buttonGetFeatureInfoClose=this._createGetFeatureInfoPanelCloseElement();l.appendChild(h),o.appendChild(l);var f=this.getFeatureInfoAccordionGroup=this._createGetFeatureInfoAccordionGroup();return o.appendChild(f),this.noDataMessage&&(this.noDataMessageDiv=this._createGetFeatureInfoNoData(this.noDataMessage)),e.appendChild(n),logger$B.log(e),e}addEventsListeners(e){var i=this;this.eventsListeners.singleclick=function(n){logger$B.trace(n),i.onMapClick(n)},e.on("singleclick",this.eventsListeners.singleclick)}removeEventsListeners(){var e=this.getMap();e.getLayers().un("singleclick",this.eventsListeners.singleclick),delete this.eventsListeners.singleclick}getFeatureInfoIsActive(){return this.buttonGetFeatureInfoShow.getAttribute("aria-pressed")}onMapClick(e){if(this.getFeatureInfoIsActive()==="true")if(this.getFeatureInfoAccordionGroup.remove(),this.noDataMessage&&this.noDataMessageDiv.remove(),this.buttonGetFeatureInfoClose.setAttribute("aria-pressed",!0),this.layers=e.map.getLayers().getArray().filter(n=>{if(n.isVisible(e.map.getView())&&n.getOpacity()>0)return n}).sort((n,o)=>o.getZIndex()-n.getZIndex()),this.layers.length>0){var i=this.getFeatureInfoAccordionGroup=this._createGetFeatureInfoAccordionGroup();this.getFeatureInfoPanelDiv.appendChild(i),this.map=e.map,this.pixel=e.pixel,this.coordinates=e.coordinate,this.res=e.map.getView().getResolution(),this.displayGetFeatureInfo()}else{this.noDataMessage&&this.getFeatureInfoPanelDiv.append(this.noDataMessageDiv);return}}getGetFeatureInfoLayer(e){var i={};let n=this.getLayerFormat(e);if(i={format:n,layer:e},n==="wmts"){let o=e.getSource().getFeatureInfoUrl(this.coordinates,this.res,this.map.getView().getProjection(),{INFOFORMAT:"text/html",STYLES:""});i={...i,url:o}}if(n==="wms"){let o=e.getSource().getFeatureInfoUrl(this.coordinates,this.res,this.map.getView().getProjection(),{INFO_FORMAT:"text/html",STYLES:""});i={...i,url:o}}return i}getFeaturesAtClick(e){var i=[];return this.getMap().forEachFeatureAtPixel(this.pixel,function(n,o){e==o&&i.push(n)}),i}async getGetFeatureInfoContent(e){var i=null;if(e.format==="vector"){var n=this.getFeaturesAtClick(e.layer);return n&&(i=this.features2html(n)),i}else return fetch(e.url).then(o=>o.text()).then(o=>{var l=!1;if((o.trim().length===0||o.indexOf("ServiceExceptionReport")!==-1||o.indexOf("java.lang.NullPointerException")!==-1||o.indexOf("java.lang.OutOfMemoryError")!==-1||o.indexOf("not queryable")!==-1||o.indexOf("No data")!==-1||o.indexOf("non interrogeable")!==-1)&&(l=!0),l)return null;var c=this.stringToHTML(o);return c&&c.innerHTML&&c.innerHTML.trim().length>0?o:null}).catch(o=>(logger$B.log(o),o))}getLayerTitle(e){if(e.layer.getProperties!==void 0&&e.layer.getSource!==void 0){var i=e.layer.getProperties(),n=i.source,o="";n&&(o=n._title||n.name||i.title||i.name||n.url_||"Couche de donnes")}return o}displayGetFeatureInfo(){var e=this.layers.map(n=>this.getGetFeatureInfoLayer(n)),i=e.map(n=>{var o=this.getLayerTitle(n),l=null,c=this._createGetFeatureInfoLayerAccordion(o);c.style.display="none";var u=!0;return new AsyncData({...n,layername:o,content:l,contentDiv:c,pending:u})});for(let n=0;n<i.length;n++)this.getFeatureInfoAccordionGroup.append(i[n].data.contentDiv);i.forEach(n=>{n.subscribe((o,l)=>{o=="content"&&(n.set("pending",!1),n.get("content")?(n.get("contentDiv").querySelector("div.fr-collapse").innerHTML=n.get("content"),this.buttonGetFeatureInfoClose.setAttribute("aria-pressed",!0),n.get("contentDiv").style.display="block"):n.get("contentDiv").remove(),i.filter(c=>c.get("pending")===!0).length==0&&i.filter(c=>c.get("content")).length==0&&(this.noDataMessage?this.getFeatureInfoPanelDiv.append(this.noDataMessageDiv):this.buttonGetFeatureInfoClose.setAttribute("aria-pressed",!1)))})}),i.forEach(n=>{this.getGetFeatureInfoContent(n.data).then(o=>{n.set("content",o)})})}getLayerFormat(e){var i=typeof e.getType=="function"?e.getType():null,n=e.getSource();if(i){if(i==="VECTOR"||i==="VECTOR_TILE")return"vector";if(i==="TILE")return n.tileGrid?"wmts":"wms";if(i==="IMAGE")return"wms"}else{if(n instanceof TileWMS||n instanceof ImageWMS)return"wms";if(n instanceof WMTS$1)return"wmts";if(n instanceof VectorSource||n instanceof VectorTile)return"vector"}return"unknown"}features2html(e){var i=document.createElement("div");return e.forEach(function(n){var o=n.getProperties();if(o.hasOwnProperty("render"))i.insertAdjacentHTML("beforeend",o.render);else{if(o.hasOwnProperty("name")){var l=document.createElement("div");l.className="gp-att-name-div",l.insertAdjacentHTML("afterbegin",o.name),i.appendChild(l)}if(o.hasOwnProperty("description")){var c=document.createElement("div");c.className="gp-att-description-div",c.insertAdjacentHTML("afterbegin",o.description),i.appendChild(c)}var u=null,h=!1,f=null,g=null,H=null,Y=["fill","fill-opacity","label-fill","label-fill-opacity","label-stroke","label-stroke-opacity","label-stroke-width","label-font","label-textAlign","stroke","stroke-opacity","stroke-width","marker-symbol","marker-color","marker-size","geometry","value","name","description","styleUrl","extensionsNode_","icon"];for(u in o)if(o[u]!==void 0&&Y.indexOf(u)===-1){h||(f=document.createElement("div"),f.className="gp-att-others-div",g=document.createElement("ul"),h=!0),H=document.createElement("li");var ee=document.createElement("span");ee.className="gp-attname-others-span",ee.appendChild(document.createTextNode(u+" : ")),H.appendChild(ee),H.appendChild(document.createTextNode(o[u])),g.appendChild(H)}g&&(f.appendChild(g),i.appendChild(f))}}),i.hasChildNodes()?i=i.innerHTML:i="",i}onShowGetFeatureInfoClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen(),e.target.ariaPressed==="false"&&this.buttonGetFeatureInfoClose.setAttribute("aria-pressed",!1),logger$B.trace(e)}onCloseGetFeatureInfoClick(e){logger$B.trace(e)}onGetFeatureInfoComputationSubmit(e){logger$B.trace(e)}}Object.assign(GetFeatureInfo.prototype,GetFeatureInfoDOM);Object.assign(GetFeatureInfo.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.GetFeatureInfo=GetFeatureInfo);var MathUtils={modulo:function(s,e){var i=s%e;return i*e<0?i+e:i},decimalToDMS:function(s,e,i){var n=this.modulo(s+180,360)-180,o=Math.abs(3600*n),l=i||0,c=Math.pow(10,l),u=Math.floor(o/3600),h=Math.floor((o-u*3600)/60),f=o-u*3600-h*60;f=Math.ceil(f*c)/c,f>=60&&(f=0,h+=1),h>=60&&(h=0,u+=1);var g=e.charAt(n<0?1:0);return{d:u,m:h,s:f,direction:g}},dmsToDecimal(s,e,i,n){var o=s+e/60+i/3600;return(n=="S"||n=="O")&&(o=o*-1),o},coordinateToDecimal(s){var e={};return e.lat=s[1].toFixed(6),e.lng=s[0].toFixed(6),e.unit="",e},coordinateToDMS(s){return{lng:MathUtils.decimalToDMS(s[0],"EO",2),lat:MathUtils.decimalToDMS(s[1],"NS",2),unit:"DMS"}},coordinateToRad(s){var e={},i=.017453292519943295;return e.lng=s[0]*i,e.lng=e.lng.toFixed(8),e.lat=s[1]*i,e.lat=e.lat.toFixed(8),e.unit="rad",e},coordinateToGon(s){var e={},i=1.1111111111111112;return e.lng=s[0]*i,e.lng=e.lng.toFixed(8),e.lat=s[1]*i,e.lat=e.lat.toFixed(8),e.unit="gon",e},coordinateToMeter(s){var e={};return e.x=s[0].toFixed(2),e.y=s[1].toFixed(2),e.unit="m",e},coordinateToKMeter(s){var e={};return e.x=(s[0]/1e3).toFixed(2),e.y=(s[1]/1e3).toFixed(2),e.unit="km",e},toInteger:function(s,e){var i=e||10,n=parseInt(s,i);return!isNaN(n)&&isFinite(n)?n:null},isInteger:function(s){if(isNaN(s))return!1;var e=parseFloat(s);return(e|0)===e},toFloat:function(s){var e=parseFloat(s);return!isNaN(e)&&isFinite(e)?e:null},convertSecondsToTime:function(s){var e="";s=Math.round(s);var i=Math.floor(s/3600),n=s%3600,o=Math.floor(n/60);return i&&(e=i+"h "),e+=o+" min",e},convertDistance:function(s){var e="",i=parseInt(s/1e3,10);return i?e=i+" km":e=parseInt(s,10)+" m",e}},SearchEngineUtils={advancedSearchFiltersByDefault:{PositionOfInterest:[{name:"q",title:"Chercher un lieu"},{name:"category",title:"Type",value:["cimetire","arodrome","rservoir","administratif","construction linaire","construction ponctuelle","construction surfacique","cours d'eau","dtail hydrographique","dtail orographique","quipement de transport","plan d'eau","poste de transformation","terrain de sport","transport par cble","zone d'activit ou d'intrt","zone d'habitation","lieu-dit non habit"]},{name:"postcode",title:"Code postal"},{name:"citycode",title:"Code INSEE"}],StreetAddress:[{name:"address",title:"Adresse"},{name:"city",title:"Ville"},{name:"postcode",title:"Code postal"}],CadastralParcel:[{name:"departmentcode",title:"Code dpartement (INSEE)",description:"Code INSEE du dpartement (ex: 01, 94)"},{name:"municipalitycode",title:"Code commune (INSEE)",description:"Code INSEE de la commune : 3 chiffres (ex: 067)"},{name:"oldmunicipalitycode",title:"Commune absorbe",description:"Commune absorbe : 3 chiffres (ex: 000, 001)"},{name:"districtcode",title:"Arrondissement",description:"Arrondissement : 3 chiffres (ex: 004, 012)"},{name:"section",title:"Section",description:"Section Cadastrale : 2 caractres (chiffre et/ou lettre)"},{name:"number",title:"Numro",description:"Numro de la parcelle : 4 chiffres (ex: 0041, 0250)"},{name:"sheet",title:"Feuille",description:"Numro de la feuille cadastrale"}]},zoomToResultsByDefault:function(s){var e=15,i=s.service,n=s.fields,o=s.type,l={1:11,2:12,3:13,4:14,5:15,6:16,7:17,8:17};return i==="SuggestedLocation"&&o==="PositionOfInterest"&&(e=l[n.classification]),i==="GeocodedLocation"&&o==="PositionOfInterest"&&(e=l[n.importance]||14),o==="StreetAddress"&&(e=17),o==="CadastralParcel"&&(e=17),e}},GeocodeUtils={getGeocodedLocationFreeform:function(s){var e=s.placeAttributes;if(e.label)return e.label;if(s.type==="PositionOfInterest"){var i=e.toponym;return e.category&&Array.isArray(e.category)&&e.category.length>=2&&e.category[0]==="administratif"?i=i+", "+e.category[1]:e.postcode&&(i=i+", "+e.postcode[0],e.city&&(i=i+" "+e.city[0])),i}else return s.type==="StreetAddress"?(e.housenumber?e.housenumber+" ":"")+e.street+" "+(e.postcode?e.postcode+", ":"")+e.city:s.type==="CadastralParcel"?e.id:"..."},getSuggestedLocationFreeform:function(s){if(s.fullText)return s.fullText;var e=[];return e.push(s.street||""),e.push(s.postalCode||""),e.push(s.commune||""),s.type==="PositionOfInterest"&&(e.push(s.poi||""),e.push(s.kind||"")),e.join(" - ")}};function globals(s){s("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),s("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),s("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var e=1;e<=60;++e)s("EPSG:"+(32600+e),"+proj=utm +zone="+e+" +datum=WGS84 +units=m"),s("EPSG:"+(32700+e),"+proj=utm +zone="+e+" +south +datum=WGS84 +units=m");s.WGS84=s["EPSG:4326"],s["EPSG:3785"]=s["EPSG:3857"],s.GOOGLE=s["EPSG:3857"],s["EPSG:900913"]=s["EPSG:3857"],s["EPSG:102113"]=s["EPSG:3857"]}var PJD_3PARAM=1,PJD_7PARAM=2,PJD_GRIDSHIFT=3,PJD_WGS84=4,PJD_NODATUM=5,SRS_WGS84_SEMIMAJOR=6378137,SRS_WGS84_SEMIMINOR=6356752314e-3,SRS_WGS84_ESQUARED=.0066943799901413165,SEC_TO_RAD=484813681109536e-20,HALF_PI=Math.PI/2,SIXTH=.16666666666666666,RA4=.04722222222222222,RA6=.022156084656084655,EPSLN=1e-10,D2R$1=.017453292519943295,R2D=57.29577951308232,FORTPI=Math.PI/4,TWO_PI=Math.PI*2,SPI=3.14159265359,exports$2={};exports$2.greenwich=0;exports$2.lisbon=-9.131906111111;exports$2.paris=2.337229166667;exports$2.bogota=-74.080916666667;exports$2.madrid=-3.687938888889;exports$2.rome=12.452333333333;exports$2.bern=7.439583333333;exports$2.jakarta=106.807719444444;exports$2.ferro=-17.666666666667;exports$2.brussels=4.367975;exports$2.stockholm=18.058277777778;exports$2.athens=23.7163375;exports$2.oslo=10.722916666667;const units={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.01},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var ignoredChar=/[\s_\-\/\(\)]/g;function match(s,e){if(s[e])return s[e];for(var i=Object.keys(s),n=e.toLowerCase().replace(ignoredChar,""),o=-1,l,c;++o<i.length;)if(l=i[o],c=l.toLowerCase().replace(ignoredChar,""),c===n)return s[l]}function projStr(s){var e={},i=s.split("+").map(function(u){return u.trim()}).filter(function(u){return u}).reduce(function(u,h){var f=h.split("=");return f.push(!0),u[f[0].toLowerCase()]=f[1],u},{}),n,o,l,c={proj:"projName",datum:"datumCode",rf:function(u){e.rf=parseFloat(u)},lat_0:function(u){e.lat0=u*D2R$1},lat_1:function(u){e.lat1=u*D2R$1},lat_2:function(u){e.lat2=u*D2R$1},lat_ts:function(u){e.lat_ts=u*D2R$1},lon_0:function(u){e.long0=u*D2R$1},lon_1:function(u){e.long1=u*D2R$1},lon_2:function(u){e.long2=u*D2R$1},alpha:function(u){e.alpha=parseFloat(u)*D2R$1},gamma:function(u){e.rectified_grid_angle=parseFloat(u)},lonc:function(u){e.longc=u*D2R$1},x_0:function(u){e.x0=parseFloat(u)},y_0:function(u){e.y0=parseFloat(u)},k_0:function(u){e.k0=parseFloat(u)},k:function(u){e.k0=parseFloat(u)},a:function(u){e.a=parseFloat(u)},b:function(u){e.b=parseFloat(u)},r:function(u){e.a=e.b=parseFloat(u)},r_a:function(){e.R_A=!0},zone:function(u){e.zone=parseInt(u,10)},south:function(){e.utmSouth=!0},towgs84:function(u){e.datum_params=u.split(",").map(function(h){return parseFloat(h)})},to_meter:function(u){e.to_meter=parseFloat(u)},units:function(u){e.units=u;var h=match(units,u);h&&(e.to_meter=h.to_meter)},from_greenwich:function(u){e.from_greenwich=u*D2R$1},pm:function(u){var h=match(exports$2,u);e.from_greenwich=(h||parseFloat(u))*D2R$1},nadgrids:function(u){u==="@null"?e.datumCode="none":e.nadgrids=u},axis:function(u){var h="ewnsud";u.length===3&&h.indexOf(u.substr(0,1))!==-1&&h.indexOf(u.substr(1,1))!==-1&&h.indexOf(u.substr(2,1))!==-1&&(e.axis=u)},approx:function(){e.approx=!0}};for(n in i)o=i[n],n in c?(l=c[n],typeof l=="function"?l(o):e[l]=o):e[n]=o;return typeof e.datumCode=="string"&&e.datumCode!=="WGS84"&&(e.datumCode=e.datumCode.toLowerCase()),e}class PROJJSONBuilderBase{static getId(e){const i=e.find(n=>Array.isArray(n)&&n[0]==="ID");return i&&i.length>=3?{authority:i[1],code:parseInt(i[2],10)}:null}static convertUnit(e,i="unit"){if(!e||e.length<3)return{type:i,name:"unknown",conversion_factor:null};const n=e[1],o=parseFloat(e[2])||null,l=e.find(u=>Array.isArray(u)&&u[0]==="ID"),c=l?{authority:l[1],code:parseInt(l[2],10)}:null;return{type:i,name:n,conversion_factor:o,id:c}}static convertAxis(e){const i=e[1]||"Unknown";let n;const o=i.match(/^\((.)\)$/);if(o){const f=o[1].toUpperCase();if(f==="E")n="east";else if(f==="N")n="north";else if(f==="U")n="up";else throw new Error(`Unknown axis abbreviation: ${f}`)}else n=e[2]?e[2].toLowerCase():"unknown";const l=e.find(f=>Array.isArray(f)&&f[0]==="ORDER"),c=l?parseInt(l[1],10):null,u=e.find(f=>Array.isArray(f)&&(f[0]==="LENGTHUNIT"||f[0]==="ANGLEUNIT"||f[0]==="SCALEUNIT")),h=this.convertUnit(u);return{name:i,direction:n,unit:h,order:c}}static extractAxes(e){return e.filter(i=>Array.isArray(i)&&i[0]==="AXIS").map(i=>this.convertAxis(i)).sort((i,n)=>(i.order||0)-(n.order||0))}static convert(e,i={}){switch(e[0]){case"PROJCRS":i.type="ProjectedCRS",i.name=e[1],i.base_crs=e.find(Y=>Array.isArray(Y)&&Y[0]==="BASEGEOGCRS")?this.convert(e.find(Y=>Array.isArray(Y)&&Y[0]==="BASEGEOGCRS")):null,i.conversion=e.find(Y=>Array.isArray(Y)&&Y[0]==="CONVERSION")?this.convert(e.find(Y=>Array.isArray(Y)&&Y[0]==="CONVERSION")):null;const n=e.find(Y=>Array.isArray(Y)&&Y[0]==="CS");n&&(i.coordinate_system={type:n[1],axis:this.extractAxes(e)});const o=e.find(Y=>Array.isArray(Y)&&Y[0]==="LENGTHUNIT");if(o){const Y=this.convertUnit(o);i.coordinate_system.unit=Y}i.id=this.getId(e);break;case"BASEGEOGCRS":case"GEOGCRS":i.type="GeographicCRS",i.name=e[1];const l=e.find(Y=>Array.isArray(Y)&&(Y[0]==="DATUM"||Y[0]==="ENSEMBLE"));if(l){const Y=this.convert(l);l[0]==="ENSEMBLE"?i.datum_ensemble=Y:i.datum=Y;const ee=e.find(te=>Array.isArray(te)&&te[0]==="PRIMEM");ee&&ee[1]!=="Greenwich"&&(Y.prime_meridian={name:ee[1],longitude:parseFloat(ee[2])})}i.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(e)},i.id=this.getId(e);break;case"DATUM":i.type="GeodeticReferenceFrame",i.name=e[1],i.ellipsoid=e.find(Y=>Array.isArray(Y)&&Y[0]==="ELLIPSOID")?this.convert(e.find(Y=>Array.isArray(Y)&&Y[0]==="ELLIPSOID")):null;break;case"ENSEMBLE":i.type="DatumEnsemble",i.name=e[1],i.members=e.filter(Y=>Array.isArray(Y)&&Y[0]==="MEMBER").map(Y=>({type:"DatumEnsembleMember",name:Y[1],id:this.getId(Y)}));const c=e.find(Y=>Array.isArray(Y)&&Y[0]==="ENSEMBLEACCURACY");c&&(i.accuracy=parseFloat(c[1]));const u=e.find(Y=>Array.isArray(Y)&&Y[0]==="ELLIPSOID");u&&(i.ellipsoid=this.convert(u)),i.id=this.getId(e);break;case"ELLIPSOID":i.type="Ellipsoid",i.name=e[1],i.semi_major_axis=parseFloat(e[2]),i.inverse_flattening=parseFloat(e[3]),e.find(Y=>Array.isArray(Y)&&Y[0]==="LENGTHUNIT")&&this.convert(e.find(Y=>Array.isArray(Y)&&Y[0]==="LENGTHUNIT"),i);break;case"CONVERSION":i.type="Conversion",i.name=e[1],i.method=e.find(Y=>Array.isArray(Y)&&Y[0]==="METHOD")?this.convert(e.find(Y=>Array.isArray(Y)&&Y[0]==="METHOD")):null,i.parameters=e.filter(Y=>Array.isArray(Y)&&Y[0]==="PARAMETER").map(Y=>this.convert(Y));break;case"METHOD":i.type="Method",i.name=e[1],i.id=this.getId(e);break;case"PARAMETER":i.type="Parameter",i.name=e[1],i.value=parseFloat(e[2]),i.unit=this.convertUnit(e.find(Y=>Array.isArray(Y)&&(Y[0]==="LENGTHUNIT"||Y[0]==="ANGLEUNIT"||Y[0]==="SCALEUNIT"))),i.id=this.getId(e);break;case"BOUNDCRS":i.type="BoundCRS";const h=e.find(Y=>Array.isArray(Y)&&Y[0]==="SOURCECRS");if(h){const Y=h.find(ee=>Array.isArray(ee));i.source_crs=Y?this.convert(Y):null}const f=e.find(Y=>Array.isArray(Y)&&Y[0]==="TARGETCRS");if(f){const Y=f.find(ee=>Array.isArray(ee));i.target_crs=Y?this.convert(Y):null}const g=e.find(Y=>Array.isArray(Y)&&Y[0]==="ABRIDGEDTRANSFORMATION");g?i.transformation=this.convert(g):i.transformation=null;break;case"ABRIDGEDTRANSFORMATION":if(i.type="Transformation",i.name=e[1],i.method=e.find(Y=>Array.isArray(Y)&&Y[0]==="METHOD")?this.convert(e.find(Y=>Array.isArray(Y)&&Y[0]==="METHOD")):null,i.parameters=e.filter(Y=>Array.isArray(Y)&&(Y[0]==="PARAMETER"||Y[0]==="PARAMETERFILE")).map(Y=>{if(Y[0]==="PARAMETER")return this.convert(Y);if(Y[0]==="PARAMETERFILE")return{name:Y[1],value:Y[2],id:{authority:"EPSG",code:8656}}}),i.parameters.length===7){const Y=i.parameters[6];Y.name==="Scale difference"&&(Y.value=Math.round((Y.value-1)*1e12)/1e6)}i.id=this.getId(e);break;case"AXIS":i.coordinate_system||(i.coordinate_system={type:"unspecified",axis:[]}),i.coordinate_system.axis.push(this.convertAxis(e));break;case"LENGTHUNIT":const H=this.convertUnit(e,"LinearUnit");i.coordinate_system&&i.coordinate_system.axis&&i.coordinate_system.axis.forEach(Y=>{Y.unit||(Y.unit=H)}),H.conversion_factor&&H.conversion_factor!==1&&i.semi_major_axis&&(i.semi_major_axis={value:i.semi_major_axis,unit:H});break;default:i.keyword=e[0];break}return i}}class PROJJSONBuilder2015 extends PROJJSONBuilderBase{static convert(e,i={}){return super.convert(e,i),i.coordinate_system&&i.coordinate_system.subtype==="Cartesian"&&delete i.coordinate_system,i.usage&&delete i.usage,i}}class PROJJSONBuilder2019 extends PROJJSONBuilderBase{static convert(e,i={}){super.convert(e,i);const n=e.find(l=>Array.isArray(l)&&l[0]==="CS");n&&(i.coordinate_system={subtype:n[1],axis:this.extractAxes(e)});const o=e.find(l=>Array.isArray(l)&&l[0]==="USAGE");if(o){const l=o.find(h=>Array.isArray(h)&&h[0]==="SCOPE"),c=o.find(h=>Array.isArray(h)&&h[0]==="AREA"),u=o.find(h=>Array.isArray(h)&&h[0]==="BBOX");i.usage={},l&&(i.usage.scope=l[1]),c&&(i.usage.area=c[1]),u&&(i.usage.bbox=u.slice(1))}return i}}function detectWKT2Version(s){return s.find(e=>Array.isArray(e)&&e[0]==="USAGE")?"2019":(s.find(e=>Array.isArray(e)&&e[0]==="CS")||s[0]==="BOUNDCRS"||s[0]==="PROJCRS"||s[0]==="GEOGCRS","2015")}function buildPROJJSON(s){return(detectWKT2Version(s)==="2019"?PROJJSONBuilder2019:PROJJSONBuilder2015).convert(s)}function detectWKTVersion(s){const e=s.toUpperCase();return e.includes("PROJCRS")||e.includes("GEOGCRS")||e.includes("BOUNDCRS")||e.includes("VERTCRS")||e.includes("LENGTHUNIT")||e.includes("ANGLEUNIT")||e.includes("SCALEUNIT")?"WKT2":(e.includes("PROJCS")||e.includes("GEOGCS")||e.includes("LOCAL_CS")||e.includes("VERT_CS")||e.includes("UNIT"),"WKT1")}var NEUTRAL=1,KEYWORD=2,NUMBER=3,QUOTED=4,AFTERQUOTE=5,ENDED=-1,whitespace=/\s/,latin=/[A-Za-z]/,keyword$1=/[A-Za-z84_]/,endThings=/[,\]]/,digets=/[\d\.E\-\+]/;function Parser(s){if(typeof s!="string")throw new Error("not a string");this.text=s.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=NEUTRAL}Parser.prototype.readCharicter=function(){var s=this.text[this.place++];if(this.state!==QUOTED)for(;whitespace.test(s);){if(this.place>=this.text.length)return;s=this.text[this.place++]}switch(this.state){case NEUTRAL:return this.neutral(s);case KEYWORD:return this.keyword(s);case QUOTED:return this.quoted(s);case AFTERQUOTE:return this.afterquote(s);case NUMBER:return this.number(s);case ENDED:return}};Parser.prototype.afterquote=function(s){if(s==='"'){this.word+='"',this.state=QUOTED;return}if(endThings.test(s)){this.word=this.word.trim(),this.afterItem(s);return}throw new Error(`havn't handled "`+s+'" in afterquote yet, index '+this.place)};Parser.prototype.afterItem=function(s){if(s===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=NEUTRAL;return}if(s==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=NEUTRAL,this.currentObject=this.stack.pop(),this.currentObject||(this.state=ENDED);return}};Parser.prototype.number=function(s){if(digets.test(s)){this.word+=s;return}if(endThings.test(s)){this.word=parseFloat(this.word),this.afterItem(s);return}throw new Error(`havn't handled "`+s+'" in number yet, index '+this.place)};Parser.prototype.quoted=function(s){if(s==='"'){this.state=AFTERQUOTE;return}this.word+=s};Parser.prototype.keyword=function(s){if(keyword$1.test(s)){this.word+=s;return}if(s==="["){var e=[];e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=NEUTRAL;return}if(endThings.test(s)){this.afterItem(s);return}throw new Error(`havn't handled "`+s+'" in keyword yet, index '+this.place)};Parser.prototype.neutral=function(s){if(latin.test(s)){this.word=s,this.state=KEYWORD;return}if(s==='"'){this.word="",this.state=QUOTED;return}if(digets.test(s)){this.word=s,this.state=NUMBER;return}if(endThings.test(s)){this.afterItem(s);return}throw new Error(`havn't handled "`+s+'" in neutral yet, index '+this.place)};Parser.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===ENDED)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function parseString(s){var e=new Parser(s);return e.output()}function mapit(s,e,i){Array.isArray(e)&&(i.unshift(e),e=null);var n=e?{}:s,o=i.reduce(function(l,c){return sExpr(c,l),l},n);e&&(s[e]=o)}function sExpr(s,e){if(!Array.isArray(s)){e[s]=!0;return}var i=s.shift();if(i==="PARAMETER"&&(i=s.shift()),s.length===1){if(Array.isArray(s[0])){e[i]={},sExpr(s[0],e[i]);return}e[i]=s[0];return}if(!s.length){e[i]=!0;return}if(i==="TOWGS84"){e[i]=s;return}if(i==="AXIS"){i in e||(e[i]=[]),e[i].push(s);return}Array.isArray(i)||(e[i]={});var n;switch(i){case"UNIT":case"PRIMEM":case"VERT_DATUM":e[i]={name:s[0].toLowerCase(),convert:s[1]},s.length===3&&sExpr(s[2],e[i]);return;case"SPHEROID":case"ELLIPSOID":e[i]={name:s[0],a:s[1],rf:s[2]},s.length===4&&sExpr(s[3],e[i]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":s[0]=["name",s[0]],mapit(e,i,s);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":s[0]=["name",s[0]],mapit(e,i,s),e[i].type=i;return;default:for(n=-1;++n<s.length;)if(!Array.isArray(s[n]))return sExpr(s,e[i]);return mapit(e,i,s)}}var D2R=.017453292519943295;function d2r(s){return s*D2R}function applyProjectionDefaults(s){const e=(s.projName||"").toLowerCase().replace(/_/g," ");!s.long0&&s.longc&&(e==="albers conic equal area"||e==="lambert azimuthal equal area")&&(s.long0=s.longc),!s.lat_ts&&s.lat1&&(e==="stereographic south pole"||e==="polar stereographic (variant b)")?(s.lat0=d2r(s.lat1>0?90:-90),s.lat_ts=s.lat1,delete s.lat1):!s.lat_ts&&s.lat0&&(e==="polar stereographic"||e==="polar stereographic (variant a)")&&(s.lat_ts=s.lat0,s.lat0=d2r(s.lat0>0?90:-90),delete s.lat1)}function processUnit(s){let e={units:null,to_meter:void 0};return typeof s=="string"?(e.units=s.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.units==="meter"&&(e.to_meter=1)):s&&s.name&&(e.units=s.name.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.to_meter=s.conversion_factor),e}function toValue(s){return typeof s=="object"?s.value*s.unit.conversion_factor:s}function calculateEllipsoid(s,e){s.ellipsoid.radius?(e.a=s.ellipsoid.radius,e.rf=0):(e.a=toValue(s.ellipsoid.semi_major_axis),s.ellipsoid.inverse_flattening!==void 0?e.rf=s.ellipsoid.inverse_flattening:s.ellipsoid.semi_major_axis!==void 0&&s.ellipsoid.semi_minor_axis!==void 0&&(e.rf=e.a/(e.a-toValue(s.ellipsoid.semi_minor_axis))))}function transformPROJJSON(s,e={}){return!s||typeof s!="object"?s:s.type==="BoundCRS"?(transformPROJJSON(s.source_crs,e),s.transformation&&(s.transformation.method&&s.transformation.method.name==="NTv2"?e.nadgrids=s.transformation.parameters[0].value:e.datum_params=s.transformation.parameters.map(i=>i.value)),e):(Object.keys(s).forEach(i=>{const n=s[i];if(n!==null)switch(i){case"name":if(e.srsCode)break;e.name=n,e.srsCode=n;break;case"type":n==="GeographicCRS"?e.projName="longlat":n==="ProjectedCRS"&&s.conversion&&s.conversion.method&&(e.projName=s.conversion.method.name);break;case"datum":case"datum_ensemble":n.ellipsoid&&(e.ellps=n.ellipsoid.name,calculateEllipsoid(n,e)),n.prime_meridian&&(e.from_greenwich=n.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":e.ellps=n.name,calculateEllipsoid(n,e);break;case"prime_meridian":e.long0=(n.longitude||0)*Math.PI/180;break;case"coordinate_system":if(n.axis){if(e.axis=n.axis.map(o=>{const l=o.direction;if(l==="east")return"e";if(l==="north")return"n";if(l==="west")return"w";if(l==="south")return"s";throw new Error(`Unknown axis direction: ${l}`)}).join("")+"u",n.unit){const{units:o,to_meter:l}=processUnit(n.unit);e.units=o,e.to_meter=l}else if(n.axis[0]&&n.axis[0].unit){const{units:o,to_meter:l}=processUnit(n.axis[0].unit);e.units=o,e.to_meter=l}}break;case"id":n.authority&&n.code&&(e.title=n.authority+":"+n.code);break;case"conversion":n.method&&n.method.name&&(e.projName=n.method.name),n.parameters&&n.parameters.forEach(o=>{const l=o.name.toLowerCase().replace(/\s+/g,"_"),c=o.value;o.unit&&o.unit.conversion_factor?e[l]=c*o.unit.conversion_factor:o.unit==="degree"?e[l]=c*Math.PI/180:e[l]=c});break;case"unit":n.name&&(e.units=n.name.toLowerCase(),e.units==="metre"&&(e.units="meter")),n.conversion_factor&&(e.to_meter=n.conversion_factor);break;case"base_crs":transformPROJJSON(n,e),e.datumCode=n.id?n.id.authority+"_"+n.id.code:n.name;break}}),e.latitude_of_false_origin!==void 0&&(e.lat0=e.latitude_of_false_origin),e.longitude_of_false_origin!==void 0&&(e.long0=e.longitude_of_false_origin),e.latitude_of_standard_parallel!==void 0&&(e.lat0=e.latitude_of_standard_parallel,e.lat1=e.latitude_of_standard_parallel),e.latitude_of_1st_standard_parallel!==void 0&&(e.lat1=e.latitude_of_1st_standard_parallel),e.latitude_of_2nd_standard_parallel!==void 0&&(e.lat2=e.latitude_of_2nd_standard_parallel),e.latitude_of_projection_centre!==void 0&&(e.lat0=e.latitude_of_projection_centre),e.longitude_of_projection_centre!==void 0&&(e.longc=e.longitude_of_projection_centre),e.easting_at_false_origin!==void 0&&(e.x0=e.easting_at_false_origin),e.northing_at_false_origin!==void 0&&(e.y0=e.northing_at_false_origin),e.latitude_of_natural_origin!==void 0&&(e.lat0=e.latitude_of_natural_origin),e.longitude_of_natural_origin!==void 0&&(e.long0=e.longitude_of_natural_origin),e.longitude_of_origin!==void 0&&(e.long0=e.longitude_of_origin),e.false_easting!==void 0&&(e.x0=e.false_easting),e.easting_at_projection_centre&&(e.x0=e.easting_at_projection_centre),e.false_northing!==void 0&&(e.y0=e.false_northing),e.northing_at_projection_centre&&(e.y0=e.northing_at_projection_centre),e.standard_parallel_1!==void 0&&(e.lat1=e.standard_parallel_1),e.standard_parallel_2!==void 0&&(e.lat2=e.standard_parallel_2),e.scale_factor_at_natural_origin!==void 0&&(e.k0=e.scale_factor_at_natural_origin),e.scale_factor_at_projection_centre!==void 0&&(e.k0=e.scale_factor_at_projection_centre),e.scale_factor_on_pseudo_standard_parallel!==void 0&&(e.k0=e.scale_factor_on_pseudo_standard_parallel),e.azimuth!==void 0&&(e.alpha=e.azimuth),e.azimuth_at_projection_centre!==void 0&&(e.alpha=e.azimuth_at_projection_centre),e.angle_from_rectified_to_skew_grid&&(e.rectified_grid_angle=e.angle_from_rectified_to_skew_grid),applyProjectionDefaults(e),e)}var knownTypes=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function rename(s,e){var i=e[0],n=e[1];!(i in s)&&n in s&&(s[i]=s[n],e.length===3&&(s[i]=e[2](s[i])))}function cleanWKT(s){for(var e=Object.keys(s),i=0,n=e.length;i<n;++i){var o=e[i];knownTypes.indexOf(o)!==-1&&setPropertiesFromWkt(s[o]),typeof s[o]=="object"&&cleanWKT(s[o])}}function setPropertiesFromWkt(s){if(s.AUTHORITY){var e=Object.keys(s.AUTHORITY)[0];e&&e in s.AUTHORITY&&(s.title=e+":"+s.AUTHORITY[e])}if(s.type==="GEOGCS"?s.projName="longlat":s.type==="LOCAL_CS"?(s.projName="identity",s.local=!0):typeof s.PROJECTION=="object"?s.projName=Object.keys(s.PROJECTION)[0]:s.projName=s.PROJECTION,s.AXIS){for(var i="",n=0,o=s.AXIS.length;n<o;++n){var l=[s.AXIS[n][0].toLowerCase(),s.AXIS[n][1].toLowerCase()];l[0].indexOf("north")!==-1||(l[0]==="y"||l[0]==="lat")&&l[1]==="north"?i+="n":l[0].indexOf("south")!==-1||(l[0]==="y"||l[0]==="lat")&&l[1]==="south"?i+="s":l[0].indexOf("east")!==-1||(l[0]==="x"||l[0]==="lon")&&l[1]==="east"?i+="e":(l[0].indexOf("west")!==-1||(l[0]==="x"||l[0]==="lon")&&l[1]==="west")&&(i+="w")}i.length===2&&(i+="u"),i.length===3&&(s.axis=i)}s.UNIT&&(s.units=s.UNIT.name.toLowerCase(),s.units==="metre"&&(s.units="meter"),s.UNIT.convert&&(s.type==="GEOGCS"?s.DATUM&&s.DATUM.SPHEROID&&(s.to_meter=s.UNIT.convert*s.DATUM.SPHEROID.a):s.to_meter=s.UNIT.convert));var c=s.GEOGCS;s.type==="GEOGCS"&&(c=s),c&&(c.DATUM?s.datumCode=c.DATUM.name.toLowerCase():s.datumCode=c.name.toLowerCase(),s.datumCode.slice(0,2)==="d_"&&(s.datumCode=s.datumCode.slice(2)),s.datumCode==="new_zealand_1949"&&(s.datumCode="nzgd49"),(s.datumCode==="wgs_1984"||s.datumCode==="world_geodetic_system_1984")&&(s.PROJECTION==="Mercator_Auxiliary_Sphere"&&(s.sphere=!0),s.datumCode="wgs84"),s.datumCode==="belge_1972"&&(s.datumCode="rnb72"),c.DATUM&&c.DATUM.SPHEROID&&(s.ellps=c.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),s.ellps.toLowerCase().slice(0,13)==="international"&&(s.ellps="intl"),s.a=c.DATUM.SPHEROID.a,s.rf=parseFloat(c.DATUM.SPHEROID.rf,10)),c.DATUM&&c.DATUM.TOWGS84&&(s.datum_params=c.DATUM.TOWGS84),~s.datumCode.indexOf("osgb_1936")&&(s.datumCode="osgb36"),~s.datumCode.indexOf("osni_1952")&&(s.datumCode="osni52"),(~s.datumCode.indexOf("tm65")||~s.datumCode.indexOf("geodetic_datum_of_1965"))&&(s.datumCode="ire65"),s.datumCode==="ch1903+"&&(s.datumCode="ch1903"),~s.datumCode.indexOf("israel")&&(s.datumCode="isr93")),s.b&&!isFinite(s.b)&&(s.b=s.a),s.rectified_grid_angle&&(s.rectified_grid_angle=d2r(s.rectified_grid_angle));function u(g){var H=s.to_meter||1;return g*H}var h=function(g){return rename(s,g)},f=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",d2r],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",d2r],["x0","false_easting",u],["y0","false_northing",u],["long0","central_meridian",d2r],["lat0","latitude_of_origin",d2r],["lat0","standard_parallel_1",d2r],["lat1","standard_parallel_1",d2r],["lat2","standard_parallel_2",d2r],["azimuth","Azimuth"],["alpha","azimuth",d2r],["srsCode","name"]];f.forEach(h),applyProjectionDefaults(s)}function wkt(s){if(typeof s=="object")return transformPROJJSON(s);const e=detectWKTVersion(s);var i=parseString(s);if(e==="WKT2"){const l=buildPROJJSON(i);return transformPROJJSON(l)}var n=i[0],o={};return sExpr(i,o),cleanWKT(o),o[n]}function defs(s){var e=this;if(arguments.length===2){var i=arguments[1];typeof i=="string"?i.charAt(0)==="+"?defs[s]=projStr(arguments[1]):defs[s]=wkt(arguments[1]):defs[s]=i}else if(arguments.length===1){if(Array.isArray(s))return s.map(function(n){Array.isArray(n)?defs.apply(e,n):defs(n)});if(typeof s=="string"){if(s in defs)return defs[s]}else"EPSG"in s?defs["EPSG:"+s.EPSG]=s:"ESRI"in s?defs["ESRI:"+s.ESRI]=s:"IAU2000"in s?defs["IAU2000:"+s.IAU2000]=s:console.log(s);return}}globals(defs);function testObj(s){return typeof s=="string"}function testDef(s){return s in defs}var codeWords=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function testWKT(s){return codeWords.some(function(e){return s.indexOf(e)>-1})}var codes=["3857","900913","3785","102113"];function checkMercator(s){var e=match(s,"authority");if(e){var i=match(e,"epsg");return i&&codes.indexOf(i)>-1}}function checkProjStr(s){var e=match(s,"extension");if(e)return match(e,"proj4")}function testProj(s){return s[0]==="+"}function parse(s){if(testObj(s)){if(testDef(s))return defs[s];if(testWKT(s)){var e=wkt(s);if(checkMercator(e))return defs["EPSG:3857"];var i=checkProjStr(e);return i?projStr(i):e}if(testProj(s))return projStr(s)}else return s}function extend(s,e){s=s||{};var i,n;if(!e)return s;for(n in e)i=e[n],i!==void 0&&(s[n]=i);return s}function msfnz(s,e,i){var n=s*e;return i/Math.sqrt(1-n*n)}function sign(s){return s<0?-1:1}function adjust_lon(s){return Math.abs(s)<=SPI?s:s-sign(s)*TWO_PI}function tsfnz(s,e,i){var n=s*i,o=.5*s;return n=Math.pow((1-n)/(1+n),o),Math.tan(.5*(HALF_PI-e))/n}function phi2z(s,e){for(var i=.5*s,n,o,l=HALF_PI-2*Math.atan(e),c=0;c<=15;c++)if(n=s*Math.sin(l),o=HALF_PI-2*Math.atan(e*Math.pow((1-n)/(1+n),i))-l,l+=o,Math.abs(o)<=1e-10)return l;return-9999}function init$x(){var s=this.b/this.a;this.es=1-s*s,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=msfnz(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function forward$v(s){var e=s.x,i=s.y;if(i*R2D>90&&i*R2D<-90&&e*R2D>180&&e*R2D<-180)return null;var n,o;if(Math.abs(Math.abs(i)-HALF_PI)<=EPSLN)return null;if(this.sphere)n=this.x0+this.a*this.k0*adjust_lon(e-this.long0),o=this.y0+this.a*this.k0*Math.log(Math.tan(FORTPI+.5*i));else{var l=Math.sin(i),c=tsfnz(this.e,i,l);n=this.x0+this.a*this.k0*adjust_lon(e-this.long0),o=this.y0-this.a*this.k0*Math.log(c)}return s.x=n,s.y=o,s}function inverse$v(s){var e=s.x-this.x0,i=s.y-this.y0,n,o;if(this.sphere)o=HALF_PI-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var l=Math.exp(-i/(this.a*this.k0));if(o=phi2z(this.e,l),o===-9999)return null}return n=adjust_lon(this.long0+e/(this.a*this.k0)),s.x=n,s.y=o,s}var names$y=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const merc={init:init$x,forward:forward$v,inverse:inverse$v,names:names$y};function init$w(){}function identity(s){return s}var names$x=["longlat","identity"];const longlat={init:init$w,forward:identity,inverse:identity,names:names$x};var projs=[merc,longlat],names$w={},projStore=[];function add(s,e){var i=projStore.length;return s.names?(projStore[i]=s,s.names.forEach(function(n){names$w[n.toLowerCase()]=i}),this):(console.log(e),!0)}function get(s){if(!s)return!1;var e=s.toLowerCase();if(typeof names$w[e]<"u"&&projStore[names$w[e]])return projStore[names$w[e]]}function start(){projs.forEach(add)}const projections={start,add,get};var exports$1={};exports$1.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};exports$1.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};exports$1.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};exports$1.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};exports$1.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};exports$1.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};exports$1.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};exports$1.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};exports$1.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};exports$1.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};exports$1.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};exports$1.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};exports$1.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};exports$1.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};exports$1.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};exports$1.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};exports$1.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};exports$1.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};exports$1.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};exports$1.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};exports$1.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};exports$1.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};exports$1.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};exports$1.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};exports$1.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};exports$1.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};exports$1.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};exports$1.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};exports$1.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};exports$1.hough={a:6378270,rf:297,ellipseName:"Hough"};exports$1.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};exports$1.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};exports$1.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};exports$1.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};exports$1.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};exports$1.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};exports$1.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};exports$1.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};exports$1.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};exports$1.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};exports$1.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};exports$1.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var WGS84=exports$1.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};exports$1.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function eccentricity(s,e,i,n){var o=s*s,l=e*e,c=(o-l)/o,u=0;n?(s*=1-c*(SIXTH+c*(RA4+c*RA6)),o=s*s,c=0):u=Math.sqrt(c);var h=(o-l)/l;return{es:c,e:u,ep2:h}}function sphere(s,e,i,n,o){if(!s){var l=match(exports$1,n);l||(l=WGS84),s=l.a,e=l.b,i=l.rf}return i&&!e&&(e=(1-1/i)*s),(i===0||Math.abs(s-e)<EPSLN)&&(o=!0,e=s),{a:s,b:e,rf:i,sphere:o}}var datums={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}};for(var key in datums){var datum$1=datums[key];datums[datum$1.datumName]=datum$1}function datum(s,e,i,n,o,l,c){var u={};return s===void 0||s==="none"?u.datum_type=PJD_NODATUM:u.datum_type=PJD_WGS84,e&&(u.datum_params=e.map(parseFloat),(u.datum_params[0]!==0||u.datum_params[1]!==0||u.datum_params[2]!==0)&&(u.datum_type=PJD_3PARAM),u.datum_params.length>3&&(u.datum_params[3]!==0||u.datum_params[4]!==0||u.datum_params[5]!==0||u.datum_params[6]!==0)&&(u.datum_type=PJD_7PARAM,u.datum_params[3]*=SEC_TO_RAD,u.datum_params[4]*=SEC_TO_RAD,u.datum_params[5]*=SEC_TO_RAD,u.datum_params[6]=u.datum_params[6]/1e6+1)),c&&(u.datum_type=PJD_GRIDSHIFT,u.grids=c),u.a=i,u.b=n,u.es=o,u.ep2=l,u}var loadedNadgrids={};function nadgrid(s,e){var i=new DataView(e),n=detectLittleEndian(i),o=readHeader(i,n),l=readSubgrids(i,o,n),c={header:o,subgrids:l};return loadedNadgrids[s]=c,c}function getNadgrids(s){if(s===void 0)return null;var e=s.split(",");return e.map(parseNadgridString)}function parseNadgridString(s){if(s.length===0)return null;var e=s[0]==="@";return e&&(s=s.slice(1)),s==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:s,mandatory:!e,grid:loadedNadgrids[s]||null,isNull:!1}}function secondsToRadians(s){return s/3600*Math.PI/180}function detectLittleEndian(s){var e=s.getInt32(8,!1);return e===11?!1:(e=s.getInt32(8,!0),e!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function readHeader(s,e){return{nFields:s.getInt32(8,e),nSubgridFields:s.getInt32(24,e),nSubgrids:s.getInt32(40,e),shiftType:decodeString(s,56,64).trim(),fromSemiMajorAxis:s.getFloat64(120,e),fromSemiMinorAxis:s.getFloat64(136,e),toSemiMajorAxis:s.getFloat64(152,e),toSemiMinorAxis:s.getFloat64(168,e)}}function decodeString(s,e,i){return String.fromCharCode.apply(null,new Uint8Array(s.buffer.slice(e,i)))}function readSubgrids(s,e,i){for(var n=176,o=[],l=0;l<e.nSubgrids;l++){var c=readGridHeader(s,n,i),u=readGridNodes(s,n,c,i),h=Math.round(1+(c.upperLongitude-c.lowerLongitude)/c.longitudeInterval),f=Math.round(1+(c.upperLatitude-c.lowerLatitude)/c.latitudeInterval);o.push({ll:[secondsToRadians(c.lowerLongitude),secondsToRadians(c.lowerLatitude)],del:[secondsToRadians(c.longitudeInterval),secondsToRadians(c.latitudeInterval)],lim:[h,f],count:c.gridNodeCount,cvs:mapNodes(u)}),n+=176+c.gridNodeCount*16}return o}function mapNodes(s){return s.map(function(e){return[secondsToRadians(e.longitudeShift),secondsToRadians(e.latitudeShift)]})}function readGridHeader(s,e,i){return{name:decodeString(s,e+8,e+16).trim(),parent:decodeString(s,e+24,e+24+8).trim(),lowerLatitude:s.getFloat64(e+72,i),upperLatitude:s.getFloat64(e+88,i),lowerLongitude:s.getFloat64(e+104,i),upperLongitude:s.getFloat64(e+120,i),latitudeInterval:s.getFloat64(e+136,i),longitudeInterval:s.getFloat64(e+152,i),gridNodeCount:s.getInt32(e+168,i)}}function readGridNodes(s,e,i,n){for(var o=e+176,l=16,c=[],u=0;u<i.gridNodeCount;u++){var h={latitudeShift:s.getFloat32(o+u*l,n),longitudeShift:s.getFloat32(o+u*l+4,n),latitudeAccuracy:s.getFloat32(o+u*l+8,n),longitudeAccuracy:s.getFloat32(o+u*l+12,n)};c.push(h)}return c}function Projection(s,e){if(!(this instanceof Projection))return new Projection(s);e=e||function(f){if(f)throw f};var i=parse(s);if(typeof i!="object"){e("Could not parse to valid json: "+s);return}var n=Projection.projections.get(i.projName);if(!n){e("Could not get projection name from: "+s);return}if(i.datumCode&&i.datumCode!=="none"){var o=match(datums,i.datumCode);o&&(i.datum_params=i.datum_params||(o.towgs84?o.towgs84.split(","):null),i.ellps=o.ellipse,i.datumName=o.datumName?o.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu",i.ellps=i.ellps||"wgs84",i.lat1=i.lat1||i.lat0;var l=sphere(i.a,i.b,i.rf,i.ellps,i.sphere),c=eccentricity(l.a,l.b,l.rf,i.R_A),u=getNadgrids(i.nadgrids),h=i.datum||datum(i.datumCode,i.datum_params,l.a,l.b,c.es,c.ep2,u);extend(this,i),extend(this,n),this.a=l.a,this.b=l.b,this.rf=l.rf,this.sphere=l.sphere,this.es=c.es,this.e=c.e,this.ep2=c.ep2,this.datum=h,this.init(),e(null,this)}Projection.projections=projections;Projection.projections.start();function compareDatums(s,e){return s.datum_type!==e.datum_type||s.a!==e.a||Math.abs(s.es-e.es)>5e-11?!1:s.datum_type===PJD_3PARAM?s.datum_params[0]===e.datum_params[0]&&s.datum_params[1]===e.datum_params[1]&&s.datum_params[2]===e.datum_params[2]:s.datum_type===PJD_7PARAM?s.datum_params[0]===e.datum_params[0]&&s.datum_params[1]===e.datum_params[1]&&s.datum_params[2]===e.datum_params[2]&&s.datum_params[3]===e.datum_params[3]&&s.datum_params[4]===e.datum_params[4]&&s.datum_params[5]===e.datum_params[5]&&s.datum_params[6]===e.datum_params[6]:!0}function geodeticToGeocentric(s,e,i){var n=s.x,o=s.y,l=s.z?s.z:0,c,u,h,f;if(o<-HALF_PI&&o>-1.001*HALF_PI)o=-HALF_PI;else if(o>HALF_PI&&o<1.001*HALF_PI)o=HALF_PI;else{if(o<-HALF_PI)return{x:-1/0,y:-1/0,z:s.z};if(o>HALF_PI)return{x:1/0,y:1/0,z:s.z}}return n>Math.PI&&(n-=2*Math.PI),u=Math.sin(o),f=Math.cos(o),h=u*u,c=i/Math.sqrt(1-e*h),{x:(c+l)*f*Math.cos(n),y:(c+l)*f*Math.sin(n),z:(c*(1-e)+l)*u}}function geocentricToGeodetic(s,e,i,n){var o=1e-12,l=o*o,c=30,u,h,f,g,H,Y,ee,te,xe,ne,et,tt,it,rt=s.x,nt=s.y,st=s.z?s.z:0,at,ot,ct;if(u=Math.sqrt(rt*rt+nt*nt),h=Math.sqrt(rt*rt+nt*nt+st*st),u/i<o){if(at=0,h/i<o)return ot=HALF_PI,ct=-n,{x:s.x,y:s.y,z:s.z}}else at=Math.atan2(nt,rt);f=st/h,g=u/h,H=1/Math.sqrt(1-e*(2-e)*g*g),te=g*(1-e)*H,xe=f*H,it=0;do it++,ee=i/Math.sqrt(1-e*xe*xe),ct=u*te+st*xe-ee*(1-e*xe*xe),Y=e*ee/(ee+ct),H=1/Math.sqrt(1-Y*(2-Y)*g*g),ne=g*(1-Y)*H,et=f*H,tt=et*te-ne*xe,te=ne,xe=et;while(tt*tt>l&&it<c);return ot=Math.atan(et/Math.abs(ne)),{x:at,y:ot,z:ct}}function geocentricToWgs84(s,e,i){if(e===PJD_3PARAM)return{x:s.x+i[0],y:s.y+i[1],z:s.z+i[2]};if(e===PJD_7PARAM){var n=i[0],o=i[1],l=i[2],c=i[3],u=i[4],h=i[5],f=i[6];return{x:f*(s.x-h*s.y+u*s.z)+n,y:f*(h*s.x+s.y-c*s.z)+o,z:f*(-u*s.x+c*s.y+s.z)+l}}}function geocentricFromWgs84(s,e,i){if(e===PJD_3PARAM)return{x:s.x-i[0],y:s.y-i[1],z:s.z-i[2]};if(e===PJD_7PARAM){var n=i[0],o=i[1],l=i[2],c=i[3],u=i[4],h=i[5],f=i[6],g=(s.x-n)/f,H=(s.y-o)/f,Y=(s.z-l)/f;return{x:g+h*H-u*Y,y:-h*g+H+c*Y,z:u*g-c*H+Y}}}function checkParams(s){return s===PJD_3PARAM||s===PJD_7PARAM}function datum_transform(s,e,i){if(compareDatums(s,e)||s.datum_type===PJD_NODATUM||e.datum_type===PJD_NODATUM)return i;var n=s.a,o=s.es;if(s.datum_type===PJD_GRIDSHIFT){var l=applyGridShift(s,!1,i);if(l!==0)return;n=SRS_WGS84_SEMIMAJOR,o=SRS_WGS84_ESQUARED}var c=e.a,u=e.b,h=e.es;if(e.datum_type===PJD_GRIDSHIFT&&(c=SRS_WGS84_SEMIMAJOR,u=SRS_WGS84_SEMIMINOR,h=SRS_WGS84_ESQUARED),o===h&&n===c&&!checkParams(s.datum_type)&&!checkParams(e.datum_type))return i;if(i=geodeticToGeocentric(i,o,n),checkParams(s.datum_type)&&(i=geocentricToWgs84(i,s.datum_type,s.datum_params)),checkParams(e.datum_type)&&(i=geocentricFromWgs84(i,e.datum_type,e.datum_params)),i=geocentricToGeodetic(i,h,c,u),e.datum_type===PJD_GRIDSHIFT){var f=applyGridShift(e,!0,i);if(f!==0)return}return i}function applyGridShift(s,e,i){if(s.grids===null||s.grids.length===0)return console.log("Grid shift grids not found"),-1;var n={x:-i.x,y:i.y},o={x:Number.NaN,y:Number.NaN},l=[];e:for(var c=0;c<s.grids.length;c++){var u=s.grids[c];if(l.push(u.name),u.isNull){o=n;break}if(u.mandatory,u.grid===null){if(u.mandatory)return console.log("Unable to find mandatory grid '"+u.name+"'"),-1;continue}for(var h=u.grid.subgrids,f=0,g=h.length;f<g;f++){var H=h[f],Y=(Math.abs(H.del[1])+Math.abs(H.del[0]))/1e4,ee=H.ll[0]-Y,te=H.ll[1]-Y,xe=H.ll[0]+(H.lim[0]-1)*H.del[0]+Y,ne=H.ll[1]+(H.lim[1]-1)*H.del[1]+Y;if(!(te>n.y||ee>n.x||ne<n.y||xe<n.x)&&(o=applySubgridShift(n,e,H),!isNaN(o.x)))break e}}return isNaN(o.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*R2D+" "+n.y*R2D+" tried: '"+l+"'"),-1):(i.x=-o.x,i.y=o.y,0)}function applySubgridShift(s,e,i){var n={x:Number.NaN,y:Number.NaN};if(isNaN(s.x))return n;var o={x:s.x,y:s.y};o.x-=i.ll[0],o.y-=i.ll[1],o.x=adjust_lon(o.x-Math.PI)+Math.PI;var l=nadInterpolate(o,i);if(e){if(isNaN(l.x))return n;l.x=o.x-l.x,l.y=o.y-l.y;var c=9,u=1e-12,h,f;do{if(f=nadInterpolate(l,i),isNaN(f.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}h={x:o.x-(f.x+l.x),y:o.y-(f.y+l.y)},l.x+=h.x,l.y+=h.y}while(c--&&Math.abs(h.x)>u&&Math.abs(h.y)>u);if(c<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=adjust_lon(l.x+i.ll[0]),n.y=l.y+i.ll[1]}else isNaN(l.x)||(n.x=s.x+l.x,n.y=s.y+l.y);return n}function nadInterpolate(s,e){var i={x:s.x/e.del[0],y:s.y/e.del[1]},n={x:Math.floor(i.x),y:Math.floor(i.y)},o={x:i.x-1*n.x,y:i.y-1*n.y},l={x:Number.NaN,y:Number.NaN},c;if(n.x<0||n.x>=e.lim[0]||n.y<0||n.y>=e.lim[1])return l;c=n.y*e.lim[0]+n.x;var u={x:e.cvs[c][0],y:e.cvs[c][1]};c++;var h={x:e.cvs[c][0],y:e.cvs[c][1]};c+=e.lim[0];var f={x:e.cvs[c][0],y:e.cvs[c][1]};c--;var g={x:e.cvs[c][0],y:e.cvs[c][1]},H=o.x*o.y,Y=o.x*(1-o.y),ee=(1-o.x)*(1-o.y),te=(1-o.x)*o.y;return l.x=ee*u.x+Y*h.x+te*g.x+H*f.x,l.y=ee*u.y+Y*h.y+te*g.y+H*f.y,l}function adjust_axis(s,e,i){var n=i.x,o=i.y,l=i.z||0,c,u,h,f={};for(h=0;h<3;h++)if(!(e&&h===2&&i.z===void 0))switch(h===0?(c=n,"ew".indexOf(s.axis[h])!==-1?u="x":u="y"):h===1?(c=o,"ns".indexOf(s.axis[h])!==-1?u="y":u="x"):(c=l,u="z"),s.axis[h]){case"e":f[u]=c;break;case"w":f[u]=-c;break;case"n":f[u]=c;break;case"s":f[u]=-c;break;case"u":i[u]!==void 0&&(f.z=c);break;case"d":i[u]!==void 0&&(f.z=-c);break;default:return null}return f}function common(s){var e={x:s[0],y:s[1]};return s.length>2&&(e.z=s[2]),s.length>3&&(e.m=s[3]),e}function checkSanity(s){checkCoord(s.x),checkCoord(s.y)}function checkCoord(s){if(typeof Number.isFinite=="function"){if(Number.isFinite(s))return;throw new TypeError("coordinates must be finite numbers")}if(typeof s!="number"||s!==s||!isFinite(s))throw new TypeError("coordinates must be finite numbers")}function checkNotWGS(s,e){return(s.datum.datum_type===PJD_3PARAM||s.datum.datum_type===PJD_7PARAM||s.datum.datum_type===PJD_GRIDSHIFT)&&e.datumCode!=="WGS84"||(e.datum.datum_type===PJD_3PARAM||e.datum.datum_type===PJD_7PARAM||e.datum.datum_type===PJD_GRIDSHIFT)&&s.datumCode!=="WGS84"}function transform(s,e,i,n){var o;Array.isArray(i)?i=common(i):i={x:i.x,y:i.y,z:i.z,m:i.m};var l=i.z!==void 0;if(checkSanity(i),s.datum&&e.datum&&checkNotWGS(s,e)&&(o=new Projection("WGS84"),i=transform(s,o,i,n),s=o),n&&s.axis!=="enu"&&(i=adjust_axis(s,!1,i)),s.projName==="longlat")i={x:i.x*D2R$1,y:i.y*D2R$1,z:i.z||0};else if(s.to_meter&&(i={x:i.x*s.to_meter,y:i.y*s.to_meter,z:i.z||0}),i=s.inverse(i),!i)return;if(s.from_greenwich&&(i.x+=s.from_greenwich),i=datum_transform(s.datum,e.datum,i),!!i)return e.from_greenwich&&(i={x:i.x-e.from_greenwich,y:i.y,z:i.z||0}),e.projName==="longlat"?i={x:i.x*R2D,y:i.y*R2D,z:i.z||0}:(i=e.forward(i),e.to_meter&&(i={x:i.x/e.to_meter,y:i.y/e.to_meter,z:i.z||0})),n&&e.axis!=="enu"?adjust_axis(e,!0,i):(i&&!l&&delete i.z,i)}var wgs84=Projection("WGS84");function transformer(s,e,i,n){var o,l,c;return Array.isArray(i)?(o=transform(s,e,i,n)||{x:NaN,y:NaN},i.length>2?typeof s.name<"u"&&s.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof o.z=="number"?[o.x,o.y,o.z].concat(i.slice(3)):[o.x,o.y,i[2]].concat(i.slice(3)):[o.x,o.y].concat(i.slice(2)):[o.x,o.y]):(l=transform(s,e,i,n),c=Object.keys(i),c.length===2||c.forEach(function(u){if(typeof s.name<"u"&&s.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(u==="x"||u==="y"||u==="z")return}else if(u==="x"||u==="y")return;l[u]=i[u]}),l)}function checkProj(s){return s instanceof Projection?s:s.oProj?s.oProj:Projection(s)}function proj4(s,e,i){s=checkProj(s);var n=!1,o;return typeof e>"u"?(e=s,s=wgs84,n=!0):(typeof e.x<"u"||Array.isArray(e))&&(i=e,e=s,s=wgs84,n=!0),e=checkProj(e),i?transformer(s,e,i):(o={forward:function(l,c){return transformer(s,e,l,c)},inverse:function(l,c){return transformer(e,s,l,c)}},n&&(o.oProj=e),o)}var NUM_100K_SETS=6,SET_ORIGIN_COLUMN_LETTERS="AJSAJS",SET_ORIGIN_ROW_LETTERS="AFAFAF",A=65,I$2=73,O=79,V$1=86,Z=90;const mgrs={forward:forward$u,inverse:inverse$u,toPoint};function forward$u(s,e){return e=e||5,encode(LLtoUTM({lat:s[1],lon:s[0]}),e)}function inverse$u(s){var e=UTMtoLL(decode(s.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function toPoint(s){var e=UTMtoLL(decode(s.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function degToRad(s){return s*(Math.PI/180)}function radToDeg(s){return 180*(s/Math.PI)}function LLtoUTM(s){var e=s.lat,i=s.lon,n=6378137,o=.00669438,l=.9996,c,u,h,f,g,H,Y,ee=degToRad(e),te=degToRad(i),xe,ne;ne=Math.floor((i+180)/6)+1,i===180&&(ne=60),e>=56&&e<64&&i>=3&&i<12&&(ne=32),e>=72&&e<84&&(i>=0&&i<9?ne=31:i>=9&&i<21?ne=33:i>=21&&i<33?ne=35:i>=33&&i<42&&(ne=37)),c=(ne-1)*6-180+3,xe=degToRad(c),u=o/(1-o),h=n/Math.sqrt(1-o*Math.sin(ee)*Math.sin(ee)),f=Math.tan(ee)*Math.tan(ee),g=u*Math.cos(ee)*Math.cos(ee),H=Math.cos(ee)*(te-xe),Y=n*((1-o/4-3*o*o/64-5*o*o*o/256)*ee-(3*o/8+3*o*o/32+45*o*o*o/1024)*Math.sin(2*ee)+(15*o*o/256+45*o*o*o/1024)*Math.sin(4*ee)-35*o*o*o/3072*Math.sin(6*ee));var et=l*h*(H+(1-f+g)*H*H*H/6+(5-18*f+f*f+72*g-58*u)*H*H*H*H*H/120)+5e5,tt=l*(Y+h*Math.tan(ee)*(H*H/2+(5-f+9*g+4*g*g)*H*H*H*H/24+(61-58*f+f*f+600*g-330*u)*H*H*H*H*H*H/720));return e<0&&(tt+=1e7),{northing:Math.round(tt),easting:Math.round(et),zoneNumber:ne,zoneLetter:getLetterDesignator(e)}}function UTMtoLL(s){var e=s.northing,i=s.easting,n=s.zoneLetter,o=s.zoneNumber;if(o<0||o>60)return null;var l=.9996,c=6378137,u=.00669438,h,f=(1-Math.sqrt(1-u))/(1+Math.sqrt(1-u)),g,H,Y,ee,te,xe,ne,et,tt,it=i-5e5,rt=e;n<"N"&&(rt-=1e7),ne=(o-1)*6-180+3,h=u/(1-u),xe=rt/l,et=xe/(c*(1-u/4-3*u*u/64-5*u*u*u/256)),tt=et+(3*f/2-27*f*f*f/32)*Math.sin(2*et)+(21*f*f/16-55*f*f*f*f/32)*Math.sin(4*et)+151*f*f*f/96*Math.sin(6*et),g=c/Math.sqrt(1-u*Math.sin(tt)*Math.sin(tt)),H=Math.tan(tt)*Math.tan(tt),Y=h*Math.cos(tt)*Math.cos(tt),ee=c*(1-u)/Math.pow(1-u*Math.sin(tt)*Math.sin(tt),1.5),te=it/(g*l);var nt=tt-g*Math.tan(tt)/ee*(te*te/2-(5+3*H+10*Y-4*Y*Y-9*h)*te*te*te*te/24+(61+90*H+298*Y+45*H*H-252*h-3*Y*Y)*te*te*te*te*te*te/720);nt=radToDeg(nt);var st=(te-(1+2*H+Y)*te*te*te/6+(5-2*Y+28*H-3*Y*Y+8*h+24*H*H)*te*te*te*te*te/120)/Math.cos(tt);st=ne+radToDeg(st);var at;if(s.accuracy){var ot=UTMtoLL({northing:s.northing+s.accuracy,easting:s.easting+s.accuracy,zoneLetter:s.zoneLetter,zoneNumber:s.zoneNumber});at={top:ot.lat,right:ot.lon,bottom:nt,left:st}}else at={lat:nt,lon:st};return at}function getLetterDesignator(s){var e="Z";return 84>=s&&s>=72?e="X":72>s&&s>=64?e="W":64>s&&s>=56?e="V":56>s&&s>=48?e="U":48>s&&s>=40?e="T":40>s&&s>=32?e="S":32>s&&s>=24?e="R":24>s&&s>=16?e="Q":16>s&&s>=8?e="P":8>s&&s>=0?e="N":0>s&&s>=-8?e="M":-8>s&&s>=-16?e="L":-16>s&&s>=-24?e="K":-24>s&&s>=-32?e="J":-32>s&&s>=-40?e="H":-40>s&&s>=-48?e="G":-48>s&&s>=-56?e="F":-56>s&&s>=-64?e="E":-64>s&&s>=-72?e="D":-72>s&&s>=-80&&(e="C"),e}function encode(s,e){var i="00000"+s.easting,n="00000"+s.northing;return s.zoneNumber+s.zoneLetter+get100kID(s.easting,s.northing,s.zoneNumber)+i.substr(i.length-5,e)+n.substr(n.length-5,e)}function get100kID(s,e,i){var n=get100kSetForZone(i),o=Math.floor(s/1e5),l=Math.floor(e/1e5)%20;return getLetter100kID(o,l,n)}function get100kSetForZone(s){var e=s%NUM_100K_SETS;return e===0&&(e=NUM_100K_SETS),e}function getLetter100kID(s,e,i){var n=i-1,o=SET_ORIGIN_COLUMN_LETTERS.charCodeAt(n),l=SET_ORIGIN_ROW_LETTERS.charCodeAt(n),c=o+s-1,u=l+e,h=!1;c>Z&&(c=c-Z+A-1,h=!0),(c===I$2||o<I$2&&c>I$2||(c>I$2||o<I$2)&&h)&&c++,(c===O||o<O&&c>O||(c>O||o<O)&&h)&&(c++,c===I$2&&c++),c>Z&&(c=c-Z+A-1),u>V$1?(u=u-V$1+A-1,h=!0):h=!1,(u===I$2||l<I$2&&u>I$2||(u>I$2||l<I$2)&&h)&&u++,(u===O||l<O&&u>O||(u>O||l<O)&&h)&&(u++,u===I$2&&u++),u>V$1&&(u=u-V$1+A-1);var f=String.fromCharCode(c)+String.fromCharCode(u);return f}function decode(s){if(s&&s.length===0)throw"MGRSPoint coverting from nothing";for(var e=s.length,i=null,n="",o,l=0;!/[A-Z]/.test(o=s.charAt(l));){if(l>=2)throw"MGRSPoint bad conversion from: "+s;n+=o,l++}var c=parseInt(n,10);if(l===0||l+3>e)throw"MGRSPoint bad conversion from: "+s;var u=s.charAt(l++);if(u<="A"||u==="B"||u==="Y"||u>="Z"||u==="I"||u==="O")throw"MGRSPoint zone letter "+u+" not handled: "+s;i=s.substring(l,l+=2);for(var h=get100kSetForZone(c),f=getEastingFromChar(i.charAt(0),h),g=getNorthingFromChar(i.charAt(1),h);g<getMinNorthing(u);)g+=2e6;var H=e-l;if(H%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+s;var Y=H/2,ee=0,te=0,xe,ne,et,tt,it;return Y>0&&(xe=1e5/Math.pow(10,Y),ne=s.substring(l,l+Y),ee=parseFloat(ne)*xe,et=s.substring(l+Y),te=parseFloat(et)*xe),tt=ee+f,it=te+g,{easting:tt,northing:it,zoneLetter:u,zoneNumber:c,accuracy:xe}}function getEastingFromChar(s,e){for(var i=SET_ORIGIN_COLUMN_LETTERS.charCodeAt(e-1),n=1e5,o=!1;i!==s.charCodeAt(0);){if(i++,i===I$2&&i++,i===O&&i++,i>Z){if(o)throw"Bad character: "+s;i=A,o=!0}n+=1e5}return n}function getNorthingFromChar(s,e){if(s>"V")throw"MGRSPoint given invalid Northing "+s;for(var i=SET_ORIGIN_ROW_LETTERS.charCodeAt(e-1),n=0,o=!1;i!==s.charCodeAt(0);){if(i++,i===I$2&&i++,i===O&&i++,i>V$1){if(o)throw"Bad character: "+s;i=A,o=!0}n+=1e5}return n}function getMinNorthing(s){var e;switch(s){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+s}function Point(s,e,i){if(!(this instanceof Point))return new Point(s,e,i);if(Array.isArray(s))this.x=s[0],this.y=s[1],this.z=s[2]||0;else if(typeof s=="object")this.x=s.x,this.y=s.y,this.z=s.z||0;else if(typeof s=="string"&&typeof e>"u"){var n=s.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=s,this.y=e,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Point.fromMGRS=function(s){return new Point(toPoint(s))};Point.prototype.toMGRS=function(s){return forward$u([this.x,this.y],s)};var C00=1,C02=.25,C04=.046875,C06=.01953125,C08=.01068115234375,C22=.75,C44=.46875,C46=.013020833333333334,C48=.007120768229166667,C66=.3645833333333333,C68=.005696614583333333,C88=.3076171875;function pj_enfn(s){var e=[];e[0]=C00-s*(C02+s*(C04+s*(C06+s*C08))),e[1]=s*(C22-s*(C04+s*(C06+s*C08)));var i=s*s;return e[2]=i*(C44-s*(C46+s*C48)),i*=s,e[3]=i*(C66-s*C68),e[4]=i*s*C88,e}function pj_mlfn(s,e,i,n){return i*=e,e*=e,n[0]*s-i*(n[1]+e*(n[2]+e*(n[3]+e*n[4])))}var MAX_ITER$3=20;function pj_inv_mlfn(s,e,i){for(var n=1/(1-e),o=s,l=MAX_ITER$3;l;--l){var c=Math.sin(o),u=1-e*c*c;if(u=(pj_mlfn(o,c,Math.cos(o),i)-s)*(u*Math.sqrt(u))*n,o-=u,Math.abs(u)<EPSLN)return o}return o}function init$v(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=pj_enfn(this.es),this.ml0=pj_mlfn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function forward$t(s){var e=s.x,i=s.y,n=adjust_lon(e-this.long0),o,l,c,u=Math.sin(i),h=Math.cos(i);if(this.es){var g=h*n,H=Math.pow(g,2),Y=this.ep2*Math.pow(h,2),ee=Math.pow(Y,2),te=Math.abs(h)>EPSLN?Math.tan(i):0,xe=Math.pow(te,2),ne=Math.pow(xe,2);o=1-this.es*Math.pow(u,2),g=g/Math.sqrt(o);var et=pj_mlfn(i,u,h,this.en);l=this.a*(this.k0*g*(1+H/6*(1-xe+Y+H/20*(5-18*xe+ne+14*Y-58*xe*Y+H/42*(61+179*ne-ne*xe-479*xe)))))+this.x0,c=this.a*(this.k0*(et-this.ml0+u*n*g/2*(1+H/12*(5-xe+9*Y+4*ee+H/30*(61+ne-58*xe+270*Y-330*xe*Y+H/56*(1385+543*ne-ne*xe-3111*xe))))))+this.y0}else{var f=h*Math.sin(n);if(Math.abs(Math.abs(f)-1)<EPSLN)return 93;if(l=.5*this.a*this.k0*Math.log((1+f)/(1-f))+this.x0,c=h*Math.cos(n)/Math.sqrt(1-Math.pow(f,2)),f=Math.abs(c),f>=1){if(f-1>EPSLN)return 93;c=0}else c=Math.acos(c);i<0&&(c=-c),c=this.a*this.k0*(c-this.lat0)+this.y0}return s.x=l,s.y=c,s}function inverse$t(s){var e,i,n,o,l=(s.x-this.x0)*(1/this.a),c=(s.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+c/this.k0,i=pj_inv_mlfn(e,this.es,this.en),Math.abs(i)<HALF_PI){var H=Math.sin(i),Y=Math.cos(i),ee=Math.abs(Y)>EPSLN?Math.tan(i):0,te=this.ep2*Math.pow(Y,2),xe=Math.pow(te,2),ne=Math.pow(ee,2),et=Math.pow(ne,2);e=1-this.es*Math.pow(H,2);var tt=l*Math.sqrt(e)/this.k0,it=Math.pow(tt,2);e=e*ee,n=i-e*it/(1-this.es)*.5*(1-it/12*(5+3*ne-9*te*ne+te-4*xe-it/30*(61+90*ne-252*te*ne+45*et+46*te-it/56*(1385+3633*ne+4095*et+1574*et*ne)))),o=adjust_lon(this.long0+tt*(1-it/6*(1+2*ne+te-it/20*(5+28*ne+24*et+8*te*ne+6*te-it/42*(61+662*ne+1320*et+720*et*ne))))/Y)}else n=HALF_PI*sign(c),o=0;else{var u=Math.exp(l/this.k0),h=.5*(u-1/u),f=this.lat0+c/this.k0,g=Math.cos(f);e=Math.sqrt((1-Math.pow(g,2))/(1+Math.pow(h,2))),n=Math.asin(e),c<0&&(n=-n),h===0&&g===0?o=0:o=adjust_lon(Math.atan2(h,g)+this.long0)}return s.x=o,s.y=n,s}var names$v=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const tmerc={init:init$v,forward:forward$t,inverse:inverse$t,names:names$v};function sinh(s){var e=Math.exp(s);return e=(e-1/e)/2,e}function hypot(s,e){s=Math.abs(s),e=Math.abs(e);var i=Math.max(s,e),n=Math.min(s,e)/(i||1);return i*Math.sqrt(1+Math.pow(n,2))}function log1py(s){var e=1+s,i=e-1;return i===0?s:s*Math.log(e)/i}function asinhy(s){var e=Math.abs(s);return e=log1py(e*(1+e/(hypot(1,e)+1))),s<0?-e:e}function gatg(s,e){for(var i=2*Math.cos(2*e),n=s.length-1,o=s[n],l=0,c;--n>=0;)c=-l+i*o+s[n],l=o,o=c;return e+c*Math.sin(2*e)}function clens(s,e){for(var i=2*Math.cos(e),n=s.length-1,o=s[n],l=0,c;--n>=0;)c=-l+i*o+s[n],l=o,o=c;return Math.sin(e)*c}function cosh(s){var e=Math.exp(s);return e=(e+1/e)/2,e}function clens_cmplx(s,e,i){for(var n=Math.sin(e),o=Math.cos(e),l=sinh(i),c=cosh(i),u=2*o*c,h=-2*n*l,f=s.length-1,g=s[f],H=0,Y=0,ee=0,te,xe;--f>=0;)te=Y,xe=H,Y=g,H=ee,g=-te+u*Y-h*H+s[f],ee=-xe+h*Y+u*H;return u=n*c,h=o*l,[u*g-h*ee,u*ee+h*g]}function init$u(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(tmerc.init.apply(this),this.forward=tmerc.forward,this.inverse=tmerc.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var s=this.es/(1+Math.sqrt(1-this.es)),e=s/(2-s),i=e;this.cgb[0]=e*(2+e*(-2/3+e*(-2+e*(116/45+e*(26/45+e*(-2854/675)))))),this.cbg[0]=e*(-2+e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))),i=i*e,this.cgb[1]=i*(7/3+e*(-8/5+e*(-227/45+e*(2704/315+e*(2323/945))))),this.cbg[1]=i*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),i=i*e,this.cgb[2]=i*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=i*(-26/15+e*(34/21+e*(8/5+e*(-12686/2835)))),i=i*e,this.cgb[3]=i*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=i*(1237/630+e*(-12/5+e*(-24832/14175))),i=i*e,this.cgb[4]=i*(4174/315+e*(-144838/6237)),this.cbg[4]=i*(-734/315+e*(109598/31185)),i=i*e,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+i*(1/4+i*(1/64+i/256))),this.utg[0]=e*(-.5+e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=i*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=i*(13/48+e*(-3/5+e*(557/1440+e*(281/630+e*(-1983433/1935360))))),i=i*e,this.utg[2]=i*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=i*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),i=i*e,this.utg[3]=i*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=i*(49561/161280+e*(-179/168+e*(6601661/7257600))),i=i*e,this.utg[4]=i*(-4583/161280+e*(108847/3991680)),this.gtu[4]=i*(34729/80640+e*(-3418889/1995840)),i=i*e,this.utg[5]=i*(-20648693/638668800),this.gtu[5]=i*(212378941/319334400);var n=gatg(this.cbg,this.lat0);this.Zb=-this.Qn*(n+clens(this.gtu,2*n))}function forward$s(s){var e=adjust_lon(s.x-this.long0),i=s.y;i=gatg(this.cbg,i);var n=Math.sin(i),o=Math.cos(i),l=Math.sin(e),c=Math.cos(e);i=Math.atan2(n,c*o),e=Math.atan2(l*o,hypot(n,o*c)),e=asinhy(Math.tan(e));var u=clens_cmplx(this.gtu,2*i,2*e);i=i+u[0],e=e+u[1];var h,f;return Math.abs(e)<=2.623395162778?(h=this.a*(this.Qn*e)+this.x0,f=this.a*(this.Qn*i+this.Zb)+this.y0):(h=1/0,f=1/0),s.x=h,s.y=f,s}function inverse$s(s){var e=(s.x-this.x0)*(1/this.a),i=(s.y-this.y0)*(1/this.a);i=(i-this.Zb)/this.Qn,e=e/this.Qn;var n,o;if(Math.abs(e)<=2.623395162778){var l=clens_cmplx(this.utg,2*i,2*e);i=i+l[0],e=e+l[1],e=Math.atan(sinh(e));var c=Math.sin(i),u=Math.cos(i),h=Math.sin(e),f=Math.cos(e);i=Math.atan2(c*f,hypot(h,f*u)),e=Math.atan2(h,f*u),n=adjust_lon(e+this.long0),o=gatg(this.cgb,i)}else n=1/0,o=1/0;return s.x=n,s.y=o,s}var names$u=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const etmerc={init:init$u,forward:forward$s,inverse:inverse$s,names:names$u};function adjust_zone(s,e){if(s===void 0){if(s=Math.floor((adjust_lon(e)+Math.PI)*30/Math.PI)+1,s<0)return 0;if(s>60)return 60}return s}var dependsOn="etmerc";function init$t(){var s=adjust_zone(this.zone,this.long0);if(s===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(s)-183)*D2R$1,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,etmerc.init.apply(this),this.forward=etmerc.forward,this.inverse=etmerc.inverse}var names$t=["Universal Transverse Mercator System","utm"];const utm={init:init$t,names:names$t,dependsOn};function srat(s,e){return Math.pow((1-s)/(1+s),e)}var MAX_ITER$2=20;function init$s(){var s=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*s*s),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(s/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+FORTPI)/(Math.pow(Math.tan(.5*this.lat0+FORTPI),this.C)*srat(this.e*s,this.ratexp))}function forward$r(s){var e=s.x,i=s.y;return s.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+FORTPI),this.C)*srat(this.e*Math.sin(i),this.ratexp))-HALF_PI,s.x=this.C*e,s}function inverse$r(s){for(var e=1e-14,i=s.x/this.C,n=s.y,o=Math.pow(Math.tan(.5*n+FORTPI)/this.K,1/this.C),l=MAX_ITER$2;l>0&&(n=2*Math.atan(o*srat(this.e*Math.sin(s.y),-.5*this.e))-HALF_PI,!(Math.abs(n-s.y)<e));--l)s.y=n;return l?(s.x=i,s.y=n,s):null}const gauss={init:init$s,forward:forward$r,inverse:inverse$r};function init$r(){gauss.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function forward$q(s){var e,i,n,o;return s.x=adjust_lon(s.x-this.long0),gauss.forward.apply(this,[s]),e=Math.sin(s.y),i=Math.cos(s.y),n=Math.cos(s.x),o=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*i*n),s.x=o*i*Math.sin(s.x),s.y=o*(this.cosc0*e-this.sinc0*i*n),s.x=this.a*s.x+this.x0,s.y=this.a*s.y+this.y0,s}function inverse$q(s){var e,i,n,o,l;if(s.x=(s.x-this.x0)/this.a,s.y=(s.y-this.y0)/this.a,s.x/=this.k0,s.y/=this.k0,l=hypot(s.x,s.y)){var c=2*Math.atan2(l,this.R2);e=Math.sin(c),i=Math.cos(c),o=Math.asin(i*this.sinc0+s.y*e*this.cosc0/l),n=Math.atan2(s.x*e,l*this.cosc0*i-s.y*this.sinc0*e)}else o=this.phic0,n=0;return s.x=n,s.y=o,gauss.inverse.apply(this,[s]),s.x=adjust_lon(s.x+this.long0),s}var names$s=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const sterea={init:init$r,forward:forward$q,inverse:inverse$q,names:names$s};function ssfn_(s,e,i){return e*=i,Math.tan(.5*(HALF_PI+s))*Math.pow((1-e)/(1+e),.5*i)}function init$q(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=EPSLN&&(this.k0=.5*(1+sign(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=EPSLN&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=EPSLN&&Math.abs(Math.cos(this.lat_ts))>EPSLN&&(this.k0=.5*this.cons*msfnz(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/tsfnz(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=msfnz(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-HALF_PI,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function forward$p(s){var e=s.x,i=s.y,n=Math.sin(i),o=Math.cos(i),l,c,u,h,f,g,H=adjust_lon(e-this.long0);return Math.abs(Math.abs(e-this.long0)-Math.PI)<=EPSLN&&Math.abs(i+this.lat0)<=EPSLN?(s.x=NaN,s.y=NaN,s):this.sphere?(l=2*this.k0/(1+this.sinlat0*n+this.coslat0*o*Math.cos(H)),s.x=this.a*l*o*Math.sin(H)+this.x0,s.y=this.a*l*(this.coslat0*n-this.sinlat0*o*Math.cos(H))+this.y0,s):(c=2*Math.atan(this.ssfn_(i,n,this.e))-HALF_PI,h=Math.cos(c),u=Math.sin(c),Math.abs(this.coslat0)<=EPSLN?(f=tsfnz(this.e,i*this.con,this.con*n),g=2*this.a*this.k0*f/this.cons,s.x=this.x0+g*Math.sin(e-this.long0),s.y=this.y0-this.con*g*Math.cos(e-this.long0),s):(Math.abs(this.sinlat0)<EPSLN?(l=2*this.a*this.k0/(1+h*Math.cos(H)),s.y=l*u):(l=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*u+this.cosX0*h*Math.cos(H))),s.y=l*(this.cosX0*u-this.sinX0*h*Math.cos(H))+this.y0),s.x=l*h*Math.sin(H)+this.x0,s))}function inverse$p(s){s.x-=this.x0,s.y-=this.y0;var e,i,n,o,l,c=Math.sqrt(s.x*s.x+s.y*s.y);if(this.sphere){var u=2*Math.atan(c/(2*this.a*this.k0));return e=this.long0,i=this.lat0,c<=EPSLN?(s.x=e,s.y=i,s):(i=Math.asin(Math.cos(u)*this.sinlat0+s.y*Math.sin(u)*this.coslat0/c),Math.abs(this.coslat0)<EPSLN?this.lat0>0?e=adjust_lon(this.long0+Math.atan2(s.x,-1*s.y)):e=adjust_lon(this.long0+Math.atan2(s.x,s.y)):e=adjust_lon(this.long0+Math.atan2(s.x*Math.sin(u),c*this.coslat0*Math.cos(u)-s.y*this.sinlat0*Math.sin(u))),s.x=e,s.y=i,s)}else if(Math.abs(this.coslat0)<=EPSLN){if(c<=EPSLN)return i=this.lat0,e=this.long0,s.x=e,s.y=i,s;s.x*=this.con,s.y*=this.con,n=c*this.cons/(2*this.a*this.k0),i=this.con*phi2z(this.e,n),e=this.con*adjust_lon(this.con*this.long0+Math.atan2(s.x,-1*s.y))}else o=2*Math.atan(c*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,c<=EPSLN?l=this.X0:(l=Math.asin(Math.cos(o)*this.sinX0+s.y*Math.sin(o)*this.cosX0/c),e=adjust_lon(this.long0+Math.atan2(s.x*Math.sin(o),c*this.cosX0*Math.cos(o)-s.y*this.sinX0*Math.sin(o)))),i=-1*phi2z(this.e,Math.tan(.5*(HALF_PI+l)));return s.x=e,s.y=i,s}var names$r=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const stere={init:init$q,forward:forward$p,inverse:inverse$p,names:names$r,ssfn_};function init$p(){var s=this.lat0;this.lambda0=this.long0;var e=Math.sin(s),i=this.a,n=this.rf,o=1/n,l=2*o-Math.pow(o,2),c=this.e=Math.sqrt(l);this.R=this.k0*i*Math.sqrt(1-l)/(1-l*Math.pow(e,2)),this.alpha=Math.sqrt(1+l/(1-l)*Math.pow(Math.cos(s),4)),this.b0=Math.asin(e/this.alpha);var u=Math.log(Math.tan(Math.PI/4+this.b0/2)),h=Math.log(Math.tan(Math.PI/4+s/2)),f=Math.log((1+c*e)/(1-c*e));this.K=u-this.alpha*h+this.alpha*c/2*f}function forward$o(s){var e=Math.log(Math.tan(Math.PI/4-s.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(s.y))/(1-this.e*Math.sin(s.y))),n=-this.alpha*(e+i)+this.K,o=2*(Math.atan(Math.exp(n))-Math.PI/4),l=this.alpha*(s.x-this.lambda0),c=Math.atan(Math.sin(l)/(Math.sin(this.b0)*Math.tan(o)+Math.cos(this.b0)*Math.cos(l))),u=Math.asin(Math.cos(this.b0)*Math.sin(o)-Math.sin(this.b0)*Math.cos(o)*Math.cos(l));return s.y=this.R/2*Math.log((1+Math.sin(u))/(1-Math.sin(u)))+this.y0,s.x=this.R*c+this.x0,s}function inverse$o(s){for(var e=s.x-this.x0,i=s.y-this.y0,n=e/this.R,o=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),l=Math.asin(Math.cos(this.b0)*Math.sin(o)+Math.sin(this.b0)*Math.cos(o)*Math.cos(n)),c=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(o))),u=this.lambda0+c/this.alpha,h=0,f=l,g=-1e3,H=0;Math.abs(f-g)>1e-7;){if(++H>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+l/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(f))/2)),g=f,f=2*Math.atan(Math.exp(h))-Math.PI/2}return s.x=u,s.y=f,s}var names$q=["somerc"];const somerc={init:init$p,forward:forward$o,inverse:inverse$o,names:names$q};var TOL=1e-7;function isTypeA(s){var e=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],i=typeof s.PROJECTION=="object"?Object.keys(s.PROJECTION)[0]:s.PROJECTION;return"no_uoff"in s||"no_off"in s||e.indexOf(i)!==-1}function init$o(){var s,e,i,n,o,l,c,u,h,f,g=0,H,Y=0,ee=0,te=0,xe=0,ne=0,et=0;this.no_off=isTypeA(this),this.no_rot="no_rot"in this;var tt=!1;"alpha"in this&&(tt=!0);var it=!1;if("rectified_grid_angle"in this&&(it=!0),tt&&(et=this.alpha),it&&(g=this.rectified_grid_angle*D2R$1),tt||it)Y=this.longc;else if(ee=this.long1,xe=this.lat1,te=this.long2,ne=this.lat2,Math.abs(xe-ne)<=TOL||(s=Math.abs(xe))<=TOL||Math.abs(s-HALF_PI)<=TOL||Math.abs(Math.abs(this.lat0)-HALF_PI)<=TOL||Math.abs(Math.abs(ne)-HALF_PI)<=TOL)throw new Error;var rt=1-this.es;e=Math.sqrt(rt),Math.abs(this.lat0)>EPSLN?(u=Math.sin(this.lat0),i=Math.cos(this.lat0),s=1-this.es*u*u,this.B=i*i,this.B=Math.sqrt(1+this.es*this.B*this.B/rt),this.A=this.B*this.k0*e/s,n=this.B*e/(i*Math.sqrt(s)),o=n*n-1,o<=0?o=0:(o=Math.sqrt(o),this.lat0<0&&(o=-o)),this.E=o+=n,this.E*=Math.pow(tsfnz(this.e,this.lat0,u),this.B)):(this.B=1/e,this.A=this.k0,this.E=n=o=1),tt||it?(tt?(H=Math.asin(Math.sin(et)/n),it||(g=et)):(H=g,et=Math.asin(n*Math.sin(H))),this.lam0=Y-Math.asin(.5*(o-1/o)*Math.tan(H))/this.B):(l=Math.pow(tsfnz(this.e,xe,Math.sin(xe)),this.B),c=Math.pow(tsfnz(this.e,ne,Math.sin(ne)),this.B),o=this.E/l,h=(c-l)/(c+l),f=this.E*this.E,f=(f-c*l)/(f+c*l),s=ee-te,s<-Math.pi?te-=TWO_PI:s>Math.pi&&(te+=TWO_PI),this.lam0=adjust_lon(.5*(ee+te)-Math.atan(f*Math.tan(.5*this.B*(ee-te))/h)/this.B),H=Math.atan(2*Math.sin(this.B*adjust_lon(ee-this.lam0))/(o-1/o)),g=et=Math.asin(n*Math.sin(H))),this.singam=Math.sin(H),this.cosgam=Math.cos(H),this.sinrot=Math.sin(g),this.cosrot=Math.cos(g),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(et))),this.lat0<0&&(this.u_0=-this.u_0)),o=.5*H,this.v_pole_n=this.ArB*Math.log(Math.tan(FORTPI-o)),this.v_pole_s=this.ArB*Math.log(Math.tan(FORTPI+o))}function forward$n(s){var e={},i,n,o,l,c,u,h,f;if(s.x=s.x-this.lam0,Math.abs(Math.abs(s.y)-HALF_PI)>EPSLN){if(c=this.E/Math.pow(tsfnz(this.e,s.y,Math.sin(s.y)),this.B),u=1/c,i=.5*(c-u),n=.5*(c+u),l=Math.sin(this.B*s.x),o=(i*this.singam-l*this.cosgam)/n,Math.abs(Math.abs(o)-1)<EPSLN)throw new Error;f=.5*this.ArB*Math.log((1-o)/(1+o)),u=Math.cos(this.B*s.x),Math.abs(u)<TOL?h=this.A*s.x:h=this.ArB*Math.atan2(i*this.cosgam+l*this.singam,u)}else f=s.y>0?this.v_pole_n:this.v_pole_s,h=this.ArB*s.y;return this.no_rot?(e.x=h,e.y=f):(h-=this.u_0,e.x=f*this.cosrot+h*this.sinrot,e.y=h*this.cosrot-f*this.sinrot),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function inverse$n(s){var e,i,n,o,l,c,u,h={};if(s.x=(s.x-this.x0)*(1/this.a),s.y=(s.y-this.y0)*(1/this.a),this.no_rot?(i=s.y,e=s.x):(i=s.x*this.cosrot-s.y*this.sinrot,e=s.y*this.cosrot+s.x*this.sinrot+this.u_0),n=Math.exp(-this.BrA*i),o=.5*(n-1/n),l=.5*(n+1/n),c=Math.sin(this.BrA*e),u=(c*this.cosgam+o*this.singam)/l,Math.abs(Math.abs(u)-1)<EPSLN)h.x=0,h.y=u<0?-HALF_PI:HALF_PI;else{if(h.y=this.E/Math.sqrt((1+u)/(1-u)),h.y=phi2z(this.e,Math.pow(h.y,1/this.B)),h.y===1/0)throw new Error;h.x=-this.rB*Math.atan2(o*this.cosgam-c*this.singam,Math.cos(this.BrA*e))}return h.x+=this.lam0,h}var names$p=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const omerc={init:init$o,forward:forward$n,inverse:inverse$n,names:names$p};function init$n(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<EPSLN)){var s=this.b/this.a;this.e=Math.sqrt(1-s*s);var e=Math.sin(this.lat1),i=Math.cos(this.lat1),n=msfnz(this.e,e,i),o=tsfnz(this.e,this.lat1,e),l=Math.sin(this.lat2),c=Math.cos(this.lat2),u=msfnz(this.e,l,c),h=tsfnz(this.e,this.lat2,l),f=tsfnz(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>EPSLN?this.ns=Math.log(n/u)/Math.log(o/h):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=n/(this.ns*Math.pow(o,this.ns)),this.rh=this.a*this.f0*Math.pow(f,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function forward$m(s){var e=s.x,i=s.y;Math.abs(2*Math.abs(i)-Math.PI)<=EPSLN&&(i=sign(i)*(HALF_PI-2*EPSLN));var n=Math.abs(Math.abs(i)-HALF_PI),o,l;if(n>EPSLN)o=tsfnz(this.e,i,Math.sin(i)),l=this.a*this.f0*Math.pow(o,this.ns);else{if(n=i*this.ns,n<=0)return null;l=0}var c=this.ns*adjust_lon(e-this.long0);return s.x=this.k0*(l*Math.sin(c))+this.x0,s.y=this.k0*(this.rh-l*Math.cos(c))+this.y0,s}function inverse$m(s){var e,i,n,o,l,c=(s.x-this.x0)/this.k0,u=this.rh-(s.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(c*c+u*u),i=1):(e=-Math.sqrt(c*c+u*u),i=-1);var h=0;if(e!==0&&(h=Math.atan2(i*c,i*u)),e!==0||this.ns>0){if(i=1/this.ns,n=Math.pow(e/(this.a*this.f0),i),o=phi2z(this.e,n),o===-9999)return null}else o=-HALF_PI;return l=adjust_lon(h/this.ns+this.long0),s.x=l,s.y=o,s}var names$o=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const lcc={init:init$n,forward:forward$m,inverse:inverse$m,names:names$o};function init$m(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function forward$l(s){var e,i,n,o,l,c,u,h=s.x,f=s.y,g=adjust_lon(h-this.long0);return e=Math.pow((1+this.e*Math.sin(f))/(1-this.e*Math.sin(f)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(f/2+this.s45),this.alfa)/e)-this.s45),n=-g*this.alfa,o=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(n)),l=Math.asin(Math.cos(i)*Math.sin(n)/Math.cos(o)),c=this.n*l,u=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(o/2+this.s45),this.n),s.y=u*Math.cos(c)/1,s.x=u*Math.sin(c)/1,this.czech||(s.y*=-1,s.x*=-1),s}function inverse$l(s){var e,i,n,o,l,c,u,h,f=s.x;s.x=s.y,s.y=f,this.czech||(s.y*=-1,s.x*=-1),c=Math.sqrt(s.x*s.x+s.y*s.y),l=Math.atan2(s.y,s.x),o=l/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/c,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(o)),i=Math.asin(Math.cos(n)*Math.sin(o)/Math.cos(e)),s.x=this.long0-i/this.alfa,u=e,h=0;var g=0;do s.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(u))/(1-this.e*Math.sin(u)),this.e/2))-this.s45),Math.abs(u-s.y)<1e-10&&(h=1),u=s.y,g+=1;while(h===0&&g<15);return g>=15?null:s}var names$n=["Krovak","krovak"];const krovak={init:init$m,forward:forward$l,inverse:inverse$l,names:names$n};function mlfn(s,e,i,n,o){return s*o-e*Math.sin(2*o)+i*Math.sin(4*o)-n*Math.sin(6*o)}function e0fn(s){return 1-.25*s*(1+s/16*(3+1.25*s))}function e1fn(s){return .375*s*(1+.25*s*(1+.46875*s))}function e2fn(s){return .05859375*s*s*(1+.75*s)}function e3fn(s){return s*s*s*(35/3072)}function gN(s,e,i){var n=e*i;return s/Math.sqrt(1-n*n)}function adjust_lat(s){return Math.abs(s)<HALF_PI?s:s-sign(s)*Math.PI}function imlfn(s,e,i,n,o){var l,c;l=s/e;for(var u=0;u<15;u++)if(c=(s-(e*l-i*Math.sin(2*l)+n*Math.sin(4*l)-o*Math.sin(6*l)))/(e-2*i*Math.cos(2*l)+4*n*Math.cos(4*l)-6*o*Math.cos(6*l)),l+=c,Math.abs(c)<=1e-10)return l;return NaN}function init$l(){this.sphere||(this.e0=e0fn(this.es),this.e1=e1fn(this.es),this.e2=e2fn(this.es),this.e3=e3fn(this.es),this.ml0=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0))}function forward$k(s){var e,i,n=s.x,o=s.y;if(n=adjust_lon(n-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(o)*Math.sin(n)),i=this.a*(Math.atan2(Math.tan(o),Math.cos(n))-this.lat0);else{var l=Math.sin(o),c=Math.cos(o),u=gN(this.a,this.e,l),h=Math.tan(o)*Math.tan(o),f=n*Math.cos(o),g=f*f,H=this.es*c*c/(1-this.es),Y=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,o);e=u*f*(1-g*h*(1/6-(8-h+8*H)*g/120)),i=Y-this.ml0+u*l/c*g*(.5+(5-h+6*H)*g/24)}return s.x=e+this.x0,s.y=i+this.y0,s}function inverse$k(s){s.x-=this.x0,s.y-=this.y0;var e=s.x/this.a,i=s.y/this.a,n,o;if(this.sphere){var l=i+this.lat0;n=Math.asin(Math.sin(l)*Math.cos(e)),o=Math.atan2(Math.tan(e),Math.cos(l))}else{var c=this.ml0/this.a+i,u=imlfn(c,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(u)-HALF_PI)<=EPSLN)return s.x=this.long0,s.y=HALF_PI,i<0&&(s.y*=-1),s;var h=gN(this.a,this.e,Math.sin(u)),f=h*h*h/this.a/this.a*(1-this.es),g=Math.pow(Math.tan(u),2),H=e*this.a/h,Y=H*H;n=u-h*Math.tan(u)/f*H*H*(.5-(1+3*g)*H*H/24),o=H*(1-Y*(g/3+(1+3*g)*g*Y/15))/Math.cos(u)}return s.x=adjust_lon(o+this.long0),s.y=adjust_lat(n),s}var names$m=["Cassini","Cassini_Soldner","cass"];const cass={init:init$l,forward:forward$k,inverse:inverse$k,names:names$m};function qsfnz(s,e){var i;return s>1e-7?(i=s*e,(1-s*s)*(e/(1-i*i)-.5/s*Math.log((1-i)/(1+i)))):2*e}var S_POLE=1,N_POLE=2,EQUIT=3,OBLIQ=4;function init$k(){var s=Math.abs(this.lat0);if(Math.abs(s-HALF_PI)<EPSLN?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(s)<EPSLN?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=qsfnz(this.e,1),this.mmf=.5/(1-this.es),this.apa=authset(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=qsfnz(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function forward$j(s){var e,i,n,o,l,c,u,h,f,g,H=s.x,Y=s.y;if(H=adjust_lon(H-this.long0),this.sphere){if(l=Math.sin(Y),g=Math.cos(Y),n=Math.cos(H),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(i=this.mode===this.EQUIT?1+g*n:1+this.sinph0*l+this.cosph0*g*n,i<=EPSLN)return null;i=Math.sqrt(2/i),e=i*g*Math.sin(H),i*=this.mode===this.EQUIT?l:this.cosph0*l-this.sinph0*g*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(Y+this.lat0)<EPSLN)return null;i=FORTPI-Y*.5,i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)),e=i*Math.sin(H),i*=n}}else{switch(u=0,h=0,f=0,n=Math.cos(H),o=Math.sin(H),l=Math.sin(Y),c=qsfnz(this.e,l),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(u=c/this.qp,h=Math.sqrt(1-u*u)),this.mode){case this.OBLIQ:f=1+this.sinb1*u+this.cosb1*h*n;break;case this.EQUIT:f=1+h*n;break;case this.N_POLE:f=HALF_PI+Y,c=this.qp-c;break;case this.S_POLE:f=Y-HALF_PI,c=this.qp+c;break}if(Math.abs(f)<EPSLN)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:f=Math.sqrt(2/f),this.mode===this.OBLIQ?i=this.ymf*f*(this.cosb1*u-this.sinb1*h*n):i=(f=Math.sqrt(2/(1+h*n)))*u*this.ymf,e=this.xmf*f*h*o;break;case this.N_POLE:case this.S_POLE:c>=0?(e=(f=Math.sqrt(c))*o,i=n*(this.mode===this.S_POLE?f:-f)):e=i=0;break}}return s.x=this.a*e+this.x0,s.y=this.a*i+this.y0,s}function inverse$j(s){s.x-=this.x0,s.y-=this.y0;var e=s.x/this.a,i=s.y/this.a,n,o,l,c,u,h,f;if(this.sphere){var g=0,H,Y=0;if(H=Math.sqrt(e*e+i*i),o=H*.5,o>1)return null;switch(o=2*Math.asin(o),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(Y=Math.sin(o),g=Math.cos(o)),this.mode){case this.EQUIT:o=Math.abs(H)<=EPSLN?0:Math.asin(i*Y/H),e*=Y,i=g*H;break;case this.OBLIQ:o=Math.abs(H)<=EPSLN?this.lat0:Math.asin(g*this.sinph0+i*Y*this.cosph0/H),e*=Y*this.cosph0,i=(g-Math.sin(o)*this.sinph0)*H;break;case this.N_POLE:i=-i,o=HALF_PI-o;break;case this.S_POLE:o-=HALF_PI;break}n=i===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(e,i)}else{if(f=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e/=this.dd,i*=this.dd,h=Math.sqrt(e*e+i*i),h<EPSLN)return s.x=this.long0,s.y=this.lat0,s;c=2*Math.asin(.5*h/this.rq),l=Math.cos(c),e*=c=Math.sin(c),this.mode===this.OBLIQ?(f=l*this.sinb1+i*c*this.cosb1/h,u=this.qp*f,i=h*this.cosb1*l-i*this.sinb1*c):(f=i*c/h,u=this.qp*f,i=h*l)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),u=e*e+i*i,!u)return s.x=this.long0,s.y=this.lat0,s;f=1-u/this.qp,this.mode===this.S_POLE&&(f=-f)}n=Math.atan2(e,i),o=authlat(Math.asin(f),this.apa)}return s.x=adjust_lon(this.long0+n),s.y=o,s}var P00=.3333333333333333,P01=.17222222222222222,P02=.10257936507936508,P10=.06388888888888888,P11=.0664021164021164,P20=.016415012942191543;function authset(s){var e,i=[];return i[0]=s*P00,e=s*s,i[0]+=e*P01,i[1]=e*P10,e*=s,i[0]+=e*P02,i[1]+=e*P11,i[2]=e*P20,i}function authlat(s,e){var i=s+s;return s+e[0]*Math.sin(i)+e[1]*Math.sin(i+i)+e[2]*Math.sin(i+i+i)}var names$l=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const laea={init:init$k,forward:forward$j,inverse:inverse$j,names:names$l,S_POLE,N_POLE,EQUIT,OBLIQ};function asinz(s){return Math.abs(s)>1&&(s=s>1?1:-1),Math.asin(s)}function init$j(){Math.abs(this.lat1+this.lat2)<EPSLN||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=msfnz(this.e3,this.sin_po,this.cos_po),this.qs1=qsfnz(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=msfnz(this.e3,this.sin_po,this.cos_po),this.qs2=qsfnz(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=qsfnz(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>EPSLN?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function forward$i(s){var e=s.x,i=s.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var n=qsfnz(this.e3,this.sin_phi),o=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,l=this.ns0*adjust_lon(e-this.long0),c=o*Math.sin(l)+this.x0,u=this.rh-o*Math.cos(l)+this.y0;return s.x=c,s.y=u,s}function inverse$i(s){var e,i,n,o,l,c;return s.x-=this.x0,s.y=this.rh-s.y+this.y0,this.ns0>=0?(e=Math.sqrt(s.x*s.x+s.y*s.y),n=1):(e=-Math.sqrt(s.x*s.x+s.y*s.y),n=-1),o=0,e!==0&&(o=Math.atan2(n*s.x,n*s.y)),n=e*this.ns0/this.a,this.sphere?c=Math.asin((this.c-n*n)/(2*this.ns0)):(i=(this.c-n*n)/this.ns0,c=this.phi1z(this.e3,i)),l=adjust_lon(o/this.ns0+this.long0),s.x=l,s.y=c,s}function phi1z(s,e){var i,n,o,l,c,u=asinz(.5*e);if(s<EPSLN)return u;for(var h=s*s,f=1;f<=25;f++)if(i=Math.sin(u),n=Math.cos(u),o=s*i,l=1-o*o,c=.5*l*l/n*(e/(1-h)-i/l+.5/s*Math.log((1-o)/(1+o))),u=u+c,Math.abs(c)<=1e-7)return u;return null}var names$k=["Albers_Conic_Equal_Area","Albers","aea"];const aea={init:init$j,forward:forward$i,inverse:inverse$i,names:names$k,phi1z};function init$i(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function forward$h(s){var e,i,n,o,l,c,u,h,f=s.x,g=s.y;return n=adjust_lon(f-this.long0),e=Math.sin(g),i=Math.cos(g),o=Math.cos(n),c=this.sin_p14*e+this.cos_p14*i*o,l=1,c>0||Math.abs(c)<=EPSLN?(u=this.x0+this.a*l*i*Math.sin(n)/c,h=this.y0+this.a*l*(this.cos_p14*e-this.sin_p14*i*o)/c):(u=this.x0+this.infinity_dist*i*Math.sin(n),h=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*i*o)),s.x=u,s.y=h,s}function inverse$h(s){var e,i,n,o,l,c;return s.x=(s.x-this.x0)/this.a,s.y=(s.y-this.y0)/this.a,s.x/=this.k0,s.y/=this.k0,(e=Math.sqrt(s.x*s.x+s.y*s.y))?(o=Math.atan2(e,this.rc),i=Math.sin(o),n=Math.cos(o),c=asinz(n*this.sin_p14+s.y*i*this.cos_p14/e),l=Math.atan2(s.x*i,e*this.cos_p14*n-s.y*this.sin_p14*i),l=adjust_lon(this.long0+l)):(c=this.phic0,l=0),s.x=l,s.y=c,s}var names$j=["gnom"];const gnom={init:init$i,forward:forward$h,inverse:inverse$h,names:names$j};function iqsfnz(s,e){var i=1-(1-s*s)/(2*s)*Math.log((1-s)/(1+s));if(Math.abs(Math.abs(e)-i)<1e-6)return e<0?-1*HALF_PI:HALF_PI;for(var n=Math.asin(.5*e),o,l,c,u,h=0;h<30;h++)if(l=Math.sin(n),c=Math.cos(n),u=s*l,o=Math.pow(1-u*u,2)/(2*c)*(e/(1-s*s)-l/(1-u*u)+.5/s*Math.log((1-u)/(1+u))),n+=o,Math.abs(o)<=1e-10)return n;return NaN}function init$h(){this.sphere||(this.k0=msfnz(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function forward$g(s){var e=s.x,i=s.y,n,o,l=adjust_lon(e-this.long0);if(this.sphere)n=this.x0+this.a*l*Math.cos(this.lat_ts),o=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var c=qsfnz(this.e,Math.sin(i));n=this.x0+this.a*this.k0*l,o=this.y0+this.a*c*.5/this.k0}return s.x=n,s.y=o,s}function inverse$g(s){s.x-=this.x0,s.y-=this.y0;var e,i;return this.sphere?(e=adjust_lon(this.long0+s.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(s.y/this.a*Math.cos(this.lat_ts))):(i=iqsfnz(this.e,2*s.y*this.k0/this.a),e=adjust_lon(this.long0+s.x/(this.a*this.k0))),s.x=e,s.y=i,s}var names$i=["cea"];const cea={init:init$h,forward:forward$g,inverse:inverse$g,names:names$i};function init$g(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function forward$f(s){var e=s.x,i=s.y,n=adjust_lon(e-this.long0),o=adjust_lat(i-this.lat0);return s.x=this.x0+this.a*n*this.rc,s.y=this.y0+this.a*o,s}function inverse$f(s){var e=s.x,i=s.y;return s.x=adjust_lon(this.long0+(e-this.x0)/(this.a*this.rc)),s.y=adjust_lat(this.lat0+(i-this.y0)/this.a),s}var names$h=["Equirectangular","Equidistant_Cylindrical","eqc"];const eqc={init:init$g,forward:forward$f,inverse:inverse$f,names:names$h};var MAX_ITER$1=20;function init$f(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=e0fn(this.es),this.e1=e1fn(this.es),this.e2=e2fn(this.es),this.e3=e3fn(this.es),this.ml0=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)}function forward$e(s){var e=s.x,i=s.y,n,o,l,c=adjust_lon(e-this.long0);if(l=c*Math.sin(i),this.sphere)Math.abs(i)<=EPSLN?(n=this.a*c,o=-1*this.a*this.lat0):(n=this.a*Math.sin(l)/Math.tan(i),o=this.a*(adjust_lat(i-this.lat0)+(1-Math.cos(l))/Math.tan(i)));else if(Math.abs(i)<=EPSLN)n=this.a*c,o=-1*this.ml0;else{var u=gN(this.a,this.e,Math.sin(i))/Math.tan(i);n=u*Math.sin(l),o=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+u*(1-Math.cos(l))}return s.x=n+this.x0,s.y=o+this.y0,s}function inverse$e(s){var e,i,n,o,l,c,u,h,f;if(n=s.x-this.x0,o=s.y-this.y0,this.sphere)if(Math.abs(o+this.a*this.lat0)<=EPSLN)e=adjust_lon(n/this.a+this.long0),i=0;else{c=this.lat0+o/this.a,u=n*n/this.a/this.a+c*c,h=c;var g;for(l=MAX_ITER$1;l;--l)if(g=Math.tan(h),f=-1*(c*(h*g+1)-h-.5*(h*h+u)*g)/((h-c)/g-1),h+=f,Math.abs(f)<=EPSLN){i=h;break}e=adjust_lon(this.long0+Math.asin(n*Math.tan(h)/this.a)/Math.sin(i))}else if(Math.abs(o+this.ml0)<=EPSLN)i=0,e=adjust_lon(this.long0+n/this.a);else{c=(this.ml0+o)/this.a,u=n*n/this.a/this.a+c*c,h=c;var H,Y,ee,te,xe;for(l=MAX_ITER$1;l;--l)if(xe=this.e*Math.sin(h),H=Math.sqrt(1-xe*xe)*Math.tan(h),Y=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,h),ee=this.e0-2*this.e1*Math.cos(2*h)+4*this.e2*Math.cos(4*h)-6*this.e3*Math.cos(6*h),te=Y/this.a,f=(c*(H*te+1)-te-.5*H*(te*te+u))/(this.es*Math.sin(2*h)*(te*te+u-2*c*te)/(4*H)+(c-te)*(H*ee-2/Math.sin(2*h))-ee),h-=f,Math.abs(f)<=EPSLN){i=h;break}H=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),e=adjust_lon(this.long0+Math.asin(n*H/this.a)/Math.sin(i))}return s.x=e,s.y=i,s}var names$g=["Polyconic","poly"];const poly={init:init$f,forward:forward$e,inverse:inverse$e,names:names$g};function init$e(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function forward$d(s){var e,i=s.x,n=s.y,o=n-this.lat0,l=i-this.long0,c=o/SEC_TO_RAD*1e-5,u=l,h=1,f=0;for(e=1;e<=10;e++)h=h*c,f=f+this.A[e]*h;var g=f,H=u,Y=1,ee=0,te,xe,ne=0,et=0;for(e=1;e<=6;e++)te=Y*g-ee*H,xe=ee*g+Y*H,Y=te,ee=xe,ne=ne+this.B_re[e]*Y-this.B_im[e]*ee,et=et+this.B_im[e]*Y+this.B_re[e]*ee;return s.x=et*this.a+this.x0,s.y=ne*this.a+this.y0,s}function inverse$d(s){var e,i=s.x,n=s.y,o=i-this.x0,l=n-this.y0,c=l/this.a,u=o/this.a,h=1,f=0,g,H,Y=0,ee=0;for(e=1;e<=6;e++)g=h*c-f*u,H=f*c+h*u,h=g,f=H,Y=Y+this.C_re[e]*h-this.C_im[e]*f,ee=ee+this.C_im[e]*h+this.C_re[e]*f;for(var te=0;te<this.iterations;te++){var xe=Y,ne=ee,et,tt,it=c,rt=u;for(e=2;e<=6;e++)et=xe*Y-ne*ee,tt=ne*Y+xe*ee,xe=et,ne=tt,it=it+(e-1)*(this.B_re[e]*xe-this.B_im[e]*ne),rt=rt+(e-1)*(this.B_im[e]*xe+this.B_re[e]*ne);xe=1,ne=0;var nt=this.B_re[1],st=this.B_im[1];for(e=2;e<=6;e++)et=xe*Y-ne*ee,tt=ne*Y+xe*ee,xe=et,ne=tt,nt=nt+e*(this.B_re[e]*xe-this.B_im[e]*ne),st=st+e*(this.B_im[e]*xe+this.B_re[e]*ne);var at=nt*nt+st*st;Y=(it*nt+rt*st)/at,ee=(rt*nt-it*st)/at}var ot=Y,ct=ee,ht=1,ut=0;for(e=1;e<=9;e++)ht=ht*ot,ut=ut+this.D[e]*ht;var pt=this.lat0+ut*SEC_TO_RAD*1e5,yt=this.long0+ct;return s.x=yt,s.y=pt,s}var names$f=["New_Zealand_Map_Grid","nzmg"];const nzmg={init:init$e,forward:forward$d,inverse:inverse$d,names:names$f};function init$d(){}function forward$c(s){var e=s.x,i=s.y,n=adjust_lon(e-this.long0),o=this.x0+this.a*n,l=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return s.x=o,s.y=l,s}function inverse$c(s){s.x-=this.x0,s.y-=this.y0;var e=adjust_lon(this.long0+s.x/this.a),i=2.5*(Math.atan(Math.exp(.8*s.y/this.a))-Math.PI/4);return s.x=e,s.y=i,s}var names$e=["Miller_Cylindrical","mill"];const mill={init:init$d,forward:forward$c,inverse:inverse$c,names:names$e};var MAX_ITER=20;function init$c(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=pj_enfn(this.es)}function forward$b(s){var e,i,n=s.x,o=s.y;if(n=adjust_lon(n-this.long0),this.sphere){if(!this.m)o=this.n!==1?Math.asin(this.n*Math.sin(o)):o;else for(var l=this.n*Math.sin(o),c=MAX_ITER;c;--c){var u=(this.m*o+Math.sin(o)-l)/(this.m+Math.cos(o));if(o-=u,Math.abs(u)<EPSLN)break}e=this.a*this.C_x*n*(this.m+Math.cos(o)),i=this.a*this.C_y*o}else{var h=Math.sin(o),f=Math.cos(o);i=this.a*pj_mlfn(o,h,f,this.en),e=this.a*n*f/Math.sqrt(1-this.es*h*h)}return s.x=e,s.y=i,s}function inverse$b(s){var e,i,n,o;return s.x-=this.x0,n=s.x/this.a,s.y-=this.y0,e=s.y/this.a,this.sphere?(e/=this.C_y,n=n/(this.C_x*(this.m+Math.cos(e))),this.m?e=asinz((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=asinz(Math.sin(e)/this.n)),n=adjust_lon(n+this.long0),e=adjust_lat(e)):(e=pj_inv_mlfn(s.y/this.a,this.es,this.en),o=Math.abs(e),o<HALF_PI?(o=Math.sin(e),i=this.long0+s.x*Math.sqrt(1-this.es*o*o)/(this.a*Math.cos(e)),n=adjust_lon(i)):o-EPSLN<HALF_PI&&(n=this.long0)),s.x=n,s.y=e,s}var names$d=["Sinusoidal","sinu"];const sinu={init:init$c,forward:forward$b,inverse:inverse$b,names:names$d};function init$b(){}function forward$a(s){for(var e=s.x,i=s.y,n=adjust_lon(e-this.long0),o=i,l=Math.PI*Math.sin(i);;){var c=-(o+Math.sin(o)-l)/(1+Math.cos(o));if(o+=c,Math.abs(c)<EPSLN)break}o/=2,Math.PI/2-Math.abs(i)<EPSLN&&(n=0);var u=.900316316158*this.a*n*Math.cos(o)+this.x0,h=1.4142135623731*this.a*Math.sin(o)+this.y0;return s.x=u,s.y=h,s}function inverse$a(s){var e,i;s.x-=this.x0,s.y-=this.y0,i=s.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),e=Math.asin(i);var n=adjust_lon(this.long0+s.x/(.900316316158*this.a*Math.cos(e)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),i=(2*e+Math.sin(2*e))/Math.PI,Math.abs(i)>1&&(i=1);var o=Math.asin(i);return s.x=n,s.y=o,s}var names$c=["Mollweide","moll"];const moll={init:init$b,forward:forward$a,inverse:inverse$a,names:names$c};function init$a(){Math.abs(this.lat1+this.lat2)<EPSLN||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=e0fn(this.es),this.e1=e1fn(this.es),this.e2=e2fn(this.es),this.e3=e3fn(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=msfnz(this.e,this.sinphi,this.cosphi),this.ml1=mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<EPSLN?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=msfnz(this.e,this.sinphi,this.cosphi),this.ml2=mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function forward$9(s){var e=s.x,i=s.y,n;if(this.sphere)n=this.a*(this.g-i);else{var o=mlfn(this.e0,this.e1,this.e2,this.e3,i);n=this.a*(this.g-o)}var l=this.ns*adjust_lon(e-this.long0),c=this.x0+n*Math.sin(l),u=this.y0+this.rh-n*Math.cos(l);return s.x=c,s.y=u,s}function inverse$9(s){s.x-=this.x0,s.y=this.rh-s.y+this.y0;var e,i,n,o;this.ns>=0?(i=Math.sqrt(s.x*s.x+s.y*s.y),e=1):(i=-Math.sqrt(s.x*s.x+s.y*s.y),e=-1);var l=0;if(i!==0&&(l=Math.atan2(e*s.x,e*s.y)),this.sphere)return o=adjust_lon(this.long0+l/this.ns),n=adjust_lat(this.g-i/this.a),s.x=o,s.y=n,s;var c=this.g-i/this.a;return n=imlfn(c,this.e0,this.e1,this.e2,this.e3),o=adjust_lon(this.long0+l/this.ns),s.x=o,s.y=n,s}var names$b=["Equidistant_Conic","eqdc"];const eqdc={init:init$a,forward:forward$9,inverse:inverse$9,names:names$b};function init$9(){this.R=this.a}function forward$8(s){var e=s.x,i=s.y,n=adjust_lon(e-this.long0),o,l;Math.abs(i)<=EPSLN&&(o=this.x0+this.R*n,l=this.y0);var c=asinz(2*Math.abs(i/Math.PI));(Math.abs(n)<=EPSLN||Math.abs(Math.abs(i)-HALF_PI)<=EPSLN)&&(o=this.x0,i>=0?l=this.y0+Math.PI*this.R*Math.tan(.5*c):l=this.y0+Math.PI*this.R*-Math.tan(.5*c));var u=.5*Math.abs(Math.PI/n-n/Math.PI),h=u*u,f=Math.sin(c),g=Math.cos(c),H=g/(f+g-1),Y=H*H,ee=H*(2/f-1),te=ee*ee,xe=Math.PI*this.R*(u*(H-te)+Math.sqrt(h*(H-te)*(H-te)-(te+h)*(Y-te)))/(te+h);n<0&&(xe=-xe),o=this.x0+xe;var ne=h+H;return xe=Math.PI*this.R*(ee*ne-u*Math.sqrt((te+h)*(h+1)-ne*ne))/(te+h),i>=0?l=this.y0+xe:l=this.y0-xe,s.x=o,s.y=l,s}function inverse$8(s){var e,i,n,o,l,c,u,h,f,g,H,Y,ee;return s.x-=this.x0,s.y-=this.y0,H=Math.PI*this.R,n=s.x/H,o=s.y/H,l=n*n+o*o,c=-Math.abs(o)*(1+l),u=c-2*o*o+n*n,h=-2*c+1+2*o*o+l*l,ee=o*o/h+(2*u*u*u/h/h/h-9*c*u/h/h)/27,f=(c-u*u/3/h)/h,g=2*Math.sqrt(-f/3),H=3*ee/f/g,Math.abs(H)>1&&(H>=0?H=1:H=-1),Y=Math.acos(H)/3,s.y>=0?i=(-g*Math.cos(Y+Math.PI/3)-u/3/h)*Math.PI:i=-(-g*Math.cos(Y+Math.PI/3)-u/3/h)*Math.PI,Math.abs(n)<EPSLN?e=this.long0:e=adjust_lon(this.long0+Math.PI*(l-1+Math.sqrt(1+2*(n*n-o*o)+l*l))/2/n),s.x=e,s.y=i,s}var names$a=["Van_der_Grinten_I","VanDerGrinten","vandg"];const vandg={init:init$9,forward:forward$8,inverse:inverse$8,names:names$a};function init$8(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function forward$7(s){var e=s.x,i=s.y,n=Math.sin(s.y),o=Math.cos(s.y),l=adjust_lon(e-this.long0),c,u,h,f,g,H,Y,ee,te,xe,ne,et,tt,it,rt,nt,st,at,ot,ct,ht,ut,pt;return this.sphere?Math.abs(this.sin_p12-1)<=EPSLN?(s.x=this.x0+this.a*(HALF_PI-i)*Math.sin(l),s.y=this.y0-this.a*(HALF_PI-i)*Math.cos(l),s):Math.abs(this.sin_p12+1)<=EPSLN?(s.x=this.x0+this.a*(HALF_PI+i)*Math.sin(l),s.y=this.y0+this.a*(HALF_PI+i)*Math.cos(l),s):(at=this.sin_p12*n+this.cos_p12*o*Math.cos(l),nt=Math.acos(at),st=nt?nt/Math.sin(nt):1,s.x=this.x0+this.a*st*o*Math.sin(l),s.y=this.y0+this.a*st*(this.cos_p12*n-this.sin_p12*o*Math.cos(l)),s):(c=e0fn(this.es),u=e1fn(this.es),h=e2fn(this.es),f=e3fn(this.es),Math.abs(this.sin_p12-1)<=EPSLN?(g=this.a*mlfn(c,u,h,f,HALF_PI),H=this.a*mlfn(c,u,h,f,i),s.x=this.x0+(g-H)*Math.sin(l),s.y=this.y0-(g-H)*Math.cos(l),s):Math.abs(this.sin_p12+1)<=EPSLN?(g=this.a*mlfn(c,u,h,f,HALF_PI),H=this.a*mlfn(c,u,h,f,i),s.x=this.x0+(g+H)*Math.sin(l),s.y=this.y0+(g+H)*Math.cos(l),s):(Y=n/o,ee=gN(this.a,this.e,this.sin_p12),te=gN(this.a,this.e,n),xe=Math.atan((1-this.es)*Y+this.es*ee*this.sin_p12/(te*o)),ne=Math.atan2(Math.sin(l),this.cos_p12*Math.tan(xe)-this.sin_p12*Math.cos(l)),ne===0?ot=Math.asin(this.cos_p12*Math.sin(xe)-this.sin_p12*Math.cos(xe)):Math.abs(Math.abs(ne)-Math.PI)<=EPSLN?ot=-Math.asin(this.cos_p12*Math.sin(xe)-this.sin_p12*Math.cos(xe)):ot=Math.asin(Math.sin(l)*Math.cos(xe)/Math.sin(ne)),et=this.e*this.sin_p12/Math.sqrt(1-this.es),tt=this.e*this.cos_p12*Math.cos(ne)/Math.sqrt(1-this.es),it=et*tt,rt=tt*tt,ct=ot*ot,ht=ct*ot,ut=ht*ot,pt=ut*ot,nt=ee*ot*(1-ct*rt*(1-rt)/6+ht/8*it*(1-2*rt)+ut/120*(rt*(4-7*rt)-3*et*et*(1-7*rt))-pt/48*it),s.x=this.x0+nt*Math.sin(ne),s.y=this.y0+nt*Math.cos(ne),s))}function inverse$7(s){s.x-=this.x0,s.y-=this.y0;var e,i,n,o,l,c,u,h,f,g,H,Y,ee,te,xe,ne,et,tt,it,rt,nt,st,at,ot;return this.sphere?(e=Math.sqrt(s.x*s.x+s.y*s.y),e>2*HALF_PI*this.a?void 0:(i=e/this.a,n=Math.sin(i),o=Math.cos(i),l=this.long0,Math.abs(e)<=EPSLN?c=this.lat0:(c=asinz(o*this.sin_p12+s.y*n*this.cos_p12/e),u=Math.abs(this.lat0)-HALF_PI,Math.abs(u)<=EPSLN?this.lat0>=0?l=adjust_lon(this.long0+Math.atan2(s.x,-s.y)):l=adjust_lon(this.long0-Math.atan2(-s.x,s.y)):l=adjust_lon(this.long0+Math.atan2(s.x*n,e*this.cos_p12*o-s.y*this.sin_p12*n))),s.x=l,s.y=c,s)):(h=e0fn(this.es),f=e1fn(this.es),g=e2fn(this.es),H=e3fn(this.es),Math.abs(this.sin_p12-1)<=EPSLN?(Y=this.a*mlfn(h,f,g,H,HALF_PI),e=Math.sqrt(s.x*s.x+s.y*s.y),ee=Y-e,c=imlfn(ee/this.a,h,f,g,H),l=adjust_lon(this.long0+Math.atan2(s.x,-1*s.y)),s.x=l,s.y=c,s):Math.abs(this.sin_p12+1)<=EPSLN?(Y=this.a*mlfn(h,f,g,H,HALF_PI),e=Math.sqrt(s.x*s.x+s.y*s.y),ee=e-Y,c=imlfn(ee/this.a,h,f,g,H),l=adjust_lon(this.long0+Math.atan2(s.x,s.y)),s.x=l,s.y=c,s):(e=Math.sqrt(s.x*s.x+s.y*s.y),ne=Math.atan2(s.x,s.y),te=gN(this.a,this.e,this.sin_p12),et=Math.cos(ne),tt=this.e*this.cos_p12*et,it=-tt*tt/(1-this.es),rt=3*this.es*(1-it)*this.sin_p12*this.cos_p12*et/(1-this.es),nt=e/te,st=nt-it*(1+it)*Math.pow(nt,3)/6-rt*(1+3*it)*Math.pow(nt,4)/24,at=1-it*st*st/2-nt*st*st*st/6,xe=Math.asin(this.sin_p12*Math.cos(st)+this.cos_p12*Math.sin(st)*et),l=adjust_lon(this.long0+Math.asin(Math.sin(ne)*Math.sin(st)/Math.cos(xe))),ot=Math.sin(xe),c=Math.atan2((ot-this.es*at*this.sin_p12)*Math.tan(xe),ot*(1-this.es)),s.x=l,s.y=c,s))}var names$9=["Azimuthal_Equidistant","aeqd"];const aeqd={init:init$8,forward:forward$7,inverse:inverse$7,names:names$9};function init$7(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function forward$6(s){var e,i,n,o,l,c,u,h,f=s.x,g=s.y;return n=adjust_lon(f-this.long0),e=Math.sin(g),i=Math.cos(g),o=Math.cos(n),c=this.sin_p14*e+this.cos_p14*i*o,l=1,(c>0||Math.abs(c)<=EPSLN)&&(u=this.a*l*i*Math.sin(n),h=this.y0+this.a*l*(this.cos_p14*e-this.sin_p14*i*o)),s.x=u,s.y=h,s}function inverse$6(s){var e,i,n,o,l,c,u;return s.x-=this.x0,s.y-=this.y0,e=Math.sqrt(s.x*s.x+s.y*s.y),i=asinz(e/this.a),n=Math.sin(i),o=Math.cos(i),c=this.long0,Math.abs(e)<=EPSLN?(u=this.lat0,s.x=c,s.y=u,s):(u=asinz(o*this.sin_p14+s.y*n*this.cos_p14/e),l=Math.abs(this.lat0)-HALF_PI,Math.abs(l)<=EPSLN?(this.lat0>=0?c=adjust_lon(this.long0+Math.atan2(s.x,-s.y)):c=adjust_lon(this.long0-Math.atan2(-s.x,s.y)),s.x=c,s.y=u,s):(c=adjust_lon(this.long0+Math.atan2(s.x*n,e*this.cos_p14*o-s.y*this.sin_p14*n)),s.x=c,s.y=u,s))}var names$8=["ortho"];const ortho={init:init$7,forward:forward$6,inverse:inverse$6,names:names$8};var FACE_ENUM={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},AREA_ENUM={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function init$6(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=HALF_PI-FORTPI/2?this.face=FACE_ENUM.TOP:this.lat0<=-(HALF_PI-FORTPI/2)?this.face=FACE_ENUM.BOTTOM:Math.abs(this.long0)<=FORTPI?this.face=FACE_ENUM.FRONT:Math.abs(this.long0)<=HALF_PI+FORTPI?this.face=this.long0>0?FACE_ENUM.RIGHT:FACE_ENUM.LEFT:this.face=FACE_ENUM.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function forward$5(s){var e={x:0,y:0},i,n,o,l,c,u,h={value:0};if(s.x-=this.long0,this.es!==0?i=Math.atan(this.one_minus_f_squared*Math.tan(s.y)):i=s.y,n=s.x,this.face===FACE_ENUM.TOP)l=HALF_PI-i,n>=FORTPI&&n<=HALF_PI+FORTPI?(h.value=AREA_ENUM.AREA_0,o=n-HALF_PI):n>HALF_PI+FORTPI||n<=-(HALF_PI+FORTPI)?(h.value=AREA_ENUM.AREA_1,o=n>0?n-SPI:n+SPI):n>-(HALF_PI+FORTPI)&&n<=-FORTPI?(h.value=AREA_ENUM.AREA_2,o=n+HALF_PI):(h.value=AREA_ENUM.AREA_3,o=n);else if(this.face===FACE_ENUM.BOTTOM)l=HALF_PI+i,n>=FORTPI&&n<=HALF_PI+FORTPI?(h.value=AREA_ENUM.AREA_0,o=-n+HALF_PI):n<FORTPI&&n>=-FORTPI?(h.value=AREA_ENUM.AREA_1,o=-n):n<-FORTPI&&n>=-(HALF_PI+FORTPI)?(h.value=AREA_ENUM.AREA_2,o=-n-HALF_PI):(h.value=AREA_ENUM.AREA_3,o=n>0?-n+SPI:-n-SPI);else{var f,g,H,Y,ee,te,xe;this.face===FACE_ENUM.RIGHT?n=qsc_shift_lon_origin(n,+HALF_PI):this.face===FACE_ENUM.BACK?n=qsc_shift_lon_origin(n,+SPI):this.face===FACE_ENUM.LEFT&&(n=qsc_shift_lon_origin(n,-HALF_PI)),Y=Math.sin(i),ee=Math.cos(i),te=Math.sin(n),xe=Math.cos(n),f=ee*xe,g=ee*te,H=Y,this.face===FACE_ENUM.FRONT?(l=Math.acos(f),o=qsc_fwd_equat_face_theta(l,H,g,h)):this.face===FACE_ENUM.RIGHT?(l=Math.acos(g),o=qsc_fwd_equat_face_theta(l,H,-f,h)):this.face===FACE_ENUM.BACK?(l=Math.acos(-f),o=qsc_fwd_equat_face_theta(l,H,-g,h)):this.face===FACE_ENUM.LEFT?(l=Math.acos(-g),o=qsc_fwd_equat_face_theta(l,H,f,h)):(l=o=0,h.value=AREA_ENUM.AREA_0)}return u=Math.atan(12/SPI*(o+Math.acos(Math.sin(o)*Math.cos(FORTPI))-HALF_PI)),c=Math.sqrt((1-Math.cos(l))/(Math.cos(u)*Math.cos(u))/(1-Math.cos(Math.atan(1/Math.cos(o))))),h.value===AREA_ENUM.AREA_1?u+=HALF_PI:h.value===AREA_ENUM.AREA_2?u+=SPI:h.value===AREA_ENUM.AREA_3&&(u+=1.5*SPI),e.x=c*Math.cos(u),e.y=c*Math.sin(u),e.x=e.x*this.a+this.x0,e.y=e.y*this.a+this.y0,s.x=e.x,s.y=e.y,s}function inverse$5(s){var e={lam:0,phi:0},i,n,o,l,c,u,h,f,g,H={value:0};if(s.x=(s.x-this.x0)/this.a,s.y=(s.y-this.y0)/this.a,n=Math.atan(Math.sqrt(s.x*s.x+s.y*s.y)),i=Math.atan2(s.y,s.x),s.x>=0&&s.x>=Math.abs(s.y)?H.value=AREA_ENUM.AREA_0:s.y>=0&&s.y>=Math.abs(s.x)?(H.value=AREA_ENUM.AREA_1,i-=HALF_PI):s.x<0&&-s.x>=Math.abs(s.y)?(H.value=AREA_ENUM.AREA_2,i=i<0?i+SPI:i-SPI):(H.value=AREA_ENUM.AREA_3,i+=HALF_PI),g=SPI/12*Math.tan(i),c=Math.sin(g)/(Math.cos(g)-1/Math.sqrt(2)),u=Math.atan(c),o=Math.cos(i),l=Math.tan(n),h=1-o*o*l*l*(1-Math.cos(Math.atan(1/Math.cos(u)))),h<-1?h=-1:h>1&&(h=1),this.face===FACE_ENUM.TOP)f=Math.acos(h),e.phi=HALF_PI-f,H.value===AREA_ENUM.AREA_0?e.lam=u+HALF_PI:H.value===AREA_ENUM.AREA_1?e.lam=u<0?u+SPI:u-SPI:H.value===AREA_ENUM.AREA_2?e.lam=u-HALF_PI:e.lam=u;else if(this.face===FACE_ENUM.BOTTOM)f=Math.acos(h),e.phi=f-HALF_PI,H.value===AREA_ENUM.AREA_0?e.lam=-u+HALF_PI:H.value===AREA_ENUM.AREA_1?e.lam=-u:H.value===AREA_ENUM.AREA_2?e.lam=-u-HALF_PI:e.lam=u<0?-u-SPI:-u+SPI;else{var Y,ee,te;Y=h,g=Y*Y,g>=1?te=0:te=Math.sqrt(1-g)*Math.sin(u),g+=te*te,g>=1?ee=0:ee=Math.sqrt(1-g),H.value===AREA_ENUM.AREA_1?(g=ee,ee=-te,te=g):H.value===AREA_ENUM.AREA_2?(ee=-ee,te=-te):H.value===AREA_ENUM.AREA_3&&(g=ee,ee=te,te=-g),this.face===FACE_ENUM.RIGHT?(g=Y,Y=-ee,ee=g):this.face===FACE_ENUM.BACK?(Y=-Y,ee=-ee):this.face===FACE_ENUM.LEFT&&(g=Y,Y=ee,ee=-g),e.phi=Math.acos(-te)-HALF_PI,e.lam=Math.atan2(ee,Y),this.face===FACE_ENUM.RIGHT?e.lam=qsc_shift_lon_origin(e.lam,-HALF_PI):this.face===FACE_ENUM.BACK?e.lam=qsc_shift_lon_origin(e.lam,-SPI):this.face===FACE_ENUM.LEFT&&(e.lam=qsc_shift_lon_origin(e.lam,+HALF_PI))}if(this.es!==0){var xe,ne,et;xe=e.phi<0?1:0,ne=Math.tan(e.phi),et=this.b/Math.sqrt(ne*ne+this.one_minus_f_squared),e.phi=Math.atan(Math.sqrt(this.a*this.a-et*et)/(this.one_minus_f*et)),xe&&(e.phi=-e.phi)}return e.lam+=this.long0,s.x=e.lam,s.y=e.phi,s}function qsc_fwd_equat_face_theta(s,e,i,n){var o;return s<EPSLN?(n.value=AREA_ENUM.AREA_0,o=0):(o=Math.atan2(e,i),Math.abs(o)<=FORTPI?n.value=AREA_ENUM.AREA_0:o>FORTPI&&o<=HALF_PI+FORTPI?(n.value=AREA_ENUM.AREA_1,o-=HALF_PI):o>HALF_PI+FORTPI||o<=-(HALF_PI+FORTPI)?(n.value=AREA_ENUM.AREA_2,o=o>=0?o-SPI:o+SPI):(n.value=AREA_ENUM.AREA_3,o+=HALF_PI)),o}function qsc_shift_lon_origin(s,e){var i=s+e;return i<-SPI?i+=TWO_PI:i>+SPI&&(i-=TWO_PI),i}var names$7=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const qsc={init:init$6,forward:forward$5,inverse:inverse$5,names:names$7};var COEFS_X=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],COEFS_Y=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],FXC=.8487,FYC=1.3523,C1=R2D/5,RC1=1/C1,NODES=18,poly3_val=function(s,e){return s[0]+e*(s[1]+e*(s[2]+e*s[3]))},poly3_der=function(s,e){return s[1]+e*(2*s[2]+e*3*s[3])};function newton_rapshon(s,e,i,n){for(var o=e;n;--n){var l=s(o);if(o-=l,Math.abs(l)<i)break}return o}function init$5(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function forward$4(s){var e=adjust_lon(s.x-this.long0),i=Math.abs(s.y),n=Math.floor(i*C1);n<0?n=0:n>=NODES&&(n=NODES-1),i=R2D*(i-RC1*n);var o={x:poly3_val(COEFS_X[n],i)*e,y:poly3_val(COEFS_Y[n],i)};return s.y<0&&(o.y=-o.y),o.x=o.x*this.a*FXC+this.x0,o.y=o.y*this.a*FYC+this.y0,o}function inverse$4(s){var e={x:(s.x-this.x0)/(this.a*FXC),y:Math.abs(s.y-this.y0)/(this.a*FYC)};if(e.y>=1)e.x/=COEFS_X[NODES][0],e.y=s.y<0?-HALF_PI:HALF_PI;else{var i=Math.floor(e.y*NODES);for(i<0?i=0:i>=NODES&&(i=NODES-1);;)if(COEFS_Y[i][0]>e.y)--i;else if(COEFS_Y[i+1][0]<=e.y)++i;else break;var n=COEFS_Y[i],o=5*(e.y-n[0])/(COEFS_Y[i+1][0]-n[0]);o=newton_rapshon(function(l){return(poly3_val(n,l)-e.y)/poly3_der(n,l)},o,EPSLN,100),e.x/=poly3_val(COEFS_X[i],o),e.y=(5*i+o)*D2R$1,s.y<0&&(e.y=-e.y)}return e.x=adjust_lon(e.x+this.long0),e}var names$6=["Robinson","robin"];const robin={init:init$5,forward:forward$4,inverse:inverse$4,names:names$6};function init$4(){this.name="geocent"}function forward$3(s){var e=geodeticToGeocentric(s,this.es,this.a);return e}function inverse$3(s){var e=geocentricToGeodetic(s,this.es,this.a,this.b);return e}var names$5=["Geocentric","geocentric","geocent","Geocent"];const geocent={init:init$4,forward:forward$3,inverse:inverse$3,names:names$5};var mode={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},params={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function init$3(){if(Object.keys(params).forEach((function(i){if(typeof this[i]>"u")this[i]=params[i].def;else{if(params[i].num&&isNaN(this[i]))throw new Error("Invalid parameter value, must be numeric "+i+" = "+this[i]);params[i].num&&(this[i]=parseFloat(this[i]))}params[i].degrees&&(this[i]=this[i]*D2R$1)}).bind(this)),Math.abs(Math.abs(this.lat0)-HALF_PI)<EPSLN?this.mode=this.lat0<0?mode.S_POLE:mode.N_POLE:Math.abs(this.lat0)<EPSLN?this.mode=mode.EQUIT:(this.mode=mode.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var s=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(s),this.sw=Math.sin(s)}function forward$2(s){s.x-=this.long0;var e=Math.sin(s.y),i=Math.cos(s.y),n=Math.cos(s.x),o,l;switch(this.mode){case mode.OBLIQ:l=this.sinph0*e+this.cosph0*i*n;break;case mode.EQUIT:l=i*n;break;case mode.S_POLE:l=-e;break;case mode.N_POLE:l=e;break}switch(l=this.pn1/(this.p-l),o=l*i*Math.sin(s.x),this.mode){case mode.OBLIQ:l*=this.cosph0*e-this.sinph0*i*n;break;case mode.EQUIT:l*=e;break;case mode.N_POLE:l*=-(i*n);break;case mode.S_POLE:l*=i*n;break}var c,u;return c=l*this.cg+o*this.sg,u=1/(c*this.sw*this.h1+this.cw),o=(o*this.cg-l*this.sg)*this.cw*u,l=c*u,s.x=o*this.a,s.y=l*this.a,s}function inverse$2(s){s.x/=this.a,s.y/=this.a;var e={x:s.x,y:s.y},i,n,o;o=1/(this.pn1-s.y*this.sw),i=this.pn1*s.x*o,n=this.pn1*s.y*this.cw*o,s.x=i*this.cg+n*this.sg,s.y=n*this.cg-i*this.sg;var l=hypot(s.x,s.y);if(Math.abs(l)<EPSLN)e.x=0,e.y=s.y;else{var c,u;switch(u=1-l*l*this.pfact,u=(this.p-Math.sqrt(u))/(this.pn1/l+l/this.pn1),c=Math.sqrt(1-u*u),this.mode){case mode.OBLIQ:e.y=Math.asin(c*this.sinph0+s.y*u*this.cosph0/l),s.y=(c-this.sinph0*Math.sin(e.y))*l,s.x*=u*this.cosph0;break;case mode.EQUIT:e.y=Math.asin(s.y*u/l),s.y=c*l,s.x*=u;break;case mode.N_POLE:e.y=Math.asin(c),s.y=-s.y;break;case mode.S_POLE:e.y=-Math.asin(c);break}e.x=Math.atan2(s.x,s.y)}return s.x=e.x+this.long0,s.y=e.y,s}var names$4=["Tilted_Perspective","tpers"];const tpers={init:init$3,forward:forward$2,inverse:inverse$2,names:names$4};function init$2(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var s=1-this.es,e=1/s;this.radius_p=Math.sqrt(s),this.radius_p2=s,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function forward$1(s){var e=s.x,i=s.y,n,o,l,c;if(e=e-this.long0,this.shape==="ellipse"){i=Math.atan(this.radius_p2*Math.tan(i));var u=this.radius_p/hypot(this.radius_p*Math.cos(i),Math.sin(i));if(o=u*Math.cos(e)*Math.cos(i),l=u*Math.sin(e)*Math.cos(i),c=u*Math.sin(i),(this.radius_g-o)*o-l*l-c*c*this.radius_p_inv2<0)return s.x=Number.NaN,s.y=Number.NaN,s;n=this.radius_g-o,this.flip_axis?(s.x=this.radius_g_1*Math.atan(l/hypot(c,n)),s.y=this.radius_g_1*Math.atan(c/n)):(s.x=this.radius_g_1*Math.atan(l/n),s.y=this.radius_g_1*Math.atan(c/hypot(l,n)))}else this.shape==="sphere"&&(n=Math.cos(i),o=Math.cos(e)*n,l=Math.sin(e)*n,c=Math.sin(i),n=this.radius_g-o,this.flip_axis?(s.x=this.radius_g_1*Math.atan(l/hypot(c,n)),s.y=this.radius_g_1*Math.atan(c/n)):(s.x=this.radius_g_1*Math.atan(l/n),s.y=this.radius_g_1*Math.atan(c/hypot(l,n))));return s.x=s.x*this.a,s.y=s.y*this.a,s}function inverse$1(s){var e=-1,i=0,n=0,o,l,c,u;if(s.x=s.x/this.a,s.y=s.y/this.a,this.shape==="ellipse"){this.flip_axis?(n=Math.tan(s.y/this.radius_g_1),i=Math.tan(s.x/this.radius_g_1)*hypot(1,n)):(i=Math.tan(s.x/this.radius_g_1),n=Math.tan(s.y/this.radius_g_1)*hypot(1,i));var h=n/this.radius_p;if(o=i*i+h*h+e*e,l=2*this.radius_g*e,c=l*l-4*o*this.C,c<0)return s.x=Number.NaN,s.y=Number.NaN,s;u=(-l-Math.sqrt(c))/(2*o),e=this.radius_g+u*e,i*=u,n*=u,s.x=Math.atan2(i,e),s.y=Math.atan(n*Math.cos(s.x)/e),s.y=Math.atan(this.radius_p_inv2*Math.tan(s.y))}else if(this.shape==="sphere"){if(this.flip_axis?(n=Math.tan(s.y/this.radius_g_1),i=Math.tan(s.x/this.radius_g_1)*Math.sqrt(1+n*n)):(i=Math.tan(s.x/this.radius_g_1),n=Math.tan(s.y/this.radius_g_1)*Math.sqrt(1+i*i)),o=i*i+n*n+e*e,l=2*this.radius_g*e,c=l*l-4*o*this.C,c<0)return s.x=Number.NaN,s.y=Number.NaN,s;u=(-l-Math.sqrt(c))/(2*o),e=this.radius_g+u*e,i*=u,n*=u,s.x=Math.atan2(i,e),s.y=Math.atan(n*Math.cos(s.x)/e)}return s.x=s.x+this.long0,s}var names$3=["Geostationary Satellite View","Geostationary_Satellite","geos"];const geos={init:init$2,forward:forward$1,inverse:inverse$1,names:names$3};var A1=1.340264,A2=-.081106,A3=893e-6,A4=.003796,M$2=Math.sqrt(3)/2;function init$1(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function forward(s){var e=adjust_lon(s.x-this.long0),i=s.y,n=Math.asin(M$2*Math.sin(i)),o=n*n,l=o*o*o;return s.x=e*Math.cos(n)/(M$2*(A1+3*A2*o+l*(7*A3+9*A4*o))),s.y=n*(A1+A2*o+l*(A3+A4*o)),s.x=this.a*s.x+this.x0,s.y=this.a*s.y+this.y0,s}function inverse(s){s.x=(s.x-this.x0)/this.a,s.y=(s.y-this.y0)/this.a;var e=1e-9,i=12,n=s.y,o,l,c,u,h,f;for(f=0;f<i&&(o=n*n,l=o*o*o,c=n*(A1+A2*o+l*(A3+A4*o))-s.y,u=A1+3*A2*o+l*(7*A3+9*A4*o),n-=h=c/u,!(Math.abs(h)<e));++f);return o=n*n,l=o*o*o,s.x=M$2*s.x*(A1+3*A2*o+l*(7*A3+9*A4*o))/Math.cos(n),s.y=Math.asin(Math.sin(n)/M$2),s.x=adjust_lon(s.x+this.long0),s}var names$2=["eqearth","Equal Earth","Equal_Earth"];const eqearth={init:init$1,forward,inverse,names:names$2};var EPS10=1e-10;function init(){var s;if(this.phi1=this.lat1,Math.abs(this.phi1)<EPS10)throw new Error;this.es?(this.en=pj_enfn(this.es),this.m1=pj_mlfn(this.phi1,this.am1=Math.sin(this.phi1),s=Math.cos(this.phi1),this.en),this.am1=s/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=e_inv,this.forward=e_fwd):(Math.abs(this.phi1)+EPS10>=HALF_PI?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=s_inv,this.forward=s_fwd)}function e_fwd(s){var e=adjust_lon(s.x-(this.long0||0)),i=s.y,n,o,l;return n=this.am1+this.m1-pj_mlfn(i,o=Math.sin(i),l=Math.cos(i),this.en),o=l*e/(n*Math.sqrt(1-this.es*o*o)),s.x=n*Math.sin(o),s.y=this.am1-n*Math.cos(o),s.x=this.a*s.x+(this.x0||0),s.y=this.a*s.y+(this.y0||0),s}function e_inv(s){s.x=(s.x-(this.x0||0))/this.a,s.y=(s.y-(this.y0||0))/this.a;var e,i,n,o;if(i=hypot(s.x,s.y=this.am1-s.y),o=pj_inv_mlfn(this.am1+this.m1-i,this.es,this.en),(e=Math.abs(o))<HALF_PI)e=Math.sin(o),n=i*Math.atan2(s.x,s.y)*Math.sqrt(1-this.es*e*e)/Math.cos(o);else if(Math.abs(e-HALF_PI)<=EPS10)n=0;else throw new Error;return s.x=adjust_lon(n+(this.long0||0)),s.y=adjust_lat(o),s}function s_fwd(s){var e=adjust_lon(s.x-(this.long0||0)),i=s.y,n,o;return o=this.cphi1+this.phi1-i,Math.abs(o)>EPS10?(s.x=o*Math.sin(n=e*Math.cos(i)/o),s.y=this.cphi1-o*Math.cos(n)):s.x=s.y=0,s.x=this.a*s.x+(this.x0||0),s.y=this.a*s.y+(this.y0||0),s}function s_inv(s){s.x=(s.x-(this.x0||0))/this.a,s.y=(s.y-(this.y0||0))/this.a;var e,i,n=hypot(s.x,s.y=this.cphi1-s.y);if(i=this.cphi1+this.phi1-n,Math.abs(i)>HALF_PI)throw new Error;return Math.abs(Math.abs(i)-HALF_PI)<=EPS10?e=0:e=n*Math.atan2(s.x,s.y)/Math.cos(i),s.x=adjust_lon(e+(this.long0||0)),s.y=adjust_lat(i),s}var names$1=["bonne","Bonne (Werner lat_1=90)"];const bonne={init,names:names$1};function includedProjections(s){s.Proj.projections.add(tmerc),s.Proj.projections.add(etmerc),s.Proj.projections.add(utm),s.Proj.projections.add(sterea),s.Proj.projections.add(stere),s.Proj.projections.add(somerc),s.Proj.projections.add(omerc),s.Proj.projections.add(lcc),s.Proj.projections.add(krovak),s.Proj.projections.add(cass),s.Proj.projections.add(laea),s.Proj.projections.add(aea),s.Proj.projections.add(gnom),s.Proj.projections.add(cea),s.Proj.projections.add(eqc),s.Proj.projections.add(poly),s.Proj.projections.add(nzmg),s.Proj.projections.add(mill),s.Proj.projections.add(sinu),s.Proj.projections.add(moll),s.Proj.projections.add(eqdc),s.Proj.projections.add(vandg),s.Proj.projections.add(aeqd),s.Proj.projections.add(ortho),s.Proj.projections.add(qsc),s.Proj.projections.add(robin),s.Proj.projections.add(geocent),s.Proj.projections.add(tpers),s.Proj.projections.add(geos),s.Proj.projections.add(eqearth),s.Proj.projections.add(bonne)}proj4.defaultDatum="WGS84";proj4.Proj=Projection;proj4.WGS84=new proj4.Proj("WGS84");proj4.Point=Point;proj4.toPoint=common;proj4.defs=defs;proj4.nadgrid=nadgrid;proj4.transform=transform;proj4.mgrs=mgrs;proj4.version="__VERSION__";includedProjections(proj4);var logger$A=LoggerByDefault.getLogger("CRS");function register(s){const e=Object.keys(s.defs);logger$A.trace("proj. codes :",e);const i=e.length;let n,o;for(n=0;n<i;++n){const l=e[n];if(!get$3(l)){const c=s.defs(l);addProjection(new Projection$1({code:l,axisOrientation:c.axis,metersPerUnit:c.to_meter,units:c.units}))}}for(n=0;n<i;++n){const l=e[n],c=get$3(l);for(o=0;o<i;++o){const u=e[o],h=get$3(u);if(!get$4(l,u))if(s.defs[l]===s.defs[u])addEquivalentProjections([c,h]);else{const f=s(l,u);addCoordinateTransforms(c,h,f.forward,f.inverse)}}}}var Register={isLoaded:!1,get:function(s){if(!(s===""||s===null||typeof s>"u")){var e=s.split(":");if(e.length===2){var i=e[0],n=e[1];if(this.hasOwnProperty(i)&&this[i].hasOwnProperty(n))return this[i][n]}}},exist:function(s){if(s===""||s===null||typeof s>"u")return!1;var e=s.split(":");if(e.length!==2)return!1;var i=e[0],n=e[1];return!(!this.hasOwnProperty(i)||!this[i].hasOwnProperty(n))},load:function(s){if(!this.isLoaded){for(var e=["IGNF","EPSG","CRS"],i=0;i<e.length;i++){var n=e[i],o=this[n];for(var l in o)if(o.hasOwnProperty(l)){var c=n+":"+l;s.defs(c,this.get(c))}}this.isLoaded=!0}},loadByDefault:function(s){var e={EPSG:{2154:Register.EPSG[2154],27571:Register.EPSG[27571],27572:Register.EPSG[27572],27573:Register.EPSG[27573],27574:Register.EPSG[27574]},CRS:{84:Register.CRS[84]},IGNF:{LAMB93:Register.IGNF.LAMB93,LAMBE:Register.IGNF.LAMBE,LAMB1:Register.IGNF.LAMB1,LAMB2:Register.IGNF.LAMB2,LAMB3:Register.IGNF.LAMB3,LAMB4:Register.IGNF.LAMB4,RGF93G:Register.IGNF.RGF93G,WGS84G:Register.IGNF.WGS84G}};for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];for(var o in n)if(n.hasOwnProperty(o)){var l=i+":"+o;s.defs(l,n[o])}}},loadByName:function(s,e){if(!this.exist(e))return!1;try{s.defs(e,this.get(e))}catch{return!1}return!0},EPSG:{4978:"+proj=geocent +datum=WGS84 +units=m +no_defs ",3857:"+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs",3785:"+title=WGS 84 / Pseudo-Mercator (deprecated) +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs",4149:"+title=CH1903 +proj=longlat +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +no_defs ",4150:"+title=CH1903plus +proj=longlat +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +no_defs ",4151:"+title=CHTRF95 +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ",4171:"+title=RGF93 +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ",4230:"+title=ED50 +proj=longlat +ellps=intl +no_defs ",4235:"+title=Guyane Francaise +proj=longlat +ellps=intl +no_defs ",4258:"+title=ETRS89 +proj=longlat +ellps=GRS80 +no_defs ",4275:"+title=NTF +proj=longlat +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +no_defs ",4322:"+title=WGS 72 +proj=longlat +ellps=WGS72 +no_defs ",4326:"+title=WGS 84 +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ",4467:"+proj=utm +zone=21 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",4470:"+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ",4471:"+proj=utm +zone=38 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",4474:"+proj=utm +zone=38 +south +ellps=intl +towgs84=-382,-59,-262,0,0,0,0 +units=m +no_defs ",4558:"+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ",4559:"+proj=utm +zone=20 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",4621:"+title=Fort Marigot +proj=longlat +ellps=intl +towgs84=137,248,-430,0,0,0,0 +no_defs ",4622:"+title=Guadeloupe 1948 +proj=longlat +ellps=intl +no_defs ",4623:"+title=CSG67 +proj=longlat +ellps=intl +towgs84=-186,230,110,0,0,0,0 +no_defs ",4624:"+title=RGFG95 +proj=longlat +ellps=GRS80 +towgs84=2,2,-2,0,0,0,0 +no_defs ",4625:"+title=Martinique 1938 +proj=longlat +ellps=intl +no_defs ",4626:"+title=Reunion 1947 +proj=longlat +ellps=intl +no_defs ",4627:"+title=RGR92 +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ",4628:"+title=Tahiti 52 +proj=longlat +ellps=intl +towgs84=162,117,154,0,0,0,0 +no_defs ",4629:"+title=Tahaa 54 +proj=longlat +ellps=intl +no_defs ",4630:"+title=IGN72 Nuku Hiva +proj=longlat +ellps=intl +no_defs ",4632:"+title=Combani 1950 +proj=longlat +ellps=intl +towgs84=-382,-59,-262,0,0,0,0 +no_defs ",4633:"+title=IGN56 Lifou +proj=longlat +ellps=intl +no_defs ",4634:"+title=IGN72 Grand Terre +proj=longlat +ellps=intl +no_defs ",4637:"+title=Perroud 1950 +proj=longlat +ellps=intl +towgs84=325,154,172,0,0,0,0 +no_defs ",4638:"+title=Saint Pierre et Miquelon 1950 +proj=longlat +ellps=clrk66 +towgs84=30,430,368,0,0,0,0 +no_defs ",4640:"+title=RRAF 1991 +proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs ",4641:"+title=IGN53 Mare +proj=longlat +ellps=intl +no_defs ",4645:"+title=RGNC 1991 +proj=longlat +ellps=intl +towgs84=0,0,0,0,0,0,0 +no_defs ",4687:"+proj=longlat +ellps=GRS80 +no_defs ",4662:"+title=IGN72 Grande Terre +proj=longlat +ellps=intl +no_defs ",4689:"+title=IGN63 Hiva Oa +proj=longlat +ellps=intl +no_defs ",4690:"+title=Tahiti 79 +proj=longlat +ellps=intl +no_defs ",4691:"+title=Moorea 87 +proj=longlat +ellps=intl +towgs84=215.525,149.593,176.229,-3.2624,-1.692,-1.1571,10.4773 +no_defs ",4692:"+title=Maupiti 83 +proj=longlat +ellps=intl +towgs84=217.037,86.959,23.956,0,0,0,0 +no_defs ",4698:"+title=IGN 1962 Kerguelen +proj=longlat +ellps=intl +towgs84=145,-187,103,0,0,0,0 +no_defs ",4749:"+title=RGNC91-93 +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ",4750:"+title=ST87 Ouvea +proj=longlat +ellps=WGS84 +towgs84=-56.263,16.136,-22.856,0,0,0,0 +no_defs ",4807:"+title=NTF (Paris) +proj=longlat +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +no_defs ",2056:"+title=CH1903+ / LV95 +proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +x_0=2600000 +y_0=1200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs ",2154:"+title=RGF93 / Lambert-93 +proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",2213:"+title=ETRS89 / TM 30 NE +proj=tmerc +lat_0=0 +lon_0=30 +k=0.9996 +x_0=500000 +y_0=0 +ellps=GRS80 +units=m +no_defs ",2969:"+title=Fort Marigot / UTM zone 20N +proj=utm +zone=20 +ellps=intl +towgs84=137,248,-430,0,0,0,0 +units=m +no_defs ",2970:"+title=Guadeloupe 1948 / UTM zone 20N +proj=utm +zone=20 +ellps=intl +units=m +no_defs ",2971:"+title=CSG67 / UTM zone 22N +proj=utm +zone=22 +ellps=intl +towgs84=-186,230,110,0,0,0,0 +units=m +no_defs ",2972:"+title=RGFG95 / UTM zone 22N +proj=utm +zone=22 +ellps=GRS80 +towgs84=2,2,-2,0,0,0,0 +units=m +no_defs ",2973:"+title=Martinique 1938 / UTM zone 20N +proj=utm +zone=20 +ellps=intl +units=m +no_defs ",2975:"+title=RGR92 / UTM zone 40S +proj=utm +zone=40 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",2976:"+title=Tahiti 52 / UTM zone 6S +proj=utm +zone=6 +south +ellps=intl +towgs84=162,117,154,0,0,0,0 +units=m +no_defs ",2977:"+title=Tahaa 54 / UTM zone 5S +proj=utm +zone=5 +south +ellps=intl +units=m +no_defs ",2978:"+title=IGN72 Nuku Hiva / UTM zone 7S +proj=utm +zone=7 +south +ellps=intl +units=m +no_defs ",2980:"+title=Combani 1950 / UTM zone 38S +proj=utm +zone=38 +south +ellps=intl +towgs84=-382,-59,-262,0,0,0,0 +units=m +no_defs ",2981:"+title=IGN56 Lifou / UTM zone 58S +proj=utm +zone=58 +south +ellps=intl +units=m +no_defs ",2982:"+title=IGN72 Grand Terre / UTM zone 58S (deprecated) +proj=utm +zone=58 +south +ellps=intl +units=m +no_defs ",2984:"+title=RGNC 1991 / Lambert New Caledonia (deprecated) +proj=lcc +lat_1=-20.66666666666667 +lat_2=-22.33333333333333 +lat_0=-21.5 +lon_0=166 +x_0=400000 +y_0=300000 +ellps=intl +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",2986:"+title=Terre Adelie 1950 +proj=stere +towgs84=324.9120,153.2820,172.0260 +a=6378388.0000 +rf=297.0000000000000 +lat_0=-90.000000000 +lon_0=140.000000000 +lat_ts=-67.000000000 +k=0.96027295 +x_0=300000.000 +y_0=-2299363.482 +units=m +no_defs",2987:"+title=Saint Pierre et Miquelon 1950 / UTM zone 21N +proj=utm +zone=21 +ellps=clrk66 +towgs84=30,430,368,0,0,0,0 +units=m +no_defs ",2989:"+title=RRAF 1991 / UTM zone 20N +proj=utm +zone=20 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",2990:"+title=Reunion 1947 / TM Reunion (deprecated) +proj=tmerc +lat_0=-21.11666666666667 +lon_0=55.53333333333333 +k=1 +x_0=50000 +y_0=160000 +ellps=intl +units=m +no_defs ",2995:"+title=IGN53 Mare / UTM zone 58S +proj=utm +zone=58 +south +ellps=intl +units=m +no_defs ",3038:"+proj=utm +zone=26 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3039:"+proj=utm +zone=27 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3040:"+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3041:"+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3045:"+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3046:"+proj=utm +zone=34 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3047:"+proj=utm +zone=35 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3048:"+proj=utm +zone=36 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3049:"+proj=utm +zone=37 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3050:"+proj=utm +zone=38 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3051:"+proj=utm +zone=39 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3034:"+title=ETRS89 / ETRS-LCC +proj=lcc +lat_1=35 +lat_2=65 +lat_0=52 +lon_0=10 +x_0=4000000 +y_0=2800000 +ellps=GRS80 +units=m +no_defs ",3035:"+title=ETRS89 / ETRS-LAEA +proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs ",3042:"+title=ETRS89 / ETRS-TM30 +proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs ",3043:"+title=ETRS89 / ETRS-TM31 +proj=utm +zone=31 +ellps=GRS80 +units=m +no_defs ",3044:"+title=ETRS89 / ETRS-TM32 +proj=utm +zone=32 +ellps=GRS80 +units=m +no_defs ",25828:"+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",25829:"+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",25833:"+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",25834:"+proj=utm +zone=34 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",25835:"+proj=utm +zone=35 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",25836:"+proj=utm +zone=36 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",25837:"+proj=utm +zone=37 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",25838:"+proj=utm +zone=38 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3060:"+title=IGN72 Grande Terre / UTM zone 58S +proj=utm +zone=58 +south +ellps=intl +units=m +no_defs ",3163:"+title=RGNC91-93 / Lambert New Caledonia +proj=lcc +lat_1=-20.66666666666667 +lat_2=-22.33333333333333 +lat_0=-21.5 +lon_0=166 +x_0=400000 +y_0=300000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3164:"+title=ST87 Ouvea / UTM zone 58S +proj=utm +zone=58 +south +ellps=WGS84 +towgs84=-56.263,16.136,-22.856,0,0,0,0 +units=m +no_defs ",3165:"+title=NEA74 Noumea / Noumea Lambert +proj=lcc +lat_1=-22.24469175 +lat_2=-22.29469175 +lat_0=-22.26969175 +lon_0=166.44242575 +x_0=0.66 +y_0=1.02 +ellps=intl +units=m +no_defs ",3166:"+title=NEA74 Noumea / Noumea Lambert 2 +proj=lcc +lat_1=-22.24472222222222 +lat_2=-22.29472222222222 +lat_0=-22.26972222222222 +lon_0=166.4425 +x_0=8.313000000000001 +y_0=-2.354 +ellps=intl +units=m +no_defs ",3169:"+title=RGNC91-93 / UTM zone 57S +proj=utm +zone=57 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3170:"+title=RGNC91-93 / UTM zone 58S +proj=utm +zone=58 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3171:"+title=RGNC91-93 / UTM zone 59S +proj=utm +zone=59 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3172:"+title=IGN53 Mare / UTM zone 59S +proj=utm +zone=59 +south +ellps=intl +units=m +no_defs ",3296:"+title=RGPF / UTM zone 5S +proj=utm +zone=5 +south +ellps=GRS80 +units=m +no_defs ",3297:"+title=RGPF / UTM zone 6S +proj=utm +zone=6 +south +ellps=GRS80 +units=m +no_defs ",3298:"+title=RGPF / UTM zone 7S +proj=utm +zone=7 +south +ellps=GRS80 +units=m +no_defs ",3299:"+title=RGPF / UTM zone 8S +proj=utm +zone=8 +south +ellps=GRS80 +units=m +no_defs ",3302:"+title=IGN63 Hiva Oa / UTM zone 7S +proj=utm +zone=7 +south +ellps=intl +units=m +no_defs ",3303:"+title=Fatu Iva 72 / UTM zone 7S +proj=utm +zone=7 +south +ellps=intl +towgs84=347.103,1078.12,2623.92,-33.8875,70.6773,-9.3943,186.074 +units=m +no_defs ",3304:"+title=Tahiti 79 / UTM zone 6S +proj=utm +zone=6 +south +ellps=intl +units=m +no_defs ",3305:"+title=Moorea 87 / UTM zone 6S +proj=utm +zone=6 +south +ellps=intl +towgs84=215.525,149.593,176.229,-3.2624,-1.692,-1.1571,10.4773 +units=m +no_defs ",3306:"+title=Maupiti 83 / UTM zone 5S +proj=utm +zone=5 +south +ellps=intl +towgs84=217.037,86.959,23.956,0,0,0,0 +units=m +no_defs ",3312:"+title=CSG67 / UTM zone 21N +proj=utm +zone=21 +ellps=intl +towgs84=-186,230,110,0,0,0,0 +units=m +no_defs ",3313:"+title=RGFG95 / UTM zone 21N +proj=utm +zone=21 +ellps=GRS80 +towgs84=2,2,-2,0,0,0,0 +units=m +no_defs ",3336:"+title=IGN 1962 Kerguelen / UTM zone 42S +proj=utm +zone=42 +south +ellps=intl +towgs84=145,-187,103,0,0,0,0 +units=m +no_defs ",3395:"+title=WGS 84 / World Mercator +proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",3727:"+title=Reunion 1947 / TM Reunion +proj=tmerc +lat_0=-21.11666666666667 +lon_0=55.53333333333333 +k=1 +x_0=160000 +y_0=50000 +ellps=intl +units=m +no_defs ",21781:"+title=CH1903 / LV03 +proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +x_0=600000 +y_0=200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs ",25830:"+title=ETRS89 / UTM zone 30N +proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs ",25831:"+title=ETRS89 / UTM zone 31N +proj=utm +zone=31 +ellps=GRS80 +units=m +no_defs ",25832:"+title=ETRS89 / UTM zone 32N +proj=utm +zone=32 +ellps=GRS80 +units=m +no_defs ",27561:"+title=NTF (Paris) / Lambert Nord France +proj=lcc +lat_1=49.50000000000001 +lat_0=49.50000000000001 +lon_0=0 +k_0=0.999877341 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27562:"+title=NTF (Paris) / Lambert Centre France +proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27563:"+title=NTF (Paris) / Lambert Sud France +proj=lcc +lat_1=44.10000000000001 +lat_0=44.10000000000001 +lon_0=0 +k_0=0.9998774990000001 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27564:"+title=NTF (Paris) / Lambert Corse +proj=lcc +lat_1=42.16500000000001 +lat_0=42.16500000000001 +lon_0=0 +k_0=0.9999447100000001 +x_0=234.358 +y_0=185861.369 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27571:"+title=NTF (Paris) / Lambert zone I +proj=lcc +lat_1=49.50000000000001 +lat_0=49.50000000000001 +lon_0=0 +k_0=0.999877341 +x_0=600000 +y_0=1200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27572:"+title=NTF (Paris) / Lambert zone II +proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=2200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27573:"+title=NTF (Paris) / Lambert zone III +proj=lcc +lat_1=44.10000000000001 +lat_0=44.10000000000001 +lon_0=0 +k_0=0.9998774990000001 +x_0=600000 +y_0=3200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27574:"+title=NTF (Paris) / Lambert zone IV +proj=lcc +lat_1=42.16500000000001 +lat_0=42.16500000000001 +lon_0=0 +k_0=0.9999447100000001 +x_0=234.358 +y_0=4185861.369 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27581:"+title=NTF (Paris) / France I (deprecated) +proj=lcc +lat_1=49.50000000000001 +lat_0=49.50000000000001 +lon_0=0 +k_0=0.999877341 +x_0=600000 +y_0=1200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27582:"+title=NTF (Paris) / France II (deprecated) +proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=2200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27583:"+title=NTF (Paris) / France III (deprecated) +proj=lcc +lat_1=44.10000000000001 +lat_0=44.10000000000001 +lon_0=0 +k_0=0.9998774990000001 +x_0=600000 +y_0=3200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27584:"+title=NTF (Paris) / France IV (deprecated) +proj=lcc +lat_1=42.16500000000001 +lat_0=42.16500000000001 +lon_0=0 +k_0=0.9999447100000001 +x_0=234.358 +y_0=4185861.369 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27591:"+title=NTF (Paris) / Nord France (deprecated) +proj=lcc +lat_1=49.50000000000001 +lat_0=49.50000000000001 +lon_0=0 +k_0=0.999877341 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27592:"+title=NTF (Paris) / Centre France (deprecated) +proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27593:"+title=NTF (Paris) / Sud France (deprecated) +proj=lcc +lat_1=44.10000000000001 +lat_0=44.10000000000001 +lon_0=0 +k_0=0.9998774990000001 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27594:"+title=NTF (Paris) / Corse (deprecated) +proj=lcc +lat_1=42.16500000000001 +lat_0=42.16500000000001 +lon_0=0 +k_0=0.9999447100000001 +x_0=234.358 +y_0=185861.369 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",32601:"+proj=utm +zone=1 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32602:"+proj=utm +zone=2 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32603:"+proj=utm +zone=3 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32604:"+proj=utm +zone=4 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32605:"+proj=utm +zone=5 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32606:"+proj=utm +zone=6 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32607:"+proj=utm +zone=7 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32608:"+proj=utm +zone=8 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32609:"+proj=utm +zone=9 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32610:"+proj=utm +zone=10 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32611:"+proj=utm +zone=11 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32612:"+proj=utm +zone=12 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32613:"+proj=utm +zone=13 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32614:"+proj=utm +zone=14 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32615:"+proj=utm +zone=15 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32616:"+proj=utm +zone=16 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32617:"+proj=utm +zone=17 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32618:"+proj=utm +zone=18 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32619:"+proj=utm +zone=19 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32620:"+proj=utm +zone=20 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32621:"+proj=utm +zone=21 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32622:"+proj=utm +zone=22 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32623:"+proj=utm +zone=23 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32624:"+proj=utm +zone=24 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32625:"+proj=utm +zone=25 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32626:"+proj=utm +zone=26 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32627:"+proj=utm +zone=27 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32628:"+proj=utm +zone=28 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32629:"+proj=utm +zone=29 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32630:"+proj=utm +zone=30 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32631:"+proj=utm +zone=31 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32632:"+proj=utm +zone=32 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32633:"+proj=utm +zone=33 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32634:"+proj=utm +zone=34 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32635:"+proj=utm +zone=35 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32636:"+proj=utm +zone=36 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32637:"+proj=utm +zone=37 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32638:"+proj=utm +zone=38 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32639:"+proj=utm +zone=39 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32640:"+proj=utm +zone=40 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32641:"+proj=utm +zone=41 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32642:"+proj=utm +zone=42 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32643:"+proj=utm +zone=43 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32644:"+proj=utm +zone=44 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32645:"+proj=utm +zone=45 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32646:"+proj=utm +zone=46 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32647:"+proj=utm +zone=47 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32648:"+proj=utm +zone=48 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32649:"+proj=utm +zone=49 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32650:"+proj=utm +zone=50 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32651:"+proj=utm +zone=51 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32652:"+proj=utm +zone=52 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32653:"+proj=utm +zone=53 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32654:"+proj=utm +zone=54 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32655:"+proj=utm +zone=55 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32656:"+proj=utm +zone=56 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32657:"+proj=utm +zone=57 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32658:"+proj=utm +zone=58 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32659:"+proj=utm +zone=59 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32660:"+proj=utm +zone=60 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32661:"+proj=stere +lat_0=90 +lat_ts=90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32662:"+title=WGS 84 / Plate Carree +proj=eqc +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32701:"+proj=utm +zone=1 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32702:"+proj=utm +zone=2 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32703:"+proj=utm +zone=3 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32704:"+proj=utm +zone=4 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32705:"+proj=utm +zone=5 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32706:"+proj=utm +zone=6 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32707:"+proj=utm +zone=7 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32708:"+proj=utm +zone=8 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32709:"+proj=utm +zone=9 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32710:"+proj=utm +zone=10 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32711:"+proj=utm +zone=11 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32712:"+proj=utm +zone=12 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32713:"+proj=utm +zone=13 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32714:"+proj=utm +zone=14 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32715:"+proj=utm +zone=15 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32716:"+proj=utm +zone=16 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32717:"+proj=utm +zone=17 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32718:"+proj=utm +zone=18 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32719:"+proj=utm +zone=19 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32720:"+proj=utm +zone=20 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32721:"+proj=utm +zone=21 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32722:"+proj=utm +zone=22 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32723:"+proj=utm +zone=23 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32724:"+proj=utm +zone=24 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32725:"+proj=utm +zone=25 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32726:"+proj=utm +zone=26 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32727:"+proj=utm +zone=27 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32728:"+proj=utm +zone=28 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32729:"+proj=utm +zone=29 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32730:"+proj=utm +zone=30 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32731:"+proj=utm +zone=31 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32732:"+proj=utm +zone=32 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32733:"+proj=utm +zone=33 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32734:"+proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32735:"+proj=utm +zone=35 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32736:"+proj=utm +zone=36 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32737:"+proj=utm +zone=37 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32738:"+proj=utm +zone=38 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32739:"+proj=utm +zone=39 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32740:"+proj=utm +zone=40 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32741:"+proj=utm +zone=41 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32742:"+proj=utm +zone=42 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32743:"+proj=utm +zone=43 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32744:"+proj=utm +zone=44 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32745:"+proj=utm +zone=45 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32746:"+proj=utm +zone=46 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32747:"+proj=utm +zone=47 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32748:"+proj=utm +zone=48 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32749:"+proj=utm +zone=49 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32750:"+proj=utm +zone=50 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32751:"+proj=utm +zone=51 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32752:"+proj=utm +zone=52 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32753:"+proj=utm +zone=53 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32754:"+proj=utm +zone=54 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32755:"+proj=utm +zone=55 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32756:"+proj=utm +zone=56 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32757:"+proj=utm +zone=57 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32758:"+proj=utm +zone=58 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32759:"+proj=utm +zone=59 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32760:"+proj=utm +zone=60 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32761:"+proj=stere +lat_0=-90 +lat_ts=-90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",310024802:"+title=Geoportail - France metropolitaine +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=46.500000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310915814:"+title=Geoportail - Antilles francaises +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=15.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310486805:"+title=Geoportail - Guyane +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=4.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310700806:"+title=Geoportail - Reunion et dependances +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-21.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310702807:"+title=Geoportail - Mayotte +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-12.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310706808:"+title=Geoportail - Saint-Pierre et Miquelon +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=47.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310547809:"+title=Geoportail - Nouvelle-Caledonie +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-22.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310642810:"+title=Geoportail - Wallis et Futuna +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000,0.0000,0.0000,0.0000,0.000000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-14.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310032811:"+title=Geoportail - Polynesie francaise +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-15.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310642812:"+title=Geoportail - Kerguelen +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-49.500000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310642801:"+title=Geoportail - Crozet +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-46.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310642813:"+title=Geoportail - Amsterdam et Saint-Paul +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-38.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310642901:"+title=Geoportail - Monde +proj=mill +towgs84=0.0000,0.0000,0.0000,0.0000,0.0000,0.0000,0.000000 +a=6378137.0000 +rf=298.2572221010000 +lon_0=0.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",5489:"+title=RGAF09 geographiques (dms) +proj=longlat +nadgrids=@null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137 +rf=298.257222101 +units=m +no_defs",5490:"+title=RGAF09 UTM Nord Fuseau 20 +proj=tmerc +nadgrids=@null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137 +rf=298.257222101 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs"},CRS:{84:"+title=WGS 84 longitude-latitude +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs "},IGNF:{AMST63:"+title=Amsterdam 1963 +proj=geocent +towgs84=109.753,-528.133,-362.244,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",CROZ63:"+title=Crozet 1963 +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",CSG67:"+title=Guyane CSG67 +proj=geocent +towgs84=-193.0660,236.9930,105.4470,0.4814,-0.8074,0.1276,1.564900 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",ED50:"+title=ED50 +proj=geocent +towgs84=-84.0000,-97.0000,-117.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",ETRS89:"+title=Systeme de reference terrestre Europeen (1989) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",GUAD48:"+title=Guadeloupe Ste Anne +proj=geocent +towgs84=-472.2900,-5.6300,-304.1200,0.4362,-0.8374,0.2563,1.898400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",GUADFM49:"+title=Guadeloupe Fort Marigot +proj=geocent +towgs84=136.5960,248.1480,-429.7890 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",IGN63:"+title=IGN 1963 (Hiva Oa, Tahuata, Mohotani) +proj=geocent +towgs84=410.7210,55.0490,80.7460,-2.5779,-2.3514,-0.6664,17.331100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",IGN72:"+title=IGN 1972 Grande-Terre / Ile des Pins +proj=geocent +towgs84=-11.6400,-348.6000,291.6800 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",KERG62CAR:"+title=Kerguelen - K0 +proj=geocent +towgs84=144.8990,-186.7700,100.9230 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",MART38:"+title=Martinique Fort-Desaix +proj=geocent +towgs84=126.9260,547.9390,130.4090,-2.7867,5.1612,-0.8584,13.822650 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",MAYO50:"+title=Mayotte Combani +proj=geocent +towgs84=-599.9280,-275.5520,-195.6650,-0.0835,-0.4715,0.0602,49.281400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",MOOREA87:"+title=Moorea 1987 +proj=geocent +towgs84=215.9820,149.5930,176.2290,3.2624,1.6920,1.1571,10.477300 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",NTF:"+title=Nouvelle Triangulation Francaise +proj=geocent +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +units=m +no_defs",NUKU72:"+title=IGN 1972 Nuku Hiva +proj=geocent +towgs84=165.7320,216.7200,180.5050,-0.6434,-0.4512,-0.0791,7.420400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",REUN47:"+title=Reunion 1947 +proj=geocent +towgs84=789.5240,-626.4860,-89.9040,0.6006,76.7946,-10.5788,-32.324100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",RGF93:"+title=Reseau geodesique francais 1993 +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGFG95:"+title=Reseau geodesique francais de Guyane 1995 +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGM04:"+title=RGM04 (Reseau Geodesique de Mayotte 2004) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGNC:"+title=Reseau Geodesique de Nouvelle-Caledonie +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGPF:"+title=RGPF (Reseau Geodesique de Polynesie Francaise) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGR92:"+title=Reseau geodesique Reunion 1992 +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGSPM06:"+title=Reseau Geodesique Saint-Pierre-et-Miquelon (2006) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGTAAF07:"+title=Reseau Geodesique des TAAF (2007) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RRAF91:"+title=RRAF 1991 (Reseau de Reference des Antilles Francaises) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",STPL69:"+title=Saint-Paul 1969 +proj=geocent +towgs84=225.571,-346.608,-46.567,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",STPM50:"+title=St Pierre et Miquelon 1950 +proj=geocent +towgs84=-95.5930,573.7630,173.4420,-0.9602,1.2510,-1.3918,42.626500 +a=6378206.4000 +rf=294.9786982000000 +units=m +no_defs",TAHAA:"+title=Raiatea - Tahaa 51-54 (Tahaa, Base Terme Est) +proj=geocent +towgs84=72.4380,345.9180,79.4860,-1.6045,-0.8823,-0.5565,1.374600 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",TAHI79:"+title=IGN79 (Tahiti) Iles de la Societe +proj=geocent +towgs84=221.5250,152.9480,176.7680,2.3847,1.3896,0.8770,11.474100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",TERA50:"+title=Pointe Geologie - Perroud 1950 +proj=geocent +towgs84=324.9120,153.2820,172.0260 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",WALL78:"+title=Wallis-Uvea 1978 (MOP78) +proj=geocent +towgs84=253.0000,-133.0000,-127.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",WGS72:"+title=World Geodetic System 1972 +proj=geocent +towgs84=0.0000,12.0000,6.0000 +a=6378135.0000 +rf=298.2600000000000 +units=m +no_defs",WGS84:"+title=World Geodetic System 1984 +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",AMST63GEO:"+title=Amsterdam 1963 +proj=longlat +towgs84=109.753,-528.133,-362.244,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",CROZ63GEO:"+title=Crozet 1963 +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",CSG67GEO:"+title=Guyane CSG67 +proj=longlat +towgs84=-193.0660,236.9930,105.4470,0.4814,-0.8074,0.1276,1.564900 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",ED50G:"+title=ED50 +proj=longlat +towgs84=-84.0000,-97.0000,-117.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",GUAD48GEO:"+title=Guadeloupe Ste Anne +proj=longlat +towgs84=-472.2900,-5.6300,-304.1200,0.4362,-0.8374,0.2563,1.898400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",GUADFM49GEO:"+title=Guadeloupe Fort Marigot +proj=longlat +towgs84=136.5960,248.1480,-429.7890 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",IGN63GEO:"+title=IGN 1963 (Hiva Oa, Tahuata, Mohotani) +proj=longlat +towgs84=410.7210,55.0490,80.7460,-2.5779,-2.3514,-0.6664,17.331100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",IGN72GEO:"+title=IGN 1972 Grande-Terre / Ile des Pins +proj=longlat +towgs84=-11.6400,-348.6000,291.6800 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",KERG62GEO:"+title=Kerguelen - K0 +proj=longlat +towgs84=144.8990,-186.7700,100.9230 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",MART38GEO:"+title=Martinique Fort-Desaix +proj=longlat +towgs84=126.9260,547.9390,130.4090,-2.7867,5.1612,-0.8584,13.822650 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",MAYO50GEO:"+title=Mayotte Combani +proj=longlat +towgs84=-599.9280,-275.5520,-195.6650,-0.0835,-0.4715,0.0602,49.281400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",MOOREA87GEO:"+title=Moorea 1987 +proj=longlat +towgs84=215.9820,149.5930,176.2290,3.2624,1.6920,1.1571,10.477300 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",NTFG:"+title=Nouvelle Triangulation Francaise Greenwich degres sexagesimaux +proj=longlat +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +units=m +no_defs",NTFP:"+title=Nouvelle Triangulation Francaise Paris grades +proj=longlat +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +units=m +no_defs",NUKU72GEO:"+title=IGN 1972 Nuku Hiva +proj=longlat +towgs84=165.7320,216.7200,180.5050,-0.6434,-0.4512,-0.0791,7.420400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",REUN47GEO:"+title=Reunion 1947 +proj=longlat +towgs84=789.5240,-626.4860,-89.9040,0.6006,76.7946,-10.5788,-32.324100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",RGF93G:"+title=Reseau geodesique francais 1993 +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGFG95GEO:"+title=Reseau geodesique francais de Guyane 1995 +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGM04GEO:"+title=RGM04 (Reseau Geodesique de Mayotte 2004) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGNCGEO:"+title=Reseau Geodesique de Nouvelle-Caledonie +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGPFGEO:"+title=RGPF (Reseau Geodesique de Polynesie Francaise) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGR92GEO:"+title=Reseau geodesique de la Reunion 1992 +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGSPM06GEO:"+title=Saint-Pierre-et-Miquelon (2006) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGTAAF07G:"+title=Reseau Geodesique des TAAF (2007) (dms) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",STPL69GEO:"+title=Saint-Paul 1969 +proj=longlat +towgs84=225.571,-346.608,-46.567,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",STPM50GEO:"+title=St Pierre et Miquelon 1950  +proj=longlat +towgs84=-95.5930,573.7630,173.4420,-0.9602,1.2510,-1.3918,42.626500 +a=6378206.4000 +rf=294.9786982000000 +units=m +no_defs",TAHAAGEO:"+title=Raiatea - Tahaa 51-54 (Tahaa, Base Terme Est) +proj=longlat +towgs84=72.4380,345.9180,79.4860,-1.6045,-0.8823,-0.5565,1.374600 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",TAHI79GEO:"+title=IGN79 (Tahiti) Iles de la Societe +proj=longlat +towgs84=221.5250,152.9480,176.7680,2.3847,1.3896,0.8770,11.474100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",TERA50G:"+title=Pointe Geologie - Perroud 1950 +proj=longlat +towgs84=324.9120,153.2820,172.0260 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",WALL78GEO:"+title=Wallis - Uvea 1978 (MOP78) +proj=longlat +towgs84=253.0000,-133.0000,-127.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",WGS72G:"+title=WGS72 +proj=longlat +towgs84=0.0000,12.0000,6.0000 +a=6378135.0000 +rf=298.2600000000000 +units=m +no_defs",WGS84G:"+title=World Geodetic System 1984 +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",WGS84RRAFGEO:"+title=Reseau de reference des Antilles francaises (1988-1991) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",XGEO:"+title=Systeme CIO-BIH +proj=longlat +towgs84=0.0000,0.0000,0.5000,0.0000,0.0000,0.0140,-0.100000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",AMST63UTM43S:"+title=Amsterdam 1963 UTM fuseau 43 Sud +proj=tmerc +towgs84=109.753,-528.133,-362.244,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=75.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",CROZ63UTM39S:"+title=Crozet 1963 +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=51.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",CSG67UTM21:"+title=Guyane CSG67 UTM fuseau 21 +proj=tmerc +towgs84=-193.0660,236.9930,105.4470,0.4814,-0.8074,0.1276,1.564900 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-57.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",CSG67UTM22:"+title=Guyane CSG67 UTM fuseau 22 +proj=tmerc +towgs84=-193.0660,236.9930,105.4470,0.4814,-0.8074,0.1276,1.564900 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-51.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",GEOPORTALANF:"+title=Geoportail - Antilles francaises +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=15.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALASP:"+title=Geoportail - Amsterdam et Saint-Paul +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-38.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALCRZ:"+title=Geoportail - Crozet +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-46.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALFXX:"+title=Geoportail - France metropolitaine +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=46.500000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALGUF:"+title=Geoportail - Guyane +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=4.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALKER:"+title=Geoportail - Kerguelen +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-49.500000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALMYT:"+title=Geoportail - Mayotte +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-12.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALNCL:"+title=Geoportail - Nouvelle-Caledonie +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-22.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALPYF:"+title=Geoportail - Polynesie francaise +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-15.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALREU:"+title=Geoportail - Reunion et dependances +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-21.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALSPM:"+title=Geoportail - Saint-Pierre et Miquelon +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=47.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALWLF:"+title=Geoportail - Wallis et Futuna +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-14.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GUAD48UTM20:"+title=Guadeloupe Ste Anne +proj=tmerc +towgs84=-472.2900,-5.6300,-304.1200,0.4362,-0.8374,0.2563,1.898400 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",GUADFM49U20:"+title=Guadeloupe Fort Marigot  +proj=tmerc +towgs84=136.5960,248.1480,-429.7890 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",IGN63UTM7S:"+title=IGN 1963 - Hiva Oa, Tahuata, Mohotani - UTM fuseau 7 Sud +proj=tmerc +towgs84=410.7210,55.0490,80.7460,-2.5779,-2.3514,-0.6664,17.331100 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-141.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",IGN72UTM58S:"+title=IGN 1972 - UTM fuseau 58 Sud +proj=tmerc +towgs84=-11.6400,-348.6000,291.6800 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=165.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",KERG62UTM42S:"+title=Kerguelen 1962 +proj=tmerc +towgs84=144.8990,-186.7700,100.9230 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=69.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",LAMB1:"+title=Lambert I +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=49.500000000 +lon_0=0.000000000 +k_0=0.99987734 +lat_1=49.500000000 +x_0=600000.000 +y_0=200000.000 +units=m +no_defs",LAMB1C:"+title=Lambert I Carto +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=49.500000000 +lon_0=0.000000000 +k_0=0.99987734 +lat_1=49.500000000 +x_0=600000.000 +y_0=1200000.000 +units=m +no_defs",LAMB2:"+title=Lambert II +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=46.800000000 +lon_0=0.000000000 +k_0=0.99987742 +lat_1=46.800000000 +x_0=600000.000 +y_0=200000.000 +units=m +no_defs",LAMB2C:"+title=Lambert II Carto +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=46.800000000 +lon_0=0.000000000 +k_0=0.99987742 +lat_1=46.800000000 +x_0=600000.000 +y_0=2200000.000 +units=m +no_defs",LAMB3:"+title=Lambert III +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=44.100000000 +lon_0=0.000000000 +k_0=0.99987750 +lat_1=44.100000000 +x_0=600000.000 +y_0=200000.000 +units=m +no_defs",LAMB3C:"+title=Lambert III Carto +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=44.100000000 +lon_0=0.000000000 +k_0=0.99987750 +lat_1=44.100000000 +x_0=600000.000 +y_0=3200000.000 +units=m +no_defs",LAMB4:"+title=Lambert IV +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=42.165000000 +lon_0=0.000000000 +k_0=0.99994471 +lat_1=42.165000000 +x_0=234.358 +y_0=185861.369 +units=m +no_defs",LAMB4C:"+title=Lambert IV Carto +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=42.165000000 +lon_0=0.000000000 +k_0=0.99994471 +lat_1=42.165000000 +x_0=234.358 +y_0=4185861.369 +units=m +no_defs",LAMB93:"+title=Lambert 93 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=46.500000000 +lon_0=3.000000000 +lat_1=44.000000000 +lat_2=49.000000000 +x_0=700000.000 +y_0=6600000.000 +units=m +no_defs",RGF93CC42:"+title=Lambert conique conforme Zone 1 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=42.000000000 +lon_0=3.000000000 +lat_1=41.200000000 +lat_2=42.800000000 +x_0=1700000.000 +y_0=1200000.000 +units=m +no_defs",RGF93CC43:"+title=Lambert conique conforme Zone 2 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=43.000000000 +lon_0=3.000000000 +lat_1=42.200000000 +lat_2=43.800000000 +x_0=1700000.000 +y_0=2200000.000 +units=m +no_defs",RGF93CC44:"+title=Lambert conique conforme Zone 3 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=44.000000000 +lon_0=3.000000000 +lat_1=43.200000000 +lat_2=44.800000000 +x_0=1700000.000 +y_0=3200000.000 +units=m +no_defs",RGF93CC45:"+title=Lambert conique conforme Zone 4 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=45.000000000 +lon_0=3.000000000 +lat_1=44.200000000 +lat_2=45.800000000 +x_0=1700000.000 +y_0=4200000.000 +units=m +no_defs",RGF93CC46:"+title=Lambert conique conforme Zone 5 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=46.000000000 +lon_0=3.000000000 +lat_1=45.200000000 +lat_2=46.800000000 +x_0=1700000.000 +y_0=5200000.000 +units=m +no_defs",RGF93CC47:"+title=Lambert conique conforme Zone 6 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=47.000000000 +lon_0=3.000000000 +lat_1=46.200000000 +lat_2=47.800000000 +x_0=1700000.000 +y_0=6200000.000 +units=m +no_defs",RGF93CC48:"+title=Lambert conique conforme Zone 7 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=48.000000000 +lon_0=3.000000000 +lat_1=47.200000000 +lat_2=48.800000000 +x_0=1700000.000 +y_0=7200000.000 +units=m +no_defs",RGF93CC49:"+title=Lambert conique conforme Zone 8 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=49.000000000 +lon_0=3.000000000 +lat_1=48.200000000 +lat_2=49.800000000 +x_0=1700000.000 +y_0=8200000.000 +units=m +no_defs",RGF93CC50:"+title=Lambert conique conforme Zone 9 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=50.000000000 +lon_0=3.000000000 +lat_1=49.200000000 +lat_2=50.800000000 +x_0=1700000.000 +y_0=9200000.000 +units=m +no_defs",LAMBE:"+title=Lambert II etendu +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=46.800000000 +lon_0=0.000000000 +k_0=0.99987742 +lat_1=46.800000000 +x_0=600000.000 +y_0=2200000.000 +units=m +no_defs",MART38UTM20:"+title=Martinique Fort-Desaix +proj=tmerc +towgs84=126.9260,547.9390,130.4090,-2.7867,5.1612,-0.8584,13.822650 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",MAYO50UTM38S:"+title=Mayotte Combani +proj=tmerc +towgs84=-599.9280,-275.5520,-195.6650,-0.0835,-0.4715,0.0602,49.281400 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=45.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",MILLER:"+title=Geoportail - Monde +proj=mill +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lon_0=0.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",MOOREA87U6S:"+title=Moorea 1987 - UTM fuseau 6 Sud +proj=tmerc +towgs84=215.9820,149.5930,176.2290,3.2624,1.6920,1.1571,10.477300 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-147.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",NUKU72U7S:"+title=IGN 1972 Nuku Hiva - UTM fuseau 7 Sud +proj=tmerc +towgs84=165.7320,216.7200,180.5050,-0.6434,-0.4512,-0.0791,7.420400 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-141.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGM04UTM38S:"+title=UTM fuseau 38 Sud (Reseau Geodesique de Mayotte 2004) +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=45.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGNCUTM57S:"+title=Reseau Geodesique de Nouvelle-Caledonie - UTM fuseau 57 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=159.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGNCUTM58S:"+title=Reseau Geodesique de Nouvelle-Caledonie - UTM fuseau 58 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=165.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGNCUTM59S:"+title=Reseau Geodesique de Nouvelle-Caledonie - UTM fuseau 59 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=171.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGPFUTM5S:"+title=RGPF - UTM fuseau 5 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-153.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGPFUTM6S:"+title=RGPF - UTM fuseau 6 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-147.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGPFUTM7S:"+title=RGPF - UTM fuseau 7 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-141.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGR92UTM40S:"+title=RGR92 UTM fuseau 40 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=57.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGSPM06U21:"+title=Saint-Pierre-et-Miquelon (2006) UTM Fuseau 21 Nord +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-57.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",STPL69UTM43S:"+title=Saint-Paul 1969 UTM fuseau 43 Sud +proj=tmerc +towgs84=225.571,-346.608,-46.567,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=75.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",STPM50UTM21:"+title=St Pierre et Miquelon 1950 +proj=tmerc +towgs84=-95.5930,573.7630,173.4420,-0.9602,1.2510,-1.3918,42.626500 +a=6378206.4000 +rf=294.9786982000000 +lat_0=0.000000000 +lon_0=-57.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",TAHAAUTM05S:"+title=Tahaa 1951 +proj=tmerc +towgs84=72.4380,345.9180,79.4860,-1.6045,-0.8823,-0.5565,1.374600 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-153.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",TAHI51UTM06S:"+title=Tahiti-Terme Nord UTM fuseau 6 Sud +proj=tmerc +towgs84=162.0000,117.0000,154.0000 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-147.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",TAHI79UTM6S:"+title=Tahiti 1979 +proj=tmerc +towgs84=221.5250,152.9480,176.7680,2.3847,1.3896,0.8770,11.474100 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-147.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",TERA50STEREO:"+title=Terre Adelie 1950 +proj=stere +towgs84=324.9120,153.2820,172.0260 +a=6378388.0000 +rf=297.0000000000000 +lat_0=-90.000000000 +lon_0=140.000000000 +lat_ts=-67 +k=0.96027295 +x_0=300000.000 +y_0=-2299363.482 +units=m +no_defs",UTM01SW84:"+title=World Geodetic System 1984 UTM fuseau 01 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-177.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",UTM20W84GUAD:"+title=World Geodetic System 1984 UTM fuseau 20 Nord-Guadeloupe +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM20W84MART:"+title=World Geodetic System 1984 UTM fuseau 20 Nord-Martinique +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM22RGFG95:"+title=RGFG95 UTM fuseau 22 Nord-Guyane +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-51.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM39SW84:"+title=World Geodetic System 1984 UTM fuseau 39 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=51.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",UTM42SW84:"+title=World Geodetic System 1984 UTM fuseau 42 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=69.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",UTM43SW84:"+title=World Geodetic System 1984 UTM fuseau 43 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=75.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",WALL78UTM1S:"+title=Wallis-Uvea 1978 (MOP78) UTM 1 SUD +proj=tmerc +towgs84=253.0000,-133.0000,-127.0000 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-177.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",ETRS89GEO:"+title=ETRS89 geographiques (dms) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",ETRS89LAEA:"+title=ETRS89 Lambert Azimutal Equal Area +proj=laea +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=52.000000000 +lon_0=10.000000000 +x_0=4321000.000 +y_0=3210000.000 +units=m +no_defs",ETRS89LCC:"+title=ETRS89 Lambert Conformal Conic +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=52.000000000 +lon_0=9.999999995 +lat_1=35.000000000 +lat_2=65.000000000 +x_0=4000000.000 +y_0=2800000.000 +units=m +no_defs",UTM26ETRS89:"+title=Europe - de 30d a 24d Ouest +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-27.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM27ETRS89:"+title=Europe - de 24d a 18d Ouest +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-21.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM28ETRS89:"+title=Europe - de 18d a 12d Ouest +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-15.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM29ETRS89:"+title=Europe - de 12d a 6d Ouest +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-9.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM30ETRS89:"+title=Europe - de -6d a 0d Ouest +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-3.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM31ETRS89:"+title=Europe - de 0d a 6d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=3.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM32ETRS89:"+title=Europe - de 6d a 12d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=9.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM33ETRS89:"+title=Europe - de 12d a 18d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=15.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM34ETRS89:"+title=Europe - de 18d a 24d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=21.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM35ETRS89:"+title=Europe - de 24d a 30d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=27.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM36ETRS89:"+title=Europe - de 30d a 36d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=33.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM37ETRS89:"+title=Europe - de 36d a 42d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=39.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM38ETRS89:"+title=Europe - de 42d a 48d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=45.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs"}},logger$z=LoggerByDefault.getLogger("CRS"),CRS={projectionsExtent:{"EPSG:2154":{left:-9.62,bottom:41.18,right:10.3,top:51.54},"EPSG:27572":{left:-4.87,bottom:42.33,right:8.23,top:51.14}},load:function(){if(logger$z.trace("Loading custom definitions projections"),!Register.isLoaded){Register.load(proj4);try{register(proj4),window.ol&&window.ol.proj&&window.ol.proj.proj4&&(window.ol.proj.proj4.register=register,window.ol.proj.proj4.register(proj4))}catch(s){logger$z.error(s)}}},loadByDefault:function(){if(logger$z.trace("Loading custom definitions projections by default"),!Register.isLoaded){Register.loadByDefault(proj4);try{register(proj4),window.ol&&window.ol.proj&&window.ol.proj.proj4&&(window.ol.proj.proj4.register=register,window.ol.proj.proj4.register(proj4))}catch(s){logger$z.error(s)}}},loadByName:function(s){if(logger$z.trace("Loading a custom definition projection : ",s),!Register.isLoaded){Register.loadByName(proj4,s);try{register(proj4),window.ol&&window.ol.proj&&window.ol.proj.proj4&&(window.ol.proj.proj4.register=register,window.ol.proj.proj4.register(proj4))}catch(e){logger$z.error(e)}}},overload:function(){logger$z.trace("Loading projections aera (extent)");for(var s in this.projectionsExtent)if(this.projectionsExtent.hasOwnProperty(s)){var e=this.projectionsExtent[s],i=get$3(s),n=getTransform("EPSG:4326",i),o=applyTransform([e.bottom,e.right,e.top,e.left],n);i.setExtent(o),addProjection(i),window.ol&&window.ol.proj&&window.ol.proj.addProjection&&window.ol.proj.addProjection(i)}}};window.ol&&window.ol.proj&&window.ol.proj.proj4&&(window.ol.proj.proj4.register=register);let m_suggestions=[],controller=new AbortController,m_index="geoplateforme",m_fields="title,layer_name",m_size="1000",m_maximumResponses=10,m_filterByService=["WMTS","TMS"],m_filterByProjection=[],m_filterByLayerPriority=[],m_filterWMTSPriority=!1,m_filterTMS=!0,m_url=`https://data.geopf.fr/recherche/api/indexes/${m_index}/suggest`;const target=new EventTarget,suggest=async s=>{clear(),controller=new AbortController;let e=new URL(m_url),i={text:s,fields:m_fields,size:m_size};Object.keys(i).forEach(h=>e.searchParams.append(h,i[h]));var n=await fetch(e,{}),o=await n.json();if(n.status!==200)throw new Error(n.message);if(!(!o||o.length===0)){for(let h=0;h<o.length;h++){const f=o[h];m_filterByLayerPriority.findIndex(H=>H.includes(f.source.layer_name))>=0&&(o[h].score+=100)}o.sort((h,f)=>f.score-h.score);var l=null;m_filterWMTSPriority&&(l=inventory(o));for(let h=0;h<o.length;h++){const f=o[h];var c=m_filterByService.length===0||m_filterByService.includes(f.source.type);if(c){if(unique().length>=m_maximumResponses)break;var u={attribution:f.source.attribution||{},srs:f.source.srs||[],keywords:f.source.keywords||[],extent:f.source.extent||{},metadata:f.source.metadata_urls||[],name:f.source.layer_name||"",title:f.source.title||"",description:f.source.description,service:f.source.type||"",url:f.source.url||"",tech:f.source.tech||{},tags:f.source.tags||{},theme:f.source.theme||"",producer:f.source.producer||""};if(m_filterByProjection.length&&m_filterByProjection.includes(u.srs[0])||l&&l[u.name]&&u.service==="WMS"||u.service==="TMS"&&(u.styles=!1,u.metadata.length!==0&&/(\.json)$/i.test(u.metadata[0])&&(u.styles=!0),!u.styles&&m_filterTMS)||u.service==="WMTS"&&u.metadata.length!==0&&/(.json)$/i.test(u.metadata[0])&&m_filterTMS===!0)continue;m_suggestions.push(u)}}return target.dispatchEvent(new CustomEvent("suggest",{bubbles:!0,detail:getSuggestions()})),getSuggestions()}},unique=()=>m_suggestions.filter((s,e,i)=>e===i.findIndex(n=>n.service===s.service&&n.name===s.name&&n.title===s.title&&n.description===s.description)),clear=()=>{controller.abort(),m_suggestions=[]},inventory=s=>{var e={};for(let i=0;i<s.length;i++){const n=s[i].source.type,o=s[i].source.layer_name;(n==="WMTS"||n==="WMS")&&(e[o]===void 0&&(e[o]=n==="WMTS"),e[o]||(e[o]=n==="WMTS"))}return e},getSuggestions=()=>unique(),getNames=()=>unique().map(s=>s.name),getTitles=()=>unique().map(s=>s.title),setIndex=s=>{m_index=s},setFields=s=>{m_fields=s},setSuggestions=s=>{m_suggestions=s},setSize=s=>{m_size=parseInt(s)},setUrl=value=>{m_url=eval("`"+value+"`")},setMaximumResponses=s=>{m_maximumResponses=parseInt(s)},setFiltersByService=s=>{m_filterByService=s===""?[]:s.split(",")},setFiltersByProjection=s=>{m_filterByProjection=s===""?[]:s.split(",")},setFiltersByLayerPriority=s=>{m_filterByLayerPriority=s===""?[]:s.split(",")},setFilterWMTSPriority=s=>{m_filterWMTSPriority=s},setFilterTMS=s=>{m_filterTMS=s},Search$1={target,suggest,clear,getSuggestions,getNames,getTitles,setIndex,setFields,setSuggestions,setSize,setUrl,setMaximumResponses,setFiltersByService,setFiltersByProjection,setFiltersByLayerPriority,setFilterWMTSPriority,setFilterTMS};var SearchEngineDOM={_addUID:function(s){var e=this._uid?s+"-"+this._uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPsearchEngine"),s.className="GPwidget gpf-widget",s},_createSearchDivElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPshowSearchDiv"),s},_createShowSearchEnginePictoElement:function(s){var e=this;checkDsfr()&&(s=!0);var i=document.createElement("button");return i.id=this._addUID("GPshowSearchEnginePicto"),i.className="GPshowOpen GPshowAdvancedToolPicto GPshowSearchEnginePicto gpf-btn gpf-btn-icon-search fr-btn",i.title="Afficher/masquer la recherche par lieux",checkDsfr()&&(i.title="Rechercher"),i.setAttribute("tabindex","0"),i.setAttribute("aria-pressed",!s),i.disabled=!s,i.setAttribute("type","button"),i.addEventListener("click",function(n){if(checkDsfr()){var o=document.getElementById(e._addUID("GPautocompleteResults")),l=o.getElementsByClassName("GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine current"),c=o.getElementsByClassName("GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine"),u=c.length;if(!u)return;var h=null;l.length?h=l[0]:(h=c[0],h.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine current",h.style.color="#000000",h.style["background-color"]="#CEDBEF"),h.click();return}var f=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!f),document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden"),document.getElementById(e._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(e._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden");var g=document.getElementById(e._addUID("GPshowAdvancedSearch"));g&&(g.style.display=null,document.getElementById(e._addUID("GPadvancedSearchPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(e._addUID("GPadvancedSearchPanel")).classList.replace("gpf-visible","gpf-hidden"));var H=document.getElementById(e._addUID("GPshowGeolocate"));H&&(H.style.display=null);var Y=document.getElementById(e._addUID("GPshowSearchByCoordinate"));Y&&(Y.style.display=null);var ee="#GPsearchInput-"+e._uid;document.querySelector(ee+" input").disabled=!1,checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+e._uid).disabled=!1),e.onShowSearchEngineClick(n)}),i},_createSearchInputElement:function(s){var e=this,i=document.createElement("form");i.id=this._addUID("GPsearchInput"),i.className="gpf-panel__content fr-modal__content",i.addEventListener("submit",function(l){return l.preventDefault(),document.getElementById(e._addUID("GPsearchInputText")).value===""||(document.getElementById(e._addUID("GPgeocodeResultsList")).classList.replace("GPelementHidden","GPelementVisible"),document.getElementById(e._addUID("GPgeocodeResultsList")).classList.replace("gpf-hidden","gpf-visible"),document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden"),e.onGeocodingSearchSubmit(l)),!1});var n=document.createElement("input");n.id=this._addUID("GPsearchInputText"),n.className="GPsearchInputText gpf-input fr-input",n.type="text",n.placeholder=s,n.autocomplete="off",n.addEventListener("keyup",function(l){var c=l.which||l.keyCode;c===13||c===10||c===38||c===40||(document.getElementById(e._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(e._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden"),n.value.length>2?(document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("GPelementHidden","GPelementVisible"),document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("gpf-hidden","gpf-visible")):(document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden")),e.onAutoCompleteSearchText(l))});var o=null;return document.addEventListener("pointerdown",function(l){o=l.target}),n.addEventListener("blur",function(l){o.classList.contains("GPautoCompleteProposal")||(document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden"))}),n.addEventListener("keydown",function(l){var c=l.which||l.keyCode;c===13&&l.preventDefault();var u=document.getElementById(e._addUID("GPautocompleteResults"));if(u){var h=u.getElementsByClassName("GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine current"),f=u.getElementsByClassName("GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine"),g=f.length;if(g){var H=null;if(h.length)H=h[0];else if(H=f[0],H.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine current",H.style.color="#000000",H.style["background-color"]="#CEDBEF",c!==13)return;var Y=parseInt(SelectorID.index(H.id),10),ee=Y===g-1?f[0]:f[Y+1],te=Y===0?f[g-1]:f[Y-1];switch(H.style["background-color"]="",H.style.color="",te.style["background-color"]="",te.style.color="",ee.style["background-color"]="",ee.style.color="",c){case 38:H.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine",te.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine current",te.style.color="#000000",te.style["background-color"]="#CEDBEF",H.scrollIntoView();break;case 40:H.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine",ee.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine current",ee.style.color="#000000",ee.style["background-color"]="#CEDBEF",H.scrollIntoView();break;case 13:l.preventDefault(),H.click(l);break}H.focus()}}}),i.appendChild(n),i},_createSearchResetElement:function(){var s=this,e=document.createElement("button");return e.id=this._addUID("GPsearchInputReset"),e.className="GPshowOpen GPsearchInputReset gpf-btn gpf-btn-icon-reset gpf-btn-icon-search-reset fr-btn fr-btn--secondary gpf-btn--secondary",e.setAttribute("aria-label","Supprimer la recherche"),e.addEventListener("click",function(i){document.getElementById(s._addUID("GPsearchInputText")).value="",document.getElementById(s._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden"),document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden"),s.onSearchResetClick()}),e},_createButtonsElement:function(){var s=document.createElement("div");return s.className="GPbuttonsContainer",s},_createFirstLineWrapper:function(){var s=document.createElement("div");return s.className="GPsearchFirstLineWrapper",s},_createRadioContainer:function(){var s=document.createElement("div");return s.className="GPsearchRadioContainer",s},_createRadioElements:function(){var s=document.createElement("div");s.className="GPsearchRadioElements";var e=document.createElement("div");e.className="GPsearchSplitChoice gpf-flex gpf-radio-group fr-radio-group fr-my-1w";var i=document.createElement("input");i.id=this._addUID("GPsearchSplitLocations"),i.type="radio",i.name="GPsearchSplit",i.value="address",i.checked=!0,e.appendChild(i);var n=document.createElement("label");n.className="gpf-label fr-label",n.htmlFor=this._addUID("GPsearchSplitLocations"),n.title="Adresses",n.innerHTML="Adresses",e.appendChild(n),i.addEventListener?i.addEventListener("change",function(){i.checked?(document.querySelector("[id^='GPautocompleteResultsSuggest']").classList.add("gpf-hidden","GPelementHidden"),document.querySelector("[id^='GPautocompleteResultsLocation']").classList.remove("gpf-hidden","GPelementHidden")):(document.querySelector("[id^='GPautocompleteResultsSuggest']").classList.remove("gpf-hidden","GPelementHidden"),document.querySelector("[id^='GPautocompleteResultsLocation']").classList.add("gpf-hidden","GPelementHidden"))}):i.attachEvent&&i.attachEvent("onchange",function(){i.checked?(document.querySelector("[id^='GPautocompleteResultsSuggest']").classList.add("gpf-hidden","GPelementHidden"),document.querySelector("[id^='GPautocompleteResultsLocation']").classList.remove("gpf-hidden","GPelementHidden")):(document.querySelector("[id^='GPautocompleteResultsSuggest']").classList.remove("gpf-hidden","GPelementHidden"),document.querySelector("[id^='GPautocompleteResultsLocation']").classList.add("gpf-hidden","GPelementHidden"))});var o=document.createElement("div");o.className="GPsearchSplitChoice gpf-flex gpf-radio-group fr-radio-group fr-my-1w";var l=document.createElement("input");l.id=this._addUID("GPsearchSplitData"),l.type="radio",l.name="GPsearchSplit",l.value="data",o.appendChild(l);var c=document.createElement("label");return c.className="gpf-label fr-label",c.htmlFor=this._addUID("GPsearchSplitData"),c.title="Cartes et donnes",c.innerHTML="Cartes et donnes",o.appendChild(c),l.addEventListener?l.addEventListener("change",function(){l.checked?(document.querySelector("[id^='GPautocompleteResultsSuggest']").classList.remove("gpf-hidden","GPelementHidden"),document.querySelector("[id^='GPautocompleteResultsLocation']").classList.add("gpf-hidden","GPelementHidden")):(document.querySelector("[id^='GPautocompleteResultsSuggest']").classList.add("gpf-hidden","GPelementHidden"),document.querySelector("[id^='GPautocompleteResultsLocation']").classList.remove("gpf-hidden","GPelementHidden"))}):l.attachEvent&&l.attachEvent("onchange",function(){l.checked?(document.querySelector("[id^='GPautocompleteResultsSuggest']").classList.remove("gpf-hidden","GPelementHidden"),document.querySelector("[id^='GPautocompleteResultsLocation']").classList.remove("gpf-hidden","GPelementHidden")):(document.querySelector("[id^='GPautocompleteResultsSuggest']").classList.remove("gpf-hidden","GPelementHidden"),document.querySelector("[id^='GPautocompleteResultsLocation']").classList.add("gpf-hidden","GPelementHidden"))}),s.appendChild(e),s.appendChild(o),[s,i,l]},_createShowAdvancedSearchElement:function(){var s=this,e=document.createElement("button");return e.id=this._addUID("GPshowAdvancedSearch"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowAdvancedSearch GPshowOpen gpf-btn gpf-btn-icon-search-advanced fr-btn fr-btn--secondary gpf-btn--secondary fr-m-1w",e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.addEventListener("click",function(i){var n=i.target.ariaPressed==="true";i.target.setAttribute("aria-pressed",!n);var o="#GPsearchInput-"+s._uid;n?(document.getElementById(s._addUID("GPadvancedSearchPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPadvancedSearchPanel")).classList.replace("gpf-visible","gpf-hidden"),document.querySelector(o+" input").disabled=!1,document.querySelector(o+" .GPsearchInputReset")&&(document.querySelector(o+" .GPsearchInputReset").disabled=!1),checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+s._uid).disabled=!1)):(document.getElementById(s._addUID("GPadvancedSearchPanel")).classList.replace("GPelementHidden","GPelementVisible"),document.getElementById(s._addUID("GPadvancedSearchPanel")).classList.replace("gpf-hidden","gpf-visible"),document.querySelector(o+" input").disabled=!0,document.querySelector(o+" .GPsearchInputReset")&&(document.querySelector(o+" .GPsearchInputReset").disabled=!0),checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+s._uid).disabled=!0)),document.getElementById(s._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden"),document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden");var l=document.getElementById(s._addUID("GPcoordinateSearchPanel"));l&&(l.classList.replace("GPelementVisible","GPelementHidden"),l.classList.replace("gpf-visible","gpf-hidden"));var c=document.getElementById(s._addUID("GPshowSearchByCoordinate"));c&&c.setAttribute("aria-pressed",!1)}),e},_createShowGeolocateElement:function(){var s=this,e=document.createElement("button");return e.id=this._addUID("GPshowGeolocate"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowGeolocate gpf-btn gpf-btn-icon-search-geolocate fr-btn fr-btn--secondary gpf-btn--secondary fr-m-1w",e.title="Activer la golocalisation",e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.addEventListener("click",function(i){var n=i.target.ariaPressed==="true";i.target.setAttribute("aria-pressed",!n),s.onShowSearchGeolocateClick(i)}),e},_createShowSearchByCoordinateElement:function(){var s=this,e=document.createElement("button");return e.id=this._addUID("GPshowSearchByCoordinate"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowSearchByCoordinate gpf-btn gpf-btn-icon-search-coordinate fr-btn fr-btn--secondary gpf-btn--secondary fr-m-1w",e.title="Ouvrir la recherche par coordonnes",e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.addEventListener("click",function(i){var n=i.target.ariaPressed==="true";i.target.setAttribute("aria-pressed",!n);var o="#GPsearchInput-"+s._uid;n?(document.getElementById(s._addUID("GPcoordinateSearchPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPcoordinateSearchPanel")).classList.replace("gpf-visible","gpf-hidden"),document.querySelector(o+" input").disabled=!1,document.querySelector(o+" .GPsearchInputReset").disabled=!1,checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+s._uid).disabled=!1)):(document.getElementById(s._addUID("GPcoordinateSearchPanel")).classList.replace("GPelementHidden","GPelementVisible"),document.getElementById(s._addUID("GPcoordinateSearchPanel")).classList.replace("gpf-hidden","gpf-visible"),document.querySelector(o+" input").disabled=!0,document.querySelector(o+" .GPsearchInputReset").disabled=!0,checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+s._uid).disabled=!0)),document.getElementById(s._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden"),document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden"),document.getElementById(s._addUID("GPadvancedSearchPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPadvancedSearchPanel")).classList.replace("gpf-visible","gpf-hidden"),document.getElementById(s._addUID("GPshowAdvancedSearch")).setAttribute("aria-pressed",!1)}),e},_createAdvancedSearchPanelElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPadvancedSearchPanel"),s.className="GPpanel GPelementHidden gpf-panel gpf-hidden fr-modal",s},_createAdvancedSearchPanelDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__body fr-modal__body",s},_createGeocodeResultsElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPgeocodeResultsList"),s.className="GPpanel GPelementHidden gpf-panel gpf-hidden fr-modal",s},_createGeocodeResultsDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__body fr-modal__body",s.appendChild(this._createGeocodeResultsHeaderElement()),s},_createAutoCompleteElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPautoCompleteList"),s.className="GPautoCompleteList GPelementHidden gpf-panel fr-modal gpf-hidden ",s},_createCoordinateSearchPanelElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPcoordinateSearchPanel"),s.className="GPpanel GPelementHidden gpf-panel gpf-hidden fr-modal",s},_createCoordinateSearchPanelDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__body fr-modal__body",s},_createAutoCompleteListElement:function(){var s=this,e=document.createElement("div");return e.id=this._addUID("GPautocompleteResults"),e.className="",e.addEventListener?e.addEventListener("click",function(i){document.getElementById(s._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden")},!1):e.attachEvent&&e.attachEvent("onclick",function(i){document.getElementById(s._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden")}),e},_createAutoCompletedLocationContainer(){var s=document.createElement("div");return s.id=this._addUID("GPautocompleteResultsLocation"),s.className="GPelementHidden gpf-hidden gpf-select",s.size=20,s.autofocus=!0,s},_createAutoCompletedLocationTitleElement(){var s=document.getElementById(this._addUID("GPautocompleteResultsLocation")),e=document.createElement("p");e.className="GPlabel GPlabelTitle gpf-label fr-label search-results-loc",e.innerHTML="Lieux et adresses",s.appendChild(e)},_createAutoCompletedLocationElement:function(s,e){var i=this,n=document.getElementById(this._addUID("GPautocompleteResultsLocation")),o=document.createElement("p");o.id=this._addUID("AutoCompletedLocation_"+e),o.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine";var l=GeocodeUtils.getSuggestedLocationFreeform(s);o.innerHTML=l,o.title=l,o.addEventListener?o.addEventListener("click",function(c){i.onAutoCompletedResultsItemClick(c)},!1):o.attachEvent&&o.attachEvent("onclick",function(c){i.onAutoCompletedResultsItemClick(c)}),n.appendChild(o)},_createSearchedSuggestContainer(){var s=document.createElement("div");return s.id=this._addUID("GPautocompleteResultsSuggest"),s.className="GPelementHidden gpf-hidden gpf-select",s.size=6,s.autofocus=!0,s},_createSearchedSuggestTitleElement(){var s=document.getElementById(this._addUID("GPautocompleteResultsSuggest")),e=document.createElement("p");e.className="GPlabel GPlabelTitle gpf-label fr-label search-results-data",e.innerHTML="Cartes et donnes",s.appendChild(e)},_createSearchedSuggestElement:function(s,e){var i=this,n=document.getElementById(this._addUID("GPautocompleteResultsSuggest")),o=document.createElement("p");o.id=this._addUID("AutoCompletedSuggest_"+e),o.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine",o.innerHTML=s.title+" ("+s.service+")",o.dataset.layer=s.name,o.title=`${s.description} (nom technique : ${s.name})`,o.addEventListener?o.addEventListener("click",function(l){i.onSearchedResultsItemClick(l)},!1):o.attachEvent&&o.attachEvent("onclick",function(l){i.onSearchedResultsItemClick(l)}),n.appendChild(o)},_createAdvancedSearchPanelHeaderElement:function(){var s=this,e=document.createElement("div");e.className="GPpanelHeader gpf-panel__header fr-modal__header";var i=document.createElement("div");i.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",i.innerHTML="Recherche avance",e.appendChild(i);var n=document.createElement("button");n.id=this._addUID("GPadvancedSearchClose"),n.className="GPpanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",n.title="Fermer la recherche avance",n.addEventListener?n.addEventListener("click",function(){var l="#GPsearchInput-"+s._uid;document.querySelector(l+" input").disabled=!1,document.querySelector(l+" .GPsearchInputReset")&&(document.querySelector(l+" .GPsearchInputReset").disabled=!1),checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+s._uid).disabled=!1),document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden"),document.getElementById(s._addUID("GPshowAdvancedSearch")).setAttribute("aria-pressed",!1),document.getElementById(s._addUID("GPadvancedSearchPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPadvancedSearchPanel")).classList.replace("gpf-visible","gpf-hidden")},!1):n.attachEvent&&n.attachEvent("onclick",function(){var l="#GPsearchInput-"+s._uid;document.querySelector(l+" input").disabled=!1,document.querySelector(l+" .GPsearchInputReset")&&(document.querySelector(l+" .GPsearchInputReset").disabled=!1),checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+s._uid).disabled=!1),document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden"),document.getElementById(s._addUID("GPshowAdvancedSearch")).setAttribute("aria-pressed",!1),document.getElementById(s._addUID("GPadvancedSearchPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPadvancedSearchPanel")).classList.replace("gpf-visible","gpf-hidden")});var o=document.createElement("span");return o.className="GPelementHidden gpf-visible",o.innerText="Fermer",n.appendChild(o),e.appendChild(n),e},_createAdvancedSearchPanelFormElement:function(s,e){var i=this,n=document.createElement("form");n.id=this._addUID("GPadvancedSearchForm"),n.className="gpf-panel__content fr-modal__content",n.addEventListener("submit",function(u){u.preventDefault();for(var h=[],f="#GPadvancedSearchFilters-"+i._uid,g=document.querySelectorAll(f+" > div > div > input,select#category"),H=0;H<g.length;H++){var Y=g[H];h.push({key:Y.name,value:Y.value})}return i.onGeocodingAdvancedSearchSubmit(u,h),document.getElementById(i._addUID("GPgeocodeResultsList")).classList.replace("GPelementHidden","GPelementVisible"),document.getElementById(i._addUID("GPgeocodeResultsList")).classList.replace("gpf-hidden","gpf-visible"),!1});var o=document.createElement("div");o.className="GPflexInput gpf-flex-column ";var l=document.createElement("label");l.className="GPadvancedSearchCodeLabel gpf-label fr-label",l.innerHTML="Recherche par",o.appendChild(l);var c=this._createAdvancedSearchFormCodeElement(s,e);return o.appendChild(c),n.appendChild(o),n},_createAdvancedSearchFormCodeElement:function(s,e){var i=this,n=document.createElement("select");n.id=this._addUID("GPadvancedSearchCode"),n.title="Choisir un type de recherche",n.className="GPadvancedSearchCode gpf-select fr-select",n.addEventListener("change",function(c){i.onGeocodingAdvancedSearchCodeChange(c)},!1),s||(s=[{id:"PositionOfInterest",title:"Lieux/toponymes"},{id:"StreetAddress",title:"Adresses"},{id:"CadastralParcel",title:"Parcelles cadastrales"}]);for(var o=0;o<s.length;o++){var l=document.createElement("option");l.value=s[o].id,l.text=s[o].title,n.appendChild(l)}if(e){var l=document.createElement("option");l.value="Coordinates",l.text="Coordonnes",n.appendChild(l)}return n},_createAdvancedSearchFormInputElement:function(){var s=document.createElement("input");return s.type="submit",s.id=this._addUID("GPadvancedSearchSubmit"),s.className="GPsubmit gpf-btn gpf-btn-icon-submit  fr-btn fr-btn--secondary gpf-btn--secondary",s.value="Chercher",s},_createAdvancedSearchFormFiltersElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPadvancedSearchFilters"),s},_createAdvancedSearchFiltersTableElement:function(s,e){var i=document.createElement("div");return i.id=this._addUID(s),e||(i.style.display="none"),i},_createAdvancedSearchFiltersAttributElement:function(s){var e=null,i=s.name,n=s.title,o=s.description,l=s.code,c=s.value,u=document.createElement("div");u.className="GPflexInput gpf-flex-column ";var h=document.createElement("label");if(h.className="GPadvancedSearchFilterLabel gpf-label fr-label",h.htmlFor=i,h.title=o||n,h.innerHTML=n,u.appendChild(h),i==="category"){var f=document.createElement("select");if(f.id=i,f.name=i,f.title=n,f.className="GPadvancedSearchFilterInput gpf-select fr-select",c&&Array.isArray(c))for(var g=0;g<c.length;g++){var H=document.createElement("option");H.value=c[g],H.text=c[g],f.appendChild(H)}u.appendChild(f)}else{var Y=document.createElement("input");if(Y.id=i,Y.className="GPadvancedSearchFilterInput gpf-input fr-input",Y.type="text",Y.name=i,c)if(Array.isArray(c)){var ee=i+"_list";Y.setAttribute("list",ee);var te=document.createElement("datalist");te.id=ee;for(var g=0;g<c.length;++g){var H=document.createElement("option");H.value=c[g],te.appendChild(H)}u.appendChild(te)}else Y.value=c;u.appendChild(Y)}return e=document.getElementById(this._addUID(l)),e?e.appendChild(u):e=u,e},_createGeocodeResultsHeaderElement:function(){var s=this,e=document.createElement("div");e.className="GPpanelHeader gpf-panel__header fr-modal__header";var i=document.createElement("div");i.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",i.innerHTML="Rsultats de la recherche",e.appendChild(i);var n=document.createElement("button");n.id=this._addUID("GPgeocodeResultsClose"),n.className="GPpanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",n.title="Fermer la fentre de rsultats",n.addEventListener?n.addEventListener("click",function(){document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden")},!1):n.attachEvent&&n.attachEvent("onclick",function(){document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden")});var o=document.createElement("span");return o.className="GPelementHidden gpf-visible",o.innerText="Fermer",n.appendChild(o),e.appendChild(n),e},_createGeocodeResultsListElement:function(){var s=this,e=document.createElement("div");return e.id=this._addUID("GPgeocodeResults"),e.className="gpf-panel__list",e.setAttribute("tabindex","0"),e.addEventListener?e.addEventListener("click",function(i){i.ctrlKey||(document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden")),s.onGeocodedResultsItemClick(i)},!1):e.attachEvent&&e.attachEvent("onclick",function(i){i.ctrlKey||(document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden")),s.onGeocodedResultsItemClick(i)}),e},_createGeocodedLocationElement:function(s,e){var i=document.getElementById(this._addUID("GPgeocodeResults")),n=document.createElement("div");n.id=this._addUID("GeocodedLocation_"+e),n.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine",typeof s=="string"?n.innerHTML=s:n.innerHTML=GeocodeUtils.getGeocodedLocationFreeform(s),i.appendChild(n)},_createCoordinateSearchPanelHeaderElement(){var s=this,e=document.createElement("div");e.className="GPpanelHeader gpf-panel__header fr-modal__header";var i=document.createElement("div");i.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",i.innerHTML="Recherche par coordonnes",e.appendChild(i);var n=document.createElement("button");n.id=this._addUID("GPcoordinateSearchClose"),n.className="GPpanelClose GPcoordinateSearchClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",n.title="Fermer la recherche par coordonnes",n.addEventListener?n.addEventListener("click",function(){var l="#GPsearchInput-"+s._uid;document.querySelector(l+" input").disabled=!1,document.querySelector(l+" .GPsearchInputReset")&&(document.querySelector(l+" .GPsearchInputReset").disabled=!1),checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+s._uid).disabled=!1),document.getElementById(s._addUID("GPshowSearchByCoordinate")).setAttribute("aria-pressed",!1),document.getElementById(s._addUID("GPcoordinateSearchPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPcoordinateSearchPanel")).classList.replace("gpf-visible","gpf-hidden"),s.onCoordinateSearchClose()},!1):n.attachEvent&&n.attachEvent("onclick",function(){var l="#GPsearchInput-"+s._uid;document.querySelector(l+" input").disabled=!1,document.querySelector(l+" .GPsearchInputReset")&&(document.querySelector(l+" .GPsearchInputReset").disabled=!1),checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+s._uid).disabled=!1),document.getElementById(s._addUID("GPshowSearchByCoordinate")).setAttribute("aria-pressed",!1),document.getElementById(s._addUID("GPcoordinateSearchPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPcoordinateSearchPanel")).classList.replace("gpf-visible","gpf-hidden"),s.onCoordinateSearchClose()});var o=document.createElement("span");return o.className="GPelementHidden gpf-visible",o.innerText="Fermer",n.appendChild(o),e.appendChild(n),e},_createCoordinateSearchPanelFormElement(){var s=this,e=document.createElement("form");return e.id=this._addUID("GPcoordinateSearchForm"),e.className="gpf-panel__content fr-modal__content",e.addEventListener("submit",function(i){return i.preventDefault(),s.onShowSearchByCoordinateClick(),!1}),e},__createCoordinateSearchDivElement(){var s=document.createElement("div");return s.className="GPflexInput gpf-flex-column ",s},_createCoordinateSearchSystemsLabelElement(){var s=document.createElement("label");return s.className="GPcoordinateSearchSystemsLabel gpf-label fr-label",s.innerHTML="Systme de rfrence",s},_setCoordinateSearchSystemsSelectElement(s){document.getElementById(this._addUID("GPcoordinateSearchSystem"))&&document.getElementById(this._addUID("GPcoordinateSearchSystem")).remove();var e=this,i=document.createElement("select");i.id=this._addUID("GPcoordinateSearchSystem"),i.title="Choisir un systme de rference",i.className="GPselect GPcoordinateSearchSystemsSelect gpf-select fr-select",i.addEventListener("change",function(c){e.onCoordinateSearchSystemChange(c)});for(var n=0;n<s.length;n++){var o=s[n],l=document.createElement("option");l.value=o.code,l.text=o.label||n,i.appendChild(l)}return i},_createCoordinateSearchUnitsLabelElement(){var s=document.createElement("label");return s.className="GPcoordinateSearchUnitsLabel gpf-label fr-label",s.innerHTML="Units",s},_setCoordinateSearchUnitsSelectElement(s){document.getElementById(this._addUID("GPcoordinateSearchUnits"))&&document.getElementById(this._addUID("GPcoordinateSearchUnits")).remove();var e=this,i=document.createElement("select");i.id=this._addUID("GPcoordinateSearchUnits"),i.title="Choisir un type d'unit",i.className="GPselect GPcoordinateSearchUnitsSelect gpf-select fr-select",i.addEventListener("change",function(c){e.onCoordinateSearchUnitsChange(c)});for(var n=0;n<s.length;n++){var o=s[n],l=document.createElement("option");l.value=o.code?o.code:n,l.text=o.label||n,i.appendChild(l)}return i},_setCoordinateSearchLngLabelElement(s){document.getElementById(this._addUID("GPcoordinateSearchLngLabel"))&&document.getElementById(this._addUID("GPcoordinateSearchLngLabel")).remove();var e=document.createElement("label");return e.className="GPcoordinateSearchLabel gpf-label fr-label",e.id=this._addUID("GPcoordinateSearchLngLabel"),e.htmlFor="coordinate-lng",e.innerHTML=s==="Geographical"?"Longitude :":"Y :",e},_setCoordinateSearchLngInputElement(s){document.getElementById(this._addUID("GPcoordinateSearchLngInput"))&&document.getElementById(this._addUID("GPcoordinateSearchLngInput")).remove(),document.getElementById(this._addUID("GPcoordinateSearchLngDMS"))&&document.getElementById(this._addUID("GPcoordinateSearchLngDMS")).remove();var e=document.createElement("input");switch(e.id=this._addUID("GPcoordinateSearchLngInput"),e.className="GPcoordinateSearchInput gpf-input fr-input",e.title="Saisir des coordonnes",e.name="coordinate-lng",e.type="number",e.step="any",e.required="",s){case"DMS":return e.title+=" gographiques (en sexa)",e.className="GPelementHidden gpf-hidden",this._setCoordinateSearchLngDMSElement();case"DEC":e.title+=" gographiques (en decimal)",e.min="-180",e.max="180";break;case"M":e.title+=" cartsiennes (en mtre)";break;case"KM":e.title+=" cartsiennes (en kilomtre)";break}return e},_setCoordinateSearchLngDMSElement(){var s=document.createElement("div");return s.id=this._addUID("GPcoordinateSearchLngDMS"),s.innerHTML=`
        <div class="GPflexInput gpf-flex">
            <input step="1"
                id="GPcoordinatSearchInputSexLonDeg"
                class="gpf-input fr-input"
                name="inputSexLonDeg"
                title="Saisir une valeur de degr entre 0 et 180"
                type="number"
                required=""
                min="0"
                max="180">
            <label></label>
            <input step="1"
                id="GPcoordinatSearchInputSexLonMin"
                class="gpf-input fr-input"
                name="inputSexLonMin"
                title="Saisir une valeur de minute entre 0' et 59'"
                type="number"
                required=""
                min="0"
                max="59">
            <label>'</label>
            <input step="any"
                id="GPcoordinatSearchInputSexLonSec"
                class="gpf-input fr-input"
                name="inputSexLonSec"
                title="Saisir une valeur de seconde entre 0'' et 59''"
                type="number"
                required=""
                min="0"
                max="59.9999">
            <label>"</label>
            <select
                id="GPcoordinatSearchInputSexLonToward"
                class="GPselect gpf-select fr-select"
                title="Saisir une direction pour Est et 0uest"
                name="inputSexLonToward">
                <option value="O">O</option>
                <option value="E" selected="">E</option>
            </select>
        </div>
        `,s},_setCoordinateSearchLatLabelElement(s){document.getElementById(this._addUID("GPcoordinateSearchLatLabel"))&&document.getElementById(this._addUID("GPcoordinateSearchLatLabel")).remove();var e=document.createElement("label");return e.className="GPcoordinateSearchLabel gpf-label fr-label",e.id=this._addUID("GPcoordinateSearchLatLabel"),e.htmlFor="coordinate-lat",e.innerHTML=s==="Geographical"?"Latitude :":"X :",e},_setCoordinateSearchLatInputElement(s){document.getElementById(this._addUID("GPcoordinateSearchLatInput"))&&document.getElementById(this._addUID("GPcoordinateSearchLatInput")).remove(),document.getElementById(this._addUID("GPcoordinateSearchLatDMS"))&&document.getElementById(this._addUID("GPcoordinateSearchLatDMS")).remove();var e=document.createElement("input");switch(e.id=this._addUID("GPcoordinateSearchLatInput"),e.className="GPcoordinateSearchInput gpf-input fr-input",e.title="Saisir des coordonnes",e.name="coordinate-lat",e.type="number",e.step="any",e.required="",s){case"DMS":return e.title+=" gographiques (en sexa)",e.className="GPelementHidden gpf-hidden",this._setCoordinateSearchLatDMSElement();case"DEC":e.title+=" gographiques (en decimal)",e.min="-180",e.max="180";break;case"M":e.title+=" cartsiennes (en mtre)";break;case"KM":e.title+=" cartsiennes (en kilomtre)";break}return e},_setCoordinateSearchLatDMSElement(){var s=document.createElement("div");return s.id=this._addUID("GPcoordinateSearchLatDMS"),s.innerHTML=`
        <div class="GPflexInput gpf-flex">
            <input step="1"
                id="GPcoordinatSearchInputSexLatDeg"
                class="gpf-input fr-input"
                name="inputSexLatDeg"
                title="Saisir une valeur de degr entre 0 et 85"
                type="number"
                required=""
                min="0"
                max="85">
            <label></label>
            <input step="1"
                id="GPcoordinatSearchInputSexLatMin"
                class="gpf-input fr-input"
                name="inputSexLatMin"
                title="Saisir une valeur de minute entre 0' et 59'"
                type="number"
                required=""
                min="0"
                max="59">
            <label>'</label>
            <input step="any"
                id="GPcoordinatSearchInputSexLatSec"
                class="gpf-input fr-input"
                name="inputSexLatSec"
                title="Saisir une valeur de seconde entre 0' et 59'"
                type="number"
                required=""
                min="0"
                max="59.9999">
            <label>"</label>
            <select
                id="GPcoordinatSearchInputSexLatToward"
                class="GPselect gpf-select fr-select"
                title="Saisir une direction pour Nord et Sud"
                name="inputSexLatToward">
                <option value="N">N</option>
                <option value="S">S</option>
            </select>
        </div>
        `,s},_createCoordinateSearchSubmitElement(){var s=document.createElement("input");return s.type="submit",s.id=this._addUID("GPcoordinateSearchSubmit"),s.className="GPsubmit gpf-btn gpf-btn-icon-submit  fr-btn fr-btn--secondary gpf-btn--secondary",s.value="Chercher",s}},logger$y=LoggerByDefault.getLogger("searchengine");class SearchEngine extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof SearchEngine))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="SearchEngine",this.initialize(e),this.container=this._initContainer(),this.element?this.element.appendChild(this.container):this.element=this.container,this}setMap(e){e||this._clearResults(),this.collapsed||this._showSearchEngineButton.setAttribute("aria-pressed",!0),super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getCollapsed(){return this.collapsed}setCollapsed(e){if(e===void 0){logger$y.log("[ERROR] SearchEngine:setCollapsed - missing collapsed parameter");return}this.options.collapsible&&(e&&this.collapsed||!e&&!this.collapsed||(this._showSearchEngineButton.click(),this.collapsed=e))}getData(){return this._geocodedLocations}getContainer(){return this.container}initialize(e){this._checkInputOptions(e),this.options={collapsed:!0,collapsible:!0,zoomTo:"",resources:{geocode:[],autocomplete:[],search:!1},displayButtonClose:!0,displayButtonAdvancedSearch:!1,displayButtonGeolocate:!1,displayButtonCoordinateSearch:!1,coordinateSearchInAdvancedSearch:!1,advancedSearch:{},coordinateSearch:{},searchOptions:{addToMap:!0,maximumEntries:5,serviceOptions:{maximumResponses:10},filterLayers:!0},geocodeOptions:{serviceOptions:{}},autocompleteOptions:{serviceOptions:{maximumResponses:5},triggerGeocode:!1,triggerDelay:1e3,prettifyResults:!1},displayMarker:!0,markerStyle:"lightOrange",markerUrl:"",placeholder:"Rechercher un lieu, une adresse",splitResults:!1},Helper.mergeParams(this.options,e),this.options.resources.geocode===""&&(this.options.resources.geocode=["PositionOfInterest","StreetAddress"]),this.options.resources.autocomplete.length===0&&(this.options.resources.autocomplete=["PositionOfInterest","StreetAddress"]),this.options.resources.search&&(this.options.searchOptions&&(this.options.searchOptions.serviceOptions&&(this.options.searchOptions.serviceOptions.url&&Search$1.setUrl(this.options.searchOptions.serviceOptions.url),this.options.searchOptions.serviceOptions.fields&&Search$1.setFields(this.options.searchOptions.serviceOptions.fields),this.options.searchOptions.serviceOptions.index&&Search$1.setIndex(this.options.searchOptions.serviceOptions.index),this.options.searchOptions.serviceOptions.size&&Search$1.setSize(this.options.searchOptions.serviceOptions.size),this.options.searchOptions.serviceOptions.maximumResponses&&Search$1.setMaximumResponses(this.options.searchOptions.serviceOptions.maximumResponses)),this.options.searchOptions.filterServices&&Search$1.setFiltersByService(this.options.searchOptions.filterServices),this.options.searchOptions.filterLayersPriority&&Search$1.setFiltersByLayerPriority(this.options.searchOptions.filterLayersPriority),this.options.searchOptions.filterWMTSPriority&&Search$1.setFilterWMTSPriority(this.options.searchOptions.filterWMTSPriority),this.options.searchOptions.filterTMS===!1&&Search$1.setFilterTMS(this.options.searchOptions.filterTMS),this.options.searchOptions.filterProjections&&Search$1.setFiltersByProjection(this.options.searchOptions.filterProjections)),Search$1.target.addEventListener("suggest",o=>{logger$y.debug(o);let l=o.detail;l=this._filterResultsFromConfigLayers(l),this._fillSearchedSuggestListContainer(l)})),this.options.collapsible||(this.options.collapsed=!1),this.collapsed=this.options.collapsed,this._uid=this.options.id||SelectorID.generate(),this._showSearchEngineButton=null,this._showSearchEngineAdvancedButton=null,this._inputSearchContainer=null,this._autocompleteContainer=null,this._containerResultsLocation=null,this._containerResultsSuggest=null,this._radioButtonLocation=null,this._radioButtonSuggest=null,this._suggestedLocations=[],this._geocodedContainer=null,this._geocodedLocations=[],this._filterContainer=null,this._currentGeocodingCode=null,this._currentGeocodingLocation=null,this._advancedSearchFilters={},this._initAdvancedSearchFilters(),this._advancedSearchCodes=[],this._initAdvancedSearchCodes(),this._coordinateSearchSystems=[],this.options.displayButtonCoordinateSearch&&(this._initCoordinateSearchSystems(),this._currentCoordinateSearchSystems=this._coordinateSearchSystems[0],this._currentCoordinateSearchType=this._coordinateSearchSystems[0].type),this._coordinateSearchUnits=[],this.options.displayButtonCoordinateSearch&&(this._initCoordinateSearchUnits(),this._currentCoordinateSearchUnits=this._coordinateSearchUnits[this._currentCoordinateSearchType][0].code),this._coordinateSearchLngInput=null,this._coordinateSearchLatInput=null,this._marker=null;var i=this.options.markerStyle,n=this.options.markerUrl;n?this._markerUrl=n:this._markerUrl=Object.keys(Marker).indexOf(i)===-1?Marker.lightOrange:Marker[i],this._displayMarker=this.options.displayMarker,this._popupContent=null,this._popupDiv=this._initPopupDiv(),this._popupOverlay=null,this._triggerHandler=null}_checkInputOptions(e){var i;if(e.resources)if(typeof e.resources=="object"){var n=e.resources.geocode;if(n)if(Array.isArray(n)){var o=["StreetAddress","PositionOfInterest","CadastralParcel","Administratif"];for(i=0;i<n.length;i++)o.indexOf(n[i])===-1&&logger$y.log("[SearchEngine] options.resources.geocode : "+n[i]+" is not a resource for geocode")}else logger$y.log("[SearchEngine] 'options.resources.geocode' parameter should be an array"),n=null;var l=e.resources.autocomplete;if(l)if(Array.isArray(l)){var c=["StreetAddress","PositionOfInterest"];for(i=0;i<l.length;i++)c.indexOf(l[i])===-1&&logger$y.log("[SearchEngine] options.resources.autocomplete : "+l[i]+" is not a resource for autocomplete")}else logger$y.log("[SearchEngine] 'options.resources.autocomplete' parameter should be an array"),l=null}else logger$y.log("[SearchEngine] 'resources' parameter should be an object"),e.resources=null}_initAdvancedSearchCodes(){var e=this.options.resources.geocode;e==="location"&&(e=["PositionOfInterest","StreetAddress","CadastralParcel"]),Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++)switch(e[i]){case"PositionOfInterest":this._advancedSearchCodes.push({id:"PositionOfInterest",title:"Lieux/toponymes"});break;case"StreetAddress":this._advancedSearchCodes.push({id:"StreetAddress",title:"Adresses"});break;case"CadastralParcel":this._advancedSearchCodes.push({id:"CadastralParcel",title:"Parcelles cadastrales"});break}this._advancedSearchCodes.length===0&&(this._advancedSearchCodes=[{id:"StreetAddress",title:"Adresses"},{id:"PositionOfInterest",title:"Lieux/toponymes"},{id:"CadastralParcel",title:"Cadastre"}]),logger$y.log("advancedSearchCodes",this._advancedSearchCodes)}_initAdvancedSearchFilters(){this._advancedSearchFilters=SearchEngineUtils.advancedSearchFiltersByDefault;var e=this.options.advancedSearch;Helper.assign(this._advancedSearchFilters,e),logger$y.log("advancedSearchFilters",this._advancedSearchFilters)}_initCoordinateSearchSystems(){var e=[{label:"Gographique",crs:"EPSG:4326",type:"Geographical"},{label:"Web Mercator",crs:"EPSG:3857",type:"Metric"},{label:"Lambert 93",crs:"EPSG:2154",type:"Metric"}],i=this.options.coordinateSearch.systems;if(i)for(var n=0;n<i.length;n++){var o=i[n];this._setSystem(o)}if(this._coordinateSearchSystems.length===0)for(var l=0;l<e.length;l++)this._setSystem(e[l])}_initCoordinateSearchUnits(){var e={Geographical:[{code:"DEC",label:"degrs dcimaux",format:MathUtils.coordinateToDecimal},{code:"DMS",label:"degrs sexagsimaux",format:MathUtils.coordinateToDMS}],Metric:[{code:"M",label:"mtres",format:MathUtils.coordinateToMeter},{code:"KM",label:"kilomtres",format:MathUtils.coordinateToKMeter}]},i=this.options.coordinateSearch.units;if(i){for(var n in e)if(e.hasOwnProperty(n)){for(var o=!1,l=0;l<e[n].length;l++)for(var c=e[n][l],u=0;u<i.length;u++){var h=i[u];c.code===h&&(o=!0,this._coordinateSearchUnits[n]||(this._coordinateSearchUnits[n]=[]),this._coordinateSearchUnits[n].push(c))}o||(this._coordinateSearchUnits[n]=e[n])}}typeof this._coordinateSearchUnits=="object"&&Object.keys(this._coordinateSearchUnits).length===0&&(this._coordinateSearchUnits=e)}_initPopupDiv(){var e=this,i=document.createElement("div");i.className="gp-feature-info-div gpf-widget-color";var n=document.createElement("button");n.title="Supprimer le marqueur",n.className="gp-styling-button remove gpf-btn gpf-btn-icon-remove fr-btn--remove fr-btn fr-btn--tertiary-no-outline fr-mt-1v fr-mr-2v",n.onclick=function(){var l=e.getMap();e._marker&&(l.removeOverlay(e._marker),e._marker=null),e._popupOverlay!=null&&e._popupOverlay.setPosition(void 0),e.dispatchEvent({type:"searchengine:geolocation:remove"})};var o=document.createElement("button");return o.title="Fermer la pop-up",o.className="gp-styling-button closer gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-mt-1v fr-mr-2v",o.onclick=function(){return e._popupOverlay!=null&&e._popupOverlay.setPosition(void 0),!1},this._popupContent=document.createElement("div"),this._popupContent.className="gp-features-content-div",this._popupContent.style["min-width"]="200px",i.appendChild(o),i.appendChild(this._popupContent),i.appendChild(n),i}_initContainer(){var e=this._createMainContainerElement(),i=this._createSearchDivElement(),n=this._showSearchEngineButton=this._createShowSearchEnginePictoElement(this.options.collapsible);i.appendChild(n),this.options.collapsible||e.classList.add("gpf-widget-color","gpf-widget-padding");var o=this._inputSearchContainer=this._createSearchInputElement(this.options.placeholder);this.options.displayButtonClose&&o.appendChild(this._createSearchResetElement());var l=this;o.addEventListener?o.addEventListener("click",function(){l.onAutoCompleteInputClick()}):o.attachEvent&&o.attachEvent("onclick",function(){l.onAutoCompleteInputClick()}),i.appendChild(o);var c=this._createButtonsElement(),u=this._createFirstLineWrapper();if(u.appendChild(i),u.appendChild(c),e.appendChild(u),checkDsfr()&&this.options.splitResults){var h=this._createRadioContainer();e.appendChild(h)}if(checkDsfr()&&this.options.splitResults){var f;[f,this._radioButtonLocation,this._radioButtonSuggest]=this._createRadioElements(),h.appendChild(f)}if(this.options.displayButtonGeolocate){var g=this._createShowGeolocateElement();c.appendChild(g)}if(this.options.displayButtonCoordinateSearch||this.options.coordinateSearchInAdvancedSearch){var H=this._createShowSearchByCoordinateElement();this.options.coordinateSearchInAdvancedSearch||c.appendChild(H);var Y=this._createCoordinateSearchPanelElement(),ee=this._createCoordinateSearchPanelDivElement(),te=this._createCoordinateSearchPanelHeaderElement(),xe=this._createCoordinateSearchPanelFormElement(),ne=null;ne=this._containerSystems=this.__createCoordinateSearchDivElement(),xe.appendChild(ne);var et=this._createCoordinateSearchSystemsLabelElement(),tt=this._setCoordinateSearchSystemsSelectElement(this._coordinateSearchSystems);ne.appendChild(et),ne.appendChild(tt),ne=this._containerUnits=this.__createCoordinateSearchDivElement(),xe.appendChild(ne);var it=this._createCoordinateSearchUnitsLabelElement(),rt=this._setCoordinateSearchUnitsSelectElement(this._coordinateSearchUnits[this._currentCoordinateSearchType]);ne.appendChild(it),ne.appendChild(rt),ne=this._containerCoordinateLat=this.__createCoordinateSearchDivElement(),xe.appendChild(ne);var nt=this._setCoordinateSearchLatLabelElement(this._currentCoordinateSearchType),st=this._coordinateSearchLatInput=this._setCoordinateSearchLatInputElement(this._currentCoordinateSearchUnits);ne.appendChild(nt),ne.appendChild(st),ne=this._containerCoordinateLng=this.__createCoordinateSearchDivElement(),xe.appendChild(ne);var at=this._setCoordinateSearchLngLabelElement(this._currentCoordinateSearchType),ot=this._coordinateSearchLngInput=this._setCoordinateSearchLngInputElement(this._currentCoordinateSearchUnits);ne.appendChild(at),ne.appendChild(ot);var ct=this._createCoordinateSearchSubmitElement();xe.appendChild(ct),ee.appendChild(te),ee.appendChild(xe),Y.appendChild(ee),this.options.coordinateSearchInAdvancedSearch||e.appendChild(Y)}if(this.options.displayButtonAdvancedSearch){var ht=this._showSearchEngineAdvancedButton=this._createShowAdvancedSearchElement();c.appendChild(ht);var ut=this._createAdvancedSearchPanelElement(),pt=this._createAdvancedSearchPanelDivElement(),yt=this._createAdvancedSearchPanelHeaderElement(),mt=this._createAdvancedSearchPanelFormElement(this._advancedSearchCodes,this.options.coordinateSearchInAdvancedSearch),St=this._filterContainer=this._createAdvancedSearchFormFiltersElement();this._setFilter(this._advancedSearchCodes[0].id);var Pt=this._createAdvancedSearchFormInputElement();mt.appendChild(St),this.options.coordinateSearchInAdvancedSearch&&mt.appendChild(xe),mt.appendChild(Pt),pt.appendChild(yt),pt.appendChild(mt),ut.appendChild(pt),e.appendChild(ut)}var Rt=this._autocompleteContainer=this._createAutoCompleteElement(),Lt=this._createAutoCompleteListElement(),Nt=this._containerResultsLocation=this._createAutoCompletedLocationContainer(),vt=this._containerResultsSuggest=this._createSearchedSuggestContainer();Lt.appendChild(Nt),Lt.appendChild(vt),Rt.appendChild(Lt),e.appendChild(Rt);var Et=this._createGeocodeResultsElement(),Ct=this._createGeocodeResultsDivElement();Et.appendChild(Ct);var _t=this._geocodedContainer=this._createGeocodeResultsListElement();return Ct.appendChild(_t),e.appendChild(Et),e}_setFilter(e){for(var i=this._filterContainer,n=!1,o=0;o<this._advancedSearchCodes.length;o++)if(this._advancedSearchCodes[o].id===e){n=!0;break}if(!n){for(;i.firstChild;)i.removeChild(i.firstChild);return}for(this._currentGeocodingCode=e;i.firstChild;)i.removeChild(i.firstChild);var l=this._advancedSearchFilters[e];if(!(!l||l.length===0)){for(var c=this._createAdvancedSearchFiltersTableElement(e,!0),u=0;u<l.length;u++){var h=this._createAdvancedSearchFiltersAttributElement(l[u]);c.appendChild(h)}return i.appendChild(c),i}}_requestAutoComplete(e){if(!(!e||typeof e=="object"&&Object.keys(e).length===0)&&e.text){logger$y.log(e);var i={};Helper.assign(i,this.options.autocompleteOptions.serviceOptions),Helper.assign(i,e);var n=this.options.resources.autocomplete;n&&Array.isArray(n)&&(i.type||(i.type=n)),i.apiKey=i.apiKey||this.options.apiKey,typeof i.ssl!="boolean"&&(typeof this.options.ssl=="boolean"?i.ssl=this.options.ssl:i.ssl=!0),logger$y.log(i),Gp.Services.autoComplete(i)}}_fillAutoCompletedLocationListContainer(e){if(!(!e||e.length===0)){var i=this._containerResultsLocation;if(i.childElementCount)for(;i.firstChild;)i.removeChild(i.firstChild);if(i.classList.add("GPelementHidden","gpf-hidden"),e.length){(!this._radioButtonLocation||this._radioButtonLocation&&this._radioButtonLocation.checked)&&i.classList.remove("GPelementHidden","gpf-hidden"),this._displaySuggestedLocation(),(!checkDsfr()||!this.options.splitResults)&&this._createAutoCompletedLocationTitleElement();for(var n=0;n<e.length;n++)this._createAutoCompletedLocationElement(e[n],n)}}}_fillSearchedSuggestListContainer(e){this.options.searchOptions.maximumEntries&&(e=e.slice(0,this.options.searchOptions.maximumEntries));var i=this._containerResultsSuggest;if(i.childElementCount)for(;i.firstChild;)i.removeChild(i.firstChild);if(i.classList.add("GPelementHidden","gpf-hidden"),e.length){(!this._radioButtonSuggest||this._radioButtonSuggest&&this._radioButtonSuggest.checked)&&i.classList.remove("GPelementHidden","gpf-hidden"),(!checkDsfr()||!this.options.splitResults)&&this._createSearchedSuggestTitleElement();for(let n=0;n<e.length;n++){const o=e[n];this._createSearchedSuggestElement(o,n)}}}_filterResultsFromConfigLayers(e){if(this.options.searchOptions.filterLayers){var i={};if(this.options.searchOptions.filterLayersList)i=this.options.searchOptions.filterLayersList;else{var n=window.Gp.Config.layers;for(let l in n)n.hasOwnProperty(l)&&(i[n[l].name]=n[l].serviceParams.id.split(":")[1])}let o=e.length;for(;o--;)(!i[e[o].name]||e[o].service.toUpperCase()!==i[e[o].name].toUpperCase())&&e.splice(o,1)}return Search$1.setSuggestions(e),e}_requestGeocoding(e){if(!(!e||typeof e=="object"&&Object.keys(e).length===0)&&e.query!==null){logger$y.log(e);var i={};Helper.assign(i,this.options.geocodeOptions.serviceOptions),Helper.assign(i,e);var n=this,o=this.options.geocodeOptions.serviceOptions.onFailure!==null&&typeof this.options.geocodeOptions.serviceOptions.onFailure=="function",l=this.options.geocodeOptions.serviceOptions.onSuccess!==null&&typeof this.options.geocodeOptions.serviceOptions.onSuccess=="function";if(l){var c=function(f){e.onSuccess.call(n,f),n.options.geocodeOptions.serviceOptions.onSuccess.call(n,f)};i.onSuccess=c}if(o){var u=function(f){e.onFailure.call(n,f),n.options.geocodeOptions.serviceOptions.onFailure.call(n,f)};i.onFailure=u}var h=this.options.resources.geocode;h&&(i.index||(i.index=h)),i.apiKey=i.apiKey||this.options.apiKey,typeof i.ssl!="boolean"&&(typeof this.options.ssl=="boolean"?i.ssl=this.options.ssl:i.ssl=!0),logger$y.log(i),Gp.Services.geocode(i)}}_fillGeocodedLocationListContainer(e){if(!e||e.length===0){this._clearGeocodedLocation();return}var i=this._geocodedContainer;if(i.childElementCount)for(;i.firstChild;)i.removeChild(i.firstChild);for(var n=0;n<e.length;n++)logger$y.log(e[n]),this._createGeocodedLocationElement(e[n],n);this._geocodedLocations=e}_setLabel(e){document.getElementById("GPsearchInputText-"+this._uid).value=e}_setPosition(e,i){var n=this.getMap().getView();n.setCenter(e),n.setZoom(i)}_setPositionFromExtent(e){var i=this.getMap().getView();i.fit(e)}_setMarker(e,i){var n=this.getMap(),o=this;if(this._marker!=null&&(n.removeOverlay(this._marker),this._marker=null),e){var l=document.createElement("img");l.src=this._markerUrl,l.addEventListener?l.addEventListener("click",function(){o._onResultMarkerSelect(i,e)}):l.attachEvent&&l.attachEvent("onclick",function(){o._onResultMarkerSelect(i,e)}),this._marker=new Overlay({position:e,positioning:"center-center",element:l,stopEvent:!1}),n.addOverlay(this._marker)}}_getZoom(e){var i=this.getMap(),n=this.options.zoomTo,o=null;if(typeof n=="function"&&(logger$y.trace("zoom function"),o=n.call(this,e)),typeof n=="number"&&(logger$y.trace("zoom level"),o=n),typeof n=="string")if(n==="auto")logger$y.trace("zoom auto"),o=SearchEngineUtils.zoomToResultsByDefault(e);else{logger$y.trace("zoom level parsing");var l=parseInt(n,10);isNaN(l)||(logger$y.trace("zoom parsing"),o=l)}Number.isInteger=Number.isInteger||function(h){return typeof h=="number"&&isFinite(h)&&Math.floor(h)===h},(!o||o===""||!Number.isInteger(o))&&(logger$y.trace("zoom not found, current zoom..."),o=i.getView().getZoom());var c=i.minZoom,u=i.maxZoom;return o<c&&(logger$y.trace("zoom level min..."),o=c),o>u&&(logger$y.trace("zoom level max..."),o=u),logger$y.trace("zoom",o),o}_onResultMarkerSelect(e,i=null){var n=this.getMap();i&&n.getView().animate({center:i,duration:250});var o="";if(typeof e!="string")if(e.service==="GeocodedLocation"){o="<ul>";var l=e.location.placeAttributes;for(var c in l)l.hasOwnProperty(c)&&c!=="trueGeometry"&&c!=="extraFields"&&c!=="houseNumberInfos"&&c!=="_count"&&(o+="<li>",o+='<span class="gp-attname-others-span">'+c.toUpperCase()+" : </span>",o+=l[c],o+=" </li>");o+=" </ul>"}else e.service==="SuggestedLocation"?o=GeocodeUtils.getSuggestedLocationFreeform(e.location):o="sans informations.";else o=e;this._popupContent.innerHTML=o,this._popupOverlay?this._popupOverlay.setPosition(this._marker.getPosition()):(this._popupOverlay=new Overlay({element:this._popupDiv,positioning:"bottom-center",position:this._marker.getPosition(),offset:[0,-42]}),n.addOverlay(this._popupOverlay))}_setSystem(e){if(typeof e!="object"){logger$y.log("[ERROR] MousePosition:addSystem - system parameter should be an object");return}if(!e.crs){logger$y.error("crs not defined !");return}if(e.label||(logger$y.warn("crs label not defined, use crs code by default."),e.label=e.crs),e.type||(logger$y.warn("type srs not defined, use 'Metric' by default."),e.type="Metric"),CRS.loadByName(e.crs),!get$3(e.crs)){logger$y.error("crs '{}' not available into proj4 definitions !",e.crs);return}for(var i=0;i<this._coordinateSearchSystems.length;i++){var n=this._coordinateSearchSystems[i];e.crs===n.crs&&logger$y.info("crs '{}' already configured",n.crs)}e.code=this._coordinateSearchSystems.length,this._coordinateSearchSystems.push(e)}onShowSearchEngineClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen();var i=this.getMap();Interactions.unset(i);var n=this._showSearchEngineButton.ariaPressed;this.collapsed=n!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position),this.collapsed&&this._clearResults()}onSearchResetClick(){this._clearResults()}onShowSearchGeolocateClick(){"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(e=>{var i=this.getMap().getView(),n=i.getProjection().getCode(),o=[e.coords.longitude,e.coords.latitude],l;if(n!=="EPSG:4326"?l=transform$1(o,"EPSG:4326",n):l=o,isNaN(l[0])||isNaN(l[1])){this._setMarker();return}if(this._setPosition(l,15),this._displayMarker){var c="<h6> Ma position </h6> latitude : "+o[1]+"<br/> longitude : "+o[0];this._setMarker(l,c)}this.dispatchEvent({type:"searchengine:geolocation:click",coordinates:l})})}onShowSearchByCoordinateClick(){var e=null,i=null;if(this._coordinateSearchLngInput&&this._coordinateSearchLngInput.nodeName==="DIV"&&this._coordinateSearchLatInput&&this._coordinateSearchLatInput.nodeName==="DIV"?(e=this._getCoordinateSearchDMS(this._coordinateSearchLngInput),i=this._getCoordinateSearchDMS(this._coordinateSearchLatInput)):(e=this._coordinateSearchLngInput.value,i=this._coordinateSearchLatInput.value),!(!e||!i)){var n=[e,i],o=this.getMap().getView(),l=o.getProjection().getCode();if(l!=="EPSG:4326"&&(n=transform$1(n,"EPSG:4326",l)),isNaN(n[0])||isNaN(n[1])){this._setMarker();return}this._setPosition(n,10),this._displayMarker&&this._setMarker(n,i+", "+e),this.dispatchEvent({type:"searchengine:coordinates:click",coordinates:n})}}_getCoordinateSearchDMS(e){if(e&&e.nodeName==="DIV"){var i=e.querySelectorAll("[name]");if(i){var n=MathUtils.toInteger(i[0].value),o=MathUtils.toInteger(i[1].value),l=MathUtils.toInteger(i[2].value),c=i[3].options[i[3].selectedIndex].text;return!n||!o||!l||!c?void 0:MathUtils.dmsToDecimal(n,o,l,c)}}}onAutoCompleteInputClick(){var e=document.getElementById("GPsearchInputText-"+this._uid);e&&!e.disabled&&e.value.length>2&&this._displaySuggestedLocation()}onAutoCompleteSearchText(e){var i=e.target.value;if(i){if(this._currentGeocodingLocation=i,i.length<3){this._clearSuggestedLocation();return}var n=this.options.autocompleteOptions.triggerGeocode,o=this.options.autocompleteOptions.triggerDelay,l=this.options.autocompleteOptions.maximumEntries,c=this.options.autocompleteOptions.prettifyResults,u=this;this._requestAutoComplete({text:i,onSuccess:function(f){if(logger$y.log("request from AutoComplete",f),f){u._suggestedLocations=f.suggestedLocations,u._locationsToBeDisplayed=[];for(var g=0;g<u._suggestedLocations.length;g++){var H=u._suggestedLocations[g];H.position&&H.position.x===0&&H.position.y===0&&H.fullText?u._getGeocodeCoordinatesFromFullText(H,g):u._locationsToBeDisplayed.push(H)}c===!0&&u._prettifyAutocompleteResults(u._locationsToBeDisplayed),l&&(u._locationsToBeDisplayed=u._locationsToBeDisplayed.slice(0,l)),u._fillAutoCompletedLocationListContainer(u._locationsToBeDisplayed),u._triggerHandler&&(clearTimeout(u._triggerHandler),u._triggerHandler=null,logger$y.warn("Cancel a geocode request !"))}},onFailure:function(f){u._clearSuggestedLocation(),logger$y.log(f.message),f.message==="No suggestion matching the search"&&n&&(u._triggerHandler&&(clearTimeout(u._triggerHandler),logger$y.warn("Cancel the last geocode request !")),u._triggerHandler=setTimeout(function(){logger$y.warn("Launch a geocode request !"),u._requestGeocoding({location:i,onSuccess:function(g){if(logger$y.log("request from Geocoding",g),g){u._locationsToBeDisplayed=[];for(var H=g.locations,Y=0;Y<H.length;Y++){var ee=H[Y];ee.fullText=GeocodeUtils.getGeocodedLocationFreeform(ee),ee.position={x:ee.position.lon,y:ee.position.lat},u._locationsToBeDisplayed.push(ee)}u._fillAutoCompletedLocationListContainer(H)}},onFailure:function(g){logger$y.log(g.message)}})},o))}}),this.options.resources.search&&Search$1.suggest(i);var u=this,h=this.getMap();h.once("click",function(){u._hideSuggestedLocation()}),h.once("pointerdrag",function(){u._hideSuggestedLocation()})}}_getGeocodeCoordinatesFromFullText(e,i){var n=this;Gp.Services.geocode({apiKey:this.options.apiKey,ssl:this.options.ssl,q:GeocodeUtils.getSuggestedLocationFreeform(e),index:e.type,onSuccess:function(o){logger$y.log("request from Geocoding (coordinates null)",o),o.locations&&o.locations.length!==0&&o.locations[0].position&&n._suggestedLocations&&n._suggestedLocations[i]&&(n._suggestedLocations[i].position={lon:o.locations[0].position.y,lat:o.locations[0].position.x},n._locationsToBeDisplayed.unshift(n._suggestedLocations[i]),n._fillAutoCompletedLocationListContainer(n._locationsToBeDisplayed))},onFailure:function(){n._suggestedLocations&&n._suggestedLocations[i]&&n._createAutoCompletedLocationElement(n._suggestedLocations[i],i)}})}onAutoCompletedResultsItemClick(e){var i=SelectorID.index(e.target.id);if(logger$y.log(i),logger$y.log(this._locationsToBeDisplayed[i]),!!i){var n=[this._locationsToBeDisplayed[i].position.x,this._locationsToBeDisplayed[i].position.y],o={service:"SuggestedLocation",location:this._locationsToBeDisplayed[i]},l=GeocodeUtils.getSuggestedLocationFreeform(this._locationsToBeDisplayed[i]);this._setLabel(l),this._currentGeocodingLocation=l;var c=this.getMap().getView(),u=c.getProjection().getCode();u!=="EPSG:4326"&&(n=transform$1(n,"EPSG:4326",u)),this._requestGeocoding({index:"address,poi",limit:1,returnTrueGeometry:!0,location:l,onSuccess:h=>{if(h.locations[0].placeAttributes.truegeometry){var f=JSON.parse(h.locations[0].placeAttributes.truegeometry);if(f.type==="Point")this._setPosition(n,15);else{var g=new GeoJSON$1,H=g.readGeometry(f,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}),Y=H.getExtent();this._setPositionFromExtent(Y)}}else this._setPosition(n,15);this._displayMarker&&this._setMarker(n,o);var ee=document.getElementById(this._addUID("GPautocompleteResults"));if(ee){var te=ee.getElementsByClassName("GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine");for(let ne=0;ne<te.length;ne++){const et=te[ne];et.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine"}var xe=te[i];xe.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine current",this.dispatchEvent({type:"searchengine:autocomplete:click",location:this._locationsToBeDisplayed[i]})}},onFailure:h=>{logger$y.warn(h);var f=this._getZoom(o);this._setPosition(n,f),this._displayMarker&&this._setMarker(n,o);var g=document.getElementById(this._addUID("GPautocompleteResults"));if(g){var H=g.getElementsByClassName("GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine");for(let ee=0;ee<H.length;ee++){const te=H[ee];te.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine"}var Y=H[i];Y.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine current",this.dispatchEvent({type:"searchengine:autocomplete:click",location:this._locationsToBeDisplayed[i]})}}})}}onSearchedResultsItemClick(e){var i=SelectorID.index(e.target.id),n=null;try{var o=Search$1.getSuggestions()[i];if(!o)throw"No suggestions found !";if(this.options.searchOptions.addToMap){if(!Config.isConfigLoaded())throw"ERROR : contract key configuration has to be loaded to load Geoportal layers.";var l=o.service,c=o.name,u=null;switch(l){case"WMS":u=new LayerWMS({layer:c});break;case"WMTS":u=new LayerWMTS({layer:c});break;case"WFS":u=new LayerWFS({layer:c});break;case"TMS":u=new LayerMapBox({layer:c},{declutter:!0});default:break}if(u){var h=this.getMap();h.addLayer(u)}}}catch(f){n=f}this.dispatchEvent({type:"searchengine:search:click",suggest:o,error:n})}onGeocodingSearchSubmit(e){var i=e.target[0].value;if(i){this._currentGeocodingLocation=i;var n=this;this._requestGeocoding({query:i,onSuccess:function(o){if(logger$y.log("request from Geocoding",o),o){var l=o.locations;n._fillGeocodedLocationListContainer(l)}},onFailure:function(o){n._clearGeocodedLocation(),logger$y.log(o.message)}})}}onGeocodedResultsItemClick(e){var i=SelectorID.index(e.target.id);if(i){var n=[this._geocodedLocations[i].position.lon,this._geocodedLocations[i].position.lat],o={service:"GeocodedLocation",location:this._geocodedLocations[i]},l=GeocodeUtils.getGeocodedLocationFreeform(this._geocodedLocations[i]);this._setLabel(l);var c=this.getMap().getView(),u=c.getProjection().getCode();u!=="EPSG:4326"&&(n=transform$1(n,"EPSG:4326",u));var h=this._getZoom(this.options.zoomTo);this._setPosition(n,h),this._displayMarker&&this._setMarker(n,o),this.dispatchEvent({type:"searchengine:geocode:click",location:this._geocodedLocations[i]}),this._clearSuggestedLocation(),this._showSearchEngineAdvancedButton.click()}}onGeocodingAdvancedSearchCodeChange(e){logger$y.log(e);var i=e.target.selectedIndex,n=e.target.options[i].value;n&&this._setFilter(n)}onGeocodingAdvancedSearchSubmit(e,i){if(logger$y.log(i),!(!i||i.length===0)){for(var n,o={},l=0;l<i.length;l++){var c=i[l];c.value&&(c.key==="section"&&(c.value=c.value.toUpperCase()),o[c.key]=c.value)}var u=document.getElementById("GPsearchInputText-"+this._uid);n=u.value,this._currentGeocodingCode==="CadastralParcel"&&(n=""),this._currentGeocodingCode==="StreetAddress"&&(n=`${o.address} ${o.postcode} ${o.city}`,o={}),this._currentGeocodingCode==="PositionOfInterest"&&(n=o.q,delete o.q);var h=this;this._requestGeocoding({query:n,index:this._currentGeocodingCode,filters:o,onSuccess:function(f){if(logger$y.log(f),f){var g=f.locations;h._fillGeocodedLocationListContainer(g)}},onFailure:function(f){h._clearGeocodedLocation(),logger$y.log(f.message)}})}}_getCadastralParcelRequestParams(e){var i="",n,o=e.department;o?(n=o.length,n===2?i=o:n===1?i="0"+o:i=o.substring(0,2)):i="__";var l=e.commune;l?(n=l.length,n===3?i+=l:n===2?i+="_"+l:n===1?i+="__"+l:i+=l.substring(0,3)):i+="___";var c=e.insee;c&&c.length===5&&(i=c);var u=e.absorbedCity;u?(n=u.length,n===3?i+=u:n<3?n===2?i+="_"+u:n===1&&(i+="__"+u):i+=u.substring(0,3)):i+="___";var h=e.section;h?(n=h.length,n===2?i+=h:n===1?i+="_"+h:i+=h.substring(0,2)):i+="__";var f=e.number;return f?(n=f.length,n===4?i+=f:n===3?i+="_"+f:n===2?i+="__"+f:n===1?i+="___"+f:i+=f.substring(0,4)):i+="___",logger$y.log("location : "+i),i}onCoordinateSearchSystemChange(e){var i=e.target.selectedIndex,n=e.target.options[i].value;this._coordinateSearchLngInput.value="",this._coordinateSearchLatInput.value="";for(var o=null,l=0;l<this._coordinateSearchSystems.length;++l)if(this._coordinateSearchSystems[l].code===Number(n)){o=this._coordinateSearchSystems[l].type;break}if(!o){logger$y.log("system not found in projection systems container");return}this._currentCoordinateSearchSystems=this._coordinateSearchSystems[Number(n)],o!==this._currentCoordinateSearchType&&(this._currentCoordinateSearchType=o,this._currentCoordinateSearchUnits=this._coordinateSearchUnits[o][0].code,this._containerUnits.appendChild(this._setCoordinateSearchUnitsSelectElement(this._coordinateSearchUnits[o])),this._updateCoordinateSearchElements())}onCoordinateSearchUnitsChange(e){var i=e.target.selectedIndex,n=e.target.options[i].value;this._coordinateSearchLngInput.value="",this._coordinateSearchLatInput.value="",this._currentCoordinateSearchUnits=n,this._updateCoordinateSearchElements()}onCoordinateSearchClose(){this._setMarker(),this._coordinateSearchLngInput.value="",this._coordinateSearchLatInput.value=""}_updateCoordinateSearchElements(){var e=this._setCoordinateSearchLngLabelElement(this._currentCoordinateSearchType),i=this._coordinateSearchLngInput=this._setCoordinateSearchLngInputElement(this._currentCoordinateSearchUnits);this._containerCoordinateLng.appendChild(e),this._containerCoordinateLng.appendChild(i),e=this._setCoordinateSearchLatLabelElement(this._currentCoordinateSearchType),i=this._coordinateSearchLatInput=this._setCoordinateSearchLatInputElement(this._currentCoordinateSearchUnits),this._containerCoordinateLat.appendChild(e),this._containerCoordinateLat.appendChild(i)}_clearResults(){var e=this.getMap();this._currentGeocodingLocation=null,this._clearSuggestedLocation(),this._clearGeocodedLocation(),this._setMarker(),this._popupOverlay!=null&&(e.removeOverlay(this._popupOverlay),this._popupOverlay=null)}_clearSuggestedLocation(){if(this._suggestedLocations=[],this._containerResultsLocation)for(;this._containerResultsLocation.firstChild;)this._containerResultsLocation.removeChild(this._containerResultsLocation.firstChild);if(this.options.resources.search&&(Search$1.clear(),this._containerResultsSuggest))for(;this._containerResultsSuggest.firstChild;)this._containerResultsSuggest.removeChild(this._containerResultsSuggest.firstChild)}_prettifyAutocompleteResults(e){for(var i=e.length-1;i>=0;i--){var n=e[i];(n.type==="StreetAddress"&&n.kind==="municipality"||n.type==="PositionOfInterest"&&n.poiType[0]==="lieu-dit habit"&&n.poiType[1]==="zone d'habitation")&&e.splice(i,1),n.type==="PositionOfInterest"&&n.poiType[0]==="administratif"&&(n.poiType[1]==="dpartement"||n.poiType[1]==="rgion")&&(n.fullText=n.fullText+", "+n.poiType[1])}}_hideSuggestedLocation(){this._autocompleteContainer&&(this._autocompleteContainer.classList.replace("GPelementVisible","GPelementHidden"),this._autocompleteContainer.classList.replace("gpf-visible","gpf-hidden"))}_displaySuggestedLocation(){this._autocompleteContainer&&(this._autocompleteContainer.classList.replace("GPelementHidden","GPelementVisible"),this._autocompleteContainer.classList.replace("gpf-hidden","gpf-visible"))}_clearGeocodedLocation(){if(this._geocodedLocations=[],this._geocodedContainer)for(;this._geocodedContainer.firstChild;)this._geocodedContainer.removeChild(this._geocodedContainer.firstChild)}}Object.assign(SearchEngine.prototype,SearchEngineDOM);Object.assign(SearchEngine.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.SearchEngine=SearchEngine);LoggerByDefault.getLogger("searchengine");class AbstractSearchService extends BaseObject{constructor(e){if(e=e||{},super(e),this.constructor==AbstractSearchService)throw new TypeError("AbstractSearchService cannot be instantiate");return this.CLASSNAME="AbstractSearchService",this.initialize(e),this}initialize(e){this.AUTOCOMPLETE_EVENT="autocomplete",this.SEARCH_EVENT="search",this.ERROR_EVENT="error",this._autocompleteLocations=[],this._locations=[],e.autocomplete===!1&&this.set("autocomplete",!1),this.set("index",e.index||"address,poi"),this.set("limit",typeof e.limit=="number"?e.limit:1),this.set("returnTrueGeometry",!!e.returnTrueGeometry)}getAutocompleteLocations(e){return e===void 0?this._autocompleteLocations:this._autocompleteLocations[e]}getResult(e){return e===void 0?this._locations:this._locations[e]}autocomplete(e){}search(e){}getItemTitle(e){return e}}window.ol&&(window.ol.service||(window.ol.service={}),window.ol.service.AbstractSearchService=AbstractSearchService);LoggerByDefault.getLogger("searchengine");class DefaultSearchService extends AbstractSearchService{constructor(e){e=e||{},super(e),this.CLASSNAME="DefaultSearchService",e.searchTab&&(this._searchTab=e.searchTab||[])}autocomplete(e){this._autocompleteLocations=[];const i=new RegExp(e,"i");(this._searchTab||[]).forEach(n=>{i.test(n.toLowerCase())&&this._autocompleteLocations.push(n)}),this.dispatchEvent({type:this.AUTOCOMPLETE_EVENT,result:this._autocompleteLocations})}search(e){this.dispatchEvent({type:this.SEARCH_EVENT,result:e})}}window.ol&&(window.ol.service||(window.ol.service={}),window.ol.service.DefaultSearchService=DefaultSearchService);const history$1="fr-icon-history-line",defaultIcon="fr-icon-map-pin-2-line",typeClasses={StreetAddress:"fr-icon-map-pin-2-line",PositionOfInterest:{administratif:"fr-icon-france-line",hydrographie:"fr-icon-ign-mer",transport:{"tlcabine, tlphrique transport par cble":"fr-icon-subway-line","gare voyageurs uniquement":"fr-icon-subway-line","voyageurs et fret":"fr-icon-subway-line","station de mtro":"fr-icon-subway-line","gare fret uniquement":"fr-icon-subway-line","gare routire":"fr-icon-subway-line","station de tramway":"fr-icon-subway-line","arrt voyageurs":"fr-icon-subway-line",arodrome:"fr-icon-plane-line",hliport:"fr-icon-plane-line",altiport:"fr-icon-plane-line",arogare:"fr-icon-plane-line",port:"fr-icon-ship-2-line","gare maritime":"fr-icon-ship-2-line",parking:"fr-icon-parking-box-line","aire de repos ou de service":"fr-icon-parking-box-line","service ddi aux vlos":"fr-icon-bike-line"}}};LoggerByDefault.getLogger("searchengine");class SearchEngineBase extends ControlExtended{constructor(e){if(e=e||{},super(e),this.CLASSNAME="SearchEngineBase",this.initialize(e),this.searchService=e.searchService,this.searchService.get("autocomplete")!==!1&&this.searchService.on("autocomplete",(function(i){this.onAutocomplete(i)}).bind(this)),this.searchService.on("search",(function(i){this.onSearch(i)}).bind(this)),this._initContainer(e),this._initEvents(e),this._historic=!1,this._historicName="GPsearch-"+e.historic,e.historic!==!1&&this.searchService.get("autocomplete")!==!1){this._historic=[];try{const i=window.localStorage.getItem(this._historicName);i&&(this._historic=JSON.parse(i))}catch{}}this.showHistoric()}initialize(e){e.minChars=e.minChars?e.minChars:3,e.maximumEntries=typeof e.maximumEntries=="number"?e.maximumEntries:5,e.historic=typeof e.historic=="string"?e.historic:this.CLASSNAME,e.title=e.title?e.title:"Rechercher",e.ariaLabel=e.ariaLabel?e.ariaLabel:"Rechercher",e.placeholder=e.placeholder?e.placeholder:"",e.searchService=e.searchService?e.searchService:new DefaultSearchService,e.label=e.label?e.label:"",e.hint=e.hint?e.hint:"",e.search=e.search===!0,e.searchButton=e.searchButton===!0,e.collapsible=e.collapsible===!0,this.set("maximumEntries",e.maximumEntries)}_initEvents(e){this.searchService.get("autocomplete")!==!1&&(this.input.addEventListener("input",(function(i){i.target.value.length>0?i.target.dataset.erase=!0:delete i.target.dataset.erase,console.log("input",i,i.target.value),i.target.value||this.showHistoric()}).bind(this)),this.input.addEventListener("keydown",(function(i){/ArrowDown|ArrowUp/.test(i.key)&&i.preventDefault()}).bind(this)),this.input.addEventListener("keyup",(function(i){const n=Array.from(this.autocompleteList.querySelectorAll("li"));let o=n.findIndex(l=>l.classList.contains("active"));switch(o===-1&&(this._previousValue=i.target.value),i.key){case"ArrowDown":case"ArrowUp":if(i.preventDefault(),n.length===0)return;if(n.forEach(l=>l.classList.remove("active")),i.key==="ArrowDown"?(o++,o>=n.length&&(o=-1)):i.key==="ArrowUp"&&(o--,o<-1&&(o=n.length-1)),o!==-1){const l=n[o];l.classList.add("active"),this.input.value=l.innerText,this.input.setAttribute("aria-activedescendant",l.id),this.input.setAttribute("data-active-option",l.id)}else i.target.value=this._previousValue;this.input.dispatchEvent(new Event("input"));break;default:i.target.value.length&&i.target.value.length>=e.minChars&&i.target.value!==this._currentValue&&this.autocomplete(i.target.value);break}this._currentValue=i.target.value}).bind(this),!1)),this.container.addEventListener("submit",(function(i){i.preventDefault();const n=Array.from(this.autocompleteList.querySelectorAll("li"));if(i&&i.submitter&&i.submitter.type==="submit"&&i.target.querySelector("input").value.length<e.minChars)return!1;let o=n.findIndex(c=>c.classList.contains("active")),l=n[o];o<0&&(l=n[0]),l&&l.click()}).bind(this))}_initContainer(e){const i=this.element=document.createElement("div");i.className="GPwidget gpf-widget",i.id=Helper.getUid("GPsearchEngine-");const n=this.container=document.createElement("form");n.className=e.search?"GPSearchBar":"",n.id=Helper.getUid("GPsearchInput-Base-"),!e.target&&e.collapsible&&(this.button=document.createElement("button"),this.button.id=Helper.getUid("GPshowSearchEnginePicto-"),this.button.className="GPshowOpen GPshowAdvancedToolPicto GPshowSearchEnginePicto gpf-btn fr-icon-search-line fr-btn fr-btn--lg",this.button.setAttribute("aria-pressed","true"),e.title&&this.button.setAttribute("title",e.title),e.collapsible&&this.button.addEventListener("click",(function(){i.classList.toggle("ol-collapsed");const H=this.button.getAttribute("aria-pressed")==="true";this.button.setAttribute("aria-pressed",!H),H?l.blur():l.focus()}).bind(this)),i.appendChild(this.button)),i.appendChild(n);const o=document.createElement("div");o.className="GPInputGroup",o.classList.add(e.search?"fr-input":"fr-input-group"),n.appendChild(o);const l=this.input=document.createElement("input");if(l.type="text",l.className="GPsearchInputText fr-input",l.id=Helper.getUid("GPsearchInputText-"),l.placeholder=e.placeholder,l.autocomplete="off",l.setAttribute("aria-label",e.ariaLabel),e.label){const H=document.createElement("label");if(H.className="GPLabel fr-label",H.textContent=e.label,H.htmlFor=l.id,e.hint){const Y=document.createElement("span");Y.className="GPLabelHint fr-hint-text",Y.textContent=e.hint,H.appendChild(Y)}o.appendChild(H)}o.appendChild(l);const c=document.createElement("div");if(c.className="GPMessagesGroup fr-messages-group",c.ariaLive="polite",c.id=Helper.getUid("GPMessagesGroup-"),l.setAttribute("aria-describedby",c.id),o.appendChild(c),this.optionscontainer=document.createElement("div"),this.optionscontainer.className="GPOptionsContainer",o.appendChild(this.optionscontainer),e.searchButton){const H=this.subimtBt=document.createElement("button");H.className="GPsearchInputSubmit gpf-btn fr-icon-search-line fr-btn",H.id=Helper.getUid("GPshowSearchEnginePicto-"),H.type="submit",e.title&&H.setAttribute("title",e.title),n.appendChild(H)}const u=this.acContainer=document.createElement("div");u.id=Helper.getUid("GPautoCompleteContainer-"),u.className="GPautoCompleteContainer GPelementHidden gpf-hidden",i.appendChild(u);const h=this.autocompleteHeader=document.createElement("div");h.className="GPautoCompleteHeader",u.appendChild(h);const f=this.autocompleteList=document.createElement("ul");f.className="GPautoCompleteList",f.id=Helper.getUid("GPautoCompleteList-"),f.setAttribute("role","listbox"),f.setAttribute("tabindex","-1"),f.setAttribute("aria-label","Propositions"),u.appendChild(f);const g=this.autocompleteFooter=document.createElement("div");g.className="GPautoCompleteFooter",u.appendChild(g),l.setAttribute("role","combobox"),l.setAttribute("aria-controls",u.id),l.setAttribute("aria-expanded","false"),l.setAttribute("aria-autocomplete","list"),l.setAttribute("aria-haspopup","listbox"),this.searchService.get("autocomplete")!==!1&&(l.addEventListener("focus",()=>{l.setAttribute("aria-expanded","true"),u.classList.add("gpf-visible"),u.classList.remove("gpf-hidden"),u.classList.add("GPelementVisible"),u.classList.remove("GPelementHidden")}),l.addEventListener("blur",H=>{H.relatedTarget&&u.contains(H.relatedTarget)?H.relatedTarget.tagName!=="BUTTON"?l.focus():H.relatedTarget.addEventListener("blur",Y=>{var ee;Y.relatedTarget&&u.contains(Y.relatedTarget)||Y.relatedTarget===l?l.focus():(l.value.length===0&&(delete l.dataset.erase,(ee=Y.relatedTarget.parentNode.querySelector("button"))==null||ee.focus()),setTimeout(()=>{l.setAttribute("aria-expanded","false"),u.classList.remove("gpf-visible"),u.classList.add("gpf-hidden"),u.classList.remove("GPelementVisible"),u.classList.add("GPelementHidden")},50))},{once:!0}):(l.value.length===0&&delete l.dataset.erase,setTimeout(()=>{l.setAttribute("aria-expanded","false"),u.classList.remove("gpf-visible"),u.classList.add("gpf-hidden"),u.classList.remove("GPelementVisible"),u.classList.add("GPelementHidden")},50))}))}setActive(e){this.input.disabled=!!e,this.subimtBt.disabled=!!e}autocomplete(e){clearTimeout(this._completeDelay),this._completeDelay=setTimeout((function(){this.searchService.autocomplete(e)}).bind(this),this.get("triggerDelay")||100)}onAutocomplete(e){clearTimeout(this._completeDelay),this._updateList(e.result),this.dispatchEvent(e)}search(e){clearTimeout(this._completeDelay),this._completeDelay=setTimeout((function(){this.searchService.search(e)}).bind(this),this.get("triggerDelay")||100)}onSearch(e){clearTimeout(this._completeDelay),this.dispatchEvent(e)}select(e){clearTimeout(this._completeDelay);const i=this.getItemTitle(e);this.input.value=i,this.input.dispatchEvent(new Event("input")),this._currentValue=i,this._updateHistoric(e),this._updateList(),this.dispatchEvent({type:"select",title:this.getItemTitle(e),item:e})}showHistoric(){clearTimeout(this._completeDelay),this._historic&&this._updateList(this._historic.length?this._historic:[],"history")}_updateList(e,i="search"){this.autocompleteList.parentNode.dataset.type=i,e=(e||[]).slice(0,this.get("maximumEntries")),this.autocompleteList.querySelectorAll("li").forEach(n=>n.classList.remove("active")),this.input.setAttribute("aria-activedescendant",""),this.input.setAttribute("data-active-option",""),this.autocompleteList.innerHTML="",e.forEach((n,o)=>{const l=document.createElement("li"),c=this.getIconClass(n,i);if(l.id=Helper.getUid("GPsearchResult-"),l.className=`GPsearchResult gpf-panel__item gpf-panel__item-searchengine ${c} fr-icon--sm`,l.setAttribute("role","option"),l.setAttribute("data-idx",o),l.innerHTML=l.title=this.getItemTitle(n),i==="history"){l.classList.add("GPsearchHistoric");const u=document.createElement("span");u.ariaHidden="true",u.className=`${history$1} fr-icon--sm`,l.append(u)}this.autocompleteList.appendChild(l),l.addEventListener("click",(function(u){const h=Number(u.target.getAttribute("data-idx"));this.select(e[h]),this.search({location:e[h]})}).bind(this))})}getIconClass(e,i){let n=typeClasses[e.type];if(typeof n=="object"){for(let o=0;o<e.poiType.length;o++){const l=e.poiType[o];if(Object.hasOwn(n,l)){n=n[l];break}}if(typeof n=="object")for(let o=0;o<e.poiType.length;o++){const l=e.poiType[o];if(Object.hasOwn(n,l)){n=n[l];break}}n=typeof n=="object"?defaultIcon:n}return n}getItemTitle(e){return this.searchService.getItemTitle(e)}_updateHistoric(e){if(this._historic){let i=-1;for(let o=0;o<this._historic.length;o++){const l=this._historic[o];if(this._isEqual(l,e)){i=o;break}}i!==-1&&this._historic.splice(i,1),this._historic.unshift(e)>this.get("maximumEntries")&&this._historic.pop(),localStorage.setItem(this._historicName,JSON.stringify(this._historic))}}_isEqual(e,i){const n=JSON.stringify(e),o=JSON.stringify(i);return n===o}addMessage(e,i="error"){var o;let n=this.input.ariaDescribedByElements[0];if(n){const l=document.createElement("p"),c=i==="error"?"error":"valid";l.className=`GPMessage GPMessage--${c} fr-message fr-message--${c}`,l.id=Helper.getUid("GPMessage-"),l.textContent=e,(o=n.parentElement)==null||o.classList.forEach(u=>{var h;/^fr-.*-group$/.test(u)&&((h=n.parentElement)==null||h.classList.add(`${u}--${c}`))}),n.replaceChildren(l)}}removeMessages(){var i;let e=this.input.ariaDescribedByElements[0];e&&(e.replaceChildren(),(i=e.parentElement)==null||i.classList.forEach(n=>{var o;/^fr-.*-group--/.test(n)&&((o=e.parentElement)==null||o.classList.remove(n))}))}}window.ol&&window.ol.control&&(window.ol.control.SearchEngineBase=SearchEngineBase);var logger$x=LoggerByDefault.getLogger("searchengine");class IGNSearchService extends AbstractSearchService{constructor(e){if(e=e||{},super(e),!(this instanceof IGNSearchService))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="IGNSearchService",this}initialize(e){super.initialize(e),this.options={searchOptions:{maximumEntries:5,serviceOptions:{maximumResponses:10},filterLayers:!0},geocodeOptions:{serviceOptions:{}},autocomplete:!0,autocompleteOptions:{serviceOptions:{maximumResponses:10},triggerGeocode:!1,triggerDelay:1e3,prettifyResults:!0}},Helper.mergeParams(this.options,e),this.options.searchOptions&&(this.options.searchOptions.serviceOptions&&(this.options.searchOptions.serviceOptions.url&&Search$1.setUrl(this.options.searchOptions.serviceOptions.url),this.options.searchOptions.serviceOptions.fields&&Search$1.setFields(this.options.searchOptions.serviceOptions.fields),this.options.searchOptions.serviceOptions.index&&Search$1.setIndex(this.options.searchOptions.serviceOptions.index),this.options.searchOptions.serviceOptions.size&&Search$1.setSize(this.options.searchOptions.serviceOptions.size),this.options.searchOptions.serviceOptions.maximumResponses&&Search$1.setMaximumResponses(this.options.searchOptions.serviceOptions.maximumResponses)),this.options.searchOptions.filterServices&&Search$1.setFiltersByService(this.options.searchOptions.filterServices),this.options.searchOptions.filterLayersPriority&&Search$1.setFiltersByLayerPriority(this.options.searchOptions.filterLayersPriority),this.options.searchOptions.filterWMTSPriority&&Search$1.setFilterWMTSPriority(this.options.searchOptions.filterWMTSPriority),this.options.searchOptions.filterTMS===!1&&Search$1.setFilterTMS(this.options.searchOptions.filterTMS),this.options.searchOptions.filterProjections&&Search$1.setFiltersByProjection(this.options.searchOptions.filterProjections)),Search$1.target.addEventListener("suggest",i=>{logger$x.debug(i);let n=i.detail;n=this._filterResultsFromConfigLayers(n),this._fillSearchedSuggestListContainer(n)}),this._currentGeocodingLocation,this._suggestedLocations}autocomplete(e){e&&(this._currentGeocodingLocation=e,this._requestAutoComplete({text:e,onSuccess:this._onSuccessAutoComplete.bind(this),onFailure:this._onFailureAutoComplete.bind(this)}))}getItemTitle(e){return e.fullText}_requestAutoComplete(e){if(!e||typeof e=="object"&&Object.keys(e).length===0||!e.text)return;logger$x.log(e);let i={};Helper.assign(i,this.options.autocompleteOptions.serviceOptions),Helper.assign(i,e),i.apiKey=i.apiKey||this.options.apiKey,typeof i.ssl!="boolean"&&(typeof this.options.ssl=="boolean"?i.ssl=this.options.ssl:i.ssl=!0),logger$x.log(i),Gp.Services.autoComplete(i)}_onSuccessAutoComplete(e){let i=this.options.autocompleteOptions.maximumEntries,n=this.options.autocompleteOptions.prettifyResults;if(logger$x.log("request from AutoComplete",e),e){this._suggestedLocations=e.suggestedLocations,this._autocompleteLocations=[];for(let o=0;o<this._suggestedLocations.length;o++){let l=this._suggestedLocations[o];l.position&&l.position.x===0&&l.position.y===0&&l.fullText?this._getGeocodeCoordinatesFromFullText(l,o):this._autocompleteLocations.push(l)}n===!0&&this._prettifyAutocompleteResults(this._autocompleteLocations),i&&(this._autocompleteLocations=this._autocompleteLocations.slice(0,i)),this._triggerHandler&&(clearTimeout(this._triggerHandler),this._triggerHandler=null,logger$x.warn("Cancel a geocode request !")),this.dispatchEvent({type:this.AUTOCOMPLETE_EVENT,result:this._autocompleteLocations})}}_onFailureAutoComplete(e){let i=this.options.autocompleteOptions.triggerGeocode,n=this.options.autocompleteOptions.triggerDelay,o=function(l){if(logger$x.log("request from Geocoding",l),l){this._clearResults();let c=l.locations;for(let u=0;u<c.length;u++){let h=c[u];h.fullText=GeocodeUtils.getGeocodedLocationFreeform(h),h.position={x:h.position.lon,y:h.position.lat},this._autocompleteLocations.push(h)}}this.dispatchEvent({type:this.AUTOCOMPLETE_EVENT,result:this._autocompleteLocations})};this._clearResults(),logger$x.log(e.message),e.message==="No suggestion matching the search"&&i&&(this._triggerHandler&&(clearTimeout(this._triggerHandler),logger$x.warn("Cancel the last geocode request !")),this._triggerHandler=setTimeout(function(){logger$x.warn("Launch a geocode request !"),this._requestGeocoding({location:value,onSuccess:o.bind(this),onFailure:function(l){logger$x.log(l.message)}})},n))}_prettifyAutocompleteResults(e){for(let i=e.length-1;i>=0;i--){const n=e[i];(n.type==="StreetAddress"&&n.kind==="municipality"||n.type==="PositionOfInterest"&&n.poiType[0]==="lieu-dit habit"&&n.poiType[1]==="zone d'habitation")&&e.splice(i,1),n.type==="PositionOfInterest"&&n.poiType[0]==="administratif"&&(n.poiType[1]==="dpartement"||n.poiType[1]==="rgion")&&(n.fullText=n.fullText+", "+n.poiType[1])}}_getGeocodeCoordinatesFromFullText(e,i){var n=this;Gp.Services.geocode({apiKey:this.options.apiKey,ssl:this.options.ssl,q:GeocodeUtils.getSuggestedLocationFreeform(e),index:e.type,onSuccess:function(o){logger$x.log("request from Geocoding (coordinates null)",o),o.locations&&o.locations.length!==0&&o.locations[0].position&&n._suggestedLocations&&n._suggestedLocations[i]&&(n._suggestedLocations[i].position={lon:o.locations[0].position.y,lat:o.locations[0].position.x},n._locationsToBeDisplayed.unshift(n._suggestedLocations[i]),n._fillAutoCompletedLocationListContainer(n._locationsToBeDisplayed))},onFailure:function(){n._suggestedLocations&&n._suggestedLocations[i]&&n._createAutoCompletedLocationElement(n._suggestedLocations[i],i)}})}_clearResults(){this._autocompleteLocations=[],this._locations=[]}search(e){const i=e.location,n=e.filters?e.filters:{};if(i===void 0)return;let o,l=this.get("index"),c=this.get("returnTrueGeometry");if(typeof i=="string")o=i;else{if(l=i.type?i.type:l,o=GeocodeUtils.getSuggestedLocationFreeform(i),i.type==="PositionOfInterest"&&i.poiType[0]==="administratif"&&(i.poiType[1]==="dpartement"||i.poiType[1]==="rgion")&&(o=o.substring(0,o.length-(i.poiType[1].length+2))),l==="PositionOfInterest"){let u=i.poiType[0];u==="administratif"&&i.poiType[1]&&(u=i.poiType[1]),n.category=u||null,c=!1;const h=["administratif","dpartement","construction","hydrographie"];for(let f=0;f<i.poiType.length;f++){const g=i.poiType[f];if(g!=="lieu-dit habit"&&h.includes(g)){c=!0;break}}}n.postalCode=i.postalCode?i.postalCode:null;for(const u in n)Object.hasOwn(n,u)&&n[u]===null&&delete n[u]}this._requestGeocoding({index:l,limit:this.get("limit"),returnTrueGeometry:c,location:o,filters:n,onSuccess:this._onSuccessSearch.bind(this),onFailure:this._onFailureSearch.bind(this,i)}),this._currentGeocodingLocation=o}_requestGeocoding(e){if(!(!e||typeof e=="object"&&Object.keys(e).length===0)){logger$x.log(e);var i={};Helper.assign(i,this.options.geocodeOptions.serviceOptions),Helper.assign(i,e),i.maximumResponses=e.limit;var n=this.options.geocodeOptions.serviceOptions.onSuccess!==null&&typeof this.options.geocodeOptions.serviceOptions.onSuccess=="function";if(n){var o=function(u){e.onSuccess.bind(this,u),this.options.geocodeOptions.serviceOptions.onSuccess.bind(this,u)};i.onSuccess=o.bind(this)}var l=this.options.geocodeOptions.serviceOptions.onFailure!==null&&typeof this.options.geocodeOptions.serviceOptions.onFailure=="function";if(l){var c=function(u){e.onFailure.bind(this,u),this.options.geocodeOptions.serviceOptions.onFailure.bind(this,u)};i.onFailure=c.bind(this)}i.apiKey=i.apiKey||this.options.apiKey,typeof i.ssl!="boolean"&&(typeof this.options.ssl=="boolean"?i.ssl=this.options.ssl:i.ssl=!0),logger$x.log(i),Gp.Services.geocode(i)}}getResultFeatures(e){let i=this.getResult(e);if(!i)return{featureFilter:null,extent:null};let n=[i.position.lon,i.position.lat],o,l;if(i.placeAttributes.truegeometry){let c=i.placeAttributes.truegeometry;typeof c=="string"&&(c=JSON.parse(c));let h=new GeoJSON$1().readGeometry(c,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});if(c.type!=="Point"&&c.type!=="MultiPoint"){l=new Feature({geometry:h});const f=new Point$1(n);f.transform("EPSG:4326","EPSG:3857"),o=new Feature({geometry:f})}else l=null,o=new Feature({geometry:h})}else{const c=new Point$1(n);c.transform("EPSG:4326","EPSG:3857"),o=new Feature({geometry:c})}return l&&l.set("infoPopup",this._currentGeocodingLocation),o.set("infoPopup",this._currentGeocodingLocation),{feature:o,extent:l}}_onSuccessSearch(e){this._locations=e.locations;const i=this.getResultFeatures(0);this.dispatchEvent({type:this.SEARCH_EVENT,result:i.feature,extent:i.extent,nbResults:e.locations.length})}_onFailureSearch(e,i){if(logger$x.warn(i),!e||!e.position){this.dispatchEvent({type:this.ERROR_EVENT,location:e,error:i});return}let n=[e.position.x,e.position.y];const o=new Point$1(n);let l=new Feature({geometry:o});l.set("infoPopup",this._currentGeocodingLocation),this.dispatchEvent({type:this.SEARCH_EVENT,result:l})}}window.ol&&(window.ol.service||(window.ol.service={}),window.ol.service.IGNSearchService=IGNSearchService);LoggerByDefault.getLogger("searchengine");class SearchEngineGeocodeIGN extends SearchEngineBase{constructor(e){return e=e||{},super(e),this}initialize(e){this.CLASSNAME="SearchEngineGeocodeIGN",this.REMOVE_FEATURE_EVENT="remove:feature",e.serviceOptions=e.serviceOptions?e.serviceOptions:{},e.autocomplete===!1&&(this.set("autocomplete",!1),e.serviceOptions.autocomplete=!1),e.serviceOptions.returnTrueGeometry=!!e.returnTrueGeometry,(!e.searchService||!(e.searchService instanceof AbstractSearchService))&&(e.searchService=new IGNSearchService(e.serviceOptions)),super.initialize(e)}_initEvents(e){super._initEvents(e)}}window.ol&&window.ol.control&&(window.ol.control.SearchEngineGeocodeIGN=SearchEngineGeocodeIGN);const mapPinIcon="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20width='40'%20height='40'%20fill='%23ffffff'%3e%3cpath%20d='M18.364%2017.364L12%2023.7279L5.63604%2017.364C2.12132%2013.8492%202.12132%208.15076%205.63604%204.63604C9.15076%201.12132%2014.8492%201.12132%2018.364%204.63604C21.8787%208.15076%2021.8787%2013.8492%2018.364%2017.364ZM12%2013C13.1046%2013%2014%2012.1046%2014%2011C14%209.89543%2013.1046%209%2012%209C10.8954%209%2010%209.89543%2010%2011C10%2012.1046%2010.8954%2013%2012%2013Z'%3e%3c/path%3e%3c/svg%3e";LoggerByDefault.getLogger("abstractAdvancedSearch");class AbstractAdvancedSearch extends ControlExtended{constructor(e){e=e||{},super(e),this.CLASSNAME="AbstractAdvancedSearch",this.initialize(e),this.element=this._initContainer(e),this._initEvents(e)}setMap(e){super.setMap(e),this.inputs.forEach(i=>{i.setMap&&i.setMap(e)}),this.element.appendChild(this.btnGroup)}initialize(e){if(e.name)this.name=e.name;else throw new SyntaxError("`name` is mandatory");this.inputs=[]}getName(){return this.name}getContent(){return this.element}_initContainer(e){let i=document.createElement("form");i.className="GPForm gpf-advanced-search-form",i.id=Helper.getUid("GPAdvancedForm-"+this.CLASSNAME+"-");let n=document.createElement("fieldset");n.className="GPFieldset fr-fieldset gpf-advanced-search-fieldset",n.id=Helper.getUid("GPAdvancedFieldset-"),this.addInputs(),this.inputs.forEach(u=>{u instanceof ControlExtended?u.setTarget(i):i.appendChild(u)});const o=this.btnGroup=document.createElement("div");o.className="GPFormFooter";const l=this.eraseBtn=document.createElement("button");l.type="reset",l.className="GPBtn gpf-btn fr-btn fr-btn--tertiary",l.id=Helper.getUid("GPEraseBtn-"),l.textContent="Effacer";const c=this.searchBtn=document.createElement("button");return c.className="GPBtn gpf-btn fr-btn",c.id=Helper.getUid("GPSearchBtn-"),c.type="submit",c.textContent="Rechercher",c.setAttribute("form",i.id),o.appendChild(l),o.appendChild(c),i.appendChild(o),i}addInputs(){}_initEvents(e){this.eraseBtn.onclick=this._onErase.bind(this),this.element.onsubmit=this._onSearch.bind(this)}_onErase(e){e.preventDefault(),this.getContent().querySelectorAll("input").forEach(i=>{i.value=""})}_onSearch(e){e.preventDefault()}}window.ol&&window.ol.control&&(window.ol.control.AbstractAdvancedSearch=AbstractAdvancedSearch);function getStyle(s,e,i=0){return new Style$1({image:new Icon({src:mapPinIcon,color:s,anchor:[.5,1]}),stroke:new Stroke({color:s,lineDash:[8,8],width:2,lineDashOffset:i}),fill:new Fill({color:e||"rgba(0, 0, 0, 0.1)"})})}class SearchEngineAdvanced extends ControlExtended{constructor(e){e=e||{},super(e),this.geolocation=new Geolocation({trackingOptions:{enableHighAccuracy:!0},projection:"EPSG:4326"}),this.layer=new VectorLayer({source:new VectorSource({}),zIndex:1/0,style:[getStyle([255,255,255,1]),getStyle([0,0,145,1],null,8)]}),this.selectInteraction=new Select({layers:[this.layer],style:getStyle([145,0,0,1],[145,0,0,.2])}),this.initialize(e),this._initContainer(e),this._initEvents(e),e.popupButtons=e.popupButtons?e.popupButtons:[],this.selectInteraction.on("select",this._onSelectElement.bind(this)),this.popup=this._createPopup(e.popupButtons)}initialize(e){this.CLASSNAME="SearchEngineAdvanced",this._searchForms,this.listenToClick=!1,e.advancedSearch&&e.advancedSearch instanceof Array?this._searchForms=e.advancedSearch:this._searchForms=[],this._searchForms.forEach(i=>{i.on("search",this.onAdvancedSearchResult.bind(this))})}setMap(e){this.getMap()&&this.baseSearchEngine&&this.getMap().removeControl(this.baseSearchEngine),super.setMap(e),this.baseSearchEngine&&this.baseSearchEngine.setMap(e),this._searchForms.forEach(i=>{i.setMap(e)}),this.element.appendChild(this.advancedContainer),e&&(this.layer.setMap(e),e.addInteraction(this.selectInteraction),e.addOverlay(this.popup))}getLayer(){return this.layer}_initEvents(e){this.geolocation.on("change:position",()=>{const i=new Point$1(this.geolocation.getPosition());i.transform("EPSG:4326",this.getMap().getView().getProjection());const n=this.createEvent(i,"Ma localisation");this.addResultToMap(n),this.dispatchEvent(n),this.geolocation.setTracking(!1)}),this.baseSearchEngine.input.addEventListener("keydown",(function(i){i.key==="Tab"&&!i.shiftKey&&this.locationBtn.checkVisibility()&&(i.preventDefault(),this.locationBtn.focus())}).bind(this)),this.locationBtn.addEventListener("keydown",(function(i){i.key==="Tab"&&(i.preventDefault(),i.shiftKey?this.baseSearchEngine.input.focus():this.advancedBtn.checkVisibility()?this.advancedBtn.focus():this.eraseBtn.focus())}).bind(this)),this.on("search",this.addResultToMap.bind(this)),["mousedown","focusin"].map(i=>document.addEventListener(i,this._onDocumentClick.bind(this))),this.advancedBtn.addEventListener("blur",(function(i){i.relatedTarget===this.baseSearchEngine.input&&(this.listenToClick=!1,this.advancedBtn.setAttribute("aria-expanded",!1))}).bind(this)),this.baseSearchEngine.input.addEventListener("blur",(function(i){i.relatedTarget&&i.relatedTarget===this.eraseBtn&&i.target.dispatchEvent(new Event("input"))}).bind(this))}createEvent(e,i){let n=e;return e instanceof Feature?n={result:e,extent:null}:e instanceof Point$1&&(n={result:new Feature(e),extent:null}),i&&n.result.set("infoPopup",i),n.type="search",n}_initContainer(e){const i=this.element=document.createElement("div");i.className="GPwidget gpf-widget",i.id=Helper.getUid("GPsearchEngine-Advanced-"),e.target=this.element,e.searchButton=!0,e.search=!0,this.baseSearchEngine=new SearchEngineGeocodeIGN(e),this.baseSearchEngine.on(["select","search","autocomplete"],c=>{this.dispatchEvent(c)}),this.locationBtn=this._getGeolocButton(),this.baseSearchEngine.autocompleteHeader.appendChild(this.locationBtn);const n=this.advancedBtn=document.createElement("button");n.className="GPSearchEngine-advanced-btn fr-btn fr-btn--sm fr-icon-arrow-up-s-line fr-btn--icon-right fr-btn--tertiary-no-outline",n.id=Helper.getUid("GPSearchEngine-advanced-btn-"),n.type="button",n.title="Avance",n.innerHTML="Avance",n.setAttribute("aria-label","Afficher les options avances"),n.setAttribute("aria-expanded","false");const o=this.advancedContainer=document.createElement("div");o.className="GPAdvancedContainer",o.id=Helper.getUid("GPsearchEngine-AdvancedContainer-"),o.setAttribute("aria-labelledby",n.id),o.appendChild(this._getGeolocButton()),this._searchForms.forEach(c=>{const u=document.createElement("section");u.className="fr-accordion",o.appendChild(u);const h=document.createElement("h3");h.className="fr-accordion__title",u.appendChild(h);const f=document.createElement("button");f.type="button",f.className="fr-accordion__btn",f.setAttribute("aria-expanded","false"),f.innerText=c.getName(),h.appendChild(f);const g=document.createElement("div");g.className="fr-collapse",g.id=Helper.getUid("accordion-"),f.setAttribute("aria-controls",g.id),u.appendChild(g),c.setTarget(g),f.addEventListener("click",()=>{const H=f.getAttribute("aria-expanded")==="true";o.querySelectorAll("section").forEach(Y=>{Y.querySelector(".fr-collapse").classList.remove("fr-collapse--expanded"),Y.querySelector("button").setAttribute("aria-expanded","false"),o.dataset.open=!H,H?Y.classList.remove("fr-hidden"):Y.classList.add("fr-hidden")}),H||(f.setAttribute("aria-expanded","true"),g.classList.add("fr-collapse--expanded"),u.classList.remove("fr-hidden")),c.dispatchEvent({type:"expand",expanded:!H})})}),n.setAttribute("aria-controls",o.id),n.addEventListener("click",(function(c){c.preventDefault();const u=n.getAttribute("aria-expanded")==="false";if(n.setAttribute("aria-expanded",u),this.listenToClick=u,u){const h=["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","[tabindex]:not([tabindex='-1'])"].join(","),f=o.querySelector(h);f&&f.focus()}}).bind(this)),this._searchForms.length&&this.baseSearchEngine.optionscontainer.appendChild(n);const l=this.eraseBtn=document.createElement("button");l.className="GPSearchEngine-erase-btn fr-btn fr-btn--sm fr-icon-close-circle-fill fr-btn--tertiary-no-outline",l.id=Helper.getUid("GPSearchEngine-erase-btn-"),l.type="button",l.title="Effacer la saisie",l.setAttribute("aria-label","Effacer la saisie"),l.addEventListener("click",(function(){this.baseSearchEngine.input.value="",delete this.baseSearchEngine.input.dataset.empty,this.baseSearchEngine.input.dispatchEvent(new Event("input")),console.log("click"),setTimeout(()=>{this.baseSearchEngine.input.focus()},50)}).bind(this)),this.baseSearchEngine.optionscontainer.appendChild(l)}_onDocumentClick(e){if(this.listenToClick===!0){const i=this.advancedContainer===e.target||this.advancedContainer.contains(e.target),n=this.advancedBtn===e.target;i||n||(this.listenToClick=!1,this.advancedBtn.setAttribute("aria-expanded",!1))}}addResultToMap(e){this._closePopup(),this.layer.getSource().clear();let i;if(e.result&&(this.layer.getSource().addFeature(e.result),i=e.result.getGeometry().getExtent(),this.selectInteraction.getFeatures().push(e.result),this._setPopupInfo(e.result)),e.extent&&(this.layer.getSource().addFeature(e.extent),i=e.extent.getGeometry().getExtent()),this.getMap()){let n=this.getMap().getView();i&&(n.fit(i),n.getZoom()>15&&n.setZoom(15))}}_setPopupInfo(e,i){var n,o;if(e){this.popup.setPosition(void 0);let l=null;((n=e.getGeometry())==null?void 0:n.getType())==="Point"&&(i=(o=e.getGeometry())==null?void 0:o.getCoordinates(),l=[0,-20]),this.popup.setPosition(i),l&&this.popup.setOffset(l),this.setPopupContent(e.get("infoPopup")||""),this.popup.set("feature",e),this.popup.set("layer",this.layer)}else this.popup.setPosition(void 0),this.setPopupContent(""),this.popup.unset("feature"),this.popup.unset("layer")}_onSelectElement(e){let i=e.mapBrowserEvent.coordinate;this._setPopupInfo(e.selected.length?e.selected[0]:null,i)}_createPopup(e){let i=this._popupDiv=document.createElement("div");i.className="GPSearchPopup";let n=this._popupContent=document.createElement("div");n.className="GPPopupContent";let o=this._popupBtns=document.createElement("div");return o.className="GPButtonGroups gpf-btns-group",o.appendChild(this._addCloseButton()),o.appendChild(this._addRemoveButton()),e.forEach(c=>{o.appendChild(this._createCustomPopupButton(c))}),i.appendChild(n),i.appendChild(o),new Overlay({element:i,positioning:"bottom-center"})}setPopupContent(e){this._popupContent.innerHTML=e}_addCloseButton(){let e=document.createElement("button");return e.title=e.ariaLabel="Fermer la pop-up",e.textContent="Fermer",e.className="GPButton gpf-btn fr-icon-close-line fr-btn fr-btn--sm gpf-btn--tertiary  fr-btn--tertiary-no-outline",e.onclick=this._closePopup.bind(this),e}_closePopup(){return this.selectInteraction.getFeatures().clear(),this.popup!==null&&this.popup.setPosition(void 0),!1}_addRemoveButton(){let e=document.createElement("button");return e.title=e.ariaLabel="Supprimer le marqueur",e.textContent="Supprimer",e.className="GPButton gpf-btn fr-icon-delete-line fr-btn fr-btn--sm gpf-btn--tertiary fr-btn--tertiary-no-outline",e.onclick=this._removeFeature.bind(this),e}_removeFeature(){const e=this.popup.get("feature"),i=this.popup.get("layer");i&&e&&(i.getSource().removeFeature(e),this.dispatchEvent({type:this.REMOVE_FEATURE_EVENT,feature:e,layer:i}),this._closePopup())}_createCustomPopupButton(e){const i=document.createElement("button");return i.title=i.ariaLabel=e.label,i.className="GPButton fr-btn fr-btn--sm fr-btn--tertiary-no-outline ",e.className&&(i.className+=e.className),e.icon&&i.classList.add(e.icon),e.attributes&&Object.entries(e.attributes).forEach(([n,o])=>{i.setAttribute(n,o)}),i.onclick=()=>{const n=this.popup.get("feature");if(n&&typeof e.onClick=="function"){const o=n.clone();o.setStyle(void 0),e.onClick.call(this,o)&&(this._closePopup(),this.selectInteraction.getFeatures().clear(),this.layer.getSource().removeFeature(n))}},i}_getGeolocButton(){const e=document.createElement("button");return e.innerText="Me golocaliser",e.className="GPSearchEngine-locate fr-btn fr-btn--sm fr-icon-crosshair-2-line fr-btn--icon-left fr-btn--tertiary-no-outline",e.addEventListener("click",()=>{this.geolocation.setTracking(!0),console.log("tracking",this.geolocation)}),e}onAdvancedSearchResult(e){this.listenToClick=!1,this.advancedBtn.setAttribute("aria-expanded",!1),this.closeAllSections(),e.result instanceof Array||e.result instanceof Feature&&this.addResultToMap(e)}closeAllSections(){this.advancedContainer.dataset.open=!1,this.advancedContainer.querySelectorAll("section").forEach(e=>{const i=e.querySelector(".fr-accordion__title > button[aria-expanded]");i.setAttribute("aria-expanded","false"),i.ariaControlsElements[0].classList.remove("fr-collapse--expanded"),e.classList.remove("fr-hidden")})}}window.ol&&window.ol.control&&(window.ol.control.SearchEngineAdvanced=SearchEngineAdvanced);let logger$w=LoggerByDefault.getLogger("abstractAdvancedSearch");class CoordinateAdvancedSearch extends AbstractAdvancedSearch{constructor(e){super(e),this.element.dataset.unitType=this.get("unitType"),this.element.dataset.unit=this.unit.value}initialize(e){e.name||(e.name="Coordonnes"),super.initialize(e),this._initCoordinateSearchSystems(e),this._initCoordinateSearchUnits(e),this._boundOnLonLatBeforeInput=this._onlonLatBeforeInput.bind(this),this._boundOnLonLatInput=this._onlonLatInput.bind(this),this._currentCoordinateSystem=this._coordinateSearchSystems[0],this._currentUnit=this._coordinateSearchUnits[this._currentCoordinateSystem.type],this.set("unitType",this._currentCoordinateSystem.type),this.set("unit",this._currentUnit[0].code),this.CLASSNAME="CoordinateAdvancedSearch"}_initCoordinateSearchSystems(e){this._coordinateSearchSystems=[];let i=[{label:"Gographique",crs:"EPSG:4326",type:"Geographical"},{label:"Web Mercator",crs:"EPSG:3857",type:"Metric"},{label:"Lambert 93",crs:"EPSG:2154",type:"Metric"}];if(e&&e.coordinateSearch&&e.coordinateSearch.systems){let n=e.coordinateSearch.systems;for(let o=0;o<n.length;o++){let l=n[o];this._setSystem(l)}}if(this._coordinateSearchSystems.length===0)for(let n=0;n<i.length;n++)this._setSystem(i[n])}_initCoordinateSearchUnits(e){this._coordinateSearchUnits=[];let i={Geographical:[{code:"DEC",label:"Degrs dcimaux",format:MathUtils.coordinateToDecimal},{code:"DMS",label:"Degrs sexagsimaux",format:MathUtils.coordinateToDMS}],Metric:[{code:"M",label:"Mtres",format:MathUtils.coordinateToMeter},{code:"KM",label:"Kilomtres",format:MathUtils.coordinateToKMeter}]};if(e&&e.coordinateSearch&&e.coordinateSearch.units){let n=e.coordinateSearch.units;for(let o in i)if(i.hasOwnProperty(o)){let l=!1;for(let c=0;c<i[o].length;c++){let u=i[o][c];for(let h=0;h<n.length;h++){let f=n[h];u.code===f&&(l=!0,this._coordinateSearchUnits[o]||(this._coordinateSearchUnits[o]=[]),this._coordinateSearchUnits[o].push(u))}}l||(this._coordinateSearchUnits[o]=i[o])}}typeof this._coordinateSearchUnits=="object"&&Object.keys(this._coordinateSearchUnits).length===0&&(this._coordinateSearchUnits=i)}_setSystem(e){if(typeof e!="object"){logger$w.log("[ERROR] CoordinateAdvancedSearch:_setSystem - system parameter should be an object");return}if(!e.crs){logger$w.error("crs not defined !");return}if(e.label||(logger$w.warn("crs label not defined, use crs code by default."),e.label=e.crs),e.type||(logger$w.warn("type srs not defined, use 'Metric' by default."),e.type="Metric"),CRS.loadByName(e.crs),!get$3(e.crs)){logger$w.error("crs '{}' not available into proj4 definitions !",e.crs);return}for(var i=0;i<this._coordinateSearchSystems.length;i++){var n=this._coordinateSearchSystems[i];e.crs===n.crs&&logger$w.info("crs '{}' already configured",n.crs)}e.code=this._coordinateSearchSystems.length,this._coordinateSearchSystems.push(e)}_getLabelContainer(e,i,n,o=!1){const l=document.createElement("div");l.className=i;const c=this._createLabel(e,o);return l.appendChild(c),n&&(c.setAttribute("for",n.id),l.appendChild(n)),l}_createLabel(e,i=!1){const n=document.createElement("label");n.className="fr-label";const o=i?"*":"";return n.textContent=e+o,n}_updateLabel(e,i,n=!1){const o=i.querySelector("label"),l=n?"*":"";o.innerText=e+l}addInputs(){super.addInputs();const e=document.createElement("div"),i=document.createElement("span");i.className="GPLabelHint fr-hint-text",i.textContent="* Tous les champs sont obligatoires",e.appendChild(i),this.inputs.push(e);const n=this.system=document.createElement("select");n.className="fr-select",n.id=n.name=Helper.getUid("CoordinateAdvancedSearch-system-");const o=this._getLabelContainer("Systme de rfrence","fr-select-group",n,!0);this.inputs.push(o),this._coordinateSearchSystems.forEach((g,H)=>{const Y=document.createElement("option");Y.value=H,Y.selected=!H,Y.innerText=g.label,n.appendChild(Y)});const l=this.unit=document.createElement("select");l.className="fr-select",l.id=l.name=Helper.getUid("CoordinateAdvancedSearch-unit-");const c=this._getLabelContainer("Unit","fr-select-group",l,!0);this.inputs.push(c);for(let g=0;g<this._currentUnit.length;g++){const H=this._currentUnit[g],Y=document.createElement("option");Y.value=H.code?H.code:g,Y.textContent=H.label||g,l.appendChild(Y)}const u=this.lonLatInputs=document.createElement("div");u.className="GPLonLatInputs";const h=this.lon=this.createCoordinateInput("lon");u.appendChild(h);const f=this.lat=this.createCoordinateInput("lat");u.appendChild(f),this.inputs.push(u)}createCoordinateInput(e){const i=document.createElement("div");i.className="GPCoordinateWrapper";const n=e==="lon"?"Longitude":"Latitude",o=this._createLabel(n,!0);i.appendChild(o);const l=document.createElement("div");l.className="GPCoordinateInputs",i.appendChild(l);const c=document.createElement("div"),u=document.createElement("input");u.className="GPCoordinateInput fr-input",u.type="text",u.name=e,u.inputMode="numeric",u.autocomplete="off",u.required=!0,u.id=Helper.getUid(`CoordinateAdvancedSearch-${e}-`),c.appendChild(u),l.appendChild(c),o.setAttribute("for",u.id);const h=document.createElement("div");return h.className="display-mask",h.textContent=`____'__"`,c.appendChild(h),l.appendChild(this._createSelectCardinals(e)),i}_createSelectCardinals(e){const i={lon:["O","E"],lat:["N","S"]};if(i[e]){const n=document.createElement("select");return n.className="fr-select",n.id=n.name=Helper.getUid("CoordinateAdvancedSearch-cardinal-"),i[e].forEach(o=>{const l=document.createElement("option");l.value=l.textContent=o,n.appendChild(l)}),n}else return}_initEvents(e){super._initEvents(e),this.system.addEventListener("change",this._updateSystem.bind(this)),this.unit.addEventListener("change",this._updateUnits.bind(this)),this.on("change:unitType",this._updateInputsLabel.bind(this)),this.on("change:unit",this._updateInputs.bind(this))}_updateSystem(e){if(this._coordinateSearchSystems[e.target.value].crs!==this._currentCoordinateSystem.crs){this._currentCoordinateSystem=this._coordinateSearchSystems[e.target.value],this._currentUnit=this._coordinateSearchUnits[this._currentCoordinateSystem.type],this.unit.replaceChildren();for(let n=0;n<this._currentUnit.length;n++){const o=this._currentUnit[n],l=document.createElement("option");l.value=o.code?o.code:n,l.textContent=o.label||n,this.unit.appendChild(l)}e.target.closest("form").dataset.unit=this.unit.value,this.set("unit",this.unit.value),e.target.closest("form").dataset.unitType=this._currentCoordinateSystem.type,this.set("unitType",this._currentCoordinateSystem.type)}}_updateUnits(e){const i=e.target.value;this.get("unit")!==i&&(e.target.closest("form").dataset.unit=i,this.set("unit",i))}_updateInputsLabel(){const i=this.get("unitType")==="Geographical",n={lon:i?"Longitude":"X",lat:i?"Latitude":"Y"};this._updateLabel(n.lon,this.lon,!0),this._updateLabel(n.lat,this.lat,!0),this.lon.querySelector("input").value="",this.lat.querySelector("input").value=""}_updateInputs(){const e=this.get("unit");let i=1;this.get("unitType")==="Metric"&&(i=e==="KM"?.001:1e3),e==="DMS"?this.lonLatInputs.querySelectorAll("input").forEach(n=>{n.value="",n.minLength="6",n.maxLength="6",n.addEventListener("beforeinput",this._boundOnLonLatBeforeInput),n.addEventListener("input",this._boundOnLonLatInput)}):this.lonLatInputs.querySelectorAll("input").forEach(n=>{e==="DEC"?n.value="":n.value=n.value===""||isNaN(n.value)?"":parseFloat(n.value)*i,n.removeAttribute("minLength"),n.removeAttribute("maxLength"),n.removeEventListener("beforeinput",this._boundOnLonLatBeforeInput),n.removeEventListener("input",this._boundOnLonLatInput)}),this.getContent().querySelectorAll(".display-mask").forEach(n=>{n.textContent=`____'__"`})}_onlonLatBeforeInput(e){const i=/^\d+$/;e.inputType.startsWith("insert")&&e.inputType!="insertLineBreak"&&!i.test(e.data)&&e.preventDefault()}_format(e){const i=e.padEnd(6,"_");return`${i.slice(0,2)}${i.slice(2,4)}'${i.slice(4,6)}"`}_onlonLatInput(e){console.log("on lon lat inputs");const i=e.target.value,n=e.target.parentElement.querySelector(".display-mask");n.textContent=this._format(i)}_onSearch(e){super._onSearch(e);let i=this.lon.querySelector("input").value,n=this.lat.querySelector("input").value;this.get("unit")==="DMS"?(i=MathUtils.dmsToDecimal(parseInt(i.substring(0,2)),parseInt(i.substring(2,4)),parseInt(i.substring(4,6)),this.lon.querySelector("select").value),n=MathUtils.dmsToDecimal(parseInt(n.substring(0,2)),parseInt(n.substring(2,4)),parseInt(n.substring(4,6)),this.lat.querySelector("select").value)):this.get("unit")==="KM"?(i=parseFloat(i)*1e3,n=parseFloat(n)*1e3):(i=parseFloat(i),n=parseFloat(n));let o=[i,n];const l=this.getMap().getView().getProjection().getCode(),c=this._currentCoordinateSystem.crs;l!==c&&(o=transform$1(o,c,l));const u=new Point$1(o),h=new Feature({geometry:u});h.set("infoPopup",this._createInfoPopup(i,n)),this.dispatchEvent({type:"search",result:h})}_createInfoPopup(e,i){let n,o,l,c;if(this.get("unitType")==="Geographical")if(n="Longitude",o="Latitude",this.get("unit")==="DMS"){const h=this.lon.querySelector("input").value,f=this.lon.querySelector("select").value;l=`${parseInt(h.substring(0,2))}${parseInt(h.substring(2,4))}'${parseInt(h.substring(4,6))}" ${f}`;const g=this.lat.querySelector("input").value,H=this.lat.querySelector("select").value;c=`${parseInt(g.substring(0,2))}${parseInt(g.substring(2,4))}'${parseInt(g.substring(4,6))}" ${H}`}else l=`${e} `,c=`${i} `;else n="X",o="Y",l=`${e} ${this.get("unit").toLowerCase()}`,c=`${i} ${this.get("unit").toLowerCase()}`;return`<b>${n} : </b>${l}<br><b>${o} : </b>${c}`}_onErase(e){super._onErase(e),this.getContent().querySelectorAll(".display-mask").forEach(i=>{i.textContent=`____'__"`})}}window.ol&&window.ol.control&&(window.ol.control.CoordinateAdvancedSearch=CoordinateAdvancedSearch);LoggerByDefault.getLogger("searchengine");class InseeSearchService extends AbstractSearchService{constructor(e){e=e||{},e.autocomplete=!1,super(e),this.CLASSNAME="InseeSearchService",this.ignService=new IGNSearchService({autocomplete:!1,returnTrueGeometry:!0,index:"poi"}),this.ignService.on(this.SEARCH_EVENT,this._onSearch.bind(this))}autocomplete(){}search(e,i){const n=e.location;this._requestGeoAPI({value:n,arr:!!i}).then(l=>{if(l instanceof Array&&l.length){const c=l[0];let u=c.nom;c.nom.length<3&&(u=`${c.nom}, ${c.codesPostaux[0]}`);let h={category:"administratif",citycode:c.code};const f={location:u,filters:h};this.ignService.search(f)}else{if(/^(13|69|75)/.test(n)&&!i){this.search(e,!0);return}this._onSearch({type:this.SEARCH_EVENT})}})}_onSearch(e){this.dispatchEvent(e)}async _requestGeoAPI(e){const i="https://geo.api.gouv.fr/communes",n="json",o=["nom","code","codesPostaux"],l=e.arr;let c=`${i}?code=${e.value}&format=${n}&fields=${o}`;l&&(c+="&type=arrondissement-municipal");try{const u=await fetch(c,{headers:{"Content-Type":"application/json"}});if(!u.ok)throw new Error(`Response status: ${u.status}`);return await u.json()}catch(u){console.error(u.message)}}}window.ol&&(window.ol.service||(window.ol.service={}),window.ol.service.InseeSearchService=InseeSearchService);LoggerByDefault.getLogger("abstractAdvancedSearch");class InseeAdvancedSearch extends AbstractAdvancedSearch{constructor(e){super(e),this.inseeInput.on("search",(function(i){i.result?this.dispatchEvent(i):this.inseeInput.addMessage("Ce code INSEE est introuvable.")}).bind(this))}initialize(e){e.name||(e.name="Code INSEE"),super.initialize(e),this._inputPattern=/^(\d\d|2[A,B,a,b])\d{3}$/,this.CLASSNAME="InseeAdvancedSearch"}addInputs(){super.addInputs();let e=this.inseeInput=new SearchEngineGeocodeIGN({label:"Code INSEE",hint:"Format attendu INSEE : 5 chiffres, selon le code officiel gographique (COG)",searchService:new InseeSearchService({autocomplete:!1,searchOptions:{serviceOptions:{fields:["postcode"]}}})});this.inseeInput.input.title="Code INSEE sur 5 caractres",this.inputs.push(e)}_initEvents(e){super._initEvents(e),this.inseeInput.input.onkeydown=(function(i){i.key==="Enter"&&this.element.requestSubmit(this.searchBtn)}).bind(this)}_onErase(e){super._onErase(e),this.inseeInput.removeMessages()}_onSearch(e){super._onSearch(e);const i=this.inseeInput.input.value;this._inputPattern.test(i)?(this.inseeInput.removeMessages(),this.inseeInput.search({location:i,filters:{cityCode:i}})):this.inseeInput.addMessage("Le champs INSEE n'est pas valide (texte de 5 chiffres).")}}window.ol&&window.ol.control&&(window.ol.control.InseeAdvancedSearch=InseeAdvancedSearch);class LocationAdvancedSearch extends AbstractAdvancedSearch{constructor(e){e=e||{},e.name=e.name||"Lieux et toponymes",super(e),this.searchService=new IGNSearchService({index:"poi",limit:10,returnTrueGeometry:!0}),this.element.setAttribute("novalidate","")}_initEvents(e){super._initEvents(e),this.on("expand",i=>{i.expanded&&setTimeout(()=>this.searchInput.focus(),300),this.searchResult.innerHTML=""}),setTimeout(()=>{this.searchService.on("search",i=>this.handleSearch(i)),this.searchService.on("error",i=>this.handleError(i))})}handleError(e){this.handleSearch({nbResults:0})}handleSearch(e){if(e.multi||(this.searchResult.innerHTML=""),e.nbResults===1){const i=e.attr||this.searchService.getResult(0).placeAttributes;["postcode","citycode","city","category"].forEach(o=>{i[o]=i[o]||[]});const n={infoPopup:"<strong>"+i.toponym+"</strong><br/>"+(i.category?"<em>"+(i.category||[]).join(", ")+"</em><br/>":"")+(i.postcode?"Code postal : "+(i.postcode||[]).join(", ")+"<br/>":""),toponyme:i.toponym,postcode:i.postcode[0],postcodes:i.postcode.join(" - "),insee:i.citycode[0],citycodes:i.citycode.join(" - "),city:i.city[0],citys:i.city.join(" - "),category:i.category[0],categories:i.category.join(" - ")};e.result&&e.result.setProperties(n),e.extent&&e.extent.setProperties(n),console.log(e),this.dispatchEvent(e)}else if(this.element.parentElement.parentElement.scrollTop=0,e.nbResults===0){this.searchResult.innerHTML="";const i=document.createElement("li");i.className="fr-message--error",i.innerText="Aucun rsultat",this.searchInput.value||(i.innerText+=" : prcisez votre recherche en renseignant le lieu."),this.searchResult.appendChild(i),i.addEventListener("click",()=>{i.remove()})}else this.handleMultipleResults(e)}initialize(e){super.initialize(e),this.CLASSNAME="LocationAdvancedSearch",fetch("https://data.geopf.fr/geocodage/getCapabilities").then(n=>n.json()).then(n=>{const o=n.indexes.find(l=>l.id==="poi").fields.find(l=>l.name==="category").values;this._typeList=o,e.typeList||this.setCategories(o)}).catch(()=>{console.log("error")}),this._typeList={};const i=["administratif","arodrome","cimetire","construction ponctuelle","construction surfacique","cours d'eau"];this.set("typeList",e.typeList||i)}setCategories(e,i){i=i||this.element.querySelector("select[name='category']"),i.innerHTML="";let n=[];const o=Array.isArray(e);if(o)n=e;else if(typeof e=="object")n=Object.keys(e);else return;n.forEach(l=>{const c=document.createElement("option");c.value=l.toLowerCase(),c.innerText=l,i.appendChild(c),!o&&Array.isArray(e[l])&&(c.className="option",e[l].forEach(u=>{const h=document.createElement("option");h.value=u.toLowerCase(),h.className="subOption",h.innerHTML="&nbsp;&nbsp;"+u,i.appendChild(h)}))}),this.filter&&(i.value=this.filter.category,i.value||(i.selectedIndex=0,this.filter.category=i.value))}handleMultipleResults(e){const i=this.searchService.getResult();i.forEach((l,c)=>{const u=l.placeAttributes,h=document.createElement("li");h.className="search-result-item"+(c>=5?" hidden":""),this.searchResult.appendChild(h);const f=document.createElement("a");h.appendChild(f),f.className="fr-icon-map-pin-2-line",f.href="#";const g=u.postcode&&u.postcode[0]?`, ${u.postcode[0]}`:"",H=(u.toponym||"")+g+" ("+(u.category||[]).join(", ")+") - "+(u.city||[]).join(", ");f.title=f.innerText=H,h.addEventListener("click",()=>f.click()),f.addEventListener("click",Y=>{Y.preventDefault();const ee=this.searchService.getResultFeatures(c),te={type:"search",multi:!0,attr:u,extent:ee.extent,result:ee.feature,nbResults:1};this.searchService.dispatchEvent(te)})});const n=document.createElement("li");if(this.searchResult.appendChild(n),i.length>5){const l=document.createElement("button");l.className="fr-btn fr-btn--sm fr-btn--tertiary",l.innerText="Afficher plus de rsultats",l.addEventListener("click",()=>{l.remove(),this.searchResult.querySelectorAll(".hidden").forEach(c=>{c.classList.remove("hidden")})}),n.appendChild(l)}n.className="search-result-actions";const o=document.createElement("button");o.className="fr-btn fr-btn--sm fr-btn--tertiary",o.innerText="Effacer",o.addEventListener("click",()=>{this.searchResult.innerHTML="",this.element.parentElement.parentElement.scrollTop=0}),n.appendChild(o)}_getLabelContainer(e,i,n,o=""){const l=document.createElement("div");l.className=i,this.inputs.push(l);const c=document.createElement("label");c.className="fr-label";let u=e;o&&(u=`${e} <span class="fr-hint-text">${o}</span>`),c.innerHTML=u,l.appendChild(c),n&&(c.setAttribute("for",n.id),l.appendChild(n));const h=document.createElement("div");return h.className="GPMessagesGroup fr-messages-group",l.appendChild(h),l}addInputs(){super.addInputs(),this.searchResult=document.createElement("ul"),this.searchResult.className="search-result",this.inputs.push(this.searchResult);const e=document.createElement("legend");e.className="fr-fieldset__legend fr-fieldset__legend--regular",e.id=Helper.getUid("LocationAdvancedSearch-legend-");const i=document.createElement("span");i.className="fr-hint-text",i.textContent="* Champs obligatoires",e.appendChild(i),this.inputs.push(e);const n=document.createElement("select");n.className="fr-select",n.id=Helper.getUid("LocationAdvancedSearch-type-"),n.name="category",this._getLabelContainer("Type","fr-select-group",n),this.setCategories(this.get("typeList"),n),n.addEventListener("change",()=>{this.filter.category=n.value});const o=this.searchInput=document.createElement("input");o.className="fr-input",o.type="text",o.name="search",o.setAttribute("minlength","3"),o.required=!0,o.id=Helper.getUid("LocationAdvancedSearch-search-"),this._getLabelContainer("Renseigner un lieu *","fr-input-group",o,null);const l=document.createElement("input");l.className="fr-input",l.type="text",l.name="postalCode",l.pattern="^(\\d{5})$",l.title="Code postal  5 chiffres",l.id=Helper.getUid("LocationAdvancedSearch-postal-"),this._getLabelContainer("Code postal","fr-input-group",l),l.addEventListener("change",()=>{this.filter.postcode=l.value});const c=document.createElement("input");c.className="fr-input",c.name="cityCode",c.type="text",c.pattern="^(\\d\\d|2[A,B,a,b])\\d{3}$",c.title="Code INSEE sur 5 caractres",c.id=Helper.getUid("LocationAdvancedSearch-insee-"),this._getLabelContainer("Code INSEE","fr-input-group",c,"Format attendu INSEE : 5 chiffres, selon le code officiel gographique (COG)"),c.addEventListener("change",()=>{this.filter.citycode=c.value.toUpperCase()}),this.filter={category:n.value,postcode:l.value.toUpperCase(),citycode:c.value}}_onErase(e){super._onErase(e),this.element.querySelectorAll("select").forEach(i=>{i.selectedIndex=0}),this.element.querySelectorAll("input").forEach(i=>{i.value=""}),this.searchResult.innerHTML="",this._clearMessages(),this.filter={category:this.element.querySelector("select[name='category']").value,postcode:"",citycode:""}}_clearMessages(){this.element.querySelectorAll(".fr-message--error").forEach(e=>e.remove())}_showMessage(e,i){const n=this.element.querySelector("input[name='"+e+"']").nextSibling;if(i){const o=document.createElement("p");o.className="fr-message fr-message--error",o.textContent=i,n.appendChild(o)}else n.innerHTML=""}_onSearch(e,i){super._onSearch(e);const n=i||this.searchInput.value;if(this._clearMessages(),this.filter.postcode&&!this.element.querySelector("input[name='postalCode']").checkValidity()){this._showMessage("postalCode","Le code postal doit tre compos de 5 chiffres.");return}if(this.filter.citycode&&!this.element.querySelector("input[name='cityCode']").checkValidity()){this._showMessage("cityCode","Le code INSEE doit tre compos de 5 caractres (chiffres ou 2A, 2B).");return}if(!n&&this.filter.citycode){fetch(`https://geo.api.gouv.fr/communes?code=${this.filter.citycode}&format=json&fields=nom`).then(o=>o.json()).then(o=>{if(o&&o.length){const l=o[0].nom;l?this._onSearch(e,l):this.handleSearch({nbResults:0})}}).catch(()=>{this.handleSearch({nbResults:0})});return}else if(!n&&this.filter.postcode){fetch(`https://apicarto.ign.fr/api/codes-postaux/communes/${this.filter.postcode}`).then(o=>o.json()).then(o=>{if(o&&o.length){const l=o[0].nomCommune;l?this._onSearch(e,l):this.handleSearch({nbResults:0})}}).catch(()=>{this._showMessage("postalCode","Aucune commune trouve pour ce code postal."),this.handleSearch({nbResults:0})});return}else if(n.length<3){this._showMessage("search","Veuillez saisir au moins 3 caractres pour lancer la recherche.");return}this.searchService.search({location:n,filters:this.filter})}}window.ol&&window.ol.control&&(window.ol.control.LocationAdvancedSearch=LocationAdvancedSearch);var discriminator={},codegen={},code$1={},hasRequiredCode$1;function requireCode$1(){return hasRequiredCode$1||(hasRequiredCode$1=1,(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.regexpCode=s.getEsmExportName=s.getProperty=s.safeStringify=s.stringify=s.strConcat=s.addCodeArg=s.str=s._=s.nil=s._Code=s.Name=s.IDENTIFIER=s._CodeOrName=void 0;class e{}s._CodeOrName=e,s.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class i extends e{constructor(tt){if(super(),!s.IDENTIFIER.test(tt))throw new Error("CodeGen: name must be a valid identifier");this.str=tt}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}s.Name=i;class n extends e{constructor(tt){super(),this._items=typeof tt=="string"?[tt]:tt}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const tt=this._items[0];return tt===""||tt==='""'}get str(){var tt;return(tt=this._str)!==null&&tt!==void 0?tt:this._str=this._items.reduce((it,rt)=>`${it}${rt}`,"")}get names(){var tt;return(tt=this._names)!==null&&tt!==void 0?tt:this._names=this._items.reduce((it,rt)=>(rt instanceof i&&(it[rt.str]=(it[rt.str]||0)+1),it),{})}}s._Code=n,s.nil=new n("");function o(et,...tt){const it=[et[0]];let rt=0;for(;rt<tt.length;)u(it,tt[rt]),it.push(et[++rt]);return new n(it)}s._=o;const l=new n("+");function c(et,...tt){const it=[ee(et[0])];let rt=0;for(;rt<tt.length;)it.push(l),u(it,tt[rt]),it.push(l,ee(et[++rt]));return h(it),new n(it)}s.str=c;function u(et,tt){tt instanceof n?et.push(...tt._items):tt instanceof i?et.push(tt):et.push(H(tt))}s.addCodeArg=u;function h(et){let tt=1;for(;tt<et.length-1;){if(et[tt]===l){const it=f(et[tt-1],et[tt+1]);if(it!==void 0){et.splice(tt-1,3,it);continue}et[tt++]="+"}tt++}}function f(et,tt){if(tt==='""')return et;if(et==='""')return tt;if(typeof et=="string")return tt instanceof i||et[et.length-1]!=='"'?void 0:typeof tt!="string"?`${et.slice(0,-1)}${tt}"`:tt[0]==='"'?et.slice(0,-1)+tt.slice(1):void 0;if(typeof tt=="string"&&tt[0]==='"'&&!(et instanceof i))return`"${et}${tt.slice(1)}`}function g(et,tt){return tt.emptyStr()?et:et.emptyStr()?tt:c`${et}${tt}`}s.strConcat=g;function H(et){return typeof et=="number"||typeof et=="boolean"||et===null?et:ee(Array.isArray(et)?et.join(","):et)}function Y(et){return new n(ee(et))}s.stringify=Y;function ee(et){return JSON.stringify(et).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}s.safeStringify=ee;function te(et){return typeof et=="string"&&s.IDENTIFIER.test(et)?new n(`.${et}`):o`[${et}]`}s.getProperty=te;function xe(et){if(typeof et=="string"&&s.IDENTIFIER.test(et))return new n(`${et}`);throw new Error(`CodeGen: invalid export name: ${et}, use explicit $id name mapping`)}s.getEsmExportName=xe;function ne(et){return new n(et.toString())}s.regexpCode=ne})(code$1)),code$1}var scope={},hasRequiredScope;function requireScope(){return hasRequiredScope||(hasRequiredScope=1,(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.ValueScope=s.ValueScopeName=s.Scope=s.varKinds=s.UsedValueState=void 0;const e=requireCode$1();class i extends Error{constructor(f){super(`CodeGen: "code" for ${f} not defined`),this.value=f.value}}var n;(function(h){h[h.Started=0]="Started",h[h.Completed=1]="Completed"})(n||(s.UsedValueState=n={})),s.varKinds={const:new e.Name("const"),let:new e.Name("let"),var:new e.Name("var")};class o{constructor({prefixes:f,parent:g}={}){this._names={},this._prefixes=f,this._parent=g}toName(f){return f instanceof e.Name?f:this.name(f)}name(f){return new e.Name(this._newName(f))}_newName(f){const g=this._names[f]||this._nameGroup(f);return`${f}${g.index++}`}_nameGroup(f){var g,H;if(!((H=(g=this._parent)===null||g===void 0?void 0:g._prefixes)===null||H===void 0)&&H.has(f)||this._prefixes&&!this._prefixes.has(f))throw new Error(`CodeGen: prefix "${f}" is not allowed in this scope`);return this._names[f]={prefix:f,index:0}}}s.Scope=o;class l extends e.Name{constructor(f,g){super(g),this.prefix=f}setValue(f,{property:g,itemIndex:H}){this.value=f,this.scopePath=(0,e._)`.${new e.Name(g)}[${H}]`}}s.ValueScopeName=l;const c=(0,e._)`\n`;class u extends o{constructor(f){super(f),this._values={},this._scope=f.scope,this.opts={...f,_n:f.lines?c:e.nil}}get(){return this._scope}name(f){return new l(f,this._newName(f))}value(f,g){var H;if(g.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const Y=this.toName(f),{prefix:ee}=Y,te=(H=g.key)!==null&&H!==void 0?H:g.ref;let xe=this._values[ee];if(xe){const tt=xe.get(te);if(tt)return tt}else xe=this._values[ee]=new Map;xe.set(te,Y);const ne=this._scope[ee]||(this._scope[ee]=[]),et=ne.length;return ne[et]=g.ref,Y.setValue(g,{property:ee,itemIndex:et}),Y}getValue(f,g){const H=this._values[f];if(H)return H.get(g)}scopeRefs(f,g=this._values){return this._reduceValues(g,H=>{if(H.scopePath===void 0)throw new Error(`CodeGen: name "${H}" has no value`);return(0,e._)`${f}${H.scopePath}`})}scopeCode(f=this._values,g,H){return this._reduceValues(f,Y=>{if(Y.value===void 0)throw new Error(`CodeGen: name "${Y}" has no value`);return Y.value.code},g,H)}_reduceValues(f,g,H={},Y){let ee=e.nil;for(const te in f){const xe=f[te];if(!xe)continue;const ne=H[te]=H[te]||new Map;xe.forEach(et=>{if(ne.has(et))return;ne.set(et,n.Started);let tt=g(et);if(tt){const it=this.opts.es5?s.varKinds.var:s.varKinds.const;ee=(0,e._)`${ee}${it} ${et} = ${tt};${this.opts._n}`}else if(tt=Y==null?void 0:Y(et))ee=(0,e._)`${ee}${tt}${this.opts._n}`;else throw new i(et);ne.set(et,n.Completed)})}return ee}}s.ValueScope=u})(scope)),scope}var hasRequiredCodegen;function requireCodegen(){return hasRequiredCodegen||(hasRequiredCodegen=1,(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.or=s.and=s.not=s.CodeGen=s.operators=s.varKinds=s.ValueScopeName=s.ValueScope=s.Scope=s.Name=s.regexpCode=s.stringify=s.getProperty=s.nil=s.strConcat=s.str=s._=void 0;const e=requireCode$1(),i=requireScope();var n=requireCode$1();Object.defineProperty(s,"_",{enumerable:!0,get:function(){return n._}}),Object.defineProperty(s,"str",{enumerable:!0,get:function(){return n.str}}),Object.defineProperty(s,"strConcat",{enumerable:!0,get:function(){return n.strConcat}}),Object.defineProperty(s,"nil",{enumerable:!0,get:function(){return n.nil}}),Object.defineProperty(s,"getProperty",{enumerable:!0,get:function(){return n.getProperty}}),Object.defineProperty(s,"stringify",{enumerable:!0,get:function(){return n.stringify}}),Object.defineProperty(s,"regexpCode",{enumerable:!0,get:function(){return n.regexpCode}}),Object.defineProperty(s,"Name",{enumerable:!0,get:function(){return n.Name}});var o=requireScope();Object.defineProperty(s,"Scope",{enumerable:!0,get:function(){return o.Scope}}),Object.defineProperty(s,"ValueScope",{enumerable:!0,get:function(){return o.ValueScope}}),Object.defineProperty(s,"ValueScopeName",{enumerable:!0,get:function(){return o.ValueScopeName}}),Object.defineProperty(s,"varKinds",{enumerable:!0,get:function(){return o.varKinds}}),s.operators={GT:new e._Code(">"),GTE:new e._Code(">="),LT:new e._Code("<"),LTE:new e._Code("<="),EQ:new e._Code("==="),NEQ:new e._Code("!=="),NOT:new e._Code("!"),OR:new e._Code("||"),AND:new e._Code("&&"),ADD:new e._Code("+")};class l{optimizeNodes(){return this}optimizeNames(dt,ft){return this}}class c extends l{constructor(dt,ft,bt){super(),this.varKind=dt,this.name=ft,this.rhs=bt}render({es5:dt,_n:ft}){const bt=dt?i.varKinds.var:this.varKind,Gt=this.rhs===void 0?"":` = ${this.rhs}`;return`${bt} ${this.name}${Gt};`+ft}optimizeNames(dt,ft){if(dt[this.name.str])return this.rhs&&(this.rhs=mt(this.rhs,dt,ft)),this}get names(){return this.rhs instanceof e._CodeOrName?this.rhs.names:{}}}class u extends l{constructor(dt,ft,bt){super(),this.lhs=dt,this.rhs=ft,this.sideEffects=bt}render({_n:dt}){return`${this.lhs} = ${this.rhs};`+dt}optimizeNames(dt,ft){if(!(this.lhs instanceof e.Name&&!dt[this.lhs.str]&&!this.sideEffects))return this.rhs=mt(this.rhs,dt,ft),this}get names(){const dt=this.lhs instanceof e.Name?{}:{...this.lhs.names};return yt(dt,this.rhs)}}class h extends u{constructor(dt,ft,bt,Gt){super(dt,bt,Gt),this.op=ft}render({_n:dt}){return`${this.lhs} ${this.op}= ${this.rhs};`+dt}}class f extends l{constructor(dt){super(),this.label=dt,this.names={}}render({_n:dt}){return`${this.label}:`+dt}}class g extends l{constructor(dt){super(),this.label=dt,this.names={}}render({_n:dt}){return`break${this.label?` ${this.label}`:""};`+dt}}class H extends l{constructor(dt){super(),this.error=dt}render({_n:dt}){return`throw ${this.error};`+dt}get names(){return this.error.names}}class Y extends l{constructor(dt){super(),this.code=dt}render({_n:dt}){return`${this.code};`+dt}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(dt,ft){return this.code=mt(this.code,dt,ft),this}get names(){return this.code instanceof e._CodeOrName?this.code.names:{}}}class ee extends l{constructor(dt=[]){super(),this.nodes=dt}render(dt){return this.nodes.reduce((ft,bt)=>ft+bt.render(dt),"")}optimizeNodes(){const{nodes:dt}=this;let ft=dt.length;for(;ft--;){const bt=dt[ft].optimizeNodes();Array.isArray(bt)?dt.splice(ft,1,...bt):bt?dt[ft]=bt:dt.splice(ft,1)}return dt.length>0?this:void 0}optimizeNames(dt,ft){const{nodes:bt}=this;let Gt=bt.length;for(;Gt--;){const Ft=bt[Gt];Ft.optimizeNames(dt,ft)||(St(dt,Ft.names),bt.splice(Gt,1))}return bt.length>0?this:void 0}get names(){return this.nodes.reduce((dt,ft)=>pt(dt,ft.names),{})}}class te extends ee{render(dt){return"{"+dt._n+super.render(dt)+"}"+dt._n}}class xe extends ee{}class ne extends te{}ne.kind="else";class et extends te{constructor(dt,ft){super(ft),this.condition=dt}render(dt){let ft=`if(${this.condition})`+super.render(dt);return this.else&&(ft+="else "+this.else.render(dt)),ft}optimizeNodes(){super.optimizeNodes();const dt=this.condition;if(dt===!0)return this.nodes;let ft=this.else;if(ft){const bt=ft.optimizeNodes();ft=this.else=Array.isArray(bt)?new ne(bt):bt}if(ft)return dt===!1?ft instanceof et?ft:ft.nodes:this.nodes.length?this:new et(Pt(dt),ft instanceof et?[ft]:ft.nodes);if(!(dt===!1||!this.nodes.length))return this}optimizeNames(dt,ft){var bt;if(this.else=(bt=this.else)===null||bt===void 0?void 0:bt.optimizeNames(dt,ft),!!(super.optimizeNames(dt,ft)||this.else))return this.condition=mt(this.condition,dt,ft),this}get names(){const dt=super.names;return yt(dt,this.condition),this.else&&pt(dt,this.else.names),dt}}et.kind="if";class tt extends te{}tt.kind="for";class it extends tt{constructor(dt){super(),this.iteration=dt}render(dt){return`for(${this.iteration})`+super.render(dt)}optimizeNames(dt,ft){if(super.optimizeNames(dt,ft))return this.iteration=mt(this.iteration,dt,ft),this}get names(){return pt(super.names,this.iteration.names)}}class rt extends tt{constructor(dt,ft,bt,Gt){super(),this.varKind=dt,this.name=ft,this.from=bt,this.to=Gt}render(dt){const ft=dt.es5?i.varKinds.var:this.varKind,{name:bt,from:Gt,to:Ft}=this;return`for(${ft} ${bt}=${Gt}; ${bt}<${Ft}; ${bt}++)`+super.render(dt)}get names(){const dt=yt(super.names,this.from);return yt(dt,this.to)}}class nt extends tt{constructor(dt,ft,bt,Gt){super(),this.loop=dt,this.varKind=ft,this.name=bt,this.iterable=Gt}render(dt){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(dt)}optimizeNames(dt,ft){if(super.optimizeNames(dt,ft))return this.iterable=mt(this.iterable,dt,ft),this}get names(){return pt(super.names,this.iterable.names)}}class st extends te{constructor(dt,ft,bt){super(),this.name=dt,this.args=ft,this.async=bt}render(dt){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(dt)}}st.kind="func";class at extends ee{render(dt){return"return "+super.render(dt)}}at.kind="return";class ot extends te{render(dt){let ft="try"+super.render(dt);return this.catch&&(ft+=this.catch.render(dt)),this.finally&&(ft+=this.finally.render(dt)),ft}optimizeNodes(){var dt,ft;return super.optimizeNodes(),(dt=this.catch)===null||dt===void 0||dt.optimizeNodes(),(ft=this.finally)===null||ft===void 0||ft.optimizeNodes(),this}optimizeNames(dt,ft){var bt,Gt;return super.optimizeNames(dt,ft),(bt=this.catch)===null||bt===void 0||bt.optimizeNames(dt,ft),(Gt=this.finally)===null||Gt===void 0||Gt.optimizeNames(dt,ft),this}get names(){const dt=super.names;return this.catch&&pt(dt,this.catch.names),this.finally&&pt(dt,this.finally.names),dt}}class ct extends te{constructor(dt){super(),this.error=dt}render(dt){return`catch(${this.error})`+super.render(dt)}}ct.kind="catch";class ht extends te{render(dt){return"finally"+super.render(dt)}}ht.kind="finally";class ut{constructor(dt,ft={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...ft,_n:ft.lines?`
`:""},this._extScope=dt,this._scope=new i.Scope({parent:dt}),this._nodes=[new xe]}toString(){return this._root.render(this.opts)}name(dt){return this._scope.name(dt)}scopeName(dt){return this._extScope.name(dt)}scopeValue(dt,ft){const bt=this._extScope.value(dt,ft);return(this._values[bt.prefix]||(this._values[bt.prefix]=new Set)).add(bt),bt}getScopeValue(dt,ft){return this._extScope.getValue(dt,ft)}scopeRefs(dt){return this._extScope.scopeRefs(dt,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(dt,ft,bt,Gt){const Ft=this._scope.toName(ft);return bt!==void 0&&Gt&&(this._constants[Ft.str]=bt),this._leafNode(new c(dt,Ft,bt)),Ft}const(dt,ft,bt){return this._def(i.varKinds.const,dt,ft,bt)}let(dt,ft,bt){return this._def(i.varKinds.let,dt,ft,bt)}var(dt,ft,bt){return this._def(i.varKinds.var,dt,ft,bt)}assign(dt,ft,bt){return this._leafNode(new u(dt,ft,bt))}add(dt,ft){return this._leafNode(new h(dt,s.operators.ADD,ft))}code(dt){return typeof dt=="function"?dt():dt!==e.nil&&this._leafNode(new Y(dt)),this}object(...dt){const ft=["{"];for(const[bt,Gt]of dt)ft.length>1&&ft.push(","),ft.push(bt),(bt!==Gt||this.opts.es5)&&(ft.push(":"),(0,e.addCodeArg)(ft,Gt));return ft.push("}"),new e._Code(ft)}if(dt,ft,bt){if(this._blockNode(new et(dt)),ft&&bt)this.code(ft).else().code(bt).endIf();else if(ft)this.code(ft).endIf();else if(bt)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(dt){return this._elseNode(new et(dt))}else(){return this._elseNode(new ne)}endIf(){return this._endBlockNode(et,ne)}_for(dt,ft){return this._blockNode(dt),ft&&this.code(ft).endFor(),this}for(dt,ft){return this._for(new it(dt),ft)}forRange(dt,ft,bt,Gt,Ft=this.opts.es5?i.varKinds.var:i.varKinds.let){const Ht=this._scope.toName(dt);return this._for(new rt(Ft,Ht,ft,bt),()=>Gt(Ht))}forOf(dt,ft,bt,Gt=i.varKinds.const){const Ft=this._scope.toName(dt);if(this.opts.es5){const Ht=ft instanceof e.Name?ft:this.var("_arr",ft);return this.forRange("_i",0,(0,e._)`${Ht}.length`,Mt=>{this.var(Ft,(0,e._)`${Ht}[${Mt}]`),bt(Ft)})}return this._for(new nt("of",Gt,Ft,ft),()=>bt(Ft))}forIn(dt,ft,bt,Gt=this.opts.es5?i.varKinds.var:i.varKinds.const){if(this.opts.ownProperties)return this.forOf(dt,(0,e._)`Object.keys(${ft})`,bt);const Ft=this._scope.toName(dt);return this._for(new nt("in",Gt,Ft,ft),()=>bt(Ft))}endFor(){return this._endBlockNode(tt)}label(dt){return this._leafNode(new f(dt))}break(dt){return this._leafNode(new g(dt))}return(dt){const ft=new at;if(this._blockNode(ft),this.code(dt),ft.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(at)}try(dt,ft,bt){if(!ft&&!bt)throw new Error('CodeGen: "try" without "catch" and "finally"');const Gt=new ot;if(this._blockNode(Gt),this.code(dt),ft){const Ft=this.name("e");this._currNode=Gt.catch=new ct(Ft),ft(Ft)}return bt&&(this._currNode=Gt.finally=new ht,this.code(bt)),this._endBlockNode(ct,ht)}throw(dt){return this._leafNode(new H(dt))}block(dt,ft){return this._blockStarts.push(this._nodes.length),dt&&this.code(dt).endBlock(ft),this}endBlock(dt){const ft=this._blockStarts.pop();if(ft===void 0)throw new Error("CodeGen: not in self-balancing block");const bt=this._nodes.length-ft;if(bt<0||dt!==void 0&&bt!==dt)throw new Error(`CodeGen: wrong number of nodes: ${bt} vs ${dt} expected`);return this._nodes.length=ft,this}func(dt,ft=e.nil,bt,Gt){return this._blockNode(new st(dt,ft,bt)),Gt&&this.code(Gt).endFunc(),this}endFunc(){return this._endBlockNode(st)}optimize(dt=1){for(;dt-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(dt){return this._currNode.nodes.push(dt),this}_blockNode(dt){this._currNode.nodes.push(dt),this._nodes.push(dt)}_endBlockNode(dt,ft){const bt=this._currNode;if(bt instanceof dt||ft&&bt instanceof ft)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${ft?`${dt.kind}/${ft.kind}`:dt.kind}"`)}_elseNode(dt){const ft=this._currNode;if(!(ft instanceof et))throw new Error('CodeGen: "else" without "if"');return this._currNode=ft.else=dt,this}get _root(){return this._nodes[0]}get _currNode(){const dt=this._nodes;return dt[dt.length-1]}set _currNode(dt){const ft=this._nodes;ft[ft.length-1]=dt}}s.CodeGen=ut;function pt(_t,dt){for(const ft in dt)_t[ft]=(_t[ft]||0)+(dt[ft]||0);return _t}function yt(_t,dt){return dt instanceof e._CodeOrName?pt(_t,dt.names):_t}function mt(_t,dt,ft){if(_t instanceof e.Name)return bt(_t);if(!Gt(_t))return _t;return new e._Code(_t._items.reduce((Ft,Ht)=>(Ht instanceof e.Name&&(Ht=bt(Ht)),Ht instanceof e._Code?Ft.push(...Ht._items):Ft.push(Ht),Ft),[]));function bt(Ft){const Ht=ft[Ft.str];return Ht===void 0||dt[Ft.str]!==1?Ft:(delete dt[Ft.str],Ht)}function Gt(Ft){return Ft instanceof e._Code&&Ft._items.some(Ht=>Ht instanceof e.Name&&dt[Ht.str]===1&&ft[Ht.str]!==void 0)}}function St(_t,dt){for(const ft in dt)_t[ft]=(_t[ft]||0)-(dt[ft]||0)}function Pt(_t){return typeof _t=="boolean"||typeof _t=="number"||_t===null?!_t:(0,e._)`!${Ct(_t)}`}s.not=Pt;const Rt=Et(s.operators.AND);function Lt(..._t){return _t.reduce(Rt)}s.and=Lt;const Nt=Et(s.operators.OR);function vt(..._t){return _t.reduce(Nt)}s.or=vt;function Et(_t){return(dt,ft)=>dt===e.nil?ft:ft===e.nil?dt:(0,e._)`${Ct(dt)} ${_t} ${Ct(ft)}`}function Ct(_t){return _t instanceof e.Name?_t:(0,e._)`(${_t})`}})(codegen)),codegen}var types={},hasRequiredTypes;function requireTypes(){if(hasRequiredTypes)return types;hasRequiredTypes=1,Object.defineProperty(types,"__esModule",{value:!0}),types.DiscrError=void 0;var s;return(function(e){e.Tag="tag",e.Mapping="mapping"})(s||(types.DiscrError=s={})),types}var compile={},validation_error={},hasRequiredValidation_error;function requireValidation_error(){if(hasRequiredValidation_error)return validation_error;hasRequiredValidation_error=1,Object.defineProperty(validation_error,"__esModule",{value:!0});class s extends Error{constructor(i){super("validation failed"),this.errors=i,this.ajv=this.validation=!0}}return validation_error.default=s,validation_error}var names={},hasRequiredNames;function requireNames(){if(hasRequiredNames)return names;hasRequiredNames=1,Object.defineProperty(names,"__esModule",{value:!0});const s=requireCodegen(),e={data:new s.Name("data"),valCxt:new s.Name("valCxt"),instancePath:new s.Name("instancePath"),parentData:new s.Name("parentData"),parentDataProperty:new s.Name("parentDataProperty"),rootData:new s.Name("rootData"),dynamicAnchors:new s.Name("dynamicAnchors"),vErrors:new s.Name("vErrors"),errors:new s.Name("errors"),this:new s.Name("this"),self:new s.Name("self"),scope:new s.Name("scope"),json:new s.Name("json"),jsonPos:new s.Name("jsonPos"),jsonLen:new s.Name("jsonLen"),jsonPart:new s.Name("jsonPart")};return names.default=e,names}var resolve={},util={},hasRequiredUtil;function requireUtil(){if(hasRequiredUtil)return util;hasRequiredUtil=1,Object.defineProperty(util,"__esModule",{value:!0}),util.checkStrictMode=util.getErrorPath=util.Type=util.useFunc=util.setEvaluated=util.evaluatedPropsToName=util.mergeEvaluated=util.eachItem=util.unescapeJsonPointer=util.escapeJsonPointer=util.escapeFragment=util.unescapeFragment=util.schemaRefOrVal=util.schemaHasRulesButRef=util.schemaHasRules=util.checkUnknownRules=util.alwaysValidSchema=util.toHash=void 0;const s=requireCodegen(),e=requireCode$1();function i(nt){const st={};for(const at of nt)st[at]=!0;return st}util.toHash=i;function n(nt,st){return typeof st=="boolean"?st:Object.keys(st).length===0?!0:(o(nt,st),!l(st,nt.self.RULES.all))}util.alwaysValidSchema=n;function o(nt,st=nt.schema){const{opts:at,self:ot}=nt;if(!at.strictSchema||typeof st=="boolean")return;const ct=ot.RULES.keywords;for(const ht in st)ct[ht]||rt(nt,`unknown keyword: "${ht}"`)}util.checkUnknownRules=o;function l(nt,st){if(typeof nt=="boolean")return!nt;for(const at in nt)if(st[at])return!0;return!1}util.schemaHasRules=l;function c(nt,st){if(typeof nt=="boolean")return!nt;for(const at in nt)if(at!=="$ref"&&st.all[at])return!0;return!1}util.schemaHasRulesButRef=c;function u({topSchemaRef:nt,schemaPath:st},at,ot,ct){if(!ct){if(typeof at=="number"||typeof at=="boolean")return at;if(typeof at=="string")return(0,s._)`${at}`}return(0,s._)`${nt}${st}${(0,s.getProperty)(ot)}`}util.schemaRefOrVal=u;function h(nt){return H(decodeURIComponent(nt))}util.unescapeFragment=h;function f(nt){return encodeURIComponent(g(nt))}util.escapeFragment=f;function g(nt){return typeof nt=="number"?`${nt}`:nt.replace(/~/g,"~0").replace(/\//g,"~1")}util.escapeJsonPointer=g;function H(nt){return nt.replace(/~1/g,"/").replace(/~0/g,"~")}util.unescapeJsonPointer=H;function Y(nt,st){if(Array.isArray(nt))for(const at of nt)st(at);else st(nt)}util.eachItem=Y;function ee({mergeNames:nt,mergeToName:st,mergeValues:at,resultToName:ot}){return(ct,ht,ut,pt)=>{const yt=ut===void 0?ht:ut instanceof s.Name?(ht instanceof s.Name?nt(ct,ht,ut):st(ct,ht,ut),ut):ht instanceof s.Name?(st(ct,ut,ht),ht):at(ht,ut);return pt===s.Name&&!(yt instanceof s.Name)?ot(ct,yt):yt}}util.mergeEvaluated={props:ee({mergeNames:(nt,st,at)=>nt.if((0,s._)`${at} !== true && ${st} !== undefined`,()=>{nt.if((0,s._)`${st} === true`,()=>nt.assign(at,!0),()=>nt.assign(at,(0,s._)`${at} || {}`).code((0,s._)`Object.assign(${at}, ${st})`))}),mergeToName:(nt,st,at)=>nt.if((0,s._)`${at} !== true`,()=>{st===!0?nt.assign(at,!0):(nt.assign(at,(0,s._)`${at} || {}`),xe(nt,at,st))}),mergeValues:(nt,st)=>nt===!0?!0:{...nt,...st},resultToName:te}),items:ee({mergeNames:(nt,st,at)=>nt.if((0,s._)`${at} !== true && ${st} !== undefined`,()=>nt.assign(at,(0,s._)`${st} === true ? true : ${at} > ${st} ? ${at} : ${st}`)),mergeToName:(nt,st,at)=>nt.if((0,s._)`${at} !== true`,()=>nt.assign(at,st===!0?!0:(0,s._)`${at} > ${st} ? ${at} : ${st}`)),mergeValues:(nt,st)=>nt===!0?!0:Math.max(nt,st),resultToName:(nt,st)=>nt.var("items",st)})};function te(nt,st){if(st===!0)return nt.var("props",!0);const at=nt.var("props",(0,s._)`{}`);return st!==void 0&&xe(nt,at,st),at}util.evaluatedPropsToName=te;function xe(nt,st,at){Object.keys(at).forEach(ot=>nt.assign((0,s._)`${st}${(0,s.getProperty)(ot)}`,!0))}util.setEvaluated=xe;const ne={};function et(nt,st){return nt.scopeValue("func",{ref:st,code:ne[st.code]||(ne[st.code]=new e._Code(st.code))})}util.useFunc=et;var tt;(function(nt){nt[nt.Num=0]="Num",nt[nt.Str=1]="Str"})(tt||(util.Type=tt={}));function it(nt,st,at){if(nt instanceof s.Name){const ot=st===tt.Num;return at?ot?(0,s._)`"[" + ${nt} + "]"`:(0,s._)`"['" + ${nt} + "']"`:ot?(0,s._)`"/" + ${nt}`:(0,s._)`"/" + ${nt}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return at?(0,s.getProperty)(nt).toString():"/"+g(nt)}util.getErrorPath=it;function rt(nt,st,at=nt.opts.strictSchema){if(at){if(st=`strict mode: ${st}`,at===!0)throw new Error(st);nt.self.logger.warn(st)}}return util.checkStrictMode=rt,util}var fastDeepEqual,hasRequiredFastDeepEqual;function requireFastDeepEqual(){return hasRequiredFastDeepEqual||(hasRequiredFastDeepEqual=1,fastDeepEqual=function s(e,i){if(e===i)return!0;if(e&&i&&typeof e=="object"&&typeof i=="object"){if(e.constructor!==i.constructor)return!1;var n,o,l;if(Array.isArray(e)){if(n=e.length,n!=i.length)return!1;for(o=n;o--!==0;)if(!s(e[o],i[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===i.source&&e.flags===i.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===i.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===i.toString();if(l=Object.keys(e),n=l.length,n!==Object.keys(i).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(i,l[o]))return!1;for(o=n;o--!==0;){var c=l[o];if(!s(e[c],i[c]))return!1}return!0}return e!==e&&i!==i}),fastDeepEqual}var jsonSchemaTraverse={exports:{}},hasRequiredJsonSchemaTraverse;function requireJsonSchemaTraverse(){if(hasRequiredJsonSchemaTraverse)return jsonSchemaTraverse.exports;hasRequiredJsonSchemaTraverse=1;var s=jsonSchemaTraverse.exports=function(n,o,l){typeof o=="function"&&(l=o,o={}),l=o.cb||l;var c=typeof l=="function"?l:l.pre||function(){},u=l.post||function(){};e(o,c,u,n,"",n)};s.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},s.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},s.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},s.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function e(n,o,l,c,u,h,f,g,H,Y){if(c&&typeof c=="object"&&!Array.isArray(c)){o(c,u,h,f,g,H,Y);for(var ee in c){var te=c[ee];if(Array.isArray(te)){if(ee in s.arrayKeywords)for(var xe=0;xe<te.length;xe++)e(n,o,l,te[xe],u+"/"+ee+"/"+xe,h,u,ee,c,xe)}else if(ee in s.propsKeywords){if(te&&typeof te=="object")for(var ne in te)e(n,o,l,te[ne],u+"/"+ee+"/"+i(ne),h,u,ee,c,ne)}else(ee in s.keywords||n.allKeys&&!(ee in s.skipKeywords))&&e(n,o,l,te,u+"/"+ee,h,u,ee,c)}l(c,u,h,f,g,H,Y)}}function i(n){return n.replace(/~/g,"~0").replace(/\//g,"~1")}return jsonSchemaTraverse.exports}var hasRequiredResolve;function requireResolve(){if(hasRequiredResolve)return resolve;hasRequiredResolve=1,Object.defineProperty(resolve,"__esModule",{value:!0}),resolve.getSchemaRefs=resolve.resolveUrl=resolve.normalizeId=resolve._getFullPath=resolve.getFullPath=resolve.inlineRef=void 0;const s=requireUtil(),e=requireFastDeepEqual(),i=requireJsonSchemaTraverse(),n=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function o(xe,ne=!0){return typeof xe=="boolean"?!0:ne===!0?!c(xe):ne?u(xe)<=ne:!1}resolve.inlineRef=o;const l=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function c(xe){for(const ne in xe){if(l.has(ne))return!0;const et=xe[ne];if(Array.isArray(et)&&et.some(c)||typeof et=="object"&&c(et))return!0}return!1}function u(xe){let ne=0;for(const et in xe){if(et==="$ref")return 1/0;if(ne++,!n.has(et)&&(typeof xe[et]=="object"&&(0,s.eachItem)(xe[et],tt=>ne+=u(tt)),ne===1/0))return 1/0}return ne}function h(xe,ne="",et){et!==!1&&(ne=H(ne));const tt=xe.parse(ne);return f(xe,tt)}resolve.getFullPath=h;function f(xe,ne){return xe.serialize(ne).split("#")[0]+"#"}resolve._getFullPath=f;const g=/#\/?$/;function H(xe){return xe?xe.replace(g,""):""}resolve.normalizeId=H;function Y(xe,ne,et){return et=H(et),xe.resolve(ne,et)}resolve.resolveUrl=Y;const ee=/^[a-z_][-a-z0-9._]*$/i;function te(xe,ne){if(typeof xe=="boolean")return{};const{schemaId:et,uriResolver:tt}=this.opts,it=H(xe[et]||ne),rt={"":it},nt=h(tt,it,!1),st={},at=new Set;return i(xe,{allKeys:!0},(ht,ut,pt,yt)=>{if(yt===void 0)return;const mt=nt+ut;let St=rt[yt];typeof ht[et]=="string"&&(St=Pt.call(this,ht[et])),Rt.call(this,ht.$anchor),Rt.call(this,ht.$dynamicAnchor),rt[ut]=St;function Pt(Lt){const Nt=this.opts.uriResolver.resolve;if(Lt=H(St?Nt(St,Lt):Lt),at.has(Lt))throw ct(Lt);at.add(Lt);let vt=this.refs[Lt];return typeof vt=="string"&&(vt=this.refs[vt]),typeof vt=="object"?ot(ht,vt.schema,Lt):Lt!==H(mt)&&(Lt[0]==="#"?(ot(ht,st[Lt],Lt),st[Lt]=ht):this.refs[Lt]=mt),Lt}function Rt(Lt){if(typeof Lt=="string"){if(!ee.test(Lt))throw new Error(`invalid anchor "${Lt}"`);Pt.call(this,`#${Lt}`)}}}),st;function ot(ht,ut,pt){if(ut!==void 0&&!e(ht,ut))throw ct(pt)}function ct(ht){return new Error(`reference "${ht}" resolves to more than one schema`)}}return resolve.getSchemaRefs=te,resolve}var validate={},boolSchema={},errors={},hasRequiredErrors;function requireErrors(){return hasRequiredErrors||(hasRequiredErrors=1,(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.extendErrors=s.resetErrorsCount=s.reportExtraError=s.reportError=s.keyword$DataError=s.keywordError=void 0;const e=requireCodegen(),i=requireUtil(),n=requireNames();s.keywordError={message:({keyword:ne})=>(0,e.str)`must pass "${ne}" keyword validation`},s.keyword$DataError={message:({keyword:ne,schemaType:et})=>et?(0,e.str)`"${ne}" keyword must be ${et} ($data)`:(0,e.str)`"${ne}" keyword is invalid ($data)`};function o(ne,et=s.keywordError,tt,it){const{it:rt}=ne,{gen:nt,compositeRule:st,allErrors:at}=rt,ot=H(ne,et,tt);it??(st||at)?h(nt,ot):f(rt,(0,e._)`[${ot}]`)}s.reportError=o;function l(ne,et=s.keywordError,tt){const{it}=ne,{gen:rt,compositeRule:nt,allErrors:st}=it,at=H(ne,et,tt);h(rt,at),nt||st||f(it,n.default.vErrors)}s.reportExtraError=l;function c(ne,et){ne.assign(n.default.errors,et),ne.if((0,e._)`${n.default.vErrors} !== null`,()=>ne.if(et,()=>ne.assign((0,e._)`${n.default.vErrors}.length`,et),()=>ne.assign(n.default.vErrors,null)))}s.resetErrorsCount=c;function u({gen:ne,keyword:et,schemaValue:tt,data:it,errsCount:rt,it:nt}){if(rt===void 0)throw new Error("ajv implementation error");const st=ne.name("err");ne.forRange("i",rt,n.default.errors,at=>{ne.const(st,(0,e._)`${n.default.vErrors}[${at}]`),ne.if((0,e._)`${st}.instancePath === undefined`,()=>ne.assign((0,e._)`${st}.instancePath`,(0,e.strConcat)(n.default.instancePath,nt.errorPath))),ne.assign((0,e._)`${st}.schemaPath`,(0,e.str)`${nt.errSchemaPath}/${et}`),nt.opts.verbose&&(ne.assign((0,e._)`${st}.schema`,tt),ne.assign((0,e._)`${st}.data`,it))})}s.extendErrors=u;function h(ne,et){const tt=ne.const("err",et);ne.if((0,e._)`${n.default.vErrors} === null`,()=>ne.assign(n.default.vErrors,(0,e._)`[${tt}]`),(0,e._)`${n.default.vErrors}.push(${tt})`),ne.code((0,e._)`${n.default.errors}++`)}function f(ne,et){const{gen:tt,validateName:it,schemaEnv:rt}=ne;rt.$async?tt.throw((0,e._)`new ${ne.ValidationError}(${et})`):(tt.assign((0,e._)`${it}.errors`,et),tt.return(!1))}const g={keyword:new e.Name("keyword"),schemaPath:new e.Name("schemaPath"),params:new e.Name("params"),propertyName:new e.Name("propertyName"),message:new e.Name("message"),schema:new e.Name("schema"),parentSchema:new e.Name("parentSchema")};function H(ne,et,tt){const{createErrors:it}=ne.it;return it===!1?(0,e._)`{}`:Y(ne,et,tt)}function Y(ne,et,tt={}){const{gen:it,it:rt}=ne,nt=[ee(rt,tt),te(ne,tt)];return xe(ne,et,nt),it.object(...nt)}function ee({errorPath:ne},{instancePath:et}){const tt=et?(0,e.str)`${ne}${(0,i.getErrorPath)(et,i.Type.Str)}`:ne;return[n.default.instancePath,(0,e.strConcat)(n.default.instancePath,tt)]}function te({keyword:ne,it:{errSchemaPath:et}},{schemaPath:tt,parentSchema:it}){let rt=it?et:(0,e.str)`${et}/${ne}`;return tt&&(rt=(0,e.str)`${rt}${(0,i.getErrorPath)(tt,i.Type.Str)}`),[g.schemaPath,rt]}function xe(ne,{params:et,message:tt},it){const{keyword:rt,data:nt,schemaValue:st,it:at}=ne,{opts:ot,propertyName:ct,topSchemaRef:ht,schemaPath:ut}=at;it.push([g.keyword,rt],[g.params,typeof et=="function"?et(ne):et||(0,e._)`{}`]),ot.messages&&it.push([g.message,typeof tt=="function"?tt(ne):tt]),ot.verbose&&it.push([g.schema,st],[g.parentSchema,(0,e._)`${ht}${ut}`],[n.default.data,nt]),ct&&it.push([g.propertyName,ct])}})(errors)),errors}var hasRequiredBoolSchema;function requireBoolSchema(){if(hasRequiredBoolSchema)return boolSchema;hasRequiredBoolSchema=1,Object.defineProperty(boolSchema,"__esModule",{value:!0}),boolSchema.boolOrEmptySchema=boolSchema.topBoolOrEmptySchema=void 0;const s=requireErrors(),e=requireCodegen(),i=requireNames(),n={message:"boolean schema is false"};function o(u){const{gen:h,schema:f,validateName:g}=u;f===!1?c(u,!1):typeof f=="object"&&f.$async===!0?h.return(i.default.data):(h.assign((0,e._)`${g}.errors`,null),h.return(!0))}boolSchema.topBoolOrEmptySchema=o;function l(u,h){const{gen:f,schema:g}=u;g===!1?(f.var(h,!1),c(u)):f.var(h,!0)}boolSchema.boolOrEmptySchema=l;function c(u,h){const{gen:f,data:g}=u,H={gen:f,keyword:"false schema",data:g,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:u};(0,s.reportError)(H,n,void 0,h)}return boolSchema}var dataType={},rules={},hasRequiredRules;function requireRules(){if(hasRequiredRules)return rules;hasRequiredRules=1,Object.defineProperty(rules,"__esModule",{value:!0}),rules.getRules=rules.isJSONType=void 0;const s=["string","number","integer","boolean","null","object","array"],e=new Set(s);function i(o){return typeof o=="string"&&e.has(o)}rules.isJSONType=i;function n(){const o={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...o,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},o.number,o.string,o.array,o.object],post:{rules:[]},all:{},keywords:{}}}return rules.getRules=n,rules}var applicability={},hasRequiredApplicability;function requireApplicability(){if(hasRequiredApplicability)return applicability;hasRequiredApplicability=1,Object.defineProperty(applicability,"__esModule",{value:!0}),applicability.shouldUseRule=applicability.shouldUseGroup=applicability.schemaHasRulesForType=void 0;function s({schema:n,self:o},l){const c=o.RULES.types[l];return c&&c!==!0&&e(n,c)}applicability.schemaHasRulesForType=s;function e(n,o){return o.rules.some(l=>i(n,l))}applicability.shouldUseGroup=e;function i(n,o){var l;return n[o.keyword]!==void 0||((l=o.definition.implements)===null||l===void 0?void 0:l.some(c=>n[c]!==void 0))}return applicability.shouldUseRule=i,applicability}var hasRequiredDataType;function requireDataType(){if(hasRequiredDataType)return dataType;hasRequiredDataType=1,Object.defineProperty(dataType,"__esModule",{value:!0}),dataType.reportTypeError=dataType.checkDataTypes=dataType.checkDataType=dataType.coerceAndCheckDataType=dataType.getJSONTypes=dataType.getSchemaTypes=dataType.DataType=void 0;const s=requireRules(),e=requireApplicability(),i=requireErrors(),n=requireCodegen(),o=requireUtil();var l;(function(tt){tt[tt.Correct=0]="Correct",tt[tt.Wrong=1]="Wrong"})(l||(dataType.DataType=l={}));function c(tt){const it=u(tt.type);if(it.includes("null")){if(tt.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!it.length&&tt.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');tt.nullable===!0&&it.push("null")}return it}dataType.getSchemaTypes=c;function u(tt){const it=Array.isArray(tt)?tt:tt?[tt]:[];if(it.every(s.isJSONType))return it;throw new Error("type must be JSONType or JSONType[]: "+it.join(","))}dataType.getJSONTypes=u;function h(tt,it){const{gen:rt,data:nt,opts:st}=tt,at=g(it,st.coerceTypes),ot=it.length>0&&!(at.length===0&&it.length===1&&(0,e.schemaHasRulesForType)(tt,it[0]));if(ot){const ct=te(it,nt,st.strictNumbers,l.Wrong);rt.if(ct,()=>{at.length?H(tt,it,at):ne(tt)})}return ot}dataType.coerceAndCheckDataType=h;const f=new Set(["string","number","integer","boolean","null"]);function g(tt,it){return it?tt.filter(rt=>f.has(rt)||it==="array"&&rt==="array"):[]}function H(tt,it,rt){const{gen:nt,data:st,opts:at}=tt,ot=nt.let("dataType",(0,n._)`typeof ${st}`),ct=nt.let("coerced",(0,n._)`undefined`);at.coerceTypes==="array"&&nt.if((0,n._)`${ot} == 'object' && Array.isArray(${st}) && ${st}.length == 1`,()=>nt.assign(st,(0,n._)`${st}[0]`).assign(ot,(0,n._)`typeof ${st}`).if(te(it,st,at.strictNumbers),()=>nt.assign(ct,st))),nt.if((0,n._)`${ct} !== undefined`);for(const ut of rt)(f.has(ut)||ut==="array"&&at.coerceTypes==="array")&&ht(ut);nt.else(),ne(tt),nt.endIf(),nt.if((0,n._)`${ct} !== undefined`,()=>{nt.assign(st,ct),Y(tt,ct)});function ht(ut){switch(ut){case"string":nt.elseIf((0,n._)`${ot} == "number" || ${ot} == "boolean"`).assign(ct,(0,n._)`"" + ${st}`).elseIf((0,n._)`${st} === null`).assign(ct,(0,n._)`""`);return;case"number":nt.elseIf((0,n._)`${ot} == "boolean" || ${st} === null
              || (${ot} == "string" && ${st} && ${st} == +${st})`).assign(ct,(0,n._)`+${st}`);return;case"integer":nt.elseIf((0,n._)`${ot} === "boolean" || ${st} === null
              || (${ot} === "string" && ${st} && ${st} == +${st} && !(${st} % 1))`).assign(ct,(0,n._)`+${st}`);return;case"boolean":nt.elseIf((0,n._)`${st} === "false" || ${st} === 0 || ${st} === null`).assign(ct,!1).elseIf((0,n._)`${st} === "true" || ${st} === 1`).assign(ct,!0);return;case"null":nt.elseIf((0,n._)`${st} === "" || ${st} === 0 || ${st} === false`),nt.assign(ct,null);return;case"array":nt.elseIf((0,n._)`${ot} === "string" || ${ot} === "number"
              || ${ot} === "boolean" || ${st} === null`).assign(ct,(0,n._)`[${st}]`)}}}function Y({gen:tt,parentData:it,parentDataProperty:rt},nt){tt.if((0,n._)`${it} !== undefined`,()=>tt.assign((0,n._)`${it}[${rt}]`,nt))}function ee(tt,it,rt,nt=l.Correct){const st=nt===l.Correct?n.operators.EQ:n.operators.NEQ;let at;switch(tt){case"null":return(0,n._)`${it} ${st} null`;case"array":at=(0,n._)`Array.isArray(${it})`;break;case"object":at=(0,n._)`${it} && typeof ${it} == "object" && !Array.isArray(${it})`;break;case"integer":at=ot((0,n._)`!(${it} % 1) && !isNaN(${it})`);break;case"number":at=ot();break;default:return(0,n._)`typeof ${it} ${st} ${tt}`}return nt===l.Correct?at:(0,n.not)(at);function ot(ct=n.nil){return(0,n.and)((0,n._)`typeof ${it} == "number"`,ct,rt?(0,n._)`isFinite(${it})`:n.nil)}}dataType.checkDataType=ee;function te(tt,it,rt,nt){if(tt.length===1)return ee(tt[0],it,rt,nt);let st;const at=(0,o.toHash)(tt);if(at.array&&at.object){const ot=(0,n._)`typeof ${it} != "object"`;st=at.null?ot:(0,n._)`!${it} || ${ot}`,delete at.null,delete at.array,delete at.object}else st=n.nil;at.number&&delete at.integer;for(const ot in at)st=(0,n.and)(st,ee(ot,it,rt,nt));return st}dataType.checkDataTypes=te;const xe={message:({schema:tt})=>`must be ${tt}`,params:({schema:tt,schemaValue:it})=>typeof tt=="string"?(0,n._)`{type: ${tt}}`:(0,n._)`{type: ${it}}`};function ne(tt){const it=et(tt);(0,i.reportError)(it,xe)}dataType.reportTypeError=ne;function et(tt){const{gen:it,data:rt,schema:nt}=tt,st=(0,o.schemaRefOrVal)(tt,nt,"type");return{gen:it,keyword:"type",data:rt,schema:nt.type,schemaCode:st,schemaValue:st,parentSchema:nt,params:{},it:tt}}return dataType}var defaults={},hasRequiredDefaults;function requireDefaults(){if(hasRequiredDefaults)return defaults;hasRequiredDefaults=1,Object.defineProperty(defaults,"__esModule",{value:!0}),defaults.assignDefaults=void 0;const s=requireCodegen(),e=requireUtil();function i(o,l){const{properties:c,items:u}=o.schema;if(l==="object"&&c)for(const h in c)n(o,h,c[h].default);else l==="array"&&Array.isArray(u)&&u.forEach((h,f)=>n(o,f,h.default))}defaults.assignDefaults=i;function n(o,l,c){const{gen:u,compositeRule:h,data:f,opts:g}=o;if(c===void 0)return;const H=(0,s._)`${f}${(0,s.getProperty)(l)}`;if(h){(0,e.checkStrictMode)(o,`default is ignored for: ${H}`);return}let Y=(0,s._)`${H} === undefined`;g.useDefaults==="empty"&&(Y=(0,s._)`${Y} || ${H} === null || ${H} === ""`),u.if(Y,(0,s._)`${H} = ${(0,s.stringify)(c)}`)}return defaults}var keyword={},code={},hasRequiredCode;function requireCode(){if(hasRequiredCode)return code;hasRequiredCode=1,Object.defineProperty(code,"__esModule",{value:!0}),code.validateUnion=code.validateArray=code.usePattern=code.callValidateCode=code.schemaProperties=code.allSchemaProperties=code.noPropertyInData=code.propertyInData=code.isOwnProperty=code.hasPropFunc=code.reportMissingProp=code.checkMissingProp=code.checkReportMissingProp=void 0;const s=requireCodegen(),e=requireUtil(),i=requireNames(),n=requireUtil();function o(tt,it){const{gen:rt,data:nt,it:st}=tt;rt.if(g(rt,nt,it,st.opts.ownProperties),()=>{tt.setParams({missingProperty:(0,s._)`${it}`},!0),tt.error()})}code.checkReportMissingProp=o;function l({gen:tt,data:it,it:{opts:rt}},nt,st){return(0,s.or)(...nt.map(at=>(0,s.and)(g(tt,it,at,rt.ownProperties),(0,s._)`${st} = ${at}`)))}code.checkMissingProp=l;function c(tt,it){tt.setParams({missingProperty:it},!0),tt.error()}code.reportMissingProp=c;function u(tt){return tt.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,s._)`Object.prototype.hasOwnProperty`})}code.hasPropFunc=u;function h(tt,it,rt){return(0,s._)`${u(tt)}.call(${it}, ${rt})`}code.isOwnProperty=h;function f(tt,it,rt,nt){const st=(0,s._)`${it}${(0,s.getProperty)(rt)} !== undefined`;return nt?(0,s._)`${st} && ${h(tt,it,rt)}`:st}code.propertyInData=f;function g(tt,it,rt,nt){const st=(0,s._)`${it}${(0,s.getProperty)(rt)} === undefined`;return nt?(0,s.or)(st,(0,s.not)(h(tt,it,rt))):st}code.noPropertyInData=g;function H(tt){return tt?Object.keys(tt).filter(it=>it!=="__proto__"):[]}code.allSchemaProperties=H;function Y(tt,it){return H(it).filter(rt=>!(0,e.alwaysValidSchema)(tt,it[rt]))}code.schemaProperties=Y;function ee({schemaCode:tt,data:it,it:{gen:rt,topSchemaRef:nt,schemaPath:st,errorPath:at},it:ot},ct,ht,ut){const pt=ut?(0,s._)`${tt}, ${it}, ${nt}${st}`:it,yt=[[i.default.instancePath,(0,s.strConcat)(i.default.instancePath,at)],[i.default.parentData,ot.parentData],[i.default.parentDataProperty,ot.parentDataProperty],[i.default.rootData,i.default.rootData]];ot.opts.dynamicRef&&yt.push([i.default.dynamicAnchors,i.default.dynamicAnchors]);const mt=(0,s._)`${pt}, ${rt.object(...yt)}`;return ht!==s.nil?(0,s._)`${ct}.call(${ht}, ${mt})`:(0,s._)`${ct}(${mt})`}code.callValidateCode=ee;const te=(0,s._)`new RegExp`;function xe({gen:tt,it:{opts:it}},rt){const nt=it.unicodeRegExp?"u":"",{regExp:st}=it.code,at=st(rt,nt);return tt.scopeValue("pattern",{key:at.toString(),ref:at,code:(0,s._)`${st.code==="new RegExp"?te:(0,n.useFunc)(tt,st)}(${rt}, ${nt})`})}code.usePattern=xe;function ne(tt){const{gen:it,data:rt,keyword:nt,it:st}=tt,at=it.name("valid");if(st.allErrors){const ct=it.let("valid",!0);return ot(()=>it.assign(ct,!1)),ct}return it.var(at,!0),ot(()=>it.break()),at;function ot(ct){const ht=it.const("len",(0,s._)`${rt}.length`);it.forRange("i",0,ht,ut=>{tt.subschema({keyword:nt,dataProp:ut,dataPropType:e.Type.Num},at),it.if((0,s.not)(at),ct)})}}code.validateArray=ne;function et(tt){const{gen:it,schema:rt,keyword:nt,it:st}=tt;if(!Array.isArray(rt))throw new Error("ajv implementation error");if(rt.some(ht=>(0,e.alwaysValidSchema)(st,ht))&&!st.opts.unevaluated)return;const ot=it.let("valid",!1),ct=it.name("_valid");it.block(()=>rt.forEach((ht,ut)=>{const pt=tt.subschema({keyword:nt,schemaProp:ut,compositeRule:!0},ct);it.assign(ot,(0,s._)`${ot} || ${ct}`),tt.mergeValidEvaluated(pt,ct)||it.if((0,s.not)(ot))})),tt.result(ot,()=>tt.reset(),()=>tt.error(!0))}return code.validateUnion=et,code}var hasRequiredKeyword;function requireKeyword(){if(hasRequiredKeyword)return keyword;hasRequiredKeyword=1,Object.defineProperty(keyword,"__esModule",{value:!0}),keyword.validateKeywordUsage=keyword.validSchemaType=keyword.funcKeywordCode=keyword.macroKeywordCode=void 0;const s=requireCodegen(),e=requireNames(),i=requireCode(),n=requireErrors();function o(Y,ee){const{gen:te,keyword:xe,schema:ne,parentSchema:et,it:tt}=Y,it=ee.macro.call(tt.self,ne,et,tt),rt=f(te,xe,it);tt.opts.validateSchema!==!1&&tt.self.validateSchema(it,!0);const nt=te.name("valid");Y.subschema({schema:it,schemaPath:s.nil,errSchemaPath:`${tt.errSchemaPath}/${xe}`,topSchemaRef:rt,compositeRule:!0},nt),Y.pass(nt,()=>Y.error(!0))}keyword.macroKeywordCode=o;function l(Y,ee){var te;const{gen:xe,keyword:ne,schema:et,parentSchema:tt,$data:it,it:rt}=Y;h(rt,ee);const nt=!it&&ee.compile?ee.compile.call(rt.self,et,tt,rt):ee.validate,st=f(xe,ne,nt),at=xe.let("valid");Y.block$data(at,ot),Y.ok((te=ee.valid)!==null&&te!==void 0?te:at);function ot(){if(ee.errors===!1)ut(),ee.modifying&&c(Y),pt(()=>Y.error());else{const yt=ee.async?ct():ht();ee.modifying&&c(Y),pt(()=>u(Y,yt))}}function ct(){const yt=xe.let("ruleErrs",null);return xe.try(()=>ut((0,s._)`await `),mt=>xe.assign(at,!1).if((0,s._)`${mt} instanceof ${rt.ValidationError}`,()=>xe.assign(yt,(0,s._)`${mt}.errors`),()=>xe.throw(mt))),yt}function ht(){const yt=(0,s._)`${st}.errors`;return xe.assign(yt,null),ut(s.nil),yt}function ut(yt=ee.async?(0,s._)`await `:s.nil){const mt=rt.opts.passContext?e.default.this:e.default.self,St=!("compile"in ee&&!it||ee.schema===!1);xe.assign(at,(0,s._)`${yt}${(0,i.callValidateCode)(Y,st,mt,St)}`,ee.modifying)}function pt(yt){var mt;xe.if((0,s.not)((mt=ee.valid)!==null&&mt!==void 0?mt:at),yt)}}keyword.funcKeywordCode=l;function c(Y){const{gen:ee,data:te,it:xe}=Y;ee.if(xe.parentData,()=>ee.assign(te,(0,s._)`${xe.parentData}[${xe.parentDataProperty}]`))}function u(Y,ee){const{gen:te}=Y;te.if((0,s._)`Array.isArray(${ee})`,()=>{te.assign(e.default.vErrors,(0,s._)`${e.default.vErrors} === null ? ${ee} : ${e.default.vErrors}.concat(${ee})`).assign(e.default.errors,(0,s._)`${e.default.vErrors}.length`),(0,n.extendErrors)(Y)},()=>Y.error())}function h({schemaEnv:Y},ee){if(ee.async&&!Y.$async)throw new Error("async keyword in sync schema")}function f(Y,ee,te){if(te===void 0)throw new Error(`keyword "${ee}" failed to compile`);return Y.scopeValue("keyword",typeof te=="function"?{ref:te}:{ref:te,code:(0,s.stringify)(te)})}function g(Y,ee,te=!1){return!ee.length||ee.some(xe=>xe==="array"?Array.isArray(Y):xe==="object"?Y&&typeof Y=="object"&&!Array.isArray(Y):typeof Y==xe||te&&typeof Y>"u")}keyword.validSchemaType=g;function H({schema:Y,opts:ee,self:te,errSchemaPath:xe},ne,et){if(Array.isArray(ne.keyword)?!ne.keyword.includes(et):ne.keyword!==et)throw new Error("ajv implementation error");const tt=ne.dependencies;if(tt!=null&&tt.some(it=>!Object.prototype.hasOwnProperty.call(Y,it)))throw new Error(`parent schema must have dependencies of ${et}: ${tt.join(",")}`);if(ne.validateSchema&&!ne.validateSchema(Y[et])){const rt=`keyword "${et}" value is invalid at path "${xe}": `+te.errorsText(ne.validateSchema.errors);if(ee.validateSchema==="log")te.logger.error(rt);else throw new Error(rt)}}return keyword.validateKeywordUsage=H,keyword}var subschema={},hasRequiredSubschema;function requireSubschema(){if(hasRequiredSubschema)return subschema;hasRequiredSubschema=1,Object.defineProperty(subschema,"__esModule",{value:!0}),subschema.extendSubschemaMode=subschema.extendSubschemaData=subschema.getSubschema=void 0;const s=requireCodegen(),e=requireUtil();function i(l,{keyword:c,schemaProp:u,schema:h,schemaPath:f,errSchemaPath:g,topSchemaRef:H}){if(c!==void 0&&h!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(c!==void 0){const Y=l.schema[c];return u===void 0?{schema:Y,schemaPath:(0,s._)`${l.schemaPath}${(0,s.getProperty)(c)}`,errSchemaPath:`${l.errSchemaPath}/${c}`}:{schema:Y[u],schemaPath:(0,s._)`${l.schemaPath}${(0,s.getProperty)(c)}${(0,s.getProperty)(u)}`,errSchemaPath:`${l.errSchemaPath}/${c}/${(0,e.escapeFragment)(u)}`}}if(h!==void 0){if(f===void 0||g===void 0||H===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:h,schemaPath:f,topSchemaRef:H,errSchemaPath:g}}throw new Error('either "keyword" or "schema" must be passed')}subschema.getSubschema=i;function n(l,c,{dataProp:u,dataPropType:h,data:f,dataTypes:g,propertyName:H}){if(f!==void 0&&u!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:Y}=c;if(u!==void 0){const{errorPath:te,dataPathArr:xe,opts:ne}=c,et=Y.let("data",(0,s._)`${c.data}${(0,s.getProperty)(u)}`,!0);ee(et),l.errorPath=(0,s.str)`${te}${(0,e.getErrorPath)(u,h,ne.jsPropertySyntax)}`,l.parentDataProperty=(0,s._)`${u}`,l.dataPathArr=[...xe,l.parentDataProperty]}if(f!==void 0){const te=f instanceof s.Name?f:Y.let("data",f,!0);ee(te),H!==void 0&&(l.propertyName=H)}g&&(l.dataTypes=g);function ee(te){l.data=te,l.dataLevel=c.dataLevel+1,l.dataTypes=[],c.definedProperties=new Set,l.parentData=c.data,l.dataNames=[...c.dataNames,te]}}subschema.extendSubschemaData=n;function o(l,{jtdDiscriminator:c,jtdMetadata:u,compositeRule:h,createErrors:f,allErrors:g}){h!==void 0&&(l.compositeRule=h),f!==void 0&&(l.createErrors=f),g!==void 0&&(l.allErrors=g),l.jtdDiscriminator=c,l.jtdMetadata=u}return subschema.extendSubschemaMode=o,subschema}var hasRequiredValidate;function requireValidate(){if(hasRequiredValidate)return validate;hasRequiredValidate=1,Object.defineProperty(validate,"__esModule",{value:!0}),validate.getData=validate.KeywordCxt=validate.validateFunctionCode=void 0;const s=requireBoolSchema(),e=requireDataType(),i=requireApplicability(),n=requireDataType(),o=requireDefaults(),l=requireKeyword(),c=requireSubschema(),u=requireCodegen(),h=requireNames(),f=requireResolve(),g=requireUtil(),H=requireErrors();function Y(It){if(nt(It)&&(at(It),rt(It))){ne(It);return}ee(It,()=>(0,s.topBoolOrEmptySchema)(It))}validate.validateFunctionCode=Y;function ee({gen:It,validateName:xt,schema:Tt,schemaEnv:Ut,opts:Dt},$t){Dt.code.es5?It.func(xt,(0,u._)`${h.default.data}, ${h.default.valCxt}`,Ut.$async,()=>{It.code((0,u._)`"use strict"; ${tt(Tt,Dt)}`),xe(It,Dt),It.code($t)}):It.func(xt,(0,u._)`${h.default.data}, ${te(Dt)}`,Ut.$async,()=>It.code(tt(Tt,Dt)).code($t))}function te(It){return(0,u._)`{${h.default.instancePath}="", ${h.default.parentData}, ${h.default.parentDataProperty}, ${h.default.rootData}=${h.default.data}${It.dynamicRef?(0,u._)`, ${h.default.dynamicAnchors}={}`:u.nil}}={}`}function xe(It,xt){It.if(h.default.valCxt,()=>{It.var(h.default.instancePath,(0,u._)`${h.default.valCxt}.${h.default.instancePath}`),It.var(h.default.parentData,(0,u._)`${h.default.valCxt}.${h.default.parentData}`),It.var(h.default.parentDataProperty,(0,u._)`${h.default.valCxt}.${h.default.parentDataProperty}`),It.var(h.default.rootData,(0,u._)`${h.default.valCxt}.${h.default.rootData}`),xt.dynamicRef&&It.var(h.default.dynamicAnchors,(0,u._)`${h.default.valCxt}.${h.default.dynamicAnchors}`)},()=>{It.var(h.default.instancePath,(0,u._)`""`),It.var(h.default.parentData,(0,u._)`undefined`),It.var(h.default.parentDataProperty,(0,u._)`undefined`),It.var(h.default.rootData,h.default.data),xt.dynamicRef&&It.var(h.default.dynamicAnchors,(0,u._)`{}`)})}function ne(It){const{schema:xt,opts:Tt,gen:Ut}=It;ee(It,()=>{Tt.$comment&&xt.$comment&&yt(It),ht(It),Ut.let(h.default.vErrors,null),Ut.let(h.default.errors,0),Tt.unevaluated&&et(It),ot(It),mt(It)})}function et(It){const{gen:xt,validateName:Tt}=It;It.evaluated=xt.const("evaluated",(0,u._)`${Tt}.evaluated`),xt.if((0,u._)`${It.evaluated}.dynamicProps`,()=>xt.assign((0,u._)`${It.evaluated}.props`,(0,u._)`undefined`)),xt.if((0,u._)`${It.evaluated}.dynamicItems`,()=>xt.assign((0,u._)`${It.evaluated}.items`,(0,u._)`undefined`))}function tt(It,xt){const Tt=typeof It=="object"&&It[xt.schemaId];return Tt&&(xt.code.source||xt.code.process)?(0,u._)`/*# sourceURL=${Tt} */`:u.nil}function it(It,xt){if(nt(It)&&(at(It),rt(It))){st(It,xt);return}(0,s.boolOrEmptySchema)(It,xt)}function rt({schema:It,self:xt}){if(typeof It=="boolean")return!It;for(const Tt in It)if(xt.RULES.all[Tt])return!0;return!1}function nt(It){return typeof It.schema!="boolean"}function st(It,xt){const{schema:Tt,gen:Ut,opts:Dt}=It;Dt.$comment&&Tt.$comment&&yt(It),ut(It),pt(It);const $t=Ut.const("_errs",h.default.errors);ot(It,$t),Ut.var(xt,(0,u._)`${$t} === ${h.default.errors}`)}function at(It){(0,g.checkUnknownRules)(It),ct(It)}function ot(It,xt){if(It.opts.jtd)return Pt(It,[],!1,xt);const Tt=(0,e.getSchemaTypes)(It.schema),Ut=(0,e.coerceAndCheckDataType)(It,Tt);Pt(It,Tt,!Ut,xt)}function ct(It){const{schema:xt,errSchemaPath:Tt,opts:Ut,self:Dt}=It;xt.$ref&&Ut.ignoreKeywordsWithRef&&(0,g.schemaHasRulesButRef)(xt,Dt.RULES)&&Dt.logger.warn(`$ref: keywords ignored in schema at path "${Tt}"`)}function ht(It){const{schema:xt,opts:Tt}=It;xt.default!==void 0&&Tt.useDefaults&&Tt.strictSchema&&(0,g.checkStrictMode)(It,"default is ignored in the schema root")}function ut(It){const xt=It.schema[It.opts.schemaId];xt&&(It.baseId=(0,f.resolveUrl)(It.opts.uriResolver,It.baseId,xt))}function pt(It){if(It.schema.$async&&!It.schemaEnv.$async)throw new Error("async schema in sync schema")}function yt({gen:It,schemaEnv:xt,schema:Tt,errSchemaPath:Ut,opts:Dt}){const $t=Tt.$comment;if(Dt.$comment===!0)It.code((0,u._)`${h.default.self}.logger.log(${$t})`);else if(typeof Dt.$comment=="function"){const Zt=(0,u.str)`${Ut}/$comment`,Kt=It.scopeValue("root",{ref:xt.root});It.code((0,u._)`${h.default.self}.opts.$comment(${$t}, ${Zt}, ${Kt}.schema)`)}}function mt(It){const{gen:xt,schemaEnv:Tt,validateName:Ut,ValidationError:Dt,opts:$t}=It;Tt.$async?xt.if((0,u._)`${h.default.errors} === 0`,()=>xt.return(h.default.data),()=>xt.throw((0,u._)`new ${Dt}(${h.default.vErrors})`)):(xt.assign((0,u._)`${Ut}.errors`,h.default.vErrors),$t.unevaluated&&St(It),xt.return((0,u._)`${h.default.errors} === 0`))}function St({gen:It,evaluated:xt,props:Tt,items:Ut}){Tt instanceof u.Name&&It.assign((0,u._)`${xt}.props`,Tt),Ut instanceof u.Name&&It.assign((0,u._)`${xt}.items`,Ut)}function Pt(It,xt,Tt,Ut){const{gen:Dt,schema:$t,data:Zt,allErrors:Kt,opts:qt,self:Xt}=It,{RULES:zt}=Xt;if($t.$ref&&(qt.ignoreKeywordsWithRef||!(0,g.schemaHasRulesButRef)($t,zt))){Dt.block(()=>Gt(It,"$ref",zt.all.$ref.definition));return}qt.jtd||Lt(It,xt),Dt.block(()=>{for(const wt of zt.rules)ai(wt);ai(zt.post)});function ai(wt){(0,i.shouldUseGroup)($t,wt)&&(wt.type?(Dt.if((0,n.checkDataType)(wt.type,Zt,qt.strictNumbers)),Rt(It,wt),xt.length===1&&xt[0]===wt.type&&Tt&&(Dt.else(),(0,n.reportTypeError)(It)),Dt.endIf()):Rt(It,wt),Kt||Dt.if((0,u._)`${h.default.errors} === ${Ut||0}`))}}function Rt(It,xt){const{gen:Tt,schema:Ut,opts:{useDefaults:Dt}}=It;Dt&&(0,o.assignDefaults)(It,xt.type),Tt.block(()=>{for(const $t of xt.rules)(0,i.shouldUseRule)(Ut,$t)&&Gt(It,$t.keyword,$t.definition,xt.type)})}function Lt(It,xt){It.schemaEnv.meta||!It.opts.strictTypes||(Nt(It,xt),It.opts.allowUnionTypes||vt(It,xt),Et(It,It.dataTypes))}function Nt(It,xt){if(xt.length){if(!It.dataTypes.length){It.dataTypes=xt;return}xt.forEach(Tt=>{_t(It.dataTypes,Tt)||ft(It,`type "${Tt}" not allowed by context "${It.dataTypes.join(",")}"`)}),dt(It,xt)}}function vt(It,xt){xt.length>1&&!(xt.length===2&&xt.includes("null"))&&ft(It,"use allowUnionTypes to allow union type keyword")}function Et(It,xt){const Tt=It.self.RULES.all;for(const Ut in Tt){const Dt=Tt[Ut];if(typeof Dt=="object"&&(0,i.shouldUseRule)(It.schema,Dt)){const{type:$t}=Dt.definition;$t.length&&!$t.some(Zt=>Ct(xt,Zt))&&ft(It,`missing type "${$t.join(",")}" for keyword "${Ut}"`)}}}function Ct(It,xt){return It.includes(xt)||xt==="number"&&It.includes("integer")}function _t(It,xt){return It.includes(xt)||xt==="integer"&&It.includes("number")}function dt(It,xt){const Tt=[];for(const Ut of It.dataTypes)_t(xt,Ut)?Tt.push(Ut):xt.includes("integer")&&Ut==="number"&&Tt.push("integer");It.dataTypes=Tt}function ft(It,xt){const Tt=It.schemaEnv.baseId+It.errSchemaPath;xt+=` at "${Tt}" (strictTypes)`,(0,g.checkStrictMode)(It,xt,It.opts.strictTypes)}class bt{constructor(xt,Tt,Ut){if((0,l.validateKeywordUsage)(xt,Tt,Ut),this.gen=xt.gen,this.allErrors=xt.allErrors,this.keyword=Ut,this.data=xt.data,this.schema=xt.schema[Ut],this.$data=Tt.$data&&xt.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,g.schemaRefOrVal)(xt,this.schema,Ut,this.$data),this.schemaType=Tt.schemaType,this.parentSchema=xt.schema,this.params={},this.it=xt,this.def=Tt,this.$data)this.schemaCode=xt.gen.const("vSchema",Mt(this.$data,xt));else if(this.schemaCode=this.schemaValue,!(0,l.validSchemaType)(this.schema,Tt.schemaType,Tt.allowUndefined))throw new Error(`${Ut} value must be ${JSON.stringify(Tt.schemaType)}`);("code"in Tt?Tt.trackErrors:Tt.errors!==!1)&&(this.errsCount=xt.gen.const("_errs",h.default.errors))}result(xt,Tt,Ut){this.failResult((0,u.not)(xt),Tt,Ut)}failResult(xt,Tt,Ut){this.gen.if(xt),Ut?Ut():this.error(),Tt?(this.gen.else(),Tt(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(xt,Tt){this.failResult((0,u.not)(xt),void 0,Tt)}fail(xt){if(xt===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(xt),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(xt){if(!this.$data)return this.fail(xt);const{schemaCode:Tt}=this;this.fail((0,u._)`${Tt} !== undefined && (${(0,u.or)(this.invalid$data(),xt)})`)}error(xt,Tt,Ut){if(Tt){this.setParams(Tt),this._error(xt,Ut),this.setParams({});return}this._error(xt,Ut)}_error(xt,Tt){(xt?H.reportExtraError:H.reportError)(this,this.def.error,Tt)}$dataError(){(0,H.reportError)(this,this.def.$dataError||H.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,H.resetErrorsCount)(this.gen,this.errsCount)}ok(xt){this.allErrors||this.gen.if(xt)}setParams(xt,Tt){Tt?Object.assign(this.params,xt):this.params=xt}block$data(xt,Tt,Ut=u.nil){this.gen.block(()=>{this.check$data(xt,Ut),Tt()})}check$data(xt=u.nil,Tt=u.nil){if(!this.$data)return;const{gen:Ut,schemaCode:Dt,schemaType:$t,def:Zt}=this;Ut.if((0,u.or)((0,u._)`${Dt} === undefined`,Tt)),xt!==u.nil&&Ut.assign(xt,!0),($t.length||Zt.validateSchema)&&(Ut.elseIf(this.invalid$data()),this.$dataError(),xt!==u.nil&&Ut.assign(xt,!1)),Ut.else()}invalid$data(){const{gen:xt,schemaCode:Tt,schemaType:Ut,def:Dt,it:$t}=this;return(0,u.or)(Zt(),Kt());function Zt(){if(Ut.length){if(!(Tt instanceof u.Name))throw new Error("ajv implementation error");const qt=Array.isArray(Ut)?Ut:[Ut];return(0,u._)`${(0,n.checkDataTypes)(qt,Tt,$t.opts.strictNumbers,n.DataType.Wrong)}`}return u.nil}function Kt(){if(Dt.validateSchema){const qt=xt.scopeValue("validate$data",{ref:Dt.validateSchema});return(0,u._)`!${qt}(${Tt})`}return u.nil}}subschema(xt,Tt){const Ut=(0,c.getSubschema)(this.it,xt);(0,c.extendSubschemaData)(Ut,this.it,xt),(0,c.extendSubschemaMode)(Ut,xt);const Dt={...this.it,...Ut,items:void 0,props:void 0};return it(Dt,Tt),Dt}mergeEvaluated(xt,Tt){const{it:Ut,gen:Dt}=this;Ut.opts.unevaluated&&(Ut.props!==!0&&xt.props!==void 0&&(Ut.props=g.mergeEvaluated.props(Dt,xt.props,Ut.props,Tt)),Ut.items!==!0&&xt.items!==void 0&&(Ut.items=g.mergeEvaluated.items(Dt,xt.items,Ut.items,Tt)))}mergeValidEvaluated(xt,Tt){const{it:Ut,gen:Dt}=this;if(Ut.opts.unevaluated&&(Ut.props!==!0||Ut.items!==!0))return Dt.if(Tt,()=>this.mergeEvaluated(xt,u.Name)),!0}}validate.KeywordCxt=bt;function Gt(It,xt,Tt,Ut){const Dt=new bt(It,Tt,xt);"code"in Tt?Tt.code(Dt,Ut):Dt.$data&&Tt.validate?(0,l.funcKeywordCode)(Dt,Tt):"macro"in Tt?(0,l.macroKeywordCode)(Dt,Tt):(Tt.compile||Tt.validate)&&(0,l.funcKeywordCode)(Dt,Tt)}const Ft=/^\/(?:[^~]|~0|~1)*$/,Ht=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function Mt(It,{dataLevel:xt,dataNames:Tt,dataPathArr:Ut}){let Dt,$t;if(It==="")return h.default.rootData;if(It[0]==="/"){if(!Ft.test(It))throw new Error(`Invalid JSON-pointer: ${It}`);Dt=It,$t=h.default.rootData}else{const Xt=Ht.exec(It);if(!Xt)throw new Error(`Invalid JSON-pointer: ${It}`);const zt=+Xt[1];if(Dt=Xt[2],Dt==="#"){if(zt>=xt)throw new Error(qt("property/index",zt));return Ut[xt-zt]}if(zt>xt)throw new Error(qt("data",zt));if($t=Tt[xt-zt],!Dt)return $t}let Zt=$t;const Kt=Dt.split("/");for(const Xt of Kt)Xt&&($t=(0,u._)`${$t}${(0,u.getProperty)((0,g.unescapeJsonPointer)(Xt))}`,Zt=(0,u._)`${Zt} && ${$t}`);return Zt;function qt(Xt,zt){return`Cannot access ${Xt} ${zt} levels up, current level is ${xt}`}}return validate.getData=Mt,validate}var hasRequiredCompile;function requireCompile(){if(hasRequiredCompile)return compile;hasRequiredCompile=1,Object.defineProperty(compile,"__esModule",{value:!0}),compile.resolveSchema=compile.getCompilingSchema=compile.resolveRef=compile.compileSchema=compile.SchemaEnv=void 0;const s=requireCodegen(),e=requireValidation_error(),i=requireNames(),n=requireResolve(),o=requireUtil(),l=requireValidate();class c{constructor(et){var tt;this.refs={},this.dynamicAnchors={};let it;typeof et.schema=="object"&&(it=et.schema),this.schema=et.schema,this.schemaId=et.schemaId,this.root=et.root||this,this.baseId=(tt=et.baseId)!==null&&tt!==void 0?tt:(0,n.normalizeId)(it==null?void 0:it[et.schemaId||"$id"]),this.schemaPath=et.schemaPath,this.localRefs=et.localRefs,this.meta=et.meta,this.$async=it==null?void 0:it.$async,this.refs={}}}compile.SchemaEnv=c;function u(ne){const et=g.call(this,ne);if(et)return et;const tt=(0,n.getFullPath)(this.opts.uriResolver,ne.root.baseId),{es5:it,lines:rt}=this.opts.code,{ownProperties:nt}=this.opts,st=new s.CodeGen(this.scope,{es5:it,lines:rt,ownProperties:nt});let at;ne.$async&&(at=st.scopeValue("Error",{ref:e.default,code:(0,s._)`require("ajv/dist/runtime/validation_error").default`}));const ot=st.scopeName("validate");ne.validateName=ot;const ct={gen:st,allErrors:this.opts.allErrors,data:i.default.data,parentData:i.default.parentData,parentDataProperty:i.default.parentDataProperty,dataNames:[i.default.data],dataPathArr:[s.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:st.scopeValue("schema",this.opts.code.source===!0?{ref:ne.schema,code:(0,s.stringify)(ne.schema)}:{ref:ne.schema}),validateName:ot,ValidationError:at,schema:ne.schema,schemaEnv:ne,rootId:tt,baseId:ne.baseId||tt,schemaPath:s.nil,errSchemaPath:ne.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,s._)`""`,opts:this.opts,self:this};let ht;try{this._compilations.add(ne),(0,l.validateFunctionCode)(ct),st.optimize(this.opts.code.optimize);const ut=st.toString();ht=`${st.scopeRefs(i.default.scope)}return ${ut}`,this.opts.code.process&&(ht=this.opts.code.process(ht,ne));const yt=new Function(`${i.default.self}`,`${i.default.scope}`,ht)(this,this.scope.get());if(this.scope.value(ot,{ref:yt}),yt.errors=null,yt.schema=ne.schema,yt.schemaEnv=ne,ne.$async&&(yt.$async=!0),this.opts.code.source===!0&&(yt.source={validateName:ot,validateCode:ut,scopeValues:st._values}),this.opts.unevaluated){const{props:mt,items:St}=ct;yt.evaluated={props:mt instanceof s.Name?void 0:mt,items:St instanceof s.Name?void 0:St,dynamicProps:mt instanceof s.Name,dynamicItems:St instanceof s.Name},yt.source&&(yt.source.evaluated=(0,s.stringify)(yt.evaluated))}return ne.validate=yt,ne}catch(ut){throw delete ne.validate,delete ne.validateName,ht&&this.logger.error("Error compiling schema, function code:",ht),ut}finally{this._compilations.delete(ne)}}compile.compileSchema=u;function h(ne,et,tt){var it;tt=(0,n.resolveUrl)(this.opts.uriResolver,et,tt);const rt=ne.refs[tt];if(rt)return rt;let nt=Y.call(this,ne,tt);if(nt===void 0){const st=(it=ne.localRefs)===null||it===void 0?void 0:it[tt],{schemaId:at}=this.opts;st&&(nt=new c({schema:st,schemaId:at,root:ne,baseId:et}))}if(nt!==void 0)return ne.refs[tt]=f.call(this,nt)}compile.resolveRef=h;function f(ne){return(0,n.inlineRef)(ne.schema,this.opts.inlineRefs)?ne.schema:ne.validate?ne:u.call(this,ne)}function g(ne){for(const et of this._compilations)if(H(et,ne))return et}compile.getCompilingSchema=g;function H(ne,et){return ne.schema===et.schema&&ne.root===et.root&&ne.baseId===et.baseId}function Y(ne,et){let tt;for(;typeof(tt=this.refs[et])=="string";)et=tt;return tt||this.schemas[et]||ee.call(this,ne,et)}function ee(ne,et){const tt=this.opts.uriResolver.parse(et),it=(0,n._getFullPath)(this.opts.uriResolver,tt);let rt=(0,n.getFullPath)(this.opts.uriResolver,ne.baseId,void 0);if(Object.keys(ne.schema).length>0&&it===rt)return xe.call(this,tt,ne);const nt=(0,n.normalizeId)(it),st=this.refs[nt]||this.schemas[nt];if(typeof st=="string"){const at=ee.call(this,ne,st);return typeof(at==null?void 0:at.schema)!="object"?void 0:xe.call(this,tt,at)}if(typeof(st==null?void 0:st.schema)=="object"){if(st.validate||u.call(this,st),nt===(0,n.normalizeId)(et)){const{schema:at}=st,{schemaId:ot}=this.opts,ct=at[ot];return ct&&(rt=(0,n.resolveUrl)(this.opts.uriResolver,rt,ct)),new c({schema:at,schemaId:ot,root:ne,baseId:rt})}return xe.call(this,tt,st)}}compile.resolveSchema=ee;const te=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function xe(ne,{baseId:et,schema:tt,root:it}){var rt;if(((rt=ne.fragment)===null||rt===void 0?void 0:rt[0])!=="/")return;for(const at of ne.fragment.slice(1).split("/")){if(typeof tt=="boolean")return;const ot=tt[(0,o.unescapeFragment)(at)];if(ot===void 0)return;tt=ot;const ct=typeof tt=="object"&&tt[this.opts.schemaId];!te.has(at)&&ct&&(et=(0,n.resolveUrl)(this.opts.uriResolver,et,ct))}let nt;if(typeof tt!="boolean"&&tt.$ref&&!(0,o.schemaHasRulesButRef)(tt,this.RULES)){const at=(0,n.resolveUrl)(this.opts.uriResolver,et,tt.$ref);nt=ee.call(this,it,at)}const{schemaId:st}=this.opts;if(nt=nt||new c({schema:tt,schemaId:st,root:it,baseId:et}),nt.schema!==nt.root.schema)return nt}return compile}var ref_error={},hasRequiredRef_error;function requireRef_error(){if(hasRequiredRef_error)return ref_error;hasRequiredRef_error=1,Object.defineProperty(ref_error,"__esModule",{value:!0});const s=requireResolve();class e extends Error{constructor(n,o,l,c){super(c||`can't resolve reference ${l} from id ${o}`),this.missingRef=(0,s.resolveUrl)(n,o,l),this.missingSchema=(0,s.normalizeId)((0,s.getFullPath)(n,this.missingRef))}}return ref_error.default=e,ref_error}var hasRequiredDiscriminator;function requireDiscriminator(){if(hasRequiredDiscriminator)return discriminator;hasRequiredDiscriminator=1,Object.defineProperty(discriminator,"__esModule",{value:!0});const s=requireCodegen(),e=requireTypes(),i=requireCompile(),n=requireRef_error(),o=requireUtil(),c={keyword:"discriminator",type:"object",schemaType:"object",error:{message:({params:{discrError:u,tagName:h}})=>u===e.DiscrError.Tag?`tag "${h}" must be string`:`value of tag "${h}" must be in oneOf`,params:({params:{discrError:u,tag:h,tagName:f}})=>(0,s._)`{error: ${u}, tag: ${f}, tagValue: ${h}}`},code(u){const{gen:h,data:f,schema:g,parentSchema:H,it:Y}=u,{oneOf:ee}=H;if(!Y.opts.discriminator)throw new Error("discriminator: requires discriminator option");const te=g.propertyName;if(typeof te!="string")throw new Error("discriminator: requires propertyName");if(g.mapping)throw new Error("discriminator: mapping is not supported");if(!ee)throw new Error("discriminator: requires oneOf keyword");const xe=h.let("valid",!1),ne=h.const("tag",(0,s._)`${f}${(0,s.getProperty)(te)}`);h.if((0,s._)`typeof ${ne} == "string"`,()=>et(),()=>u.error(!1,{discrError:e.DiscrError.Tag,tag:ne,tagName:te})),u.ok(xe);function et(){const rt=it();h.if(!1);for(const nt in rt)h.elseIf((0,s._)`${ne} === ${nt}`),h.assign(xe,tt(rt[nt]));h.else(),u.error(!1,{discrError:e.DiscrError.Mapping,tag:ne,tagName:te}),h.endIf()}function tt(rt){const nt=h.name("valid"),st=u.subschema({keyword:"oneOf",schemaProp:rt},nt);return u.mergeEvaluated(st,s.Name),nt}function it(){var rt;const nt={},st=ot(H);let at=!0;for(let ut=0;ut<ee.length;ut++){let pt=ee[ut];if(pt!=null&&pt.$ref&&!(0,o.schemaHasRulesButRef)(pt,Y.self.RULES)){const mt=pt.$ref;if(pt=i.resolveRef.call(Y.self,Y.schemaEnv.root,Y.baseId,mt),pt instanceof i.SchemaEnv&&(pt=pt.schema),pt===void 0)throw new n.default(Y.opts.uriResolver,Y.baseId,mt)}const yt=(rt=pt==null?void 0:pt.properties)===null||rt===void 0?void 0:rt[te];if(typeof yt!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${te}"`);at=at&&(st||ot(pt)),ct(yt,ut)}if(!at)throw new Error(`discriminator: "${te}" must be required`);return nt;function ot({required:ut}){return Array.isArray(ut)&&ut.includes(te)}function ct(ut,pt){if(ut.const)ht(ut.const,pt);else if(ut.enum)for(const yt of ut.enum)ht(yt,pt);else throw new Error(`discriminator: "properties/${te}" must have "const" or "enum"`)}function ht(ut,pt){if(typeof ut!="string"||ut in nt)throw new Error(`discriminator: "${te}" values must be unique strings`);nt[ut]=pt}}}};return discriminator.default=c,discriminator}requireDiscriminator();class ParcelAdvancedSearch extends AbstractAdvancedSearch{constructor(e){e=e||{},e.name=e.name||"Parcelles cadastrales",super(e),this.element.setAttribute("novalidate",""),this.searchService=new IGNSearchService({index:"parcel",limit:1,returnTrueGeometry:!0}),this.searchService.on("search",i=>this.handleSearch(i)),this.searchService.on("error",i=>this.handleError(i))}handleError(e){console.log("error",e),this.dispatchEvent(e)}handleSearch(e){var n,o;if(e.nbResults===0){this._showMessage("numero","Aucune parcelle ne correspond  ce numro.");return}const i=e.attr||this.searchService.getResult(0).placeAttributes;delete i.truegeometry,i.infoPopup=`<strong>${i.id}</strong><br/>
            Parcelle n ${i.number.replace(/^0{1,4}/g,"")}<br/>
            Feuille ${i.oldmunicipalitycode}-${i.section}<br/>
            ${i.city}
        `,(n=e.result)==null||n.setProperties(i),(o=e.extent)==null||o.setProperties(i),this.dispatchEvent(e)}_clearMessages(){this.element.querySelectorAll(".fr-message--error").forEach(e=>e.remove())}_showMessage(e,i,n){const o=this.element.querySelector("[name='"+e+"']").parentElement.querySelector(".GPMessagesGroup");if(i){const l=document.createElement("p");l.className="fr-message fr-message--"+(n||"error"),l.textContent=i,o.innerHTML="",o.appendChild(l)}else o.innerHTML=""}setSection(){const e=this.prefixInput.value,i=this.sectionInput.value;this.numberList.innerHTML="",this._showMessage("section","chargement en cours","info"),this._fetchCadastre(this.communeId,this.arrondId,e,i).then(n=>{this._showMessage("section","");const o=this.sectionInput.value;if(n&&n.features&&n.features[0].properties.section===o){this.numberInput.focus();const l=[];n.features.forEach(c=>l.push(c.properties.numero)),l.sort().forEach(c=>{const u=document.createElement("li");u.value=u.textContent=c.replace(/^0{1,4}/g,""),u.id=Helper.getUid("GPautoCompleteOption-"),u.addEventListener("click",()=>{this.numberInput.value=u.value,this._onSearch(),this.numberInput.blur(),this.numberInput.ariaExpanded="false",this.numberInput.setAttribute("aria-activedescendant","")}),this.numberList.appendChild(u)}),this.filterListNumber()}})}setFeuille(e){const i=this.feuilles[e];if(this.sectionInput.innerHTML="",i){const n=document.createElement("option");n.value="",n.textContent="Slectionner une section",this.sectionInput.appendChild(n);let o="";this.feuilles[e].sort().forEach(l=>{if(l!==o){const c=document.createElement("option");c.value=c.textContent=l,this.sectionInput.appendChild(c),o=l}}),this.sectionInput.removeAttribute("disabled"),this.sectionInput.focus()}else this.sectionInput.setAttribute("disabled","disabled");this.sectionInput.dispatchEvent(new Event("change"))}setCommune(e="",i=""){if(this.communeId!==e){const n=this.prefixInput;this.communeId=e,this.arrondId=i,n.innerHTML="",e?(this._showMessage("commCode","chargement en cours","info"),this._fetchCadastre(e,i).then(o=>{this._showMessage("commCode",""),this.feuilles={},o.features.forEach(c=>{this.feuilles[c.properties.com_abs]||(this.feuilles[c.properties.com_abs]=[]),this.feuilles[c.properties.com_abs].push(c.properties.section)});let l="";Object.keys(this.feuilles).sort().forEach(c=>{if(c!==l){const u=document.createElement("option");u.value=u.textContent=c,n.appendChild(u),l=c}}),this.setFeuille(n.value)}),n.removeAttribute("disabled")):(n.setAttribute("disabled","disabled"),this.setFeuille())}}_initEvents(e){super._initEvents(e),this.on("expand",te=>{te.expanded&&setTimeout(()=>i.focus(),300)});const i=this.comCodeInput,n=this.autocompleteList,o=this.prefixInput,l=this.sectionInput;let c="";this.communeId="";let u=-1,h=-1;const f=te=>{var xe,ne,et;c!==i.value&&this.setCommune(),te!==!1&&(te=c===i.value),te?(i.setAttribute("aria-expanded","true"),i.setAttribute("aria-activedescendant",((xe=n.children[u])==null?void 0:xe.id)||"")):(i.setAttribute("aria-expanded","false"),(ne=n.children[u])==null||ne.classList.remove("active"),i.setAttribute("aria-activedescendant",((et=n.children[u])==null?void 0:et.id)||""),u=-1)};let g="";i.addEventListener("keydown",te=>{var ne,et,tt,it;te.key==="Tab"&&!te.shiftKey&&i.value&&g!==i.value&&o.getAttribute("disabled")==="disabled"&&(te.preventDefault(),i.dispatchEvent(new Event("change"))),g=i.value;const xe=n.children;if(xe.length){let rt=u;switch(te.key){case"Backspace":{rt=-1,i.value.length>5&&(i.value=i.value.slice(0,6));break}case"Escape":{rt=-1;break}case"ArrowDown":{rt++,rt>=xe.length&&(rt=-1),te.preventDefault();break}case"ArrowUp":{rt--,rt<-1&&(rt+=xe.length+1),te.preventDefault();break}case"Enter":{rt>=0&&rt<xe.length&&((ne=xe[u])==null||ne.classList.remove("active"),xe[rt].click(),rt=-1);break}}u!==rt&&((et=xe[u])==null||et.classList.remove("active"),u=rt,(tt=xe[u])==null||tt.classList.add("active"),f(["ArrowUp","ArrowDown"].includes(te.key)),(it=xe[u])==null||it.scrollIntoView({block:"nearest"}))}}),i.addEventListener("keyup",te=>{if(["ArrowUp","ArrowDown","Enter","Escape"].includes(te.key)){te.preventDefault();return}f(te)}),i.addEventListener("focus",f),i.addEventListener("blur",te=>{te.relatedTarget!==n&&f(!1)});function H(te,xe){const ne=`${te.arrond||te.code} ${te.nom}`;return xe&&te.codesPostaux?`${ne}, ${te.codesPostaux.join(", ")} (postal)`:ne}i.addEventListener("change",()=>{if(i.checkValidity())this._clearMessages();else{this._showMessage("commCode","Le code INSEE doit tre compos de 5 caractres (chiffres ou 2A, 2B) ou le code postal de 5 chiffres.");return}this._showMessage("commCode","chargement en cours","info"),this._fetchCommuneData(i.value).then(te=>{this._showMessage("commCode",""),n.innerHTML="",c="",te.length===0?(this._showMessage("commCode","Aucune commune ne correspond  ce code INSEE ou code postal."),this.setCommune()):te.length===1?(c=i.value=H(te[0]),this.setCommune(te[0].code,te[0].arrond)):(te.forEach(xe=>{const ne=xe.codesPostaux?"code INSEE":"code postal",et=document.createElement("li");et.className="GPautoCompleteOption",et.setAttribute("role","option"),et.id=Helper.getUid("GPautoCompleteOption-"),et.title=et.textContent=H(xe,ne),et.addEventListener("click",()=>{c=i.value=H(xe),this.setCommune(xe.code,xe.arrond),f(!1)}),n.appendChild(et)}),c=i.value,this.setCommune(),i.setAttribute("aria-expanded","true"))})}),o.addEventListener("change",()=>{this.setFeuille(o.value)});let Y=null,ee=!1;l.addEventListener("click",()=>{ee=!0}),l.addEventListener("change",te=>{setTimeout(()=>{clearTimeout(Y),Y=setTimeout(()=>{l.value?(this.numberInput.removeAttribute("disabled"),this.setSection()):this.numberInput.setAttribute("disabled","disabled")},ee?0:500)}),ee=!1}),this.numberInput.addEventListener("focus",()=>{this.numberInput.ariaExpanded="true"}),this.numberInput.addEventListener("blur",te=>{te.relatedTarget!==this.numberList&&(this.numberInput.ariaExpanded="false")}),this.numberInput.addEventListener("keydown",te=>{if(["ArrowUp","ArrowDown","Enter","Escape"].includes(te.key)){te.preventDefault();return}}),this.numberInput.addEventListener("keyup",te=>{var ne,et,tt,it,rt,nt;this.filterListNumber();let xe=h;switch(te.key){case"ArrowDown":{for(let st=h+1;st<this.numberList.children.length;st++)if(this.numberList.children[st].style.display!=="none"){xe=st;break}xe>=this.numberList.children.length&&(xe=-1),te.preventDefault();break}case"ArrowUp":{for(let st=h-1;st>=-1;st--)if(st===-1||this.numberList.children[st].style.display!=="none"){xe=st;break}xe<-1&&(xe+=this.numberList.children.length+1),te.preventDefault();break}case"Escape":{xe=-1,this.numberInput.ariaExpanded="false";break}case"Enter":{const st=((ne=this.numberList.children[xe])==null?void 0:ne.value)||"";st&&(this.numberInput.value=st,this._onSearch(),this.filterListNumber(),xe=-1,setTimeout(()=>this.numberInput.ariaExpanded="false"));break}default:{xe=-1;break}}h!==xe&&((et=this.numberList.children[h])==null||et.classList.remove("active"),h=xe,(tt=this.numberList.children[h])==null||tt.classList.add("active"),this.numberInput.setAttribute("aria-activedescendant",((it=this.numberList.children[h])==null?void 0:it.id)||""),this.numberInput.ariaExpanded="true",this.numberInput.setAttribute("aria-activedescendant",((rt=this.numberList.children[h])==null?void 0:rt.id)||""),(nt=this.numberList.children[h])==null||nt.scrollIntoView({block:"nearest"}))})}filterListNumber(){const e=this.numberInput.value.toUpperCase();if(this.currentFilter===e)return;this.currentFilter=e;const i=this.numberList.querySelectorAll("li");let n=!1;i.forEach(o=>{o.textContent.toUpperCase().indexOf(e)>-1?(o.style.display="",n=!0):o.style.display="none"}),n?(this._showMessage("numero",""),this.numberInput.ariaExpanded="true"):this._showMessage("numero","Aucun numro de parcelle ne correspond  cette saisie.")}initialize(e){super.initialize(e),this.CLASSNAME="ParcelAdvancedSearch",this.insseSearchService=new InseeSearchService}_getLabelContainer(e,i,n,o=""){const l=document.createElement("div");l.className=i,this.inputs.push(l);const c=document.createElement("label");c.className="fr-label";let u=e;o&&(u=`${e} <span class="fr-hint-text">${o}</span>`),c.innerHTML=u,l.appendChild(c),n&&(c.setAttribute("for",n.id),l.appendChild(n));const h=document.createElement("div");return h.className="GPMessagesGroup fr-messages-group",l.appendChild(h),l}async _fetchCommuneData(e){const i="https://geo.api.gouv.fr/communes",n=`${i}?code=${e}&format=json&fields=nom,code`,o=`${i}?codePostal=${e}&format=json&fields=nom,codesPostaux`,l={headers:{"Content-Type":"application/json"}},c=[fetch(n,l),fetch(o,l)];return/^75|^6900|^6938|^1300|^1301|^1320|^1321/.test(e)&&(c.push(fetch(n+"&type=arrondissement-municipal",l)),c.push(fetch(o+"&type=arrondissement-municipal",l))),Promise.all(c).then(u=>Promise.all(u.map(h=>h.json())).then(h=>{if(h[2]&&h[2].length&&h[2].forEach(f=>{switch(f.arrond=f.code,f.code.slice(0,2)){case"75":{f.code="75056";break}case"69":{f.code="69123";break}case"13":{f.code="13055";break}}}),h[3]&&h[3].length){const f=h[3][0],g=f.codesPostaux[0];if(h[1].length){const H=h[1].filter(ee=>ee.codesPostaux.includes(g)>=0);h[1]=h[1].filter(ee=>ee.codesPostaux.includes(g)<0);const Y=H.find(ee=>ee.code!==f.code);Y&&(f.arrond=f.code,f.code=Y.code)}}return h[0].concat(h[1]).concat(h[2]||[]).concat(h[3]||[])})).catch(u=>(this._showMessage("commCode","Une erreur est survenue lors de la rcupration des donnes de la commune."),[]))}async _fetchCadastre(e,i,n,o){const l=["97","98"].includes(e.slice(0,2)),c=e.slice(0,l?3:2),u=e.slice(l?3:2,5),h="https://data.geopf.fr/wfs/ows?",f={service:"WFS",version:"2.0.0",request:"GetFeature",typename:"CADASTRALPARCELS.PARCELLAIRE_EXPRESS:"+(o?"parcelle":"feuille"),outputFormat:"application/json",srsName:"CRS:84",count:"1000",propertyName:o?"com_abs,section,numero":"com_abs,section,code_arr",cql_filter:`code_dep='${c}' and code_com='${u}'`+(i?`and code_arr='${i.slice(2)}'`:"")+(o?` and com_abs='${n}' and section='${o}'`:"")},g=new URLSearchParams(f).toString(),H=h+g;this.controller&&this.controller.abort(),this.controller=new AbortController;const Y=await fetch(H,{headers:{"Content-Type":"application/json"},signal:this.controller.signal}).catch(te=>null);return this.controller=null,Y?await Y.json():{}}addInputs(){super.addInputs();const e=document.createElement("legend");e.className="fr-fieldset__legend fr-fieldset__legend--regular",e.id=Helper.getUid("ParcelAdvancedSearch-legend-");const i=document.createElement("span");i.className="fr-hint-text",i.textContent="* Champs obligatoires",e.appendChild(i),this.inputs.push(e);const n=this.comCodeInput=document.createElement("input");n.className="fr-input",n.type="text",n.name="commCode",n.pattern="^(\\d\\d|2[A,B,a,b,0-9])\\d{3}$",n.title="Code postal ou code INSEE",n.id=Helper.getUid("ParcelAdvancedSearch-comCode-");const o=this._getLabelContainer("Renseigner un lieu*","fr-input-group",n,"Code postal ou code INSEE"),l=this.autocompleteList=document.createElement("ul");l.className="GPautoCompleteList",l.id=Helper.getUid("GPautoCompleteList-"),l.setAttribute("role","listbox"),l.setAttribute("tabindex","-1"),l.setAttribute("aria-label","Propositions"),o.insertBefore(l,n.nextSibling),n.setAttribute("role","combobox"),n.setAttribute("aria-controls",l.id),n.setAttribute("aria-expanded","false"),n.setAttribute("aria-autocomplete","list"),n.setAttribute("aria-haspopup","listbox"),n.setAttribute("autocomplete","off");const c=this.prefixInput=document.createElement("select");c.className="fr-select",c.name="prefix",c.title="Choisir le prfixe de la parcelle",c.id=Helper.getUid("ParcelAdvancedSearch-prefix-"),c.setAttribute("disabled","disabled"),this._getLabelContainer("Prfix","fr-select-group",c,"");const u=this.sectionInput=document.createElement("select");u.className="fr-select",u.name="section",u.title="Choisir la section de la parcelle",u.id=Helper.getUid("ParcelAdvancedSearch-section-"),u.setAttribute("disabled","disabled"),this._getLabelContainer("Section*","fr-select-group",u,"");const h=this.numberInput=document.createElement("input");h.className="fr-input",h.type="text",h.pattern="\\d{1,4}",h.maxLength="4",h.name="numero",h.title="Numro de la parcelle",h.autocomplete="off",h.ariaExpanded="false",h.id=Helper.getUid("ParcelAdvancedSearch-number-"),h.setAttribute("disabled","disabled");const f=this._getLabelContainer("Numro*","fr-input-group",h,""),g=this.numberList=document.createElement("ul");g.className="GPautoCompleteList",g.id=Helper.getUid("GPautoCompleteList-"),g.setAttribute("role","listbox"),g.setAttribute("tabindex","-1"),g.setAttribute("aria-label","Propositions"),f.insertBefore(g,h.nextSibling)}_onSearch(e){if(e&&super._onSearch(e),!this.communeId)return;this._clearMessages();const i=this.prefixInput.value,n=this.sectionInput.value,o=this.numberInput.value;if(i)if(n)if(this.numberInput.checkValidity()){if(!o){this._showMessage("numero","Le numro de parcelle est obligatoire.");return}}else{this._showMessage("numero","Le numro de parcelle doit tre un nombre.");return}else{this._showMessage("section","La section est obligatoire.");return}else return;const c=(this.arrondId||this.communeId)+"000".slice(i.length)+i+n+"0000".slice(o.length)+o;this.searchService.search({location:c})}_onErase(e){super._onErase(e),this.setCommune(),this._clearMessages()}}window.ol&&window.ol.control&&(window.ol.control.ParcelAdvancedSearch=ParcelAdvancedSearch);const stringToHTML$3=s=>{var e=function(){if(!window.DOMParser)return!1;var l=new DOMParser;try{l.parseFromString("x","text/html")}catch{return!1}return!0};if(e()){var i=new DOMParser,n=i.parseFromString(s,"text/html");return n.body}var o=document.createElement("div");return o.innerHTML=s,o};var MousePositionDOM={_addUID:function(s){var e=this._uid?s+"-"+this._uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPmousePosition"),s.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",s},_createShowMousePositionPictoElement:function(s){var e=this,i=document.createElement("button"),n=document.createElement("span");return i.appendChild(n),i.id=this._addUID("GPshowMousePositionPicto"),i.classList.add("GPshowOpen","GPshowAdvancedToolPicto"),i.classList.add("gpf-btn","gpf-btn--tertiary","gpf-btn-icon","gpf-btn-icon-position"),i.classList.add("fr-btn","fr-btn--tertiary"),i.setAttribute("aria-label","Afficher les coordonnes du curseur"),i.setAttribute("tabindex","0"),i.setAttribute("aria-pressed",!1),i.setAttribute("type","button"),i.addEventListener?i.addEventListener("click",function(o){var l=o.target.ariaPressed==="true";o.target.setAttribute("aria-pressed",!l),e.onShowMousePositionClick(o)}):i.attachEvent&&i.attachEvent("onclick",function(o){var l=o.target.ariaPressed==="true";o.target.setAttribute("aria-pressed",!l),e.onShowMousePositionClick(o)}),i},_createMousePositionPanelElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPmousePositionPanel"),s.className="GPpanel gpf-panel fr-modal",s},_createMousePositionPanelDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__body fr-modal__body",s},_createMapCenter:function(){var s=document.createElement("div");return s.id="GPmapCenter",s.className="",s},_createMousePositionPanelTitleElement:function(){var s=document.createElement("div");return s.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",s.id=this._addUID("GPmousePositionHeaderTitle"),s.innerHTML="Coordonnes",s},_createMousePositionPanelHeaderElement:function(){var s=document.createElement("div");return s.className="GPpanelHeader gpf-panel__header fr-modal__header",s},_createMousePositionPanelCloseElement:function(){var s=this,e=document.createElement("button");e.id=this._addUID("GPmousePositionPanelClose"),e.className="GPpanelClose gpf-btn gpf-btn-icon-close  fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",e.title="Fermer le panneau",e.addEventListener?(e.addEventListener("click",function(){document.getElementById(s._addUID("GPshowMousePositionPicto")).click()},!1),e.addEventListener("keydown",function(n){n.keyCode===13&&document.getElementById(s._addUID("GPshowMousePositionPicto")).click()},!1)):e.attachEvent&&(e.attachEvent("onclick",function(){document.getElementById(s._addUID("GPshowMousePositionPicto")).click()}),e.attachEvent("onkeydown",function(n){n.keyCode===13&&document.getElementById(s._addUID("GPshowMousePositionPicto")).click()}));var i=document.createElement("span");return i.className="GPelementHidden gpf-visible",i.innerText="Fermer",e.appendChild(i),e},_createMousePositionPanelBasicElement:function(s,e,i,n){s=typeof s>"u"?!0:s,e=typeof e>"u"?!0:e,i=typeof i>"u"?!1:i;var o=document.createElement("div");return o.id=this._addUID("GPmousePositionBasicPanel"),o.classList.add("fr-mx-1w"),o.appendChild(this._createMousePositionPanelBasicCoordinateElement(e,i,n)),o.appendChild(this._createMousePositionPanelEditToolsElement(i)),o.appendChild(this._createMousePositionPanelBasicAltitudeElement(s)),o},_createCoordinateElement:function(s,e){var i=this;if(["Lon","Lat"].indexOf(s)===-1)return[];var n=[],o=document.createElement("input");o.id=this._addUID("GPmousePosition"+s),o.title=e===!0?"Cliquer pour saisir des coordonnes":"",o.readOnly=!0,e&&(o.addEventListener("click",function(){i.onMousePositionEditModeClick(!0)}),o.addEventListener("change",function(c){this.classList.remove("error");var u=i.validateExtentCoordinate(s,this.value,c);u?this.classList.remove("error"):this.classList.add("error")})),n.push(o);var l=document.createElement("span");return l.className="GPmousePositionUnits",n.push(l),n},_createDMSCoordinateElement:function(s,e){if(["Lon","Lat"].indexOf(s)===-1)return[];var i=this,n=[],o=document.createElement("input");o.id=this._addUID("GPmousePosition"+s+"Degrees"),o.className="GPSexagesimal",o.setAttribute("name","degrees"),o.title=e===!0?"Cliquer pour saisir des coordonnes":"",o.readOnly=!0,o.dataset.min=0,o.dataset.max=s==="Lon"?180:90,e&&(o.addEventListener("click",function(){i.onMousePositionEditModeClick(!0)}),o.addEventListener("change",function(){this.classList.remove("error");var ee=i._checkDMSDegrees(s,this);ee?this.classList.remove("error"):this.classList.add("error")})),n.push(o);var l=document.createElement("span");l.className="GPmousePositionSexagesimalLabel",l.innerHTML="",n.push(l);var c=document.createElement("input");c.id=this._addUID("GPmousePosition"+s+"Minutes"),c.className="GPSexagesimal",c.setAttribute("name","minutes"),c.title=e===!0?"Cliquer pour saisir des coordonnes":"",c.readOnly=!0,c.dataset.min=0,c.dataset.max=59,e&&(c.addEventListener("click",function(){i.onMousePositionEditModeClick(!0)}),c.addEventListener("change",function(){this.classList.remove("error");var ee=i._checkDMSElement(this);ee?this.classList.remove("error"):this.classList.add("error")})),n.push(c);var u=document.createElement("span");u.className="GPmousePositionSexagesimalLabel",u.innerHTML="'",n.push(u);var h=document.createElement("input");h.id=this._addUID("GPmousePosition"+s+"Seconds"),h.className="GPSexagesimalsec",h.setAttribute("name","seconds"),h.title=e===!0?"Cliquer pour saisir des coordonnes":"",h.readOnly=!0,h.dataset.min=0,h.dataset.max=59,e&&(h.addEventListener("click",function(){i.onMousePositionEditModeClick(!0)}),h.addEventListener("change",function(){this.classList.remove("error");var ee=i._checkDMSElement(this,!0);ee?this.classList.remove("error"):this.classList.add("error")})),n.push(h);var f=document.createElement("span");f.className="GPmousePositionSexagesimalLabel",f.innerHTML="''",n.push(f);var g=document.createElement("select");g.id=this._addUID("GPmousePosition"+s+"Direction"),g.className="GPmousePositionDirection",g.setAttribute("name","direction"),g.disabled=!0;var H=document.createElement("option");H.value=s==="Lon"?"E":"N",H.innerHTML=s==="Lon"?"E":"N",g.appendChild(H);var Y=document.createElement("option");return Y.value=s==="Lon"?"O":"S",Y.innerHTML=s==="Lon"?"O":"S",g.appendChild(Y),n.push(g),n},_createMousePositionPanelBasicCoordinateElement:function(s,e,i){var n=document.createElement("div");n.id=this._addUID("GPmousePositionCoordinate"),n.style.display=s?"block":"none";var o=document.createElement("div"),l=document.createElement("span");l.className="GPmousePositionLabel",l.id=this._addUID("GPmousePositionLatLabel"),l.innerHTML="Latitude : ",o.appendChild(l);var c=document.createElement("span");c.id=this._addUID("GPmousePositionLatCoordinate");var u;i==="DMS"?u=this._createDMSCoordinateElement("Lat",e):u=this._createCoordinateElement("Lat",e);for(var h=0;h<u.length;h++)c.appendChild(u[h]);o.appendChild(c),n.appendChild(o);var f=document.createElement("div"),g=document.createElement("span");g.className="GPmousePositionLabel",g.id=this._addUID("GPmousePositionLonLabel"),g.innerHTML="Longitude : ",f.appendChild(g);var H=document.createElement("span");H.id=this._addUID("GPmousePositionLonCoordinate");var Y;i==="DMS"?Y=this._createDMSCoordinateElement("Lon",e):Y=this._createCoordinateElement("Lon",e);for(var ee=0;ee<Y.length;ee++)H.appendChild(Y[ee]);return f.appendChild(H),n.appendChild(f),n},_createMousePositionPanelBasicAltitudeElement:function(s){var e=document.createElement("div");e.id=this._addUID("GPmousePositionAltitude"),e.style.display=s?"block":"none";var i=document.createElement("span");i.className="GPmousePositionLabel",i.innerHTML="Altitude : ",e.appendChild(i);var n=document.createElement("span");n.className="GPmousePositionCoords",n.id=this._addUID("GPmousePositionAlt"),n.innerHTML="...",e.appendChild(n);var o=document.createElement("span");return o.className="GPmousePositionAltitudeUnits",o.innerHTML="m",e.appendChild(o),e},_createMousePositionPanelEditToolsElement:function(s){var e=this,i=document.createElement("div");i.className="GPmousePositionPanelEditTools",i.id=this._addUID("GPmousePositionPanelEditTools"),s||(i.style.display="none");var n=document.createElement("span");n.className="GPmousePositionEditTool gpf-btn gpf-btn-icon gpf-btn-icon-mp-edit fr-btn fr-btn--tertiary gpf-btn--tertiary",n.id=this._addUID("GPmousePositionLocate"),n.title=s===!0?"Cliquer pour saisir des coordonnes":"",s&&n.addEventListener("click",function(){e.onMousePositionEditModeLocateClick()}),i.appendChild(n);var o=document.createElement("span");return o.className="GPmousePositionEditTool gpf-btn gpf-btn-icon gpf-btn-icon-mp-edit-close fr-btn fr-btn--tertiary gpf-btn--tertiary",o.id=this._addUID("GPmousePositionCloseEdit"),o.title="Quitter la saisie des coordonnes",o.style.display="none",s&&o.addEventListener("click",function(){e.onMousePositionEditModeClick(!1)}),i.appendChild(o),i},_createShowMousePositionSettingsElement:function(s){var e=this,i=document.createElement("button");return i.id=this._addUID("GPshowMousePositionSettings"),i.className="GPelementHidden GPshowAdvancedToolPicto GPshowMoreOptionsImage GPshowMoreOptions GPshowMousePositionSettingsPicto gpf-hidden gpf-btn fr-btn--sm fr-btn--tertiary gpf-btn--tertiary fr-icon-arrow-down-fill",i.title="Rglages",i.setAttribute("tabindex","0"),i.setAttribute("aria-pressed",!0),i.addEventListener?i.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),e.onShowMousePositionSettingsClick(n)}):i.attachEvent&&i.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),e.onShowMousePositionSettingsClick(n)}),i},_createMousePositionSettingsElement:function(s){var e=document.createElement("div");e.id=this._addUID("GPmousePositionSettings"),e.style.display=s===void 0||s?"block":"none",e.classList.add("fr-m-1w");var i=document.createElement("span");return i.className="GPmousePositionSettingsLabel",e.appendChild(i),e},_createMousePositionSettingsAccordion:function(s){var e=stringToHTML$3(`
                <section class="fr-accordion">
                               <div class="fr-accordion__title GPmousePositionSettingsLabel">
                                   <button type="button" class="fr-accordion__btn" aria-expanded="false" aria-controls="accordion-more-settings-1">
                                       <span class="GPshowMousePositionAdvancedTools gpf-hidden"></span>Systme de rfrence
                                   </button>
                               </div>
                               <div class="fr-collapse GPelementHidden" id="accordion-more-settings-1">
                               </div>
                    </section>
           `);return s.map(i=>e.getElementsByClassName("fr-collapse")[0].append(i)),e.getElementsByTagName("button")[0].addEventListener("click",function(i){var n=i.target.ariaExpanded==="true";i.target.setAttribute("aria-expanded",!n),n?(e.getElementsByClassName("fr-collapse")[0].classList.remove("fr-collapse--expanded"),e.getElementsByClassName("fr-collapse")[0].classList.add("GPelementHidden")):(e.getElementsByClassName("fr-collapse")[0].classList.add("fr-collapse--expanded"),e.getElementsByClassName("fr-collapse")[0].classList.remove("GPelementHidden"))}),e},_createMousePositionSettingsSystemsElement:function(s){var e=this,i=document.createElement("select");i.id=this._addUID("GPmousePositionProjectionSystem"),i.className="GPselect GPmousePositionSettingsSelect gpf-select fr-select fr-my-1w",i.addEventListener("change",function(c){e.onMousePositionProjectionSystemChange(c)}),i.addEventListener("mouseover",function(c){c.target.nodeName!=="OPTION"&&e.onMousePositionProjectionSystemMouseOver(c)}),i.title="Type de systme";for(var n=0;n<s.length;n++){var o=s[n],l=document.createElement("option");l.value=o.code,l.text=o.label||n,i.appendChild(l)}return i},_createMousePositionSettingsUnitsElement:function(s){var e=this,i=document.createElement("select");i.id=this._addUID("GPmousePositionProjectionUnits"),i.className="GPselect GPmousePositionSettingsSelect gpf-select fr-select",i.addEventListener("change",function(c){e.onMousePositionProjectionUnitsChange(c)}),i.title="Units du systme";for(var n=0;n<s.length;n++){var o=s[n],l=document.createElement("option");l.value=o.code?o.code:n,l.text=o.label||n,i.appendChild(l)}return i},_resetLabelElements:function(s){var e=document.getElementById(this._addUID("GPmousePositionLatLabel"));e.innerHTML=s==="Geographical"?"Latitude :":"X :";var i=document.getElementById(this._addUID("GPmousePositionLonLabel"));i.innerHTML=s==="Geographical"?"Longitude :":"Y :"},_resetUnitElements:function(s){var e="";(s==="M"||s==="KM")&&(e=s.toLowerCase());for(var i=document.getElementsByClassName("GPmousePositionUnits"),n=0;n<i.length;n++)i[n].innerHTML=e},_resetCoordinateElements:function(s,e,i){for(var n=document.getElementById(this._addUID("GPmousePositionLatCoordinate"));n.firstChild;)n.removeChild(n.firstChild);var o;i==="DMS"?o=this._createDMSCoordinateElement("Lat",s):o=this._createCoordinateElement("Lat",s);for(var l=0;l<o.length;l++)n.appendChild(o[l]);for(var c=document.getElementById(this._addUID("GPmousePositionLonCoordinate"));c.firstChild;)c.removeChild(c.firstChild);var u;i==="DMS"?u=this._createDMSCoordinateElement("Lon",s):u=this._createCoordinateElement("Lon",s);for(var h=0;h<u.length;h++)c.appendChild(u[h])},_setEditMode:function(s){var e=document.getElementById(this._addUID("GPmousePositionLocate"));e.title=s?"Aller  la position ...":"Cliquer pour saisir des coordonnes";var i=document.getElementById(this._addUID("GPmousePositionCloseEdit"));i.style.display=s?"inline-block":"none",s===!0?(e.classList.remove("gpf-btn-icon-mp-edit"),e.classList.add("gpf-btn-icon-mp-edit-center"),document.getElementById(this._addUID("GPmousePositionLat")).focus()):(e.classList.remove("gpf-btn-icon-mp-edit-center"),e.classList.add("gpf-btn-icon-mp-edit"));for(var n="div[id^="+this._addUID("GPmousePositionCoordinate")+"]",o=document.querySelectorAll(n+" input"),l=0;l<o.length;l++)o[l].readOnly=!s,s&&o[l].classList.remove("error");for(var c=document.querySelectorAll(n+" select"),u=0;u<c.length;u++)c[u].disabled=!s},_checkDMSElement:function(s,e){var i=e!==void 0,n=s.value;if(i&&(n=n.replace(",",".")),isNaN(n))return!1;var o=parseFloat(n);if(!i&&(o|0)!==o)return!1;var l=Number(s.dataset.min),c=Number(s.dataset.max);return o>=l&&o<=c},_checkDMSDegrees:function(s,e){if(isNaN(e.value))return!1;var i=parseFloat(e.value);if((i|0)!==i)return!1;var n=Number(e.dataset.min),o=Number(e.dataset.max);if(i<n||i>o)return!1;var l=document.getElementById(this._addUID("GPmousePosition"+s+"Minutes")),c=document.getElementById(this._addUID("GPmousePosition"+s+"Seconds"));return i>=o?(l.dataset.max=0,c.dataset.max=0):(l.dataset.max=59,c.dataset.max=59.9999),!0},GPdisplayCoords:function(s){if(s){var e=document.getElementById(this._addUID("GPmousePositionLonLabel")),i=document.getElementById(this._addUID("GPmousePositionLatLabel"));if(s.x||s.y?(i.innerHTML="X : ",e.innerHTML="Y : "):s.e||s.n?(i.innerHTML="E : ",e.innerHTML="N : "):(i.innerHTML="Latitude : ",e.innerHTML="Longitude : "),typeof s.lat=="object"&&typeof s.lng=="object"){var n={lng:"Lon",lat:"Lat"},o=["Degrees","Minutes","Seconds"];for(var l in n)for(var c=0;c<o.length;++c){var u="GPmousePosition"+n[l]+o[c],h=document.getElementById(this._addUID(u)),f=o[c].charAt(0).toLowerCase();h.value=s[l][f]}document.getElementById(this._addUID("GPmousePositionLonDirection")).value=s.lng.direction,document.getElementById(this._addUID("GPmousePositionLatDirection")).value=s.lat.direction}else{var g=document.getElementById(this._addUID("GPmousePositionLat")),H=document.getElementById(this._addUID("GPmousePositionLon"));g.value=s.x||s.lat||s.e||"0",H.value=s.y||s.lng||s.lon||s.n||"0",g.title="Latitude",H.title="Longitude",g.type="text",H.type="text";for(var Y=s.unit===void 0?"":s.unit,ee=document.getElementsByClassName("GPmousePositionUnits"),te=0;te<ee.length;++te)ee[te].innerHTML=Y}}},GPdisplayElevation:function(s,e,i,n){var o=this,l;e||(e=500),clearTimeout(l),document.getElementById(this._addUID("GPmousePositionAlt")).innerHTML="...",i==null&&(i=-99999),n==null&&(n=99980);var c=i+n,u=i-n;s&&document.getElementById(this._addUID("GPmousePositionAltitude"))&&(l=setTimeout(function(){o.onRequestAltitude(s,function(h){u<h&&h<c?o.GPresetElevation():document.getElementById(o._addUID("GPmousePositionAlt")).innerHTML=h})},e))},GPresetElevation:function(){document.getElementById(this._addUID("GPmousePositionAltitude"))&&(document.getElementById(this._addUID("GPmousePositionAlt")).innerHTML="---")}},logger$v=LoggerByDefault.getLogger("GeoportalMousePosition");class MousePosition extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof MousePosition))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="MousePosition",this._initialize(e),this.container=this._initContainer(this.options),this.element?this.element.appendChild(this.container):this.element=this.container,this}setMap(e){var i=this;if(e){var n=this._createMapCenter();if(e.getViewport().appendChild(n),!this.collapsed&&!this._isDesktop&&(n.className="GPmapCenterVisible"),this.draggable&&Draggable.dragElement(this._panelMousePositionContainer,this._panelHeaderContainer,e.getTargetElement()),this.collapsed||(this._isDesktop?this.listenerKey=e.on("pointermove",c=>{this.onMouseMove(c)}):this.listenerKey=e.on("moveend",c=>this.onMapMove(c)),this._showMousePositionButton.setAttribute("aria-pressed",!0)),this.options.editCoordinates){var o=document.createElement("img");o.id=this._addUID("GPmousePositionMarker"),o.src=this._markerUrl,o.title="Cliquer pour supprimer",o.addEventListener("click",function(){i._markerOverlay.setPosition(void 0)}),this._markerOverlay=new Overlay({offset:this._markerOffset,element:o,stopEvent:!1}),e.addOverlay(this._markerOverlay)}}else unByKey(this.listenerKey);if(super.setMap(e),e!==null&&(this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter"),!this.collapsed)){var l=document.getElementById("GPshowMousePosition-"+this._uid);l.checked="checked",this._setElevationPanel(this.options.displayAltitude),this._setCoordinatesPanel(this.options.displayCoordinates),this.options.displayCoordinates||this._setSettingsPanel(!1)}}addSystem(e){if(typeof e!="object"){logger$v.log("[ERROR] MousePosition:addSystem - system parameter should be an object");return}if(!e.crs){logger$v.error("crs not defined !");return}if(e.label||(logger$v.warn("crs label not defined, use crs code by default."),e.label=e.crs),e.type||(logger$v.warn("type srs not defined, use 'Metric' by default."),e.type="Metric"),CRS.loadByName(e.crs),!get$3(e.crs)){logger$v.error("crs '{}' not available into proj4 definitions !",e.crs);return}for(var i=0;i<this._projectionSystems.length;i++){var n=this._projectionSystems[i];e.crs===n.crs&&logger$v.info("crs '{}' already configured",n.crs)}e.code=this._projectionSystems.length,this._projectionSystems.push(e);var o=document.getElementById("GPmousePositionProjectionSystem-"+this._uid);if(o){var l=document.createElement("option");l.value=e.code,l.text=e.label,o.appendChild(l)}}addSystems(e){if(e){if(!Array.isArray(e)){logger$v.log("[ERROR] MousePosition:addSystems - systems parameter should be an array");return}for(var i=0;i<e.length;i++)this.addSystem(e[i])}}removeSystem(e){if(!e||typeof e!="string"){logger$v.log("[ERROR] MousePosition:removeSystem - systemCode parameter should be a string");return}for(var i=document.getElementById("GPmousePositionProjectionSystem-"+this._uid),n=null,o=0;o<this._projectionSystems.length;o++){var l=this._projectionSystems[o];if(e===l.crs){n=l.code,this._projectionSystems.splice(o,1);break}}if(n==null){logger$v.log("[WARN] MousePosition:removeSystem - system not found");return}for(var c=[],u=0;u<this._projectionSystems.length;u++)c[Number(this._projectionSystems[u].code)]=u,this._projectionSystems[u].code=u;for(var h=null,f=0;f<i.childNodes.length;f++){if(n===i.childNodes[u].value){h=f;continue}i.childNodes[u].value=c[Number(i.childNodes[u].value)]}h!=null&&i.removeChild(i.childNodes[h]),this._currentProjectionSystems.code===Number(n)&&(i.childNodes[0].setAttribute("selected","selected"),this._setCurrentSystem(i.childNodes[0].value))}setUnits(e){!e||!Array.isArray(e)||(this.options.units=e,this._projectionUnits=[],this._initProjectionUnits(),this._currentProjectionType&&this._setTypeUnitsPanel(this._currentProjectionType))}setAltitudeOptions(e){if(!(!e||typeof e!="object")&&(this.options.altitude.triggerDelay=e.triggerDelay,this.options.altitude.responseDelay=e.responseDelay,e.serviceOptions))for(var i in e.serviceOptions)e.serviceOptions.hasOwnProperty(i)&&(this.options.altitude.serviceOptions[i]=e.serviceOptions[i])}displayAltitude(e){e!==void 0&&(this.options.displayAltitude=e,this._setElevationPanel(e))}displayCoordinates(e){e!==void 0&&(this.options.displayCoordinates=e,this._setCoordinatesPanel(e),this._setSettingsPanel(e))}setCollapsed(e){if(e===void 0){logger$v.log("[ERROR] MousePosition:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(this._isDesktop||(document.getElementById("GPmapCenter").className=e?"":"GPmapCenterVisible"),this.onShowMousePositionClick(),this._showMousePositionContainer.checked=!e)}getContainer(){return this.container}_initialize(e){if(e=e||{},this.options=e,this.options.collapsed=e.collapsed!==void 0?e.collapsed:!0,this.collapsed=this.options.collapsed,this.options.draggable=e.draggable!==void 0?e.draggable:!1,this.draggable=this.options.draggable,this._markerOverlay=null,this._markerUrl=null,this._markerOffset=[0,0],this._hideMarker=!1,this._initMarker(e.positionMarker),this.options.units=e.units||[],this.options.displayAltitude=e.displayAltitude!==void 0?e.displayAltitude:!0,this.options.displayCoordinates=e.displayCoordinates!==void 0?e.displayCoordinates:!0,this.options.displayCoordinates?this.options.editCoordinates=e.editCoordinates!==void 0?e.editCoordinates:!1:this.options.editCoordinates=!1,this.editing=!1,this.options.systems=e.systems||[],e.altitude){var i=e.altitude;this.options.altitude={triggerDelay:i.triggerDelay!==void 0?i.triggerDelay:200,responseDelay:i.responseDelay!==void 0?i.responseDelay:500,serviceOptions:i.serviceOptions||{},noDataValue:i.noDataValue!==void 0?i.noDataValue:-99999,noDataValueTolerance:i.noDataValueTolerance!==void 0?i.noDataValueTolerance:9e4}}else this.options.altitude={triggerDelay:200,responseDelay:500,serviceOptions:{}};this._uid=this.options.id||SelectorID.generate(),this._projectionSystems=[],this._initProjectionSystems(),this._projectionUnits={},this._initProjectionUnits(),this._isDesktop=Helper.detectSupport(),this.options.altitude.triggerDelay<100&&(this.options.altitude.triggerDelay=100),this._timer=this.options.altitude.triggerDelay,this._currentProjectionSystems=this._projectionSystems[0],this._currentProjectionType=this._projectionSystems[0].type,this._currentProjectionUnits=this._projectionUnits[this._currentProjectionType][0].code,this._projectionUnitsContainer=null,this._showMousePositionContainer=null,this._panelMousePositionContainer=null,this._panelHeaderMousePositionContainer=null,!this.options.displayAltitude&&!this.options.displayCoordinates&&(this.options.displayCoordinates=!0),this.listenerKey=null}_initMarker(e){if(this.options.editCoordinates){if(!e){this._markerUrl=Marker.lightOrange,this._markerOffset=Marker.defaultOffset;return}this._hideMarker=e.hide!==void 0?e.hide:!1,e.offset?Array.isArray(e.offset)&&e.offset.length===2?this._markerOffset=e.offset:(logger$v.log("positionMarker.offset should be an array. e.g. : [0,0]"),this._markerOffset=Marker.defaultOffset):this._markerOffset=Marker.defaultOffset;var i=e.url;i?i.match(/^[a-zA-Z]+$/)?this._markerUrl=Marker[i]!==void 0?Marker[i]:Marker.lightOrange:this._markerUrl=i:this._markerUrl=Marker.lightOrange}}_initProjectionSystems(){for(var e=[{label:"Gographique",crs:get$3("EPSG:4326").getCode(),type:"Geographical"},{label:"Web Mercator",crs:get$3("EPSG:3857").getCode(),type:"Metric"},{label:"Lambert 93",crs:get$3("EPSG:2154").getCode(),type:"Metric",geoBBox:{left:-9.86,bottom:41.15,right:10.38,top:51.56}},{label:"Lambert II tendu",crs:get$3("EPSG:27572").getCode(),type:"Metric",geoBBox:{left:-4.87,bottom:42.33,right:8.23,top:51.14}}],i=this.options.systems,n=0;n<i.length;n++){var o=i[n];this.addSystem(o)}if(this._projectionSystems.length===0)for(var l=0;l<e.length;l++)this.addSystem(e[l])}_initProjectionUnits(){var e={Geographical:[{code:"DEC",label:"Degrs dcimaux",format:MathUtils.coordinateToDecimal},{code:"DMS",label:"Degrs sexagsimaux",format:MathUtils.coordinateToDMS},{code:"RAD",label:"Radians",format:MathUtils.coordinateToRad},{code:"GON",label:"Grades",format:MathUtils.coordinateToGon}],Metric:[{code:"M",label:"Mtres",format:MathUtils.coordinateToMeter},{code:"KM",label:"Kilomtres",format:MathUtils.coordinateToKMeter}]},i=this.options.units;for(var n in e)if(e.hasOwnProperty(n)){for(var o=!1,l=0;l<e[n].length;l++)for(var c=e[n][l],u=0;u<i.length;u++){var h=i[u];c.code===h&&(o=!0,this._projectionUnits[n]||(this._projectionUnits[n]=[]),this._projectionUnits[n].push(c))}o||(this._projectionUnits[n]=e[n])}typeof this._projectionUnits=="object"&&Object.keys(this._projectionUnits).length===0&&(this._projectionUnits=e)}_getCurrentProjectionInformation(){for(var e=[this._currentProjectionSystems.label,"en"],i=this._projectionUnits[this._currentProjectionType],n=0;n<i.length;++n)if(i[n].code===this._currentProjectionUnits){e.push(i[n].label);break}return e.join(" ")}_initContainer(){var e=this._createMainContainerElement(),i=this._showMousePositionButton=this._createShowMousePositionPictoElement();e.appendChild(i);var n=this._panelMousePositionContainer=this._createMousePositionPanelElement(),o=this._createMousePositionPanelDivElement();n.appendChild(o);var l=this._panelHeaderContainer=this._createMousePositionPanelHeaderElement(),c=this._panelTitleContainer=this._createMousePositionPanelTitleElement();l.appendChild(c);var u=this._panelCloseButton=this._createMousePositionPanelCloseElement();l.appendChild(u),o.appendChild(l);var h=this._createMousePositionPanelBasicElement(this.options.displayAltitude,this.options.displayCoordinates,this.options.editCoordinates,this._currentProjectionUnits);o.appendChild(h);var f=this._createShowMousePositionSettingsElement(this.options.displayCoordinates);o.appendChild(f);var g=this._createMousePositionSettingsElement(),H=this._projectionSystemsContainer=this._createMousePositionSettingsSystemsElement(this._projectionSystems),Y=this._projectionUnitsContainer=this._createMousePositionSettingsUnitsElement(this._projectionUnits[this._currentProjectionType]),ee=this._createMousePositionSettingsAccordion([H,Y]);return g.appendChild(ee),o.appendChild(g),e.appendChild(n),e}_setElevationPanel(e){var i=null;e?(i=document.getElementById("GPmousePositionAltitude-"+this._uid),i.style.display=""):(i=document.getElementById("GPmousePositionAltitude-"+this._uid),i.style.display="none")}_setCoordinatesPanel(e){var i=document.getElementById("GPmousePositionCoordinate-"+this._uid);e?i.style.display="":i.style.display="none"}_setSettingsPanel(e){var i=document.getElementById("GPshowMousePositionSettingsPicto-"+this._uid),n=document.getElementById("GPmousePositionSettings-"+this._uid);e?(i.style.display="",n.style.display=""):(i.style.display="none",n.style.display="none")}_setTypeUnitsPanel(e){for(var i=this._projectionUnitsContainer;i.firstChild;)i.removeChild(i.firstChild);for(var n=this._projectionUnits[e],o=0;o<n.length;o++){var l=n[o],c=document.createElement("option");c.value=l.code?l.code:o,c.text=l.label||o,i.appendChild(c)}var u=this._projectionUnits[e][0].code;(this._currentProjectionUnits==="DMS"||u==="DMS")&&(this._resetCoordinateElements(this.options.editCoordinates,e,u),this._setEditMode(this.editing)),this._currentProjectionType=e,this._resetLabelElements(e),this._resetUnitElements(u),this._currentProjectionUnits=u}_setCoordinate(e,i){var n={},o=this._currentProjectionSystems.crs;if(!o){logger$v.log("ERROR : system crs not found");return}e=transform$1(e,i,o);for(var l=this._currentProjectionSystems.type,c=null,u=this._projectionUnits[l],h=0;h<u.length;h++)if(u[h].code===this._currentProjectionUnits){c=u[h].format;break}if(!c||typeof c!="function"){logger$v.log("WARNING : coordinates format function not found");return}else n=c(e);!n||Object.keys(n).length===0||this.GPdisplayCoords(n)}_setElevation(e){var i=this.options.altitude.responseDelay,n=this.options.altitude.noDataValue,o=this.options.altitude.noDataValueTolerance;this.GPdisplayElevation(e,i,n,o)}onMoveStopped(e,i){var n=transform$1(e,i,"EPSG:4326");this._setElevation(n)}onMouseMove(e){var i=this;const n=e.originalEvent||e;if(!this._panelMousePositionContainer.contains(n.target)){var o=e.coordinate;if(!(!e.map||!e.map.getView())){var l=e.map.getView().getProjection();this._setCoordinate(o,l),clearTimeout(this._timer),this._timer=setTimeout(function(){i.onMoveStopped(o,l)},this.options.altitude.triggerDelay)}}}onMapMove(){var e=this,i=this.getMap();if(!(!i||!i.getView())){var n=i.getView(),o=n.getCenter(),l=n.getProjection();this._setCoordinate(o,l),clearTimeout(this._timer),this._timer=setTimeout(function(){e.onMoveStopped(o,l)},this.options.altitude.triggerDelay)}}onRequestAltitude(e,i){if(!(!e||Object.keys(e).length===0)&&this.options.displayAltitude){var n=this.options.altitude.serviceOptions||{},o=n.protocol||"XHR",l=n.timeOut||0;o==="JSONP"&&l===0&&(l=15e3);var c=n.outputFormat||"json",u=!0,u;n.zonly===!1?u=n.zonly:u=!0;var h=n.measures||!1,f=[{lon:e[0],lat:e[1]}],g=n.resource,H=this,Y=n.rawResponse||!1,ee=n.onSuccess||null,te=null,xe=null;Y?te=function(tt){ee&&ee.call(this,tt),logger$v.log("alti service raw response : ",tt)}:te=function(tt){tt&&Object.keys(tt).length&&(ee&&ee.call(this,tt),i.call(this,tt.elevations[0].z))},xe=function(tt){logger$v.log("[getAltitude] ERROR : "+tt.message)};var ne=n.apiKey||this.options.apiKey;typeof n.ssl!="boolean"&&(typeof this.options.ssl=="boolean"?n.ssl=this.options.ssl:n.ssl=!0);var et=n.ssl;Gp.Services.getAltitude({apiKey:ne,protocol:o,ssl:et,timeOut:l,scope:H,outputFormat:c,rawResponse:Y,onSuccess:te,onFailure:xe,zonly:u,measures:h,resource:g,positions:f})}}onShowMousePositionClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen();var i=this.getMap();Interactions.unset(i);var n=this._showMousePositionButton.ariaPressed;this.collapsed=n!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position),n==="false"?unByKey(this.listenerKey):this.editing||(this._isDesktop?this.listenerKey=i.on("pointermove",o=>{this.onMouseMove(o)}):(this.listenerKey=i.on("moveend",o=>this.onMapMove(o)),this.onMapMove())),this._setElevationPanel(this.options.displayAltitude),this._setCoordinatesPanel(this.options.displayCoordinates),this.options.displayCoordinates||this._setSettingsPanel(!1)}onShowMousePositionSettingsClick(e){this.draggable||e.target.ariaPressed}onMousePositionEditModeClick(e){if(this.options.editCoordinates&&this.editing!==e){this.editing=e,this._setEditMode(this.editing);var i=this.getMap();this._isDesktop?this.editing?unByKey(this.listenerKey):(this.listenerKey=i.on("pointermove",n=>{this.onMouseMove(n)}),this.onMapMove()):this.editing?unByKey(this.listenerKey):(this.listenerKey=i.on("moveend",n=>this.onMapMove(n)),this.onMapMove()),!this.editing&&this._markerOverlay&&this._markerOverlay.setPosition(void 0)}}getCoordinate(e){var i=document.getElementById(this._addUID("GPmousePosition"+e+"Degrees")),n=i.value;if(!n||(n=n.replace(",","."),!MathUtils.isInteger(n)))return null;var o=MathUtils.toInteger(n);if(o<Number(i.dataset.min)||o>Number(i.dataset.max))return null;var l=document.getElementById(this._addUID("GPmousePosition"+e+"Direction")).value,c=document.getElementById(this._addUID("GPmousePosition"+e+"Minutes")),u=c.value;if(u&&(u=u.replace(",","."),MathUtils.isInteger(u))){var h=MathUtils.toInteger(u);h>=Number(c.dataset.min)&&h<=Number(c.dataset.max)&&(o+=h/60)}var f=document.getElementById(this._addUID("GPmousePosition"+e+"Seconds")),g=f.value;if(g){g=g.replace(",",".");var H=MathUtils.toFloat(g);H&&H>=Number(f.dataset.min)&&H<=Number(f.dataset.max)&&(o+=H/3600)}return(l==="O"||l==="S")&&(o=-o),o}locateDMSCoordinates(){var e=[this.getCoordinate("Lon"),this.getCoordinate("Lat")];if(!(e[0]===null||e[1]===null)){var i=this._currentProjectionSystems.crs;if(!i){logger$v.log("ERROR : system crs not found");return}var n=this.getMap().getView(),o=transform$1(e,i,n.getProjection());n.setCenter(o),this._markerOverlay&&!this._hideMarker&&this._markerOverlay.setPosition(o)}}locateCoordinates(){var e=document.getElementById(this._addUID("GPmousePositionLon")).value;if(e=e.replace(",","."),e=MathUtils.toFloat(e),e!==null){var i=document.getElementById(this._addUID("GPmousePositionLat")).value;if(i=i.replace(",","."),i=MathUtils.toFloat(i),i!==null){var n=this._currentProjectionSystems.crs;if(!n){logger$v.log("ERROR : system crs not found");return}var o;this._currentProjectionSystems.type==="Geographical"?o=[this.convert(e),this.convert(i)]:o=[this.convert(i),this.convert(e)];var l=transform$1(o,this._currentProjectionSystems.crs,"EPSG:4326"),c=this._currentProjectionSystems.geoBBox;if(c){var u=[c.left,c.bottom,c.right,c.top];if(l[0]<u[0]||l[0]>u[2]||l[1]<u[1]||l[1]>u[3])return}var h=this.getMap().getView(),f=transform$1(o,n,h.getProjection());h.setCenter(f),this._markerOverlay&&!this._hideMarker&&this._markerOverlay.setPosition(f)}}}onMousePositionEditModeLocateClick(){if(this.options.editCoordinates){if(!this.editing){this.onMousePositionEditModeClick(!0);return}this._currentProjectionUnits==="DMS"?this.locateDMSCoordinates():this.locateCoordinates();var e=this.options.mapCenterCallback;if(typeof e=="function"){var i=this.getMap().getView(),n=i.getCenter();e.call(this,n)}}}onMousePositionProjectionSystemChange(e){var i=e.target.selectedIndex,n=e.target.options[i].value;this._setCurrentSystem(n)}_setCurrentSystem(e){for(var i=null,n=0;n<this._projectionSystems.length;++n)if(this._projectionSystems[n].code===Number(e)){i=this._projectionSystems[n].type;break}if(!i){logger$v.log("system not found in projection systems container");return}this._currentProjectionSystems=this._projectionSystems[Number(e)],i!==this._currentProjectionType&&this._setTypeUnitsPanel(i),this._isDesktop||this.onMapMove()}onMousePositionProjectionSystemMouseOver(e){logger$v.trace(e);var i=this.getMap();if(!(!i||!i.getView())){var n=i.getView(),o=n.getProjection(),l=n.calculateExtent(i.getSize());l=transformExtent(l,o,"EPSG:4326");var c=document.getElementById(this._addUID("GPmousePositionProjectionSystem"));c.innerHTML="";for(var u=0;u<this._projectionSystems.length;u++){var h=this._projectionSystems[u],f=null;if(h.geoBBox&&(l[0]>h.geoBBox.right||l[1]>h.geoBBox.top||l[2]<h.geoBBox.left||l[3]<h.geoBBox.bottom)){h===this._currentProjectionSystems&&(f=document.createElement("option"),f.value=h.code,f.text=h.label||u,f.setAttribute("selected","selected"),f.setAttribute("disabled","disabled"),c.appendChild(f));continue}var g=document.createElement("option");g.value=h.code,g.text=h.label||u,h===this._currentProjectionSystems&&g.setAttribute("selected","selected"),c.appendChild(g)}}}onMousePositionProjectionUnitsChange(e){var i=e.target.selectedIndex,n=e.target.options[i].value,o=this._currentProjectionUnits;this._currentProjectionUnits=n,this._resetLabelElements(this._currentProjectionType),this._resetUnitElements(this._currentProjectionUnits),(o==="DMS"||this._currentProjectionUnits==="DMS")&&(this._resetCoordinateElements(this.options.editCoordinates,this._currentProjectionType,this._currentProjectionUnits),this._setEditMode(this.editing)),this._isDesktop||this.onMapMove()}convert(e){var i;if(this._currentProjectionUnits==="M"||this._currentProjectionUnits==="DEC")i=e;else if(this._currentProjectionUnits==="KM")i=e*1e3;else if(this._currentProjectionUnits==="RAD"){var n=(180/Math.PI).toFixed(20);i=(e*n).toFixed(20)}else if(this._currentProjectionUnits==="GON"){var o=.9.toFixed(20);i=(e*o).toFixed(20)}return i}validateExtentCoordinate(e,i){if(["Lon","Lat"].indexOf(e)===-1)return!1;var n=i.replace(",",".");if(n=MathUtils.toFloat(n),n===null)return!1;n=this.convert(n);var o=this._currentProjectionSystems.geoBBox;if(o===void 0)return!0;var l=[o.left,o.bottom,o.right,o.top];return l=transformExtent(l,"EPSG:4326",this._currentProjectionSystems.crs),!(e==="Lat"&&(n<l[0]||n>l[2])||e==="Lon"&&(n<l[1]||n>l[3]))}}Object.assign(MousePosition.prototype,MousePositionDOM);Object.assign(MousePosition.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.GeoportalMousePosition=MousePosition);var MarkersOther={drawing_api:[{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABapJREFUWMO1mGtsFFUUgL9zZ6bdbaEP2kpRCYj4wlciRMHEHxo0MdHEqDFG/aExvmJiYmJ8G2P0B8YYYozC+oivCAl/VMRqIkTBUIygCAiNlr6oQAttd9vS7bQ7c48/pq0QdtvZFU9yM5nZOfd895xz7zmzQomibwFlgACVCCPUI1QDCcAFAsBHydBDP2ejOEAlyN2l2XRLhaUcyCDUsoQsK4DrgCuBRmAWcALoAfbQyDaUn1nGAZrRUk1KSV59DwhpRLgLuAe4JsZMPwPrsGzA0CuP/M+wugYwCMJFKM+g3IVQEU8ZgCywAeF1LH/ioPJwfPvFpUGA4LEYeBW4DSlCP3JLBXAfSgXCC7i0TS0jhpjYXk0BHjXAE8BtaMn57gK3IzxBjhpdE18xNiyKg3ADcD/glpbtExJF5AGUGwDnjMJqChBqgccRZhVYTDTCk8bks/zvzwIeBWr1vXiwcUNpgCuAqwuCgtKwtIcFtzqU19Ywls5waGPI8d8aUeS0SET3KxAuB34kRu7Gh1VuRCjPDyqWhbcMsGI1VJ1fCRPH/wX3DrHjyX46N9XlBY5O65XAT0RFZEaPxYMVlpAvvxSoXjTIsteGqTp/LvAvbNXiuSx7dZiqRZkCfnOAy9B4HHFhhagy5d9WsxcmmXN5XZ75DHOunEPVecmC8ypz0XjbtZjjJ5H3qQLGcxHJb1CkHPGcghkpFFrIaRL/6ILBAsbA7zvBWLov7+/+QB/+8ZFpfJc5s7CKRWlFCfPCDhxI0JKyaDh8ql44TMtaJd2SLAAbAn8BNg5GvDRQLEIzUdNy6iYTIMgm+H3VXMYz3Vz8UAavqoHc0HEOpMZpSc0nyJYVgM0RNTixYGMltq5BEM4DvkdYlGcxkRg3xKsAcR1sEBJkwQbONFbaEVYCnfLwzOds3JxV4CiwLq8XZGLYwGFsyMEfgPEhZwZQC3xO1PPGamZiV3hNAcqFCJ8Ay+PqTSM7EO6/86PGv347Uo6xEFqD41isiepHhe9zXU8Pk71Ocf1sCg+4HVgNzCuVUpWjA1nz3B3vn7PxSNZ4AbjGYkJrjOPY0BqxAuNJ389eMjjk7204i3meLRoWop70ZeBJwIuvHLnGKnZ7R2LbU183fHVs2PFdo65G6SiR71QRUcCiBChpA/vFaGvRjd4E8EKUtcBNeSv+NLxtfV778011m3YeSmSciYyWU94QUJ24CIAVGLXo98UUBQAmvp26UFYDHcXoDo6azPrds5t3dSfSjkElArFMDYmuIhbEiqgVQRStQLWmaNgJYCXNZuAdou+qGSUXEvzQmty1fvfsDiMgseIhgqqoyBE1prUkWACOESJ8DHzJdEePRlHd31Pe8vb2mt3jgdgYoAIYBR/YY6DJJBKHS//f4BIA0sAbqlwMXJUXQuDYsNOb2lHd3JX2sqe/ogKCTjbwgkU1CxxE5E+gO51MnqjO5YpqZE5leGTSb+zNhawOleGpJydd/RxjX+yb1bzlYLJXmAp/FF7FqAqoBsAI0KmwxXHdzxS+u7mzswU4MT+Tof3gwf/02RcxpaCzz6ltqLKvJD19zAju5KYOlfCntsTOF7+t33pkyPUdE9U6VUVExoERVdKCdomY1hCOqxCM9veHlbW14Di0tbdP2So9DU7y8M7nTAbHfFBfGSyt8PRaI5FjuwbcQx/+Uv3r34Ou7xp1VMkBaRE5BhwVkW7Xcw+j5KwNkFyouA71Cxbwx759+TLqzEjHKo8yx97RUBm+7TnMG/Rl+N3tNU1rm6v3ey5pgaOo/q3QU5FI9I6OjfkiguN5nLt8OZs//XRmx5wpWIDvnp6duLR+9KXaZPjgjs7k1mebGtals6bDiPY7IpnusrKReb5PeVkZB1pbi57/P6fByVKXDPzOtPtmwtX1f/Qm0u3pRL/b0+VXL2xEVbm+r49v+vtLnv8f2Pk64kl5WH4AAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjAyOjM4KzAwOjAwnw8TLgAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABm5JREFUWMO1mFtsXFcVhr+195mLx3bshNghKWkNpCglPEBpUYSAKg88gGigUftARSJzkbiIB54QalQkKvGISkGQSkTQplJBKQgQbbmUW6CkTZuGVq0pjV3n4jSOnUzG47HHM545++fhjNs6npDjISzpaDQ6s9f69tr/XnvtMTo0fbYfAhACbN5knJ1ch9QHlseIgAZSHbMyhRsvUj0qvIPeHPbd6Y5iRp3CIkGjy8jUtnJ28mbgg8B7gEGgB5gDpoCXmD92GOxZ3pt/haN1dRrSOuLcvQYitwHpNsTtwE0gj5kAXeLfkGLgKGaPgPslIZ62A7P/X9hk6YMRuB5nX8PYBeoBiy+BbBfHA3OIXyDdh7NRXFP24/nU8VcnA3OG6R047QXtTACsmWaeQBNUAO7E6Ea6B984cYVJLjOXOqvD/aC4D/gSxk7MPFhY1WSx0Bq3E/gizVyf9vSmHp0aloBH3ALcCeZIakEnFkgk8RmCfQTkryqshvshoh/4AtBNu6WTjBAbzUWjUYfmYvJdWrkvDLX8fB58n/b0p4JNp1lhBG0D3k+yWZbDJkCBd95c5H0fz1LoX0u1VOKfv11k/Ln1SNaqFMuR4SaMbYgnSaHddLAmD+wAsm0zigI33lrh09/OMzDUD3QBxvY7Zvjp3lmO/aYX4ZYBmwHkEDswPQVccaOm1KwcaCuJ1i55FWDDlgq79i4yMLSJZHkd0M3A0CZ23bXIhi0V1FbiHtNWTKk4UsKagQ22/X0IMDhU4JobBlhZt41r3j3A4FCB0BbWgW1YSvOVLK1mAfKAtTbHm18Kn4kwy11mnll8RpeRpLX8prK0pUvALO0imjMqF+aols+3HTk/c4HZC3NJtVvhVUhlpFQHQ1rNCvQqEK/04GFiJMuhB+uEUFn2LoQKhx6sc2Yki2tbTptgY8hSwaY9bgNwBNMdYMujmkG9muPR7/RTnZ3glt095HsHWKic59CBOf68fwP1agbXLi9qAs9i6Q6YVMLWcK8hfx3oVxhvZ6UcDAl8pkmuYPjIEzdj6lURN6LW/mlXZ09g9knUPG0PzF0xu+k1GzSFeAQRt5mkMCBuRFTLnkpRVMv+v4KKGHEQaRrSySB1i6jdfeDYAuzD2E47/aY3j/Q0xpd3He0de74S4QLEweF9IDjDgEKtxofPnWNfa1DqFtEeKqPhNSeR7UNch/FWVtHMSK3EGIY0WWy4n9z2zJriVMMGWxyu9cQtv4uC6vmuQu1dA4NszIRVNt/DfRAoYHwd01fBMlz2TBfSG8VeyCRzTaF/lKKnvvHv7sfPL7paZIqUQFqr7VDrWA6IJqLkYMScRld9rdGePjBdC9wLfHTlVeYNyCC5gHmBCZmBjc378W8e7/79c+Wo7F2SLHvTWLCkUtpSf0QwWAjoifT97JIcDpTBwgTSD4Fxlu5ZCEkWZC4WviGyTcgE4aQkc6WGK/1sMvfMsdloxhuyBCTw+mPJp1kAC2YKZphQAal/1bAA9sCcmF74K/AjpPmlbAaZb4pMLKKAnLBkp5hoBGv8pZh5/ueTuVOOtN2AGZLJ7KycG+0IFoCLzZhgD4M9KpliETUhkuRkMsPUWlAk00jFH7//dP6FxWAhBagBTlADXnDwuMvnX+v8f4MtfVDIzlCvf09ia4x9QBKtZC5p2Awxtein9p/JH5lY8AsrOWVLZwqtNh+pCoxh9gowUerqmutrNFZxB7t06g+Xod4QxCO12H4Qi7IlZUnQSimiHlvt11PZI4eKmWnj9eVPlle4pHdXE5gHTgr+5KPoIcHvPnby5MvA3OaZGcbHxjr7k2NZXoZ7GatE/etzujvn9RVnconMZEEW/n4xc/Rbo4UnJ+uu7pcULGFmi8C8RMnQKTM3GsN5Gc2FYjHuXrsWvOfV8fFl2vif7fAn1tr6vG1bn42/3+X5kFlyLTgx70/eM1b4w+FSphglV6MGUDKzaWDSzCZ8FL2GaITQJG7EUuQp9PTw0osvrlzNqwELcPz2deRd+NS6rO7NODaXG1a6/1T+if1nci9nnJUMJpHOCM4V8vmphXq9Zmb4TIa3bd/OHw8cuGKMqwYL8NitA7kb8s27+jL63NOl6G93j/UcnGnYCYeK3mxmIpud31irkctm+dfo6Kr9d14N2thbolA/VbP7rnc6ODIXzZyqZy76M6cX1ly7EUnsuHCBx4rFjv3/B5an/+2QIsMIAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowMjo1MCswMDowMGqPVM4AAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABPdJREFUWMO9mNtrXFUUh7+1z5nMmdhkkjZpE1RsWi1FqQWL0gp98EUQ7JP+AYJPPigIlvqgiIr4IFqxSFtQ1AqW4oMXUAreK7Zia0vv2Exz6SVNc5u0SZpJZ875+XBOa0oz6UwydcFimNln//a3195nrb3HmKPpxq8GtABZIAB8oAQUgFFgeHoXm+OY/lxhp417P7AOWA+sBtqABcA40A8cBvYAfwInbp7nbTbF3iZ4QfCnQBX4PsHzgiX/C20CaYKVgk8EExWCXvOJpN/KROe2wprgPsGXgmKVoNe8KNgluFdz374VRbVZsGUeoNOBP0j0bgusJ3hKMDZP0Gs+luh5tyOqLYKfawR6zX9IdCuySlOXAx4EHpl1TmvW9LNhg0dzcxP5/Cjffhty8GAb5ffmOmAV8Cu1SmkCX/B22b1qFmrDhkHlcn2SxiWVJI2rs7NPTz45KIhm2btvaf75/gbYOsE3ZQddvnxEhw93SQp1o4U6dKhLy5aNlIGNEt26Spe3EjPiyjTzci5dmmHVqkUz6DlWr15IR0dmFt0lVJjCqgl/ULYllfIxm3lAszSp1GxvfIYKrdLIAlwq2zI0NE4+PzRj28jIEIODE7PojtYaNgI6gXDG1hMnArZvjwjDsRt+D8Mxtm0TJ0+Wi14InEr0a2NJQXhWMFk2Z2azU9q0Kadc7owGBiaVy53Rxo05NTZOzZJnJxPd2hWG5EywTHB61iTv+yU1Npa0cKHU2FiS75duURROCzpqekZIKlhG8KYgrFH1CgVvJLoVWcUzSgRXAJ8Ba2sQg33AM0+3tZ06mE7jIggjh+dFRM4woL5QYH1/P1uTDhWnLouBu4H3gc1A+zxW6sKIc9ufuvPOwT7nFiccLvGQ+IW7KrgymKkvrGhdTHsqqm6vJNGtB14DXgRS1YJGEP0RBHteam39ZsDzCr7kK4a0JCTCTECEKCHyDo6bU2dVNTmJ7hVgK/F963Gq3EpdqVTPlqamIwOe1+yByWyagGI5xa+cYv52QUcofqimKFwHBnqJt0J3NX0vOTe6s6Fh74EgyHsgg8jiJU/c4k+zCCwyU2SGCdUjNVUNmwAL+BH4kDjSt7QilH7JZA7sbGjodhUvhxmSyaxPznXOCTaxEPgU+JpbnEUFHE+nT25pajp01SyqANQAp/h/h8MOvndBcH6+58g88I5gJfBQOYgBz7u4PZvd25tKXbn5GRkYUjIvI0K6AuQw+wc4m89kxrPFYlUHmZumngTtSBE2hzA203MFmPpqwYK9P2UyF+2/fvHyCicZSCVgAugR/OT5/ueC3U/09JwExu8eHaUrl5t/mRPQ43nNrVH0ekZ6zk3L3SGEvwfB/ldaWn7r8/2CF7OaJMzsKjAhkTfUa+Y6QxiUUZocHg7vaG4Gz+N0V9f1seZ9nTBgv3OjOPdRS6m0pl561CWT6PX9Mx9ns3+f8/2CL3mCIpA3swHggpmd9VP+eUQxikpYMRS+R8s993Ds6NGbxqrJ3efhYlHdqdSRy869lw7DDgftl83GdjU0/LUnk7mYigEvIJ0T9GfS6YuTU1OFeLbGXevW8uOOHRUFpma2u6EheGBy8tXmMHx2X5D57eXFrV/knet20rBnNnq2rm6ivVAgXVfHic7OqvVrd6sEFpVKhR7ffzeItPNYOsh3BcGw39tbyLa1IYnHhob4bnh4zvr/AlFvZYTScGjCAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowMzowMSswMDowMGvaOiAAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABfxJREFUWMO1mF1sXEcVx39n5u5613btOIlrp0lEhBr6RSmKLUiQIkQFSH0rLSoI8VCE1DSqVKkIAeVDCPECQhChClKXB0qBRKpoQbQNRbSUNIoTKW1NmsZW6vgjNbHXjje79q7Xd33vncPDjYuc7qZ3t+ZIq5V27sz5zZn/mXPuCk2a7vwlZNNgBK5vE/JLm0E6UTIIHhCi+KBFSrk8nTcokYVqGzL85aZ8es3C0tkCI0Xhpq5byVf2AHuBO4BeoB0oAzngNNf1vorTk8z1D9MzqM26lKaiuusJMFEvTu4DvgJ88t2l6q2onAQOoe5pxMzKG/v+v7DafxAiI4jchOi3Qe8DaU04G5QK8DTITxF3DmdVhh5I7L8xGdhQcKkbgR8Dd6PiJd+ugNAKfBXVVlS+h3pj8S6SmUke1QEIUxsQHgbuBm0A9KoACfeAPIwEG7TvYOKJiWFRtSB3AvfH2d4caWziAV9D9E7Arius9g2AkS7gIZD2OpsBpxBEsBLF307j32vyajvwII4u7X8iEWwyzSoGx8eAT9QFBeW27hx7P2TpaNnAYrXIq+9EjFzqRVWQq09CQNiDyO3Av0ig3WSwggH9HEhLHVDHp3dc5ht7YFtHG/HRtnHXzkV+cSLP0clNUAuYFuCzKMeA8P0wkmrWgNxKLX05hW2dC+zvL7Gtowf4H+z2jh7295fY3lHE1QycBT4KmogjGawiKL3UyioFtl6X5caNm2qsZ9i5cSNbO7J1DllAe0ATZWtSGQBkam9EwTMeIrUdirRgxdZNNCSbiCFxZGNbqAMDBb/MYnW+5viiP0/RX0LqBq+4zrDqQEdBo/cMWYGxyxmeHXE4La0Zc1rimRFlrJDF1oBVIpS3UVwSioTlVh3IIHHTsjbJRMAPMzz57x5KK1N84eYibaluloJLPDu8wjMj2/HDNKYGrBAAJ2E9YQVHxCsYpoEPv2fcAKVqmj+c3sGfhsGKJXI34IcQOlsTNLZpVP6JTQabVLOKZQY4VDsKEkc4dJZy1bLgQ3nFEjp7Da06lD8COTRZM5O4wGv/AET6EUR+h7A76bxr2AlU7v/iwm/ffiOcxjiInMFahzOCAK2+z95cjtVWp7F+tm8gBdwDHAC2NEup6MxlV3n03uJv/jrtKqkQPOMwkTPGWhc5I05gJev7lVsWFv03u69nS8o1/FoTAM8Bu4BHgFQjiCA4VXc8mDj3zfJzXXOu/CUP4xkwGMSauMcw8cPOb8mEQ92ZgoGzM5GMNtznad8AwA5UH0f4PNcQZS3csWh+/LvlI8+fCt4pWonvM1nzhMSFRkDjwuYElh36j0aKAgDy+j6AC4geACYambvglouH/aHB14KpgsWoxCCOdz8Sf4s4ECeiTgRRtBXVDQ3DXgFWsoWXgF8BlSRzAo3CV4LR1w77QxMGqVudr/IkqIqKTKsxo03BAtA+F6HyJMpfrn31KKrK2Sg38ljl+NCKhi4BqABGwQdOGzhiMpmLzf9vcOkWWKFAmp8pejPKrtoQwpwrzQ5UTgxeiAqVGm2bgKz2OYrgUK0A5xE5B0wVstlyZxA01MisRXh9H6RQhDcDogMRq33BlSBf8e67oPrn6pnBl4PzswKrxx8fr2JUBVRDYAmYVHjZet7vFV68a3JyBChvLxYZP3/+A731xUx9A0xG813dpuNHWVL7jYi3mtWRanQsGDv1/fLfjk67Rd+KEUBUFRFZAZZUKQh6QcSMRnBJhXA5n4/aurrAWsbGx9do4wPbqTselc3Seftm03awldSnjAgKTIT5iR8u/f3IsWB83sNY4nu6ICJzwIyITFnPu4gSOBcSBZGqZ2ltb+etM2dqCGqdbOLjPyEt9t5uaXssJXbLgvNLv14+fuTx5cGzKfEKAjOo/kch15rJzC5Xq76IYFMptu3ezUtPPfW+PtYNFuDFXd/K3Kabf9Al2a+fCC4c/c7SC4cKrjJhkLwVKU6l00tbfJ+WdJrh0dGG12/+NqhhmzTrT0aFn2esd/itaLYwTiHvXcz5nVt3oKp8Zn6eF/L5ptf/L2sInRchOhqOAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowNjo0OCswMDowMJwhuk0AAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABmRJREFUWMO1mF2MlFcZx3//887Ozs5O96OwZekupiq0ptJigFhaJaZNa9MbbTVBY5pYY0MlxiZ640XjhfHGxtheGFNFL7AIGmIbEy2Cix8sCSWxSCiyKyy7QGGXhd1hZnc+dnbfec/jxSwI7ADvjvhPJm/yvufj93ycc54zokHt+tYqMnMtOHN0lu7RdGt2KdBuWApTQqIKVgHy3d2F7PhYu7koork0y6d3DTQ0Z6JR2Ltn23m/Y1Crcw88OJ3OPgpsBNYA3UAGKALjwNHx8bv6kT+06r1LA/9+bJk1Oqca6fTnF9fiAtftzW8CvgI8IsAAzQ9p1yDNvzkE7DRnu5zXxSd/8c//L+y+l9bjfSRMDyB9V2ITRjrOKDV2Kwt2yXjVnE74yNvTvzwSe/5FpYESgRT6lQY/AJ4FS6B49tY8rzTG8yZLm9krvmrDV+2IIRe3Yd/m9VhY7QC9jHhWIrHYLJpPlYShL2C87JrUsfeldbH7x4Y1LDDjCeAFoYYX5nwgEoKvSXrCILijsHs3ryMw1wl8k9pKX2iMGeY9vhriwzl8NcS8x2xhlAWYlAG+EeA7+15cHws2pofMefzDwCdvBiqwtg9/fHzpwxuDRLqto1qezk8c7Y8KZwe7zUy6IbcFYHoU00PA34mRu7FgHXKIp4DmeqCAX7rmM5fv3/Qd0l29rdRC29r9yDPTJ3e9lp04un+JGQuAgWaDJ4UdAKq354gh1do9SL38Mk/6nt6plZ/fUkh39S4DrsKmu1Ys++jnthTSXSvymK83dCBYjeJxxGpkmMC6qbP8zYyWJT0trT0rl9QZz2V6V93dsrSnpV7uIoRYdvUkuY1i5qwAUvUtMRQkEvViDCCpWUEQYDdNyZZ4DHE9a2DGVH07xFwxVwzL05P1Poel6cm5Yr50i8Mjf0dhJbzEEBAt+OYCSmPDqdH+t715X7jOSO8L5/vfstLocItcve3UIjM7aVY/oW9UvDQQHuMgtaLlulklEc1VUmf2bFsWlgvnejc+lw9SrV1RpTRxvv/tufMH3loRhZWktNAvZgqBQ8CdgzXkRfQ3cGPARxZ63hGWC8kP+n593+j+30EQBETRvdFcBR9Vg3qg8xrD7K9GEAs27tZlEFww2HkzL0jCR9UgnCkGYXGKcKYY1EDr56oZHmyHwTi3WH03cMRT3+b1eKL7hX4ltCFuv1voXcle+OG7UyeHp6o4D5F3BIHHu9pelq5U2Dg+zhvzHWIXEdsPj/HVtT3TkqaATwF3NUppxoVC6F99pT9/ZLIctXlol9Fupg7nLGNSRtCcqFZJRz6q3tuj1UvbFlk9iRD4A7AW49smmuKGpnaLAG/mB7PhiW3Hip3Ts/5LgUg4cDgUOAMwV2vuK82p6pGuVM7B8QuRhhZ9renbvA7gPsN+BvqsFlnUjhejke0DxT8OXQ7zgZOuGHGdSWbzDwF4wYzH+mLXs1f01NbDeDiL9DpwOn6dD6U5n99/vnLwVC7MOdW8p9qCnf+p9pQ8yEvmJWRYGrOORcMCPL31sCU6W/YJfgqU4/SJvFWPTYbvHThXOS1qu8ftJWEmk8bMuaGGYAHC7kwkbBuy399q6zFqxc7ZQjT4znD5SNWbjwEqwBlUgKMOdrtUarTh60lyYAKfnMvZXPJHGB8zbG09CAH5WX9x70j54KVyVF7YwgS6Yq7VTksrA6eQTgDnci0txfYwjH8Hu1GPbz2MhU0m0/tV43UPBfivj6+UhGHkZw+NzR48NhFevCb8tfAazkxgVgVKwBmDvwSJxHaDPc+cOTMIFFfk84ycOtXYnxzXat/mdVyaiTrbku77TY4tTkqY1S6GZhYdnwz/sWOguP9yxVdcjVRWuzbMASUzcsLOSm4oggkT1ZlsNmrt7IQgYHhk5Loo/c/6+ZfXKJPQQ21J90ZzwGNX0mG8VD3928HS7uOT4WQgAiAEcpIuARcknQsSiVGM0PsqURiZJQLSmQz/OnasbkrdEe14/hM0SV+8q1k/STgtL4e+8KeRmd17Ts8cD5xygguYnTcYT6dSF2dmZyuSCJqa6N2wgX1vvnnbOe4YLMBrz61NLc/Y9zJN+vqJy+H+7cdLOwuhP+0gG0j5c8lkaXmlQnMyycDQ0KLHb3g3qKdMk1UuzUQ/TrrEbz4o+NzFClmNjlZaP9SDmfH45CTvZLMNj/8ffOgG6JpOcn4AAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjA3OjAwKzAwOjAwxEaR7gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABZ5JREFUWMO1mF1oXFUQx39z7r3Z3aQx2TYxCVo1aaviJyhqK/TBUgVBRVT6oD4oIiqFgiAoqIjogyIaoYgGFGrFVuuDWloRrWgrxmKrYmtbbZovY76z2e0m2W6ye8/4cLe1obvN3bUOHO7DOTPzP/+ZM2fOFSoUHQaygAVyCB4NKHUIUcAF8ihZIMUUCepQCGbkosp8upWCJQM0IoxxBS6rgNXAtUAzsAiYBkaA36hlD5a9xDlMsgC6ApGKWO0GhGaUdcD9wE3ogtb2AluAbSijsvx/Bqs9gEUQLgOeBtahVJdhJYOyDXgV5U9AZUV4/+WlgUFQlgMvodwNuGXGphp4sPB9ljzdED4tTFms+tQDG1DuRsoGGojgAvcgbMCjXrvL4Sq8EwdYAzxUcFi5BPoPI6wBnHMKtsBqHFhPcNKLLCoxSgNehPI4lnhYdsMyZBCuQbmxaOiDSqBErh8hdqeDE6/HJlPMbPeZ/aUZkBIpswrhapTvCJG74cAqBrgVIVIUKGKpuWOSxe3gLashCG0Nix5Ik3gywcyOJWgRwIG9tcD3QH5hxsKCVa6gVH55bcepf3kKb1kT8C9Yb3kT8Zem8NpSJSw7KFcVyFhQwh4wIbiZigfTuyRG1dVLitgzVF27GLc1VoIEAZoIWe/DpUFgKlp6geciUtyhSATxikdEACVGSAlfuuB4yRl/Yho/OVF8bnICOz5zFiJSYet12Jy1KF0oftH53OEo6Q6L+lPz9fwp0u8oc0dKsecDRwl6twUlbOmyQCdB0zI/pALYTJTUK03Y1ADnPZrCnNeITY+T7pgj3bEUm6kqwV6OoMEJBTZUALQLAVoRvkZoK8E+iOsj1SCug+Z9NAOad87ipQfDWpQ+aVu4zobNWUUYRthSkgUhAGbTDv4k2LSzAFALfIhlhJDNTOhWpHAlXgq8D6wMq3cW+RGHh+57rPnoL39EMBZ8a3AcizXB/VGdzbJ6ZIS3CwqhGxJZBnqMXoQ3gXagpVKUqgxPpkzHvesvGB8aMecXcJjC8AuszylkxmPV2Usbz6fFs2U23wG71cALwJOAF14ZELAW+8PP0T1PvdL4+VjCybpGXQ1ASiGXFBEFLEoeJWngkBjtKqvVk2Wg3WSAtwneW7cRNpUkwNsz4PVt3Fx/YGzCiTsOonJ6y1DYkWphvYDQotDqK1+XcymcAgz0o7Sj9JajezxtUlu313buPxhNOg4qgpUg5IUhwVfEglgRtSKIotWo1pcNtgBYGWMX8BbBO3dByeXJf7s3tn/rjtpeY0BCxUMEVVGRITWmqyKwAEzio2xC+Qw9S+nRIKqHjkaObNxc/+tcTmwIoAIYDf5M/GbgCxONDlb+PFkOKEmE1xQuR7muKAiBsQlntOOjus7+QS9z5hoVEFQLWxMsqhngGCJ/AgPJWGy6Lpcrq5GZj+FygteBcCCXo933mTrJ5Onf7Cyzn361qPObztioyKnwB+FVjKqAah6YAfoUvnFc9wOFL2/v6zsCTC9Npeg5dqyynxzzeOmGvkEn3rjYvhiL6BPG4J481L7F/35fdN9zrzfsHhpzs05wn4mqIiJzwIwqSUH7RUyXD+Mq5E8kEn5NPA6OQ3dPzylf/+2VSlAd9m03KdS827A4f311VG82JiC2f9D9671P6n7+e8TNuq46quSApIiMAcMiMuB67iBKzto8kvMV16Hh4ov5/eDBM3z9Z7AAN9yV097d3oH0lHkj4vmtxtCSnpapj3fW/rTnp9io55EUZBjVvxVGYpHI6InZ2WywW+HCVSvZtXnzwsScC7An5ctNtdErV5x4Pl7nP/Ljr7Hdz7zWuCV53PQa0YQjkhqoqpppyWaJVFVxuKurbPvnhNmTsiSez/YNua9HI7r1965osmcgmnCT/dm6S5pRVW6ZmGBnIlGx/X8AIXpAQWXTlG4AAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjA3OjE0KzAwOjAw/KO1YwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABh1JREFUWMO1mH+MXFUVxz/nvje/3s7+mLa72wqNSykIxEKCqKUJf0jQgGJCIGKC/AEaUSEh4R+NGv8wEMUY0xgjTI2J2Go1/EWA7hbBxELcboKh0tItZZfd7a50Z3dmdmZ3Z2dndt67xz9mt7bd2fbNUE/y8jL35d77eed83znnjtCqvfRrcKPgCBS7ha7sFtBOkDioC+KDVFAt0lXKU0wqvgu5Tvjm11ra0m0ZNhqDXFXYHLuJzuztwB3ALcBWIAmUQDPAu8y3vYnRId6+bZg9R7XVLaWlWf1pUN2K8CDIQ8DnEb1oufOZBGAI5SDoixgzw93f+T/DHkqDEUH1U6A/AHkQUS/UMgqIlkFeROQXqJ4Gq9zzeOjtm5SBFdTsBJ4G7kNwQ7+vAIqH8DCqHuiPwX7IhSG4pJnQnANpwHQBTyLch0jzehcBVRflfuBJ1HTV173SsKiDcCfwCB/nwxShHhEeBbkTxbmysAP7wJoU8ARCsvG7aP2ywf+utbHG1EmE72I0xeHnQmGE9ZBB9GbgcxuCCvqZjp7MV3s+6aTcaFehVi2+nJ0M3lnIbkVVkIbavh3YBfyDENoNCasG4YtArBGogL23p29u7w17uNbraAMcoO0bV12/8NT7g/lXZyY2bwAcQ7kLkbcA//IeC+tZuGkV4mJadnid889c99nFa72OXuAc7E6vo/fpnbct7vA6ihs4zgE+jYbjCAsr1CvT+lgq9HntiV3JTZsbrGduad+86RqvI7FBkAWlFw2X/5r5quONh5WIGFeksShFJBYR4zT2rIBoIixAE6mL+cbDQm6lUirUqrlGT+dqlVx2ZXmpYfFQQCmGLQvhYBWLMgIEDVzHcGkuvm/qlA1UF89/FKgupieH9VSpkGiYDYQAkQ8QsWEwwsrAgg6i8hBy0UcmQjnw48+OH+st+tWpb199Y7HDjXQv+LXsvqnhlX1Tw9vLgR9tnLq0BgwhhIINV9gPpQVHr0F5HWTH+j3rcXSNCTwngivi+KpBOajhW+tskGMBxkDuQvwJ7n7ismIIq1kFpoGDqK73ggiI4FvrLNSqztxKhYVa1bkkqKpF9c/1nldCqTZ8i3g4DVavR+SPwO7Q8za2o4g8sv3nL3zgTpzFWAiswXEs1ggCeJUKd2QyPN80LMBrv4sQBPcDexHZ1jKm6rQpLf/wqmd+/3J8finig2ssJrDGOI4NrBErsJKoVMo3zi9Ujnf3sC1im+yeVGuovoKRW4GngEgTc+tysWq99ydO9/zhlZQ7v/h1NcY1YDCIYxRATV12thKL+8e64wUDJ6cDGWn+WHPoOTCmDyUNfAlpLjqRTH6s50D/q4mRySKOc9FhaPVXvTFCVQCswLJFX2+mKNTtK4+DmjOI7kV0vJmpprRc7DzyzmBidKqAMboKYjl3Sf0uYkGsiFoRRFEP1a7mYQG+/JgSLbwB/BYoh5oTBH7bidF/db717/G17HF5E0FVVOSsGjPSGixA8myAygsoL3GpXnS1AY9PZk5t6v/nMfF9GwJUAKNQAd410G/i8Y9aP55kb4aIKWD9X6J6A3Br45IqOMXFma7XhgYjs4XyeoWrgKzVFUWwqJaBUUROA1OFRKLUWas11chcaPc+BjZQ0OP4di92tS9YO8as3mWlVm0fOjHYdnx0BmEt/PXwKkZVQNUHloAJhb87rntA4fA9ExOngNL2YpGx0dEW/+Q43wbSOLm5lG1P/lQjke9hxD2XplQD7+TY2z1/GjjiFhYqGCOAqCoisgIsqVIQ9IyIGQkgq4K/nM8HbakUOA4fjo1doI2PbZH0jwQvuctvb3teY9E9a3KIZPLj3X/9W793ciynjnGAGlAQkVlgWkSmHNf9CKVmrU9QC1RdBy+Z5L0TJ9Yr6krAAkT2/wzruA8EnW2/wXG2mXJlMTUw2J86fPQkrlMAplH9j0LGi8dnlqvViojgRCJcvXs3b+zff9k9rhgsQPuz348vb9/yk8CLf8s7feZI74H+g6ZUHkck74gUp6LRpW2VCrFolOGRkabXbz0bNDC/PVFxZwu/0k9s+UtscrYQny3ka9lMRfv6UFW+kMtxKJ9vef3/AgyZp3iOwsFtAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowNzozMyswMDowMHshjJAAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABjBJREFUWMO1mFFsXFcRhr//3F1713biOCVxotiolJiUlpLKtiBFiiqqgpS3tkhFQjwU8QBRpUr0BSHEA+IFVNoIIVQeQ4CAKiVCoUSIFokEKUSENGpCYxJnnUQmteN4u+v12r7ru+cMD+tESbOO727DSFfn4dwz852ZOXPmXtGmDE0NkY/zuODYnGxWMVv8GEavyXJCGaBuZjFQnp+fL/b29prHU8vUOP/x823ZzLQL27vYy9imMe2Y2fFIMVN8AtgN7AS2AD1AFZgG3l23bt3xEMLJmb6Z8/2lfmvXptpZNFwYxsltCRaeB74GfB5raNMqKg07CRw07A2Zrr+z/Z3/L+zoxCg+eEnaIfRd4HmMrrRaDFvEeAP4iUwXAsHODJ1Jbb+lNIhcpGBhO/AjjGcMy0jp9yvUBXzdsC7Dvm91KwCp08K14tW6r28QegnjGURLoLcRZ4SeQ7ykrDaMFEZSL00Na7IIeAp4QVLbB/MmMPANSU8B0X2FHZkYwXnXB7xI46TfvRkzggUSS1i2ZRJLCBawVaIsqQfj2yGEvtHCaCrYVB4yzAWFz2J8rtlhMjMQ9mjno9O787uj9dH6DZVQKR9fOO7HamNbDFOzlBF6QtJjGH8jRe6mgpXJAV9CdDYFhfBk95MfvLzxZQayA900Qtu9p2dP5bXia8VjC8cewLgbuKHvacP+DtTX4kiXs4bDeIQm+RUIDGQH5vZu2Ds/kB3oB27BDmYH+/f27Z0fzA6WA6GZ5gjjM1g6jlQvGSbDttCkLhvGtuy2/PaO7Q800eeGOoY2bstsyzfNXUNAPynrfbo0aIQvt8pGyJDJaJU6JqkzUhQ1hRVg5NMwpPbsisw1hUGUfKla8ZXZZvMVX5kth/LCatcwopz2BkybswFjHMN/eCoiopAUcocrh0OwMH/7XLAwf6hyyArLhXzUpJwa5g27aFgghaQt7gE4QaNpucOqJOIQ5/aX9/fPh/nJZ9c/W+523ZsWwsKNw5XDy4cqhwbjEHc43e0XoQQ4uaJ/TUkVgNHxUXn8J5zcW4iHmjrfjIwyPqcckaLIm/exxdStHt3jWp4wZ09HFl059dCpNets2py1SNEU4uBqXpBE3epRNVSjOT9HNVSjNUCDYb8lMG1YqmYmdScyWhjF4z8l9CuhXWnX3UP+YZG9sPituYu1/9RxAXxwRFEguMZx7Ipjdk9P83qrsAAjl0ayiOeAfcDWtjGNqVAO35t7sXwkmg7ZOmRcwPngXBQFH5yCYDkfx4ufnqvEZzdtZms2tPhZIxLgj8Aw8B0g2wIgCCxYqJ9OLiz9uNqnYviqOTIOHA5FzgDMNd4OcWeufmZTruTgvSmv8ZYb0pX+80HDfin05Vaj46/6icWfVt/0Z5OyIsl0u4KbO7KVQQBBsBSwt1q5FAA4/cnTAFdl2odxuZW1Vgnl5SPxCX8uKRFhiKDGgV151BilAAqSBQkZ1oXZhpZhV4AtP5N/G/gFsJgKtG715GTyr+U348u4W1f4GiJhJpPeN+fG24IF6Pmgx5vZfjP7g9k9So81arC/6MfiA4tnLLGQAlSAM4iBdx0cdbnctbY/T25sv8GyLZc61PEK8LCZDTeFENhsuF77/eKJcM0vNunbBLpZaQ0RMFsELiFdACZL+Xy1N0laamTukNMPnyarrEk6S8I+PPM3PdkYV6zXQm35L7UTyYnkOroV/kZ4DWcmMKsDC8AVg79GmcyvDf6858qVMaA6WC4zcelSez85bpeRwgj+mu9zG90P6WSvnDK3lSlfP5WcWnq1eizMhFiRBMjMkLQMLJhREnZVcuMebpioLxWLvruvD6KIwsTEHbnxkWXnkZ1Srx5zG93r5PiCnBqFcrJ+eelnC0fr/0xmyRABCVCSNANMSZqMMplrGEkIdXzizTIRXT09/PvcuWYZdX/k8WOPo6y+oo36ubLaatUwH/9m6Wjt4NJ7yqoETGH2X4Pprlzu+lKtFksiymYZ2LWLtw8cWNPGfYMFGN4/nLMh+4F69c36meRY/MrCQT8XLksUI6k82dGxsDWO6ezo4Pz4eMv6P9rPig+J9Vns3/evRp2Z3/nxULJJila6FuvBbZgZX5yd5U/FYtv6/weDRwGc3Jre9AAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMy0wNS0yNVQwMDoyODo1OSswMDowMDPIuVsAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjMtMDUtMjRUMjM6MDc6NDkrMDA6MDDVlNrHAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAABJRU5ErkJggg==",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABmJJREFUWMO1l1tsXFcVhr9/7zPjGY/jSy6NXVHVScsttCBVqElBFU0FFYiXqkitVPEQBA8ERBFPqCIUIZAQApSHFgchSEorAuoTUJJSNalTUNNQLs0FO0qcOE6d+D6ecXwbe+bsxcPYpYknyvE0LOloP5yz1/r22v9Ze21Rpz3zxlrcYgULMes2NCk/Prte0AJkDEWCCkbJsOKVcnu+OT1sFfNMqYGnto/XFTOqF1bzC6Q2NKuSn9kyOT53H3A/8DGgHWgCZoAR4ERzeuSvoGP/mr21d2tu0OqOWc+krldzBNEuuUdlPA62FRP2bqfLng2QYXAMtN9CeMF7Rnc+MPv/hX2mO4cHmfFBQ99GPApqvKETq0YybE7wgmQ/DsYZ55zt/NR04virk0GIZfJ3gn4APCxTlGjJqgILNSL7opkaZXzHOzu/tJRE5pJ+2HV4Dbio1aQnEA9LilAC0HcDCwxFZjwCPFGJ1dp1eE3iXCWGNTMv9CCwg+WM1mFVZkWgL2E8iJm/qbBdR3I479pkfF2mplrZNDPMYuKwSBwWiMMiZjFmNXZZgKzJsK+ad217DucSwSbNkDPCRxH31tp3MwNht6z5+Ejnus/6dNTaulgpFgcmXorHZo63m5mklfME92HhbuAICbSbDNbkDD4jaLgOaOhc//nJT97xI1qym3KAB3Lv3/jYldfPPZkfmDi4biWwABqQfdqkvwGVG2YsKaxMW0Ar9GUEWjKbp7Z27ppuyW7aCLwD25LdvPHeTbumW7KbikZY6Ra8obsMJeJIBiuEaKeGBswCzdnbs2tzH1lXw59bl7tr7ZpsZ9Ys1PYMG1GymrKavzpznbQjRVFNUQKSGpwiX0uSSxOySSttosxa9ZmqDeMolfMzC+XiRK33pXJholTOz6rWTlcdF28qrCAI+oB45TvP5OzpTO/w3mAWrjo7zcJ0z9Bem5ztzYqV5dREbOKsiUACSyQDCwTEUeBxXRNVEpV4LvPvt3dvXKhMDW7p2FFM+TUbyvH0eM/QvsXeob23VeL5dK3MCsrAMW4mbEDBQTeEIUybr/0dJMdCuZg+Pvh0Z8/lXyN5bxbfWg5zhFD215OAiSEz92okSwSbVAaG4mGJ/chCLY1JEELZL1SmfKk8yUJlyldBax13gCwIfisXRixhM5O4RezqzoHcBzB+g7Gtvk74KntDnh37v9d89lJ/hAsQB4f3geCqtayxVOL+kRH2rBYWoOtQcwofHgF2Y+qoF9jMhuem3ZP7nmr9U7moVAUiF3BxcM77EAenIFjMlkpzH566Ujq54RY6UmGV/awoI3uR4O4x8S1BKjkgSIYFhYu96TMv/bKpbb7oHvPOIgcOh7wzAHNVWYRSQ6by1oZMwUHPcKy+Veem60gOC64T+IXgoaSnz7IsJ4ei/pf35f586Uyq6L3JrnKwfKWwpUFQLZvzAXslcT+7bF97YJYguwi227ALq5k7P+OKJ7ozRy+fTRWcw0BBEHjnUXWUAihIFiRkWCNmrauGBfjG9hmb0vwhoZ9jzCXJaohV6T+R+ufJ7oYLUrV63NgkzGTSkDnXVxcswIVMHDvTs8AfanfYS5hW3c7RAX/62B8b36pUFBKACnAGJeCEg4Muk7lc9/Vk63Qb026+kFbqJ6APYdxTC0IyZgp+9M0DjUeLo36uRt8mEEvLNUTAbA44h3QGGCxkszMt5XLyO9i19pWHCjQoZZI7GSrstsA02HLQpdGoLGqh5/WGo+ePp0b53/ZXt9dwZgKzCjALDBgc9lH0vMFfPjcwcBqYua1YpP/cufde2ru6mymOubbG5vj7qTQ75SwyU7VMmeKBk6l/vPJs7rUrk77k3NLtywxJi8CsGQVhFyXXF8O4icp8Ph/n2trAe87391+ljfdsu361Vpmm+O5cc9iTzvAJaalMDfsLh5/PHRw4lZ5w3jzVxqUgaQwYljToo+gyRjmECnE5Nos8jU1N/OfUqZWSuhmwAD/8fQtRxBdyLeFpH1lHadZN//3FzME3DzT2uIiCYBizSwYjjZnM6PzCQkkSPpXifdu2cei5524Y46bBAnzzp+sz7beXv5ttCl8e7E2/9vLepv3zM+6CZHkvFQfT6dmOUomGdJrevr5V+6+7GtSyXHMoFcf8z1Jp+93Y26lCYawhz/jFUrazAzNj+8QEB/L5uv3/F2k1+QZ70J2JAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowODowMiswMDowMKLS20oAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABdtJREFUWMO1mFuMFFUax3/fqarp7ppLdzMDDCwmzAxegrIka7KLF2JkITFGE5NNfFAeNPuwGh8ML2rcbDYbXMNkszFmH7w8qYmYGB92jcuDwkYwQYzILEFmggODgDANc+menkvX0FXn24dqFJZuprrVf1KpTup85/zP/7uc77TQKv4KmNrvKoJHD0IWSAMuEKIEQIlZpsihGKAT+ENrS7otk3WBACHFejzuAjYDG4FeoAOYAwrAUTo5gOUQ9zLMAbTVJaUlq12A0IvyKMpjCL9JYHUI2I3wPsJFnvu5yQ7WbJRbgeeBRwE/ka0CwgLwPoZBLCewKC8mX77ZMBBgHbAT5RHATbxdARQfYTsWH+WPWE7VtpEITpOq5lFeALYjTRC9lrABbgUcDIf4LQH7kpmbZMO+39gW4Al+TGIKILjAk8AWJLlgyci+DCh5lGeIM/16KGCBCAhrb8uNnNwBPIUlz8vJyCZVyKD8Evh1XdfHyaN3rrqz8PC6h518Kp8rLhZLH45+GB0pHOlFkevs4pC4C2ED8CkJYjcZWcEA24BUPaKC2Idufmj6lS2vMJAbaCcOmfbH1z9e3rFvx9RHJz/qrksYUghbgc9q/lhCsaRkhfV140uhP98/89Lml2YHcgMrge/JrsuvW7lz887Z/lx/qa5ugoNwR02MJZE0wYT4ZLpeG4W12bWZDT0buuvMZzau2LisL9eXaeBkAVaSsN43k9XpRh88x3NFpO6CIpLyjNc445VMUgLNlK6ZRtpMLkzOFYPiZL3P08H05ERlYr6hdkIpab1OStYCo8QF6TqywxPD6Tf++4aNNJq9+lOk0ezrQ6/ryMRIpgGhCPimNv+SSFaQtyIo3cADtYJ+DdmqrbqHC4cz5cXyeF+ubz6yUaowXxgf/GKw/OpXr66euzyXakD2MvAmMMTepUtXMgfsQrD0IXyC0F93jILruJHv+bjiOqGG0UJ1gTAKnRusMlaT4lueX5ps0jBQhHFgN41cJhBGoVMOys50ZZpyUHaWIGpR3iXueRM1M8lbkV2AcgvC28CmxHaN8TnCEzd90PuNeymFsRBZg+NYrInPDz8I2Fwo8FrNIHnXtRfYRpm4KtxDfEFpDcq4qZjBNe+uGUrPeF0WsqJkVSVnjHaoSIdAyg1D/MhG4epfyB09XdJck7cLiJvtPwM7AK8Jglf6Aet/lz6wYt/yf7kLToCoq3E4Sm2AIhK3RUqIUjRwXIyOJlf2irpbqQInUW4HBuqe+PVQG+WVvNM9B5d9liq2CYYuFWkXET9+NH6rtovQAdKF0IPQH8Fcc2R/IDwDTAD3IOSTmprAlPJHs/s6T7VfqPW1KrHmtUfit4iCqIiqiIiiHqoXmyd7hfB9fIuLIb7VLh0OlrBjzD/YfTh/TFQ0mT9EUBUVuaAiXzRz3F6LEhHCWyj/RG9QemqapSdSI8u+yg1JJDYBUQGMQgAcNbDHpNPnW7+erAZmKOLzN4TbUH5Vl4SAM+dczA1lD3oz3kKd3QgIqrWtCRbVBeAkIieAc8VMZi5brTZRuv4fHwMPAB6XiJgHtiGkrsr6OL9DFrtGuv6THe4cE5UriRa7FzEgCBqCVIDzKhx2XfdTa+3xB8+cKZzM5S4vn59n5OzZFv/kuBqD4JScvPXtX9TVpxHcqwhH/tn0lyv29+x359wAE6eVqiIil4F5VYqCnhExoxFMqBBWpqai9nweHIdTY2PXxMaPhvesJ2TYEPrha+rp3T+UKff08gPde/xzmUk16gBVoCgil4BxETnnuO55lKq1IVE1UnUd/I4Ovj52rF5E/TTwXvCwrv1dlIn+gcMqsyiz+SO5Pfkj2eM4FIFxVL9TKPjp9MXK4mIgIjiex5pNm9j7zjtLrvGTkQXofLozXVlW+VOUin7vn8/sX7l/+W5TMacRnXJESufa2uZXBQGptjaGR0ebnr/1alAHYToM3JL7d+3W91KT6WK6nJ6qXjgT6NpeVJX7Jyf599RUy/P/D0pQLH84wUhqAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowODoxNiswMDowMJo3/8cAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABapJREFUWMO1mF1sFFUUgL9zZ6bd3ULbBUpBJVTwB1E0UaJg4oNGTUw0MZoYoz5ojKAxMeFFQ4wxBh8wxhB/sWriPyY+GH+RBDT+FhQVFaSBQrtQhRba7ral22l35h4fZosou3R2qSe5mWTm3nu+e+6555w7QrWizwI1gAB1AiOzQBqABOACAeCD5qCnH85QcIA6kNurUulWDUstkBNIL4b8cuAq4BJgDjANOAb0AL/BnG9At8HS3dCm1WqU6qz6ChDOAbkNuAO4IsZU24ANYN8H04us/J9hdT1gBOR80EdAbwNJxRwMkAfeB3kK7B5wFFkRW32FbhAIeOcAa4CbQSoYLwAp4C7QFMij4O6fWEUcMfGt2gp4jcBDEahW6+8ucAvIQ1BojHZrqmFRB+Qa4O5IYXXuHom4wD2g1xCFiCmE1VZA0sCDINPKdCq28IQ28a5k/2nA/UA6OrCTS9ytNMDFwOXlQdHLaOq5iflOmtrGLGO5jzkY/sLROaBy8k4IwHKQJcBXxPDdCmD1OpDaUqAC9kZaBtaxnIXU11GM/ndy7tAqtvZ/SmZmaWBqgWuBb4mSyKQWiwkriynpX8oCGgafZOnwQuqbgeOw51DfvIalwwuoz5UxnANcBBqLIy6sEGWmkqeqhenJJcyYWWI+cwkzZpxNfbL8vNocWX1yqST8JEq/VjyMK0hJhYLUeohT3iWl3EJOkgpCF4PljNOHfyzLWF+prwP4fUfxR04R6nJTDKsWtAM0LAW7m4FEK+02RIdP/BKiwy/Tru1kk2VgQ2AvYONQxHQDtSBtREXLfw6ZkCdIrOXX5hzj3fexKFeP1zRE4Wgru8dbaZ+XJ6gpA1sgKnBiwcZLQ7peQM4GNoMsKNGhuHITpvBwESfAhnkCAqxzCjWdINcCGWTFpHE2rs8qcBjYUNoKAggB1hlizBnAZ4hxZxJQC7xLVPPGKmbiJ3htBfQ8kDeBZbHHlZetIHfPu/n1ve6vhzAWQmtwHIs1ggAp3+eqnh4mSp0K69lWD7gFWAfMrRpT9bAZyK8+89ZXP05k8l4ArrGY0BrjODa0RqzAeNL38xcMDvm/N81mrmcrhoWoJn0cWAV4FQyObGPVpr7r+mb2qk8+co8M+zjG1cgdi+lYFREFLEqAkjXwhxjtqLzOi4BbQF8GrqdMMijH6+3v65z9yMZPkz8czOE68u+Kobgg1eJDAKzAqEU3V5IUIonuTgdA1wFdlQw1udFcwzs72pLbu7O4RhGsRAet2CR6ilgQK6JWBFE0hWpj5bARsEJ2C/Ai0b1qcimEQd2XHT81bNjRFV3j4myICKqiIofUmI7qYAE4EoK8AXzIKUOPgiqJXT3tM577foeMBzYGqABGwQd+M7DRJBJ/ncZ/gwsAssDTqC4CLi0NITi9w72N67e2eZls/uQjHXmtanFlgkU1D+xDZA/QnU0mjzUUChUVMv9hWFk0G79TCNcRTtQFE0aOnuIXxqZ/sLOt7ot9vVHukGgFqqKKURVQDYARIKPwheO6bytsuiGTaQeOzcvl6Ny377RufUWmVpxMX9o21T+hSe8BjLjHT3WgYerb/dtnr/78a/fQkI9jBBBVRUTGgRFVsoIeEDEdIRxVIRjt7w/r0mlwHPZ3dh5XdRpu8I+FzfbVOYPzWjCr7jJNeVdiJApTBwYONr7648/un4O+usZBtQBkReQIcFhEul3P/QulYG2AFELFdZg1fz67du4s4VBTJF7XWmyNc2vYVPc8njPXDPrD6Re+35h+qe0PatwscBjVPxV6UolE7+jYmC8iOJ7HWcuWseWttya3y1TBAkzf9HBi9MJZj4WNyXtTWw983fzwZxvMQL4LI/2OSK67pmZkru9TW1PD7o6Oiuc/fTc4QYKZSd/NZJ/RRe57tbt6s4nObH9hqMfXlhZUlav7+visv7/q+f8Gb188Ax2DNawAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjA4OjMyKzAwOjAwLF3cqQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABQ5JREFUWMO9mNtvFFUcxz+/M9N2d1HaQgEbNVy8hEiURIIBEx98MTGRhIR/wMQnHzThQXwyPhkfjBcwBg0mKiJiTIiYoCQKEWOoEZWLXCIt2+VWWnrZddvSLTszXx9ma8tll9m2+EtOJrtnzvd85nd+8zu/M8Z0TZr6y4A2oBlIAT4QACWgAAwCkwPMpjWlP23YSchHgLXAU8BK4B7gLmAE6AWOAT8DvwKnroP+X0wC6R6kl5F+RVKC1oH0EtKiG1bljkIa0nKkT5BGE4JOtNHKuOUVnTsKa0gPIX2NVK4TdKKVkb5CehBpesGb0KutSO/PAHQq8JaK3h2B9ZA2IA3PEHSiDVf0vDvh1TakA7MEOtF+qOgmwkiauhzwGPBErUdaBb3rwGuFljwUvoXwzziVVYvNtcCjwE/MWkqTfKQ3q8WqSeE6qb9L6pE0IimQNNIp9Twn9SNFNWL3DaSZ5vvrYBuR9lSb9AFp6JiUlRTqeguPSNll0lAV2Kii25h0eZOYUWM5l0D6UZh/Cz23EuYthXQN3UVUD5PrrB73p6p1NIBvVSY0aGqAWm98moSW1LMA/1TrGICRPAzcqm8IBvphtIZuYbZhI6ATCG/VeQpSH0EUwvDU/0MY/hB0urr3QuBMRX+WLN4QXkAaq5Yzm6XxV6WuLun8FWmsSzr/itQ1VxqvkWfHKrqzuDHENcEypLO1krwvBXOlYJ6kuVLgS8FtNoWzSEuT1ghJw0DAZWBnrSULwCuCNwQUwQtqv1gR8AVxzZtoQ0he9cRb4sPAZ8Ca6S7SFOsAnr9//foz/tGjuAjCyOF5EZEzDMiUSjzV28vWyoDkqcsMpG7gPeBdoH3amNJlNzT00b0bNvSncrmFQczhKi2seP2a4Gp/OlN6eMFC2huiOjw76d0M8DqwEWioGzSKoswvv/y8cOPGPf6VKyU8z1cMWUnVEmYCIkSAyDs4aU6d9e3JsXevAluJz1vPUGcoNWSzudbNm4/7fX2t+L7JbIqAYjkpvsT87YKlofihnk1hEhjOEYdCdz1DXaFQaN6x41D68OE8vi/MIouXvNIsvppFYJGZIjNMKIPUUj9sDCzgR+AD4GqiMeVyMOfAgd+bd+7sxrmEx3EzJJNZj5zrnB5sbCHwKfANt0s9EqkTJ07P27LliF27FiUANcAp/u5wzMF3LpW6NNM6Mg+8hbQceLwahNfX19eydeuhhlzu6s33yOC/g64wosp70YXZ38CFfDo90lwu11XI3PDsRsWjxymX3yUMh295W6k0fvfu3Yfm7N/fh9nEuHh5hZMMpIC42MkJ9nu+/7lg37O53Glg5P5CgWxX1wy/yMTZIfJ6evZGCxZ8KudexLlJzSAI0x0dR1q2bz9j5bLwPANMEmZ2zWBUIg+cc2adIfTLCIr9/eGc1la+X7aMs9nsf3IzP06Y4Q4fLjj4OGhrW6VM5kmci9PUuXPnW7Zt+8O/eLEk3/eQykDezK4Al83sgt/gX0KUoyjAyqHwPdoWL+bEX3/dNNWsnH3Kq1erobv7uCsW3wmbmpbiXLsrFofn7tr1W+bgwT4aG/MGl5EuCnrTTU19Y+PjpYmHvW/tGn7cvv32fpkN2Am7e9++1NiKFa+FLa0vZDoOHVy0adNONzTUjXODnlnhQmPjaHupRFNjI6c6O+vWn8VTJQTz55f8XO5tLU992XTiZD6VzQ6Wi8WSlixBEk8PDLB3cHDa+v8CFsk24crxS5QAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjA4OjQ3KzAwOjAwdKD6FwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABm5JREFUWMO1mFtsXFcVhr9/nzMXj8ceu4mVG1VSFwiq4iIqKClVHygFqQgkRKNAqjyk4gFC+gBPRYI8IISgIKgQjdKXiFKUi6IGVQKiirb0kjakCiJtrk0dO26cxHbsiWdsjz23sxcPdkJIxs3xpGxpdGZ0zt77m3/9a+01I5ocXd99lrJLUnfQPXGnBtr6FxuWk5QGC5HqZpRlVlgzkckfzU1b6Opks5cZ+sUPmtozbBZ2OkjRVaxotD1910Bb/33AA8CngaVAFmMKGAbePd4+84ZDhz6x+sDJ0ye+ZM3uqWYmtXx/D4H5pSbWgx41+DwyhOAqyuwbk+Y2skPALnm3N8JGZrZv+P/CZjfvJgIhrRb2hLD1JjKKsYwBMqYN9prxJI7THqyyLT70gmygyEmB/zjYzxDfAMI4oFdVERnMNkrKGPy4Cn1cE4ubjSDug61bdoKzTqQfgW2UCJtxkSSHbLVQEJodSt27rlw7vC/WXBd3E5MFJnsQbJOkpkD/q7JC4DEHD3ostmCxYLOP78HVw05MWxDZhl/GjMgb1bqnUo+o1j2RN8waR1mQRfpeaOrMPr4zFmxczzocdyPdOx+okH125W3DD/csDzoyyY7CdLWw/9iF6J1zl5eamaRGkbD7TPQArxHDu7FgzZsDvoyRuj76c8r5r9694vIvv/kZuruyrczmQuu3P7dy4onnj+T3H7+waB7glMFDwAGgfnPF4sAKZ+IudGNCeoPurrbi1q/1THZ3ZZcAV2G7u9qWbP16z+Qdi7MF31i3wGCNmWJxxHpIIM2eTDdI481Yuai1Zc3y3KIG67meFR23rVqcbfENvSvJtESmWNm6kDqbbqi6QSJw4TymRFIqESiw+R3ZEhcgZukywIqNcsAJ8lOVqcJ0dazRzPFSZWxsslJy82knCnGrYDxYw2P0AtH1twInTl4spHe8ecZ7b5PX3vPeJne81Wcnh4otQWPaCHgf8HEwYtrAebCDGI9en2SSmK5F6d/+/dSS4kxt8LH77yy0pRNdE+Xq6B/e7KvueKvv9plalHQNXGJQAzskUyzYWAFo3bxHTnaHh5cQ3Q3FNyMRuCiTDAmcgshbNF2tU4t8MI+dMazfyx4KzA2Utm24aZ2Ne9yaR0PALmyekEnUIh8UZ6rB5VKF4kw1+DBQzLyMnc4YJmYzE/uAb92yB8x/EumPGGtvoTWYU5V/Stq0+MDT77vCIM5D5B1B4PFutpfLlMs8MDzM9rk5sZuI2uHnSaxdNyGjCNyPaGue1IZctfTkon/86kiqNNbuIScjZ6YO5yxrUlaQCut1MpGP6stXaM3idi2snzVqGH8B7gH7ISixEC1nOwjzqbHe0x3v7O105YlvmVzoZnsPBc4AzM3awpdT6fqRrvS4gxNDkXoXHMzWLbuR2SqDZ0z6imJa6YopE5OX+nPH9v01mT9bwAUyrl1g7pPZ3EUAXjDjsZdi97NXRmnbBgLvPzDpKeBsnNS48oirThcy594+mLw8MI6czYF4rr40e5U8yEvmJWRYBrOOBcMCFJ/ZaJVc58uCbcim4ySzfFRPX3rvX5lzb5+92m3cfJYwk0kXzbnepmABokwucuJZgxfsQ2kNmZEoXjiV7X3liKK6jwEqwBmUgXcd7Hfp9IWm/zdYNDpIXonxjNV+LbNPgd1Dw1NKhJXiSLbvtYNhaWz6RoubQMw1OobwmE0DZ5BOA4PjLS1TuVot/m+w60f+d+tpsbrJ7Cg+egpscjaX50Q2wwBXr1XS5/99MDXy3sg14Z8Nr+HMBGZ1oAQMGLwShOGfDF58eGDgFDB1e6FA/5kzt1raZ6uDK412+lT7TwmSm00KZYZJyCxKjZ4+nDv659eDcrGMnACZGZKqQMmMcWEfSK43glET9Zl8Pmrt7IQgoK+//3+8ccujfcPPRSrXE6Wy2wmSX7jSS4dTo2dzx1/YnxrtHTO5AKgB45IuAUOSBoMwvIBR875OVIvMwoBMNsvxY8du2OcjgQVo3/Q05oJHfCr7e3PhMledmcyeeXV/tu/VE7hwHBjC7LzBcCadHpmpVMqSCBIJPrZ2LS8/99xN9/jIYAG61v0kXWlftjVKtH4nNdb3eufRfbtUK50F5QOpMJhMlpaVy6SSSU729i54/aarQaMRJbNlVxr7jW9L7E5MXBxPlvP52vmRMitXYWZ8cWyMv+XzTa//H6b399ILDmv5AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowOToxMyswMDowMCfNu14AAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABhBJREFUWMO1l0tsXGcVx3//e+94xmPHzsSxPXm4NK/adRKKQISUKjz6QIBKFIQUpMCiwIoFSF3RDQsELCIWCLEosKiggiyyQKWQSFV5pJRHUKpaVbDj2HnUedmOPR57xmOPPfd+h8Wk1JbH9Z1p+kmf7uK795zfd87/nu98otHxkScgbAYLYM4XbdFWsHZQCiNAhIgy2CwtTTmKy0YgaHfwj5cbchk0DLvcCh23xcyOftqiRzGOIB4BskArMI8xAbzFfOXv4J1nb2KIkWVr1KUa+qr/GMhlMR0HToA+gRlohbm1SOcRp/B0GucmGfrDBwy7/yg4T4he4HtgxzGl41kyQAvAabCTOF0GZwzHl4RfF2zXPoH2gn4MHMeURHG3LDASyA5gZIEBQsszM/IBwO4/CngZ4DlMXwcLVqU9Ji/IA/UifHzO0/VwmanhWJ97dbjyMR4HnkHUD7oaOgC+gfQ4ZrEDFu/F/i8DdAA/AXpr5t2sOsMIogicvftarY1JTaAtyDtDV99CnOjGLV0epg8jDtVcNQOwjx3cN/Glz3zcz7S1bM4XSrMvn7sQvTl4JYuZ1snEo2AHwc5Rq340Bmse4imM5JqgmiFwT3/20MxPn/sme3qyLVQz1vK1pz9VePbkC7k//e1CxzrASeBJ0OtAuHHE4sJi/aiGbJyx+4Hs3I++e6K4pyfbDfwfdu8D27p/+J0Txd092VlcjcAZPsYBXDyOmLASKEstsTrHgzu6mw8+9KGOGva8R3of3LJrZ3czztU0DNYNFutvree4Ta23kAj8QKotSknJRODX/pGrpaw5LkA9pWuutkMxnS/O5wvz07WWZ+aK01P5Quk9St3s/YU1c5iNAtGaNd9j6MpY6penX3GRc8WVS5FzxV+cfsUujd5oxq/pKsIYwXDEGPHqbGefgA7E50GrpSNRqYTBG0NXmwvFhfFdO7OlyLnkxHR+/OQLvy/87Ldnts+XFpN4tWBtGfgVaIDp4Q1LV7xjqO+o8LxdwKvA7nWiTxAEUbo5SeB7fhi5aGGxTBhG/voSsGvIniTy3mb4pQ1h42rWEONgp9ZPmQjD0C8US/7MbJFCseS/J2jVzu8wTRDjQIgfWYD9x8DcQ6DfYDrcYCe8kvbfwDM9iyMjgVvAcxA5D99397pQSJfLHJmY4Pl7X8TvuqaGoau3AJoDPYbY1DinjXsWntxZHhpIuaU2B+0y2s202fOs1aRWQTIIQ9KRi8LtO3Rga5vqvdZUMP0R+CjwLJBogNSlXfFy19JYJrDwqwaBBx4e8r1qj+FVZeHKyVQ40JnKezA4Hmm0vuZ76jJ09VUQV4D9wB4M1SOJhCtf31q583rSLQmpzaQWSenqtOrTrEWiFdSG2IrYHcF8fbBQlUN3/xzmpoDHQJm4sJ6Fs5lw6i+bwtk7AEimahTvTVWfkoFMMpMkwxKYTdYPC3D3EuzreZtyk4d0hDhyMAtbo7l/dVQmLgqzeM27hJlMumPSf+o5blePlrkI6dfAS2xUesxIuYVLWyoTAzLnYoAK8AzKwFsenPVSqduNRRag9RBAGeMqZocQ29arhL5VJjsq4682u1L+nYCt2IlAqrbFgHCYlYBBpH8K3syn09PJMIx//1kzJoehsw+Mu2Al0FNIyRUQgJC5pbYo99f2KHdN74JW01u9PCIsBC0Ct028EQTBOefc4BfHxiaubN683FkqcenGjfdf2uk/hh8uZZwf/MDkfbvaO1RBMYvSUfFC1/KN1wKrlKm2kTIzJC0DJTPywsYkbzSCKRPhYi4XtWQy4PtcvXZtlTbe90js/ZxI+AdDgucN75PvpDnhytc7l26dTbvCtCEfqAB5SXeBcUk3/SC4jVFxLiSqRGaBT7q1lf9evLjGz32BBUj0fwHn+ErkNf0ctM2zsJipTJ7NVCYHkZcHxjG7ZTCRTqUmF5eWypLwEwl2Hj7Mn198cUMf9w0WYNPDn04tkv5+RPCtdDT/Wnfl5inPwutAzpdmbzY1lbaVyySbmhgaHa3b/n2Fbe57AnO2peI3b2+v5PJZG89Vbtwq244ePGBfsciZXK5h+/8DFYWTIIiuQPwAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjA5OjIzKzAwOjAwqUK8vQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABilJREFUWMO1mF9sXEcVh78zd9fetZ04TkmcKDYqJSalpaSyLUiRooqqIOWtLVKREA9FPEBUqRJ9QQjxgHgBlTZCCJXHECCgSolQKBGiRSJBSiNCGjWhMYljJ5FJ7Tje7np3bd/duzM/HtZFCazju9twpNU83J0z3znzmzN/jA5tZGSWfD7GucDWrYkVCtmPgPoly5mRARqSYqBUqVQK/f398h5qtQwXL360ozEzncL29y8zMbHFdu2af6hQyDwG7AV2A9uAPqAKzAHvbNiw4WQI4fT8/MDFwcGiOh3TOuk0OjqFc7YtBD0LfAX4LAgwbA2PEqeBwxKvmenm22/v/P/Cjo9P430wM9tlxreBZ0E9ad1ILINeA35kpkshoHPnRlKP35YMoshZCNoJ/AD0lETGLH28ZvQAX5Xokfiu1JiiOSWpzLWT1UbDbzLjBdBTYG2B3oacMeMZsBfMspvGxqZS90wNK1kEPAE8Z2YdL8wPgIGvmdkTQHRPYcfGpnHODwDP01zpLYIRIYgkEfV6sw1BaI1JNrM+0DdDCAPj4+mymypDEi4E+zToM60WkyTA9PDD3XN79+ajjRujTeVyKJ08ueQnJmrbJKyVZMx4zMweAf2FFNpNBWsmB3wBrLs1KOHxx3vff/HFzQwNZXtpTm3vvn195VdeKRROnFi6D9QC2LqBJyX+CjTW40ipWTnQQ7TQVwgwNJRd3L9/U2VoKDsI/Ad2eDg7uH//QGV4OFsKoaXjCPSppv/1LdWfJExiGy00IMGOHdn8zp1d97Xw50ZGujbv2JHJt9auDBgkZaFOKQMDyK0RCJkMGVujjplZdxRZ1BrWAOXTMKTO7KottoaBYtFXy2W/0Op7uewXSqWwtHZJtlLaHTCtZgNoEuT/+0sUwdRUkjt6tBxCUOX2byGocuRIWVNT9XzUoppKeInLEoEUlra4B+AUzUPLHcOaGXEccgcPlgYrlTDz9NMbS729bsvSUrh19Gi5fuRIeTiOQ5dzLUtXApxe9b+upcr/+Pikec/HnLM3wB5omXuJTMZ8LmdEkUXey8exaDQU3WVbnpbck1Gka2fOPLBunU2rWUWRzYIdXisLZkajoahaDdHioqdaDdE6oEHi1xDmpHSHmdQnkfHxKbznE2b8wow9afvdxd6SoueWF79xudb4Jy6AD44oCgRnGNATx+ydm+PVdmEBxsauZMGeAQ4A2zvn1GwIpe8slp4/FoW5bAMyLuB8cC6Kgg/OgkE9H8fLn1wsx+e3bGV7NrR7rbEE+D0wCnwLyLYBCBhSCI3k7KWV6g8HLBS+LFzGgcNhkROsbpdAiLtzjXNbckUH7856m2z7QLp6/rxf4udmfLHd2fH++vRy9cev++R8ySwyYbc5aAaEtNoYQDBYCeiNdjYFAM6e/TjAdTMdAF1tp69CuVSPj53yyYUiRAIL1lywqz9rtmYBLJgpmGFCPUib2oZdBVY+P/8m8DNgORWoGo0kOf33evz6VXCku2WYIZnM3pNzkx3BAvT1ve8lHZT0O0l3KT1CEt5fnoiXD52TkpAC1AAniIF3HBx3udyNjq8nt27tpF5XsavLXgIelDTaGsJQWLhZW/7tqeBvLP+vxGXNhbcamRGQloErmF0CZor5fLU/Sdo6yNxhZ88+SDZrMrPzkBwAX/kgk81mdfRQq9VrfzqVJKduNt8VbDUCmYSTDKQGsARcE/w5ymR+KfjjvmvXJoDqcKnE9JUrnT1y3G5jY1N4f2PAuc3fh+79Zi5zW5nyjeTMmZXqyydCmI/NIgNMzXtOHViSKBq6buYmPdyS0VgpFHzvwABEEVPT03do40Pb7t3HzKz/Eec2vwq5z5m5ZqFszFxdWfrJ8UbytwXIREACFM1sHpg1s5kok7mBSEJo4BMvZSJ6+vr4x4ULLQR1j+zRR09glv2S2eafmmW3K1Qr8cqvjtdWDr9rli0Cs0j/Esz15HI3V2q12MyIslmG9uzhzUOH1h3jnsECjI4ezEkj3zPr/3ojOXciXnrpsA+LVw0rRGalma6upe1xTHdXFxcnJ9v2/yEfK+40aSD2/r2Xo6j7N95fKYqZgm4UY9txP5L4/MICfygUOvb/b4OFAZuQsv++AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowOTo0MSswMDowMPiypBMAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABfxJREFUWMOtmF1sHNUVgL9zZ3a9u97gXRITO4CwImhpAqXioQ2oeWgESPAUgRQk4AHEQ4uQqJAQP614QFVRItSi/tD0CRVo08gR/xAhkQRIIhMURJxAfm2vHdzY63g3Hv/P7s7c04dxCm7WYXbJkUZXmtl7znfPOffcc1doUn7/smJSgIHalUiiyApR2lBSCC4QKPiAN62Uc4IaB5al4Zd3SVM23WZh3Sz4g0hLF2sSo9wCrAduAjqALDADFIHDy4S9Fg78fC3H9h5Bm7XZ1BI3dyuidChsUrhP4GcxNB4AtonQLZaxJ+9t3HRDM7Z0Kwiiyg9RnkLYBGTizFUFEeZQug1ssYaTVtHfbIqP0FgaWATDtcDvFDYCblxTIqCQEXjAChlVfmuFAYifFqYhrxpyCo8BG0Xig/4PGFDBVbgbeMyx5J7fHj+FY8OiOMAG4EG+x8aU6HFRHgI2CDiXFPb5HYoa8gqPEu30C9eiYBVCC0EYjVaj90tIFviVFfJxvRvXQ0bhx8BP64V+YfNoZ57itZ04LUlylSpe3yhh8Rwdqoj830QRUOUWgRuBj4mRu7FgBQzK7UBLPVDAXreKcxtuglyWVqLQtq65hqndvZT7R1heDxhoEbgN2AcE3+mxWLCKEVhTL78UyGeZXL+W6VyWlfANbD7LyvU3MJ3L4tVzm4AjcINIPI54G0wRlA7q1GVVaGslvaKN5XX0mSvauDzXSlrr0wrCSiRevY+Xs5Gq1FKfHYMrSxgUocWYpXe8QjoWQ2zPRjK51DrmKsz4VUr1vvtVSvMVZpdynSiexCy1cWEt0AeEdTzH+CSp3gJWlelFXlOmDw2g45OkpT5tiHAKwcaBiFu6rEIPUdOyKKQiEISkDpxgpV9l+Cer8ZIJ2qs1xnsLVHsLXB2EJJeArRE1OJcQVrCqfCTKCMLqet71qyQPnqKrdwDE4KhlVS06HBxZKgeUEZQ9EtOzcdNAxTIKbEPrKxaJwPwaznwF/BrORUGjaP0LoYjEa2Zi9yKbtysq/EDgFYR1ceddRD4V4cG3/7Tx1OhwL8ZCaA2OY7EmKi0Z32d9scjWRmEBNndrgqhjehHobJZSVUfnZ849s+OP97wTzAwlAnCNxYTWGMexoTViBapp35/70eSUf6T9CjoTtuHuqQa8C9wMPA4k4gOe7wesPXNq/8mPtz+er0ydvdcYxzVgMIhjFEBNdDBavyUVHGpPTRg4OhpKX8N3i83dCtClyt+BOyTm6bOAjHd2oLB3x1PvFQufecZxRRcdXwrIwspAVQCswLxFP2zkUADg6egacpooFQYbmevPet6xT//ZUxw8OCHGVRArUdlaeCQaRSyIFVErgiiaQTXXMOwCsNZy7BJ4CWUuzhwb1oKvj+/5/MSBbYMipm4LdqGIoCoqMqLG9DUFC+BdSSjKPxTe0ov0oqqgqpTOfHX80K4/HwqDqo0BKkQ9tA8cNrDTpFJnmr6erDoMk2kmMgEviOr1CjfXgxCB2cmxscMfbe2ZKg3NccFvVEDO98WKYFGdA/oROQkMT6TTM221WkONzCJ54n4hHaAuHLFB7UW14fR5T357DGt+pe+LN3pOH9s9hsj58EfhVYyqgGoAzAJDCrsd131N4YM7h4aOAzNXex6F/v7m/uT4tmzpVrzSUD6zrP05N5F+RIxxvylTQTh8Yt/B/a8/88mMN+Ib4wggGl0bqsCsKhOCnhYxfSGMqxDMl8thaz4PjsNAobAoN763/PqFg5LOrLgxc9mKrYlk5lYRAyjeeGGw581ndw6f2FsyjusQ1ekJETkLjIrIsOO6Z1Bq1gaEtVDVdchks3z15ZcXptSlgAV4+qVB3GTynnS2/S+Ok+iszE1O9+75687ePX87atzkhMAoqv9RKGZSqbH5SsUXEZxEgqvWrWPXq69+p41LBgvwyHMfpC7vWPtsSyb/8Eh/zyf7dzy5bX723KCIKTsi3nAyOdvp+7Qkkxzr62tYf9PVoJ6kWpf7XnnoD8vd1L9LI0cnvFKhzNkpP9XVharyi1KJ98vlpvX/F5vAnOxV5r8nAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowOTo1MiswMDowMAXwvhAAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABa9JREFUWMOtmGtoHFUUx3/nzkyym7R5tIlNfdCH9f0CLdoK/aCoICiUFkTUDxWxKoLQL0oREdEPikjxGaP9oLVW8IOo2GqpilqJlfporU2oaZKNaW3SZrOb12aSnbnHD7PV1O42s2sPDBdm773nd8/933PurFChvYxSBQhQCzIBTQL1QAJwgQDwFbIDkD4X1In6cjdSkU+3UthqIAvSCJfnYCWwCrgGaAHmAOPAALC/Bb5T2LMcOtpBK/VZ0RLfQgmhReAu4B7ghhgT7QG2WfjQwOBDFbgua0QrigERuEThCYW7BGrijC2EMwd8KPCChUMO6PoyEMqSQQDiwTLgWWC1lDG+gFQD3KdQI/CkC92UIQsTt2MbigcNwGPAaq1c7y6wRuCxPDS0liHh2LAKjsDNwDrArew8R1bYkfs1ms85q7BtKAKNwKMSnfRii0GBcMZz8l2J/nOAh4HGt2JGN+5WGuBq4PpSoIA2X8fAojtxqhtpmMqQ/fNTwhO/0KLRofxvdAFWClwFfEMM7caGVbhVovR6OqhgF9/B8MpNUHchtURbW3vRvYz+sIF06jPmFwMmmu8WYDdREZk1YrFgBS6niL4UqF/KyPLnGKu7kAXwL2zdMhYsf5axuqVkS4TNAa7UmBxxYYWoMhU9V3MXk5x3FfOLzGfmXcO8uiUkS82rsEBj5vty0k+i2EsFjIcrUtyhCNXi4ZQSpFByIadZ7NQFjJRwhj/E+FSGoWK/+8MM+SeYOEPosmcVVsEqdGmUkU6DHe4g0dmG1ZCxU8aFjHW+iWY6SZaADYE/ABuHI5YMFKxAO9Gl5ZRDJkCQI7HveRZMZ+m/9EGyXh3N+VFOdLQx3dnGBUGOqhKweaILTizYWMJuRUVgCbBLYGmRxQBgXEKvBsTFsQFhkAMb4JzBSY9EqSu1Hpk1z8bVrALHgG3FoiCFxwY4U6M4/jBMj+LMAmqB94nuvLFKWOwS34aicLHAu8CKuOPOYD8IrNvasvqP/up9GAuhNTiOxZootdT4PqsGBmgtF7YA7AFrgE3AwkopFT2WM8MbN5+39tO8SXkBuMZiQmuM49jQGrEC00nfz102Mur/1nwOCz1bNixEd9KngQ2AFx8wioxibSrx/Xfbmzd8Mu4c9x113EIFk0IPRUQBixKgZAwcFKNdZd/0CsCLFd4EbpOydkdJe909n89/4rMjiR+zDq4oM6tJYUmqhUYgykSTFt1VTlEAoPDt1KeRFHrLGTtpstl9c7e2H03szRhcBbESHbTCI1ErYkGsiFoRRNEaVBvKhi0Aawa+BF4n+q6a1ULyQXfy65/2z93WKxgk1oaIoCoq8pca01URLMBxCAXeAT7mDKknuoArg9W/d7Y3vPJrINM2BqgQXUt9YL+BHSaROFrx/waXRU0GeFHRS4Fri0EIMO4MDv5Y39qe9VK50yWuAoJqYW2CRTUHHEbkENCfSSbH6/P5si4yp1hBuwr8FpLfpIRjJ1/MbPP4UwfmfNR+OPnVIMjJ7Y+2VzGqAqoBMAGkFL5yXPc9hS9uT6U6gfELsll6Dh+u8H+cGdaGMuSkGuts8zOeJh8RjPtvmgrC3sTuvTubNn476v7lm6igiaoiItPAhCoZQftETFcIJ1QIJtPpsLaxERyH7p6ef3xVLIOZEd5o9mYdw+baoOk6T2tuFAygDLt9f+6tf/vnEfeIb9R1FM0DGRE5DhwTkX7Xc4+i5K0NkHyouA5Nixbx+4EDRSV1Vux5rxfHVq2tDZtfdfAW+jIytqfhtR176t84aKjKCBxD9YjCQE0iMTg5NeWLCI7ncf6KFXy5ZcusPs4aLMDjc79INE1e8VQybHygL9H+7c5zHt+WM8O9oibtiGT7q6omFvo+1VVVdHR1lT3//5bBTEsG8/2Mm3rJtYkPBqsPZoYTPWn6Rv1ky2JUlZuGhtieTlc8/98L/TvfZZ49dwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMy0wNS0yNVQwMDoyODo1OSswMDowMDPIuVsAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjMtMDUtMjRUMjM6MTA6MDQrMDA6MDATW3FEAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAABJRU5ErkJggg==",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABQpJREFUWMO9mNtvVFUUh7+1z5nOTKWUSsE2ahRUQiRootGIiQ++mJhIYoJ/gIlPPmhi4u3F+GR8MN4gBokaFRU0Jt4SlYSLQhSIKAhyibRMWy6l9xl6nTLnnJ8Pc4pFmOFMW1yTlZMz++y1v73WPmvtfYwZitD0WwOagUYgA/hAABSBAjAI/3YwbEZj+jOFnQZ5O7AKeAC4E2gB5gGjQA9wENgF7AWOTof+X0TlX4vQ00J7hZRA9wg9JXSd/g/eGNKElgt9KDSWEHRKx+J+y2M7VxXWhG4T+lKoVCPolJaEvhC6VWhmizehV5uE1s0CdDrw2tjeVYH1hNYIjcwSdEpHYnve1fBqs9COOQKd0q2x3UQcSVOXA+4A7q06p7vpYTUeTSwgT4HvCNlPC1RMrKuAlcDPzFVKE/KFXq24Vk2hVqtf7eqWNCopkDSqNnXrEfULRVXW7itCs833F8HWCX1bcdBbNKSDykkKdbGEOqCclmqoAmwU261LGt4kYlAlnDeTZSULL2PPcSfXsoRsFbvXQbL6W4v7MxVbUvgVC76RJkW1Nz5LQknqWYBzFVsGGCXPwGXbhhign7EqdgtzDRsBbUB42dajZNhARMjIRf+HjPAu4lhF74XA8dj+3EhcEJ4QmqiYMxs1qRfUrnadVJ8m1K6Tek7tmq/JKnl2IrY7d4Uh3hMsFTpRNcn7CjRfga6VNF+BfAVXKAonhJYk3SMkXQYCzgKbqoYswGMYjyFgGI+g6osVAZ9R3vMmKgiJdz1xSVwGfAzcN9MoTZM9wOOPtTx6fH/6T1wEYeTwvIjIlVNLfbHIAz09rI87JE5dhiHUAbwFvAm0zpRS6OyQG9qw5vo1/d2uc3HM4WINY6+fF4z3Z+uLyxYtpjUV1XYYir1bD7wMPAOkagWNiKJfM7/senbRM9/2eX1FX56vMqSVAy1hJiBCBIi8gyPm1FZTTY69Ow6sp3zeeogal1Iuletct+DtQ31eb5OHb7Lp1URlc1L5UuZvFSwJxdZaisIFYKCL8lLoqKXvOVcobG74dPfvmX15D1+GRVYOeaxWvppFYJGZIjNMqB5pQc2wMbCAbcA7wHiSPiVKwU/ZHb9vbtjU4XAJj+NmSCazbjnXNiPYWELgI+AbrpB6hDiSPnxs3YK1B87b+SgBqAFO5e8OBx384DKZM7PdR+aB14SWA3dVgujzens3NK7f3ZXqHL/0GRkYUjwvI0IaB9ox+xs4lc9mRxtLpZo2Mv+ZuhF79FCJ0psh4cjlnitSnPx63le7t2e39xo21a8cXuEkAykAxoBOwXbP9z8RbHm4s/MYMHpjoUCuvX12X2Ti7BB1e93fL4oWfeTknnS4CzZDgnBvZs+BTxs2Hg+sJA/PAJOEmZ03GJPIA13OrC2EfhnBcH9/eE1TEz8uXcqJXO7CeLM+ThjGPrevgOP95qD57nrV3+9wCNHld538oPG9P077p4u+fE+oBOTNrA84a2an/JR/BlGKogArhcL3aL7pJg7/9dclY83J2eee0j3qSHUcGnbDb6TD9BKHax224ZEvGj7/bVd2Z2+KurwZZ5FOC3qy6XTvxORksTxb44ZV97Ft48YEjplD2dKwJbNiYsVLTWHTE3syu3e+uPj5TXk31OHkBj2zwqm6urHWYpF0XR1H29pqtj93p0pgYbCw2Ol3vp6JMpsPp4/kc5ncoN81XGxsuRlJPDgwwPeDgzO2/w/IRTXCFJZFPwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMy0wNS0yNVQwMDoyODo1OSswMDowMDPIuVsAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjMtMDUtMjRUMjM6MTA6MTMrMDA6MDAaVk9UAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAABJRU5ErkJggg==",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABfVJREFUWMO9mE1sXFcVx3/nvnn2PI/leEZDHSNQ04gUUgGVQIIGqQuqgMSuYtEFRUoqNlRIlVixoKiqukIIwgZVhEr9CAS1Vj+Q2oJE+EijpmnTNiRNaxKnSWyntmM/z0wyiXnjmXf/LGZchXbGvHECR7q6i3vPub93znnnnveMDUq9XqfVaiGJarVqo6OjZTPbBOSBHNACEkm1hYWF5fHxcQE45xgdHd3QmbZR2DiOGRkZsXq9fhuwA7jTzG4HNgPDwBVgQdJx4BXgSD6ff6/RaKhUKv3/YKvVKmmabnbO3QN8B/hqBrUjwH4zewa4WCwW/7ewcRwTBIEBn5X0I0n3mNlQHyZWgGfM7KfAKUD9QOf6gfXem3PuM8AjwN1m1pe+pCEz+25n/rFz7n1AWfVd1o2VSoUgCEYlPQDcLakvUAAzo6P3bUkPeO9HK5VKZv3MsEBgZncBu4Gc2cbezY5eDrhP0l1AcENh4zhGUlHSD8xsuNseST1HDxmW9H1JxTiOM8FmDaUDvgh8pReomSkIgoUwDAMzG5VUazabaZqmmyVZj0jsAL4A/J0MuZvJs2bmgG8Agz1AfRiGy4VCgSiKCvl8PoiiqFAoFAjDcNnM1MPDg8BOM8uUCplhzey2Xkadc5eiKKoHQTAGFGjnYSEIgrEoiurOuVoP0wHw+awcWdPAaN9MXWPpnIucc0GXQ51zruScG0zTtJfdMTLW+37KT349O72S0swG6fHGd1SirAD9lK5LvRYkXZEU91iLJV1dR7e2TsXoH1aSlzQlqWss0zTNNxoNL6n+Eb16o9FQmqa9vJea2Wkz8zcM1sy8mR02s2aXNSTlkyQZS5Jk0Xs/671PvPezSZIsJkkyJmmwh+kmcCQrbKacdc75NE3/BsyZ2dZuwN77gSRJtjQaDWjn6Cc7l0KwtqeLzEn66w31rNoyD+yX1NVwx8OB9z7w3uO9DyQFZtYVtGPnd865BTI2M5kv+DiOMbNbgSfN7I6seus44LUgCHbvvvfe08dPnsR5SL0jCDzeGQYMJQl3LizwaEcnc+kql8tUKpVzwC+BPcD4dYDOV6vVX+/atWtp8cKFmzocrjNSwAOrgpWlaCi59RM3MR76/prvTjs3BDwE/BAI+wBcy23/xuuvv/LQgw/+YSmOk5xzObUhrR1oCTMBHtFCVB28a05TffWkpVKJSqWyAjwq6XYz+yYZU2ktb6enp8//Zu/eE0tLS8UgCExm1xhQ25zUntr844JbUvHnfi6FD4GBaTPbA5zLWtABLtVqtecmJg7/4+23q0EQyMy8tUPeGdaezTyYN5M3w4SGkEb7hu0Aa3h4+ADwKzNbyaLTarVahw4devO5Z58955wjW/NuhmQym5NzUxuCBQjDMDWzJ4AXtI571xrwycnJycf27j22urrqM4Aa4AQJcNzByy6f/6Dv76g1qdfrrK6uVsMw/JmZfU7Sl7pBmBmLi4sXn3z88cMXZmdXPr5HBkbncYXhkVaAM5idAmarUXRlU7PZVyPzHzIyMkIYhnLOnWg2m3vSNK2vefLaudFoNF5+8cXDhw4evHjNBdEOr3CSgdQCrgLnBX8Jcrl9gj996/z5SeDKp2s1zp4509+n+EelVCpRrVb9/Pz8S+Vy+Qnn3P3Oudw1ZSp96+jRYxNPP3261Wqp88/BOuurBlclqsC0M5tKYUlG6/LSUlooFvnj1q28f/bsh+ddFyxAsVjkwIEDNUmPlcvlL0dR9DXn2gGbnZmZ+e2+fW/Nzc0luVwukNQEqma2CMyb2WwuzH2AaHrfwpqpyAWUb76Zk++887GzrhsWYOfOnTp27NiJer3+i4GBgVucc+OXL1+uv/D882+89uqrF3MDA1WDeaQLgoVocPDivxqNBAAzPrXjDg489dR/PWfDP+a6ycTERH779u0/2bRp0/fePHr04CMPP7y/Vqudc2bLgVltdmDg6niSMDgwwHtTU33bvyGeXZNSqZTMzMz8fNu2bb//5+Sp6vT09HJQqyUjW7Ygia/HMS8tL2/Y/r8BRVECE4yt2dgAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjEwOjMxKzAwOjAwz+xZAAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABihJREFUWMO1mF9sW2cVwH/n+6597aRVbLykf0S0iiJGpwLSGkGHtAcmQOINDWlIEw9DvIAmTeKhoAnxgHhCCFVa1UIRDxBEkaZ1He2YUCnQDalUqdextmvnpUs60sVxbMdO4tROfO93eMhNadO4vXbLka6u7v3uOefn853zfeez0KMUCgWazSbOOWZnZyWXyz0EDIhICvBUNRCRFlDPZDLVubk5tdbi+z67d+/uyafXK+z8/Dy7du2SQqHwaC6Xexx4AvgcsBXYBDSAGeCder3+pjHm7NDQ0OVSqaS9+pRelPL5PM65rcaYp4FngC9s9J3q/7hE5CxwREReUtXSyMjI/xd2bGwMa62o6iOq+kPgaaBP5N5mVBURuQG8BPxMVQvGGN2zZ09s/12lQRiGYoz5JPBT4OsiEls/+kF9qvotEekTkR+JyAdA7LQw3UTV87yMqj7fLeg6aE9VnwKeV9VMPp+PrRsbVkQs8CTwLPdRmGvAwLdV9UlVtQ8UNiqoLPAcq5V+h6gqqopz7ua19q6DbAK+a63Njo2NxYKNGyFjjPmsiHy+Eyig/f39MwMDA9bzvEwQBPX5+flwaWlpq6pKhyJ8PAzDzwCniZG7sWBV1QBfUVV/vdMI1GUymbnh4WF83+8HLNCfy+UWpqamqvV6PbcRsKr6wJdF5J9AcM+IxY0s8GgEcYekUqn57du3L/q+vwW4Cev7/pbofb2DXQvsjssRK7JRSLbSYV1OJpPpdDptN3Bq0un0x3zf95eXlzc0DWwh5nrfTVWnNnoZLfZep6QUEV9EbPTd+jGAdFyA2EsXMN8BhiAIGkEQVDYaD4KgEgTBUqddTlXrd1kxuodVVaeq40C40Xiz2UyVy2Wnqovr9BbL5bI2m81O0QtF5H0RcXE44qaBA86o6jPR5nBbZJ1zqVKptCUMw6nBwcG6MWbQOVcul8srlUpl2DmX3CiyqtoGzkb2Hwysqjpr7T+cc9PAJ9aPR6mQLJVKOyqVCqxW+fYwDFFV2ykFRGQa+HsYhrFg4+ashmFYBI50ioKIoKo2CAIbBAFBENi7gUZ2/gDMiEispI3dIkbt4adU9XfA3rh6d5F/WWuffWHfvvcL4+MYB6EzWOtwRhCgr9XiiZkZftktLMC5c+cSIvIUsB/Y1iulqhYXFhZe+MG+fccXqtVEAJ5xmNAZY60LnREnsJJutW7sml9oXRgcYlvCddc9iUgbOAE8BnwfSHQBuFaM7uKFC4WDL76YrdVq37TGeAYMBrFmtccwq32Ca/mp4O3BVM3Au8VQxrs+1kT95w7gV8BXu52d69evTxw+dOi1K5cv1z3PE73NQPSkGt0EwAk0HfrXbjYFAKKz04equl9VJ7vRXVxcrJ86efJM4b33atZajUAcNy9ZvYs4ECeiTgRRtA/VTNewEbA2m81TwEFVvRFHJwiC4Hw+nz918uSkiBDn3AYiqIqKTKsx4z3BAjQajVBEfisir3KXXnStAZ+cmLhy9OWX32632y4GqABGoQW8Y+B1k0p91PPxZGhoiGQyWVtZWfm5qn4aeGwjCBFhbm6u9Kdjx87MFIs37vxGBYSoPVAEx+psXUWkAEzV0unGQLvdVSNzm4yMjNBut1VVLwRBsN85t7gWyVvvK8vLy2+ePn3mrXy+dMv0r06vYlQFVANgCbim8Dfreb9X+MvXrl27AjSG63Umrl7t7U+OWyWfzzM9PZ3NZrM/8X3/e8YYb22ZUtXw3+fPn/v14cNvVCuVljFGAInGV4AlVWqCfihixkMoqxA0q9WwP5sFa/lgYuKmr/s6pa5FeHR0tC4iv8lkMntSqdQX16a6WCz+57UTJ94qz862rLU2alxqIjILFEVkykt4H6G0nQuQdqh4locefphLFy/emVL3C7smx48fJ5FIfCObzR7wPG9bo9FYfPWVV14/dvTou14iURMoonpdYaYvlSo1l5dbIoJNJPj43r2cGh29p48HBgtw4MCB1M6dO3+8efPm71y6eOmNw4cOHllYXJw0IlUrUp9KJpe2tVr4ySSXx8e7tn/faXCrZDKZVqlU+kUymfzj5ORkbbpYrJpqtbVpxw5UlS9VKvy5Wu3Z/n8BcY8RVtNG93EAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjEwOjQwKzAwOjAwY15brQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABh5JREFUWMO1mF9sW3cVxz/nd23Xf26bhFGaNEyNKrTB0lFpD9Ah7QEESPRpAimVKA9DvIAmTdoTQoiHiidUsWpCZTxVMESJHG3lb4VEl64gteWPuiZjTZrUdqZQ203sxk7s1H/u/R0e7FTpZqfXXvlK1pX98zm/zz3n/H6/c6/Qp86cOUM0GsUYw+joqOTz+Y+r6oCqRkUkBHhADSipalFE1HEcYrEYR48e7WvOUL+wruuSyWRkbGzsqVwu9yzwHHAYGAZcoALkgRkR+RtwdXx8/Mbs7Kz2O6f0Y5RMJlHVYWAC+Cbw+fsOpavLq8BZEUlaa+8cO3bs/wubTCYREVHVJ1X1+yIyAcSD2KoqIrKpqkngJ8aYm6qqExMTgefvqQystWKM+RTwY+D5XuzbEY8D3xKRuKr+UERSQOCyML1E1RgzCLwEPN9eRD2rbfd14CVr7eDk5GRg28CwquoAXwJe6CWiXRRS1W+3/TmPFHZqagpjzBDwIq2V3ulmUFWstfi+j7X2/m9d5ALfFZGhoNENGiEDfBb4XDdQEdGhoaH8yMiIE4lEBhuNRimXy/l3794dVlX54C4hIqjqs8DTwNsEqN3AsKr6FWBXJ1DA7t+//+7hw4dxXTdBK7WJAwcOrF+/fr2YzWYf6wTc9vdl4O+0DpGHRuyhUlUDPEWX+nJdtzw+Pr7huu4+4D6s67r7Dh06tOG6bqmLawc4JCKBOILCSvsQkA5jJBKJ2MDAwGMd/JmBgYGPJRKJWKfalZb2yQ4nyXYFKoO2r2jXOzYm1G1CEdlljNlpxceCMASObFvlbgP1er3SaDQKncYajUahXq9Xu9mqammHHaMvWAssAn6HyFEul6PpdNqq6sYHQDZSqZSWy+VYl8D7IrIgIjYIRNDdwAKXaTUtD6RURPB9Pzo/P7+v0WgsHzx4sBQOh/c2m83VdDrdSKfTj/u+H+kC26TV4Dw6WBGxqnpRVbMicrBTdBuNRmRhYWEslUphjHGstfvbh4PTbf2oalZVp4NGNmgZqLU2B5xV1Y6ORQRrrdNsNp16vU6z2XR2Am1H8zcikheRQEUbuEWcnJxERJ4AfiUiR4La7aArIvLCz199dWFpeRljwbcGx7FYIwgQr9V4Lp/ntV5hAZLJZJhWx3QKGOmXUlVzlUrlB6deeeUP9Uol7EHIWIxvjXEc61sjVqARq9U2P1Ner83u/QQjYdtz99QE/gg8A7wMhHsA3OoH7OLCws2pycmh6vr6MceYkAGDQRyjAGpafYKt7Yp67+yNrhl4L+fLYs+PNclkEmBMVX8BfDXo6bOllZWV9JtTU3/KpNMlx3FE2Z7e9jfV9kUArMA9i/61l0MBgPZjyPu0SiHTi+1mtVr655Url5cymTVjjLZBLPc/0rqKWBArolYEUTSO6mDPsG1gHRwcvACcVtXNIDa+73vzc3P//sfVqxkRIVhCRFAVFcmqMYt9wQKMjo76qvpL4Hfs0ItuNeDZ27fn3rpw4R3P82wAUAGMtt47zBg4b6LR230/nszMzBCLxdY8zzupqp8GnukEISKsl8t3Ll28eLlYKGx++D8qILTbA0WwtLJ1C5GbwPJaLFYZaDZ7amQe0PHjx/E8T4FZz/NOWWs3tiK5/dpsNuvXrl27PHfjxp1t6W+lVzGqAqoeUAWWFN5yQqFfK/zla0tLc0Dl8VKJ9K1b/b3k2K5kMkmhUBjavXv3iXA4/D1jTGjbNuUvzM//69wbb1wqlUo1Y4wA0h5vAFVV1gR9X8Qs+rCqgnevWPQTQ0PgOKTS6Qdq4yPr5MmTEo/Hn96zZ89rkUjkC1upXl1dzfz+3Lnzi/PzBeM4Dq19ek1EVoCciCw7odBtlKa1Hn7TVw05xF2X/7z77odL6lHAApw+fZpIJPIN13V/5jjOyL3NzY2L09Pn356efs8JhdYEcqj+VyEfj0bv3KvXayKCEw7zySNHuPD66w+d45HBApw4cSI6PDz8o3g8/p3UrdSlN6eSZyvVasaIFB2R0nIkUh2p1dgViXBjcbFn/x/1ZcUDSiQStWKx+NNQKPTbbDa7tlooFGVlpRYfG0NV+WKhwJ+Lxb79/w9bQvQtKYEySwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMy0wNS0yNVQwMDoyODo1OSswMDowMDPIuVsAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjMtMDUtMjRUMjM6MTA6NTArMDA6MDCv9FszAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAABJRU5ErkJggg==",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABjJJREFUWMO1mE1sFOcZx3//d9beXePixQvCpFSp0qopNGlFKlGn2EhF5VIulSqlUsQhqDduPfClqqdeiEJPPeTApY1UKuVUCcIhaikpBrxRKEmJ7RrMR7CNd8GuP3a9O/bszNPDrhE4Xjy7oY80GmneeZ/nN8/832eed0SLduLECaIoAqCtrU1BEGw2sy5JKSBhZlVJPjCXyWRmZmZmLIoiisUip0+fbilmolXYarVKKpXS0tLSziAIXgf6gR8APUAnUALywGdzc3P/dM4NDgwMDO/du9dajalWJh09ehQz65H0hqQ3gR+ZGdLT7sye4hoEzpjZ+2ZWOHXq1P8X9siRIwCS9DJwDHhDUkfc+WZWBt6Pouht59yoc85OnjwZO36zMhDwbeB3kn7e7HxJHWZ20DnXIek3zrnbQGxZeE1mdZOk48BBSS3pXZKrvxnPzAb7+/v9gYGBWHNdE3E8YB/wVqugT1gCOATsM7PYCYt14/HjxwGykt4BXl69kKC2mMyMMAyJouhxWatncy237UC3c+6Dvr6+cpzsxs2Qk/R9YPdag/VKYNu3b8/v2LHDS6fTmUqlMjcyMhJOTEz0mJkaAL9uZq8CF4mh3ViwZuaA/UByLVAg2rlz538PHDhANpvdQO2Nbdi1a9fCuXPnZoaHh7MNgJNm9lPgElBdN2NxYc1sJ2vIxszIZrPz+/fvL2az2a3AY9hsNru1fn1uVc1dMc/MXqknY12LdZNq1sMaddnM6O7uTvf09GTX8Oe2bdvW3d3dnW4AK0lbG2lktTWzqlMNn9i5RKOAkpLOuWct5HRcgGZK13yjgXK5XKpUKtMNxqYXFxcX1xqrV5BGEmkZNgJuAeGXHDhHPp9P5XK5KIqi4lOToqg4ODhohUIh7dyaoULgZt3/uhZXBhFwBXiTVYtMEkEQpC5evLi1UqmM7969ey6VSm3xff9RLpdbzuVy3wiCoL2BSgJqDc7zhZX0DzN7ALy0elASlUql/dKlS98cHBzEOedFUfRCEASEYeg9Y/08AC6YWSzYuDIwM5sCzjTKgiTCMPR83/fK5TK+73vrgEaS/kyt540l2tgt4rFjxwC+A/wJ6I077xl2VdJbFz788OajmRlcBGHk8LyIyAkBHb5Pfz7Pu/UJsZuIy5cvs2fPngVJ88Ae4GutUprZ1NLS0tvnzp69XikWN0bQJaPLTBnnrNOkTkEyUa3SEUZh9YWv65XNG5vrniQFwFngNTP7taS2FkCjQj4/+kkutynw/V86KeHA4ZDnDMBcTRaRn0xVr29JzToYmgp1K3ZmV7Lb19cXAGOSvgd8iyZ3G8WFhbv//vTTSwvz83LObTRpg6SO2mG1s9kGiU7QRsRmxEshlJqCfQJ4HngE7DGzTTG/liwvLc3dGh39+8T4+ANJSDLVslg/VDtLBjKp1v0Y1oZZoWnYFeB9+/bdq1arDuiPI4coiqqTExNXhoeGblitBYsRScJMJj0wKdfM5/Ypy2QyoZn9UdJfWaf0mBmzs7Mjw8PD18MwjGKACnAGPvCZg/MulZpseXsyOTlJV1fXbLlcfsfMvgu81gjC9/3CzZGRK4vFYnmNRxGIentgiIjaLngMaRQYn02nS11BEL90rbarV6/S29uLmT2MomgR2C8pufL/YOUcVqtLd27fvnBnbOwOPN7i1F4vciCEVUEVYNLEJ4lE4mIURUM/++KL/Fgms7xlcZGR+/dbhwUYGBigr6/PSqXSuOd5m5xzP5TkngAOHxYK14Y///xfQRBU622kq+8aAokFYEpww8l9FEk5k+4vTk8X29Pp6lg2y+1798iXSo+18ZXt0KFD6ujoeDWZTL6bSCR+vCKH4sLC3evXrp0v5PPTkjxqjcuspIfAlKRxL5GYxAiiqEoYhGYJj47OTj6/ceNLcZ4LLMDhw4dxzv0inU7/wTm3bXl5ufifoaHzoyMjQ87zZoEpzCYM8h2pVKGytORLwmtrY3tvL3977711Yzw3WICDBw+mMpnMb5PJ5K8eFgofXfv44zNLy8t3BTOeNDfe3r64zfdJtrczfOtW0/6/6s+KpyyZTPqlUun3nuf9ZW5ufnaxXJ6JJif95IsvYmb8ZHqaD2ZmWvb/PzZaBDRi9tDdAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzoxMTowMCswMDowMAjWPmkAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABixJREFUWMO1mE1sVNcVx3//+549Y2MMDkTMTBHCNgpVmlApi2IagVQ0SFVXlYpSKcoC1BXLrlKp6qLqKoq66gKpqzZSqciGSnXYuEVJIwWjVkIRkAhMBtt82MYej8fz4fHMe/d0MQZR8Mcbhx7p6S3uu+f87rn/d+55T2zTTp8+TbVaxXtPqVRSf3//XmCXpDQQAhHQMLOl2dnZYjabtTiOWVlZYXx8fFsxw+3CLi4ucuTIEd28efP1/v7+Y8Bx4PtABugDqsAs8GUmk/mXmY1PT09/NTg4aNuNqe1MyufzeO8zzrl3gHeBo1vNMbNx4IKkj733c1euXPn/wp48eRLnnIDDwPtm9g7QKyV2Uzezj83sA0m3nXM2NjaWOH5HMjAzmdkhSb8DfiqpUxn1Au9J6pX0a+AbILEsgqQP5vN5gAFJv5L0npmFHWT0qUlykg4DgaTx4eHhRqFQSDTXdRAkkHQSOANsC/QZC4GzwElJiROW6MFTp04RRdEeSR+uZeUFMzPMjCiKiOMY7z1PFrTBwrqBV7z3nwwPD9eTZDep5pxz7oikH2wECtjhw4dnR0ZGgp07d+6uVCpL165di+/cuZMxM60HbGbHgDeBT0mg3USw3nsHnDKz1PNB10D9sWPHFs+dO0cul9tBe8d25PP55fPnzxevXr26Zz1gSSkgD3xO+xDZPGNJMwu8zjqyMTNyuVz57NmzlVwutw94CpvL5fadOXOmks1ml9YW9bwFwBtJORI9pLZl1ttL7z2ZTKZncHBwzzr+3NDQ0CvZbLbHe7+ua2AfCet9J3UyvaGTMAy1wVskKRUEwWYvck9SgMSlCyhvAEO5XK5Wq9WF9cYrlcpCuVyubVLqll4qrJl5M5sws/gFB84xOTmZHh0d9d77yrNj3vvK6OioTU5O9ji3bqgYuAN4EliiOjs0NCRgD/Dj549YSbRarXBiYqKnVqvNZDKZmvc+tbi4OHPx4sXlS5cu5er1emoD2CbwR+B6oVDYsnQlEnY+n5eZDQJjkoY2yD5hGMapVIogCII4juPV1VWiKAo2kUAByEuaHBsb2xI2qWYNmJF0gU22LIqioFarBcvLy9RqtWALUA/8RdIsCZuZxAd8Pp9H0mtm9mdgJOm8TeyqpDOPpqfv1BsNnIfYO4LA450Q0NtocHx2lvNrExI3EYVCgcHBwWVJZeBtYOe3AJ2J4/iDyXv3rvtWq9/DLhm7zLTbOeszqU+QCqOI3tjHUe47emNvf2f9qKQW8Hczewv4paSuTinNzDdWVm7Pz80NEMc/NwgdOBwKXLvHcG1Z+EYqHV1/NV1ycGsm1kTizD7J7tDQUAu4K+l7wDAdSMmAVrN5b7FY/LzVbEpSv0k71prxXsnad7MdEn2gfsRexFAM1Y5gnwAfOnSoDMwDb5vZQNLe1sfxUmVp6Z+1avXR2k6Z2mtYu9S+SwYyqd39GNaF2VzHsE+ADxw4MCnJAceTyMHMolq1+kW5VLph7RYsQSQJM5n0yKRrnRy3/2NdXV2xmf0J+BtblB4zY3V19eulUum6994nABXgDBrAlw4uu3T64bb/GzSbTXp6ekpRFH1oZt8F3toIwsfx3HKp9EXUbNbXWYpArHWQhvCY1YG7SLeB+6WenuquVit56XrepqamOHjwIMBjM6tJOrXWTD/NpiTM+9Xl5eUrlXK5AE8/cdrbixwIYRFoBXho4j9hGH7qvb/1k6mp2bu7dzdfrdX4enp6ez85nrV8Pk+j0Rjo6ur6rXPunKTwKahZ3KjX/73w+PFnURQ11tpIrY03gZoZJWFTkpuIYd5EtFIsxjsGBiAI+OaZb7NvDQswMjKi7u7uN8MwPC/ph0/k0Go27xXn5y+v1OsLtA+gFlCS9Jj28X0/CMOHGC3vI+JWbBYG9Pb1cfPGjRfivBRYgBMnTiDpZ2EY/kFSNo7jSnlx8fJSqXTLOVcCZjB7YDDbm07PrayuNiQRdHWxf2SEf3z00ZYxXhoswNGjR9PpdPo3QRD8olFf+aw4//hCFMf3BMVAWrrf3V3LNhqkurv5amKiY//brgbrWRAEjVar9Xsn99dms1WKvC/6Bw8awf79mBk/Wljgk2Jx2/7/C8D87PcyjeWGAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzoxMTowOSswMDowMJ1Oe7oAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABNVJREFUWMO9l8trXHUUxz/nd+/NPJK5k5kmzbRG2iRWijZmESit0qUbaVb+A0JXLhRclK5EVETcuNCFLQhiF4K4asFVtbT1UZ8JsSbBzjQ1qU3zntQkzCRz7z0u7kRazKSTzI0HDhd+j+/5/n7n/M45V4hGBGgD0kAcsAEPKANLwAKgURhpdP9TwHHgBNAH5IAWYAWYBoaBa8APwGgUpHciOeDVKgmtQ68DrwAd/ydJAQ4DnwCrdRLd0NXqvsM07tW6iB4CvgAq2yS6oRXgc+CJ3SacAT5sgOiDhD+o4u2KWMCLwHKDRDd0uYpn7QbZNuByREQ39FIVty6x61xngGeAo1us0f7+/umBgQErk8m0FovFpYsXL/qDg4M5asfmcaAXuEKEKc0G3qVGrIqIPzAwMFcoFKZUdUVVPVVdyefzUydPnpwDAmrH7jvbuLS6pAm4UMtoT0/P4vDw8Liq+vqw+ENDQ+Pd3d2LNcgGVdymekiYOskKYRHY1J0HDx5M9Pb27tkEz/T19WW7uroSW+B2UGcK2871x2tNOI5ji8imBkUk5jjOVi8+QZ1S780C3K81MT8/v1IsFuc3m1tcXJyfm5tb3QJ3KWqyAZAH/M0mR0dH4+fOnQt8319+cNz3/eWzZ8/q2NhYrdvzgZtV/MjEAk4BJWrkzHQ6vXbmzJlCoVCYnJ2dLRUKhcnTp08XXNddo3aeLVVxIy0MAnQDt7YwrLZte67retlsVl3X9Wzb9ti6KNwCutiFHiEBvE3ouiiqlw+8xTYe2HZP9CTwKXAsgsNfB156PJe7acdimAD8wGBZAYERBEiWy5yYnuaj6obtxsrfhFnhOSDVANF7xpj3Ojs7h+KO4waQFiWtKq3GaIuKtAjEbM8j6Qe+t/8xOdLmyk5iJQm8AbwGODvYHyTj8Wt729sv2JZVRtXWMCtJ6GhVRMLqpngoRQMjYjS/k1dYAQrA00AP2wwlx3Fut2Wz38SamgRwVaRZRJKhavhVbRahBcRFaEPo9mFlpynjPjBHGA51N9DGmKVMOv11qrl5qjqk8tCjk/AroiAqoioioqiD6kwj+e1PQvedoL5w8FqSye/3ZDI3JHRzHSKCqqjIlIr82AhZBf4gzL9HeEQ4xGOxkfZs9lvLstbrYQkYhbLAqIhckXj8bqOVo0yY2I8C+2otsixrZk8mcykRjxc3ObOAiGr1sEKA6iowgsh3AoPFZHI+5nkaRZmbJfzFfh6IbXJFa67rXk6nUuMPNGahexEDgqAeSAm4q8Ivtm1fCYJg5IWJielCa+t6++oqY5OT0ZQ5y7IyQRC8qaov83Db6Sfj8Z/3trVdtW27HHJHVBURWQdWVSkKOiFi8j7MqeCVFhb85kwGLItb4+P/gkXyO2GMWTLGfOx5Xr+qPrsx7tj2ZGs6/att22VVtQjTXlFEZoF7InLHduy7KJUg8JCKr9gWbQcO8PuNG/+xEwnZSqWijuP8Zox53/f9LmCfEVl2U6mfkonETJXgPVT/UphOxGIzpbW1chgQQufxY3x1/vwj7UTa7aRSqXipVHrd9/1TyXjiasfe9s+MMbdRXbBElu40Na3uK5eJNTUxms9vGz9SsolEAlXNVtYr+9NuupjraF+oTEyUNZfDAIeWl/lyYWHH+P8AZ0RW2q2R2psAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjExOjE5KzAwOjAwUeR7JAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]}]},logger$u=LoggerByDefault.getLogger("DrawingDOM"),DrawingDOM={_addUID:function(s){var e=this._uid?s+"-"+this._uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPdrawing"),s.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",s},_createShowDrawingPictoElement:function(){var s=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowDrawingPicto"),e.classList.add("GPshowOpen","GPshowAdvancedToolPicto","GPshowDrawingPicto"),e.classList.add("gpf-btn","gpf-btn--tertiary","gpf-btn-icon","gpf-btn-icon-drawing"),e.classList.add("fr-btn","fr-btn--tertiary"),e.setAttribute("aria-label",this.options.labels.control),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowDrawingClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowDrawingClick(n)}),e},_createDrawingPanelElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPdrawingPanel"),s.className="GPpanel gpf-panel fr-modal",s},_createDrawingPanelDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__body fr-modal__body",s},_createDrawingToolsDivSections:function(){var s=document.createElement("div");return s.className="gpf-panel__content fr-px-3w fr-modal__content",s},_createDrawingButtonsPluginDiv:function(){var s=document.createElement("div");return s.className="container-buttons-plugin fr-mx-2w",s},_createDrawingPanelHeaderElement:function(){var s=document.createElement("div");s.className="GPpanelHeader gpf-panel__header fr-modal__header fr-m-1w";var e=document.createElement("div");e.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",e.innerHTML=this.options.controlLabel||"Annoter la carte",s.appendChild(e);var i=document.createElement("button");i.id=this._addUID("GPdrawingPanelClose"),i.className="GPpanelClose GPdrawingPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",i.title="Fermer le panneau";var n=this;i.addEventListener?i.addEventListener("click",function(){document.getElementById(n._addUID("GPshowDrawingPicto")).click()},!1):i.attachEvent&&i.attachEvent("onclick",function(){document.getElementById(n._addUID("GPshowDrawingPicto")).click()});var o=document.createElement("span");return o.className="GPelementHidden gpf-visible",o.innerText="Fermer",i.appendChild(o),s.appendChild(i),s},_createDrawingToolsSections:function(){var s=[];return this.dtOptions={},this.options.tools.points&&(this.dtOptions.points={label:this.options.labels.points,active:!1,panel:"draw",id:"point"}),this.options.tools.lines&&(this.dtOptions.lines={label:this.options.labels.lines,active:!1,panel:"draw",id:"line"}),this.options.tools.polygons&&(this.dtOptions.polygons={label:this.options.labels.polygons,active:!1,panel:"draw",id:"polygon"}),this.options.tools.holes&&(this.dtOptions.holes={label:this.options.labels.holes,active:!1,panel:"draw",id:"holes"}),this.options.tools.text&&(this.dtOptions.text={label:this.options.labels.text,active:!1,panel:"draw",id:"text"}),this.options.tools.edit&&(this.dtOptions.edit={label:this.options.labels.edit,active:!1,panel:"edit",id:"edit"}),this.options.tools.display&&(this.dtOptions.display={label:this.options.labels.display,active:!1,panel:"edit",id:"display"}),this.options.tools.tooltip&&(this.dtOptions.tooltip={label:this.options.labels.tooltip,active:!1,panel:"edit",id:"tooltip"}),this.options.tools.remove&&(this.dtOptions.remove={label:this.options.labels.remove,active:!1,panel:"edit",id:"remove"}),(this.dtOptions.points||this.dtOptions.lines||this.dtOptions.polygons||this.dtOptions.text)&&s.push(this._createDrawingToolSection(this.options.labels.creatingTools,"draw")),(this.dtOptions.edit||this.dtOptions.display||this.dtOptions.tooltip||this.dtOptions.remove)&&s.push(this._createDrawingToolSection(this.options.labels.editingTools,"edit")),this.options.tools.export&&s.push(this._createSavingSection(this.options.labels.export,this.options.labels.exportTitle)),s},_createDrawingToolSection:function(s,e){var i=document.createElement("div");i.className="drawing-tool-section fr-mx-2w";var n=document.createElement("p");n.className="drawing-tool-section-title",n.innerHTML=s,i.appendChild(n);var o=document.createElement("div");o.className="drawing-tools-flex-display";var l=this;function c(f){l._handleDOMToolClick(f,this.id,l),l._handleToolClick(f,this.id,l)}for(var u in this.dtOptions)if(this.dtOptions[u].panel===e){var h=document.createElement("button");h.className="drawing-tool fr-btn fr-btn--tertiary gpf-btn--tertiary",h.id=this._addUID("drawing-tool-"+this.dtOptions[u].id),h.title=this.dtOptions[u].label,h.addEventListener("click",c),o.appendChild(h)}return i.appendChild(o),i},_createSavingSection:function(s,e){var i=document.createElement("div");i.className="drawing-tool-section drawing-tools-flex-display fr-m-1w";var n=document.createElement("button");n.title=e,n.className="tool-form-submit drawing-button fr-btn fr-btn--secondary gpf-btn--secondary fr-m-1w",n.id=this._addUID("drawing-export"),n.setAttribute("type","button"),n.textContent=s;var o=this;return n.onclick=function(){o.onExportFeatureClick()},i.appendChild(n),i},_createMarkersChooser:function(s){var e=document.createElement("div");e.className=s.className;var i=document.createElement("input");i.type="checkbox",i.className="gpf-custom-dropdown-toggle",i.id=this._addUID("gpf-custom-dropdown-toggle"),e.appendChild(i);var n=document.createElement("span");n.innerText="Slectionner le pictogramme :",e.appendChild(n);for(var o=0;o<this.options.markersList.length;o++){var l=document.createElement("input");l.type="radio",l.name="gpf-dropdown-radio-style",l.value=this.options.markersList[o].src,l.className="gpf-custom-dropdown-display",l.id=this._addUID(`gpf-custom-dropdown-display-${o}`),e.appendChild(l),o===0&&(l.checked=!0);var c=document.createElement("label");c.htmlFor=this._addUID("gpf-custom-dropdown-toggle"),c.className="fr-select GPselect gpf-select",e.appendChild(c);var u=document.createElement("img");u.src=this.options.markersList[o].src,u.alt=`Option ${o+1}`,c.appendChild(u)}var h=document.createElement("div");h.className="gpf-custom-dropdown-options",e.append(h);for(var o=0;o<this.options.markersList.length;o++){var f=document.createElement("label");f.htmlFor=this._addUID(`gpf-custom-dropdown-display-${o}`),f.className="gpf-custom-dropdown-option",h.appendChild(f);var g=document.createElement("img");g.src=this.options.markersList[o].src,g.alt=`Option ${o+1}`,f.appendChild(g),f.addEventListener("click",()=>{i.click()})}return e},_createStylingElement:function(s){var e=document.createElement("div");e.className=s.className;var i=document.createTextNode(s.label);e.appendChild(i);var n=document.createElement("input");try{n.type=s.type}catch{n.type="text"}if(s.type==="range"){e.dataset.frJsRange="true",e.title=s.label;var o=s.defaultValue;o=Math.round((o-s.min)/(s.max-s.min)*100),e.style.setProperty("--progress-right",o+"%"),n.addEventListener("change",l=>{l.target.parentNode.style.setProperty("--progress-right",`${(l.target.value-s.min)/(s.max-s.min)*100}%`)})}return n.id=s.id,n.value=s.defaultValue,s.title&&(n.title=s.title),s.checked!==void 0&&(n.checked=s.checked),s.min!==void 0&&(n.min=s.min),s.max!==void 0&&(n.max=s.max),s.step!==void 0&&(n.step=s.step),e.appendChild(n),e},_createStylingDiv:function(s){var e=document.createElement("dialog");e.className="gp-styling-div gpf-panel fr-modal gpf-visible GPelementVisible";var i=document.createElement("div");if(i.className="gpf-modal__body fr-modal__body",e.appendChild(i),checkDsfr()){var n=document.createElement("div");n.className="GPpanelHeader gpf-panel__header fr-modal__header fr-m-1w";var o=document.createElement("div");o.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",o.innerHTML="Modifier le style",n.appendChild(o);var l=document.createElement("button");l.id=this._addUID("GPdrawingStylePanelClose"),l.className="GPpanelClose GPdrawingStylePanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",l.title="Fermer le panneau",l.addEventListener?l.addEventListener("click",function(){s.applyFunc.call(this,"cancel")},!1):l.attachEvent&&l.attachEvent("onclick",function(){s.applyFunc.call(this,"cancel")});var c=document.createElement("span");c.className="GPelementHidden gpf-visible",c.innerText="Fermer",l.appendChild(c),n.appendChild(l),i.appendChild(n)}var u=document.createElement("div");u.className="gpf-panel__content fr-px-3w fr-modal__content",i.appendChild(u);var h=document.createElement("div"),f=null,g=s.geomType.toLowerCase();switch(g){case"point&text":case"point":f=this._createMarkersChooser({className:"gp-styling-option",defaultValue:s.initValues.markerSrc}),h.appendChild(f),f=this._createStylingElement({type:"range",className:"gp-styling-option fr-range fr-range--sm",label:this.options.labels.markerSize,title:"petit, moyen ou grand",id:this._addUID("markerSize"),min:5,max:15,step:5,defaultValue:s.initValues.markerSize*10}),h.appendChild(f),s.initValues.markerCustom,g==="point&text"&&(f=this._createStylingElement({type:"checkbox",className:"gp-styling-option",label:this.options.labels.labelDisplay,id:this._addUID("labelDisplay"),checked:s.initValues.labelDisplay,defaultValue:s.initValues.labelDisplay}),h.appendChild(f));break;case"text":f=this._createStylingElement({type:"color",className:"gp-styling-option",label:this.options.labels.fillColor,id:this._addUID("fillColor"),defaultValue:s.initValues.fillColor}),h.appendChild(f),f=this._createStylingElement({type:"color",className:"gp-styling-option",label:this.options.labels.strokeColor,id:this._addUID("strokeColor"),defaultValue:s.initValues.strokeColor}),h.appendChild(f),f=this._createStylingElement({type:"range",className:"gp-styling-option",label:this.options.labels.strokeWidth,title:"1  10 pixels",id:this._addUID("strokeWidth"),min:1,max:10,step:1,defaultValue:s.initValues.strokeWidth}),h.appendChild(f);break;case"line":f=this._createStylingElement({type:"color",className:"gp-styling-option",label:this.options.labels.strokeColor,id:this._addUID("strokeColor"),defaultValue:s.initValues.strokeColor}),h.appendChild(f),f=this._createStylingElement({type:"range",className:"gp-styling-option fr-range fr-range--sm",label:this.options.labels.strokeWidth,title:"1  10 pixels",id:this._addUID("strokeWidth"),min:1,max:10,step:1,defaultValue:s.initValues.strokeWidth}),h.appendChild(f);break;case"polygon":f=this._createStylingElement({type:"color",className:"gp-styling-option",label:this.options.labels.strokeColor,id:this._addUID("strokeColor"),defaultValue:s.initValues.strokeColor}),h.appendChild(f),f=this._createStylingElement({type:"range",className:"gp-styling-option fr-range fr-range--sm",label:this.options.labels.strokeWidth,title:"1  10 pixels",id:this._addUID("strokeWidth"),min:1,max:10,step:1,defaultValue:s.initValues.strokeWidth}),h.appendChild(f),f=this._createStylingElement({type:"color",className:"gp-styling-option",label:this.options.labels.fillColor,id:this._addUID("fillColor"),defaultValue:s.initValues.fillColor}),h.appendChild(f),f=this._createStylingElement({type:"range",className:"gp-styling-option fr-range fr-range--sm",label:this.options.labels.fillOpacity,title:"0 (transparent)  100% (opaque)",id:this._addUID("fillOpacity"),min:0,max:10,step:1,defaultValue:s.initValues.fillOpacity*10}),h.appendChild(f);break;default:logger$u.log("Unhandled geometry type for styling.")}u.appendChild(h);var H=document.createElement("div");H.className="gpf-flex-row",u.appendChild(H);var Y=document.createElement("input");Y.type="button",Y.className="gp-styling-button fr-btn fr-btn--secondary",Y.value=this.options.labels.applyToObject,Y.onclick=function(){s.applyFunc.call(this,"apply")};var ee=document.createElement("input");ee.type="button",ee.value=this.options.labels.setAsDefault,ee.className="gp-styling-button fr-btn fr-btn--tertiary",ee.onclick=function(){s.applyFunc.call(this,"default")},H.appendChild(ee),H.appendChild(Y);var te=document.createElement("input");return te.type="button",te.className="gp-styling-button closer",te.onclick=function(){s.applyFunc.call(this,"cancel")},u.appendChild(te),e},_createLabelDiv:function(s){var e=document.createElement("dialog");e.className="gp-label-div gpf-panel fr-modal gpf-visible GPelementVisible";var i=document.createElement("div");if(i.className="gpf-modal__body fr-modal__body",e.appendChild(i),checkDsfr()){var n=document.createElement("div");n.className="GPpanelHeader gpf-panel__header fr-modal__header fr-m-1w";var o=document.createElement("div");o.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",o.innerHTML="Ajouter une description",s.geomType==="Text"&&(o.innerHTML="Texte de l'annotation"),n.appendChild(o);var l=document.createElement("button");l.id=this._addUID("GPdrawingStylePanelClose"),l.className="GPpanelClose GPdrawingStylePanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",l.title="Fermer le panneau",l.addEventListener?l.addEventListener("click",function(){s.applyFunc.call(this,"cancel")},!1):l.attachEvent&&l.attachEvent("onclick",function(){s.applyFunc.call(this,"cancel")});var c=document.createElement("span");c.className="GPelementHidden gpf-visible",c.innerText="Fermer",l.appendChild(c),n.appendChild(l),i.appendChild(n)}var u=document.createElement("div");u.className="gpf-panel__content fr-px-3w fr-modal__content",i.appendChild(u);var h=null;if(s.geomType==="Text"?(h=document.createElement("input"),h.type="text",h.className="gp-input-label-style fr-input fr-mb-3w"):(h=document.createElement("textArea"),h.rows=2,h.cols=40,h.className="gp-textarea-att-label-style fr-input"),s.text&&(h.value=s.text),h.autocomplete="off",h.placeholder=s.placeholder,h.id=s.inputId,u.appendChild(h),h.onkeyup=function(Y){s.geomType==="Text"&&Y.keyCode===13&&s.applyFunc.call(this,s.key,h.value,!0),Y.keyCode===27&&s.applyFunc.call(this,s.key,h.value,!1)},s.measure&&s.geomType!=="Text"){var f=document.createElement("input");f.type="text",f.readonly=!0,f.className="gp-input-measure-style",f.value=s.measure,u.appendChild(f)}var g=document.createElement("input");g.type="button",g.className="gp-styling-button fr-btn fr-btn--tertiary",g.value=this.options.labels.saveDescription,g.onclick=function(){s.applyFunc.call(this,s.key,h.value,!0)},u.appendChild(g);var H=document.createElement("input");return H.type="button",H.className="gp-styling-button closer",H.onclick=function(){s.applyFunc.call(this,s.key,h.value,!1)},u.appendChild(H),e},_handleDOMToolClick:function(s,e,i){for(var n in i.dtOptions){var o=i._addUID("drawing-tool-"+i.dtOptions[n].id),l=document.getElementById(o);if(o!==e){l.className="drawing-tool fr-btn fr-btn--tertiary gpf-btn--tertiary",i.dtOptions[n].active=!1;continue}i.dtOptions[n].active?l.className="drawing-tool fr-btn fr-btn--tertiary gpf-btn--tertiary":l.className="drawing-tool drawing-tool-active fr-btn fr-btn--tertiary gpf-btn--tertiary",i.dtOptions[n].active=!i.dtOptions[n].active}}},logger$t=LoggerByDefault.getLogger("Drawing");const yi=class yi extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof yi))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="Drawing",this._initialize(e),this._container=this._initContainer(),this.element?this.element.appendChild(this._container):this.element=this._container,this}setMap(e){super.setMap(e),this.getMap()&&this.eventKey&&unByKey(this.eventKey),e!=null&&(this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter"),this.draggable&&Draggable.dragElement(this._drawingPanel,this._drawingPanelHeader,e.getTargetElement()),this.collapsed||this._showDrawingButton.setAttribute("aria-pressed",!0),this.layer&&this.setLayer(this.layer),this.eventKey=this.getMap().getLayers().on("remove",i=>{i.element===this.layer&&(this.layer=null,this.interactionCurrent&&(this.getMap().removeInteraction(this.interactionCurrent),this.interactionCurrent=null))}))}exportFeatures(){var e=null;if(ControlExtended.prototype.getMap.call(this)==null)return logger$t.log("Impossible to export : control isn't attached to any map."),e;if(!this.layer)return logger$t.log("Impossible to export : no layer is hosting features."),e;if(!this.layer.getSource()||!this.layer.getSource().getFeatures()||!this.layer.getSource().getFeatures().length)return logger$t.log("Impossible to export : no features found."),e;this.featuresCollectionSelected&&this.featuresCollectionSelected.clear();var i=null;switch(this.getExportFormat()){case"KML":i=new KML({writeStyles:!0});break;case"GPX":i=new GPX({});break;case"GEOJSON":i=new GeoJSON({});break}if(!i)return logger$t.log("Impossible to export : format unknown !?"),e;var n=this.layer.getSource().getProjection();return n=n||this.getMap().getView().getProjection(),e=i.writeFeatures(this.layer.getSource().getFeatures(),{dataProjection:"EPSG:4326",featureProjection:n}),e}setCollapsed(e){if(e===void 0){logger$t.error("[ERROR] Drawing:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(this.onShowDrawingClick(),this._showDrawingButton.click())}setExportName(e){this._exportName=e}getExportName(){return this._exportName}setExportFormat(e){switch(this._exportFormat=e?e.toUpperCase():"KML",e.toUpperCase()){case"KML":this._exportExt=".kml",this._exportMimeType="application/vnd.google-earth.kml+xml";break;case"GPX":this._exportExt=".gpx",this._exportMimeType="application/gpx+xml";break;case"GEOJSON":this._exportExt=".geojson",this._exportMimeType="application/geo+json";break;default:this._exportFormat="KML";break}}getExportFormat(){return this._exportFormat}setLayer(e){if(!e){this.layer=null;return}if(!(e instanceof VectorLayer)){logger$t.log("no valid layer given for hosting drawn features.");return}var i=this.getMap().getLayers();if(i){var n=!1;i.forEach(o=>{o===e&&(logger$t.trace("layer already in map. Not adding."),n=!0)}),n||(this.getMap().addLayer(e),this.dispatchEvent({type:this.ADD_AFTER_DRAWING_LAYER_EVENT,layer:e})),e.getSource().getFeatures().forEach(o=>{var l=o.getStyle();if(typeof l=="function"){var c=o.getStyleFunction();if(c){var u=c.call(this,o,0);u&&u.length!==0&&o.setStyle(Array.isArray(u)?u[0]:u)}}}),this.layer=e,this.getMap().getControls().forEach(o=>{if(o instanceof LayerSwitcher){var l=this.layer.gpLayerId;l&&o._layers[l].title===l&&o.addLayer(this.layer,{title:this.options.layerDescription.title,description:this.options.layerDescription.description})}})}}getLayer(){return this.layer}getContainer(){return this._container}disable(){var e=this.getMap();Interactions.unset(e);for(var i in this.dtOptions)if(this.dtOptions.hasOwnProperty(i)&&this.dtOptions[i].active){var n=this._addUID("drawing-tool-"+this.dtOptions[i].id);document.getElementById(n).className="drawing-tool fr-btn fr-btn--tertiary gpf-btn--tertiary",this.dtOptions[i].active=!1}}_getsMarkersOptionsFromSrc(e){for(var i=null,n=0;n<this.options.markersList.length;n++)if(e&&this.options.markersList[n].src===e)return i=this.options.markersList[n],i;return i}_getIconStyleOptions(e){var i={};return Object.keys(e).forEach(n=>{switch(n){case"src":case"size":case"scale":case"color":case"anchor":case"anchorOrigin":case"anchorXUnits":case"anchorYUnits":i[n]=e[n];break}}),i}_initialize(e){this._uid=e.id||SelectorID.generate(),this._exportName="Croquis",this._exportFormat="KML",this._exportMimeType="application/vnd.google-earth.kml+xml",this._exportExt=".kml",e=e||{},this.options=e,this.options.layerDescription=Object.assign({title:"Croquis",description:"Mon croquis"},e.layerDescription),this.options.tools||(this.options.tools={}),Object.keys(yi.DefaultTools).forEach(i=>{this.options.tools.hasOwnProperty(i)||(this.options.tools[i]=yi.DefaultTools[i])}),this.options.cursorStyle||(this.options.cursorStyle={}),Object.keys(yi.DefaultCursorStyle).forEach(i=>{this.options.cursorStyle.hasOwnProperty(i)||(this.options.cursorStyle[i]=yi.DefaultCursorStyle[i])}),this.options.collapsed=e.collapsed!==void 0?e.collapsed:!0,this.collapsed=this.options.collapsed,this.options.draggable=e.draggable!==void 0?e.draggable:!1,this.draggable=this.options.draggable,this.options.markersList=e.markersList||MarkersOther.drawing_api,this.options.labels||(this.options.labels={}),Object.keys(yi.DefaultLabels).forEach(i=>{this.options.labels.hasOwnProperty(i)||(this.options.labels[i]=yi.DefaultLabels[i])}),this.options.defaultStyles||(this.options.defaultStyles={}),Object.keys(yi.DefaultStyles).forEach(i=>{if(!e.defaultStyles.hasOwnProperty(i)){this.options.defaultStyles[i]=yi.DefaultStyles[i];return}if(i==="polyFillOpacity"&&(e.defaultStyles[i]<0||e.defaultStyles[i]>1)){logger$t.log("Wrong value ("+e.defaultStyles[i]+") for defaultStyles.polyFillOpactity. Must be between 0 and 1"),this.options.defaultStyles[i]=yi.DefaultStyles[i];return}if(i==="strokeWidth"||i==="polyStrokeWidth"){var n=parseInt(e.defaultStyles[i],10);if(isNaN(n)||n<0){logger$t.log("Wrong value ("+e.defaultStyles[i]+") for defaultStyles.strokeWidth. Must be a positive interger value."),this.options.defaultStyles[i]=yi.DefaultStyles[i];return}this.options.defaultStyles[i]=n}if(i==="markerSize"){var o=parseFloat(e.defaultStyles[i]);if(isNaN(o)||o<0){logger$t.log("Wrong value ("+e.defaultStyles[i]+") for defaultStyles.markerSize. Must be a positive value."),this.options.defaultStyles[i]=yi.DefaultStyles[i];return}this.options.defaultStyles[i]=o}}),this.interactionCurrent=null,this.interactionSelectEdit=null,this.featuresCollectionSelected=null,this.stylingOvl=null,this.popupOvl=null,this.tooltipOvl=null,this.tooltipElem=null,this.layer=null,this.options.layer&&this.options.layer instanceof VectorLayer&&(this.layer=this.options.layer),this._isDesktop=this._detectSupport(),this.options.popup||(this.options.popup={display:!0,apply:null}),this.ADD_AFTER_DRAWING_LAYER_EVENT="drawing:add:after",this.ADD_BEFORE_DRAWING_LAYER_EVENT="drawing:add:before"}_createEmptyLayer(){var e=new Collection,i=new VectorLayer({source:new VectorSource({features:e}),title:this.options.layerDescription.title,description:this.options.layerDescription.description});i.gpResultLayerId="drawing",this.dispatchEvent({type:this.ADD_BEFORE_DRAWING_LAYER_EVENT,layer:i}),this.setLayer(i)}_detectSupport(){var e=!0,i=window.navigator.userAgent.toLowerCase();return(i.indexOf("iphone")!==-1||i.indexOf("ipod")!==-1||i.indexOf("ipad")!==-1||i.indexOf("android")!==-1||i.indexOf("mobile")!==-1||i.indexOf("blackberry")!==-1||i.indexOf("tablet")!==-1||i.indexOf("phone")!==-1||i.indexOf("touch")!==-1)&&(e=!1),(i.indexOf("msie")!==-1||i.indexOf("trident")!==-1)&&(e=!0),e}_initContainer(){var e=this._createMainContainerElement(),i=this._showDrawingButton=this._createShowDrawingPictoElement();e.appendChild(i);var n=this._drawingPanel=this._createDrawingPanelElement(),o=this._createDrawingPanelDivElement();n.appendChild(o);var l=this._drawingPanelHeader=this._createDrawingPanelHeaderElement();o.appendChild(l);var c=this._createDrawingToolsDivSections();o.appendChild(c);for(var u=this._createDrawingToolsSections(),h=0;h<u.length;h++)c.appendChild(u[h]);var f=this._createDrawingButtonsPluginDiv();return c.appendChild(f),e.appendChild(n),e}_drawEndFeature(e,i){var n=null;switch(i){case"Point":n=new Style$1({image:new Icon(this._getIconStyleOptions(this.options.markersList[0]))});break;case"LineString":n=new Style$1({stroke:new Stroke({color:this.options.defaultStyles.strokeColor,width:this.options.defaultStyles.strokeWidth})});break;case"Polygon":n=new Style$1({fill:new Fill({color:ColorUtils.hexToRgba(this.options.defaultStyles.polyFillColor,this.options.defaultStyles.polyFillOpacity)}),stroke:new Stroke({color:this.options.defaultStyles.polyStrokeColor,width:this.options.defaultStyles.polyStrokeWidth})});break}if(e.setStyle(n),this._updateMeasure(e,i),this.options.popup.display){var o=this,l=function(g,H,Y){if(o.getMap().removeOverlay(o.popupOvl),o.popupOvl=null,Y&&H&&H.trim().length>0){var ee={};ee[g]=H.replace(/\n/g,"<br>"),e.setProperties(ee)}},c=null,u=!0,h=this.options.popup.function;h&&typeof h=="function"&&(c=h.call(o,{feature:e,geomType:i,closeFunc:function(){l(null,!1)},saveFunc:function(g){l(g,!0)}}),c&&(u=!1,c.tabIndex=-1,c.onblur=function(){o.getMap().removeOverlay(o.popupOvl),o.popupOvl=null})),u&&(c=this._createLabelDiv({applyFunc:l,inputId:this._addUID("att-input"),placeholder:"Saisir une description... (facultatif)",measure:this.options.tools.measure?e.getProperties().measure:null,geomType:i,key:"description"})),this.popupOvl&&(this.getMap().removeOverlay(this.popupOvl),this.popupOvl=null),this.popupOvl=new Overlay({element:c,positioning:"top-center"}),this.getMap().addOverlay(this.popupOvl);var f=e.getGeometry().getExtent();this.popupOvl.setPosition([(f[0]+f[2])/2,(f[1]+f[3])/2]),document.getElementById(this._addUID("att-input"))&&document.getElementById(this._addUID("att-input")).focus()}}_createRemoveInteraction(){var e=new Select({layers:[this.layer],style:!1});return e.on("select",i=>{!i||!i.selected||i.selected.length===0||(this.layer.getSource().removeFeature(i.selected[0]),this.getMap().removeInteraction(this.interactionCurrent),this.interactionCurrent=this._createRemoveInteraction(),this.getMap().addInteraction(this.interactionCurrent))}),e}_createStylingInteraction(){var e=new Select({layers:[this.layer],style:!1});return e.on("select",i=>{if(this.stylingOvl&&this.getMap().removeOverlay(this.stylingOvl),!(!i||!i.selected||i.selected.length===0)){var n=null,o=null,l=null,c=null,u={},h=i.selected[0].getGeometry(),f=i.selected[0].getStyle();if(h instanceof Point$1||h instanceof MultiPoint){if(f&&f.getImage()&&typeof f.getImage().getSrc=="function"&&f.getImage().getSrc()!==this.options.defaultStyles.textIcon1x1.src&&(c="Point",typeof f.getImage().getSrc=="function"?(u.markerSrc=f.getImage().getSrc(),u.markerSize=f.getImage().getScale()||1,u.markerAnchor=f.getImage().getAnchor(),f.getImage().getColor()?(n=f.getImage().getColor(),Array.isArray(n)?n="rgba("+n.join()+")":u.markerColor=n,o=ColorUtils.isRGB(n)?ColorUtils.rgbaToHex(n):{hex:n,opacity:1},u.markerColor=o.hex,u.markerOpacity=o.opacity):u.markerColor=this.options.markersList[0].color||"#ffffff"):(u.markerSrc=this.options.markersList[0].src,u.markerSize=this.options.markersList[0].scale||1,u.markerColor=this.options.markersList[0].color||"#ffffff",u.markerAnchor=this.options.markersList[0].anchor),u.markerCustom=!this._getsMarkersOptionsFromSrc(u.markerSrc)),f&&f.getText()){var g=i.selected[0].getProperties().name;if(g&&(c=c==="Point"?"Point&Text":"Text",f.getText().getStroke()&&f.getText().getStroke().getColor()&&(n=f.getText().getStroke().getColor(),Array.isArray(n)?n="rgba("+n.join()+")":u.strokeColor=n,o=ColorUtils.isRGB(n)?ColorUtils.rgbaToHex(n):{hex:n,opacity:1},u.strokeColor=o.hex,u.strokeOpacity=o.opacity),f.getText().getStroke()&&f.getText().getStroke().getWidth()&&(u.strokeWidth=f.getText().getStroke().getWidth()),f.getText().getFill()&&f.getText().getFill().getColor()&&(n=f.getText().getFill().getColor(),Array.isArray(n)?n="rgba("+n.join()+")":u.fillColor=n,o=ColorUtils.isRGB(n)?ColorUtils.rgbaToHex(n):{hex:n,opacity:1},u.fillColor=o.hex,u.fillOpacity=o.opacity),u.strokeColor=u.hasOwnProperty("strokeColor")?u.strokeColor:this.options.defaultStyles.textStrokeColor,u.strokeWidth=u.hasOwnProperty("strokeWidth")?u.strokeWidth:this.options.defaultStyles.textStrokeWidth,u.fillColor=u.hasOwnProperty("fillColor")?u.fillColor:this.options.defaultStyles.textFillColor,c==="Point&Text")){var H=f.getText().getText();H||f.getText().setText(g);var Y=i.selected[0].get("checked");u.labelDisplay=Y===void 0?this.options.defaultStyles.labelDisplay:Y}}}else h instanceof LineString||h instanceof MultiLineString?(c="Line",f&&f.getStroke()&&(f.getStroke().getWidth()&&(u.strokeWidth=f.getStroke().getWidth()),f.getStroke().getColor()&&(n=f.getStroke().getColor(),Array.isArray(n)?n="rgba("+n.join()+")":u.strokeColor=n,o=ColorUtils.isRGB(n)?ColorUtils.rgbaToHex(n):{hex:n,opacity:1},u.strokeColor=o.hex,u.strokeOpacity=o.opacity)),u.strokeWidth=u.hasOwnProperty("strokeWidth")?u.strokeWidth:this.options.defaultStyles.strokeWidth,u.strokeColor=u.hasOwnProperty("strokeColor")?u.strokeColor:this.options.defaultStyles.strokeColor):(h instanceof Polygon||h instanceof MultiPolygon)&&(c="Polygon",f&&f.getStroke()&&(f.getStroke().getWidth()&&(u.strokeWidth=f.getStroke().getWidth()),f.getStroke().getColor()&&(n=f.getStroke().getColor(),Array.isArray(n)?n="rgba("+n.join()+")":u.strokeColor=n,o=ColorUtils.isRGB(n)?ColorUtils.rgbaToHex(n):{hex:n,opacity:1},u.strokeColor=o.hex,u.strokeOpacity=o.opacity)),f&&f.getFill()&&f.getFill().getColor()&&(n=f.getFill().getColor(),Array.isArray(n)?n="rgba("+n.join()+")":u.fillColor=n,o=ColorUtils.isRGB(n)?ColorUtils.rgbaToHex(n):{hex:n,opacity:1},u.fillColor=o.hex,u.fillOpacity=o.opacity),u.strokeWidth=u.hasOwnProperty("strokeWidth")?u.strokeWidth:this.options.defaultStyles.polyStrokeWidth,u.strokeColor=u.hasOwnProperty("strokeColor")?u.strokeColor:this.options.defaultStyles.polyStrokeColor,u.fillColor=u.hasOwnProperty("fillColor")?u.fillColor:this.options.defaultStyles.polyFillColor,u.fillOpacity=u.hasOwnProperty("fillOpacity")?u.fillOpacity:this.options.defaultStyles.polyFillOpacity);if(!c){logger$t.log("Unhandled geometry type for styling.");return}var ee=this,te=function(ne){if(ne==="cancel"){ee.getMap().removeOverlay(l);return}var et=ne!=="apply",tt=document.getElementById(ee._addUID("fillColor")),it=document.getElementById(ee._addUID("fillOpacity")),rt=document.getElementById(ee._addUID("strokeColor")),nt=document.getElementById(ee._addUID("strokeWidth")),st=document.getElementById(ee._addUID("markerSize"));switch(c.toLowerCase()){case"text":et?(ee.options.defaultStyles.textStrokeColor=rt.value,ee.options.defaultStyles.textStrokeWidth=nt.value,ee.options.defaultStyles.textFillColor=tt.value):i.selected[0].setStyle(new Style$1({text:new Text({font:"16px sans",textAlign:"left",text:f.getText().getText(),fill:new Fill({color:tt.value}),stroke:new Stroke({color:rt.value,width:parseInt(nt.value,10)})})}));break;case"point&text":case"point":var at=document.querySelector("input[type='checkbox']"),ot=null,ct=parseInt(st.value,10)/10,ht=document.querySelector("input[name='gpf-dropdown-radio-style']:checked");if(ht&&(ot=ee._getsMarkersOptionsFromSrc(ht.value),ot.scale=ct),et){if(ee.options.defaultStyles.markerSize=ct,ee.options.markersList.length>1){var ut=ee.options.markersList.findIndex(function(mt){return mt===ot});ut>0&&(ee.options.markersList.splice(ut,1),ee.options.markersList.splice(0,0,ot))}c.toLowerCase()==="point&text"&&(ee.options.defaultStyles.textStrokeColor=u.strokeColor,ee.options.defaultStyles.textStrokeWidth=u.strokeWidth,ee.options.defaultStyles.textFillColor=u.fillColor,ee.options.defaultStyles.labelDisplay=u.labelDisplay)}else{var pt={};c.toLowerCase()==="point&text"&&(i.selected[0].set("checked",at.checked),pt={text:new Text({font:"16px sans",textAlign:"left",text:at.checked?i.selected[0].get("name"):"",fill:new Fill({color:u.fillColor}),stroke:new Stroke({color:u.strokeColor,width:parseInt(u.strokeWidth,10)})})}),ot?i.selected[0].setStyle(new Style$1(Object.assign({image:new Icon(ee._getIconStyleOptions(ot))},pt))):i.selected[0].setStyle(new Style$1(Object.assign({image:new Icon({src:u.markerSrc,anchor:u.markerAnchor,anchorOrigin:"top-left",anchorXUnits:"pixels",anchorYUnits:"pixels",scale:ct})},pt)))}break;case"line":et?(ee.options.defaultStyles.strokeColor=rt.value,ee.options.defaultStyles.strokeWidth=parseInt(nt.value,10)):i.selected[0].setStyle(new Style$1({stroke:new Stroke({width:parseInt(nt.value,10),color:rt.value})}));break;case"polygon":var yt=parseInt(it.value,10)/10;et?(ee.options.defaultStyles.polyStrokeColor=rt.value,ee.options.defaultStyles.polyFillColor=tt.value,ee.options.defaultStyles.polyFillOpacity=yt,ee.options.defaultStyles.polyStrokeWidth=parseInt(nt.value,10)):i.selected[0].setStyle(new Style$1({stroke:new Stroke({width:parseInt(nt.value,10),color:rt.value}),fill:new Fill({color:ColorUtils.hexToRgba(tt.value,yt)})}));break}et||ee.getMap().removeOverlay(l)},xe=this._createStylingDiv({geomType:c,initValues:u,applyFunc:te});l=new Overlay({element:xe,positioning:"top-center"}),this.getMap().addOverlay(l),l.setPosition(i.mapBrowserEvent.coordinate),this.stylingOvl=l,this.getMap().removeInteraction(this.interactionCurrent),this.interactionCurrent=this._createStylingInteraction(),this.getMap().addInteraction(this.interactionCurrent)}}),e}_createLabelInteraction(){var e=new Select({layers:[this.layer],style:!1});return e.on("select",i=>{if(this.labelOvl&&this.getMap().removeOverlay(this.labelOvl),!(!i||!i.selected||i.selected.length===0)){var n=null,o=null,l=null,c=null,u=i.selected[0].getGeometry(),h=i.selected[0].getStyle();if(u instanceof Point$1||u instanceof MultiPoint){var f=i.selected[0].getProperties().name;h&&h.getText()&&f?o="Text":h&&h.getImage()&&(o="Point")}else if(u instanceof LineString||u instanceof MultiLineString)o="Line";else if(u instanceof Polygon||u instanceof MultiPolygon)o="Polygon";else{logger$t.log("Geometry type for styling not supported .");return}if(!o){logger$t.log("Unhandled geometry type for styling.");return}if(o==="Text")l=h.getText().getText();else{var g=i.selected[0].getProperties();g&&(g.hasOwnProperty("description")||g.hasOwnProperty("desc"))&&(l=g.description||g.desc),g&&g.hasOwnProperty("measure")&&(c=g.measure)}var H=this,Y=function(te,xe,ne){if(H.getMap().removeOverlay(n),!!ne){var et=i.selected[0];if(o==="Text"){var tt=et.getStyle();tt.getText().setText(xe),et.setProperties({name:xe}),et.setStyle(tt);return}var it={};it[te]=xe.replace(/\n/g,"<br>"),et.setProperties(it)}},ee=this._createLabelDiv({applyFunc:Y,inputId:this._addUID("label-input"),placeholder:o==="Text"?"Saisir un label...":"Saisir une description... (facultatif)",text:l,key:"description",measure:this.options.tools.measure?c:null,geomType:o});n=new Overlay({element:ee,positioning:"top-center"}),this.getMap().addOverlay(n),n.setPosition(i.mapBrowserEvent.coordinate),document.getElementById(this._addUID("label-input")).focus(),this.labelOvl=n,this.getMap().removeInteraction(this.interactionCurrent),this.interactionCurrent=this._createLabelInteraction(),this.getMap().addInteraction(this.interactionCurrent)}}),e}_updateMeasure(e,i){logger$t.log(e);var n=null,o=this.getMap().getView().getProjection();function l(nt,st){st=st||2;var at=Math.pow(10,st);return Math.round(nt*at)/at}var c=i||e.getProperties().type;switch(c){case"Point":var u=e.getGeometry().getCoordinates(),h=transform$1(u,o,"EPSG:4326");n="lon : ",n+=l(h[0],4)+"",n+=" / ",n+="lat : ",n+=l(h[1],4)+"";break;case"LineString":for(var f=0,g=e.getGeometry().getCoordinates(),H=0,Y=g.length-1;H<Y;++H){var ee=transform$1(g[H],o,"EPSG:4326"),te=transform$1(g[H+1],o,"EPSG:4326");f+=getDistance(ee,te)}n=f>1e3?l(f/1e3,3)+" km":l(f,3)+" m";break;case"Polygon":var xe=0,ne=e.getGeometry().clone(),et=ne.getLinearRing(0).getCoordinates();xe=Math.abs(getArea$1(new Polygon([et])));var tt=ne.getLinearRings();if(tt.length>1)for(var it=1;it<tt.length;it++){var rt=tt[it].getCoordinates();xe-=Math.abs(getArea$1(new Polygon([rt])))}n=xe>1e6?l(xe/1e6,3)+" km^2":l(xe,2)+" m^2";break}e.setProperties({measure:n,type:c})}_handleToolClick(e,i,n){var o=n.getMap();if(!o){logger$t.trace("Drawing control not attached to any map.");return}Interactions.unset(o,{current:"Drawing"}),n.interactionCurrent&&(o.removeInteraction(n.interactionCurrent),n.interactionCurrent=null),n.interactionSelectEdit&&(o.removeInteraction(n.interactionSelectEdit),n.interactionSelectEdit=null),n.popupOvl&&(n.getMap().removeOverlay(n.popupOvl),n.popupOvl=null),n.stylingOvl&&(n.getMap().removeOverlay(n.stylingOvl),n.stylingOvl=null),n.tooltipOvl&&(n.getMap().removeOverlay(n.tooltipOvl),n.tooltipOvl=null),this.layer||this._createEmptyLayer();const l=u=>{if(u.dragging||!n.tooltipOvl)return;const h=u.coordinate;n.tooltipOvl.setPosition(h)},c=()=>{n.tooltipOvl&&(n.getMap().removeOverlay(n.tooltipOvl),n.tooltipOvl=null)};switch(i){case this._addUID("drawing-tool-point"):n.dtOptions.points.active&&(n.interactionCurrent=new Draw({stopClick:!0,source:n.layer.getSource(),style:new Style$1({image:new Icon(this._getIconStyleOptions(this.options.markersList[0]))}),type:"Point"}),n.interactionCurrent.on("drawend",function(u){n._drawEndFeature(u.feature,"Point")},n));break;case this._addUID("drawing-tool-line"):n.dtOptions.lines.active&&(n.interactionCurrent=new Draw({stopClick:!0,source:n.layer.getSource(),style:new Style$1({image:new CircleStyle({radius:this.options.cursorStyle.radius,stroke:new Stroke({color:this.options.cursorStyle.strokeColor,width:this.options.cursorStyle.strokeWidth}),fill:new Fill({color:this.options.cursorStyle.fillColor})}),stroke:new Stroke({color:this.options.defaultStyles.strokeColor,width:this.options.defaultStyles.strokeWidth})}),type:"LineString",handleMoveEvent:l}),n.tootlTipElem||(n.tootlTipElem=document.createElement("div"),n.tootlTipElem.className="gpf-draw-linestring-tooltip"),n.tootlTipElem.innerText="Double-cliquer pour terminer",n.tooltipOvl=new Overlay({element:n.tootlTipElem,positioning:"top-right"}),n.interactionCurrent.on("drawend",function(u){n._drawEndFeature(u.feature,"LineString"),c()},n),n.interactionCurrent.on("drawabort",c,n));break;case this._addUID("drawing-tool-polygon"):n.dtOptions.polygons.active&&(n.interactionCurrent=new Draw({stopClick:!0,source:n.layer.getSource(),style:new Style$1({image:new CircleStyle({radius:this.options.cursorStyle.radius,stroke:new Stroke({color:this.options.cursorStyle.strokeColor,width:this.options.cursorStyle.strokeWidth}),fill:new Fill({color:this.options.cursorStyle.fillColor})}),stroke:new Stroke({color:this.options.defaultStyles.polyStrokeColor,width:this.options.defaultStyles.polyStrokeWidth}),fill:new Fill({color:ColorUtils.hexToRgba(this.options.defaultStyles.polyFillColor,this.options.defaultStyles.polyFillOpacity)})}),type:"Polygon",handleMoveEvent:l}),n.tootlTipElem||(n.tootlTipElem=document.createElement("div"),n.tootlTipElem.className="gpf-draw-linestring-tooltip"),n.tootlTipElem.innerText="Double-cliquer pour terminer",n.tooltipOvl=new Overlay({element:n.tootlTipElem,positioning:"top-right"}),n.interactionCurrent.on("drawend",function(u){n._drawEndFeature(u.feature,"Polygon"),c()},n),n.interactionCurrent.on("drawabort",c,n));break;case this._addUID("drawing-tool-holes"):n.dtOptions.holes.active&&(n.interactionSelectEdit=new Select({stopClick:!0,condition:pointerMove,layers:[this.layer]}),n.interactionSelectEdit.setProperties({name:"Drawing",source:n}),o.addInteraction(n.interactionSelectEdit),n.interactionCurrent=new Draw({stopClick:!0,features:this.interactionSelectEdit.getFeatures(),style:new Style$1({image:new CircleStyle({radius:this.options.cursorStyle.radius,stroke:new Stroke({color:this.options.cursorStyle.strokeColor,width:this.options.cursorStyle.strokeWidth}),fill:new Fill({color:this.options.cursorStyle.fillColor})}),stroke:new Stroke({color:this.options.defaultStyles.polyStrokeColor,width:this.options.defaultStyles.polyStrokeWidth}),fill:new Fill({color:ColorUtils.hexToRgba(this.options.defaultStyles.polyFillColor,this.options.defaultStyles.polyFillOpacity)})}),type:"Polygon"}),n.interactionCurrent.on("drawstart",function(u){},n),n.interactionCurrent.on("drawend",function(u){var h=n.interactionSelectEdit.getFeatures();if(h.getLength()){for(var f=h.item(0),g=u.feature.getGeometry().getCoordinates()[0],H=!0,Y=0;Y<g.length;Y++)if(!f.getGeometry().intersectsCoordinate(g[Y])){H=!1;break}if(!H)return;f.getGeometry().appendLinearRing(new LinearRing(g)),u.feature=f,n._drawEndFeature(u.feature,"Polygon")}},n));break;case this._addUID("drawing-tool-text"):n.dtOptions.text.active&&(n.interactionCurrent=new Draw({stopClick:!0,source:n.layer.getSource(),style:new Style$1({image:new CircleStyle({radius:this.options.cursorStyle.radius,stroke:new Stroke({color:this.options.cursorStyle.strokeColor,width:this.options.cursorStyle.strokeWidth}),fill:new Fill({color:this.options.cursorStyle.fillColor})})}),type:"Point"}),n.interactionCurrent.on("drawend",u=>{var h=function(g,H,Y){if(n.getMap().removeOverlay(n.popupOvl),n.popupOvl=null,!Y||!H){n.layer.getSource().removeFeature(u.feature);return}var ee={};ee[g]=H,u.feature.setProperties(ee),u.feature.setStyle(new Style$1({image:new Icon(n._getIconStyleOptions(n.options.defaultStyles.textIcon1x1)),text:new Text({textAlign:"left",font:"16px sans",text:H,fill:new Fill({color:n.options.defaultStyles.textFillColor}),stroke:new Stroke({color:n.options.defaultStyles.textStrokeColor,width:3})})}))},f=this._createLabelDiv({applyFunc:h,inputId:n._addUID("label-input"),geomType:"Text",key:"name",placeholder:"Saisir un label..."});n.popupOvl&&n.popupOvl.element.querySelector(".gp-styling-button.closer").click(),n.popupOvl=new Overlay({element:f,positioning:"top-center"}),n.getMap().addOverlay(n.popupOvl),n.popupOvl.setPosition(u.feature.getGeometry().getCoordinates()),document.getElementById(n._addUID("label-input")).focus()}));break;case this._addUID("drawing-tool-edit"):n.dtOptions.edit.active&&(this.featuresCollectionSelected=new Collection,n.interactionSelectEdit=new Select({condition:singleClick,layers:[this.layer],features:this.featuresCollectionSelected}),n.interactionSelectEdit.on("select",u=>{}),n.interactionSelectEdit.setProperties({name:"Drawing",source:n}),o.addInteraction(n.interactionSelectEdit),n.interactionCurrent=new Modify({stopClick:!0,features:this.interactionSelectEdit.getFeatures(),style:new Style$1({image:new CircleStyle({radius:this.options.cursorStyle.radius,stroke:new Stroke({color:this.options.cursorStyle.strokeColor,width:this.options.cursorStyle.strokeWidth}),fill:new Fill({color:this.options.cursorStyle.fillColor})})})}),n.interactionCurrent.on("modifyend",u=>{var h=u.features.item(0);n._updateMeasure(h)}));break;case this._addUID("drawing-tool-display"):n.dtOptions.display.active&&(n.interactionCurrent=this._createStylingInteraction());break;case this._addUID("drawing-tool-tooltip"):n.dtOptions.tooltip.active&&(n.interactionCurrent=this._createLabelInteraction());break;case this._addUID("drawing-tool-remove"):n.dtOptions.remove.active&&(n.interactionCurrent=n._createRemoveInteraction());break;default:logger$t.trace("unhandled tool type")}n.interactionCurrent&&(n.interactionCurrent.setProperties({name:"Drawing",source:this}),o.addInteraction(n.interactionCurrent),n.tooltipOvl&&o.addOverlay(n.tooltipOvl)),logger$t.log("interactions",o.getInteractions())}onShowDrawingClick(e){var i=this._showDrawingButton.ariaPressed;i==="true"&&this.onPanelOpen(),this.disable(),this.collapsed=i!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position)}onExportFeatureClick(){var e=this.exportFeatures();if(e){var i=document.createElement("a"),n="utf-8";if(i.setAttribute("href","data:"+this._exportMimeType+";charset="+n+","+encodeURIComponent(e)),i.setAttribute("download",this.getExportName()+this._exportExt),document.createEvent){var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!0),i.dispatchEvent(o)}else i.click()}}};ei(yi,"DefaultTools",{points:!0,lines:!0,polygons:!0,holes:!1,text:!0,remove:!0,display:!0,tooltip:!0,edit:!0,export:!0,measure:!1}),ei(yi,"DefaultLabels",{control:"Annoter la carte",creatingTools:"Crer",points:"Placer des points",lines:"Dessiner des lignes",polygons:"Dessiner des polygones",holes:"Crer des trous sur un polygone",text:"Ecrire sur la carte",editingTools:"diter",edit:"Editer les tracs",display:"Modifier l'apparence des objets",tooltip:"Modifier les textes / infos-bulles",remove:"Supprimer des objets",export:"Exporter",exportTitle:"Exporter en KML",applyToObject:"Appliquer  l'objet",saveDescription:"Enregistrer",setAsDefault:"Dfinir par dfaut",strokeColor:"Couleur du trait : ",strokeWidth:"Epaisseur du trait : ",fillColor:"Couleur de remplissage : ",fillOpacity:"Opacit du remplissage : ",markerSize:"Taille du pictogramme : ",markerColor:"Couleur du pictogramme : ",labelDisplay:"Afficher le label : "}),ei(yi,"DefaultStyles",{textFillColor:"#000000",textStrokeColor:"#FFFFFF",textStrokeWidth:6,textIcon1x1:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNiYAAAAAkAAxkR2eQAAAAASUVORK5CYII=",anchor:[0,0]},polyFillColor:"#000091",polyFillOpacity:.7,polyStrokeColor:"#000091",polyStrokeWidth:4,strokeColor:"#FF7F00",strokeWidth:4,markerSize:1,markerColor:"#ffcc33",labelDisplay:!0}),ei(yi,"DefaultCursorStyle",{radius:6,strokeColor:"#FFF",strokeWidth:1,fillColor:"rgba(0, 153, 255, 1)"});let Drawing=yi;Object.assign(Drawing.prototype,DrawingDOM);Object.assign(Drawing.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.Drawing=Drawing);var logger$s=LoggerByDefault.getLogger("LocationSelectorDOM"),LocationSelectorDOM={_addUID:function(s){var e=this._uid?s+"-"+this._uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.className=this._addUID("GPlocationPoint"),s.className+=" GPwidget gpf-widget ",s},_createLocationPointElement:function(s,e){var i=document.createElement("div");return i.id=this._addUID("GPlocationPoint_"+s),i.className=e?"GPflexInput GPlocationStageFlexInput gpf-flex":"GPflexInput GPelementHidden gpf-flex gpf-hidden",i.style.cssText="",i},_createLocationPointLabelElement:function(s,e){var i=this,n=document.createElement("button");return n.id=this._addUID("GPlocationOriginLabel_"+s),n.innerHTML=e,n.className="GPlocationOriginLabel gpf-btn gpf-btn-icon-label fr-btn fr-btn--secondary gpf-btn--secondary",n.setAttribute("type","button"),n.addEventListener("click",function(o){for(var l=SelectorID.index(this.id),c=document.getElementsByClassName(i._addUID("GPlocationPoint")),u=0;u<c.length;u++){var h=c[u].childNodes[0].id,f=SelectorID.index(h);document.getElementById(i._addUID("GPlocationPoint_"+f)).style.cssText=""}document.getElementById(i._addUID("GPlocationOriginCoords_"+l)).value="",document.getElementById(i._addUID("GPlocationOrigin_"+l)).value="",document.getElementById(i._addUID("GPlocationPoint_"+l)).style.cssText="",document.getElementById(i._addUID("GPlocationOriginPointer_"+l)).checked=!1,document.getElementById(i._addUID("GPlocationOrigin_"+l)).className="GPelementShow gpf-show  gpf-input fr-input",document.getElementById(i._addUID("GPlocationOriginCoords_"+l)).className="GPelementHidden gpf-hidden",document.getElementById(i._addUID("GPlocationStageRemove_"+l))&&(document.getElementById(i._addUID("GPlocationStageRemove_"+l)).className="GPlocationStageRemove gpf-btn gpf-btn-icon-remove fr-btn--sm fr-btn--secondary gpf-btn--secondary"),document.getElementById(i._addUID("GPlocationStageAdd"))&&(document.getElementById(i._addUID("GPlocationStageAdd")).className="GPlocationStageAdd gpf-btn gpf-btn-icon-add fr-btn--sm fr-btn--secondary gpf-btn--secondary fr-mt-2w"),i.onLocationClearPointClick(o)}),n},_createLocationAutoCompleteteInputElement:function(s){var e=this,i=document.createElement("input");return i.id=this._addUID("GPlocationOrigin_"+s),i.className="GPelementShow gpf-show gpf-input fr-input",i.type="text",i.placeholder="Saisir une adresse, un lieu...",i.autocomplete="off",i.addEventListener("keyup",function(n){var o=n.which||n.keyCode;if(!(o===13||o===10||o===38||o===40)){var l=SelectorID.index(this.id);document.getElementById(e._addUID("GPlocationOrigin_"+l)).value.length>2?(document.getElementById(e._addUID("GPlocationAutoCompleteList_"+l)).classList.replace("GPelementHidden","GPelementVisible"),document.getElementById(e._addUID("GPlocationAutoCompleteList_"+l)).classList.replace("gpf-hidden","gpf-visible")):(document.getElementById(e._addUID("GPlocationAutoCompleteList_"+l)).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(e._addUID("GPlocationAutoCompleteList_"+l)).classList.replace("gpf-visible","gpf-hidden")),e.onAutoCompleteSearchText(n)}}),i.addEventListener("keydown",function(n){var o=n.which||n.keyCode,l=document.getElementById(e._addUID("GPlocationAutoCompleteResult_"+s));if(l){var c=l.getElementsByClassName("GPautoCompleteProposal current"),u=l.getElementsByClassName("GPautoCompleteProposal"),h=u.length;if(h){var f=null;if(c.length)f=c[0];else{f=u[0],f.className="GPautoCompleteProposal current",f.style.color="#000000",f.style["background-color"]="#CEDBEF";return}var g=parseInt(SelectorID.index(f.id),10),H=g===h-1?u[0]:u[g+1],Y=g===0?u[h-1]:u[g-1];switch(f.style["background-color"]="",f.style.color="",Y.style["background-color"]="",Y.style.color="",H.style["background-color"]="",H.style.color="",o){case 38:logger$s.log("arrow up"),f.className="GPautoCompleteProposal",Y.className="GPautoCompleteProposal current",Y.style.color="#000000",Y.style["background-color"]="#CEDBEF";break;case 40:logger$s.log("arrow down"),f.className="GPautoCompleteProposal",H.className="GPautoCompleteProposal current",H.style.color="#000000",H.style["background-color"]="#CEDBEF";break;case 13:logger$s.log("enter"),f.click(n);break}f.focus()}}}),i},_createLocationCoordinateInputElement:function(s){var e=this,i=document.createElement("input");return i.id=this._addUID("GPlocationOriginCoords_"+s),i.className="GPelementHidden gpf-input gpf-hidden fr-input",i.type="text",i.disabled=!1,i.addEventListener("click",function(){var n=SelectorID.index(this.id);document.getElementById(e._addUID("GPlocationOriginLabel_"+n)).click()}),i},_createLocationPointerShowInputElement:function(s){var e=document.createElement("input");return e.id=this._addUID("GPlocationOriginPointer_"+s),e.className="GPelementHidden gpf-hidden",e.type="checkbox",e},_createLocationPointerInputElement:function(s){var e=this,i=document.createElement("button");return i.id=this._addUID("GPlocationOriginPointerImg_"+s),i.htmlFor=this._addUID("GPlocationOriginPointer_"+s),i.className="GPlocationOriginPointerImg gpf-btn gpf-btn-icon-pointer fr-btn",i.title="Pointer un lieu sur la carte",i.setAttribute("type","button"),i.addEventListener("click",function(n){n.preventDefault(),n.stopPropagation();var o=SelectorID.index(this.id),l=document.getElementsByClassName(e._addUID("GPlocationPoint")),c,u,h;for(c=0;c<l.length;c++)u=l[c].childNodes[0].id,h=SelectorID.index(u),o!==h&&(document.getElementById(e._addUID("GPlocationOriginPointer_"+h)).checked=!1,document.getElementById(e._addUID("GPlocationOriginCoords_"+h)).value==="Pointer un lieu sur la carte"&&(document.getElementById(e._addUID("GPlocationOriginCoords_"+h)).value="",document.getElementById(e._addUID("GPlocationOrigin_"+h)).className="GPelementShow gpf-show  gpf-input fr-input",document.getElementById(e._addUID("GPlocationOriginCoords_"+h)).className="GPelementHidden gpf-hidden"));if(document.getElementById(e._addUID("GPlocationOriginPointer_"+o)).checked){for(document.getElementById(e._addUID("GPlocationOriginCoords_"+o)).value="",c=0;c<l.length;c++)u=l[c].childNodes[0].id,h=SelectorID.index(u),document.getElementById(e._addUID("GPlocationPoint_"+h)).style.cssText="";document.getElementById(e._addUID("GPlocationStageRemove_"+o))&&(document.getElementById(e._addUID("GPlocationStageRemove_"+o)).className="GPlocationStageRemove  gpf-btn gpf-btn-icon-remove fr-btn--sm fr-btn--secondary gpf-btn--secondary"),document.getElementById(e._addUID("GPlocationStageAdd"))&&(document.getElementById(e._addUID("GPlocationStageAdd")).className="GPlocationStageAdd gpf-btn gpf-btn-icon-add fr-btn--sm fr-btn--secondary gpf-btn--secondary fr-mt-2w"),document.getElementById(e._addUID("GPlocationOriginPointer_"+o)).checked=!1,document.getElementById(e._addUID("GPlocationOrigin_"+o)).className="GPelementShow gpf-show  gpf-input fr-input",document.getElementById(e._addUID("GPlocationOriginCoords_"+o)).className="GPelementHidden gpf-hidden"}else{for(document.getElementById(e._addUID("GPlocationOriginCoords_"+o)).value="Pointer un lieu sur la carte",c=0;c<l.length;c++)u=l[c].childNodes[0].id,h=SelectorID.index(u),o===h?document.getElementById(e._addUID("GPlocationPoint_"+h)).style.cssText="":document.getElementById(e._addUID("GPlocationPoint_"+h)).style.display="none";document.getElementById(e._addUID("GPlocationStageRemove_"+o))&&(document.getElementById(e._addUID("GPlocationStageRemove_"+o)).className="GPelementHidden gpf-hidden"),document.getElementById(e._addUID("GPlocationStageAdd"))&&(document.getElementById(e._addUID("GPlocationStageAdd")).className="GPelementHidden gpf-hidden"),document.getElementById(e._addUID("GPlocationOriginPointer_"+o)).checked=!0,document.getElementById(e._addUID("GPlocationOrigin_"+o)).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPlocationOriginCoords_"+o)).className="GPelementShow gpf-show gpf-input fr-input",document.getElementById(e._addUID("GPlocationOriginCoords_"+o)).disabled=!0}e.onActivateMapPointClick(n)}),i},_createLocationRemovePointElement:function(s){var e=this,i=document.createElement("button");return i.id=this._addUID("GPlocationStageRemove_"+s),i.className="GPlocationOpen GPlocationStageRemove gpf-btn gpf-btn-icon-remove fr-btn--sm fr-btn--secondary gpf-btn--secondary",i.title="Supprimer l'tape",i.setAttribute("tabindex","0"),i.setAttribute("aria-pressed",!1),i.setAttribute("type","button"),i.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o);var l=document.getElementsByClassName(e._addUID("GPlocationPoint")),c=l.length-1,u=l[0].childNodes[0].id,h=l[c].childNodes[0].id,f=SelectorID.index(u),g=SelectorID.index(h);if(s!==f&&s!==g){var H=SelectorID.index(this.id);document.getElementById(e._addUID("GPlocationPoint_"+H)).className="GPflexInput GPelementHidden gpf-flex gpf-hidden",document.getElementById(e._addUID("GPlocationOrigin_"+H)).value="",document.getElementById(e._addUID("GPlocationOrigin_"+H)).className="GPelementShow gpf-show gpf-input fr-input",document.getElementById(e._addUID("GPlocationOriginCoords_"+H)).value="",document.getElementById(e._addUID("GPlocationOriginCoords_"+H)).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPlocationStageAdd")).style.display="",document.getElementById(e._addUID("GPlocationPoint_"+H)).parentElement.previousSibling.classList.add("GPelementHidden","gpf-hidden"),e.onLocationRemovePointClick(n)}}),i},_createLocationAddPointElement:function(){var s=this,e=document.createElement("button");return e.id=this._addUID("GPlocationStageAdd"),e.className="GPlocationOpen GPlocationStageAdd gpf-btn gpf-btn-icon-add fr-btn--sm fr-btn--secondary gpf-btn--secondary fr-mt-2w",e.title="Ajouter une tape",checkDsfr()&&(e.innerText="Ajouter une tape"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener("click",function(i){for(var n=1,o=0,l=document.getElementsByClassName(s._addUID("GPlocationPoint")),c=1;c<l.length-1;c++){var u=l[c].childNodes[0].id,h=SelectorID.index(u);document.getElementById(s._addUID("GPlocationPoint_"+h))&&(document.getElementById(s._addUID("GPlocationPoint_"+h)).className==="GPflexInput GPelementHidden gpf-flex gpf-hidden"?n===1&&(n=h):o++)}n<l.length&&(document.getElementById(s._addUID("GPlocationPoint_"+n)).className="GPflexInput GPlocationStageFlexInput gpf-flex",document.getElementById(s._addUID("GPlocationPoint_"+n)).parentElement.previousSibling.classList.remove("GPelementHidden","gpf-hidden")),o===4&&(document.getElementById(s._addUID("GPlocationStageAdd")).style.display="none");var f=i.target.ariaPressed==="true";i.target.setAttribute("aria-pressed",!f),s.onLocationAddPointClick(i)}),e},_createLocationAutoCompleteElement:function(s){var e=document.createElement("div");return e.id=this._addUID("GPlocationAutoCompleteList_"+s),e.className="GPlocationAutoCompleteList GPelementHidden gpf-panel gpf-hidden fr-modal",e},_createLocationAutoCompleteResultElement:function(s){var e=this,i=document.createElement("div");return i.id=this._addUID("GPlocationAutoCompleteResult_"+s),i.className="GPadvancedAutoCompleteResult gpf-panel__list",i.addEventListener?i.addEventListener("click",function(n){e.onAutoCompletedResultsItemClick(n),document.getElementById(e._addUID("GPlocationAutoCompleteList_"+s)).classList.replace("GPelementHidden","GPelementVisible"),document.getElementById(e._addUID("GPlocationAutoCompleteList_"+s)).classList.replace("gpf-hidden","gpf-visible")},!1):i.attachEvent&&i.attachEvent("onclick",function(n){e.onAutoCompletedResultsItemClick(n),document.getElementById(e._addUID("GPlocationAutoCompleteList_"+s)).classList.replace("GPelementHidden","GPelementVisible"),document.getElementById(e._addUID("GPlocationAutoCompleteList_"+s)).classList.replace("gpf-hidden","gpf-visible")}),i},_createLocationAutoCompletedLocationElement:function(s,e,i){var n=document.getElementById(this._addUID("GPlocationAutoCompleteResult_"+s)),o=document.createElement("div");o.id=this._addUID("AutoCompletedLocation_"+i),o.className="GPautoCompleteProposal gpf-panel__items",o.title=GeocodeUtils.getSuggestedLocationFreeform(e),o.innerHTML=GeocodeUtils.getSuggestedLocationFreeform(e),n.appendChild(o)},GPdisplayCoordinate:function(s){for(var e=document.getElementsByClassName(this._addUID("GPlocationPoint")),i=0;i<e.length;i++){var n=e[i].childNodes[0].id,o=SelectorID.index(n);if(document.getElementById(this._addUID("GPlocationOriginPointer_"+o)).checked){document.getElementById(this._addUID("GPlocationOriginCoords_"+o)).value=s,document.getElementById(this._addUID("GPlocationOriginCoords_"+o)).disabled=!1;for(var l=0;l<e.length;l++){n=e[l].childNodes[0].id;var c=SelectorID.index(n);document.getElementById(this._addUID("GPlocationPoint_"+c)).style.cssText="",document.getElementById(this._addUID("GPlocationStageRemove_"+c))&&(document.getElementById(this._addUID("GPlocationStageRemove_"+c)).className="GPlocationStageRemove gpf-btn gpf-btn-icon-remove fr-btn--sm fr-btn--secondary gpf-btn--secondary")}document.getElementById(this._addUID("GPlocationOriginPointer_"+o)).checked=!1,document.getElementById(this._addUID("GPlocationStageAdd"))&&(document.getElementById(this._addUID("GPlocationStageAdd")).className="GPlocationStageAdd gpf-btn gpf-btn-icon-add fr-btn--sm");return}}}},logger$r=LoggerByDefault.getLogger("locationselector");class LocationSelector extends Control{constructor(e){if(e=e||{},super({element:e.element||document.createElement("div"),render:e.render,target:e.target}),!(this instanceof LocationSelector))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="LocationSelector",this.initialize(e),this._container=this._initContainer(),this.element?this.element.appendChild(this._container):this.element=this._container,this}initialize(e){this.options={tag:{id:1,groupId:null,label:">",display:!0,addOption:!1,removeOption:!1},displayInfo:!0,autocompleteOptions:{}},Helper.mergeParams(this.options,e),this._uid=this.options.tag.groupId||SelectorID.generate(),this._map=null,this._inputsContainer=null,this._buttonLabel=null,this._inputAutoComplete=null,this._inputShowPointerContainer=null,this._inputShowPointer=null,this._inputCoordinateContainer=null,this._addPointElement=null,this._removePointElement=null,this._coordinate=null,this._suggestedContainer=null,this._suggestedList=null,this._suggestedLocations=[],this._currentLocation=null,this._initMarker(),this._resources={},this.listenerKey=null}_initMarker(){if(this._marker=null,this._markerUrl="",this._markerOffset=[0,0],this.options.tag.markerOpts&&this.options.tag.markerOpts.url){this._markerUrl=this.options.tag.markerOpts.url;var e=this.options.tag.markerOpts.offset;e&&(Array.isArray(e)&&e.length===2?this._markerOffset=e:logger$r.log("markerOpts.offset should be an array. e.g. : [0,0]"))}else this._markerUrl=Marker.lightOrange,this._markerOffset=Marker.defaultOffset}getCoordinate(){return this._coordinate}setCoordinate(e,i){var n=this.getMap(),o=n.getView().getProjection().getCode();i||(i=o),this._setCoordinate(e,i),e=transform$1(e,i,o),this._setMarker([e[0],e[1]],null,!1)}clear(){this.clearResults(),this._buttonLabel.click()}clearResults(){this._currentLocation=null,this._coordinate=null,this._hideSuggestedLocation(),this._clearSuggestedLocation(),this._setMarker(),unByKey(this.listenerKey)}_initContainer(){var e=this.options.tag.id,i=this._createMainContainerElement(),n=this._inputsContainer=this._createLocationPointElement(e,this.options.tag.display);i.appendChild(n);var o=this._buttonLabel=this._createLocationPointLabelElement(e,this.options.tag.label);n.appendChild(o);var l=this._inputAutoComplete=this._createLocationAutoCompleteteInputElement(e);l.addEventListener?l.addEventListener("click",()=>this.onAutoCompleteInputClick()):l.attachEvent&&l.attachEvent("onclick",()=>this.onAutoCompleteInputClick()),n.appendChild(l);var c=this._inputCoordinateContainer=this._createLocationCoordinateInputElement(e);n.appendChild(c);var u=this._inputShowPointerContainer=this._createLocationPointerShowInputElement(e);n.appendChild(u);var h=this._inputShowPointer=this._createLocationPointerInputElement(e);if(n.appendChild(h),this.options.tag.addOption){var f=this._addPointElement=this._createLocationAddPointElement();n.appendChild(f)}if(this.options.tag.removeOption){var g=this._removePointElement=this._createLocationRemovePointElement(e);n.appendChild(g)}var H=this._suggestedContainer=this._createLocationAutoCompleteElement(e),Y=this._suggestedList=this._createLocationAutoCompleteResultElement(e);return H.appendChild(Y),i.appendChild(H),i}onAutoCompleteInputClick(){this._inputAutoComplete&&this._inputAutoComplete.value.length>2&&this._displaySuggestedLocation()}onAutoCompleteSearchText(e){var i=e.target.value;if(i){var n=this.options.autocompleteOptions||{},o=n.onSuccess||null,l=n.onFailure||null;if(this._currentLocation=i,i.length<3){this._clearSuggestedLocation();return}var c=this;this._requestAutoComplete({text:i,maximumResponses:5,onSuccess:function(h){if(h){var f=h.suggestedLocations;c._fillAutoCompletedLocationListContainer(f),o&&o.call(this,h)}},onFailure:function(h){c._clearSuggestedLocation(),logger$r.log(h.message),l&&l.call(this,h)}});var u=this.getMap();u.on("click",()=>this._hideSuggestedLocation()),u.on("pointerdrag",()=>this._hideSuggestedLocation())}}onAutoCompletedResultsItemClick(e){var i=SelectorID.index(e.target.id);if(i){var n=[this._suggestedLocations[i].position.x,this._suggestedLocations[i].position.y];this._coordinate=n;var o={type:this._suggestedLocations[i].type,fields:this._suggestedLocations[i]},l=GeocodeUtils.getSuggestedLocationFreeform(this._suggestedLocations[i]);this._setLabel(l);var c=this.getMap().getView(),u=c.getProjection().getCode();u!=="EPSG:4326"&&(n=transform$1(n,"EPSG:4326",u)),this._setPosition(n),this._setMarker(n,o,this.options.displayInfo)}}onActivateMapPointClick(){var e=this.getMap();this._inputShowPointerContainer.checked?(this.clearResults(),this.listenerKey=e.on("click",i=>this.onMouseMapClick(i)),this._setCursor("crosshair")):(unByKey(this.listenerKey),this._setCursor())}onLocationClearPointClick(){this._setCursor(),this.clearResults()}onLocationRemovePointClick(){this._setCursor(),this.clearResults()}onLocationAddPointClick(e){logger$r.log("onRouteAddPointClick",e)}onMouseMapClick(e){var i=e.coordinate;if(!(!e.map||!e.map.getView())){var n=e.map.getView().getProjection();this._setCoordinate(i,n),this._setMarker([i[0],i[1]],null,!1),this.onActivateMapPointClick(e)}}_setLabel(e){this._inputAutoComplete.value=e}_setCursor(e){var i=this.getMap(),n=i.getTargetElement();e?n.style.cursor=e:n.style.cursor=null}_setCoordinate(e,i){this._coordinate=transform$1(e,i,"EPSG:4326");var n=this._coordinate[0].toFixed(4),o=this._coordinate[1].toFixed(4),l=o+" / "+n;this.GPdisplayCoordinate(l)}_setPosition(e){var i=this.getMap().getView();i.setCenter(e)}_setMarker(e,i,n){var o=this.getMap();if(this._marker!=null&&(o.removeOverlay(this._marker),this._marker=null),e){var l=document.createElement("img");l.src=this._markerUrl,this._marker=new Overlay({position:e,offset:this._markerOffset,element:l,stopEvent:!1}),o.addOverlay(this._marker),n&&logger$r.log("marker information : ",i)}}_clearSuggestedLocation(){if(this._suggestedLocations=[],this._suggestedList)for(;this._suggestedList.firstChild;)this._suggestedList.removeChild(this._suggestedList.firstChild)}_hideSuggestedLocation(){this._suggestedContainer&&(this._suggestedContainer.classList.replace("GPelementVisible","GPelementHidden"),this._suggestedContainer.classList.replace("gpf-visible","gpf-hidden"))}_displaySuggestedLocation(){this._suggestedContainer&&(this._suggestedContainer.classList.replace("GPelementHidden","GPelementVisible"),this._suggestedContainer.classList.replace("gpf-hidden","gpf-visible"))}_requestAutoComplete(e){if(logger$r.log("_requestAutoComplete()",e),!(!e||Object.keys(e).length===0)&&e.text){logger$r.log(e);var i={};Helper.assign(i,this.options.autocompleteOptions),Helper.assign(i,e);var n=this._resources.AutoCompletion||null;n&&Array.isArray(n)&&(i.filterOptions||(i.filterOptions={}),i.filterOptions.type=n),i.apiKey=i.apiKey||this.options.apiKey,typeof i.ssl!="boolean"&&(typeof this.options.ssl=="boolean"?i.ssl=this.options.ssl:i.ssl=!0),logger$r.log(i),Gp.Services.autoComplete(i)}}_fillAutoCompletedLocationListContainer(e){if(!(!e||e.length===0)){var i=this._suggestedList;if(i.childElementCount)for(;i.firstChild;)i.removeChild(i.firstChild);for(var n=0;n<e.length;n++)this._createLocationAutoCompletedLocationElement(this.options.tag.id,e[n],n);this._suggestedLocations=e}}}Object.assign(LocationSelector.prototype,LocationSelectorDOM);window.ol&&window.ol.control&&(window.ol.control.LocationSelector=LocationSelector);var ExportDOM={_addUID:function(s){var e=this.uid?s+"-"+this.uid:s;return e}},logger$q=LoggerByDefault.getLogger("export");class ButtonExport extends Control{constructor(e){if(e=e||{layer:null,control:null,target:null,format:"geojson",name:"export",description:"export",title:"Exporter",kind:"secondary",menu:!1,icons:{menu:" ",button:""},callback:null},logger$q.trace("[constructor] Export",e),super({element:document.createElement("div"),render:e.render,target:null}),!(this instanceof ButtonExport))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this.CLASSNAME="Export",this.EXPORT_ROUTE={},this.EXPORT_ISOCHRON={},this.EXPORT_PROFILE={},this.uid=e.id||SelectorID.generate(),this.extension=null,this.mimeType=null,this.container=null,this.button=null,this.buttonOptions=null,this.inputName=null,this.inputDesc=null,this.menu=null,this.menuClassHidden="GPelementHidden gpf-hidden",this.initOptions(e),this.initContainer(),this.BUTTON_EXPORT_CLICKED_EVENT="button:clicked"}render(){if(!this.options.target&&this.options.control){var e=this.options.control.getContainer(),i=e.querySelector(".container-buttons-plugin");this.options.target=i||e.lastChild}this.container&&this.options.target.appendChild(this.container)}initOptions(e){this.options={layer:null,control:null,target:null,download:!0,format:"geojson",name:"export",description:"export",title:"Exporter",kind:"secondary",direction:"row",menu:!1,menuOptions:{above:!1,outside:!1,labelName:!0,labelDesc:!0,selectFormat:!0},icons:{menu:" ",button:"export"},callback:null};var i=Helper.assign(this.options.icons,e.icons),n=Helper.assign(this.options.menuOptions,e.menuOptions);Helper.assign(this.options,e),Helper.assign(this.options.icons,i),Helper.assign(this.options.menuOptions,n),logger$q.debug(this.options),this.options.layer,this.options.control,this.options.target;var o=this.options.format;o?this.setFormat(o):this.setFormat(""),this.options.name||this.setName("export"),this.options.description||this.setDescription("export"),this.options.title||this.setTitle("Exporter"),this.options.kind||this.setKind("secondary"),this.options.menu===void 0&&this.setMenu(!1)}initContainer(){var e=this.options.title;this.options.menu&&(e=this.options.icons.menu+this.options.title);var i=document.createElement("div");i.id=this._addUID("GPexportContainer"),i.className="GPexportMenuContainer gpf-export-menu-container gpf-export-menu-container-row-reverse",this.options.direction==="column"&&i.classList.replace("gpf-export-menu-container-row-reverse","gpf-export-menu-container-column-reverse");var n=this.stringToHTML(`
            <div class="GPexportMenuHidden gpf-accordion fr-accordion ${this.menuClassHidden}">
                <h3 class="gpf-accordion__title fr-accordion__title">
                    <button type="button" 
                        id="GPexportBtnMenuContent-${this.uid}"
                        class="gpf-accordion__btn fr-accordion__btn" 
                        aria-expanded="false" aria-controls="GPexportMenuContent-${this.uid}">options</button>
                </h3>
                <div id="GPexportMenuContent-${this.uid}"
                    class="GPexportMenuContent fr-collapse fr-mx-2w">
                    <div id="GPexportMenuName-${this.uid}" 
                        class="GPexportMenuName">
                        <label class="GPlabel gpf-label fr-label" for="GPexportMenuInputName-${this.uid}" title="Nom">Nom</label>
                        <input type="text" id="GPexportMenuInputName-${this.uid}" class="GPinput gpf-input fr-input">
                    </div>
                    <div id="GPexportMenuDesc-${this.uid}"
                        class="GPexportMenuDesc">
                        <label class="GPlabel gpf-label fr-label" for="GPexportMenuInputDesc-${this.uid}" title="Description">Description</label>
                        <input type="text" id="GPexportMenuInputDesc-${this.uid}" class="GPinput gpf-input fr-input">
                    </div>
                    <div id="GPexportMenuFormat-${this.uid}">
                        <label class="GPlabel gpf-label fr-label" title="Formats">Formats</label>
                        <div class="GPexportMenuFormat fr-radio-group fr-m-1w">
                            <input type="radio" 
                                id="GPmenuFormatGeojson-${this.uid}"
                                name="format" 
                                value="geojson">
                            <label class="fr-label container" for="GPmenuFormatGeojson-${this.uid}">GeoJSON
                                <span class="checkmark"></span>
                            </label>
                        </div>
                        <div class="GPexportMenuFormat fr-radio-group fr-m-1w">
                            <input type="radio" 
                                id="GPmenuFormatKml-${this.uid}"
                                name="format" 
                                value="kml">
                            <label class="fr-label container" for="GPmenuFormatKml-${this.uid}">KML
                                <span class="checkmark"></span>
                            </label>
                        </div>
                        <div class="GPexportMenuFormat fr-radio-group fr-m-1w">
                            <input type="radio" 
                                id="GPmenuFormatGpx-${this.uid}"
                                name="format" 
                                value="gpx">
                            <label class="fr-label container" for="GPmenuFormatGpx-${this.uid}">GPX
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                    <div id="GPexportMenuButtons-${this.uid}" 
                        class="GPexportMenuButtons">
                        <button 
                            type="button"
                            id="GPexportMenuButtonValidate-${this.uid}" 
                            class="GPexportMenuButtonValidate GPsubmit gpf-btn gpf-btn-icon-export-validate fr-btn fr-btn--secondary fr-m-1w">
                            Valider
                        </button>
                        <button 
                            type="button"
                            id="GPexportMenuButtonCancel-${this.uid}" 
                            class="GPexportMenuButtonIconCancel GPsubmit gpf-btn gpf-btn-icon-export-cancel fr-btn fr-btn--secondary fr-m-1w">
                            Annuler
                        </button>
                    </div>
                </div>
            </div>
        `);if(this.menu=n.firstChild,this.menu){if(this.options.menu){var o=this.menu.className;this.menu.className=o.replace(this.menuClassHidden,"")}var l=this.options.format.toUpperCase(),c=this.menu.querySelectorAll('input[type=radio][name="format"]');for(let et=0;et<c.length;et++){var u=c[et];u.id.toUpperCase().includes(l)&&(u.checked=!0),u.addEventListener("change",tt=>this.onChangeRadioFormat(tt))}this.buttonOptions=this.menu.querySelector("#GPexportBtnMenuContent-"+this.uid),this.buttonOptions&&this.buttonOptions.addEventListener("click",et=>this.onClickButtonToggleOptions(et)),this.inputName=this.menu.querySelector("#GPexportMenuInputName-"+this.uid),this.inputDesc=this.menu.querySelector("#GPexportMenuInputDesc-"+this.uid),this.inputName.addEventListener("change",et=>this.onChangeInputName(et)),this.inputName.addEventListener("focusin",et=>this.onFocusInputName(et)),this.inputDesc.addEventListener("change",et=>this.onChangeInputDesc(et)),this.inputDesc.addEventListener("focusin",et=>this.onFocusInputDesc(et));var h=this.menu.querySelector("#GPexportMenuButtonValidate-"+this.uid);h.addEventListener("click",et=>this.onClickButtonValidate(et));var f=this.menu.querySelector("#GPexportMenuButtonCancel-"+this.uid);if(f.addEventListener("click",et=>this.onClickButtonCancel(et)),this.options.menuOptions){if(this.options.menuOptions.outside){this.menu.classList.remove("gpf-accordion","fr-accordion");var g=this.menu.querySelector("#GPexportBtnMenuContent-"+this.uid);g.classList.add("gpf-hidden");var H=this.menu.querySelector("#GPexportMenuContent-"+this.uid);H.classList.remove("fr-collapse");var Y=this.menu.querySelector("#GPexportMenuButtons-"+this.uid);Y.classList.add("gpf-hidden")}if(this.options.menuOptions.above&&(i.classList.replace("gpf-export-menu-container-row-reverse","gpf-export-menu-container-row"),i.classList.replace("gpf-export-menu-container-column-reverse","gpf-export-menu-container-column")),!this.options.menuOptions.labelName){var ee=this.menu.querySelector("#GPexportMenuName-"+this.uid);ee.classList.add("gpf-hidden")}if(!this.options.menuOptions.labelDesc){var te=this.menu.querySelector("#GPexportMenuDesc-"+this.uid);te.classList.add("gpf-hidden")}if(!this.options.menuOptions.selectFormat){var xe=this.menu.querySelector("#GPexportMenuFormat-"+this.uid);xe.classList.add("gpf-hidden")}}}i.appendChild(this.menu);var ne=this.stringToHTML(`
            <button 
                type="button"
                id="${this._addUID("GPexportButton")}" 
                class="GPexportButtonExportIcon GPsubmit gpf-btn gpf-btn-icon-export-submit fr-btn fr-m-1w">
                ${e}
            </button>
        `);switch(this.button=ne.firstChild,this.button&&this.button.addEventListener("click",et=>this.onClickButtonExport(et)),this.options.kind){case"tertiary":this.button.classList.add("fr-btn--tertiary","gpf-btn--tertiary");break;case"secondary":this.button.classList.add("fr-btn--secondary","gpf-btn--secondary");break;case"primary":default:this.button.classList.add("fr-btn--primary","gpf-btn--primary");break}if(!this.options.icons.button)this.button.classList.remove("GPexportButtonExportIcon","gpf-btn-icon-export-submit");else switch(this.options.icons.button){case"export":break;case"save":this.button.classList.replace("GPexportButtonExportIcon","GPexportButtonSaveIcon"),this.button.classList.replace("gpf-btn-icon-export-submit","gpf-btn-icon-save-submit");break;default:this.button.classList.remove("GPexportButtonExportIcon","gpf-btn-icon-export-submit");break}i.appendChild(this.button),this.container=i}stringToHTML(e){var i=function(){if(!window.DOMParser)return!1;var c=new DOMParser;try{c.parseFromString("x","text/html")}catch{return!1}return!0};if(i()){var n=new DOMParser,o=n.parseFromString(e,"text/html");return o.body}var l=document.createElement("div");return l.innerHTML=e,l}isPluggableControl(){return!!(this.options.control&&typeof this.options.control.getContainer=="function"&&typeof this.options.control.getLayer=="function")}exportFeatures(e,i,n){var o=null;if(!e)return logger$q.warn("Impossible to export : no layer is hosting features."),o;if(!e.getSource()||!e.getSource().getFeatures()||!e.getSource().getFeatures().length)return logger$q.warn("Impossible to export : no features found."),o;e.getSource().getFeatures().forEach(g=>{var H=g.getStyle();!H&&this.options.control&&typeof this.options.control.getStyle=="function"&&g.setStyle(this.options.control.getStyle())});var l={defaultStyle:n,extensions:{}};i&&(l.extensions={"geoportail:compute":i}),this.options.description&&(l.extensions.description=this.inputDesc&&this.inputDesc.value?this.inputDesc.value:this.options.description);var c=null;switch(this.options.format.toUpperCase()){case"KML":l.writeStyles=!0,l.showPointNames=!0,c=new KML(l);break;case"GPX":c=new GPX(l);break;case"GEOJSON":c=new GeoJSON(l);break}if(!c)return logger$q.warn("Impossible to export : format unknown !?"),o;var u=e.getSource().getProjection(),h=this.getMap();h&&(u=u||h.getView().getProjection());var f=e.getSource().getFeatures();return o=c.writeFeatures(f,{dataProjection:"EPSG:4326",featureProjection:u||"EPSG:3857"}),o}onClickButtonExport(e){this.isPluggableControl()||logger$q.warn("Componant not pluggable with the control !");var i=this.options.control&&this.options.control.getLayer!==void 0?this.options.control.getLayer():this.options.layer,n=this.options.control&&this.options.control.getData!==void 0?this.options.control.getData():{},o=this.options.control&&this.options.control.getStyle!==void 0?this.options.control.getStyle():{},l=this.exportFeatures(i,n,o);if(!(!l||l==="null")){if(this.dispatchEvent({type:this.BUTTON_EXPORT_CLICKED_EVENT,content:l,name:this.options.name,description:this.options.description,format:this.options.format,layer:i}),this.options.download){var c=document.createElement("a"),u="utf-8";if(c.setAttribute("href","data:"+this.mimeType+";charset="+u+","+encodeURIComponent(l)),c.setAttribute("download",this.options.name+this.extension),document.createEvent){var h=document.createEvent("MouseEvents");h.initEvent("click",!0,!0),c.dispatchEvent(h)}else c.click()}this.options.callback&&typeof this.options.callback=="function"&&this.options.callback(l,i)}}onChangeRadioFormat(e){this.setFormat(e.target.value)}onChangeInputName(e){this.setName(e.target.value)}onFocusInputName(e){var i=this.getMap();i&&this.options.control&&typeof this.options.control.disable=="function"&&this.options.control.disable()}onChangeInputDesc(e){this.setDescription(e.target.value)}onFocusInputDesc(e){var i=this.getMap();i&&this.options.control&&typeof this.options.control.disable=="function"&&this.options.control.disable()}onClickButtonToggleOptions(e){e.target.ariaExpanded=e.target.ariaExpanded!=="true";var i=this.menu.querySelector("#"+e.target.getAttribute("aria-controls"));i&&(e.target.ariaExpanded==="true"?(i.classList.add("fr-collapse--expanded"),this.menu.classList.add("gpf-full-container"),this.menu.classList.add("gpf-accordion--opened"),i.classList.remove("GPelementHidden")):(i.classList.remove("fr-collapse--expanded"),this.menu.classList.remove("gpf-full-container"),this.menu.classList.remove("gpf-accordion--opened"),i.classList.add("GPelementHidden")))}onClickButtonValidate(e){this.setName(this.inputName.value),this.setDescription(this.inputDesc.value),this.buttonOptions.click()}onClickButtonCancel(e){this.inputName.value="",this.inputDesc.value="",this.buttonOptions.click()}getContainer(){return this.container}setControl(e){this.options.control=e}setTarget(e){this.options.target=e}setFormat(e){switch(this.options.format=e.toUpperCase(),this.options.format){case"KML":this.extension=".kml",this.mimeType="application/vnd.google-earth.kml+xml";break;case"GPX":this.extension=".gpx",this.mimeType="application/gpx+xml";break;case"GEOJSON":this.extension=".geojson",this.mimeType="application/geo+json";break;default:this.options.format="GEOJSON",this.extension=".geojson",this.mimeType="application/geo+json";break}}setName(e){this.options.name=e}setDescription(e){this.options.description=e}setTitle(e){this.options.title=e,this.button&&(this.button.textContent=this.options.menu?this.options.icons.menu+e:e)}setKind(e){if(this.options.kind=e,this.button)switch(this.button.classList.remove("fr-btn--tertiary","gpf-btn--tertiary"),this.button.classList.remove("fr-btn--secondary","gpf-btn--secondary"),this.options.kind){case"tertiary":this.button.classList.add("fr-btn--tertiary","gpf-btn--tertiary");break;case"secondary":this.button.classList.add("fr-btn--secondary","gpf-btn--secondary");break;case"primary":default:this.button.classList.add("fr-btn--primary","gpf-btn--primary");break}}setMenu(e){if(this.options.menu=e,this.button&&(this.button.textContent=this.options.menu?this.options.icons.menu+this.options.title:this.options.title),this.menu&&this.options.menu){var i=this.menu.className;this.menu.className=i.replace(this.menuClassHidden,"");var n=this.options.format.toUpperCase(),o=this.menu.querySelectorAll('input[type=radio][name="format"]');for(let c=0;c<o.length;c++){var l=o[c];l.id.toUpperCase().includes(n)&&(l.checked=!0)}}}setMenuOptions(e){}setLayer(e){this.options.layer=e}setDownload(e){this.options.download=e}}Object.assign(ButtonExport.prototype,ExportDOM);Object.assign(ButtonExport.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.Export=ButtonExport);var logger$p=LoggerByDefault.getLogger("RouteDOM"),RouteDOM={_addUID:function(s){var e=this._uid?s+"-"+this._uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GProute"),s.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",s},_createShowRoutePictoElement:function(){var s=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowRoutePicto"),e.classList.add("GPshowOpen","GPshowAdvancedToolPicto","GPshowRoutePicto"),e.classList.add("gpf-btn","gpf-btn--tertiary","gpf-btn-icon","gpf-btn-icon-route"),e.classList.add("fr-btn","fr-btn--tertiary"),e.setAttribute("aria-label","Ouvrir le calcul d'itinraire"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowRoutePanelClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowRoutePanelClick(n)}),e},_createRoutePanelElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GProutePanel"),s.className="GPpanel gpf-panel fr-modal",s},_createRoutePanelDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__body fr-modal__body",s},_createDrawingButtonsPluginDiv:function(){var s=document.createElement("div");return s.className="container-buttons-plugin fr-mx-2w",s},_createRoutePanelHeaderElement:function(){var s=this,e=document.createElement("div");e.className="GPpanelHeader gpf-panel__header fr-modal__header";var i=document.createElement("div");i.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",i.innerHTML="Calcul d'itinraire",e.appendChild(i);var n=document.createElement("button");n.id=this._addUID("GProutePanelClose"),n.className="GPpanelClose GProutePanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",n.title="Masquer le panneau",n.addEventListener?n.addEventListener("click",function(){document.getElementById(s._addUID("GPshowRoutePicto")).click()},!1):n.attachEvent&&n.attachEvent("onclick",function(){document.getElementById(s._addUID("GPshowRoutePicto")).click()});var o=document.createElement("span");return o.className="GPelementHidden gpf-visible",o.innerText="Fermer",n.appendChild(o),e.appendChild(n),e},_createRoutePanelFooterElement:function(){var s=document.createElement("div");return s.className="GPpanelFooter gpf-panel__footer fr-modal__footer",s},_createRoutePanelFormPointLabel:function(s,e=!0){var i=document.createElement("p");i.innerHTML=s;var n=e?"":" GPelementHidden gpf-hidden";return i.className="GProutePointLabelP gpf-label fr-label"+n,i},_createRoutePanelFormElement:function(){var s=this,e=document.createElement("form");return e.id=this._addUID("GProuteForm"),e.className="gpf-panel__content fr-modal__content",e.setAttribute("onkeypress","return event.keyCode != 13;"),e.addEventListener("submit",function(i){logger$p.log(i),i.preventDefault();var n=document.getElementsByClassName(s._addUID("GPlocationPoint")),o=n[0].childNodes[0].id,l=n[n.length-1].childNodes[0].id,c=SelectorID.index(o),u=SelectorID.index(l);if(document.getElementById(s._addUID("GPlocationOrigin_"+c)).value===""&&document.getElementById(s._addUID("GPlocationOriginCoords_"+c)).value===""||document.getElementById(s._addUID("GPlocationOrigin_"+u)).value===""&&document.getElementById(s._addUID("GPlocationOriginCoords_"+u)).value==="")return!1;s._addRouteResultsStagesValuesElement(n);var h=null;document.getElementById(s._addUID("GProuteComputationChoice"))&&(document.getElementById(s._addUID("GProuteComputationFastest"))&&document.getElementById(s._addUID("GProuteComputationFastest")).checked&&(h=document.getElementById(s._addUID("GProuteComputationFastest")).value),document.getElementById(s._addUID("GProuteComputationShortest"))&&document.getElementById(s._addUID("GProuteComputationShortest")).checked&&(h=document.getElementById(s._addUID("GProuteComputationShortest")).value));var f=null;document.getElementById(s._addUID("GProuteTransportCar"))&&document.getElementById(s._addUID("GProuteTransportCar")).checked&&(f=document.getElementById(s._addUID("GProuteTransportCar")).value),document.getElementById(s._addUID("GProuteTransportPedestrian"))&&document.getElementById(s._addUID("GProuteTransportPedestrian")).checked&&(f=document.getElementById(s._addUID("GProuteTransportPedestrian")).value);for(var g=[],H=document.getElementsByClassName("GProuteExclusionsOption"),Y=0;Y<H.length;Y++){var ee=H[Y].htmlFor,te=document.getElementById(ee);te.checked||g.push(te.value)}return s.onRouteComputationSubmit({computation:h,transport:f,exclusions:g}),!1}),e},_createRoutePanelResultsElement:function(){var s=document.createElement("div");return s.id=this._addUID("GProuteResultsPanel"),s.className="GPelementHidden gpf-hidden",s.appendChild(this._createRouteResultsStagesElement()),s.appendChild(this._createRouteResultsElement()),s.appendChild(this._createRouteShowResultsDetailsElement()),s.appendChild(this._createRouteResultsDetailsElement()),s},_createRouteWaitingElement:function(){var s=document.createElement("div");s.id=this._addUID("GProuteCalcWaitingContainer"),s.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden";var e=document.createElement("p");return e.className="GPwaitingContainerInfo gpf-waiting_info",e.innerHTML="Recherche en cours...",s.appendChild(e),s},_createRouteResultsStagesElement:function(){var s=document.createElement("div");return s.id=this._addUID("GProuteResultsStages"),s},_addRouteResultsStagesValuesElement:function(s){document.getElementById(this._addUID("GProuteResultsStages")).innerHTML="";for(var e=0;e<s.length;e++){var i=s[e].childNodes[0].id,n=SelectorID.index(i);if(document.getElementById(this._addUID("GPlocationPoint_"+n)).className==="GPflexInput GPlocationStageFlexInput gpf-flex"){var o=document.createElement("div");o.className="GProuteResultsStages fr-my-1w";var l=document.createElement("span");l.className="GProuteResultStageLabel",l.innerHTML=document.getElementById(this._addUID("GPlocationOriginLabel_"+n)).innerHTML+" : ",o.appendChild(l);var c=document.createElement("span");c.className="GProuteResultStageValue";var u=document.getElementById(this._addUID("GPlocationOriginCoords_"+n)),h=u.value;h!==null&&h!==""?c.innerHTML=h:c.innerHTML=document.getElementById(this._addUID("GPlocationOrigin_"+n)).value,o.appendChild(c),c.innerHTML!==""&&document.getElementById(this._addUID("GProuteResultsStages")).appendChild(o)}}},_createRouteResultsElement:function(){var s=this,e=document.createElement("div");e.id=this._addUID("GProuteResults");var i=document.createElement("div");i.id=this._addUID("GProuteResultsValues"),e.appendChild(i);var n=document.createElement("div");n.id=this._addUID("GProuteResultsMode");var o=document.createElement("select");o.id=this._addUID("GProuteResultsComputationSelect"),o.className="GPselect gpf-select fr-select",o.addEventListener("change",function(f){s.onRouteModeComputationChangeAndRun(f)});for(var l=[{code:"fastest",label:"Plus rapide"},{code:"shortest",label:"Plus court"}],c=0;c<l.length;c++){var u=document.createElement("option");u.value=l[c].code,u.text=l[c].label,o.appendChild(u)}n.appendChild(o),e.appendChild(n);var h=document.createElement("div");return h.id=this._addUID("GProuteResultsNew"),h.className="GPresetPicto gpf-btn gpf-btn-icon-reset fr-btn fr-btn--secondary gpf-btn--secondary",h.title="Modifier le calcul",h.addEventListener("click",function(f){document.getElementById(s._addUID("GProuteResultsPanel")).className="GPelementHidden gpf-hidden",document.getElementById(s._addUID("GProuteForm")).className="gpf-panel__content fr-modal__content",s.onShowRouteResultsNewClick(f)}),e.appendChild(h),e},_addRouteResultsValuesElement:function(s,e,i){var n=document.getElementById(this._addUID("GProuteResultsValues"));if(n.childElementCount)for(;n.firstChild;)n.removeChild(n.firstChild);var o=document.createElement("div");o.className="GProuteResultsValue";var l=document.createElement("label");l.className="GProuteResultsValueLabel",l.innerHTML="Distance :",o.appendChild(l);var c=0,u=parseInt(s/1e3,10);if(!u)c=Math.round(s)+" m";else{var h=Math.round(s);h=h/1e3,c=h+" km"}var f=document.createElement("div");f.id=this._addUID("GProuteResultsValueDist"),f.innerHTML=c,o.appendChild(f),n.appendChild(o);var g=document.createElement("div");g.className="GProuteResultsValue";var H=document.createElement("label");H.className="GProuteResultsValueLabel",H.innerHTML="Dure :",g.appendChild(H);var Y=document.createElement("div");return Y.id=this._addUID("GProuteResultsValueDist"),Y.innerHTML=i(e),g.appendChild(Y),n.appendChild(g),n},_createRouteShowResultsDetailsElement:function(){var s=document.createElement("div");if(s.className="GProuteResultsShowDetailsDiv gpf-flex fr-checkbox-group fr-m-1w",!checkDsfr()){var e=document.createElement("div");e.className="GPfakeBorder GPfakeBorderLeft",s.appendChild(e)}var i=document.createElement("input");i.id=this._addUID("GProuteResultsShowDetails"),i.type="checkbox",s.appendChild(i);var n=document.createElement("label");if(n.className="gpf-label fr-label",n.htmlFor=this._addUID("GProuteResultsShowDetails"),n.innerHTML="Afficher le dtail",s.appendChild(n),!checkDsfr()){var o=document.createElement("label");o.htmlFor=this._addUID("GProuteResultsShowDetails"),o.innerHTML="Masquer le dtail",s.appendChild(o);var l=document.createElement("div");l.className="GPfakeBorder",s.appendChild(l)}return s},_createRouteResultsDetailsElement:function(){var s=document.createElement("div");return s.id=this._addUID("GProuteResultsDetails"),s},_addRouteResultsDetailsElement:function(s,e){var i=this,n=document.getElementById(this._addUID("GProuteResultsDetails"));if(n.childElementCount)for(;n.firstChild;)n.removeChild(n.firstChild);for(var o=0,l=0,c=0;c<s.length;c++){var u=c+1,h=s[c],f=document.createElement("div");f.className="GProuteResultsDetailsNumber",f.innerHTML=u+".",n.appendChild(f),l+=parseFloat(h.duration),o+=parseFloat(h.distance);var g=0,H=parseInt(o/1e3,10);if(!H)g=Math.round(o)+" m";else{var Y=Math.round(o);Y=Y/1e3,g=Y+" km"}var ee=document.createElement("div");ee.className="GProuteResultsDetailsInstruction",ee.id=this._addUID("GProuteResultsDetailsInstruction_"+u),ee.title="distance : "+g+" / temps : "+e(l),ee.innerHTML=h.instruction,ee.addEventListener("mouseover",function(te){i.onRouteResultsDetailsMouseOver(te)}),ee.addEventListener("mouseout",function(te){i.onRouteResultsDetailsMouseOut(te)}),ee.addEventListener("click",function(te){typeof i.onRouteResultsDetailsClick=="function"&&i.onRouteResultsDetailsClick(te)}),n.appendChild(ee)}return n},_createRoutePanelFormPointElement:function(s,e,i){var n=this,o=document.createElement("div");o.id="GProutePoint"+s,o.className=i?"GPflexInput GProuteStageFlexInput":"GPflexInput GProuteStageFlexInputHidden";var l=document.createElement("label");l.id="GProuteOriginLabel"+s,l.htmlFor="GProuteOrigin"+s,l.innerHTML=e,l.addEventListener("click",function(){var g=this.id.charAt(this.id.length-1);document.getElementById("GProuteOriginCoords"+g).value="";for(var H=1;H<8;H++)document.getElementById("GProutePoint"+H).style.display="flex";document.getElementById("GProuteForm").className="gpf-panel__content fr-modal__content",document.getElementById("GProuteOriginPointer"+g).checked=!1,document.getElementById("GProuteOrigin"+g).className="GPelementVisible gpf-visible",document.getElementById("GProuteOriginCoords"+g).className="GPelementHidden gpf-hidden"}),o.appendChild(l);var c=document.createElement("input");c.id="GProuteOrigin"+s,c.className="GPelementVisible gpf-visible",c.type="text",c.placeholder="Saisir une adresse, un lieu...",c.addEventListener("keyup",function(g){var H=g.which||g.keyCode;if(!(H===13||H===10)){var Y=this.id.charAt(this.id.length-1);document.getElementById("GProuteOrigin"+Y).value.length>2?document.getElementById("GProuteAutoCompleteList"+Y).style.display="block":document.getElementById("GProuteAutoCompleteList"+Y).style.display="none",n.onAutoCompleteSearchText(g)}}),c.addEventListener("blur",function(){var g=this.id.charAt(this.id.length-1);document.getElementById("GProuteAutoCompleteList"+g).style.display="none"}),o.appendChild(c);var u=document.createElement("input");u.id="GProuteOriginCoords"+s,u.className="GPelementHidden gpf-hidden",u.type="text",u.disabled=!0,o.appendChild(u);var h=document.createElement("input");h.id="GProuteOriginPointer"+s,h.type="checkbox",o.appendChild(h);var f=document.createElement("label");return f.id="GProuteOriginPointerImg"+s,f.htmlFor="GProuteOriginPointer"+s,f.className="GProuteOriginPointerImg",f.title="Pointer un lieu sur la carte",f.addEventListener("click",function(g){g.preventDefault(),g.stopPropagation();var H=this.id.charAt(this.id.length-1),Y;for(Y=1;Y<8;Y++)H!==Y&&(document.getElementById("GProuteOriginPointer"+Y).checked=!1,document.getElementById("GProuteOriginCoords"+Y).value==="Pointer un lieu sur la carte"&&(document.getElementById("GProuteOriginCoords"+Y).value="",document.getElementById("GProuteOrigin"+Y).className="GPelementVisible gpf-visible",document.getElementById("GProuteOriginCoords"+Y).className="GPelementHidden gpf-hidden"));if(document.getElementById("GProuteOriginPointer"+H).checked){for(document.getElementById("GProuteOriginCoords"+H).value="",Y=1;Y<8;Y++)document.getElementById("GProutePoint"+Y).style.display="flex";document.getElementById("GProuteForm").className="gpf-panel__content fr-modal__content",document.getElementById("GProuteOriginPointer"+H).checked=!1,document.getElementById("GProuteOrigin"+H).className="GPelementVisible gpf-visible",document.getElementById("GProuteOriginCoords"+H).className="GPelementHidden gpf-hidden"}else{for(document.getElementById("GProuteOriginCoords"+H).value="Pointer un lieu sur la carte",Y=1;Y<8;Y++)H===Y?document.getElementById("GProutePoint"+Y).style.display="flex":document.getElementById("GProutePoint"+Y).style.display="none";document.getElementById("GProuteForm").className="GProuteFormMini gpf-panel__content fr-modal__content",document.getElementById("GProuteOriginPointer"+H).checked=!0,document.getElementById("GProuteOrigin"+H).className="GPelementHidden gpf-hidden",document.getElementById("GProuteOriginCoords"+H).className="GPelementVisible gpf-visible"}n.onRouteMapPointClick(g)}),o.appendChild(f),o},_createRoutePanelFormRemoveStageElement:function(s){var e=this,i=document.createElement("div");return i.id="GProuteStageRemove"+s,i.className="GProuteStageRemove",i.title="Supprimer l'tape",s!==1&&s!==7&&i.addEventListener("click",function(n){var o=this.id.charAt(this.id.length-1);document.getElementById("GProutePoint"+o).className="GPflexInput GProuteStageFlexInputHidden",document.getElementById("GProuteOrigin"+o).value="",document.getElementById("GProuteOrigin"+o).className="GPelementVisible gpf-visible",document.getElementById("GProuteOriginCoords"+o).value="",document.getElementById("GProuteOriginCoords"+o).className="GPelementHidden gpf-hidden",document.getElementById("GProuteStageAdd").style.display="",e.onRouteRemovePointClick(n)}),i},_createRoutePanelFormAddStageElement:function(){var s=this,e=document.createElement("div");return e.id="GProuteStageAdd",e.title="Ajouter une tape",e.addEventListener("click",function(i){for(var n=1,o=0,l=2;l<7;l++)document.getElementById("GProutePoint"+l).className==="GPflexInput GProuteStageFlexInputHidden"?n===1&&(n=l):o++;n<7&&(document.getElementById("GProutePoint"+n).className="GPflexInput GProuteStageFlexInput"),o===4&&(document.getElementById("GProuteStageAdd").style.display="none"),s.onRouteAddPointClick(i)}),e},_createRoutePanelFormAutoCompleteListElement:function(s){var e=this,i=document.createElement("div");return i.id="GProuteAutoCompleteList"+s,i.className="GPadvancedAutoCompleteList",i.addEventListener?i.addEventListener("click",function(n){e.onAutoCompletedResultsItemClick(n),document.getElementById("GProuteAutoCompleteList"+s).style.display="none"},!1):i.attachEvent&&i.attachEvent("onclick",function(n){e.onAutoCompletedResultsItemClick(n),document.getElementById("GProuteAutoCompleteList"+s).style.display="none"}),i},_createRouteAutoCompletedLocationElement:function(s,e,i){var n=document.getElementById("GProuteAutoCompleteList"+e),o=document.createElement("div");o.id="AutoCompletedLocation"+i,o.className="GPautoCompleteProposal",o.innerHTML=GeocodeUtils.getSuggestedLocationFreeform(s),n.appendChild(o)},_createRoutePanelFormModeChoiceTransportElement:function(s){var e=this,i=document.createElement("div");i.id=this._addUID("GProuteTransportChoice");var n=document.createElement("label");n.className="GProuteModeLabel gpf-label fr-label",n.innerHTML="Choisir un mode de dplacement",i.appendChild(n);var o=document.createElement("div");o.className="gpf-radio-btn-group";for(var l=0;l<s.length;l++){var c=s[l],u=document.createElement("div");if(u.className="GProuteTransportChoice gpf-flex gpf-radio-group fr-radio-group fr-my-1w",c==="Voiture"){var h=document.createElement("input");h.id=this._addUID("GProuteTransportCar"),h.type="radio",h.name="GProuteTransport",h.value="Voiture",l===0&&(h.checked=!0),h.addEventListener?h.addEventListener("change",function(Y){e.onRouteModeTransportChange(Y)}):h.attachEvent&&h.attachEvent("onchange",function(Y){e.onRouteModeTransportChange(Y)}),u.appendChild(h);var f=document.createElement("label");f.className="GProuteTransportImg gpf-label fr-label",f.htmlFor=this._addUID("GProuteTransportCar"),f.title="Voiture",f.innerHTML="Voiture",u.appendChild(f)}if(c==="Pieton"){var g=document.createElement("input");g.id=this._addUID("GProuteTransportPedestrian"),g.type="radio",g.name="GProuteTransport",g.value="Pieton",l===0&&(g.checked=!0),g.addEventListener?g.addEventListener("change",function(Y){e.onRouteModeTransportChange(Y)}):g.attachEvent&&g.attachEvent("onchange",function(Y){e.onRouteModeTransportChange(Y)}),u.appendChild(g);var H=document.createElement("label");H.className="GProuteTransportImg gpf-label fr-label",H.htmlFor=this._addUID("GProuteTransportPedestrian"),H.title="Piton",H.innerHTML="Piton",u.appendChild(H)}o.appendChild(u)}return i.appendChild(o),i},_createRoutePanelFormModeChoiceComputeElement:function(){var s=this,e=document.createElement("div");e.id=this._addUID("GProuteComputationChoice"),e.className="fr-mt-2w";var i=document.createElement("label");i.className="GProuteComputationLabel gpf-label fr-label",i.innerHTML="Mode de calcul",e.appendChild(i);var n=document.createElement("div");n.className="gpf-radio-btn-group";var o=document.createElement("div");o.className="GProuteComputationChoice gpf-flex gpf-radio-group fr-radio-group fr-my-1w";var l=document.createElement("input");l.id=this._addUID("GProuteComputationFastest"),l.type="radio",l.name="GProuteComputation",l.value="fastest",l.checked=!0,l.addEventListener?l.addEventListener("change",function(g){s.onRouteModeComputationChange(g)}):l.attachEvent&&l.attachEvent("onchange",function(g){s.onRouteModeComputationChange(g)}),o.appendChild(l);var c=document.createElement("label");c.className="gpf-label fr-label",c.htmlFor=this._addUID("GProuteComputationFastest"),c.title="Plus rapide",c.innerHTML="Plus rapide",o.appendChild(c),n.appendChild(o);var u=document.createElement("div");u.className="GProuteComputationChoice gpf-flex gpf-radio-group fr-radio-group fr-my-1w";var h=document.createElement("input");h.id=this._addUID("GProuteComputationShortest"),h.type="radio",h.name="GProuteComputation",h.value="shortest",h.addEventListener?h.addEventListener("change",function(g){s.onRouteModeComputationChange(g)}):h.attachEvent&&h.attachEvent("onchange",function(g){s.onRouteModeComputationChange(g)}),u.appendChild(h);var f=document.createElement("label");return f.className="gpf-label fr-label",f.htmlFor=this._addUID("GProuteComputationShortest"),f.title="Plus court",f.innerHTML="Plus court",u.appendChild(f),n.appendChild(u),e.appendChild(n),e},_createShowRouteExclusionsPictoElement:function(){var s=this,e=document.createElement("button");e.id=this._addUID("GPshowRouteExclusionsPicto");var i="";return checkDsfr()&&(i="GPelementHidden gpf-hidden"),e.className=`GPshowAdvancedToolPicto GPshowMoreOptionsImage GPshowMoreOptions GPshowRouteExclusionsPicto ${i} gpf-btn fr-btn--sm fr-btn--tertiary gpf-btn--tertiary fr-icon-arrow-down-fill`,e.title="Exclusions",e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!0),e.addEventListener?e.addEventListener("click",function(n){n.preventDefault();var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowRouteExclusionsClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){n.preventDefault();var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowRouteExclusionsClick(n)}),e},_createRoutePanelFormExclusionsElement:function(){var s=document.createElement("div");s.id=this._addUID("GProuteExclusions"),s.className="fr-mt-2w";var e=document.createElement("label");return e.className="GProuteExclusionsLabel fr-label",e.innerHTML="Passages autoriss",s.appendChild(e),s},_createRoutePanelFormExclusionOptionsElement:function(s){var e=this,i=document.createElement("div");i.className="GProuteExclusionsOptions gpf-flex fr-checkbox-group fr-m-1w";for(var n in s)if(s.hasOwnProperty(n)){var o=s[n];switch(n){case"toll":var l=document.createElement("input");l.id=this._addUID("GProuteExclusionsToll"),l.type="checkbox",l.value="Toll",l.name="Peage",l.checked=!o,l.addEventListener?l.addEventListener("change",function(H){e.onRouteExclusionsChange(H)}):l.attachEvent&&l.attachEvent("onchange",function(H){e.onRouteExclusionsChange(H)}),i.appendChild(l);var c=document.createElement("label");c.className="GProuteExclusionsOption",c.htmlFor=this._addUID("GProuteExclusionsToll"),c.innerHTML="Pages",i.appendChild(c);break;case"tunnel":var u=document.createElement("input");u.id=this._addUID("GProuteExclusionsTunnel"),u.type="checkbox",u.value="Tunnel",u.name="Tunnel",u.checked=!o,u.addEventListener?u.addEventListener("change",function(H){e.onRouteExclusionsChange(H)}):u.attachEvent&&u.attachEvent("onchange",function(H){e.onRouteExclusionsChange(H)}),i.appendChild(u);var h=document.createElement("label");h.className="GProuteExclusionsOption",h.htmlFor=this._addUID("GProuteExclusionsTunnel"),h.innerHTML="Tunnels",i.appendChild(h);break;case"bridge":var f=document.createElement("input");f.id=this._addUID("GProuteExclusionsBridge"),f.type="checkbox",f.value="Bridge",f.name="Ponts",f.checked=!o,f.addEventListener?f.addEventListener("change",function(H){e.onRouteExclusionsChange(H)}):f.attachEvent&&f.attachEvent("onchange",function(H){e.onRouteExclusionsChange(H)}),i.appendChild(f);var g=document.createElement("label");g.className="GProuteExclusionsOption",g.htmlFor=this._addUID("GProuteExclusionsBridge"),g.innerHTML="Ponts",i.appendChild(g);break}}return i},_createRouteSubmitFormElement:function(){var s=document.createElement("input");return s.id=this._addUID("GProuteSubmit"),s.className="GPsubmit gpf-btn gpf-btn-icon-submit fr-btn",s.type="submit",s.value="Calculer l'itinraire",s},_createRouteFormResetElement:function(){var s=this,e=document.createElement("button");return e.id=this._addUID("GProuteReset"),e.title="Rinitialiser les paramtres",e.className="GPresetPicto gpf-btn gpf-btn-icon-reset fr-btn fr-btn--secondary gpf-btn--secondary",e.title="Rinitialiser les paramtres",e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.addEventListener("click",function(i){var n=i.target.ariaPressed==="true";i.target.setAttribute("aria-pressed",!n),s.onRouteResetClick(i)}),e}},logger$o=LoggerByDefault.getLogger("route");class Route extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof Route))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="Route",this.initialize(e),this._container=this._createMainContainerElement(),this.element?this.element.appendChild(this._container):this.element=this._container,this}setMap(e){if(e){if(this._container=this._initContainer(e),this.element=this._container,this.options.export){var i=Helper.assign({control:this},this.options.export);this.export=new ButtonExport(i),this.export.render();var n=this;this.export.on("button:clicked",o=>{n.dispatchEvent({type:"export:compute",content:o.content})})}this.draggable&&Draggable.dragElement(this._panelRouteContainer,this._panelHeaderRouteContainer,e.getTargetElement()),this.collapsed||this._showRouteButton.setAttribute("aria-pressed",!0)}super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getCollapsed(){return this.collapsed}setCollapsed(e){if(e===void 0){logger$o.log("[ERROR] Route:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(e?document.getElementById("GProutePanelClose-"+this._uid).click():this._showRouteButton.click(),this.collapsed=e)}getLayer(){return this._geojsonSections}setLayer(e){if(!e){this._geojsonSections=null;return}if(!(e instanceof VectorLayer)){logger$o.log("no valid layer given for hosting drawn features.");return}e.setStyle(this._defaultFeatureStyle),this._geojsonSections=e}getGeoJSON(){return JSON.stringify(this._geojsonObject)}setGeoJSON(e){try{this._geojsonObject=JSON.parse(e)}catch(i){logger$o.log("no valid geojson given :"+i.message)}}getData(){var e=[];for(let n=0;n<this._currentPoints.length;n++){const o=this._currentPoints[n];e.push(o.getCoordinate())}var i={type:"route",points:e,transport:this._currentTransport,exclusions:this._currentExclusions,computation:this._currentComputation,results:{}};return Helper.assign(i.results,this._currentRouteInformations),i}setData(e){this._currentTransport=e.transport,this._currentComputation=e.computation,this._currentExclusions=e.exclusions;for(var i=0;i<e.points.length;i++){const u=e.points[i];u&&this._currentPoints[i].setCoordinate(u,"EPSG:4326")}for(var n=0;n<this._currentPoints.length;n++){var o=this._currentPoints[n];if(o.getCoordinate()){var l=n+1+"-"+this._uid,c=o.getCoordinate()[1].toFixed(4)+" / "+o.getCoordinate()[0].toFixed(4);document.getElementById("GPlocationOriginCoords_"+l).value=c,document.getElementById("GPlocationOrigin_"+l).value=c,n>0&&n<6&&(document.getElementById("GPlocationPoint_"+l).className="GPflexInput GPelementHidden gpf-flex gpf-hidden ")}}this._currentRouteInformations=e.results}getContainer(){return this._container}getStyle(){return this._defaultFeatureStyle}init(){for(let ee=0;ee<this._currentPoints.length;ee++){const te=this._currentPoints[ee];var e=ee+1,i=te.getCoordinate();if(i){var n=document.getElementById("GPlocationOrigin_"+e+"-"+this._uid);n.value=i[1].toFixed(4)+" / "+i[0].toFixed(4),ee>0&&ee<6&&(document.getElementById("GPlocationPoint_"+e+"-"+this._uid).className="GPflexInput GPlocationStageFlexInput gpf-flex")}}var o=document.getElementsByClassName("GPlocationPoint-"+this._uid);this._addRouteResultsStagesValuesElement(o);var l;this._currentTransport==="Pieton"?(l=document.getElementById("GProuteTransportPedestrian-"+this._uid),l&&(l.checked="true")):(l=document.getElementById("GProuteTransportCar-"+this._uid),l&&(l.checked="true"));var c=document.getElementById("GProuteComputationSelect-"+this._uid);c&&(c.value=this._currentComputation);var u=document.getElementById("GProuteExclusionsToll-"+this._uid);u&&(this._currentExclusions.indexOf("toll")!==-1?u.checked=!1:u.checked=!0);var h=document.getElementById("GProuteExclusionsTunnel-"+this._uid);h&&(this._currentExclusions.indexOf("tunnel")!==-1?h.checked=!1:h.checked=!0);var f=document.getElementById("GProuteExclusionsBridge-"+this._uid);f&&(this._currentExclusions.indexOf("bridge")!==-1?f.checked=!1:f.checked=!0);var g=this._currentRouteInformations.totalDistance,H=this._currentRouteInformations.totalTime,Y=this._simplifiedInstructions(this._currentRouteInformations.routeInstructions);Y&&this._fillRouteResultsDetailsContainer(g,H,Y),this._formRouteContainer.className="GPelementHidden gpf-hidden gpf-panel__content fr-modal__content",this._hideWaitingContainer(),this._resultsRouteContainer.className=""}clean(){this._currentTransport=null,this._currentExclusions=[],this._currentComputation=null;for(var e=0;e<this._currentPoints.length;e++)this._currentPoints[e].clear();this._removeRouteStepLocations(),this._clearRouteInputOptions(),this._clearRouteResultsDetails(),this.setLayer(),this._formRouteContainer.className="gpf-panel__content fr-modal__content",this._resultsRouteContainer.className="GPelementHidden gpf-hidden"}initialize(e){this._checkInputOptions(e),this.options={collapsed:!0,draggable:!1,export:!1,graphs:["Pieton","Voiture"],exclusions:{toll:!1,tunnel:!1,bridge:!1},routeOptions:{},autocompleteOptions:{},layerDescription:{title:"Itinraire",description:"Itinraire bas sur un graphe"}},Helper.assign(this.options,e);var i={departure:{url:Marker.red,offset:Marker.defaultOffset},stages:{url:Marker.lightOrange,offset:Marker.defaultOffset},arrival:{url:Marker.darkOrange,offset:Marker.defaultOffset}};this.options.markersOpts=Helper.assign(i,e.markersOpts),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this._uid=this.options.id||SelectorID.generate(),this._showRouteButton=null,this._panelRouteContainer=null,this._panelHeaderRouteContainer=null,this._waitingContainer=null,this._formRouteContainer=null,this._resultsRouteContainer=null,this._showRouteExclusionsElement=null,this._currentPoints=[],this._currentTransport=null,this._initTransport(),this._currentComputation=null,this._initComputation(),this._currentExclusions=[],this._initExclusions(),this._waiting=!1,this._timer=null,this._geojsonRoute=null,this._geojsonSections=null,this._geojsonObject=null,this.export=null,this._popupContent=null,this._popupDiv=this._initPopupDiv(),this._popupOverlay=null,this._resultsSelectInteraction=null,this._resultsHoverInteraction=null,this._defaultFeatureStyle=new Style$1({stroke:new Stroke({color:"rgba(0,183,152,0.9)",width:12})}),this._selectedFeatureStyle=new Style$1({stroke:new Stroke({color:"rgba(255,102,0,0.9)",width:12})}),this._currentRouteInformations=null,this._resources={},this.listenerKey=null}_checkInputOptions(e){if(e.graphs)if(Array.isArray(e.graphs)&&e.graphs.length)for(var i=0;i<e.graphs.length;i++)typeof e.graphs[i]=="string"?(e.graphs[i].toLowerCase()==="pieton"&&(e.graphs[i]="Pieton"),e.graphs[i].toLowerCase()==="voiture"&&(e.graphs[i]="Voiture")):(logger$o.log("[ol.control.Route] ERROR : parameter 'graphs' elements should be of type 'string'"),e.graphs[i]=null);else logger$o.warn("'graphs' parameter should be an array"),e.graphs=null;e.collapsed==="true"&&(e.collapsed=!0),e.collapsed==="false"&&(e.collapsed=!1)}_initContainer(e){var i=this._container;if(i.childElementCount>0)return i;var n=this._showRouteButton=this._createShowRoutePictoElement();i.appendChild(n);var o=this._panelRouteContainer=this._createRoutePanelElement(),l=this._createRoutePanelDivElement();o.appendChild(l);var c=this._panelHeaderRouteContainer=this._createRoutePanelHeaderElement();l.appendChild(c);var u=this._formRouteContainer=this._createRoutePanelFormElement();u.appendChild(this._createRoutePanelFormModeChoiceTransportElement(this.options.graphs));for(var h=this._createRoutePanelFormPointsElement(e),f=0;f<h.length;f++)u.appendChild(h[f]);u.appendChild(this._createRoutePanelFormModeChoiceComputeElement()),this._showRouteExclusionsElement=this._createShowRouteExclusionsPictoElement(),u.appendChild(this._showRouteExclusionsElement);var g=this._createRoutePanelFormExclusionsElement();g.appendChild(this._createRoutePanelFormExclusionOptionsElement(this.options.exclusions)),u.appendChild(g);var H=this._createRoutePanelFooterElement();if(u.appendChild(H),!checkDsfr()){var Y=this._createRouteFormResetElement();H.appendChild(Y)}var ee=this._createRouteSubmitFormElement();H.appendChild(ee),l.appendChild(u);var te=this._resultsRouteContainer=this._createRoutePanelResultsElement();l.appendChild(te);var xe=this._createDrawingButtonsPluginDiv();l.appendChild(xe);var ne=this._waitingContainer=this._createRouteWaitingElement();return l.appendChild(ne),i.appendChild(o),i.addEventListener&&i.addEventListener("click",et=>this._hideRouteSuggestedLocations(et)),i}_initTransport(){this._currentTransport="Pieton";var e=this.options.graphs;(!e||e.length===0)&&(this.options.graphs=["Pieton","Voiture"]),Array.isArray(e)&&e.length&&(e[0]==="Voiture"||e[0]==="Pieton")&&(this._currentTransport=e[0]);var i=this.options.routeOptions;i.graph&&(this._currentTransport=i.graph)}_initComputation(){this._currentComputation="fastest";var e=this.options.routeOptions;e.routePreference&&(this._currentComputation=e.routePreference)}_initExclusions(){this._currentExclusions=[];var e=this.options.exclusions;if((!e||typeof e=="object"&&Object.keys(e).length===0)&&(this.options.exclusions={toll:!1,tunnel:!1,bridge:!1}),e&&typeof e=="object"&&Object.keys(e).length)for(var i in e)e.hasOwnProperty(i)&&e[i]&&this._currentExclusions.push(i);var n=this.options.routeOptions;Array.isArray(n.exclusions)&&(this._currentExclusions=n.exclusions)}_initPopupDiv(){var e=this,i=document.createElement("div");i.className="gp-feature-info-div";var n=document.createElement("button");return n.className="gp-styling-button closer",n.onclick=function(){return e._popupOverlay!=null&&e._popupOverlay.setPosition(void 0),!1},this._popupContent=document.createElement("div"),this._popupContent.className="gp-features-content-div",i.appendChild(this._popupContent),i.appendChild(n),i}_createRoutePanelFormPointsElement(e){var i=[],n=1,o=new LocationSelector({apiKey:this.options.apiKey||null,tag:{id:n,label:"Dpart",groupId:this._uid,markerOpts:this.options.markersOpts.departure,display:!0},autocompleteOptions:this.options.autocompleteOptions||null});for(o.setMap(e),this._addFormPointsEventListeners(o),i.push(this._createRoutePanelFormPointLabel("Dpart")),i.push(o._container),this._currentPoints.push(o),n=2;n<7;n++){var l=new LocationSelector({apiKey:this.options.apiKey||null,tag:{id:n,label:"Etape "+(n-1),groupId:this._uid,markerOpts:this.options.markersOpts.stages,display:!1,removeOption:!0},autocompleteOptions:this.options.autocompleteOptions||null});l.setMap(e),this._addFormPointsEventListeners(l),i.push(this._createRoutePanelFormPointLabel("tape",!1)),i.push(l._container),this._currentPoints.push(l)}var c=new LocationSelector({apiKey:this.options.apiKey||null,tag:{id:n,label:"Arrive",groupId:this._uid,markerOpts:this.options.markersOpts.arrival,display:!0,addOption:!0},autocompleteOptions:this.options.autocompleteOptions||null});return c.setMap(e),this._addFormPointsEventListeners(c),i.push(this._createRoutePanelFormPointLabel("Arrive")),i.push(c._container),this._currentPoints.push(c),i}_addFormPointsEventListeners(e){e&&(e._buttonLabel.addEventListener?(e._buttonLabel.addEventListener("click",i=>this.onRouteOriginLabelClick(i)),e._inputShowPointer.addEventListener("click",i=>this.onRouteOriginPointerClick(i,e)),e._removePointElement&&e._removePointElement.addEventListener("click",i=>{logger$o.trace("click on _removePointElement",i)}),e._addPointElement&&e._addPointElement.addEventListener("click",i=>{logger$o.trace("click on _addPointElement",i)})):e._buttonLabel.attachEvent&&(e._buttonLabel.attachEvent("onclick",i=>this.onRouteOriginLabelClick(i)),e._inputShowPointer.attachEvent("onclick",i=>this.onRouteOriginPointerClick(i,e)),e._removePointElement&&e._removePointElement.attachEvent("onclick",i=>{}),e._addPointElement&&e._addPointElement.attachEvent("onclick",i=>{})))}onRouteComputationSubmit(e){logger$o.log("onRouteComputationSubmit",e);var i=this._currentPoints,n;if(i[0]&&i[0].getCoordinate){var o=i[0].getCoordinate();n={x:o[0].toFixed(5),y:o[1].toFixed(5)},logger$o.log("start",n)}var l,c=i[i.length-1];if(c&&c.getCoordinate){var u=c.getCoordinate();l={x:u[0].toFixed(5),y:u[1].toFixed(5)},logger$o.log("end",l)}for(var h=[],f=1;f<i.length-1;f++)if(i[f]&&i[f].getCoordinate){var g=i[f].getCoordinate();if(g){var H={x:g[0].toFixed(5),y:g[1].toFixed(5)};logger$o.log("step",H),h.push(H)}}this._currentTransport=e.transport,this._currentComputation=e.computation,this._currentExclusions=e.exclusions;var Y=this.options.routeOptions,ee;Y.resource?ee=Y.resource:this._currentComputation==="fastest"&&this._currentTransport==="Pieton"&&(ee="bdtopo-valhalla");var te=Y.protocol||"XHR",xe=Y.timeOut||0;te==="JSONP"&&xe===0&&(xe=15e3);var ne=Y.onFailure!==null&&typeof Y.onFailure=="function",et=Y.onSuccess!==null&&typeof Y.onSuccess=="function",tt=this;this._requestRouting({startPoint:n,endPoint:l,viaPoints:h,graph:Y.graph||this._currentTransport,routePreference:Y.routePreference||this._currentComputation,exclusions:Y.exclusions||this._currentExclusions,geometryInInstructions:!0,distanceUnit:"m",timeOut:xe,protocol:te,resource:ee,onSuccess:function(it){logger$o.log(it),it&&tt._fillRouteResultsDetails(it),et&&Y.onSuccess.call(tt,it)},onFailure:function(it){tt._hideWaitingContainer(),tt._clearRouteResultsDetails(),logger$o.log(it.message),ne&&Y.onFailure.call(tt,it)}})}onRouteOriginLabelClick(){this._formRouteContainer.className="gpf-panel__content gpf-mobile-form fr-modal__content",unByKey(this.listenerKey),this.dispatchEvent("route:drawend")}onRouteOriginPointerClick(e,i){var n=this.getMap();i._inputShowPointerContainer.checked?(this._formRouteContainer.className="GProuteFormMini gpf-panel__content fr-modal__content",e.target.parentElement.parentElement.classList.add("selected"),this.listenerKey=n.on("click",()=>{e.target.parentElement.parentElement.classList.remove("selected"),this._formRouteContainer.className==="GProuteFormMini gpf-panel__content fr-modal__content"&&(this._formRouteContainer.className="gpf-panel__content fr-modal__content"),unByKey(this.listenerKey),this.dispatchEvent("route:drawend")}),this.dispatchEvent("route:drawstart")):(this._formRouteContainer.className="",unByKey(this.listenerKey),this.dispatchEvent("route:drawend"))}onShowRoutePanelClick(e){var i=this._showRouteButton.ariaPressed;i==="true"&&this.onPanelOpen();var n=this.getMap();Interactions.unset(n),!this._geojsonSections&&!this._waiting&&this._clear(),this.collapsed=i!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position)}onRouteModeComputationChange(e){var i=e.target.value;i&&(logger$o.log(i),this._currentComputation=i)}onRouteModeComputationChangeAndRun(e){this.onRouteModeComputationChange(e),this._clearRouteResultsDetails(),this._clearRouteResultsGeometry(),this._clearRouteResultsFeatureGeometry(),this.onRouteComputationSubmit({computation:this._currentComputation,transport:this._currentTransport,exclusions:this._currentExclusions})}onRouteModeTransportChange(e){var i=e.target.value;i&&(this._currentTransport=i)}onShowRouteExclusionsClick(e){logger$o.log("onShowRouteExclusionsClick",e)}onRouteExclusionsChange(e){var i=e.target.value,n=e.target.checked;if(!(!i||typeof i!="string")){i=i.toLowerCase();for(var o=!1,l=null,c=0;c<this._currentExclusions.length;c++)this._currentExclusions[c]===i&&(l=c,o=!0);!o&&!n&&this._currentExclusions.push(i),o&&n&&this._currentExclusions.splice(l,1)}}onRouteResetClick(){for(var e=this._currentPoints,i=0;i<e.length;i++)e[i].clear();this._clear(),this._clearRouteInputOptions()}onShowRouteResultsNewClick(){this._clearRouteResultsDetails(),this._clearRouteResultsGeometry(),this._clearRouteResultsFeatureGeometry(),this.dispatchEvent("route:newresults")}onRouteResultsDetailsMouseOver(e){var i=e.target.id,n=i.substring(i.indexOf("_")+1);if(e.target.classList&&e.target.classList.add("GProuteResultsDetailsInstructionHighlight"),!!this._geojsonSections){var o=this._geojsonSections.getSource().getFeatureById(parseInt(n,10));o.setStyle(this._selectedFeatureStyle)}}onRouteResultsDetailsMouseOut(e){var i=e.target.id,n=i.substring(i.indexOf("_")+1);if(e.target.classList&&e.target.classList.remove("GProuteResultsDetailsInstructionHighlight"),!!this._geojsonSections){var o=this._geojsonSections.getSource().getFeatureById(parseInt(n,10));o.setStyle(null)}}_requestRouting(e){!e||typeof e=="object"&&Object.keys(e).length===0||e.startPoint&&e.endPoint&&(e.apiKey=this.options.routeOptions.apiKey||this.options.apiKey,typeof e.ssl!="boolean"&&(typeof this.options.ssl=="boolean"?e.ssl=this.options.ssl:e.ssl=!0),logger$o.log(e),this._displayWaitingContainer(),Gp.Services.route(e))}_fillRouteResultsDetails(e){var i=e.totalDistance,n=e.totalTime,o=this._simplifiedInstructions(e.routeInstructions);o&&this._fillRouteResultsDetailsContainer(i,n,o);var l=e.routeGeometry;l&&this._fillRouteResultsDetailsGeometry(l,this._defaultFeatureStyle),o&&o[0].geometry&&this._fillRouteResultsDetailsFeatureGeometry(o,this._defaultFeatureStyle);var c=e.bbox;if(c){var u=this.getMap(),h=[c.left,c.bottom,c.right,c.top],f=u.getView().getProjection().getCode();f!=="EPSG:4326"&&(h=transformExtent(h,"EPSG:4326",f)),u.getView().fit(h,u.getSize())}this._currentRouteInformations=e,this.dispatchEvent({type:"route:compute"}),this._formRouteContainer.className="GPelementHidden gpf-hidden gpf-panel__content fr-modal__content",this._hideWaitingContainer(),this._resultsRouteContainer.className=""}_fillRouteResultsDetailsContainer(e,i,n){this._resultsRouteValuesContainer=this._addRouteResultsValuesElement(e,i,MathUtils.convertSecondsToTime),this._resultsRouteDetailsContainer=this._addRouteResultsDetailsElement(n,MathUtils.convertSecondsToTime)}_fillRouteResultsDetailsGeometry(e,i){this._clearRouteResultsGeometry();var n=this.getMap();if(e){var o={type:"FeatureCollection",features:[{type:"Feature",crs:{type:"name",properties:{name:"EPSG:4326"}},geometry:e}]},l=new GeoJSON({defaultDataProjection:"EPSG:4326",defaultStyle:i}),c=l.readFeatures(o,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});this._geojsonRoute=new VectorLayer({source:new VectorSource({features:c}),style:i,title:"Mon Itinraire"}),n.addLayer(this._geojsonRoute)}}_fillRouteResultsDetailsFeatureGeometry(e,i){this._clearRouteResultsFeatureGeometry();var n=this.getMap();this._geojsonObject={type:"FeatureCollection",crs:{type:"name",properties:{name:"EPSG:4326"}},features:[]};for(var o=0;o<e.length;o++){for(var l=e[o],c=o+1,u=l.geometry.coordinates,h=0;h<u.length;h++)typeof u[h][0]=="string"&&(u[h][0]=parseFloat(u[h][0]),u[h][1]=parseFloat(u[h][1]));this._geojsonObject.features.push({type:"Feature",geometry:l.geometry,properties:{popupContent:"("+c+") distance : "+MathUtils.convertDistance(l.distance)+" / temps : "+MathUtils.convertSecondsToTime(l.duration)},id:c})}this._geojsonObject.features.push({type:"Feature",geometry:{type:"Point",coordinates:this._currentPoints[0].getCoordinate()},properties:{description:"Point de dpart","marker-symbol":this.options.markersOpts.departure.url}});for(var f=1;f<this._currentPoints.length-1;f++)if(this._currentPoints[f]&&this._currentPoints[f].getCoordinate){var g=this._currentPoints[f].getCoordinate();g&&this._geojsonObject.features.push({type:"Feature",geometry:{type:"Point",coordinates:g},properties:{description:"Point d'tape","marker-symbol":this.options.markersOpts.stages.url}})}this._geojsonObject.features.push({type:"Feature",geometry:{type:"Point",coordinates:this._currentPoints[this._currentPoints.length-1].getCoordinate()},properties:{description:"Point d'arrive","marker-symbol":this.options.markersOpts.arrival.url}});var H=new GeoJSON({defaultDataProjection:"EPSG:4326",defaultStyle:i}),Y=this.getMap().getView().getProjection().getCode(),ee=H.readFeatures(this._geojsonObject,{dataProjection:"EPSG:4326",featureProjection:Y});this._geojsonSections=new VectorLayer({source:new VectorSource({features:ee}),style:i,opacity:.9,title:"Mon Itinraire"});var te;this._currentTransport==="Pieton"?(te="piton",this._geojsonSections.gpResultLayerId="compute:Pieton$OGC:OPENLS;Itineraire"):(te="voiture",this._geojsonSections.gpResultLayerId="compute:Voiture$OGC:OPENLS;Itineraire"),n.addLayer(this._geojsonSections),n.getControls().forEach(xe=>{if(xe instanceof LayerSwitcher){var ne=this._geojsonSections.gpLayerId;xe._layers[ne].title===ne&&xe.addLayer(this._geojsonSections,{title:this.options.layerDescription.title+" ("+te+")",description:this.options.layerDescription.description})}},this),this._resultsHoverInteraction=new Select({condition:pointerMove,layers:[this._geojsonSections],style:this._selectedFeatureStyle}),this._resultsHoverInteraction.on("select",xe=>this._onResultsFeatureMouseOver(xe)),n.addInteraction(this._resultsHoverInteraction),this._resultsSelectInteraction=new Select({layers:[this._geojsonSections],style:this._selectedFeatureStyle}),this._resultsSelectInteraction.on("select",xe=>this._onResultsFeatureSelect(xe)),n.addInteraction(this._resultsSelectInteraction)}_onResultsFeatureMouseOver(e){if(e.selected.length!==0){var i=e.selected[0],n=document.getElementById("GProuteResultsDetailsInstruction_"+i.getId()+"-"+this._uid);n&&n.classList&&n.classList.add("GProuteResultsDetailsInstructionHighlight")}if(e.deselected.length!==0){var o=e.deselected[0],l=document.getElementById("GProuteResultsDetailsInstruction_"+o.getId()+"-"+this._uid);l&&l.classList&&l.classList.remove("GProuteResultsDetailsInstructionHighlight")}}_onResultsFeatureSelect(e){var i=this.getMap();if(e.selected.length!==0){var n=e.selected[0];this._popupContent.innerHTML=n.getProperties().popupContent,this._popupOverlay?this._popupOverlay.setPosition(e.mapBrowserEvent.coordinate):(this._popupOverlay=new Overlay({element:this._popupDiv,positioning:"bottom-center",position:e.mapBrowserEvent.coordinate}),i.addOverlay(this._popupOverlay))}else this._popupOverlay!=null&&this._popupOverlay.setPosition(void 0)}_clear(){this._currentTransport=null,this._currentExclusions=[],this._currentComputation=null,this._clearRouteResultsDetails(),this._clearRouteResultsGeometry(),this._clearRouteResultsFeatureGeometry();for(var e=0;e<this._currentPoints.length;e++)this._currentPoints[e].clear();this._removeRouteStepLocations()}_clearRouteInputOptions(){this._initTransport(),this._initComputation(),this._initExclusions();var e;this._currentTransport==="Pieton"?(e=document.getElementById("GProuteTransportPedestrian-"+this._uid),e&&(e.checked="true")):(e=document.getElementById("GProuteTransportCar-"+this._uid),e&&(e.checked="true"));var i=document.getElementById("GProuteComputationSelect-"+this._uid);i&&(i.value=this._currentComputation);var n=document.getElementById("GProuteExclusionsToll-"+this._uid);n&&(this._currentExclusions.indexOf("toll")!==-1?n.checked=!1:n.checked=!0);var o=document.getElementById("GProuteExclusionsTunnel-"+this._uid);o&&(this._currentExclusions.indexOf("tunnel")!==-1?o.checked=!1:o.checked=!0);var l=document.getElementById("GProuteExclusionsBridge-"+this._uid);l&&(this._currentExclusions.indexOf("bridge")!==-1?l.checked=!1:l.checked=!0)}_removeRouteStepLocations(){var e=document.querySelectorAll('div[id^="GPlocationPoint"]');if(e.length!==0){for(var i=[],n=0;n<e.length;n++)e[n].id.indexOf(this._uid)!==-1&&i.push(e[n]);for(var o=1;o<i.length-1;o++){var l=i[o].classList;if(l.length!==0)for(var c=0;c<l.length;c++)l[c]==="GPlocationStageFlexInput"&&document.getElementById(this._addUID("GPlocationStageRemove_"+(o+1))).click()}}}_clearRouteResultsDetails(){if(this._currentRouteInformations=null,this._resultsRouteDetailsContainer){var e=this._resultsRouteDetailsContainer;if(e.childElementCount)for(;e.firstChild;)e.removeChild(e.firstChild)}if(this._resultsRouteValuesContainer){var i=this._resultsRouteValuesContainer;if(i.childElementCount)for(;i.firstChild;)i.removeChild(i.firstChild)}}_clearRouteResultsGeometry(){var e=this.getMap();this._geojsonRoute!=null&&(e.removeLayer(this._geojsonRoute),this._geojsonRoute=null)}_clearRouteResultsFeatureGeometry(){var e=this.getMap();this._geojsonSections!=null&&(e.removeLayer(this._geojsonSections),this._geojsonSections=null,this._geojsonObject=null),this._popupOverlay!=null&&(e.removeOverlay(this._popupOverlay),this._popupOverlay=null),this._resultsSelectInteraction!=null&&(e.removeInteraction(this._resultsSelectInteraction),this._resultsSelectInteraction=null),this._resultsHoverInteraction!=null&&(e.removeInteraction(this._resultsHoverInteraction),this._resultsHoverInteraction=null)}_hideRouteSuggestedLocations(e){if(e.target&&e.target.id&&e.target.id.indexOf("GPlocationOrigin_")!==-1)for(var i=parseInt(e.target.id.split("_")[1][0],10)-1,n=0;n<this._currentPoints.length;n++)n!==parseInt(i,10)&&this._currentPoints[n]._hideSuggestedLocation();else for(var o=0;o<this._currentPoints.length;o++)this._currentPoints[o]._hideSuggestedLocation()}_displayWaitingContainer(){this._waitingContainer.className="GPwaitingContainer GPwaitingContainerVisible gpf-waiting gpf-waiting--visible",this._waiting=!0;var e=this.options.routeOptions;if(e&&e.timeOut){this._timer&&(clearTimeout(this._timer),this._timer=null);var i=this;this._timer=setTimeout(function(){i._waiting===!0?i._hideWaitingContainer():i._timer&&clearTimeout(i._timer)},16e3)}}_hideWaitingContainer(){if(this._waiting){this._waitingContainer.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden",this._waiting=!1;var e=this.options.routeOptions;e&&e.timeOut&&(clearTimeout(this._timer),this._timer=null)}}_simplifiedInstructions(e){var i=[],n=e[0];e.length===1&&i.push(n);for(var o=1;o<e.length;o++){var l=e[o];if(l.instruction===n.instruction){n.distance=(parseFloat(l.distance)+parseFloat(n.distance)).toString(),n.duration=(parseFloat(l.duration)+parseFloat(n.duration)).toString();for(var c=1;c<l.geometry.coordinates.length;c++)n.geometry.coordinates.push(l.geometry.coordinates[c])}else i.push(n),n=l,o===e.length-1&&(i.push(l),n=null)}return logger$o.log(i),i}}Object.assign(Route.prototype,RouteDOM);Object.assign(Route.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.Route=Route);var IsoDOM={_addUID:function(s){var e=this._uid?s+"-"+this._uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPisochron"),s.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",s},_createShowIsoPictoElement:function(){var s=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowIsochronPicto"),e.classList.add("GPshowOpen","GPshowAdvancedToolPicto","GPshowIsochronPicto"),e.classList.add("gpf-btn","gpf-btn--tertiary","gpf-btn-icon","gpf-btn-icon-isocurve"),e.classList.add("icon--ri","icon--ri--map-pin-time-line"),e.classList.add("fr-btn","fr-btn--tertiary"),e.setAttribute("aria-label","Calculer une isochrone"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowIsoPanelClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowIsoPanelClick(n)}),e},_createIsoPanelElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPisochronPanel"),s.className="GPpanel gpf-panel fr-modal",s},_createIsoPanelDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__body fr-modal__body",s},_createDrawingButtonsPluginDiv:function(){var s=document.createElement("div");return s.className="container-buttons-plugin fr-mx-2w",s},_createIsoPanelHeaderElement:function(){var s=this,e=document.createElement("div");e.className="GPpanelHeader gpf-panel__header fr-modal__header";var i=document.createElement("div");i.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",i.innerHTML="Calcul d'isochrone",e.appendChild(i);var n=document.createElement("button");n.id=this._addUID("GPisochronPanelClose"),n.className="GPpanelClose GPisochronPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",n.title="Fermer le panneau",n.addEventListener?n.addEventListener("click",function(){document.getElementById(s._addUID("GPshowIsochronPicto")).click()},!1):n.attachEvent&&n.attachEvent("onclick",function(){document.getElementById(s._addUID("GPshowIsochronPicto")).click()});var o=document.createElement("span");return o.className="GPelementHidden gpf-visible",o.innerText="Fermer",n.appendChild(o),e.appendChild(n),e},_createIsoPanelFormElement:function(){var s=this,e=document.createElement("form");return e.id=this._addUID("GPisochronForm"),e.className="GPform gpf-panel__content gpf-mobile-form fr-modal__content",e.addEventListener("submit",function(i){return i.preventDefault(),s.onIsoComputationSubmit(i),!1}),e},_createIsoPanelResultsElement:function(){var s=this,e=document.createElement("div");e.id=this._addUID("GPisoResultsPanel"),e.className="GPelementHidden gpf-hidden";var i=document.createElement("div");return i.id=this._addUID("GPisoResultsNew"),i.className="GPresetPicto gpf-btn gpf-btn-icon-reset fr-btn fr-btn--secondary gpf-btn--secondary fr-m-2w",i.title="Modifier le calcul",i.addEventListener("click",function(n){document.getElementById(s._addUID("GPisoResultsPanel")).className="GPelementHidden gpf-hidden",document.getElementById(s._addUID("GPisochronForm")).className="gpf-panel__content fr-modal__content",s.onShowIsoResultsNewClick(n)}),e.appendChild(i),e},_addIsoResultsValuesElement:function(s,e,i){var n=s.distance,o=s.time,l=s.location,c=e.graph,u=e.method,h=e.exclusions,f=document.getElementById(this._addUID("GPisoResultsPanel"));f.childElementCount&&f.firstChild.id===this._addUID("GPisoResultsValueDiv")&&f.removeChild(f.firstChild);var g=document.createElement("div");g.id=this._addUID("GPisoResultsValueDiv"),g.className="fr-m-2w";var H=document.createElement("div");H.className="GPisoResultsValue";var Y=document.createElement("label");Y.className="GPisoResultsValueLabel",Y.innerHTML="Type :",H.appendChild(Y);var ee=document.createElement("div");ee.id=this._addUID("GPisoResultsValueType"),u==="time"?ee.innerHTML="temps":ee.innerHTML="distance",H.appendChild(ee),g.appendChild(H);var te=document.createElement("div");te.className="GPisoResultsValue";var xe=document.createElement("label");xe.className="GPisoResultsValueLabel",xe.innerHTML="Mode :",te.appendChild(xe);var ne=document.createElement("div");ne.id=this._addUID("GPisoResultsValueMode"),ne.innerHTML=c,te.appendChild(ne),g.appendChild(te);var et=document.createElement("div");et.className="GPisoResultsValue";var tt=document.createElement("label");tt.className="GPisoResultsValueLabel",tt.innerHTML="Centre :",et.appendChild(tt);var it=document.createElement("div");if(it.id=this._addUID("GPisoResultsValueOrigin"),it.innerHTML=parseFloat(l.y).toFixed(4)+", "+parseFloat(l.x).toFixed(4),et.appendChild(it),g.appendChild(et),n&&n.length!==0){var rt=document.createElement("div");rt.className="GPisoResultsValue";var nt=document.createElement("label");nt.className="GPisoResultsValueLabel",nt.innerHTML="Distance :",rt.appendChild(nt);var st=0,at=parseInt(n/1e3,10);if(!at)st=Math.round(n)+" m";else{var ot=Math.round(n);ot=ot/1e3,st=ot+" km"}var ct=document.createElement("div");ct.id=this._addUID("GPisoResultsValueDist"),ct.innerHTML=st,rt.appendChild(ct),g.appendChild(rt)}if(o&&o.length!==0){var ht=document.createElement("div");ht.className="GPisoResultsValue";var ut=document.createElement("label");ut.className="GPisoResultsValueLabel",ut.innerHTML="Dure :",ht.appendChild(ut);var pt=document.createElement("div");pt.id=this._addUID("GPisoResultsValueTime"),pt.innerHTML=i(o),ht.appendChild(pt),g.appendChild(ht)}if(h.length>0){var yt=document.createElement("div");yt.className="GPisoResultsValue";var mt=document.createElement("label");mt.className="GPisoResultsValueLabel",mt.innerHTML="Exclusions :",yt.appendChild(mt);var St=document.createElement("div");St.id=this._addUID("GPisoResultsValueExclusions"),St.innerHTML=h.join(", "),yt.appendChild(St),g.appendChild(yt)}return f.prepend(g),f},_createIsoWaitingElement:function(){var s=document.createElement("div");s.id=this._addUID("GPisochronCalcWaitingContainer"),s.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden";var e=document.createElement("p");return e.className="GPwaitingContainerInfo gpf-waiting_info",e.innerHTML="Recherche en cours...",s.appendChild(e),s},_createIsoPanelFooterElement:function(){var s=document.createElement("div");return s.className="GPpanelFooter gpf-panel__footer fr-modal__footer",s},_createIsoPanelFormPointLabel:function(){var s=document.createElement("p");return s.id=this._addUID("GPisochronPointLabelP"),s.className="gpf-label fr-label",s.innerHTML="Dpart",s},_createIsoPanelFormTypeChoiceElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPisochronChoice"),s.className="fr-mt-2w",s},_createIsoPanelFormTypeChoiceChronElement:function(s){var e=this,i=document.createElement("div");i.className="GPisochronChoiceAlt gpf-flex gpf-flex-isocurve gpf-radio-group fr-radio-group";var n=document.createElement("input");n.id=this._addUID("GPisochronChoiceAltChron"),n.name="GPisochronChoiceMode",n.type="radio",n.checked=!!s,n.addEventListener?n.addEventListener("change",function(c){document.getElementById(e._addUID("GPisochronValueChron")).className="GPflexInput gpf-flex fr-mt-1w",document.getElementById(e._addUID("GPisochronValueDist")).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPisochronValueChronLabelP")).className="gpf-label fr-label",document.getElementById(e._addUID("GPisochronValueDistLabelP")).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPisochronSubmit")).value="Calculer l'isochrone",e.onIsoTypeChoiceChange(c)},!1):n.attachEvent&&n.attachEvent("onchange",function(){document.getElementById(e._addUID("GPisochronValueChron")).className="GPflexInput gpf-flex fr-mt-1w",document.getElementById(e._addUID("GPisochronValueDist")).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPisochronValueChronLabelP")).className="gpf-label fr-label",document.getElementById(e._addUID("GPisochronValueDistLabelP")).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPisochronSubmit")).value="Calculer l'isochrone",e.onIsoTypeChoiceChange()}),n.value="isochron",i.appendChild(n);var o=document.createElement("label");o.className="GPisochronChoiceAltImg gpf-label fr-label",o.htmlFor=this._addUID("GPisochronChoiceAltChron"),o.innerHTML="Dure",o.title="Dure",i.appendChild(o);var l=document.createElement("span");return l.id=this._addUID("GPisochronChoiceAltChronTxt"),l.className="gpf-hidden",l.innerHTML="Dure",l.addEventListener?l.addEventListener("click",function(){document.getElementById(e._addUID("GPisochronChoiceAltChron")).click()},!1):l.attachEvent&&l.attachEvent("onclick",function(){document.getElementById(e._addUID("GPisochronChoiceAltChron")).click()}),i.appendChild(l),i},_createIsoPanelFormTypeChoiceDistElement:function(s){var e=this,i=document.createElement("div");i.className="GPisochronChoiceAlt gpf-flex gpf-flex-isocurve gpf-radio-group fr-radio-group";var n=document.createElement("input");n.id=this._addUID("GPisochronChoiceAltDist"),n.name="GPisochronChoiceMode",n.type="radio",n.checked=!!s,n.addEventListener?n.addEventListener("change",function(c){document.getElementById(e._addUID("GPisochronValueDist")).className="GPflexInput gpf-flex fr-mt-1w",document.getElementById(e._addUID("GPisochronValueChron")).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPisochronValueDistLabelP")).className="gpf-label fr-label",document.getElementById(e._addUID("GPisochronValueChronLabelP")).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPisochronSubmit")).value="Calculer l'isodistance",e.onIsoTypeChoiceChange(c)},!1):n.attachEvent&&n.attachEvent("onchange",function(){document.getElementById(e._addUID("GPisochronValueDist")).className="GPflexInput gpf-flex fr-mt-1w",document.getElementById(e._addUID("GPisochronValueChron")).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPisochronValueDistLabelP")).className="gpf-label fr-label",document.getElementById(e._addUID("GPisochronValueChronLabelP")).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPisochronSubmit")).value="Calculer l'isodistance",e.onIsoTypeChoiceChange()}),n.value="isodistance",i.appendChild(n);var o=document.createElement("label");o.className="GPisochronChoiceAltImg gpf-label fr-label",o.htmlFor=this._addUID("GPisochronChoiceAltDist"),o.innerHTML="Distance",o.title="Distance",i.appendChild(o);var l=document.createElement("span");return l.id=this._addUID("GPisochronChoiceAltDistTxt"),l.className="gpf-hidden",l.innerHTML="Distance",l.addEventListener?l.addEventListener("click",function(){document.getElementById(e._addUID("GPisochronChoiceAltDist")).click()},!1):l.attachEvent&&l.attachEvent("onclick",function(){document.getElementById(e._addUID("GPisochronChoiceAltDist")).click()}),i.appendChild(l),i},_createIsoPanelFormLabelIsochronElement:function(s){var e=document.createElement("p");return e.id=this._addUID("GPisochronValueChronLabelP"),e.className=s?"gpf-label fr-label":"GPelementHidden gpf-hidden",e.innerHTML="Dfinir un temps de trajet",e},_createIsoPanelFormValueIsochronElement:function(s){var e=this,i=document.createElement("div");i.id=this._addUID("GPisochronValueChron"),i.className=s?"GPflexInput gpf-flex fr-mt-1w":"GPelementHidden gpf-hidden";var n=document.createElement("input");n.id=this._addUID("GPisochronValueChronInput1"),n.className="gpf-input fr-input",n.min="0",n.step="1",n.value="0",n.type="number",n.title="Temps",n.addEventListener?n.addEventListener("change",function(u){typeof e.onIsoValueChronTimeMinuteChange=="function"&&e.onIsoValueChronTimeHourChange(u)}):n.attachEvent&&n.attachEvent("onchange",function(u){typeof e.onIsoValueChronTimeMinuteChange=="function"&&e.onIsoValueChronTimeHourChange(u)}),i.appendChild(n);var o=document.createElement("label");o.innerHTML="h",o.className="gpf-label fr-label",i.appendChild(o);var l=document.createElement("input");l.id=this._addUID("GPisochronValueChronInput2"),l.className="gpf-input fr-input",l.min="0",l.max="59",l.step="1",l.value="0",l.type="number",l.title="Heures",l.addEventListener?l.addEventListener("change",function(u){typeof e.onIsoValueChronTimeMinuteChange=="function"&&e.onIsoValueChronTimeMinuteChange(u)}):l.attachEvent&&l.attachEvent("onchange",function(u){typeof e.onIsoValueChronTimeMinuteChange=="function"&&e.onIsoValueChronTimeMinuteChange(u)}),i.appendChild(l);var c=document.createElement("label");return c.innerHTML="min",c.className="gpf-label fr-label",i.appendChild(c),i},_createIsoPanelFormLabelIsodistanceElement:function(s){var e=document.createElement("p");return e.id=this._addUID("GPisochronValueDistLabelP"),e.className=s?"gpf-label fr-label":"GPelementHidden gpf-hidden",e.innerHTML="Dfinir une distance",e},_createIsoPanelFormValueIsodistanceElement:function(s){var e=this,i=document.createElement("div");i.id=this._addUID("GPisochronValueDist"),i.className=s?"GPflexInput gpf-flex fr-mt-1w":"GPelementHidden gpf-hidden";var n=document.createElement("input");n.id=this._addUID("GPisochronValueDistInput"),n.className="gpf-input fr-input fr-ml-1w",n.min="0",n.step="any",n.value="0",n.type="number",n.title="Distance",n.addEventListener?n.addEventListener("change",function(l){typeof e.onIsoValueDistChange=="function"&&e.onIsoValueDistChange(l)}):n.attachEvent&&n.attachEvent("onchange",function(l){typeof e.onIsoValueDistChange=="function"&&e.onIsoValueDistChange(l)}),i.appendChild(n);var o=document.createElement("label");return o.innerHTML="km",o.className="gpf-label fr-label",i.appendChild(o),i},_createIsoPanelFormModeChoiceTransportElement:function(s){var e=this,i=document.createElement("div");i.id=this._addUID("GPisochronTransportChoice");var n=document.createElement("label");n.className="GPisochronModeLabel gpf-label fr-label",n.innerHTML="Choisir un mode de dplacement",i.appendChild(n);for(var o=document.createElement("div"),l=0;l<s.length;l++){var c=s[l],u=document.createElement("div");if(u.className="GPisochronTransportChoice gpf-flex gpf-radio-group fr-radio-group",c==="Voiture"){var h=document.createElement("input");h.id=this._addUID("GPisochronTransportCar"),h.type="radio",h.name="GPisochronTransport",l===0&&(h.checked=!0),h.addEventListener?h.addEventListener("change",function(Y){e.onIsoModeTransportChange(Y)}):h.attachEvent&&h.attachEvent("onchange",function(Y){e.onIsoModeTransportChange(Y)}),h.value="Voiture",u.appendChild(h);var f=document.createElement("label");f.className="GPisochronTransportImg gpf-label fr-label",f.htmlFor=this._addUID("GPisochronTransportCar"),f.title="Voiture",f.innerHTML="Voiture",u.appendChild(f)}if(c==="Pieton"){var g=document.createElement("input");g.id=this._addUID("GPisochronTransportPedestrian"),g.type="radio",g.name="GPisochronTransport",l===0&&(g.checked=!0),g.addEventListener?g.addEventListener("change",function(Y){e.onIsoModeTransportChange(Y)}):g.attachEvent&&g.attachEvent("onchange",function(Y){e.onIsoModeTransportChange(Y)}),g.value="Pieton",u.appendChild(g);var H=document.createElement("label");H.className="GPisochronTransportImg gpf-label fr-label",H.htmlFor=this._addUID("GPisochronTransportPedestrian"),H.title="Piton",H.innerHTML="Piton",u.appendChild(H)}o.appendChild(u)}return i.appendChild(o),i},_createIsoPanelFormModeChoiceDirectionElement:function(s){var e=this,i=document.createElement("div");i.id=this._addUID("GPisochronDirectionChoice"),i.className="fr-my-2w";var n=document.createElement("label");n.innerHTML="Dfinir un sens de parcours",n.className="fr-label",i.appendChild(n);var o=document.createElement("select");o.id=this._addUID("GPisochronDirectionSelect"),o.className="GPselect gpf-select fr-select",o.title="Sens de parcours",o.addEventListener("change",function(f){e.onIsoModeDirectionChange(f)});for(var l=0;l<s.length;l++){var c=s[l];if(c.toLowerCase()==="departure"){var u=document.createElement("option");l===0&&(u.selected="selected"),u.value="departure",u.text="Dpart",o.appendChild(u)}if(c.toLowerCase()==="arrival"){var h=document.createElement("option");l===0&&(h.selected="selected"),h.value="arrival",h.text="Arrive",o.appendChild(h)}}return i.appendChild(o),i},_createShowIsoExclusionsPictoElement:function(){var s=this,e=document.createElement("button");e.id=this._addUID("GPshowIsoExclusionsPicto");var i="";return checkDsfr()&&(i="GPelementHidden gpf-hidden"),e.className=`GPshowAdvancedToolPicto GPshowMoreOptionsImage GPshowMoreOptions GPshowIsoExclusionsPicto ${i} gpf-btn fr-btn--sm fr-btn--tertiary gpf-btn--tertiary fr-icon-arrow-down-fill`,e.title="Exclusions",e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!0),e.addEventListener?e.addEventListener("click",function(n){n.preventDefault();var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowIsoSettingsClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){n.preventDefault();var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowIsoSettingsClick(n)}),e},_createIsoPanelFormExclusionsElement:function(){var s=document.createElement("div");s.id=this._addUID("GPisoExclusions");var e=document.createElement("label");return e.className="GPisoExclusionsLabel gpf-label fr-label",e.innerHTML="Passages autoriss",s.appendChild(e),s},_createIsoPanelFormExclusionOptionsElement:function(s){var e=this,i=document.createElement("div");i.className="GPisoExclusionsOptions gpf-flex fr-checkbox-group fr-m-1w";for(var n in s)if(s.hasOwnProperty(n)){var o=s[n];switch(n){case"toll":var l=document.createElement("input");l.id=this._addUID("GPisoExclusionsToll"),l.type="checkbox",l.name="Pages",l.checked=!o,l.addEventListener?l.addEventListener("change",function(H){e.onIsoExclusionsChange(H)}):l.attachEvent&&l.attachEvent("onchange",function(H){e.onIsoExclusionsChange(H)}),l.value="Toll",i.appendChild(l);var c=document.createElement("label");c.className="GPisoExclusionsOption",c.htmlFor=this._addUID("GPisoExclusionsToll"),c.innerHTML="Pages",i.appendChild(c);break;case"tunnel":var u=document.createElement("input");u.id=this._addUID("GPisoExclusionsTunnel"),u.type="checkbox",u.name="Tunnel",u.checked=!o,u.addEventListener?u.addEventListener("change",function(H){e.onIsoExclusionsChange(H)}):u.attachEvent&&u.attachEvent("onchange",function(H){e.onIsoExclusionsChange(H)}),u.value="Tunnel",i.appendChild(u);var h=document.createElement("label");h.className="GPisoExclusionsOption",h.htmlFor=this._addUID("GPisoExclusionsTunnel"),h.innerHTML="Tunnels",i.appendChild(h);break;case"bridge":var f=document.createElement("input");f.id=this._addUID("GPisoExclusionsBridge"),f.type="checkbox",f.name="Ponts",f.checked=!o,f.addEventListener?f.addEventListener("change",function(H){e.onIsoExclusionsChange(H)}):f.attachEvent&&f.attachEvent("onchange",function(H){e.onIsoExclusionsChange(H)}),f.value="Bridge",i.appendChild(f);var g=document.createElement("label");g.className="GPisoExclusionsOption",g.htmlFor=this._addUID("GPisoExclusionsBridge"),g.innerHTML="Ponts",i.appendChild(g);break}}return i},_createIsoSubmitFormElement:function(){var s=document.createElement("input");return s.id=this._addUID("GPisochronSubmit"),s.className="GPsubmit gpf-btn fr-btn",s.type="submit",s.value="Calculer l'isochrone",s},_createIsoFormResetElement:function(){var s=this,e=document.createElement("button");return e.id=this._addUID("GPisochronReset"),e.className="GPresetPicto GPisochronReset gpf-btn gpf-btn-icon-reset gpf-btn-icon-isocurve-reset fr-btn fr-btn--secondary gpf-btn--secondary",e.title="Rinitialiser les paramtres",e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.addEventListener("click",function(i){var n=i.target.ariaPressed==="true";i.target.setAttribute("aria-pressed",!n),s.onIsoResetClick(i)}),e}},logger$n=LoggerByDefault.getLogger("isocurve");class Isocurve extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof Isocurve))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="Isocurve",this.initialize(e),this._container=this._createMainContainerElement(),this.element?this.element.appendChild(this._container):this.element=this._container,this}setMap(e){if(e){if(this._container=this._initContainer(e),this.options.export){var i=Helper.assign({control:this},this.options.export);this.export=new ButtonExport(i),this.export.render();var n=this;this.export.on("button:clicked",o=>{n.dispatchEvent({type:"export:compute",content:o.content})})}this.draggable&&Draggable.dragElement(this._IsoPanelContainer,this._IsoPanelHeaderContainer,e.getTargetElement()),this.collapsed||this._pictoIsoButton.setAttribute("aria-pressed",!0)}super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getCollapsed(){return this.collapsed}setCollapsed(e){if(e===void 0){logger$n.log("[ERROR] Isocurve:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(e?document.getElementById("GPisochronPanelClose-"+this._uid).click():this._pictoIsoButton.click(),this.collapsed=e)}getLayer(){return this._geojsonLayer}setLayer(e){if(!e){this._geojsonLayer=null;return}if(!(e instanceof VectorLayer)){logger$n.log("no valid layer given for hosting drawn features.");return}e.setStyle(this._defaultFeatureStyle),this._geojsonLayer=e}getGeoJSON(){return JSON.stringify(this._geojsonObject)}setGeoJSON(e){try{this._geojsonObject=JSON.parse(e)}catch(i){logger$n.log("no valid geojson given :"+i.message)}}getData(){var e={type:"isocurve",transport:this._currentTransport,computation:this._currentComputation,exclusions:this._currentExclusions,direction:this._currentDirection,point:this._originPoint.getCoordinate(),results:{}};return Helper.assign(e.results,this._currentIsoResults),e}setData(e){this._currentTransport=e.transport,this._currentComputation=e.computation,this._currentExclusions=e.exclusions,this._currentDirection=e.direction;var i=document.getElementById("GPlocationOriginPointer_1-"+this._uid);i.checked=!0;var n=document.getElementById("GPlocationOrigin_1-"+this._uid),o=document.getElementById("GPlocationOriginCoords_1-"+this._uid);o.value=e.point,n.value=e.point[1].toFixed(4)+" / "+e.point[0].toFixed(4),this._originPoint.setCoordinate(e.point,"EPSG:4326"),this._currentIsoResults=e.results}getContainer(){return this._container}getStyle(){return this._defaultFeatureStyle}compute(e,i,n){this._clear();var o=this._pictoIsoButton.ariaPressed;o!=="true"&&this._pictoIsoButton.click();var l=this.getMap();if(l){var c={direction:"departure",method:"time",transport:"Voiture",exclusions:[]};Helper.assign(c,n),this._originPoint.setCoordinate(e);var u=this._originPoint.getCoordinate(),h=document.getElementById("GPlocationOrigin_1-"+this._uid);if(h.value=u[0].toFixed(4)+" / "+u[1].toFixed(4),this._currentTransport=c.transport,c.transport==="Voiture"?document.getElementById("GPisochronTransportCar-"+this._uid).checked=!0:document.getElementById("GPisochronTransportPedestrian-"+this._uid).checked=!0,this._currentExclusions=c.exclusions,this._currentComputation=c.method,c.method==="time"){var f=i.split(".");this._currentTimeHour=f[0]||0,document.getElementById("GPisochronValueChronInput1-"+this._uid).value=this._currentTimeHour,this._currentTimeMinute=f[1]||0,document.getElementById("GPisochronValueChronInput2-"+this._uid).value=this._currentTimeMinute,document.getElementById("GPisochronChoiceAltChron-"+this._uid).click()}else this._currentDistance=i,document.getElementById("GPisochronValueDistInput-"+this._uid).value=this._currentDistance,document.getElementById("GPisochronChoiceAltDist-"+this._uid).click();this._currentDirection=c.direction,c.direction==="departure"?document.getElementById("GPisochronDirectionSelect-"+this._uid).selectedIndex=0:document.getElementById("GPisochronDirectionSelect-"+this._uid).selectedIndex=1,this.onIsoComputationSubmit()}}init(){var e=this._originPoint.getCoordinate(),i=document.getElementById("GPlocationOrigin_1-"+this._uid);if(i.value=e[1].toFixed(4)+" / "+e[0].toFixed(4),this._currentTransport==="Voiture"?document.getElementById("GPisochronTransportCar-"+this._uid).checked=!0:document.getElementById("GPisochronTransportPedestrian-"+this._uid).checked=!0,this._currentComputation==="time"){var n=this._currentIsoResults.time/60;this._currentTimeHour=Math.floor(n/60),document.getElementById("GPisochronValueChronInput1-"+this._uid).value=this._currentTimeHour,this._currentTimeMinute=Math.round((n/60-this._currentTimeHour)*60),document.getElementById("GPisochronValueChronInput2-"+this._uid).value=this._currentTimeMinute,document.getElementById("GPisochronChoiceAltChron-"+this._uid).click()}else this._currentDistance=this._currentIsoResults.distance/1e3,document.getElementById("GPisochronValueDistInput-"+this._uid).value=this._currentDistance,document.getElementById("GPisochronChoiceAltDist-"+this._uid).click();this._currentDirection==="departure"?document.getElementById("GPisochronDirectionSelect-"+this._uid).selectedIndex=0:document.getElementById("GPisochronDirectionSelect-"+this._uid).selectedIndex=1,this._fillIsoResultsDetails(this._currentIsoResults,{graph:this._currentTransport,exclusions:this._currentExclusions,method:this._currentComputation})}clean(){this._clearIsoInputs(),this._originPoint.clearResults(),document.getElementById("GPlocationPoint_1-"+this._uid).style.cssText="",document.getElementById("GPlocationOriginCoords_1-"+this._uid).value="",document.getElementById("GPlocationOrigin_1-"+this._uid).value="",document.getElementById("GPlocationPoint_1-"+this._uid).style.cssText="",document.getElementById("GPlocationOriginPointer_1-"+this._uid).checked=!1,document.getElementById("GPlocationOrigin_1-"+this._uid).className="GPlocationOriginVisible gpf-visible",document.getElementById("GPlocationOriginCoords_1-"+this._uid).className="GPlocationOriginHidden gpf-hidden",this._currentIsoResults=null,this.setLayer(),this._resultsIsoContainer.className="GPelementHidden gpf-hidden",this._formContainer.className="gpf-panel__content fr-modal__content"}initialize(e){this._checkInputOptions(e),this.options={collapsed:!0,draggable:!1,export:!1,methods:["time","distance"],graphs:["Pieton","Voiture"],exclusions:{toll:!1,tunnel:!1,bridge:!1},directions:["departure","arrival"],markerOpts:{url:Marker.lightOrange,offset:Marker.defaultOffset},isocurveOptions:{},autocompleteOptions:{},layerDescription:{title:"Isochrone/Isodistance",description:"isochrone/isodistance bas sur un graphe"}},Helper.assign(this.options,e),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this._uid=this.options.id||SelectorID.generate(),this._currentTransport=null,this._initTransport(),this._currentComputation=null,this._initComputation(),this._currentExclusions=[],this._initExclusions(),this._currentDirection=null,this._initDirection(),this._originPoint=null,this._pictoIsoButton=null,this._waitingContainer=null,this._formContainer=null,this._resultsIsoContainer=null,this._IsoPanelContainer=null,this._IsoPanelHeaderContainer=null,this._currentIsoResults=null,this._geojsonLayer=null,this._geojsonObject=null,this.export=null,this._waiting=!1,this._timer=null,this._defaultFeatureStyle=new Style$1({fill:new Fill({color:"rgba(0, 183, 152, 0.7)"}),stroke:new Stroke({color:"rgba(0, 183, 152, 0)",width:1})}),this._resources={},this.listenerKey=null,this.COMPUTE_ISOCURVE_EVENT="isocurve:comput",this.RESULTS_ISOCURVE_EVENT="isocurve:newresults",this.DRAW_START_ISOCURVE_EVENT="isocurve:drawstart",this.DRAW_END_ISOCURVE_EVENT="isocurve:drawend"}_checkInputOptions(e){var i;if(e.methods)if(Array.isArray(e.methods))if(e.methods.length===0)e.methods=null;else for(i=0;i<e.methods.length;i++)typeof e.methods[i]!="string"&&logger$n.log("[ol.control.Isocurve] ERROR : parameter 'methods' elements should be of type 'string'");else logger$n.warn("'methods' parameter should be an array"),e.methods=null;if(e.graphs)if(Array.isArray(e.graphs))if(e.graphs.length===0)e.graphs=null;else for(i=0;i<e.graphs.length;i++)typeof e.graphs[i]!="string"?logger$n.log("[ol.control.Isocurve] ERROR : parameter 'graphs' elements should be of type 'string'"):(e.graphs[i].toLowerCase()==="pieton"&&(e.graphs[i]="Pieton"),e.graphs[i].toLowerCase()==="voiture"&&(e.graphs[i]="Voiture"));else logger$n.warn("'graphs' parameter should be an array"),e.graphs=null;if(e.directions)if(Array.isArray(e.directions))if(e.directions.length===0)e.directions=null;else for(i=0;i<e.directions.length;i++)typeof e.directions[i]!="string"&&logger$n.log("[ol.control.Isocurve] ERROR : parameter 'directions' elements should be of type 'string'");else logger$n.warn("'directions' parameter should be an array"),e.directions=null;e.collapsed==="true"&&(e.collapsed=!0),e.collapsed==="false"&&(e.collapsed=!1)}_initTransport(){this._currentTransport="Piton";var e=this.options.graphs;(!e||e.length===0)&&(this.options.graphs=["Pieton","Voiture"]),Array.isArray(e)&&e.length&&(e[0]==="Voiture"||e[0]==="Pieton")&&(this._currentTransport=e[0]);var i=this.options.isocurveOptions;i.graph&&(this._currentTransport=i.graph)}_initComputation(){this._currentComputation="time";var e=this.options.methods;(!e||e.length===0)&&(this.options.methods=["time","distance"]),Array.isArray(e)&&e.length&&(e[0]==="time"||e[0]==="distance")&&(this._currentComputation=e[0]);var i=this.options.isocurveOptions;i.method&&(this._currentComputation=i.method),i.time&&(this._currentComputation="time"),i.distance&&(this._currentComputation="distance")}_initDirection(){this._currentDirection="departure";var e=this.options.directions;(!e||e.length===0)&&(this.options.directions=["departure","arrival"]),Array.isArray(e)&&e.length&&(e[0]==="departure"||e[0]==="arrival")&&(this._currentDirection=e[0]);var i=this.options.isocurveOptions;i.reverse||(this._currentDirection="departure"),i.reverse===!0&&(this._currentDirection="arrival",this.options.directions=["arrival","departure"])}_initExclusions(){this._currentExclusions=[];var e=this.options.exclusions;if((!e||typeof e=="object"&&Object.keys(e).length===0)&&(this.options.exclusions={toll:!1,tunnel:!1,bridge:!1}),e&&typeof e=="object"&&Object.keys(e).length)for(var i in e)e.hasOwnProperty(i)&&e.k&&this._currentExclusions.push(i);var n=this.options.isocurveOptions;Array.isArray(n.exclusions)&&(this._currentExclusions=n.exclusions)}_initContainer(e){var i=this._container;if(i.childElementCount>0)return i;var n=this._pictoIsoButton=this._createShowIsoPictoElement();i.appendChild(n);var o=this._IsoPanelContainer=this._createIsoPanelElement(),l=this._createIsoPanelDivElement();o.appendChild(l);var c=this._IsoPanelHeaderContainer=this._createIsoPanelHeaderElement();l.appendChild(c);var u=this._formContainer=this._createIsoPanelFormElement();u.appendChild(this._createIsoPanelFormModeChoiceTransportElement(this.options.graphs)),u.appendChild(this._createIsoPanelFormPointLabel());var h=this._createIsoPanelFormPointElement(e);u.appendChild(h);for(var f=!1,g=!1,H=this._createIsoPanelFormTypeChoiceElement(),Y=0;Y<this.options.methods.length;Y++)this.options.methods[Y]==="time"&&(f=Y===0,H.appendChild(this._createIsoPanelFormTypeChoiceChronElement(f))),this.options.methods[Y]==="distance"&&(g=Y===0,H.appendChild(this._createIsoPanelFormTypeChoiceDistElement(g)));if(u.appendChild(H),u.appendChild(this._createIsoPanelFormLabelIsochronElement(f)),u.appendChild(this._createIsoPanelFormValueIsochronElement(f)),u.appendChild(this._createIsoPanelFormLabelIsodistanceElement(g)),u.appendChild(this._createIsoPanelFormValueIsodistanceElement(g)),u.appendChild(this._createIsoPanelFormModeChoiceDirectionElement(this.options.directions)),this.options.exclusions&&typeof this.options.exclusions=="object"&&Object.keys(this.options.exclusions).length!==0){u.appendChild(this._createShowIsoExclusionsPictoElement());var ee=this._createIsoPanelFormExclusionsElement();ee.appendChild(this._createIsoPanelFormExclusionOptionsElement(this.options.exclusions)),u.appendChild(ee)}var te=this._createIsoPanelFooterElement();if(u.appendChild(te),!checkDsfr()){var xe=this._createIsoFormResetElement();te.appendChild(xe)}var ne=this._submitContainer=this._createIsoSubmitFormElement();te.appendChild(ne),l.appendChild(u);var et=this._resultsIsoContainer=this._createIsoPanelResultsElement();l.appendChild(et);var tt=this._createDrawingButtonsPluginDiv();l.appendChild(tt);var it=this._waitingContainer=this._createIsoWaitingElement();return o.appendChild(it),i.appendChild(o),i.addEventListener&&i.addEventListener("click",rt=>this._hideIsoSuggestedLocations(rt)),i}_createIsoPanelFormPointElement(e){this._originPoint=new LocationSelector({apiKey:this.options.apiKey||null,tag:{id:1,groupId:this._uid,markerOpts:this.options.markerOpts,display:!0},autocompleteOptions:this.options.autocompleteOptions||null}),this._originPoint.setMap(e);var i=this;return document.getElementById("GPlocationOriginPointerImg_1-"+this._uid).onclick=function(){i._clearGeojsonLayer();var n=i.getMap();i._originPoint._inputShowPointerContainer.checked?(i._formContainer.className="GPisochronFormMini gpf-panel__content fr-modal__content",this.listenerKey=n.on("click",()=>{i._formContainer.className="gpf-panel__content fr-modal__content",i.dispatchEvent(i.DRAW_END_ISOCURVE_EVENT)})):(i._formContainer.className="gpf-panel__content fr-modal__content",unByKey(this.listenerKey)),i.dispatchEvent(i.DRAW_START_ISOCURVE_EVENT)},document.getElementById("GPlocationOriginLabel_1-"+this._uid).onclick=function(){i._clearGeojsonLayer(),i._formContainer.className="gpf-panel__content fr-modal__content",e.un("click",()=>{i._formContainer.className="gpf-panel__content fr-modal__content"}),i.dispatchEvent(i.DRAW_END_ISOCURVE_EVENT)},document.getElementById("GPlocationOrigin_1-"+this._uid).onclick=function(){i._clearGeojsonLayer(),i.dispatchEvent(i.DRAW_END_ISOCURVE_EVENT)},this._originPoint._container}onIsoComputationSubmit(){if(!this._originPoint||!this._originPoint.getCoordinate||!this._originPoint.getCoordinate()){logger$n.log("[Isocurve] Missing position parameter to submit isocurve request");return}var e=this._originPoint.getCoordinate(),i={x:e[0].toFixed(5),y:e[1].toFixed(5)};logger$n.log("origin : ",i);var n,o;if(this._currentComputation.toLowerCase()==="time"){var l=document.getElementById("GPisochronValueChronInput1-"+this._uid),c=parseInt(l.value,10);isNaN&&isNaN(c)&&(c=0);var u=document.getElementById("GPisochronValueChronInput2-"+this._uid),h=parseInt(u.value,10);isNaN&&isNaN(h)&&(h=0),n=c*3600+h*60,logger$n.log("time : "+n)}if(this._currentComputation.toLowerCase()==="distance"){var f=document.getElementById("GPisochronValueDistInput-"+this._uid);o=parseFloat(f.value)*1e3,logger$n.log("distance : "+o)}if(!n&&!o){logger$n.log("[Isocurve] Missing time or distance parameter to submit isocurve request");return}var g=this.options.isocurveOptions||{},H=g.protocol||"XHR",Y=g.timeOut||0;H==="JSONP"&&Y===0&&(Y=15e3);var ee=g.onFailure!==null&&typeof g.onFailure=="function",te=g.onSuccess!==null&&typeof g.onSuccess=="function",xe=this,ne={position:i,graph:g.graph||this._currentTransport,exclusions:g.exclusions||this._currentExclusions,method:g.method||this._currentComputation,smoothing:g.smoothing||!0,timeOut:Y,protocol:H,resource:g.resource,onSuccess:function(et){logger$n.log(et),et&&(xe._fillIsoResultsDetails(et,ne),xe._drawIsoResults(et)),te&&g.onSuccess.call(xe,et)},onFailure:function(et){xe._hideWaitingContainer(),logger$n.log(et.message),ee&&g.onFailure.call(xe,et)}};(this._currentDirection.toLowerCase()==="arrival"||g.reverse)&&(ne.reverse=!0),n&&(ne.time=n),o&&(ne.distance=o),this._requestIsoCurve(ne)}onShowIsoPanelClick(e){var i=this._pictoIsoButton.ariaPressed;i==="true"&&this.onPanelOpen();var n=this.getMap();Interactions.unset(n),this.collapsed=i!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position)}onIsoTypeChoiceChange(e){var i=e.target.value;i&&(i==="isodistance"&&(this._currentComputation="distance"),i==="isochron"&&(this._currentComputation="time"))}onIsoModeTransportChange(e){var i=e.target.value;i&&(this._currentTransport=i)}onIsoModeDirectionChange(e){var i=e.target.value;i&&(i.toLowerCase()==="arrival"?document.getElementById("GPisochronPointLabelP-"+this._uid).innerHTML="Arrive":document.getElementById("GPisochronPointLabelP-"+this._uid).innerHTML="Dpart",this._currentDirection=i)}onIsoExclusionsChange(e){var i=e.target.value,n=e.target.checked;if(i){for(var o=!1,l=null,c=0;c<this._currentExclusions.length;c++)deepEqual(this._currentExclusions[c],i.toLowerCase())&&(l=c,o=!0);!o&&!n&&this._currentExclusions.push(i.toLowerCase()),o&&n&&(this._currentExclusions[l]=null)}}onIsoResetClick(){this._clear()}onShowIsoResultsNewClick(){this._clearGeojsonLayer(),this.dispatchEvent(this.RESULTS_ISOCURVE_EVENT)}onShowIsoSettingsClick(){}_requestIsoCurve(e){!e||typeof e=="object"&&Object.keys(e).length===0||e.position&&(typeof e.ssl!="boolean"&&(typeof this.options.ssl=="boolean"?e.ssl=this.options.ssl:e.ssl=!0),logger$n.log(e),this._clearGeojsonLayer(),this._displayWaitingContainer(),Gp.Services.isoCurve(e))}_fillIsoResultsDetails(e,i){this._fillIsoResultsDetailsContainer(e,i),this._currentIsoInformations=e,this.dispatchEvent({type:this.COMPUTE_ISOCURVE_EVENT}),this._formContainer.className="GPelementHidden gpf-hidden gpf-panel__content fr-modal__content",this._hideWaitingContainer(),this._resultsIsoContainer.className="gpf-flex GPflex"}_fillIsoResultsDetailsContainer(e,i){this._resultsIsoValuesContainer=this._addIsoResultsValuesElement(e,i,MathUtils.convertSecondsToTime)}_drawIsoResults(e){if(this._currentIsoResults=e,this._hideWaitingContainer(),!!e.geometry){var i=this.getMap();this._geojsonObject={type:"FeatureCollection",crs:{type:"name",properties:{name:"EPSG:4326"}},features:[{type:"Feature",crs:{type:"name",properties:{name:"EPSG:4326"}},geometry:e.geometry}]},this._geojsonObject.features.push({type:"Feature",geometry:{type:"Point",coordinates:this._originPoint.getCoordinate()},properties:{description:"Point d'origine","marker-symbol":this.options.markerOpts.url}});var n=new GeoJSON({defaultDataProjection:"EPSG:4326",defaultStyle:this._defaultFeatureStyle}),o=i.getView().getProjection().getCode(),l=n.readFeatures(this._geojsonObject,{dataProjection:"EPSG:4326",featureProjection:o}),h=this._currentComputation==="time"?"Isochrone":"Isodistance";this._geojsonLayer=new VectorLayer({source:new VectorSource({features:l}),style:this._defaultFeatureStyle,opacity:.9,title:"Mon "+h});var c;if(this._currentTransport==="Pieton"?(c="piton",this._geojsonLayer.gpResultLayerId="compute:Pieton$GEOPORTAIL:GPP:Isocurve"):(c="voiture",this._geojsonLayer.gpResultLayerId="compute:Voiture$GEOPORTAIL:GPP:Isocurve"),i.addLayer(this._geojsonLayer),this.dispatchEvent({type:this.COMPUTE_ISOCURVE_EVENT}),l[0]&&l[0].getGeometry()&&l[0].getGeometry().getExtent()){var u=l[0].getGeometry().getExtent();i.getView().fit(u,i.getSize())}var h=this._currentComputation==="time"?"Isochrone":"Isodistance";i.getControls().forEach(f=>{if(f instanceof LayerSwitcher){var g=this._geojsonLayer.gpLayerId;f._layers[g].title===g&&f.addLayer(this._geojsonLayer,{title:this.options.layerDescription.title+" ("+h+"/"+c+")",description:this.options.layerDescription.description})}})}}_clear(){this._clearIsoInputs(),this._originPoint.clear(),this._clearGeojsonLayer(),this._currentIsoResults=null}_clearIsoInputs(){var e=document.getElementById("GPisochronValueChronInput1-"+this._uid);e&&(e.value="0");var i=document.getElementById("GPisochronValueChronInput2-"+this._uid);i&&(i.value="0");var n=document.getElementById("GPisochronValueDistInput-"+this._uid);n&&(n.value="0"),this._initTransport(),this._initComputation(),this._initDirection(),this._initExclusions();var o;this._currentTransport==="Pieton"?(o=document.getElementById("GPisochronTransportPedestrian-"+this._uid),o&&(o.checked="true")):(o=document.getElementById("GPisochronTransportCar-"+this._uid),o&&(o.checked="true"));var l;this._currentComputation.toLowerCase()==="distance"?(l=document.getElementById("GPisochronChoiceAltDist-"+this._uid),l&&(l.checked="true"),document.getElementById("GPisochronValueDist-"+this._uid)&&(document.getElementById("GPisochronValueDist-"+this._uid).className="GPflexInput gpf-flex"),document.getElementById("GPisochronValueChron-"+this._uid)&&(document.getElementById("GPisochronValueChron-"+this._uid).className="GPelementHidden gpf-hidden")):(l=document.getElementById("GPisochronChoiceAltChron-"+this._uid),l&&(l.checked="true"),document.getElementById("GPisochronValueChron-"+this._uid)&&(document.getElementById("GPisochronValueChron-"+this._uid).className="GPflexInput gpf-flex"),document.getElementById("GPisochronValueDist-"+this._uid)&&(document.getElementById("GPisochronValueDist-"+this._uid).className="GPelementHidden gpf-hidden"));var c=document.getElementById("GPisochronDirectionSelect-"+this._uid);c&&(c.value=this._currentDirection),c.value.toLowerCase()==="arrival"?document.getElementById("GPisochronPointLabelP-"+this._uid).innerHTML="Arrive":document.getElementById("GPisochronPointLabelP-"+this._uid).innerHTML="Dpart";var u=document.getElementById("GPisoExclusionsToll-"+this._uid);u&&(this._currentExclusions.indexOf("toll")!==-1?u.checked=!1:u.checked=!0);var h=document.getElementById("GPisoExclusionsTunnel-"+this._uid);h&&(this._currentExclusions.indexOf("tunnel")!==-1?h.checked=!1:h.checked=!0);var f=document.getElementById("GPisoExclusionsBridge-"+this._uid);f&&(this._currentExclusions.indexOf("bridge")!==-1?f.checked=!1:f.checked=!0)}_clearGeojsonLayer(){var e=this.getMap();this._geojsonLayer&&(e.removeLayer(this._geojsonLayer),this._geojsonLayer=null),this._geojsonObject=null}_hideIsoSuggestedLocations(e){e.target&&e.target.id&&e.target.id.indexOf("GPlocationOrigin_")!==-1||this._originPoint._hideSuggestedLocation()}_displayWaitingContainer(){this._waitingContainer.className="GPwaitingContainer GPwaitingContainerVisible gpf-waiting gpf-waiting--visible",this._waiting=!0;var e=this.options.isocurveOptions;if(e&&e.timeOut){this._timer&&(clearTimeout(this._timer),this._timer=null);var i=this;this._timer=setTimeout(function(){i._waiting===!0?i._hideWaitingContainer():i._timer&&clearTimeout(i._timer)},16e3)}}_hideWaitingContainer(){if(this._waiting){this._waitingContainer.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden",this._waiting=!1;var e=this.options.isocurveOptions;e&&e.timeOut&&(clearTimeout(this._timer),this._timer=null)}}}Object.assign(Isocurve.prototype,IsoDOM);Object.assign(Isocurve.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.Isocurve=Isocurve);const deepEqual=function(s,e){if(s===e)return!0;if(typeof s=="object"&&s!=null&&typeof e=="object"&&e!=null){if(Object.keys(s).length!==Object.keys(e).length)return!1;for(var i in s)if(e.hasOwnProperty(i)){if(!deepEqual(s[i],e[i]))return!1}else return!1;return!0}else return!1};var ReverseGeocodeDOM={_addUID:function(s){var e=this._uid?s+"-"+this._uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPreverseGeocoding"),s.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",s},_createShowReverseGeocodingPictoElement:function(){var s=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowReverseGeocodingPicto"),e.classList.add("GPshowOpen","GPshowAdvancedToolPicto","GPshowReverseGeocodingPicto"),e.classList.add("gpf-btn","gpf-btn--tertiary","gpf-btn-icon","gpf-btn-icon-reverse"),e.classList.add("fr-btn","fr-btn--tertiary"),e.setAttribute("aria-label","Ouvrir la recherche d'adresses"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowReverseGeocodingClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowReverseGeocodingClick(n)}),e},_createReverseGeocodingWaitingElement:function(){var s=document.createElement("div");s.id=this._addUID("GPreverseGeocodingCalcWaitingContainer"),s.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden";var e=document.createElement("p");return e.className="GPwaitingContainerInfo gpf-waiting_info",e.innerHTML="Recherche en cours...",s.appendChild(e),s},_createReverseGeocodingResultsPanelElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPreverseGeocodingResultsPanel"),s.className="GPpanel GPelementHidden gpf-panel gpf-panel-reverse gpf-panel--hidden",s},_createReverseGeocodingResultsListElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPreverseGeocodingResultsList"),s.className="gpf-panel__list",s.setAttribute("tabindex","0"),s},_createReverseGeocodingResultElement:function(s,e){var i=this,n=document.getElementById(this._addUID("GPreverseGeocodingResultsList")),o=document.createElement("div");if(s){o.id=this._addUID("GPreverseGeocodedLocationResultDiv_"+e);var l=document.createElement("div");l.id=this._addUID("GPreverseGeocodedLocation_"+e),l.setAttribute("tabindex","0"),l.className="GPautoCompleteProposal gpf-panel__items",l.innerHTML=s,l.title=s,l.addEventListener?(l.addEventListener("mouseover",function(h){i.onReverseGeocodingResultMouseOver(h)}),l.addEventListener("focus",function(h){i.onReverseGeocodingResultMouseOver(h)}),l.addEventListener("mouseout",function(h){i.onReverseGeocodingResultMouseOut(h)}),l.addEventListener("blur",function(h){i.onReverseGeocodingResultMouseOut(h)}),l.addEventListener("click",function(h){typeof i.onReverseGeocodingResultClick=="function"&&i.onReverseGeocodingResultClick(h)})):l.attachEvent&&(l.attachEvent("onmouseover",function(h){i.onReverseGeocodingResultMouseOver(h)}),l.attachEvent("onmouseout",function(h){i.onReverseGeocodingResultMouseOut(h)}),l.attachEvent("onclick",function(h){typeof i.onReverseGeocodingResultClick=="function"&&i.onReverseGeocodingResultClick(h)}));var c=document.createElement("button");c.type="button",c.id=this._addUID("GPreverseGeocodedLocationResultCopy_"+e),c.setAttribute("data-text-geolocate",l.innerHTML),c.setAttribute("title","Copier le rsultat"),c.classList.add("gpf-btn-icon-copy-result","fr-btn","fr-btn--tertiary","gpf-btn","gpf-btn--tertiary","gpf-btn-icon"),c.addEventListener?c.addEventListener("click",function(h){typeof i.onReverseGeocodingResultCopyButtonClick=="function"&&(i.onReverseGeocodingResultCopyButtonClick(h),c.classList.add("GPcopiedLocation"),setTimeout(()=>{c.classList.remove("GPcopiedLocation")},1e3))}):c.attachEvent&&c.attachEvent("onclick",function(h){typeof i.onReverseGeocodingResultCopyButtonClick=="function"&&i.onReverseGeocodingResultCopyButtonClick(h)}),o.appendChild(l),o.appendChild(c)}else{o.id=this._addUID("GPreverseGeocodedLocationNoResultDiv");var l=document.createElement("div");l.id=this._addUID("GPreverseGeocodedNoResult"),l.setAttribute("tabindex","0"),l.className="GPautoCompleteProposal gpf-panel__items",l.innerHTML="Aucun rsultat trouv",l.title="Aucun rsultat trouv",o.appendChild(l)}n.appendChild(o)},_createReverseGeocodingPanelElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPreverseGeocodingPanel"),s.className="GPpanel gpf-panel fr-modal",s},_createReverseGeocodingPanelDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__body fr-modal__body",s},_createReverseGeocodingPanelHeaderElement:function(){var s=document.createElement("div");return s.className="GPpanelHeader gpf-panel__header fr-modal__header",s},_createReverseGeocodingPanelReturnPictoElement:function(){var s=this,e=document.createElement("button");if(e.id=this._addUID("GPreverseGeocodingReturnPicto"),e.title="Nouvelle recherche",e.className="GPreturnPicto GPimportPanelReturnPicto gpf-btn gpf-btn-icon-return fr-btn fr-btn--close fr-btn--tertiary-no-outline fr-m-1w",e.classList.add("GPelementHidden"),e.classList.add("gpf-hidden"),checkDsfr()){var i=document.createElement("span");i.className="GPelementHidden gpf-visible",i.innerHTML="Retour",e.appendChild(i)}return e.addEventListener?e.addEventListener("click",function(n){document.getElementById(s._addUID("GPreverseGeocodingResultsPanel")).className="GPelementHidden gpf-panel--hidden",document.getElementById(s._addUID("GPreverseGeocodingForm")).className="GPform gpf-panel__content fr-modal__content",document.getElementById(s._addUID("GPreverseGeocodingHeaderTitle")).innerHTML="Trouver une adresse",document.getElementById(s._addUID("GPreverseGeocodingReturnPicto")).classList.add("GPelementHidden"),document.getElementById(s._addUID("GPreverseGeocodingReturnPicto")).classList.add("gpf-hidden"),s.onGPreverseGeocodingReturnPictoClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){document.getElementById(s._addUID("GPreverseGeocodingResultsPanel")).className="GPelementHidden gpf-panel--hidden",document.getElementById(s._addUID("GPreverseGeocodingForm")).className="GPform gpf-panel__content fr-modal__content",document.getElementById(s._addUID("GPreverseGeocodingHeaderTitle")).innerHTML="Trouver une adresse",document.getElementById(s._addUID("GPreverseGeocodingReturnPicto")).classList.add("GPelementHidden"),document.getElementById(s._addUID("GPreverseGeocodingReturnPicto")).classList.add("gpf-hidden"),s.onGPreverseGeocodingReturnPictoClick(n)}),e},_createReverseGeocodingPanelTitleElement:function(){var s=document.createElement("div");return s.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",s.id=this._addUID("GPreverseGeocodingHeaderTitle"),s.innerHTML="Trouver une adresse",s},_createReverseGeocodingPanelCloseElement:function(){var s=this,e=document.createElement("button");e.id=this._addUID("GPreverseGeocodingPanelClose"),e.className="GPpanelClose GPreverseGeocodingPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",e.title="Fermer le panneau",e.addEventListener?(e.addEventListener("click",function(){document.getElementById(s._addUID("GPshowReverseGeocodingPicto")).click()},!1),e.addEventListener("keydown",function(n){n.keyCode===13&&document.getElementById(s._addUID("GPshowReverseGeocodingPicto")).click()},!1)):e.attachEvent&&(e.attachEvent("onclick",function(){document.getElementById(s._addUID("GPshowReverseGeocodingPicto")).click()}),e.attachEvent("onkeydown",function(n){n.keyCode===13&&document.getElementById(s._addUID("GPshowReverseGeocodingPicto")).click()}));var i=document.createElement("span");return i.className="GPelementHidden gpf-visible",i.innerText="Fermer",e.appendChild(i),e},_createReverseGeocodingPanelFormElement:function(){var s=this,e=document.createElement("form");return e.id=this._addUID("GPreverseGeocodingForm"),e.className="GPform gpf-panel__content fr-modal__content",e.addEventListener?e.addEventListener("submit",function(i){i.preventDefault(),s.onReverseGeocodingSubmit()}):e.attachEvent&&e.attachEvent("onsubmit",function(i){i.preventDefault(),s.onReverseGeocodingSubmit()}),e},_createReverseGeocodingFormModeChoiceGeocodingTypeElement:function(s){var e=this,i=document.createElement("div");i.className="GPflexInput gpf-flex gpf-flex-reverse fr-mb-1w";var n=document.createElement("label");n.id="label-recherche-par",n.className="GPlabel gpf-label fr-label",n.innerHTML="Recherche par",n.title="Recherche par",i.appendChild(n);var o=document.createElement("select");o.setAttribute("aria-labelledby","label-recherche-par"),o.className="GPselect gpf-select fr-select",o.addEventListener?o.addEventListener("change",function(f){e.onReverseGeocodingTypeChange(f)}):o.attachEvent&&o.attachEvent("onchange",function(f){e.onReverseGeocodingTypeChange(f)}),(!s||!Array.isArray(s))&&(s=["StreetAddress","PositionOfInterest","CadastralParcel"]);for(var l=0;l<s.length;l++)switch(s[l]){case"PositionOfInterest":var c=document.createElement("option");c.value="PositionOfInterest",c.text="Lieux/toponymes",o.appendChild(c);break;case"StreetAddress":var u=document.createElement("option");u.value="StreetAddress",u.text="Adresses",o.appendChild(u);break;case"CadastralParcel":var h=document.createElement("option");h.value="CadastralParcel",h.text="Parcelles cadastrales",o.appendChild(h);break}return i.appendChild(o),i},_createReverseGeocodingFormModeChoiceGeocodingDelimitationElement:function(s){var e=this,i=document.createElement("div");i.className="GPflexInput gpf-flex gpf-flex-reverse fr-mb-2w";var n=document.createElement("label");n.id="label-delimitation",n.className="GPlabel gpf-label fr-label",n.innerHTML="Dlimitation",n.title="Dlimitation",i.appendChild(n);var o=document.createElement("select");o.setAttribute("aria-labelledby","label-delimitation"),o.className="GPselect gpf-select fr-select",o.addEventListener?o.addEventListener("change",function(f){e.onReverseGeocodingDelimitationChange(f)}):o.attachEvent&&o.attachEvent("onchange",function(f){e.onReverseGeocodingDelimitationChange(f)}),(!s||!Array.isArray(s))&&(s=["Point","Circle","Extent"]);for(var l=0;l<s.length;l++)switch(s[l].toLowerCase()){case"point":var c=document.createElement("option");c.value="point",c.text="Pointer un lieu",o.appendChild(c);break;case"circle":var u=document.createElement("option");u.value="circle",u.text="Dessiner un cercle",o.appendChild(u);break;case"extent":var h=document.createElement("option");h.value="extent",h.text="Dessiner une emprise",o.appendChild(h);break}return i.appendChild(o),i},_createReverseGeocodingSubmitFormElement:function(){var s=document.createElement("input");return s.id=this._addUID("GPreverseGeocodingSubmit"),s.className="GPsubmit gpf-btn fr-btn",s.type="submit",s.value="Rechercher",s}},logger$m=LoggerByDefault.getLogger("reversegeocoding");class ReverseGeocode extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof ReverseGeocode))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="ReverseGeocode",this.initialize(e),this.container=this._initContainer(),this.element?this.element.appendChild(this.container):this.element=this.container,this}getCollapsed(){return this.collapsed}setCollapsed(e){if(e===void 0){logger$m.log("[ERROR] ReverseGeocode:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(e?this._panelCloseButton.click():this._showReverseGeocodingButton.click(),this.collapsed=e)}setMap(e){if(e)this._activateMapInteraction(e),this.draggable&&Draggable.dragElement(this._panelContainer,this._panelHeaderContainer,e.getTargetElement()),this.collapsed||this._showReverseGeocodingButton.setAttribute("aria-pressed",!0);else{var i=this.getMap();this._clearResults(),this._clearInputFeatures(),this._removeMapInteraction(i),this._inputFeaturesLayer!=null&&(i.removeLayer(this._inputFeaturesLayer),this._inputFeaturesLayer=null,this._inputFeaturesSources=null,this._inputFeatures=null)}super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getData(){return this._reverseGeocodingLocations}getContainer(){return this.container}initialize(e){this._checkInputOptions(e),this.options={collapsed:!0,draggable:!1,resources:["StreetAddress","PositionOfInterest","CadastralParcel"],delimitations:["Point","Circle","Extent"],reverseGeocodeOptions:{},layerDescription:{title:"Saisie (recherche inverse)",description:"Couche de saisie d'une zone de recherche pour la recherche inverse"}},Helper.assign(this.options,e),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this._uid=this.options.id||SelectorID.generate(),this._currentGeocodingType=null,this._initGeocodingType(),this._currentGeocodingDelimitation=null,this._initGeocodingDelimitation(),this._showReverseGeocodingButton=null,this._panelContainer=null,this._panelHeaderContainer=null,this._panelTitleContainer=null,this._returnPictoContainer=null,this._panelCloseButton=null,this._formContainer=null,this._resultsContainer=null,this._resultsListContainer=null,this._waitingContainer=null,this._inputFeatures=null,this._inputFeaturesSource=null,this._inputFeaturesLayer=null,this._mapInteraction=null,this._requestOptions=null,this._requestGeom=null,this._requestPosition=null,this._waiting=!1,this._timer=null,this._reverseGeocodingLocations=[],this._reverseGeocodingLocationsMarkers=[],this._resultsDefaultStyle=new Style$1({image:new Icon({src:Marker.lightOrange,anchor:[.5,1]})}),this._resultsSelectedStyle=new Style$1({image:new Icon({src:Marker.red,anchor:[.5,1]})}),this._resultsHoverInteraction=null,this._resultsSelectInteraction=null,this._popupContent=null,this._popupDiv=this._initPopupDiv(),this._popupOverlay=null}_checkInputOptions(e){var i,n;if(e.resources){var o=e.resources;if(Array.isArray(o)){var l=["StreetAddress","PositionOfInterest","CadastralParcel"],c=[];for(i=0;i<o.length;i++)l.indexOf(o[i])===-1&&(c.push(i),logger$m.log("[ReverseGeocode] options.resources : "+o[i]+" is not a resource for reverse geocode"));if(c.length!==0)for(n=0;n<c.length;n++)o.splice(c[n],1)}else logger$m.log("[ReverseGeocode] 'options.resources' parameter should be an array"),o=null}if(e.delimitations){var u=e.delimitations;if(Array.isArray(u)){var h=["Circle","Point","Extent"],f=[];for(i=0;i<u.length;i++)h.indexOf(u[i])===-1&&(f.push(i),logger$m.log("[ReverseGeocode] options.delimitations : "+u[i]+" is not a delimitation for reverse geocode"));if(f.length!==0)for(n=0;n<f.length;n++)u.splice(f[n],1)}else logger$m.log("[ReverseGeocode] 'options.delimitations' parameter should be an array"),u=null}}_initGeocodingType(){this._currentGeocodingType="StreetAddress";var e=this.options.resources;(!e||e.length===0)&&(this.options.resources=["StreetAddress","PositionOfInterest","CadastralParcel"]),Array.isArray(e)&&e.length&&(e[0]==="StreetAddress"||e[0]==="PositionOfInterest"||e[0]==="CadastralParcel")&&(this._currentGeocodingType=e[0]);var i=this.options.reverseGeocodeOptions;i.filterOptions&&Array.isArray(i.filterOptions.type)&&i.filterOptions.type.length!==0&&(this._currentGeocodingType=i.filterOptions.type[0])}_initGeocodingDelimitation(){this._currentGeocodingDelimitation="Point";var e=this.options.delimitations;if((!e||e.length===0)&&(this.options.delimitations=["Point","Circle","Extent"]),Array.isArray(e)&&e.length){var i=e[0].toLowerCase();(i==="point"||i==="circle"||i==="extent")&&(this._currentGeocodingDelimitation=e[0])}}_initPopupDiv(){var e=this,i=document.createElement("div");i.className="gp-feature-info-div";var n=document.createElement("button");return n.className="gp-styling-button closer",n.onclick=function(){return e._popupOverlay!=null&&e._popupOverlay.setPosition(void 0),!1},this._popupContent=document.createElement("div"),this._popupContent.className="gp-features-content-div",i.appendChild(this._popupContent),i.appendChild(n),i}_initContainer(){var e=this._createMainContainerElement(),i=this._showReverseGeocodingButton=this._createShowReverseGeocodingPictoElement();e.appendChild(i);var n=this._panelContainer=this._createReverseGeocodingPanelElement(),o=this._createReverseGeocodingPanelDivElement();n.appendChild(o);var l=this._panelHeaderContainer=this._createReverseGeocodingPanelHeaderElement(),c=this._returnPictoContainer=this._createReverseGeocodingPanelReturnPictoElement();l.appendChild(c);var u=this._panelTitleContainer=this._createReverseGeocodingPanelTitleElement();l.appendChild(u);var h=this._panelCloseButton=this._createReverseGeocodingPanelCloseElement();l.appendChild(h),o.appendChild(l);var f=this._formContainer=this._createReverseGeocodingPanelFormElement();f.appendChild(this._createReverseGeocodingFormModeChoiceGeocodingTypeElement(this.options.resources)),f.appendChild(this._createReverseGeocodingFormModeChoiceGeocodingDelimitationElement(this.options.delimitations));var g=this._createReverseGeocodingSubmitFormElement();f.appendChild(g),o.appendChild(f);var H=this._waitingContainer=this._createReverseGeocodingWaitingElement();o.appendChild(H);var Y=this._resultsContainer=this._createReverseGeocodingResultsPanelElement(),ee=this._resultsListContainer=this._createReverseGeocodingResultsListElement();return Y.appendChild(ee),o.appendChild(Y),e.appendChild(n),logger$m.log(e),e}_activateMapInteraction(e){if(!this.collapsed){this._inputFeaturesLayer==null&&(this._inputFeatures=new Collection,this._inputFeaturesSource=new VectorSource({features:this._inputFeatures}),this._inputFeaturesLayer=new VectorLayer({source:this._inputFeaturesSource,style:new Style$1({fill:new Fill({color:"rgba(0, 183, 152, 0.3)"}),stroke:new Stroke({color:"rgba(0, 183, 152, 0.8)",width:3}),image:new Icon({src:Marker.turquoiseBlue,anchor:[.5,1]})})}),this._inputFeaturesLayer.gpResultLayerId="reverseGeocoding",e.addLayer(this._inputFeaturesLayer));var i=this._currentGeocodingDelimitation.toLowerCase();switch(i){case"point":this._activatePointInteraction(e);break;case"circle":this._activateCircleInteraction(e);break;case"extent":this._activateBoxInteraction(e);break}e.getControls().forEach(n=>{if(n instanceof LayerSwitcher){var o=this._inputFeaturesLayer.gpLayerId;n._layers[o].title===o&&(n.addLayer(this._inputFeaturesLayer,{title:this.options.layerDescription.title,description:this.options.layerDescription.description}),n.setRemovable(this._inputFeaturesLayer,!1))}})}}_activatePointInteraction(e){this._mapInteraction=new Draw({style:new Style$1({image:new CircleStyle({radius:0,fill:new Fill({color:"rgba(0, 183, 152, 0.8)"})})}),type:"Point",source:this._inputFeaturesSource}),this._mapInteraction.on("drawstart",i=>{logger$m.log("on drawstart ",i),this._inputFeatures.clear(),this._onDrawStart(i,"point")}),this._mapInteraction.on("drawend",i=>{logger$m.log("on drawend",i),i.feature&&i.feature.getGeometry&&(this._requestGeom={type:"Point",coordinates:[this._requestPosition.lon,this._requestPosition.lat]})}),e.addInteraction(this._mapInteraction),this._setCursor("crosshair",e)}_activateCircleInteraction(e){this._mapInteraction=new Draw({style:new Style$1({fill:new Fill({color:"rgba(0, 183, 152, 0.3)"}),stroke:new Stroke({color:"rgba(0, 183, 152, 0.8)",width:3}),image:new CircleStyle({radius:4,fill:new Fill({color:"rgba(0, 183, 152, 0.8)"})})}),type:"Circle",source:this._inputFeaturesSource,geometryFunction:function(i,n){const o=i[0],l=i[i.length-1],c=o[0]-l[0],u=o[1]-l[1],f=Math.min(Math.sqrt(c*c+u*u),500);return n?n.setCenterAndRadius(o,f):n=new Circle(o,f),n}}),this._mapInteraction.on("drawstart",i=>{logger$m.log("on drawstart ",i),this._inputFeatures.clear(),this._onDrawStart(i,"circle")}),this._mapInteraction.on("drawend",i=>{if(logger$m.log("on drawend",i),i.feature&&i.feature.getGeometry){var n=i.feature.getGeometry().getRadius();this._requestGeom={},this._requestGeom.type="Circle",this._requestGeom.radius=n,this._requestPosition&&(this._requestGeom.coordinates=[this._requestPosition.lon,this._requestPosition.lat]),logger$m.log("circle radius : ",n)}}),e.addInteraction(this._mapInteraction)}_activateBoxInteraction(e){var i=function(n,o){o||(o=new Polygon([]));var l=n[0],c=n[1];const u=l[0]-c[0],h=l[1]-c[1],f=1e3,g=Math.max(-f,Math.min(u,f)),H=Math.max(-f,Math.min(h,f));return o.setCoordinates([[l,[l[0],l[1]-H],[l[0]-g,l[1]-H],[l[0]-g,l[1]],l]]),o};this._mapInteraction=new Draw({style:new Style$1({fill:new Fill({color:"rgba(0, 183, 152, 0.3)"}),stroke:new Stroke({color:"rgba(0, 183, 152, 0.8)",width:3}),image:new CircleStyle({radius:4,fill:new Fill({color:"rgba(0, 183, 152, 0.8)"})})}),type:"LineString",source:this._inputFeaturesSource,maxPoints:2,geometryFunction:i}),this._mapInteraction.on("drawstart",n=>{logger$m.log("on drawstart",n),this._inputFeatures.clear(),this._onDrawStart(n,"polygon")}),this._mapInteraction.on("drawend",n=>{logger$m.log("on drawend",n),this._onBoxDrawEnd(n)}),e.addInteraction(this._mapInteraction)}_removeMapInteraction(e){this._mapInteraction!=null&&(e.removeInteraction(this._mapInteraction),this._mapInteraction=null),this._setCursor()}_onDrawStart(e,i){var n;if(e.feature&&e.feature.getGeometry){var o=e.feature.getGeometry();i==="point"&&(n=o.getCoordinates()),i==="circle"&&(n=o.getCenter()),i==="polygon"&&(n=o.getFirstCoordinate())}if(n){var l;if(this.options.reverseGeocodeOptions&&this.options.reverseGeocodeOptions.srs)l=this.options.reverseGeocodeOptions.srs;else{var c=this.getMap();if(!c||!c.getView())return;l=c.getView().getProjection()}var u=transform$1(n,l,"EPSG:4326");this._requestPosition={lon:u[0],lat:u[1]},logger$m.log("position coordinates : ",this._requestPosition)}}_onBoxDrawEnd(e){if(e.feature&&e.feature.getGeometry){var i=e.feature.getGeometry().getCoordinates()[0],n=i[0],o=i[2],l;if(this.options.reverseGeocodeOptions&&this.options.reverseGeocodeOptions.srs)l=this.options.reverseGeocodeOptions.srs;else{var c=this.getMap();if(!c||!c.getView())return;l=c.getView().getProjection()}var u=transform$1(n,l,"EPSG:4326"),h=transform$1(o,l,"EPSG:4326"),f={};u[0]<h[0]?(f.left=u[0],f.right=h[0]):(f.left=h[0],f.right=u[0]),u[1]<h[1]?(f.bottom=u[1],f.top=h[1]):(f.bottom=h[1],f.top=u[1]),this._requestGeom={type:"Polygon",coordinates:[[[f.left,f.top],[f.left,f.bottom],[f.right,f.bottom],[f.right,f.top],[f.left,f.top]]]},logger$m.log("searchGeometry filter : ",this._requestGeom)}}_setCursor(e,i){if(i=i||this.getMap(),!!i){var n=i.getTargetElement();e?n.style.cursor=e:n.style.cursor=null}}_reverseGeocodingRequest(){var e=this.getMap();this._requestOptions=this._getReverseGeocodingRequestOptions(),this._removeMapInteraction(e),this._displayWaitingContainer(),Gp.Services.reverseGeocode(this._requestOptions)}_getReverseGeocodingRequestOptions(){var e=this.getMap(),i=this.options.reverseGeocodeOptions,n=this;typeof this.options.ssl!="boolean"&&(this.options.ssl=!0);var o=i.onFailure!==null&&typeof i.onFailure=="function",l=i.onSuccess!==null&&typeof i.onSuccess=="function",c={apiKey:i.apiKey||this.options.apiKey,ssl:this.options.ssl,position:this._requestPosition,filterOptions:{type:[this._currentGeocodingType]},srs:"CRS:84",returnFreeForm:!1,maximumResponses:i.maximumResponses||18,timeOut:i.timeOut||3e4,onSuccess:function(u){u.locations&&(logger$m.log("reverseGeocode results : ",u.locations),n._displayGeocodedLocations(u.locations)),l&&i.onSuccess.call(n,u.locations)},onFailure:function(u){n._hideWaitingContainer(),n._clearResults(),n._clearInputFeatures(),n._activateMapInteraction(e),logger$m.log(u.message),o&&i.onFailure.call(n,u)}};return this._requestGeom.type.toLowerCase()==="circle"?(this._requestGeom.radius>500&&(logger$m.log("INFO : initial circle radius ("+this._requestGeom.radius+") limited to 1000m."),this._requestGeom.radius=500),c.searchGeometry=this._requestGeom):this._requestGeom.type.toLowerCase()==="polygon"?c.searchGeometry=this._requestGeom:this._requestGeom.type.toLowerCase()==="point"&&(this._currentGeocodingType==="StreetAddress"?(c.searchGeometry={type:"Circle",radius:50,coordinates:this._requestGeom.coordinates},c.maximumResponses=1):c.searchGeometry=this._requestGeom),logger$m.log("reverseGeocode request options : ",c),c}_displayGeocodedLocations(e){this._clearResults(),this._reverseGeocodingLocations=e,this.dispatchEvent({type:"reversegeocode:compute"}),this._formContainer.className="GPelementHidden gpf-hidden",this._hideWaitingContainer(),this._panelTitleContainer.innerHTML="Rsultats de la recherche",this._returnPictoContainer.classList.remove("GPelementHidden"),this._returnPictoContainer.classList.remove("gpf-hidden"),this._resultsContainer.className="GPform gpf-panel__content fr-modal__content",this._fillGeocodedLocationListContainer(e),this._displayGeocodedLocationsOnMap(e)}_fillGeocodedLocationListContainer(e){e.length===0&&this._createReverseGeocodingResultElement();for(var i=0;i<e.length;i++){var n=e[i];logger$m.log(n);var o=this._fillGeocodedLocationDescription(n);o&&o.length!==0&&this._createReverseGeocodingResultElement(o,i)}}_fillGeocodedLocationDescription(e){if(!(!e||!e.placeAttributes)){var i=e.placeAttributes,n="";switch(e.type){case"StreetAddress":i.street&&(n+=i.housenumber?i.housenumber+" ":"",n+=i.street+", "),n+=i.postcode+" "+i.city;break;case"PositionOfInterest":n+=i.toponym,i.postcode&&i.postcode.length===1&&(n+=", "+i.postcode[0]),n+=" ("+i.category.join(",")+")";break;case"CadastralParcel":n+=i.id,n+=i.city?" ("+i.city+")":"";break;default:n+=i.city?i.city:"";break}return n}}_displayGeocodedLocationsOnMap(e){if(this._reverseGeocodingLocations.length!==0){var i=this.getMap();this._createResultsLayer();for(var n=0;n<e.length;n++)this._addResultFeature(e[n],n);if(this._resultsFeatures.getLength()>1){if(this._resultsFeaturesSource&&this._resultsFeaturesSource.getExtent){var o=this._resultsFeaturesSource.getExtent();i.getView().fit(o,i.getSize())}}else{var l=this._resultsFeatures.item(0),c=l.getGeometry().getCoordinates();i.getView().setCenter(c),i.getView().setZoom(17)}this._resultsHoverInteraction=new Select({condition:pointerMove,layers:[this._resultsFeaturesLayer]}),this._resultsHoverInteraction.on("select",h=>this._onResultsFeatureMouseOver(h)),i.addInteraction(this._resultsHoverInteraction),this._resultsSelectInteraction=new Select({layers:[this._resultsFeaturesLayer]}),this._resultsSelectInteraction.on("select",h=>this._onResultsFeatureSelect(h)),i.addInteraction(this._resultsSelectInteraction);var u="";switch(this._currentGeocodingType){case"StreetAddress":u="adresses";break;case"PositionOfInterest":u="toponymes";break;case"CadastralParcel":u="parcelles cadastrales";break}i.getControls().forEach(h=>{if(h instanceof LayerSwitcher){var f=this._resultsFeaturesLayer.gpLayerId;h._layers[f].title===f&&(h.addLayer(this._resultsFeaturesLayer,{title:"Rsultats de la recherche inverse",description:"Rsultats de la recherche inverse sur les "+u}),h.setRemovable(this._resultsFeaturesLayer,!1))}})}}_createResultsLayer(){var e=this.getMap();this._resultsFeatures=new Collection,this._resultsFeaturesSource=new VectorSource({features:this._resultsFeatures}),this._resultsFeaturesLayer=new VectorLayer({source:this._resultsFeaturesSource}),this._resultsFeaturesLayer.gpResultLayerId="reverseGeocodingResults",e.addLayer(this._resultsFeaturesLayer)}_addResultFeature(e,i){var n=this.getMap(),o=[e.position.lon,e.position.lat];if(o.length!==0){var l=n.getView(),c=l.getProjection().getCode();c!=="EPSG:4326"&&(o=transform$1(o,"EPSG:4326",c));var u=new Feature({geometry:new Point$1(o)});u.setStyle(this._resultsDefaultStyle),u.setId(i),u.setProperties({location:e,popupContent:this._fillPopupContent(e)}),this._resultsFeatures.push(u)}}_fillPopupContent(e){var i="<ul>",n=e.placeAttributes;for(var o in n)n.hasOwnProperty(o)&&o!=="trueGeometry"&&o!=="extraFields"&&o!=="houseNumberInfos"&&o!=="_count"&&(i+="<li>",i+='<span class="gp-attname-others-span">'+o.toUpperCase()+" : </span>",i+=n[o],i+=" </li>");return i+=" </ul>",i}_onResultsFeatureMouseOver(e){var i;if(e.selected.length!==0){if(i=e.selected[0],i.setStyle(this._resultsSelectedStyle),i.getId()!=null){var n=document.getElementById("GPreverseGeocodedLocation_"+i.getId()+"-"+this._uid);n&&n.classList&&n.classList.add("GPlocationHighlight")}document.getElementById("GPreverseGeocodedLocation_"+i.getId()+"-"+this._uid)}if(e.deselected.length!==0){i=e.deselected[0],i.setStyle(this._resultsDefaultStyle);var o=document.getElementById("GPreverseGeocodedLocation_"+i.getId()+"-"+this._uid);o&&o.classList&&o.classList.remove("GPlocationHighlight")}}_onResultsFeatureSelect(e){var i=this.getMap();if(e.selected.length!==0){var n=e.selected[0];this._popupContent.innerHTML=n.getProperties().popupContent,this._popupOverlay?this._popupOverlay.setPosition(e.mapBrowserEvent.coordinate):(this._popupOverlay=new Overlay({element:this._popupDiv,positioning:"bottom-center",position:e.mapBrowserEvent.coordinate}),i.addOverlay(this._popupOverlay)),this.dispatchEvent({type:"reversegeocode:onclickresult",location:n.getProperties().location})}else this._popupOverlay!=null&&this._popupOverlay.setPosition(void 0)}onShowReverseGeocodingClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen();var i=this.getMap();if(i){Interactions.unset(i);var n=this._showReverseGeocodingButton.ariaPressed;this.collapsed=n!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position),!this._waiting&&!this._reverseGeocodingLocations.length&&(this.collapsed?(this._clearResults(),this._clearInputFeatures(),this._removeMapInteraction(i),this._inputFeaturesLayer!=null&&(i.removeLayer(this._inputFeaturesLayer),this._inputFeaturesLayer=null,this._inputFeaturesSources=null,this._inputFeatures=null)):this._activateMapInteraction(i))}}onReverseGeocodingTypeChange(e){var i=e.target.selectedIndex,n=e.target.options[i].value;n&&(logger$m.log(n),this._currentGeocodingType=n)}onReverseGeocodingDelimitationChange(e){var i=e.target.selectedIndex,n=e.target.options[i].value;if(n){logger$m.log(n),this._currentGeocodingDelimitation=n;var o=this.getMap();this._clearInputFeatures(),this._removeMapInteraction(o),this._activateMapInteraction(o)}}onGPreverseGeocodingReturnPictoClick(){this._clearResults(),this._clearInputFeatures(),this._activateMapInteraction(this.getMap())}onReverseGeocodingSubmit(){if(!this._requestPosition){logger$m.log("missing position");return}this._reverseGeocodingRequest()}onReverseGeocodingResultClick(e){var i=e.target.id,n=i.substring(i.indexOf("_")+1),o=this._resultsFeaturesSource.getFeatureById(parseInt(n,10));this.dispatchEvent({type:"reversegeocode:onclickresult",location:o.getProperties().location})}onReverseGeocodingResultMouseOver(e){var i=e.target.id,n=i.substring(i.indexOf("_")+1);if(e.target.classList&&e.target.classList.add("GPlocationHighlight"),!!this._resultsFeaturesSource){var o=this._resultsFeaturesSource.getFeatureById(parseInt(n,10));o.setStyle(this._resultsSelectedStyle)}}onReverseGeocodingResultMouseOut(e){var i=e.target.id,n=i.substring(i.indexOf("_")+1);if(e.target.classList&&e.target.classList.remove("GPlocationHighlight"),!!this._resultsFeaturesSource){var o=this._resultsFeaturesSource.getFeatureById(parseInt(n,10));o.setStyle(this._resultsDefaultStyle)}}onReverseGeocodingResultCopyButtonClick(e){navigator.clipboard.writeText(e.target.getAttribute("data-text-geolocate")).then(()=>console.log("Texte copi !")).catch(i=>console.error("Erreur de copie :",i))}_clearResults(){var e=this.getMap();if(this._reverseGeocodingLocations=[],this._resultsListContainer)for(;this._resultsListContainer.firstChild;)this._resultsListContainer.removeChild(this._resultsListContainer.firstChild);this._resultsFeaturesLayer&&(e.removeLayer(this._resultsFeaturesLayer),this._resultsFeaturesLayer=null),this._popupOverlay!=null&&(e.removeOverlay(this._popupOverlay),this._popupOverlay=null),this._resultsSelectInteraction!=null&&(e.removeInteraction(this._resultsSelectInteraction),this._resultsSelectInteraction=null),this._resultsHoverInteraction!=null&&(e.removeInteraction(this._resultsHoverInteraction),this._resultsHoverInteraction=null)}_clearInputFeatures(){this._inputFeatures&&this._inputFeatures.clear(),this._requestGeom=null,this._requestPosition=null}_displayWaitingContainer(){this._waitingContainer.className="GPwaitingContainer GPwaitingContainerVisible gpf-waiting gpf-waiting--visible",this._waiting=!0,this._timer&&(clearTimeout(this._timer),this._timer=null);var e=this;this._timer=setTimeout(function(){e._waiting===!0?e._hideWaitingContainer():e._timer&&clearTimeout(e._timer)},16e3)}_hideWaitingContainer(){this._waiting&&(this._waitingContainer.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden",this._waiting=!1,clearTimeout(this._timer),this._timer=null)}}Object.assign(ReverseGeocode.prototype,ReverseGeocodeDOM);Object.assign(ReverseGeocode.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.ReverseGeocode=ReverseGeocode);class XML{read(e){if(!e)return null;if(typeof e=="string"){const i=parse$1(e);return this.readFromDocument(i)}return isDocument(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let i=e.firstChild;i;i=i.nextSibling)if(i.nodeType==Node.ELEMENT_NODE)return this.readFromNode(i);return null}readFromNode(e){abstract()}}const NAMESPACE_URI="http://www.w3.org/1999/xlink";function readHref(s){return s.getAttributeNS(NAMESPACE_URI,"href")}const NAMESPACE_URIS$2=[null,"http://www.opengis.net/wms","http://www.opengis.net/sld"];function isV13(s){return compareVersions(s[0].version,"1.3")>=0}const PARSERS$2=makeStructureNS(NAMESPACE_URIS$2,{Service:makeObjectPropertySetter(readService),Capability:makeObjectPropertySetter(readCapability)}),CAPABILITY_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{Request:makeObjectPropertySetter(readRequest),Exception:makeObjectPropertySetter(readException),Layer:makeObjectPropertySetter(readCapabilityLayer),UserDefinedSymbolization:makeObjectPropertySetter(readUserDefinedSymbolization)});class WMSCapabilities extends XML{constructor(){super(),this.version=void 0}readFromNode(e){this.version=e.getAttribute("version").trim();const i=pushParseAndPop({version:this.version},PARSERS$2,e,[]);return i||null}}const COMMON_SERVICE_PARSERS={Name:makeObjectPropertySetter(readString),Title:makeObjectPropertySetter(readString),Abstract:makeObjectPropertySetter(readString),KeywordList:makeObjectPropertySetter(readKeywordList),OnlineResource:makeObjectPropertySetter(readHref),ContactInformation:makeObjectPropertySetter(readContactInformation),Fees:makeObjectPropertySetter(readString),AccessConstraints:makeObjectPropertySetter(readString)},SERVICE_PARSERS=makeStructureNS(NAMESPACE_URIS$2,COMMON_SERVICE_PARSERS),SERVICE_PARSERS_V13=makeStructureNS(NAMESPACE_URIS$2,{...COMMON_SERVICE_PARSERS,LayerLimit:makeObjectPropertySetter(readPositiveInteger),MaxWidth:makeObjectPropertySetter(readPositiveInteger),MaxHeight:makeObjectPropertySetter(readPositiveInteger)}),CONTACT_INFORMATION_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{ContactPersonPrimary:makeObjectPropertySetter(readContactPersonPrimary),ContactPosition:makeObjectPropertySetter(readString),ContactAddress:makeObjectPropertySetter(readContactAddress),ContactVoiceTelephone:makeObjectPropertySetter(readString),ContactFacsimileTelephone:makeObjectPropertySetter(readString),ContactElectronicMailAddress:makeObjectPropertySetter(readString)}),CONTACT_PERSON_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{ContactPerson:makeObjectPropertySetter(readString),ContactOrganization:makeObjectPropertySetter(readString)}),CONTACT_ADDRESS_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{AddressType:makeObjectPropertySetter(readString),Address:makeObjectPropertySetter(readString),City:makeObjectPropertySetter(readString),StateOrProvince:makeObjectPropertySetter(readString),PostCode:makeObjectPropertySetter(readString),Country:makeObjectPropertySetter(readString)}),EXCEPTION_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{Format:makeArrayPusher(readString)}),COMMON_LAYER_PARSERS={Name:makeObjectPropertySetter(readString),Title:makeObjectPropertySetter(readString),Abstract:makeObjectPropertySetter(readString),KeywordList:makeObjectPropertySetter(readKeywordList),BoundingBox:makeObjectPropertyPusher(readBoundingBox$1),Dimension:makeObjectPropertyPusher(readDimension),Attribution:makeObjectPropertySetter(readAttribution),AuthorityURL:makeObjectPropertyPusher(readAuthorityURL),Identifier:makeObjectPropertyPusher(readString),MetadataURL:makeObjectPropertyPusher(readMetadataURL),DataURL:makeObjectPropertyPusher(readFormatOnlineresource),FeatureListURL:makeObjectPropertyPusher(readFormatOnlineresource),Style:makeObjectPropertyPusher(readStyle$1),Layer:makeObjectPropertyPusher(readLayer$1)},LAYER_PARSERS$1=makeStructureNS(NAMESPACE_URIS$2,{...COMMON_LAYER_PARSERS,SRS:makeObjectPropertyPusher(readString),Extent:makeObjectPropertySetter(readExtent),ScaleHint:makeObjectPropertyPusher(readScaleHint),LatLonBoundingBox:makeObjectPropertySetter((s,e)=>readBoundingBox$1(s,e,!1)),Layer:makeObjectPropertyPusher(readLayer$1)}),LAYER_PARSERS_V13=makeStructureNS(NAMESPACE_URIS$2,{...COMMON_LAYER_PARSERS,CRS:makeObjectPropertyPusher(readString),EX_GeographicBoundingBox:makeObjectPropertySetter(readEXGeographicBoundingBox),MinScaleDenominator:makeObjectPropertySetter(readDecimal),MaxScaleDenominator:makeObjectPropertySetter(readDecimal),Layer:makeObjectPropertyPusher(readLayer$1)}),ATTRIBUTION_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{Title:makeObjectPropertySetter(readString),OnlineResource:makeObjectPropertySetter(readHref),LogoURL:makeObjectPropertySetter(readSizedFormatOnlineresource)}),EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{westBoundLongitude:makeObjectPropertySetter(readDecimal),eastBoundLongitude:makeObjectPropertySetter(readDecimal),southBoundLatitude:makeObjectPropertySetter(readDecimal),northBoundLatitude:makeObjectPropertySetter(readDecimal)}),REQUEST_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{GetCapabilities:makeObjectPropertySetter(readOperationType),GetMap:makeObjectPropertySetter(readOperationType),GetFeatureInfo:makeObjectPropertySetter(readOperationType),DescribeLayer:makeObjectPropertySetter(readOperationType),GetLegendGraphic:makeObjectPropertySetter(readOperationType)}),OPERATIONTYPE_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{Format:makeObjectPropertyPusher(readString),DCPType:makeObjectPropertyPusher(readDCPType)}),DCPTYPE_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{HTTP:makeObjectPropertySetter(readHTTP)}),HTTP_PARSERS$1=makeStructureNS(NAMESPACE_URIS$2,{Get:makeObjectPropertySetter(readFormatOnlineresource),Post:makeObjectPropertySetter(readFormatOnlineresource)}),STYLE_PARSERS$1=makeStructureNS(NAMESPACE_URIS$2,{Name:makeObjectPropertySetter(readString),Title:makeObjectPropertySetter(readString),Abstract:makeObjectPropertySetter(readString),LegendURL:makeObjectPropertyPusher(readSizedFormatOnlineresource),StyleSheetURL:makeObjectPropertySetter(readFormatOnlineresource),StyleURL:makeObjectPropertySetter(readFormatOnlineresource)}),FORMAT_ONLINERESOURCE_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{Format:makeObjectPropertySetter(readString),OnlineResource:makeObjectPropertySetter(readHref)}),KEYWORDLIST_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{Keyword:makeArrayPusher(readString)});function readAttribution(s,e){return pushParseAndPop({},ATTRIBUTION_PARSERS,s,e)}function readUserDefinedSymbolization(s,e){return{SupportSLD:!!readBooleanString(s.getAttribute("SupportSLD")),UserLayer:!!readBooleanString(s.getAttribute("UserLayer")),UserStyle:!!readBooleanString(s.getAttribute("UserStyle")),RemoteWFS:!!readBooleanString(s.getAttribute("RemoteWFS")),InlineFeatureData:!!readBooleanString(s.getAttribute("InlineFeatureData")),RemoteWCS:!!readBooleanString(s.getAttribute("RemoteWCS"))}}function readBoundingBox$1(s,e,i=!0){const n=[readDecimalString(s.getAttribute("minx")),readDecimalString(s.getAttribute("miny")),readDecimalString(s.getAttribute("maxx")),readDecimalString(s.getAttribute("maxy"))],o=[readDecimalString(s.getAttribute("resx")),readDecimalString(s.getAttribute("resy"))],l={extent:n,res:o};return i&&(isV13(e)?l.crs=s.getAttribute("CRS"):l.srs=s.getAttribute("SRS")),l}function readEXGeographicBoundingBox(s,e){const i=pushParseAndPop({},EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS,s,e);if(!i)return;const n=i.westBoundLongitude,o=i.southBoundLatitude,l=i.eastBoundLongitude,c=i.northBoundLatitude;if(!(n===void 0||o===void 0||l===void 0||c===void 0))return[n,o,l,c]}function readCapability(s,e){return pushParseAndPop({},CAPABILITY_PARSERS,s,e)}function readService(s,e){return pushParseAndPop({},isV13(e)?SERVICE_PARSERS_V13:SERVICE_PARSERS,s,e)}function readContactInformation(s,e){return pushParseAndPop({},CONTACT_INFORMATION_PARSERS,s,e)}function readContactPersonPrimary(s,e){return pushParseAndPop({},CONTACT_PERSON_PARSERS,s,e)}function readContactAddress(s,e){return pushParseAndPop({},CONTACT_ADDRESS_PARSERS,s,e)}function readException(s,e){return pushParseAndPop([],EXCEPTION_PARSERS,s,e)}function readCapabilityLayer(s,e){const i=pushParseAndPop({},isV13(e)?LAYER_PARSERS_V13:LAYER_PARSERS$1,s,e);return i.Layer===void 0?Object.assign(i,readLayer$1(s,e)):i}function readLayer$1(s,e){const i=isV13(e),n=e[e.length-1],o=pushParseAndPop({},i?LAYER_PARSERS_V13:LAYER_PARSERS$1,s,e);if(!o)return;let l=readBooleanString(s.getAttribute("queryable"));l===void 0&&(l=n.queryable),o.queryable=l!==void 0?l:!1;let c=readNonNegativeIntegerString(s.getAttribute("cascaded"));c===void 0&&(c=n.cascaded),o.cascaded=c;let u=readBooleanString(s.getAttribute("opaque"));u===void 0&&(u=n.opaque),o.opaque=u!==void 0?u:!1;let h=readBooleanString(s.getAttribute("noSubsets"));h===void 0&&(h=n.noSubsets),o.noSubsets=h!==void 0?h:!1;let f=readDecimalString(s.getAttribute("fixedWidth"));f||(f=n.fixedWidth),o.fixedWidth=f;let g=readDecimalString(s.getAttribute("fixedHeight"));g||(g=n.fixedHeight),o.fixedHeight=g;const H=["Style","AuthorityURL"];i?H.push("CRS"):H.push("SRS","Dimension"),H.forEach(function(ee){if(ee in n){const te=o[ee]||[];o[ee]=te.concat(n[ee])}});const Y=["BoundingBox","Attribution"];return i?Y.push("Dimension","EX_GeographicBoundingBox","MinScaleDenominator","MaxScaleDenominator"):Y.push("LatLonBoundingBox","ScaleHint","Extent"),Y.forEach(function(ee){if(!(ee in o)){const te=n[ee];o[ee]=te}}),o}function readDimension(s,e){const i={name:s.getAttribute("name"),units:s.getAttribute("units"),unitSymbol:s.getAttribute("unitSymbol")};return isV13(e)&&Object.assign(i,{default:s.getAttribute("default"),multipleValues:readBooleanString(s.getAttribute("multipleValues")),nearestValue:readBooleanString(s.getAttribute("nearestValue")),current:readBooleanString(s.getAttribute("current")),values:readString(s)}),i}function readExtent(s,e){return{name:s.getAttribute("name"),default:s.getAttribute("default"),nearestValue:readBooleanString(s.getAttribute("nearestValue"))}}function readScaleHint(s,e){return{min:readDecimalString(s.getAttribute("min")),max:readDecimalString(s.getAttribute("max"))}}function readFormatOnlineresource(s,e){return pushParseAndPop({},FORMAT_ONLINERESOURCE_PARSERS,s,e)}function readRequest(s,e){return pushParseAndPop({},REQUEST_PARSERS,s,e)}function readDCPType(s,e){return pushParseAndPop({},DCPTYPE_PARSERS,s,e)}function readHTTP(s,e){return pushParseAndPop({},HTTP_PARSERS$1,s,e)}function readOperationType(s,e){return pushParseAndPop({},OPERATIONTYPE_PARSERS,s,e)}function readSizedFormatOnlineresource(s,e){const i=readFormatOnlineresource(s,e);if(i){const n=[readNonNegativeIntegerString(s.getAttribute("width")),readNonNegativeIntegerString(s.getAttribute("height"))];return i.size=n,i}}function readAuthorityURL(s,e){const i=readFormatOnlineresource(s,e);if(i)return i.name=s.getAttribute("name"),i}function readMetadataURL(s,e){const i=readFormatOnlineresource(s,e);if(i)return i.type=s.getAttribute("type"),i}function readStyle$1(s,e){return pushParseAndPop({},STYLE_PARSERS$1,s,e)}function readKeywordList(s,e){return pushParseAndPop([],KEYWORDLIST_PARSERS,s,e)}const NAMESPACE_URIS$1=[null,"http://www.opengis.net/ows/1.1"],PARSERS$1=makeStructureNS(NAMESPACE_URIS$1,{ServiceIdentification:makeObjectPropertySetter(readServiceIdentification),ServiceProvider:makeObjectPropertySetter(readServiceProvider),OperationsMetadata:makeObjectPropertySetter(readOperationsMetadata)});class OWS extends XML{constructor(){super()}readFromNode(e){const i=pushParseAndPop({},PARSERS$1,e,[]);return i||null}}const ADDRESS_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{DeliveryPoint:makeObjectPropertySetter(readString),City:makeObjectPropertySetter(readString),AdministrativeArea:makeObjectPropertySetter(readString),PostalCode:makeObjectPropertySetter(readString),Country:makeObjectPropertySetter(readString),ElectronicMailAddress:makeObjectPropertySetter(readString)}),ALLOWED_VALUES_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Value:makeObjectPropertyPusher(readValue)}),CONSTRAINT_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{AllowedValues:makeObjectPropertySetter(readAllowedValues)}),CONTACT_INFO_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Phone:makeObjectPropertySetter(readPhone),Address:makeObjectPropertySetter(readAddress)}),DCP_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{HTTP:makeObjectPropertySetter(readHttp)}),HTTP_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Get:makeObjectPropertyPusher(readGet),Post:void 0}),OPERATION_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{DCP:makeObjectPropertySetter(readDcp)}),OPERATIONS_METADATA_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Operation:readOperation}),PHONE_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Voice:makeObjectPropertySetter(readString),Facsimile:makeObjectPropertySetter(readString)}),REQUEST_METHOD_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Constraint:makeObjectPropertyPusher(readConstraint)}),SERVICE_CONTACT_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{IndividualName:makeObjectPropertySetter(readString),PositionName:makeObjectPropertySetter(readString),ContactInfo:makeObjectPropertySetter(readContactInfo)}),SERVICE_IDENTIFICATION_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Abstract:makeObjectPropertySetter(readString),AccessConstraints:makeObjectPropertySetter(readString),Fees:makeObjectPropertySetter(readString),Title:makeObjectPropertySetter(readString),ServiceTypeVersion:makeObjectPropertySetter(readString),ServiceType:makeObjectPropertySetter(readString)}),SERVICE_PROVIDER_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{ProviderName:makeObjectPropertySetter(readString),ProviderSite:makeObjectPropertySetter(readHref),ServiceContact:makeObjectPropertySetter(readServiceContact)});function readAddress(s,e){return pushParseAndPop({},ADDRESS_PARSERS,s,e)}function readAllowedValues(s,e){return pushParseAndPop({},ALLOWED_VALUES_PARSERS,s,e)}function readConstraint(s,e){const i=s.getAttribute("name");if(i)return pushParseAndPop({name:i},CONSTRAINT_PARSERS,s,e)}function readContactInfo(s,e){return pushParseAndPop({},CONTACT_INFO_PARSERS,s,e)}function readDcp(s,e){return pushParseAndPop({},DCP_PARSERS,s,e)}function readGet(s,e){const i=readHref(s);if(i)return pushParseAndPop({href:i},REQUEST_METHOD_PARSERS,s,e)}function readHttp(s,e){return pushParseAndPop({},HTTP_PARSERS,s,e)}function readOperation(s,e){const i=s.getAttribute("name"),n=pushParseAndPop({},OPERATION_PARSERS,s,e);if(!n)return;const o=e[e.length-1];o[i]=n}function readOperationsMetadata(s,e){return pushParseAndPop({},OPERATIONS_METADATA_PARSERS,s,e)}function readPhone(s,e){return pushParseAndPop({},PHONE_PARSERS,s,e)}function readServiceIdentification(s,e){return pushParseAndPop({},SERVICE_IDENTIFICATION_PARSERS,s,e)}function readServiceContact(s,e){return pushParseAndPop({},SERVICE_CONTACT_PARSERS,s,e)}function readServiceProvider(s,e){return pushParseAndPop({},SERVICE_PROVIDER_PARSERS,s,e)}function readValue(s,e){return readString(s)}const NAMESPACE_URIS=[null,"http://www.opengis.net/wmts/1.0"],OWS_NAMESPACE_URIS=[null,"http://www.opengis.net/ows/1.1"],PARSERS=makeStructureNS(NAMESPACE_URIS,{Contents:makeObjectPropertySetter(readContents)});class WMTSCapabilities extends XML{constructor(){super(),this.owsParser_=new OWS}readFromNode(e){let i=e.getAttribute("version");i&&(i=i.trim());let n=this.owsParser_.readFromNode(e);return n?(n.version=i,n=pushParseAndPop(n,PARSERS,e,[]),n||null):null}}const CONTENTS_PARSERS=makeStructureNS(NAMESPACE_URIS,{Layer:makeObjectPropertyPusher(readLayer),TileMatrixSet:makeObjectPropertyPusher(readTileMatrixSet)}),LAYER_PARSERS=makeStructureNS(NAMESPACE_URIS,{Style:makeObjectPropertyPusher(readStyle),Format:makeObjectPropertyPusher(readString),TileMatrixSetLink:makeObjectPropertyPusher(readTileMatrixSetLink),Dimension:makeObjectPropertyPusher(readDimensions),ResourceURL:makeObjectPropertyPusher(readResourceUrl)},makeStructureNS(OWS_NAMESPACE_URIS,{Title:makeObjectPropertySetter(readString),Abstract:makeObjectPropertySetter(readString),WGS84BoundingBox:makeObjectPropertySetter(readBoundingBox),BoundingBox:makeObjectPropertyPusher(readBoundingBoxWithCrs),Identifier:makeObjectPropertySetter(readString)})),STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{LegendURL:makeObjectPropertyPusher(readLegendUrl)},makeStructureNS(OWS_NAMESPACE_URIS,{Title:makeObjectPropertySetter(readString),Identifier:makeObjectPropertySetter(readString)})),TMS_LINKS_PARSERS=makeStructureNS(NAMESPACE_URIS,{TileMatrixSet:makeObjectPropertySetter(readString),TileMatrixSetLimits:makeObjectPropertySetter(readTileMatrixLimitsList)}),TMS_LIMITS_LIST_PARSERS=makeStructureNS(NAMESPACE_URIS,{TileMatrixLimits:makeArrayPusher(readTileMatrixLimits)}),TMS_LIMITS_PARSERS=makeStructureNS(NAMESPACE_URIS,{TileMatrix:makeObjectPropertySetter(readString),MinTileRow:makeObjectPropertySetter(readPositiveInteger),MaxTileRow:makeObjectPropertySetter(readPositiveInteger),MinTileCol:makeObjectPropertySetter(readPositiveInteger),MaxTileCol:makeObjectPropertySetter(readPositiveInteger)}),DIMENSION_PARSERS=makeStructureNS(NAMESPACE_URIS,{Default:makeObjectPropertySetter(readString),Value:makeObjectPropertyPusher(readString)},makeStructureNS(OWS_NAMESPACE_URIS,{Identifier:makeObjectPropertySetter(readString)})),WGS84_BBOX_READERS=makeStructureNS(OWS_NAMESPACE_URIS,{LowerCorner:makeArrayPusher(readCoordinates),UpperCorner:makeArrayPusher(readCoordinates)}),TMS_PARSERS=makeStructureNS(NAMESPACE_URIS,{WellKnownScaleSet:makeObjectPropertySetter(readString),TileMatrix:makeObjectPropertyPusher(readTileMatrix)},makeStructureNS(OWS_NAMESPACE_URIS,{SupportedCRS:makeObjectPropertySetter(readString),Identifier:makeObjectPropertySetter(readString),BoundingBox:makeObjectPropertySetter(readBoundingBox)})),TM_PARSERS=makeStructureNS(NAMESPACE_URIS,{TopLeftCorner:makeObjectPropertySetter(readCoordinates),ScaleDenominator:makeObjectPropertySetter(readDecimal),TileWidth:makeObjectPropertySetter(readPositiveInteger),TileHeight:makeObjectPropertySetter(readPositiveInteger),MatrixWidth:makeObjectPropertySetter(readPositiveInteger),MatrixHeight:makeObjectPropertySetter(readPositiveInteger)},makeStructureNS(OWS_NAMESPACE_URIS,{Identifier:makeObjectPropertySetter(readString)}));function readContents(s,e){return pushParseAndPop({},CONTENTS_PARSERS,s,e)}function readLayer(s,e){return pushParseAndPop({},LAYER_PARSERS,s,e)}function readTileMatrixSet(s,e){return pushParseAndPop({},TMS_PARSERS,s,e)}function readStyle(s,e){const i=pushParseAndPop({},STYLE_PARSERS,s,e);if(!i)return;const n=s.getAttribute("isDefault")==="true";return i.isDefault=n,i}function readTileMatrixSetLink(s,e){return pushParseAndPop({},TMS_LINKS_PARSERS,s,e)}function readDimensions(s,e){return pushParseAndPop({},DIMENSION_PARSERS,s,e)}function readResourceUrl(s,e){const i=s.getAttribute("format"),n=s.getAttribute("template"),o=s.getAttribute("resourceType"),l={};return i&&(l.format=i),n&&(l.template=n),o&&(l.resourceType=o),l}function readBoundingBox(s,e){const i=pushParseAndPop([],WGS84_BBOX_READERS,s,e);if(i.length==2)return boundingExtent(i)}function readBoundingBoxWithCrs(s,e){const i=s.getAttribute("crs"),n=pushParseAndPop([],WGS84_BBOX_READERS,s,e);if(n.length==2)return{extent:boundingExtent(n),crs:i}}function readLegendUrl(s,e){const i={};return i.format=s.getAttribute("format"),i.href=readHref(s),i}function readCoordinates(s,e){const i=readString(s).split(/\s+/);if(!i||i.length!=2)return;const n=+i[0],o=+i[1];if(!(isNaN(n)||isNaN(o)))return[n,o]}function readTileMatrix(s,e){return pushParseAndPop({},TM_PARSERS,s,e)}function readTileMatrixLimitsList(s,e){return pushParseAndPop([],TMS_LIMITS_LIST_PARSERS,s,e)}function readTileMatrixLimits(s,e){return pushParseAndPop({},TMS_LIMITS_PARSERS,s,e)}var eventbus_min$1={exports:{}},eventbus_min=eventbus_min$1.exports,hasRequiredEventbus_min;function requireEventbus_min(){return hasRequiredEventbus_min||(hasRequiredEventbus_min=1,(function(s,e){(function(i,n){s.exports=n()})(eventbus_min,function(){var i={};i=function(){this.listeners={}},i.prototype={addEventListener:function(o,l,c){for(var u=[],h=arguments.length,f=0;f<h;f++)u.push(arguments[f]);u=u.length>3?u.splice(3,u.length-1):[],typeof this.listeners[o]<"u"?this.listeners[o].push({scope:c,callback:l,args:u}):this.listeners[o]=[{scope:c,callback:l,args:u}]},removeEventListener:function(o,l,c){if(typeof this.listeners[o]<"u"){for(var u=this.listeners[o].length,h=[],f=0;f<u;f++){var g=this.listeners[o][f];g.scope==c&&g.callback==l||h.push(g)}this.listeners[o]=h}},hasEventListener:function(o,l,c){if(typeof this.listeners[o]<"u"){var u=this.listeners[o].length;if(l===void 0&&c===void 0)return u>0;for(var h=0;h<u;h++){var f=this.listeners[o][h];if((!c||f.scope==c)&&f.callback==l)return!0}}return!1},dispatch:function(o,l){for(var c={type:o,target:l},u=[],h=arguments.length,f=0;f<h;f++)u.push(arguments[f]);if(u=u.length>2?u.splice(2,u.length-1):[],u=[c].concat(u),typeof this.listeners[o]<"u")for(var g=this.listeners[o].slice(),H=g.length,f=0;f<H;f++){var Y=g[f];if(Y&&Y.callback){var ee=u.concat(Y.args);Y.callback.apply(Y.scope,ee)}}},getEvents:function(){var o="";for(var l in this.listeners)for(var c=this.listeners[l].length,u=0;u<c;u++){var h=this.listeners[l][u];o+=h.scope&&h.scope.className?h.scope.className:"anonymous",o+=" listen for '"+l+`'
`}return o}};var n=new i;return n})})(eventbus_min$1)),eventbus_min$1.exports}var eventbus_minExports=requireEventbus_min();const EventBus=getDefaultExportFromCjs$1(eventbus_minExports);var EventEditor={onloaded:"editor:onloaded",layer:{onclickvisibility:"editor:layer:onclickvisibility",onclickclone:"editor:layer:onclickclone",onclickremove:"editor:layer:onclickremove"},legend:{onclickedition:"editor:legend:onclickedition",onchangevalue:"editor:legend:onchangevalue"},group:{oncollapse:"editor:group:oncollapse"},style:{oneditjson:"editor:style:oneditjson",scale:{onchangemin:"editor:style:scale:onchangemin",onchangemax:"editor:style:scale:onchangemax"}},filter:{oneditjson:"editor:filter:oneditjson"},themes:{onclickimage:"editor:themes:onclickimage",onclicktitle:"editor:themes:onclicktitle"},search:{onsubmit:"editor:search:onsubmit",onautocomplete:"editor:search:onautocomplete"}},logger$l=LoggerByDefault.getLogger("editor-style");class Style{constructor(e){if(logger$l.trace("[constructor] Style",e),this.options=e||{target:null,position:0,tools:null,title:null,obj:null},!(this instanceof Style))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this._initialize(),this._initContainer()}_initialize(){this.id=this.options.id||null,this.options.target,this.options.position||(this.options.position=0);var e={scale:!0,edition:!1};this.options.tools||(this.options.tools=e),Helper.mergeParams(this.options.tools,e,!1),this.options.obj||(this.options.obj={paint:{},layout:{}}),this.options.title||(this.options.title="JSON Styles :"),this.container=null,this.name={target:"GPEditorMapBoxStyleTarget",container:"GPEditorMapBoxStyleContainer",containerjson:"GPEditorMapBoxStyleJsonContainer",jsonlabel:"GPEditorMapBoxStyleJsonTitle",jsondisplay:"GPEditorMapBoxStyleJsonDisplay",containertoolsscale:"GPEditorMapBoxStyleToolsScaleContainer",scaletitle:"GPEditorMapBoxStyleScaleTitle",containertoolsminscale:"GPEditorMapBoxStyleToolsScaleMinContainer",scalelabelmin:"GPEditorMapBoxStyleScaleLabelMin",scaleinputmin:"GPEditorMapBoxStyleScaleInputMin",containertoolsmaxscale:"GPEditorMapBoxStyleToolsScaleMaxContainer",scalelabelmax:"GPEditorMapBoxStyleScaleLabelMax",scaleinputmax:"GPEditorMapBoxStyleScaleInputMax",containertoolsedit:"GPEditorMapBoxStyleToolsEditionContainer"}}_initContainer(){var e=this,i=!1,n=JSON.parse(JSON.stringify(this.options.obj)),o={};n.paint&&(i=!0,o.paint=n.paint,Object.keys(n.paint).length===0&&logger$l.info("tag 'paint' is empty !")),n.layout&&(i=!0,o.layout=n.layout,n.layout.visibility&&delete o.visibility,Object.keys(n.layout).length===0&&logger$l.info("tag 'layout' is empty !"));var l=document.createElement("div");l.className=this.name.container;var c=null;if(i){var u=JSON.stringify(o,null,4);c=this._syntaxHighlight(u)}var h=document.createElement("div");h.className=this.name.containerjson;var f=document.createElement("label");f.className=this.name.jsonlabel,f.innerHTML=this.options.title,h.appendChild(f);var g=document.createElement("pre");g.className=this.name.jsondisplay,g.innerHTML=c,g.addEventListener?g.addEventListener("click",function(H){e.options.tools.edition&&e.onEditJsonStyleMapBox(H)}):g.attachEvent&&g.attachEvent("onclick",function(H){e.options.tools.edition&&e.onEditJsonStyleMapBox(H)}),h.appendChild(g),l.appendChild(h),this.options.tools.scale&&l.appendChild(this._createElementToolsScale({min:o.layout?o.layout.minzoom:0,max:o.layout?o.layout.maxzoom:21})),this.options.tools.edition&&l.appendChild(this._createElementToolsEdition()),this.container=l}_createElementToolsScale(e){logger$l.trace("_createElementToolsScale");var i=this,n=this.options.obj,o=document.createElement("div");o.className=this.name.containertoolsscale;var l=document.createElement("div");l.className=this.name.containertoolsminscale;var c=document.createElement("label");c.className=this.name.scalelabelmin,c.innerHTML="min :",l.appendChild(c);var u=document.createElement("input");u.className=this.name.scaleinputmin,u.type="range",u.value=e.min||0,u.title=e.min||0,u.disabled=!1,u.min=0,u.max=21,u.data=n,u.addEventListener?u.addEventListener("change",function(H){i.onChangeStyleScaleMinMapBox(H)}):u.appendChild&&u.appendChild("onchange",function(H){i.onChangeStyleScaleMinMapBox(H)}),l.appendChild(u),o.appendChild(l);var h=document.createElement("div");h.className=this.name.containertoolsmaxscale;var f=document.createElement("label");f.className=this.name.scalelabelmax,f.innerHTML="max :",h.appendChild(f);var g=document.createElement("input");return g.className=this.name.scaleinputmin,g.type="range",g.value=e.max||21,g.title=e.max||21,g.disabled=!1,g.min=0,g.max=21,g.data=n,g.addEventListener?g.addEventListener("change",function(H){i.onChangeStyleScaleMaxMapBox(H)}):g.appendChild&&g.appendChild("onchange",function(H){i.onChangeStyleScaleMaxMapBox(H)}),h.appendChild(g),o.appendChild(h),o}_createElementToolsEdition(){logger$l.warn("_createElementToolsEdition, it's not yet implemented !");var e=document.createElement("div");return e.className=this.name.containertoolsedit,e}_syntaxHighlight(e){return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?)/g,function(i){var n="gp-json-number";return/^"/.test(i)?/:$/.test(i)?n="gp-json-key":n="gp-json-string":/true|false/.test(i)?n="gp-json-boolean":/null/.test(i)&&(n="gp-json-null"),"<span class='"+n+"'>"+i+"</span>"})}add(){if(!this.options.target){if(!document.getElementById(this.name.target)){var e=document.createElement("div");e.id=this.name.target;var i=document.documentElement||document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0];i.appendChild(e)}this.options.target=document.getElementById(this.name.target)}return this.container&&this.options.target.appendChild(this.container),this}display(e){return logger$l.trace("display()",e),typeof e<"u"&&(this.container.style.display=e?"flex":"none"),this.container.style.display==="flex"}getContainer(){return this.container}onEditJsonStyleMapBox(e){logger$l.trace("onEditJsonStyleMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.style.oneditjson,e)}onChangeStyleScaleMinMapBox(e){logger$l.trace("onChangeStyleScaleMinMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.style.scale.onchangemin,e)}onChangeStyleScaleMaxMapBox(e){logger$l.trace("onChangeStyleScaleMaxMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.style.scale.onchangemax,e)}}window.ol&&window.ol.style&&(window.ol.style.editor||(window.ol.style.editor={}),window.ol.style.editor.Style=Style);var logger$k=LoggerByDefault.getLogger("editor-themes");class Themes{constructor(e){if(logger$k.trace("[constructor] Themes",e),this.options=e||{},!(this instanceof Themes))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this._initialize(),this._initContainer()}_initialize(){this.id=this.options.id||null,this.options.target;var e={thumbnails:!0,button:{visible:!0,type:"radio"}};(!this.options.tools||Object.keys(this.options.tools).length===0)&&(this.options.tools=e),Helper.mergeParams(this.options.tools,e,!1),(typeof this.options.obj>"u"||this.options.obj===null||!this.options.obj)&&(this.options.obj={themesSummary:"",themes:[]}),this.container=null,this.name={target:"GPEditorMapBoxThemeTarget",container:"GPEditorMapBoxThemesContainer",containertheme:"GPEditorMapBoxThemeContainer",containerthemeID:"GPEditorMapBoxThemeContainer_ID_",input:"GPEditorMapBoxThemeInput",inputID:"GPEditorMapBoxThemeInput_ID_",label:"GPEditorMapBoxThemeTitle",labelID:"GPEditorMapBoxThemeTitle_ID_",image:"GPEditorMapBoxThemeImage",imageID:"GPEditorMapBoxThemeImage_ID_",message:"GPEditorMapBoxThemeMessage"}}_initContainer(){var e=this,i=this.options.obj,n=this.id||SelectorID.generate(),o=document.createElement("div");o.className=this.name.container,o.title=i.themesSummary||"";var l=i.themes;if(l)for(var c=0;c<l.length;c++){var u=l[c],h=document.createElement("div");h.id=this.name.containerthemeID+c+"_"+n,h.className=this.name.containertheme,h.tabIndex=c;var f=u.url,g=u.selected||!1;if(f){var H=this.options.tools.button;if(H.visible){var Y=H.type==="checkbox"?"checkbox":"radio",ee=document.createElement("input");ee.type=Y,ee.id=this.name.inputID+c+"_"+n,ee.className=this.name.input,ee.name=n,ee.checked=g,ee.data=f,ee.addEventListener?ee.addEventListener("click",function(et){e.onClickThemeTitleMapBox(et)}):ee.attachEvent&&ee.attachEvent("onclick",function(et){e.onClickThemeTitleMapBox(et)}),h.appendChild(ee)}if(this.options.tools.thumbnails&&u.thumbnail){var te=document.createElement("img");te.id=this.name.imageID+c+"_"+n,te.className=this.name.image,te.src=u.thumbnail,te.alt=u.thumbnail,te.title=u.description||"",te.data=f,te.addEventListener?te.addEventListener("click",function(et){e.onClickThemeImageMapBox(et);var tt=et.target.parentElement.childNodes;if(tt){var it=tt[0];it.tagName.toLowerCase()==="input"&&(it.checked=!it.checked)}}):te.attachEvent&&te.attachEvent("onclick",function(et){e.onClickThemeImageMapBox(et);var tt=et.target.parentElement.childNodes;if(tt){var it=tt[0];it.tagName.toLowerCase()==="input"&&(it.checked=!it.checked)}}),h.appendChild(te)}if(u.name){var xe=document.createElement("label");xe.id=this.name.labelID+c+"_"+n,this.options.tools.button.visible&&(xe.htmlFor=ee.id),xe.className=this.name.label,xe.innerHTML=u.name,xe.title=u.description||"",xe.data=f,this.options.tools.button.visible||(xe.addEventListener?xe.addEventListener("click",function(et){e.onClickThemeTitleMapBox(et)}):xe.attachEvent&&xe.attachEvent("onclick",function(et){e.onClickThemeTitleMapBox(et)})),h.appendChild(xe)}}else{var ne=document.createElement("label");ne.className=this.name.message,ne.innerHTML="Thme non disponible...",h.appendChild(ne)}o.appendChild(h)}this.container=o}add(){if(!this.options.target){if(!document.getElementById(this.name.target)){var e=document.createElement("div");e.id=this.name.target;var i=document.documentElement||document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0];i.appendChild(e)}this.options.target=document.getElementById(this.name.target)}return this.container&&this.options.target.appendChild(this.container),this}display(e){return logger$k.trace("display()",e),typeof e<"u"&&(this.container.style.display=e?"flex":"none"),this.container.style.display==="flex"}getContainer(){return this.container}onClickThemeImageMapBox(e){if(logger$k.trace("onClickThemeImageMapBox",e),e.editorID=this.id,e.data=this.options,this.options.tools.button.type==="checkbox")for(var i=e.target.previousSibling.id.substring(e.target.previousSibling.id.lastIndexOf("_")+1),n=document.getElementsByClassName(this.name.input),o=0;o<n.length;o++){var l=n[o];if(l.id!==e.target.previousSibling.id){var c=l.id.substring(l.id.lastIndexOf("_")+1);c===i&&(l.checked=!1)}}EventBus.dispatch(EventEditor.themes.onclickimage,e)}onClickThemeTitleMapBox(e){if(logger$k.trace("onClickThemeTitleMapBox",e),e.editorID=this.id,e.data=this.options,this.options.tools.button.type==="checkbox")for(var i=e.target.id.substring(e.target.id.lastIndexOf("_")+1),n=document.getElementsByClassName(this.name.input),o=0;o<n.length;o++){var l=n[o];if(l.id!==e.target.id){var c=l.id.substring(l.id.lastIndexOf("_")+1);c===i&&(l.checked=!1)}}EventBus.dispatch(EventEditor.themes.onclicktitle,e)}}window.ol&&window.ol.style&&(window.ol.style.editor||(window.ol.style.editor={}),window.ol.style.editor.Themes=Themes);var logger$j=LoggerByDefault.getLogger("editor-filter");class Filter{constructor(e){if(logger$j.trace("[constructor] Filter",e),this.options=e||{target:null,position:0,tools:null,title:null,obj:null},!(this instanceof Filter))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this._initialize(),this._initContainer()}_initialize(){this.id=this.options.id||null,this.options.target,this.options.position||(this.options.position=0);var e={edition:!1};this.options.tools||(this.options.tools=e),Helper.mergeParams(this.options.tools,e,!1),this.options.obj||(this.options.obj={filter:[]}),this.options.title||(this.options.title="JSON Filtres :"),this.container=null,this.name={target:"GPEditorMapBoxFilterTarget",container:"GPEditorMapBoxFilterContainer",containerjson:"GPEditorMapBoxFilterJsonContainer",jsonlabel:"GPEditorMapBoxFilterTitleJson",jsondisplay:"GPEditorMapBoxFilterDisplayJson",containertoolsedit:"GPEditorMapBoxFilterToolsEditionContainer"}}_initContainer(){var e=this,i=!1,n=JSON.parse(JSON.stringify(this.options.obj));n.filter&&(i=!0,n.filter.length===0&&logger$j.info("tag 'filter' is empty !"));var o=document.createElement("div");o.className=this.name.container;var l=null;i&&(l=JSON.stringify(n.filter,null,4));var c=document.createElement("div");c.className=this.name.containerjson;var u=document.createElement("label");u.className=this.name.jsonlabel,u.innerHTML=this.options.title,c.appendChild(u);var h=document.createElement("pre");if(h.className=this.name.jsondisplay,h.innerHTML=l,h.addEventListener?h.addEventListener("click",function(g){e.options.tools.edition&&e.onEditJsonFilterMapBox(g)}):h.attachEvent&&h.attachEvent("onclick",function(g){e.options.tools.edition&&e.onEditJsonFilterMapBox(g)}),c.appendChild(h),o.appendChild(c),this.options.tools.edition){var f=document.createElement("div");f.className=this.name.containertoolsedit,o.appendChild(f)}this.container=o}add(){if(!this.options.target){if(!document.getElementById(this.name.target)){var e=document.createElement("div");e.id=this.name.target;var i=document.documentElement||document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0];i.appendChild(e)}this.options.target=document.getElementById(this.name.target)}return this.container&&this.options.target.appendChild(this.container),this}display(e){return logger$j.trace("display()",e),typeof e<"u"&&(this.container.style.display=e?"flex":"none"),this.container.style.display==="flex"}getContainer(){return this.container}onEditJsonFilterMapBox(e){logger$j.trace("onEditJsonFilterMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.filter.oneditjson,e)}}window.ol&&window.ol.style&&(window.ol.style.editor||(window.ol.style.editor={}),window.ol.style.editor.Filter=Filter);var logger$i=LoggerByDefault.getLogger("editor-legend");class Legend{constructor(e){if(logger$i.trace("[constructor] Legend",e),this.options=e||{target:null,position:0,sprites:null,obj:null},!(this instanceof Legend))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this._initialize(),this._initContainer()}_initialize(){this.id=this.options.id||null,this.options.target,this.options.position||(this.options.position=0),this.options.obj||(this.options.obj={title:"vide...",editable:!0,paint:{"fill-color":"#FFFFFF"}});var e=this.options.obj.editable;this.editable=typeof e<"u"?e:!1,this.legendRender={type:"fill",values:{width:1,stroke:"#FFFFFF",color:"#000000",opacity:1}},this.container=null,this.rendercontainer=null,this.toolscontainer=null,this.name={target:"GPEditorMapBoxLegendTarget",container:"GPEditorMapBoxLegendContainer",containerlegendrender:"GPEditorMapBoxLegendRenderContainer",legendrender:"GPEditorMapBoxLegendRender",legendeditable:"GPEditorMapBoxLegendEditable",legendtitle:"GPEditorMapBoxLegendTitle",containerlegendtools:"GPEditorMapBoxLegendToolsContainer"},this.labels={"line-color":"Couleur du trait","line-width":"Epaisseur du trait","line-opacity":"Opacit du trait","fill-color":"Couleur de remplissage","fill-opacity":"Opacit du remplissage"}}_initContainer(){var e=this.options.obj,i=document.createElement("div");i.className=this.name.container;var n=Object.assign({},e.paint,e.layout),o=Object.keys(n);if(o.length===0){logger$i.info("tag 'paint' or 'layout' is empty !");return}for(var l={},c=!1,u=0;u<o.length;u++){var h=o[u];if(/fill-/.test(h)||/line-/.test(h)||/circle-/.test(h)||/background-/.test(h)||/text-/.test(h)||/icon-/.test(h)){c=!0;var f=e.title||"",g=h.split("-")[0];(g==="text"||g==="icon")&&(g="symbol"),this.legendRender=this._getProperties(g,n),l={edit:this.editable,title:f,type:this.legendRender.type,values:this.legendRender.values},i.appendChild(this._createElementIconLegend(l));break}}c||(l={edit:this.editable,title:"",type:this.legendRender.type,values:this.legendRender.values},i.appendChild(this._createElementIconLegend(l)),logger$i.warn("legend type unknown, default legend used...")),this.toolscontainer=this._createElementEditionLegend(l),i.appendChild(this.toolscontainer),this.container=i}_getProperties(e,i){if(e==="symbol"){var n=i["text-field"],o=i["icon-image"];if(e=n&&o?"icon":n?"text":o?"icon":"unknow",e==="unknow"){logger$i.warn("type unknow !?");return}}var l={};for(const f in i)if(Object.hasOwnProperty.call(i,f)){const g=i[f];if(Legend.PROPERTIES[e].includes(f)){var c=f.replace(e,"").slice(1),u=this._getValue(g);if(u){if((c==="pattern"||c==="image")&&(!this.options.sprites||!this.options.sprites.json||!this.options.sprites.json[u])){var h=e+":"+c;logger$i.warn("sprites mandatory for key ",h);break}l[c]=u}}else logger$i.warn("property not supported : ",f)}return{type:e,values:l}}_renderThumbnail(e,i){var n=this.rendercontainer;if(!n)return!1;var o=null,l=3;switch(i.color||(i.color="#FFFFFF"),e){case"text":var c="font-size: 5em;font-weight: bold;";o=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' preserveAspectRatio='none' viewBox='0 0 100 100'><text x='50' y='50' fill='%color%' fill-opacity='%opacity%'  text-anchor='middle' dominant-baseline='central' style='%style%'> T </text></svg>")`,n.style.background=o.replace("%color%",i.color.indexOf("rgb")===0?i.color:ColorUtils.hexToRgba(i.color,1)).replace("%opacity%",i.opacity||1).replace("%style%",c);break;case"icon":if(i.image)o="<svg xmlns='http://www.w3.org/2000/svg' version='1.1' preserveAspectRatio='none' width='27px' height='27px' x='0' y='0' viewBox='%x% %y% %w% %h%'><image width='%W%px' height='%H%px' href='%URL%'/></svg>".replace("%x%",this.options.sprites.json[i.image].x).replace("%y%",this.options.sprites.json[i.image].y).replace(/%w%/g,this.options.sprites.json[i.image].width).replace(/%h%/g,this.options.sprites.json[i.image].height).replace("%W%",this.options.sprites.size.w).replace("%H%",this.options.sprites.size.h).replace("%URL%",this.options.sprites.url),n.innerHTML=o;else{var u="fill: transparent;stroke-width: 10;";o=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' preserveAspectRatio='none' viewBox='0 0 100 100'><path d='M 50,20 80,82.5 20,82.5 z' stroke='%color%' style='%style%'/></svg>")`,n.style.background=o.replace("%color%",i.color.indexOf("rgb")===0?i.color:ColorUtils.hexToRgba(i.color,1)).replace("%style%",u)}break;case"line":var h=Array.isArray(i.dasharray)?i.dasharray.join(" "):0;o=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' preserveAspectRatio='none' viewBox='0 0 100 100'><line x1='0' y1='100' x2='100' y2='0' stroke='%color%' stroke-width='%stroke-width%' stroke-opacity='%stroke-opacity%' stroke-dasharray='%stroke-dasharray%' /></svg>")`,n.style.background=o.replace("%color%",i.color.indexOf("rgb")===0?i.color:ColorUtils.hexToRgba(i.color,1)).replace("%stroke-opacity%",i.opacity||1).replace("%stroke-dasharray%",h).replace("%stroke-width%",(i.width||0)*l);break;case"circle":var f=i["stroke-color"]||"#FFFFFF";o=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' preserveAspectRatio='none' viewBox='0 0 100 100'><circle cx='50' cy='50' r='40' stroke='%stroke-color%' stroke-width='%stroke-width%' stroke-opacity='%strock-opacity%' fill='%color%' fill-opacity='%opacity%' /></svg>")`,n.style.background=o.replace("%color%",i.color.indexOf("rgb")===0?i.color:ColorUtils.hexToRgba(i.color,1)).replace("%opacity%",i.opacity||1).replace("%stroke-color%",f.indexOf("rgb")===0?f:ColorUtils.hexToRgba(f,1)).replace("%stroke-opacity%",i["stroke-opacity"]||1).replace("%stroke-width%",(i["stroke-width"]||0)*l);break;case"background":case"fill":if(i.pattern)o="<svg xmlns='http://www.w3.org/2000/svg' version='1.1' preserveAspectRatio='none' width='27px' height='27px' x='0' y='0' viewBox='%x% %y% %w% %h%'><image width='%W%px' height='%H%px' href='%URL%'/></svg>".replace("%x%",this.options.sprites.json[i.pattern].x).replace("%y%",this.options.sprites.json[i.pattern].y).replace(/%w%/g,this.options.sprites.json[i.pattern].width).replace(/%h%/g,this.options.sprites.json[i.pattern].height).replace("%W%",this.options.sprites.size.w).replace("%H%",this.options.sprites.size.h).replace("%URL%",this.options.sprites.url),n.innerHTML=o;else{var g=i["outline-color"]||"#FFFFFF";o=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' preserveAspectRatio='none' viewBox='0 0 100 100'><rect x='0' y='0' width='100' height='100' rx='5' ry='5' stroke='%stroke-color%' stroke-width='3' fill='%color%' fill-opacity='%opacity%' /></svg>")`,n.style.background=o.replace("%color%",i.color.indexOf("rgb")===0?i.color:ColorUtils.hexToRgba(i.color,1)).replace("%opacity%",i.opacity||1).replace("%stroke-color%",g.indexOf("rgb")===0?g:ColorUtils.hexToRgba(g,1))}break;default:return logger$i.warn("type not found, no thumbnail..."),!1}return!0}_getValue(e){var i=null;if(typeof e=="string")i=e;else if(typeof e=="number")i=e;else if(Array.isArray(e)){var n=!0;e.forEach(l=>{typeof l!="number"&&(n=!1)}),n&&(i=e)}else if(typeof e=="object"){if(i=null,"stops"in e){e.stops.sort((l,c)=>{var u=l[0],h=c[0];return u>h?-1:u<h?1:0});var o=e.stops.slice(-1);i=o[0][1]}}else logger$i.warn("value not supported !");return i}_createElementIconLegend(e){var i=this,n=document.createElement("div");n.className=this.name.containerlegendrender;var o=this.rendercontainer=document.createElement("div");o.className=this.name.legendrender,e.edit&&(o.className+=" ",o.className+=this.name.legendeditable,o.addEventListener?o.addEventListener("click",function(u){i.onEditionLegendMapBox(u)}):o.attachEvent&&o.attachEvent("onclick",function(u){i.onEditionLegendMapBox(u)}));var l=e.type;this._renderThumbnail(l,e.values)?o.className+=e.edit?" legend-"+l:" legend-"+l+"-not-editable":o.className+=" legend-unknow",n.appendChild(o);var c=document.createElement("span");return c.className=this.name.legendtitle,c.innerHTML=e.title||"",n.appendChild(c),n}_createElementEditionLegend(e){var i=this,n=document.createElement("div");if(n.className=this.name.containerlegendtools,!e.edit)return n;switch(e.type){case"line":o.call(i),l.call(i),c.call(i);break;case"background":case"fill":u.call(i),h.call(i);break}function o(){var f=document.createElement("div");f.className="legend-styling-div";var g=document.createElement("label");g.className="legend-line",g.htmlFor=this.id?"line-color-"+this.id:"line-color",g.innerHTML=this.labels["line-color"];var H=document.createElement("input");H.className="legend-styling",H.id=this.id?"line-color-"+this.id:"line-color",H.title="Selectionner une couleur de trait",H.type="color",H.value=e.values.color,H.setAttribute("data-id","line-color"),H.addEventListener?H.addEventListener("change",function(Y){i._renderThumbnail(e.type,Object.assign(e.values,{color:Y.target.value})),i.onChangeValueLegendMapBox(Y)}):H.attachEvent&&H.attachEvent("onchange",function(Y){i._renderThumbnail(e.type,Object.assign(e.values,{color:Y.target.value})),i.onChangeValueLegendMapBox(Y)}),f.appendChild(g),f.appendChild(H),n.appendChild(f)}function l(){var f=document.createElement("div");f.className="legend-styling-div";var g=document.createElement("label");g.className="legend-line",g.htmlFor=this.id?"line-width-"+this.id:"line-width",g.innerHTML=this.labels["line-width"];var H=document.createElement("input");H.className="legend-styling",H.id=this.id?"line-width-"+this.id:"line-width",H.title=e.values.width,H.type="range",H.min="0",H.max="10",H.step="1",H.defaultValue=e.values.width,H.setAttribute("data-id","line-width"),H.addEventListener?H.addEventListener("change",function(Y){logger$i.trace(Y),Y.target.title=Y.target.value,i._renderThumbnail(e.type,Object.assign(e.values,{width:Y.target.value})),i.onChangeValueLegendMapBox(Y)}):H.attachEvent&&H.attachEvent("onchange",function(Y){logger$i.trace(Y),Y.target.title=Y.target.value,i._renderThumbnail(e.type,Object.assign(e.values,{width:Y.target.value})),i.onChangeValueLegendMapBox(Y)}),f.appendChild(g),f.appendChild(H),n.appendChild(f)}function c(){var f=document.createElement("div");f.className="legend-styling-div";var g=document.createElement("label");g.className="legend-line",g.htmlFor=this.id?"line-opacity-"+this.id:"line-opacity",g.innerHTML=this.labels["line-opacity"];var H=document.createElement("input");H.className="legend-styling",H.id=this.id?"line-opacity-"+this.id:"line-opacity",H.title=e.values.opacity,H.type="range",H.min="0",H.max="1",H.step="0.1",H.defaultValue=e.values.opacity,H.setAttribute("data-id","line-opacity"),H.addEventListener?H.addEventListener("change",function(Y){logger$i.trace(Y),Y.target.title=Y.target.value,i._renderThumbnail(e.type,Object.assign(e.values,{opacity:Y.target.value})),i.onChangeValueLegendMapBox(Y)}):H.attachEvent&&H.attachEvent("onchange",function(Y){logger$i.trace(Y),Y.target.title=Y.target.value,i._renderThumbnail(e.type,Object.assign(e.values,{opacity:Y.target.value})),i.onChangeValueLegendMapBox(Y)}),f.appendChild(g),f.appendChild(H),n.appendChild(f)}function u(){var f=document.createElement("div");f.className="legend-styling-div";var g=document.createElement("label");g.className="legend-fill",g.htmlFor=this.id?"fill-color-"+this.id:"fill-color",g.innerHTML=this.labels["fill-color"];var H=document.createElement("input");H.className="legend-styling",H.id=this.id?"fill-color-"+this.id:"fill-color",H.title="Selectionner une couleur de remplissage",H.type="color",H.value=e.values.color,H.setAttribute("data-id","fill-color"),H.addEventListener?H.addEventListener("change",function(Y){i._renderThumbnail(e.type,Object.assign(e.values,{color:Y.target.value})),i.onChangeValueLegendMapBox(Y)}):H.attachEvent&&H.attachEvent("onchange",function(Y){i._renderThumbnail(e.type,Object.assign(e.values,{color:Y.target.value})),i.onChangeValueLegendMapBox(Y)}),f.appendChild(g),f.appendChild(H),n.appendChild(f)}function h(){var f=document.createElement("div");f.className="legend-styling-div";var g=document.createElement("label");g.className="legend-fill",g.htmlFor=this.id?"fill-opacity-"+this.id:"fill-opacity",g.innerHTML=this.labels["fill-opacity"];var H=document.createElement("input");H.className="legend-styling",H.id=this.id?"fill-opacity-"+this.id:"fill-opacity",H.title=e.values.opacity,H.type="range",H.min="0",H.max="1",H.step="0.1",H.defaultValue=e.values.opacity,H.setAttribute("data-id","fill-opacity"),H.addEventListener?H.addEventListener("change",function(Y){Y.target.title=Y.target.value,i._renderThumbnail(e.type,Object.assign(e.values,{opacity:Y.target.value})),i.onChangeValueLegendMapBox(Y)}):H.attachEvent&&H.attachEvent("onchange",function(Y){Y.target.title=Y.target.value,i._renderThumbnail(e.type,Object.assign(e.values,{opacity:Y.target.value})),i.onChangeValueLegendMapBox(Y)}),f.appendChild(g),f.appendChild(H),n.appendChild(f)}return n}add(){if(!this.options.target){if(!document.getElementById(this.name.target)){var e=document.createElement("div");e.id=this.name.target;var i=document.documentElement||document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0];i.appendChild(e)}this.options.target=document.getElementById(this.name.target)}return this.container&&this.options.target.appendChild(this.container),this}display(e){return logger$i.trace("display()",e),typeof e<"u"&&(this.container.style.display=e?"flex":"none"),this.container.style.display==="flex"}isEditable(){return this.editable}getRenderContainer(){return this.rendercontainer}getToolsContainer(){return this.toolscontainer}getContainer(){return this.container}onEditionLegendMapBox(e){logger$i.trace("onEditionLegendMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.legend.onclickedition,e)}onChangeValueLegendMapBox(e){logger$i.trace("onChangeValueLegendMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.legend.onchangevalue,e)}}Legend.PROPERTIES={line:["line-color","line-dasharray","line-opacity","line-width"],fill:["fill-color","fill-opacity","fill-outline-color","fill-pattern"],background:["background-color","background-opacity","background-pattern"],circle:["circle-color","circle-opacity","circle-stroke-color","circle-stroke-opacity","circle-stroke-width"],icon:["icon-color","icon-image","icon-opacity","__icon-size"],text:["__text-anchor","text-color","text-field","__text-font","__text-opacity","__text-size"]};window.ol&&window.ol.style&&(window.ol.style.editor||(window.ol.style.editor={}),window.ol.style.editor.Legend=Legend);var logger$h=LoggerByDefault.getLogger("editor-layer");class Layer{constructor(e){if(logger$h.trace("[constructor] Layer",e),this.options=e||{},!(this instanceof Layer))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this._initialize(),this._initContainer()}_initialize(){this.id=this.options.id||null,this.options.target,this.options.position||(this.options.position=0);var e={visibility:!0,icon:{image:!0,anchor:"end"},type:!0,pin:!0,remove:!1,clone:!1};this.options.tools||(this.options.tools=e),Helper.mergeParams(this.options.tools,e,!1);var i={id:"",type:"",source:"","source-layer":""};this.options.obj||(this.options.obj=i),Helper.mergeParams(this.options.obj,i,!1),this.bSlotLegend=!1,this.oFilter=null,this.oStyle=null,this.oLegend=null,this.container=null,this.DomVisibility=null,this.DomToggle=null,this.name={target:"GPEditorMapBoxLayerTarget",container:"GPEditorMapBoxLayerContainer",containerlegend:"GPEditorMapBoxLayerLegendContainer",containertitle:"GPEditorMapBoxLayerTitleContainer",imagelabelinput:"GPEditorMapBoxLayerImageInput",imagelabel:"GPEditorMapBoxLayerImageLabel",typeimg:"GPEditorMapBoxLayerTypeImage",titleinput:"GPEditorMapBoxLayerTitleInput",titlelabel:"GPEditorMapBoxLayerTitleLabel",containertools:"GPEditorMapBoxToolsContainer",visibilityinput:"GPEditorMapBoxToolsVisibilityInput",visibilitylabel:"GPEditorMapBoxToolsVisibilityLabel",visibilityinputdisable:"GPEditorMapBoxToolsVisibilityInputDisable",visibilitylabeldisable:"GPEditorMapBoxToolsVisibilityLabelDisable"}}_initContainer(){var e=this,i=this.options.obj,n=document.createElement("div");n.className=this.name.container;var o=document.createElement("div");if(o.id=this.name.containertitle+"-"+this.options.position,o.className=this.name.containertitle,this.options.tools.pin){var l=document.createElement("input");l.id=this.name.imagelabelinput+"-"+this.options.position,l.className=this.name.imagelabelinput,l.type="checkbox",o.appendChild(l);var c=document.createElement("label");c.className=this.name.imagelabel,c.htmlFor=l.id,c.addEventListener?c.addEventListener("click",function(Y){e.onClickLayerMapBox(Y)}):c.attachEvent&&c.attachEvent("onclick",function(Y){e.onClickLayerMapBox(Y)}),o.appendChild(c)}var u=function(){var Y=document.createElement("div");if(Y.id=this.name.containertools+"-"+this.options.position,Y.className=this.name.containertools,this.options.tools.visibility){var ee=document.createElement("input");ee.id=this.name.visibilityinput+"-"+this.options.position,ee.className=this.options.tools.icon.image?this.name.visibilityinput:this.name.visibilityinputdisable,ee.type="checkbox",ee.checked="checked",ee.addEventListener?ee.addEventListener("click",function(xe){e.onVisibilityLayerMapBox(xe)}):ee.attachEvent&&ee.attachEvent("onclick",function(xe){e.onVisibilityLayerMapBox(xe)}),Y.appendChild(ee),this.DomVisibility=ee;var te=document.createElement("label");te.htmlFor=this.name.visibilityinput+"-"+this.options.position,te.id=this.name.visibilitylabel+"-"+this.options.position,te.className=this.options.tools.icon.image?this.name.visibilitylabel:this.name.visibilitylabeldisable,te.title="Afficher/masquer la couche",Y.appendChild(te),n.appendChild(Y)}this.options.tools.clone&&logger$h.warn("Dom for tools clone, it's not yet implemented !"),this.options.tools.remove&&logger$h.warn("Dom for tools remove, it's not yet implemented !")};if(this.options.tools.icon.anchor==="start"&&u.apply(this),this.options.tools.type&&i.type){var h=document.createElement("img");switch(h.className=this.name.typeimg,i.type.toUpperCase()){case"SYMBOL-ICON":h.style["background-position"]="0px 0";break;case"SYMBOL-TEXT":h.style["background-position"]="-194px 0";break;case"SYMBOL":h.style["background-position"]="-84px 0";break;case"LINE":h.style["background-position"]="-28px 0";break;case"FILL":h.style["background-position"]="-56px 0";break;case"BACKGROUND":h.style["background-position"]="-140px 0";break;case"CIRCLE":h.style["background-position"]="-168px 0";break;default:h.style["background-position"]="-112px 0"}o.appendChild(h)}var f=document.createElement("div");f.id=this.name.containerlegend+"-"+this.options.position,f.className=this.name.containerlegend,o.appendChild(f);var g=document.createElement("input");g.id=this.name.titleinput+"-"+this.options.position,g.className=this.name.titleinput,g.type="checkbox",o.appendChild(g);var H=document.createElement("label");H.className=this.name.titlelabel,H.htmlFor=g.id,H.innerHTML=i.id||i["source-layer"]||i.source,H.title=i["source-layer"]||i.source||i.id,H.addEventListener?H.addEventListener("click",function(Y){e.onClickLayerMapBox(Y)}):H.attachEvent&&H.attachEvent("onclick",function(Y){e.onClickLayerMapBox(Y)}),o.appendChild(H),this.DomToggle=H,n.appendChild(o),this.options.tools.icon.anchor==="end"&&u.apply(this),this.container=n}add(){if(logger$h.trace("add()"),!this.options.target){if(!document.getElementById(this.name.target)){var e=document.createElement("div");e.id=this.name.target;var i=document.documentElement||document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0];i.appendChild(e)}this.options.target=document.getElementById(this.name.target)}return this.container&&this.options.target.appendChild(this.container),this}addStyle(e){logger$h.trace("addStyle()",e),e&&typeof e=="object"&&e instanceof Style&&(this.oStyle=e,this.oStyle.display(!1))}addFilter(e){logger$h.trace("addFilter()",e),e&&typeof e=="object"&&e instanceof Filter&&(this.oFilter=e,this.oFilter.display(!1))}addLegend(e){logger$h.trace("addLegend()",e),e&&typeof e=="object"&&e instanceof Legend&&(this.oLegend=e,this.oLegend.display(!1))}slotLegend(){var e=this.oLegend;if(e){var i=null,n=this.container.childNodes;if(n.length)for(var o=this.options.tools.icon.anchor==="start"?1:0,l=n[o].childNodes,c=0;c<l.length;c++){var u=l[c];u.id.indexOf(this.name.containerlegend)!==-1&&(i=u)}if(i){var h=e.getRenderContainer();h&&(i.appendChild(h),this.bSlotLegend=!0)}}}visibility(e){if(logger$h.trace("visibility()",e),!!this.options.tools.visibility)return typeof e<"u"&&(this.DomVisibility.checked=e?"checked":""),this.DomVisibility.checked}collapse(){logger$h.trace("collapse()"),this.DomToggle.click()}visible(){logger$h.trace("visible()"),this.options.tools.visibility&&this.DomVisibility.click()}display(e){logger$h.trace("display()",e);var i=document.getElementById(this.DomToggle.htmlFor).checked;return typeof e<"u"&&(this.container.style.display=e?"inline-flex":"none",this.oStyle&&this.oStyle.display(e&&i),this.oFilter&&this.oFilter.display(e&&i),this.oLegend&&this.oLegend.display(e&&i)),i}active(e){return logger$h.trace("active()",e),typeof e<"u"&&(this.container.className=e?this.name.container:this.name.container+" disabled"),this.container.className===this.name.container}getContainer(){return this.container}onClickLayerMapBox(e){logger$h.trace("onClickLayerMapBox",e);var i=e.target.htmlFor.substring(e.target.htmlFor.indexOf("-")),n=document.getElementById(e.target.htmlFor).checked;e.target.htmlFor===this.name.imagelabelinput+i&&(document.getElementById(this.name.titleinput+i).checked=!n),e.target.htmlFor===this.name.titleinput+i&&document.getElementById(this.name.imagelabelinput+i)&&(document.getElementById(this.name.imagelabelinput+i).checked=!n),this.oStyle&&this.oStyle.display(!n),this.oFilter&&this.oFilter.display(!n),this.oLegend&&this.oLegend.isEditable()&&this.oLegend.display(!n)}onVisibilityLayerMapBox(e){logger$h.trace("onVisibilityLayerMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.layer.onclickvisibility,e)}onCloneLayerMapBox(e){logger$h.trace("onCloneLayerMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.layer.onclickclone,e)}onRemoveLayerMapBox(e){logger$h.trace("onRemoveLayerMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.layer.onclickremove,e)}}window.ol&&window.ol.style&&(window.ol.style.editor||(window.ol.style.editor={}),window.ol.style.editor.Layer=Layer);var logger$g=LoggerByDefault.getLogger("editor-group");class Group{constructor(e){if(logger$g.trace("[constructor] Group",e),this.options=e||{},!(this instanceof Group))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this._initialize(),this._initContainer()}_initialize(){this.id=this.options.id||null,this.options.target,this.options.title||(this.options.title="Dtails du groupe..."),typeof this.options.collapse>"u"&&(this.options.collapse=!0),this.container=null,this.name={target:"GPEditorMapBoxGroupTarget",container:"GPEditorMapBoxGroupContainer",details:"GPEditorMapBoxGroupDetails",summary:"GPEditorMapBoxGroupSummary"}}_initContainer(){var e=document.createElement("div");e.className=this.name.container;var i=document.createElement("details");i.className=this.name.details,i.open=!this.options.collapse,e.appendChild(i);var n=document.createElement("summary");n.className=this.name.summary,n.innerHTML=this.options.title,i.appendChild(n),this.container=e}add(){if(!this.options.target){if(!document.getElementById(this.name.target)){var e=document.createElement("div");e.id=this.name.target;var i=document.documentElement||document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0];i.appendChild(e)}this.options.target=document.getElementById(this.name.target)}this.container&&this.options.target.appendChild(this.container)}display(e){this.container.style.display=e?"flex":"none"}getContainer(){var e=this.container.childNodes;return e.length?e[0]:this.container}onCollapseGroupMapBox(e){logger$g.trace("onCollapseGroupMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.group.oncollapse,e)}}var logger$f=LoggerByDefault.getLogger("editor-search");class Search{constructor(e){if(logger$f.trace("[constructor] Search",e),this.options=e||{target:null,tools:null,title:null,obj:null},!(this instanceof Search))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this._initialize(),this._initContainer()}_initialize(){this.id=this.options.id||null,this.options.target;var e={};this.options.tools||(this.options.tools=e),Helper.mergeParams(this.options.tools,e,!1),this.options.obj||(this.options.obj={}),this.options.title||(this.options.title="Recherche de couches :"),this.container=null,this.name={target:"GPEditorMapBoxSearchTarget",container:"GPEditorMapBoxSearchContainer"}}_initContainer(){var e=JSON.parse(JSON.stringify(this.options.obj));e.layers&&e.layers.length===0&&logger$f.info("tag 'layers' is empty !");var i=document.createElement("div");i.className=this.name.container,this.container=i}add(){if(!this.options.target){if(!document.getElementById(this.name.target)){var e=document.createElement("div");e.id=this.name.target;var i=document.documentElement||document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0];i.appendChild(e)}this.options.target=document.getElementById(this.name.target)}return this.container&&this.options.target.appendChild(this.container),this}display(e){return logger$f.trace("display()",e),typeof e<"u"&&(this.container.style.display=e?"flex":"none"),this.container.style.display==="flex"}getContainer(){return this.container}onSubmitSearchLayersMapBox(e){logger$f.trace("onSubmitSearchLayersMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.search.onsubmit,e)}onAutocompleteSearchLayersMapBox(e){logger$f.trace("onAutocompleteSearchLayersMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.search.onautocomplete,e)}}var EditorDOM={_addUID:function(s){var e=this._uid?s+"-"+this._uid:s;return e}},logger$e=LoggerByDefault.getLogger("editor");class Editor{constructor(e){if(logger$e.trace("[constructor] Editor",e),this.options=e||{},!(this instanceof Editor))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this._initialize()}_initialize(){if(this.options.target||logger$e.info("La 'target' n'est pas renseigne (options.target)."),!this.options.style){logger$e.error("Le 'style' MapBox n'est pas renseign (options.style) !");return}this.options.events?this._initEvents():logger$e.warn("Les 'handlers' ne sont pas renseigns (options.events) !"),this.options.themes||logger$e.info("Les 'themes' MapBox ne sont pas renseigns (options.themes).");var e={themes:!1,layers:!0,search:!1,style:!1,filter:!1,legend:!1,group:!1,groupAuto:!1,sort:!0,sortBy:"id",sortOrder:"asc",title:!0,collapse:void 0,type:!0,pin:!0,visibility:!0,icon:{image:!0,anchor:"end"},editable:!0};this.options.tools||(logger$e.trace("Utilisation des outils MapBox par dfaut (options.tools)."),this.options.tools=e),Helper.mergeParams(this.options.tools,e,!1),this.id=this.options.id||SelectorID.generate(),this.context={},this.layers=[],this.container=null,this.name={target:"GPEditorMapBoxTarget",container:"GPEditorMapBoxContainer",containerID:"GPEditorMapBoxContainer_ID_",containerLayers:"GPEditorMapBoxLayersContainer",titleLayers:"GPEditorMapBoxLayersTitle",titleLayersID:"GPEditorMapBoxLayersTitle_ID_",titleThemes:"GPEditorMapBoxThemesTitle",titleThemesID:"GPEditorMapBoxThemesTitle_ID_",sep:"GPEditorMapBoxSep"},this.mapbox={},this.sprites={}}_initEvents(){var e=this.options.scope||this,i=this.options.events;if(i){for(var n in i)if(i.hasOwnProperty(n)){var o=i[n];o&&(EventBus.hasEventListener(n,o,e)||EventBus.addEventListener(n,o,e))}}}_initContainer(){logger$e.trace(this.mapbox);var e=document.createElement("div");e.id=this.name.containerID+this.id,e.className=this.name.container;var i=this.options.tools.themes;if(i&&this.options.themes){if(this.options.tools.title){var n=document.createElement("div");n.id=this.name.titleThemesID+this.id,n.className=this.name.titleThemes,n.innerHTML="Liste des 'thmes'",e.appendChild(n)}var o=new Themes({id:this.id,target:e,tools:typeof i=="object"?i:{},obj:this.options.themes});o.add()}if(this.options.tools.search){var l=new Search({id:this.id,target:e,tools:{},obj:this.mapbox.layers});l.add()}for(var c in this.mapbox.sources)if(this.mapbox.sources.hasOwnProperty(c)){if(this.options.tools.layers){var u=Object.keys(this.mapbox.sources).length>1?1:0;if(u){var h=document.createElement("hr");h.className=this.name.sep,e.appendChild(h)}if(this.options.tools.title){var f=document.createElement("div");f.id=this.name.titleLayersID+this.id,f.className=this.name.titleLayers,f.innerHTML=u?"Liste des 'couches' ("+c+")":"Liste des 'couches'",e.appendChild(f)}}var g=this.mapbox.layers.slice();if(g.forEach(function(Lt,Nt){var vt=Lt.metadata;vt?vt["geoportail:order"]=Nt:Lt.metadata={"geoportail:order":Nt}}),this.options.tools.sort){var H=this.options.tools.sortBy,Y=this.options.tools.sortOrder,ee=function(Lt,Nt){var vt=0;if(Lt.metadata&&Lt.metadata["geoportail:group"]&&Nt.metadata&&Nt.metadata["geoportail:group"]){var Et=null,Ct=null;Et=Lt.metadata["geoportail:group"],Ct=Nt.metadata["geoportail:group"],vt=Et.localeCompare(Ct)}else switch(H){case"geom":vt=Y==="asc"?Lt.type.localeCompare(Nt.type)||Lt.id.localeCompare(Nt.id):Nt.type.localeCompare(Lt.type)||Nt.id.localeCompare(Lt.id);break;case"class":vt=Y==="asc"?Lt["source-layer"].localeCompare(Nt["source-layer"])||Lt.id.localeCompare(Nt.id):Nt["source-layer"].localeCompare(Lt["source-layer"])||Nt.id.localeCompare(Lt.id);break;case"id":default:vt=Y==="asc"?Lt.id.localeCompare(Nt.id):Nt.id.localeCompare(Lt.id);break}return vt};g.sort(ee)}logger$e.trace("Layers : ",g);var te=this.options.tools.sortBy,xe=this.options.tools.groupAuto,ne={};g.forEach(function(Lt){var Nt=Lt.metadata;if(Nt&&Nt["geoportail:group"]){var vt=Nt["geoportail:group"];ne[vt]=ne[vt]?ne[vt]+1:1}else{var Et=null;switch(te){case"class":Et=Lt["source-layer"];break;case"geom":Et=Lt.type;break;case"id":default:Et=Lt.id;break}var Ct=Et;if(xe){var _t=/_|-|:|=/,dt=Et.search(_t);Ct=dt!==-1?Et.substring(0,dt).trim():Et}ne[Ct]=ne[Ct]?ne[Ct]+1:1,Nt?Nt["geoportail:group"]=Ct:Lt.metadata={"geoportail:group":Ct}}}),logger$e.trace("Groups : ",ne);var et=document.createElement("div");et.className=this.name.containerLayers,e.appendChild(et);var tt;if(this.options.tools.collapse!==void 0){tt=document.createElement("details"),tt.className="",tt.open=!this.options.tools.collapse,et.appendChild(tt);var it=document.createElement("summary");it.className="",it.innerHTML="",tt.appendChild(it)}for(var rt=this.options.tools.collapse!==void 0?tt:et,nt=-1,st=0;st<g.length;st++){var at=g[st];if(nt++,at.source===c){if(this.options.tools.group&&this.options.tools.sort){var ot=at.metadata;if(ot){var ct=at.metadata["geoportail:group"];if(ct)if(ne[ct]>1){ne[ct]=-1;var ht=new Group({id:this.id,target:this.options.tools.collapse!==void 0?tt:et,title:ct,collapse:!0});ht.add(),rt=ht.getContainer()}else ne[ct]===1&&(rt=this.options.tools.collapse!==void 0?tt:et);else rt=this.options.tools.collapse!==void 0?tt:et}else rt=this.options.tools.collapse!==void 0?tt:et}if(this.options.tools.layers){var ut=new Layer({id:this.id,target:rt,position:nt+"_"+this.id,tools:{visibility:this.options.tools.visibility,icon:this.options.tools.icon,type:this.options.tools.type,pin:this.options.tools.pin},obj:{id:at.id,type:at.type,source:at.source,"source-layer":at["source-layer"]}});ut.add(),at.layout&&at.layout.visibility&&at.layout.visibility==="none"&&ut.visibility(!1),this.layers.push(ut)}if(this.options.tools.legend){var pt=this.options.tools.editable;typeof pt>"u"&&(pt=at.editable);var yt=new Legend({id:this.id,target:rt,sprites:this.sprites,obj:{id:at.id,source:at.source,title:at.id,editable:typeof pt<"u"?pt:!1,paint:at.paint,layout:at.layout}});yt.add(),yt.display(!1),ut&&(ut.addLegend(yt),ut.slotLegend())}if(this.options.tools.style){var mt=new Style({id:this.id,target:rt,position:nt+"_"+this.id,obj:{id:at.id,source:at.source,layout:at.layout,paint:at.paint}});mt.add(),mt.display(!1),ut&&ut.addStyle(mt),at.layout&&at.layout.visibility&&at.layout.visibility==="none"&&ut.visibility(!1)}if(this.options.tools.filter){var St=new Filter({id:this.id,target:rt,position:nt+"_"+this.id,obj:{id:at.id,source:at.source,filter:at.Filter}});St.add(),St.display(!1),ut&&ut.addFilter(St)}}else nt>=0&&nt--}}if(this.container=e,!this.options.target){if(!document.getElementById(this.name.target)){var Pt=document.createElement("div");Pt.id=this.name.target;var Rt=document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0]||document.documentElement;Rt.appendChild(Pt)}this.options.target=document.getElementById(this.name.target)}this.container&&this.options.target.appendChild(this.container),EventBus.dispatch(EventEditor.onloaded,this)}_getSprites(e){var i=this;if(e&&e.startsWith("mapbox://"))return new Promise((l,c)=>{logger$e.error("Protocole mapbox:// non gr !"),l(i)});if(!e)return new Promise((l,c)=>{logger$e.error("Auncun sprites disponibles !"),l(i)});var n=function(){var l=e+".png";return fetch(l,{credentials:"same-origin"}).then(function(c){if(c.ok)return c.blob().then(function(h){i.sprites.url=l;var f=new Image;return f.src=l,f.decode().then(function(){i.sprites.size={},i.sprites.size.h=f.height,i.sprites.size.w=f.width})}).catch(h=>{logger$e.warn("fetch image sprites exception :",h)});var u=new Error("HTTP status code: "+c.status);throw u}).catch(c=>new Promise((u,h)=>{logger$e.error("fetch image sprites exception :",c),h(c)}))},o=function(){var l=e+".json";return fetch(l,{credentials:"same-origin"}).then(function(c){if(c.ok)return c.json().then(function(h){i.sprites.json=h}).catch(h=>{logger$e.warn("fetch json sprites exception :",h)});var u=new Error("HTTP status code: "+c.status);throw u}).catch(c=>new Promise((u,h)=>{logger$e.error("fetch json sprites exception :",c),h(c)}))};return Promise.all([n(),o()])}createElement(){var e=this;if(typeof this.options.style=="object")return this.mapbox=this.options.style,this.options.tools.legend?this._getSprites(this.mapbox.sprite).then(function(){return e._initContainer(),e}).catch(i=>{logger$e.warn("fetch sprites exception :",i)}):new Promise((i,n)=>{e._initContainer(),i(e)});if(typeof this.options.style=="string")return fetch(this.options.style,{credentials:"same-origin"}).then(i=>i.json().then(n=>{e.mapbox=n}).then(function(){return e.options.tools.legend?e._getSprites(e.mapbox.sprite).then(function(){return e._initContainer(),e}).catch(n=>{logger$e.warn("fetch sprites exception :",n)}):new Promise((n,o)=>{e._initContainer(),n(e)})}).catch(n=>{logger$e.error("json exception :",n)})).catch(i=>{logger$e.error("fetch exception :",i)})}display(e){this.container.style.display=e?"block":"none"}setContext(e,i){this.context[e]=i}getContext(e){return this.context[e]}getID(){return this.id}getContainer(){return this.container}getStyle(){return this.mapbox}getStyleLayer(e){for(var i=null,n=this.getLayer(e),o=n.options.obj.id,l=0;l<this.mapbox.layers.length;l++){var c=this.mapbox.layers[l];if(c.id===o){i=c;break}}return i}getLayerFromStyle(e){for(var i=null,n=this.mapbox.layers[e],o=0;o<this.getLayers().length;o++){var l=this.getLayer(o);if(n.id===l.options.obj.id){i=l;break}}return i}getLayers(){return this.layers}getLayer(e){return this.layers[e]}}Helper.assign(Editor.prototype,EditorDOM);window.ol&&window.ol.style&&(window.ol.style.Editor=Editor);var LayerImportDOM={_addUID:function(s){var e=this._uid?s+"-"+this._uid:s;return e},_createLoadingElement:function(){var s=document.createElement("div");return s.id="GPmapLoading",s.className="",s},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPimport"),s.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",s},_createShowImportPictoElement:function(){var s=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowImportPicto"),e.classList.add("GPshowOpen","GPshowAdvancedToolPicto","GPshowImportPicto"),e.classList.add("gpf-btn","gpf-btn--tertiary","gpf-btn-icon","gpf-btn-icon-import"),e.classList.add("fr-btn","fr-btn--tertiary"),e.setAttribute("aria-label","Ouvrir l'import de couches"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s._onShowImportClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s._onShowImportClick(n)}),e},_createImportPanelElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPimportPanel"),s.className="GPpanel gpf-panel fr-modal",s},_createImportPanelDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__body fr-modal__body",s},_createImportPanelHeaderElement:function(){var s=document.createElement("div");return s.className="GPpanelHeader GPelementVisible gpf-visible gpf-panel__header fr-modal__header",s},_createImportPanelReturnPictoElement:function(){var s=this,e=document.createElement("button");if(e.id=this._addUID("GPimportPanelReturnPicto"),e.title="Masquer le panneau",e.className="GPreturnPicto GPimportPanelReturnPicto GPelementHidden gpf-hidden gpf-btn gpf-btn-icon-return fr-btn fr-btn--close fr-btn--tertiary-no-outline",checkDsfr()){var i=document.createElement("span");i.className="GPelementHidden",i.innerHTML="Retour",e.appendChild(i)}return e.addEventListener?e.addEventListener("click",function(n){document.getElementById(s._addUID("GPshowImportPicto")).click(),s._onReturnPictoClick(n),document.getElementById(s._addUID("GPshowImportPicto")).click()}):e.attachEvent&&e.attachEvent("onclick",function(n){document.getElementById(s._addUID("GPshowImportPicto")).click(),s._onReturnPictoClick(n),document.getElementById(s._addUID("GPshowImportPicto")).click()}),e},_createImportPanelTitleElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPimportHeaderTitle"),s.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",s.innerHTML="Import de donnes",s},_createImportPanelCloseElement:function(){var s=this,e=document.createElement("button");e.id=this._addUID("GPimportPanelClose"),e.className="GPpanelClose GPimportPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline",e.title="Fermer le panneau",e.addEventListener?e.addEventListener("click",function(){document.getElementById(s._addUID("GPshowImportPicto")).click()},!1):e.attachEvent&&e.attachEvent("onclick",function(){document.getElementById(s._addUID("GPshowImportPicto")).click()});var i=document.createElement("span");return i.className="GPelementHidden gpf-visible",i.innerText="Fermer",e.appendChild(i),e},_createImportPanelFormElement:function(){var s=this,e=document.createElement("form");return e.id=this._addUID("GPimportForm"),e.className="GPform GPelementVisible gpf-visible gpf-mobile-form gpf-panel__content fr-modal__content",e.addEventListener?e.addEventListener("submit",function(i){i.preventDefault(),s._onImportSubmit()}):e.attachEvent&&e.attachEvent("onsubmit",function(i){i.preventDefault(),s._onImportSubmit()}),e},_createImportTypeLineElement:function(s){var e=this,i=document.createElement("div");i.id=this._addUID("GPimportTypeLine"),i.className="GPimportInputLine";var n=document.createElement("label");n.id=this._addUID("GPimportTypeLabel"),n.className="GPlabel gpf-label fr-label",n.innerHTML="Type de donne",n.title="Type de donne",i.appendChild(n);var o=document.createElement("select");o.setAttribute("aria-labelledby",this._addUID("GPimportTypeLabel")),o.className="GPselect gpf-select fr-select",o.addEventListener?o.addEventListener("change",function(u){this.value==="KML"||this.value==="GPX"||this.value==="GeoJSON"||this.value==="MAPBOX"?(document.getElementById(e._addUID("GPimportStaticParams")).className="GPelementVisible gpf-visible fr-my-4w",document.getElementById(e._addUID("GPimportServiceParams")).className="GPelementHidden gpf-hidden"):(this.value==="WMS"||this.value==="WMTS"||this.value==="WFS")&&(document.getElementById(e._addUID("GPimportServiceParams")).className="GPelementVisible gpf-visible fr-my-4w",document.getElementById(e._addUID("GPimportStaticParams")).className="GPelementHidden gpf-hidden"),e._onImportTypeChange(u)}):o.attachEvent&&o.attachEvent("onchange",function(){this.value==="KML"||this.value==="GPX"||this.value==="GeoJSON"||this.value==="MAPBOX"?(document.getElementById(e._addUID("GPimportStaticParams")).className="GPelementVisible gpf-visible fr-my-4w",document.getElementById(e._addUID("GPimportServiceParams")).className="GPelementHidden gpf-hidden"):(this.value==="WMS"||this.value==="WMTS"||this.value==="WFS")&&(document.getElementById(e._addUID("GPimportServiceParams")).className="GPelementVisible gpf-visible fr-my-4w",document.getElementById(e._addUID("GPimportStaticParams")).className="GPelementHidden gpf-hidden"),e._onImportTypeChange()}),o.id=this._addUID("GPimportTypeSelect"),(!s||!Array.isArray(s))&&(s=["KML","GPX","GeoJSON","MAPBOX","WMS","WMTS","WFS"]);for(var l,c=0;c<s.length;c++)l=document.createElement("option"),l.value=s[c],l.text=s[c]==="MAPBOX"?"Tuiles vectorielles":s[c],o.appendChild(l);return i.appendChild(o),i},_createImportWaitingElement:function(){var s=document.createElement("div");s.id=this._addUID("GPimportWaitingContainer"),s.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden";var e=document.createElement("p");return e.className="GPwaitingContainerInfo gpf-waiting_info",e.innerHTML="Recherche en cours...",s.appendChild(e),s},_createImportStaticParamsContainer:function(s){var e=document.createElement("div");return e.id=this._addUID("GPimportStaticParams"),s==="KML"||s==="GPX"||s==="GeoJSON"||s==="MAPBOX"?e.className="GPelementVisible gpf-visible fr-my-4w":e.className="GPelementHidden gpf-hidden",e},_createStaticNameLabel:function(){var s=document.createElement("div");s.className="GPimportInputLine fr-mb-1w";var e=document.createElement("label");e.className="GPlabel gpf-label fr-label",e.htmlFor=this._addUID("GPimportName"),e.innerHTML="Nom",e.title="Nom",s.appendChild(e);var i=document.createElement("input");return i.type="text",i.id=this._addUID("GPimportName"),i.className="GPinput gpf-input fr-input",s.appendChild(i),s},_createStaticModeChoiceDiv:function(){var s=document.createElement("div");return s.id=this._addUID("GPimportChoice"),s.className="fr-my-1w",s},_createStaticLocalChoiceDiv:function(){var s=this,e=document.createElement("div");e.className="GPimportChoiceAlt gpf-radio-group fr-radio-group";var i=document.createElement("input");i.type="radio",i.addEventListener?i.addEventListener("change",function(o){document.getElementById(s._addUID("GPimportValueLocal")).className="GPimportInputLine fr-mb-1w",document.getElementById(s._addUID("GPimportValueUrl")).className="GPelementHidden gpf-hidden",s._onStaticImportTypeChange(o)}):i.appendChild&&i.appendChild("onchange",function(){document.getElementById(s._addUID("GPimportValueLocal")).className="GPimportInputLine fr-mb-1w",document.getElementById(s._addUID("GPimportValueUrl")).className="GPelementHidden gpf-hidden",s._onStaticImportTypeChange()}),i.name="GPimportChoiceMode",i.value="local",i.checked=!0,i.id=this._addUID("GPimportChoiceAltLocal"),e.appendChild(i);var n=document.createElement("label");return n.className="GPimportChoiceAltTxt gpf-label fr-label",n.htmlFor=this._addUID("GPimportChoiceAltLocal"),n.innerHTML="par fichier local",n.title="par fichier local",e.appendChild(n),e},_createStaticUrlChoiceDiv:function(){var s=this,e=document.createElement("div");e.className="GPimportChoiceAlt gpf-radio-group fr-radio-group";var i=document.createElement("input");i.type="radio",i.addEventListener?i.addEventListener("change",function(o){document.getElementById(s._addUID("GPimportValueUrl")).className="GPimportInputLine",document.getElementById(s._addUID("GPimportValueLocal")).className="GPelementHidden gpf-hidden",s._onStaticImportTypeChange(o)}):i.appendChild&&i.appendChild("onchange",function(){document.getElementById(s._addUID("GPimportValueUrl")).className="GPimportInputLine",document.getElementById(s._addUID("GPimportValueLocal")).className="GPelementHidden gpf-hidden",s._onStaticImportTypeChange()}),i.id=this._addUID("GPimportChoiceAltUrl"),i.name="GPimportChoiceMode",i.value="url",i.checked=!1,e.appendChild(i);var n=document.createElement("label");return n.className="GPimportChoiceAltTxt gpf-label fr-label",n.htmlFor=this._addUID("GPimportChoiceAltUrl"),n.innerHTML="par URL",n.title="par URL",e.appendChild(n),e},_createStaticLocalInputDiv:function(){var s=document.createElement("div");return s.id=this._addUID("GPimportValueLocal"),s.className="GPimportInputLine",s},_createStaticLocalInputLabel:function(){var s=document.createElement("label");return s.className="GPlabel gpf-label fr-label fr-mb-1w",s.htmlFor=this._addUID("GPimportFile"),s.innerHTML="Fichier local",s.title="Fichier local",s},_createStaticLocalInput:function(){var s=document.createElement("input");return s.type="file",s.id=this._addUID("GPimportFile"),s.className="GPimportInputFile gpf-upload fr-upload",s},_createStaticUrlInputDiv:function(){var s=document.createElement("div");return s.id=this._addUID("GPimportValueUrl"),s.className="GPelementHidden gpf-hidden",s},_createStaticUrlInputLabel:function(){var s=document.createElement("label");return s.className="GPlabel gpf-label fr-label",s.htmlFor=this._addUID("GPimportUrl"),s.innerHTML="URL",s.title="URL",s},_createStaticUrlInput:function(){var s=document.createElement("input");return s.type="text",s.id=this._addUID("GPimportUrl"),s.className="GPinput gpf-input fr-input",s},_createServiceParamsContainer:function(s){var e=document.createElement("div");return e.id=this._addUID("GPimportServiceParams"),s==="WMS"||s==="WMTS"||s==="WFS"?e.className="GPelementVisible gpf-visible":e.className="GPelementHidden gpf-hidden",e},_createServiceUrlDiv:function(){var s=document.createElement("div");return s.className="GPimportInputLine",s},_createServiceUrlInputLabel:function(){var s=document.createElement("label");return s.className="GPlabel gpf-label fr-label",s.htmlFor=this._addUID("GPimportServiceUrl"),s.innerHTML="URL du service",s.title="URL du service",s},_createServiceUrlInput:function(){var s=document.createElement("input");return s.type="text",s.id=this._addUID("GPimportServiceUrl"),s.className="GPinput gpf-input fr-input",s},_createImportSubmitFormElement:function(){var s=document.createElement("input");return s.id=this._addUID("GPimportSubmit"),s.className="GPsubmit gpf-btn fr-btn",s.type="submit",s.value="Importer",s},_createImportGetCapPanelElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPimportGetCapPanel"),s.className="GPpanel GPelementHidden gpf-panel fr-modal gpf-hidden",s},_createImportGetCapPanelHeaderElement:function(){var s=this,e=document.createElement("div");e.className="GPpanelHeader gpf-panel__header fr-modal__header";var i=document.createElement("div");i.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",i.innerHTML="Couches accessibles",i.title="Couches accessibles",e.appendChild(i);var n=document.createElement("button");n.className="GPpanelClose GPimportGetCapPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",n.title="Fermer le panneau",n.id=this._addUID("GPimportGetCapPanelClose"),n.addEventListener?n.addEventListener("click",function(){document.getElementById(s._addUID("GPshowImportPicto")).click(),document.getElementById(s._addUID("GPimportGetCapPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPimportGetCapPanel")).classList.replace("gpf-visible","gpf-hidden"),s._onGetCapPanelClose()}):n.attachEvent&&n.attachEvent("click",function(){document.getElementById(s._addUID("GPshowImportPicto")).click(),document.getElementById(s._addUID("GPimportGetCapPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(s._addUID("GPimportGetCapPanel")).classList.replace("gpf-visible","gpf-hidden"),s._onGetCapPanelClose()});var o=document.createElement("span");return o.className="GPelementHidden gpf-visible",o.innerText="Fermer",n.appendChild(o),e.appendChild(n),e},_createImportGetCapResultsContainer:function(){var s=document.createElement("div");return s.className="GPimportGetCapRoot gpf-panel__list",s.id=this._addUID("GPimportGetCapResults"),s},_addImportGetCapResultListRubrique:function(s,e){var i=document.createElement("ul");return i.className="GPimportGetCapListRubrique",i.title=s,e.appendChild(i),e},_addImportGetCapResultRubrique:function(s,e){var i=document.createElement("li");i.className="GPimportGetCapRubrique gpf-panel__items_layerimport";var n=document.createElement("input");n.id="GPimportGetCapRubrique-"+SelectorID.generate(),n.className="GPimportGetCapRubrique",n.type="checkbox",i.appendChild(n);var o=document.createElement("label");return o.className="GPimportGetCapRubriqueTitle gpf-label fr-btn fr-btn--secondary",o.htmlFor=n.id,o.innerHTML=s,o.title=s,i.appendChild(o),e.appendChild(i),e},_addImportGetCapResultListLayer:function(s){var e=document.createElement("ul");return e.className="GPimportGetCapListLayer",s.appendChild(e),s},_addImportGetCapResultLayer:function(s,e,i){var n=document.createElement("li");n.className="GPimportGetCapProposal gpf-panel__items_layerimport gpf-panel__items",n.innerHTML=s.content,n.title=s.title,n.id="GPimportGetCapProposal_"+e;var o=this;return n.addEventListener?n.addEventListener("click",function(l){o._onGetCapResponseLayerClick(l)}):n.attachEvent&&n.attachEvent("onclick",function(){o._onGetCapResponseLayerClick()}),i.appendChild(n),i},_createImportMapBoxPanelElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPimportMapBoxPanel"),s.className="GPpanel GPelementHidden gpf-panel fr-modal gpf-hidden",s},_createImportMapBoxPanelHeaderElement:function(){var s=this,e=document.createElement("div");e.className="GPpanelHeader gpf-panel__header fr-modal__header";var i=document.createElement("button");i.id=this._addUID("GPimportMapBoxPanelReturnPicto"),i.title="Nouvel import",i.className="GPreturnPicto GPimportMapBoxPanelReturnPicto gpf-btn gpf-btn-icon-return fr-btn fr-btn--secondary gpf-btn--secondary",i.addEventListener?i.addEventListener("click",function(c){document.getElementById(s._addUID("GPshowImportPicto")).click(),s._onMapBoxReturnPictoClick(c)}):i.attachEvent&&i.attachEvent("onclick",function(c){document.getElementById(s._addUID("GPshowImportPicto")).click(),s._onMapBoxReturnPictoClick(c)}),e.appendChild(i);var n=document.createElement("div");n.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",n.innerHTML="Edition des styles",n.title="Edition des styles",e.appendChild(n);var o=document.createElement("button");o.className="GPpanelClose GPimportMapBoxPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",o.title="Fermer le panneau",o.id=this._addUID("GPimportMapBoxPanelClose"),o.addEventListener?o.addEventListener("click",function(){document.getElementById(s._addUID("GPshowImportPicto")).click(),document.getElementById(s._addUID("GPimportMapBoxPanel")).style.display="none",s._onMapBoxPanelClose()}):o.attachEvent&&o.attachEvent("click",function(){document.getElementById(s._addUID("GPshowImportPicto")).click(),document.getElementById(s._addUID("GPimportMapBoxPanel")).style.display="none",s._onMapBoxPanelClose()});var l=document.createElement("span");return l.className="GPelementHidden gpf-visible",l.innerText="Fermer",o.appendChild(l),e.appendChild(o),e},_createImportMapBoxResultsContainer:function(){var s=document.createElement("div");return s.className="GPimportMapBoxpRoot",s.id=this._addUID("GPimportMapBoxResults"),s}},MeasureToolBoxDOM={_toolboxId:"GPtoolbox-measure-main",_buttonId:"GPtoolbox-measure-button",_widgetId:"GPtoolbox-measure-widget",getToolBoxID:function(s){return s?this._toolboxId+"-"+s:this._toolboxId},getButtonID:function(s){return s?this._buttonId+"-"+s:this._buttonId},getWidgetID:function(s){return s?this._widgetId+"-"+s:this._widgetId},_createToolBoxContainerElement:function(s){var e=document.createElement("div");e.id=this.getToolBoxID(s),e.className="GPshowAdvancedToolPicto";var i=document.createElement("button");i.id=this.getButtonID(s),i.className="GPshowOpen GPshowAdvancedToolPicto GPshowToolBoxPicto gpf-btn gpf-btn-icon-toolbox fr-btn",i.setAttribute("tabindex","0"),i.setAttribute("aria-pressed",!1),i.setAttribute("type","button");var n=this;i.addEventListener("click",function(l){var c=l.target.ariaPressed==="true";l.target.setAttribute("aria-pressed",!c),this.blur();var u=document.getElementById(n.getWidgetID(s));u.style.display==="block"?u.style.display="none":u.style.display="block"}),e.appendChild(i);var o=document.createElement("div");return o.id=this.getWidgetID(s),o.addEventListener("click",function(){},!1),e.appendChild(o),e}},logger$d=LoggerByDefault.getLogger("toolbox"),MeasureToolBox={_toolbox:{},add:function(s,e){if(logger$d.trace("ToolBox.add()",e),!s){logger$d.trace("map doesn't exist !?");return}var i=typeof window<"u"?window:typeof self<"u"?self:null;i&&(this._toolbox=i.gpShareMeasureToolBox||{});var n=s.getTargetElement(),o=n.ownerDocument,l=n.id;!this._toolbox||Object.keys(this._toolbox).length===0?(this._toolbox={},this._toolbox[l]=SelectorID.generate()):this._toolbox[l]||(this._toolbox[l]=SelectorID.generate());var c=this._toolbox[l];if(!o.getElementById(this.getToolBoxID(c))){logger$d.trace("create toolbox !");var u=this._createToolBoxContainerElement(c);u.style.pointerEvents="auto";var h=n.getElementsByClassName("ol-overlaycontainer-stopevent");h[0].appendChild(u)}var f=o.getElementById(this.getWidgetID(c));e.setTarget(f),i&&(i.gpShareMeasureToolBox=this._toolbox),logger$d.trace("add control to toolbox !")}};Helper.assign(MeasureToolBox,MeasureToolBoxDOM);var logger$c=LoggerByDefault.getLogger("measures"),Measures={DEFAULT_POINTER_STYLE:new CircleStyle({radius:5,stroke:new Stroke({color:"#002A50",width:2}),fill:new Fill({color:"rgba(255, 155, 0, 0.7)"})}),DEFAULT_DRAW_START_STYLE:new Style$1({fill:new Fill({color:"rgba(0, 183, 152, 0.2)"}),stroke:new Stroke({color:"#002A50",lineDash:[10,10],width:2})}),DEFAULT_DRAW_FINISH_STYLE:new Style$1({fill:new Fill({color:"rgba(0, 183, 152, 0.3)"}),stroke:new Stroke({color:"#002A50",width:3})}),tools:{MeasureLength:[],MeasureArea:[],MeasureAzimuth:[]},measureDraw:null,measureSource:null,measureVector:null,eventLayerRemove:null,sketch:null,measureTooltipElement:null,measureTooltip:null,helpTooltipElement:null,helpTooltip:null,clean:function(){var s=this.CLASSNAME;logger$c.trace("["+s+"] deactived tool !"),this.clearMeasure(),this.clearMeasureToolTip(),this.removeMeasureEvents(),this._pictoContainer.setAttribute("aria-pressed",!1)},onPointerMoveHandler:function(s){if(!s.dragging){var e=s.coordinate;if(this.sketch){var i,n=this.sketch.getGeometry();if(i=this.format(n),n.getType()==="LineString")e=n.getLastCoordinate();else if(n.getType()==="Polygon")e=n.getInteriorPoint().getCoordinates();else return;this.measureTooltipElement.innerHTML=i,this.measureTooltip.setPosition(e)}}},onShowMeasureClick:function(s,e){s.target.ariaPressed==="true"&&this.onPanelOpen();var i=this.getMap(),n=i.getTargetElement().id,o=typeof window<"u"?window:typeof self<"u"?self:null;o&&(this.tools=o.gpShareMeasures||{});var l=this.CLASSNAME;for(var c in this.tools)if(this.tools.hasOwnProperty(c))for(var u=this.tools[c],h=0;h<u.length;h++){var f=u[h];f&&f.active&&c!==l&&f.map.id===n&&(f.active=!1,f.instance!==null&&f.instance.clean())}Interactions.unset(i,{current:"Measures"});var g=this._pictoContainer.ariaPressed;if(g==="true"){this.addMeasureEvents(),this.initMeasureInteraction(),this.addMeasureInteraction(e);for(var H=0;H<this.tools[l].length;H++)this.tools[l][H].map.id===n&&(this.tools[l][H].active=!0)}else{this.clearMeasure(),this.clearMeasureToolTip(),this.removeMeasureEvents();for(var Y=0;Y<this.tools[l].length;Y++)this.tools[l][Y].map.id===n&&(this.tools[l][Y].active=!1)}},clearMeasureToolTip:function(){var s=this.getMap();if(s)for(var e=s.getTargetElement(),i=e.getElementsByClassName("ol-overlaycontainer"),n=0;n<i.length;n++){for(var o=i[n],l=o.children.length,c=[],u=0;u<l;u++){var h=o.children[u];if(h.children.length!==0){var f=h.children[0];(f.className==="GPmeasureTooltip GPmeasureTooltip-static"||f.className==="GPmeasureTooltip GPmeasureTooltip-measure")&&c.push(h)}}for(var g=0;g<c.length;g++)o.removeChild(c[g])}},clearMeasure:function(){var s=this.getMap();this.measureVector&&(s.removeLayer(this.measureVector),this.measureVector=null),this.measureDraw&&(s.removeInteraction(this.measureDraw),this.measureDraw=null)},createMeasureTooltip:function(s){this.measureTooltipElement&&this.measureTooltipElement.parentNode.removeChild(this.measureTooltipElement),this.measureTooltipElement=document.createElement("div"),this.measureTooltipElement.className="GPmeasureTooltip GPmeasureTooltip-measure",this.measureTooltip=new Overlay({element:this.measureTooltipElement,stopEvent:!1,offset:[0,-15],positioning:"bottom-center"}),s.addOverlay(this.measureTooltip)},createHelpTooltip:function(s){this.helpTooltipElement&&this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement),this.helpTooltipElement=document.createElement("div"),this.helpTooltipElement.className="tooltip hidden",this.helpTooltip=new Overlay({element:this.helpTooltipElement,stopEvent:!1,offset:[15,0],positioning:"center-left"}),s.addOverlay(this.helpTooltip)},createStylingMeasureInteraction:function(s){this.options.styles=s||{},logger$c.trace("style start",this.options.styles.start);var e={image:Measures.DEFAULT_POINTER_STYLE,fill:Measures.DEFAULT_DRAW_START_STYLE.getFill(),stroke:Measures.DEFAULT_DRAW_START_STYLE.getStroke()};this.options.styles.hasOwnProperty("pointer")&&this.options.styles.pointer instanceof Image&&(e.image=this.options.styles.pointer),this.options.styles.hasOwnProperty("start")&&this.options.styles.start instanceof Style$1&&(this.options.styles.start.getFill()!=null&&(e.fill=this.options.styles.start.getFill()),this.options.styles.start.getStroke()!=null&&(e.stroke=this.options.styles.start.getStroke())),this.options.styles.start=new Style$1(e),logger$c.trace("style finish",this.options.styles.finish);var i={fill:Measures.DEFAULT_DRAW_FINISH_STYLE.getFill(),stroke:Measures.DEFAULT_DRAW_FINISH_STYLE.getStroke()};this.options.styles.hasOwnProperty("finish")&&this.options.styles.finish instanceof Style$1&&(this.options.styles.finish.getFill()!=null&&(i.fill=this.options.styles.finish.getFill()),this.options.styles.finish.getStroke()!=null&&(i.stroke=this.options.styles.finish.getStroke())),this.options.styles.finish=new Style$1(i)},addMeasureInteraction:function(s){var e=this.getMap(),i=this;this.measureDraw=new Draw({source:this.measureSource,condition:function(n){return n.originalEvent.ctrlKey?(i.sketch&&this.removeLastPoint(),!1):!0},type:s,style:this.options.styles.start||Measures.DEFAULT_DRAW_START_STYLE}),this.measureDraw.setProperties({name:"Measures",source:this}),e.addInteraction(this.measureDraw),this.createMeasureTooltip(e),this.measureDraw.on("drawstart",n=>{i.sketch=n.feature}),this.measureDraw.on("drawend",()=>{if(i.sketch){var n,o,l=i.sketch.getGeometry();if(n=i.format(l),l.getType()==="LineString")o=l.getLastCoordinate();else if(l.getType()==="Polygon")o=l.getInteriorPoint().getCoordinates();else return;i.measureTooltipElement.innerHTML=n,i.measureTooltip.setPosition(o)}i.measureTooltipElement.className="GPmeasureTooltip GPmeasureTooltip-static",i.measureTooltip.setOffset([0,-7]),i.sketch=null,i.measureTooltipElement=null,i.createMeasureTooltip(e)})},initMeasureInteraction:function(){var s=this.getMap();this.measureSource=new VectorSource,this.measureVector=new VectorLayer({source:this.measureSource,style:this.options.styles.finish||Measures.DEFAULT_DRAW_FINISH_STYLE}),this.measureVector.gpResultLayerId="measure",s.addLayer(this.measureVector),s.getControls().forEach(e=>{if(e.CLASSNAME==="LayerSwitcher"){var i=this.measureVector.gpLayerId;e._layers[i].title===i&&e.addLayer(this.measureVector,{title:this.options.layerDescription.title,description:this.options.layerDescription.description})}})}},ElevationPathDOM={_addUID:function(s){var e=this._uid?s+"-"+this._uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPelevationPath"),s.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",s},_createShowElevationPathPictoElement:function(){var s=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowElevationPathPicto"),e.classList.add("GPshowOpen","GPshowAdvancedToolPicto","GPshowElevationPathPicto"),e.classList.add("gpf-btn","gpf-btn--tertiary","gpf-btn-icon","gpf-btn-icon-elevation"),e.classList.add("fr-btn","fr-btn--tertiary"),e.setAttribute("aria-label","Calculer un profil altimtrique"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowElevationPathClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowElevationPathClick(n)}),e},_createElevationPathPanelElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPelevationPathPanel"),s.className="GPpanel gpf-panel fr-modal",s},_createElevationPathPanelDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__body fr-modal__body",s},_createDrawingButtonsPluginDiv:function(){var s=document.createElement("div");return s.className="container-buttons-plugin fr-mx-2w",s},_createElevationPathPanelHeaderElement:function(){var s=this,e=document.createElement("div");if(e.className="GPpanelHeader gpf-panel__header fr-modal__header",!checkDsfr()){var i=document.createElement("button");i.id=this._addUID("GPelevationPathPanelInfo"),i.className="GPpanelInfo gpf-btn gpf-btn-icon-info fr-btn fr-btn--secondary gpf-btn--secondary fr-m-1w",i.title="Informations",i.addEventListener?i.addEventListener("click",function(){s.onOpenElevationPathInfoClick()}):i.attachEvent&&i.attachEvent("onclick",function(){s.onOpenElevationPathInfoClick()}),e.appendChild(i)}var n=document.createElement("div");n.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",n.innerHTML="Profil Altimtrique",e.appendChild(n);var o=document.createElement("button");o.id=this._addUID("GPelevationPathPanelReduce"),o.className="GPpanelReduce gpf-btn gpf-btn-icon-reduce fr-btn fr-btn--secondary gpf-btn--secondary",o.title="Masquer le panneau",o.addEventListener?o.addEventListener("click",function(u){typeof s.onReduceElevationPathPanelClick=="function"&&s.onReduceElevationPathPanelClick()},!1):o.attachEvent&&o.attachEvent("onclick",function(u){typeof s.onReduceElevationPathPanelClick=="function"&&s.onReduceElevationPathPanelClick()}),e.appendChild(o);var l=document.createElement("button");l.id=this._addUID("GPelevationPathPanelClose"),l.className="GPpanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",l.title="Fermer le panneau",l.addEventListener?l.addEventListener("click",function(){document.getElementById(s._addUID("GPshowElevationPathPicto")).click()},!1):l.attachEvent&&l.attachEvent("onclick",function(){document.getElementById(s._addUID("GPshowElevationPathPicto")).click()});var c=document.createElement("span");return c.className="GPelementHidden gpf-visible",c.innerText="Fermer",l.appendChild(c),e.appendChild(l),e},_createElevationPathPanelProfilElement:function(){var s=document.createElement("div");s.className="GPelevationPathProfilWrapper";var e=document.createElement("div");return e.id="GPelevationPathProfil",s.appendChild(e),s},_createElevationPathWaitingElement:function(){var s=document.createElement("div");s.id=this._addUID("GPelevationPathCalcWaitingContainer"),s.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden";var e=document.createElement("p");return e.className="GPwaitingContainerInfo gpf-waiting_info",e.innerHTML="Recherche en cours...",s.appendChild(e),s},_createElevationPathInformationsElement:function(){var s=document.createElement("div");s.id=this._addUID("GPelevationPathInformationsContainer"),checkDsfr()||(s.className="GPelementHidden gpf-hidden");var e=document.createElement("p");return e.className="GPelevationPathInformations",e.innerHTML="Aucune information...",s.appendChild(e),s},_addElevationPathInformationsItem:function(s,e){var i=document.getElementById(this._addUID("GPelevationPathInformationsContainer"));if(i){var n=document.createElement("p");n.className="GPelevationPathInformations";var o=document.createElement("span");o.innerText=s;var l=document.createElement("span");l.innerText=e,n.appendChild(o),n.appendChild(l),i.appendChild(n)}return i}},ProfileElevationPathDOM={_getCssProperty:function(s,e){return window.getComputedStyle(s,null).getPropertyValue(e)},_getTextWidth:function(s,e,i=null){var n=this.canvas||(this.canvas=document.createElement("canvas")),o=n.getContext("2d");i===null?o.font=`${this._getCssProperty(e,"font-weight")} ${this._getCssProperty(e,"font-size")} ${this._getCssProperty(e,"font-family")}`:o.font=i;var l=o.measureText(s);return l.width},_dataZToSvgY:function(s,e,i,n){return e-(s-i)*n-.5},_dataDistToSvgX:function(s,e,i,n){return e-i+s*n},_svgXToDataDist:function(s,e,i,n){return(s+i-e)/n},_arrayBisect:function(s,e){let i;if(s.length===0)return 0;for(i=0;i<s.length;i++)if(e<s[i].dist)return i;return i-1},displayProfileByDefault:function(s,e,i,n){var o=i;if(!e||!s)return;const l={fontFamily:"Arial",strokeColor:"#0B6BA7",fillColor:"#00B798",focusLineColor:"#F90"};for(checkDsfr()&&(l.fontFamily="Marianne",l.strokeColor="#2F4077",l.fillColor="#2F4077",l.focusLineColor="#639f6a");e.firstChild;)e.removeChild(e.firstChild);const c={top:25,right:15,bottom:10,left:10};var u=o.options.displayProfileOptions,h=s.points,f=JSON.parse(JSON.stringify(h));f.sort(function(Qt,vi){return Qt.z-vi.z});var g=f[0].z,H=f[f.length-1].z,Y=s.distance;let ee="m";const te=document.createElement("div");te.id="profileElevationByDefault",e.appendChild(te);var xe=window.getComputedStyle(e).getPropertyValue("width").replace(/px/,""),ne=window.getComputedStyle(e).getPropertyValue("height").replace(/px/,"");const et=ne-c.top-c.bottom,tt=xe-c.left-c.right,it=17,rt=this._getTextWidth(Math.round(H).toLocaleString()+",88",e,`400 10 ${l.fontFamily}`),nt=17,st=15,at=15,ot=this._getTextWidth(Math.round(Y).toLocaleString()+",5",e),ct=1,ht=et-nt-st,ut=tt-it-rt,pt=document.createElementNS("http://www.w3.org/2000/svg","svg");pt.id="profileElevationByDefaultSvg",pt.setAttribute("style","display: block; margin: auto; overflow: visible;"),pt.setAttribute("viewBox",`0 0 ${xe} ${ne}`),pt.setAttribute("width","100%"),pt.setAttribute("height","100%");const yt=Math.floor(ht/at);let mt;H===g?mt=.1:mt=Math.pow(10,Math.ceil(Math.log((H-g)/yt)/Math.log(10)))/2;let St=Math.floor(g/mt)*mt,Pt=Math.ceil(H/mt)*mt;Pt===H&&(Pt+=mt),St=Math.round(St*100)/100,Pt=Math.round(Pt*100)/100;let Rt=Math.round((Pt-St)/mt);Rt+1>yt&&(mt=Math.pow(10,Math.ceil(Math.log((H-g)/yt)/Math.log(10))),St=Math.floor(g/mt)*mt,Pt=Math.ceil(H/mt)*mt,Pt===H&&(Pt+=mt),St=Math.round(St*100)/100,Pt=Math.round(Pt*100)/100,Rt=Math.floor((Pt-St)/mt)),Rt=Math.max(Math.round(Rt),1);const Lt=document.createElementNS("http://www.w3.org/2000/svg","g");Lt.setAttribute("class","profile-z-vertical");const Nt=document.createElementNS("http://www.w3.org/2000/svg","g"),vt=ht/Rt;let Et;H===g?Et=ht/.2:Et=ht/(Pt-St);let Ct,_t,dt,ft,bt,Gt;for(let Qt=0;Qt<=Rt;Qt++)Ct=document.createElementNS("http://www.w3.org/2000/svg","text"),Ct.setAttribute("class","profile-z-graduation"),Ct.setAttribute("font-family",l.fontFamily),Ct.setAttribute("font-size","10px"),Ct.setAttribute("fill","#5E5E5E"),Ct.textContent=(Math.round(100*(St+Qt*mt))/100).toLocaleString(),_t=ht-Qt*vt,Ct.setAttribute("transform",`translate(${it+rt-8}, ${_t+5})`),Ct.setAttribute("text-anchor","end"),Lt.appendChild(Ct),dt=Math.round(_t)-.5,ft=document.createElementNS("http://www.w3.org/2000/svg","g"),bt=document.createElementNS("http://www.w3.org/2000/svg","path"),bt.setAttribute("cs","100,100"),bt.setAttribute("stroke-width","1"),Qt!==0?bt.setAttribute("stroke-opacity","0.2"):bt.setAttribute("stroke-opacity","1"),bt.setAttribute("stroke","#000000"),bt.setAttribute("fill","none"),bt.setAttribute("d",`M${it+rt},${dt} L${ut+it+rt},${dt}`),Gt=document.createElementNS("http://www.w3.org/2000/svg","path"),Gt.setAttribute("cs","100,100"),Gt.setAttribute("stroke-width","1"),Gt.setAttribute("stroke-opacity","1"),Gt.setAttribute("stroke","#000000"),Gt.setAttribute("fill","none"),Gt.setAttribute("d",`M${it+rt},${dt} L${it+rt+5},${dt}`),Gt.setAttribute("transform","translate(-5, 0)"),ft.appendChild(Gt),ft.appendChild(bt),Nt.appendChild(ft);var Ft=document.createElementNS("http://www.w3.org/2000/svg","text");Ft.setAttribute("class","profile-z-legend"),Ft.setAttribute("font-family",l.fontFamily),Ft.setAttribute("font-size","11px"),Ft.setAttribute("fill","#5E5E5E"),Ft.textContent="Altitude (m)",Ft.setAttribute("transform",`translate(${it-8}, ${Math.round(ht/2)}) rotate(-90)`),Ft.setAttribute("text-anchor","middle"),Lt.appendChild(Ft),pt.appendChild(Lt),pt.appendChild(Nt),Y>2e3&&(Y/=1e3,ee="km");const Ht=Math.floor(ut/ot);let Mt=Math.pow(10,Math.ceil(Math.log(Y/Ht)/Math.log(10)))/2;const It=Y;let xt=Math.floor(It/Mt);xt>Ht?(Mt=Math.pow(10,Math.ceil(Math.log(Y/Ht)/Math.log(10))),xt=Math.floor(It/Mt)):xt<ct&&(Mt=Math.pow(10,Math.ceil(Math.log(Y/Ht)/Math.log(10))-1),xt=Math.floor(It/Mt)),xt=Math.max(xt,1);const Tt=Mt*xt,Ut=document.createElementNS("http://www.w3.org/2000/svg","g");Ut.setAttribute("class","profile-x-vertical");const Dt=document.createElementNS("http://www.w3.org/2000/svg","g"),$t=ut/It,Zt=(It-Tt)*$t,Kt=Math.round((ut-Zt)/xt);let qt,Xt,zt,ai,wt,Ot;for(let Qt=0;Qt<=xt+1;Qt++)qt=document.createElementNS("http://www.w3.org/2000/svg","text"),qt.setAttribute("class","profile-x-graduation"),qt.setAttribute("font-family",l.fontFamily),qt.setAttribute("font-size","10px"),qt.setAttribute("fill","#5E5E5E"),Qt!==xt+1&&(qt.textContent=(Math.round(100*Qt*Mt)/100).toLocaleString()),Xt=it+rt+Qt*Kt,Qt===xt+1&&(Xt=it+rt+ut),qt.setAttribute("transform",`translate(${Xt}, ${ht+st+5})`),qt.setAttribute("text-anchor","middle"),Ut.appendChild(qt),zt=Xt-.5,ai=document.createElementNS("http://www.w3.org/2000/svg","g"),wt=document.createElementNS("http://www.w3.org/2000/svg","path"),wt.setAttribute("cs","100,100"),wt.setAttribute("stroke-width","1"),Qt!==0?wt.setAttribute("stroke-opacity","0.2"):wt.setAttribute("stroke-opacity","1"),wt.setAttribute("stroke","#000000"),wt.setAttribute("fill","none"),wt.setAttribute("d",`M${zt},${ht} L${zt},0`),Ot=document.createElementNS("http://www.w3.org/2000/svg","path"),Ot.setAttribute("cs","100,100"),Ot.setAttribute("stroke-width","1"),Ot.setAttribute("stroke-opacity","1"),Ot.setAttribute("stroke","#000000"),Ot.setAttribute("fill","none"),Ot.setAttribute("d",`M${zt},${ht} L${zt},${ht-5}`),Ot.setAttribute("transform","translate(0, 5)"),ai.appendChild(Ot),ai.appendChild(wt),Dt.appendChild(ai);var kt=document.createElementNS("http://www.w3.org/2000/svg","text");kt.setAttribute("class","profile-x-legend"),kt.setAttribute("font-family",l.fontFamily),kt.setAttribute("font-size","11px"),kt.setAttribute("fill","#5E5E5E"),kt.textContent=`Distance (${ee})`,kt.setAttribute("transform",`translate(${it+rt+ut/2}, ${ht+st+nt+3})`),kt.setAttribute("text-anchor","middle"),Ut.appendChild(kt),pt.appendChild(Ut),pt.appendChild(Dt);const Bt=document.createElementNS("http://www.w3.org/2000/svg","g");let jt=1;ee==="km"&&(jt=1e3);let Wt=this._dataDistToSvgX(h[0].dist/jt,tt,ut,$t),Vt=this._dataZToSvgY(h[0].z,ht,St,Et),Yt=`M${Wt},${Vt}`;for(let Qt=1;Qt<h.length;Qt++)Wt=this._dataDistToSvgX(h[Qt].dist/jt,tt,ut,$t),Vt=this._dataZToSvgY(h[Qt].z,ht,St,Et),Yt+=` L${Wt},${Vt}`;const ti=document.createElementNS("http://www.w3.org/2000/svg","path");ti.setAttribute("cs","100,100"),ti.setAttribute("stroke-width","1"),ti.setAttribute("stroke-opacity","1"),ti.setAttribute("stroke",l.strokeColor),ti.setAttribute("fill","none"),ti.setAttribute("d",Yt),Yt+=` L${Wt},${ht}`,Yt+=` L${tt-ut},${ht}`;const ni=document.createElementNS("http://www.w3.org/2000/svg","path");ni.setAttribute("cs","100,100"),ni.setAttribute("stroke-width","1"),ni.setAttribute("stroke-opacity","0"),ni.setAttribute("stroke","#000000"),ni.setAttribute("fill",l.fillColor),ni.setAttribute("fill-opacity","0.2"),ni.setAttribute("d",Yt),Bt.appendChild(ti),Bt.appendChild(ni),pt.appendChild(Bt);const ui=document.createElementNS("http://www.w3.org/2000/svg","g"),ci=document.createElementNS("http://www.w3.org/2000/svg","rect");ci.setAttribute("width",ut),ci.setAttribute("height",ht),ci.setAttribute("transform",`translate(${tt-ut},0)`),ci.setAttribute("visibility","hidden"),ci.setAttribute("pointer-events","all");const hi=JSON.parse(JSON.stringify(h));hi.sort(function(Qt,vi){return Qt.dist-vi.dist});const si=document.createElementNS("http://www.w3.org/2000/svg","line");si.setAttribute("id","focusLineX"),si.setAttribute("class","focusLine-default"),si.setAttribute("fill","none"),si.setAttribute("stroke",l.focusLineColor),si.setAttribute("stroke-width","0.5px"),si.setAttribute("visibility","hidden");const Jt=document.createElementNS("http://www.w3.org/2000/svg","line");Jt.setAttribute("id","focusLineY"),Jt.setAttribute("class","focusLine-default"),Jt.setAttribute("fill","none"),Jt.setAttribute("stroke",l.focusLineColor),Jt.setAttribute("stroke-width","0.5px"),Jt.setAttribute("visibility","hidden");const oi=document.createElementNS("http://www.w3.org/2000/svg","circle");oi.setAttribute("id","focusCircle"),oi.setAttribute("r",4),oi.setAttribute("class","circle-default focusCircle-default"),oi.setAttribute("fill",l.focusLineColor),oi.setAttribute("visibility","hidden"),ui.appendChild(oi),ui.appendChild(si),ui.appendChild(Jt);const ri=document.createElementNS("http://www.w3.org/2000/svg","text"),ii=document.createElementNS("http://www.w3.org/2000/svg","tspan"),pi=document.createElementNS("http://www.w3.org/2000/svg","tspan"),Ci=document.createElementNS("http://www.w3.org/2000/svg","tspan");ri.setAttribute("style",`text-align:center; max-width:220px; font-size:10px; color:#000000; font-family:${l.fontFamily}; z-index:50;`),ri.style.pointerEvents="none",ri.style.position="fixed",ri.setAttribute("class","tooltipInit"),ri.setAttribute("text-anchor","middle"),te.appendChild(ri),ii.setAttribute("class","altiPathValue"),ii.setAttribute("x","0"),ii.setAttribute("dy","-.7em"),pi.setAttribute("class","altiPathValue"),pi.setAttribute("x","0"),pi.setAttribute("dy","1em"),Ci.setAttribute("class","altiPathCoords"),Ci.setAttribute("x","0"),Ci.setAttribute("dy","1em"),ri.appendChild(ii),u.currentSlope&&ri.appendChild(pi),ri.appendChild(Ci);const gi=document.createElementNS("http://www.w3.org/2000/svg","g");ui.appendChild(gi);const _i=document.createElementNS("http://www.w3.org/2000/svg","path");_i.setAttribute("cs","100,100"),_i.setAttribute("fill","#FFFFFF"),_i.setAttribute("stroke","#CCCCCC"),_i.setAttribute("fill-opacity","0.8"),_i.setAttribute("stroke-width","1"),_i.setAttribute("stroke-opacity","1");const di=document.createElementNS("http://www.w3.org/2000/svg","path");di.setAttribute("cs","100,100"),di.setAttribute("fill","#FFFFFF"),di.setAttribute("stroke","#000000"),di.setAttribute("fill-opacity","0"),di.setAttribute("stroke-width","1"),di.setAttribute("stroke-opacity","0.4"),di.setAttribute("transform","translate(1,1)"),gi.appendChild(di),gi.appendChild(_i),gi.appendChild(ri),gi.setAttribute("class","tooltipInit"),gi.style.pointerEvents="none";function xi(){si.setAttribute("visibility","visible"),Jt.setAttribute("visibility","visible"),oi.setAttribute("visibility","visible"),n.__createProfileMarker(o,h[0]),ri.classList.remove("tooltipInit"),gi.classList.remove("tooltipInit"),ri.classList.remove("tooltipFadeOut"),gi.classList.remove("tooltipFadeOut"),ri.classList.add("tooltipFadeIn"),gi.classList.add("tooltipFadeIn")}function Ei(){si.setAttribute("visibility","hidden"),Jt.setAttribute("visibility","hidden"),oi.setAttribute("visibility","hidden"),n.__removeProfileMarker(o),ri.classList.remove("tooltipFadeIn"),gi.classList.remove("tooltipFadeIn"),ri.classList.add("tooltipFadeOut"),gi.classList.add("tooltipFadeOut")}function Si(Qt){const vi=pt.createSVGPoint();vi.x=Qt.clientX,vi.y=Qt.clientY;const Pi=vi.matrixTransform(pt.getScreenCTM().inverse()),li=this._svgXToDataDist(Pi.x,tt,ut,$t)*jt,mi=Math.max(1,this._arrayBisect(hi,li)),Ii=h[mi-1],Gi=h[mi];let wi=Ii;li-Ii.dist>Gi.dist-li&&(wi=Gi);const Mi=this._dataDistToSvgX(wi.dist/jt,tt,ut,$t),Di=this._dataZToSvgY(wi.z,ht,St,Et);oi.setAttribute("cx",Mi),oi.setAttribute("cy",Di),si.setAttribute("x1",Mi),si.setAttribute("y1",ht),si.setAttribute("x2",Mi),si.setAttribute("y2",0),Jt.setAttribute("x1",it+rt),Jt.setAttribute("y1",Di),Jt.setAttribute("x2",ut+it+rt),Jt.setAttribute("y2",Di),n.__updateProfileMarker(o,wi);const Wi=`Altitude : ${wi.z.toLocaleString()} m`,Qi=`Pente : ${wi.slope} %`,zi=`(lat : ${wi.lat.toLocaleString()} / lon : ${wi.lon.toLocaleString()})`;ii.innerHTML=Wi,pi.innerHTML=Qi,Ci.innerHTML=zi;const Ti=Math.max(this._getTextWidth(zi,Ci),this._getTextWidth(Wi,ii));let ki;wi.dist>Y*jt/2?(ki=`M -0.5 -0.5 l -6 6 l 0 16 l -${Ti+10} 0 l 0 -44 l ${Ti+10} 0 l 0 16 l 6 6`,ri.setAttribute("transform",`translate(${-(Ti/2+12)},0)`)):wi.dist<=Y*jt/2&&(ki=`M -0.5 -0.5 l 6 6 l 0 16 l ${Ti+10} 0 l 0 -44 l -${Ti+10} 0 l 0 16 l -6 6`,ri.setAttribute("transform",`translate(${Ti/2+12},0)`)),_i.setAttribute("d",ki),di.setAttribute("d",ki),gi.setAttribute("transform",`translate(${Mi},${Di})`),gi.style.transform=`translate(${Mi}px,${Di}px)`}return ci.addEventListener("pointerover",xi),ci.addEventListener("pointerout",Ei),ci.addEventListener("pointermove",Si.bind(this)),ui.appendChild(ci),pt.appendChild(ui),te.appendChild(pt),e},displayProfileRaw:function(s,e,i,n){if(e){for(;e.firstChild;)e.removeChild(e.firstChild);var o=s&&s.points?s.points:{},l=document.createElement("textarea");return l.id="profilElevationResults",l.rows=10,l.cols=50,l.style.width="100%",l.innerHTML=JSON.stringify(o,void 0,4),l.addEventListener("mouseover",function(c){n.__customRawProfileMouseOverEvent(i,c)}),e.appendChild(l),e}},displayProfileLibD3:function(s,e,i,n){var o=i;if(e&&s){for(;e.firstChild;)e.removeChild(e.firstChild);var l=s.points;if(s.distance>2e3){s.unit="km";for(let ot=0;ot<l.length;ot++)l[ot].dist/=1e3}var c=o.options.displayProfileOptions,u={top:20,right:20,bottom:30,left:40},h=window.getComputedStyle(e).getPropertyValue("width"),f=window.getComputedStyle(e).getPropertyValue("height"),g=h.replace(/px/,"")-u.left-u.right,H=f.replace(/px/,"")-u.top-u.bottom,Y=d3.scale.linear().range([0,g]),ee=d3.scale.linear().range([H,0]),te=d3.svg.axis().scale(Y).orient("bottom").ticks(5),xe=d3.svg.axis().scale(ee).orient("left").ticks(5),ne=d3.svg.line().interpolate("basis").x(function(ot){return Y(ot.dist)}).y(function(ot){return ee(ot.z)}),et=d3.svg.area().interpolate("basis").x(function(ot){return Y(ot.dist)}).y0(H).y1(function(ot){return ee(ot.z)}),tt=d3.select(e).append("svg").attr("width",g+u.left+u.right).attr("height",H+u.top+u.bottom).append("g").attr("transform","translate("+u.left+","+u.top+")"),it=d3.extent(l,function(ot){return ot.dist});Y.domain(it);var rt=[0,d3.max(l,function(ot){return ot.z})];ee.domain(rt),tt.append("path").datum(l).attr("class","area-d3").attr("d",et),tt.append("g").attr("class","x axis-d3").attr("transform","translate(0,"+H+")").call(te).append("text").attr("y",-15).attr("dy",".71em").attr("x",g).text("Distance ("+s.unit+")"),tt.append("g").attr("class","y axis-d3").call(xe).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").text("Altitude (m)"),tt.append("g").attr("class","grid-d3 vertical").attr("transform","translate(0,"+H+")").call(te.orient("bottom").tickSize(-H,0,0).tickFormat("")),tt.append("g").attr("class","grid-d3 horizontal").call(xe.orient("left").tickSize(-g,0,0).tickFormat("")),tt.append("path").datum(l).attr("class","line-d3").attr("d",ne),tt.selectAll("circle").data(l).enter().append("circle").attr("cx",function(ot){return Y(ot.dist)}).attr("cy",function(ot){return ee(ot.z)}).attr("r",0).attr("class","circle-d3");var nt=tt.append("g").style("display","none");nt.append("line").attr("id","focusLineX").attr("class","focusLine-d3"),nt.append("line").attr("id","focusLineY").attr("class","focusLine-d3"),nt.append("circle").attr("id","focusCircle").attr("r",4).attr("class","circle-d3 focusCircle-d3");var st=d3.select(e).append("div").attr("class","tooltip-d3").style("opacity",0),at=d3.bisector(function(ot){return ot.dist}).left;return tt.append("rect").attr("class","overlay-d3").attr("width",g).attr("height",H).on("mouseover",function(){nt.style("display",null),n.__createProfileMarker(o,l[0])}).on("mouseout",function(){nt.style("display","none"),n.__removeProfileMarker(o),st.transition().duration(500).style("opacity",0)}).on("mousemove",function(){var ot=d3.mouse(this),ct=Y.invert(ot[0]),ht=Math.max(1,at(l,ct)),ut=l[ht-1],pt=l[ht],yt=ct-ut[0]>pt[0]-ct?pt:ut,mt=Y(yt.dist),St=ee(yt.z);nt.select("#focusCircle").attr("cx",mt).attr("cy",St),nt.select("#focusLineX").attr("x1",mt).attr("y1",ee(rt[0])).attr("x2",mt).attr("y2",ee(rt[1])),nt.select("#focusLineY").attr("x1",Y(it[0])).attr("y1",St).attr("x2",Y(it[1])).attr("y2",St),n.__updateProfileMarker(o,yt),st.transition().duration(200).style("opacity",.9);var Pt="";Pt+=" Altitude : "+yt.z+" m",c.currentSlope&&(Pt+="<br/> Pente : "+yt.slope+" %"),Pt+="<br/> (Lat : "+yt.lat+"/ Lon : "+yt.lon+")",st.html(Pt).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}),tt}},displayProfileLibAmCharts:function(s,e,i,n){var o=i;if(e&&s){var l=s.points,c="<span class='altiPathValue'>[[title]] : [[value]]m</span><br/>",u=o.options.displayProfileOptions.currentSlope;if(u&&(c+="<span class='altiPathValue'>Pente : [[slope]] %</span><br/>"),c+="<span class='altiPathCoords'>(Lat: [[lat]] / Lon:[[lon]])</span>",AmCharts.addInitHandler(function(){}),s.distance>2e3){s.unit="km";for(let Y=0;Y<l.length;Y++)l[Y].dist/=1e3}for(let Y=0;Y<l.length;Y++){var h=l[Y].dist,f=100;h>100?f=1:h>10&&(f=10),h=Math.round(h*f)/f,l[Y].dist=h}var g={type:"serial",pathToImages:"http://cdn.amcharts.com/lib/3/images/",categoryField:"dist",autoMarginOffset:0,marginRight:10,marginTop:10,startDuration:0,color:"#5E5E5E",fontSize:8,theme:"light",thousandsSeparator:"",numberFormatter:{precision:-1,decimalSeparator:",",thousandsSeparator:" "},categoryAxis:{color:"#5E5E5E",gridPosition:"start",minHorizontalGap:40,tickPosition:"start",title:"Distance ("+s.unit+")",titleColor:"#5E5E5E",labelOffset:0,startOnAxis:!0},chartCursor:{animationDuration:0,bulletsEnabled:!0,bulletSize:10,categoryBalloonEnabled:!1,cursorColor:"#F90",graphBulletAlpha:1,graphBulletSize:1,zoomable:!1},trendLines:[],graphs:[{balloonColor:"#CCCCCC",balloonText:c,bullet:"round",bulletAlpha:0,bulletBorderColor:"#FFF",bulletBorderThickness:2,bulletColor:"#F90",bulletSize:6,hidden:!1,id:"AmGraph-1",fillAlphas:.4,fillColors:"#C77A04",lineAlpha:1,lineColor:"#C77A04",lineThickness:1,title:"Altitude",valueField:"z"}],guides:[],valueAxes:[{id:"ValueAxis-1",minVerticalGap:20,title:"Altitude (m)"}],balloon:{borderColor:"#CCCCCC",borderThickness:1,fillColor:"#FFFFFF",showBullet:!0},titles:[],allLabels:[],dataProvider:l},H=AmCharts.makeChart(e,g);return H.addListener("changed",function(Y){var ee=Y.chart.dataProvider[Y.index];n.__updateProfileMarker(o,ee)}),H}}},logger$b=LoggerByDefault.getLogger("elevationpath");const Ai=class Ai extends ControlExtended{constructor(e){if(logger$b.trace("ElevationPath()"),e=e||{},super(e),!(this instanceof Ai))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="ElevationPath",this._uid=e.id||SelectorID.generate(),this._showContainer=null,this._pictoButton=null,this._panelContainer=null,this._profileContainer=null,this._waitingContainer=null,this._infoContainer=null,this._timerHdlr=null,this._drawStyleStart=null,this._drawStyleFinish=null,this._markerStyle=null,this._profile=null,this._data={},this._measureSource=null,this._measureVector=null,this._measureDraw=null,this._lastSketch=null,this._currentSketch=null,this._marker=null,this._initialize(e),this._container=this._initializeContainer(),this.element?this.element.appendChild(this._container):this.element=this._container,this}static __removeProfileMarker(e){var i=e;i._marker&&(i._measureSource.removeFeature(i._marker),i._marker=null)}static __createProfileMarker(e,i){var n=e;n._marker&&(n._measureSource.removeFeature(n._marker),n._marker=null);var o=n.getMap(),l=o.getView().getProjection(),c=transform$1([i.lon,i.lat],"EPSG:4326",l),u=n._measureSource.getFeatures()[0].getGeometry().getClosestPoint(c),h=new Point$1(u);n._marker=new Feature({geometry:h}),logger$b.trace(h),n._marker.setStyle(n._markerStyle),n._measureSource.addFeature(n._marker)}static __updateProfileMarker(e,i){var n=e;Ai.__removeProfileMarker(n),Ai.__createProfileMarker(n,i)}static __customRawProfileOperation(e,i){logger$b.log("__customRawProfileOperation");for(var n=e,o=i.points,l=n.getMap().getView().getProjection(),c=0;c<o.length;c++){var u=o[c],h=transform$1([u.lon,u.lat],"EPSG:4326",l),f=new Point$1(h);n._marker=new Feature({geometry:f}),logger$b.trace(f);var g=Ai.DEFAULT_STYLES.RESULTS,H=new CircleStyle({radius:g.imageRadius,stroke:new Stroke({color:g.imageStrokeColor,width:g.imageStrokeWidth}),fill:new Fill({color:g.imageFillColor})});n._marker.setStyle(new Style$1({image:H})),n._measureSource.addFeature(n._marker)}}static __customRawProfileMouseOverEvent(e,i){logger$b.log("__customRawProfileMouseOverEvent",e,i)}static DISPLAY_PROFILE_LIB_AMCHARTS(e,i,n){if(logger$b.trace("ElevationPath.DISPLAY_PROFILE_LIB_AMCHARTS"),typeof AmCharts>"u"){logger$b.log("Lib. AmCharts is not loaded !");return}var o=ProfileElevationPathDOM.displayProfileLibAmCharts(e,i,n,Ai);o&&(this._profile=o)}static DISPLAY_PROFILE_LIB_D3(e,i,n){if(logger$b.trace("ElevationPath.DISPLAY_PROFILE_LIB_D3"),typeof d3>"u"){logger$b.log("Lib. D3 is not loaded !");return}var o=ProfileElevationPathDOM.displayProfileLibD3(e,i,n,Ai);o&&(this._profile=o)}static DISPLAY_PROFILE_RAW(e,i,n){logger$b.trace("ElevationPath.DISPLAY_PROFILE_RAW");var o=ProfileElevationPathDOM.displayProfileRaw(e,i,n,Ai);o&&(this._profile=o)}static DISPLAY_PROFILE_BY_DEFAULT(e,i,n){logger$b.trace("ElevationPath.DISPLAY_PROFILE_BY_DEFAULT");var o=ProfileElevationPathDOM.displayProfileByDefault(e,i,n,Ai);o&&(this._profile=o)}setMap(e){if(logger$b.trace("ElevationPath::setMap"),e&&(this.options.active&&(this._profile===null&&(this._panelContainer.style.display="none"),this._initMeasureInteraction(e),this._addMeasureInteraction(e)),!this.options.target&&!this.options.position&&MeasureToolBox.add(e,this),this.options.export)){var i=Helper.assign({control:this},this.options.export);this.export=new ButtonExport(i),this.export.render();var n=this;this.export.on("button:clicked",o=>{n.dispatchEvent({type:"export:compute",content:o.content})})}super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getActive(){return logger$b.trace("ElevationPath::getActive"),this.options.active}setActive(e){logger$b.trace("ElevationPath::setActive"),this.options.active=e}getData(){return Helper.assign({type:"elevationpath"},this._data)}setData(e){this._data=e}getContainer(){return this._container}getLayer(){return this._measureVector}setLayer(e){if(!e){this._measureVector=null;return}if(!(e instanceof VectorLayer)){logger$b.log("no valid layer given for hosting drawn features.");return}e.setStyle(this._drawStyleFinish),this._measureVector=e,this._measureSource=e.getSource()}getGeoJSON(){var e=this._measureVector.getSource().getFeatures(),i=new GeoJSON({defaultStyle:this._drawStyleFinish}),n=i.writeFeatures(e,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});return n}getStyle(){return this._drawStyleFinish}clean(e){logger$b.trace("ElevationPath::clean");var i=this.getMap();this._panelContainer.style.display="none",this._pictoButton.setAttribute("aria-pressed",!1),this._removeProfile(),this._removeMeasureInteraction(i,typeof e<"u"?e:!1),this.setLayer()}init(){this._pictoButton.setAttribute("aria-pressed",!0),this._panelContainer.style.display="block",this._displayProfile(this._data),this._waitingContainer.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden"}_initialize(e){logger$b.trace("ElevationPath::_initialize : ",e),this.options={target:null,render:null,active:!1,apiKey:null,export:!1,elevationOptions:{outputFormat:"json"},layerDescription:{title:"Profil altimtrique",description:"Mon profil altimtrique"},displayProfileOptions:{totalDistance:!0,greaterSlope:!0,meanSlope:!0,ascendingElevation:!0,descendingElevation:!0,currentSlope:!0,apply:null,target:null},stylesOptions:{profile:null,draw:null,marker:null}},Helper.mergeParams(this.options,e),this.options.target=e.target||null,this.options.apiKey=e.apiKey;var i=e.displayProfileOptions||{};this.export=null;var n=i.apply;this.options.displayProfileOptions.apply=typeof n=="function"?n:Ai.DISPLAY_PROFILE_BY_DEFAULT;var o=i.target;this.options.displayProfileOptions.target=typeof o<"u"?o:null;var l=e.stylesOptions||{};this.options.stylesOptions.draw=l.draw||{},this._createStylingDraw(),this.options.stylesOptions.marker=l.marker||{},this._createStylingMarker(),this.COMPUTE_ELEVATION_EVENT="elevationpath:compute",this.DRAW_START_ELEVATION_EVENT="elevationpath:drawstart",this.DRAW_END_ELEVATION_EVENT="elevationpath:drawend"}_initializeContainer(){logger$b.trace("ElevationPath::_initializeContainer : ",this._uid);var e=this._createMainContainerElement(),i=this._pictoButton=this._createShowElevationPathPictoElement();e.appendChild(i),this.options.active&&this._pictoButton.click();var n=this._panelContainer=this._createElevationPathPanelElement(),o=this._createElevationPathPanelDivElement();n.appendChild(o);var l=this._createElevationPathPanelHeaderElement();o.appendChild(l);var c=this._createElevationPathPanelProfilElement();this._profileContainer=c.firstChild,o.appendChild(c);var u=this._waitingContainer=this._createElevationPathWaitingElement();o.appendChild(u);var h=this._infoContainer=this._createElevationPathInformationsElement();o.appendChild(h);var f=this._createDrawingButtonsPluginDiv();return o.appendChild(f),this.options.displayProfileOptions.target===null&&e.appendChild(n),e}_createStylingMarker(){logger$b.trace("ElevationPath::_createStylingMarker ");var e=Ai.DEFAULT_STYLES.MARKER;logger$b.trace("style marker",e),this.options.stylesOptions.marker instanceof ImageStyle&&(e=this.options.stylesOptions.marker),this._markerStyle=new Style$1({image:e})}_createStylingDraw(){logger$b.trace("ElevationPath::_createStylingDraw");var e=this.options.stylesOptions.draw;logger$b.trace("style start",e.start);var i={image:Measures.DEFAULT_POINTER_STYLE,stroke:Measures.DEFAULT_DRAW_START_STYLE.getStroke()};e.hasOwnProperty("pointer")&&e.pointer instanceof ImageStyle&&(i.image=e.pointer),e.hasOwnProperty("start")&&e.start instanceof Stroke&&(i.stroke=e.start),this._drawStyleStart=new Style$1(i),logger$b.trace("style finish",e.finish);var n={stroke:Measures.DEFAULT_DRAW_FINISH_STYLE.getStroke()};e.hasOwnProperty("finish")&&e.finish instanceof Stroke&&(n.stroke=e.finish),this._drawStyleFinish=new Style$1(n)}_createStylingProfile(){logger$b.trace("ElevationPath::_createStylingProfile");var e=this.options.stylesOptions.profile;logger$b.trace("style profile",e);var i=Ai.DEFAULT_STYLES.PROFILE;Object.keys(i).forEach(n=>{if(!e.hasOwnProperty(n))e[n]=i[n];else{var o=i[n];typeof o=="object"&&(Helper.mergeParams(o,e[n]),e[n]=o)}})}_initMeasureInteraction(e){logger$b.trace("ElevationPath::_initMeasureInteraction()"),e&&(this._measureSource=new VectorSource,this._measureVector=new VectorLayer({source:this._measureSource,style:this._drawStyleFinish}),this._measureVector.gpResultLayerId="measure:profil",e.addLayer(this._measureVector),e.getControls().forEach(i=>{if(i instanceof LayerSwitcher){var n=this._measureVector.gpLayerId;i._layers[n].title===n&&i.addLayer(this._measureVector,{title:this.options.layerDescription.title,description:this.options.layerDescription.description})}}))}_addMeasureInteraction(e){logger$b.trace("ElevationPath::_addMeasureInteraction()"),e&&(this._measureDraw=new Draw({source:this._measureSource,type:"LineString",style:this._drawStyleStart,stopClick:!0}),this._measureDraw.setProperties({name:"ElevationPath",source:this}),e.addInteraction(this._measureDraw),this._measureDraw.on("drawstart",i=>{logger$b.trace("drawstart",i),this._marker!==null&&(this._measureSource.removeFeature(this._marker),this._marker=null),this._lastSketch!==null&&(this._measureSource.removeFeature(this._lastSketch),this._lastSketch=null),this._currentSketch=i.feature;for(var n=this._measureSource.getFeatures(),o=0;o<n.length;o++)this._measureSource.removeFeature(n[o]);this.dispatchEvent(this.DRAW_START_ELEVATION_EVENT)}),this._measureDraw.on("drawend",i=>{logger$b.trace("drawend",i),this.dispatchEvent(this.DRAW_END_ELEVATION_EVENT),this._lastSketch=this._currentSketch,typeof this.options.elevationOptions.onSuccess>"u"&&this.options.displayProfileOptions.target===null&&(this._panelContainer.style.display="block"),this._measureDraw.setActive(!1),this._requestService()}))}_removeMeasureInteraction(e,i){logger$b.trace("ElevationPath::_removeMeasureInteraction()"),e&&(i&&this._measureVector&&(e.removeLayer(this._measureVector),this._measureVector=null),this._measureDraw&&(e.removeInteraction(this._measureDraw),this._measureDraw=null))}_getGeometry(){if(this._currentSketch===null){logger$b.warn("Current Feature undefined !?");return}for(var e=[],i=this.getMap(),n=i.getView().getProjection(),o="EPSG:4326",l=this._currentSketch.getGeometry().getCoordinates(),c=0;c<l.length;c++){var u=l[c],h=u;n!==o&&(h=transform$1(u,n,o)),e.push({lon:Math.round(h[0]*1e8)/1e8,lat:Math.round(h[1]*1e8)/1e8})}return e}_getLength(){if(this._currentSketch===null){logger$b.warn("Current Feature undefined !?");return}for(var e=0,i=this.getMap(),n=i.getView().getProjection(),o="EPSG:4326",l=this._currentSketch.getGeometry().getCoordinates(),c=0,u=l.length-1;c<u;++c){var h=transform$1(l[c],n,o),f=transform$1(l[c+1],n,o);h[0]=Math.round(h[0]*1e8)/1e8,h[1]=Math.round(h[1]*1e8)/1e8,f[0]=Math.round(f[0]*1e8)/1e8,f[1]=Math.round(f[1]*1e8)/1e8,e+=getDistance(h,f)}return e}_getSketchCoords(){if(this._currentSketch===null){logger$b.warn("Current Feature undefined !?");return}for(var e=this.getMap(),i=e.getView().getProjection(),n="EPSG:4326",o=[],l=this._currentSketch.getGeometry().getCoordinates(),c=0;c<l.length;c++){var u=transform$1(l[c],i,n);u[0]=Math.round(u[0]*1e8)/1e8,u[1]=Math.round(u[1]*1e8)/1e8,o.push(u)}return o}_requestService(){logger$b.trace("ElevationPath::_requestService");var e=this._getGeometry();if(logger$b.trace("geometry",e),!e){logger$b.warn("missing geometry !?");return}var i={};Helper.mergeParams(i,this.options.elevationOptions),Helper.mergeParams(i,{apiKey:i.apiKey||this.options.apiKey}),typeof i.ssl!="boolean"&&(typeof this.options.ssl=="boolean"?i.ssl=this.options.ssl:i.ssl=!0),Helper.mergeParams(i,{ssl:i.ssl});var n=this,o=this.options.elevationOptions.onFailure!==null&&typeof this.options.elevationOptions.onFailure=="function",l=this.options.elevationOptions.onSuccess!==null&&typeof this.options.elevationOptions.onSuccess=="function",c=function(g){logger$b.trace(g),g&&(n._panelContainer.style.display="block",n._data&&(n._data={}),n._data=n._computeElevationMeasure(g.elevations),n._displayProfile(n._data),n._waitingContainer.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden",n._waiting=!1,n._measureDraw.setActive(!0)),l&&n.options.elevationOptions.onSuccess.call(n,n.getData())},u=function(g){n._panelContainer.style.display="none",logger$b.error(g.message),n._waitingContainer.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden",n._waiting=!1,n._measureDraw.setActive(!0),o&&n.options.elevationOptions.onFailure.call(n,g)};Helper.mergeParams(i,{onSuccess:c,onFailure:u});var h=i.sampling||200,f=Math.max(50,Math.floor(this._getLength())/5);f>200?h=200:h=Math.floor(f),h>0&&Helper.mergeParams(i,{sampling:h}),Helper.mergeParams(i,{positions:e}),logger$b.trace("options du service",i),this._waitingContainer.className="GPwaitingContainer GPwaitingContainerVisible gpf-waiting gpf-waiting--visible",Gp.Services.getAltitude(i)}_computeElevationMeasure(e){logger$b.trace("ElevationPath::_computeElevationMeasure",e);var i=e,n="m",o=this._getSketchCoords();if(o){i[0].dist=0,i[0].slope=0,i[0].oldlat=i[0].lat,i[0].oldlon=i[0].lon,i[0].lat=Math.round(i[0].lat*1e5)/1e5,i[0].lon=Math.round(i[0].lon*1e5)/1e5;for(var l=0,c=0,u=0,h=0,f=0,g=0,H=[],Y=1;Y<i.length;Y++){var ee=[i[Y].lon,i[Y].lat],te=getDistance(ee,[i[Y-1].oldlon,i[Y-1].oldlat]),xe=te+f,ne=i[Y].z,et=i[Y-1].z;ne<0&&(ne=0),et<0&&(et=0);var tt=ne-et;tt<0?(l+=te,h+=tt):tt>0&&(c+=te,u+=tt),f=xe,i[Y].dist=xe,g+=tt?Math.abs(Math.round(tt/te*100)):0,i[Y].slope=tt?Math.abs(Math.round(tt/te*100)):0;var it=i[Y].slope;it>15&&it<30?i[Y].color="#005b4c":it>30&&it<45?i[Y].color="#00362d":it>45?i[Y].color="#00120f":i[Y].color="#00B798",i[Y].oldlat=i[Y].lat,i[Y].oldlon=i[Y].lon,i[Y].lat=Math.round(i[Y].lat*1e5)/1e5,i[Y].lon=Math.round(i[Y].lon*1e5)/1e5}logger$b.trace("List Distances",H);for(var rt=i[0].z,nt=i[0].z,st=i[0].slope,at=0;at<i.length;at++){var ot=i[at];ot.z<-100&&(ot.z=0),ot.z>nt&&(nt=ot.z),ot.z<rt&&(rt=ot.z),ot.slope>st&&(st=ot.slope)}return{greaterSlope:st,meanSlope:Math.round(g/i.length),distancePlus:c,distanceMinus:l,ascendingElevation:u,descendingElevation:h,altMin:rt.toLocaleString(),altMax:nt.toLocaleString(),distance:this._getLength(),unit:n,points:i}}}_displayProfile(e){logger$b.trace("ElevationPath::_displayProfile",e),this._updateInfoContainer();var i=this.options.displayProfileOptions.target;i&&i.appendChild(this._panelContainer),i=this._profileContainer;var n=this,o=this.options.displayProfileOptions.apply;o.call(this,e,i,n);var l=this.options.displayProfileOptions,c=document.getElementById("GPelevationPathPanelInfo-"+this._uid);c&&(l.totalDistance||l.greaterSlope||l.meanSlope||l.ascendingElevation||l.descendingElevation)&&(c.style.display="block"),this.dispatchEvent(this.COMPUTE_ELEVATION_EVENT)}_updateInfoContainer(){logger$b.trace("ElevationPath::_updateInfoContainer");var e=this.options.displayProfileOptions.totalDistance,i=this.options.displayProfileOptions.meanSlope,n=this.options.displayProfileOptions.greaterSlope,o=this.options.displayProfileOptions.ascendingElevation,l=this.options.displayProfileOptions.descendingElevation,c=this._infoContainer;if(c.childElementCount)for(;c.firstChild;)c.removeChild(c.firstChild);e&&this._addElevationPathInformationsItem("Distance totale",Math.round(this._data.distance).toLocaleString()+" m"),o&&this._addElevationPathInformationsItem("Dnivel positif",this._data.ascendingElevation.toLocaleString()+" m"),l&&this._addElevationPathInformationsItem("Dnivel ngatif",this._data.descendingElevation.toLocaleString()+" m"),i&&this._addElevationPathInformationsItem("Pente moyenne",this._data.meanSlope.toLocaleString()+" %"),n&&this._addElevationPathInformationsItem("Plus forte pente",this._data.greaterSlope.toLocaleString()+" %")}_removeMeasure(){if(this._lastSketch=null,this._currentSketch=null,this._measureSource){this._marker&&(this._measureSource.removeFeature(this._marker),this._marker=null);for(var e=this._measureSource.getFeatures(),i=0;i<e.length;i++)this._measureSource.removeFeature(e[i])}}_removeProfile(){if(this._profile=null,this._profileContainer)for(;this._profileContainer.firstChild;)this._profileContainer.removeChild(this._profileContainer.firstChild)}onShowElevationPathClick(e){var i=this._pictoButton.ariaPressed;i==="true"&&this.onPanelOpen();var n=this.getMap();Interactions.unset(n,{current:"ElevationPath"}),i==="true"?(this._profile===null&&(this._panelContainer.style.display="none"),this._initMeasureInteraction(n),this._addMeasureInteraction(n)):(this._panelContainer.style.display="none",e&&e.target.dataset&&e.target.dataset.removeMeasure?e.target.dataset.removeMeasure==="true"?this._removeMeasure():(this._lastSketch=null,this._currentSketch=null):this._removeMeasure(),this._removeProfile(),e&&e.target.dataset&&e.target.dataset.removeLayer?this._removeMeasureInteraction(n,e.target.dataset.removeLayer==="true"):this._removeMeasureInteraction(n,!0)),this.collapsed=i!=="true",this.dispatchEvent("change:collapsed")}onOpenElevationPathInfoClick(){var e=this._infoContainer;e.className==="GPelementVisible gpf-visible"?(clearTimeout(this._timerHdlr),e.className="GPelementHidden gpf-hidden"):e.className="GPelevationPathInformationsContainerVisible",this._timerHdlr=setTimeout(function(){e.className="GPelementHidden gpf-hidden"},4e3)}};ei(Ai,"DEFAULT_STYLES",{MARKER:new Icon({src:Marker.lightOrange,anchor:[.5,1],snapToPixel:!0}),RESULTS:{imageRadius:5,imageFillColor:"rgba(128, 128, 128, 0.2)",imageStrokeColor:"rgba(0, 0, 0, 0.7)",imageStrokeWidth:2}});let ElevationPath=Ai;Object.assign(ElevationPath.prototype,ElevationPathDOM);Object.assign(ElevationPath.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.ElevationPath=ElevationPath);var logger$a=LoggerByDefault.getLogger("layerimport");const fi=class fi extends ControlExtended{constructor(e){if(e=e||{},super(e),this.CLASSNAME="LayerImport",!(this instanceof fi))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this._initialize(e),this._container=this._initContainer(e),this.element?this.element.appendChild(this._container):this.element=this._container,this}setMap(e){if(e){var i=this;e.getLayers().on("remove",function(n){n.element.gpResultLayerId==="layerimport:MAPBOX"&&n.element.gpEditorId&&i._mapBoxPanel&&i._importPanel&&(i.cleanMapBoxResults(n.element.gpEditorId),i._mapBoxPanel.classList.replace("GPelementVisible","GPelementHidden"),i._mapBoxPanel.classList.replace("gpf-visible","gpf-hidden"))},i),this.draggable&&Draggable.dragElement(this._importPanel,this._importPanelHeader,e.getTargetElement()),this.collapsed||this._showImportButton.setAttribute("aria-pressed",!0)}super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getCollapsed(){return this.collapsed}setCollapsed(e){if(e===void 0){logger$a.error("[ERROR] LayerImport:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(e?this._panelCloseButton.click():this._showImportButton.click(),this.collapsed=e)}getStaticImportContent(){return this.contentStatic}getServiceImportContent(){return this.contentService}getName(){return this._name}getContainer(){return this._container}_initialize(e){if(this._checkInputOptions(e),this.options={collapsed:!0,draggable:!1,layerTypes:["KML","GPX","GeoJSON","WMS","WMTS","MAPBOX"],webServicesOptions:{},vectorStyleOptions:{KML:{extractStyles:!0,showPointNames:!0,defaultStyle:{}},GPX:{defaultStyle:{}},GeoJSON:{defaultStyle:{}},MapBox:{defaultStyle:{},editor:{}}}},e.vectorStyleOptions&&e.vectorStyleOptions.KML&&e.vectorStyleOptions.KML.extractStyles&&(this.options.vectorStyleOptions.KML.extractStyles=e.vectorStyleOptions.KML.extractStyles),e.vectorStyleOptions&&e.vectorStyleOptions.KML&&e.vectorStyleOptions.KML.showPointNames&&(this.options.vectorStyleOptions.KML.showPointNames=e.vectorStyleOptions.KML.showPointNames),e.vectorStyleOptions&&e.vectorStyleOptions.KML&&e.vectorStyleOptions.KML.defaultStyle?this.options.vectorStyleOptions.KML.defaultStyle=e.vectorStyleOptions.KML.defaultStyle:this.options.vectorStyleOptions.KML.defaultStyle=new Style$1({image:fi.DefaultStyles.image,stroke:fi.DefaultStyles.stroke,fill:fi.DefaultStyles.fill,text:fi.DefaultStyles.text}),e.vectorStyleOptions&&e.vectorStyleOptions.GPX&&e.vectorStyleOptions.GPX.defaultStyle?this.options.vectorStyleOptions.GPX.defaultStyle=e.vectorStyleOptions.GPX.defaultStyle:this.options.vectorStyleOptions.GPX.defaultStyle=new Style$1({image:fi.DefaultStyles.image,stroke:fi.DefaultStyles.stroke,fill:fi.DefaultStyles.fill,text:fi.DefaultStyles.text}),e.vectorStyleOptions&&e.vectorStyleOptions.GeoJSON&&e.vectorStyleOptions.GeoJSON.defaultStyle?this.options.vectorStyleOptions.GeoJSON.defaultStyle=e.vectorStyleOptions.GeoJSON.defaultStyle:this.options.vectorStyleOptions.GeoJSON.defaultStyle=new Style$1({image:fi.DefaultStyles.image,stroke:fi.DefaultStyles.stroke,fill:fi.DefaultStyles.fill,text:fi.DefaultStyles.text}),e.vectorStyleOptions&&e.vectorStyleOptions.MapBox&&e.vectorStyleOptions.MapBox.defaultStyle?this.options.vectorStyleOptions.MapBox.defaultStyle=e.vectorStyleOptions.MapBox.defaultStyle:this.options.vectorStyleOptions.MapBox.defaultStyle=new Style$1({image:fi.DefaultStyles.image,stroke:fi.DefaultStyles.stroke,fill:fi.DefaultStyles.fill,text:fi.DefaultStyles.text}),e.vectorStyleOptions&&e.vectorStyleOptions.MapBox&&e.vectorStyleOptions.MapBox.editor?this.options.vectorStyleOptions.MapBox.editor=e.vectorStyleOptions.MapBox.editor:this.options.vectorStyleOptions.MapBox.editor={title:!0,collapse:!1,themes:!1,layers:!0,style:!0,filter:!1,legend:!0,group:!1},e.vectorStyleOptions&&e.vectorStyleOptions.MapBox&&e.vectorStyleOptions.MapBox.hasOwnProperty("display")?this.options.vectorStyleOptions.MapBox.display=e.vectorStyleOptions.MapBox.display:this.options.vectorStyleOptions.MapBox.display=!0,Array.isArray(e.layerTypes)){for(var i=[],n=0;n<e.layerTypes.length;n++)i.push(e.layerTypes[n]);this.options.layerTypes=i}Helper.mergeParams(this.options,e),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this._uid=this.options.id||SelectorID.generate(),this._waiting=!1,this._timer=null,this._initImportTypes(),this._initDefaultStyles(),this._showImportButton=null,this._importPanel=null,this._panelCloseButton=null,this._importPanelHeader=null,this._importPanelTitle=null,this._importPanelReturnPicto=null,this._formContainer=null,this._staticLocalImportInput=null,this._staticUrlImportInput=null,this._serviceUrlImportInput=null,this._getCapPanel=null,this._getCapPanelHeader=null,this._getCapResultsListContainer=null,this._mapBoxPanel=null,this._mapBoxPanelHeader=null,this._mapBoxResultsListContainer=null,this._waitingContainer=null,this._loadingContainer=null,this._hasGetCapResults=!1,this._getCapRequestUrl=null,this._getCapResponseWMS=null,this._getCapResponseWMSLayers=[],this._getCapResponseWMTS=null,this._getCapResponseWMTSLayers=[],this._hasMapBoxResults=!1,this.contentStatic=null,this._url=null,this._file=null,this._name=null}_checkInputOptions(e){if(e.layerTypes){var i=e.layerTypes;if(!Array.isArray(i))logger$a.warn(`[ol.control.LayerImport] 'options.layerTypes' parameter should be an array. Set default values ["KML", "GPX", "GeoJSON", "WMS", "WMTS"]`),e.layerTypes=["KML","GPX","GeoJSON","WMS","WMTS","MAPBOX"];else{for(var n=["KML","GPX","GEOJSON","WMS","WMTS","WFS","MAPBOX"],o=[],l=0;l<i.length;l++)typeof i[l]!="string"?(o.push(l),logger$a.warn("[ol.control.LayerImport] 'options.layerTypes' elements should be of type string ("+i[l]+")")):(i[l]=i[l].toUpperCase(),n.indexOf(i[l])===-1&&(o.push(l),logger$a.log("[ol.control.LayerImport] options.layerTypes : "+i[l]+" is not a supported type")),i[l]==="GEOJSON"&&(i[l]="GeoJSON"),i[l]==="MAPBOX"&&(i[l]="MAPBOX"));if(o.length!==0)for(var c=o.length-1;c>=0;c--)i.splice(o[c],1)}}}_initDefaultStyles(){var e=this.options.vectorStyleOptions.KML.defaultStyle;this._defaultKMLStyle=new Style$1({image:e.image,stroke:e.stroke,fill:e.fill,text:e.text});var i=this.options.vectorStyleOptions.GPX.defaultStyle;this._defaultGPXStyle=new Style$1({image:i.image,stroke:i.stroke,fill:i.fill,text:i.text});var n=this.options.vectorStyleOptions.GeoJSON.defaultStyle;this._defaultGeoJSONStyle=new Style$1({image:n.image,stroke:n.stroke,fill:n.fill,text:n.text});var o=this.options.vectorStyleOptions.MapBox.defaultStyle;this._defaultMapBoxStyle=new Style$1({image:o.image,stroke:o.stroke,fill:o.fill,text:o.text})}_initImportTypes(){this._currentImportType=this.options.layerTypes[0]||"KML",this._currentImportType==="KML"||this._currentImportType==="GPX"||this._currentImportType==="GeoJSON"||this._currentImportType==="MAPBOX"?this._isCurrentImportTypeStatic=!0:(this._currentImportType==="WMS"||this._currentImportType==="WMTS"||this._currentImportType==="WFS")&&(this._isCurrentImportTypeStatic=!1),this._currentStaticImportType="local"}_initContainer(){var e=this._createMainContainerElement(),i=this._showImportButton=this._createShowImportPictoElement();e.appendChild(i);var n=this._importPanel=this._createImportPanelElement(),o=this._createImportPanelDivElement();n.appendChild(o);var l=this._importPanelHeader=this._createImportPanelHeaderElement(),c=this._importPanelReturnPicto=this._createImportPanelReturnPictoElement();l.appendChild(c);var u=this._importPanelTitle=this._createImportPanelTitleElement();l.appendChild(u);var h=this._panelCloseButton=this._createImportPanelCloseElement();l.appendChild(h),o.appendChild(l);var f=this._formContainer=this._initInputFormElement();o.appendChild(f);var g=this._getCapPanel=this._createImportGetCapPanelElement(),H=this._getCapResultsListContainer=this._createImportGetCapResultsContainer();g.appendChild(H),o.appendChild(g);var Y=this._mapBoxPanel=this._createImportMapBoxPanelElement(),ee=this._mapBoxResultsListContainer=this._createImportMapBoxResultsContainer();Y.appendChild(ee);var te=this._loadingContainer=this._createLoadingElement();Y.appendChild(te),o.appendChild(Y);var xe=this._waitingContainer=this._createImportWaitingElement();return o.appendChild(xe),e.appendChild(n),e}_initInputFormElement(){var e=this._createImportPanelFormElement(),i=this._createImportTypeLineElement(this.options.layerTypes);e.appendChild(i);var n=this._createImportStaticParamsContainer(this.options.layerTypes[0]),o=this._createStaticNameLabel();n.appendChild(o);var l=this._createStaticModeChoiceDiv(),c=this._createStaticLocalChoiceDiv();l.appendChild(c);var u=this._createStaticUrlChoiceDiv();l.appendChild(u),n.appendChild(l);var h=this._createStaticLocalInputDiv();h.appendChild(this._createStaticLocalInputLabel()),this._staticLocalImportInput=this._createStaticLocalInput(),h.appendChild(this._staticLocalImportInput),n.appendChild(h);var f=this._createStaticUrlInputDiv();f.appendChild(this._createStaticUrlInputLabel()),this._staticUrlImportInput=this._createStaticUrlInput(),f.appendChild(this._staticUrlImportInput),n.appendChild(f),e.appendChild(n);var g=this._createServiceParamsContainer(this.options.layerTypes[0]),H=this._createServiceUrlDiv();H.appendChild(this._createServiceUrlInputLabel()),this._serviceUrlImportInput=this._createServiceUrlInput(),H.appendChild(this._serviceUrlImportInput),g.appendChild(H),e.appendChild(g);var Y=this._createImportSubmitFormElement();return e.appendChild(Y),e}_onShowImportClick(e){var i=this._showImportButton.ariaPressed;i==="true"&&this.onPanelOpen();var n=this.getMap();Interactions.unset(n),this.collapsed=i!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position),this._hasMapBoxResults?(this._mapBoxPanel.classList.replace("GPelementHidden","GPelementVisible"),this._mapBoxPanel.classList.replace("gpf-hidden","gpf-visible"),this._hideFormContainer()):this._hasGetCapResults?(this._getCapPanel.classList.replace("GPelementHidden","GPelementVisible"),this._getCapPanel.classList.replace("gpf-hidden","gpf-visible"),this._hideFormContainer()):(this._getCapPanel.classList.replace("GPelementVisible","GPelementHidden"),this._getCapPanel.classList.replace("gpf-visible","gpf-hidden"),this._mapBoxPanel.classList.replace("GPelementVisible","GPelementHidden"),this._mapBoxPanel.classList.replace("gpf-visible","gpf-hidden"),this._displayFormContainer())}_onImportTypeChange(e){this._currentImportType=e.target.value,this._currentImportType==="KML"||this._currentImportType==="GPX"||this._currentImportType==="GeoJSON"||this._currentImportType==="MAPBOX"?this._isCurrentImportTypeStatic=!0:(this._currentImportType==="WMS"||this._currentImportType==="WMTS"||this._currentImportType==="WFS")&&(this._isCurrentImportTypeStatic=!1)}_onStaticImportTypeChange(e){this._currentStaticImportType=e.target.value}_onGetCapPanelClose(){(this._currentImportType==="WMS"||this._currentImportType==="WMTS"||this._currentImportType==="WFS")&&this.cleanGetCapResultsList()}_onMapBoxPanelClose(){this.cleanMapBoxResultsList(),this._loadingContainer.className="",this._importPanelReturnPicto.classList.replace("GPelementVisible","GPelementHidden"),this._importPanelReturnPicto.classList.replace("gpf-visible","gpf-hidden"),this._mapBoxPanel.classList.replace("GPelementVisible","GPelementHidden"),this._mapBoxPanel.classList.replace("gpf-visible","gpf-hidden")}_onReturnPictoClick(e){this._onGetCapPanelClose(),this._onMapBoxPanelClose(),this._loadingContainer.className=""}_onImportSubmit(){logger$a.log("import d'une couche de type : "+this._currentImportType),this.contentStatic=null,this.contentService=null,this._isCurrentImportTypeStatic?(this.setCollapsed(!0),this._importStaticLayer()):this._importServiceLayers()}_importStaticLayer(){var e,i=document.getElementById(this._addUID("GPimportName"));i&&(e=i.value||"",logger$a.log("import layer name : "+e)),this._currentStaticImportType==="local"?(logger$a.log("import static layer from local file"),this._importStaticLayerFromLocalFile(e)):this._currentStaticImportType==="url"&&(logger$a.log("import static layer from url"),this._importStaticLayerFromUrl(e))}_importStaticLayerFromUrl(e){var i=this._staticUrlImportInput.value;if(logger$a.log("url : ",i),i.length===0){logger$a.error("[ol.control.LayerImport] url parameter is mandatory");return}i.trim&&(i=i.trim()),this._url=i,e||(e=this._url.substring(this._url.lastIndexOf("/")+1,this._url.lastIndexOf("."))),this._name=e,this.options.webServicesOptions&&this.options.webServicesOptions.proxyUrl&&(i=ProxyUtils.proxifyUrl(i,this.options.webServicesOptions));var n=this;Gp.Protocols.XHR.call({url:i,method:"GET",timeOut:15e3,onResponse:function(o){n._hideWaitingContainer(),n._addFeaturesFromImportStaticLayer(o,e)},onFailure:function(o){n._hideWaitingContainer(),logger$a.error("[ol.control.LayerImport] KML/GPX/GeoJSON/MapBox request failed : ",o)}})}_importStaticLayerFromLocalFile(e){var i=this._staticLocalImportInput.files[0];if(!i){logger$a.warn("[ol.control.LayerImport] missing file");return}this._file=i,e||(e=this._file.name.substring(this._file.name.lastIndexOf("/")+1,this._file.name.lastIndexOf("."))),this._name=e;var n=new FileReader,o=this;n.onerror=l=>{o._hideWaitingContainer(),logger$a.error("error fileReader : ",l)},n.onprogress=()=>{logger$a.log("onprogress")},n.onloadstart=()=>{o._displayWaitingContainer(),logger$a.log("onloadstart")},n.onabort=()=>{o._hideWaitingContainer(),logger$a.log("onabort")},n.onloadend=l=>{logger$a.log("onloadend : ",l)},n.onload=l=>{logger$a.log("fileReader onload - file content : ",l.target.result),o._hideWaitingContainer(),o._addFeaturesFromImportStaticLayer(l.target.result,e)},n.readAsText(i)}_addFeaturesFromImportStaticLayer(e,i){var n=this.getMap();if(!(!n||!e)){var o=null,l=null,c=null,u=null;if(this.contentStatic=e,this._currentImportType==="MAPBOX"){this._hasMapBoxResults=!0;var h=this,f=JSON.parse(e);n.set("mapbox-style",f);var g=f.sources,H=Object.keys(g).length>1?1:0;for(var Y in g)if(g.hasOwnProperty(Y)){var ee="",te="",xe=null,ne=null,et=null,tt=null;if(f.metadata){for(var it in f.metadata)if(f.metadata.hasOwnProperty(it)){var rt=it.split(":");if(rt[0]==="geoportail"){var nt=rt[1];if(nt==="title"){ee=f.metadata[it];continue}if(nt==="description"){te=f.metadata[it];continue}if(nt==="quicklookUrl"){xe=f.metadata[it];continue}if(nt==="legends"){ne=f.metadata[it];continue}if(nt==="metadata"){et=f.metadata[it];continue}if(nt==="originators"){tt=f.metadata[it];continue}}}}ee||(ee="Couche MapBox"),te||(te="Couche MapBox"),ee=H?ee+"("+Y+")":ee;var st=g[Y],at=st.type;if(at==="vector"){var ot=st.url,ct=st.tiles,ht=f.sprite;if(ot&&ot.indexOf("mapbox://")===0){var ut=this._url;if(ut){if(ct=["a","b","c","d"].map(function(Dt){var $t=ot.replace("mapbox://",""),Zt=ut.split("?")[1];return"https://"+Dt+".tiles.mapbox.com/v4/"+$t+"/{z}/{x}/{y}.vector.pbf?"+Zt}),ht.indexOf("mapbox://")===0){var pt=ut.split("?");f.sprite=pt[0]+"/sprite?"+pt[1]}}else logger$a.warn("Not yet implemented, can't use the local import scheme with a 'mapbox://' in the file.!")}if(ct)c=new MVT({featureClass:Feature}),l=new VectorTile({attributions:st.attribution,format:c,urls:ct}),l._title=ee,l._description=te,l._quicklookUrl=xe,l._metadata=et,l._legends=ne,l._originators=tt,l.on("tileloadstart",function(Dt){h._loadingContainer.className="GPmapLoadingVisible"}),l.on("tileloadend",function(Dt){h._loadingContainer.className=""}),l.on("tileloaderror",function(Dt){h._loadingContainer.className=""}),o=new VectorTileLayer({source:l,visible:!1,declutter:!0}),o.id=Y,o.gpResultLayerId="layerimport:"+this._currentImportType;else if(ot){c=new MVT({featureClass:Feature}),o=new VectorTileLayer({visible:!1,declutter:!0}),o.id=Y,o.gpResultLayerId="layerimport:"+this._currentImportType;var yt=new TileJSON({url:ot}),mt=yt.on("change",function(){if(yt.getState()==="ready"){for(var Dt=yt.getTileJSON(),$t=Array.isArray(Dt.tiles)?Dt.tiles:[Dt.tiles],Zt=0;Zt<$t.length;Zt++){var Kt=$t[Zt];Kt.indexOf("http")!==0&&($t[Zt]=ot+Kt)}l=new VectorTile({attributions:yt.getAttributions()||Dt.attribution,format:c,urls:$t}),l._title=ee,l._description=te,l._quicklookUrl=xe,l._metadata=et,l._legends=ne,l._originators=tt,l.on("tileloadstart",function(qt){h._loadingContainer.className="GPmapLoadingVisible"}),l.on("tileloadend",function(qt){h._loadingContainer.className=""}),o.setSource(l),o.set("mapbox-extension",Dt.vector_layers),unByKey(mt)}})}}else if(at==="geojson"){var St=st.data;c=new GeoJSON,l=new VectorTile({attributions:st.attribution,format:c,url:St}),l._title=ee,l._description=te,l._quicklookUrl=xe,l._metadata=et,l._legends=ne,l._originators=tt,o=new VectorTileLayer({source:l,visible:!1,declutter:!0}),o.id=Y,o.gpResultLayerId="layerimport:"+this._currentImportType}else{logger$a.warn("Type MapBox format unknown !");return}var Pt=JSON.parse(JSON.stringify(f));if(H){for(var Rt=Pt.layers,Lt=0;Lt<Rt.length;Lt++){var Nt=Rt[Lt];if(Nt.source!==Y){Rt.splice(Lt,1);continue}}for(var vt in Pt.sources)Pt.sources.hasOwnProperty(vt)&&vt!==Y&&delete Pt.sources[vt]}var Et={id:Y,styles:Pt,layer:o,options:{title:i||ee,description:te,quicklookUrl:xe,metadata:et,legends:ne,originators:tt}};(function(Dt){var $t=()=>{applyStyle(Dt.layer,Dt.styles,{source:Dt.id}).then(function(){var qt=!0;Dt.layer.setVisible(qt);var Xt=1;Dt.layer.setOpacity(Xt)}).then(function(){var qt=n.getView().getProjection().getCode();n.getView()&&Dt.styles.center&&Dt.styles.center.length&&n.getView().setCenter(transform$1(Dt.styles.center,"EPSG:4326",qt)),n.getView()&&(Dt.styles.zoom||Dt.styles.zoom===0)&&n.getView().setZoom(Dt.styles.zoom);var Xt=Dt.layer.getSource();if(n.getView()&&n.getSize()){var zt=null;Xt&&Xt.getExtent?zt=Xt.getExtent():zt=Xt.getTileGrid().getExtent(),zt&&zt[0]!==1/0&&n.getView().fit(zt,n.getSize())}}).then(function(){h._hideFormContainer(),h._importPanelHeader.classList.replace("GPelementVisible","GPelementHidden"),h._importPanelHeader.classList.replace("gpf-visible","gpf-hidden"),h._importPanelTitle.innerHTML="Edition des styles";var qt=new Editor({target:h._mapBoxResultsListContainer,style:JSON.parse(JSON.stringify(Dt.styles)),scope:this,events:{"editor:onloaded":h._onLoadedMapBox,"editor:layer:onclickvisibility":h._onChangeVisibilitySourceMapBox,"editor:style:scale:onchangemin":h._onChangeScaleMinSourceMapBox,"editor:style:scale:onchangemax":h._onChangeScaleMaxSourceMapBox,"editor:legend:onchangevalue":h._onChangeLegendValueSourceMapBox,"editor:legend:onclickedition":h._onDisplayLayerSourceMapBox},tools:h.options.vectorStyleOptions.MapBox.editor});return qt.setContext("map",n),qt.setContext("layer",Dt.layer),qt.createElement().then(function(){if(qt.getLayers().length===0)throw new Error("Il n'existe pas de styles pour la source demande !?")}).then(function(){h.options.vectorStyleOptions.MapBox.display&&(h._importPanelHeader.classList.replace("GPelementHidden","GPelementVisible"),h._importPanelHeader.classList.replace("gpf-hidden","gpf-visible"),h._mapBoxPanel.classList.replace("GPelementHidden","GPelementVisible"),h._mapBoxPanel.classList.replace("gpf-hidden","gpf-visible"),h._importPanelReturnPicto.classList.replace("GPelementHidden","GPelementVisible"),h._importPanelReturnPicto.classList.replace("gpf-hidden","gpf-visible"))}).then(function(){var Xt=h._mapBoxResultsListContainer.getElementsByClassName("GPEditorMapBoxLayerTitleLabel");for(let zt=0;zt<Xt.length;zt++){const ai=Xt[zt];ai.textContent==="bckgrd"&&(ai.textContent="Couleur de remplissage")}}).then(function(){Dt.layer.set("mapbox-editor",qt.getID()),setTimeout(function(){n.dispatchEvent({id:qt.getID(),type:"editor:loaded",style:Dt.styles,layer:Dt.layer})},100)}).catch(function(Xt){throw Xt})}).then(function(){n.dispatchEvent({id:Dt.id,type:"render:success",style:Dt.styles})}).catch(function(qt){logger$a.error(qt),n.dispatchEvent({id:Dt.id,type:"render:failure",error:qt})})};logger$a.warn(Dt.layer);var Zt=n.get("mapbox-styles")||{},Kt=Dt.id;Zt[Kt]=Dt.styles,n.set("mapbox-styles",Zt),Dt.layer.set("mapbox-styles",Dt.styles),n.addLayer(Dt.layer),h.dispatchEvent({type:"layerimport:mapbox:added",name:i,data:e,layer:Dt.layer,format:h._currentImportType.toLowerCase()||"mapbox"}),Dt.layer.getSource()?$t():Dt.layer.once("change:source",$t),n.getControls().forEach(qt=>{qt instanceof LayerSwitcher&&qt.addLayer(Dt.layer,Dt.options)})})(Et)}}else{this._currentImportType==="KML"?(u=this.options.vectorStyleOptions.KML.defaultStyle,c=new KML({showPointNames:this.options.vectorStyleOptions.KML.showPointNames,extractStyles:this.options.vectorStyleOptions.KML.extractStyles,defaultStyle:[u]})):this._currentImportType==="GPX"?(u=this.options.vectorStyleOptions.GPX.defaultStyle,c=new GPX({defaultStyle:u})):this._currentImportType==="GeoJSON"&&(u=this.options.vectorStyleOptions.GeoJSON.defaultStyle,c=new GeoJSON({defaultStyle:u}));var Ct=c.readProjection(e),_t=this._getMapProjectionCode(),dt=null;dt=c.readFeatures(e,{dataProjection:Ct,featureProjection:_t}),logger$a.log("loaded features : ",dt),l=new VectorSource({features:new Collection}),l.addFeatures(dt),logger$a.trace(l),l._title=l._description=i,o=new VectorLayer({source:l,style:u}),o.gpResultLayerId="layerimport:"+this._currentImportType;var ft=c.readRootExtensions("geoportail:compute");if(ft&&Object.keys(ft).length!==0){var bt={route:{class:Route,name:"itineraire"},isocurve:{class:Isocurve,name:"isocurve"},elevationpath:{class:ElevationPath,name:"profil altimetrique"}},Gt=ft.type,Ft=ft.transport;if(Gt){var Ht=bt[Gt].name,Mt=Ft?Ht+" ("+Ft+")":Ht,It=bt[Gt].class;if(It){o.gpResultLayerId="layerimport:COMPUTE",o.set("control",Gt),o.set("name",Ht),o.set("graph",Ft),o.set("data",ft),o.set("title",Mt);var xt=new GeoJSON({defaultStyle:u}),Tt=xt.writeFeatures(dt,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});o.set("geojson",Tt),this.getMap().getControls().forEach(Dt=>{Dt instanceof It&&(Dt.setData(ft),Dt.setLayer(o),Dt.init())})}}}if(n.addLayer(o),n.getView()&&n.getSize()&&l.getExtent){var Ut=l.getExtent();Ut&&Ut[0]!==1/0&&n.getView().fit(Ut,n.getSize())}this.dispatchEvent({type:"layerimport:vector:added",name:i,data:e,layer:o,format:this._currentImportType.toLowerCase()})}}}_addFeaturesFromImportStaticLayerUrl(e,i){var n=this.getMap();if(!(!n||!e)){var o,l,c;if(this._currentImportType==="MAPBOX"?logger$a.trace("Not yet implemented !"):(this._currentImportType==="KML"?c=new KML({showPointNames:!0,extractStyles:this.options.vectorStyleOptions.KML.extractStyles,defaultStyle:[this.options.vectorStyleOptions.KML.defaultStyle]}):this._currentImportType==="GPX"?c=new GPX({defaultStyle:this.options.vectorStyleOptions.GPX.defaultStyle}):this._currentImportType==="GeoJSON"&&(c=new GeoJSON({defaultStyle:this.options.vectorStyleOptions.GeoJSON.defaultStyle})),o=new VectorSource({url:e,format:c}),this._currentImportType==="GPX"&&o.forEachFeature(function(h){h.getStyle()==null&&(logger$a.log("[ol.control.LayerImport] set default style for GPX feature"),h.setStyle(this.options.vectorStyleOptions.GPX.defaultStyle))}),this._currentImportType==="GeoJSON"&&o.forEachFeature(function(h){h.getStyle()==null&&(logger$a.log("[ol.control.LayerImport] set default style for GeoJSON feature"),h.setStyle(this.options.vectorStyleOptions.GeoJSON.defaultStyle))}),o._title=o._description=i,l=new VectorLayer({source:o})),l.gpResultLayerId="layerimport:"+this._currentImportType,n.addLayer(l),n.getView()&&n.getSize()&&o.getExtent){var u=o.getExtent();u&&u[0]!==1/0&&n.getView().fit(u,n.getSize())}this.dispatchEvent({type:"layerimport:vector:added",name:i,url:e,layer:l,format:this._currentImportType.toLowerCase()})}}_onLoadedMapBox(e){}_onChangeVisibilitySourceMapBox(e){var i=e.target.data.obj,n=e.target.srcElement,o=this.getContext("map"),l=this.getContext("layer");if(l.get("mapbox-source")===i.source&&l.get("mapbox-editor")===e.target.editorID){for(var c=l.get("mapbox-styles"),u,h=c.layers,f=0;f<h.length;f++)if(h[f].id===i.id){var g=h[f].layout;g?g.visibility=n.checked?"visible":"none":h[f].layout={visibility:n.checked?"visible":"none"},u=h[f];break}updateMapboxLayer(o,u),Promise.resolve()}}_onChangeScaleMinSourceMapBox(e){var i=e.target.data.obj,n=e.target.srcElement,o=this.getContext("map"),l=this.getContext("layer");if(l.get("mapbox-source")===i.source&&l.get("mapbox-editor")===e.target.editorID){for(var c=l.get("mapbox-styles"),u,h=c.layers,f=0;f<h.length;f++)if(h[f].id===i.id){h[f].minzoom=n.value,n.title=n.value,u=h[f];break}updateMapboxLayer(o,u),Promise.resolve()}}_onChangeScaleMaxSourceMapBox(e){var i=e.target.data.obj,n=e.target.srcElement,o=this.getContext("map"),l=this.getContext("layer");if(l.get("mapbox-source")===i.source&&l.get("mapbox-editor")===e.target.editorID){for(var c=l.get("mapbox-styles"),u,h=c.layers,f=0;f<h.length;f++)if(h[f].id===i.id){h[f].maxzoom=n.value,n.title=n.value,u=h[f];break}updateMapboxLayer(o,u),Promise.resolve()}}_onChangeLegendValueSourceMapBox(e){var i=e.target.data.obj,n=e.target.srcElement,o=this.getContext("map"),l=this.getContext("layer");if(l.get("mapbox-source")===i.source&&l.get("mapbox-editor")===e.target.editorID){for(var c=l.get("mapbox-styles"),u,h=c.layers,f=0;f<h.length;f++)if(h[f].id===i.id){var g=h[f].paint;g&&(g[n.dataset.id]=n.value),u=h[f];break}updateMapboxLayer(o,u),Promise.resolve()}}_onDisplayLayerSourceMapBox(e){var i=e.target.data.obj,n=this.getContext("layer");if(n.get("mapbox-source")===i.source&&n.get("mapbox-editor")===e.target.editorID){var o=e.target.currentTarget.parentNode.id,l=o.substring(o.indexOf("-")+1,o.indexOf("_")),c=this.getLayer(l);c.collapse()}}_importServiceLayers(){if(this._currentImportType==="WFS"){logger$a.warn("[ol.control.LayerImport] WFS layer import is not implemented yet");return}this.cleanGetCapResultsList();var e=this._getCapRequestUrl=this._serviceUrlImportInput.value;if(!e){logger$a.error("[ol.control.LayerImport] url parameter is mandatory");return}logger$a.log("url : ",e),e.trim&&(e=e.trim());var i=e.indexOf("?");i<0?e+="?SERVICE="+this._currentImportType+"&REQUEST=GetCapabilities":i===e.length-1&&(e+="SERVICE="+this._currentImportType+"&REQUEST=GetCapabilities"),this.options.webServicesOptions&&this.options.webServicesOptions.proxyUrl&&(e=ProxyUtils.proxifyUrl(e,this.options.webServicesOptions)),this._displayWaitingContainer();var n=this;Gp.Protocols.XHR.call({url:e,method:"GET",timeOut:15e3,onResponse:function(o){n._hideWaitingContainer(),n._displayGetCapResponseLayers(o)},onFailure:function(o){n._hideWaitingContainer(),logger$a.error("[ol.control.LayerImport] getCapabilities request failed : ",o)}})}_displayGetCapResponseLayers(e){var i,n,o={content:null,title:null},l;if(this._getCapResponseWMSLayers=[],this.contentService=e,this._hideFormContainer(),this._getCapPanel.classList.replace("GPelementHidden","GPelementVisible"),this._getCapPanel.classList.replace("gpf-hidden","gpf-visible"),this._importPanelTitle.innerHTML="Couches accessibles",this._importPanelReturnPicto.classList.replace("GPelementHidden","GPelementVisible"),this._importPanelReturnPicto.classList.replace("gpf-hidden","gpf-visible"),this._hasGetCapResults=!0,this._currentImportType==="WMS"){i=new WMSCapabilities;var c=this._getCapResponseWMS=i.read(e);if(logger$a.log("getCapabilities response : ",c),c&&c.Capability&&c.Capability.Layer){var u=c.Capability.Layer;if(Array.isArray(u))for(var h=0;h<u.length;h++)this._displayGetCapResponseWMSLayer(u[h]);else this._displayGetCapResponseWMSLayer(u)}}else if(this._currentImportType==="WMTS"){i=new WMTSCapabilities;var f=this._getCapResponseWMTS=i.read(e);if(logger$a.log("getCapabilities response : ",f),f&&f.Contents&&f.Contents.Layer&&(n=f.Contents.Layer,Array.isArray(n))){this._getCapResponseWMTSLayers=n;for(var g=0;g<n.length;g++)if(l=this._getWMTSLayerProjection(n[g],f),l&&typeof l=="string")if(get$3(l)||get$3(l.toUpperCase()))o={content:n[g].Title,title:n[g].Abstract||n[g].Title},this._getCapResultsListContainer&&this._addImportGetCapResultLayer(o,g,this._getCapResultsListContainer);else{logger$a.warn("[ol.control.LayerImport] wmts layer cannot be added to map : unknown projection",n[g]);continue}}}}_displayGetCapResponseWMSLayer(e,i){if(!e){logger$a.warn("[ol.control.LayerImport] _displayGetCapResponseWMSLayer : getCapabilities layer object not found");return}logger$a.log("[ol.control.LayerImport] _displayGetCapResponseWMSLayer - layerObj : ",e);var n=this._getMapProjectionCode(),o,l={content:null,title:null};if(i){var c,u,h=["CRS","Style"];for(u=0;u<h.length;u++)if(c=h[u],Array.isArray(i[c])&&i[c].length!==0)if(Array.isArray(e[c])&&e[c].length!==0)for(var f=0;f<i[c].length;f++)e[c].indexOf(i[c][f])===-1&&e[c].push(i[c][f]);else e[c]=i[c];var g=["BoundingBox","EX_GeographicBoundingBox","MaxScaleDenominator","MinScaleDenominator","Attribution","Dimension","queryable","cascaded","opaque","noSubsets","fixedWidth","fixedHeight"];for(u=0;u<g.length;u++)c=g[u],i[c]&&!e[c]&&(e[c]=i[c])}else e._isRootLayer=!0,e._container=this._getCapResultsListContainer,e.Title||(e.Title="Liste des couches");if(e.Layer){if(Array.isArray(e.Layer)){var H=e?e._container:i._container,Y=e?e.Title:i.Title;e._container=this._addImportGetCapResultListRubrique(Y,H).lastChild;for(var ee=0;ee<e.Layer.length;ee++){for(var te=!1,xe=e._container.getElementsByClassName("GPimportGetCapRubriqueTitle"),ne=0;ne<xe.length;ne++)xe[ne].title===e.Title&&(te=!0,e.Layer[ee]._container=xe[ne].parentElement);te||(e.Layer[ee]._container=this._addImportGetCapResultRubrique(e.Title,e._container).lastChild),this._displayGetCapResponseWMSLayer(e.Layer[ee],e)}}}else{var et=this._getCapResponseWMSLayers.length;if(o=this._getWMSLayerProjection(e,n),!o)logger$a.warn("[ol.control.LayerImport] wms layer cannot be added to map : unknown projection",e);else{e._projection=o,l={content:e.Title,title:e.Abstract||e.Title};var tt=e._container;tt.localName==="ul"&&(tt=tt.lastChild),this._addImportGetCapResultLayer(l,et,tt),this._getCapResponseWMSLayers[et]=e}}}_onGetCapResponseLayerClick(e){if(e.target&&e.target.id){var i=parseInt(e.target.id.substr(23),10);if(isNaN(i))return;var n;this._currentImportType==="WMS"?(n=this._getCapResponseWMSLayers[i],this._addGetCapWMSLayer(n)):this._currentImportType==="WMTS"&&(n=this._getCapResponseWMTSLayers[i],this._addGetCapWMTSLayer(n))}}_addGetCapWMSLayer(e){var i=this.getMap();if(!i){logger$a.warn("[ol.control.LayerImport] _addGetCapWMSLayer error : map is not defined");return}if(!e){logger$a.warn("[ol.control.LayerImport] _addGetCapWMSLayer error : layerInfo is not defined");return}var n=this._getMapProjectionCode(),o={},l=this._getWMSLayerGetMapUrl();if(l)o.url=l;else{var c=this._getCapRequestUrl.indexOf("?");c!==-1?o.url=this._getCapRequestUrl.substring(0,c):o.url=this._getCapRequestUrl}if(e.Url=l||o.url,o.params={},e.Name)o.params.LAYERS=e.Name;else{logger$a.warn("[ol.control.LayerImport] unable to add wms layer : mandatory layer 'name' parameter cannot be found",e);return}o.params.SERVICE="WMS",this._getCapResponseWMS.version&&(o.params.VERSION=this._getCapResponseWMS.version),e.Version=this._getCapResponseWMS.version;var u=e._projection;if(u)u!==n&&(o.projection=u);else{logger$a.warn("[ol.control.LayerImport] wms layer cannot be added to map : unknown projection");return}e.Projection=u||o.projection;var h;if(e.Style&&Array.isArray(e.Style)){var f=e.Style[0];o.params.STYLES=f.Name,f.LegendURL&&Array.isArray(f.LegendURL)&&f.LegendURL.length!==0&&(h=f.LegendURL[0].OnlineResource)}var g=new TileWMS(o);this._getWMSLayerInfoForLayerSwitcher(e,h,g);var H={};H.source=g,this._getWMSLayerMinMaxResolution(e,n,H),this._getWMSLayerExtent(e,n,H);var Y=new TileLayer(H);if(Y.setExtent(H.extent),Y.gpResultLayerId="layerimport:WMS",e.queryable&&(Y.gpGFIparams={queryable:!0},this._getCapResponseWMS&&this._getCapResponseWMS.Capability&&this._getCapResponseWMS.Capability.Request&&this._getCapResponseWMS.Capability.Request.GetFeatureInfo&&this._getCapResponseWMS.Capability.Request.GetFeatureInfo.Format&&Array.isArray(this._getCapResponseWMS.Capability.Request.GetFeatureInfo.Format)&&(Y.gpGFIparams.formats=this._getCapResponseWMS.Capability.Request.GetFeatureInfo.Format)),i.addLayer(Y),i.getView()&&i.getSize()&&Y.getExtent){var ee=Y.getExtent();ee&&ee[0]!==1/0&&i.getView().fit(ee,i.getSize())}this.dispatchEvent({type:"layerimport:service:added",name:e.Name,data:e,layer:Y,format:"wms"})}_getWMSLayerGetMapUrl(){var e;if(this._getCapResponseWMS&&this._getCapResponseWMS.Capability&&this._getCapResponseWMS.Capability.Request&&this._getCapResponseWMS.Capability.Request.GetMap){var i=this._getCapResponseWMS.Capability.Request.GetMap;if(i.DCPType&&Array.isArray(i.DCPType)&&i.DCPType.length!==0){var n=i.DCPType[0];n&&n.HTTP&&n.HTTP.Get&&(e=n.HTTP.Get.OnlineResource)}}return e}_getWMSLayerProjection(e,i){var n;if(!e||typeof e!="object"){logger$a.warn("missing layer information (from getCapabilities)");return}var o=e.CRS;if(Array.isArray(o)){if(o.includes(i))return n=i,n;var l,c;for(c=0;c<o.length;c++)if(l=o[c],l&&typeof l=="string"&&(get$3(l)||get$3(l.toUpperCase())))return n=l,n}return n}_getWMSLayerMinMaxResolution(e,i,n){var o=get$3(i).getUnits();if(o==="m")e.MinScaleDenominator&&(n.minResolution=e.MinScaleDenominator*28e-5),e.MaxScaleDenominator&&(n.maxResolution=e.MaxScaleDenominator*28e-5);else if(o==="degrees"){var l=.05039999999999999/(Math.PI*6378137);e.MinScaleDenominator&&(n.minResolution=e.MinScaleDenominator*l),e.MaxScaleDenominator&&(n.maxResolution=e.MaxScaleDenominator*l)}}_getWMSLayerExtent(e,i,n){if(!e){logger$a.warn("[ol.control.LayerImport] _getWMSLayerExtent error : layerInfo is not defined");return}var o=e.EX_GeographicBoundingBox,l=e.BoundingBox;if(o&&Array.isArray(o))i==="EPSG:4326"?n.extent=o:n.extent=transformExtent(o,"EPSG:4326",i);else if(l&&Array.isArray(l)){for(var c,u,h=0;h<l.length;h++)if(c=l[h].crs,u=l[h].extent,c){if(c===i){n.extent=u;break}else if(typeof c=="string"){var f=get$3(c)?get$3(c):get$3(c.toUpperCase());if(f){if(f.getUnits()==="degrees"&&c.toUpperCase().indexOf("EPSG")===0){var g=[u[1],u[0],u[3],u[2]];n.extent=transformExtent(g,f,i)}else n.extent=transformExtent(u,f,i);break}}}}}_getWMSLayerInfoForLayerSwitcher(e,i,n){if(e.Title?(n._title=e.Title,n._description=e.Abstract?e.Abstract:e.Title):(n._title=e.Name,n._description=e.Abstract?e.Abstract:e.Name),i&&(n._legends=[{url:i}]),e.MetadataURL&&Array.isArray(e.MetadataURL)){n._metadata=[];for(var o=0;o<e.MetadataURL.length;o++){var l=e.MetadataURL[o].OnlineResource;l&&n._metadata.push({url:l})}}if(e.Attribution){var c=e.Attribution;n._originators={},c.OnlineResource&&(n._originators.url=c.OnlineResource),c.Title&&(n._originators.name=n._originators.attribution=c.Title),c.LogoURL&&c.LogoURL.OnlineResource&&(n._originators.logo=c.LogoURL.OnlineResource)}}_addGetCapWMTSLayer(e){if(!e||!e.Identifier){logger$a.warn("[ol.control.LayerImport] layer information not found in getCapabilities response for layer ");return}var i=this.getMap();if(i){var n={};n.layer=e.Identifier,this._getCapResponseWMTS.version&&(n.version=this._getCapResponseWMTS.version),e.Version=n.version;var o=this._getWMTSLayerGetTileUrl();if(o)n.url=o;else{var l=this._getCapRequestUrl.indexOf("?");l!==-1?n.url=this._getCapRequestUrl.substring(0,l):n.url=this._getCapRequestUrl}e.Url=o||n.url;var c=this._getTMSParams(e);n.matrixSet=c.tms,n.projection=c.projCode,n.tileGrid=new WMTSTileGrid({resolutions:c.resolutions,matrixIds:c.matrixIds,origin:c.origin}),e.MatrixIds=c.matrixIds,e.Projection=n.projection,e.Resolutions=c.resolutions,e.Origin=c.origin;var u,h;if(e.Style&&Array.isArray(e.Style))for(var f,g=0;g<e.Style.length&&(f=e.Style[g],u=f.Identifier,!f.isDefault);g++)f.LegendURL&&Array.isArray(f.LegendURL)&&f.LegendURL.length!==0&&(h=f.LegendURL[0].href);u==null&&logger$a.warn("[ol.control.LayerImport] style information not found in getCapabilities response for layer "+e.Identifier),n.style=u;var H;e.Format&&Array.isArray(e.Format)&&(H=e.Format[0]),H==null&&logger$a.warn("[ol.control.LayerImport] format information not found in getCapabilities response for layer "+e.Identifier),n.format=H;var Y=new WMTS$1(n);e.Title?(Y._title=e.Title,Y._description=e.Abstract?e.Abstract:e.Title):(Y._title=e.Identifier,Y._description=e.Abstract?e.Abstract:e.Identifier),h&&(Y._legends=[{url:h}]);var ee={};ee.source=Y,ee.extent=this._getWMTSLayerExtent(e);var te;try{te=new TileLayer(ee),te.setExtent(ee.extent)}catch(ne){logger$a.warn("[ol.control.LayerImport] an error occured while trying to create ol.layer.Tile from getCapabilities information. error : ",ne);return}if(te.gpResultLayerId="layerimport:WMTS",i.addLayer(te),i.getView()&&i.getSize()&&te.getExtent){var xe=te.getExtent();xe&&xe[0]!==1/0&&i.getView().fit(xe,i.getSize())}this.dispatchEvent({type:"layerimport:service:added",name:e.Identifier,data:e,layer:te,format:"wmts"})}}_getWMTSLayerGetTileUrl(){var e;if(this._getCapResponseWMTS&&this._getCapResponseWMTS.OperationsMetadata&&this._getCapResponseWMTS.OperationsMetadata.GetTile){var i=this._getCapResponseWMTS.OperationsMetadata.GetTile;i.DCP&&i.DCP.HTTP&&i.DCP.HTTP.Get&&Array.isArray(i.DCP.HTTP.Get)&&i.DCP.HTTP.Get.length!==0&&(e=i.DCP.HTTP.Get[0].href)}return e}_getWMTSLayerProjection(e,i){var n;if(!e||typeof e!="object"){logger$a.warn("missing layer information (from getCapabilities)");return}if(!i||typeof i!="object"){logger$a.warn("missing getCapabilities response");return}if(e.TileMatrixSetLink&&Array.isArray(e.TileMatrixSetLink)){var o=e.TileMatrixSetLink[0].TileMatrixSet,l;if(i.Contents&&Array.isArray(i.Contents.TileMatrixSet)){for(var c=i.Contents.TileMatrixSet,u=0;u<c.length;u++)if(c[u].Identifier===o&&c[u].TileMatrix){var h=c[u];l=h.SupportedCRS,l&&typeof l=="string"&&(get$3(l)||get$3(l.toUpperCase()))&&(n=l);break}}}return n}_getTMSParams(e){var i={},n=[],o=[],l=[],c,u,h,f=this.getMap();if(f){if(e.TileMatrixSetLink&&Array.isArray(e.TileMatrixSetLink))if(c=e.TileMatrixSetLink[0].TileMatrixSet,this._getCapResponseWMTS.Contents&&Array.isArray(this._getCapResponseWMTS.Contents.TileMatrixSet)){for(var g=this._getCapResponseWMTS.Contents.TileMatrixSet,H=0;H<g.length;H++)if(g[H].Identifier===c&&g[H].TileMatrix){var Y=g[H],ee,te,xe,ne,et;if(Y.SupportedCRS&&(u=Y.SupportedCRS,h=get$3(u)),h&&h.getUnits&&(et=h.getUnits()),Array.isArray(Y.TileMatrix))for(var tt=0;tt<Y.TileMatrix.length;tt++)ee=Y.TileMatrix[tt],ee.Identifier!=null&&(te=parseInt(ee.Identifier,10),n.push(te)),xe=ee.ScaleDenominator,et==="degrees"?ne=xe*28e-5*180/(Math.PI*6378137):ne=xe*28e-5,o.push(ne),l=ee.TopLeftCorner;o.sort!==void 0&&o.sort(function(it,rt){return rt-it}),n.sort!==void 0&&n.sort(function(it,rt){return it-rt})}}else logger$a.warn("[ol.control.LayerImport] TileMatrixSet data not found in getCapabilities response for layer "+e.Identifier);else return;return i.tms=c,i.projCode=u,i.matrixIds=n,i.resolutions=o,i.origin=l,i}}_getWMTSLayerExtent(e){var i,n=this._getMapProjectionCode();return e.WGS84BoundingBox&&Array.isArray(e.WGS84BoundingBox)&&(i=transformExtent(e.WGS84BoundingBox,"EPSG:4326",n)),i}_getMapProjectionCode(){var e=this.getMap();if(!e||!e.getView||!e.getView().getProjection){logger$a.warn("unable to get layerimport's map");return}var i=e.getView().getProjection().getCode();return i}_displayWaitingContainer(){this._waitingContainer.className="GPwaitingContainer GPwaitingContainerVisible gpf-waiting gpf-waiting--visible",this._waiting=!0,this._timer&&(clearTimeout(this._timer),this._timer=null);var e=this;this._timer=setTimeout(function(){e._waiting===!0?e._hideWaitingContainer():e._timer&&clearTimeout(e._timer)},16e3)}_hideWaitingContainer(){this._waiting&&(this._waitingContainer.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden",this._waiting=!1,clearTimeout(this._timer),this._timer=null)}_displayFormContainer(){this._formContainer.classList.replace("GPelementHidden","GPelementVisible"),this._formContainer.classList.replace("gpf-hidden","gpf-visible"),this._importPanelTitle.innerHTML="Import de donnes"}_hideFormContainer(){this._formContainer.classList.replace("GPelementVisible","GPelementHidden"),this._formContainer.classList.replace("gpf-visible","gpf-hidden")}cleanGetCapResultsList(){if(this._hasGetCapResults=!1,this._getCapRequestUrl=null,this._getCapResponseWMS=null,this._getCapResponseWMTS=null,this._getCapResponseWMSLayers=null,this._getCapResponseWMTSLayers=null,this._getCapResultsListContainer)for(;this._getCapResultsListContainer.firstChild;)this._getCapResultsListContainer.removeChild(this._getCapResultsListContainer.firstChild)}cleanMapBoxResultsList(){if(this._hasMapBoxResults=!1,this._mapBoxResultsListContainer)for(;this._mapBoxResultsListContainer.firstChild;)this._mapBoxResultsListContainer.removeChild(this._mapBoxResultsListContainer.firstChild)}cleanMapBoxResults(e){if(this._hasMapBoxResults=!1,this._mapBoxResultsListContainer){var i=this._mapBoxResultsListContainer.childNodes;for(let n=0;n<i.length;n++){const o=i[n];o.id==="GPEditorMapBoxContainer_ID_"+e&&o.remove()}}}};ei(fi,"DefaultStyles",{image:new Icon({src:Marker.lightOrange,anchor:[25.5,38],anchorOrigin:"top-left",anchorXUnits:"pixels",anchorYUnits:"pixels"}),stroke:new Stroke({color:"rgba(0,42,80,0.8)",width:4}),fill:new Fill({color:"rgba(0, 183, 152, 0.5)"}),text:new Text({font:"16px Sans",textAlign:"left",fill:new Fill({color:"rgba(255, 255, 255, 1)"}),stroke:new Stroke({color:"rgba(0, 0, 0, 1)",width:2})})});let LayerImport=fi;Object.assign(LayerImport.prototype,LayerImportDOM);Object.assign(LayerImport.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.LayerImport=LayerImport);var logger$9=LoggerByDefault.getLogger("geoportalattribution");class GeoportalAttribution extends Attribution{constructor(e){if(e=e||{},e.collapsible=!0,e.collapsed=!0,super(e),!(this instanceof GeoportalAttribution))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this}setMap(e){if(e!=null){var i=e.getControls();i.forEach(n=>{if(!(n instanceof GeoportalAttribution)&&n){for(var o=n.element.classList,l=0;l<o.length;l++)if(o[l]==="ol-attribution"){i.remove(n);break}}}),this._updateAttributions(e),e.on("moveend",()=>{this._updateAttributions(e)}),e.getLayers().on("add",()=>{this._updateAttributions(e)}),e.getLayers().on("remove",()=>{this._updateAttributions(e)})}super.setMap(e)}_updateAttributions(e){for(var i={},n=e.getView(),o=n.calculateExtent(e.getSize()),l=n.getProjection().getCode(),c=transformExtent(o,l,"EPSG:4326"),u=[c[3],c[0],c[1],c[2]],h=n.getZoom(),f=e.getLayers().getArray(),g=0;g<f.length;g++)if(f[g].getSource)this._updateLayerAttributions(f[g],i,u,l,h);else if(f[g].getLayers){var H=f[g].getLayers();H.forEach(Y=>{Y.getSource?this._updateLayerAttributions(Y,i,u,l,h):logger$9.log("cannot find layer source in layergroup ",f[g])})}}_updateLayerAttributions(e,i,n,o,l){if(!e){logger$9.trace("layer is null !?");return}var c=e.getSource();if(!c){logger$9.trace("source is not yet loaded !");return}i||(i={});var u=[],h=e.getVisible(),f=c._originators;if(typeof f<"u"&&c.setAttributions(),f&&h){for(var g=LayerUtils.getAttributions({extent:n,crs:o,zoom:l,visibility:h,originators:f}),H=0;H<g.length;H++){var Y=g[H];i.hasOwnProperty(Y)||(u.push(Y),i[Y]=!0)}u.length!==0&&(c.setAttributions(u),this.dispatchEvent({type:"attributions:update",attributions:u}))}}}window.ol&&window.ol.control&&(window.ol.control.GeoportalAttribution=GeoportalAttribution);var MeasureLengthDOM={_addUID:function(s){var e=this._uid?s+"-"+this._uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPmeasureLength"),s.className="GPwidget gpf-widget gpf-widget-button",s},_createShowMeasureLengthPictoElement:function(){var s=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowMeasureLengthPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-length fr-btn fr-btn--tertiary",e.setAttribute("aria-label","Mesurer une distance"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowMeasureLengthClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowMeasureLengthClick(n)}),e}},logger$8=LoggerByDefault.getLogger("measurelength");class MeasureLength extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof MeasureLength))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="MeasureLength",this._uid=e.id||SelectorID.generate(),this._pictoContainer=null,this._initialize(e),this._container=this._initializeContainer(),this.element?this.element.appendChild(this._container):this.element=this._container,this}setMap(e){logger$8.trace("setMap()");var i=this.CLASSNAME;e?!this.options.target&&!this.options.position&&MeasureToolBox.add(e,this):this.clean(),this.tools[i].push({instance:e?this:null,active:!1,map:e?e.getTargetElement():null});var n=typeof window<"u"?window:typeof self<"u"?self:null;n&&(n.gpShareMeasures||(n.gpShareMeasures={}),n.gpShareMeasures[i]=this.tools[i]),super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getContainer(){return this._container}_initialize(e){logger$8.trace("call MeasureLength::_initialize() : ",e),this.options={},this.options.geodesic=typeof e.geodesic<"u"?e.geodesic:!0,this.options.unit=typeof e.unit<"u"?e.unit:null,this.options.position=typeof e.position<"u"?e.position:null,this.options.target=typeof e.target<"u"?e.target:null,this.options.render=typeof e.render<"u"?e.render:null,this.options.gutter=typeof e.gutter<"u"?e.gutter:null,this.options.layerDescription=typeof e.layerDescription<"u"?e.layerDescription:{title:"Mesures de distance",description:"Mes mesures"},this.createStylingMeasureInteraction(e.styles)}_initializeContainer(){logger$8.trace("call MeasureLength::_initializeContainer() : ",this._uid);var e=this._createMainContainerElement(),i=this._pictoContainer=this._createShowMeasureLengthPictoElement();return e.appendChild(i),e}addMeasureEvents(){logger$8.trace("call MeasureLength::addMeasureEvents()");var e=this.getMap();e.on("singleclick",i=>this.onPointerMoveHandler(i)),e.on("pointermove",i=>this.onPointerMoveHandler(i)),this.eventLayerRemove=e.getLayers().on("remove",i=>{i.element===this.measureVector&&this.clean()})}removeMeasureEvents(){logger$8.trace("call MeasureLength::removeMeasureEvents()");var e=this.getMap();e.un("singleclick",i=>this.onPointerMoveHandle(i)),e.un("pointermove",i=>this.onPointerMoveHandler(i)),this.eventLayerRemove&&unByKey(this.eventLayerRemove)}format(e){logger$8.trace("call MeasureLength::format()");var i=this.getMap(),n;if(this.options.geodesic){var o=e.getCoordinates();n=0;for(var l=i.getView().getProjection(),c=0,u=o.length-1;c<u;++c){var h=transform$1(o[c],l,"EPSG:4326"),f=transform$1(o[c+1],l,"EPSG:4326");n+=getDistance(h,f)}}else n=Math.round(e.getLength()*100)/100;var g;return this.options.unit==="km"?g=Math.round(n/1e3*100)/100+" km":this.options.unit==="m"?g=Math.round(n*100)/100+" m":n>1e3?g=Math.round(n/1e3*100)/100+" km":g=Math.round(n*100)/100+" m",g}onShowMeasureLengthClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen(),logger$8.trace("call MeasureLength::onShowMeasureLengthClick()",e),this.onShowMeasureClick(e,"LineString")}}Object.assign(MeasureLength.prototype,Measures);Object.assign(MeasureLength.prototype,MeasureLengthDOM);Object.assign(MeasureLength.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.MeasureLength=MeasureLength);var MeasureAreaDOM={_addUID:function(s){var e=this._uid?s+"-"+this._uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPmeasureArea"),s.className="GPwidget gpf-widget gpf-widget-button",s},_createShowMeasureAreaPictoElement:function(){var s=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowMeasureAreaPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-area fr-btn fr-btn--tertiary",e.setAttribute("aria-label","Mesurer une surface"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowMeasureAreaClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowMeasureAreaClick(n)}),e}},logger$7=LoggerByDefault.getLogger("measurearea");class MeasureArea extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof MeasureArea))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="MeasureArea",this._uid=e.id||SelectorID.generate(),this._pictoContainer=null,this._initialize(e),this._container=this._initializeContainer(),this.element?this.element.appendChild(this._container):this.element=this._container,this}setMap(e){logger$7.trace("setMap()");var i=this.CLASSNAME;e?!this.options.target&&!this.options.position&&MeasureToolBox.add(e,this):this.clean(),this.tools[i].push({instance:e?this:null,active:!1,map:e?e.getTargetElement():null});var n=typeof window<"u"?window:typeof self<"u"?self:null;n&&(n.gpShareMeasures||(n.gpShareMeasures={}),n.gpShareMeasures[i]=this.tools[i]),super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getContainer(){return this._container}_initialize(e){logger$7.trace("call MeasureArea::_initialize() : ",e),this.options={},this.options.geodesic=typeof e.geodesic<"u"?e.geodesic:!0,this.options.position=typeof e.position<"u"?e.position:null,this.options.target=typeof e.target<"u"?e.target:null,this.options.render=typeof e.render<"u"?e.render:null,this.options.gutter=typeof e.gutter<"u"?e.gutter:null,this.options.layerDescription=typeof e.layerDescription<"u"?e.layerDescription:{title:"Mesures de surface",description:"Mes mesures"},this.createStylingMeasureInteraction(e.styles)}_initializeContainer(){logger$7.trace("call MeasureArea::_initializeContainer() : ",this._uid);var e=this._createMainContainerElement(),i=this._pictoContainer=this._createShowMeasureAreaPictoElement();return e.appendChild(i),e}addMeasureEvents(){logger$7.trace("call MeasureArea::addMeasureEvents()");var e=this.getMap();e.on("singleclick",i=>this.onPointerMoveHandler(i)),e.on("pointermove",i=>this.onPointerMoveHandler(i)),this.eventLayerRemove=e.getLayers().on("remove",i=>{i.element===this.measureVector&&this.clean()})}removeMeasureEvents(){logger$7.trace("call MeasureArea::removeMeasureEvents()");var e=this.getMap();e.un("singleclick",i=>this.onPointerMoveHandler(i)),e.un("pointermove",i=>this.onPointerMoveHandler(i)),this.eventLayerRemove&&unByKey(this.eventLayerRemove)}format(e){logger$7.trace("call MeasureArea::format()");var i;if(this.options.geodesic){var n=e.clone(),o=n.getLinearRing(0).getCoordinates();i=Math.abs(getArea$1(new Polygon([o])))}else i=e.getArea();var l;return i>1e6?l=Math.round(i/1e6*100)/100+" km<sup>2</sup>":i>1e5?l=Math.round(i/1e6*1e3)/1e3+" km<sup>2</sup>":i>1e3?l=Math.round(i/10)*10+" m<sup>2</sup>":l=Math.round(i*100)/100+" m<sup>2</sup>",l}onShowMeasureAreaClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen(),logger$7.trace("call MeasureArea::onShowMeasureAreaClick()",e),this.onShowMeasureClick(e,"Polygon")}}Object.assign(MeasureArea.prototype,Measures);Object.assign(MeasureArea.prototype,MeasureAreaDOM);Object.assign(MeasureArea.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.MeasureArea=MeasureArea);var MeasureAzimuthDOM={_addUID:function(s){var e=this._uid?s+"-"+this._uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPmeasureAzimuth"),s.className="GPwidget gpf-widget gpf-widget-button",s},_createShowMeasureAzimuthPictoElement:function(){var s=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowMeasureAzimuthPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-azimuth fr-btn fr-btn--tertiary",e.setAttribute("aria-label","Mesurer un azimut"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowMeasureAzimuthClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowMeasureAzimuthClick(n)}),e}},logger$6=LoggerByDefault.getLogger("measureazimut");class MeasureAzimuth extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof MeasureAzimuth))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="MeasureAzimuth",this._uid=e.id||SelectorID.generate(),this._pictoContainer=null,this._initialize(e),this._container=this._initializeContainer(),this.element?this.element.appendChild(this._container):this.element=this._container,this}setMap(e){logger$6.trace("setMap()");var i=this.CLASSNAME;e?!this.options.target&&!this.options.position&&MeasureToolBox.add(e,this):this.clean(),this.tools[i].push({instance:e?this:null,active:!1,map:e?e.getTargetElement():null});var n=typeof window<"u"?window:typeof self<"u"?self:null;n&&(n.gpShareMeasures||(n.gpShareMeasures={}),n.gpShareMeasures[i]=this.tools[i]),super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}setGeodesic(e){this.options.geodesic=typeof e<"u"?e:!1}isGeodesic(){return this.options.geodesic}getContainer(){return this._container}_initialize(e){logger$6.trace("call MeasureAzimuth::_initialize() : ",e),this.options={},this.options.geodesic=typeof e.geodesic<"u"?e.geodesic:!1,this.options.position=typeof e.position<"u"?e.position:null,this.options.target=typeof e.target<"u"?e.target:null,this.options.render=typeof e.render<"u"?e.render:null,this.options.gutter=typeof e.gutter<"u"?e.gutter:null,this.options.layerDescription=typeof e.layerDescription<"u"?e.layerDescription:{title:"Mesures d'azimuth",description:"Mes mesures"},this.createStylingMeasureInteraction(e.styles)}_initializeContainer(){logger$6.trace("call MeasureAzimuth::_initializeContainer() : ",this._uid);var e=this._createMainContainerElement(),i=this._pictoContainer=this._createShowMeasureAzimuthPictoElement();return e.appendChild(i),e}addMeasureEvents(){logger$6.trace("call MeasureAzimuth::addMeasureEvents()");var e=this.getMap();e.on("singleclick",i=>this.onPointerMoveAzimutHandler(i)),e.on("pointermove",i=>this.onPointerMoveAzimutHandler(i)),this.eventLayerRemove=e.getLayers().on("remove",i=>{i.element===this.measureVector&&this.clean()})}removeMeasureEvents(){logger$6.trace("call MeasureAzimuth::removeMeasureEvents()");var e=this.getMap();e.un("singleclick",i=>this.onPointerMoveAzimutHandler(i)),e.un("pointermove",i=>this.onPointerMoveAzimutHandler(i)),this.eventLayerRemove&&unByKey(this.eventLayerRemove)}format(e){logger$6.trace("call MeasureAzimuth::format()");var i=this.getMap(),n=i.getView().getProjection(),o=transform$1(e.getFirstCoordinate(),n,"EPSG:4326"),l=transform$1(e.getLastCoordinate(),n,"EPSG:4326");if(!this.options.geodesic){var c=getDistance(o,l);if(logger$6.trace("measure between 2 points with geodesic method",c),c>500){var u=500/c;logger$6.trace("%",u),l=transform$1(e.getCoordinateAt(u),n,"EPSG:4326")}}var h=Math.PI/180,f=180/Math.PI,g=h*o[0],H=h*l[0],Y=h*o[1],ee=h*l[1],te=Math.sin(H-g)*Math.cos(ee),xe=Math.cos(Y)*Math.sin(ee)-Math.sin(Y)*Math.cos(ee)*Math.cos(H-g),ne=Math.atan2(te,xe),et=f*ne;logger$6.trace("azimut",et),et<0&&(et+=360);var tt=Math.round(et*100)/100+" ";return tt}onShowMeasureAzimuthClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen(),logger$6.trace("call MeasureAzimuth::onShowMeasureAzimuthClick()",e),this.onShowMeasureClick(e,"LineString")}onPointerMoveAzimutHandler(e){if(this.onPointerMoveHandler(e),this.sketch){var i=this.sketch.getGeometry();i.getCoordinates().length>2&&this.measureDraw.finishDrawing()}}}Object.assign(MeasureAzimuth.prototype,Measures);Object.assign(MeasureAzimuth.prototype,MeasureAzimuthDOM);Object.assign(MeasureAzimuth.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.MeasureAzimuth=MeasureAzimuth);LoggerByDefault.getLogger("zoom");class GeoportalZoom extends Zoom{constructor(e){e=e||{};var i="ol-custom-zoom";e.className=i,super(e),this.container=null,this.options=e}_createContainerPosition(e){if(this.container=e.getOverlayContainerStopEvent(),this.options.position){this.options.target=this.container;var i="position-container-"+this.options.position;if(!document.getElementById(i)){var n=document.createElement("div");n.id=i,n.classList.add("position"),n.classList.add(i),this.container.appendChild(n)}this.options.target=this.container.children[i]}}_initContainer(){this._uid=this.options.id||SelectorID.generate(),this.element.id="GPzoom-"+this._uid,this.element.classList.add("GPwidget","gpf-widget","gpf-widget-button"),this.element.classList.add(this.options.className),this.element.classList.remove("ol-zoom","ol-unselectable","ol-control");var e=this,i=this.element.childNodes;for(let o=0;o<i.length;o++){const l=i[o];if(l.classList.contains(this.options.className+"-in")){l.classList.add("GPzoomIn","GPshowOpen","GPshowAdvancedToolPicto","gpf-btn-icon-zoom-in","fr-btn","fr-btn--tertiary","gpf-btn","gpf-btn--tertiary","gpf-btn-icon"),l.id="GPzoomIn",l.innerHTML="",l.removeAttribute("title"),l.setAttribute("aria-label","Zoomer");var n=document.createElement("span");l.appendChild(n),l.addEventListener?l.addEventListener("click",function(){e.dispatchEvent("zoom:in")}):l.attachEvent&&l.attachEvent("onclick",function(){e.dispatchEvent("zoom:in")})}if(l.classList.contains(this.options.className+"-out")){l.classList.add("GPzoomOut","GPshowOpen","GPshowAdvancedToolPicto","gpf-btn-icon-zoom-out","fr-btn","fr-btn--tertiary","gpf-btn","gpf-btn--tertiary","gpf-btn-icon"),l.id="GPzoomOut",l.innerHTML="",l.removeAttribute("title"),l.setAttribute("aria-label","Dzoomer");var n=document.createElement("span");l.appendChild(n),l.addEventListener?l.addEventListener("click",function(){e.dispatchEvent("zoom:out")}):l.attachEvent&&l.attachEvent("onclick",function(){e.dispatchEvent("zoom:out")})}}this.options.position&&(this.element.style.position="unset"),this.options.gutter===!1&&this.element.classList.add("gpf-button-no-gutter")}setMap(e){if(e){this._createContainerPosition(e),this._initContainer();var i=e.getControls();i.forEach(n=>{n.element.classList.contains("ol-zoom")&&(n.element.classList.add("ol-hidden"),n.element.style.display="none")})}this.setTarget(this.options.target),super.setMap(e)}getContainer(){return this.container}}window.ol&&window.ol.control&&(window.ol.control.GeoportalZoom=GeoportalZoom);const events=["fullscreenchange","webkitfullscreenchange"],FullScreenEventType={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class FullScreen extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const i=e.label!==void 0?e.label:"";this.labelNode_=typeof i=="string"?document.createTextNode(i):i;const n=e.labelActive!==void 0?e.labelActive:"";this.labelActiveNode_=typeof n=="string"?document.createTextNode(n):n;const o=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=o,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${CLASS_UNSELECTABLE} ${CLASS_CONTROL}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const i=e.getOwnerDocument();if(isFullScreenSupported(i))if(isFullScreen(i))exitFullScreen(i);else{let n;this.source_?n=typeof this.source_=="string"?i.getElementById(this.source_):this.source_:n=e.getTargetElement(),this.keys_?requestFullScreenWithKeys(n):requestFullScreen(n)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const i=this.isInFullscreen_;this.isInFullscreen_=isFullScreen(e.getOwnerDocument()),i!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(replaceNode(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(FullScreenEventType.ENTERFULLSCREEN)):(replaceNode(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(FullScreenEventType.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,i){i?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const i=this.getMap();i&&i.removeChangeListener(MapProperty.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(MapProperty.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let n=0,o=e.length;n<o;++n)unlistenByKey(e[n]);e.length=0;const i=this.getMap();if(i){const n=i.getOwnerDocument();isFullScreenSupported(n)?this.element.classList.remove(CLASS_UNSUPPORTED):this.element.classList.add(CLASS_UNSUPPORTED);for(let o=0,l=events.length;o<l;++o)e.push(listen(n,events[o],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function isFullScreenSupported(s){const e=s.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&s.fullscreenEnabled)}function isFullScreen(s){return!!(s.webkitIsFullScreen||s.fullscreenElement)}function requestFullScreen(s){s.requestFullscreen?s.requestFullscreen():s.webkitRequestFullscreen&&s.webkitRequestFullscreen()}function requestFullScreenWithKeys(s){s.webkitRequestFullscreen?s.webkitRequestFullscreen():requestFullScreen(s)}function exitFullScreen(s){s.exitFullscreen?s.exitFullscreen():s.webkitExitFullscreen&&s.webkitExitFullscreen()}LoggerByDefault.getLogger("fullscreen");class GeoportalFullScreen extends FullScreen{constructor(e){e=e||{};var i="ol-custom-full-screen";e.className=e.className||i,e.label=e.label||"",e.labelActive=e.labelActive||"",e.activeClassName=e.activeClassName||i+"-true",e.inactiveClassName=e.inactiveClassName||i+"-false",e.tipLabel=e.tipLabel||"Basculer en mode plein cran",super(e),this.CLASSNAME="FullScreen",this.container=null,this.options=e}_createContainerPosition(e){if(this.container=e.getOverlayContainerStopEvent(),this.options.target=this.container,this.options.position){var i="position-container-"+this.options.position;if(!document.getElementById(i)){var n=document.createElement("div");n.id=i,n.classList.add("position"),n.classList.add(i),this.container.appendChild(n)}this.options.target=this.container.children[i]}}_initContainer(){this._uid=this.options.id||SelectorID.generate(),this.element.id="GPfullScreen-"+this._uid,this.element.classList.add("GPwidget","gpf-widget","gpf-widget-button"),this.element.classList.add(this.options.className),this.element.classList.remove("ol-full-screen","ol-unselectable","ol-control");var e=this.element.childNodes[0],i=document.createElement("span");e.appendChild(i),e.classList.add("GPshowOpen","GPshowAdvancedToolPicto","GPfullScreenPicto"),e.classList.add("fr-btn","fr-btn--tertiary"),e.classList.add("gpf-btn--tertiary","gpf-btn","gpf-btn-icon"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.removeAttribute("title"),e.setAttribute("aria-label",this.options.tipLabel),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o)}),this.options.position&&(this.element.style.position="unset"),this.options.gutter===!1&&this.element.classList.add("gpf-button-no-gutter")}setMap(e){if(e){this._createContainerPosition(e),this._initContainer();var i=e.getControls();i.forEach(n=>{n.element.classList.contains("ol-full-screen")&&(n.element.classList.add("ol-hidden"),n.element.style.display="none")})}this.setTarget(this.options.target),super.setMap(e)}getContainer(){return this.container}}window.ol&&window.ol.control&&(window.ol.control.GeoportalFullScreen=GeoportalFullScreen);const MAX_RATIO=.75,MIN_RATIO=.1;class OverviewMap extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const i=e.className!==void 0?e.className:"ol-overviewmap",n=e.tipLabel!==void 0?e.tipLabel:"Overview map",o=e.collapseLabel!==void 0?e.collapseLabel:"";typeof o=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o):this.collapseLabel_=o;const l=e.label!==void 0?e.label:"";typeof l=="string"?(this.label_=document.createElement("span"),this.label_.textContent=l):this.label_=l;const c=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,u=document.createElement("button");u.setAttribute("type","button"),u.title=n,u.appendChild(c),u.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const h=new Map$1({view:e.view,controls:new Collection,interactions:new Collection});this.ovmap_=h,e.layers&&e.layers.forEach(function(et){h.addLayer(et)});const f=document.createElement("div");f.className="ol-overviewmap-box",f.style.boxSizing="border-box",this.boxOverlay_=new Overlay({position:[0,0],positioning:"center-center",element:f}),this.ovmap_.addOverlay(this.boxOverlay_);const g=i+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" "+CLASS_COLLAPSED:"")+(this.collapsible_?"":" ol-uncollapsible"),H=this.element;H.className=g,H.appendChild(this.ovmapDiv_),H.appendChild(u);const Y=this.boxOverlay_,ee=this.boxOverlay_.getElement(),te=et=>({clientX:et.clientX,clientY:et.clientY}),xe=function(et){const tt=te(et),it=h.getEventCoordinate(tt);Y.setPosition(it)},ne=et=>{const tt=h.getEventCoordinateInternal(et),it=this.getMap();it.getView().setCenterInternal(tt);const rt=it.getOwnerDocument();rt.removeEventListener("pointermove",xe),rt.removeEventListener("pointerup",ne)};this.ovmapDiv_.addEventListener("pointerdown",et=>{const tt=this.getMap().getOwnerDocument();et.target===ee&&tt.addEventListener("pointermove",xe),tt.addEventListener("pointerup",ne)})}setMap(e){const i=this.getMap();if(e!==i){if(i){const n=i.getView();n&&this.unbindView_(n),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(listen(e,ObjectEventType.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const n=e.getView();n&&this.bindView_(n),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===MapProperty.VIEW){const i=e.oldValue;i&&this.unbindView_(i);const n=this.getMap().getView();this.bindView_(n)}else!this.ovmap_.isRendered()&&(e.key===MapProperty.TARGET||e.key===MapProperty.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const i=new View({projection:e.getProjection()});this.ovmap_.setView(i)}e.addChangeListener(ViewProperty.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_(),e.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())}unbindView_(e){e.removeChangeListener(ViewProperty.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),i=this.ovmap_;if(!e.isRendered()||!i.isRendered())return;const n=e.getSize(),l=e.getView().calculateExtentInternal(n);if(this.viewExtent_&&equals$1(l,this.viewExtent_))return;this.viewExtent_=l;const c=i.getSize(),h=i.getView().calculateExtentInternal(c),f=i.getPixelFromCoordinateInternal(getTopLeft(l)),g=i.getPixelFromCoordinateInternal(getBottomRight(l)),H=Math.abs(f[0]-g[0]),Y=Math.abs(f[1]-g[1]),ee=c[0],te=c[1];H<ee*MIN_RATIO||Y<te*MIN_RATIO||H>ee*MAX_RATIO||Y>te*MAX_RATIO?this.resetExtent_():containsExtent(h,l)||this.recenter_()}resetExtent_(){const e=this.getMap(),i=this.ovmap_,n=e.getSize(),l=e.getView().calculateExtentInternal(n),c=i.getView(),u=Math.log(MAX_RATIO/MIN_RATIO)/Math.LN2,h=1/(Math.pow(2,u/2)*MIN_RATIO);scaleFromCenter(l,h),c.fitInternal(fromExtent(l))}recenter_(){const e=this.getMap(),i=this.ovmap_,n=e.getView();i.getView().setCenterInternal(n.getCenterInternal())}updateBox_(){const e=this.getMap(),i=this.ovmap_;if(!e.isRendered()||!i.isRendered())return;const n=e.getSize(),o=e.getView(),l=i.getView(),c=this.rotateWithView_?0:-o.getRotation(),u=this.boxOverlay_,h=this.boxOverlay_.getElement(),f=o.getCenter(),g=o.getResolution(),H=l.getResolution(),Y=n[0]*g/H,ee=n[1]*g/H;if(u.setPosition(f),h){h.style.width=Y+"px",h.style.height=ee+"px";const te="rotate("+c+"rad)";h.style.transform=te}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=listenOnce(this.ovmap_,MapEventType.POSTRENDER,e=>{delete this.ovmapPostrenderKey_,this.updateBox_()}))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(CLASS_COLLAPSED),this.collapsed_?replaceNode(this.collapseLabel_,this.label_):replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}}LoggerByDefault.getLogger("overviewMap");class GeoportalOverviewMap extends OverviewMap{constructor(e){e=e||{};const i={name:"GEOGRAPHICALGRIDSYSTEMS.MAPS.OVERVIEW",globalConstraint:{maxScaleDenominator:27954113201435894e-8,minScaleDenominator:2.1839150938621787e6,bbox:{left:-179.5,right:179.5,top:75,bottom:-75}},params:{url:"https://data.geopf.fr/wmts",styles:"normal",version:"1.0.0",format:"image/jpeg",projection:"EPSG:3857",minScale:2.1839150938621787e6,maxScale:27954113201435894e-8,extent:{left:-179.5,right:179.5,top:75,bottom:-75},legends:[{format:"image/jpeg",url:"https://data.geopf.fr/annexes/ressources/legendes/LEGEND.jpg",minScaleDenominator:"200"}],title:"Carte Mondiale pour la mini-vue",description:"Carte Mondiale pour la mini-vue",tileMatrixSetLimits:{1:{minTileRow:"0",maxTileRow:"1",minTileCol:"0",maxTileCol:"1"},2:{minTileRow:"0",maxTileRow:"3",minTileCol:"0",maxTileCol:"3"},3:{minTileRow:"1",maxTileRow:"6",minTileCol:"0",maxTileCol:"7"},4:{minTileRow:"2",maxTileRow:"13",minTileCol:"0",maxTileCol:"15"},5:{minTileRow:"5",maxTileRow:"26",minTileCol:"0",maxTileCol:"31"},6:{minTileRow:"11",maxTileRow:"52",minTileCol:"0",maxTileCol:"63"},7:{minTileRow:"22",maxTileRow:"105",minTileCol:"0",maxTileCol:"127"},8:{minTileRow:"45",maxTileRow:"210",minTileCol:"0",maxTileCol:"255"}},TMSLink:"PM_1_8",matrixIds:["1","2","3","4","5","6","7","8"],tileMatrices:{1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}},nativeResolutions:["78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100"]}};var n="ol-overviewmap";e.className=e.className||n,e.collapseLabel=e.collapseLabel||"",e.collapsed=e.collapsed,e.collapsed===void 0&&(e.collapsed=!0),e.label=e.label||"",e.tipLabel="Carte gnrale",e.layers=e.layers||[new LayerWMTS({layer:"GEOGRAPHICALGRIDSYSTEMS.MAPS.OVERVIEW",configuration:i})],e.view=e.view||new View({minZoom:1,maxZoom:8}),super(e),this.CLASSNAME="OverviewMap",this.container=null,this.options=e}_createContainerPosition(e){if(this.container=e.getOverlayContainerStopEvent(),this.options.target=this.container,this.options.position){var i="position-container-"+this.options.position;if(!document.getElementById(i)){var n=document.createElement("div");n.id=i,n.classList.add("position"),n.classList.add(i),this.container.appendChild(n)}this.options.target=this.container.children[i]}}_initContainer(){this._uid=this.options.id||SelectorID.generate(),this.element.id="GPoverviewMap-"+this._uid,this.element.classList.add("GPwidget","gpf-widget","gpf-widget-button"),this.element.classList.remove("ol-control");var e=this.element.childNodes,i=e[1];i.id="GPshowOverviewMap-"+this._uid,i.classList.add("GPshowOpen","GPshowAdvancedToolPicto","GPshowOverviewMapPicto"),i.classList.add("gpf-btn-icon","gpf-btn--tertiary","gpf-btn-icon-overviewmap"),i.classList.add("fr-btn","fr-btn--tertiary"),i.setAttribute("tabindex","0"),i.setAttribute("aria-pressed",!this.options.collapsed),i.setAttribute("type","button"),i.removeAttribute("title"),i.setAttribute("aria-label",this.options.tipLabel);var n=this;i.addEventListener?i.addEventListener("click",function(o){var l=o.target.ariaPressed==="true";o.target.setAttribute("aria-pressed",!l),n.dispatchEvent({type:"overviewmap:toggle",status:l})}):i.attachEvent&&i.attachEvent("onclick",function(o){var l=o.target.ariaPressed==="true";o.target.setAttribute("aria-pressed",!l),n.dispatchEvent({type:"overviewmap:toggle",status:l})}),this.options.position&&(this.element.style.position="unset"),this.options.gutter===!1&&this.element.classList.add("gpf-button-no-gutter")}setMap(e){e&&(this._createContainerPosition(e),this._initContainer()),this.setTarget(this.options.target),super.setMap(e)}getContainer(){return this.container}}window.ol&&window.ol.control&&(window.ol.control.GeoportalOverviewMap=GeoportalOverviewMap);var LegendsDOM={_addUID:function(s){var e=this.uid?s+"-"+this.uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPlegends"),s.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",s},_createShowLegendsPictoElement:function(){var s=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowLegendsPicto"),e.classList.add("GPshowOpen","GPshowAdvancedToolPicto","GPshowLegendsPicto"),e.classList.add("gpf-btn","gpf-btn--tertiary","gpf-btn-icon","gpf-btn-icon-legends"),e.classList.add("fr-btn","fr-btn--tertiary"),e.setAttribute("aria-label","Afficher les lgendes"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowLegendsClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowLegendsClick(n)}),e},_createLegendsPanelElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPlegendsPanel"),s.className="GPpanel gpf-panel fr-modal",s},_createLegendsPanelDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__legends",s},_createLegendsPanelHeaderElement:function(){var s=document.createElement("div");return s.className="gpf-panel__header_legends",s},_createLegendsPanelIconElement:function(){var s=document.createElement("label");return s.className="gpf-btn-header-legends gpf-btn-icon-header-legends",s.title="Lgendes",s},_createLegendsPanelTitleElement:function(){var s=document.createElement("div");return s.className="gpf-panel__title_legends",s.innerHTML="Lgendes",s},_createLegendsPanelCloseElement:function(){var s=this,e=document.createElement("button");e.className="gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline",e.title="Fermer le panneau";var i=document.createElement("span");return i.className="GPelementHidden gpf-visible",i.innerText="Fermer",e.appendChild(i),e.addEventListener?e.addEventListener("click",function(){document.getElementById(s._addUID("GPshowLegendsPicto")).click()},!1):e.attachEvent&&e.attachEvent("onclick",function(){document.getElementById(s._addUID("GPshowLegendsPicto")).click()}),e},_createLegendElement:function(){var s=document.createElement("div");return s.className="legends-entries gpf-panel__body fr-modal__body",s},_createLegendEntry:function(s){const e=l=>{var c=function(){if(!window.DOMParser)return!1;var g=new DOMParser;try{g.parseFromString("x","text/html")}catch{return!1}return!0};if(c()){var u=new DOMParser,h=u.parseFromString(l,"text/html");return h.body}var f=document.createElement("div");return f.innerHTML=l,f};if(s&&s.legends&&s.legends.length){var i=s.legends[0].url,n=e(`
                    <div
                        id="${s.id}"
                        class="legend-entry-container gpf-panel__content fr-modal__content">
                        <label class="legend-entry-title gpf-label-legends-name fr-label">${s.title}</label>
                        <button
                            id="GPcollapseLegend_ID_${s.id}"
                            class="legend-entry-show gpf-btn gpf-btn-icon gpf-btn-icon-legends-collapse fr-btn fr-btn--tertiary gpf-btn--tertiary"
                            type="button"
                            title=""
                            tabindex="0"
                            aria-pressed="false"></button>
                        <div id="GPlegend_ID_${s.id}" class="legend-entry-image gpf-hidden">
                            <img src="${i}" alt="${s.desc}">
                        </div>
                    </div>
                `),o=n.firstChild.querySelector("button");return o&&o.addEventListener("click",l=>{var c=l.target.ariaPressed==="true";l.target.setAttribute("aria-pressed",!c);var u=document.getElementById("GPlegend_ID_"+s.id);c?u.classList.replace("gpf-visible","gpf-hidden"):u.classList.replace("gpf-hidden","gpf-visible")}),n.firstChild}}},logger$5=LoggerByDefault.getLogger("legends");class Legends extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof Legends))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="Legends",this.initialize(e),this.container=this.initContainer(),this.element?this.element.appendChild(this.container):this.element=this.container,this}setMap(e){if(e){if(this.draggable&&Draggable.dragElement(this.panelLegendsContainer,this.panelLegendsHeaderContainer,e.getTargetElement()),this.collapsed||this.buttonLegendsShow.setAttribute("aria-pressed",!0),this.auto){var i=this;e.getLayers().forEach(n=>{i.add(n)})}this.auto&&this.addEventsListeners(e)}else this.auto&&this.removeEventsListeners();super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getContainer(){return this.container}getMetaInformations(e){if(e.hasOwnProperty("name"))return{id:e.name,title:e.getTitle(),legends:e.getLegends(),metadatas:e.getMetadata(),desc:e.getDescription(),url:e.getQuicklookUrl(),partners:e.getOriginators()}}adds(e){if(e)for(let i=0;i<e.length;i++)this.add(e[i])}add(e){if(e){var i=this._createLegendEntry(this.getMetaInformations(e));if(i)return this.exist(i)?!1:(this.panelLegendsEntriesContainer.prepend(i),this.legends.push({obj:e,dom:i}),!0)}return!1}remove(e){var i=!1;if(e)for(let n=0;n<this.legends.length;n++){const o=this.legends[n];if(e.name===o.obj.name&&e.service===o.obj.service){o.dom&&this.legends[n].dom.remove(),this.legends.splice(n,1),i=!0;break}}return i}exist(e){var i=!1;for(let n=0;n<this.legends.length;n++)if(this.legends[n].dom.id===e.id){i=!0;break}return i}initialize(e){this.uid=e.id||SelectorID.generate(),this.options={collapsed:!0,draggable:!1,auto:!0,panel:!1},Helper.assign(this.options,e),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this.auto=this.options.auto,this.buttonLegendsShow=null,this.panelLegendsContainer=null,this.panelLegendsEntriesContainer=null,this.panelLegendsHeaderContainer=null,this.buttonLegendsClose=null,this.eventsListeners=[],this.legends=[]}initContainer(){var e=this._createMainContainerElement(),i=this.buttonLegendsShow=this._createShowLegendsPictoElement();e.appendChild(i);var n=this.panelLegendsContainer=this._createLegendsPanelElement(),o=this._createLegendsPanelDivElement();n.appendChild(o);var l=this.panelLegendsEntriesContainer=this._createLegendElement();if(n.appendChild(l),this.options.panel){var c=this.panelLegendsHeaderContainer=this._createLegendsPanelHeaderElement(),u=this._createLegendsPanelIconElement();c.appendChild(u);var h=this._createLegendsPanelTitleElement();c.appendChild(h);var f=this.buttonLegendsClose=this._createLegendsPanelCloseElement();c.appendChild(f),o.appendChild(c)}return e.appendChild(n),logger$5.log(e),e}addEventsListeners(e){var i=this;this.eventsListeners["layer:add"]=function(n){if(logger$5.trace(n),!i.add(n.element)){logger$5.error("Layer already added...");return}},this.eventsListeners["layer:remove"]=function(n){if(logger$5.trace(n),!i.remove(n.element)){logger$5.error("Layer already removed...");return}},this.eventsListeners["layer:change:position"]=function(n){logger$5.trace(n)},this.eventsListeners["view:change:resolution"]=function(n){logger$5.trace(n);var o=i.getMap();for(let Y=0;Y<i.legends.length;Y++){const ee=i.legends[Y];var l=i.getMetaInformations(ee.obj);if(l){var c=o.getView().getResolution()||o.getView().getResolutionForZoom(o.getZoom()),u=c*3570,h=l.legends.slice(),f=h[0];for(let te=0;te<h.length;++te){const xe=h[te];xe.minScaleDenominator||(xe.minScaleDenominator=0),(u>f.minScaleDenominator&&xe.minScaleDenominator>f.minScaleDenominator&&xe.minScaleDenominator<u||u<f.minScaleDenominator&&xe.minScaleDenominator<f.minScaleDenominator)&&(f=xe)}if(l.legends[0]!==f){l.legends=[],l.legends.push(f);var g=i._createLegendEntry(l),H=ee.dom;H.replaceWith(g),ee.dom=g}}}},e.getLayers().on("add",this.eventsListeners["layer:add"]),e.getLayers().on("remove",this.eventsListeners["layer:remove"]),e.getLayers().on("change:zIndex",this.eventsListeners["layer:change:position"]),e.getView().on("change:resolution",this.eventsListeners["view:change:resolution"])}removeEventsListeners(){var e=this.getMap();e.getLayers().un("add",this.eventsListeners["layer:add"]),e.getLayers().un("remove",this.eventsListeners["layer:remove"]),e.getLayers().un("change:zIndex",this.eventsListeners["layer:change:position"]),e.getView().un("change:resolution",this.eventsListeners["view:change:resolution"]),delete this.eventsListeners["layer:add"],delete this.eventsListeners["layer:remove"],delete this.eventsListeners["layer:change:position"],delete this.eventsListeners["view:change:resolution"]}onShowLegendsClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen(),logger$5.trace(e);var i=this.buttonLegendsShow.ariaPressed;this.collapsed=i!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position)}}Object.assign(Legends.prototype,LegendsDOM);Object.assign(Legends.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.Legends=Legends);const PM={projection:"EPSG:3857",nativeResolutions:["156543.0339280410","78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395","0.2985821417389697","0.1492910708694849","0.0746455354347424"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5590822640287179e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},19:{matrixId:"19",matrixHeight:524288,matrixWidth:524288,scaleDenominator:1066.364791924893,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},20:{matrixId:"20",matrixHeight:1048576,matrixWidth:1048576,scaleDenominator:533.1823959624465,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},21:{matrixId:"21",matrixHeight:2097152,matrixWidth:2097152,scaleDenominator:266.5911979812229,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_0_14={projection:"EPSG:3857",nativeResolutions:["156543.0339280410","78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5590822640287179e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_0_16={projection:"EPSG:3857",nativeResolutions:["156543.0339280410","78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5590822640287179e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_0_18={projection:"EPSG:3857",nativeResolutions:["156543.0339280410","78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5590822640287179e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_0_19={projection:"EPSG:3857",nativeResolutions:["156543.0339280410","78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395","0.2985821417389697"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5590822640287179e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},19:{matrixId:"19",matrixHeight:524288,matrixWidth:524288,scaleDenominator:1066.364791924893,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_0_21={projection:"EPSG:3857",nativeResolutions:["156543.0339280410","78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395","0.2985821417389697","0.1492910708694849","0.0746455354347424"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5590822640287179e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},19:{matrixId:"19",matrixHeight:524288,matrixWidth:524288,scaleDenominator:1066.364791924893,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},20:{matrixId:"20",matrixHeight:1048576,matrixWidth:1048576,scaleDenominator:533.1823959624465,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},21:{matrixId:"21",matrixHeight:2097152,matrixWidth:2097152,scaleDenominator:266.5911979812229,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_0_6={projection:"EPSG:3857",nativeResolutions:["156543.0339280410","78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5590822640287179e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_0_8={projection:"EPSG:3857",nativeResolutions:["156543.0339280410","78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5590822640287179e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_10_12={projection:"EPSG:3857",nativeResolutions:["152.8740565703525","76.43702828517624","38.21851414258813"],tileMatrices:{10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_15_18={projection:"EPSG:3857",nativeResolutions:["4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395"],tileMatrices:{15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_3_15={projection:"EPSG:3857",nativeResolutions:["19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516"],tileMatrices:{3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_4_10={projection:"EPSG:3857",nativeResolutions:["9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525"],tileMatrices:{4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_4_18={projection:"EPSG:3857",nativeResolutions:["9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395"],tileMatrices:{4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_4_19={projection:"EPSG:3857",nativeResolutions:["9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395","0.2985821417389697"],tileMatrices:{4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},19:{matrixId:"19",matrixHeight:524288,matrixWidth:524288,scaleDenominator:1066.364791924893,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_11={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_14={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_15={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_16={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_17={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_18={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_19={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395","0.2985821417389697"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},19:{matrixId:"19",matrixHeight:524288,matrixWidth:524288,scaleDenominator:1066.364791924893,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_21={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395","0.2985821417389697","0.1492910708694849","0.0746455354347424"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},19:{matrixId:"19",matrixHeight:524288,matrixWidth:524288,scaleDenominator:1066.364791924893,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},20:{matrixId:"20",matrixHeight:1048576,matrixWidth:1048576,scaleDenominator:533.1823959624465,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},21:{matrixId:"21",matrixHeight:2097152,matrixWidth:2097152,scaleDenominator:266.5911979812229,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_9={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_7_17={projection:"EPSG:3857",nativeResolutions:["1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879"],tileMatrices:{7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_7_18={projection:"EPSG:3857",nativeResolutions:["1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395"],tileMatrices:{7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_9_16={projection:"EPSG:3857",nativeResolutions:["305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758"],tileMatrices:{9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},TMS={"2154_10cm":{projection:"EPSG:2154",nativeResolutions:["209715.2","104857.6","52428.8","26214.4","13107.2","6553.6","3276.8","1638.4","819.2","409.6","204.8","102.4","51.2","25.6","12.8","6.4","3.2","1.6","0.8","0.4","0.2","0.1"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:7489828571428572e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},1:{matrixId:"1",matrixHeight:1,matrixWidth:1,scaleDenominator:3744914285714286e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},2:{matrixId:"2",matrixHeight:1,matrixWidth:1,scaleDenominator:1872457142857143e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},3:{matrixId:"3",matrixHeight:2,matrixWidth:1,scaleDenominator:9362285714285715e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},4:{matrixId:"4",matrixHeight:4,matrixWidth:1,scaleDenominator:46811428571428575e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},5:{matrixId:"5",matrixHeight:7,matrixWidth:1,scaleDenominator:23405714285714287e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},6:{matrixId:"6",matrixHeight:13,matrixWidth:2,scaleDenominator:11702857142857144e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},7:{matrixId:"7",matrixHeight:26,matrixWidth:4,scaleDenominator:5851428571428572e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},8:{matrixId:"8",matrixHeight:52,matrixWidth:7,scaleDenominator:2925714285714286e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},9:{matrixId:"9",matrixHeight:103,matrixWidth:13,scaleDenominator:1462857142857143e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},10:{matrixId:"10",matrixHeight:206,matrixWidth:25,scaleDenominator:731428.5714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},11:{matrixId:"11",matrixHeight:411,matrixWidth:50,scaleDenominator:365714.28571428574,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},12:{matrixId:"12",matrixHeight:822,matrixWidth:99,scaleDenominator:182857.14285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},13:{matrixId:"13",matrixHeight:1643,matrixWidth:197,scaleDenominator:91428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},14:{matrixId:"14",matrixHeight:3285,matrixWidth:394,scaleDenominator:45714.28571428572,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},15:{matrixId:"15",matrixHeight:6569,matrixWidth:788,scaleDenominator:22857.14285714286,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},16:{matrixId:"16",matrixHeight:13138,matrixWidth:1575,scaleDenominator:11428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},17:{matrixId:"17",matrixHeight:26276,matrixWidth:3150,scaleDenominator:5714.285714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},18:{matrixId:"18",matrixHeight:52552,matrixWidth:6300,scaleDenominator:2857.1428571428573,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},19:{matrixId:"19",matrixHeight:105102,matrixWidth:12600,scaleDenominator:1428.5714285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},20:{matrixId:"20",matrixHeight:210205,matrixWidth:25200,scaleDenominator:714.2857142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},21:{matrixId:"21",matrixHeight:420409,matrixWidth:50400,scaleDenominator:357.14285714285717,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}}}},"2154_10cm_10_20":{projection:"EPSG:2154",nativeResolutions:["204.8","102.4","51.2","25.6","12.8","6.4","3.2","1.6","0.8","0.4","0.2"],tileMatrices:{10:{matrixId:"10",matrixHeight:206,matrixWidth:25,scaleDenominator:731428.5714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},11:{matrixId:"11",matrixHeight:411,matrixWidth:50,scaleDenominator:365714.28571428574,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},12:{matrixId:"12",matrixHeight:822,matrixWidth:99,scaleDenominator:182857.14285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},13:{matrixId:"13",matrixHeight:1643,matrixWidth:197,scaleDenominator:91428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},14:{matrixId:"14",matrixHeight:3285,matrixWidth:394,scaleDenominator:45714.28571428572,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},15:{matrixId:"15",matrixHeight:6569,matrixWidth:788,scaleDenominator:22857.14285714286,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},16:{matrixId:"16",matrixHeight:13138,matrixWidth:1575,scaleDenominator:11428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},17:{matrixId:"17",matrixHeight:26276,matrixWidth:3150,scaleDenominator:5714.285714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},18:{matrixId:"18",matrixHeight:52552,matrixWidth:6300,scaleDenominator:2857.1428571428573,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},19:{matrixId:"19",matrixHeight:105102,matrixWidth:12600,scaleDenominator:1428.5714285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},20:{matrixId:"20",matrixHeight:210205,matrixWidth:25200,scaleDenominator:714.2857142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}}}},"2154_10cm_6_19":{projection:"EPSG:2154",nativeResolutions:["3276.8","1638.4","819.2","409.6","204.8","102.4","51.2","25.6","12.8","6.4","3.2","1.6","0.8","0.4"],tileMatrices:{6:{matrixId:"6",matrixHeight:13,matrixWidth:2,scaleDenominator:11702857142857144e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},7:{matrixId:"7",matrixHeight:26,matrixWidth:4,scaleDenominator:5851428571428572e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},8:{matrixId:"8",matrixHeight:52,matrixWidth:7,scaleDenominator:2925714285714286e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},9:{matrixId:"9",matrixHeight:103,matrixWidth:13,scaleDenominator:1462857142857143e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},10:{matrixId:"10",matrixHeight:206,matrixWidth:25,scaleDenominator:731428.5714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},11:{matrixId:"11",matrixHeight:411,matrixWidth:50,scaleDenominator:365714.28571428574,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},12:{matrixId:"12",matrixHeight:822,matrixWidth:99,scaleDenominator:182857.14285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},13:{matrixId:"13",matrixHeight:1643,matrixWidth:197,scaleDenominator:91428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},14:{matrixId:"14",matrixHeight:3285,matrixWidth:394,scaleDenominator:45714.28571428572,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},15:{matrixId:"15",matrixHeight:6569,matrixWidth:788,scaleDenominator:22857.14285714286,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},16:{matrixId:"16",matrixHeight:13138,matrixWidth:1575,scaleDenominator:11428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},17:{matrixId:"17",matrixHeight:26276,matrixWidth:3150,scaleDenominator:5714.285714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},18:{matrixId:"18",matrixHeight:52552,matrixWidth:6300,scaleDenominator:2857.1428571428573,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},19:{matrixId:"19",matrixHeight:105102,matrixWidth:12600,scaleDenominator:1428.5714285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}}}},"2154_10cm_6_20":{projection:"EPSG:2154",nativeResolutions:["3276.8","1638.4","819.2","409.6","204.8","102.4","51.2","25.6","12.8","6.4","3.2","1.6","0.8","0.4","0.2"],tileMatrices:{6:{matrixId:"6",matrixHeight:13,matrixWidth:2,scaleDenominator:11702857142857144e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},7:{matrixId:"7",matrixHeight:26,matrixWidth:4,scaleDenominator:5851428571428572e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},8:{matrixId:"8",matrixHeight:52,matrixWidth:7,scaleDenominator:2925714285714286e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},9:{matrixId:"9",matrixHeight:103,matrixWidth:13,scaleDenominator:1462857142857143e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},10:{matrixId:"10",matrixHeight:206,matrixWidth:25,scaleDenominator:731428.5714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},11:{matrixId:"11",matrixHeight:411,matrixWidth:50,scaleDenominator:365714.28571428574,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},12:{matrixId:"12",matrixHeight:822,matrixWidth:99,scaleDenominator:182857.14285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},13:{matrixId:"13",matrixHeight:1643,matrixWidth:197,scaleDenominator:91428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},14:{matrixId:"14",matrixHeight:3285,matrixWidth:394,scaleDenominator:45714.28571428572,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},15:{matrixId:"15",matrixHeight:6569,matrixWidth:788,scaleDenominator:22857.14285714286,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},16:{matrixId:"16",matrixHeight:13138,matrixWidth:1575,scaleDenominator:11428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},17:{matrixId:"17",matrixHeight:26276,matrixWidth:3150,scaleDenominator:5714.285714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},18:{matrixId:"18",matrixHeight:52552,matrixWidth:6300,scaleDenominator:2857.1428571428573,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},19:{matrixId:"19",matrixHeight:105102,matrixWidth:12600,scaleDenominator:1428.5714285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},20:{matrixId:"20",matrixHeight:210205,matrixWidth:25200,scaleDenominator:714.2857142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}}}},"2154_5cm":{projection:"EPSG:2154",nativeResolutions:["209715.2","104857.6","52428.8","26214.4","13107.2","6553.6","3276.8","1638.4","819.2","409.6","204.8","102.4","51.2","25.6","12.8","6.4","3.2","1.6","0.8","0.4","0.2","0.1","0.05"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:7489828571428572e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},1:{matrixId:"1",matrixHeight:1,matrixWidth:1,scaleDenominator:3744914285714286e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},2:{matrixId:"2",matrixHeight:1,matrixWidth:1,scaleDenominator:1872457142857143e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},3:{matrixId:"3",matrixHeight:2,matrixWidth:1,scaleDenominator:9362285714285715e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},4:{matrixId:"4",matrixHeight:4,matrixWidth:1,scaleDenominator:46811428571428575e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},5:{matrixId:"5",matrixHeight:7,matrixWidth:1,scaleDenominator:23405714285714287e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},6:{matrixId:"6",matrixHeight:13,matrixWidth:2,scaleDenominator:11702857142857144e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},7:{matrixId:"7",matrixHeight:26,matrixWidth:4,scaleDenominator:5851428571428572e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},8:{matrixId:"8",matrixHeight:52,matrixWidth:7,scaleDenominator:2925714285714286e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},9:{matrixId:"9",matrixHeight:103,matrixWidth:13,scaleDenominator:1462857142857143e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},10:{matrixId:"10",matrixHeight:206,matrixWidth:25,scaleDenominator:731428.5714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},11:{matrixId:"11",matrixHeight:411,matrixWidth:50,scaleDenominator:365714.28571428574,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},12:{matrixId:"12",matrixHeight:822,matrixWidth:99,scaleDenominator:182857.14285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},13:{matrixId:"13",matrixHeight:1643,matrixWidth:197,scaleDenominator:91428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},14:{matrixId:"14",matrixHeight:3285,matrixWidth:394,scaleDenominator:45714.28571428572,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},15:{matrixId:"15",matrixHeight:6569,matrixWidth:788,scaleDenominator:22857.14285714286,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},16:{matrixId:"16",matrixHeight:13138,matrixWidth:1575,scaleDenominator:11428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},17:{matrixId:"17",matrixHeight:26276,matrixWidth:3150,scaleDenominator:5714.285714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},18:{matrixId:"18",matrixHeight:52552,matrixWidth:6300,scaleDenominator:2857.1428571428573,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},19:{matrixId:"19",matrixHeight:105102,matrixWidth:12600,scaleDenominator:1428.5714285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},20:{matrixId:"20",matrixHeight:210205,matrixWidth:25200,scaleDenominator:714.2857142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},21:{matrixId:"21",matrixHeight:420409,matrixWidth:50400,scaleDenominator:357.14285714285717,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},22:{matrixId:"22",matrixHeight:840818,matrixWidth:100800,scaleDenominator:178.57142857142858,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}}}},"2154_5cm_6_22":{projection:"EPSG:2154",nativeResolutions:["3276.8","1638.4","819.2","409.6","204.8","102.4","51.2","25.6","12.8","6.4","3.2","1.6","0.8","0.4","0.2","0.1","0.05"],tileMatrices:{6:{matrixId:"6",matrixHeight:13,matrixWidth:2,scaleDenominator:11702857142857144e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},7:{matrixId:"7",matrixHeight:26,matrixWidth:4,scaleDenominator:5851428571428572e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},8:{matrixId:"8",matrixHeight:52,matrixWidth:7,scaleDenominator:2925714285714286e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},9:{matrixId:"9",matrixHeight:103,matrixWidth:13,scaleDenominator:1462857142857143e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},10:{matrixId:"10",matrixHeight:206,matrixWidth:25,scaleDenominator:731428.5714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},11:{matrixId:"11",matrixHeight:411,matrixWidth:50,scaleDenominator:365714.28571428574,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},12:{matrixId:"12",matrixHeight:822,matrixWidth:99,scaleDenominator:182857.14285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},13:{matrixId:"13",matrixHeight:1643,matrixWidth:197,scaleDenominator:91428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},14:{matrixId:"14",matrixHeight:3285,matrixWidth:394,scaleDenominator:45714.28571428572,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},15:{matrixId:"15",matrixHeight:6569,matrixWidth:788,scaleDenominator:22857.14285714286,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},16:{matrixId:"16",matrixHeight:13138,matrixWidth:1575,scaleDenominator:11428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},17:{matrixId:"17",matrixHeight:26276,matrixWidth:3150,scaleDenominator:5714.285714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},18:{matrixId:"18",matrixHeight:52552,matrixWidth:6300,scaleDenominator:2857.1428571428573,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},19:{matrixId:"19",matrixHeight:105102,matrixWidth:12600,scaleDenominator:1428.5714285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},20:{matrixId:"20",matrixHeight:210205,matrixWidth:25200,scaleDenominator:714.2857142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},21:{matrixId:"21",matrixHeight:420409,matrixWidth:50400,scaleDenominator:357.14285714285717,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},22:{matrixId:"22",matrixHeight:840818,matrixWidth:100800,scaleDenominator:178.57142857142858,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}}}},"LAMB93_2.5m":{projection:"IGNF:LAMB93",nativeResolutions:["163840","81920","40960","20480","10240","5120","2560","1280","640","320","160","80","40","20","10","5","2.5"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5851428571428572e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},1:{matrixId:"1",matrixHeight:1,matrixWidth:1,scaleDenominator:2925714285714286e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},2:{matrixId:"2",matrixHeight:2,matrixWidth:1,scaleDenominator:1462857142857143e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},3:{matrixId:"3",matrixHeight:3,matrixWidth:1,scaleDenominator:7314285714285715e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},4:{matrixId:"4",matrixHeight:5,matrixWidth:1,scaleDenominator:36571428571428575e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},5:{matrixId:"5",matrixHeight:9,matrixWidth:1,scaleDenominator:18285714285714287e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},6:{matrixId:"6",matrixHeight:17,matrixWidth:2,scaleDenominator:9142857142857144e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},7:{matrixId:"7",matrixHeight:33,matrixWidth:4,scaleDenominator:4571428571428572e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},8:{matrixId:"8",matrixHeight:66,matrixWidth:8,scaleDenominator:2285714285714286e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},9:{matrixId:"9",matrixHeight:132,matrixWidth:16,scaleDenominator:1142857142857143e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},10:{matrixId:"10",matrixHeight:263,matrixWidth:32,scaleDenominator:571428.5714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},11:{matrixId:"11",matrixHeight:526,matrixWidth:63,scaleDenominator:285714.28571428574,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},12:{matrixId:"12",matrixHeight:1051,matrixWidth:126,scaleDenominator:142857.14285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},13:{matrixId:"13",matrixHeight:2102,matrixWidth:252,scaleDenominator:71428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},14:{matrixId:"14",matrixHeight:4204,matrixWidth:504,scaleDenominator:35714.28571428572,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},15:{matrixId:"15",matrixHeight:8408,matrixWidth:1008,scaleDenominator:17857.14285714286,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},16:{matrixId:"16",matrixHeight:16816,matrixWidth:2016,scaleDenominator:8928.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}}}},"LAMB93_2.5m_3_16":{projection:"IGNF:LAMB93",nativeResolutions:["20480","10240","5120","2560","1280","640","320","160","80","40","20","10","5","2.5"],tileMatrices:{3:{matrixId:"3",matrixHeight:3,matrixWidth:1,scaleDenominator:7314285714285715e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},4:{matrixId:"4",matrixHeight:5,matrixWidth:1,scaleDenominator:36571428571428575e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},5:{matrixId:"5",matrixHeight:9,matrixWidth:1,scaleDenominator:18285714285714287e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},6:{matrixId:"6",matrixHeight:17,matrixWidth:2,scaleDenominator:9142857142857144e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},7:{matrixId:"7",matrixHeight:33,matrixWidth:4,scaleDenominator:4571428571428572e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},8:{matrixId:"8",matrixHeight:66,matrixWidth:8,scaleDenominator:2285714285714286e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},9:{matrixId:"9",matrixHeight:132,matrixWidth:16,scaleDenominator:1142857142857143e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},10:{matrixId:"10",matrixHeight:263,matrixWidth:32,scaleDenominator:571428.5714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},11:{matrixId:"11",matrixHeight:526,matrixWidth:63,scaleDenominator:285714.28571428574,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},12:{matrixId:"12",matrixHeight:1051,matrixWidth:126,scaleDenominator:142857.14285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},13:{matrixId:"13",matrixHeight:2102,matrixWidth:252,scaleDenominator:71428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},14:{matrixId:"14",matrixHeight:4204,matrixWidth:504,scaleDenominator:35714.28571428572,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},15:{matrixId:"15",matrixHeight:8408,matrixWidth:1008,scaleDenominator:17857.14285714286,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},16:{matrixId:"16",matrixHeight:16816,matrixWidth:2016,scaleDenominator:8928.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}}}},PM,PM_0_14,PM_0_16,PM_0_18,PM_0_19,PM_0_21,PM_0_6,PM_0_8,PM_10_12,PM_15_18,PM_3_15,PM_4_10,PM_4_18,PM_4_19,PM_6_11,PM_6_14,PM_6_15,PM_6_16,PM_6_17,PM_6_18,PM_6_19,PM_6_21,PM_6_9,PM_7_17,PM_7_18,PM_9_16};var LayerConfigUtils={getLayerConfig:function(s){var e={};if(s){var i=s.serviceParams.id.split(/:/)[1],n=Object.keys(s.serviceParams.serverUrl)[0];if(e.url=s.serviceParams.serverUrl[n],i!=="WFS"&&(/\/v\//.test(e.url)?e.styles=" ":e.styles=s.styles[0].name),e.version=s.serviceParams.version,e.format=s.formats&&s.formats.length?s.formats[0].name:"",e.projection=s.defaultProjection,e.minScale=s.globalConstraint?s.globalConstraint.minScaleDenominator:null,e.maxScale=s.globalConstraint?s.globalConstraint.maxScaleDenominator:null,e.extent=s.globalConstraint?s.globalConstraint.bbox:null,e.legends=s.legends,e.title=s.title,e.description=s.description,i==="WMS"&&(e.metadata=s.metadata),s.wmtsOptions){e.tileMatrixSetLimits=s.wmtsOptions.tileMatrixSetLimits;var o=s.wmtsOptions.tileMatrixSetLink;if(o){e.TMSLink=o;var l=this.getTMSConfig(o);e.matrixIds=Object.keys(l.tileMatrices),e.tileMatrices=l.tileMatrices,e.nativeResolutions=l.nativeResolutions||this.getTMSConfig("PM").nativeResolutions}}}return{params:e}},getTMSConfig:function(s){return TMS[s]}};const stringToHTML$2=s=>{var e=function(){if(!window.DOMParser)return!1;var l=new DOMParser;try{l.parseFromString("x","text/html")}catch{return!1}return!0};if(e()){var i=new DOMParser,n=i.parseFromString(s,"text/html");return n.body}var o=document.createElement("div");return o.innerHTML=s,o};var CatalogDOM={generateID:function(s){return Math.abs(Array.from(s).reduce((e,i)=>Math.imul(31,e)+i.charCodeAt(0)|0,0))},_addUID:function(s){var e=this.uid?s+"-"+this.uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPcatalog"),s.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",s},_createShowCatalogPictoElement:function(){var s=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowCatalogPicto"),e.classList.add("GPshowOpen","GPshowAdvancedToolPicto","GPshowCatalogPicto"),e.classList.add("gpf-btn","gpf-btn--tertiary","gpf-btn-icon","gpf-btn-icon-catalog"),e.classList.add("fr-btn","fr-btn--tertiary"),e.setAttribute("aria-label","Catalogue de donnes"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowCatalogClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowCatalogClick(n)}),e},_createCatalogPanelElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPcatalogPanel"),s.className="GPpanel gpf-panel fr-modal",s},_createCatalogPanelDivSizeElement:function(s){s||(s="md");var e="";switch(s){case"sm":e="fr-col-8";break;case"md":e="fr-col-10";break;case"lg":e="fr-col-12";break;case"xl":e="fr-col-14";break}var i=document.createElement("div");return i.className=e,i},_createCatalogPanelDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__body fr-modal__body",s},_createCatalogPanelContentDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__content fr-modal__content",s},_createCatalogPanelHeaderElement:function(){var s=document.createElement("div");return s.className="GPpanelHeader gpf-panel__header_catalog",s},_createCatalogPanelTitleElement:function(s){var e=document.createElement("div");return e.className="GPpanelTitle gpf-panel__title_catalog",e.innerHTML=s,e},_createCatalogPanelIconElement:function(s){var e=document.createElement("label");return e.className="gpf-btn-header-catalog gpf-btn-icon-header-catalog",e.title=s,e},_createCatalogPanelCloseElement:function(){var s=this,e=document.createElement("button");e.id=this._addUID("GPcatalogPanelClose"),e.className="GPpanelClose GPcatalogPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline",e.title="Fermer le panneau",e.addEventListener?e.addEventListener("click",function(){document.getElementById(s._addUID("GPshowCatalogPicto")).click(),s.onCloseCatalogClick()},!1):e.attachEvent&&e.attachEvent("onclick",function(){document.getElementById(s._addUID("GPshowCatalogPicto")).click(),s.onCloseCatalogClick()});var i=document.createElement("span");return i.className="GPelementHidden gpf-hidden",i.innerText="Fermer",e.appendChild(i),e},_createCatalogContentDivElement:function(){var s=stringToHTML$2('<div class="catalog-container-content" style=""></div>');return s.firstChild},_createCatalogContentTitleElement:function(s){var e=stringToHTML$2(`
        <!-- titre -->
        <div class="catalog-container-title">
            <div class="fr-title">
                <h5 style="margin:unset">${s}</h5>
            </div>
        </div>
        `);return e.firstChild},_createCatalogContentSearchGlobalElement:function(s){var e=`
        <!-- barre de recherche globale -->
        <!-- https://www.systeme-de-design.gouv.fr/composants-et-modeles/composants/barre-de-recherche -->
        <div class="catalog-container-search-global" style="padding:10px;">
            <div class="fr-search-bar" id="catalog-header-search-global" role="search" style="justify-content: center;">
                <label class="fr-label" for="catalog-input-search-global">
                    Recherche
                </label>
                <div class="input-wrapper" style="width:100%;">
                    <input class="fr-input" placeholder="${s}" type="text" id="catalog-input-search-global" name="search-input" incremental>
                    <button type="button" id="catalog-button-reset-search-global" class="clear-btn" aria-label="Effacer le texte">
                        <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-opacity="0.8"/>
                            <line x1="6" y1="6" x2="14" y2="14"/>
                            <line x1="14" y1="6" x2="6" y2="14"/>
                        </svg>
                    </button>
                </div>
                <button id="catalog-button-search-global" class="fr-btn" title="${s}">
                    Rechercher
                </button>
            </div>
        </div>
        `,i=stringToHTML$2(e);const n=i.attachShadow({mode:"open"});n.innerHTML=e.trim();var o=n.getElementById("catalog-button-search-global");o&&o.addEventListener("click",u=>{u.target.value=c.value,this.onSearchGlobalCatalogButtonClick(u)});var l=n.getElementById("catalog-button-reset-search-global");l&&l.addEventListener("click",u=>{c.value="",this.onSearchGlobalCatalogButtonResetClick(u)});var c=n.getElementById("catalog-input-search-global");return c&&c.addEventListener("input",u=>{u.target.value.length<3&&u.target.value.length>0||this.onSearchGlobalCatalogInputChange(u)}),n},_createCatalogWaitingElement:function(){var s=document.createElement("div");s.id=this._addUID("GPcatalogCalcWaitingContainer"),s.className="GPwaitingContainerHidden gpf-waiting--hidden";var e=document.createElement("p");return e.className="GPwaitingContainerInfo gpf-waiting_info",e.innerHTML="Recherche en cours...",s.appendChild(e),s},_createCatalogContentCategoriesTabs:function(s,e){var i="",n=(ot,ct,ht,ut)=>{var pt="GPtabButton fr-tabs__tab",yt="false",mt=-1;return ut&&(pt="GPtabButton GPtabButtonActive fr-tabs__tab",yt="true",mt=0),`
            <li class="GPtabList" role="presentation">
                <button 
                    id="tabbutton-${ot}_${ct}" 
                    class="${pt}" 
                    data-category="${ct}"
                    tabindex="${mt}" 
                    role="tabbutton" 
                    aria-selected="${yt}" 
                    aria-controls="tabpanel-${ot}-panel_${ct}">
                    ${ht}
                </button>
            </li>
            `},o=(ot,ct)=>{var ht="gpf-hidden";return ot&&(ht="fr-tabs__panel--selected"),`
            <!-- barre de recherche spcifique  la catgorie -->
            <div id="catalog-container-search-specific" class="fr-tabs__list ${ht}" style="padding:10px;justify-content:center;">
                <div class="fr-search-bar" id="catalog-header-search-specific" role="search" style="width:100%;">
                    <label class="fr-label" for="catalog-input-search-specific">
                        Recherche dans la catgorie
                    </label>
                    <div class="input-wrapper" style="width:100%">
                        <input class="fr-input" placeholder="${ct}" type="text" id="catalog-input-search-specific" name="search-input-specific" incremental>
                        <button type="button" id="catalog-button-reset-search-specific" class="clear-btn" aria-label="Effacer le texte">
                            <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-opacity="0.8"/>
                                <line x1="6" y1="6" x2="14" y2="14"/>
                                <line x1="14" y1="6" x2="6" y2="14"/>
                            </svg>
                        </button>
                    </div>
                    <button id="catalog-button-search-specific" class="fr-btn" title="${ct}">
                        Rechercher
                    </button>
                </div>
            </div>
            `},l=(ot,ct)=>{var ht=ct.default?"checked":"";return`
            <div class="fr-fieldset__element fr-fieldset__element--inline">
                <div class="fr-radio-group fr-radio-group--sm">
                    <input 
                        type="radio" 
                        ${ht} 
                        id="radio-inline_${ct.id}" 
                        data-category="${ct.id}"
                        name="radio-inline-${ot}" 
                        role="radio-inline-section"
                        aria-controls="tabcontent-${ct.id}">
                    <label class="fr-label" for="radio-inline_${ct.id}">
                        ${ct.title}
                    </label>
                </div>
            </div>
            `},c=(ot,ct)=>{var ht="",ut="";for(let yt=0;yt<ct.length;yt++){const mt=ct[yt];ut+=l(ot,mt);var pt="";mt.default||(pt="GPelementHidden gpf-hidden"),ht+=`<div class="tabcontent ${pt}" data-category="${ot}" role="tabpanel-section" id="tabcontent-${mt.id}"></div>`}return`
            <!-- boutons radio des sous categories -->
            <fieldset class="fr-fieldset" id="radio-inline_${ot}" aria-labelledby="radio-inline-legend radio-inline-messages" style="margin:unset;">
                ${ut}
                <div class="fr-messages-group" id="radio-inline-messages" aria-live="assertive"></div>
            </fieldset>
            <!-- panneaux des sous categories -->
            ${ht}
            `},u="",h=(ot,ct,ht,ut,pt,yt)=>{var mt="GPtabContent fr-tabs__panel",St=-1;ht&&(mt="GPtabContent GPtabContentSelected fr-tabs__panel fr-tabs__panel--selected",St=0);var Pt=`<div class="tabcontent" data-category="${ct}" style="content-visibility: auto;contain-intrinsic-size:50px;"></div>`;pt&&(Pt=c(ct,pt));var Rt="330px";return yt&&!ut&&(Rt="390px"),`
            <!-- panneaux -->
            <div id="tabpanel-${ot}-panel_${ct}" 
                class="${mt}" 
                role="tabpanel" 
                aria-labelledby="tabbutton-${ot}_${ct}" 
                tabindex="${St}" 
                style="max-height: ${Rt};overflow-y: auto; padding: 1em; contain: content;">
                ${Pt}
            </div>
            `},f=!1,g=!1;for(let ot=0;ot<s.length;ot++){const ct=s[ot];ct.search&&(g=!0),ct.default&&ct.search&&(f=!0)}for(let ot=0;ot<s.length;ot++){const ct=s[ot];i+=n(ot,ct.id,ct.title,ct.default),u+=h(ot,ct.id,ct.default,ct.search,ct.items,g)}var Y=o(f,"Rechercher une donne dans la catgorie"),ee="gpf-catalog-tabs-fixe";g&&(ee="gpf-catalog-tabs-fixe-with-bar");var te=`
        <!-- onglets -->
        <div id="GPcatalogContainerTabs" class="catalog-container-tabs">
            <div class="GPtabs fr-tabs ${e?"":ee}">
                <ul class="GPtabsList fr-tabs__list" role="tablist" aria-label="presentation">
                    ${i}
                </ul>
                ${Y}
                ${u}
            </div>
        </div>
        `,xe=stringToHTML$2(te.trim());const ne=xe.attachShadow({mode:"open"});ne.innerHTML=te.trim();var et=ne.querySelectorAll('[role="tabpanel-section"]'),tt=ne.querySelectorAll('[role="radio-inline-section"]');tt&&tt.forEach(ot=>{ot.addEventListener("change",ct=>{for(let pt=0;pt<et.length;pt++){const yt=et[pt];var ht=yt.getAttribute("data-category");ht===ct.target.name.split("-")[2]&&(yt.classList.add("gpf-hidden"),yt.classList.add("GPelementHidden"))}var ut=document.getElementById(ct.target.getAttribute("aria-controls"));ut.classList.remove("gpf-hidden"),ut.classList.remove("GPelementHidden"),this.onToggleCatalogRadioChange(ct,ct.target.getAttribute("data-category"))})});var it=ne.querySelectorAll('[role="tabpanel"]'),rt=ne.querySelectorAll('[role="tabbutton"]');rt&&rt.forEach(ot=>{ot.addEventListener("click",ct=>{for(let ut=0;ut<rt.length;ut++){const pt=rt[ut];pt.setAttribute("tabindex",-1),pt.ariaSelected=!1,pt.classList.remove("GPtabButtonActive")}ct.target.setAttribute("tabindex",0),ct.target.ariaSelected=!0,ct.target.classList.add("GPtabButtonActive");for(let ut=0;ut<it.length;ut++){const pt=it[ut];pt.setAttribute("tabindex",-1),pt.classList.remove("fr-tabs__panel--selected"),pt.classList.remove("GPtabContentSelected"),pt.classList.add("gpf-hidden"),pt.classList.add("GPelementHidden")}var ht=document.getElementById(ct.target.getAttribute("aria-controls"));ht.setAttribute("tabindex",0),ht.classList.add("fr-tabs__panel--selected"),ht.classList.add("GPtabContentSelected"),ht.classList.remove("gpf-hidden"),ht.classList.remove("GPelementHidden"),this.onSelectCatalogTabClick(ct,ct.target.getAttribute("data-category"))})});var nt=ne.getElementById("catalog-button-search-specific");nt&&nt.addEventListener("click",ot=>{ot.target.value=at.value,this.onSearchSpecificCatalogButtonClick(ot)});var st=ne.getElementById("catalog-button-reset-search-specific");st&&st.addEventListener("click",ot=>{at.value="",this.onSearchSpecificCatalogButtonResetClick(ot)});var at=ne.getElementById("catalog-input-search-specific");return at&&at.addEventListener("input",ot=>{ot.target.value.length<3&&ot.target.value.length>0||this.onSearchSpecificCatalogInputChange(ot)}),ne},_createCatalogContentCategoryTabContent:async function(s,e,i){var n=Object.values(e).sort((ot,ct)=>ot.title.localeCompare(ct.title,"fr",{sensitivity:"base"}));const o=10;var l=[],c="",u=(ot,ct,ht,ut,pt,yt,mt,St)=>{var Pt=vt=>{if(vt){if(vt.startsWith("data:")||vt.startsWith("http"))return`
                        <div class="catalog-thumbnail" style="width:50px; height:50px; margin-right:10px; flex-shrink:0; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                            <img src="${vt}" alt="Aperu de la couche" style="min-width:100%;min-height:100%;object-fit:cover;"/>
                        </div>
                        `;if(vt="default",vt==="default")return'<div class="catalog-thumbnail-default" style="width:50px; height:50px; margin-right:10px; flex-shrink:0; display:flex; align-items:center; justify-content:center; overflow:hidden;"></div>'}return""},Rt=yt.producers?yt.producers[0].name:"",Lt=vt=>{if(!vt)return"";var Et="";for(let Ct=0;Ct<vt.length;Ct++){const _t=vt[Ct];Et+=`
                        <a href="${_t.url}" target="_blank" class="fr-tag fr-tag--sm fr-icon-arrow-right-line fr-tag--icon-left">
                            ${_t.name}
                        </a>
                    `}return Et},Nt=vt=>{if(!vt)return"";var Et="";for(let Ct=0;Ct<vt.length;Ct++){const _t=vt[Ct];if(_t.includes("catalogue/dataset"))return`
                            <a href="${_t}" target="_blank" class="fr-link fr-icon-arrow-right-line fr-link--icon-right">
                                Voir la fiche dtaille
                            </a>
                        `}return Et};return`
            <div 
                class="fr-fieldset__element" 
                id="fieldset-${St}_${ct}-${ut}"
                style="contain: content;">
                <div class="fr-checkbox-group gpf-flex" style="justify-content:flex-start;padding-top:5px;padding-bottom:5px;box-shadow: inset 0 1px 0 0 var(--border-default-grey),0 0 0 0 var(--border-default-grey);">
                    <input
                        class="fr-input"
                        name="checkboxes-${St}"
                        id="checkboxes-${St}-${ot}_${ct}-${ut}"
                        type="checkbox"
                        data-layer="${ct}:${ut}"/>
                    <label 
                        for="checkboxes-${St}-${ot}_${ct}-${ut}"
                        style="position: relative; bottom: 12px;">
                    </label>
                    <div class="catalog-thumbnail-container" style="">
                        ${Pt(mt)}
                    </div>
                    <div style="width: 100%;">
                        <label 
                            class="GPlabelActive fr-label"
                            role="label-collapse-more-${St}"
                            aria-controls="catalog-collapse-more-${ot}-${St}"
                            title="${ht}"
                            style="display: -webkit-box; width: 100%; text-overflow: ellipsis; overflow: hidden; white-space: normal; cursor: pointer; line-height: 1.9em; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                            ${ht}
                        </label>
                        <span class="GPlabelActive fr-label fr-hint-text">${Rt}</span>
                    </div>
                    <button 
                        id="catalog-collapse-more-${ot}-${St}"
                        role="button-collapse-more-${St}"
                        class="catalog-collapse-show gpf-btn gpf-btn-icon gpf-btn-icon-catalog-collapse fr-btn fr-btn--tertiary gpf-btn--tertiary" 
                        type="button" 
                        title="En savoir plus sur la couche" 
                        tabindex="0" 
                        aria-pressed="false"
                        aria-controls="catalog-info-more-${ot}-${St}"
                        style="position: relative;">
                    </button>
                </div>
                <div class="gpf-hidden" id="catalog-info-more-${ot}-${St}">
                    <p>
                        <span class="fr-label fr-message" style="word-break: break-all;">${ct} - ${ut}</span>
                        ${Lt(yt.producers)}
                    </p>
                    <p>
                        ${pt}
                    </p>
                    ${Nt(yt.metadatas)}
                </div>
            </div>
            `},h="",f=(ot,ct,ht,ut,pt,yt)=>{var mt=ut&&ut.startsWith("fr-icon")?ut:"",St=`section-accordion-${ct}-${ot}`;return`
            <!-- section -->
            <section 
                id="section-${ct}-${ot}" 
                data-category="${ct}"
                data-id="${ot}"
                class="fr-accordion" style="contain: content;">
                <h3 class="fr-accordion__title">
                    <button class="GPcatalogButtonSection fr-accordion__btn gpf-accordion__btn" role="section-collapse-${ct}" aria-expanded="false" aria-controls="${St}">
                        <span class="GPshowCatalogAdvancedTools gpf-hidden"></span>
                        <span class="catalog-section-icon ${mt}" role="section-icon-collapse-${ct}" style="width: calc(100% - 2rem);">${ht}</span>
                        <span class="catalog-section-count" role="section-count-collapse-${ct}" id="section-count-${ct}-${ot}" style="position: absolute; right: 1.25rem;">${pt}</span>
                    </button>
                </h3>
                <div class="fr-collapse GPelementHidden" id="${St}">
                    ${yt}
                </div>
            </section>
            `},g=s.section;g&&(n=n.sort((ot,ct)=>ot[s.filter.field][0].localeCompare(ct[s.filter.field][0])));var H={},Y=[];for(let ot=0;ot<n.length;ot+=o){for(let ct=ot;ct<Math.min(ot+o,n.length);ct++){const ht=n[ct],ut={producers:ht.producer_urls,thematics:ht.thematic_urls,metadatas:ht.metadata_urls};var ee=u(ct,ht.name,ht.label,ht.service,ht.description,ut,ht.thumbnail,s.id);if(g){var te=ht[s.filter.field];Array.isArray(te)&&(te=te[0]),te?(H.hasOwnProperty(te)||(H[te]=""),H[te]+=ee):(H.hasOwnProperty("Autres")||(H.Autres=""),H.Autres+=ee)}else c+=ee,Y.push(ee)}await new Promise(ct=>setTimeout(ct,0))}if(c!==""){var st=stringToHTML$2(c);const ct=st.attachShadow({mode:"open"});ct.innerHTML=c.trim(),l.push({domid:`checkboxes-${s.id}`,rows:Y,fragment:ct,debug:{type:"layers",desc:"liste des couches pour une categorie",title:s.title}}),i&&(c="")}if(g){s.sections=[];for(const ot in H)if(Object.prototype.hasOwnProperty.call(H,ot)){const ct=H[ot];var xe=[],ne=[...ct.matchAll(/"fr-fieldset__element"/g)];for(let ht=0;ht<ne.length;ht++){const ut=ne[ht];xe.push(ut.input)}var et=ne.length,tt=this.generateID(ot),it="";if(s.icon&&s.iconJson){const ht=s.iconJson.find(ut=>ut.name===ot);ht?it=ht.icon:it="fr-icon-folder-2-fill"}var rt=f(tt,s.id,ot,it,et,i?"":ct);if(h+=rt,s.sections.push(ot),rt!==""){var st=stringToHTML$2(ct);const ut=st.attachShadow({mode:"open"});ut.innerHTML=ct.trim(),l.push({domid:`section-accordion-${s.id}-${tt}`,rows:xe,fragment:ut,debug:{type:"section",desc:"liste des couches pour une section",title:ot,id:tt,category:s.id}})}}}var nt=`
            <!-- liste de donnes -->
            <div class="fr-accordions-group" 
                id="checkboxes-${s.id}" 
                data-category="${s.id}"
                data-sections="${!!h}"
                aria-labelledby="checkboxes-legend checkboxes-messages"
                style="contain: content;">
                ${h||c}
            </div>
        `,st=stringToHTML$2(nt);const at=st.attachShadow({mode:"open"});return at.innerHTML=nt.trim(),{dom:at,blocks:l}},_updateListenersLayersDOM:function(s,e){var i=`checkboxes-${e}`,n=s.querySelectorAll('[name="'+i+'"]');n&&n.forEach(te=>{te.addEventListener("click",xe=>{this.onSelectCatalogEntryClick(xe)})});var o=`section-collapse-${e}`,l=s.querySelectorAll('[role="'+o+'"]');l&&l.forEach(te=>{te.addEventListener("click",xe=>{xe.target.ariaExpanded=xe.target.ariaExpanded!=="true";var ne=xe.target.getAttribute("aria-controls"),et=document.getElementById(ne);if(et){var tt=ne.replace("section-accordion","section"),it=document.getElementById(tt),rt=it?it.dataset.category:null;if(xe.target.ariaExpanded==="true"){et.classList.add("fr-collapse--expanded"),et.classList.remove("GPelementHidden"),it&&(it.classList.add("catalog-section-full"),this.updateVisibilitySectionsByCategory(tt,rt,!1));const nt=te.closest('div[id^="tabpanel-"]'),st=te.getBoundingClientRect(),at=nt.getBoundingClientRect(),ot=st.top-at.top;nt.scrollTo({top:nt.scrollTop+ot,behavior:"smooth"})}else et.classList.remove("fr-collapse--expanded"),et.classList.add("GPelementHidden"),it&&(it.classList.remove("catalog-section-full"),this.updateVisibilitySectionsByCategory(tt,rt,!0));this.onToggleCatalogSectionClick(xe,rt,ne)}},!1)});var c=`button-collapse-more-${e}`,u=s.querySelectorAll('[role="'+c+'"]');u&&u.forEach(te=>{te.addEventListener("click",xe=>{xe.target.ariaPressed=xe.target.ariaPressed!=="true";var ne=document.getElementById(xe.target.getAttribute("aria-controls"));if(ne){if(xe.target.ariaPressed==="true"){ne.classList.add("gpf-visible"),ne.classList.remove("gpf-hidden"),te.closest('div[id^="tabpanel-"]');const et=te.closest('div[id^="tabpanel-"]'),tt=te.getBoundingClientRect(),it=et.getBoundingClientRect(),rt=tt.top-it.top;et.scrollTo({top:et.scrollTop+rt,behavior:"smooth"})}else ne.classList.remove("gpf-visible"),ne.classList.add("gpf-hidden");this.onToggleCatalogMoreLearnClick(xe)}},!1)});var h=`label-collapse-more-${e}`,f=s.querySelectorAll('[role="'+h+'"]');f&&f.forEach(te=>{te.addEventListener("click",xe=>{var ne=document.getElementById(xe.target.getAttribute("aria-controls"));ne&&ne.click()},!1)});var g=`section-icon-collapse-${e}`,H=s.querySelectorAll('[role="'+g+'"]');H&&H.forEach(te=>{te.addEventListener("click",xe=>{xe.target.parentElement.click()})});var Y=`section-count-collapse-${e}`,ee=s.querySelectorAll('[role="'+Y+'"]');ee&&ee.forEach(te=>{te.addEventListener("click",xe=>{xe.target.parentElement.click()})})},updateVisibilitySectionsByCategory(s,e,i){var n=`[id^="section-${e}-"]`,o=document.querySelectorAll(n);for(let h=0;h<o.length;h++){const f=o[h];if(f.id!==s)if(i){var l=`section-count-${e}-${f.getAttribute("data-id")}`,c=document.getElementById(l),u=parseInt(c.textContent,10);if(u===0)continue;f.classList.remove("gpf-hidden"),f.classList.remove("GPelementHidden")}else f.classList.add("gpf-hidden"),f.classList.add("GPelementHidden")}}};const thematic=[{id:"biota",name:"Biologie, faune et flore",icon:"fr-icon-plant-fill"},{id:"boundaries",name:"Limites politiques et administratives",icon:"fr-icon-france-line"},{id:"climatologyMeteorologyAtmosphere",name:"Climatologie, mtorologie, atmosphre",icon:"fr-icon-heavy-showers-fill"},{id:"economy",name:"conomie",icon:"fr-icon-bar-chart-box-fill"},{id:"elevation",name:"Altimtrie",icon:"fr-icon-line-chart-fill"},{id:"environment",name:"Environnement",icon:"fr-icon-leaf-fill"},{id:"farming",name:"Agriculture",icon:"fr-icon-seedling-fill"},{id:"geoscientificInformation",name:"Sciences de la terre, gosciences",icon:"fr-icon-earth-fill"},{id:"health",name:"Sant",icon:"fr-icon-first-aid-kit-fill"},{id:"imageryBaseMapsEarthCover",name:"Carte de rfrence de la couverture terrestre",icon:"fr-icon-global-fill"},{id:"intelligenceMilitary",name:"Infrastructures militaires",icon:"fr-icon-medal-fill"},{id:"inlandWaters",name:"Eaux intrieures, Hydrographie",icon:"fr-icon-drop-fill"},{id:"location",name:"Localisation",icon:"fr-icon-road-map-fill"},{id:"oceans",name:"Ocans",icon:"fr-icon-fr--submersion-fill"},{id:"planningCadastre",name:"Cadastre, amnagement",icon:"fr-icon-layout-grid-fill"},{id:"society",name:"Socit",icon:"fr-icon-capsule-fill"},{id:"structure",name:"Constructions et ouvrages",icon:"fr-icon-community-fill"},{id:"transportation",name:"Infrastructures de transport",icon:"fr-icon-bus-fill"},{id:"utilitiesCommunication",name:"Tlcommunication, approvisionnement et nergie",icon:"fr-icon-lightbulb-fill"}],service=[{id:"wmts",name:"WMTS",icon:"fr-icon-earth-line"},{id:"wfs",name:"WFS",icon:"fr-icon-earth-fill"},{id:"wms",name:"WMS",icon:"fr-icon-earth-line"},{id:"tms",name:"TMS",icon:"fr-icon-earth-fill"}],producer=[{id:"ign",name:"IGN",icon:"fr-icon-government-fill"}],Topics={thematic,service,producer};function L$1(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var T=L$1();function G(s){T=s}var E={exec:()=>null};function d$1(s,e=""){let i=typeof s=="string"?s:s.source,n={replace:(o,l)=>{let c=typeof l=="string"?l:l.source;return c=c.replace(m.caret,"$1"),i=i.replace(o,c),n},getRegex:()=>new RegExp(i,e)};return n}var be=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),m={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:s=>new RegExp(`^( {0,3}${s})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}#`),htmlBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}<(?:[a-z].*>|!--)`,"i")},Re=/^(?:[ \t]*(?:\n|$))+/,Te=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Oe=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,I$1=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,we=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,F=/(?:[*+-]|\d{1,9}[.)])/,ie=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,oe=d$1(ie).replace(/bull/g,F).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),ye=d$1(ie).replace(/bull/g,F).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),j=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Pe=/^[^\n]+/,Q=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Se=d$1(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Q).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),$e=d$1(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,F).getRegex(),v="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",U=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,_e=d$1("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",U).replace("tag",v).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),ae=d$1(j).replace("hr",I$1).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v).getRegex(),Le=d$1(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",ae).getRegex(),K={blockquote:Le,code:Te,def:Se,fences:Oe,heading:we,hr:I$1,html:_e,lheading:oe,list:$e,newline:Re,paragraph:ae,table:E,text:Pe},re=d$1("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",I$1).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v).getRegex(),Me={...K,lheading:ye,table:re,paragraph:d$1(j).replace("hr",I$1).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",re).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v).getRegex()},ze={...K,html:d$1(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",U).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:E,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:d$1(j).replace("hr",I$1).replace("heading",` *#{1,6} *[^
]`).replace("lheading",oe).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Ae=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Ee=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,le=/^( {2,}|\\)\n(?!\s*$)/,Ie=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,D=/[\p{P}\p{S}]/u,W=/[\s\p{P}\p{S}]/u,ue=/[^\s\p{P}\p{S}]/u,Ce=d$1(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,W).getRegex(),pe=/(?!~)[\p{P}\p{S}]/u,Be=/(?!~)[\s\p{P}\p{S}]/u,qe=/(?:[^\s\p{P}\p{S}]|~)/u,ve=d$1(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",be?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),ce=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,De=d$1(ce,"u").replace(/punct/g,D).getRegex(),He=d$1(ce,"u").replace(/punct/g,pe).getRegex(),he="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Ze=d$1(he,"gu").replace(/notPunctSpace/g,ue).replace(/punctSpace/g,W).replace(/punct/g,D).getRegex(),Ge=d$1(he,"gu").replace(/notPunctSpace/g,qe).replace(/punctSpace/g,Be).replace(/punct/g,pe).getRegex(),Ne=d$1("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,ue).replace(/punctSpace/g,W).replace(/punct/g,D).getRegex(),Fe=d$1(/\\(punct)/,"gu").replace(/punct/g,D).getRegex(),je=d$1(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Qe=d$1(U).replace("(?:-->|$)","-->").getRegex(),Ue=d$1("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Qe).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),q=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Ke=d$1(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",q).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),de=d$1(/^!?\[(label)\]\[(ref)\]/).replace("label",q).replace("ref",Q).getRegex(),ke=d$1(/^!?\[(ref)\](?:\[\])?/).replace("ref",Q).getRegex(),We=d$1("reflink|nolink(?!\\()","g").replace("reflink",de).replace("nolink",ke).getRegex(),se=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,X={_backpedal:E,anyPunctuation:Fe,autolink:je,blockSkip:ve,br:le,code:Ee,del:E,emStrongLDelim:De,emStrongRDelimAst:Ze,emStrongRDelimUnd:Ne,escape:Ae,link:Ke,nolink:ke,punctuation:Ce,reflink:de,reflinkSearch:We,tag:Ue,text:Ie,url:E},Xe={...X,link:d$1(/^!?\[(label)\]\((.*?)\)/).replace("label",q).getRegex(),reflink:d$1(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",q).getRegex()},N$1={...X,emStrongRDelimAst:Ge,emStrongLDelim:He,url:d$1(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",se).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:d$1(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",se).getRegex()},Je={...N$1,br:d$1(le).replace("{2,}","*").getRegex(),text:d$1(N$1.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},C$1={normal:K,gfm:Me,pedantic:ze},M$1={normal:X,gfm:N$1,breaks:Je,pedantic:Xe},Ve={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ge=s=>Ve[s];function w$1(s,e){if(e){if(m.escapeTest.test(s))return s.replace(m.escapeReplace,ge)}else if(m.escapeTestNoEncode.test(s))return s.replace(m.escapeReplaceNoEncode,ge);return s}function J(s){try{s=encodeURI(s).replace(m.percentDecode,"%")}catch{return null}return s}function V(s,e){var l;let i=s.replace(m.findPipe,(c,u,h)=>{let f=!1,g=u;for(;--g>=0&&h[g]==="\\";)f=!f;return f?"|":" |"}),n=i.split(m.splitPipe),o=0;if(n[0].trim()||n.shift(),n.length>0&&!((l=n.at(-1))!=null&&l.trim())&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;o<n.length;o++)n[o]=n[o].trim().replace(m.slashPipe,"|");return n}function z$1(s,e,i){let n=s.length;if(n===0)return"";let o=0;for(;o<n&&s.charAt(n-o-1)===e;)o++;return s.slice(0,n-o)}function fe(s,e){if(s.indexOf(e[1])===-1)return-1;let i=0;for(let n=0;n<s.length;n++)if(s[n]==="\\")n++;else if(s[n]===e[0])i++;else if(s[n]===e[1]&&(i--,i<0))return n;return i>0?-2:-1}function me(s,e,i,n,o){let l=e.href,c=e.title||null,u=s[1].replace(o.other.outputLinkReplace,"$1");n.state.inLink=!0;let h={type:s[0].charAt(0)==="!"?"image":"link",raw:i,href:l,title:c,text:u,tokens:n.inlineTokens(u)};return n.state.inLink=!1,h}function Ye(s,e,i){let n=s.match(i.other.indentCodeCompensation);if(n===null)return e;let o=n[1];return e.split(`
`).map(l=>{let c=l.match(i.other.beginningSpace);if(c===null)return l;let[u]=c;return u.length>=o.length?l.slice(o.length):l}).join(`
`)}var y$1=class{constructor(e){ei(this,"options");ei(this,"rules");ei(this,"lexer");this.options=e||T}space(e){let i=this.rules.block.newline.exec(e);if(i&&i[0].length>0)return{type:"space",raw:i[0]}}code(e){let i=this.rules.block.code.exec(e);if(i){let n=i[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:i[0],codeBlockStyle:"indented",text:this.options.pedantic?n:z$1(n,`
`)}}}fences(e){let i=this.rules.block.fences.exec(e);if(i){let n=i[0],o=Ye(n,i[3]||"",this.rules);return{type:"code",raw:n,lang:i[2]?i[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):i[2],text:o}}}heading(e){let i=this.rules.block.heading.exec(e);if(i){let n=i[2].trim();if(this.rules.other.endingHash.test(n)){let o=z$1(n,"#");(this.options.pedantic||!o||this.rules.other.endingSpaceChar.test(o))&&(n=o.trim())}return{type:"heading",raw:i[0],depth:i[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){let i=this.rules.block.hr.exec(e);if(i)return{type:"hr",raw:z$1(i[0],`
`)}}blockquote(e){let i=this.rules.block.blockquote.exec(e);if(i){let n=z$1(i[0],`
`).split(`
`),o="",l="",c=[];for(;n.length>0;){let u=!1,h=[],f;for(f=0;f<n.length;f++)if(this.rules.other.blockquoteStart.test(n[f]))h.push(n[f]),u=!0;else if(!u)h.push(n[f]);else break;n=n.slice(f);let g=h.join(`
`),H=g.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");o=o?`${o}
${g}`:g,l=l?`${l}
${H}`:H;let Y=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(H,c,!0),this.lexer.state.top=Y,n.length===0)break;let ee=c.at(-1);if((ee==null?void 0:ee.type)==="code")break;if((ee==null?void 0:ee.type)==="blockquote"){let te=ee,xe=te.raw+`
`+n.join(`
`),ne=this.blockquote(xe);c[c.length-1]=ne,o=o.substring(0,o.length-te.raw.length)+ne.raw,l=l.substring(0,l.length-te.text.length)+ne.text;break}else if((ee==null?void 0:ee.type)==="list"){let te=ee,xe=te.raw+`
`+n.join(`
`),ne=this.list(xe);c[c.length-1]=ne,o=o.substring(0,o.length-ee.raw.length)+ne.raw,l=l.substring(0,l.length-te.raw.length)+ne.raw,n=xe.substring(c.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:o,tokens:c,text:l}}}list(e){let i=this.rules.block.list.exec(e);if(i){let n=i[1].trim(),o=n.length>1,l={type:"list",raw:"",ordered:o,start:o?+n.slice(0,-1):"",loose:!1,items:[]};n=o?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=o?n:"[*+-]");let c=this.rules.other.listItemRegex(n),u=!1;for(;e;){let f=!1,g="",H="";if(!(i=c.exec(e))||this.rules.block.hr.test(e))break;g=i[0],e=e.substring(g.length);let Y=i[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,tt=>" ".repeat(3*tt.length)),ee=e.split(`
`,1)[0],te=!Y.trim(),xe=0;if(this.options.pedantic?(xe=2,H=Y.trimStart()):te?xe=i[1].length+1:(xe=i[2].search(this.rules.other.nonSpaceChar),xe=xe>4?1:xe,H=Y.slice(xe),xe+=i[1].length),te&&this.rules.other.blankLine.test(ee)&&(g+=ee+`
`,e=e.substring(ee.length+1),f=!0),!f){let tt=this.rules.other.nextBulletRegex(xe),it=this.rules.other.hrRegex(xe),rt=this.rules.other.fencesBeginRegex(xe),nt=this.rules.other.headingBeginRegex(xe),st=this.rules.other.htmlBeginRegex(xe);for(;e;){let at=e.split(`
`,1)[0],ot;if(ee=at,this.options.pedantic?(ee=ee.replace(this.rules.other.listReplaceNesting,"  "),ot=ee):ot=ee.replace(this.rules.other.tabCharGlobal,"    "),rt.test(ee)||nt.test(ee)||st.test(ee)||tt.test(ee)||it.test(ee))break;if(ot.search(this.rules.other.nonSpaceChar)>=xe||!ee.trim())H+=`
`+ot.slice(xe);else{if(te||Y.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||rt.test(Y)||nt.test(Y)||it.test(Y))break;H+=`
`+ee}!te&&!ee.trim()&&(te=!0),g+=at+`
`,e=e.substring(at.length+1),Y=ot.slice(xe)}}l.loose||(u?l.loose=!0:this.rules.other.doubleBlankLine.test(g)&&(u=!0));let ne=null,et;this.options.gfm&&(ne=this.rules.other.listIsTask.exec(H),ne&&(et=ne[0]!=="[ ] ",H=H.replace(this.rules.other.listReplaceTask,""))),l.items.push({type:"list_item",raw:g,task:!!ne,checked:et,loose:!1,text:H,tokens:[]}),l.raw+=g}let h=l.items.at(-1);if(h)h.raw=h.raw.trimEnd(),h.text=h.text.trimEnd();else return;l.raw=l.raw.trimEnd();for(let f=0;f<l.items.length;f++)if(this.lexer.state.top=!1,l.items[f].tokens=this.lexer.blockTokens(l.items[f].text,[]),!l.loose){let g=l.items[f].tokens.filter(Y=>Y.type==="space"),H=g.length>0&&g.some(Y=>this.rules.other.anyLine.test(Y.raw));l.loose=H}if(l.loose)for(let f=0;f<l.items.length;f++)l.items[f].loose=!0;return l}}html(e){let i=this.rules.block.html.exec(e);if(i)return{type:"html",block:!0,raw:i[0],pre:i[1]==="pre"||i[1]==="script"||i[1]==="style",text:i[0]}}def(e){let i=this.rules.block.def.exec(e);if(i){let n=i[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),o=i[2]?i[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",l=i[3]?i[3].substring(1,i[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):i[3];return{type:"def",tag:n,raw:i[0],href:o,title:l}}}table(e){var u;let i=this.rules.block.table.exec(e);if(!i||!this.rules.other.tableDelimiter.test(i[2]))return;let n=V(i[1]),o=i[2].replace(this.rules.other.tableAlignChars,"").split("|"),l=(u=i[3])!=null&&u.trim()?i[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],c={type:"table",raw:i[0],header:[],align:[],rows:[]};if(n.length===o.length){for(let h of o)this.rules.other.tableAlignRight.test(h)?c.align.push("right"):this.rules.other.tableAlignCenter.test(h)?c.align.push("center"):this.rules.other.tableAlignLeft.test(h)?c.align.push("left"):c.align.push(null);for(let h=0;h<n.length;h++)c.header.push({text:n[h],tokens:this.lexer.inline(n[h]),header:!0,align:c.align[h]});for(let h of l)c.rows.push(V(h,c.header.length).map((f,g)=>({text:f,tokens:this.lexer.inline(f),header:!1,align:c.align[g]})));return c}}lheading(e){let i=this.rules.block.lheading.exec(e);if(i)return{type:"heading",raw:i[0],depth:i[2].charAt(0)==="="?1:2,text:i[1],tokens:this.lexer.inline(i[1])}}paragraph(e){let i=this.rules.block.paragraph.exec(e);if(i){let n=i[1].charAt(i[1].length-1)===`
`?i[1].slice(0,-1):i[1];return{type:"paragraph",raw:i[0],text:n,tokens:this.lexer.inline(n)}}}text(e){let i=this.rules.block.text.exec(e);if(i)return{type:"text",raw:i[0],text:i[0],tokens:this.lexer.inline(i[0])}}escape(e){let i=this.rules.inline.escape.exec(e);if(i)return{type:"escape",raw:i[0],text:i[1]}}tag(e){let i=this.rules.inline.tag.exec(e);if(i)return!this.lexer.state.inLink&&this.rules.other.startATag.test(i[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(i[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(i[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(i[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:i[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:i[0]}}link(e){let i=this.rules.inline.link.exec(e);if(i){let n=i[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let c=z$1(n.slice(0,-1),"\\");if((n.length-c.length)%2===0)return}else{let c=fe(i[2],"()");if(c===-2)return;if(c>-1){let u=(i[0].indexOf("!")===0?5:4)+i[1].length+c;i[2]=i[2].substring(0,c),i[0]=i[0].substring(0,u).trim(),i[3]=""}}let o=i[2],l="";if(this.options.pedantic){let c=this.rules.other.pedanticHrefTitle.exec(o);c&&(o=c[1],l=c[3])}else l=i[3]?i[3].slice(1,-1):"";return o=o.trim(),this.rules.other.startAngleBracket.test(o)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?o=o.slice(1):o=o.slice(1,-1)),me(i,{href:o&&o.replace(this.rules.inline.anyPunctuation,"$1"),title:l&&l.replace(this.rules.inline.anyPunctuation,"$1")},i[0],this.lexer,this.rules)}}reflink(e,i){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){let o=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),l=i[o.toLowerCase()];if(!l){let c=n[0].charAt(0);return{type:"text",raw:c,text:c}}return me(n,l,n[0],this.lexer,this.rules)}}emStrong(e,i,n=""){let o=this.rules.inline.emStrongLDelim.exec(e);if(!(!o||o[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(o[1]||o[2])||!n||this.rules.inline.punctuation.exec(n))){let l=[...o[0]].length-1,c,u,h=l,f=0,g=o[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(g.lastIndex=0,i=i.slice(-1*e.length+l);(o=g.exec(i))!=null;){if(c=o[1]||o[2]||o[3]||o[4]||o[5]||o[6],!c)continue;if(u=[...c].length,o[3]||o[4]){h+=u;continue}else if((o[5]||o[6])&&l%3&&!((l+u)%3)){f+=u;continue}if(h-=u,h>0)continue;u=Math.min(u,u+h+f);let H=[...o[0]][0].length,Y=e.slice(0,l+o.index+H+u);if(Math.min(l,u)%2){let te=Y.slice(1,-1);return{type:"em",raw:Y,text:te,tokens:this.lexer.inlineTokens(te)}}let ee=Y.slice(2,-2);return{type:"strong",raw:Y,text:ee,tokens:this.lexer.inlineTokens(ee)}}}}codespan(e){let i=this.rules.inline.code.exec(e);if(i){let n=i[2].replace(this.rules.other.newLineCharGlobal," "),o=this.rules.other.nonSpaceChar.test(n),l=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return o&&l&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:i[0],text:n}}}br(e){let i=this.rules.inline.br.exec(e);if(i)return{type:"br",raw:i[0]}}del(e){let i=this.rules.inline.del.exec(e);if(i)return{type:"del",raw:i[0],text:i[2],tokens:this.lexer.inlineTokens(i[2])}}autolink(e){let i=this.rules.inline.autolink.exec(e);if(i){let n,o;return i[2]==="@"?(n=i[1],o="mailto:"+n):(n=i[1],o=n),{type:"link",raw:i[0],text:n,href:o,tokens:[{type:"text",raw:n,text:n}]}}}url(e){var n;let i;if(i=this.rules.inline.url.exec(e)){let o,l;if(i[2]==="@")o=i[0],l="mailto:"+o;else{let c;do c=i[0],i[0]=((n=this.rules.inline._backpedal.exec(i[0]))==null?void 0:n[0])??"";while(c!==i[0]);o=i[0],i[1]==="www."?l="http://"+i[0]:l=i[0]}return{type:"link",raw:i[0],text:o,href:l,tokens:[{type:"text",raw:o,text:o}]}}}inlineText(e){let i=this.rules.inline.text.exec(e);if(i){let n=this.lexer.state.inRawBlock;return{type:"text",raw:i[0],text:i[0],escaped:n}}}},x$1=class ji{constructor(e){ei(this,"tokens");ei(this,"options");ei(this,"state");ei(this,"tokenizer");ei(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||T,this.options.tokenizer=this.options.tokenizer||new y$1,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let i={other:m,block:C$1.normal,inline:M$1.normal};this.options.pedantic?(i.block=C$1.pedantic,i.inline=M$1.pedantic):this.options.gfm&&(i.block=C$1.gfm,this.options.breaks?i.inline=M$1.breaks:i.inline=M$1.gfm),this.tokenizer.rules=i}static get rules(){return{block:C$1,inline:M$1}}static lex(e,i){return new ji(i).lex(e)}static lexInline(e,i){return new ji(i).inlineTokens(e)}lex(e){e=e.replace(m.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let i=0;i<this.inlineQueue.length;i++){let n=this.inlineQueue[i];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,i=[],n=!1){var o,l,c;for(this.options.pedantic&&(e=e.replace(m.tabCharGlobal,"    ").replace(m.spaceLine,""));e;){let u;if((l=(o=this.options.extensions)==null?void 0:o.block)!=null&&l.some(f=>(u=f.call({lexer:this},e,i))?(e=e.substring(u.raw.length),i.push(u),!0):!1))continue;if(u=this.tokenizer.space(e)){e=e.substring(u.raw.length);let f=i.at(-1);u.raw.length===1&&f!==void 0?f.raw+=`
`:i.push(u);continue}if(u=this.tokenizer.code(e)){e=e.substring(u.raw.length);let f=i.at(-1);(f==null?void 0:f.type)==="paragraph"||(f==null?void 0:f.type)==="text"?(f.raw+=(f.raw.endsWith(`
`)?"":`
`)+u.raw,f.text+=`
`+u.text,this.inlineQueue.at(-1).src=f.text):i.push(u);continue}if(u=this.tokenizer.fences(e)){e=e.substring(u.raw.length),i.push(u);continue}if(u=this.tokenizer.heading(e)){e=e.substring(u.raw.length),i.push(u);continue}if(u=this.tokenizer.hr(e)){e=e.substring(u.raw.length),i.push(u);continue}if(u=this.tokenizer.blockquote(e)){e=e.substring(u.raw.length),i.push(u);continue}if(u=this.tokenizer.list(e)){e=e.substring(u.raw.length),i.push(u);continue}if(u=this.tokenizer.html(e)){e=e.substring(u.raw.length),i.push(u);continue}if(u=this.tokenizer.def(e)){e=e.substring(u.raw.length);let f=i.at(-1);(f==null?void 0:f.type)==="paragraph"||(f==null?void 0:f.type)==="text"?(f.raw+=(f.raw.endsWith(`
`)?"":`
`)+u.raw,f.text+=`
`+u.raw,this.inlineQueue.at(-1).src=f.text):this.tokens.links[u.tag]||(this.tokens.links[u.tag]={href:u.href,title:u.title},i.push(u));continue}if(u=this.tokenizer.table(e)){e=e.substring(u.raw.length),i.push(u);continue}if(u=this.tokenizer.lheading(e)){e=e.substring(u.raw.length),i.push(u);continue}let h=e;if((c=this.options.extensions)!=null&&c.startBlock){let f=1/0,g=e.slice(1),H;this.options.extensions.startBlock.forEach(Y=>{H=Y.call({lexer:this},g),typeof H=="number"&&H>=0&&(f=Math.min(f,H))}),f<1/0&&f>=0&&(h=e.substring(0,f+1))}if(this.state.top&&(u=this.tokenizer.paragraph(h))){let f=i.at(-1);n&&(f==null?void 0:f.type)==="paragraph"?(f.raw+=(f.raw.endsWith(`
`)?"":`
`)+u.raw,f.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=f.text):i.push(u),n=h.length!==e.length,e=e.substring(u.raw.length);continue}if(u=this.tokenizer.text(e)){e=e.substring(u.raw.length);let f=i.at(-1);(f==null?void 0:f.type)==="text"?(f.raw+=(f.raw.endsWith(`
`)?"":`
`)+u.raw,f.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=f.text):i.push(u);continue}if(e){let f="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(f);break}else throw new Error(f)}}return this.state.top=!0,i}inline(e,i=[]){return this.inlineQueue.push({src:e,tokens:i}),i}inlineTokens(e,i=[]){var h,f,g,H,Y;let n=e,o=null;if(this.tokens.links){let ee=Object.keys(this.tokens.links);if(ee.length>0)for(;(o=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)ee.includes(o[0].slice(o[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(o=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,o.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let l;for(;(o=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)l=o[2]?o[2].length:0,n=n.slice(0,o.index+l)+"["+"a".repeat(o[0].length-l-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);n=((f=(h=this.options.hooks)==null?void 0:h.emStrongMask)==null?void 0:f.call({lexer:this},n))??n;let c=!1,u="";for(;e;){c||(u=""),c=!1;let ee;if((H=(g=this.options.extensions)==null?void 0:g.inline)!=null&&H.some(xe=>(ee=xe.call({lexer:this},e,i))?(e=e.substring(ee.raw.length),i.push(ee),!0):!1))continue;if(ee=this.tokenizer.escape(e)){e=e.substring(ee.raw.length),i.push(ee);continue}if(ee=this.tokenizer.tag(e)){e=e.substring(ee.raw.length),i.push(ee);continue}if(ee=this.tokenizer.link(e)){e=e.substring(ee.raw.length),i.push(ee);continue}if(ee=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(ee.raw.length);let xe=i.at(-1);ee.type==="text"&&(xe==null?void 0:xe.type)==="text"?(xe.raw+=ee.raw,xe.text+=ee.text):i.push(ee);continue}if(ee=this.tokenizer.emStrong(e,n,u)){e=e.substring(ee.raw.length),i.push(ee);continue}if(ee=this.tokenizer.codespan(e)){e=e.substring(ee.raw.length),i.push(ee);continue}if(ee=this.tokenizer.br(e)){e=e.substring(ee.raw.length),i.push(ee);continue}if(ee=this.tokenizer.del(e)){e=e.substring(ee.raw.length),i.push(ee);continue}if(ee=this.tokenizer.autolink(e)){e=e.substring(ee.raw.length),i.push(ee);continue}if(!this.state.inLink&&(ee=this.tokenizer.url(e))){e=e.substring(ee.raw.length),i.push(ee);continue}let te=e;if((Y=this.options.extensions)!=null&&Y.startInline){let xe=1/0,ne=e.slice(1),et;this.options.extensions.startInline.forEach(tt=>{et=tt.call({lexer:this},ne),typeof et=="number"&&et>=0&&(xe=Math.min(xe,et))}),xe<1/0&&xe>=0&&(te=e.substring(0,xe+1))}if(ee=this.tokenizer.inlineText(te)){e=e.substring(ee.raw.length),ee.raw.slice(-1)!=="_"&&(u=ee.raw.slice(-1)),c=!0;let xe=i.at(-1);(xe==null?void 0:xe.type)==="text"?(xe.raw+=ee.raw,xe.text+=ee.text):i.push(ee);continue}if(e){let xe="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(xe);break}else throw new Error(xe)}}return i}},P$1=class{constructor(e){ei(this,"options");ei(this,"parser");this.options=e||T}space(e){return""}code({text:e,lang:i,escaped:n}){var c;let o=(c=(i||"").match(m.notSpaceStart))==null?void 0:c[0],l=e.replace(m.endingNewline,"")+`
`;return o?'<pre><code class="language-'+w$1(o)+'">'+(n?l:w$1(l,!0))+`</code></pre>
`:"<pre><code>"+(n?l:w$1(l,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}def(e){return""}heading({tokens:e,depth:i}){return`<h${i}>${this.parser.parseInline(e)}</h${i}>
`}hr(e){return`<hr>
`}list(e){let i=e.ordered,n=e.start,o="";for(let u=0;u<e.items.length;u++){let h=e.items[u];o+=this.listitem(h)}let l=i?"ol":"ul",c=i&&n!==1?' start="'+n+'"':"";return"<"+l+c+`>
`+o+"</"+l+`>
`}listitem(e){var n;let i="";if(e.task){let o=this.checkbox({checked:!!e.checked});e.loose?((n=e.tokens[0])==null?void 0:n.type)==="paragraph"?(e.tokens[0].text=o+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=o+" "+w$1(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:o+" ",text:o+" ",escaped:!0}):i+=o+" "}return i+=this.parser.parse(e.tokens,!!e.loose),`<li>${i}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let i="",n="";for(let l=0;l<e.header.length;l++)n+=this.tablecell(e.header[l]);i+=this.tablerow({text:n});let o="";for(let l=0;l<e.rows.length;l++){let c=e.rows[l];n="";for(let u=0;u<c.length;u++)n+=this.tablecell(c[u]);o+=this.tablerow({text:n})}return o&&(o=`<tbody>${o}</tbody>`),`<table>
<thead>
`+i+`</thead>
`+o+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let i=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+i+`</${n}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${w$1(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:i,tokens:n}){let o=this.parser.parseInline(n),l=J(e);if(l===null)return o;e=l;let c='<a href="'+e+'"';return i&&(c+=' title="'+w$1(i)+'"'),c+=">"+o+"</a>",c}image({href:e,title:i,text:n,tokens:o}){o&&(n=this.parser.parseInline(o,this.parser.textRenderer));let l=J(e);if(l===null)return w$1(n);e=l;let c=`<img src="${e}" alt="${n}"`;return i&&(c+=` title="${w$1(i)}"`),c+=">",c}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:w$1(e.text)}},$=class{strong({text:s}){return s}em({text:s}){return s}codespan({text:s}){return s}del({text:s}){return s}html({text:s}){return s}text({text:s}){return s}link({text:s}){return""+s}image({text:s}){return""+s}br(){return""}},b$1=class $i{constructor(e){ei(this,"options");ei(this,"renderer");ei(this,"textRenderer");this.options=e||T,this.options.renderer=this.options.renderer||new P$1,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new $}static parse(e,i){return new $i(i).parse(e)}static parseInline(e,i){return new $i(i).parseInline(e)}parse(e,i=!0){var o,l;let n="";for(let c=0;c<e.length;c++){let u=e[c];if((l=(o=this.options.extensions)==null?void 0:o.renderers)!=null&&l[u.type]){let f=u,g=this.options.extensions.renderers[f.type].call({parser:this},f);if(g!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(f.type)){n+=g||"";continue}}let h=u;switch(h.type){case"space":{n+=this.renderer.space(h);continue}case"hr":{n+=this.renderer.hr(h);continue}case"heading":{n+=this.renderer.heading(h);continue}case"code":{n+=this.renderer.code(h);continue}case"table":{n+=this.renderer.table(h);continue}case"blockquote":{n+=this.renderer.blockquote(h);continue}case"list":{n+=this.renderer.list(h);continue}case"html":{n+=this.renderer.html(h);continue}case"def":{n+=this.renderer.def(h);continue}case"paragraph":{n+=this.renderer.paragraph(h);continue}case"text":{let f=h,g=this.renderer.text(f);for(;c+1<e.length&&e[c+1].type==="text";)f=e[++c],g+=`
`+this.renderer.text(f);i?n+=this.renderer.paragraph({type:"paragraph",raw:g,text:g,tokens:[{type:"text",raw:g,text:g,escaped:!0}]}):n+=g;continue}default:{let f='Token with "'+h.type+'" type was not found.';if(this.options.silent)return console.error(f),"";throw new Error(f)}}}return n}parseInline(e,i=this.renderer){var o,l;let n="";for(let c=0;c<e.length;c++){let u=e[c];if((l=(o=this.options.extensions)==null?void 0:o.renderers)!=null&&l[u.type]){let f=this.options.extensions.renderers[u.type].call({parser:this},u);if(f!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(u.type)){n+=f||"";continue}}let h=u;switch(h.type){case"escape":{n+=i.text(h);break}case"html":{n+=i.html(h);break}case"link":{n+=i.link(h);break}case"image":{n+=i.image(h);break}case"strong":{n+=i.strong(h);break}case"em":{n+=i.em(h);break}case"codespan":{n+=i.codespan(h);break}case"br":{n+=i.br(h);break}case"del":{n+=i.del(h);break}case"text":{n+=i.text(h);break}default:{let f='Token with "'+h.type+'" type was not found.';if(this.options.silent)return console.error(f),"";throw new Error(f)}}}return n}},Ni,S$1=(Ni=class{constructor(e){ei(this,"options");ei(this,"block");this.options=e||T}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}emStrongMask(e){return e}provideLexer(){return this.block?x$1.lex:x$1.lexInline}provideParser(){return this.block?b$1.parse:b$1.parseInline}},ei(Ni,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),ei(Ni,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),Ni),B=class{constructor(...s){ei(this,"defaults",L$1());ei(this,"options",this.setOptions);ei(this,"parse",this.parseMarkdown(!0));ei(this,"parseInline",this.parseMarkdown(!1));ei(this,"Parser",b$1);ei(this,"Renderer",P$1);ei(this,"TextRenderer",$);ei(this,"Lexer",x$1);ei(this,"Tokenizer",y$1);ei(this,"Hooks",S$1);this.use(...s)}walkTokens(s,e){var n,o;let i=[];for(let l of s)switch(i=i.concat(e.call(this,l)),l.type){case"table":{let c=l;for(let u of c.header)i=i.concat(this.walkTokens(u.tokens,e));for(let u of c.rows)for(let h of u)i=i.concat(this.walkTokens(h.tokens,e));break}case"list":{let c=l;i=i.concat(this.walkTokens(c.items,e));break}default:{let c=l;(o=(n=this.defaults.extensions)==null?void 0:n.childTokens)!=null&&o[c.type]?this.defaults.extensions.childTokens[c.type].forEach(u=>{let h=c[u].flat(1/0);i=i.concat(this.walkTokens(h,e))}):c.tokens&&(i=i.concat(this.walkTokens(c.tokens,e)))}}return i}use(...s){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return s.forEach(i=>{let n={...i};if(n.async=this.defaults.async||n.async||!1,i.extensions&&(i.extensions.forEach(o=>{if(!o.name)throw new Error("extension name required");if("renderer"in o){let l=e.renderers[o.name];l?e.renderers[o.name]=function(...c){let u=o.renderer.apply(this,c);return u===!1&&(u=l.apply(this,c)),u}:e.renderers[o.name]=o.renderer}if("tokenizer"in o){if(!o.level||o.level!=="block"&&o.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let l=e[o.level];l?l.unshift(o.tokenizer):e[o.level]=[o.tokenizer],o.start&&(o.level==="block"?e.startBlock?e.startBlock.push(o.start):e.startBlock=[o.start]:o.level==="inline"&&(e.startInline?e.startInline.push(o.start):e.startInline=[o.start]))}"childTokens"in o&&o.childTokens&&(e.childTokens[o.name]=o.childTokens)}),n.extensions=e),i.renderer){let o=this.defaults.renderer||new P$1(this.defaults);for(let l in i.renderer){if(!(l in o))throw new Error(`renderer '${l}' does not exist`);if(["options","parser"].includes(l))continue;let c=l,u=i.renderer[c],h=o[c];o[c]=(...f)=>{let g=u.apply(o,f);return g===!1&&(g=h.apply(o,f)),g||""}}n.renderer=o}if(i.tokenizer){let o=this.defaults.tokenizer||new y$1(this.defaults);for(let l in i.tokenizer){if(!(l in o))throw new Error(`tokenizer '${l}' does not exist`);if(["options","rules","lexer"].includes(l))continue;let c=l,u=i.tokenizer[c],h=o[c];o[c]=(...f)=>{let g=u.apply(o,f);return g===!1&&(g=h.apply(o,f)),g}}n.tokenizer=o}if(i.hooks){let o=this.defaults.hooks||new S$1;for(let l in i.hooks){if(!(l in o))throw new Error(`hook '${l}' does not exist`);if(["options","block"].includes(l))continue;let c=l,u=i.hooks[c],h=o[c];S$1.passThroughHooks.has(l)?o[c]=f=>{if(this.defaults.async&&S$1.passThroughHooksRespectAsync.has(l))return(async()=>{let H=await u.call(o,f);return h.call(o,H)})();let g=u.call(o,f);return h.call(o,g)}:o[c]=(...f)=>{if(this.defaults.async)return(async()=>{let H=await u.apply(o,f);return H===!1&&(H=await h.apply(o,f)),H})();let g=u.apply(o,f);return g===!1&&(g=h.apply(o,f)),g}}n.hooks=o}if(i.walkTokens){let o=this.defaults.walkTokens,l=i.walkTokens;n.walkTokens=function(c){let u=[];return u.push(l.call(this,c)),o&&(u=u.concat(o.call(this,c))),u}}this.defaults={...this.defaults,...n}}),this}setOptions(s){return this.defaults={...this.defaults,...s},this}lexer(s,e){return x$1.lex(s,e??this.defaults)}parser(s,e){return b$1.parse(s,e??this.defaults)}parseMarkdown(s){return(e,i)=>{let n={...i},o={...this.defaults,...n},l=this.onError(!!o.silent,!!o.async);if(this.defaults.async===!0&&n.async===!1)return l(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return l(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return l(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(o.hooks&&(o.hooks.options=o,o.hooks.block=s),o.async)return(async()=>{let c=o.hooks?await o.hooks.preprocess(e):e,u=await(o.hooks?await o.hooks.provideLexer():s?x$1.lex:x$1.lexInline)(c,o),h=o.hooks?await o.hooks.processAllTokens(u):u;o.walkTokens&&await Promise.all(this.walkTokens(h,o.walkTokens));let f=await(o.hooks?await o.hooks.provideParser():s?b$1.parse:b$1.parseInline)(h,o);return o.hooks?await o.hooks.postprocess(f):f})().catch(l);try{o.hooks&&(e=o.hooks.preprocess(e));let c=(o.hooks?o.hooks.provideLexer():s?x$1.lex:x$1.lexInline)(e,o);o.hooks&&(c=o.hooks.processAllTokens(c)),o.walkTokens&&this.walkTokens(c,o.walkTokens);let u=(o.hooks?o.hooks.provideParser():s?b$1.parse:b$1.parseInline)(c,o);return o.hooks&&(u=o.hooks.postprocess(u)),u}catch(c){return l(c)}}}onError(s,e){return i=>{if(i.message+=`
Please report this to https://github.com/markedjs/marked.`,s){let n="<p>An error occurred:</p><pre>"+w$1(i.message+"",!0)+"</pre>";return e?Promise.resolve(n):n}if(e)return Promise.reject(i);throw i}}},_$1=new B;function k$1(s,e){return _$1.parse(s,e)}k$1.options=k$1.setOptions=function(s){return _$1.setOptions(s),k$1.defaults=_$1.defaults,G(k$1.defaults),k$1};k$1.getDefaults=L$1;k$1.defaults=T;k$1.use=function(...s){return _$1.use(...s),k$1.defaults=_$1.defaults,G(k$1.defaults),k$1};k$1.walkTokens=function(s,e){return _$1.walkTokens(s,e)};k$1.parseInline=_$1.parseInline;k$1.Parser=b$1;k$1.parser=b$1.parse;k$1.Renderer=P$1;k$1.TextRenderer=$;k$1.Lexer=x$1;k$1.lexer=x$1.lex;k$1.Tokenizer=y$1;k$1.Hooks=S$1;k$1.parse=k$1;k$1.options;k$1.setOptions;k$1.use;k$1.walkTokens;k$1.parseInline;b$1.parse;x$1.lex;var clusterize={exports:{}},hasRequiredClusterize;function requireClusterize(){return hasRequiredClusterize||(hasRequiredClusterize=1,(function(s){(function(e,i){s.exports=i()})("Clusterize",function(){var e=(function(){for(var h=3,f=document.createElement("b"),g=f.all||[];f.innerHTML="<!--[if gt IE "+ ++h+"]><i><![endif]-->",g[0];);return h>4?h:document.documentMode})(),i=navigator.platform.toLowerCase().indexOf("mac")+1,n=function(h){if(!(this instanceof n))return new n(h);var f=this,g={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};f.options={};for(var H=["rows_in_block","blocks_in_cluster","show_no_data_row","no_data_class","no_data_text","keep_parity","tag","callbacks"],Y=0,ee;ee=H[Y];Y++)f.options[ee]=typeof h[ee]<"u"&&h[ee]!=null?h[ee]:g[ee];for(var te=["scroll","content"],Y=0,xe;xe=te[Y];Y++)if(f[xe+"_elem"]=h[xe+"Id"]?document.getElementById(h[xe+"Id"]):h[xe+"Elem"],!f[xe+"_elem"])throw new Error("Error! Could not find "+xe+" element");f.content_elem.hasAttribute("tabindex")||f.content_elem.setAttribute("tabindex",0);var ne=c(h.rows)?h.rows:f.fetchMarkup(),et={},tt=f.scroll_elem.scrollTop;f.insertToDOM(ne,et),f.scroll_elem.scrollTop=tt;var it=!1,rt=0,nt=!1,st=function(){i&&(nt||(f.content_elem.style.pointerEvents="none"),nt=!0,clearTimeout(rt),rt=setTimeout(function(){f.content_elem.style.pointerEvents="auto",nt=!1},50)),it!=(it=f.getClusterNum(ne))&&f.insertToDOM(ne,et),f.options.callbacks.scrollingProgress&&f.options.callbacks.scrollingProgress(f.getScrollProgress())},at=0,ot=function(){clearTimeout(at),at=setTimeout(f.refresh,100)};o("scroll",f.scroll_elem,st),o("resize",window,ot),f.destroy=function(ht){l("scroll",f.scroll_elem,st),l("resize",window,ot),f.html((ht?f.generateEmptyRow():ne).join(""))},f.refresh=function(ht){(f.getRowsHeight(ne)||ht)&&f.update(ne)},f.update=function(ht){ne=c(ht)?ht:[];var ut=f.scroll_elem.scrollTop;ne.length*f.options.item_height<ut&&(f.scroll_elem.scrollTop=0,it=0),f.insertToDOM(ne,et),f.scroll_elem.scrollTop=ut},f.clear=function(){f.update([])},f.getRowsAmount=function(){return ne.length},f.getScrollProgress=function(){return this.options.scroll_top/(ne.length*this.options.item_height)*100||0};var ct=function(ht,ut){var pt=c(ut)?ut:[];pt.length&&(ne=ht=="append"?ne.concat(pt):pt.concat(ne),f.insertToDOM(ne,et))};f.append=function(ht){ct("append",ht)},f.prepend=function(ht){ct("prepend",ht)}};n.prototype={constructor:n,fetchMarkup:function(){for(var h=[],f=this.getChildNodes(this.content_elem);f.length;)h.push(f.shift().outerHTML);return h},exploreEnvironment:function(h,f){var g=this.options;g.content_tag=this.content_elem.tagName.toLowerCase(),h.length&&(e&&e<=9&&!g.tag&&(g.tag=h[0].match(/<([^>\s/]*)/)[1].toLowerCase()),this.content_elem.children.length<=1&&(f.data=this.html(h[0]+h[0]+h[0])),g.tag||(g.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(h))},getRowsHeight:function(h){var f=this.options,g=f.item_height;if(f.cluster_height=0,!!h.length){var H=this.content_elem.children;if(H.length){var Y=H[Math.floor(H.length/2)];if(f.item_height=Y.offsetHeight,f.tag=="tr"&&u("borderCollapse",this.content_elem)!="collapse"&&(f.item_height+=parseInt(u("borderSpacing",this.content_elem),10)||0),f.tag!="tr"){var ee=parseInt(u("marginTop",Y),10)||0,te=parseInt(u("marginBottom",Y),10)||0;f.item_height+=Math.max(ee,te)}return f.block_height=f.item_height*f.rows_in_block,f.rows_in_cluster=f.blocks_in_cluster*f.rows_in_block,f.cluster_height=f.blocks_in_cluster*f.block_height,g!=f.item_height}}},getClusterNum:function(h){var f=this.options;f.scroll_top=this.scroll_elem.scrollTop;var g=f.cluster_height-f.block_height,H=Math.floor(f.scroll_top/g),Y=Math.floor(h.length*f.item_height/g);return Math.min(H,Y)},generateEmptyRow:function(){var h=this.options;if(!h.tag||!h.show_no_data_row)return[];var f=document.createElement(h.tag),g=document.createTextNode(h.no_data_text),H;return f.className=h.no_data_class,h.tag=="tr"&&(H=document.createElement("td"),H.colSpan=100,H.appendChild(g)),f.appendChild(H||g),[f.outerHTML]},generate:function(h){var f=this.options,g=h.length;if(g<f.rows_in_block)return{top_offset:0,bottom_offset:0,rows_above:0,rows:g?h:this.generateEmptyRow()};var H=Math.max((f.rows_in_cluster-f.rows_in_block)*this.getClusterNum(h),0),Y=H+f.rows_in_cluster,ee=Math.max(H*f.item_height,0),te=Math.max((g-Y)*f.item_height,0),xe=[],ne=H;ee<1&&ne++;for(var et=H;et<Y;et++)h[et]&&xe.push(h[et]);return{top_offset:ee,bottom_offset:te,rows_above:ne,rows:xe}},renderExtraTag:function(h,f){var g=document.createElement(this.options.tag),H="clusterize-";return g.className=[H+"extra-row",H+h].join(" "),f&&(g.style.height=f+"px"),g.outerHTML},insertToDOM:function(h,f){this.options.cluster_height||this.exploreEnvironment(h,f);var g=this.generate(h),H=g.rows.join(""),Y=this.checkChanges("data",H,f),ee=this.checkChanges("top",g.top_offset,f),te=this.checkChanges("bottom",g.bottom_offset,f),xe=this.options.callbacks,ne=[];Y||ee?(g.top_offset&&(this.options.keep_parity&&ne.push(this.renderExtraTag("keep-parity")),ne.push(this.renderExtraTag("top-space",g.top_offset))),ne.push(H),g.bottom_offset&&ne.push(this.renderExtraTag("bottom-space",g.bottom_offset)),xe.clusterWillChange&&xe.clusterWillChange(),this.html(ne.join("")),this.options.content_tag=="ol"&&this.content_elem.setAttribute("start",g.rows_above),this.content_elem.style["counter-increment"]="clusterize-counter "+(g.rows_above-1),xe.clusterChanged&&xe.clusterChanged()):te&&(this.content_elem.lastChild.style.height=g.bottom_offset+"px")},html:function(h){var f=this.content_elem;if(e&&e<=9&&this.options.tag=="tr"){var g=document.createElement("div"),H;for(g.innerHTML="<table><tbody>"+h+"</tbody></table>";H=f.lastChild;)f.removeChild(H);for(var Y=this.getChildNodes(g.firstChild.firstChild);Y.length;)f.appendChild(Y.shift())}else f.innerHTML=h},getChildNodes:function(h){for(var f=h.children,g=[],H=0,Y=f.length;H<Y;H++)g.push(f[H]);return g},checkChanges:function(h,f,g){var H=f!=g[h];return g[h]=f,H}};function o(h,f,g){return f.addEventListener?f.addEventListener(h,g,!1):f.attachEvent("on"+h,g)}function l(h,f,g){return f.removeEventListener?f.removeEventListener(h,g,!1):f.detachEvent("on"+h,g)}function c(h){return Object.prototype.toString.call(h)==="[object Array]"}function u(h,f){return window.getComputedStyle?window.getComputedStyle(f)[h]:f.currentStyle[h]}return n})})(clusterize)),clusterize.exports}var clusterizeExports=requireClusterize();const Clusterize=getDefaultExportFromCjs$1(clusterizeExports);Clusterize.default;var logger$4=LoggerByDefault.getLogger("widget");class Catalog extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof Catalog))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="Catalog",this.initialize(e),this.container=this.initContainer(),this.element?this.element.appendChild(this.container):this.element=this.container,this.showWaiting(),this.initConfigData().then(i=>{logger$4.trace(this,i),this.hideWaiting(),this.configData=i,this.dispatchEvent({type:this.LOADED_CATALOG_EVENT,data:i})}).catch(i=>{this.hideWaiting(),logger$4.error(i)}),this}setMap(e){e?(this.on("catalog:loaded",this.checkLayersOnMap),this.draggable&&Draggable.dragElement(this.panelCatalogContainer,this.panelCatalogHeaderContainer,e.getTargetElement()),this.collapsed||this.buttonCatalogShow.setAttribute("aria-pressed",!0),this.auto&&this.addEventsListeners(e)):(this.un("catalog:loaded",this.checkLayersOnMap),this.auto&&this.removeEventsListeners()),super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getCollapsed(){return this.collapsed}setCollapsed(e){if(e===void 0){logger$4.error("[ERROR] Catalog:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(e?this.buttonCatalogClose.click():this.buttonCatalogShow.click(),this.collapsed=e)}addLayerConfig(e){for(const o in e)if(Object.prototype.hasOwnProperty.call(e,o)){const l=e[o];if(l.serviceParams){var i=l.serviceParams.id.split(":").slice(-1)[0];l.service=i,l.categories=[],l.producer_urls=this.createCatalogLinks("producer",l.producer),l.thematic_urls=this.createCatalogLinks("thematic",l.thematic),this.layersList[o]=l}}var n=document.getElementById("GPcatalogContainerTabs");n&&n.remove(),this.layersList.sort((o,l)=>o.title.localeCompare(l.title,"fr",{sensitivity:"base"})),this.createCatalogContentEntries(this.layersList)}activeLayerByID(e){var i=e.split("$")[0],n=e.split(":").slice(-1)[0];this.activeLayer(i,n)}disableLayerByID(e){var i=e.split("$")[0],n=e.split(":").slice(-1)[0];this.disableLayer(i,n)}activeLayer(e,i){var n=this.getLayerId(e,i);if(n){var o={};this.options.addToMap&&(o=this.addLayer(e,i)),this.dispatchEvent({type:this.ADD_CATALOG_LAYER_EVENT,name:e,service:i,layer:o})}}disableLayer(e,i){var n=this.getLayerId(e,i);if(n){var o={};this.options.addToMap&&(o=this.removeLayer(e,i)),this.dispatchEvent({type:this.REMOVE_CATALOG_LAYER_EVENT,name:e,service:i,layer:o})}}getLayerId(e,i){if(!this.layersList||typeof this.layersList!="object")return null;var n=new RegExp(e+".*"+i);for(const o in this.layersList)if(Object.prototype.hasOwnProperty.call(this.layersList,o)&&n.test(o))return o;return null}getLayersByCategory(e,i){var n=i,o=e.filter;if(o){n={};for(const c in i)if(Object.prototype.hasOwnProperty.call(i,c)){const u=i[c];if(u[o.field]){var l=Array.isArray(o.value)?o.value.includes(u[o.field].toString()):o.value==="*"||u[o.field].toString()===o.value;l&&(n[c]=u,this.layersList[c].categories.push(e.id))}}}return n}getContainer(){return this.container}initialize(e){this.uid=e.id||SelectorID.generate(),this.clusterOptions={rows_in_block:50,blocks_in_cluster:4},this.options={collapsed:!0,draggable:!1,auto:!0,titlePrimary:"Grer vos couches de donnes",titleSecondary:"",layerLabel:"title",layerThumbnail:!1,tabHeightAuto:!1,optimisation:"none",size:"md",search:{display:!0,label:"Rechercher une donne",criteria:["name","title","description"]},addToMap:!0,categories:[{title:"Donnes",id:"data",cluster:!0,clusterOptions:this.clusterOptions,default:!0,filter:null}],configuration:{type:"json",urls:["https://raw.githubusercontent.com/IGNF/geoportal-configuration/new-url/dist/entreeCarto.json"]}};var i=Helper.assign(this.options.search,e.search);Helper.assign(this.options,e),Helper.assign(this.options.search,i),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this.auto=this.options.auto,this.eventsListeners=[],this.buttonCatalogShow=null,this.panelCatalogContainer=null,this.panelCatalogHeaderContainer=null,this.buttonCatalogClose=null,this.contentCatalogContainer=null,this.waitingContainer=null,this.configData={},this.layersList={},this.clusterizeRef={},this.clusterizeSections={},this.dataOnDemand={},this.categories=this.options.categories.map(n=>{var o=n.items;return n.items&&(o=n.items.map(l=>({title:l.title,id:l.id||this.generateID(l.title),default:l.hasOwnProperty("default")?l.default:!1,section:l.hasOwnProperty("section")?l.section:!1,sections:[],subcategory:!0,icon:l.hasOwnProperty("icon")?l.icon:!1,iconJson:l.iconJson||[],cluster:l.hasOwnProperty("cluster")?l.cluster:!1,clusterOptions:l.hasOwnProperty("clusterOptions")?l.clusterOptions:this.clusterOptions,filter:l.filter||null}))),{title:n.title,id:n.id||this.generateID(n.title),default:n.hasOwnProperty("default")?n.default:!1,search:n.hasOwnProperty("search")?n.search:!1,cluster:n.hasOwnProperty("cluster")?n.cluster:!1,clusterOptions:n.hasOwnProperty("clusterOptions")?n.clusterOptions:this.clusterOptions,filter:n.filter||null,items:o||null}}),this.categoryId=(()=>{var n=this.categories.findIndex(o=>o.default);return n===-1&&(n=0,this.categories[n].default=!0),this.categories[n].id})(),this.layersListOnMap={},this._searchTimeout=null,this.ADD_CATALOG_LAYER_EVENT="catalog:layer:add",this.REMOVE_CATALOG_LAYER_EVENT="catalog:layer:remove",this.LOADED_CATALOG_EVENT="catalog:loaded"}initContainer(){var e=this._createMainContainerElement(),i=this.buttonCatalogShow=this._createShowCatalogPictoElement();e.appendChild(i);var n=this.panelCatalogContainer=this._createCatalogPanelElement(),o=this._createCatalogPanelDivSizeElement(this.options.size);n.appendChild(o);var l=this._createCatalogPanelDivElement();o.appendChild(l);var c=this.panelCatalogHeaderContainer=this._createCatalogPanelHeaderElement(),u=this._createCatalogPanelIconElement(this.options.titlePrimary);c.appendChild(u);var h=this._createCatalogPanelTitleElement(this.options.titlePrimary);c.appendChild(h);var f=this.buttonCatalogClose=this._createCatalogPanelCloseElement();c.appendChild(f),l.appendChild(c);var g=this._createCatalogPanelContentDivElement(),H=this.contentCatalogContainer=this._createCatalogContentDivElement();H.appendChild(this._createCatalogContentTitleElement(this.options.titleSecondary)),this.options.search.display&&H.appendChild(this._createCatalogContentSearchGlobalElement(this.options.search.label));var Y=this.waitingContainer=this._createCatalogWaitingElement();return H.appendChild(Y),g.appendChild(H),l.appendChild(g),e.appendChild(n),e}checkLayersOnMap(){var e=this.getMap();if(e){var i=e.getLayers();i.forEach(n=>{if(n.name&&n.service){this.layersListOnMap[n.name+":"+n.service]=n;var o=document.querySelectorAll(`input[data-layer="${n.name}:${n.service}"]`);o&&o.forEach(l=>{l.checked=!0})}})}}async initConfigData(){var e=null;if(this.options.configuration.data)return e=this.options.configuration.data||{},Config.isConfigLoaded()&&Helper.mergeParams(e,Config.configuration),this.checkConfigLayers(e.layers),this.layersList=e.layers,this.createCatalogContentEntries(e),new Promise((n,o)=>{n(e)});if(this.options.configuration.urls){var i=[];for(let n=0;n<this.options.configuration.urls.length;n++){const o=this.options.configuration.urls[n],l=function(){return fetch(o,{}).then(function(c){if(c.ok)return c.json().then(function(h){return h}).catch(h=>{logger$4.warn("fetch json exception :",h)});var u=new Error("HTTP status code: "+c.status);throw u}).catch(c=>new Promise((u,h)=>{logger$4.error("fetch json exception :",c),h(c)}))};i.push(l())}try{const n=await Promise.all(i);e=n[0];for(let o=1;o<n.length;o++){const l=n[o];Helper.mergeParams(e,l)}return Config.isConfigLoaded()&&Helper.mergeParams(e,Config.configuration),this.checkConfigLayers(e.layers),this.layersList=e.layers,this.createCatalogContentEntries(e),await new Promise((o,l)=>{o(e)})}catch(n){return await new Promise((o,l)=>{l(n)})}}}checkConfigLayers(e){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const o=e[n];if(o.serviceParams){if((c=>{const u=document.createElement("div");return u.innerHTML=c.trim(),u.childNodes.length>0&&u.firstChild.nodeType===1})(o.description)){logger$4.error(`layer description contains HTML code, which is not allowed. Layer: ${n}`),logger$4.error("Please use Markdown syntax for layer descriptions instead."),logger$4.error(o.description),delete e[n];continue}var i=o.serviceParams.id.split(":").slice(-1)[0];o.service=i,o.categories=[],o.producer_urls=this.createCatalogProducerLinks(o.producer),o.thematic_urls=this.createCatalogThematicLinks(o.thematic),o.label=this.options.layerLabel&&o[this.options.layerLabel]||o.title,o.description=k$1.parse(o.description),this.options.layerThumbnail?o.thumbnail||(o.thumbnail="default"):o.thumbnail&&delete o.thumbnail}else delete e[n]}}createCatalogContentEntries(e){var i=this.contentCatalogContainer,n=this._createCatalogContentCategoriesTabs(this.categories,this.options.tabHeightAuto);i.appendChild(n);var o=[];this.categories.forEach(h=>{if(h.items)for(let f=0;f<h.items.length;f++){const g=h.items[f];if(g.icon&&g.iconJson.length===0&&g.section&&g.filter){const H=g.filter.field;e.topics&&e.topics[H]?g.iconJson=e.topics[H]:e[H]?g.iconJson=e[H]:Topics[H]?g.iconJson=Topics[H]:g.iconJson=[]}g.subcategory=!0,o.push(g)}else o.push(h)}),o.findIndex(h=>h.id===this.categoryId);var l=i.querySelectorAll(".tabcontent");for(let h=0;h<l.length;h++){const f=l[h];var c=this.getLayersByCategory(o[h],e.layers),u=o[h].cluster&&this.options.optimisation==="clusterize"||this.options.optimisation==="on-demand";this._createCatalogContentCategoryTabContent(o[h],c,u).then(g=>{const H=document.createDocumentFragment();if(g.dom)if(H.appendChild(g.dom),f.appendChild(H),console.log(`Content for category ${o[h].title} created.`),o[h].cluster&&this.options.optimisation==="clusterize")o[h].section?(console.warn(`No clustering at initialization for sections : ${o[h].title} !`),this.clusterizeSections[o[h].id]=g.blocks.reduce((Y,ee)=>(Y[ee.domid]=ee.rows,Y),{}),this._updateListenersLayersDOM(f,o[h].id)):this.clusterizeRef[o[h].id]=new Clusterize({scrollId:f.parentElement.id,contentId:g.blocks[0].domid,rows:g.blocks[0].rows,rows_in_block:o[h].clusterOptions.rows_in_block,blocks_in_cluster:o[h].clusterOptions.blocks_in_cluster,callbacks:{clusterChanged:()=>{logger$4.trace("cluster changed"),this._updateListenersLayersDOM(f,o[h].id),this.checkLayersOnMap()}}});else if(this.options.optimisation==="on-demand"){if(o[h].section)this.dataOnDemand[o[h].id]=g.blocks.reduce((Y,ee)=>(Y[ee.domid]=ee.fragment,Y),{});else if(this.dataOnDemand[o[h].id]=g.blocks[0].fragment,o[h].default){const ee=(te=>{const xe=document.createDocumentFragment();return te.childNodes.forEach(ne=>{xe.appendChild(ne.cloneNode(!0))}),xe})(this.dataOnDemand[o[h].id]);f.querySelector(`#checkboxes-${o[h].id}`).appendChild(ee)}this._updateListenersLayersDOM(f,o[h].id)}else this._updateListenersLayersDOM(f,o[h].id),this.checkLayersOnMap()})}}createCatalogThematicLinks(e){if(!e)return null;var i="https://cartes.gouv.fr/catalogue/search?",n=[];for(let l=0;l<e.length;l++){const c=e[l];if(c!=="Autres"){var o=Topics.thematic.find(u=>u.name===c);o&&n.push({name:c,url:i+"topic="+o.id})}}return n.length===0&&(n=null),n}createCatalogProducerLinks(e){if(!e)return null;var i="https://cartes.gouv.fr/catalogue/search?",n=[];for(let o=0;o<e.length;o++){const l=e[o];l!=="Autres"&&n.push({name:l,url:i+"organization="+l})}return n.length===0&&(n=null),n}addEventsListeners(e){var i=this;this.eventsListeners["map:add"]=function(n){logger$4.trace(n);var o=n.element.name,l=n.element.service;i.layersListOnMap[o+":"+l]=n.element;var c=document.querySelectorAll(`input[data-layer="${o}:${l}"]`);c&&c.forEach(u=>{u.checked=!0})},e.getLayers().on("add",this.eventsListeners["map:add"]),this.eventsListeners["map:remove"]=function(n){logger$4.trace(n);var o=n.element.name,l=n.element.service;delete i.layersListOnMap[o+":"+l];var c=document.querySelectorAll(`input[data-layer="${o}:${l}"]`);c&&c.forEach(u=>{u.checked=!1})},e.getLayers().on("remove",this.eventsListeners["map:remove"])}removeEventsListeners(){var e=this.getMap();e.getLayers().un("add",this.eventsListeners["map:add"]),delete this.eventsListeners["map:add"],e.getLayers().un("remove",this.eventsListeners["map:remove"]),delete this.eventsListeners["map:remove"]}addLayer(e,i){var n=null,o=null,l=this.getLayerId(e,i);if(l){var c=Config.isConfigLoaded()?null:LayerConfigUtils.getLayerConfig(this.layersList[l]);switch(i){case"WMS":o=new LayerWMS({layer:e,configuration:c});break;case"WMTS":o=new LayerWMTS({layer:e,configuration:c});break;case"TMS":o=new LayerMapBox({layer:e,configuration:c},{declutter:!0});break;case"WFS":o=new LayerWFS({layer:e,configuration:c});break}if(o){var u=this.getMap();u.addLayer(o),this.layersListOnMap[e+":"+i]=o,n=o.getConfiguration()}return n}}removeLayer(e,i){var n=null,o=this.layersListOnMap[e+":"+i];if(o){n=o.getConfiguration();var l=this.getMap();l.removeLayer(o),delete this.layersListOnMap[e+":"+i]}return n}hideWaiting(){this.waitingContainer.className="GPwaitingContainerHidden  gpf-waiting--hidden"}showWaiting(){this.waitingContainer.className="GPwaitingContainerVisible gpf-waiting--visible"}resetFilteredLayersList(){for(const e in this.layersList)if(Object.prototype.hasOwnProperty.call(this.layersList,e)){const i=this.layersList[e];i.hidden=!1,this.updateVisibilityFilteredLayers(i.name,i.service,i.hidden)}}setFilteredLayersList(e){var i=this.options.search.criteria;for(const o in this.layersList)if(Object.prototype.hasOwnProperty.call(this.layersList,o)){const l=this.layersList[o];var n="";for(let c=0;c<i.length;c++){const u=i[c];l[u]&&(n+=l[u].toLowerCase())}l.hidden=!n.includes(e.toLowerCase()),l.hidden||logger$4.info(`Filtering layer ${l.name} with words : ${n}`),this.updateVisibilityFilteredLayers(l.name,l.service,l.hidden)}this.updateVisibilityFilteredSections()}updateVisibilityFilteredLayers(e,i,n){const o=h=>h.replace(/\./g,"\\.");var l=[];this.categories.forEach(h=>{if(h.items)for(let f=0;f<h.items.length;f++){const g=h.items[f];l.push(g)}else l.push(h)});const c=(h,f,g)=>{var H=document.getElementById(`fieldset-${h.id}_${f}-${g}`);if(this.options.optimisation==="on-demand"&&h.section)for(const ee in this.dataOnDemand[h.id]){const te=this.dataOnDemand[h.id][ee];if(te){var Y=o(`#fieldset-${h.id}_${f}-${g}`);if(H=te.querySelector(Y),H)break}}return H};for(let h=0;h<l.length;h++){const f=l[h];var u=c(f,e,i);u&&(n?(u.classList.add("gpf-hidden"),u.classList.add("GPelementHidden")):(u.classList.remove("gpf-hidden"),u.classList.remove("GPelementHidden"),logger$4.info(`Layer ${e}:${i} visibility updated to hidden=${n} in category ${f.id} (${u.id}).`)))}}updateVisibilityFilteredSections(){const e=(c,u)=>{var h=0;if(this.options.optimisation==="on-demand"){var f=this.dataOnDemand[c][u];f&&(h=f.querySelectorAll(".fr-fieldset__element:not(.gpf-hidden):not(.GPelementHidden)").length)}else{var g=document.getElementById(u);if(g){var H=g.innerHTML;h=[...H.matchAll(/"fr-fieldset__element"/g)].length}}return h};for(let c=0;c<this.categories.length;c++){const u=this.categories[c];if(u.items)for(let h=0;h<u.items.length;h++){const f=u.items[h];if(f.section)for(let g=0;g<f.sections.length;g++){const H=f.sections[g];var i=document.getElementById(`section-${f.id}-${this.generateID(H)}`);if(i){var n=`section-accordion-${f.id}-${this.generateID(H)}`,o=e(f.id,n),l=document.getElementById(`section-count-${f.id}-${this.generateID(H)}`);o===0?(i.classList.add("gpf-hidden"),i.classList.add("GPelementHidden"),l&&(l.textContent=o)):(l&&(l.textContent=o),i.classList.remove("gpf-hidden"),i.classList.remove("GPelementHidden"))}}}}}onShowCatalogClick(e){var i=e.target.ariaPressed;i==="true"&&this.onPanelOpen(),this.collapsed=i!=="true",this.dispatchEvent("change:collapsed"),logger$4.trace(e)}onCloseCatalogClick(e){logger$4.trace(e)}onSelectCatalogTabClick(e,i){logger$4.trace(e);var n=[];this.categories.forEach(xe=>{if(xe.items)for(let ne=0;ne<xe.items.length;ne++){const et=xe.items[ne];n.push(et)}else n.push(xe)});var o=document.getElementById(`checkboxes-${this.categoryId}`);if(o){var l=n.find(xe=>xe.id==this.categoryId);this.options.optimisation==="on-demand"&&!l.section&&(o.innerHTML="")}this.categoryId=i;var c=n.find(xe=>xe.id==i);const u=xe=>{const ne=document.createDocumentFragment();return xe.childNodes.forEach(et=>{ne.appendChild(et.cloneNode(!0))}),ne};var h=e.target.ariaSelected==="true",f=document.getElementById(`checkboxes-${i}`);if(f&&f.children.length===0){if(this.options.optimisation==="on-demand"&&h){var g=this.dataOnDemand[c.id];g&&(f.appendChild(u(g)),this._updateListenersLayersDOM(f,c.id),this.checkLayersOnMap())}c.cluster&&this.options.optimisation}var H=document.getElementById("catalog-container-search-specific");if(H){var Y=this.categories.find(xe=>xe.id==i);Y&&Y.search?(H.classList.remove("gpf-hidden"),H.classList.add("fr-tabs__panel--selected")):(H.classList.add("gpf-hidden"),H.classList.remove("fr-tabs__panel--selected"))}var ee=document.getElementById("catalog-input-search-specific");ee&&ee.value!==""&&(ee.value="",this.setFilteredLayersList(""));var te=document.getElementById("catalog-input-search-global");te&&this.options.optimisation==="on-demand"&&te.value!==""&&this.setFilteredLayersList(te.value)}onSelectCatalogEntryClick(e){logger$4.trace(e);var i=e.target.dataset.layer,n=i.substring(0,i.lastIndexOf(":")),o=i.substring(i.lastIndexOf(":")+1),l={};e.target.checked?(this.options.addToMap&&(l=this.addLayer(n,o)),this.dispatchEvent({type:this.ADD_CATALOG_LAYER_EVENT,name:n,service:o,layer:l})):(this.options.addToMap&&(l=this.removeLayer(n,o)),this.dispatchEvent({type:this.REMOVE_CATALOG_LAYER_EVENT,name:n,service:o,layer:l}))}onToggleCatalogMoreLearnClick(e){logger$4.trace(e)}onToggleCatalogSectionClick(e,i,n){logger$4.trace(e);const o=H=>{const Y=document.createDocumentFragment();return H.childNodes.forEach(ee=>{Y.appendChild(ee.cloneNode(!0))}),Y};var l=[];this.categories.forEach(H=>{if(H.items)for(let Y=0;Y<H.items.length;Y++){const ee=H.items[Y];l.push(ee)}else l.push(H)});var c=l.find(H=>H.id==i),u=e.target.ariaExpanded==="true",h=document.getElementById(n);if(h){if(this.options.optimisation==="on-demand")if(u){var f=this.dataOnDemand[c.id][n];f&&(h.appendChild(o(f)),this._updateListenersLayersDOM(h,c.id),this.checkLayersOnMap())}else h.innerHTML="";if(c.cluster&&this.options.optimisation==="clusterize")if(u)if(this.clusterizeRef[c.id]&&this.clusterizeRef[c.id][n]&&this.clusterizeRef[c.id][n].destroyed)this.clusterizeRef[c.id][n].refresh(!0);else{var g=this.clusterizeSections[c.id][n];this.clusterizeRef[c.id]||(this.clusterizeRef[c.id]={}),this.clusterizeRef[c.id][n]=new Clusterize({scrollId:h.parentElement.id,contentId:n,rows:g,rows_in_block:c.clusterOptions.rows_in_block,blocks_in_cluster:c.clusterOptions.blocks_in_cluster,callbacks:{clusterChanged:()=>{logger$4.trace("cluster changed"),this._updateListenersLayersDOM(h,c.id),this.checkLayersOnMap()}}})}else this.clusterizeRef[c.id]&&this.clusterizeRef[c.id][n]&&!this.clusterizeRef[c.id][n].destroyed&&this.clusterizeRef[c.id][n].destroy(!0)}}onToggleCatalogRadioChange(e,i){logger$4.trace(e,i);var n=[];this.categories.forEach(f=>{if(f.items)for(let g=0;g<f.items.length;g++){const H=f.items[g];n.push(H)}else n.push(f)});var o=n.find(f=>f.id==i),l=document.getElementById(`checkboxes-${this.categoryId}`);l&&!o.section&&this.options.optimisation==="on-demand"&&(l.innerHTML=""),this.categoryId=i;const c=f=>{const g=document.createDocumentFragment();return f.childNodes.forEach(H=>{g.appendChild(H.cloneNode(!0))}),g};var u=document.getElementById(`checkboxes-${i}`);if(u&&u.children.length===0){if(this.options.optimisation==="on-demand"&&e.target.checked){var h=this.dataOnDemand[o.id];h&&(u.appendChild(c(h)),this._updateListenersLayersDOM(u,o.id),this.checkLayersOnMap())}o.cluster&&this.options.optimisation}}onSearchGlobalCatalogButtonClick(e){var i=e.target.value;this.setFilteredLayersList(i)}onSearchGlobalCatalogInputChange(e){clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(()=>{this.onSearchGlobalCatalogButtonClick(e)},200)}onSearchGlobalCatalogButtonResetClick(e){this.resetFilteredLayersList(),this.updateVisibilityFilteredSections()}onSearchSpecificCatalogButtonClick(e){var i=e.target.value;this.setFilteredLayersList(i)}onSearchSpecificCatalogInputChange(e){clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(()=>{this.onSearchSpecificCatalogButtonClick(e)},200)}onSearchSpecificCatalogButtonResetClick(e){this.resetFilteredLayersList(),this.updateVisibilityFilteredSections()}}Object.assign(Catalog.prototype,CatalogDOM);Object.assign(Catalog.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.Catalog=Catalog);const TerritoriesJson=[{id:"FXX",title:"France mtropolitaine",description:"",zoom:null,bbox:[-9.86,41.15,10.38,51.56],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/fxx.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/fxx.svg"},{id:"GLP",title:"Guadeloupe",description:"",zoom:null,bbox:[-61.97,15.72,-60.93,16.66],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/glp.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/glp.svg"},{id:"GUF",title:"Guyane",description:"",zoom:null,bbox:[-55.65,1.49,-51.2,6.21],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/guf.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/guf.svg"},{id:"MTQ",title:"Martinique",description:"",zoom:null,bbox:[-61.4,14.25,-60.67,15.04],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/mtq.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/mtq.svg"},{id:"REU",title:"Runion",description:"",zoom:null,bbox:[55.07,-21.46,55.86,-20.79],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/reu.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/reu.svg"},{id:"SPM",title:"Saint-Pierre-et-Miquelon",description:"",zoom:null,bbox:[-56.48,46.69,-56.07,47.19],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/spm.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/spm.svg"},{id:"IDF",title:"Paris petite couronne",description:"",zoom:null,bbox:[2.18,48.77,2.52,48.95],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/idf.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/idf.svg"},{id:"MYT",title:"Mayotte",description:"",zoom:null,bbox:[44.95,-13.049,45.32,-12.57],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/myt.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/myt.svg"},{id:"NCL",title:"Nouvelle Caldonie",description:"",zoom:null,bbox:[163.02,-23.08,167.86,-19.5],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/ncl.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/ncl.svg"}],stringToHTML$1=s=>{var e=function(){if(!window.DOMParser)return!1;var l=new DOMParser;try{l.parseFromString("x","text/html")}catch{return!1}return!0};if(e()){var i=new DOMParser,n=i.parseFromString(s,"text/html");return n.body}var o=document.createElement("div");return o.innerHTML=s,o};var TerritoriesDOM={_addUID:function(s){var e=this.uid?s+"-"+this.uid:s;return e},createDraggableElement:function(s,e){return Sortable.create(s,{animation:150,handle:".gpf-btn-icon-territories-draggable",draggable:".draggable-territories-view",ghostClass:"gpf-territories-view-ghost",onEnd:function(n){e.onReorderTerritoriesViews(n)}})},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPterritories"),s.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",s},_createShowTerritoriesPictoElement:function(){var s=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowTerritoriesPicto"),e.classList.add("GPshowOpen","GPshowAdvancedToolPicto","GPshowTerritoriesPicto"),e.classList.add("gpf-btn","gpf-btn--tertiary","gpf-btn-icon","gpf-btn-icon-territories"),e.classList.add("fr-icon-france-line"),e.classList.add("fr-btn","fr-btn--tertiary"),e.setAttribute("aria-label","Slecteur de territoire"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowTerritoriesClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowTerritoriesClick(n)}),e},_createTerritoriesPanelElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPterritoriesPanel"),s.className="GPpanel gpf-panel fr-modal",s},_createTerritoriesPanelDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__territories",s},_createTerritoriesPanelHeaderElement:function(){var s=document.createElement("div");return s.className="gpf-panel__header_territories",s},_createTerritoriesPanelIconElement:function(){var s=document.createElement("label");return s.className="gpf-btn-header-territories gpf-btn-icon-header-territories",s.title="Selecteur de territoires",s},_createTerritoriesPanelTitleElement:function(s){var e=document.createElement("div");return e.className="gpf-panel__title_territories",e.innerHTML=s,e},_createTerritoriesPanelCloseElement:function(){var s=this,e=document.createElement("button");e.id="GPterritoriesPanelClose",e.className="gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",e.title="Fermer le panneau";var i=document.createElement("span");return i.className="GPelementHidden gpf-visible",i.innerText="Fermer",e.appendChild(i),e.addEventListener?e.addEventListener("click",function(){document.getElementById(s._addUID("GPshowTerritoriesPicto")).click(),s.onCloseTerritoriesClick()},!1):e.attachEvent&&e.attachEvent("onclick",function(){document.getElementById(s._addUID("GPshowTerritoriesPicto")).click(),s.onCloseTerritoriesClick()}),e},_createTerritoriesPanelOptionsElement:function(s,e){var i=this,n="&#x2630",o="gpf-territories-button-option-id",l="gpf-territories-upload-id",c="gpf-territories-upload-close-id",u="gpf-territories-toggle-messages",h="gpf-territories-apply-id",f=`
        <div>
            <button type="button" 
                id="${o}"
                class="fr-btn fr-btn--tertiary-no-outline" 
                role="territories-button-options" 
                aria-expanded="false" 
                aria-controls="gpf-territories-upload-container-id">
                ${n}
            </button>
            <dialog id="gpf-territories-upload-container-id" class="fr-modal__body fr-upload-group gpf-hidden">
                <div class="gpf-territories-header-upload">
                    <button 
                        id="${c}"
                        type="button" 
                        class="gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w"
                        aria-expanded="false"
                        title="Fermer le panneau">
                        <span>Fermer</span>
                    </button>
                </div>
                <label class="fr-label">
                    ${s}
                    <span class="fr-hint-text">${e}</span>
                </label>
                <fieldset class="fr-fieldset">
                    <div class="fr-fieldset__element">
                        <div class="fr-toggle fr-m-2v">
                            <input 
                                id="${u}" 
                                class="fr-toggle__input" 
                                type="checkbox" 
                                aria-describedby="gpf-territories-toggle-messages">
                            <label class="fr-toggle__label" for="${u}">Complter la liste</label>
                            <div class="fr-messages-group" id="gpf-territories-toggle-messages" aria-live="polite"></div>
                        </div>
                    </div>
                    <div class="fr-fieldset__element">
                        <input 
                            id="${l}" 
                            class="fr-upload" 
                            aria-describedby="gpf-territories-upload-id-messages" 
                            type="file" 
                            name="upload">
                        <div class="fr-messages-group" id="gpf-territories-upload-id-messages" aria-live="polite"></div>
                    </div>
                </fieldset>
                <fieldset class="fr-fieldset">
                    <button 
                        id="${h}" 
                        class="gpf-button gpf-button fr-btn fr-btn--tertiary" 
                        aria-describedby="gpf-territories-apply-id-messages">Appliquer</button>
                    <div class="fr-messages-group" id="gpf-territories-apply-id-messages" aria-live="polite"></div>
                </fieldset>
            </dialog>
        </div>
        `,g=stringToHTML$1(f);const H=g.attachShadow({mode:"open"});H.innerHTML=f.trim();var Y=H.getElementById(o);Y&&Y.addEventListener("click",et=>{et.target.ariaExpanded=et.target.ariaExpanded!=="true";var tt=document.getElementById(et.target.getAttribute("aria-controls"));tt&&(et.target.ariaExpanded==="true"?(tt.classList.add("gpf-visible"),tt.classList.remove("gpf-hidden")):(tt.classList.remove("gpf-visible"),tt.classList.add("gpf-hidden")))},!1);var ee=H.getElementById(c);ee&&ee.addEventListener("click",et=>{et.target.ariaExpanded=et.target.ariaExpanded!=="true";var tt=document.getElementById(o);tt.click()});var te=H.getElementById(l);te&&te.addEventListener("change",et=>{i.onUploadFileClick(et)},!1);var xe=H.getElementById(u);xe.addEventListener("click",et=>{console.log(et.target.checked),i.onUploadToggleClick(et)});var ne=H.getElementById(h);return ne&&ne.addEventListener("click",et=>{i.onApplyTerritoriesClick(et)},!1),H.firstChild},_createTerritoriesPanelMenuViewsDivElement:function(s,e){var i=document.createElement("div");return i.className="territories-views gpf-panel__menuviews_territories",i.appendChild(this._createTerritoriesButtonOpenMenuViewsElement(s,e)),i.appendChild(this._createTerritoriesPanelMenuViewsElement(s)),i},_createTerritoriesButtonOpenMenuViewsElement:function(s,e){var i=this,n=document.createElement("button"),o=document.createElement("span");return n.appendChild(o),n.id="gpf-territories-button-open-views-id",n.classList.add("gpf-btn","gpf-btn--tertiary","gpf-btn-icon"),n.classList.add("fr-btn","fr-btn--tertiary"),n.setAttribute("aria-label",s),n.setAttribute("title",e),n.setAttribute("tabindex","0"),n.setAttribute("aria-pressed",!1),n.setAttribute("aria-controls","gpf-territories-views-container-id"),n.setAttribute("type","button"),n.innerHTML=s,n.addEventListener?n.addEventListener("click",function(l){var c=l.target.ariaPressed==="true";l.target.setAttribute("aria-pressed",!c);var u=document.getElementById(l.target.getAttribute("aria-controls"));u&&(c?(u.classList.remove("gpf-visible"),u.classList.add("gpf-hidden")):(u.classList.add("gpf-visible"),u.classList.remove("gpf-hidden")),i.onShowTerritoriesViewsClick(l))}):n.attachEvent&&n.attachEvent("onclick",function(l){var c=l.target.ariaPressed==="true";l.target.setAttribute("aria-pressed",!c);var u=document.getElementById(l.target.getAttribute("aria-controls"));u&&(c?(u.classList.remove("gpf-visible"),u.classList.add("gpf-hidden")):(u.classList.add("gpf-visible"),u.classList.remove("gpf-hidden")),i.onShowTerritoriesViewsClick(l))}),n},_createTerritoriesPanelMenuViewsElement:function(s){var e=document.createElement("dialog");return e.id="gpf-territories-views-container-id",e.className="fr-modal__body gpf-panel__views_territories-menu gpf-hidden",e.appendChild(this._createTerritoriesMenuAddViewElement(s)),e.appendChild(this._createTerritoriesMenuListViewElement()),e},_createTerritoriesMenuAddViewElement:function(s){var e=this,i="gpf-territories-views-back-button-id",n="gpf-territories-views-input-id",o="gpf-territories-views-form-id",l="gpf-territories-views-submit-id",c=`
        <div>
            <button 
                id="${i}" 
                class="fr-btn fr-icon-arrow-left-line fr-btn--icon-left fr-btn--tertiary-no-outline"
                aria-pressed="false" 
                aria-controls="gpf-territories-views-container-id gpf-territories-button-open-views-id"
                title="Retour au slecteur de territoires" 
                type="button">
                ${s}
            </button>
            <form id="${o}">
                <fieldset 
                    class="fr-fieldset" 
                    id="add-view-form-fieldset" 
                    aria-labelledby="add-view-form-fieldset-legend add-view-form-fieldset-messages">
                    <legend 
                        class="fr-fieldset__legend" 
                        id="add-view-form-fieldset-legend"> 
                        Ajouter la vue actuelle 
                    </legend>
                    <div class="fr-fieldset__element">
                        <div class="fr-input-group" id="${n}-input-group-view">
                            <label class="fr-label" for="${n}"> Nom </label>
                            <input class="fr-input" aria-describedby="${n}-messages" id="${n}" type="text">
                            <div class="fr-messages-group" id="${n}-messages" aria-live="polite"></div>
                        </div>
                    </div>
                    <div class="fr-messages-group" id="add-view-form-fieldset-messages" aria-live="polite">
                        <p class="fr-message fr-message--error gpf-hidden" id="${n}-message-error-duplicate-id">Ce nom est dj utilis</p>
                        <p class="fr-message fr-message--error gpf-hidden" id="${n}-message-error-empty-id">Le nom est vide</p>
                    </div>
                </fieldset>
            </form>
            <input type="submit" id="${l}" value="Ajouter" class="fr-btn">
            <hr class="fr-m-1v"/>
        </div>
        `,u=stringToHTML$1(c);const h=u.attachShadow({mode:"open"});h.innerHTML=c.trim();var f=h.getElementById(i);f&&f.addEventListener("click",Y=>{var ee=Y.target.ariaPressed==="true";Y.target.setAttribute("aria-pressed",!ee);var te=Y.target.getAttribute("aria-controls").split(" "),xe=document.getElementById(te[0]);if(xe){xe.classList.remove("gpf-visible"),xe.classList.add("gpf-hidden");var ne=document.getElementById(te[1]);if(ne){ne.setAttribute("aria-pressed","false");var et=document.getElementById(n);if(et){et.value="";var tt=document.getElementById(n+"-message-error-empty-id"),it=document.getElementById(n+"-message-error-duplicate-id");tt&&tt.classList.add("gpf-hidden"),it&&it.classList.add("gpf-hidden")}e.onCloseTerritoriesViewsClick(Y)}}},!1);var g=h.getElementById(o);g&&g.addEventListener("submit",Y=>{Y.preventDefault();var ee=document.getElementById(n);ee&&e.onAddTerritoriesViewClick(Y,ee.value)},!1);var H=h.getElementById(l);return H&&H.addEventListener("click",Y=>{Y.preventDefault();var ee=document.getElementById(n);if(ee){var te=e.territories.find(et=>et.data.title===ee.value),xe=document.getElementById(n+"-message-error-empty-id"),ne=document.getElementById(n+"-message-error-duplicate-id");if(ee.value===""){xe&&xe.classList.remove("gpf-hidden"),ne&&ne.classList.add("gpf-hidden");return}if(te){ne&&ne.classList.remove("gpf-hidden"),xe&&xe.classList.add("gpf-hidden");return}xe&&xe.classList.add("gpf-hidden"),ne&&ne.classList.add("gpf-hidden"),e.onAddTerritoriesViewClick(Y,ee.value)}},!1),h.firstChild},_createTerritoriesMenuListViewElement:function(){var s=this,e="gpf-territories-views-reset-button-id",i="gpf-territories-views-count-id",n=`
        <div class="gpf-panel__views_territories-listview">
            <!-- Menu de la liste des vues -->
            <div class="gpf-panel__views_territories-listview-header">
                <div class="gpf-panel__views_territories-listview-count">
                    <span class="fr-label" style="padding-right: 10px;"> Territoires </span>
                    <span 
                        class="fr-message" 
                        id="${i}"> 0 </span>
                </div>
                <button 
                    id="${e}" 
                    class="fr-btn fr-btn--sm fr-btn--tertiary-no-outline"
                    title="Rinitialiser la liste des territoires" 
                    type="button">
                    Rinitialiser
                </button>
            </div>
            <!-- Liste des vues -->
            <div 
                id="gpf-territories-views-listview-entries-id"
                class="gpf-panel__views_territories-listview-entries">
            </div>
        </div>
        `,o=stringToHTML$1(n);const l=o.attachShadow({mode:"open"});l.innerHTML=n.trim();var c=l.getElementById(e);return c&&c.addEventListener("click",u=>{s.onResetTerritoriesViewClick(u)},!1),l.firstChild},_createTerritoriesElement:function(){var s=document.createElement("div");return s.className="territories-entries gpf-panel__body_territories fr-modal__body",s},_createTerritoryEntry:function(s){var e=this;if(s){var i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFvSURBVHgB7ZfBisIwEIb/aIWKHsXH8OCT+lBevHgRjwp6EBEREdRqTbKZLN3FXT20yRyK80FIqJR8mf4drDqfjUWNaKBmiDA3IsyNCHMjwtyIMDcizI0Ic/O5wsYA7bZCkjxfb7UQlWjCnY7CaJRhNtM/0nSAyUQjTRViEU3Yug+t8Tj3ws2mcpVVWCw0Gm4Hmv9Wvioq1jcdRaLbVX6+XCyUK+p0ql2VgevVYjhM/LVQolSYqni7AVlm/aB4UKXT9LvyFI35PE40goVJ9nSiYb0cPfrVyvh1Aa21BjYb4+KCIIKFiwhQNzgcSFphvTb/ugMdZLnULhbq6TBlCcowSex2v7dTRvd74+PxLq90kMEg8dGpQuUKF1GgR01VpvF4AP1+A3lu/frVOB4ttltT+QWsXGHakN7+V5mkQ9zv7++l33s95efS+4ZEIqRNVc1xUDu3UTp4OeTfGjcizI0IcyPC3IgwNyLMjQhzUzvhL49qosB5TImnAAAAAElFTkSuQmCC",n=s.thumbnail||i,o="",l=s.icon||i;l.startsWith("fr-icon-")?o=`
                <button 
                    type="button" 
                    class="fr-btn fr-btn--lg ${l} fr-btn--tertiary-no-outline">
                </button>`:o=`
                <svg>       
                    <image id="icon-${s.id}" xlink:href="${l}" style="width:100%;"/>    
                </svg>`;var c=s.id.toLowerCase(),u=stringToHTML$1(`
            <div class="gpf-tile fr-tile fr-tile--sm">
                <div class="fr-tile__body">
                    <div class="fr-tile__content">
                        <p class="fr-tile__title">
                            <label class="gpf-label fr-label" title="${s.description}">${s.title}</label>
                        </p>
                    </div>
                </div>
                <div class="gpf-tile__header fr-tile__header">
                    <div class="fr-tile__pictogram fr-tile__thumbnail">
                        <img id="thumbnail-${s.id}" src="${n}" width="100%" height="100%" title="${s.description}"/>
                    </div>
                    <div class="fr-tile__pictogram fr-tile__icon fr-tile__icon--${c}">
                        ${o}
                    </div>
                </div>
            </div>
            `),h=u.firstChild;return h&&h.addEventListener("click",f=>{e.onImageTerritoriesClick(f,s.id)}),u.firstChild}},_createTerritoryView:function(s){var e=this,i="gpf-territories-view-entry-button-id-"+s.id;if(s){var n=stringToHTML$1(`
            <div class="gpf-panel__views_territories-listview-entry draggable-territories-view">
                <!-- ${s.title} -->
                <div style="display: flex;flex-direction: row;align-items: center;">    
                    <span class="gpf-btn gpf-btn-icon-territories-draggable gpf-btn--tertiary"></span>
                    <label class="gpf-label fr-label" title="${s.description}">${s.title}</label>
                </div>
                <button 
                    id="${i}" 
                    type="button" 
                    class="fr-btn fr-btn--sm fr-btn--icon-left fr-btn--tertiary-no-outline gpf-btn gpf-btn-icon-territories-remove gpf-btn--tertiary"></button>
            </div>
            `),o=n.firstChild;if(o){o.addEventListener("click",c=>{e.onViewTerritoryClick(c,s.id)});var l=n.querySelector("#"+i);l&&l.addEventListener("click",c=>{c.stopPropagation(),e.onViewTerritoryRemoveClick(c,s.id)})}return n.firstChild}}};let logger$3=LoggerByDefault.getLogger("territories");class Territories extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof Territories))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="Territories",this.initialize(e),this.container=this.initContainer(),this.element?this.element.appendChild(this.container):this.element=this.container,this}setMap(e){if(e){this.draggable&&Draggable.dragElement(this.panelTerritoriesContainer,this.panelTerritoriesHeaderContainer,e.getTargetElement()),this.collapsed||this.buttonTerritoriesShow.setAttribute("aria-pressed",!0);var i=this.auto?TerritoriesJson:this.options.territories;for(let o=0;o<i.length;o++){const l=i[o];this.setTerritory(l)}}super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter");var n=this;this.createDraggableElement(n.element.querySelector("#gpf-territories-views-listview-entries-id"),n),this.dispatchEvent({type:"territories:loaded"})}setTerritory(e,i=!1){var n=this.territories.some(h=>h.data.id===e.id);if(e&&!n){var o=this._createTerritoryEntry(e),l=this._createTerritoryView(e);if(o&&l){this.panelTerritoriesEntriesContainer.appendChild(o),this.panelTerritoriesViewsContainer.appendChild(l);var c=this.element.querySelector("#gpf-territories-views-count-id");if(c){var u=this.territories.filter(h=>!h.isRemoved).length+1;c.innerText=u}return this.territories.push({isRemoved:!1,isAdded:i,data:e,initialIndex:this.territories.length,domEntry:o,domView:l}),!0}}return!1}setTerritories(e){for(let i=0;i<e.length;i++){const n=e[i];this.setTerritory(n)}}removeTerritory(e,i=!1){var n=!1;if(e){for(let c=0;c<this.territories.length;c++)if(this.territories[c].data.id===e.data.id){i?(this.territories[c].domEntry.remove(),this.territories[c].domView.remove(),this.territories.splice(c,1)):(this.territories[c].isRemoved=!0,this.territories[c].domEntry.classList.add("gpf-hidden"),this.territories[c].domView.style.display="none"),n=!0;var o=this.element.querySelector("#gpf-territories-views-count-id");if(o){var l=this.territories.filter(h=>!h.isRemoved).length;o.innerText=l}break}}return n}removeTerritories(){for(let e=0;e<this.territories.length;e++){const i=this.territories[e];i.domEntry.remove(),i.domView.remove()}this.territories=[]}setCollapse(e){if(e===void 0){logger$3.log("[ERROR] Territory:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(e?document.getElementById("GPterritoriesPanelClose").click():this.buttonTerritoriesShow.click(),this.collapsed=e)}setReduce(e){e?this.panelTerritoriesEntriesContainer.classList.add("tiles-reduce"):this.panelTerritoriesEntriesContainer.classList.remove("tiles-reduce")}getContainer(){return this.container}initialize(e){this.uid=e.id||SelectorID.generate(),this.options={collapsed:!0,draggable:!1,panel:!0,upload:{active:!1,title:"Ajouter un fichier de configuration",description:""},view:{active:!1,title:"Modifier les territoires",description:""},title:"Slectionner un territoire",auto:!1,thumbnail:!1,reduce:!1,tiles:3,territories:[]};var i=Helper.assign(this.options.upload,e.upload);Helper.assign(this.options,e),Helper.assign(this.options.upload,i),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this.auto=this.options.auto,this.territories=[],this.uploadConfig=null,this.append=!1,this.buttonTerritoriesShow=null,this.panelTerritoriesContainer=null,this.panelTerritoriesHeaderContainer=null,this.buttonTerritoriesClose=null,this.containerTerritoriesOptions=null,this.panelTerritoriesEntriesContainer=null,this.panelTerritoriesViewsContainer=null}initContainer(){var e=this._createMainContainerElement(),i=this.buttonTerritoriesShow=this._createShowTerritoriesPictoElement();e.appendChild(i);var n=this.panelTerritoriesContainer=this._createTerritoriesPanelElement();n.classList.add("tiles-direction"),n.classList.add("tiles-"+this.options.tiles);var o=this._createTerritoriesPanelDivElement();n.appendChild(o);var l=this._createTerritoriesPanelMenuViewsDivElement(this.options.view.title,this.options.view.description);n.appendChild(l),this.panelTerritoriesViewsContainer=l.querySelector("#gpf-territories-views-listview-entries-id"),this.options.view&&!this.options.view.active&&(l.style.display="none");var c=this.panelTerritoriesEntriesContainer=this._createTerritoriesElement();if(c.classList.add("tiles-direction"),c.classList.add("tiles-"+this.options.tiles),this.options.reduce&&c.classList.add("tiles-reduce"),this.options.thumbnail?c.classList.add("tiles-thumbnail"):c.classList.add("tiles-icon"),n.appendChild(c),this.options.panel){var u=this.panelTerritoriesHeaderContainer=this._createTerritoriesPanelHeaderElement(),h=this._createTerritoriesPanelIconElement();u.appendChild(h);var f=this._createTerritoriesPanelTitleElement(this.options.title);if(u.appendChild(f),this.options.upload&&this.options.upload.active){var g=this.containerTerritoriesOptions=this._createTerritoriesPanelOptionsElement(this.options.upload.title,this.options.upload.description);u.appendChild(g)}var H=this.buttonTerritoriesClose=this._createTerritoriesPanelCloseElement();u.appendChild(H),o.appendChild(u)}return e.appendChild(n),logger$3.log(e),e}closePanelUpLoad(){var e=this.containerTerritoriesOptions.children[0];e&&e.setAttribute("aria-expanded","false");var i=this.containerTerritoriesOptions.children[1];i&&(i.classList.add("gpf-hidden"),i.classList.remove("gpf-visible"))}onShowTerritoriesClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen(),logger$3.trace(e),this.collapsed=!this.collapsed}onCloseTerritoriesClick(e){logger$3.trace(e)}onImageTerritoriesClick(e,i){logger$3.trace(e,i);var n=this.territories.find(H=>H.data.id===i);if(n){var o=n.data.zoom,l=n.data.bbox,c=n.data.point;if(l&&!l.length||!c&&!l)return;var u=this.getMap(),h=u.getView().getProjection().getCode();if(l){var f=transformExtent(l,"EPSG:4326",h);u.getView().fit(f,{size:u.getSize()})}if(c){var g=transform$1(c,"EPSG:4326",h);u.getView().setCenter(g)}o&&u.getView().setZoom(o),this.setCollapse(!0),this.dispatchEvent({type:"territories:change",territory:n.data})}}onUploadFileClick(e){var i=e.target.files[0];if(e.target,!i){logger$3.warn("Missing file to upload !");return}var n=new FileReader,o=this;n.onerror=l=>{logger$3.log("onerror")},n.onprogress=l=>{logger$3.log("onprogress")},n.onloadstart=l=>{logger$3.log("onloadstart")},n.onabort=l=>{logger$3.log("onabort")},n.onloadend=l=>{logger$3.log("onloadend : ",l)},n.onload=l=>{logger$3.log("file content : ",l.target.result);try{if(o.uploadConfig=JSON.parse(l.target.result),!o.uploadConfig){console.error("Invalid configuration file !");return}}catch(c){console.error("Error parsing configuration file : ",c);return}},n.readAsText(i)}onUploadToggleClick(e){this.append=e.target.checked}onApplyTerritoriesClick(e){if(logger$3.trace(e),this.closePanelUpLoad(),!this.uploadConfig){logger$3.error("No configuration to apply !");return}this.append||this.removeTerritories(),this.setTerritories(this.uploadConfig)}onShowTerritoriesViewsClick(e){logger$3.trace(e)}onCloseTerritoriesViewsClick(e){logger$3.trace(e),this.closePanelUpLoad()}onAddTerritoriesViewClick(e,i){logger$3.trace(e,i);var n=Math.abs(Array.from(i).reduce((f,g)=>Math.imul(31,f)+g.charCodeAt(0)|0,0)),o=this.getMap().getView(),l=o.getProjection().getCode(),c=transform$1(o.getCenter(),l,"EPSG:4326"),u=o.getZoom(),h={id:n.toString(),title:i,description:"Vue personnalise",point:c,zoom:u,thumbnail:"",icon:"fr-icon-map-pin-2-line"};this.setTerritory(h,!0),this.dispatchEvent({type:"territories:add",territory:h})}onResetTerritoriesViewClick(e){logger$3.trace(e);for(let o=0;o<this.territories.length;o++){const l=this.territories[o];l.isAdded?this.removeTerritory(l,!0):l.isRemoved&&(l.domEntry.classList.remove("gpf-hidden"),l.domView.style.display="",l.isRemoved=!1)}this.territories.sort((o,l)=>o.initialIndex-l.initialIndex),this.panelTerritoriesEntriesContainer.innerHTML="",this.territories.forEach(o=>{this.panelTerritoriesEntriesContainer.appendChild(o.domEntry)}),this.panelTerritoriesViewsContainer.innerHTML="",this.territories.forEach(o=>{this.panelTerritoriesViewsContainer.appendChild(o.domView)});var i=this.element.querySelector("#gpf-territories-views-count-id");if(i){var n=this.territories.filter(o=>!o.isRemoved).length;i.innerText=n}}onViewTerritoryClick(e,i){logger$3.trace(e,i)}onViewTerritoryRemoveClick(e,i){logger$3.trace(e,i);var n=this.territories.find(o=>o.data.id===i);n&&(this.removeTerritory(n,n.isAdded),this.dispatchEvent({type:"territories:remove",territory:n.data}))}onReorderTerritoriesViews(e){logger$3.trace(e);const i=Array.from(this.panelTerritoriesViewsContainer.children),n=[];i.forEach(o=>{const l=this.territories.find(c=>c.domView===o);l&&n.push(l)}),this.territories=n,this.panelTerritoriesEntriesContainer.innerHTML="",this.territories.forEach(o=>{this.panelTerritoriesEntriesContainer.appendChild(o.domEntry)})}}Object.assign(Territories.prototype,TerritoriesDOM);Object.assign(Territories.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.Territories=Territories);var ControlListDOM={_addUID:function(s){var e=this._uid?s+"-"+this._uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPcontrolList"),s.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",s},_createShowControlListPictoElement:function(){var s=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowControlListPicto"),e.classList.add("GPshowOpen","GPshowAdvancedToolPicto","GPshowControlListPicto"),e.classList.add("gpf-btn","gpf-btn--tertiary","gpf-btn-icon","gpf-btn-icon-controllist"),e.classList.add("fr-btn","fr-btn--tertiary"),e.setAttribute("aria-label","Tous mes outils"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowControlListPanelClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowControlListPanelClick(n)}),e},_createControlListPanelElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPcontrolListPanel"),s.className="GPpanel gpf-panel fr-modal",s},_createControlListPanelDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__body fr-modal__body",s},_createControlListPanelHeaderElement:function(){var s=this,e=document.createElement("div");e.className="GPpanelHeader gpf-panel__header fr-modal__header";var i=document.createElement("div");i.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",i.innerHTML="Mes outils",e.appendChild(i);var n=document.createElement("button");n.id=this._addUID("GPcontrolListPanelClose"),n.className="GPpanelClose GPcontrolListPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",n.title="Fermer le panneau",n.addEventListener?n.addEventListener("click",function(){document.getElementById(s._addUID("GPshowControlListPicto")).click()},!1):n.attachEvent&&n.attachEvent("onclick",function(){document.getElementById(s._addUID("GPshowControlListPicto")).click()});var o=document.createElement("span");return o.className="GPelementHidden gpf-visible",o.innerText="Fermer",n.appendChild(o),e.appendChild(n),e},_createControlListPanelContentElement:function(){var s=document.createElement("div");return s.className="gpf-panel__content fr-modal__content",s},_createControlListPanelFooterElement:function(s){var e=document.createElement("div");e.className="GPpanelFooter gpf-panel__footer fr-modal__footer";var i=document.createElement("button");return i.classList.add("gpf-btn","gpf-btn--tertiary","fr-btn","fr-btn--tertiary"),i.innerText="+ Ajouter plus d'outils",i.addEventListener("click",function(){s.click()}),e.appendChild(i),e},_createControlListPanelControl:function(s){let e;try{e=s.getContainer()}catch{e=s.container}var i=document.createElement("div"),n=e.querySelector(".GPshowOpen").cloneNode();n.id=n.id+"-controllist",n.classList.add("inside-control-list"),i.appendChild(n);var o=document.createElement("div"),l=document.createElement("span");if(o.appendChild(l),e.querySelector(".GPshowOpen").ariaLabel?l.innerText=e.querySelector(".GPshowOpen").ariaLabel:e.querySelector(".GPpanelTitle")?l.innerText=e.querySelector(".GPpanelTitle").innerText:e.querySelector("[class^='gpf-btn-header-']")&&(l.innerText=e.querySelector("[class^='gpf-btn-header-']").title),s.description){var c=document.createElement("span");c.innerText=s.description,o.appendChild(c)}return i.appendChild(o),i.addEventListener("click",function(){e.querySelector(".GPshowOpen").click()}),i}},logger$2=LoggerByDefault.getLogger("controlList");class ControlList extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof ControlList))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return e.controlCatalogElement?this.controlCatalogElement=e.controlCatalogElement:this.controlCatalogElement=null,this.CLASSNAME="ControlList",this.initialize(e),this._container=this._initContainer(),this.element?this.element.appendChild(this._container):this.element=this._container,this}setMap(e){e&&(this.draggable&&Draggable.dragElement(this._ControlListPanelContainer,this._ControlListPanelHeaderContainer,e.getTargetElement()),this.collapsed||this._pictoControlListButton.setAttribute("aria-pressed",!0)),super.setMap(e),this.options.position&&this.setPosition(this.options.position)}getCollapsed(){return this.collapsed}setCollapsed(e){if(e===void 0){logger$2.log("[ERROR] ControlList:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(e?document.getElementById("GPcontrolListPanelClose-"+this._uid).click():this._pictoIsoButton.click(),this.collapsed=e)}getContainer(){return this._container}clean(){this._clearIsoInputs(),this._originPoint.clearResults(),document.getElementById("GPlocationPoint_1-"+this._uid).style.cssText="",document.getElementById("GPlocationOriginCoords_1-"+this._uid).value="",document.getElementById("GPlocationOrigin_1-"+this._uid).value="",document.getElementById("GPlocationPoint_1-"+this._uid).style.cssText="",document.getElementById("GPlocationOriginPointer_1-"+this._uid).checked=!1,document.getElementById("GPlocationOrigin_1-"+this._uid).className="GPlocationOriginVisible gpf-visible",document.getElementById("GPlocationOriginCoords_1-"+this._uid).className="GPlocationOriginHidden gpf-hidden",this._currentIsoResults=null,this.setLayer()}initialize(e){e.collapsed==="true"&&(e.collapsed=!0),e.collapsed==="false"&&(e.collapsed=!1),this.options={collapsed:!0,draggable:!1},Helper.assign(this.options,e),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this._uid=this.options.id||SelectorID.generate()}_initContainer(){var e=this._createMainContainerElement(),i=this._pictoControlListButton=this._createShowControlListPictoElement();e.appendChild(i);var n=this._ControlListPanelContainer=this._createControlListPanelElement(),o=this._createControlListPanelDivElement();n.appendChild(o);var l=this._ControlListPanelHeaderContainer=this._createControlListPanelHeaderElement();o.appendChild(l);var c=this._ControlListPanelContentContainer=this._createControlListPanelContentElement();if(o.appendChild(c),this.controlCatalogElement){var u=this._createControlListPanelFooterElement(this.controlCatalogElement);o.appendChild(u)}return e.appendChild(n),e}onShowControlListPanelClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen();var i=this.getMap();Interactions.unset(i);var n=this._pictoControlListButton.ariaPressed;this.collapsed=n!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position),this.collapsed?this._ControlListPanelContentContainer.innerHTML="":this.getMap().getControls().getArray().forEach(l=>{if(l.listable){let c=this._createControlListPanelControl(l);this._ControlListPanelContentContainer.appendChild(c)}})}}Object.assign(ControlList.prototype,ControlListDOM);Object.assign(ControlList.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.ControlList=ControlList);var OGCRequest={computeGenericGPFWFS:async function(s,e,i=0,n="geom",o="",l=4326,c=!1,u,h){let f=h,g=u;l!==4326&&([f,g]=proj4(proj4.defs("EPSG:4326"),proj4.defs(`EPSG:${l}`),[h,u]));let H=`INTERSECTS(${n},Point(${f}%20${g}))`;i>0&&(H=`DWITHIN(${n},Point(${f}%20${g}),${i},kilometers)`),o&&(H+=` ${o}`);const ee=await(await fetch(`https://data.geopf.fr/wfs/ows?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&typename=${s}&outputFormat=json&count=50&CQL_FILTER=${H}`)).json(),te=[];return ee.features.forEach(xe=>{const ne=[];e.forEach(et=>{ne.push(xe.properties[et])}),c&&ne.push(xe.geometry),e.length===1&&ne[0]!==null&&!c?te.push(ne[0]):(e.length>1||c)&&te.push(ne)}),te}},title$3="contextMenu",ContextMenuDOM={_addUID:function(s){var e=this.uid?s+"-"+this.uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPpointInfo"),s.className="GPpointInfo GPwidget gpf-widget",s},_createShowPointInfoPictoElement:function(){var s=this,e=document.createElement("button");return e.id=this._addUID("GPshowPointInfoPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowPointInfoPicto gpf-btn gpf-btn-icon gpf-btn-icon-widget fr-btn",e.title=`${title$3}`,e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(i){var n=i.target.ariaPressed==="true";i.target.setAttribute("aria-pressed",!n),s.onShowPointInfoClick(i)}):e.attachEvent&&e.attachEvent("onclick",function(i){var n=i.target.ariaPressed==="true";i.target.setAttribute("aria-pressed",!n),s.onShowPointInfoClick(i)}),e},_createPointInfoPanelElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPpointInfoPanel"),s.className="GPpanel gpf-panel fr-modal",s},_createPointInfoPanelDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__pointInfo",s},_createPointInfoPanelHeaderElement:function(){var s=document.createElement("div");return s.className="GPpointInfoHeader gpf-panel__header_pointInfo",s},_createPointInfoPanelIconElement:function(){var s=document.createElement("label");return s.className="GPpanelHeader gpf-btn-header-pointInfo gpf-btn-icon-header-pointInfo",s.title="Adresse et coordonnes",s},_createPointInfoPanelTitleElement:function(){var s=document.createElement("div");return s.className="GPpanelTitle gpf-panel__title_pointInfo fr-pt-4w",s.innerHTML="Adresse et coordonnes",s},_createPointInfoPanelCloseElement:function(){var s=this,e=document.createElement("button");e.className="GPpanelClose GPpointInfoPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline",e.title="Fermer le panneau";var i=document.createElement("span");return i.className="GPelementHidden gpf-visible",i.innerText="Fermer",e.appendChild(i),e.addEventListener?e.addEventListener("click",function(){document.getElementById(s._addUID("GPshowPointInfoPicto")).click(),s.onClosePointInfoClick()},!1):e.attachEvent&&e.attachEvent("onclick",function(){document.getElementById(s._addUID("GPshowPointInfoPicto")).click(),s.onClosePointInfoClick()}),e},_createEntriesElement:function(){var s=document.createElement("div");s.className="point-info-content gpf-panel__body fr-modal__body";var e=document.createElement("div");return s.appendChild(e),s},_createPinDOMOverlay:function(s){var e=document.createElement("div"),i=document.createElement("img");return i.src=s,e.appendChild(i),e}};/*!
  * ol-contextmenu - v5.5.0
  * https://github.com/jonataswalker/ol-contextmenu
  * Built: Wed Aug 07 2024 12:29:18 GMT+0000 (Coordinated Universal Time)
  */var k=Object.defineProperty,I=(s,e,i)=>e in s?k(s,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[e]=i,a=(s,e,i)=>I(s,typeof e!="symbol"?e+"":e,i),S={exports:{}};function x(){}x.prototype={on:function(s,e,i){var n=this.e||(this.e={});return(n[s]||(n[s]=[])).push({fn:e,ctx:i}),this},once:function(s,e,i){var n=this;function o(){n.off(s,o),e.apply(i,arguments)}return o._=e,this.on(s,o,i)},emit:function(s){var e=[].slice.call(arguments,1),i=((this.e||(this.e={}))[s]||[]).slice(),n=0,o=i.length;for(n;n<o;n++)i[n].fn.apply(i[n].ctx,e);return this},off:function(s,e){var i=this.e||(this.e={}),n=i[s],o=[];if(n&&e)for(var l=0,c=n.length;l<c;l++)n[l].fn!==e&&n[l].fn._!==e&&o.push(n[l]);return o.length?i[s]=o:delete i[s],this}};S.exports=x;var _=S.exports.TinyEmitter=x,L=(s=>(s.CONTEXTMENU="contextmenu",s.CLICK="click",s.DBLCLICK="dblclick",s))(L||{}),p=(s=>(s.BEFOREOPEN="beforeopen",s.OPEN="open",s.CLOSE="close",s.ADD_MENU_ENTRY="add-menu-entry",s))(p||{});class w extends MapBrowserEvent{constructor(e){super(e.type,e.map,e.originalEvent)}}const z={width:150,scrollAt:4,eventType:L.CONTEXTMENU,defaultItems:!0,items:[]},d="ol-ctx-menu",r={container:`${d}-container`,separator:`${d}-separator`,submenu:`${d}-submenu`,hidden:`${d}-hidden`,icon:`${d}-icon`,zoomIn:`${d}-zoom-in`,zoomOut:`${d}-zoom-out`,unselectable:"ol-unselectable"},C=[{text:"Zoom In",classname:`${r.zoomIn} ${r.icon}`,callback:(s,e)=>{const i=e.getView();i.animate({zoom:Number(i.getZoom())+1,duration:700,center:s.coordinate})}},{text:"Zoom Out",classname:`${r.zoomOut} ${r.icon}`,callback:(s,e)=>{const i=e.getView();i.animate({zoom:Number(i.getZoom())-1,duration:700,center:s.coordinate})}}];function y(s){const e=document.createDocumentFragment(),i=document.createElement("div");for(i.innerHTML=s;i.firstChild;)e.append(i.firstChild);return e}function P(s){var h,f;const e=document.importNode(s),i=s.offsetWidth;e.style.cssText=`position: fixed; top: 0; left: 0; overflow: auto; visibility: hidden; pointer-events: none; height: unset; max-height: unset; width: ${i}px`;const n=y("<span>Foo</span>"),o=y("<span>Foo</span>"),l=document.createElement("li"),c=document.createElement("li");l.append(n),c.append(o),e.append(l),e.append(c),(h=s.parentNode)==null||h.append(e);const u=e.offsetHeight/2;return(f=s.parentNode)==null||f.removeChild(e),u}function N({parentNode:s,item:e,isSubmenu:i=!1,isInsideSubmenu:n=!1,emitter:o}){const l=`_${Math.random().toString(36).slice(2,11)}`;if(typeof e!="string"&&"text"in e){const g=`<span>${e.text}</span>`,H=y(g),Y=document.createElement("li");e.classname=e.classname||"",e.icon&&(e.classname===""?e.classname=r.icon:e.classname.includes(r.icon)===!1&&(e.classname+=` ${r.icon}`),Y.setAttribute("style",`background-image:url(${e.icon})`)),Y.id=l,Y.className=e.classname,Y.append(H),s.append(Y);const ee={id:l,isSubmenu:i,isInsideSubmenu:n,isSeparator:!1,callback:"callback"in e?e.callback:null,data:"data"in e?e.data:null};return o.emit(p.ADD_MENU_ENTRY,ee,Y),Y}const c=`<li id="${l}" class="${r.separator}"><hr></li>`,u=y(c);s.append(u);const h=s.lastChild,f={id:l,isSubmenu:!1,isInsideSubmenu:!1,isSeparator:!0,callback:null,data:null};return o.emit(p.ADD_MENU_ENTRY,f,h),h}function M({container:s,items:e,menuWidth:i,isInsideSubmenu:n,emitter:o}){e.forEach(l=>{if(typeof l!="string"&&"items"in l&&Array.isArray(l.items)){const c=N({parentNode:s,item:l,isSubmenu:!0,emitter:o});c.classList.add(r.submenu);const u=document.createElement("ul");u.classList.add(r.container),u.style.width=`${i}px`,c.append(u),M({emitter:o,menuWidth:i,container:u,items:l.items,isInsideSubmenu:!0})}else N({parentNode:s,item:l,isSubmenu:!1,isInsideSubmenu:n,emitter:o})})}function b(s,e){if(!s)throw new Error(e)}class R extends Control{constructor(e={}){b(typeof e=="object","@param `opts` should be object type!");const i=document.createElement("div");super({element:i}),a(this,"map"),a(this,"emitter",new _),a(this,"container"),a(this,"coordinate",[]),a(this,"pixel",[]),a(this,"contextMenuEventListener"),a(this,"entryCallbackEventListener"),a(this,"mapMoveListener"),a(this,"lineHeight",0),a(this,"disabled"),a(this,"opened"),a(this,"items",[]),a(this,"menuEntries",new Map),a(this,"options"),this.options={...z,...e};const n=document.createElement("ul");i.append(n),i.style.width=`${this.options.width}px`,i.classList.add(r.container,r.unselectable,r.hidden),this.container=i,this.contextMenuEventListener=o=>{this.handleContextMenu(o)},this.entryCallbackEventListener=o=>{this.handleEntryCallback(o)},this.mapMoveListener=()=>{this.handleMapMove()},this.disabled=!1,this.opened=!1,window.addEventListener("beforeunload",()=>{this.removeListeners()},{once:!0})}clear(){for(const e of this.menuEntries.keys())this.removeMenuEntry(e);this.container.replaceChildren(),this.container.append(document.createElement("ul"))}enable(){this.disabled=!1}disable(){this.disabled=!0}getDefaultItems(){return C}countItems(){return this.menuEntries.size}extend(e){b(Array.isArray(e),"@param `items` should be an Array."),M({items:e,emitter:this.emitter,menuWidth:this.options.width,container:this.container.firstElementChild})}closeMenu(){this.opened=!1,this.container.classList.add(r.hidden),this.dispatchEvent(p.CLOSE)}isOpen(){return this.opened}updatePosition(e){b(Array.isArray(e),"@param `pixel` should be an Array."),this.isOpen()&&(this.pixel=e,this.positionContainer())}pop(){const e=Array.from(this.menuEntries.keys()).pop();e&&this.removeMenuEntry(e)}shift(){const e=Array.from(this.menuEntries.keys()).shift();e&&this.removeMenuEntry(e)}push(e){e&&this.extend([e])}setMap(e){if(super.setMap(e),e){this.map=e,e.getViewport().addEventListener(this.options.eventType,this.contextMenuEventListener,!1),e.on("movestart",()=>{this.handleMapMove()}),this.emitter.on(p.ADD_MENU_ENTRY,(n,o)=>{this.handleAddMenuEntry(n,o)},this),this.items=this.options.defaultItems?this.options.items.concat(C):this.options.items,M({items:this.items,emitter:this.emitter,menuWidth:this.options.width,container:this.container.firstElementChild});const i=this.getMenuEntriesLength();this.lineHeight=i>0?this.container.offsetHeight/i:P(this.container)}else this.removeListeners(),this.clear()}removeListeners(){this.map.getViewport().removeEventListener(this.options.eventType,this.contextMenuEventListener,!1),this.emitter.off(p.ADD_MENU_ENTRY)}removeMenuEntry(e){let i=document.getElementById(e);i==null||i.remove(),i=null,this.menuEntries.delete(e)}handleContextMenu(e){var i;this.coordinate=this.map.getEventCoordinate(e),this.pixel=this.map.getEventPixel(e),this.dispatchEvent(new w({map:this.map,originalEvent:e,type:p.BEFOREOPEN})),!this.disabled&&(this.options.eventType===L.CONTEXTMENU&&(e.stopPropagation(),e.preventDefault()),setTimeout(()=>{this.openMenu(e)}),(i=e.target)==null||i.addEventListener("pointerdown",n=>{this.opened&&(n.stopPropagation(),this.closeMenu())},{once:!0}))}openMenu(e){this.opened=!0,this.positionContainer(),this.container.classList.remove(r.hidden),this.dispatchEvent(new w({map:this.map,originalEvent:e,type:p.OPEN}))}getMenuEntriesLength(){return Array.from(this.menuEntries).filter(([,e])=>e.isSeparator===!1&&e.isSubmenu===!1&&e.isInsideSubmenu===!1).length}positionContainer(){const e=this.map.getSize()||[0,0],i={w:e[0]-this.pixel[0],h:e[1]-this.pixel[1]},n=this.getMenuEntriesLength(),o={w:this.container.offsetWidth,h:Math.round(this.lineHeight*n)},l=i.w>=o.w?this.pixel[0]+5:this.pixel[0]-o.w;this.container.style.left=`${l}px`,this.container.style.top=i.h>=o.h?`${this.pixel[1]-10}px`:`${this.pixel[1]-o.h}px`,this.container.style.right="auto",this.container.style.bottom="auto",i.w-=o.w;const c=f=>Array.from(f.children).filter(g=>g.tagName==="LI"&&g.classList.contains(r.submenu));let u=0;const h=(f,g)=>{u+=1,c(f).forEach(H=>{const Y=g>=o.w?o.w-8:(o.w+8)*-1,ee=H.querySelector(`ul.${r.container}`),te=Math.round(this.lineHeight*Array.from(ee.children).filter(xe=>xe.tagName==="LI").length);ee.style.left=`${Y}px`,ee.style.right="auto",ee.style.top=i.h>=te+o.h?"0":`-${ee.offsetHeight-25}px`,ee.style.bottom="auto",ee.style.zIndex=String(u),c(ee).length>0&&h(ee,g-o.w)})};h(this.container.firstElementChild,i.w)}handleMapMove(){this.closeMenu()}handleEntryCallback(e){var l;e.preventDefault(),e.stopPropagation();const i=e.currentTarget,n=this.menuEntries.get(i.id);if(!n)return;const o={data:n.data,coordinate:this.coordinate};this.closeMenu(),(l=n.callback)==null||l.call(n,o,this.map)}handleAddMenuEntry(e,i){this.menuEntries.set(e.id,e),this.positionContainer(),"callback"in e&&typeof e.callback=="function"&&i.addEventListener("click",this.entryCallbackEventListener,!1)}}var logger$1=LoggerByDefault.getLogger("contextMenu");class ContextMenu extends ControlExtended{constructor(e){if(e=e||{},super({element:e.element,target:e.target,render:e.render}),!(this instanceof ContextMenu))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="ContextMenu",this.initialize(e),this.container=this.initContainer(),this.element?this.element.appendChild(this.container):this.element=this.container,this}setMap(e){e?(e.addControl(this.contextmenu),e.addOverlay(this._marker),this.auto&&this.addEventsListeners()):this.auto&&this.removeEventsListeners(),super.setMap(e)}initialize(e){this.uid=SelectorID.generate(),this.options={collapsed:!0,draggable:!1,auto:!0,panel:!0,contextMenuItemsOptions:[]},Helper.assign(this.options,e),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this.auto=this.options.auto,this.buttonContextMenuShow=null,this.panelContextMenuContainer=null,this.panelContextMenuHeaderContainer=null,this.buttonContextMenuClose=null,this.panelContextMenuEntriesContainer=null,this.eventsListeners=[],this.controlList=[],this.itiPoints=new Array(7),this._marker=new Overlay({element:this._createPinDOMOverlay(Marker.lightOrange),stopEvent:!1,offset:Marker.defaultOffset});var i=this.getAvailableContextMenuControls.call(this);this.contextMenuItemsOptions=[],e.contextMenuItemsOptions instanceof Array&&e.contextMenuItemsOptions&&e.contextMenuItemsOptions.length>0&&(this.contextMenuItemsOptions=e.contextMenuItemsOptions.map(n=>({...n,classname:"ol-context-menu-custom fr-text--md"}))),this.contextmenu=new R({defaultItems:!1,width:250,items:i})}initContainer(){var e=this._createMainContainerElement(),i=this.buttonPointInfoShow=this._createShowPointInfoPictoElement();e.appendChild(i);var n=this.panelPointInfoContainer=this._createPointInfoPanelElement(),o=this._createPointInfoPanelDivElement();n.appendChild(o);var l=this.panelPointInfoEntriesContainer=this._createEntriesElement();n.appendChild(l);var c=this.panelPointInfoHeaderContainer=this._createPointInfoPanelHeaderElement(),u=this._createPointInfoPanelIconElement();c.appendChild(u);var h=this._createPointInfoPanelTitleElement();c.appendChild(h);var f=this.buttonPointInfoClose=this._createPointInfoPanelCloseElement();return c.appendChild(f),o.appendChild(c),e.appendChild(n),logger$1.log(e),e}addEventsListeners(){this.contextmenu.on("open",e=>{e.this=this,this.onOpenContextMenu(e)}),this.contextmenu.on("close",e=>{e.this=this,this.onCloseContextMenu(e)})}removeEventsListeners(){}getAvailableContextMenuControls(){var e=[{text:"Informations sur des couches",classname:"ol-context-menu-custom fr-text--md",callback:this.getFeatureInfo.bind(this),control_CLASSNAME:"GetFeatureInfo"},{text:"Adresse / Coordonnes",classname:"ol-context-menu-custom fr-text--md",callback:this.displayAdressAndCoordinate.bind(this),control_CLASSNAME:"ContextMenu"},{text:"Itinraire depuis ce lieu",classname:"ol-context-menu-custom fr-text--md",callback:this.defineStartPoint.bind(this),control_CLASSNAME:"Route"},{text:"Itinraire vers ce lieu",classname:"ol-context-menu-custom fr-text--md",callback:this.defineEndPoint.bind(this),control_CLASSNAME:"Route"},{text:"Zone selon temps de trajet",classname:"ol-context-menu-custom fr-text--md",callback:this.computeIsochrone.bind(this),control_CLASSNAME:"Isocurve"},{text:"Ajouter des cartes / donnes",classname:"ol-context-menu-custom fr-text--md",callback:this.openCatalogue.bind(this),control_CLASSNAME:"Catalog"},"separator",{text:"Afficher la lgende",classname:"ol-context-menu-custom fr-text--md",callback:this.displayLegend.bind(this),control_CLASSNAME:"Legends"}],i=this.getMap(),n=[];i&&(n=i.getControls().getArray());var o=e.filter(l=>{if(n.filter(u=>u.CLASSNAME&&u.CLASSNAME==l.control_CLASSNAME).length>0||l=="separator")return l});return Array.prototype.push.apply(o,this.contextMenuItemsOptions),o}defineStartPoint(e){let i=this.to4326(e.coordinate);var n=this.getMap().getControls().getArray().filter(o=>o.CLASSNAME=="Route")[0];n._showRouteButton.click(),n._showRouteButton.setAttribute("aria-pressed",!0),this.itiPoints[0]=i,n.setData({points:this.itiPoints})}defineEndPoint(e){let i=this.to4326(e.coordinate);var n=this.getMap().getControls().getArray().filter(o=>o.CLASSNAME=="Route")[0];n._showRouteButton.click(),n._showRouteButton.setAttribute("aria-pressed",!0),this.itiPoints[6]=i,n.setData({points:this.itiPoints})}to4326(e){return transform$1([parseFloat(e[0]),parseFloat(e[1])],"EPSG:3857","EPSG:4326")}computeIsochrone(e){var i=this.getMap().getControls().getArray().filter(l=>l.CLASSNAME=="Isocurve")[0];i._pictoIsoButton.click(),i._pictoIsoButton.setAttribute("aria-pressed",!0);let n=this.to4326(e.coordinate);var o=i.getData();o.point=n,i.setData(o)}getFeatureInfo(e){var i=this.getMap().getControls().getArray().filter(c=>c.CLASSNAME=="GetFeatureInfo")[0],n;i.buttonGetFeatureInfoShow.getAttribute("aria-pressed")==="false"&&(n=!1),i.buttonGetFeatureInfoShow.click(),i.buttonGetFeatureInfoShow.setAttribute("aria-pressed",!0);let l={pixel:this.getMap().getPixelFromCoordinate(e.coordinate),map:this.getMap(),coordinate:e.coordinate};this.getMap().dispatchEvent({type:"singleclick",...l}),n===!1&&i.buttonGetFeatureInfoShow.setAttribute("aria-pressed",!1)}displayLegend(e){var i=this.getMap().getControls().getArray().filter(n=>n.CLASSNAME=="Legends")[0];i.buttonLegendsShow.click(),i.buttonLegendsShow.setAttribute("aria-pressed",!0)}openCatalogue(e){var i=this.getMap().getControls().getArray().filter(n=>n.CLASSNAME=="Catalog")[0];i.buttonCatalogShow.click(),i.buttonCatalogShow.setAttribute("aria-pressed",!0)}displayAdressAndCoordinate(e){let i=this.to4326(e.coordinate);this.panelPointInfoEntriesContainer.innerHTML="",this._marker.setPosition(fromLonLat(i)),this.buttonPointInfoShow.click(),this.buttonPointInfoShow.setAttribute("aria-pressed",!0);var n=document.createElement("div");n.innerHTML=i[1].toFixed(6)+", "+i[0].toFixed(6);var o=document.createElement("div"),l=document.createElement("div"),c=document.createElement("div");this.panelPointInfoEntriesContainer.appendChild(n),this.panelPointInfoEntriesContainer.appendChild(o),this.panelPointInfoEntriesContainer.appendChild(l),this.panelPointInfoEntriesContainer.appendChild(c);var u={rawResponse:!1,scope:null,onSuccess:function(H){H.elevations.length>0&&H.elevations[0].z&&(c.innerHTML="Altitude : "+H.elevations[0].z+"m")},onFailure:function(H){},positions:[{lon:i[0],lat:i[1]}],outputFormat:"json"};Gp.Services.getAltitude(u);var h={onSuccess:function(H){H.locations.length>0&&(l.innerHTML="Parcelle : "+H.locations[0].placeAttributes.districtcode+" / "+H.locations[0].placeAttributes.section+" / "+H.locations[0].placeAttributes.number)},onFailure:function(H){},position:{lon:i[1],lat:i[0]},searchGeometry:{type:"Circle",coordinates:[i[1],i[0]],radius:100},index:"CadastralParcel",maximumResponses:1};Gp.Services.reverseGeocode(h);var f=async function(){let H={layer:"LIMITES_ADMINISTRATIVES_EXPRESS.LATEST:commune",attributes:["code_postal","nom_officiel"]};const Y=await OGCRequest.computeGenericGPFWFS(H.layer,H.attributes,H.around||0,H.geom_name||"geometrie",H.additional_cql||"",H.epsg||4326,H.get_geom||!1,i[0],i[1]);Y.length&&(o.innerHTML=Y[0].join(", "))},g={onSuccess:function(H){H.locations.length>0?o.innerHTML=H.locations[0].placeAttributes.label:f()},onFailure:function(H){f()},position:{lon:i[0],lat:i[1]},searchGeometry:{type:"Circle",coordinates:[i[0],i[1]],radius:100},index:"StreetAddress",maximumResponses:1};Gp.Services.reverseGeocode(g)}onShowPointInfoClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen(),logger$1.trace(e);var i=this.buttonPointInfoShow.ariaPressed;this.collapsed=i!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position)}onClosePointInfoClick(e){logger$1.trace(e),this._marker.setPosition(void 0)}onCloseContextMenu(e){e.target.clear()}onOpenContextMenu(e){const n=this.getMap().getViewport().querySelector("canvas");if(!n||e.originalEvent.target!==n){this.contextmenu.clear(),this.contextmenu.closeMenu();return}var o=()=>{e.this.controlList=[];var c=e.this.getMap().getControls().getArray().filter(u=>u.CLASSNAME=="Route");c.length>0&&c[0].on("route:newresults",()=>{e.this.itiPoints=new Array(7)})},l=e.this.getAvailableContextMenuControls();e.target.clear(),e.target.extend(l),o()}}Object.assign(ContextMenu.prototype,ContextMenuDOM);Object.assign(ContextMenu.prototype,ContextMenu);Object.assign(ContextMenu.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.ContextMenu=ContextMenu);var title$2="reporting";const stringToHTML=s=>{var e=function(){if(!window.DOMParser)return!1;var l=new DOMParser;try{l.parseFromString("x","text/html")}catch{return!1}return!0};if(e()){var i=new DOMParser,n=i.parseFromString(s,"text/html");return n.body}var o=document.createElement("div");return o.innerHTML=s,o};var ReportingDOM={_addUID:function(s){var e=this.uid?s+"-"+this.uid:s;return e},_createMainContainerElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPreporting"),s.className="gpf-widget gpf-widget-button gpf-mobile-fullscreen gpf-button-no-gutter",s},_createShowReportingPictoElement:function(){var s=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowReportingPicto"),e.className="gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-reporting fr-btn fr-btn--tertiary ",e.title=`${title$2}`,e.setAttribute("aria-label","Signalement"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowReportingClick(n)}):e.attachEvent&&e.attachEvent("onclick",function(n){var o=n.target.ariaPressed==="true";n.target.setAttribute("aria-pressed",!o),s.onShowReportingClick(n)}),e},_createReportingPanelElement:function(){var s=document.createElement("dialog");return s.id=this._addUID("GPreportingPanel"),s.className="GPpanel gpf-panel fr-modal",s},_createReportingPanelDivElement:function(){var s=document.createElement("div");return s.className="gpf-panel__body fr-modal__body",s},_createReportingPanelHeaderElement:function(){var s=document.createElement("div");return s.className="gpf-panel__header fr-modal__header gpf-panel__header_reporting",s},_createReportingPanelIconElement:function(){var s=this,e=document.createElement("label");return e.className="gpf-btn-header gpf-btn-icon-header-reporting",e.title="Retour  l'tape prcdente",e.addEventListener("click",function(i){s.onPrevReportingClick(i)}),e},_createReportingPanelTitleElement:function(s){var e=document.createElement("div");return e.className="gpf-panel__title fr-modal__title fr-pt-4w",e.innerHTML=s||"",e},_createReportingPanelCloseElement:function(){var s=this,e=document.createElement("button");e.className="gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",e.title="Fermer le panneau",e.addEventListener?e.addEventListener("click",function(n){document.getElementById(s._addUID("GPshowReportingPicto")).click(),s.onCloseReportingClick(n)},!1):e.attachEvent&&e.attachEvent("onclick",function(n){document.getElementById(s._addUID("GPshowReportingPicto")).click(),s.onCloseReportingClick(n)});var i=document.createElement("span");return i.className="gpf-visible",i.innerText="Fermer",e.appendChild(i),e},_createReportingPanelFooterElement:function(){var s=document.createElement("div");return s.className="gpf-panel__footer fr-modal__footer gpf-panel__footer_reporting gpf-visible",s},_createReportingButtonAnnulerFooterElement:function(){var s=this,e=document.createElement("button");return e.className="gpf-btn gpf-btn--tertiary gpf-btn-icon-annuler fr-btn fr-btn--tertiary fr-m-1w",e.title="Annuler",e.textContent="Annuler",e.addEventListener?e.addEventListener("click",function(i){s.onCancelReportingClick(i)},!1):e.attachEvent&&e.attachEvent("onclick",function(i){s.onCancelReportingClick(i)}),e},_createReportingButtonSuivantFooterElement:function(){var s=this,e=document.createElement("button");return e.className="gpf-btn gpf-btn--primary gpf-btn-icon-suivant fr-btn fr-btn--primary fr-m-1w",e.title="Suivant",e.textContent="Suivant",e.addEventListener?e.addEventListener("click",function(i){s.onNextReportingClick(i)},!1):e.attachEvent&&e.attachEvent("onclick",function(i){s.onNextReportingClick(i)}),e},_createReportingPanelInputElement:function(){var s=document.createElement("div");s.id=this._addUID("GPreportingPanelInput"),s.className="gpf-panel__content fr-modal__content fr-px-3w gpf-hidden";var e=document.createElement("p");return e.innerHTML="Cliquez sur la carte  l'endroit que vous souhaitez corriger.",e.className="gpf-label fr-label",s.appendChild(e),s},_createReportingPanelFormElement:function(s){var e=this,i=document.createElement("form");i.id=this._addUID("GPreportingForm"),i.className="gpf-panel__content fr-modal__content gpf-hidden",i.addEventListener("submit",function(tt){tt.preventDefault();var it=document.getElementById(n).value,rt=document.getElementById(u).value,nt=document.getElementById(l),st=nt.options[nt.selectedIndex].textContent;return e.onReportingFormSubmit({target:tt.target,name:it,desc:rt,theme:st}),!1});var n=this._addUID("GPreportingFormLabelName"),o=`
        <div class="fr-input-group">
            <label class="gpf-label fr-label" for="${n}">Titre (obligatoire)</label>
            <input class="gpf-input fr-input" type="text" id="${n}" name="GPreportingLabelName" required>
        </div>
        `,l=this._addUID("GPreportingFormSelectTheme"),c=`
        <div class="fr-select-group">
            <label class="gpf-label fr-label" for="${l}">
                Objet du signalement (obligatoire)
            </label>
            <select class="gpf-select fr-select" id="${l}" name="GPreportingSelectTheme" required>
                <option value="" selected disabled >Slectionner une option</option>
                ${s.map(tt=>`<option value="${tt}">${tt}</option>`).join("")}
            </select>
        </div>
        `,u=this._addUID("GPreportingFormTextDesc"),h=`
        <div class="fr-input-group">
            <label class="gpf-label fr-label" for="${u}">
                Description (obligatoire)
            </label>
            <textarea class="gpf-input fr-input" id="${u}" name="GPreportingTextDesc" required></textarea>
        </div>
        `,f=this._addUID("GPreportingFormButtonDrawing"),g=`
        <div class="gpf-btn-group">
            <button id="${f}" class="gpf-btn fr-btn fr-btn--secondary fr-btn--icon-left fr-icon-edit-box-line">
                Dessiner sur la carte
            </button>
        </div>
        `,H=`
        <fieldset class="fr-fieldset" id="GPreportingFormFieldset" role="group" aria-labelledby="GPreportingFormFieldsetMessages">
            ${o}
            ${c}
            ${h}
            <div class="fr-messages-group gpf-hidden" id="GPreportingFormFieldsetMessages" aria-live="polite">
                <p class="fr-message fr-message--error" id="GPreportingFormFieldsetMessage">Les champs sont obligatoires</p>
            </div>
            ${g}
        </fieldset>
        `,Y=stringToHTML(H);const ee=Y.attachShadow({mode:"open"});ee.innerHTML=H.trim();var te=ee.getElementById(f);te&&te.addEventListener("click",tt=>{this.onShowFormDrawingReportingClick(tt)});var xe=ee.getElementById(n);xe&&xe.addEventListener("change",tt=>{this.onEntryFormNameReportingChange(tt)});var ne=ee.getElementById(l);ne&&ne.addEventListener("change",tt=>{this.onSelectFormThemeReportingChange(tt)});var et=ee.getElementById(u);return et&&et.addEventListener("change",tt=>{this.onEntryFormDescReportingChange(tt)}),i.appendChild(ee),i},_createReportingSubmitFormElement:function(){var s=document.createElement("input");return s.id=this._addUID("GPreportingSubmit"),s.className="gpf-btn fr-btn gpf-hidden",s.type="submit",s.value="",s},_createReportingPanelDrawingElement:function(){var s=document.createElement("div");return s.id=this._addUID("GPreportingPanelDrawing"),s.className="gpf-panel__content fr-modal__content gpf-hidden",s},_createReportingPanelSendElement:function(){var s=document.createElement("div");s.id=this._addUID("GPreportingPanelSend"),s.className="gpf-panel__content fr-modal__content fr-px-3w gpf-hidden";var e=this._addUID("GPreportingLabelEmail"),i=`
        <div class="fr-input-group">
            <label class="gpf-label fr-label" for="${e}">Adresse courriel
                <span class="fr-hint-text">Pour valider le signalement, renseignez votre adresse courriel. Nous vous tiendrons informs de sa prise en compte.</span>
            </label>
            <input class="gpf-input fr-input" type="text" id="${e}" name="GPreportingLabelEmail" required>
        </div>
        `,n=this._addUID("GPreportingButtonEnvoyer"),o=`
        <div class="gpf-btn-group fr-pb-1w">
            <button id="${n}" class="gpf-btn fr-btn fr-btn--primary">
                Envoyer
            </button>
        </div>
        `,l=`
        <fieldset class="fr-fieldset" id="GPreportingSendFieldset" role="group" aria-labelledby="GPreportingSendFieldsetMessages">
            ${i}
            ${o}
            <div class="fr-messages-group gpf-hidden" id="GPreportingSendFieldsetMessages" aria-live="polite">
                <p class="fr-message fr-message--error" id="GPreportingSendFieldsetMessage">Le champ est obligatoire</p>
            </div>
        </fieldset>
        `,c=stringToHTML(l);const u=c.attachShadow({mode:"open"});u.innerHTML=l.trim();var h=u.getElementById(n);h&&h.addEventListener("click",g=>{this.onShowSendReportingClick({target:g.target,mail:document.getElementById(e).value})});var f=u.getElementById(e);return f&&f.addEventListener("change",g=>{this.onEntrySendMailReportingChange(g)}),s.appendChild(u),s},_createReportingErrorSendElement:function(){var s=this._addUID("GPreportingSpanError"),e=document.createElement("span");return e.id=s,e.className="gpf-error fr-error fr-error-text gpf-hidden",e.innerHTML="Une erreur est survenue lors de l'envoi du signalement. <br> Veuillez ressayer plus tard.",e}},logger=LoggerByDefault.getLogger("reporting");class InputActionByDefaut{constructor(e){logger.info("InputActionByDefaut constructor"),this.map=e||null,this.data=null,this.coordinate=null,this.listener=null,this.icon="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAzNiIgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4Ij48cGF0aCBmaWxsPSIjMDAwMDkxIiBkPSJNMTguMzY0IDMuNjM2YTkgOSAwIDAgMSAwIDEyLjcyOEwxMiAyMi43MjhsLTYuMzY0LTYuMzY0QTkgOSAwIDAgMSAxOC4zNjQgMy42MzZaTTEyIDhhMiAyIDAgMSAwIDAgNCAyIDIgMCAwIDAgMC00WiIvPjwvc3ZnPg=="}setMap(e){logger.info("InputActionByDefaut map"),this.map=e}setIcon(e){logger.info("InputActionByDefaut icon"),e&&(this.icon=e)}getData(){logger.info("InputActionByDefaut data");var e=this.map.getView().getProjection();this.coordinate||(this.coordinate=this.map.getView().getCenter());var i={type:"FeatureCollection",crs:{type:"name",properties:{name:e.getCode()}},features:[{type:"Feature",crs:{type:"name",properties:{name:e.getCode()}},geometry:{type:"Point",coordinates:this.coordinate||[0,0]},properties:{description:"Point de signalement",date:new Date().toISOString(),author:"Anonyme"}}]};return this.data={location:i},this.data||{location:null}}clear(){logger.info("InputActionByDefaut clear"),this.data=null,this.coordinate=null,this.listener&&(unByKey(this.listener),this.listener=null),this.marker!=null&&(this.map.removeOverlay(this.marker),this.marker=null)}active(){this._addEventsListeners()}disable(){this._removeEventsListeners()}_addEventsListeners(){logger.info("InputActionByDefaut active"),this.map&&(this.listener=this.map.on("singleclick",this._handler.bind(this)))}_removeEventsListeners(){logger.info("InputActionByDefaut disable"),this.map&&unByKey(this.listener)}_handler(e){if(logger.info("InputActionByDefaut handler",e),!!this.map){this.coordinate=e.coordinate,this.marker!=null&&(this.map.removeOverlay(this.marker),this.marker=null);var i=document.createElement("img");i.src=this.icon,this.marker=new Overlay({position:this.coordinate,positioning:"center-center",element:i,stopEvent:!1}),this.map.addOverlay(this.marker)}}}class FormActionByDefaut{constructor(e){logger.info("FormActionByDefaut constructor"),this.data=null,this.form=null,this.submit=null,this.error=null,this.message=null}active(){logger.info("FormActionByDefaut active"),this._addEventsListeners()}disable(){logger.info("FormActionByDefaut disable")}setForm(e){logger.info("FormActionByDefaut form"),this.form=e,this.submit=this.form.querySelector('input[type="submit"]'),this.error=this.form.querySelector("#GPreportingFormFieldset"),this.message=this.form.querySelector("#GPreportingFormFieldsetMessages")}getData(){return logger.info("FormActionByDefaut data"),this.submit.click(),this.data?(this.error.classList.remove("fr-fieldset--error"),this.message.classList.replace("gpf-visible","gpf-hidden")):(this.error.classList.add("fr-fieldset--error"),this.message.classList.replace("gpf-hidden","gpf-visible")),this.data}clear(){logger.info("FormActionByDefaut clear"),this.data=null}_addEventsListeners(){this.form.addEventListener("submit",this._handler.bind(this),{once:!0})}_handler(e){logger.info("FormActionByDefaut handler",e),e.preventDefault();var i=new FormData(e.target),n=i.get("GPreportingLabelName"),o=i.get("GPreportingTextDesc"),l=i.get("GPreportingSelectTheme");return n&&o&&l&&(this.data={name:n,desc:o,theme:l}),!1}}class DrawingActionByDefaut{constructor(e){logger.info("DrawingActionByDefaut constructor"),this.data=null,this.format="geojson",this.map=e||null,this.dom=null,this.Drawing=null,this.DrawingBtn=null,this.DrawingPanel=null}active(){logger.info("ServiceActionByDefaut active"),this.Drawing||this._initializeDrawing(),this.Drawing.setCollapsed(!1),this.DrawingPanel.style.position="relative",this.DrawingPanel.style.left="0px",this.DrawingPanel.style.top="0px",this.DrawingPanel.style.bottom="unset",this.DrawingPanel.style.right="unset"}disable(){logger.info("DrawingActionByDefaut disable"),this.Drawing&&this.Drawing.setCollapsed(!0)}clear(){logger.info("DrawingActionByDefaut clear"),this.data=null}getData(){if(logger.info("DrawingActionByDefaut data"),this.Drawing){var e=this.Drawing.exportFeatures();this.data={drawing:this.format.toLowerCase()==="geojson"?JSON.parse(e):e}}return this.data||{drawing:null}}setMap(e){logger.info("DrawingActionByDefaut map"),this.map=e}setTarget(e){if(logger.info("DrawingActionByDefaut target"),!e){logger.warn("DrawingActionByDefaut target is null");return}this.dom=e}setFormat(e){logger.info("DrawingActionByDefaut format"),e&&(this.format=e)}_initializeDrawing(){if(logger.info("DrawingActionByDefaut initializeDrawing"),!!this.map){var e=1e3;this.Drawing=new Drawing({target:this.dom,id:e,layerDescription:{title:"Signalement",description:"Dessin de signalement"},popup:{display:!1},tools:{export:!1}}),this.Drawing.setExportFormat(this.format);var i=this.Drawing.getContainer();i.className="";var n=this.DrawingBtn=i.querySelector("#GPshowDrawingPicto-"+e);n&&(n.style.display="none");var o=this.DrawingPanel=i.querySelector("#GPdrawingPanel-"+e);o&&(o.style.position="relative",o.style.left="0px",o.style.top="0px",o.style.bottom="unset",o.style.right="unset",o.style.margin="auto");var l=i.querySelector(".gpf-panel__header");l&&(l.style.display="none"),this.map.addControl(this.Drawing)}}}class ServiceActionByDefaut{constructor(){logger.info("ServiceActionByDefaut constructor")}active(){logger.info("ServiceActionByDefaut active")}disable(){logger.info("ServiceActionByDefaut disable")}send(e){return logger.info("ServiceActionByDefaut send"),Promise.reject(new Error("ServiceActionByDefaut send not implemented"))}clear(){logger.info("ServiceActionByDefaut clear")}}var Ri,Zi,Ji;const Hi=class Hi extends ControlExtended{constructor(i){i=i||{};super({element:i.element,target:i.target,render:i.render});Ui(this,Ri);if(!(this instanceof Hi))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return Li(this,Ri,Zi).call(this,i),this.container=Li(this,Ri,Ji).call(this),this.element?this.element.appendChild(this.container):this.element=this.container,this}setMap(i){i?(this.setStep(0),this._setComponents(i),this.draggable&&Draggable.dragElement(this.panelReportingContainer,this.panelReportingHeaderContainer,this.options.position?null:i.getTargetElement()),this.collapsed||this.buttonReportingShow.click(),this.auto&&this._addEventsListeners(i)):this.auto&&this._removeEventsListeners(),super.setMap(i),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getContainer(){return this.container}getCollapsed(){return this.collapsed}setCollapsed(i){i!==void 0&&(i&&this.collapsed||!i&&!this.collapsed||(i?this.buttonReportingClose.click():this.buttonReportingShow.click(),this.collapsed=i))}_setComponents(i){this.iocInput||(this.iocInput=new InputActionByDefaut),this.iocInput.setMap(i),this.iocInput.setIcon(this.options.icon||null),this.iocForm||(this.iocForm=new FormActionByDefaut),this.iocForm.setForm(this.formReportingContainer),this.iocService||(this.iocService=new ServiceActionByDefaut),this.iocDrawing||(this.iocDrawing=new DrawingActionByDefaut),this.iocDrawing.setFormat(this.options.format||"geojson"),this.iocDrawing.setMap(i),this.iocDrawing.setTarget(this.drawingReportingContainer),this.stepContainer[0].action=this.iocInput,this.stepContainer[1].action=this.iocForm,this.stepContainer[2].action=this.iocService,this.stepContainer[3].action=this.iocDrawing}setComponentInput(i){this.iocInput=i}setComponentForm(i){this.iocForm=i}setComponentService(i){this.iocService=i}setComponentDrawing(i){this.iocDrawing=i}_addEventsListeners(i){this.eventsListeners["custom:action"]=function(n){logger.trace(n)},i.getLayers().on("some:event",this.eventsListeners["custom:action"])}_removeEventsListeners(){var i=this.getMap();i.getLayers().un("some:event",this.eventsListeners["custom:action"]),delete this.eventsListeners["custom:action"]}setStep(i){if(i!==void 0){for(let l=0;l<this.stepContainer.length;l++){this.stepContainer[l].container.classList.replace("gpf-visible","gpf-hidden");var o=this.stepContainer[l].action;o&&(o.disable(),o.clear())}this.step=i;var n=this.stepContainer[i].container;n.classList.replace("gpf-hidden","gpf-visible");var o=this.stepContainer[i].action;o&&o.active(),this.divReportingTitle.innerHTML=this.stepContainer[i].name,this.panelReportingFooterContainer.style.display=this.stepContainer[i].footer?"flex":"none",this.reportingBtnAnnulerFooter.style.display=this.stepContainer[i].prev===-1?"none":"flex",this.reportingBtnSuivantFooter.style.display=this.stepContainer[i].next===-1?"none":"flex",this.labelReportingIcon.style.display=this.stepContainer[i].prev===-1?"none":"flex"}}nextStep(){var i=this.step,n=this.stepContainer[i].next;if(n!==-1){var o=this.stepContainer[i].action;if(o){var l=o.getData();if(!l)return;logger.trace("Reporting nextStep",l),this.data=Object.assign({},this.data,l),o.disable(),o.clear()}this.setStep(n)}}prevStep(){var i=this.step,n=this.stepContainer[i].prev;if(n!==-1){var o=this.stepContainer[i].action;o&&o.clear(),this.setStep(n)}}clear(){for(let c=0;c<this.stepContainer.length;c++){this.stepContainer[c].container.classList.replace("gpf-visible","gpf-hidden");var i=this.stepContainer[c].action;i&&(i.disable(),i.clear())}var n=this.iocDrawing.Drawing;if(n){var o=n.getLayer(),l=this.getMap();o&&(l.removeLayer(o),n.setLayer())}}onShowReportingClick(i){logger.trace("onShowReportingClick",i);var n=this.buttonReportingShow.ariaPressed;n==="true"&&this.onPanelOpen(),this.collapsed=n!=="true",this.dispatchEvent("change:collapsed"),this.collapsed?this.clear():(this.setStep(0),this.dispatchEvent(this.OPENED_REPORTING_EVENT))}onPrevReportingClick(i){logger.trace("onPrevReportingClick",i),this.prevStep()}onNextReportingClick(i){logger.trace("onNextReportingClick",i),this.nextStep()}onCloseReportingClick(i){logger.trace("onCloseReportingClick",i),this.clear()}onCancelReportingClick(i){logger.trace("onCancelReportingClick",i),this.clear(),this.setStep(0)}onReportingFormSubmit(i){logger.trace("onReportingFormSubmit",i)}onShowFormDrawingReportingClick(i){logger.trace("onShowFormDrawingReportingClick",i),this.setStep(3)}onEntryFormNameReportingChange(i){logger.trace("onEntryFormNameReportingChange",i)}onSelectFormThemeReportingChange(i){logger.trace("onSelectFormThemeReportingChange",i)}onEntryFormDescReportingChange(i){logger.trace("onEntryFormDescReportingChange",i)}onEntrySendMailReportingChange(i){logger.trace("onEntrySendMailReportingChange",i)}onShowSendReportingClick(i){logger.trace("onShowSendReportingClick",i),this.data=Object.assign({},this.data,{mail:i.mail});var n=this.sendReportingContainer.querySelector("#GPreportingSendFieldset"),o=this.sendReportingContainer.querySelector("#GPreportingSendFieldsetMessages");if(i.mail)n.classList.remove("fr-fieldset--error"),o.classList.replace("gpf-visible","gpf-hidden");else{n.classList.add("fr-fieldset--error"),o.classList.replace("gpf-hidden","gpf-visible");return}logger.info("Reporting data to send:",this.data),this.iocService.send(this.data).then(()=>{this.data=null;var l=this.iocDrawing.Drawing;if(l){var c=l.getLayer(),u=this.getMap();c&&(u.removeLayer(c),l.setLayer())}}).then(()=>{this.setStep(0)}).then(()=>{this.dispatchEvent({type:this.SEND_REPORTING_EVENT,data:this.data})}).catch(l=>{this.spanReportingError.classList.replace("gpf-hidden","gpf-visible"),setTimeout(()=>{this.spanReportingError.classList.replace("gpf-visible","gpf-hidden")},5e3),logger.error(l)})}};Ri=new WeakSet,Zi=function(i){this.uid=SelectorID.generate(),this.options={collapsed:!0,draggable:!1,auto:!0,thematics:["Rseau routier","Btiment","Toponyme","Touristique/randonne","Borne cadastrale","Hydrographie","Vgtation","Autre"]},Helper.assign(this.options,i),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this.auto=this.options.auto,this.buttonReportingShow=null,this.panelReportingContainer=null,this.panelReportingHeaderContainer=null,this.panelReportingFooterContainer=null,this.reportingBtnAnnulerFooter=null,this.reportingBtnSuivantFooter=null,this.buttonReportingClose=null,this.divReportingTitle=null,this.labelReportingIcon=null,this.buttonReportingSubmit=null,this.spanReportingError=null,this.inputReportingContainer=null,this.formReportingContainer=null,this.sendReportingContainer=null,this.drawingReportingContainer=null,this.step=0,this.stepContainer=[{name:"",footer:!0,header:!0,next:1,prev:-1,action:null,container:null},{name:"Dcrire le signalement",footer:!0,header:!0,next:2,prev:0,action:null,container:null},{name:"Envoyer un signalement",footer:!1,header:!0,next:-1,prev:1,action:null,container:null},{name:"Dessiner sur la carte",footer:!0,header:!0,next:1,prev:1,action:null,container:null}],this.iocInput=null,this.iocForm=null,this.iocService=null,this.iocDrawing=null,this.data=null,this.eventsListeners=[],this.OPENED_REPORTING_EVENT="reporting:opened",this.SEND_REPORTING_EVENT="reporting:sending"},Ji=function(){var i=this._createMainContainerElement(),n=this.buttonReportingShow=this._createShowReportingPictoElement();i.appendChild(n);var o=this.panelReportingContainer=this._createReportingPanelElement(),l=this._createReportingPanelDivElement();o.appendChild(l);var c=this.panelReportingHeaderContainer=this._createReportingPanelHeaderElement(),u=this.labelReportingIcon=this._createReportingPanelIconElement();c.appendChild(u);var h=this.divReportingTitle=this._createReportingPanelTitleElement();c.appendChild(h);var f=this.buttonReportingClose=this._createReportingPanelCloseElement();c.appendChild(f);var g=this.panelReportingFooterContainer=this._createReportingPanelFooterElement(),H=this.reportingBtnAnnulerFooter=this._createReportingButtonAnnulerFooterElement(),Y=this.reportingBtnSuivantFooter=this._createReportingButtonSuivantFooterElement();g.appendChild(H),g.appendChild(Y);var ee=this.inputReportingContainer=this._createReportingPanelInputElement();this.stepContainer[0].container=ee;var te=this.formReportingContainer=this._createReportingPanelFormElement(this.options.thematics);this.stepContainer[1].container=te;var xe=this.sendReportingContainer=this._createReportingPanelSendElement();this.stepContainer[2].container=xe;var ne=this.drawingReportingContainer=this._createReportingPanelDrawingElement();this.stepContainer[3].container=ne;var et=this.buttonReportingSubmit=this._createReportingSubmitFormElement();te.appendChild(et);var tt=this.spanReportingError=this._createReportingErrorSendElement();return xe.appendChild(tt),l.appendChild(c),l.appendChild(ee),l.appendChild(te),l.appendChild(xe),l.appendChild(ne),l.appendChild(g),i.appendChild(o),logger.log(i),i};let Reporting=Hi;Object.assign(Reporting.prototype,ReportingDOM);Object.assign(Reporting.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.Reporting=Reporting);var ajv={exports:{}},core$1={};const $id$7="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description="Meta-schema for $data reference (JSON AnySchema extension proposal)",type$7="object",required$5=["$data"],properties$6={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties$4=!1,require$$9={$id:$id$7,description,type:type$7,required:required$5,properties:properties$6,additionalProperties:additionalProperties$4};var uri={},fastUri={exports:{}},utils,hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1;const s=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),e=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function i(Y){let ee="",te=0,xe=0;for(xe=0;xe<Y.length;xe++)if(te=Y[xe].charCodeAt(0),te!==48){if(!(te>=48&&te<=57||te>=65&&te<=70||te>=97&&te<=102))return"";ee+=Y[xe];break}for(xe+=1;xe<Y.length;xe++){if(te=Y[xe].charCodeAt(0),!(te>=48&&te<=57||te>=65&&te<=70||te>=97&&te<=102))return"";ee+=Y[xe]}return ee}const n=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function o(Y){return Y.length=0,!0}function l(Y,ee,te){if(Y.length){const xe=i(Y);if(xe!=="")ee.push(xe);else return te.error=!0,!1;Y.length=0}return!0}function c(Y){let ee=0;const te={error:!1,address:"",zone:""},xe=[],ne=[];let et=!1,tt=!1,it=l;for(let rt=0;rt<Y.length;rt++){const nt=Y[rt];if(!(nt==="["||nt==="]"))if(nt===":"){if(et===!0&&(tt=!0),!it(ne,xe,te))break;if(++ee>7){te.error=!0;break}rt>0&&Y[rt-1]===":"&&(et=!0),xe.push(":");continue}else if(nt==="%"){if(!it(ne,xe,te))break;it=o}else{ne.push(nt);continue}}return ne.length&&(it===o?te.zone=ne.join(""):tt?xe.push(ne.join("")):xe.push(i(ne))),te.address=xe.join(""),te}function u(Y){if(h(Y,":")<2)return{host:Y,isIPV6:!1};const ee=c(Y);if(ee.error)return{host:Y,isIPV6:!1};{let te=ee.address,xe=ee.address;return ee.zone&&(te+="%"+ee.zone,xe+="%25"+ee.zone),{host:te,isIPV6:!0,escapedHost:xe}}}function h(Y,ee){let te=0;for(let xe=0;xe<Y.length;xe++)Y[xe]===ee&&te++;return te}function f(Y){let ee=Y;const te=[];let xe=-1,ne=0;for(;ne=ee.length;){if(ne===1){if(ee===".")break;if(ee==="/"){te.push("/");break}else{te.push(ee);break}}else if(ne===2){if(ee[0]==="."){if(ee[1]===".")break;if(ee[1]==="/"){ee=ee.slice(2);continue}}else if(ee[0]==="/"&&(ee[1]==="."||ee[1]==="/")){te.push("/");break}}else if(ne===3&&ee==="/.."){te.length!==0&&te.pop(),te.push("/");break}if(ee[0]==="."){if(ee[1]==="."){if(ee[2]==="/"){ee=ee.slice(3);continue}}else if(ee[1]==="/"){ee=ee.slice(2);continue}}else if(ee[0]==="/"&&ee[1]==="."){if(ee[2]==="/"){ee=ee.slice(2);continue}else if(ee[2]==="."&&ee[3]==="/"){ee=ee.slice(3),te.length!==0&&te.pop();continue}}if((xe=ee.indexOf("/",1))===-1){te.push(ee);break}else te.push(ee.slice(0,xe)),ee=ee.slice(xe)}return te.join("")}function g(Y,ee){const te=ee!==!0?escape:unescape;return Y.scheme!==void 0&&(Y.scheme=te(Y.scheme)),Y.userinfo!==void 0&&(Y.userinfo=te(Y.userinfo)),Y.host!==void 0&&(Y.host=te(Y.host)),Y.path!==void 0&&(Y.path=te(Y.path)),Y.query!==void 0&&(Y.query=te(Y.query)),Y.fragment!==void 0&&(Y.fragment=te(Y.fragment)),Y}function H(Y){const ee=[];if(Y.userinfo!==void 0&&(ee.push(Y.userinfo),ee.push("@")),Y.host!==void 0){let te=unescape(Y.host);if(!e(te)){const xe=u(te);xe.isIPV6===!0?te=`[${xe.escapedHost}]`:te=Y.host}ee.push(te)}return(typeof Y.port=="number"||typeof Y.port=="string")&&(ee.push(":"),ee.push(String(Y.port))),ee.length?ee.join(""):void 0}return utils={nonSimpleDomain:n,recomposeAuthority:H,normalizeComponentEncoding:g,removeDotSegments:f,isIPv4:e,isUUID:s,normalizeIPv6:u,stringArrayToHexStripped:i},utils}var schemes,hasRequiredSchemes;function requireSchemes(){if(hasRequiredSchemes)return schemes;hasRequiredSchemes=1;const{isUUID:s}=requireUtils(),e=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,i=["http","https","ws","wss","urn","urn:uuid"];function n(nt){return i.indexOf(nt)!==-1}function o(nt){return nt.secure===!0?!0:nt.secure===!1?!1:nt.scheme?nt.scheme.length===3&&(nt.scheme[0]==="w"||nt.scheme[0]==="W")&&(nt.scheme[1]==="s"||nt.scheme[1]==="S")&&(nt.scheme[2]==="s"||nt.scheme[2]==="S"):!1}function l(nt){return nt.host||(nt.error=nt.error||"HTTP URIs must have a host."),nt}function c(nt){const st=String(nt.scheme).toLowerCase()==="https";return(nt.port===(st?443:80)||nt.port==="")&&(nt.port=void 0),nt.path||(nt.path="/"),nt}function u(nt){return nt.secure=o(nt),nt.resourceName=(nt.path||"/")+(nt.query?"?"+nt.query:""),nt.path=void 0,nt.query=void 0,nt}function h(nt){if((nt.port===(o(nt)?443:80)||nt.port==="")&&(nt.port=void 0),typeof nt.secure=="boolean"&&(nt.scheme=nt.secure?"wss":"ws",nt.secure=void 0),nt.resourceName){const[st,at]=nt.resourceName.split("?");nt.path=st&&st!=="/"?st:void 0,nt.query=at,nt.resourceName=void 0}return nt.fragment=void 0,nt}function f(nt,st){if(!nt.path)return nt.error="URN can not be parsed",nt;const at=nt.path.match(e);if(at){const ot=st.scheme||nt.scheme||"urn";nt.nid=at[1].toLowerCase(),nt.nss=at[2];const ct=`${ot}:${st.nid||nt.nid}`,ht=rt(ct);nt.path=void 0,ht&&(nt=ht.parse(nt,st))}else nt.error=nt.error||"URN can not be parsed.";return nt}function g(nt,st){if(nt.nid===void 0)throw new Error("URN without nid cannot be serialized");const at=st.scheme||nt.scheme||"urn",ot=nt.nid.toLowerCase(),ct=`${at}:${st.nid||ot}`,ht=rt(ct);ht&&(nt=ht.serialize(nt,st));const ut=nt,pt=nt.nss;return ut.path=`${ot||st.nid}:${pt}`,st.skipEscape=!0,ut}function H(nt,st){const at=nt;return at.uuid=at.nss,at.nss=void 0,!st.tolerant&&(!at.uuid||!s(at.uuid))&&(at.error=at.error||"UUID is not valid."),at}function Y(nt){const st=nt;return st.nss=(nt.uuid||"").toLowerCase(),st}const ee={scheme:"http",domainHost:!0,parse:l,serialize:c},te={scheme:"https",domainHost:ee.domainHost,parse:l,serialize:c},xe={scheme:"ws",domainHost:!0,parse:u,serialize:h},ne={scheme:"wss",domainHost:xe.domainHost,parse:xe.parse,serialize:xe.serialize},it={http:ee,https:te,ws:xe,wss:ne,urn:{scheme:"urn",parse:f,serialize:g,skipNormalize:!0},"urn:uuid":{scheme:"urn:uuid",parse:H,serialize:Y,skipNormalize:!0}};Object.setPrototypeOf(it,null);function rt(nt){return nt&&(it[nt]||it[nt.toLowerCase()])||void 0}return schemes={wsIsSecure:o,SCHEMES:it,isValidSchemeName:n,getSchemeHandler:rt},schemes}var hasRequiredFastUri;function requireFastUri(){if(hasRequiredFastUri)return fastUri.exports;hasRequiredFastUri=1;const{normalizeIPv6:s,removeDotSegments:e,recomposeAuthority:i,normalizeComponentEncoding:n,isIPv4:o,nonSimpleDomain:l}=requireUtils(),{SCHEMES:c,getSchemeHandler:u}=requireSchemes();function h(ne,et){return typeof ne=="string"?ne=Y(te(ne,et),et):typeof ne=="object"&&(ne=te(Y(ne,et),et)),ne}function f(ne,et,tt){const it=tt?Object.assign({scheme:"null"},tt):{scheme:"null"},rt=g(te(ne,it),te(et,it),it,!0);return it.skipEscape=!0,Y(rt,it)}function g(ne,et,tt,it){const rt={};return it||(ne=te(Y(ne,tt),tt),et=te(Y(et,tt),tt)),tt=tt||{},!tt.tolerant&&et.scheme?(rt.scheme=et.scheme,rt.userinfo=et.userinfo,rt.host=et.host,rt.port=et.port,rt.path=e(et.path||""),rt.query=et.query):(et.userinfo!==void 0||et.host!==void 0||et.port!==void 0?(rt.userinfo=et.userinfo,rt.host=et.host,rt.port=et.port,rt.path=e(et.path||""),rt.query=et.query):(et.path?(et.path[0]==="/"?rt.path=e(et.path):((ne.userinfo!==void 0||ne.host!==void 0||ne.port!==void 0)&&!ne.path?rt.path="/"+et.path:ne.path?rt.path=ne.path.slice(0,ne.path.lastIndexOf("/")+1)+et.path:rt.path=et.path,rt.path=e(rt.path)),rt.query=et.query):(rt.path=ne.path,et.query!==void 0?rt.query=et.query:rt.query=ne.query),rt.userinfo=ne.userinfo,rt.host=ne.host,rt.port=ne.port),rt.scheme=ne.scheme),rt.fragment=et.fragment,rt}function H(ne,et,tt){return typeof ne=="string"?(ne=unescape(ne),ne=Y(n(te(ne,tt),!0),{...tt,skipEscape:!0})):typeof ne=="object"&&(ne=Y(n(ne,!0),{...tt,skipEscape:!0})),typeof et=="string"?(et=unescape(et),et=Y(n(te(et,tt),!0),{...tt,skipEscape:!0})):typeof et=="object"&&(et=Y(n(et,!0),{...tt,skipEscape:!0})),ne.toLowerCase()===et.toLowerCase()}function Y(ne,et){const tt={host:ne.host,scheme:ne.scheme,userinfo:ne.userinfo,port:ne.port,path:ne.path,query:ne.query,nid:ne.nid,nss:ne.nss,uuid:ne.uuid,fragment:ne.fragment,reference:ne.reference,resourceName:ne.resourceName,secure:ne.secure,error:""},it=Object.assign({},et),rt=[],nt=u(it.scheme||tt.scheme);nt&&nt.serialize&&nt.serialize(tt,it),tt.path!==void 0&&(it.skipEscape?tt.path=unescape(tt.path):(tt.path=escape(tt.path),tt.scheme!==void 0&&(tt.path=tt.path.split("%3A").join(":")))),it.reference!=="suffix"&&tt.scheme&&rt.push(tt.scheme,":");const st=i(tt);if(st!==void 0&&(it.reference!=="suffix"&&rt.push("//"),rt.push(st),tt.path&&tt.path[0]!=="/"&&rt.push("/")),tt.path!==void 0){let at=tt.path;!it.absolutePath&&(!nt||!nt.absolutePath)&&(at=e(at)),st===void 0&&at[0]==="/"&&at[1]==="/"&&(at="/%2F"+at.slice(2)),rt.push(at)}return tt.query!==void 0&&rt.push("?",tt.query),tt.fragment!==void 0&&rt.push("#",tt.fragment),rt.join("")}const ee=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function te(ne,et){const tt=Object.assign({},et),it={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0};let rt=!1;tt.reference==="suffix"&&(tt.scheme?ne=tt.scheme+":"+ne:ne="//"+ne);const nt=ne.match(ee);if(nt){if(it.scheme=nt[1],it.userinfo=nt[3],it.host=nt[4],it.port=parseInt(nt[5],10),it.path=nt[6]||"",it.query=nt[7],it.fragment=nt[8],isNaN(it.port)&&(it.port=nt[5]),it.host)if(o(it.host)===!1){const ot=s(it.host);it.host=ot.host.toLowerCase(),rt=ot.isIPV6}else rt=!0;it.scheme===void 0&&it.userinfo===void 0&&it.host===void 0&&it.port===void 0&&it.query===void 0&&!it.path?it.reference="same-document":it.scheme===void 0?it.reference="relative":it.fragment===void 0?it.reference="absolute":it.reference="uri",tt.reference&&tt.reference!=="suffix"&&tt.reference!==it.reference&&(it.error=it.error||"URI is not a "+tt.reference+" reference.");const st=u(tt.scheme||it.scheme);if(!tt.unicodeSupport&&(!st||!st.unicodeSupport)&&it.host&&(tt.domainHost||st&&st.domainHost)&&rt===!1&&l(it.host))try{it.host=URL.domainToASCII(it.host.toLowerCase())}catch(at){it.error=it.error||"Host's domain name can not be converted to ASCII: "+at}(!st||st&&!st.skipNormalize)&&(ne.indexOf("%")!==-1&&(it.scheme!==void 0&&(it.scheme=unescape(it.scheme)),it.host!==void 0&&(it.host=unescape(it.host))),it.path&&(it.path=escape(unescape(it.path))),it.fragment&&(it.fragment=encodeURI(decodeURIComponent(it.fragment)))),st&&st.parse&&st.parse(it,tt)}else it.error=it.error||"URI can not be parsed.";return it}const xe={SCHEMES:c,normalize:h,resolve:f,resolveComponent:g,equal:H,serialize:Y,parse:te};return fastUri.exports=xe,fastUri.exports.default=xe,fastUri.exports.fastUri=xe,fastUri.exports}var hasRequiredUri;function requireUri(){if(hasRequiredUri)return uri;hasRequiredUri=1,Object.defineProperty(uri,"__esModule",{value:!0});const s=requireFastUri();return s.code='require("ajv/dist/runtime/uri").default',uri.default=s,uri}var hasRequiredCore$1;function requireCore$1(){return hasRequiredCore$1||(hasRequiredCore$1=1,(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.CodeGen=s.Name=s.nil=s.stringify=s.str=s._=s.KeywordCxt=void 0;var e=requireValidate();Object.defineProperty(s,"KeywordCxt",{enumerable:!0,get:function(){return e.KeywordCxt}});var i=requireCodegen();Object.defineProperty(s,"_",{enumerable:!0,get:function(){return i._}}),Object.defineProperty(s,"str",{enumerable:!0,get:function(){return i.str}}),Object.defineProperty(s,"stringify",{enumerable:!0,get:function(){return i.stringify}}),Object.defineProperty(s,"nil",{enumerable:!0,get:function(){return i.nil}}),Object.defineProperty(s,"Name",{enumerable:!0,get:function(){return i.Name}}),Object.defineProperty(s,"CodeGen",{enumerable:!0,get:function(){return i.CodeGen}});const n=requireValidation_error(),o=requireRef_error(),l=requireRules(),c=requireCompile(),u=requireCodegen(),h=requireResolve(),f=requireDataType(),g=requireUtil(),H=require$$9,Y=requireUri(),ee=(vt,Et)=>new RegExp(vt,Et);ee.code="new RegExp";const te=["removeAdditional","useDefaults","coerceTypes"],xe=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),ne={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},et={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},tt=200;function it(vt){var Et,Ct,_t,dt,ft,bt,Gt,Ft,Ht,Mt,It,xt,Tt,Ut,Dt,$t,Zt,Kt,qt,Xt,zt,ai,wt,Ot,kt;const Bt=vt.strict,jt=(Et=vt.code)===null||Et===void 0?void 0:Et.optimize,Wt=jt===!0||jt===void 0?1:jt||0,Vt=(_t=(Ct=vt.code)===null||Ct===void 0?void 0:Ct.regExp)!==null&&_t!==void 0?_t:ee,Yt=(dt=vt.uriResolver)!==null&&dt!==void 0?dt:Y.default;return{strictSchema:(bt=(ft=vt.strictSchema)!==null&&ft!==void 0?ft:Bt)!==null&&bt!==void 0?bt:!0,strictNumbers:(Ft=(Gt=vt.strictNumbers)!==null&&Gt!==void 0?Gt:Bt)!==null&&Ft!==void 0?Ft:!0,strictTypes:(Mt=(Ht=vt.strictTypes)!==null&&Ht!==void 0?Ht:Bt)!==null&&Mt!==void 0?Mt:"log",strictTuples:(xt=(It=vt.strictTuples)!==null&&It!==void 0?It:Bt)!==null&&xt!==void 0?xt:"log",strictRequired:(Ut=(Tt=vt.strictRequired)!==null&&Tt!==void 0?Tt:Bt)!==null&&Ut!==void 0?Ut:!1,code:vt.code?{...vt.code,optimize:Wt,regExp:Vt}:{optimize:Wt,regExp:Vt},loopRequired:(Dt=vt.loopRequired)!==null&&Dt!==void 0?Dt:tt,loopEnum:($t=vt.loopEnum)!==null&&$t!==void 0?$t:tt,meta:(Zt=vt.meta)!==null&&Zt!==void 0?Zt:!0,messages:(Kt=vt.messages)!==null&&Kt!==void 0?Kt:!0,inlineRefs:(qt=vt.inlineRefs)!==null&&qt!==void 0?qt:!0,schemaId:(Xt=vt.schemaId)!==null&&Xt!==void 0?Xt:"$id",addUsedSchema:(zt=vt.addUsedSchema)!==null&&zt!==void 0?zt:!0,validateSchema:(ai=vt.validateSchema)!==null&&ai!==void 0?ai:!0,validateFormats:(wt=vt.validateFormats)!==null&&wt!==void 0?wt:!0,unicodeRegExp:(Ot=vt.unicodeRegExp)!==null&&Ot!==void 0?Ot:!0,int32range:(kt=vt.int32range)!==null&&kt!==void 0?kt:!0,uriResolver:Yt}}class rt{constructor(Et={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,Et=this.opts={...Et,...it(Et)};const{es5:Ct,lines:_t}=this.opts.code;this.scope=new u.ValueScope({scope:{},prefixes:xe,es5:Ct,lines:_t}),this.logger=pt(Et.logger);const dt=Et.validateFormats;Et.validateFormats=!1,this.RULES=(0,l.getRules)(),nt.call(this,ne,Et,"NOT SUPPORTED"),nt.call(this,et,Et,"DEPRECATED","warn"),this._metaOpts=ht.call(this),Et.formats&&ot.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),Et.keywords&&ct.call(this,Et.keywords),typeof Et.meta=="object"&&this.addMetaSchema(Et.meta),at.call(this),Et.validateFormats=dt}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:Et,meta:Ct,schemaId:_t}=this.opts;let dt=H;_t==="id"&&(dt={...H},dt.id=dt.$id,delete dt.$id),Ct&&Et&&this.addMetaSchema(dt,dt[_t],!1)}defaultMeta(){const{meta:Et,schemaId:Ct}=this.opts;return this.opts.defaultMeta=typeof Et=="object"?Et[Ct]||Et:void 0}validate(Et,Ct){let _t;if(typeof Et=="string"){if(_t=this.getSchema(Et),!_t)throw new Error(`no schema with key or ref "${Et}"`)}else _t=this.compile(Et);const dt=_t(Ct);return"$async"in _t||(this.errors=_t.errors),dt}compile(Et,Ct){const _t=this._addSchema(Et,Ct);return _t.validate||this._compileSchemaEnv(_t)}compileAsync(Et,Ct){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:_t}=this.opts;return dt.call(this,Et,Ct);async function dt(Mt,It){await ft.call(this,Mt.$schema);const xt=this._addSchema(Mt,It);return xt.validate||bt.call(this,xt)}async function ft(Mt){Mt&&!this.getSchema(Mt)&&await dt.call(this,{$ref:Mt},!0)}async function bt(Mt){try{return this._compileSchemaEnv(Mt)}catch(It){if(!(It instanceof o.default))throw It;return Gt.call(this,It),await Ft.call(this,It.missingSchema),bt.call(this,Mt)}}function Gt({missingSchema:Mt,missingRef:It}){if(this.refs[Mt])throw new Error(`AnySchema ${Mt} is loaded but ${It} cannot be resolved`)}async function Ft(Mt){const It=await Ht.call(this,Mt);this.refs[Mt]||await ft.call(this,It.$schema),this.refs[Mt]||this.addSchema(It,Mt,Ct)}async function Ht(Mt){const It=this._loading[Mt];if(It)return It;try{return await(this._loading[Mt]=_t(Mt))}finally{delete this._loading[Mt]}}}addSchema(Et,Ct,_t,dt=this.opts.validateSchema){if(Array.isArray(Et)){for(const bt of Et)this.addSchema(bt,void 0,_t,dt);return this}let ft;if(typeof Et=="object"){const{schemaId:bt}=this.opts;if(ft=Et[bt],ft!==void 0&&typeof ft!="string")throw new Error(`schema ${bt} must be string`)}return Ct=(0,h.normalizeId)(Ct||ft),this._checkUnique(Ct),this.schemas[Ct]=this._addSchema(Et,_t,Ct,dt,!0),this}addMetaSchema(Et,Ct,_t=this.opts.validateSchema){return this.addSchema(Et,Ct,!0,_t),this}validateSchema(Et,Ct){if(typeof Et=="boolean")return!0;let _t;if(_t=Et.$schema,_t!==void 0&&typeof _t!="string")throw new Error("$schema must be a string");if(_t=_t||this.opts.defaultMeta||this.defaultMeta(),!_t)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const dt=this.validate(_t,Et);if(!dt&&Ct){const ft="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(ft);else throw new Error(ft)}return dt}getSchema(Et){let Ct;for(;typeof(Ct=st.call(this,Et))=="string";)Et=Ct;if(Ct===void 0){const{schemaId:_t}=this.opts,dt=new c.SchemaEnv({schema:{},schemaId:_t});if(Ct=c.resolveSchema.call(this,dt,Et),!Ct)return;this.refs[Et]=Ct}return Ct.validate||this._compileSchemaEnv(Ct)}removeSchema(Et){if(Et instanceof RegExp)return this._removeAllSchemas(this.schemas,Et),this._removeAllSchemas(this.refs,Et),this;switch(typeof Et){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const Ct=st.call(this,Et);return typeof Ct=="object"&&this._cache.delete(Ct.schema),delete this.schemas[Et],delete this.refs[Et],this}case"object":{const Ct=Et;this._cache.delete(Ct);let _t=Et[this.opts.schemaId];return _t&&(_t=(0,h.normalizeId)(_t),delete this.schemas[_t],delete this.refs[_t]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(Et){for(const Ct of Et)this.addKeyword(Ct);return this}addKeyword(Et,Ct){let _t;if(typeof Et=="string")_t=Et,typeof Ct=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),Ct.keyword=_t);else if(typeof Et=="object"&&Ct===void 0){if(Ct=Et,_t=Ct.keyword,Array.isArray(_t)&&!_t.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(mt.call(this,_t,Ct),!Ct)return(0,g.eachItem)(_t,ft=>St.call(this,ft)),this;Rt.call(this,Ct);const dt={...Ct,type:(0,f.getJSONTypes)(Ct.type),schemaType:(0,f.getJSONTypes)(Ct.schemaType)};return(0,g.eachItem)(_t,dt.type.length===0?ft=>St.call(this,ft,dt):ft=>dt.type.forEach(bt=>St.call(this,ft,dt,bt))),this}getKeyword(Et){const Ct=this.RULES.all[Et];return typeof Ct=="object"?Ct.definition:!!Ct}removeKeyword(Et){const{RULES:Ct}=this;delete Ct.keywords[Et],delete Ct.all[Et];for(const _t of Ct.rules){const dt=_t.rules.findIndex(ft=>ft.keyword===Et);dt>=0&&_t.rules.splice(dt,1)}return this}addFormat(Et,Ct){return typeof Ct=="string"&&(Ct=new RegExp(Ct)),this.formats[Et]=Ct,this}errorsText(Et=this.errors,{separator:Ct=", ",dataVar:_t="data"}={}){return!Et||Et.length===0?"No errors":Et.map(dt=>`${_t}${dt.instancePath} ${dt.message}`).reduce((dt,ft)=>dt+Ct+ft)}$dataMetaSchema(Et,Ct){const _t=this.RULES.all;Et=JSON.parse(JSON.stringify(Et));for(const dt of Ct){const ft=dt.split("/").slice(1);let bt=Et;for(const Gt of ft)bt=bt[Gt];for(const Gt in _t){const Ft=_t[Gt];if(typeof Ft!="object")continue;const{$data:Ht}=Ft.definition,Mt=bt[Gt];Ht&&Mt&&(bt[Gt]=Nt(Mt))}}return Et}_removeAllSchemas(Et,Ct){for(const _t in Et){const dt=Et[_t];(!Ct||Ct.test(_t))&&(typeof dt=="string"?delete Et[_t]:dt&&!dt.meta&&(this._cache.delete(dt.schema),delete Et[_t]))}}_addSchema(Et,Ct,_t,dt=this.opts.validateSchema,ft=this.opts.addUsedSchema){let bt;const{schemaId:Gt}=this.opts;if(typeof Et=="object")bt=Et[Gt];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof Et!="boolean")throw new Error("schema must be object or boolean")}let Ft=this._cache.get(Et);if(Ft!==void 0)return Ft;_t=(0,h.normalizeId)(bt||_t);const Ht=h.getSchemaRefs.call(this,Et,_t);return Ft=new c.SchemaEnv({schema:Et,schemaId:Gt,meta:Ct,baseId:_t,localRefs:Ht}),this._cache.set(Ft.schema,Ft),ft&&!_t.startsWith("#")&&(_t&&this._checkUnique(_t),this.refs[_t]=Ft),dt&&this.validateSchema(Et,!0),Ft}_checkUnique(Et){if(this.schemas[Et]||this.refs[Et])throw new Error(`schema with key or id "${Et}" already exists`)}_compileSchemaEnv(Et){if(Et.meta?this._compileMetaSchema(Et):c.compileSchema.call(this,Et),!Et.validate)throw new Error("ajv implementation error");return Et.validate}_compileMetaSchema(Et){const Ct=this.opts;this.opts=this._metaOpts;try{c.compileSchema.call(this,Et)}finally{this.opts=Ct}}}rt.ValidationError=n.default,rt.MissingRefError=o.default,s.default=rt;function nt(vt,Et,Ct,_t="error"){for(const dt in vt){const ft=dt;ft in Et&&this.logger[_t](`${Ct}: option ${dt}. ${vt[ft]}`)}}function st(vt){return vt=(0,h.normalizeId)(vt),this.schemas[vt]||this.refs[vt]}function at(){const vt=this.opts.schemas;if(vt)if(Array.isArray(vt))this.addSchema(vt);else for(const Et in vt)this.addSchema(vt[Et],Et)}function ot(){for(const vt in this.opts.formats){const Et=this.opts.formats[vt];Et&&this.addFormat(vt,Et)}}function ct(vt){if(Array.isArray(vt)){this.addVocabulary(vt);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const Et in vt){const Ct=vt[Et];Ct.keyword||(Ct.keyword=Et),this.addKeyword(Ct)}}function ht(){const vt={...this.opts};for(const Et of te)delete vt[Et];return vt}const ut={log(){},warn(){},error(){}};function pt(vt){if(vt===!1)return ut;if(vt===void 0)return console;if(vt.log&&vt.warn&&vt.error)return vt;throw new Error("logger must implement log, warn and error methods")}const yt=/^[a-z_$][a-z0-9_$:-]*$/i;function mt(vt,Et){const{RULES:Ct}=this;if((0,g.eachItem)(vt,_t=>{if(Ct.keywords[_t])throw new Error(`Keyword ${_t} is already defined`);if(!yt.test(_t))throw new Error(`Keyword ${_t} has invalid name`)}),!!Et&&Et.$data&&!("code"in Et||"validate"in Et))throw new Error('$data keyword must have "code" or "validate" function')}function St(vt,Et,Ct){var _t;const dt=Et==null?void 0:Et.post;if(Ct&&dt)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:ft}=this;let bt=dt?ft.post:ft.rules.find(({type:Ft})=>Ft===Ct);if(bt||(bt={type:Ct,rules:[]},ft.rules.push(bt)),ft.keywords[vt]=!0,!Et)return;const Gt={keyword:vt,definition:{...Et,type:(0,f.getJSONTypes)(Et.type),schemaType:(0,f.getJSONTypes)(Et.schemaType)}};Et.before?Pt.call(this,bt,Gt,Et.before):bt.rules.push(Gt),ft.all[vt]=Gt,(_t=Et.implements)===null||_t===void 0||_t.forEach(Ft=>this.addKeyword(Ft))}function Pt(vt,Et,Ct){const _t=vt.rules.findIndex(dt=>dt.keyword===Ct);_t>=0?vt.rules.splice(_t,0,Et):(vt.rules.push(Et),this.logger.warn(`rule ${Ct} is not defined`))}function Rt(vt){let{metaSchema:Et}=vt;Et!==void 0&&(vt.$data&&this.opts.$data&&(Et=Nt(Et)),vt.validateSchema=this.compile(Et,!0))}const Lt={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function Nt(vt){return{anyOf:[vt,Lt]}}})(core$1)),core$1}var draft7={},core={},id={},hasRequiredId;function requireId(){if(hasRequiredId)return id;hasRequiredId=1,Object.defineProperty(id,"__esModule",{value:!0});const s={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};return id.default=s,id}var ref={},hasRequiredRef;function requireRef(){if(hasRequiredRef)return ref;hasRequiredRef=1,Object.defineProperty(ref,"__esModule",{value:!0}),ref.callRef=ref.getValidate=void 0;const s=requireRef_error(),e=requireCode(),i=requireCodegen(),n=requireNames(),o=requireCompile(),l=requireUtil(),c={keyword:"$ref",schemaType:"string",code(f){const{gen:g,schema:H,it:Y}=f,{baseId:ee,schemaEnv:te,validateName:xe,opts:ne,self:et}=Y,{root:tt}=te;if((H==="#"||H==="#/")&&ee===tt.baseId)return rt();const it=o.resolveRef.call(et,tt,ee,H);if(it===void 0)throw new s.default(Y.opts.uriResolver,ee,H);if(it instanceof o.SchemaEnv)return nt(it);return st(it);function rt(){if(te===tt)return h(f,xe,te,te.$async);const at=g.scopeValue("root",{ref:tt});return h(f,(0,i._)`${at}.validate`,tt,tt.$async)}function nt(at){const ot=u(f,at);h(f,ot,at,at.$async)}function st(at){const ot=g.scopeValue("schema",ne.code.source===!0?{ref:at,code:(0,i.stringify)(at)}:{ref:at}),ct=g.name("valid"),ht=f.subschema({schema:at,dataTypes:[],schemaPath:i.nil,topSchemaRef:ot,errSchemaPath:H},ct);f.mergeEvaluated(ht),f.ok(ct)}}};function u(f,g){const{gen:H}=f;return g.validate?H.scopeValue("validate",{ref:g.validate}):(0,i._)`${H.scopeValue("wrapper",{ref:g})}.validate`}ref.getValidate=u;function h(f,g,H,Y){const{gen:ee,it:te}=f,{allErrors:xe,schemaEnv:ne,opts:et}=te,tt=et.passContext?n.default.this:i.nil;Y?it():rt();function it(){if(!ne.$async)throw new Error("async schema referenced by sync schema");const at=ee.let("valid");ee.try(()=>{ee.code((0,i._)`await ${(0,e.callValidateCode)(f,g,tt)}`),st(g),xe||ee.assign(at,!0)},ot=>{ee.if((0,i._)`!(${ot} instanceof ${te.ValidationError})`,()=>ee.throw(ot)),nt(ot),xe||ee.assign(at,!1)}),f.ok(at)}function rt(){f.result((0,e.callValidateCode)(f,g,tt),()=>st(g),()=>nt(g))}function nt(at){const ot=(0,i._)`${at}.errors`;ee.assign(n.default.vErrors,(0,i._)`${n.default.vErrors} === null ? ${ot} : ${n.default.vErrors}.concat(${ot})`),ee.assign(n.default.errors,(0,i._)`${n.default.vErrors}.length`)}function st(at){var ot;if(!te.opts.unevaluated)return;const ct=(ot=H==null?void 0:H.validate)===null||ot===void 0?void 0:ot.evaluated;if(te.props!==!0)if(ct&&!ct.dynamicProps)ct.props!==void 0&&(te.props=l.mergeEvaluated.props(ee,ct.props,te.props));else{const ht=ee.var("props",(0,i._)`${at}.evaluated.props`);te.props=l.mergeEvaluated.props(ee,ht,te.props,i.Name)}if(te.items!==!0)if(ct&&!ct.dynamicItems)ct.items!==void 0&&(te.items=l.mergeEvaluated.items(ee,ct.items,te.items));else{const ht=ee.var("items",(0,i._)`${at}.evaluated.items`);te.items=l.mergeEvaluated.items(ee,ht,te.items,i.Name)}}}return ref.callRef=h,ref.default=c,ref}var hasRequiredCore;function requireCore(){if(hasRequiredCore)return core;hasRequiredCore=1,Object.defineProperty(core,"__esModule",{value:!0});const s=requireId(),e=requireRef(),i=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",s.default,e.default];return core.default=i,core}var validation={},limitNumber={},hasRequiredLimitNumber;function requireLimitNumber(){if(hasRequiredLimitNumber)return limitNumber;hasRequiredLimitNumber=1,Object.defineProperty(limitNumber,"__esModule",{value:!0});const s=requireCodegen(),e=s.operators,i={maximum:{okStr:"<=",ok:e.LTE,fail:e.GT},minimum:{okStr:">=",ok:e.GTE,fail:e.LT},exclusiveMaximum:{okStr:"<",ok:e.LT,fail:e.GTE},exclusiveMinimum:{okStr:">",ok:e.GT,fail:e.LTE}},n={message:({keyword:l,schemaCode:c})=>(0,s.str)`must be ${i[l].okStr} ${c}`,params:({keyword:l,schemaCode:c})=>(0,s._)`{comparison: ${i[l].okStr}, limit: ${c}}`},o={keyword:Object.keys(i),type:"number",schemaType:"number",$data:!0,error:n,code(l){const{keyword:c,data:u,schemaCode:h}=l;l.fail$data((0,s._)`${u} ${i[c].fail} ${h} || isNaN(${u})`)}};return limitNumber.default=o,limitNumber}var multipleOf={},hasRequiredMultipleOf;function requireMultipleOf(){if(hasRequiredMultipleOf)return multipleOf;hasRequiredMultipleOf=1,Object.defineProperty(multipleOf,"__esModule",{value:!0});const s=requireCodegen(),i={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:{message:({schemaCode:n})=>(0,s.str)`must be multiple of ${n}`,params:({schemaCode:n})=>(0,s._)`{multipleOf: ${n}}`},code(n){const{gen:o,data:l,schemaCode:c,it:u}=n,h=u.opts.multipleOfPrecision,f=o.let("res"),g=h?(0,s._)`Math.abs(Math.round(${f}) - ${f}) > 1e-${h}`:(0,s._)`${f} !== parseInt(${f})`;n.fail$data((0,s._)`(${c} === 0 || (${f} = ${l}/${c}, ${g}))`)}};return multipleOf.default=i,multipleOf}var limitLength={},ucs2length={},hasRequiredUcs2length;function requireUcs2length(){if(hasRequiredUcs2length)return ucs2length;hasRequiredUcs2length=1,Object.defineProperty(ucs2length,"__esModule",{value:!0});function s(e){const i=e.length;let n=0,o=0,l;for(;o<i;)n++,l=e.charCodeAt(o++),l>=55296&&l<=56319&&o<i&&(l=e.charCodeAt(o),(l&64512)===56320&&o++);return n}return ucs2length.default=s,s.code='require("ajv/dist/runtime/ucs2length").default',ucs2length}var hasRequiredLimitLength;function requireLimitLength(){if(hasRequiredLimitLength)return limitLength;hasRequiredLimitLength=1,Object.defineProperty(limitLength,"__esModule",{value:!0});const s=requireCodegen(),e=requireUtil(),i=requireUcs2length(),o={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:{message({keyword:l,schemaCode:c}){const u=l==="maxLength"?"more":"fewer";return(0,s.str)`must NOT have ${u} than ${c} characters`},params:({schemaCode:l})=>(0,s._)`{limit: ${l}}`},code(l){const{keyword:c,data:u,schemaCode:h,it:f}=l,g=c==="maxLength"?s.operators.GT:s.operators.LT,H=f.opts.unicode===!1?(0,s._)`${u}.length`:(0,s._)`${(0,e.useFunc)(l.gen,i.default)}(${u})`;l.fail$data((0,s._)`${H} ${g} ${h}`)}};return limitLength.default=o,limitLength}var pattern={},hasRequiredPattern;function requirePattern(){if(hasRequiredPattern)return pattern;hasRequiredPattern=1,Object.defineProperty(pattern,"__esModule",{value:!0});const s=requireCode(),e=requireCodegen(),n={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:{message:({schemaCode:o})=>(0,e.str)`must match pattern "${o}"`,params:({schemaCode:o})=>(0,e._)`{pattern: ${o}}`},code(o){const{data:l,$data:c,schema:u,schemaCode:h,it:f}=o,g=f.opts.unicodeRegExp?"u":"",H=c?(0,e._)`(new RegExp(${h}, ${g}))`:(0,s.usePattern)(o,u);o.fail$data((0,e._)`!${H}.test(${l})`)}};return pattern.default=n,pattern}var limitProperties={},hasRequiredLimitProperties;function requireLimitProperties(){if(hasRequiredLimitProperties)return limitProperties;hasRequiredLimitProperties=1,Object.defineProperty(limitProperties,"__esModule",{value:!0});const s=requireCodegen(),i={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:{message({keyword:n,schemaCode:o}){const l=n==="maxProperties"?"more":"fewer";return(0,s.str)`must NOT have ${l} than ${o} properties`},params:({schemaCode:n})=>(0,s._)`{limit: ${n}}`},code(n){const{keyword:o,data:l,schemaCode:c}=n,u=o==="maxProperties"?s.operators.GT:s.operators.LT;n.fail$data((0,s._)`Object.keys(${l}).length ${u} ${c}`)}};return limitProperties.default=i,limitProperties}var required$4={},hasRequiredRequired;function requireRequired(){if(hasRequiredRequired)return required$4;hasRequiredRequired=1,Object.defineProperty(required$4,"__esModule",{value:!0});const s=requireCode(),e=requireCodegen(),i=requireUtil(),o={keyword:"required",type:"object",schemaType:"array",$data:!0,error:{message:({params:{missingProperty:l}})=>(0,e.str)`must have required property '${l}'`,params:({params:{missingProperty:l}})=>(0,e._)`{missingProperty: ${l}}`},code(l){const{gen:c,schema:u,schemaCode:h,data:f,$data:g,it:H}=l,{opts:Y}=H;if(!g&&u.length===0)return;const ee=u.length>=Y.loopRequired;if(H.allErrors?te():xe(),Y.strictRequired){const tt=l.parentSchema.properties,{definedProperties:it}=l.it;for(const rt of u)if((tt==null?void 0:tt[rt])===void 0&&!it.has(rt)){const nt=H.schemaEnv.baseId+H.errSchemaPath,st=`required property "${rt}" is not defined at "${nt}" (strictRequired)`;(0,i.checkStrictMode)(H,st,H.opts.strictRequired)}}function te(){if(ee||g)l.block$data(e.nil,ne);else for(const tt of u)(0,s.checkReportMissingProp)(l,tt)}function xe(){const tt=c.let("missing");if(ee||g){const it=c.let("valid",!0);l.block$data(it,()=>et(tt,it)),l.ok(it)}else c.if((0,s.checkMissingProp)(l,u,tt)),(0,s.reportMissingProp)(l,tt),c.else()}function ne(){c.forOf("prop",h,tt=>{l.setParams({missingProperty:tt}),c.if((0,s.noPropertyInData)(c,f,tt,Y.ownProperties),()=>l.error())})}function et(tt,it){l.setParams({missingProperty:tt}),c.forOf(tt,h,()=>{c.assign(it,(0,s.propertyInData)(c,f,tt,Y.ownProperties)),c.if((0,e.not)(it),()=>{l.error(),c.break()})},e.nil)}}};return required$4.default=o,required$4}var limitItems={},hasRequiredLimitItems;function requireLimitItems(){if(hasRequiredLimitItems)return limitItems;hasRequiredLimitItems=1,Object.defineProperty(limitItems,"__esModule",{value:!0});const s=requireCodegen(),i={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:{message({keyword:n,schemaCode:o}){const l=n==="maxItems"?"more":"fewer";return(0,s.str)`must NOT have ${l} than ${o} items`},params:({schemaCode:n})=>(0,s._)`{limit: ${n}}`},code(n){const{keyword:o,data:l,schemaCode:c}=n,u=o==="maxItems"?s.operators.GT:s.operators.LT;n.fail$data((0,s._)`${l}.length ${u} ${c}`)}};return limitItems.default=i,limitItems}var uniqueItems={},equal={},hasRequiredEqual;function requireEqual(){if(hasRequiredEqual)return equal;hasRequiredEqual=1,Object.defineProperty(equal,"__esModule",{value:!0});const s=requireFastDeepEqual();return s.code='require("ajv/dist/runtime/equal").default',equal.default=s,equal}var hasRequiredUniqueItems;function requireUniqueItems(){if(hasRequiredUniqueItems)return uniqueItems;hasRequiredUniqueItems=1,Object.defineProperty(uniqueItems,"__esModule",{value:!0});const s=requireDataType(),e=requireCodegen(),i=requireUtil(),n=requireEqual(),l={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:{message:({params:{i:c,j:u}})=>(0,e.str)`must NOT have duplicate items (items ## ${u} and ${c} are identical)`,params:({params:{i:c,j:u}})=>(0,e._)`{i: ${c}, j: ${u}}`},code(c){const{gen:u,data:h,$data:f,schema:g,parentSchema:H,schemaCode:Y,it:ee}=c;if(!f&&!g)return;const te=u.let("valid"),xe=H.items?(0,s.getSchemaTypes)(H.items):[];c.block$data(te,ne,(0,e._)`${Y} === false`),c.ok(te);function ne(){const rt=u.let("i",(0,e._)`${h}.length`),nt=u.let("j");c.setParams({i:rt,j:nt}),u.assign(te,!0),u.if((0,e._)`${rt} > 1`,()=>(et()?tt:it)(rt,nt))}function et(){return xe.length>0&&!xe.some(rt=>rt==="object"||rt==="array")}function tt(rt,nt){const st=u.name("item"),at=(0,s.checkDataTypes)(xe,st,ee.opts.strictNumbers,s.DataType.Wrong),ot=u.const("indices",(0,e._)`{}`);u.for((0,e._)`;${rt}--;`,()=>{u.let(st,(0,e._)`${h}[${rt}]`),u.if(at,(0,e._)`continue`),xe.length>1&&u.if((0,e._)`typeof ${st} == "string"`,(0,e._)`${st} += "_"`),u.if((0,e._)`typeof ${ot}[${st}] == "number"`,()=>{u.assign(nt,(0,e._)`${ot}[${st}]`),c.error(),u.assign(te,!1).break()}).code((0,e._)`${ot}[${st}] = ${rt}`)})}function it(rt,nt){const st=(0,i.useFunc)(u,n.default),at=u.name("outer");u.label(at).for((0,e._)`;${rt}--;`,()=>u.for((0,e._)`${nt} = ${rt}; ${nt}--;`,()=>u.if((0,e._)`${st}(${h}[${rt}], ${h}[${nt}])`,()=>{c.error(),u.assign(te,!1).break(at)})))}}};return uniqueItems.default=l,uniqueItems}var _const={},hasRequired_const;function require_const(){if(hasRequired_const)return _const;hasRequired_const=1,Object.defineProperty(_const,"__esModule",{value:!0});const s=requireCodegen(),e=requireUtil(),i=requireEqual(),o={keyword:"const",$data:!0,error:{message:"must be equal to constant",params:({schemaCode:l})=>(0,s._)`{allowedValue: ${l}}`},code(l){const{gen:c,data:u,$data:h,schemaCode:f,schema:g}=l;h||g&&typeof g=="object"?l.fail$data((0,s._)`!${(0,e.useFunc)(c,i.default)}(${u}, ${f})`):l.fail((0,s._)`${g} !== ${u}`)}};return _const.default=o,_const}var _enum={},hasRequired_enum;function require_enum(){if(hasRequired_enum)return _enum;hasRequired_enum=1,Object.defineProperty(_enum,"__esModule",{value:!0});const s=requireCodegen(),e=requireUtil(),i=requireEqual(),o={keyword:"enum",schemaType:"array",$data:!0,error:{message:"must be equal to one of the allowed values",params:({schemaCode:l})=>(0,s._)`{allowedValues: ${l}}`},code(l){const{gen:c,data:u,$data:h,schema:f,schemaCode:g,it:H}=l;if(!h&&f.length===0)throw new Error("enum must have non-empty array");const Y=f.length>=H.opts.loopEnum;let ee;const te=()=>ee??(ee=(0,e.useFunc)(c,i.default));let xe;if(Y||h)xe=c.let("valid"),l.block$data(xe,ne);else{if(!Array.isArray(f))throw new Error("ajv implementation error");const tt=c.const("vSchema",g);xe=(0,s.or)(...f.map((it,rt)=>et(tt,rt)))}l.pass(xe);function ne(){c.assign(xe,!1),c.forOf("v",g,tt=>c.if((0,s._)`${te()}(${u}, ${tt})`,()=>c.assign(xe,!0).break()))}function et(tt,it){const rt=f[it];return typeof rt=="object"&&rt!==null?(0,s._)`${te()}(${u}, ${tt}[${it}])`:(0,s._)`${u} === ${rt}`}}};return _enum.default=o,_enum}var hasRequiredValidation;function requireValidation(){if(hasRequiredValidation)return validation;hasRequiredValidation=1,Object.defineProperty(validation,"__esModule",{value:!0});const s=requireLimitNumber(),e=requireMultipleOf(),i=requireLimitLength(),n=requirePattern(),o=requireLimitProperties(),l=requireRequired(),c=requireLimitItems(),u=requireUniqueItems(),h=require_const(),f=require_enum(),g=[s.default,e.default,i.default,n.default,o.default,l.default,c.default,u.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},h.default,f.default];return validation.default=g,validation}var applicator={},additionalItems={},hasRequiredAdditionalItems;function requireAdditionalItems(){if(hasRequiredAdditionalItems)return additionalItems;hasRequiredAdditionalItems=1,Object.defineProperty(additionalItems,"__esModule",{value:!0}),additionalItems.validateAdditionalItems=void 0;const s=requireCodegen(),e=requireUtil(),n={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:{message:({params:{len:l}})=>(0,s.str)`must NOT have more than ${l} items`,params:({params:{len:l}})=>(0,s._)`{limit: ${l}}`},code(l){const{parentSchema:c,it:u}=l,{items:h}=c;if(!Array.isArray(h)){(0,e.checkStrictMode)(u,'"additionalItems" is ignored when "items" is not an array of schemas');return}o(l,h)}};function o(l,c){const{gen:u,schema:h,data:f,keyword:g,it:H}=l;H.items=!0;const Y=u.const("len",(0,s._)`${f}.length`);if(h===!1)l.setParams({len:c.length}),l.pass((0,s._)`${Y} <= ${c.length}`);else if(typeof h=="object"&&!(0,e.alwaysValidSchema)(H,h)){const te=u.var("valid",(0,s._)`${Y} <= ${c.length}`);u.if((0,s.not)(te),()=>ee(te)),l.ok(te)}function ee(te){u.forRange("i",c.length,Y,xe=>{l.subschema({keyword:g,dataProp:xe,dataPropType:e.Type.Num},te),H.allErrors||u.if((0,s.not)(te),()=>u.break())})}}return additionalItems.validateAdditionalItems=o,additionalItems.default=n,additionalItems}var prefixItems={},items$1={},hasRequiredItems;function requireItems(){if(hasRequiredItems)return items$1;hasRequiredItems=1,Object.defineProperty(items$1,"__esModule",{value:!0}),items$1.validateTuple=void 0;const s=requireCodegen(),e=requireUtil(),i=requireCode(),n={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(l){const{schema:c,it:u}=l;if(Array.isArray(c))return o(l,"additionalItems",c);u.items=!0,!(0,e.alwaysValidSchema)(u,c)&&l.ok((0,i.validateArray)(l))}};function o(l,c,u=l.schema){const{gen:h,parentSchema:f,data:g,keyword:H,it:Y}=l;xe(f),Y.opts.unevaluated&&u.length&&Y.items!==!0&&(Y.items=e.mergeEvaluated.items(h,u.length,Y.items));const ee=h.name("valid"),te=h.const("len",(0,s._)`${g}.length`);u.forEach((ne,et)=>{(0,e.alwaysValidSchema)(Y,ne)||(h.if((0,s._)`${te} > ${et}`,()=>l.subschema({keyword:H,schemaProp:et,dataProp:et},ee)),l.ok(ee))});function xe(ne){const{opts:et,errSchemaPath:tt}=Y,it=u.length,rt=it===ne.minItems&&(it===ne.maxItems||ne[c]===!1);if(et.strictTuples&&!rt){const nt=`"${H}" is ${it}-tuple, but minItems or maxItems/${c} are not specified or different at path "${tt}"`;(0,e.checkStrictMode)(Y,nt,et.strictTuples)}}}return items$1.validateTuple=o,items$1.default=n,items$1}var hasRequiredPrefixItems;function requirePrefixItems(){if(hasRequiredPrefixItems)return prefixItems;hasRequiredPrefixItems=1,Object.defineProperty(prefixItems,"__esModule",{value:!0});const s=requireItems(),e={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:i=>(0,s.validateTuple)(i,"items")};return prefixItems.default=e,prefixItems}var items2020={},hasRequiredItems2020;function requireItems2020(){if(hasRequiredItems2020)return items2020;hasRequiredItems2020=1,Object.defineProperty(items2020,"__esModule",{value:!0});const s=requireCodegen(),e=requireUtil(),i=requireCode(),n=requireAdditionalItems(),l={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:{message:({params:{len:c}})=>(0,s.str)`must NOT have more than ${c} items`,params:({params:{len:c}})=>(0,s._)`{limit: ${c}}`},code(c){const{schema:u,parentSchema:h,it:f}=c,{prefixItems:g}=h;f.items=!0,!(0,e.alwaysValidSchema)(f,u)&&(g?(0,n.validateAdditionalItems)(c,g):c.ok((0,i.validateArray)(c)))}};return items2020.default=l,items2020}var contains={},hasRequiredContains;function requireContains(){if(hasRequiredContains)return contains;hasRequiredContains=1,Object.defineProperty(contains,"__esModule",{value:!0});const s=requireCodegen(),e=requireUtil(),n={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:{message:({params:{min:o,max:l}})=>l===void 0?(0,s.str)`must contain at least ${o} valid item(s)`:(0,s.str)`must contain at least ${o} and no more than ${l} valid item(s)`,params:({params:{min:o,max:l}})=>l===void 0?(0,s._)`{minContains: ${o}}`:(0,s._)`{minContains: ${o}, maxContains: ${l}}`},code(o){const{gen:l,schema:c,parentSchema:u,data:h,it:f}=o;let g,H;const{minContains:Y,maxContains:ee}=u;f.opts.next?(g=Y===void 0?1:Y,H=ee):g=1;const te=l.const("len",(0,s._)`${h}.length`);if(o.setParams({min:g,max:H}),H===void 0&&g===0){(0,e.checkStrictMode)(f,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(H!==void 0&&g>H){(0,e.checkStrictMode)(f,'"minContains" > "maxContains" is always invalid'),o.fail();return}if((0,e.alwaysValidSchema)(f,c)){let it=(0,s._)`${te} >= ${g}`;H!==void 0&&(it=(0,s._)`${it} && ${te} <= ${H}`),o.pass(it);return}f.items=!0;const xe=l.name("valid");H===void 0&&g===1?et(xe,()=>l.if(xe,()=>l.break())):g===0?(l.let(xe,!0),H!==void 0&&l.if((0,s._)`${h}.length > 0`,ne)):(l.let(xe,!1),ne()),o.result(xe,()=>o.reset());function ne(){const it=l.name("_valid"),rt=l.let("count",0);et(it,()=>l.if(it,()=>tt(rt)))}function et(it,rt){l.forRange("i",0,te,nt=>{o.subschema({keyword:"contains",dataProp:nt,dataPropType:e.Type.Num,compositeRule:!0},it),rt()})}function tt(it){l.code((0,s._)`${it}++`),H===void 0?l.if((0,s._)`${it} >= ${g}`,()=>l.assign(xe,!0).break()):(l.if((0,s._)`${it} > ${H}`,()=>l.assign(xe,!1).break()),g===1?l.assign(xe,!0):l.if((0,s._)`${it} >= ${g}`,()=>l.assign(xe,!0)))}}};return contains.default=n,contains}var dependencies={},hasRequiredDependencies;function requireDependencies(){return hasRequiredDependencies||(hasRequiredDependencies=1,(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.validateSchemaDeps=s.validatePropertyDeps=s.error=void 0;const e=requireCodegen(),i=requireUtil(),n=requireCode();s.error={message:({params:{property:h,depsCount:f,deps:g}})=>{const H=f===1?"property":"properties";return(0,e.str)`must have ${H} ${g} when property ${h} is present`},params:({params:{property:h,depsCount:f,deps:g,missingProperty:H}})=>(0,e._)`{property: ${h},
    missingProperty: ${H},
    depsCount: ${f},
    deps: ${g}}`};const o={keyword:"dependencies",type:"object",schemaType:"object",error:s.error,code(h){const[f,g]=l(h);c(h,f),u(h,g)}};function l({schema:h}){const f={},g={};for(const H in h){if(H==="__proto__")continue;const Y=Array.isArray(h[H])?f:g;Y[H]=h[H]}return[f,g]}function c(h,f=h.schema){const{gen:g,data:H,it:Y}=h;if(Object.keys(f).length===0)return;const ee=g.let("missing");for(const te in f){const xe=f[te];if(xe.length===0)continue;const ne=(0,n.propertyInData)(g,H,te,Y.opts.ownProperties);h.setParams({property:te,depsCount:xe.length,deps:xe.join(", ")}),Y.allErrors?g.if(ne,()=>{for(const et of xe)(0,n.checkReportMissingProp)(h,et)}):(g.if((0,e._)`${ne} && (${(0,n.checkMissingProp)(h,xe,ee)})`),(0,n.reportMissingProp)(h,ee),g.else())}}s.validatePropertyDeps=c;function u(h,f=h.schema){const{gen:g,data:H,keyword:Y,it:ee}=h,te=g.name("valid");for(const xe in f)(0,i.alwaysValidSchema)(ee,f[xe])||(g.if((0,n.propertyInData)(g,H,xe,ee.opts.ownProperties),()=>{const ne=h.subschema({keyword:Y,schemaProp:xe},te);h.mergeValidEvaluated(ne,te)},()=>g.var(te,!0)),h.ok(te))}s.validateSchemaDeps=u,s.default=o})(dependencies)),dependencies}var propertyNames={},hasRequiredPropertyNames;function requirePropertyNames(){if(hasRequiredPropertyNames)return propertyNames;hasRequiredPropertyNames=1,Object.defineProperty(propertyNames,"__esModule",{value:!0});const s=requireCodegen(),e=requireUtil(),n={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:{message:"property name must be valid",params:({params:o})=>(0,s._)`{propertyName: ${o.propertyName}}`},code(o){const{gen:l,schema:c,data:u,it:h}=o;if((0,e.alwaysValidSchema)(h,c))return;const f=l.name("valid");l.forIn("key",u,g=>{o.setParams({propertyName:g}),o.subschema({keyword:"propertyNames",data:g,dataTypes:["string"],propertyName:g,compositeRule:!0},f),l.if((0,s.not)(f),()=>{o.error(!0),h.allErrors||l.break()})}),o.ok(f)}};return propertyNames.default=n,propertyNames}var additionalProperties$3={},hasRequiredAdditionalProperties;function requireAdditionalProperties(){if(hasRequiredAdditionalProperties)return additionalProperties$3;hasRequiredAdditionalProperties=1,Object.defineProperty(additionalProperties$3,"__esModule",{value:!0});const s=requireCode(),e=requireCodegen(),i=requireNames(),n=requireUtil(),l={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:{message:"must NOT have additional properties",params:({params:c})=>(0,e._)`{additionalProperty: ${c.additionalProperty}}`},code(c){const{gen:u,schema:h,parentSchema:f,data:g,errsCount:H,it:Y}=c;if(!H)throw new Error("ajv implementation error");const{allErrors:ee,opts:te}=Y;if(Y.props=!0,te.removeAdditional!=="all"&&(0,n.alwaysValidSchema)(Y,h))return;const xe=(0,s.allSchemaProperties)(f.properties),ne=(0,s.allSchemaProperties)(f.patternProperties);et(),c.ok((0,e._)`${H} === ${i.default.errors}`);function et(){u.forIn("key",g,st=>{!xe.length&&!ne.length?rt(st):u.if(tt(st),()=>rt(st))})}function tt(st){let at;if(xe.length>8){const ot=(0,n.schemaRefOrVal)(Y,f.properties,"properties");at=(0,s.isOwnProperty)(u,ot,st)}else xe.length?at=(0,e.or)(...xe.map(ot=>(0,e._)`${st} === ${ot}`)):at=e.nil;return ne.length&&(at=(0,e.or)(at,...ne.map(ot=>(0,e._)`${(0,s.usePattern)(c,ot)}.test(${st})`))),(0,e.not)(at)}function it(st){u.code((0,e._)`delete ${g}[${st}]`)}function rt(st){if(te.removeAdditional==="all"||te.removeAdditional&&h===!1){it(st);return}if(h===!1){c.setParams({additionalProperty:st}),c.error(),ee||u.break();return}if(typeof h=="object"&&!(0,n.alwaysValidSchema)(Y,h)){const at=u.name("valid");te.removeAdditional==="failing"?(nt(st,at,!1),u.if((0,e.not)(at),()=>{c.reset(),it(st)})):(nt(st,at),ee||u.if((0,e.not)(at),()=>u.break()))}}function nt(st,at,ot){const ct={keyword:"additionalProperties",dataProp:st,dataPropType:n.Type.Str};ot===!1&&Object.assign(ct,{compositeRule:!0,createErrors:!1,allErrors:!1}),c.subschema(ct,at)}}};return additionalProperties$3.default=l,additionalProperties$3}var properties$5={},hasRequiredProperties;function requireProperties(){if(hasRequiredProperties)return properties$5;hasRequiredProperties=1,Object.defineProperty(properties$5,"__esModule",{value:!0});const s=requireValidate(),e=requireCode(),i=requireUtil(),n=requireAdditionalProperties(),o={keyword:"properties",type:"object",schemaType:"object",code(l){const{gen:c,schema:u,parentSchema:h,data:f,it:g}=l;g.opts.removeAdditional==="all"&&h.additionalProperties===void 0&&n.default.code(new s.KeywordCxt(g,n.default,"additionalProperties"));const H=(0,e.allSchemaProperties)(u);for(const ne of H)g.definedProperties.add(ne);g.opts.unevaluated&&H.length&&g.props!==!0&&(g.props=i.mergeEvaluated.props(c,(0,i.toHash)(H),g.props));const Y=H.filter(ne=>!(0,i.alwaysValidSchema)(g,u[ne]));if(Y.length===0)return;const ee=c.name("valid");for(const ne of Y)te(ne)?xe(ne):(c.if((0,e.propertyInData)(c,f,ne,g.opts.ownProperties)),xe(ne),g.allErrors||c.else().var(ee,!0),c.endIf()),l.it.definedProperties.add(ne),l.ok(ee);function te(ne){return g.opts.useDefaults&&!g.compositeRule&&u[ne].default!==void 0}function xe(ne){l.subschema({keyword:"properties",schemaProp:ne,dataProp:ne},ee)}}};return properties$5.default=o,properties$5}var patternProperties={},hasRequiredPatternProperties;function requirePatternProperties(){if(hasRequiredPatternProperties)return patternProperties;hasRequiredPatternProperties=1,Object.defineProperty(patternProperties,"__esModule",{value:!0});const s=requireCode(),e=requireCodegen(),i=requireUtil(),n=requireUtil(),o={keyword:"patternProperties",type:"object",schemaType:"object",code(l){const{gen:c,schema:u,data:h,parentSchema:f,it:g}=l,{opts:H}=g,Y=(0,s.allSchemaProperties)(u),ee=Y.filter(rt=>(0,i.alwaysValidSchema)(g,u[rt]));if(Y.length===0||ee.length===Y.length&&(!g.opts.unevaluated||g.props===!0))return;const te=H.strictSchema&&!H.allowMatchingProperties&&f.properties,xe=c.name("valid");g.props!==!0&&!(g.props instanceof e.Name)&&(g.props=(0,n.evaluatedPropsToName)(c,g.props));const{props:ne}=g;et();function et(){for(const rt of Y)te&&tt(rt),g.allErrors?it(rt):(c.var(xe,!0),it(rt),c.if(xe))}function tt(rt){for(const nt in te)new RegExp(rt).test(nt)&&(0,i.checkStrictMode)(g,`property ${nt} matches pattern ${rt} (use allowMatchingProperties)`)}function it(rt){c.forIn("key",h,nt=>{c.if((0,e._)`${(0,s.usePattern)(l,rt)}.test(${nt})`,()=>{const st=ee.includes(rt);st||l.subschema({keyword:"patternProperties",schemaProp:rt,dataProp:nt,dataPropType:n.Type.Str},xe),g.opts.unevaluated&&ne!==!0?c.assign((0,e._)`${ne}[${nt}]`,!0):!st&&!g.allErrors&&c.if((0,e.not)(xe),()=>c.break())})})}}};return patternProperties.default=o,patternProperties}var not={},hasRequiredNot;function requireNot(){if(hasRequiredNot)return not;hasRequiredNot=1,Object.defineProperty(not,"__esModule",{value:!0});const s=requireUtil(),e={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(i){const{gen:n,schema:o,it:l}=i;if((0,s.alwaysValidSchema)(l,o)){i.fail();return}const c=n.name("valid");i.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},c),i.failResult(c,()=>i.reset(),()=>i.error())},error:{message:"must NOT be valid"}};return not.default=e,not}var anyOf={},hasRequiredAnyOf;function requireAnyOf(){if(hasRequiredAnyOf)return anyOf;hasRequiredAnyOf=1,Object.defineProperty(anyOf,"__esModule",{value:!0});const e={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:requireCode().validateUnion,error:{message:"must match a schema in anyOf"}};return anyOf.default=e,anyOf}var oneOf={},hasRequiredOneOf;function requireOneOf(){if(hasRequiredOneOf)return oneOf;hasRequiredOneOf=1,Object.defineProperty(oneOf,"__esModule",{value:!0});const s=requireCodegen(),e=requireUtil(),n={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:{message:"must match exactly one schema in oneOf",params:({params:o})=>(0,s._)`{passingSchemas: ${o.passing}}`},code(o){const{gen:l,schema:c,parentSchema:u,it:h}=o;if(!Array.isArray(c))throw new Error("ajv implementation error");if(h.opts.discriminator&&u.discriminator)return;const f=c,g=l.let("valid",!1),H=l.let("passing",null),Y=l.name("_valid");o.setParams({passing:H}),l.block(ee),o.result(g,()=>o.reset(),()=>o.error(!0));function ee(){f.forEach((te,xe)=>{let ne;(0,e.alwaysValidSchema)(h,te)?l.var(Y,!0):ne=o.subschema({keyword:"oneOf",schemaProp:xe,compositeRule:!0},Y),xe>0&&l.if((0,s._)`${Y} && ${g}`).assign(g,!1).assign(H,(0,s._)`[${H}, ${xe}]`).else(),l.if(Y,()=>{l.assign(g,!0),l.assign(H,xe),ne&&o.mergeEvaluated(ne,s.Name)})})}}};return oneOf.default=n,oneOf}var allOf={},hasRequiredAllOf;function requireAllOf(){if(hasRequiredAllOf)return allOf;hasRequiredAllOf=1,Object.defineProperty(allOf,"__esModule",{value:!0});const s=requireUtil(),e={keyword:"allOf",schemaType:"array",code(i){const{gen:n,schema:o,it:l}=i;if(!Array.isArray(o))throw new Error("ajv implementation error");const c=n.name("valid");o.forEach((u,h)=>{if((0,s.alwaysValidSchema)(l,u))return;const f=i.subschema({keyword:"allOf",schemaProp:h},c);i.ok(c),i.mergeEvaluated(f)})}};return allOf.default=e,allOf}var _if={},hasRequired_if;function require_if(){if(hasRequired_if)return _if;hasRequired_if=1,Object.defineProperty(_if,"__esModule",{value:!0});const s=requireCodegen(),e=requireUtil(),n={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:{message:({params:l})=>(0,s.str)`must match "${l.ifClause}" schema`,params:({params:l})=>(0,s._)`{failingKeyword: ${l.ifClause}}`},code(l){const{gen:c,parentSchema:u,it:h}=l;u.then===void 0&&u.else===void 0&&(0,e.checkStrictMode)(h,'"if" without "then" and "else" is ignored');const f=o(h,"then"),g=o(h,"else");if(!f&&!g)return;const H=c.let("valid",!0),Y=c.name("_valid");if(ee(),l.reset(),f&&g){const xe=c.let("ifClause");l.setParams({ifClause:xe}),c.if(Y,te("then",xe),te("else",xe))}else f?c.if(Y,te("then")):c.if((0,s.not)(Y),te("else"));l.pass(H,()=>l.error(!0));function ee(){const xe=l.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},Y);l.mergeEvaluated(xe)}function te(xe,ne){return()=>{const et=l.subschema({keyword:xe},Y);c.assign(H,Y),l.mergeValidEvaluated(et,H),ne?c.assign(ne,(0,s._)`${xe}`):l.setParams({ifClause:xe})}}}};function o(l,c){const u=l.schema[c];return u!==void 0&&!(0,e.alwaysValidSchema)(l,u)}return _if.default=n,_if}var thenElse={},hasRequiredThenElse;function requireThenElse(){if(hasRequiredThenElse)return thenElse;hasRequiredThenElse=1,Object.defineProperty(thenElse,"__esModule",{value:!0});const s=requireUtil(),e={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:i,parentSchema:n,it:o}){n.if===void 0&&(0,s.checkStrictMode)(o,`"${i}" without "if" is ignored`)}};return thenElse.default=e,thenElse}var hasRequiredApplicator;function requireApplicator(){if(hasRequiredApplicator)return applicator;hasRequiredApplicator=1,Object.defineProperty(applicator,"__esModule",{value:!0});const s=requireAdditionalItems(),e=requirePrefixItems(),i=requireItems(),n=requireItems2020(),o=requireContains(),l=requireDependencies(),c=requirePropertyNames(),u=requireAdditionalProperties(),h=requireProperties(),f=requirePatternProperties(),g=requireNot(),H=requireAnyOf(),Y=requireOneOf(),ee=requireAllOf(),te=require_if(),xe=requireThenElse();function ne(et=!1){const tt=[g.default,H.default,Y.default,ee.default,te.default,xe.default,c.default,u.default,l.default,h.default,f.default];return et?tt.push(e.default,n.default):tt.push(s.default,i.default),tt.push(o.default),tt}return applicator.default=ne,applicator}var format$1={},format={},hasRequiredFormat$1;function requireFormat$1(){if(hasRequiredFormat$1)return format;hasRequiredFormat$1=1,Object.defineProperty(format,"__esModule",{value:!0});const s=requireCodegen(),i={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:{message:({schemaCode:n})=>(0,s.str)`must match format "${n}"`,params:({schemaCode:n})=>(0,s._)`{format: ${n}}`},code(n,o){const{gen:l,data:c,$data:u,schema:h,schemaCode:f,it:g}=n,{opts:H,errSchemaPath:Y,schemaEnv:ee,self:te}=g;if(!H.validateFormats)return;u?xe():ne();function xe(){const et=l.scopeValue("formats",{ref:te.formats,code:H.code.formats}),tt=l.const("fDef",(0,s._)`${et}[${f}]`),it=l.let("fType"),rt=l.let("format");l.if((0,s._)`typeof ${tt} == "object" && !(${tt} instanceof RegExp)`,()=>l.assign(it,(0,s._)`${tt}.type || "string"`).assign(rt,(0,s._)`${tt}.validate`),()=>l.assign(it,(0,s._)`"string"`).assign(rt,tt)),n.fail$data((0,s.or)(nt(),st()));function nt(){return H.strictSchema===!1?s.nil:(0,s._)`${f} && !${rt}`}function st(){const at=ee.$async?(0,s._)`(${tt}.async ? await ${rt}(${c}) : ${rt}(${c}))`:(0,s._)`${rt}(${c})`,ot=(0,s._)`(typeof ${rt} == "function" ? ${at} : ${rt}.test(${c}))`;return(0,s._)`${rt} && ${rt} !== true && ${it} === ${o} && !${ot}`}}function ne(){const et=te.formats[h];if(!et){nt();return}if(et===!0)return;const[tt,it,rt]=st(et);tt===o&&n.pass(at());function nt(){if(H.strictSchema===!1){te.logger.warn(ot());return}throw new Error(ot());function ot(){return`unknown format "${h}" ignored in schema at path "${Y}"`}}function st(ot){const ct=ot instanceof RegExp?(0,s.regexpCode)(ot):H.code.formats?(0,s._)`${H.code.formats}${(0,s.getProperty)(h)}`:void 0,ht=l.scopeValue("formats",{key:h,ref:ot,code:ct});return typeof ot=="object"&&!(ot instanceof RegExp)?[ot.type||"string",ot.validate,(0,s._)`${ht}.validate`]:["string",ot,ht]}function at(){if(typeof et=="object"&&!(et instanceof RegExp)&&et.async){if(!ee.$async)throw new Error("async format in sync schema");return(0,s._)`await ${rt}(${c})`}return typeof it=="function"?(0,s._)`${rt}(${c})`:(0,s._)`${rt}.test(${c})`}}}};return format.default=i,format}var hasRequiredFormat;function requireFormat(){if(hasRequiredFormat)return format$1;hasRequiredFormat=1,Object.defineProperty(format$1,"__esModule",{value:!0});const e=[requireFormat$1().default];return format$1.default=e,format$1}var metadata={},hasRequiredMetadata;function requireMetadata(){return hasRequiredMetadata||(hasRequiredMetadata=1,Object.defineProperty(metadata,"__esModule",{value:!0}),metadata.contentVocabulary=metadata.metadataVocabulary=void 0,metadata.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"],metadata.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]),metadata}var hasRequiredDraft7;function requireDraft7(){if(hasRequiredDraft7)return draft7;hasRequiredDraft7=1,Object.defineProperty(draft7,"__esModule",{value:!0});const s=requireCore(),e=requireValidation(),i=requireApplicator(),n=requireFormat(),o=requireMetadata(),l=[s.default,e.default,(0,i.default)(),n.default,o.metadataVocabulary,o.contentVocabulary];return draft7.default=l,draft7}const $schema$6="http://json-schema.org/draft-07/schema#",$id$6="http://json-schema.org/draft-07/schema#",title$1="Core schema meta-schema",definitions={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type$6=["object","boolean"],properties$4={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},require$$3={$schema:$schema$6,$id:$id$6,title:title$1,definitions,type:type$6,properties:properties$4,default:!0};var hasRequiredAjv;function requireAjv(){return hasRequiredAjv||(hasRequiredAjv=1,(function(s,e){Object.defineProperty(e,"__esModule",{value:!0}),e.MissingRefError=e.ValidationError=e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=e.Ajv=void 0;const i=requireCore$1(),n=requireDraft7(),o=requireDiscriminator(),l=require$$3,c=["/properties"],u="http://json-schema.org/draft-07/schema";class h extends i.default{_addVocabularies(){super._addVocabularies(),n.default.forEach(te=>this.addVocabulary(te)),this.opts.discriminator&&this.addKeyword(o.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const te=this.opts.$data?this.$dataMetaSchema(l,c):l;this.addMetaSchema(te,u,!1),this.refs["http://json-schema.org/schema"]=u}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(u)?u:void 0)}}e.Ajv=h,s.exports=e=h,s.exports.Ajv=h,Object.defineProperty(e,"__esModule",{value:!0}),e.default=h;var f=requireValidate();Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return f.KeywordCxt}});var g=requireCodegen();Object.defineProperty(e,"_",{enumerable:!0,get:function(){return g._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return g.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return g.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return g.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return g.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return g.CodeGen}});var H=requireValidation_error();Object.defineProperty(e,"ValidationError",{enumerable:!0,get:function(){return H.default}});var Y=requireRef_error();Object.defineProperty(e,"MissingRefError",{enumerable:!0,get:function(){return Y.default}})})(ajv,ajv.exports)),ajv.exports}var ajvExports=requireAjv();const Ajv=getDefaultExportFromCjs$1(ajvExports);var dist={exports:{}},formats={},hasRequiredFormats;function requireFormats(){return hasRequiredFormats||(hasRequiredFormats=1,(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.formatNames=s.fastFormats=s.fullFormats=void 0;function e(ut,pt){return{validate:ut,compare:pt}}s.fullFormats={date:e(l,c),time:e(h(!0),f),"date-time":e(Y(!0),ee),"iso-time":e(h(),g),"iso-date-time":e(Y(),te),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:et,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:ht,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:it,int32:{type:"number",validate:st},int64:{type:"number",validate:at},float:{type:"number",validate:ot},double:{type:"number",validate:ot},password:!0,binary:!0},s.fastFormats={...s.fullFormats,date:e(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,c),time:e(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,f),"date-time":e(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,ee),"iso-time":e(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,g),"iso-date-time":e(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,te),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i},s.formatNames=Object.keys(s.fullFormats);function i(ut){return ut%4===0&&(ut%100!==0||ut%400===0)}const n=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,o=[0,31,28,31,30,31,30,31,31,30,31,30,31];function l(ut){const pt=n.exec(ut);if(!pt)return!1;const yt=+pt[1],mt=+pt[2],St=+pt[3];return mt>=1&&mt<=12&&St>=1&&St<=(mt===2&&i(yt)?29:o[mt])}function c(ut,pt){if(ut&&pt)return ut>pt?1:ut<pt?-1:0}const u=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function h(ut){return function(yt){const mt=u.exec(yt);if(!mt)return!1;const St=+mt[1],Pt=+mt[2],Rt=+mt[3],Lt=mt[4],Nt=mt[5]==="-"?-1:1,vt=+(mt[6]||0),Et=+(mt[7]||0);if(vt>23||Et>59||ut&&!Lt)return!1;if(St<=23&&Pt<=59&&Rt<60)return!0;const Ct=Pt-Et*Nt,_t=St-vt*Nt-(Ct<0?1:0);return(_t===23||_t===-1)&&(Ct===59||Ct===-1)&&Rt<61}}function f(ut,pt){if(!(ut&&pt))return;const yt=new Date("2020-01-01T"+ut).valueOf(),mt=new Date("2020-01-01T"+pt).valueOf();if(yt&&mt)return yt-mt}function g(ut,pt){if(!(ut&&pt))return;const yt=u.exec(ut),mt=u.exec(pt);if(yt&&mt)return ut=yt[1]+yt[2]+yt[3],pt=mt[1]+mt[2]+mt[3],ut>pt?1:ut<pt?-1:0}const H=/t|\s/i;function Y(ut){const pt=h(ut);return function(mt){const St=mt.split(H);return St.length===2&&l(St[0])&&pt(St[1])}}function ee(ut,pt){if(!(ut&&pt))return;const yt=new Date(ut).valueOf(),mt=new Date(pt).valueOf();if(yt&&mt)return yt-mt}function te(ut,pt){if(!(ut&&pt))return;const[yt,mt]=ut.split(H),[St,Pt]=pt.split(H),Rt=c(yt,St);if(Rt!==void 0)return Rt||f(mt,Pt)}const xe=/\/|:/,ne=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function et(ut){return xe.test(ut)&&ne.test(ut)}const tt=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function it(ut){return tt.lastIndex=0,tt.test(ut)}const rt=-2147483648,nt=2**31-1;function st(ut){return Number.isInteger(ut)&&ut<=nt&&ut>=rt}function at(ut){return Number.isInteger(ut)}function ot(){return!0}const ct=/[^\\]\\Z/;function ht(ut){if(ct.test(ut))return!1;try{return new RegExp(ut),!0}catch{return!1}}})(formats)),formats}var limit={},hasRequiredLimit;function requireLimit(){return hasRequiredLimit||(hasRequiredLimit=1,(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.formatLimitDefinition=void 0;const e=requireAjv(),i=requireCodegen(),n=i.operators,o={formatMaximum:{okStr:"<=",ok:n.LTE,fail:n.GT},formatMinimum:{okStr:">=",ok:n.GTE,fail:n.LT},formatExclusiveMaximum:{okStr:"<",ok:n.LT,fail:n.GTE},formatExclusiveMinimum:{okStr:">",ok:n.GT,fail:n.LTE}},l={message:({keyword:u,schemaCode:h})=>(0,i.str)`should be ${o[u].okStr} ${h}`,params:({keyword:u,schemaCode:h})=>(0,i._)`{comparison: ${o[u].okStr}, limit: ${h}}`};s.formatLimitDefinition={keyword:Object.keys(o),type:"string",schemaType:"string",$data:!0,error:l,code(u){const{gen:h,data:f,schemaCode:g,keyword:H,it:Y}=u,{opts:ee,self:te}=Y;if(!ee.validateFormats)return;const xe=new e.KeywordCxt(Y,te.RULES.all.format.definition,"format");xe.$data?ne():et();function ne(){const it=h.scopeValue("formats",{ref:te.formats,code:ee.code.formats}),rt=h.const("fmt",(0,i._)`${it}[${xe.schemaCode}]`);u.fail$data((0,i.or)((0,i._)`typeof ${rt} != "object"`,(0,i._)`${rt} instanceof RegExp`,(0,i._)`typeof ${rt}.compare != "function"`,tt(rt)))}function et(){const it=xe.schema,rt=te.formats[it];if(!rt||rt===!0)return;if(typeof rt!="object"||rt instanceof RegExp||typeof rt.compare!="function")throw new Error(`"${H}": format "${it}" does not define "compare" function`);const nt=h.scopeValue("formats",{key:it,ref:rt,code:ee.code.formats?(0,i._)`${ee.code.formats}${(0,i.getProperty)(it)}`:void 0});u.fail$data(tt(nt))}function tt(it){return(0,i._)`${it}.compare(${f}, ${g}) ${o[H].fail} 0`}},dependencies:["format"]};const c=u=>(u.addKeyword(s.formatLimitDefinition),u);s.default=c})(limit)),limit}var hasRequiredDist;function requireDist(){return hasRequiredDist||(hasRequiredDist=1,(function(s,e){Object.defineProperty(e,"__esModule",{value:!0});const i=requireFormats(),n=requireLimit(),o=requireCodegen(),l=new o.Name("fullFormats"),c=new o.Name("fastFormats"),u=(f,g={keywords:!0})=>{if(Array.isArray(g))return h(f,g,i.fullFormats,l),f;const[H,Y]=g.mode==="fast"?[i.fastFormats,c]:[i.fullFormats,l],ee=g.formats||i.formatNames;return h(f,ee,H,Y),g.keywords&&(0,n.default)(f),f};u.get=(f,g="full")=>{const Y=(g==="fast"?i.fastFormats:i.fullFormats)[f];if(!Y)throw new Error(`Unknown format "${f}"`);return Y};function h(f,g,H,Y){var ee,te;(ee=(te=f.opts.code).formats)!==null&&ee!==void 0||(te.formats=(0,o._)`require("ajv-formats/dist/formats").${Y}`);for(const xe of g)f.addFormat(xe,H[xe])}s.exports=e=u,Object.defineProperty(e,"__esModule",{value:!0}),e.default=u})(dist,dist.exports)),dist.exports}var distExports=requireDist();const addFormats=getDefaultExportFromCjs$1(distExports),$id$5="catalog",$schema$5="http://json-schema.org/draft-07/schema#",jsdoc="schema.jsdoc",title="Generated schema for configuration service",type$5="object",properties$3={generalOptions:{type:"object",properties:{apiKeys:{type:"object",properties:{$apikey:{type:"array",items:{}}},required:[]}},required:["apiKeys"]},layers:{type:"object",properties:{"$GEOPORTAIL:OGC:WMTS":{type:"object",properties:{name:{type:"string"},title:{type:"string"},description:{type:"string"},globalConstraint:{type:"object",properties:{maxScaleDenominator:{type:"number"},minScaleDenominator:{type:"number"},bbox:{type:"object",properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},required:["left","right","top","bottom"]}},required:["maxScaleDenominator","minScaleDenominator","bbox"]},serviceParams:{type:"object",properties:{id:{type:"string"},version:{type:"string"},serverUrl:{type:"object",properties:{$apikey:{type:"string"}},required:["$apikey"]}},required:["id","version","serverUrl"]},defaultProjection:{type:"string"},wmtsOptions:{type:"object",properties:{tileMatrixSetLink:{type:"string"},tileMatrixSetLimits:{type:"object",properties:{$level:{type:"object",properties:{minTileRow:{type:"string"},maxTileRow:{type:"string"},minTileCol:{type:"string"},maxTileCol:{type:"string"}},required:["minTileRow","maxTileRow","minTileCol","maxTileCol"]}},required:["$level"]}},required:["tileMatrixSetLink","tileMatrixSetLimits"]},styles:{type:"array",items:{type:"object",properties:{name:{type:"string"},title:{type:"string"},current:{type:"boolean"},url:{}},required:["name","title","current","url"]}},legends:{type:"array",items:{type:"object",properties:{format:{type:"string"},url:{type:"string"},minScaleDenominator:{type:"string"}},required:["format","url","minScaleDenominator"]}},formats:{type:"array",items:{type:"object",properties:{name:{type:"string"},current:{type:"boolean"}},required:["name","current"]}}},required:["name","title","description","globalConstraint","serviceParams","defaultProjection","wmtsOptions","styles","legends","formats"]},"$GEOPORTAIL:OGC:WMS":{type:"object",properties:{name:{type:"string"},title:{type:"string"},description:{type:"string"},globalConstraint:{type:"object",properties:{minScaleDenominator:{type:"number"},maxScaleDenominator:{type:"number"},bbox:{type:"object",properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},required:["left","right","top","bottom"]}},required:["minScaleDenominator","maxScaleDenominator","bbox"]},serviceParams:{type:"object",properties:{id:{type:"string"},version:{type:"string"},serverUrl:{type:"object",properties:{$apikey:{type:"string"}},required:["$apikey"]}},required:["id","version","serverUrl"]},defaultProjection:{type:"string"},queryable:{type:"boolean"},metadata:{type:"array",items:{}},styles:{type:"array",items:{type:"object",properties:{name:{type:"string"},title:{type:"string"}},required:["name","title"]}},legends:{type:"array",items:{type:"object",properties:{format:{type:"string"},url:{type:"string"}},required:["format","url"]}},formats:{type:"array",items:{type:"object",properties:{name:{type:"string"},current:{type:"boolean"}},required:["name","current"]}}},required:["name","title","description","globalConstraint","serviceParams","defaultProjection","queryable","metadata","styles","legends","formats"]},"$GEOPORTAIL:GPP:TMS":{type:"object",properties:{hidden:{type:"boolean"},queryable:{type:"boolean"},serviceParams:{type:"object",properties:{id:{type:"string"},version:{type:"string"},serverUrl:{type:"object",properties:{$apikey:{type:"string"}},required:["$apikey"]}},required:["id","version","serverUrl"]},name:{type:"string"},title:{type:"string"},description:{type:"string"},formats:{type:"array",items:{type:"object",properties:{current:{type:"boolean"},name:{type:"string"}},required:["current","name"]}},styles:{type:"array",items:{type:"object",properties:{name:{type:"string"},title:{type:"string"},current:{type:"boolean"},url:{type:"string"}},required:["name","title","current","url"]}},globalConstraint:{type:"object",properties:{crs:{type:"string"},bbox:{type:"object",properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},required:["left","right","top","bottom"]},minScaleDenominator:{},maxScaleDenominator:{}},required:["crs","bbox","minScaleDenominator","maxScaleDenominator"]},layerId:{type:"string"},defaultProjection:{type:"string"}},required:["hidden","queryable","serviceParams","name","title","description","formats","styles","globalConstraint","layerId","defaultProjection"]}},required:[]},tileMatrixSets:{type:"object",properties:{$tmsid:{type:"object",properties:{projection:{type:"string"},nativeResolutions:{type:"array",items:{type:"string"}},tileMatrices:{type:"object",properties:{$level:{type:"object",properties:{matrixId:{type:"string"},matrixHeight:{type:"number"},matrixWidth:{type:"number"},scaleDenominator:{type:"number"},tileHeight:{type:"number"},tileWidth:{type:"number"},topLeftCorner:{type:"object",properties:{x:{type:"number"},y:{type:"number"}},required:["x","y"]}},required:["matrixId","matrixHeight","matrixWidth","scaleDenominator","tileHeight","tileWidth","topLeftCorner"]}},required:["$level"]}},required:["projection","nativeResolutions","tileMatrices"]}},required:[]}},required$3=["generalOptions","layers","tileMatrixSets"],CatalogSchema={$id:$id$5,$schema:$schema$5,jsdoc,title,type:type$5,properties:properties$3,required:required$3},$id$4="territories",$schema$4="http://json-schema.org/draft-07/schema#",type$4="array",items={type:"object",required:["id","title","description","zoom","thumbnail","icon"],oneOf:[{required:["bbox"]},{required:["point"]}],properties:{id:{type:"string",description:"Code du territoire"},title:{type:"string",description:"Nom affich du territoire"},description:{type:"string"},zoom:{type:["integer","null"],minimum:0},bbox:{type:"array",minItems:4,maxItems:4,items:{type:"number"},description:"Bounding box au format [minX, minY, maxX, maxY]"},point:{type:"array",minItems:2,maxItems:2,items:{type:"number"},description:"Coordonnes"},thumbnail:{anyOf:[{type:"string",format:"uri"},{type:"string"}]},icon:{anyOf:[{type:"string",format:"uri"},{type:"string"}]}},additionalProperties:!1},TerrotoriesSchema={$id:$id$4,$schema:$schema$4,type:type$4,items},$id$3="layer-wmts",$schema$3="http://json-schema.org/draft-07/schema#",type$3="object",required$2=["name","globalConstraint","params"],properties$2={name:{type:"string"},globalConstraint:{type:"object",required:["maxScaleDenominator","minScaleDenominator","bbox"],properties:{maxScaleDenominator:{type:"number"},minScaleDenominator:{type:"number"},bbox:{type:"object",required:["left","right","top","bottom"],properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},additionalProperties:!1}},additionalProperties:!1},params:{type:"object",required:["url","styles","version","format","projection","minScale","maxScale","extent","legends","title","description","tileMatrixSetLimits","TMSLink","matrixIds","tileMatrices","nativeResolutions"],properties:{url:{type:"string",format:"uri"},styles:{type:"string"},version:{type:"string"},format:{type:"string"},projection:{type:"string"},minScale:{type:"number"},maxScale:{type:"number"},extent:{type:"object",required:["left","right","top","bottom"],properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},additionalProperties:!1},legends:{type:"array",items:{type:"object",required:["format","url","minScaleDenominator"],properties:{format:{type:"string"},url:{type:"string"},minScaleDenominator:{type:["string","number"]}},additionalProperties:!1}},title:{type:"string"},description:{type:"string"},tileMatrixSetLimits:{type:"object",patternProperties:{"^[0-9]+$":{type:"object",required:["minTileRow","maxTileRow","minTileCol","maxTileCol"],properties:{minTileRow:{type:"string"},maxTileRow:{type:"string"},minTileCol:{type:"string"},maxTileCol:{type:"string"}},additionalProperties:!1}},additionalProperties:!1},TMSLink:{type:"string"},matrixIds:{type:"array",items:{type:"string"}},tileMatrices:{type:"object",patternProperties:{"^[0-9]+$":{type:"object",required:["matrixId","matrixHeight","matrixWidth","scaleDenominator","tileHeight","tileWidth","topLeftCorner"],properties:{matrixId:{type:"string"},matrixHeight:{type:"integer"},matrixWidth:{type:"integer"},scaleDenominator:{type:"number"},tileHeight:{type:"integer"},tileWidth:{type:"integer"},topLeftCorner:{type:"object",required:["x","y"],properties:{x:{type:"number"},y:{type:"number"}},additionalProperties:!1}},additionalProperties:!1}},additionalProperties:!1},nativeResolutions:{type:"array",items:{type:"string"}}},additionalProperties:!1}},additionalProperties$2=!1,LayerWmtsSchema={$id:$id$3,$schema:$schema$3,type:type$3,required:required$2,properties:properties$2,additionalProperties:additionalProperties$2},$id$2="layer-wms",$schema$2="http://json-schema.org/draft-07/schema#",type$2="object",required$1=["name","title","description","globalConstraint","serviceParams","defaultProjection","queryable","metadata","styles","legends","formats","producer","thematic","base","key","position","opacity","visible","grayscale","params"],properties$1={name:{type:"string"},title:{type:"string"},description:{type:"string"},globalConstraint:{type:"object",required:["minScaleDenominator","maxScaleDenominator","bbox"],properties:{minScaleDenominator:{type:"number"},maxScaleDenominator:{type:"number"},bbox:{type:"object",required:["left","right","top","bottom"],properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},additionalProperties:!1}},additionalProperties:!1},serviceParams:{type:"object",required:["id","version","serverUrl"],properties:{id:{type:"string"},version:{type:"string"},serverUrl:{type:"object",required:["full"],properties:{full:{type:"string",format:"uri"}},additionalProperties:!1}},additionalProperties:!1},defaultProjection:{type:"string"},queryable:{type:"boolean"},metadata:{type:"array",items:{}},styles:{type:"array",items:{type:"object",required:["name","title"],properties:{name:{type:"string"},title:{type:"string"}},additionalProperties:!1}},legends:{type:"array",items:{type:"object",required:["format","url"],properties:{format:{type:"string"},url:{type:"string",format:"uri"}},additionalProperties:!1}},formats:{type:"array",items:{type:"object",required:["name","current"],properties:{name:{type:"string"},current:{type:"boolean"}},additionalProperties:!1}},producer:{type:"array",items:{type:"string"}},thematic:{type:"array",items:{type:"string"}},base:{type:"boolean"},key:{type:"string"},position:{type:"integer"},opacity:{type:"number"},visible:{type:"boolean"},grayscale:{type:"boolean"},params:{type:"object",required:["url","styles","version","format","projection","minScale","maxScale","extent","legends","title","description"],properties:{url:{type:"string",format:"uri"},styles:{type:"string"},version:{type:"string"},format:{type:"string"},projection:{type:"string"},minScale:{type:"number"},maxScale:{type:"number"},extent:{type:"object",required:["left","right","top","bottom"],properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},additionalProperties:!1},legends:{type:"array",items:{type:"object",required:["format","url"],properties:{format:{type:"string"},url:{type:"string",format:"uri"}},additionalProperties:!1}},title:{type:"string"},description:{type:"string"}},additionalProperties:!1}},additionalProperties$1=!1,LayerWmsSchema={$id:$id$2,$schema:$schema$2,type:type$2,required:required$1,properties:properties$1,additionalProperties:additionalProperties$1},$id$1="layer-wfs",$schema$1="http://json-schema.org/draft-07/schema#",type$1="object",LayerWfsSchema={$id:$id$1,$schema:$schema$1,type:type$1},$id="layer-tms",$schema="http://json-schema.org/draft-07/schema#",type="object",required=["name","title","description","params","formats","styles","globalConstraint"],properties={hidden:{type:"boolean"},queryable:{type:"boolean"},serviceParams:{type:"object",required:["id","version","serverUrl"],properties:{id:{type:"string"},version:{type:"string"},serverUrl:{type:"object",required:["full"],properties:{full:{type:"string",format:"uri"}},additionalProperties:!1}},additionalProperties:!1},name:{type:"string"},title:{type:"string"},description:{type:"string"},formats:{type:"array",items:{type:"object",required:["name","current"],properties:{name:{type:"string"},current:{type:"boolean"}},additionalProperties:!1}},styles:{type:"array",items:{type:"object",required:["name","title","url"],properties:{name:{type:"string"},title:{type:"string"},current:{type:"boolean"},url:{type:"string",format:"uri"}},additionalProperties:!1}},globalConstraint:{type:"object",required:["crs","bbox","minScaleDenominator","maxScaleDenominator"],properties:{crs:{type:"string"},bbox:{type:"object",required:["left","right","top","bottom"],properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},additionalProperties:!1},minScaleDenominator:{type:"number"},maxScaleDenominator:{type:"number"}},additionalProperties:!1},defaultProjection:{type:"string"},thematic:{type:"array",items:{type:"string"}},base:{type:"boolean"},producer:{type:"array",items:{type:"string"}},key:{type:"string"},position:{type:"integer"},opacity:{type:"number"},visible:{type:"boolean"},grayscale:{type:"boolean"},params:{type:"object",required:["url","styles","version","format","projection","minScale","maxScale","extent","title","description"],properties:{url:{type:"string",format:"uri"},styles:{type:"string"},version:{type:"string"},format:{type:"string"},projection:{type:"string"},minScale:{type:"number"},maxScale:{type:"number"},extent:{type:"object",required:["left","right","top","bottom"],properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},additionalProperties:!1},title:{type:"string"},description:{type:"string"}},additionalProperties:!1}},additionalProperties=!1,LayerTmsSchema={$id,$schema,type,required,properties,additionalProperties};class JsonValidatorUtils{constructor(){this.ajv=new Ajv({strict:!1,allErrors:!0}),addFormats(this.ajv,{mode:"fast",formats:["uri"],keywords:!0}),this.schemas={},this.loadSchemas()}loadSchemas(){this.ajv.addSchema(CatalogSchema,CatalogSchema.$id),this.schemas[CatalogSchema.$id]=CatalogSchema,this.ajv.addSchema(TerrotoriesSchema,TerrotoriesSchema.$id),this.schemas[TerrotoriesSchema.$id]=TerrotoriesSchema,this.ajv.addSchema(LayerWmtsSchema,LayerWmtsSchema.$id),this.schemas[LayerWmtsSchema.$id]=LayerWmtsSchema,this.ajv.addSchema(LayerWmsSchema,LayerWmsSchema.$id),this.schemas[LayerWmsSchema.$id]=LayerWmsSchema,this.ajv.addSchema(LayerWfsSchema,LayerWfsSchema.$id),this.schemas[LayerWfsSchema.$id]=LayerWfsSchema,this.ajv.addSchema(LayerTmsSchema,LayerTmsSchema.$id),this.schemas[LayerTmsSchema.$id]=LayerTmsSchema}validate(e,i){if(!this.schemas[e])throw new Error(`Aucun schma trouv pour le type "${e}"`);const n=this.ajv.getSchema(e);return n(i)?{valid:!0}:{valid:!1,errors:n.errors}}}window.Gp&&(window.Gp.JsonValidatorUtils=JsonValidatorUtils);const mainMap="mainMap",printMap="printMap",_hoisted_1$1=["id"],__default__$7={name:"Map"},_sfc_main$w=Object.assign(__default__$7,{props:{mapId:String},setup(s,{expose:e}){const i=useMapStore(),n=s,o=ref$1(null),l=new Map$1({target:n.mapId,controls:[],interactions:defaults$3().extend([new MouseWheelZoom({constrainResolution:!0,condition:shiftKeyOnly})])}),c=new Set,u=5e3,h=location.origin+location.pathname;function f(){const ee=setTimeout(()=>{console.warn("Fallback loadend dclench"),g(),c.delete(ee)},u);c.add(ee)}function g(){history.pushState(null,"",h)}l.on("loadstart",f),l.on("loadend",()=>{const ee=c.values().next().value;ee&&(clearTimeout(ee),c.delete(ee)),g()}),provide(n.mapId,l),onMounted(()=>{CRS.loadByDefault(),l.setTarget(o.value);const ee=o.value.getElementsByTagName("canvas");ee.length&&(ee[0].tabIndex=0),n.mapId==mainMap&&i.setMap(l)});const H=()=>{document.activeElement.tagName!=="INPUT"&&document.activeElement.tagName!=="SELECT"&&document.querySelector("button[id^=GPSearchEngine-advanced-btn-]").getAttribute("aria-expanded")!=="true"&&o.value.focus()};return e({mapRef:o,updateSize:()=>{l.updateSize()}}),(ee,te)=>(openBlock(),createElementBlock("div",{id:s.mapId,ref_key:"mapRef",ref:o,tabindex:"0",onMouseover:H},[renderSlot(ee.$slots,"default")],40,_hoisted_1$1))}}),__default__$6={name:"View"},_sfc_main$v=Object.assign(__default__$6,{props:{zoom:Number,center:Array,mapId:String},setup(s){const e=useMapStore(),i=s,n=inject(i.mapId),o=new View({zoom:i.zoom,center:fromLonLat(i.center),minZoom:0,maxZoom:19,projection:"EPSG:3857"});return o.on("change:center",l=>{if(i.mapId==mainMap){e.x=l.target.getCenter()[0],e.y=l.target.getCenter()[1];var c=toLonLat(l.target.getCenter());e.lon=c[0],e.lat=c[1]}}),o.on("change:resolution",l=>{e.zoom=o.getZoom()}),onMounted(()=>{n&&n.setView(o)}),(l,c)=>null}}),useDataStore=defineStore("data",()=>{const s=ref$1({}),e=ref$1({}),i=ref$1({}),n=ref$1({}),o=ref$1([]),l=ref$1([]),c=ref$1([]),u=ref$1([]),h=ref$1(!1),f=ref$1(""),g="WMTS,WMS,TMS",H="IGNF:LAMB93,EPSG:2154",Y=ref$1([]),ee=ref$1([]),te=computed(()=>{let _t=[];return _t=[...new Set(Object.values(s.value).flatMap(dt=>(dt==null?void 0:dt.thematic)||[]).filter(dt=>typeof dt=="string"))].sort((dt,ft)=>dt==="Autres"?1:ft==="Autres"?-1:dt.localeCompare(ft,"fr",{sensitivity:"base"})),_t=_t.map(dt=>[dt,nt(dt)]),_t}),xe=computed(()=>{let _t=[];return _t=[...new Set(Object.values(s.value).flatMap(dt=>(dt==null?void 0:dt.producer)||[]).filter(dt=>typeof dt=="string"))].sort((dt,ft)=>dt==="Autres"?1:ft==="Autres"?-1:dt.localeCompare(ft,"fr",{sensitivity:"base"})),_t.map(dt=>[dt,at(dt)])});async function ne(){try{var _t=null;try{const Ft=window.__ENV__.VITE_GPF_CONF_ALERTS;if(_t=await fetch(Ft),!_t.ok)throw new Error("Erreur HTTP")}catch{_t=await fetch("data/alerts.json")}const dt=await _t.json();c.value=dt;const ft=window.__ENV__.VITE_GPF_CONF_ENTREE_CARTO,Gt=await(await fetch(ft)).json();return o.value=Gt.territories,n.value=Gt.contacts,l.value=Gt.featured||[],s.value=Gt.layers,e.value.apiKeys={...Gt.generalOptions.apiKeys},i.value=Gt.tileMatrixSets,u.value=Gt.topics||[],this.isLoaded=!0,Gt.layers}catch(dt){console.log(dt),this.isLoaded=!1,f.value=dt.message}}function et(){return o.value}function tt(){return n.value}function it(){return c.value.filter(_t=>_t.visibility.map)}function rt(){return te.value}function nt(_t){return Object.keys(s.value).filter(dt=>s.value[dt].thematic.includes(_t)).map(dt=>dt)}function st(){return xe.value}function at(_t){return Object.keys(s.value).filter(dt=>s.value[dt].producer.includes(_t)).map(dt=>dt)}function ot(){return l.value}function ct(){return s.value}function ht(){return Object.fromEntries(Object.entries(s.value).map(([_t,dt])=>[dt.name,dt.serviceParams.id.split(":")[1]]))}function ut(_t,dt){for(const ft in s.value)if(Object.hasOwnProperty.call(s.value,ft)){const bt=s.value[ft];if(bt.name===_t&&bt.serviceParams.id.split(":")[1]===dt)return bt.name+"$GEOPORTAIL:"+bt.serviceParams.id}}function pt(_t,dt){const ft=this.getLayerIdByName(_t,dt);return this.getLayerByID(ft)}function yt(_t){return s.value[_t]}function mt(_t){return Object.values(s.value).filter(dt=>{if(_t&&dt.title==_t)return dt})}function St(_t){var dt=[],ft=e.value.apiKeys;for(var bt in ft){var Gt=ft[bt];Gt.forEach(function(Ft){Ft===_t&&dt.push(bt)})}return dt}function Pt(_t,dt){var ft=null;if((dt==="WMS"||Object.keys(this.getTileMatrixSets()).length!==0)&&Object.keys(this.getLayers()).length!==0){var bt=this.getLayerIdByName(_t,dt);ft=this.getLayerParamsByID(bt)}return ft}function Rt(_t){var dt=null;if(_t){dt={};var ft=this.getLayerByID(_t),bt=this.getLayerKeysByID(_t);if(bt.length===0)return;for(var Gt=0;Gt<bt.length;Gt++)ft.serviceParams.serverUrl[bt[Gt]]&&(dt.url=ft.serviceParams.serverUrl[bt[Gt]]);if(/\/v\//.test(dt.url)?dt.styles=" ":dt.styles=ft.styles[0].name,dt.version=ft.serviceParams.version,dt.format=ft.formats[0].name,dt.projection=ft.defaultProjection,dt.minScale=ft.globalConstraint.minScaleDenominator,dt.maxScale=ft.globalConstraint.maxScaleDenominator,dt.extent=ft.globalConstraint.bbox,dt.legends=ft.legends,dt.title=ft.title,dt.description=ft.description,ft.wmtsOptions){dt.tileMatrixSetLimits=ft.wmtsOptions.tileMatrixSetLimits;var Ft=ft.wmtsOptions.tileMatrixSetLink;if(Ft){dt.TMSLink=Ft;var Ht=this.getTileMatrixSetByID(Ft);dt.matrixIds=Object.keys(Ht.tileMatrices),dt.tileMatrices=Ht.tileMatrices,dt.nativeResolutions=Ht.nativeResolutions}}}return dt}function Lt(_t){var dt=null;if(_t){var ft=this.getLayerByID(_t);dt={},dt.projection=ft.globalConstraint.crs,dt.minScale=ft.globalConstraint.minScaleDenominator,dt.maxScale=ft.globalConstraint.maxScaleDenominator,dt.extent=ft.globalConstraint.bbox}return dt}function Nt(_t,dt){var ft=this.getLayerIdByName(_t,dt);return this.getGlobalConstraintsByID(ft)}function vt(){return i.value}function Et(_t){return i.value[_t]}function Ct(){return u.value}return{error:f,isLoaded:h,filterProjections:H,filterServices:g,producers:ee,themes:Y,fetchData:ne,getTerritories:et,getContacts:tt,getAlerts:it,getLayersByThematic:nt,getThematics:rt,getLayersByProducer:at,getProducers:st,getFeatured:ot,getLayers:ct,getLayersSignatures:ht,getLayerKeysByID:St,getLayerIdByName:ut,getLayerByName:pt,getLayerByID:yt,getLayerByTitle:mt,getTileMatrixSets:vt,getTileMatrixSetByID:Et,getLayerParamsByName:Pt,getLayerParamsByID:Rt,getGlobalConstraintsByID:Lt,getGlobalConstraintsByName:Nt,getTopics:Ct}}),_sfc_main$u={__name:"SearchEngine",props:{mapId:String,visibility:Boolean,analytic:Boolean,searchEngineOptions:Object},setup(s){inject("emitter");const e=s,i=distExports$1.useLogger(),n=useMapStore(),o=useDataStore(),l=inject(e.mapId),c=ref$1(new InseeAdvancedSearch),u=ref$1(new LocationAdvancedSearch),h=ref$1(new CoordinateAdvancedSearch),f=ref$1(new ParcelAdvancedSearch),g=computed(()=>Object.assign(e.searchEngineOptions,{advancedSearch:[c.value,u.value,h.value,f.value]})),H=ref$1(new SearchEngineAdvanced(g.value));onMounted(()=>{e.visibility&&(l.addControl(H.value),H.value.on("searchengine:search:click",Y),H.value.on("searchengine:autocomplete:click",ee),H.value.on("searchengine:geocode:click",te),H.value.on("searchengine:coordinates:click",xe),H.value.on("searchengine:geolocation:click",ne),H.value.on("searchengine:geolocation:remove",et))}),onBeforeUpdate(()=>{e.visibility||l.removeControl(H.value)}),onUpdated(()=>{e.visibility&&l.addControl(H.value)}),onUnmounted(()=>{});const Y=tt=>{var it=o.getLayerIdByName(tt.suggest.name,tt.suggest.service);n.addLayer(it),i.debug("onClickSearch",it)},ee=tt=>{},te=tt=>{},xe=tt=>{},ne=tt=>{n.geolocation=toLonLat(tt.coordinates).toString()},et=tt=>{n.geolocation=""};return(tt,it)=>null}},UNITS_PROP="units",LEADING_DIGITS=[1,2,5],DEFAULT_DPI=25.4/.28;class ScaleLine extends Control{constructor(e){e=e||{};const i=document.createElement("div");i.style.pointerEvents="none",super({element:i,render:e.render,target:e.target}),this.on,this.once,this.un;const n=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+CLASS_UNSELECTABLE,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(UNITS_PROP,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(UNITS_PROP)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(UNITS_PROP,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const i=e.center,n=e.projection,o=this.getUnits(),l=o=="degrees"?"degrees":"m";let c=getPointResolution(n,e.resolution,i,l);const u=this.minWidth_*(this.dpi_||DEFAULT_DPI)/DEFAULT_DPI,h=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||DEFAULT_DPI)/DEFAULT_DPI:void 0;let f=u*c,g="";if(o=="degrees"){const it=METERS_PER_UNIT.degrees;f*=it,f<it/60?(g="",c*=3600):f<it?(g="",c*=60):g=""}else if(o=="imperial")f<.9144?(g="in",c/=.0254):f<1609.344?(g="ft",c/=.3048):(g="mi",c/=1609.344);else if(o=="nautical")c/=1852,g="NM";else if(o=="metric")f<1e-6?(g="nm",c*=1e9):f<.001?(g="m",c*=1e6):f<1?(g="mm",c*=1e3):f<1e3?g="m":(g="km",c/=1e3);else if(o=="us")f<.9144?(g="in",c*=39.37):f<1609.344?(g="ft",c/=.30480061):(g="mi",c/=1609.3472);else throw new Error("Invalid units");let H=3*Math.floor(Math.log(u*c)/Math.log(10)),Y,ee,te,xe=0,ne,et;for(;;){te=Math.floor(H/3);const it=Math.pow(10,te);if(Y=LEADING_DIGITS[(H%3+3)%3]*it,ee=Math.round(Y/c),isNaN(ee)){this.element.style.display="none",this.renderedVisible_=!1;return}if(h!==void 0&&ee>=h){Y=xe,ee=ne,te=et;break}else if(ee>=u)break;xe=Y,ne=ee,et=te,++H}const tt=this.scaleBar_?this.createScaleBar(ee,Y,g):Y.toFixed(te<0?-te:0)+" "+g;this.renderedHTML_!=tt&&(this.innerElement_.innerHTML=tt,this.renderedHTML_=tt),this.renderedWidth_!=ee&&(this.innerElement_.style.width=ee+"px",this.renderedWidth_=ee),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,i,n){const o=this.getScaleForResolution(),l=o<1?Math.round(1/o).toLocaleString()+" : 1":"1 : "+Math.round(o).toLocaleString(),c=this.scaleBarSteps_,u=e/c,h=[this.createMarker("absolute")];for(let g=0;g<c;++g){const H=g%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";h.push(`<div><div class="ol-scale-singlebar ${H}" style="width: ${u}px;"></div>`+this.createMarker("relative")+(g%2===0||c===2?this.createStepText(g,e,!1,i,n):"")+"</div>")}return h.push(this.createStepText(c,e,!0,i,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+l+"</div>":"")+h.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,i,n,o,l){const u=(e===0?0:Math.round(o/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+l),h=e===0?-3:i/this.scaleBarSteps_*-1,f=e===0?0:i/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${h}px;text-align: ${e===0?"left":"center"};min-width: ${f}px;left: ${n?i+"px":"unset"};">`+u+"</div>"}getScaleForResolution(){const e=getPointResolution(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),i=this.dpi_||DEFAULT_DPI,n=1e3/25.4;return e*n*i}render(e){const i=e.frameState;i?this.viewState_=i.viewState:this.viewState_=null,this.updateElement_()}}const _sfc_main$t={__name:"ScaleLine",props:{mapId:String,visibility:Boolean,analytic:Boolean,scaleLineOptions:Object},setup(s){const e=s,i=inject(e.mapId),n=ref$1(new ScaleLine(e.scaleLineOptions));return onMounted(()=>{e.visibility&&i.addControl(n.value)}),onBeforeUpdate(()=>{e.visibility||i.removeControl(n.value)}),onUpdated(()=>{e.visibility&&i.addControl(n.value)}),(o,l)=>null}};function useActionButtonEulerian(s){s.setAttribute("data-fr-analytics-action",s.title),s.setAttribute("data-fr-js-button-actionee",!0)}const _sfc_main$s={__name:"OverviewMap",props:{mapId:String,visibility:Boolean,analytic:Boolean,overviewMapOptions:Object},setup(s){const e=s,i=distExports$1.useLogger(),n=inject(e.mapId),o=ref$1(new GeoportalOverviewMap(e.overviewMapOptions)),l=useMatchMedia("SM");watch(l,()=>{if(e.visibility&&!l.value){if(n.addControl(o.value),e.analytic){var u=o.value.element.querySelector("button[id^=GPshowOverviewMap-]");useActionButtonEulerian(u)}}else n.removeControl(o.value)}),onMounted(()=>{if(e.visibility&&!l.value&&(n.addControl(o.value),o.value.on("overviewmap:toggle",c),e.analytic)){var u=o.value.element.querySelector("button[id^=GPshowOverviewMap-]");useActionButtonEulerian(u)}}),onBeforeUpdate(()=>{if(e.visibility&&!l.value){if(n.addControl(o.value),e.analytic){var u=o.value.element.querySelector("button[id^=GPshowOverviewMap-]");useActionButtonEulerian(u)}}else n.removeControl(o.value)});function c(u){i.debug(u)}return(u,h)=>null}},_sfc_main$r={__name:"Zoom",props:{mapId:String,visibility:Boolean,analytic:Boolean,zoomOptions:Object},setup(s){const e=s,i=distExports$1.useLogger(),n=inject(e.mapId),o=ref$1(new GeoportalZoom(e.zoomOptions));onMounted(()=>{e.visibility&&(n.addControl(o.value),o.value.on("zoom:in",l),o.value.on("zoom:out",c))}),onBeforeUpdate(()=>{e.visibility||n.removeControl(o.value)}),onUpdated(()=>{e.visibility&&n.addControl(o.value)});function l(u){i.debug(u)}function c(u){i.debug(u)}return(u,h)=>null}},_sfc_main$q={__name:"LayerSwitcher",props:{mapId:String,visibility:Boolean,analytic:Boolean,layerSwitcherOptions:Object},setup(s){const e=s,i=distExports$1.useLogger(),n=useMapStore(),o=useDataStore(),l=inject("emitter"),c=inject(e.mapId),u=ref$1(new LayerSwitcher(e.layerSwitcherOptions));onMounted(()=>{if(e.visibility){if(c.addControl(u.value),e.analytic){var et=u.value.element.querySelector("button[id^=GPshowLayersListPicto-]");useActionButtonEulerian(et)}u.value.on("layerswitcher:add",h),u.value.on("layerswitcher:remove",f),u.value.on("layerswitcher:edit",ne),u.value.on("layerswitcher:extent",g),u.value.on("layerswitcher:change:opacity",H),u.value.on("layerswitcher:change:visibility",Y),u.value.on("layerswitcher:change:position",ee),u.value.on("layerswitcher:change:grayscale",te),u.value.on("layerswitcher:change:style",xe)}}),onBeforeUpdate(()=>{if(!e.visibility&&(c.removeControl(u.value),e.analytic)){var et=u.value.element.querySelector("button[id^=GPshowLayersListPicto-]");useActionButtonEulerian(et)}}),onUpdated(()=>{e.visibility&&c.addControl(u.value)});const h=et=>{i.debug("onAddLayer",et);var tt=et.layer,it=null;if(tt.name&&tt.service){if(it=o.getLayerIdByName(tt.name,tt.service),i.debug(tt.name,"| position",tt.layer.getZIndex()),n.updateLayerProperty(it,{position:tt.layer.getZIndex()}),tt.service==="TMS"){var rt=tt.layer.styleName,nt=tt.layer.styleUrl;i.debug("TMS",rt,nt),rt&&nt&&n.updateLayerProperty(it,{style:rt})}}else{var st=tt.layer.gpResultLayerId;it=st,st&&(tt.layer.gpResultLayerDiv=tt.div,st.startsWith("bookmark")&&(it=st.split(":").pop(),i.debug(it,"| position",tt.layer.getZIndex()),n.updateBookmarkPropertyByID(it,{p:tt.layer.getZIndex()})))}i.debug("onAddLayer",it),it?push$1.success({title:t$1.layerswitcher.title,message:t$1.layerswitcher.add_success}):push$1.warning({title:t$1.layerswitcher.title,message:t$1.layerswitcher.add_failed})},f=et=>{i.debug("onRemoveLayer",et);var tt=et.layer,it=null;if(tt.name&&tt.service)it=o.getLayerIdByName(tt.name,tt.service),it&&n.removeLayer(it);else{var rt=tt.layer.gpResultLayerId;rt&&(it=rt.split(":").pop(),rt.startsWith("bookmark")&&it&&n.removeBookmarkByID(it))}var nt=et.target._layersOrder;if(nt){for(const st in nt)if(Object.prototype.hasOwnProperty.call(nt,st)){const at=nt[st];if(at.layer.name&&at.layer.service)it=o.getLayerIdByName(at.layer.name,at.layer.service),it&&n.updateLayerProperty(it,{position:at.layer.getZIndex()});else{var rt=at.layer.gpResultLayerId;rt&&rt.startsWith("bookmark")&&(it=rt.split(":").pop(),it&&n.updateBookmarkPropertyByID(it,{p:at.layer.getZIndex()}))}}}i.debug("onRemoveLayer",it),it?push$1.success({title:t$1.layerswitcher.title,message:t$1.layerswitcher.remove_success}):push$1.warning({title:t$1.layerswitcher.title,message:t$1.layerswitcher.remove_failed})},g=et=>{i.debug("onZoomToExtentLayer",et);var tt=et.layer;if(et.error){var it=o.getGlobalConstraintsByName(tt.name,tt.service);if(it){var rt=c.getView(),nt=rt.getProjection(),st=[it.extent.left,it.extent.bottom,it.extent.right,it.extent.top],at=it.projection;at||(at="EPSG:4326");var ot=transformExtent(st,at,nt);ot&&rt.fit(ot)}}},H=et=>{i.debug("onChangeOpacityLayer",et);var tt=et.layer,it=null;if(tt.name&&tt.service)it=o.getLayerIdByName(tt.name,tt.service),it&&n.updateLayerProperty(it,{opacity:et.opacity});else{var rt=tt.layer.gpResultLayerId;rt&&rt.startsWith("bookmark")&&(it=rt.split(":").pop(),it&&n.updateBookmarkPropertyByID(it,{o:et.opacity}))}},Y=et=>{i.debug("onChangeVisibilityLayer",et);var tt=et.layer,it=null;if(tt.name&&tt.service)it=o.getLayerIdByName(tt.name,tt.service),it&&n.updateLayerProperty(it,{visible:et.visibility});else{var rt=tt.layer.gpResultLayerId;rt&&rt.startsWith("bookmark")&&(it=rt.split(":").pop(),it&&n.updateBookmarkPropertyByID(it,{v:et.visibility}))}},ee=et=>{i.debug("onChangePositionLayer",et),n.updateLayerPosition(et.layers.reverse().map(tt=>{if(tt.name&&tt.service)return o.getLayerIdByName(tt.name,tt.service)}))},te=et=>{i.debug("onChangeGrayScaleLayer",et);var tt=et.layer,it=null;if(tt.name&&tt.service)it=o.getLayerIdByName(tt.name,tt.service),it&&n.updateLayerProperty(it,{grayscale:et.grayscale||!1});else{var rt=tt.layer.gpResultLayerId;rt&&rt.startsWith("bookmark")&&(it=rt.split(":").pop(),it&&n.updateBookmarkPropertyByID(it,{g:et.grayscale||!1}))}},xe=et=>{if(i.debug("onChangeStyleMapboxLayer",et),et.layer.name&&et.layer.service){var tt=o.getLayerIdByName(et.layer.name,et.layer.service),it=et.name,rt=et.url;i.debug("TMS",it,rt),it&&rt&&n.updateLayerProperty(tt,{style:it})}},ne=et=>{if(i.debug("onClickEditLayer",et),et.layer.gpResultLayerId){var tt=et.layer.gpResultLayerId.toLowerCase();if(tt){if(tt.toLowerCase().includes("drawing")||tt.toLowerCase().includes("layerimport:kml")||tt.toLowerCase().includes("layerimport:gpx")||tt.toLowerCase().includes("layerimport:geojson")||tt.toLowerCase().includes("bookmark:drawing-kml")||tt.toLowerCase().includes("bookmark:import-kml")||tt.toLowerCase().includes("bookmark:import-gpx")||tt.toLowerCase().includes("bookmark:import-geojson")){n.addControl("Drawing"),setTimeout(function(){l.dispatchEvent("vector:edit:clicked",et)},0);return}if(tt.toLowerCase().includes("bookmark:compute-route")||tt.toLowerCase().includes("compute:pieton$ogc:openls;itineraire")||tt.toLowerCase().includes("compute:voiture$ogc:openls;itineraire")||tt.toLowerCase().includes("layerimport:compute")&&et.layer.get("control")==="route"){n.addControl("Route"),setTimeout(function(){l.dispatchEvent("compute-route:edit:clicked",et)},0);return}if(tt.toLowerCase().includes("bookmark:compute-isocurve")||tt.toLowerCase().includes("compute:pieton$geoportail:gpp:isocurve")||tt.toLowerCase().includes("compute:voiture$geoportail:gpp:isocurve")||tt.toLowerCase().includes("layerimport:compute")&&et.layer.get("control")==="isocurve"){n.addControl("Isocurve"),setTimeout(function(){l.dispatchEvent("compute-isocurve:edit:clicked",et)},0);return}if(tt.toLowerCase().includes("bookmark:compute-profil")||tt.toLowerCase().includes("measure:profil")||tt.toLowerCase().includes("layerimport:compute")&&et.layer.get("control")==="elevationpath"){n.addControl("ElevationPath"),setTimeout(function(){l.dispatchEvent("compute-profil:edit:clicked",et)},0);return}}}push$1.warning({title:t$1.layerswitcher.title,message:t$1.layerswitcher.failed_not_yet_implemented})};return(et,tt)=>null}},_sfc_main$p={__name:"Legends",props:{mapId:String,visibility:Boolean,analytic:Boolean,legendsOptions:Object},setup(s){const e=s,i=inject(e.mapId),n=ref$1(new Legends(e.legendsOptions));return onMounted(()=>{if(e.visibility&&(i.addControl(n.value),e.analytic)){var o=n.value.element.querySelector("button[id^=GPshowLegendsPicto-]");useActionButtonEulerian(o)}}),onBeforeUpdate(()=>{if(e.visibility){if(i.addControl(n.value),e.analytic){var o=n.value.element.querySelector("button[id^=GPshowLegendsPicto-]");useActionButtonEulerian(o)}}else i.removeControl(n.value)}),(o,l)=>null}},useCreateDocument=async(s,e,i)=>{try{const c=await i.setDocument(s);var n=c.uuid,o=c.action;if(s.layer.gpResultLayerId&&(s.layer.gpResultLayerId=`bookmark:${s.type}-${s.compute||s.format}:${n}`),s.layer.gpResultLayerDiv){var l=s.layer.gpResultLayerDiv.querySelector("label[id^=GPname_ID_]");l&&(l.innerHTML=s.name,l.title=s.description)}const u=await i.sharingDocument({uuid:n,type:s.type});console.debug(u);const h=await i.updateMetadataDocument({uuid:n,type:s.type,name:s.name,description:s.description,extra:{format:s.format.toLowerCase(),target:"internal",date:new Date().toLocaleDateString()}});return console.debug(h),e.dispatchEvent("document:saved",{uuid:n,action:o}),c}catch(c){throw console.error(c),c}},useUpdateDocument=async(s,e,i)=>{try{const c=await i.updateGeometryDocument(s);var n=c.uuid,o=c.action;if(s.layer.gpResultLayerDiv){var l=s.layer.gpResultLayerDiv.querySelector("label[id^=GPname_ID_]");l&&(l.innerHTML=s.name,l.title=s.description)}const u=i.find(n);if(u&&!u.public_url){const f=await i.sharingDocument({uuid:n,type:s.type});console.debug(f)}const h=await i.updateMetadataDocument({uuid:n,type:s.type,name:s.name,description:s.description,extra:{format:s.format.toLowerCase(),target:"internal",date:new Date().toLocaleDateString()}});return console.debug(h),e.dispatchEvent("document:updated",{uuid:n,action:o}),c}catch(c){throw console.error(c),c}},toShare=(s,e)=>{var i=useServiceStore(),n=i.getService();if(!s){console.debug("toShare: Document non dfini !");return}var o=null;if(s.public_url){var o=s.public_url,l=new URLSearchParams;l.append("id",s._id),l.append("name",s.name),l.append("description",s.description),l.append("format",s.labels.find(u=>n.labelsFormats.includes(u))),l.append("type",s.labels.find(u=>n.labels.includes(u))),l.append("target",s.labels.find(u=>n.labelsTarget.includes(u))),l.append("kind",s.labels.find(u=>n.labelsService.includes(u))),l.append("compute",s.labels.find(u=>n.labelsCompute.includes(u))),e&&Object.keys(e).forEach(u=>l.append(u,e[u])),o+="?"+l.toString()}if(!o){console.debug("toShare: URL publique non dfinie !");return}return _reduce(o)},fromShare=s=>{var e={};if(!s){console.debug("toShare: URL publique non dfinie !");return}var i,n;i=s.split(SEPARATOR_REDUCED_URL)[0],n=s.split(SEPARATOR_REDUCED_URL)[1];var o=new URLSearchParams(n);if(o.forEach((l,c)=>{e[c]=l}),Object.keys(e).length===0){console.debug("fromShare: Document non dfini !");return}return e.u=i.split("?")[0],e.i=e.i||e.u.split(".")[0],_extend(e)},SEPARATOR_REDUCED_URL="?",SEPARATOR_REDUCED_PARAMS="&",REDUCED_BASE_URL=window.__ENV__.VITE_GPF_BASE_URL_DOCUMENT||"https://data.geopf.fr/documents/",REDUCED_KVP={url:{k:"u",opt:!1},id:{k:"i",opt:!1},name:{k:"n",opt:!1},description:{k:"d",opt:!0},format:{k:"f",opt:!1},type:{k:"t",opt:!1},target:{k:"c",opt:!1},kind:{k:"k",opt:!1},compute:{k:"w",opt:!1},position:{k:"p",opt:!1},opacity:{k:"o",opt:!1},visible:{k:"v",opt:!1},grayscale:{k:"g",opt:!1},stop:{k:"s",opt:!1}},_reduce=s=>{var e=new URL(s),i=new URLSearchParams(e.search),n=new URLSearchParams;i.forEach((l,c)=>{if(!(l===""||l===void 0||l==="undefined"))if(REDUCED_KVP[c]){if(REDUCED_KVP[c].opt)return;n.append(REDUCED_KVP[c].k,l)}else n.append(c,l)});var o=(e.origin+e.pathname).replace(REDUCED_BASE_URL,"")+SEPARATOR_REDUCED_URL+""+n.toString().replace("&",SEPARATOR_REDUCED_PARAMS);return o},_extend=s=>{var e={};Object.keys(REDUCED_KVP).forEach(n=>{e[REDUCED_KVP[n].k]=n});var i={};return Object.keys(s).forEach(n=>{var o=s[n];e[n]?i[e[n]]=o:i[n]=o}),i.url=REDUCED_BASE_URL+i.url,i},__default__$5={name:"Drawing"},_sfc_main$o=Object.assign(__default__$5,{props:{mapId:String,visibility:Boolean,analytic:Boolean,drawingOptions:Object},setup(s){const e=inject("emitter");var i=inject("services");const n=useMapStore(),o=distExports$1.useLogger(),l=s,c=inject(l.mapId),u=ref$1(new Drawing(l.drawingOptions)),h="kml",f=ref$1(new ButtonExport({title:"Exporter",kind:"secondary",download:!0,name:"Mon croquis",description:"",control:u.value,menu:!0,menuOptions:{outside:!0,above:!0,selectFormat:!1,labelDesc:!1},direction:"column",format:h,icons:{menu:"",button:"export"}})),g=ref$1(new ButtonExport({title:"Enregistrer",kind:"primary",download:!1,name:"Mon croquis",description:"",control:u.value,menu:!1,format:h,icons:{menu:"",button:"save"}}));e.addEventListener("vector:edit:clicked",te=>{u.value&&(u.value.setCollapsed(!1),u.value.setLayer(te.layer),f.value.inputName.value=te.options.title||"");var xe=te.layer.gpResultLayerId.toLowerCase();if(xe){var ne;xe.includes("drawing")||xe.includes("kml")?ne="kml":xe.includes("geojson")?ne="geojson":xe.includes("gpx")?ne="gpx":ne="kml",f.value.setFormat(ne),g.value.setFormat(ne)}}),e.addEventListener("drawing:open:clicked",te=>{u.value&&u.value.setCollapsed(!te.open)}),onMounted(()=>{if(l.visibility){if(c.addControl(u.value),c.addControl(f.value),window.__ENV__.IAM_DISABLE==="1"&&(g.value.getContainer().style.display="none"),c.addControl(g.value),l.analytic){var te=u.value.element.querySelector("button[id^=GPshowDrawingPicto-]");useActionButtonEulerian(te)}g.value.on("button:clicked",Y),f.value.on("button:clicked",ee),u.value.on("change:collapsed",H)}}),onBeforeUpdate(()=>{if(l.visibility){if(c.addControl(u.value),c.addControl(f.value),window.__ENV__.IAM_DISABLE==="1"&&(g.value.getContainer().style.display="none"),c.addControl(g.value),l.analytic){var te=u.value.element.querySelector("button[id^=GPshowDrawingPicto-]");useActionButtonEulerian(te)}g.value.on("button:clicked",Y),f.value.on("button:clicked",ee),u.value.on("change:collapsed",H)}else c.removeControl(g.value),c.removeControl(u.value),c.removeControl(f.value)});const H=te=>{o.debug(te),te.target.collapsed&&(u.value.setLayer(),f.value.inputName.value="",f.value.setFormat(h),g.value.setFormat(h))},Y=te=>{if(o.debug(te),!i.authenticated){push$1.warning({title:t$1.auth.title,message:t$1.auth.not_authentificated});return}var xe=te.layer.gpResultLayerId.toLowerCase(),ne=xe.split(":")[0],et={layer:te.layer,content:te.content,name:f.value.inputName.value||te.name,description:te.description,format:te.format.toLowerCase(),target:"internal",type:xe.split(":")[0].replace("layer","")},tt;if(ne!=="bookmark")tt=useCreateDocument(et,e,i);else{var it=xe.split(":")[2],ne=xe.split(":")[1].split("-")[0];et.type=ne,et.uuid=it,tt=useUpdateDocument(et,e,i)}tt.then(rt=>{var nt=i.find(rt.uuid);if(nt){var st=toShare(nt,{opacity:et.layer.get("opacity"),visible:et.layer.get("visible"),grayscale:et.layer.get("grayscale"),stop:1});if(rt.action==="added")n.addBookmark(st);else if(rt.action==="updated")n.updateBookmark(st);else throw new Error("Action not yet implemented !")}}).then(()=>{push$1.success({title:t$1.drawing.title,message:t$1.drawing.save_success})}).catch(rt=>{console.error(rt),push$1.error({title:t$1.drawing.title,message:t$1.drawing.save_failed})})},ee=te=>{};return(te,xe)=>null}});function useActionEdit(s,e){s&&(e.get("geojson")&&typeof s.setGeoJSON=="function"&&s.setGeoJSON(e.get("geojson")),e.get("data")&&s.setData(e.get("data")),(e.get("control")==="route"||e.get("control")==="isocurve"||e.get("control")==="elevationpath"||s.CLASSNAME==="Isocurve"||s.CLASSNAME==="Route"||s.CLASSNAME==="ElevationPath")&&(s.setLayer(e),s.init()),typeof s.setCollapsed=="function"&&s.setCollapsed(!1))}const _sfc_main$n={__name:"Isocurve",props:{mapId:String,visibility:Boolean,analytic:Boolean,isocurveOptions:Object},setup(s){const e=inject("emitter");var i=inject("services");const n=s,o=distExports$1.useLogger();useDataStore();const l=useMapStore(),c=inject(n.mapId),u=ref$1(new Isocurve(n.isocurveOptions)),h=ref$1(new ButtonExport({title:"Exporter",kind:"secondary",download:!0,name:"Mon iso",description:"",control:u.value,menu:!0,menuOptions:{outside:!0,above:!0,selectFormat:!1,labelDesc:!1},direction:"column",format:"geojson",icons:{menu:"",button:"export"}})),f=ref$1(new ButtonExport({title:"Enregistrer",kind:"primary",download:!1,control:u.value,format:"geojson",menu:!1,direction:"column",icons:{menu:"",button:"save"}}));e.addEventListener("compute-isocurve:edit:clicked",ne=>{o.debug(ne),h.value.inputName.value=ne.options.title||"",useActionEdit(u.value,ne.layer)}),onMounted(()=>{if(n.visibility){if(c.addControl(u.value),c.addControl(h.value),window.__ENV__.IAM_DISABLE==="1"&&(f.value.getContainer().style.display="none"),c.addControl(f.value),n.analytic){var ne=u.value.element.querySelector("button[id^=GPshowIsochronPicto-]");useActionButtonEulerian(ne)}u.value.on("isocurve:drawstart",H),u.value.on("socurve:drawend",Y),u.value.on("isocurve:compute",ee),u.value.on("change:collapsed",g),h.value.on("button:clicked",xe),f.value.on("button:clicked",te)}}),onBeforeUpdate(()=>{n.visibility||(c.removeControl(u.value),c.removeControl(f.value),c.removeControl(h.value))}),onUpdated(()=>{if(n.visibility){if(c.addControl(u.value),c.addControl(h.value),window.__ENV__.IAM_DISABLE==="1"&&(f.value.getContainer().style.display="none"),c.addControl(f.value),n.analytic){var ne=u.value.element.querySelector("button[id^=GPshowIsochronPicto-]");useActionButtonEulerian(ne)}u.value.on("isocurve:drawstart",H),u.value.on("socurve:drawend",Y),u.value.on("isocurve:compute",ee),u.value.on("change:collapsed",g),h.value.on("button:clicked",xe),f.value.on("button:clicked",te)}});const g=ne=>{o.debug(ne),ne.target.collapsed&&u.value.clean()},H=ne=>{o.debug(ne)},Y=ne=>{o.debug(ne)},ee=ne=>{o.debug(ne);var et=ne.target,tt=et.getLayer();tt.set("control",et.CLASSNAME.toLowerCase()),tt.set("data",et.getData()),tt.set("geojson",et.getGeoJSON())},te=ne=>{if(o.debug(ne),!i.authenticated){push$1.warning({title:t$1.auth.title,message:t$1.auth.not_authentificated});return}var et=ne.layer.gpResultLayerId.toLowerCase(),tt=et.split(":")[0];if(tt==="layerimport"&&(tt=et.split(":")[1],tt!=="compute")){push$1.error({title:t$1.iso.title,message:t$1.iso.failed_import});return}var it={layer:ne.layer,content:ne.content,name:h.value.inputName.value||ne.name,description:ne.description,format:ne.format.toLowerCase(),compute:"isocurve",target:"internal",type:tt},rt;if(tt!=="bookmark")rt=useCreateDocument(it,e,i);else{push$1.info({title:t$1.iso.title,message:t$1.iso.save_already});return}rt.then(nt=>{var st=i.find(nt.uuid);if(st){var at=toShare(st,{opacity:it.layer.get("opacity"),visible:it.layer.get("visible"),grayscale:it.layer.get("grayscale"),stop:1});if(nt.action==="added")l.addBookmark(at);else throw new Error("Action not yet implemented !")}}).then(()=>{push$1.success({title:t$1.iso.title,message:t$1.iso.save_success})}).catch(nt=>{console.error(nt),push$1.error({title:t$1.iso.title,message:t$1.iso.save_failed})})},xe=ne=>{o.debug(ne),h.value.options.name=h.value.inputName.value||ne.name};return(ne,et)=>null}},_sfc_main$m={__name:"Route",props:{mapId:String,visibility:Boolean,analytic:Boolean,routeOptions:Object},setup(s){const e=inject("emitter");var i=inject("services");const n=s,o=distExports$1.useLogger();useDataStore();const l=useMapStore(),c=inject(n.mapId),u=ref$1(new Route(n.routeOptions)),h=ref$1(new ButtonExport({title:"Exporter",kind:"secondary",download:!0,name:"Mon itineraire",description:"",control:u.value,menu:!0,menuOptions:{outside:!0,above:!0,selectFormat:!1,labelDesc:!1},direction:"column",format:"geojson",icons:{menu:"",button:"export"}})),f=ref$1(new ButtonExport({title:"Enregistrer",kind:"primary",download:!1,name:"Mon itineraire",control:u.value,format:"geojson",menu:!1,direction:"column",icons:{menu:"",button:"save"}}));e.addEventListener("compute-route:edit:clicked",ne=>{o.debug(ne),h.value.inputName.value=ne.options.title||"",useActionEdit(u.value,ne.layer)}),onMounted(()=>{if(n.visibility&&(c.addControl(u.value),c.addControl(h.value),window.__ENV__.IAM_DISABLE==="1"&&(f.value.getContainer().style.display="none"),c.addControl(f.value),u.value.on("route:drawstart",H),u.value.on("route:drawend",Y),u.value.on("route:compute",ee),u.value.on("change:collapsed",g),h.value.on("button:clicked",xe),f.value.on("button:clicked",te),n.analytic)){var ne=u.value.element.querySelector("button[id^=GPshowRoutePicto-]");useActionButtonEulerian(ne)}}),onBeforeUpdate(()=>{n.visibility||(c.removeControl(u.value),c.removeControl(f.value),c.removeControl(h.value))}),onUpdated(()=>{if(n.visibility){if(c.addControl(u.value),c.addControl(h.value),window.__ENV__.IAM_DISABLE==="1"&&(f.value.getContainer().style.display="none"),c.addControl(f.value),n.analytic){var ne=u.value.element.querySelector("button[id^=GPshowRoutePicto-]");useActionButtonEulerian(ne)}u.value.on("route:drawstart",H),u.value.on("route:drawend",Y),u.value.on("route:compute",ee),u.value.on("change:collapsed",g),h.value.on("button:clicked",xe),f.value.on("button:clicked",te)}});const g=ne=>{o.debug(ne),ne.target.collapsed&&u.value.clean()},H=ne=>{o.debug(ne)},Y=ne=>{o.debug(ne)},ee=ne=>{o.debug(ne);var et=ne.target,tt=et.getLayer();tt.set("control",et.CLASSNAME.toLowerCase()),tt.set("data",et.getData()),tt.set("geojson",et.getGeoJSON())},te=ne=>{if(o.debug(ne),!i.authenticated){push$1.warning({title:t$1.auth.title,message:t$1.auth.not_authentificated});return}var et=ne.layer.gpResultLayerId.toLowerCase(),tt=et.split(":")[0];if(tt==="layerimport"&&(tt=et.split(":")[1],tt!=="compute")){push$1.error({title:t$1.route.title,message:t$1.route.failed_import});return}var it={layer:ne.layer,content:ne.content,name:h.value.inputName.value||ne.name,description:ne.description,format:ne.format.toLowerCase(),compute:"route",target:"internal",type:tt},rt;if(tt!=="bookmark")rt=useCreateDocument(it,e,i);else{push$1.info({title:t$1.route.title,message:t$1.route.save_already});return}rt.then(nt=>{var st=i.find(nt.uuid);if(st){var at=toShare(st,{opacity:it.layer.get("opacity"),visible:it.layer.get("visible"),grayscale:it.layer.get("grayscale"),stop:1});if(nt.action==="added")l.addBookmark(at);else throw new Error("Action not yet implemented !")}}).then(()=>{push$1.success({title:t$1.route.title,message:t$1.route.save_success})}).catch(nt=>{console.error(nt),push$1.error({title:t$1.route.title,message:t$1.route.save_failed})})},xe=ne=>{o.debug(ne),h.value.options.name=h.value.inputName.value||ne.name};return(ne,et)=>null}},_sfc_main$l={__name:"MeasureLength",props:{mapId:String,visibility:Boolean,analytic:Boolean,measureLengthOptions:Object},setup(s){const e=s,i=inject(e.mapId),n=ref$1(new MeasureLength(e.measureLengthOptions));return onMounted(()=>{if(e.visibility&&(i.addControl(n.value),e.analytic)){var o=n.value.element.querySelector("button[id^=GPshowMeasureLengthPicto-]");useActionButtonEulerian(o)}}),onBeforeUpdate(()=>{if(e.visibility){if(i.addControl(n.value),e.analytic){var o=n.value.element.querySelector("button[id^=GPshowMeasureLengthPicto-]");useActionButtonEulerian(o)}}else i.removeControl(n.value)}),(o,l)=>null}},_sfc_main$k={__name:"MeasureArea",props:{mapId:String,visibility:Boolean,analytic:Boolean,measureAreaOptions:Object},setup(s){const e=s,i=inject(e.mapId),n=ref$1(new MeasureArea(e.measureAreaOptions));return onMounted(()=>{if(e.visibility&&(i.addControl(n.value),e.analytic)){var o=n.value.element.querySelector("button[id^=GPshowMeasureAreaPicto-]");useActionButtonEulerian(o)}}),onBeforeUpdate(()=>{if(e.visibility){if(i.addControl(n.value),e.analytic){var o=n.value.element.querySelector("button[id^=GPshowMeasureAreaPicto-]");useActionButtonEulerian(o)}}else i.removeControl(n.value)}),(o,l)=>null}},_sfc_main$j={__name:"MeasureAzimuth",props:{mapId:String,visibility:Boolean,analytic:Boolean,measureAzimuthOptions:Object},setup(s){const e=s,i=inject(e.mapId),n=ref$1(new MeasureAzimuth(e.measureAzimuthOptions));return onMounted(()=>{if(e.visibility&&(i.addControl(n.value),e.analytic)){var o=n.value.element.querySelector("button[id^=GPshowMeasureAzimuthPicto-]");useActionButtonEulerian(o)}}),onBeforeUpdate(()=>{if(e.visibility){if(i.addControl(n.value),e.analytic){var o=n.value.element.querySelector("button[id^=GPshowMeasureAzimuthPicto-]");useActionButtonEulerian(o)}}else i.removeControl(n.value)}),(o,l)=>null}},_sfc_main$i={__name:"MousePosition",props:{mapId:String,visibility:Boolean,analytic:Boolean,mousePositionOptions:Object},setup(s){const e=s;distExports$1.useLogger();const i=inject(e.mapId),n=ref$1(new MousePosition(e.mousePositionOptions));return onMounted(()=>{if(e.visibility&&(i.addControl(n.value),e.analytic)){var o=n.value.element.querySelector("button[id^=GPshowMousePositionPicto-]");useActionButtonEulerian(o)}}),onBeforeUpdate(()=>{e.visibility||i.removeControl(n.value)}),onUpdated(()=>{if(e.visibility&&(i.addControl(n.value),e.analytic)){var o=n.value.element.querySelector("button[id^=GPshowMousePositionPicto-]");useActionButtonEulerian(o)}}),(o,l)=>null}},_sfc_main$h={__name:"ElevationPath",props:{mapId:String,visibility:Boolean,analytic:Boolean,elevationPathOptions:Object},setup(s){const e=inject("emitter");var i=inject("services");const n=s,o=distExports$1.useLogger();useDataStore();const l=useMapStore(),c=inject(n.mapId),u=ref$1(new ElevationPath(n.elevationPathOptions)),h=ref$1(new ButtonExport({title:"Exporter",kind:"secondary",download:!0,name:"Mon profil",description:"",control:u.value,menu:!0,menuOptions:{outside:!0,above:!0,selectFormat:!1,labelDesc:!1},direction:"column",format:"geojson",icons:{menu:"",button:"export"}})),f=ref$1(new ButtonExport({title:"Enregistrer",kind:"primary",name:"Mon profil",download:!1,control:u.value,format:"geojson",menu:!1,icons:{menu:"",button:"save"}}));e.addEventListener("compute-profil:edit:clicked",ne=>{o.debug(ne),h.value.inputName.value=ne.options.title||"",useActionEdit(u.value,ne.layer)}),onMounted(()=>{if(n.visibility){c.addControl(u.value),window.__ENV__.IAM_DISABLE==="1"&&(f.value.getContainer().style.display="none"),c.addControl(h.value),c.addControl(f.value),u.value.on("elevationpath:drawstart",H),u.value.on("elevationpath:drawend",Y),u.value.on("elevationpath:compute",ee),u.value.on("change:collapsed",g),h.value.on("button:clicked",xe),f.value.on("button:clicked",te);var ne=u.value.element.querySelector("button[id^=GPshowElevationPathPicto-]");n.analytic&&useActionButtonEulerian(ne),ne.dataset.removeMeasure="false",ne.dataset.removeLayer="false"}}),onBeforeUpdate(()=>{n.visibility||(c.removeControl(u.value),c.removeControl(f.value),c.removeControl(h.value))}),onUpdated(()=>{if(n.visibility){c.addControl(u.value),c.addControl(h.value),window.__ENV__.IAM_DISABLE==="1"&&(f.value.getContainer().style.display="none"),c.addControl(f.value);var ne=u.value.element.querySelector("button[id^=GPshowElevationPathPicto-]");n.analytic&&useActionButtonEulerian(ne),ne.dataset.removeMeasure="false",ne.dataset.removeLayer="false",u.value.on("elevationpath:drawstart",H),u.value.on("elevationpath:drawend",Y),u.value.on("elevationpath:compute",ee),u.value.on("change:collapsed",g),h.value.on("button:clicked",xe),f.value.on("button:clicked",te)}});const g=ne=>{o.debug(ne),ne.target.collapsed&&u.value.clean(!1)},H=ne=>{o.debug(ne)},Y=ne=>{o.debug(ne)},ee=ne=>{o.debug(ne);var et=ne.target,tt=et.getLayer();tt.set("control",et.CLASSNAME.toLowerCase()),tt.set("data",et.getData())},te=ne=>{if(o.debug(ne),!i.authenticated){push$1.warning({title:t$1.auth.title,message:t$1.auth.not_authentificated});return}var et=ne.layer.gpResultLayerId.toLowerCase(),tt=et.split(":")[0];if(tt==="measure"&&(tt=et.split(":")[1],tt!=="profil")){push$1.error({title:t$1.profil.title,message:t$1.profil.failed_import});return}var it={layer:ne.layer,content:ne.content,name:h.value.inputName.value||ne.name,description:ne.description,format:ne.format.toLowerCase(),compute:"profil",target:"internal",type:"compute"},rt;if(tt!=="bookmark")rt=useCreateDocument(it,e,i);else{push$1.info({title:t$1.iso.title,message:t$1.iso.save_already});return}rt.then(nt=>{var st=i.find(nt.uuid);if(st){var at=toShare(st,{opacity:it.layer.get("opacity"),visible:it.layer.get("visible"),grayscale:it.layer.get("grayscale"),stop:1});if(nt.action==="added")l.addBookmark(at);else throw new Error("Action not yet implemented !")}}).then(()=>{push$1.success({title:t$1.profil.title,message:t$1.profil.save_success})}).catch(nt=>{console.error(nt),push$1.error({title:t$1.profil.title,message:t$1.profil.save_failed})})},xe=ne=>{o.debug(ne),h.value.options.name=h.value.inputName.value||ne.name};return(ne,et)=>null}},_sfc_main$g={__name:"Territories",props:{mapId:String,visibility:Boolean,analytic:Boolean,territoriesOptions:Object},setup(s){const e=s,i=distExports$1.useLogger(),n=useDataStore(),o=inject(e.mapId),l=ref$1(new Territories(e.territoriesOptions));function c(){var h=n.getTerritories();for(let f=0;f<h.length;f++){const g=h[f];l.value.setTerritory(g)}}onMounted(()=>{if(e.visibility){if(c(),o.addControl(l.value),e.analytic){var h=l.value.element.querySelector("button[id^=GPshowTerritoriesPicto-]");useActionButtonEulerian(h)}l.value.on("territories:change",u)}}),onBeforeUpdate(()=>{e.visibility||o.removeControl(l.value)}),onUpdated(()=>{if(e.visibility){if(c(),o.addControl(l.value),e.analytic){var h=l.value.element.querySelector("button[id^=GPshowTerritoriesPicto-]");useActionButtonEulerian(h)}l.value.on("territories:change",u)}});const u=h=>{i.debug(h)};return(h,f)=>null}},_sfc_main$f={__name:"GetFeatureInfo",props:{mapId:String,visibility:Boolean,analytic:Boolean,getFeatureInfoOptions:Object},setup(s){const e=s,i=distExports$1.useLogger(),n=inject(e.mapId),o=ref$1(new GetFeatureInfo(e.getFeatureInfoOptions)),l=useMatchMedia("SM");watch(l,()=>{if(e.visibility&&!l.value){if(n.addControl(o.value),e.analytic){var u=o.value.element.querySelector("button[id^=GPgetFeatureInfoPicto-]");useActionButtonEulerian(u)}}else n.removeControl(o.value)}),onMounted(()=>{if(e.visibility&&!l.value&&(n.addControl(o.value),o.value.on("GetFeatureInfo:toggle",c),e.analytic)){var u=o.value.element.querySelector("button[id^=GPgetFeatureInfoPicto-]");useActionButtonEulerian(u)}}),onBeforeUpdate(()=>{if(e.visibility&&!l.value){if(n.addControl(o.value),e.analytic){var u=o.value.element.querySelector("button[id^=GPgetFeatureInfoPicto-]");useActionButtonEulerian(u)}}else n.removeControl(o.value)});function c(u){i.debug(u)}return(u,h)=>null}},__default__$4={name:"LayerImport"},_sfc_main$e=Object.assign(__default__$4,{props:{mapId:String,visibility:Boolean,analytic:Boolean,layerImportOptions:Object},setup(s){const e=inject("emitter"),i=inject("services"),n=inject("refModalLogin"),o=inject("refModalSave"),l=s,c=useMapStore(),u=distExports$1.useLogger(),h=inject(l.mapId),f=ref$1(new LayerImport(l.layerImportOptions));e.addEventListener("layerimport:open:clicked",rt=>{f.value&&f.value.setCollapsed(!rt.open)}),onMounted(()=>{if(l.visibility){if(h.addControl(f.value),l.analytic){var rt=f.value.element.querySelector("button[id^=GPshowImportPicto-]");useActionButtonEulerian(rt)}f.value.on("layerimport:vector:added",ee),f.value.on("layerimport:service:added",te),f.value.on("layerimport:mapbox:added",xe),f.value.on("layerimport:compute:added",ne)}}),onBeforeUpdate(()=>{l.visibility||h.removeControl(f.value)}),onUpdated(()=>{if(l.visibility){if(h.addControl(f.value),l.analytic){var rt=f.value.element.querySelector("button[id^=GPshowImportPicto-]");useActionButtonEulerian(rt)}f.value.on("layerimport:vector:added",ee),f.value.on("layerimport:service:added",te),f.value.on("layerimport:mapbox:added",xe),f.value.on("layerimport:compute:added",ne)}});const g=rt=>{u.debug(rt),n&&n.value.openModalLogin(!0)},H=()=>{o&&o.value.openModalSave()},Y=rt=>{console.log("saveImportVector",rt);var nt={layer:rt.layer,content:rt.data,name:rt.name,description:"",format:rt.format.toLowerCase(),target:"internal",type:"import"},st=useCreateDocument(nt,e,i);st.then(at=>{var ot=i.find(at.uuid);if(ot){var ct=toShare(ot,{opacity:nt.layer.get("opacity"),visible:nt.layer.get("visible"),grayscale:nt.layer.get("grayscale"),stop:1});if(at.action==="added")c.addBookmark(ct);else throw new Error("Action not yet implemented !")}}).then(()=>{f.value.setCollapsed(!0)}).then(()=>{push$1.success({title:t$1.layerimport.title,message:t$1.layerimport.save_success})}).catch(at=>{console.error(at),push$1.error({title:t$1.layerimport.title,message:t$1.layerimport.save_failed})})},ee=rt=>{u.debug(rt),i.authenticated?(o.value.onDelegateCbk(()=>{Y(rt)}),i.authenticated&&H()):c.noLoginInformation||g(rt)},te=rt=>{if(u.debug(rt),!!i.authenticated){var nt={};if(rt.format.toLowerCase()==="wmts"&&(nt=tt(rt.data)),rt.format.toLowerCase()==="wms"&&(nt=et(rt.data)),rt.format.toLowerCase()==="wfs"){console.error("WFS not implemented !");return}if(!nt.url){push$1.error({title:t$1.layerimport.title,message:t$1.layerimport.add_failed_service(rt.format.toUpperCase())});return}var st={content:JSON.stringify(nt),name:nt.title||rt.name,description:nt.description,format:"json",type:"service",kind:nt.format.toLowerCase(),target:"external",layer:rt.layer};it(st).then(at=>{var ot=i.find(at.uuid);if(ot){var ct=toShare(ot,{opacity:1,visible:!0,grayscale:!1,stop:1});c.addBookmark(ct)}}).then(()=>{push$1.success({title:t$1.layerimport.title,message:t$1.layerimport.add_success_service(rt.format.toUpperCase())})}).catch(at=>{console.error(at),push$1.warning({title:t$1.layerimport.title,message:t$1.layerimport.add_failed_service(rt.format.toUpperCase())})})}},xe=rt=>{if(u.debug(rt),!!i.authenticated){var nt={content:rt.data,name:rt.name,description:"Import Mapbox",format:"json",type:"service",kind:"mapbox",target:"internal",layer:rt.layer};it(nt).then(st=>{var at=i.find(st.uuid);if(at){var ot=toShare(at,{opacity:1,visible:!0,grayscale:!1,stop:1});c.addBookmark(ot)}}).then(()=>{push$1.success({title:t$1.layerimport.title,message:t$1.layerimport.add_success_mapbox})}).catch(st=>{console.error(st),push$1.warning({title:t$1.layerimport.title,message:t$1.layerimport.add_failed_mapbox})})}},ne=rt=>{u.debug(rt)},et=rt=>({url:rt.Url,format:"WMS",title:rt.Title,description:rt.Abstract,layers:[rt.Name],version:rt.Version,stylesName:rt.Style.map(nt=>nt.Name),queryable:rt.queryable,gfiFormat:"text/html",projection:rt.Projection}),tt=rt=>({url:rt.Url,format:"WMTS",version:rt.Version,layer:rt.Identifier,outputFormat:rt.Format[0],styleName:rt.Style[0].Identifier,tileMatrixSet:rt.TileMatrixSetLink[0].TileMatrixSet,topLeftCorner:{x:rt.Origin[0],y:rt.Origin[1]},resolutions:rt.Resolutions,matrixIds:rt.MatrixIds,title:rt.Title,description:rt.Abstract}),it=async rt=>{try{const at=await i.setDocument(rt);var nt=at.uuid,st=at.action;const ot=await i.sharingDocument({uuid:nt,type:rt.type});return console.debug(ot),rt.layer.gpResultLayerId&&(rt.layer.gpResultLayerId=`bookmark:${rt.kind}:${nt}`),e.dispatchEvent("document:saved",{uuid:nt,action:st}),at}catch(at){throw console.error(at),at}};return(rt,nt)=>null}}),selectedControls=computed(()=>useMapStore().getControls()),_sfc_main$d={__name:"ControlList",props:{mapId:String,visibility:Boolean,analytic:Boolean,controlListOptions:Object},setup(s){const e=s;distExports$1.useLogger();const i=inject(e.mapId),n=ref$1(new ControlList(e.controlListOptions));return watch(selectedControls,()=>{setTimeout(()=>{if(i.removeControl(n.value),e.visibility&&(i.addControl(n.value),e.analytic)){var o=n.value.element.querySelector("button[id^=GPshowControlListPicto-]");useActionButtonEulerian(o)}},10)}),onMounted(()=>{if(e.visibility&&(i.addControl(n.value),e.analytic)){var o=n.value.element.querySelector("button[id^=GPshowControlListPicto-]");useActionButtonEulerian(o)}}),onBeforeUpdate(()=>{e.visibility||i.removeControl(n.value)}),onUpdated(()=>{if(e.visibility&&(i.addControl(n.value),e.analytic)){var o=n.value.element.querySelector("button[id^=GPshowControlListPicto-]");useActionButtonEulerian(o)}}),(o,l)=>null}},_sfc_main$c={__name:"ContextMenu",props:{mapId:String,visibility:Boolean,analytic:Boolean,contextMenuOptions:Object},setup(s){const e=useMatchMedia("SM"),i=s,n=inject(i.mapId),o=ref$1(new ContextMenu(i.contextMenuOptions));return onMounted(()=>{i.visibility&&!e.value&&n.addControl(o.value)}),onBeforeUpdate(()=>{i.visibility&&!e.value?n.addControl(o.value):n.removeControl(o.value)}),(l,c)=>null}},_sfc_main$b={__name:"FullScreen",props:{mapId:String,visibility:Boolean,analytic:Boolean,fullscreenOptions:Object},setup(s){const e=s,i=inject(e.mapId),n=ref$1(new GeoportalFullScreen(e.fullscreenOptions));return onMounted(()=>{e.visibility&&i.addControl(n.value)}),onBeforeUpdate(()=>{e.visibility?i.addControl(n.value):i.removeControl(n.value)}),(o,l)=>null}},_sfc_main$a={__name:"ReverseGeocode",props:{mapId:String,visibility:Boolean,analytic:Boolean,reverseGeocodeOptions:Object},setup(s){const e=s,i=distExports$1.useLogger();useDataStore();const n=inject(e.mapId),o=ref$1(new ReverseGeocode(e.reverseGeocodeOptions));onMounted(()=>{if(e.visibility&&(n.addControl(o.value),o.value.on("reverseGeocode:onclickresult",l),o.value.on("reverseGeocode:compute",c),e.analytic)){var u=o.value.element.querySelector("button[id^=GPshowReverseGeocodingPicto-]");useActionButtonEulerian(u)}}),onBeforeUpdate(()=>{e.visibility||n.removeControl(o.value)}),onUpdated(()=>{if(e.visibility&&(n.addControl(o.value),e.analytic)){var u=o.value.element.querySelector("button[id^=GPshowReverseGeocodingPicto-]");useActionButtonEulerian(u)}});const l=u=>{i.debug(u)},c=u=>{i.debug(u)};return(u,h)=>null}},__default__$3={name:"ModalReportingSuccessSent"},_sfc_main$9=Object.assign(__default__$3,{setup(s,{expose:e}){const i=inject("emitter"),n=useEulerian();useRouter();const o="Merci de contribuer  amliorer cartes.gouv.fr !",l="fr-icon-feedback-line",c=[{label:"Retour  la carte",onClick(){u.value=!1,i.dispatchEvent("reporting:open:clicked",{open:!1,componentName:"Reporting"})}},{label:"Autre contribution",tertiary:!0,onClick(){u.value=!1}}],u=ref$1(!1),h=ref$1({display:"none"});u.value&&n.pause();const f=H=>{h.value=H?{display:"block"}:{display:"none"},u.value=!0,n.pause()},g=()=>{u.value=!1,n.resume()};return e({openModalReportingSent:f,onModalReportingSentClose:g}),(H,Y)=>{const ee=DsfrModal_default;return openBlock(),createBlock(ee,{opened:unref(u),title:o,size:"md",icon:l,"is-alert":!0,actions:c,onClose:g},{default:withCtx(()=>[...Y[0]||(Y[0]=[createBaseVNode("p",null," Nous vous tiendrons inform par courriel de la prise en compte de votre signalement par nos quipes. ",-1)])]),_:1},8,["opened"])}}}),__default__$2={name:"ModalReportingStart"},_sfc_main$8=Object.assign(__default__$2,{setup(s,{expose:e}){const i=useEulerian();useRouter();const n=useMapStore(),o=useDataStore(),l=`${useBaseUrl()}/faq`,c="Avant d'effectuer un signalement",u="fr-icon-feedback-line",h=[{label:"J'ai compris",onClick(){f.value=!1}},{label:"Afficher Plan IGN J+1",tertiary:!0,onClick(){f.value=!1;var ee=o.getLayerIdByName("GEOGRAPHICALGRIDSYSTEMS.MAPS.BDUNI.J1","WMTS");n.addLayer(ee)}}],f=ref$1(!1),g=ref$1({display:"none"});f.value&&i.pause();const H=ee=>{g.value=ee?{display:"block"}:{display:"none"},f.value=!0,i.pause()},Y=()=>{f.value=!1,i.resume()};return e({openModalReportingStart:H,onModalReportingStartClose:Y}),(ee,te)=>{const xe=DsfrButtonGroup_default,ne=DsfrModal_default;return openBlock(),createBlock(ne,{opened:unref(f),title:c,size:"md",icon:u,"is-alert":!0,onClose:Y},{default:withCtx(()=>[createBaseVNode("p",null,[te[0]||(te[0]=createTextVNode(" Avant de dbuter, nous vous recommandons de prendre connaissance de notre ",-1)),createBaseVNode("a",{href:l,target:"_blank"},"foire aux questions"),te[1]||(te[1]=createTextVNode(" ddie et d'afficher la carte la plus  jour, afin de vrifier que l'anomalie n'a pas dj t prise en compte. ",-1))])]),footer:withCtx(()=>[createVNode(xe,{align:"center",buttons:h,"inline-layout-when":"large"})]),_:1},8,["opened"])}}});class MyServiceAction{constructor(){console.info("MyServiceAction constructor"),this.url=window.__ENV__.VITE_GPF_SERVICE_ANOMALY||"https://www.geoportail.gouv.fr/wp-json/wp/v2"}active(){console.info("MyServiceAction active")}disable(){console.info("MyServiceAction disable")}send(e){return console.info("MyServiceAction send"),this._send(e)}clear(){console.info("MyServiceAction clear")}async _send(e){console.info("MyServiceAction #send",e);var i=e.location.features[0].geometry.coordinates;e.location.crs.properties.name!=="EPSG::4326"&&(i=transform$1(e.location.features[0].geometry.coordinates,e.location.crs.properties.name,"EPSG:4326"));const n=`https://cartes.gouv.fr/cartes?c=${i[0]},${i[1]}&p=${i[0]},${i[1]}&z=11&l=GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2$GEOPORTAIL:OGC:WMTS(1;1;1;0)&w=OverviewMap,SearchEngine,ScaleLine,LayerSwitcher,GetFeatureInfo,Legends,Zoom,FullScreen,Share,Print,Territories,LayerImport,ControlList,ContextMenu&permalink=yes`,o={name:e.name+" (Anomalie) (cartes.gouv.fr)",description:e.desc,theme:e.theme,permalink:n,id_drawing:"",mail:e.mail};var l=`
        <kml xmlns="http://www.opengis.net/kml/2.2" xmlns:gx="http://www.google.com/kml/ext/2.2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd">
          <ExtendedData>
            <Data name="description">"Signalement (cartes.gouv.fr)"</Data>
          </ExtendedData>
          <Placemark>
            <name>Signalement</name>
            <Style>
              <IconStyle>
                <scale>0.03125</scale>
                <Icon>
                  <href>data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNiYAAAAAkAAxkR2eQAAAAASUVORK5CYII=</href>
                  <gx:w>1</gx:w>
                  <gx:h>1</gx:h>
                </Icon>
                <hotSpot x="0" y="1" xunits="pixels" yunits="pixels"/>
              </IconStyle>
              <LabelStyle>
                <color>ff000000</color>
                <LabelStyleSimpleExtensionGroup fontSize="16px" fontFamily="sans" haloColor="ffffffff" haloRadius="3" haloOpacity="1"/>
              </LabelStyle>
            </Style>
            <Point>
              <coordinates>${i[0]},${i[1]}</coordinates>
            </Point>
          </Placemark>
        </kml>`;const u={drawing:{is_anomaly:1,kml:e.drawing||l,layername:e.name,name:e.name}},f=await(await fetch(this.url+"/drawing",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},mode:"cors",credentials:"same-origin",body:JSON.stringify(u)})).json();o.id_drawing=f.drawing[0].id;const g={anomaly:o};await fetch(this.url+"/anomaly",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},mode:"cors",credentials:"same-origin",body:JSON.stringify(g)})}}typeof window<"u"&&(window.MyServiceAction=MyServiceAction);const _sfc_main$7={__name:"Reporting",props:{mapId:String,visibility:Boolean,analytic:Boolean,reportingOptions:Object},setup(s){const e=inject("emitter"),i=s,n=distExports$1.useLogger(),o=inject(i.mapId),l=ref$1(new Reporting(i.reportingOptions)),c=ref$1({}),u=ref$1({});e.addEventListener("reporting:open:clicked",g=>{l.value&&l.value.setCollapsed(!g.open)}),onMounted(()=>{if(i.visibility){if(l.value.setComponentService(new MyServiceAction),o.addControl(l.value),i.analytic){var g=l.value.element.querySelector("button[id^=GPshowReportingPicto-]");useActionButtonEulerian(g)}l.value.on("reporting:opened",h),l.value.on("reporting:sending",f)}}),onBeforeUpdate(()=>{i.visibility||o.removeControl(l.value)}),onUpdated(()=>{if(i.visibility){if(l.value.setComponentService(new MyServiceAction),o.addControl(l.value),i.analytic){var g=l.value.element.querySelector("button[id^=GPshowReportingPicto-]");useActionButtonEulerian(g)}l.value.on("reporting:opened",h),l.value.on("reporting:sending",f)}});const h=g=>{n.debug(g),u.value.openModalReportingStart(!0)},f=g=>{n.debug(g),c.value.openModalReportingSent()};return(g,H)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(_sfc_main$9,{ref_key:"refModalReportingSent",ref:c},null,512),createVNode(_sfc_main$8,{ref_key:"refModalReportingStart",ref:u},null,512)],64))}},_sfc_main$6={__name:"CatalogManager",props:{mapId:{type:String,default:""},visibility:Boolean,analytic:Boolean,catalogManagerOptions:{type:Object,default:()=>({})}},setup(s){const e=s,i=distExports$1.useLogger(),n=useDataStore(),o=useMapStore(),l=inject("emitter"),c=inject(e.mapId),u=ref$1(new Catalog(e.catalogManagerOptions));l.addEventListener("catalog:open:clicked",()=>{if(u.value){var H=u.value.getCollapsed();u.value.setCollapsed(!H)}}),onMounted(()=>{if(e.visibility){if(c.addControl(u.value),i.info("CatalogManager mounted",u.value),e.analytic){var H=u.value.element.querySelector("button[id^=GPshowCatalogPicto-]");useActionButtonEulerian(H)}u.value.on("catalog:loaded",h),u.value.on("catalog:layer:add",f),u.value.on("catalog:layer:remove",g)}}),onBeforeUpdate(()=>{i.info("CatalogManager updated",u.value),e.visibility||c.removeControl(u.value)}),onUpdated(()=>{if(e.visibility){if(c.addControl(u.value),i.info("CatalogManager updated",u.value),e.analytic){var H=u.value.element.querySelector("button[id^=GPshowCatalogPicto-]");useActionButtonEulerian(H)}u.value.on("catalog:loaded",h),u.value.on("catalog:layer:add",f),u.value.on("catalog:layer:remove",g)}});const h=H=>{i.info("catalog:loaded",H)},f=H=>{i.info("catalog:layer:add",H);var Y=n.getLayerIdByName(H.name,H.service);Y&&o.addLayer(Y)},g=H=>{i.info("catalog:layer:remove",H);var Y=n.getLayerIdByName(H.name,H.service);Y&&o.removeLayer(Y)};return(H,Y)=>(openBlock(),createElementBlock("div"))}},IconGeolocationSVG="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2036'%20width='48'%20height='48'%3e%3cpath%20fill='%23000091'%20d='M18.364%203.636a9%209%200%200%201%200%2012.728L12%2022.728l-6.364-6.364A9%209%200%200%201%2018.364%203.636ZM12%208a2%202%200%201%200%200%204%202%202%200%200%200%200-4Z'/%3e%3c/svg%3e",__default__$1={name:"Controls"},_sfc_main$5=Object.assign(__default__$1,{props:{controlOptions:{type:Array,default:()=>[]},mapId:{type:String,default:""}},setup(s){const e=inject("emitter");LoggerByDefault.enableAll();const i=s,n=useMapStore(),o=useDomStore(),l=useDataStore();distExports$1.useLogger().debug(i.controlOptions);const u={id:"1",collapsed:!1,collapsible:!1,returnTrueGeometry:!0,autocompleteOptions:{serviceOptions:{maximumResponses:10},prettifyResults:!0,maximumEntries:5},markerUrl:IconGeolocationSVG},h={options:{id:"2",position:useControlsExtensionPosition().layerSwitcherOptions,collapsed:!0,panel:!0,counter:!0,allowEdit:!0,allowGrayScale:!0}},f={id:"3",position:useControlsExtensionPosition().legendsOptions,panel:!0,auto:!0,draggable:!1},g={id:"4",units:"metric",bar:!1},H={id:"5",position:useControlsExtensionPosition().territoriesOptions,panel:!0,title:"Slectionner un territoire",auto:!1,thumbnail:!1,reduce:!1,tiles:3},Y={id:"6",position:useControlsExtensionPosition().getFeatureInfoOptions,noDataMessage:"<h6 style='text-align: center;'> Pas d'infos disponibles </h6> <p style='text-align: center;'> Il n'y a pas de donnes interrogeables ici </p>"},ee={id:"7",collapsed:!1,position:useControlsExtensionPosition().overviewMapOptions,layers:[new LayerWMTS({layer:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2",configuration:{...l.getLayerByName("GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2","WMTS"),params:l.getLayerParamsByName("GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2","WMTS")}})]},te={id:"8",position:useControlsExtensionPosition().fullscreenOptions,source:"map-and-tools-container"},xe={position:useControlsExtensionPosition().zoomOptions,id:"9"},ne={position:useControlsExtensionPosition().controlListOptions,id:"10",gutter:!1,controlCatalogElement:document.getElementById("MenuControl")},et={id:"11",position:useControlsExtensionPosition().drawingOptions,gutter:!1,listable:!0,tools:{export:!1}},tt={id:"12",position:useControlsExtensionPosition().reverseGeocodeOptions,gutter:!1,listable:!0},it={position:useControlsExtensionPosition().isocurveOptions,id:"13",gutter:!1,listable:!0},rt={position:useControlsExtensionPosition().routeOptions,id:"14",gutter:!1,listable:!0},nt={id:"15",position:useControlsExtensionPosition().measureLengthOptions,gutter:!1,listable:!0},st={position:useControlsExtensionPosition().measureAreaOptions,id:"16",gutter:!1,listable:!0},at={position:useControlsExtensionPosition().measureAzimuthOptions,gutter:!1,listable:!0,id:"17"},ot={position:useControlsExtensionPosition().mousePositionOptions,id:"18",gutter:!1,listable:!0,editCoordinates:!0,systems:[{label:"Gographique",crs:"EPSG:4326",type:"Geographical"},{label:"Web Mercator",crs:"EPSG:3857",type:"Metric"},{label:"Lambert 93",crs:"EPSG:2154",type:"Metric",geoBBox:{left:-9.86,bottom:41.15,right:10.38,top:51.56}},{label:"Lambert II tendu",crs:"EPSG:27572",type:"Metric",geoBBox:{left:-4.87,bottom:42.33,right:8.23,top:51.14}},{crs:"EPSG:32620",label:"UTM 20N (Guadeloupe, Martinique)",type:"Metric",geoBBox:{left:-66,bottom:0,right:-60,top:84}},{crs:"EPSG:4467",label:"UTM 21N (Saint-Pierre-et-Miquelon)",type:"Metric",geoBBox:{left:-57.1,bottom:43.41,right:-55.9,top:47.37}},{crs:"EPSG:2972",label:"UTM 22N (Guyane)",type:"Metric",geoBBox:{left:-54.6,bottom:2.11,right:-49.46,top:8.88}},{crs:"EPSG:32630",label:"UTM 30N (France mtropolitaine)",type:"Metric",geoBBox:{left:-6,bottom:0,right:0,top:84}},{crs:"EPSG:32631",label:"UTM 31N (France mtropolitaine)",type:"Metric",geoBBox:{left:0,bottom:0,right:6,top:84}},{crs:"EPSG:32632",label:"UTM 32N (France mtropolitaine)",type:"Metric",geoBBox:{left:6,bottom:0,right:12,top:84}},{crs:"EPSG:4471",label:"UTM 38S (Mayotte)",type:"Metric",geoBBox:{left:43.68,bottom:-14.49,right:46.7,top:-11.33}},{crs:"EPSG:2975",label:"UTM 40S (Runion)",type:"Metric",geoBBox:{left:51.83,bottom:-24.72,right:58.24,top:-18.28}},{crs:"EPSG:3296",label:"UTM 5S (Polynsie)",type:"Metric",geoBBox:{left:-158.13,bottom:-26.7,right:-150,top:-12.5}},{crs:"EPSG:3297",label:"UTM 6S (Polynsie)",type:"Metric",geoBBox:{left:-150,bottom:-31.2,right:-144,top:-7.29}},{crs:"EPSG:32707",label:"UTM 7S (Polynsie)",type:"Metric",geoBBox:{left:-144,bottom:-80,right:-138,top:0}},{crs:"EPSG:32708",label:"UTM 8S (Polynsie)",type:"Metric",geoBBox:{left:-138,bottom:-80,right:-132,top:0}},{crs:"EPSG:26912",label:"UTM 12N (le de Clipperton)",type:"Metric",geoBBox:{left:-109.5,bottom:10.17,right:-109,top:10.5}},{crs:"EPSG:32742",label:"UTM 42S (les Kerguelen)",type:"Metric",geoBBox:{left:66,bottom:-80,right:72,top:0}},{crs:"EPSG:32739",label:"UTM 39S (les Crozet)",type:"Metric",geoBBox:{left:48,bottom:-80,right:54,top:0}},{crs:"EPSG:32743",label:"UTM 43S (les St-Paul et Amsterdam)",type:"Metric",geoBBox:{left:72,bottom:-80,right:78,top:0}},{crs:"EPSG:2986",label:"Strographique polaire (Terre Adlie)",type:"Metric",geoBBox:{left:136,bottom:-67.13,right:142,top:-65.61}},{crs:"EPSG:32737",label:"UTM 37S (les du canal de Mozambique)",type:"Metric",geoBBox:{left:36,bottom:-80,right:42,top:0}},{crs:"EPSG:32738",label:"UTM 38S (les du canal de Mozambique)",type:"Metric",geoBBox:{left:42,bottom:-80,right:48,top:0}},{crs:"EPSG:2988",label:"UTM 1S (Wallis-et-Futuna)",type:"Metric",geoBBox:{left:-176.25,bottom:-13.41,right:-176.07,top:-13.16}},{crs:"EPSG:3163",label:"RGNC91-93 (Nouvelle-Caldonie)",type:"Metric",geoBBox:{left:156.25,bottom:-26.45,right:174.28,top:-14.83}}]},ct={id:"19",position:useControlsExtensionPosition().elevationPathOptions,gutter:!1,listable:!0},ht={id:"20",position:useControlsExtensionPosition().layerImportOptions,gutter:!1,listable:!0},ut={id:"21",position:useControlsExtensionPosition().reportingOptions,gutter:!1,listable:!0,format:"kml"},pt={id:"22",position:"top-right",gutter:!1,listable:!0,titlePrimary:"Catalogue de cartes",layerLabel:"title",layerThumbnail:!0,size:"xl",tabHeightAuto:!1,addToMap:!1,optimisation:"on-demand",search:{display:!1,criteria:["name","title","description"]},categories:[{title:"Cartes de rfrence",id:"base",filter:{field:"base",value:"true"}},{title:"Toutes les cartes",id:"data",search:!0,items:[{title:"Thme",default:!0,section:!0,icon:!0,filter:{field:"thematic",value:"*"}},{title:"Producteur",section:!0,icon:!1,filter:{field:"producer",value:"*"}}]}],configuration:{type:"json",data:{layers:l.getLayers(),topics:l.getTopics()}}};inject("refModalPrint"),inject("refModalShare");const yt=computed(()=>({contextMenuItemsOptions:[{text:"Signaler une anomalie",callback:()=>{n.addControl("Reporting"),setTimeout(()=>{e.dispatchEvent("reporting:open:clicked",{open:!0,componentName:"Reporting"}),e.dispatchEvent("leftmenu:close",{open:!1,componentName:"ContextMenu"})},0)}}]}));return onMounted(()=>{o.setleftControlMenu(document.getElementById("position-container-bottom-left"))}),(mt,St)=>(openBlock(),createElementBlock(Fragment,null,[s.controlOptions?(openBlock(),createBlock(_sfc_main$q,{key:0,visibility:i.controlOptions.includes(unref(useControls).LayerSwitcher.id),analytic:unref(useControls).LayerSwitcher.analytic,"layer-switcher-options":h,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$p,{key:1,visibility:i.controlOptions.includes(unref(useControls).Legends.id),analytic:unref(useControls).Legends.analytic,"legends-options":f,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$m,{key:2,visibility:i.controlOptions.includes(unref(useControls).Route.id),analytic:unref(useControls).Route.analytic,"route-options":rt,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$n,{key:3,visibility:i.controlOptions.includes(unref(useControls).Isocurve.id),analytic:unref(useControls).Isocurve.analytic,"isocurve-options":it,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$a,{key:4,visibility:i.controlOptions.includes(unref(useControls).ReverseGeocode.id),analytic:unref(useControls).ReverseGeocode.analytic,"reverse-geocode-options":tt,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$b,{key:5,visibility:i.controlOptions.includes(unref(useControls).FullScreen.id),analytic:unref(useControls).FullScreen.analytic,"fullscreen-options":te,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$r,{key:6,visibility:i.controlOptions.includes(unref(useControls).Zoom.id),analytic:unref(useControls).Zoom.analytic,"zoom-options":xe,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$u,{key:7,visibility:i.controlOptions.includes(unref(useControls).SearchEngine.id),analytic:unref(useControls).SearchEngine.analytic,"search-engine-options":u,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$f,{key:8,visibility:i.controlOptions.includes(unref(useControls).GetFeatureInfo.id),analytic:unref(useControls).GetFeatureInfo.analytic,"get-feature-info-options":Y,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$t,{key:9,visibility:i.controlOptions.includes(unref(useControls).ScaleLine.id),analytic:unref(useControls).ScaleLine.analytic,"scale-line-options":g,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$s,{key:10,visibility:i.controlOptions.includes(unref(useControls).OverviewMap.id),analytic:unref(useControls).OverviewMap.analytic,"overview-map-options":ee,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$g,{key:11,visibility:i.controlOptions.includes(unref(useControls).Territories.id),analytic:unref(useControls).Territories.analytic,"territories-options":H,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$l,{key:12,visibility:i.controlOptions.includes(unref(useControls).MeasureLength.id),analytic:unref(useControls).MeasureLength.analytic,"measure-length-options":nt,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$k,{key:13,visibility:i.controlOptions.includes(unref(useControls).MeasureArea.id),analytic:unref(useControls).MeasureArea.analytic,"measure-area-options":st,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$j,{key:14,visibility:i.controlOptions.includes(unref(useControls).MeasureAzimuth.id),analytic:unref(useControls).MeasureAzimuth.analytic,"measure-azimuth-options":at,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$i,{key:15,visibility:i.controlOptions.includes(unref(useControls).MousePosition.id),analytic:unref(useControls).MousePosition.analytic,"mouse-position-options":ot,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$o,{key:16,visibility:i.controlOptions.includes(unref(useControls).Drawing.id),analytic:unref(useControls).Drawing.analytic,"drawing-options":et,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$h,{key:17,visibility:i.controlOptions.includes(unref(useControls).ElevationPath.id),analytic:unref(useControls).ElevationPath.analytic,"elevation-path-options":ct,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$e,{key:18,visibility:i.controlOptions.includes(unref(useControls).LayerImport.id),analytic:unref(useControls).LayerImport.analytic,"layer-import-options":ht,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$d,{key:19,visibility:i.controlOptions.includes(unref(useControls).ControlList.id),analytic:unref(useControls).ControlList.analytic,"control-list-options":ne,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$c,{key:20,visibility:i.controlOptions.includes(unref(useControls).ContextMenu.id),analytic:unref(useControls).ContextMenu.analytic,"context-menu-options":unref(yt),"map-id":s.mapId},null,8,["visibility","analytic","context-menu-options","map-id"])):createCommentVNode("",!0),s.controlOptions?(openBlock(),createBlock(_sfc_main$7,{key:21,visibility:i.controlOptions.includes(unref(useControls).Reporting.id),analytic:unref(useControls).Reporting.analytic,"reporting-options":ut,"map-id":s.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),createVNode(_sfc_main$6,{visibility:!0,analytic:!1,"catalog-manager-options":pt,"map-id":s.mapId},null,8,["map-id"])],64))}}),DEFAULT_STYLE=new Style$1({image:new Icon({src:Marker.lightOrange,anchor:[25.5,38],anchorOrigin:"top-left",anchorXUnits:"pixels",anchorYUnits:"pixels"}),stroke:new Stroke({color:"rgba(0,42,80,0.8)",width:4}),fill:new Fill({color:"rgba(0, 183, 152, 0.5)"}),text:new Text({font:"16px Sans",textAlign:"left",fill:new Fill({color:"rgba(255, 255, 255, 1)"}),stroke:new Stroke({color:"rgba(0, 0, 0, 1)",width:2})})}),createVectorLayer=s=>{try{var e=null,i=null,n=null,o=s.extended===void 0?!0:s.extended;switch(s.format.toLowerCase()){case"geojson":e=new GeoJSON$1,o&&(e=new GeoJSON({defaultStyle:DEFAULT_STYLE}));break;case"kml":e=new KML$1,o&&(e=new KML({defaultStyle:DEFAULT_STYLE}));break;case"gpx":e=new GPX$1,o&&(e=new GPX({defaultStyle:DEFAULT_STYLE,readExtensions:function(l,c){this.readExtensions(l,c)}}));break;default:break}if(!e)throw new Error(t.ol.failed_format(s.format));if(s.data){const l=e.readProjection(s.data);i=new VectorSource({features:e.readFeatures(s.data,{dataProjection:l,featureProjection:"EPSG:3857"})})}if(s.url&&(i=new VectorSource({format:e,url:s.url})),!i)throw new Error(t.ol.failed_source("vecteur"));if(i._title=s.name,i._description=s.description,n=new VectorLayer({source:i,visible:getVisible(s.visible),opacity:getOpacity(s.opacity)}),!n)throw new Error(t.ol.failed_layer("vecteur"));return n.gpResultLayerId="bookmark:"+s.type+"-"+s.format.toLowerCase()+":"+s.id,Promise.resolve(n)}catch(l){return Promise.reject(l)}},createComputeLayer=s=>{try{var e=null,i=null,n=null;e=new GeoJSON$1;var o=s.extended===void 0?!0:s.extended;if(o&&(e=new GeoJSON({defaultStyle:DEFAULT_STYLE})),!e)throw new Error(t.ol.failed_format(s.format));if(s.data){const u=e.readProjection(s.data);i=new VectorSource({features:e.readFeatures(s.data,{dataProjection:u,featureProjection:"EPSG:3857"})})}if(s.url&&(i=new VectorSource({format:e,loader:function(u,h,f,g,H){const Y=f.getCode(),ee=new XMLHttpRequest;ee.open("GET",s.url);const te=function(){i.removeLoadedExtent(u),H()};ee.onerror=te,ee.onload=function(){if(ee.status===200){var xe=e.readProjection(ee.responseText);const ne=e.readFeatures(ee.responseText,{dataProjection:xe,featureProjection:Y});i.addFeatures(ne),g(ne)}else te()},ee.send()}})),!i)throw new Error(t.ol.failed_source("compute"));if(i._title=s.name,i._description=s.description,n=new VectorLayer({source:i,visible:getVisible(s.visible),opacity:getOpacity(s.opacity)}),!n)throw new Error(t.ol.failed_layer("compute"));n.gpResultLayerId="bookmark:"+s.type+"-"+s.compute.toLowerCase()+":"+s.id;const l=()=>{throw new Error(t.ol.failed_layer("compute"))},c=u=>{var h=e.readRootExtensions("geoportail:compute");if(!h||Object.keys(h).length===0)throw new Error(t.ol.failed_layer("compute"));n.set("control",s.compute),n.set("data",h);var f=new GeoJSON({defaultStyle:DEFAULT_STYLE}),g=f.writeFeatures(u.features,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});n.set("geojson",g)};return n.getSource().once("featuresloadend",c),n.getSource().once("featuresloaderror",l),Promise.resolve(n)}catch(l){return Promise.reject(l)}},createServiceLayer=s=>{var e=n=>{var o=null;if(typeof n.data=="string"&&(n.data=JSON.parse(n.data)),n.kind==="wmts"){const u=new WMTSTileGrid({origin:[n.data.topLeftCorner.x,n.data.topLeftCorner.y],resolutions:n.data.resolutions,matrixIds:n.data.matrixIds});var l=new WMTS$1({url:n.data.url,version:n.data.version,layer:n.data.layer,matrixSet:n.data.tileMatrixSet,format:n.data.outputFormat,projection:"EPSG:3857",tileGrid:u,style:n.data.styleName,attributions:""}),o=null;if(typeof n.data=="string"&&(n.data=JSON.parse(n.data)),n.kind==="wmts"){const f=new WMTSTileGrid({origin:[n.data.topLeftCorner.x,n.data.topLeftCorner.y],resolutions:n.data.resolutions,matrixIds:n.data.matrixIds});var l=new WMTS$1({url:n.data.url,version:n.data.version,layer:n.data.layer,matrixSet:n.data.tileMatrixSet,format:n.data.outputFormat,projection:"EPSG:3857",tileGrid:f,style:n.data.styleName,attributions:""});if(!l)throw new Error(t.ol.failed_source("service wmts"));if(l._title=n.data.name||n.name,l._description=n.data.description||n.description,o=new TileLayer({source:l}),!o)throw new Error(t.ol.failed_layer("service wmts"))}else if(n.kind==="wms"){var c=new TileWMS({url:n.data.url,params:{LAYERS:n.data.layers,SERVICE:n.data.format,VERSION:n.data.version,STYLES:n.data.stylesName},projection:n.data.projection||"EPSG:3857",attributions:""});if(!c)throw new Error(t.ol.failed_source("service wms"));if(c._title=n.data.name||n.name,c._description=n.data.description||n.description,o=new TileLayer({source:c}),!o)throw new Error(t.ol.failed_layer("service wms"));o.gpGFIparams={queryable:n.data.queryable,formats:n.data.gfiFormat}}else throw new Error(t.ol.failed_source("service non reconnu"));if(o&&!o.getExtent()){const f=get$3("EPSG:3857");o.setExtent(f.getExtent())}return o&&(o.gpResultLayerId="bookmark:"+n.kind.toLowerCase()+":"+n.id),o.setVisible(getVisible(n.visible)),o.setOpacity(getOpacity(n.opacity)),o}else if(n.kind==="wms"){var c=new TileWMS({url:n.data.url,params:{LAYERS:n.data.layers,SERVICE:n.data.format,VERSION:n.data.version,STYLES:n.data.stylesName},projection:n.data.projection||"EPSG:3857",attributions:""});if(!c)throw new Error(t.ol.failed_source("service wms"));if(c._title=n.data.name||n.name,c._description=n.data.description||n.description,o=new TileLayer({source:c}),!o)throw new Error(t.ol.failed_layer("service wms"));o.gpGFIparams={queryable:n.data.queryable,formats:n.data.gfiFormat}}else throw new Error(t.ol.failed_source("service non reconnu"));if(o&&!o.getExtent()){const u=get$3("EPSG:3857");o.setExtent(u.getExtent())}return o&&(o.gpResultLayerId="bookmark:"+n.kind.toLowerCase()+":"+n.id),o};if(s.url)return fetch(s.url).then(n=>{if(n.ok)return n.json().then(o=>e({...s,data:o})).catch(o=>{throw o})}).catch(n=>{throw n});if(s.data)try{var i=e(s);return Promise.resolve(i)}catch(n){return Promise.reject(n)}},createMapBoxLayer=s=>{const e=n=>{var o=null,l=n.data,c=l.sources,u=Object.keys(c)[0],h=c[u],f=h.type;if(f==="vector"){var g=h.tiles;if(!g)throw new Error("Source 'tiles' uniquement !");var H=new MVT({featureClass:Feature}),Y=new VectorTile({state:"loading",attributions:"",format:H,urls:g});Y._title=n.name,Y._description=n.description,o=new VectorTileLayer({source:Y,visible:!1,declutter:!0}),o.gpResultLayerId="bookmark:"+n.format.toLowerCase()+":"+n.id,o.styleUrl=n.url;var ee=()=>{applyStyle(o,l,{source:u}).then(()=>{o.getSource().setState("ready"),o.set("mapbox-styles",l)}).then(()=>{o.setVisible(getVisible(n.visible)),o.setOpacity(getOpacity(n.opacity))}).catch(te=>{throw te})};o.getSource()?ee():o.once("change:source",ee)}else throw new Error("Type 'vector' uniquement !");return o};if(s.url)return fetch(s.url).then(n=>{if(n.ok)return n.json().then(o=>e({...s,data:o})).catch(o=>{throw o})}).catch(n=>{throw n});if(s.data)try{var i=e(s);return Promise.resolve(i)}catch(n){return Promise.reject(n)}},getVisible=s=>{var e=s===void 0?!0:s;return typeof e=="string"&&(e==="true"?e=!0:e==="false"?e=!1:e=!0),e},getOpacity=s=>{var e=s===void 0?1:s;return typeof e=="string"&&(e=parseFloat(e)),isNaN(e)&&(e=1),e<0&&(e=0),e>1&&(e=1),e},_sfc_main$4={__name:"Layer",props:{layerOptions:Object,mapId:String},setup(s){const e=s,i=distExports$1.useLogger();i.debug(e.layerOptions);const n=useDataStore(),o=useMapStore(),l=inject(e.mapId);var c=null;return onMounted(()=>{if(!e.layerOptions||Object.keys(e.layerOptions).length===0)return;const u=e.layerOptions.service,h=e.layerOptions.name,f=e.layerOptions.position;if(h&&u){var g=n.getLayerByName(e.layerOptions.name,e.layerOptions.service),H=n.getLayerParamsByName(e.layerOptions.name,e.layerOptions.service);g.params=H;var Y={position:e.layerOptions.position,visible:e.layerOptions.visible,opacity:e.layerOptions.opacity,grayscale:e.layerOptions.grayscale,sourceParams:{crossOrigin:"anonymous"}},ee={preload:1/0,cacheSize:1024};switch(i.debug("layer to add (catalog)",h,u,Y,g),u){case"WMS":c=new LayerWMS({layer:h,configuration:g,apiKey:"entree-carto",olParams:Object.assign(Y,ee)});break;case"WMTS":c=new LayerWMTS({layer:h,configuration:g,apiKey:"entree-carto",olParams:Object.assign(Y,ee)});break;case"TMS":Y.declutter=!0,Y.styleName=e.layerOptions.style||"default",c=new LayerMapBox({layer:h,style:e.layerOptions.style,configuration:g,apiKey:"entree-carto"},Y);break}c&&(i.debug(h,"| position (props - zindex)",f,c.getZIndex()),f!==c.getZIndex()&&(f===-1?i.debug(h,"| position auto"):(i.debug(h,"| change position",f),c.setZIndex(Number(f)))),l.addLayer(c))}const te=e.layerOptions.url,xe=e.layerOptions.format;if(te&&xe){var ne=null;const tt=e.layerOptions.type.toLowerCase();switch(i.debug("layer to add (bookmark)",h,tt,xe),tt){case"service":var et=e.layerOptions.kind.toLowerCase();if(et==="mapbox")ne=createMapBoxLayer(e.layerOptions);else if(et==="wmts"||et==="wms")ne=createServiceLayer(e.layerOptions);else throw new Error("Le service est inconnu !");break;case"carte":throw"Not yet implemented !";case"compute":ne=createComputeLayer(e.layerOptions);break;case"import":xe.toLowerCase()==="mapbox"?ne=createMapBoxLayer(e.layerOptions):ne=createVectorLayer(e.layerOptions);break;case"drawing":ne=createVectorLayer(e.layerOptions);break}ne&&ne.then(it=>(l.addLayer(it),it)).then(it=>(i.debug(h,"| position (props - zindex)",f,it.getZIndex()),f!==it.getZIndex()&&(f===-1?i.debug(h,"| position auto"):(i.debug(h,"| change position",f),it.setZIndex(Number(f)))),it)).then(it=>{c=it}).then(()=>{if(!o.isPermalink){var it=c.getSource();if(l.getView()&&l.getSize()){var rt=null;it&&it.getExtent?rt=it.getExtent():it&&it.getTileGrid&&(rt=it.getTileGrid().getExtent()),rt&&rt[0]!==1/0?l.getView().fit(rt,l.getSize()):c.once("change",()=>{c.getSource().getExtent()&&l.getView().fit(c.getSource().getExtent(),l.getSize())})}}}).catch(it=>{throw it})}}),onUnmounted(()=>{l&&c&&l.removeLayer(c)}),(u,h)=>(openBlock(),createElementBlock("div",null,[renderSlot(u.$slots,"default")]))}},_sfc_main$3={__name:"Layers",props:{selectedLayers:Object,selectedBookmarks:Object,mapId:String},setup(s){const e=s,i=distExports$1.useLogger();var n=computed(()=>toRaw(e.selectedLayers).map(l=>{i.debug(l.name,l.position);var c={name:l.name,service:l.service||l.serviceParams.id.split(":")[1],key:l.key,position:l.hasOwnProperty("position")?l.position:-1,opacity:l.hasOwnProperty("opacity")?l.opacity:1,visible:l.hasOwnProperty("visible")?l.visible:!0,grayscale:l.hasOwnProperty("grayscale")?l.grayscale:!1};return l.hasOwnProperty("style")&&(c.style=l.style),c})),o=computed(()=>toRaw(e.selectedBookmarks).map(l=>(i.debug(l.name,l.position),{position:l.hasOwnProperty("position")?l.position:-1,opacity:l.hasOwnProperty("opacity")?l.opacity:1,visible:l.hasOwnProperty("visible")?l.visible:!0,grayscale:l.hasOwnProperty("grayscale")?l.grayscale:!1,...l})));return(l,c)=>(openBlock(!0),createElementBlock(Fragment,null,renderList([...unref(n),...unref(o)],u=>(openBlock(),createBlock(_sfc_main$4,{key:u.key,"layer-options":u,"map-id":s.mapId},null,8,["layer-options","map-id"]))),128))}},__default__={name:"Carto"},_sfc_main$2=Object.assign(__default__,{props:{selectedControls:{type:Array,default:()=>[]},selectedLayers:{type:Object,default:()=>({})},selectedBookmarks:{type:Object,default:()=>({})}},setup(s){const e=s,i=useMapStore(),n=ref$1(null),o=computed(()=>n.value&&n.value.mapRef);return(l,c)=>(openBlock(),createBlock(_sfc_main$w,{ref_key:"refMap",ref:n,class:"map","map-id":unref(mainMap)},{default:withCtx(()=>[createVNode(_sfc_main$v,{"map-id":unref(mainMap),center:unref(i).center,zoom:unref(i).zoom},null,8,["map-id","center","zoom"]),unref(o)?(openBlock(),createBlock(_sfc_main$5,{key:0,"control-options":e.selectedControls,"map-id":unref(mainMap)},null,8,["control-options","map-id"])):createCommentVNode("",!0),createVNode(_sfc_main$3,{"map-id":unref(mainMap),"selected-layers":e.selectedLayers,"selected-bookmarks":e.selectedBookmarks},null,8,["map-id","selected-layers","selected-bookmarks"])]),_:1},8,["map-id"]))}}),Carto=_export_sfc(_sfc_main$2,[["__scopeId","data-v-debf6fb7"]]),_sfc_main$1={},_hoisted_1={class:"loader"};function _sfc_render(s,e){return openBlock(),createElementBlock("span",_hoisted_1)}const Patience=_export_sfc(_sfc_main$1,[["render",_sfc_render],["__scopeId","data-v-1ebaa4fc"]]),_sfc_main={__name:"StoreData",props:{},async setup(s){let e,i;const n=distExports$1.useLogger(),o=useDataStore(),{fetchData:l}=o,c=([e,i]=withAsyncContext(()=>l()),e=await e,i(),e);return n.debug(c),(u,h)=>unref(o).isLoaded&&!unref(o).error?renderSlot(u.$slots,"default",{key:0}):createCommentVNode("",!0)}};export{Carto as C,Patience as P,_sfc_main$w as _,_sfc_main$v as a,_sfc_main$3 as b,_sfc_main$t as c,_sfc_main as d,fromShare as f,printMap as p,toShare as t,useDataStore as u};
//# sourceMappingURL=StoreData-BZEor8zR.js.map
