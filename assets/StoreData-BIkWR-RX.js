var tr=Object.defineProperty;var qi=n=>{throw TypeError(n)};var ir=(n,e,i)=>e in n?tr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i;var ii=(n,e,i)=>ir(n,typeof e!="symbol"?e+"":e,i),rr=(n,e,i)=>e.has(n)||qi("Cannot "+i);var Bi=(n,e,i)=>e.has(n)?qi("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,i);var Ti=(n,e,i)=>(rr(n,e,"access private method"),i);import{ac as commonjsGlobal,g as getDefaultExportFromCjs$1,ad as useUrlSearchParams,ae as defineStore,x as inject,r as ref$1,af as useStorage,c as computed,O as watch,a8 as provide,t as onMounted,d as createElementBlock,o as openBlock,h as renderSlot,T as distExports$1,ag as onBeforeUpdate,P as onUpdated,ah as onUnmounted,$ as useMatchMedia,z as push$1,A as t$1,u as useServiceStore,U as useEulerian,V as useRouter,H as createBlock,j as withCtx,f as createBaseVNode,l as unref,Z as jt,aa as useBaseUrl,i as createVNode,y as qe$1,k as createTextVNode,J as Fragment,e as createCommentVNode,ai as toRaw,M as renderList,_ as _export_sfc,aj as withAsyncContext}from"./index-Dmu0EUTT.js";const version$2="1.0.0-beta.6-458",Pkg$1={version:version$2},MapEventType={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},ObjectEventType={PROPERTYCHANGE:"propertychange"},EventType$1={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class Disposable{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function binarySearch$1(n,e,i){let s,o;i=i||ascending;let l=0,c=n.length,u=!1;for(;l<c;)s=l+(c-l>>1),o=+i(n[s],e),o<0?l=s+1:(c=s,u=!o);return u?l:~l}function ascending(n,e){return n>e?1:n<e?-1:0}function descending(n,e){return n<e?1:n>e?-1:0}function linearFindNearest(n,e,i){if(n[0]<=e)return 0;const s=n.length;if(e<=n[s-1])return s-1;if(typeof i=="function"){for(let o=1;o<s;++o){const l=n[o];if(l===e)return o;if(l<e)return i(e,n[o-1],l)>0?o-1:o}return s-1}if(i>0){for(let o=1;o<s;++o)if(n[o]<e)return o-1;return s-1}if(i<0){for(let o=1;o<s;++o)if(n[o]<=e)return o;return s-1}for(let o=1;o<s;++o){if(n[o]==e)return o;if(n[o]<e)return n[o-1]-e<e-n[o]?o-1:o}return s-1}function reverseSubArray(n,e,i){for(;e<i;){const s=n[e];n[e]=n[i],n[i]=s,++e,--i}}function extend$4(n,e){const i=Array.isArray(e)?e:[e],s=i.length;for(let o=0;o<s;o++)n[n.length]=i[o]}function equals$2(n,e){const i=n.length;if(i!==e.length)return!1;for(let s=0;s<i;s++)if(n[s]!==e[s])return!1;return!0}function isSorted(n,e,i){const s=e||ascending;return n.every(function(o,l){if(l===0)return!0;const c=s(n[l-1],o);return!(c>0||c===0)})}function TRUE(){return!0}function FALSE(){return!1}function VOID(){}function memoizeOne(n){let e,i,s;return function(){const o=Array.prototype.slice.call(arguments);return(!i||this!==s||!equals$2(o,i))&&(s=this,i=o,e=n.apply(this,arguments)),e}}function toPromise(n){function e(){let i;try{i=n()}catch(s){return Promise.reject(s)}return i instanceof Promise?i:Promise.resolve(i)}return e()}function clear$1(n){for(const e in n)delete n[e]}function isEmpty$1(n){let e;for(e in n)return!1;return!e}class BaseEvent{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class Target extends Disposable{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,i){if(!e||!i)return;const s=this.listeners_||(this.listeners_={}),o=s[e]||(s[e]=[]);o.includes(i)||o.push(i)}dispatchEvent(e){const i=typeof e=="string",s=i?e:e.type,o=this.listeners_&&this.listeners_[s];if(!o)return;const l=i?new BaseEvent(e):e;l.target||(l.target=this.eventTarget_||this);const c=this.dispatching_||(this.dispatching_={}),u=this.pendingRemovals_||(this.pendingRemovals_={});s in c||(c[s]=0,u[s]=0),++c[s];let f;for(let g=0,H=o.length;g<H;++g)if("handleEvent"in o[g]?f=o[g].handleEvent(l):f=o[g].call(this,l),f===!1||l.propagationStopped){f=!1;break}if(--c[s]===0){let g=u[s];for(delete u[s];g--;)this.removeEventListener(s,VOID);delete c[s]}return f}disposeInternal(){this.listeners_&&clear$1(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,i){if(!this.listeners_)return;const s=this.listeners_[e];if(!s)return;const o=s.indexOf(i);o!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(s[o]=VOID,++this.pendingRemovals_[e]):(s.splice(o,1),s.length===0&&delete this.listeners_[e]))}}function listen(n,e,i,s,o){if(o){const c=i;i=function(u){return n.removeEventListener(e,i),c.call(s??this,u)}}else s&&s!==n&&(i=i.bind(s));const l={target:n,type:e,listener:i};return n.addEventListener(e,i),l}function listenOnce(n,e,i,s){return listen(n,e,i,s,!0)}function unlistenByKey(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),clear$1(n))}class Observable extends Target{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(EventType$1.CHANGE)}getRevision(){return this.revision_}onInternal(e,i){if(Array.isArray(e)){const s=e.length,o=new Array(s);for(let l=0;l<s;++l)o[l]=listen(this,e[l],i);return o}return listen(this,e,i)}onceInternal(e,i){let s;if(Array.isArray(e)){const o=e.length;s=new Array(o);for(let l=0;l<o;++l)s[l]=listenOnce(this,e[l],i)}else s=listenOnce(this,e,i);return i.ol_key=s,s}unInternal(e,i){const s=i.ol_key;if(s)unByKey(s);else if(Array.isArray(e))for(let o=0,l=e.length;o<l;++o)this.removeEventListener(e[o],i);else this.removeEventListener(e,i)}}Observable.prototype.on;Observable.prototype.once;Observable.prototype.un;function unByKey(n){if(Array.isArray(n))for(let e=0,i=n.length;e<i;++e)unlistenByKey(n[e]);else unlistenByKey(n)}function abstract(){throw new Error("Unimplemented abstract method.")}let uidCounter_=0;function getUid(n){return n.ol_uid||(n.ol_uid=String(++uidCounter_))}class ObjectEvent extends BaseEvent{constructor(e,i,s){super(e),this.key=i,this.oldValue=s}}class BaseObject extends Observable{constructor(e){super(),this.on,this.once,this.un,getUid(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let i;return this.values_&&this.values_.hasOwnProperty(e)&&(i=this.values_[e]),i}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,i){let s;s=`change:${e}`,this.hasListener(s)&&this.dispatchEvent(new ObjectEvent(s,e,i)),s=ObjectEventType.PROPERTYCHANGE,this.hasListener(s)&&this.dispatchEvent(new ObjectEvent(s,e,i))}addChangeListener(e,i){this.addEventListener(`change:${e}`,i)}removeChangeListener(e,i){this.removeEventListener(`change:${e}`,i)}set(e,i,s){const o=this.values_||(this.values_={});if(s)o[e]=i;else{const l=o[e];o[e]=i,l!==i&&this.notify(e,l)}}setProperties(e,i){for(const s in e)this.set(s,e[s],i)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,i){if(this.values_&&e in this.values_){const s=this.values_[e];delete this.values_[e],isEmpty$1(this.values_)&&(this.values_=null),i||this.notify(e,s)}}}const CLASS_HIDDEN="ol-hidden",CLASS_SELECTABLE="ol-selectable",CLASS_UNSELECTABLE="ol-unselectable",CLASS_UNSUPPORTED="ol-unsupported",CLASS_CONTROL="ol-control",CLASS_COLLAPSED="ol-collapsed",fontRegEx=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),fontRegExMatchIndex=["style","variant","weight","size","lineHeight","family"],fontWeights$1={normal:400,bold:700},getFontParameters=function(n){const e=n.match(fontRegEx);if(!e)return null;const i={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let s=0,o=fontRegExMatchIndex.length;s<o;++s){const l=e[s+1];l!==void 0&&(i[fontRegExMatchIndex[s]]=typeof l=="string"?l.trim():l)}return isNaN(Number(i.weight))&&i.weight in fontWeights$1&&(i.weight=fontWeights$1[i.weight]),i.families=i.family.split(/,\s?/).map(s=>s.trim().replace(/^['"]|['"]$/g,"")),i},ua=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",SAFARI=ua.includes("safari")&&!ua.includes("chrom");SAFARI&&(ua.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(ua));const WEBKIT=ua.includes("webkit")&&!ua.includes("edge"),MAC=ua.includes("macintosh"),DEVICE_PIXEL_RATIO=typeof devicePixelRatio<"u"?devicePixelRatio:1,WORKER_OFFSCREEN_CANVAS=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,IMAGE_DECODE=typeof Image<"u"&&Image.prototype.decode,CREATE_IMAGE_BITMAP=typeof createImageBitmap=="function",PASSIVE_EVENT_LISTENERS=(function(){let n=!1;try{const e=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return n})();function createCanvasContext2D(n,e,i,s){let o;return i&&i.length?o=i.shift():WORKER_OFFSCREEN_CANVAS?o=new OffscreenCanvas(n||300,e||300):o=document.createElement("canvas"),n&&(o.width=n),e&&(o.height=e),o.getContext("2d",s)}let sharedCanvasContext;function getSharedCanvasContext2D(){return sharedCanvasContext||(sharedCanvasContext=createCanvasContext2D(1,1)),sharedCanvasContext}function releaseCanvas(n){const e=n.canvas;e.width=1,e.height=1,n.clearRect(0,0,1,1)}function outerWidth(n){let e=n.offsetWidth;const i=getComputedStyle(n);return e+=parseInt(i.marginLeft,10)+parseInt(i.marginRight,10),e}function outerHeight(n){let e=n.offsetHeight;const i=getComputedStyle(n);return e+=parseInt(i.marginTop,10)+parseInt(i.marginBottom,10),e}function replaceNode(n,e){const i=e.parentNode;i&&i.replaceChild(n,e)}function removeChildren(n){for(;n.lastChild;)n.lastChild.remove()}function replaceChildren(n,e){const i=n.childNodes;for(let s=0;;++s){const o=i[s],l=e[s];if(!o&&!l)break;if(o!==l){if(!o){n.appendChild(l);continue}if(!l){n.removeChild(o),--s;continue}n.insertBefore(l,o)}}}const Relationship={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function boundingExtent(n){const e=createEmpty();for(let i=0,s=n.length;i<s;++i)extendCoordinate(e,n[i]);return e}function _boundingExtentXYs(n,e,i){const s=Math.min.apply(null,n),o=Math.min.apply(null,e),l=Math.max.apply(null,n),c=Math.max.apply(null,e);return createOrUpdate$2(s,o,l,c,i)}function buffer(n,e,i){return i?(i[0]=n[0]-e,i[1]=n[1]-e,i[2]=n[2]+e,i[3]=n[3]+e,i):[n[0]-e,n[1]-e,n[2]+e,n[3]+e]}function clone$1(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n.slice()}function closestSquaredDistanceXY(n,e,i){let s,o;return e<n[0]?s=n[0]-e:n[2]<e?s=e-n[2]:s=0,i<n[1]?o=n[1]-i:n[3]<i?o=i-n[3]:o=0,s*s+o*o}function containsCoordinate(n,e){return containsXY(n,e[0],e[1])}function containsExtent(n,e){return n[0]<=e[0]&&e[2]<=n[2]&&n[1]<=e[1]&&e[3]<=n[3]}function containsXY(n,e,i){return n[0]<=e&&e<=n[2]&&n[1]<=i&&i<=n[3]}function coordinateRelationship(n,e){const i=n[0],s=n[1],o=n[2],l=n[3],c=e[0],u=e[1];let f=Relationship.UNKNOWN;return c<i?f=f|Relationship.LEFT:c>o&&(f=f|Relationship.RIGHT),u<s?f=f|Relationship.BELOW:u>l&&(f=f|Relationship.ABOVE),f===Relationship.UNKNOWN&&(f=Relationship.INTERSECTING),f}function createEmpty(){return[1/0,1/0,-1/0,-1/0]}function createOrUpdate$2(n,e,i,s,o){return o?(o[0]=n,o[1]=e,o[2]=i,o[3]=s,o):[n,e,i,s]}function createOrUpdateEmpty(n){return createOrUpdate$2(1/0,1/0,-1/0,-1/0,n)}function createOrUpdateFromCoordinate(n,e){const i=n[0],s=n[1];return createOrUpdate$2(i,s,i,s,e)}function createOrUpdateFromFlatCoordinates(n,e,i,s,o){const l=createOrUpdateEmpty(o);return extendFlatCoordinates(l,n,e,i,s)}function equals$1(n,e){return n[0]==e[0]&&n[2]==e[2]&&n[1]==e[1]&&n[3]==e[3]}function extend$3(n,e){return e[0]<n[0]&&(n[0]=e[0]),e[2]>n[2]&&(n[2]=e[2]),e[1]<n[1]&&(n[1]=e[1]),e[3]>n[3]&&(n[3]=e[3]),n}function extendCoordinate(n,e){e[0]<n[0]&&(n[0]=e[0]),e[0]>n[2]&&(n[2]=e[0]),e[1]<n[1]&&(n[1]=e[1]),e[1]>n[3]&&(n[3]=e[1])}function extendFlatCoordinates(n,e,i,s,o){for(;i<s;i+=o)extendXY(n,e[i],e[i+1]);return n}function extendXY(n,e,i){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],i),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],i)}function forEachCorner(n,e){let i;return i=e(getBottomLeft(n)),i||(i=e(getBottomRight(n)),i)||(i=e(getTopRight(n)),i)||(i=e(getTopLeft(n)),i)?i:!1}function getArea$1(n){let e=0;return isEmpty(n)||(e=getWidth(n)*getHeight(n)),e}function getBottomLeft(n){return[n[0],n[1]]}function getBottomRight(n){return[n[2],n[1]]}function getCenter(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function getCorner(n,e){let i;if(e==="bottom-left")i=getBottomLeft(n);else if(e==="bottom-right")i=getBottomRight(n);else if(e==="top-left")i=getTopLeft(n);else if(e==="top-right")i=getTopRight(n);else throw new Error("Invalid corner");return i}function getForViewAndSize(n,e,i,s,o){const[l,c,u,f,g,H,Y,ee]=getRotatedViewport(n,e,i,s);return createOrUpdate$2(Math.min(l,u,g,Y),Math.min(c,f,H,ee),Math.max(l,u,g,Y),Math.max(c,f,H,ee),o)}function getRotatedViewport(n,e,i,s){const o=e*s[0]/2,l=e*s[1]/2,c=Math.cos(i),u=Math.sin(i),f=o*c,g=o*u,H=l*c,Y=l*u,ee=n[0],te=n[1];return[ee-f+Y,te-g-H,ee-f-Y,te-g+H,ee+f-Y,te+g+H,ee+f+Y,te+g-H,ee-f+Y,te-g-H]}function getHeight(n){return n[3]-n[1]}function getIntersection(n,e,i){const s=i||createEmpty();return intersects$1(n,e)?(n[0]>e[0]?s[0]=n[0]:s[0]=e[0],n[1]>e[1]?s[1]=n[1]:s[1]=e[1],n[2]<e[2]?s[2]=n[2]:s[2]=e[2],n[3]<e[3]?s[3]=n[3]:s[3]=e[3]):createOrUpdateEmpty(s),s}function getTopLeft(n){return[n[0],n[3]]}function getTopRight(n){return[n[2],n[3]]}function getWidth(n){return n[2]-n[0]}function intersects$1(n,e){return n[0]<=e[2]&&n[2]>=e[0]&&n[1]<=e[3]&&n[3]>=e[1]}function isEmpty(n){return n[2]<n[0]||n[3]<n[1]}function returnOrUpdate(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n}function scaleFromCenter(n,e){const i=(n[2]-n[0])/2*(e-1),s=(n[3]-n[1])/2*(e-1);n[0]-=i,n[2]+=i,n[1]-=s,n[3]+=s}function intersectsSegment(n,e,i){let s=!1;const o=coordinateRelationship(n,e),l=coordinateRelationship(n,i);if(o===Relationship.INTERSECTING||l===Relationship.INTERSECTING)s=!0;else{const c=n[0],u=n[1],f=n[2],g=n[3],H=e[0],Y=e[1],ee=i[0],te=i[1],ne=(te-Y)/(ee-H);let Ye,xe;l&Relationship.ABOVE&&!(o&Relationship.ABOVE)&&(Ye=ee-(te-g)/ne,s=Ye>=c&&Ye<=f),!s&&l&Relationship.RIGHT&&!(o&Relationship.RIGHT)&&(xe=te-(ee-f)*ne,s=xe>=u&&xe<=g),!s&&l&Relationship.BELOW&&!(o&Relationship.BELOW)&&(Ye=ee-(te-u)/ne,s=Ye>=c&&Ye<=f),!s&&l&Relationship.LEFT&&!(o&Relationship.LEFT)&&(xe=te-(ee-c)*ne,s=xe>=u&&xe<=g)}return s}function applyTransform(n,e,i,s){if(isEmpty(n))return createOrUpdateEmpty(i);let o=[];o=[n[0],n[1],n[2],n[1],n[2],n[3],n[0],n[3]],e(o,o,2);const l=[],c=[];for(let u=0,f=o.length;u<f;u+=2)l.push(o[u]),c.push(o[u+1]);return _boundingExtentXYs(l,c,i)}function wrapX$2(n,e){const i=e.getExtent(),s=getCenter(n);if(e.canWrapX()&&(s[0]<i[0]||s[0]>=i[2])){const o=getWidth(i),c=Math.floor((s[0]-i[0])/o)*o;n[0]-=c,n[2]-=c}return n}function wrapAndSliceX(n,e,i){if(e.canWrapX()){const s=e.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[s[0],n[1],s[2],n[3]]];wrapX$2(n,e);const o=getWidth(s);if(getWidth(n)>o&&!i)return[[s[0],n[1],s[2],n[3]]];if(n[0]<s[0])return[[n[0]+o,n[1],s[2],n[3]],[s[0],n[1],n[2],n[3]]];if(n[2]>s[2])return[[n[0],n[1],s[2],n[3]],[s[0],n[1],n[2]-o,n[3]]]}return[n]}const Property$3={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Overlay extends BaseObject{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+CLASS_SELECTABLE,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(Property$3.ELEMENT,this.handleElementChanged),this.addChangeListener(Property$3.MAP,this.handleMapChanged),this.addChangeListener(Property$3.OFFSET,this.handleOffsetChanged),this.addChangeListener(Property$3.POSITION,this.handlePositionChanged),this.addChangeListener(Property$3.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(Property$3.ELEMENT)}getId(){return this.id}getMap(){return this.get(Property$3.MAP)||null}getOffset(){return this.get(Property$3.OFFSET)}getPosition(){return this.get(Property$3.POSITION)}getPositioning(){return this.get(Property$3.POSITIONING)}handleElementChanged(){removeChildren(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){var i;this.mapPostrenderListenerKey&&((i=this.element)==null||i.remove(),unlistenByKey(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=listen(e,MapEventType.POSTRENDER,this.render,this),this.updatePixelPosition();const s=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?s.insertBefore(this.element,s.childNodes[0]||null):s.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(Property$3.ELEMENT,e)}setMap(e){this.set(Property$3.MAP,e)}setOffset(e){this.set(Property$3.OFFSET,e)}setPosition(e){this.set(Property$3.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const i=this.getMap();if(!i||!i.getTargetElement()||!this.get(Property$3.POSITION))return;const s=this.getRect(i.getTargetElement(),i.getSize()),o=this.getElement(),l=this.getRect(o,[outerWidth(o),outerHeight(o)]);e=e||{};const c=e.margin===void 0?20:e.margin;if(!containsExtent(s,l)){const u=l[0]-s[0],f=s[2]-l[2],g=l[1]-s[1],H=s[3]-l[3],Y=[0,0];if(u<0?Y[0]=u-c:f<0&&(Y[0]=Math.abs(f)+c),g<0?Y[1]=g-c:H<0&&(Y[1]=Math.abs(H)+c),Y[0]!==0||Y[1]!==0){const ee=i.getView().getCenterInternal(),te=i.getPixelFromCoordinateInternal(ee);if(!te)return;const ne=[te[0]+Y[0],te[1]+Y[1]],Ye=e.animation||{};i.getView().animateInternal({center:i.getCoordinateFromPixelInternal(ne),duration:Ye.duration,easing:Ye.easing})}}}getRect(e,i){const s=e.getBoundingClientRect(),o=s.left+window.pageXOffset,l=s.top+window.pageYOffset;return[o,l,o+i[0],l+i[1]]}setPositioning(e){this.set(Property$3.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),i=this.getPosition();if(!e||!e.isRendered()||!i){this.setVisible(!1);return}const s=e.getPixelFromCoordinate(i),o=e.getSize();this.updateRenderedPosition(s,o)}updateRenderedPosition(e,i){const s=this.element.style,o=this.getOffset(),l=this.getPositioning();this.setVisible(!0);const c=`${e[0]+o[0]}px`,u=`${e[1]+o[1]}px`;let f="0%",g="0%";l=="bottom-right"||l=="center-right"||l=="top-right"?f="-100%":(l=="bottom-center"||l=="center-center"||l=="top-center")&&(f="-50%"),l=="bottom-left"||l=="bottom-center"||l=="bottom-right"?g="-100%":(l=="center-left"||l=="center-center"||l=="center-right")&&(g="-50%");const H=`translate(${f}, ${g}) translate(${c}, ${u})`;this.rendered.transform_!=H&&(this.rendered.transform_=H,s.transform=H)}getOptions(){return this.options}}const TileState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function easeIn(n){return Math.pow(n,3)}function easeOut(n){return 1-easeIn(1-n)}function inAndOut(n){return 3*n*n-2*n*n*n}function linear(n){return n}class Tile extends Target{constructor(e,i,s){super(),s=s||{},this.tileCoord=e,this.state=i,this.key="",this.transition_=s.transition===void 0?250:s.transition,this.transitionStarts_={},this.interpolate=!!s.interpolate}changed(){this.dispatchEvent(EventType$1.CHANGE)}release(){this.setState(TileState.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==TileState.EMPTY){if(this.state!==TileState.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}}load(){abstract()}getAlpha(e,i){if(!this.transition_)return 1;let s=this.transitionStarts_[e];if(!s)s=i,this.transitionStarts_[e]=s;else if(s===-1)return 1;const o=i-s+1e3/60;return o>=this.transition_?1:easeIn(o/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}const canvasPool$2=[];class VectorRenderTile extends Tile{constructor(e,i,s,o,l){super(e,i,{transition:0}),this.context_=null,this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=o.bind(void 0,this),this.removeSourceTiles_=l,this.wrappedTileCoord=s}getContext(){return this.context_||(this.context_=createCanvasContext2D(1,1,canvasPool$2)),this.context_}hasContext(){return!!this.context_}getImage(){return this.hasContext()?this.getContext().canvas:null}getReplayState(e){const i=getUid(e);return i in this.replayState_||(this.replayState_[i]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[i]}load(){this.getSourceTiles()}release(){this.context_&&(releaseCanvas(this.context_),canvasPool$2.push(this.context_.canvas),this.context_=null),this.removeSourceTiles_(this),this.sourceTiles.length=0,super.release()}}let VectorTile$1=class extends Tile{constructor(e,i,s,o,l,c){super(e,i,c),this.extent=null,this.format_=o,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=l,this.url_=s,this.key=s}getTileUrl(){return this.url_}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==TileState.IDLE&&(this.setState(TileState.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,i){this.setFeatures(e)}onError(){this.setState(TileState.ERROR)}setFeatures(e){this.features_=e,this.setState(TileState.LOADED)}setLoader(e){this.loader_=e}};function assert(n,e){if(!n)throw new Error(e)}let withCredentials=!1;function loadFeaturesXhr(n,e,i,s,o,l,c){const u=new XMLHttpRequest;u.open("GET",typeof n=="function"?n(i,s,o):n,!0),e.getType()=="arraybuffer"&&(u.responseType="arraybuffer"),u.withCredentials=withCredentials,u.onload=function(f){if(!u.status||u.status>=200&&u.status<300){const g=e.getType();try{let H;g=="text"||g=="json"?H=u.responseText:g=="xml"?H=u.responseXML||u.responseText:g=="arraybuffer"&&(H=u.response),H?l(e.readFeatures(H,{extent:i,featureProjection:o}),e.readProjection(H)):c()}catch{c()}}else c()},u.onerror=c,u.send()}function xhr(n,e){return function(i,s,o,l,c){loadFeaturesXhr(n,e,i,s,o,(u,f)=>{this.addFeatures(u),l!==void 0&&l(u)},()=>{this.changed(),c!==void 0&&c()})}}function warn(...n){console.warn(...n)}function clamp$1(n,e,i){return Math.min(Math.max(n,e),i)}function squaredSegmentDistance(n,e,i,s,o,l){const c=o-i,u=l-s;if(c!==0||u!==0){const f=((n-i)*c+(e-s)*u)/(c*c+u*u);f>1?(i=o,s=l):f>0&&(i+=c*f,s+=u*f)}return squaredDistance$1(n,e,i,s)}function squaredDistance$1(n,e,i,s){const o=i-n,l=s-e;return o*o+l*l}function solveLinearSystem(n){const e=n.length;for(let s=0;s<e;s++){let o=s,l=Math.abs(n[s][s]);for(let u=s+1;u<e;u++){const f=Math.abs(n[u][s]);f>l&&(l=f,o=u)}if(l===0)return null;const c=n[o];n[o]=n[s],n[s]=c;for(let u=s+1;u<e;u++){const f=-n[u][s]/n[s][s];for(let g=s;g<e+1;g++)s==g?n[u][g]=0:n[u][g]+=f*n[s][g]}}const i=new Array(e);for(let s=e-1;s>=0;s--){i[s]=n[s][e]/n[s][s];for(let o=s-1;o>=0;o--)n[o][e]-=n[o][s]*i[s]}return i}function toDegrees(n){return n*180/Math.PI}function toRadians(n){return n*Math.PI/180}function modulo(n,e){const i=n%e;return i*e<0?i+e:i}function lerp(n,e,i){return n+i*(e-n)}function toFixed(n,e){const i=Math.pow(10,e);return Math.round(n*i)/i}function round(n,e){return Math.round(toFixed(n,e))}function floor(n,e){return Math.floor(toFixed(n,e))}function ceil(n,e){return Math.ceil(toFixed(n,e))}function wrap(n,e,i){if(n>=e&&n<i)return n;const s=i-e;return((n-e)%s+s)%s+e}function padNumber(n,e,i){const s=""+n;let o=s.indexOf(".");return o=o===-1?s.length:o,o>e?s:new Array(1+e-o).join("0")+s}function compareVersions(n,e){const i=(""+n).split("."),s=(""+e).split(".");for(let o=0;o<Math.max(i.length,s.length);o++){const l=parseInt(i[o]||"0",10),c=parseInt(s[o]||"0",10);if(l>c)return 1;if(c>l)return-1}return 0}function add$3(n,e){return n[0]+=+e[0],n[1]+=+e[1],n}function closestOnSegment(n,e){const i=n[0],s=n[1],o=e[0],l=e[1],c=o[0],u=o[1],f=l[0],g=l[1],H=f-c,Y=g-u,ee=H===0&&Y===0?0:(H*(i-c)+Y*(s-u))/(H*H+Y*Y||0);let te,ne;return ee<=0?(te=c,ne=u):ee>=1?(te=f,ne=g):(te=c+ee*H,ne=u+ee*Y),[te,ne]}function equals(n,e){let i=!0;for(let s=n.length-1;s>=0;--s)if(n[s]!=e[s]){i=!1;break}return i}function rotate$1(n,e){const i=Math.cos(e),s=Math.sin(e),o=n[0]*i-n[1]*s,l=n[1]*i+n[0]*s;return n[0]=o,n[1]=l,n}function scale$3(n,e){return n[0]*=e,n[1]*=e,n}function squaredDistance(n,e){const i=n[0]-e[0],s=n[1]-e[1];return i*i+s*s}function distance(n,e){return Math.sqrt(squaredDistance(n,e))}function squaredDistanceToSegment(n,e){return squaredDistance(n,closestOnSegment(n,e))}function wrapX$1(n,e){if(e.canWrapX()){const i=getWidth(e.getExtent()),s=getWorldsAway(n,e,i);s&&(n[0]-=s*i)}return n}function getWorldsAway(n,e,i){const s=e.getExtent();let o=0;return e.canWrapX()&&(n[0]<s[0]||n[0]>s[2])&&(i=i||getWidth(s),o=Math.floor((n[0]-s[0])/i)),o}const METERS_PER_UNIT$1={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let Projection$1=class{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||METERS_PER_UNIT$1[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const RADIUS$1=6378137,HALF_SIZE=Math.PI*RADIUS$1,EXTENT$2=[-HALF_SIZE,-HALF_SIZE,HALF_SIZE,HALF_SIZE],WORLD_EXTENT=[-180,-85,180,85],MAX_SAFE_Y=RADIUS$1*Math.log(Math.tan(Math.PI/2));class EPSG3857Projection extends Projection$1{constructor(e){super({code:e,units:"m",extent:EXTENT$2,global:!0,worldExtent:WORLD_EXTENT,getPointResolution:function(i,s){return i/Math.cosh(s[1]/RADIUS$1)}})}}const PROJECTIONS$1=[new EPSG3857Projection("EPSG:3857"),new EPSG3857Projection("EPSG:102100"),new EPSG3857Projection("EPSG:102113"),new EPSG3857Projection("EPSG:900913"),new EPSG3857Projection("http://www.opengis.net/def/crs/EPSG/0/3857"),new EPSG3857Projection("http://www.opengis.net/gml/srs/epsg.xml#3857")];function fromEPSG4326(n,e,i,s){const o=n.length;i=i>1?i:2,s=s??i,e===void 0&&(i>2?e=n.slice():e=new Array(o));for(let l=0;l<o;l+=s){e[l]=HALF_SIZE*n[l]/180;let c=RADIUS$1*Math.log(Math.tan(Math.PI*(+n[l+1]+90)/360));c>MAX_SAFE_Y?c=MAX_SAFE_Y:c<-MAX_SAFE_Y&&(c=-MAX_SAFE_Y),e[l+1]=c}return e}function toEPSG4326(n,e,i,s){const o=n.length;i=i>1?i:2,s=s??i,e===void 0&&(i>2?e=n.slice():e=new Array(o));for(let l=0;l<o;l+=s)e[l]=180*n[l]/HALF_SIZE,e[l+1]=360*Math.atan(Math.exp(n[l+1]/RADIUS$1))/Math.PI-90;return e}const RADIUS=6378137,EXTENT$1=[-180,-90,180,90],METERS_PER_UNIT=Math.PI*RADIUS/180;class EPSG4326Projection extends Projection$1{constructor(e,i){super({code:e,units:"degrees",extent:EXTENT$1,axisOrientation:i,global:!0,metersPerUnit:METERS_PER_UNIT,worldExtent:EXTENT$1})}}const PROJECTIONS=[new EPSG4326Projection("CRS:84"),new EPSG4326Projection("EPSG:4326","neu"),new EPSG4326Projection("urn:ogc:def:crs:OGC:1.3:CRS84"),new EPSG4326Projection("urn:ogc:def:crs:OGC:2:84"),new EPSG4326Projection("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new EPSG4326Projection("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new EPSG4326Projection("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let cache$1={};function get$5(n){return cache$1[n]||cache$1[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function add$2(n,e){cache$1[n]=e}let transforms={};function add$1(n,e,i){const s=n.getCode(),o=e.getCode();s in transforms||(transforms[s]={}),transforms[s][o]=i}function get$4(n,e){return n in transforms&&e in transforms[n]?transforms[n][e]:null}const K0=.9996,E$1=.00669438,E2$1=E$1*E$1,E3=E2$1*E$1,E_P2=E$1/(1-E$1),SQRT_E=Math.sqrt(1-E$1),_E=(1-SQRT_E)/(1+SQRT_E),_E2=_E*_E,_E3=_E2*_E,_E4=_E3*_E,_E5=_E4*_E,M1=1-E$1/4-3*E2$1/64-5*E3/256,M2=3*E$1/8+3*E2$1/32+45*E3/1024,M3=15*E2$1/256+45*E3/1024,M4=35*E3/3072,P2=3/2*_E-27/32*_E3+269/512*_E5,P3=21/16*_E2-55/32*_E4,P4=151/96*_E3-417/128*_E5,P5=1097/512*_E4,R$1=6378137;function toLonLat$1(n,e,i){const s=n-5e5,c=(i.north?e:e-1e7)/K0/(R$1*M1),u=c+P2*Math.sin(2*c)+P3*Math.sin(4*c)+P4*Math.sin(6*c)+P5*Math.sin(8*c),f=Math.sin(u),g=f*f,H=Math.cos(u),Y=f/H,ee=Y*Y,te=ee*ee,ne=1-E$1*g,Ye=Math.sqrt(1-E$1*g),xe=R$1/Ye,tt=(1-E$1)/ne,et=E_P2*H**2,it=et*et,rt=s/(xe*K0),nt=rt*rt,at=nt*rt,st=at*rt,ot=st*rt,ut=ot*rt,ht=u-Y/tt*(nt/2-st/24*(5+3*ee+10*et-4*it-9*E_P2))+ut/720*(61+90*ee+298*et+45*te-252*E_P2-3*it);let dt=(rt-at/6*(1+2*ee+et)+ot/120*(5-2*et+28*ee-3*it+8*E_P2+24*te))/H;return dt=wrap(dt+toRadians(zoneToCentralLongitude(i.number)),-Math.PI,Math.PI),[toDegrees(dt),toDegrees(ht)]}const MIN_LATITUDE=-80,MAX_LATITUDE=84,MIN_LONGITUDE=-180,MAX_LONGITUDE=180;function fromLonLat$1(n,e,i){n=wrap(n,MIN_LONGITUDE,MAX_LONGITUDE),e<MIN_LATITUDE?e=MIN_LATITUDE:e>MAX_LATITUDE&&(e=MAX_LATITUDE);const s=toRadians(e),o=Math.sin(s),l=Math.cos(s),c=o/l,u=c*c,f=u*u,g=toRadians(n),H=zoneToCentralLongitude(i.number),Y=toRadians(H),ee=R$1/Math.sqrt(1-E$1*o**2),te=E_P2*l**2,ne=l*wrap(g-Y,-Math.PI,Math.PI),Ye=ne*ne,xe=Ye*ne,tt=xe*ne,et=tt*ne,it=et*ne,rt=R$1*(M1*s-M2*Math.sin(2*s)+M3*Math.sin(4*s)-M4*Math.sin(6*s)),nt=K0*ee*(ne+xe/6*(1-u+te)+et/120*(5-18*u+f+72*te-58*E_P2))+5e5;let at=K0*(rt+ee*c*(Ye/2+tt/24*(5-u+9*te+4*te**2)+it/720*(61-58*u+f+600*te-330*E_P2)));return i.north||(at+=1e7),[nt,at]}function zoneToCentralLongitude(n){return(n-1)*6-180+3}const epsgRegExes=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function zoneFromCode(n){let e=0;for(const o of epsgRegExes){const l=n.match(o);if(l){e=parseInt(l[1]);break}}if(!e)return null;let i=0,s=!1;return e>32700&&e<32761?i=e-32700:e>32600&&e<32661&&(s=!0,i=e-32600),i?{number:i,north:s}:null}function makeTransformFunction(n,e){return function(i,s,o,l){const c=i.length;o=o>1?o:2,l=l??o,s||(o>2?s=i.slice():s=new Array(c));for(let u=0;u<c;u+=l){const f=i[u],g=i[u+1],H=n(f,g,e);s[u]=H[0],s[u+1]=H[1]}return s}}function makeProjection(n){return zoneFromCode(n)?new Projection$1({code:n,units:"m"}):null}function makeTransforms(n){const e=zoneFromCode(n.getCode());return e?{forward:makeTransformFunction(fromLonLat$1,e),inverse:makeTransformFunction(toLonLat$1,e)}:null}const DEFAULT_RADIUS=63710088e-1;function getDistance(n,e,i){i=i||DEFAULT_RADIUS;const s=toRadians(n[1]),o=toRadians(e[1]),l=(o-s)/2,c=toRadians(e[0]-n[0])/2,u=Math.sin(l)*Math.sin(l)+Math.sin(c)*Math.sin(c)*Math.cos(s)*Math.cos(o);return 2*i*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))}function getAreaInternal(n,e){let i=0;const s=n.length;let o=n[s-1][0],l=n[s-1][1];for(let c=0;c<s;c++){const u=n[c][0],f=n[c][1];i+=toRadians(u-o)*(2+Math.sin(toRadians(l))+Math.sin(toRadians(f))),o=u,l=f}return i*e*e/2}function getArea(n,e){e=e||{};const i=e.radius||DEFAULT_RADIUS,s=e.projection||"EPSG:3857",o=n.getType();o!=="GeometryCollection"&&(n=n.clone().transform(s,"EPSG:4326"));let l=0,c,u,f,g,H,Y;switch(o){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"LinearRing":break;case"Polygon":{for(c=n.getCoordinates(),l=Math.abs(getAreaInternal(c[0],i)),f=1,g=c.length;f<g;++f)l-=Math.abs(getAreaInternal(c[f],i));break}case"MultiPolygon":{for(c=n.getCoordinates(),f=0,g=c.length;f<g;++f)for(u=c[f],l+=Math.abs(getAreaInternal(u[0],i)),H=1,Y=u.length;H<Y;++H)l-=Math.abs(getAreaInternal(u[H],i));break}case"GeometryCollection":{const ee=n.getGeometries();for(f=0,g=ee.length;f<g;++f)l+=getArea(ee[f],e);break}default:throw new Error("Unsupported geometry type: "+o)}return l}const transformFactories=[makeTransforms],projectionFactories=[makeProjection];let showCoordinateWarning=!0;function disableCoordinateWarning(n){showCoordinateWarning=!1}function cloneTransform(n,e){if(e!==void 0){for(let i=0,s=n.length;i<s;++i)e[i]=n[i];e=e}else e=n.slice();return e}function addProjection(n){add$2(n.getCode(),n),add$1(n,n,cloneTransform)}function addProjections(n){n.forEach(addProjection)}function get$3(n){if(typeof n!="string")return n;const e=get$5(n);if(e)return e;for(const i of projectionFactories){const s=i(n);if(s)return s}return null}function getPointResolution(n,e,i,s){n=get$3(n);let o;const l=n.getPointResolutionFunc();if(l){if(o=l(e,i),s&&s!==n.getUnits()){const c=n.getMetersPerUnit();c&&(o=o*c/METERS_PER_UNIT$1[s])}}else{const c=n.getUnits();if(c=="degrees"&&!s||s=="degrees")o=e;else{const u=getTransformFromProjections(n,get$3("EPSG:4326"));if(!u&&c!=="degrees")o=e*n.getMetersPerUnit();else{let g=[i[0]-e/2,i[1],i[0]+e/2,i[1],i[0],i[1]-e/2,i[0],i[1]+e/2];g=u(g,g,2);const H=getDistance(g.slice(0,2),g.slice(2,4)),Y=getDistance(g.slice(4,6),g.slice(6,8));o=(H+Y)/2}const f=s?METERS_PER_UNIT$1[s]:n.getMetersPerUnit();f!==void 0&&(o/=f)}}return o}function addEquivalentProjections(n){addProjections(n),n.forEach(function(e){n.forEach(function(i){e!==i&&add$1(e,i,cloneTransform)})})}function addEquivalentTransforms(n,e,i,s){n.forEach(function(o){e.forEach(function(l){add$1(o,l,i),add$1(l,o,s)})})}function createProjection(n,e){return n?typeof n=="string"?get$3(n):n:get$3(e)}function createTransformFromCoordinateTransform(n){return(function(e,i,s,o){const l=e.length;s=s!==void 0?s:2,o=o??s,i=i!==void 0?i:new Array(l);for(let c=0;c<l;c+=o){const u=n(e.slice(c,c+s)),f=u.length;for(let g=0,H=o;g<H;++g)i[c+g]=g>=f?e[c+g]:u[g]}return i})}function addCoordinateTransforms(n,e,i,s){const o=get$3(n),l=get$3(e);add$1(o,l,createTransformFromCoordinateTransform(i)),add$1(l,o,createTransformFromCoordinateTransform(s))}function fromLonLat(n,e){return disableCoordinateWarning(),transform$1(n,"EPSG:4326",e!==void 0?e:"EPSG:3857")}function toLonLat(n,e){const i=transform$1(n,"EPSG:3857","EPSG:4326"),s=i[0];return(s<-180||s>180)&&(i[0]=modulo(s+180,360)-180),i}function equivalent$1(n,e){if(n===e)return!0;const i=n.getUnits()===e.getUnits();return(n.getCode()===e.getCode()||getTransformFromProjections(n,e)===cloneTransform)&&i}function getTransformFromProjections(n,e){const i=n.getCode(),s=e.getCode();let o=get$4(i,s);if(o)return o;let l=null,c=null;for(const f of transformFactories)l||(l=f(n)),c||(c=f(e));if(!l&&!c)return null;const u="EPSG:4326";if(c)if(l)o=composeTransformFuncs(l.inverse,c.forward);else{const f=get$4(i,u);f&&(o=composeTransformFuncs(f,c.forward))}else{const f=get$4(u,s);f&&(o=composeTransformFuncs(l.inverse,f))}return o&&(addProjection(n),addProjection(e),add$1(n,e,o)),o}function composeTransformFuncs(n,e){return function(i,s,o,l){return s=n(i,s,o,l),e(s,s,o,l)}}function getTransform(n,e){const i=get$3(n),s=get$3(e);return getTransformFromProjections(i,s)}function transform$1(n,e,i){const s=getTransform(e,i);if(!s){const o=get$3(e).getCode(),l=get$3(i).getCode();throw new Error(`No transform available between ${o} and ${l}`)}return s(n,void 0,n.length)}function transformExtent(n,e,i,s){const o=getTransform(e,i);return applyTransform(n,o,void 0)}let userProjection=null;function getUserProjection(){return userProjection}function toUserCoordinate(n,e){return n}function fromUserCoordinate(n,e){return showCoordinateWarning&&!equals(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(showCoordinateWarning=!1,warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n}function toUserExtent(n,e){return n}function fromUserExtent(n,e){return n}function fromUserResolution(n,e){return n}function addCommon(){addEquivalentProjections(PROJECTIONS$1),addEquivalentProjections(PROJECTIONS),addEquivalentTransforms(PROJECTIONS,PROJECTIONS$1,fromEPSG4326,toEPSG4326)}addCommon();function hasArea(n){return n[0]>0&&n[1]>0}function scale$2(n,e,i){return i===void 0&&(i=[0,0]),i[0]=n[0]*e+.5|0,i[1]=n[1]*e+.5|0,i}function toSize(n,e){return Array.isArray(n)?n:(e===void 0?e=[n,n]:(e[0]=n,e[1]=n),e)}class TileRange{constructor(e,i,s,o){this.minX=e,this.maxX=i,this.minY=s,this.maxY=o}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,i){return this.minX<=e&&e<=this.maxX&&this.minY<=i&&i<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function createOrUpdate$1(n,e,i,s,o){return o!==void 0?(o.minX=n,o.maxX=e,o.minY=i,o.maxY=s,o):new TileRange(n,e,i,s)}function linearRingContainsExtent(n,e,i,s,o){return!forEachCorner(o,function(c){return!linearRingContainsXY(n,e,i,s,c[0],c[1])})}function linearRingContainsXY(n,e,i,s,o,l){let c=0,u=n[i-s],f=n[i-s+1];for(;e<i;e+=s){const g=n[e],H=n[e+1];f<=l?H>l&&(g-u)*(l-f)-(o-u)*(H-f)>0&&c++:H<=l&&(g-u)*(l-f)-(o-u)*(H-f)<0&&c--,u=g,f=H}return c!==0}function linearRingsContainsXY(n,e,i,s,o,l){if(i.length===0||!linearRingContainsXY(n,e,i[0],s,o,l))return!1;for(let c=1,u=i.length;c<u;++c)if(linearRingContainsXY(n,i[c-1],i[c],s,o,l))return!1;return!0}function linearRingssContainsXY(n,e,i,s,o,l){if(i.length===0)return!1;for(let c=0,u=i.length;c<u;++c){const f=i[c];if(linearRingsContainsXY(n,e,f,s,o,l))return!0;e=f[f.length-1]}return!1}function forEach(n,e,i,s,o){let l;for(e+=s;e<i;e+=s)if(l=o(n.slice(e-s,e),n.slice(e,e+s)),l)return l;return!1}function intersectsLineString(n,e,i,s,o,l){return l=l??extendFlatCoordinates(createEmpty(),n,e,i,s),intersects$1(o,l)?l[0]>=o[0]&&l[2]<=o[2]||l[1]>=o[1]&&l[3]<=o[3]?!0:forEach(n,e,i,s,function(c,u){return intersectsSegment(o,c,u)}):!1}function intersectsLineStringArray(n,e,i,s,o){for(let l=0,c=i.length;l<c;++l){if(intersectsLineString(n,e,i[l],s,o))return!0;e=i[l]}return!1}function intersectsLinearRing(n,e,i,s,o){return!!(intersectsLineString(n,e,i,s,o)||linearRingContainsXY(n,e,i,s,o[0],o[1])||linearRingContainsXY(n,e,i,s,o[0],o[3])||linearRingContainsXY(n,e,i,s,o[2],o[1])||linearRingContainsXY(n,e,i,s,o[2],o[3]))}function intersectsLinearRingArray(n,e,i,s,o){if(!intersectsLinearRing(n,e,i[0],s,o))return!1;if(i.length===1)return!0;for(let l=1,c=i.length;l<c;++l)if(linearRingContainsExtent(n,i[l-1],i[l],s,o)&&!intersectsLineString(n,i[l-1],i[l],s,o))return!1;return!0}function intersectsLinearRingMultiArray(n,e,i,s,o){for(let l=0,c=i.length;l<c;++l){const u=i[l];if(intersectsLinearRingArray(n,e,u,s,o))return!0;e=u[u.length-1]}return!1}function createOrUpdate(n,e,i,s){return s!==void 0?(s[0]=n,s[1]=e,s[2]=i,s):[n,e,i]}function getKeyZXY(n,e,i){return n+"/"+e+"/"+i}function hash(n){return hashZXY(n[0],n[1],n[2])}function hashZXY(n,e,i){return(e<<n)+i}function withinExtentAndZ(n,e){const i=n[0],s=n[1],o=n[2];if(e.getMinZoom()>i||i>e.getMaxZoom())return!1;const l=e.getFullTileRange(i);return l?l.containsXY(s,o):!0}const DEFAULT_MAX_ZOOM=42,DEFAULT_TILE_SIZE=256,tmpTileCoord=[0,0,0],DECIMALS$1=5;class TileGrid{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,assert(isSorted(this.resolutions_,(o,l)=>l-o),"`resolutions` must be sorted in descending order");let i;if(!e.origins){for(let o=0,l=this.resolutions_.length-1;o<l;++o)if(!i)i=this.resolutions_[o]/this.resolutions_[o+1];else if(this.resolutions_[o]/this.resolutions_[o+1]!==i){i=void 0;break}}this.zoomFactor_=i,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,assert(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const s=e.extent;s!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=getTopLeft(s)),assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,assert(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:DEFAULT_TILE_SIZE,assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=s!==void 0?s:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((o,l)=>{const c=new TileRange(Math.min(0,o[0]),Math.max(o[0]-1,-1),Math.min(0,o[1]),Math.max(o[1]-1,-1));if(s){const u=this.getTileRangeForExtentAndZ(s,l);c.minX=Math.max(u.minX,c.minX),c.maxX=Math.min(u.maxX,c.maxX),c.minY=Math.max(u.minY,c.minY),c.maxY=Math.min(u.maxY,c.maxY)}return c}):s&&this.calculateTileRanges_(s)}forEachTileCoord(e,i,s){const o=this.getTileRangeForExtentAndZ(e,i);for(let l=o.minX,c=o.maxX;l<=c;++l)for(let u=o.minY,f=o.maxY;u<=f;++u)s([i,l,u])}forEachTileCoordParentTileRange(e,i,s,o){let l,c,u,f=null,g=e[0]-1;for(this.zoomFactor_===2?(c=e[1],u=e[2]):f=this.getTileCoordExtent(e,o);g>=this.minZoom;){if(c!==void 0&&u!==void 0?(c=Math.floor(c/2),u=Math.floor(u/2),l=createOrUpdate$1(c,c,u,u,s)):l=this.getTileRangeForExtentAndZ(f,g,s),i(g,l))return!0;--g}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,i,s){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const l=e[1]*2,c=e[2]*2;return createOrUpdate$1(l,l+1,c,c+1,i)}const o=this.getTileCoordExtent(e,s||this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,e[0]+1,i)}return null}getTileRangeForTileCoordAndZ(e,i,s){if(i>this.maxZoom||i<this.minZoom)return null;const o=e[0],l=e[1],c=e[2];if(i===o)return createOrUpdate$1(l,c,l,c,s);if(this.zoomFactor_){const f=Math.pow(this.zoomFactor_,i-o),g=Math.floor(l*f),H=Math.floor(c*f);if(i<o)return createOrUpdate$1(g,g,H,H,s);const Y=Math.floor(f*(l+1))-1,ee=Math.floor(f*(c+1))-1;return createOrUpdate$1(g,Y,H,ee,s)}const u=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(u,i,s)}getTileRangeForExtentAndZ(e,i,s){this.getTileCoordForXYAndZ_(e[0],e[3],i,!1,tmpTileCoord);const o=tmpTileCoord[1],l=tmpTileCoord[2];this.getTileCoordForXYAndZ_(e[2],e[1],i,!0,tmpTileCoord);const c=tmpTileCoord[1],u=tmpTileCoord[2];return createOrUpdate$1(o,c,l,u,s)}getTileCoordCenter(e){const i=this.getOrigin(e[0]),s=this.getResolution(e[0]),o=toSize(this.getTileSize(e[0]),this.tmpSize_);return[i[0]+(e[1]+.5)*o[0]*s,i[1]-(e[2]+.5)*o[1]*s]}getTileCoordExtent(e,i){const s=this.getOrigin(e[0]),o=this.getResolution(e[0]),l=toSize(this.getTileSize(e[0]),this.tmpSize_),c=s[0]+e[1]*l[0]*o,u=s[1]-(e[2]+1)*l[1]*o,f=c+l[0]*o,g=u+l[1]*o;return createOrUpdate$2(c,u,f,g,i)}getTileCoordForCoordAndResolution(e,i,s){return this.getTileCoordForXYAndResolution_(e[0],e[1],i,!1,s)}getTileCoordForXYAndResolution_(e,i,s,o,l){const c=this.getZForResolution(s),u=s/this.getResolution(c),f=this.getOrigin(c),g=toSize(this.getTileSize(c),this.tmpSize_);let H=u*(e-f[0])/s/g[0],Y=u*(f[1]-i)/s/g[1];return o?(H=ceil(H,DECIMALS$1)-1,Y=ceil(Y,DECIMALS$1)-1):(H=floor(H,DECIMALS$1),Y=floor(Y,DECIMALS$1)),createOrUpdate(c,H,Y,l)}getTileCoordForXYAndZ_(e,i,s,o,l){const c=this.getOrigin(s),u=this.getResolution(s),f=toSize(this.getTileSize(s),this.tmpSize_);let g=(e-c[0])/u/f[0],H=(c[1]-i)/u/f[1];return o?(g=ceil(g,DECIMALS$1)-1,H=ceil(H,DECIMALS$1)-1):(g=floor(g,DECIMALS$1),H=floor(H,DECIMALS$1)),createOrUpdate(s,g,H,l)}getTileCoordForCoordAndZ(e,i,s){return this.getTileCoordForXYAndZ_(e[0],e[1],i,!1,s)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,i){const s=linearFindNearest(this.resolutions_,e,i||0);return clamp$1(s,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,i){return intersectsLinearRing(i,0,i.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const i=this.resolutions_.length,s=new Array(i);for(let o=this.minZoom;o<i;++o)s[o]=this.getTileRangeForExtentAndZ(e,o);this.fullTileRanges_=s}}class WMTSTileGrid extends TileGrid{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}function getForProjection(n){let e=n.getDefaultTileGrid();return e||(e=createForProjection(n),n.setDefaultTileGrid(e)),e}function wrapX(n,e,i){const s=e[0],o=n.getTileCoordCenter(e),l=extentFromProjection(i);if(!containsCoordinate(l,o)){const c=getWidth(l),u=Math.ceil((l[0]-o[0])/c);return o[0]+=c*u,n.getTileCoordForCoordAndZ(o,s)}return e}function createForExtent(n,e,i,s){s=s!==void 0?s:"top-left";const o=resolutionsFromExtent(n,e,i);return new TileGrid({extent:n,origin:getCorner(n,s),resolutions:o,tileSize:i})}function createXYZ(n){const e=n||{},i=e.extent||get$3("EPSG:3857").getExtent(),s={extent:i,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:resolutionsFromExtent(i,e.maxZoom,e.tileSize,e.maxResolution)};return new TileGrid(s)}function resolutionsFromExtent(n,e,i,s){e=e!==void 0?e:DEFAULT_MAX_ZOOM,i=toSize(i!==void 0?i:DEFAULT_TILE_SIZE);const o=getHeight(n),l=getWidth(n);s=s>0?s:Math.max(l/i[0],o/i[1]);const c=e+1,u=new Array(c);for(let f=0;f<c;++f)u[f]=s/Math.pow(2,f);return u}function createForProjection(n,e,i,s){const o=extentFromProjection(n);return createForExtent(o,e,i,s)}function extentFromProjection(n){n=get$3(n);let e=n.getExtent();if(!e){const i=180*METERS_PER_UNIT$1.degrees/n.getMetersPerUnit();e=createOrUpdate$2(-i,-i,i,i)}return e}function appendParams(n,e){const i=[];Object.keys(e).forEach(function(o){e[o]!==null&&e[o]!==void 0&&i.push(o+"="+encodeURIComponent(e[o]))});const s=i.join("&");return n=n.replace(/[?&]$/,""),n+=n.includes("?")?"&":"?",n+s}const zRegEx=/\{z\}/g,xRegEx=/\{x\}/g,yRegEx=/\{y\}/g,dashYRegEx=/\{-y\}/g;function renderXYZTemplate(n,e,i,s,o){return n.replace(zRegEx,e.toString()).replace(xRegEx,i.toString()).replace(yRegEx,s.toString()).replace(dashYRegEx,function(){if(o===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(o-s).toString()})}function expandUrl(n){const e=[];let i=/\{([a-z])-([a-z])\}/.exec(n);if(i){const s=i[1].charCodeAt(0),o=i[2].charCodeAt(0);let l;for(l=s;l<=o;++l)e.push(n.replace(i[0],String.fromCharCode(l)));return e}if(i=/\{(\d+)-(\d+)\}/.exec(n),i){const s=parseInt(i[2],10);for(let o=parseInt(i[1],10);o<=s;o++)e.push(n.replace(i[0],o.toString()));return e}return e.push(n),e}function createFromTemplate(n,e){return(function(i,s,o){if(!i)return;let l;const c=i[0];if(e){const u=e.getFullTileRange(c);u&&(l=u.getHeight()-1)}return renderXYZTemplate(n,c,i[1],i[2],l)})}function createFromTemplates(n,e){const i=n.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=createFromTemplate(n[o],e);return createFromTileUrlFunctions(s)}function createFromTileUrlFunctions(n){return n.length===1?n[0]:(function(e,i,s){if(!e)return;const o=hash(e),l=modulo(o,n.length);return n[l](e,i,s)})}class Source extends BaseObject{constructor(e){super(),this.projection=get$3(e.projection),this.attributions_=adaptAttributions(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible??!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const i=this;this.viewPromise_=new Promise(function(s,o){i.viewResolver=s,i.viewRejector=o})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=adaptAttributions(e),this.changed()}setState(e){this.state_=e,this.changed()}}function adaptAttributions(n){return n?typeof n=="function"?n:(Array.isArray(n)||(n=[n]),e=>n):null}class TileSource extends Source{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const i=[256,256];this.tileGrid&&toSize(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),i),this.tmpSize=[0,0],this.key_=e.key||getUid(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){const i=e?this.getTileGridForProjection(e):this.tileGrid;return i?i.getResolutions():null}getTile(e,i,s,o,l){return abstract()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:getForProjection(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,i,s){const o=this.getTileGridForProjection(s),l=this.getTilePixelRatio(i),c=toSize(o.getTileSize(e),this.tmpSize);return l==1?c:scale$2(c,l,this.tmpSize)}getTileCoordForTileUrlFunction(e,i){const s=i!==void 0?i:this.getProjection(),o=i!==void 0?this.getTileGridForProjection(s):this.tileGrid||this.getTileGridForProjection(s);return this.getWrapX()&&s.isGlobal()&&(e=wrapX(o,e,s)),withinExtentAndZ(e,o)?e:null}clear(){}refresh(){this.clear(),super.refresh()}}class TileSourceEvent extends BaseEvent{constructor(e,i){super(e),this.tile=i}}const TileEventType={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class UrlTile extends TileSource{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===UrlTile.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const i=e.target,s=getUid(i),o=i.getState();let l;o==TileState.LOADING?(this.tileLoadingKeys_[s]=!0,l=TileEventType.TILELOADSTART):s in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[s],l=o==TileState.ERROR?TileEventType.TILELOADERROR:o==TileState.LOADED?TileEventType.TILELOADEND:void 0),l!=null&&this.dispatchEvent(new TileSourceEvent(l,i))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,i){this.tileUrlFunction=e,typeof i<"u"?this.setKey(i):this.changed()}setUrl(e){const i=expandUrl(e);this.urls=i,this.setUrls(i)}setUrls(e){this.urls=e;const i=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(createFromTemplates(e,this.tileGrid),i):this.setKey(i)}tileUrlFunction(e,i,s){}}class VectorTile extends UrlTile{constructor(e){const i=e.projection||"EPSG:3857",s=e.extent||extentFromProjection(i),o=e.tileGrid||createXYZ({extent:s,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,projection:i,state:e.state,tileGrid:o,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:defaultLoadFunction,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.tileKeysBySourceTileUrl_={},this.sourceTiles_={},this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:VectorTile$1,this.tileGrids_={}}getOverlaps(){return this.overlaps_}getSourceTiles(e,i,s){if(s.getState()===TileState.IDLE){s.setState(TileState.LOADING);const o=s.wrappedTileCoord,l=this.getTileGridForProjection(i),c=l.getTileCoordExtent(o),u=o[0],f=l.getResolution(u);buffer(c,-f,c);const g=this.tileGrid,H=g.getExtent();H&&getIntersection(c,H,c);const Y=g.getZForResolution(f,this.zDirection);g.forEachTileCoord(c,Y,ee=>{const te=this.tileUrlFunction(ee,e,i);this.sourceTiles_[te]||(this.sourceTiles_[te]=new this.tileClass(ee,te?TileState.IDLE:TileState.EMPTY,te,this.format_,this.tileLoadFunction));const ne=this.sourceTiles_[te];s.sourceTiles.push(ne),this.tileKeysBySourceTileUrl_[te]||(this.tileKeysBySourceTileUrl_[te]=[]),this.tileKeysBySourceTileUrl_[te].push(s.getKey());const Ye=ne.getState();if(Ye<TileState.LOADED){const xe=tt=>{this.handleTileChange(tt);const et=ne.getState();if(et===TileState.LOADED||et===TileState.ERROR){const it=ne.getKey();it in s.errorTileKeys?ne.getState()===TileState.LOADED&&delete s.errorTileKeys[it]:s.loadingSourceTiles--,et===TileState.ERROR?s.errorTileKeys[it]=!0:ne.removeEventListener(EventType$1.CHANGE,xe),s.loadingSourceTiles===0&&s.setState(isEmpty$1(s.errorTileKeys)?TileState.LOADED:TileState.ERROR)}};ne.addEventListener(EventType$1.CHANGE,xe),s.loadingSourceTiles++}Ye===TileState.IDLE&&(ne.extent=g.getTileCoordExtent(ee),ne.projection=i,ne.resolution=g.getResolution(ee[0]),ne.load())}),s.loadingSourceTiles||s.setState(s.sourceTiles.some(ee=>ee.getState()===TileState.ERROR)?TileState.ERROR:TileState.LOADED)}return s.sourceTiles}removeSourceTiles(e){const i=e.getKey(),s=e.sourceTiles;for(let o=0,l=s.length;o<l;++o){const c=s[o].getTileUrl();if(!this.tileKeysBySourceTileUrl_[c])return;const u=this.tileKeysBySourceTileUrl_[c].indexOf(i);u!==-1&&(this.tileKeysBySourceTileUrl_[c].splice(u,1),this.tileKeysBySourceTileUrl_[c].length===0&&(delete this.tileKeysBySourceTileUrl_[c],delete this.sourceTiles_[c]))}}getTile(e,i,s,o,l){const c=[e,i,s];let u=this.getTileCoordForTileUrlFunction(c,l);const f=this.getTileGrid().getExtent(),g=this.getTileGridForProjection(l);if(u&&f){const ee=g.getTileCoordExtent(u);buffer(ee,-g.getResolution(e),ee),intersects$1(f,ee)||(u=null)}let H=!0;if(u!==null){const ee=this.tileGrid,te=g.getResolution(e),ne=ee.getZForResolution(te,1),Ye=g.getTileCoordExtent(u);buffer(Ye,-te,Ye),ee.forEachTileCoord(Ye,ne,xe=>{H=H&&!this.tileUrlFunction(xe,o,l)})}const Y=new VectorRenderTile(c,H?TileState.EMPTY:TileState.IDLE,u,this.getSourceTiles.bind(this,o,l),this.removeSourceTiles.bind(this));return Y.key=this.getKey(),Y}getTileGridForProjection(e){const i=e.getCode();let s=this.tileGrids_[i];if(!s){const o=this.getProjection();assert(o===null||equivalent$1(o,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection.");const l=this.tileGrid,c=l.getResolutions().slice(),u=c.map(function(H,Y){return l.getOrigin(Y)}),f=c.map(function(H,Y){return l.getTileSize(Y)}),g=DEFAULT_MAX_ZOOM+1;for(let H=c.length;H<g;++H)c.push(c[H-1]/2),u.push(u[H-1]),f.push(f[H-1]);s=new TileGrid({extent:l.getExtent(),origins:u,resolutions:c,tileSizes:f}),this.tileGrids_[i]=s}return s}getTilePixelRatio(e){return e}getTilePixelSize(e,i,s){const o=this.getTileGridForProjection(s),l=toSize(o.getTileSize(e),this.tmpSize);return[Math.round(l[0]*i),Math.round(l[1]*i)]}setOverlaps(e){this.overlaps_=e,this.changed()}}function defaultLoadFunction(n,e){n.setLoader(function(i,s,o){loadFeaturesXhr(e,n.getFormat(),i,s,o,n.onLoad.bind(n),n.onError.bind(n))})}const CollectionEventType={ADD:"add",REMOVE:"remove"},Property$2={LENGTH:"length"};class CollectionEvent extends BaseEvent{constructor(e,i,s){super(e),this.element=i,this.index=s}}class Collection extends BaseObject{constructor(e,i){if(super(),this.on,this.once,this.un,i=i||{},this.unique_=!!i.unique,this.array_=e||[],this.unique_)for(let s=0,o=this.array_.length;s<o;++s)this.assertUnique_(this.array_[s],s);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let i=0,s=e.length;i<s;++i)this.push(e[i]);return this}forEach(e){const i=this.array_;for(let s=0,o=i.length;s<o;++s)e(i[s],s,i)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(Property$2.LENGTH)}insertAt(e,i){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(i),this.array_.splice(e,0,i),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,i,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const i=this.getLength();return this.insertAt(i,e),this.getLength()}remove(e){const i=this.array_;for(let s=0,o=i.length;s<o;++s)if(i[s]===e)return this.removeAt(s)}removeAt(e){if(e<0||e>=this.getLength())return;const i=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,i,e)),i}setAt(e,i){const s=this.getLength();if(e>=s){this.insertAt(e,i);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(i,e);const o=this.array_[e];this.array_[e]=i,this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,o,e)),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,i,e))}updateLength_(){this.set(Property$2.LENGTH,this.array_.length)}assertUnique_(e,i){for(let s=0,o=this.array_.length;s<o;++s)if(this.array_[s]===e&&s!==i)throw new Error("Duplicate item added to a unique collection")}}function all$1(n,e){return[[-1/0,-1/0,1/0,1/0]]}function bbox(n,e){return[n]}function tile(n){return(function(e,i,s){const o=n.getZForResolution(fromUserResolution(i)),l=n.getTileRangeForExtentAndZ(fromUserExtent(e),o),c=[],u=[o,0,0];for(u[1]=l.minX;u[1]<=l.maxX;++u[1])for(u[2]=l.minY;u[2]<=l.maxY;++u[2])c.push(toUserExtent(n.getTileCoordExtent(u)));return c})}class Feature extends BaseObject{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const i=e;this.setGeometry(i)}else{const i=e;this.setProperties(i)}}clone(){const e=new Feature(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const i=this.getGeometry();i&&e.setGeometry(i.clone());const s=this.getStyle();return s&&e.setStyle(s),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(unlistenByKey(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=listen(e,EventType$1.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?createStyleFunction(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function createStyleFunction(n){if(typeof n=="function")return n;let e;return Array.isArray(n)?e=n:(assert(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[n]),function(){return e}}function linearRingss$1(n,e,i,s){const o=[];let l=createEmpty();for(let c=0,u=i.length;c<u;++c){const f=i[c];l=createOrUpdateFromFlatCoordinates(n,e,f[0],s),o.push((l[0]+l[2])/2,(l[1]+l[3])/2),e=f[f.length-1]}return o}function getInteriorPointOfArray(n,e,i,s,o,l,c){let u,f,g,H,Y,ee,te;const ne=o[l+1],Ye=[];for(let et=0,it=i.length;et<it;++et){const rt=i[et];for(H=n[rt-s],ee=n[rt-s+1],u=e;u<rt;u+=s)Y=n[u],te=n[u+1],(ne<=ee&&te<=ne||ee<=ne&&ne<=te)&&(g=(ne-ee)/(te-ee)*(Y-H)+H,Ye.push(g)),H=Y,ee=te}let xe=NaN,tt=-1/0;for(Ye.sort(ascending),H=Ye[0],u=1,f=Ye.length;u<f;++u){Y=Ye[u];const et=Math.abs(Y-H);et>tt&&(g=(H+Y)/2,linearRingsContainsXY(n,e,i,s,g,ne)&&(xe=g,tt=et)),H=Y}return isNaN(xe)&&(xe=o[l]),c?(c.push(xe,ne,tt),c):[xe,ne,tt]}function getInteriorPointsOfMultiArray(n,e,i,s,o){let l=[];for(let c=0,u=i.length;c<u;++c){const f=i[c];l=getInteriorPointOfArray(n,e,f,s,o,2*c,l),e=f[f.length-1]}return l}function interpolatePoint(n,e,i,s,o,l,c){let u,f;const g=(i-e)/s;if(g===1)u=e;else if(g===2)u=e,f=o;else if(g!==0){let H=n[e],Y=n[e+1],ee=0;const te=[0];for(let xe=e+s;xe<i;xe+=s){const tt=n[xe],et=n[xe+1];ee+=Math.sqrt((tt-H)*(tt-H)+(et-Y)*(et-Y)),te.push(ee),H=tt,Y=et}const ne=o*ee,Ye=binarySearch$1(te,ne);Ye<0?(f=(ne-te[-Ye-2])/(te[-Ye-1]-te[-Ye-2]),u=e+(-Ye-2)*s):u=e+Ye*s}c=c>1?c:2,l=l||new Array(c);for(let H=0;H<c;++H)l[H]=u===void 0?NaN:f===void 0?n[u+H]:lerp(n[u+H],n[u+s+H],f);return l}function lineStringCoordinateAtM(n,e,i,s,o,l){if(i==e)return null;let c;if(o<n[e+s-1])return l?(c=n.slice(e,e+s),c[s-1]=o,c):null;if(n[i-1]<o)return l?(c=n.slice(i-s,i),c[s-1]=o,c):null;if(o==n[e+s-1])return n.slice(e,e+s);let u=e/s,f=i/s;for(;u<f;){const ee=u+f>>1;o<n[(ee+1)*s-1]?f=ee:u=ee+1}const g=n[u*s-1];if(o==g)return n.slice((u-1)*s,(u-1)*s+s);const H=n[(u+1)*s-1],Y=(o-g)/(H-g);c=[];for(let ee=0;ee<s-1;++ee)c.push(lerp(n[(u-1)*s+ee],n[u*s+ee],Y));return c.push(o),c}function lineStringsCoordinateAtM(n,e,i,s,o,l,c){if(c)return lineStringCoordinateAtM(n,e,i[i.length-1],s,o,l);let u;if(o<n[s-1])return l?(u=n.slice(0,s),u[s-1]=o,u):null;if(n[n.length-1]<o)return l?(u=n.slice(n.length-s),u[s-1]=o,u):null;for(let f=0,g=i.length;f<g;++f){const H=i[f];if(e!=H){if(o<n[e+s-1])return null;if(o<=n[H-1])return lineStringCoordinateAtM(n,e,H,s,o,!1);e=H}}return null}function coordinates(n,e,i,s){for(;e<i-s;){for(let o=0;o<s;++o){const l=n[e+o];n[e+o]=n[i-s+o],n[i-s+o]=l}e+=s,i-=s}}function linearRingIsClockwise(n,e,i,s){let o=0,l=n[i-s],c=n[i-s+1];for(;e<i;e+=s){const u=n[e],f=n[e+1];o+=(u-l)*(f+c),l=u,c=f}return o===0?void 0:o>0}function linearRingsAreOriented(n,e,i,s,o){o=o!==void 0?o:!1;for(let l=0,c=i.length;l<c;++l){const u=i[l],f=linearRingIsClockwise(n,e,u,s);if(l===0){if(o&&f||!o&&!f)return!1}else if(o&&!f||!o&&f)return!1;e=u}return!0}function linearRingssAreOriented(n,e,i,s,o){for(let l=0,c=i.length;l<c;++l){const u=i[l];if(!linearRingsAreOriented(n,e,u,s,o))return!1;u.length&&(e=u[u.length-1])}return!0}function orientLinearRings(n,e,i,s,o){o=o!==void 0?o:!1;for(let l=0,c=i.length;l<c;++l){const u=i[l],f=linearRingIsClockwise(n,e,u,s);(l===0?o&&f||!o&&!f:o&&!f||!o&&f)&&coordinates(n,e,u,s),e=u}return e}function orientLinearRingsArray(n,e,i,s,o){for(let l=0,c=i.length;l<c;++l)e=orientLinearRings(n,e,i[l],s,o);return e}function inflateEnds(n,e){const i=[];let s=0,o=0,l;for(let c=0,u=e.length;c<u;++c){const f=e[c],g=linearRingIsClockwise(n,s,f,2);if(l===void 0&&(l=g),g===l)i.push(e.slice(o,c+1));else{if(i.length===0)continue;i[i.length-1].push(e[o])}o=c+1,s=f}return i}function douglasPeucker(n,e,i,s,o,l,c){const u=(i-e)/s;if(u<3){for(;e<i;e+=s)l[c++]=n[e],l[c++]=n[e+1];return c}const f=new Array(u);f[0]=1,f[u-1]=1;const g=[e,i-s];let H=0;for(;g.length>0;){const Y=g.pop(),ee=g.pop();let te=0;const ne=n[ee],Ye=n[ee+1],xe=n[Y],tt=n[Y+1];for(let et=ee+s;et<Y;et+=s){const it=n[et],rt=n[et+1],nt=squaredSegmentDistance(it,rt,ne,Ye,xe,tt);nt>te&&(H=et,te=nt)}te>o&&(f[(H-e)/s]=1,ee+s<H&&g.push(ee,H),H+s<Y&&g.push(H,Y))}for(let Y=0;Y<u;++Y)f[Y]&&(l[c++]=n[e+Y*s],l[c++]=n[e+Y*s+1]);return c}function douglasPeuckerArray(n,e,i,s,o,l,c,u){for(let f=0,g=i.length;f<g;++f){const H=i[f];c=douglasPeucker(n,e,H,s,o,l,c),u.push(c),e=H}return c}function snap(n,e){return e*Math.round(n/e)}function quantize(n,e,i,s,o,l,c){if(e==i)return c;let u=snap(n[e],o),f=snap(n[e+1],o);e+=s,l[c++]=u,l[c++]=f;let g,H;do if(g=snap(n[e],o),H=snap(n[e+1],o),e+=s,e==i)return l[c++]=g,l[c++]=H,c;while(g==u&&H==f);for(;e<i;){const Y=snap(n[e],o),ee=snap(n[e+1],o);if(e+=s,Y==g&&ee==H)continue;const te=g-u,ne=H-f,Ye=Y-u,xe=ee-f;if(te*xe==ne*Ye&&(te<0&&Ye<te||te==Ye||te>0&&Ye>te)&&(ne<0&&xe<ne||ne==xe||ne>0&&xe>ne)){g=Y,H=ee;continue}l[c++]=g,l[c++]=H,u=g,f=H,g=Y,H=ee}return l[c++]=g,l[c++]=H,c}function quantizeArray(n,e,i,s,o,l,c,u){for(let f=0,g=i.length;f<g;++f){const H=i[f];c=quantize(n,e,H,s,o,l,c),u.push(c),e=H}return c}function quantizeMultiArray(n,e,i,s,o,l,c,u){for(let f=0,g=i.length;f<g;++f){const H=i[f],Y=[];c=quantizeArray(n,e,H,s,o,l,c,Y),u.push(Y),e=H[H.length-1]}return c}function transform2D(n,e,i,s,o,l,c){l=l||[],c=c||2;let u=0;for(let f=e;f<i;f+=s){const g=n[f],H=n[f+1];l[u++]=o[0]*g+o[2]*H+o[4],l[u++]=o[1]*g+o[3]*H+o[5];for(let Y=2;Y<c;Y++)l[u++]=n[f+Y]}return l&&l.length!=u&&(l.length=u),l}function rotate(n,e,i,s,o,l,c){c=c||[];const u=Math.cos(o),f=Math.sin(o),g=l[0],H=l[1];let Y=0;for(let ee=e;ee<i;ee+=s){const te=n[ee]-g,ne=n[ee+1]-H;c[Y++]=g+te*u-ne*f,c[Y++]=H+te*f+ne*u;for(let Ye=ee+2;Ye<ee+s;++Ye)c[Y++]=n[Ye]}return c&&c.length!=Y&&(c.length=Y),c}function scale$1(n,e,i,s,o,l,c,u){u=u||[];const f=c[0],g=c[1];let H=0;for(let Y=e;Y<i;Y+=s){const ee=n[Y]-f,te=n[Y+1]-g;u[H++]=f+o*ee,u[H++]=g+l*te;for(let ne=Y+2;ne<Y+s;++ne)u[H++]=n[ne]}return u&&u.length!=H&&(u.length=H),u}function translate$1(n,e,i,s,o,l,c){c=c||[];let u=0;for(let f=e;f<i;f+=s){c[u++]=n[f]+o,c[u++]=n[f+1]+l;for(let g=f+2;g<f+s;++g)c[u++]=n[g]}return c&&c.length!=u&&(c.length=u),c}const tmp_=new Array(6);function create(){return[1,0,0,1,0,0]}function reset(n){return set(n,1,0,0,1,0,0)}function multiply(n,e){const i=n[0],s=n[1],o=n[2],l=n[3],c=n[4],u=n[5],f=e[0],g=e[1],H=e[2],Y=e[3],ee=e[4],te=e[5];return n[0]=i*f+o*g,n[1]=s*f+l*g,n[2]=i*H+o*Y,n[3]=s*H+l*Y,n[4]=i*ee+o*te+c,n[5]=s*ee+l*te+u,n}function set(n,e,i,s,o,l,c){return n[0]=e,n[1]=i,n[2]=s,n[3]=o,n[4]=l,n[5]=c,n}function setFromArray(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n}function apply(n,e){const i=e[0],s=e[1];return e[0]=n[0]*i+n[2]*s+n[4],e[1]=n[1]*i+n[3]*s+n[5],e}function scale(n,e,i){return multiply(n,set(tmp_,e,0,0,i,0,0))}function translate(n,e,i){return multiply(n,set(tmp_,1,0,0,1,e,i))}function compose(n,e,i,s,o,l,c,u){const f=Math.sin(l),g=Math.cos(l);return n[0]=s*g,n[1]=o*f,n[2]=-s*f,n[3]=o*g,n[4]=c*s*g-u*s*f+e,n[5]=c*o*f+u*o*g+i,n}function makeInverse(n,e){const i=determinant(e);assert(i!==0,"Transformation matrix cannot be inverted");const s=e[0],o=e[1],l=e[2],c=e[3],u=e[4],f=e[5];return n[0]=c/i,n[1]=-o/i,n[2]=-l/i,n[3]=s/i,n[4]=(l*f-c*u)/i,n[5]=-(s*f-o*u)/i,n}function determinant(n){return n[0]*n[3]-n[1]*n[2]}const matrixPrecision=[1e5,1e5,1e5,1e5,2,2];function toString$1(n){return"matrix("+n.join(", ")+")"}function fromString$1(n){return n.substring(7,n.length-1).split(",").map(parseFloat)}function equivalent(n,e){const i=fromString$1(n),s=fromString$1(e);for(let o=0;o<6;++o)if(Math.round((i[o]-s[o])*matrixPrecision[o])!==0)return!1;return!0}const tmpTransform$1=create(),tmpPoint=[NaN,NaN];class Geometry extends BaseObject{constructor(){super(),this.extent_=createEmpty(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=memoizeOne((e,i,s)=>{if(!s)return this.getSimplifiedGeometry(i);const o=this.clone();return o.applyTransform(s),o.getSimplifiedGeometry(i)})}simplifyTransformed(e,i){return this.simplifyTransformedInternal(this.getRevision(),e,i)}clone(){return abstract()}closestPointXY(e,i,s,o){return abstract()}containsXY(e,i){return this.closestPointXY(e,i,tmpPoint,Number.MIN_VALUE)===0}getClosestPoint(e,i){return i=i||[NaN,NaN],this.closestPointXY(e[0],e[1],i,1/0),i}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return abstract()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const i=this.computeExtent(this.extent_);(isNaN(i[0])||isNaN(i[1]))&&createOrUpdateEmpty(i),this.extentRevision_=this.getRevision()}return returnOrUpdate(this.extent_,e)}rotate(e,i){abstract()}scale(e,i,s){abstract()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return abstract()}getType(){return abstract()}applyTransform(e){abstract()}intersectsExtent(e){return abstract()}translate(e,i){abstract()}transform(e,i){const s=get$3(e),o=s.getUnits()=="tile-pixels"?function(l,c,u){const f=s.getExtent(),g=s.getWorldExtent(),H=getHeight(g)/getHeight(f);compose(tmpTransform$1,g[0],g[3],H,-H,0,0,0);const Y=transform2D(l,0,l.length,u,tmpTransform$1,c),ee=getTransform(s,i);return ee?ee(Y,Y,u):Y}:getTransform(s,i);return this.applyTransform(o),this}}class SimpleGeometry extends Geometry{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return createOrUpdateFromFlatCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return abstract()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const i=this.getSimplifiedGeometryInternal(e);return i.getFlatCoordinates().length<this.flatCoordinates.length?i:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,i){this.stride=getStrideForLayout(e),this.layout=e,this.flatCoordinates=i}setCoordinates(e,i){abstract()}setLayout(e,i,s){let o;if(e)o=getStrideForLayout(e);else{for(let l=0;l<s;++l){if(i.length===0){this.layout="XY",this.stride=2;return}i=i[0]}o=i.length,e=getLayoutForStride(o)}this.layout=e,this.stride=o}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(e,i){const s=this.getFlatCoordinates();if(s){const o=this.getStride();rotate(s,0,s.length,o,e,i,s),this.changed()}}scale(e,i,s){i===void 0&&(i=e),s||(s=getCenter(this.getExtent()));const o=this.getFlatCoordinates();if(o){const l=this.getStride();scale$1(o,0,o.length,l,e,i,s,o),this.changed()}}translate(e,i){const s=this.getFlatCoordinates();if(s){const o=this.getStride();translate$1(s,0,s.length,o,e,i,s),this.changed()}}}function getLayoutForStride(n){let e;return n==2?e="XY":n==3?e="XYZ":n==4&&(e="XYZM"),e}function getStrideForLayout(n){let e;return n=="XY"?e=2:n=="XYZ"||n=="XYM"?e=3:n=="XYZM"&&(e=4),e}function transformGeom2D(n,e,i){const s=n.getFlatCoordinates();if(!s)return null;const o=n.getStride();return transform2D(s,0,s.length,o,e,i)}function deflateCoordinate(n,e,i,s){for(let o=0,l=i.length;o<l;++o)n[e++]=i[o];return e}function deflateCoordinates(n,e,i,s){for(let o=0,l=i.length;o<l;++o){const c=i[o];for(let u=0;u<s;++u)n[e++]=c[u]}return e}function deflateCoordinatesArray(n,e,i,s,o){o=o||[];let l=0;for(let c=0,u=i.length;c<u;++c){const f=deflateCoordinates(n,e,i[c],s);o[l++]=f,e=f}return o.length=l,o}function deflateMultiCoordinatesArray(n,e,i,s,o){o=o||[];let l=0;for(let c=0,u=i.length;c<u;++c){const f=deflateCoordinatesArray(n,e,i[c],s,o[l]);f.length===0&&(f[0]=e),o[l++]=f,e=f[f.length-1]}return o.length=l,o}class Circle extends SimpleGeometry{constructor(e,i,s){super(),s!==void 0&&i===void 0?this.setFlatCoordinates(s,e):(i=i||0,this.setCenterAndRadius(e,i,s))}clone(){const e=new Circle(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,i,s,o){const l=this.flatCoordinates,c=e-l[0],u=i-l[1],f=c*c+u*u;if(f<o){if(f===0)for(let g=0;g<this.stride;++g)s[g]=l[g];else{const g=this.getRadius()/Math.sqrt(f);s[0]=l[0]+g*c,s[1]=l[1]+g*u;for(let H=2;H<this.stride;++H)s[H]=l[H]}return s.length=this.stride,f}return o}containsXY(e,i){const s=this.flatCoordinates,o=e-s[0],l=i-s[1];return o*o+l*l<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const i=this.flatCoordinates,s=i[this.stride]-i[0];return createOrUpdate$2(i[0]-s,i[1]-s,i[0]+s,i[1]+s,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],i=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+i*i}getType(){return"Circle"}intersectsExtent(e){const i=this.getExtent();if(intersects$1(e,i)){const s=this.getCenter();return e[0]<=s[0]&&e[2]>=s[0]||e[1]<=s[1]&&e[3]>=s[1]?!0:forEachCorner(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const i=this.stride,s=this.flatCoordinates[i]-this.flatCoordinates[0],o=e.slice();o[i]=o[0]+s;for(let l=1;l<i;++l)o[i+l]=e[l];this.setFlatCoordinates(this.layout,o),this.changed()}setCenterAndRadius(e,i,s){this.setLayout(s,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const o=this.flatCoordinates;let l=deflateCoordinate(o,0,e,this.stride);o[l++]=o[0]+i;for(let c=1,u=this.stride;c<u;++c)o[l++]=o[c];o.length=l,this.changed()}getCoordinates(){return null}setCoordinates(e,i){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,i){const s=this.getCenter(),o=this.getStride();this.setCenter(rotate(s,0,s.length,o,e,i,s)),this.changed()}}Circle.prototype.transform;class GeometryCollection extends Geometry{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(unlistenByKey),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)this.changeEventsKeys_.push(listen(e[i],EventType$1.CHANGE,this.changed,this))}clone(){const e=new GeometryCollection(cloneGeometries(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,i,s,o){if(o<closestSquaredDistanceXY(this.getExtent(),e,i))return o;const l=this.geometries_;for(let c=0,u=l.length;c<u;++c)o=l[c].closestPointXY(e,i,s,o);return o}containsXY(e,i){const s=this.geometries_;for(let o=0,l=s.length;o<l;++o)if(s[o].containsXY(e,i))return!0;return!1}computeExtent(e){createOrUpdateEmpty(e);const i=this.geometries_;for(let s=0,o=i.length;s<o;++s)extend$3(e,i[s].getExtent());return e}getGeometries(){return cloneGeometries(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const i=this.geometries_;for(let s=0,o=i.length;s<o;++s)i[s].getType()===this.getType()?e=e.concat(i[s].getGeometriesArrayRecursive()):e.push(i[s]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const i=[],s=this.geometries_;let o=!1;for(let l=0,c=s.length;l<c;++l){const u=s[l],f=u.getSimplifiedGeometry(e);i.push(f),f!==u&&(o=!0)}return o?new GeometryCollection(i):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){const i=this.geometries_;for(let s=0,o=i.length;s<o;++s)if(i[s].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,i){const s=this.geometries_;for(let o=0,l=s.length;o<l;++o)s[o].rotate(e,i);this.changed()}scale(e,i,s){s||(s=getCenter(this.getExtent()));const o=this.geometries_;for(let l=0,c=o.length;l<c;++l)o[l].scale(e,i,s);this.changed()}setGeometries(e){this.setGeometriesArray(cloneGeometries(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const i=this.geometries_;for(let s=0,o=i.length;s<o;++s)i[s].applyTransform(e);this.changed()}translate(e,i){const s=this.geometries_;for(let o=0,l=s.length;o<l;++o)s[o].translate(e,i);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function cloneGeometries(n){return n.map(e=>e.clone())}function linearRing(n,e,i,s){let o=0;const l=n[i-s],c=n[i-s+1];let u=0,f=0;for(;e<i;e+=s){const g=n[e]-l,H=n[e+1]-c;o+=f*g-u*H,u=g,f=H}return o/2}function linearRings(n,e,i,s){let o=0;for(let l=0,c=i.length;l<c;++l){const u=i[l];o+=linearRing(n,e,u,s),e=u}return o}function linearRingss(n,e,i,s){let o=0;for(let l=0,c=i.length;l<c;++l){const u=i[l];o+=linearRings(n,e,u,s),e=u[u.length-1]}return o}function assignClosest(n,e,i,s,o,l,c){const u=n[e],f=n[e+1],g=n[i]-u,H=n[i+1]-f;let Y;if(g===0&&H===0)Y=e;else{const ee=((o-u)*g+(l-f)*H)/(g*g+H*H);if(ee>1)Y=i;else if(ee>0){for(let te=0;te<s;++te)c[te]=lerp(n[e+te],n[i+te],ee);c.length=s;return}else Y=e}for(let ee=0;ee<s;++ee)c[ee]=n[Y+ee];c.length=s}function maxSquaredDelta(n,e,i,s,o){let l=n[e],c=n[e+1];for(e+=s;e<i;e+=s){const u=n[e],f=n[e+1],g=squaredDistance$1(l,c,u,f);g>o&&(o=g),l=u,c=f}return o}function arrayMaxSquaredDelta(n,e,i,s,o){for(let l=0,c=i.length;l<c;++l){const u=i[l];o=maxSquaredDelta(n,e,u,s,o),e=u}return o}function multiArrayMaxSquaredDelta(n,e,i,s,o){for(let l=0,c=i.length;l<c;++l){const u=i[l];o=arrayMaxSquaredDelta(n,e,u,s,o),e=u[u.length-1]}return o}function assignClosestPoint(n,e,i,s,o,l,c,u,f,g,H){if(e==i)return g;let Y,ee;if(o===0){if(ee=squaredDistance$1(c,u,n[e],n[e+1]),ee<g){for(Y=0;Y<s;++Y)f[Y]=n[e+Y];return f.length=s,ee}return g}H=H||[NaN,NaN];let te=e+s;for(;te<i;)if(assignClosest(n,te-s,te,s,c,u,H),ee=squaredDistance$1(c,u,H[0],H[1]),ee<g){for(g=ee,Y=0;Y<s;++Y)f[Y]=H[Y];f.length=s,te+=s}else te+=s*Math.max((Math.sqrt(ee)-Math.sqrt(g))/o|0,1);if(l&&(assignClosest(n,i-s,e,s,c,u,H),ee=squaredDistance$1(c,u,H[0],H[1]),ee<g)){for(g=ee,Y=0;Y<s;++Y)f[Y]=H[Y];f.length=s}return g}function assignClosestArrayPoint(n,e,i,s,o,l,c,u,f,g,H){H=H||[NaN,NaN];for(let Y=0,ee=i.length;Y<ee;++Y){const te=i[Y];g=assignClosestPoint(n,e,te,s,o,l,c,u,f,g,H),e=te}return g}function assignClosestMultiArrayPoint(n,e,i,s,o,l,c,u,f,g,H){H=H||[NaN,NaN];for(let Y=0,ee=i.length;Y<ee;++Y){const te=i[Y];g=assignClosestArrayPoint(n,e,te,s,o,l,c,u,f,g,H),e=te[te.length-1]}return g}function inflateCoordinates(n,e,i,s,o){o=o!==void 0?o:[];let l=0;for(let c=e;c<i;c+=s)o[l++]=n.slice(c,c+s);return o.length=l,o}function inflateCoordinatesArray(n,e,i,s,o){o=o!==void 0?o:[];let l=0;for(let c=0,u=i.length;c<u;++c){const f=i[c];o[l++]=inflateCoordinates(n,e,f,s,o[l]),e=f}return o.length=l,o}function inflateMultiCoordinatesArray(n,e,i,s,o){o=o!==void 0?o:[];let l=0;for(let c=0,u=i.length;c<u;++c){const f=i[c];o[l++]=f.length===1&&f[0]===e?[]:inflateCoordinatesArray(n,e,f,s,o[l]),e=f[f.length-1]}return o.length=l,o}class LinearRing extends SimpleGeometry{constructor(e,i){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,i!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(i,e):this.setCoordinates(e,i)}clone(){return new LinearRing(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,i,s,o){return o<closestSquaredDistanceXY(this.getExtent(),e,i)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,i,s,o))}getArea(){return linearRing(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const i=[];return i.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,i,0),new LinearRing(i,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,i){this.setLayout(i,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,e,this.stride),this.changed()}}function lineStringLength(n,e,i,s){let o=n[e],l=n[e+1],c=0;for(let u=e+s;u<i;u+=s){const f=n[u],g=n[u+1];c+=Math.sqrt((f-o)*(f-o)+(g-l)*(g-l)),o=f,l=g}return c}class LineString extends SimpleGeometry{constructor(e,i){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,i!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(i,e):this.setCoordinates(e,i)}appendCoordinate(e){extend$4(this.flatCoordinates,e),this.changed()}clone(){const e=new LineString(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,i,s,o){return o<closestSquaredDistanceXY(this.getExtent(),e,i)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,i,s,o))}forEachSegment(e){return forEach(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,i){return this.layout!="XYM"&&this.layout!="XYZM"?null:(i=i!==void 0?i:!1,lineStringCoordinateAtM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,i))}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,i){return interpolatePoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,i,this.stride)}getLength(){return lineStringLength(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const i=[];return i.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,i,0),new LineString(i,"XY")}getType(){return"LineString"}intersectsExtent(e){return intersectsLineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,this.getExtent())}setCoordinates(e,i){this.setLayout(i,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,e,this.stride),this.changed()}}class MultiLineString extends SimpleGeometry{constructor(e,i,s){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,i);else if(i!==void 0&&s)this.setFlatCoordinates(i,e),this.ends_=s;else{const o=e,l=[],c=[];for(let f=0,g=o.length;f<g;++f){const H=o[f];extend$4(l,H.getFlatCoordinates()),c.push(l.length)}const u=o.length===0?this.getLayout():o[0].getLayout();this.setFlatCoordinates(u,l),this.ends_=c}}appendLineString(e){extend$4(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new MultiLineString(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,i,s,o){return o<closestSquaredDistanceXY(this.getExtent(),e,i)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,i,s,o))}getCoordinateAtM(e,i,s){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(i=i!==void 0?i:!1,s=s!==void 0?s:!1,lineStringsCoordinateAtM(this.flatCoordinates,0,this.ends_,this.stride,e,i,s))}getCoordinates(){return inflateCoordinatesArray(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new LineString(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,i=this.ends_,s=this.layout,o=[];let l=0;for(let c=0,u=i.length;c<u;++c){const f=i[c],g=new LineString(e.slice(l,f),s);o.push(g),l=f}return o}getLength(){const e=this.ends_;let i=0,s=0;for(let o=0,l=e.length;o<l;++o)s+=lineStringLength(this.flatCoordinates,i,e[o],this.stride),i=e[o];return s}getFlatMidpoints(){const e=[],i=this.flatCoordinates;let s=0;const o=this.ends_,l=this.stride;for(let c=0,u=o.length;c<u;++c){const f=o[c],g=interpolatePoint(i,s,f,l,.5);extend$4(e,g),s=f}return e}getSimplifiedGeometryInternal(e){const i=[],s=[];return i.length=douglasPeuckerArray(this.flatCoordinates,0,this.ends_,this.stride,e,i,0,s),new MultiLineString(i,"XY",s)}getType(){return"MultiLineString"}intersectsExtent(e){return intersectsLineStringArray(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,i){this.setLayout(i,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const s=deflateCoordinatesArray(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=s.length===0?0:s[s.length-1],this.changed()}}let Point$1=class Yi extends SimpleGeometry{constructor(e,i){super(),this.setCoordinates(e,i)}clone(){const e=new Yi(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,i,s,o){const l=this.flatCoordinates,c=squaredDistance$1(e,i,l[0],l[1]);if(c<o){const u=this.stride;for(let f=0;f<u;++f)s[f]=l[f];return s.length=u,c}return o}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return createOrUpdateFromCoordinate(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return containsXY(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinate(this.flatCoordinates,0,e,this.stride),this.changed()}};class MultiPoint extends SimpleGeometry{constructor(e,i){super(),i&&!Array.isArray(e[0])?this.setFlatCoordinates(i,e):this.setCoordinates(e,i)}appendPoint(e){extend$4(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){const e=new MultiPoint(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,i,s,o){if(o<closestSquaredDistanceXY(this.getExtent(),e,i))return o;const l=this.flatCoordinates,c=this.stride;for(let u=0,f=l.length;u<f;u+=c){const g=squaredDistance$1(e,i,l[u],l[u+1]);if(g<o){o=g;for(let H=0;H<c;++H)s[H]=l[u+H];s.length=c}}return o}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const i=this.flatCoordinates.length/this.stride;return e<0||i<=e?null:new Point$1(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,i=this.layout,s=this.stride,o=[];for(let l=0,c=e.length;l<c;l+=s){const u=new Point$1(e.slice(l,l+s),i);o.push(u)}return o}getType(){return"MultiPoint"}intersectsExtent(e){const i=this.flatCoordinates,s=this.stride;for(let o=0,l=i.length;o<l;o+=s){const c=i[o],u=i[o+1];if(containsXY(e,c,u))return!0}return!1}setCoordinates(e,i){this.setLayout(i,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,e,this.stride),this.changed()}}class Polygon extends SimpleGeometry{constructor(e,i,s){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,i!==void 0&&s?(this.setFlatCoordinates(i,e),this.ends_=s):this.setCoordinates(e,i)}appendLinearRing(e){this.flatCoordinates?extend$4(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Polygon(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,i,s,o){return o<closestSquaredDistanceXY(this.getExtent(),e,i)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,i,s,o))}containsXY(e,i){return linearRingsContainsXY(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,i)}getArea(){return linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let i;return e!==void 0?(i=this.getOrientedFlatCoordinates().slice(),orientLinearRings(i,0,this.ends_,this.stride,e)):i=this.flatCoordinates,inflateCoordinatesArray(i,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=getCenter(this.getExtent());this.flatInteriorPoint_=getInteriorPointOfArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Point$1(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new LinearRing(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,i=this.flatCoordinates,s=this.ends_,o=[];let l=0;for(let c=0,u=s.length;c<u;++c){const f=s[c],g=new LinearRing(i.slice(l,f),e);o.push(g),l=f}return o}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;linearRingsAreOriented(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=orientLinearRings(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const i=[],s=[];return i.length=quantizeArray(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),i,0,s),new Polygon(i,"XY",s)}getType(){return"Polygon"}intersectsExtent(e){return intersectsLinearRingArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,i){this.setLayout(i,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const s=deflateCoordinatesArray(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=s.length===0?0:s[s.length-1],this.changed()}}function fromExtent(n){if(isEmpty(n))throw new Error("Cannot create polygon from empty extent");const e=n[0],i=n[1],s=n[2],o=n[3],l=[e,i,e,o,s,o,s,i,e,i];return new Polygon(l,"XY",[l.length])}class MultiPolygon extends SimpleGeometry{constructor(e,i,s){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!s&&!Array.isArray(e[0])){const o=e,l=[],c=[];for(let u=0,f=o.length;u<f;++u){const g=o[u],H=l.length,Y=g.getEnds();for(let ee=0,te=Y.length;ee<te;++ee)Y[ee]+=H;extend$4(l,g.getFlatCoordinates()),c.push(Y)}i=o.length===0?this.getLayout():o[0].getLayout(),e=l,s=c}i!==void 0&&s?(this.setFlatCoordinates(i,e),this.endss_=s):this.setCoordinates(e,i)}appendPolygon(e){let i;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),i=e.getEnds().slice(),this.endss_.push();else{const s=this.flatCoordinates.length;extend$4(this.flatCoordinates,e.getFlatCoordinates()),i=e.getEnds().slice();for(let o=0,l=i.length;o<l;++o)i[o]+=s}this.endss_.push(i),this.changed()}clone(){const e=this.endss_.length,i=new Array(e);for(let o=0;o<e;++o)i[o]=this.endss_[o].slice();const s=new MultiPolygon(this.flatCoordinates.slice(),this.layout,i);return s.applyProperties(this),s}closestPointXY(e,i,s,o){return o<closestSquaredDistanceXY(this.getExtent(),e,i)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(multiArrayMaxSquaredDelta(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestMultiArrayPoint(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,i,s,o))}containsXY(e,i){return linearRingssContainsXY(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,i)}getArea(){return linearRingss(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let i;return e!==void 0?(i=this.getOrientedFlatCoordinates().slice(),orientLinearRingsArray(i,0,this.endss_,this.stride,e)):i=this.flatCoordinates,inflateMultiCoordinatesArray(i,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=linearRingss$1(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=getInteriorPointsOfMultiArray(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new MultiPoint(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;linearRingssAreOriented(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=orientLinearRingsArray(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const i=[],s=[];return i.length=quantizeMultiArray(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),i,0,s),new MultiPolygon(i,"XY",s)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let i;if(e===0)i=0;else{const l=this.endss_[e-1];i=l[l.length-1]}const s=this.endss_[e].slice(),o=s[s.length-1];if(i!==0)for(let l=0,c=s.length;l<c;++l)s[l]-=i;return new Polygon(this.flatCoordinates.slice(i,o),this.layout,s)}getPolygons(){const e=this.layout,i=this.flatCoordinates,s=this.endss_,o=[];let l=0;for(let c=0,u=s.length;c<u;++c){const f=s[c].slice(),g=f[f.length-1];if(l!==0)for(let Y=0,ee=f.length;Y<ee;++Y)f[Y]-=l;const H=new Polygon(i.slice(l,g),e,f);o.push(H),l=g}return o}getType(){return"MultiPolygon"}intersectsExtent(e){return intersectsLinearRingMultiArray(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,i){this.setLayout(i,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const s=deflateMultiCoordinatesArray(this.flatCoordinates,0,e,this.stride,this.endss_);if(s.length===0)this.flatCoordinates.length=0;else{const o=s[s.length-1];this.flatCoordinates.length=o.length===0?0:o[o.length-1]}this.changed()}}const tmpTransform=create();class RenderFeature{constructor(e,i,s,o,l,c){this.styleFunction,this.extent_,this.id_=c,this.type_=e,this.flatCoordinates_=i,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=s||null,this.properties_=l,this.squaredTolerance_,this.stride_=o,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?createOrUpdateFromCoordinate(this.flatCoordinates_):createOrUpdateFromFlatCoordinates(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=getCenter(this.getExtent());this.flatInteriorPoints_=getInteriorPointOfArray(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=inflateEnds(this.flatCoordinates_,this.ends_),i=linearRingss$1(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=getInteriorPointsOfMultiArray(this.flatCoordinates_,0,e,2,i)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=interpolatePoint(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let i=0;const s=this.ends_;for(let o=0,l=s.length;o<l;++o){const c=s[o],u=interpolatePoint(e,i,c,2,.5);extend$4(this.flatMidpoints_,u),i=c}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,i){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=get$3(e);const i=e.getExtent(),s=e.getWorldExtent();if(i&&s){const o=getHeight(s)/getHeight(i);compose(tmpTransform,s[0],s[3],o,-o,0,0,0),transform2D(this.flatCoordinates_,0,this.flatCoordinates_.length,2,tmpTransform,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var e;return new RenderFeature(this.type_,this.flatCoordinates_.slice(),(e=this.ends_)==null?void 0:e.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=memoizeOne((e,i)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),i&&this.simplifiedGeometry_.applyTransform(i);const s=this.simplifiedGeometry_.getFlatCoordinates();let o;switch(this.type_){case"LineString":s.length=douglasPeucker(s,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,s,0),o=[s.length];break;case"MultiLineString":o=[],s.length=douglasPeuckerArray(s,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,s,0,o);break;case"Polygon":o=[],s.length=quantizeArray(s,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),s,0,o);break}return o&&(this.simplifiedGeometry_=new RenderFeature(this.type_,s,o,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}RenderFeature.prototype.getFlatCoordinates=RenderFeature.prototype.getOrientedFlatCoordinates;function quickselect(n,e,i=0,s=n.length-1,o=defaultCompare){for(;s>i;){if(s-i>600){const f=s-i+1,g=e-i+1,H=Math.log(f),Y=.5*Math.exp(2*H/3),ee=.5*Math.sqrt(H*Y*(f-Y)/f)*(g-f/2<0?-1:1),te=Math.max(i,Math.floor(e-g*Y/f+ee)),ne=Math.min(s,Math.floor(e+(f-g)*Y/f+ee));quickselect(n,e,te,ne,o)}const l=n[e];let c=i,u=s;for(swap(n,i,e),o(n[s],l)>0&&swap(n,i,s);c<u;){for(swap(n,c,u),c++,u--;o(n[c],l)<0;)c++;for(;o(n[u],l)>0;)u--}o(n[i],l)===0?swap(n,i,u):(u++,swap(n,u,s)),u<=e&&(i=u+1),e<=u&&(s=u-1)}}function swap(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}function defaultCompare(n,e){return n<e?-1:n>e?1:0}let RBush$1=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let i=this.data;const s=[];if(!intersects(e,i))return s;const o=this.toBBox,l=[];for(;i;){for(let c=0;c<i.children.length;c++){const u=i.children[c],f=i.leaf?o(u):u;intersects(e,f)&&(i.leaf?s.push(u):contains$1(e,f)?this._all(u,s):l.push(u))}i=l.pop()}return s}collides(e){let i=this.data;if(!intersects(e,i))return!1;const s=[];for(;i;){for(let o=0;o<i.children.length;o++){const l=i.children[o],c=i.leaf?this.toBBox(l):l;if(intersects(e,c)){if(i.leaf||contains$1(e,c))return!0;s.push(l)}}i=s.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let s=0;s<e.length;s++)this.insert(e[s]);return this}let i=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=i;else if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){const s=this.data;this.data=i,i=s}this._insert(i,this.data.height-i.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=createNode([]),this}remove(e,i){if(!e)return this;let s=this.data;const o=this.toBBox(e),l=[],c=[];let u,f,g;for(;s||l.length;){if(s||(s=l.pop(),f=l[l.length-1],u=c.pop(),g=!0),s.leaf){const H=findItem(e,s.children,i);if(H!==-1)return s.children.splice(H,1),l.push(s),this._condense(l),this}!g&&!s.leaf&&contains$1(s,o)?(l.push(s),c.push(u),u=0,f=s,s=s.children[0]):f?(u++,s=f.children[u],g=!1):s=null}return this}toBBox(e){return e}compareMinX(e,i){return e.minX-i.minX}compareMinY(e,i){return e.minY-i.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,i){const s=[];for(;e;)e.leaf?i.push(...e.children):s.push(...e.children),e=s.pop();return i}_build(e,i,s,o){const l=s-i+1;let c=this._maxEntries,u;if(l<=c)return u=createNode(e.slice(i,s+1)),calcBBox(u,this.toBBox),u;o||(o=Math.ceil(Math.log(l)/Math.log(c)),c=Math.ceil(l/Math.pow(c,o-1))),u=createNode([]),u.leaf=!1,u.height=o;const f=Math.ceil(l/c),g=f*Math.ceil(Math.sqrt(c));multiSelect(e,i,s,g,this.compareMinX);for(let H=i;H<=s;H+=g){const Y=Math.min(H+g-1,s);multiSelect(e,H,Y,f,this.compareMinY);for(let ee=H;ee<=Y;ee+=f){const te=Math.min(ee+f-1,Y);u.children.push(this._build(e,ee,te,o-1))}}return calcBBox(u,this.toBBox),u}_chooseSubtree(e,i,s,o){for(;o.push(i),!(i.leaf||o.length-1===s);){let l=1/0,c=1/0,u;for(let f=0;f<i.children.length;f++){const g=i.children[f],H=bboxArea(g),Y=enlargedArea(e,g)-H;Y<c?(c=Y,l=H<l?H:l,u=g):Y===c&&H<l&&(l=H,u=g)}i=u||i.children[0]}return i}_insert(e,i,s){const o=s?e:this.toBBox(e),l=[],c=this._chooseSubtree(o,this.data,i,l);for(c.children.push(e),extend$2(c,o);i>=0&&l[i].children.length>this._maxEntries;)this._split(l,i),i--;this._adjustParentBBoxes(o,l,i)}_split(e,i){const s=e[i],o=s.children.length,l=this._minEntries;this._chooseSplitAxis(s,l,o);const c=this._chooseSplitIndex(s,l,o),u=createNode(s.children.splice(c,s.children.length-c));u.height=s.height,u.leaf=s.leaf,calcBBox(s,this.toBBox),calcBBox(u,this.toBBox),i?e[i-1].children.push(u):this._splitRoot(s,u)}_splitRoot(e,i){this.data=createNode([e,i]),this.data.height=e.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)}_chooseSplitIndex(e,i,s){let o,l=1/0,c=1/0;for(let u=i;u<=s-i;u++){const f=distBBox(e,0,u,this.toBBox),g=distBBox(e,u,s,this.toBBox),H=intersectionArea(f,g),Y=bboxArea(f)+bboxArea(g);H<l?(l=H,o=u,c=Y<c?Y:c):H===l&&Y<c&&(c=Y,o=u)}return o||s-i}_chooseSplitAxis(e,i,s){const o=e.leaf?this.compareMinX:compareNodeMinX,l=e.leaf?this.compareMinY:compareNodeMinY,c=this._allDistMargin(e,i,s,o),u=this._allDistMargin(e,i,s,l);c<u&&e.children.sort(o)}_allDistMargin(e,i,s,o){e.children.sort(o);const l=this.toBBox,c=distBBox(e,0,i,l),u=distBBox(e,s-i,s,l);let f=bboxMargin(c)+bboxMargin(u);for(let g=i;g<s-i;g++){const H=e.children[g];extend$2(c,e.leaf?l(H):H),f+=bboxMargin(c)}for(let g=s-i-1;g>=i;g--){const H=e.children[g];extend$2(u,e.leaf?l(H):H),f+=bboxMargin(u)}return f}_adjustParentBBoxes(e,i,s){for(let o=s;o>=0;o--)extend$2(i[o],e)}_condense(e){for(let i=e.length-1,s;i>=0;i--)e[i].children.length===0?i>0?(s=e[i-1].children,s.splice(s.indexOf(e[i]),1)):this.clear():calcBBox(e[i],this.toBBox)}};function findItem(n,e,i){if(!i)return e.indexOf(n);for(let s=0;s<e.length;s++)if(i(n,e[s]))return s;return-1}function calcBBox(n,e){distBBox(n,0,n.children.length,e,n)}function distBBox(n,e,i,s,o){o||(o=createNode(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let l=e;l<i;l++){const c=n.children[l];extend$2(o,n.leaf?s(c):c)}return o}function extend$2(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function compareNodeMinX(n,e){return n.minX-e.minX}function compareNodeMinY(n,e){return n.minY-e.minY}function bboxArea(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function bboxMargin(n){return n.maxX-n.minX+(n.maxY-n.minY)}function enlargedArea(n,e){return(Math.max(e.maxX,n.maxX)-Math.min(e.minX,n.minX))*(Math.max(e.maxY,n.maxY)-Math.min(e.minY,n.minY))}function intersectionArea(n,e){const i=Math.max(n.minX,e.minX),s=Math.max(n.minY,e.minY),o=Math.min(n.maxX,e.maxX),l=Math.min(n.maxY,e.maxY);return Math.max(0,o-i)*Math.max(0,l-s)}function contains$1(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function intersects(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function createNode(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(n,e,i,s,o){const l=[e,i];for(;l.length;){if(i=l.pop(),e=l.pop(),i-e<=s)continue;const c=e+Math.ceil((i-e)/s/2)*s;quickselect(n,c,e,i,o),l.push(e,c,c,i)}}class RBush{constructor(e){this.rbush_=new RBush$1(e),this.items_={}}insert(e,i){const s={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:i};this.rbush_.insert(s),this.items_[getUid(i)]=s}load(e,i){const s=new Array(i.length);for(let o=0,l=i.length;o<l;o++){const c=e[o],u=i[o],f={minX:c[0],minY:c[1],maxX:c[2],maxY:c[3],value:u};s[o]=f,this.items_[getUid(u)]=f}this.rbush_.load(s)}remove(e){const i=getUid(e),s=this.items_[i];return delete this.items_[i],this.rbush_.remove(s)!==null}update(e,i){const s=this.items_[getUid(i)],o=[s.minX,s.minY,s.maxX,s.maxY];equals$1(o,e)||(this.remove(i),this.insert(e,i))}getAll(){return this.rbush_.all().map(function(i){return i.value})}getInExtent(e){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(i).map(function(o){return o.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,i){return this.forEach_(this.getInExtent(e),i)}forEach_(e,i){let s;for(let o=0,l=e.length;o<l;o++)if(s=i(e[o]),s)return s;return s}isEmpty(){return isEmpty$1(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const i=this.rbush_.toJSON();return createOrUpdate$2(i.minX,i.minY,i.maxX,i.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const i in e.items_)this.items_[i]=e.items_[i]}}const VectorEventType={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class VectorSourceEvent extends BaseEvent{constructor(e,i,s){super(e),this.feature=i,this.features=s}}class VectorSource extends Source{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=VOID,this.format_=e.format||null,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(assert(this.format_,"`format` must be set when `url` is set"),this.loader_=xhr(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:all$1;const i=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=i?new RBush:null,this.loadedExtentsRtree_=new RBush,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let s,o;Array.isArray(e.features)?o=e.features:e.features&&(s=e.features,o=s.getArray()),!i&&s===void 0&&(s=new Collection(o)),o!==void 0&&this.addFeaturesInternal(o),s!==void 0&&this.bindFeaturesCollection_(s)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const i=getUid(e);if(!this.addToIndex_(i,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(i,e);const s=e.getGeometry();if(s){const o=s.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(o,e)}else this.nullGeometryFeatures_[i]=e;this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,e))}setupChangeEvents_(e,i){i instanceof RenderFeature||(this.featureChangeKeys_[e]=[listen(i,EventType$1.CHANGE,this.handleFeatureChange_,this),listen(i,ObjectEventType.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,i){let s=!0;if(i.getId()!==void 0){const o=String(i.getId());if(!(o in this.idIndex_))this.idIndex_[o]=i;else if(i instanceof RenderFeature){const l=this.idIndex_[o];l instanceof RenderFeature?Array.isArray(l)?l.push(i):this.idIndex_[o]=[l,i]:s=!1}else s=!1}return s&&(assert(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=i),s}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const i=[],s=[],o=[];for(let l=0,c=e.length;l<c;l++){const u=e[l],f=getUid(u);this.addToIndex_(f,u)&&s.push(u)}for(let l=0,c=s.length;l<c;l++){const u=s[l],f=getUid(u);this.setupChangeEvents_(f,u);const g=u.getGeometry();if(g){const H=g.getExtent();i.push(H),o.push(u)}else this.nullGeometryFeatures_[f]=u}if(this.featuresRtree_&&this.featuresRtree_.load(i,o),this.hasListener(VectorEventType.ADDFEATURE))for(let l=0,c=s.length;l<c;l++)this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,s[l]))}bindFeaturesCollection_(e){let i=!1;this.addEventListener(VectorEventType.ADDFEATURE,function(s){i||(i=!0,e.push(s.feature),i=!1)}),this.addEventListener(VectorEventType.REMOVEFEATURE,function(s){i||(i=!0,e.remove(s.feature),i=!1)}),e.addEventListener(CollectionEventType.ADD,s=>{i||(i=!0,this.addFeature(s.element),i=!1)}),e.addEventListener(CollectionEventType.REMOVE,s=>{i||(i=!0,this.removeFeature(s.element),i=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const s in this.featureChangeKeys_)this.featureChangeKeys_[s].forEach(unlistenByKey);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(s=>{this.removeFeatureInternal(s)});for(const s in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[s])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const i=new VectorSourceEvent(VectorEventType.CLEAR);this.dispatchEvent(i),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,i){const s=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(s,function(o){const l=o.getGeometry();if(l instanceof RenderFeature||l.intersectsCoordinate(e))return i(o)})}forEachFeatureInExtent(e,i){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,i);this.featuresCollection_&&this.featuresCollection_.forEach(i)}forEachFeatureIntersectingExtent(e,i){return this.forEachFeatureInExtent(e,function(s){const o=s.getGeometry();if(o instanceof RenderFeature||o.intersectsExtent(e)){const l=i(s);if(l)return l}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),isEmpty$1(this.nullGeometryFeatures_)||extend$4(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const i=[];return this.forEachFeatureAtCoordinateDirect(e,function(s){i.push(s)}),i}getFeaturesInExtent(e,i){if(this.featuresRtree_){if(!(i&&i.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const o=wrapAndSliceX(e,i);return[].concat(...o.map(l=>this.featuresRtree_.getInExtent(l)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,i){const s=e[0],o=e[1];let l=null;const c=[NaN,NaN];let u=1/0;const f=[-1/0,-1/0,1/0,1/0];return i=i||TRUE,this.featuresRtree_.forEachInExtent(f,function(g){if(i(g)){const H=g.getGeometry(),Y=u;if(u=H instanceof RenderFeature?0:H.closestPointXY(s,o,c,u),u<Y){l=g;const ee=Math.sqrt(u);f[0]=s-ee,f[1]=o-ee,f[2]=s+ee,f[3]=o+ee}}}),l}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const i=this.idIndex_[e.toString()];return i!==void 0?i:null}getFeatureByUid(e){const i=this.uidIndex_[e];return i!==void 0?i:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const i=e.target,s=getUid(i),o=i.getGeometry();if(!o)s in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(i),this.nullGeometryFeatures_[s]=i);else{const c=o.getExtent();s in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[s],this.featuresRtree_&&this.featuresRtree_.insert(c,i)):this.featuresRtree_&&this.featuresRtree_.update(c,i)}const l=i.getId();if(l!==void 0){const c=l.toString();this.idIndex_[c]!==i&&(this.removeFromIdIndex_(i),this.idIndex_[c]=i)}else this.removeFromIdIndex_(i),this.uidIndex_[s]=i;this.changed(),this.dispatchEvent(new VectorSourceEvent(VectorEventType.CHANGEFEATURE,i))}hasFeature(e){const i=e.getId();return i!==void 0?i in this.idIndex_:getUid(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&isEmpty$1(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,i,s){const o=this.loadedExtentsRtree_,l=this.strategy_(e,i,s);for(let c=0,u=l.length;c<u;++c){const f=l[c];o.forEachInExtent(f,function(H){return containsExtent(H.extent,f)})||(++this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADSTART)),this.loader_.call(this,f,i,s,H=>{--this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADEND,void 0,H))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADERROR))}),o.insert(f,{extent:f.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const i=this.loadedExtentsRtree_,s=i.forEachInExtent(e,function(o){if(equals$1(o.extent,e))return o});s&&i.remove(s)}removeFeatures(e){let i=!1;for(let s=0,o=e.length;s<o;++s)i=this.removeFeatureInternal(e[s])||i;i&&this.changed()}removeFeature(e){if(!e)return;this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const i=getUid(e);if(!(i in this.uidIndex_))return!1;i in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[i]:this.featuresRtree_&&this.featuresRtree_.remove(e);const s=this.featureChangeKeys_[i];s==null||s.forEach(unlistenByKey),delete this.featureChangeKeys_[i];const o=e.getId();if(o!==void 0){const l=o.toString(),c=this.idIndex_[l];c===e?delete this.idIndex_[l]:Array.isArray(c)&&(c.splice(c.indexOf(e),1),c.length===1&&(this.idIndex_[l]=c[0]))}return delete this.uidIndex_[i],this.hasListener(VectorEventType.REMOVEFEATURE)&&this.dispatchEvent(new VectorSourceEvent(VectorEventType.REMOVEFEATURE,e)),!0}removeFromIdIndex_(e){for(const i in this.idIndex_)if(this.idIndex_[i]===e){delete this.idIndex_[i];break}}setLoader(e){this.loader_=e}setUrl(e){assert(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(xhr(e,this.format_))}setOverlaps(e){this.overlaps_=e,this.changed()}}let brokenDiagonalRendering_;const canvasPool$1=[];function drawTestTriangle(n,e,i,s,o){n.beginPath(),n.moveTo(0,0),n.lineTo(e,i),n.lineTo(s,o),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(e,s)+1,Math.max(i,o)),n.restore()}function verifyBrokenDiagonalRendering(n,e){return Math.abs(n[e*4]-210)>2||Math.abs(n[e*4+3]-.75*255)>2}function isBrokenDiagonalRendering(){if(brokenDiagonalRendering_===void 0){const n=createCanvasContext2D(6,6,canvasPool$1);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",drawTestTriangle(n,4,5,4,0),drawTestTriangle(n,4,5,0,5);const e=n.getImageData(0,0,3,3).data;brokenDiagonalRendering_=verifyBrokenDiagonalRendering(e,0)||verifyBrokenDiagonalRendering(e,4)||verifyBrokenDiagonalRendering(e,8),releaseCanvas(n),canvasPool$1.push(n.canvas)}return brokenDiagonalRendering_}function calculateSourceResolution(n,e,i,s){const o=transform$1(i,e,n);let l=getPointResolution(e,s,i);const c=e.getMetersPerUnit();c!==void 0&&(l*=c);const u=n.getMetersPerUnit();u!==void 0&&(l/=u);const f=n.getExtent();if(!f||containsCoordinate(f,o)){const g=getPointResolution(n,l,o)/l;isFinite(g)&&g>0&&(l/=g)}return l}function calculateSourceExtentResolution(n,e,i,s){const o=getCenter(i);let l=calculateSourceResolution(n,e,o,s);return(!isFinite(l)||l<=0)&&forEachCorner(i,function(c){return l=calculateSourceResolution(n,e,c,s),isFinite(l)&&l>0}),l}function render(n,e,i,s,o,l,c,u,f,g,H,Y,ee,te){const ne=createCanvasContext2D(Math.round(i*n),Math.round(i*e),canvasPool$1);if(Y||(ne.imageSmoothingEnabled=!1),f.length===0)return ne.canvas;ne.scale(i,i);function Ye(nt){return Math.round(nt*i)/i}ne.globalCompositeOperation="lighter";const xe=createEmpty();f.forEach(function(nt,at,st){extend$3(xe,nt.extent)});let tt;const et=i/s,it=(Y?1:1+Math.pow(2,-24))/et;if(!ee||f.length!==1||g!==0){if(tt=createCanvasContext2D(Math.round(getWidth(xe)*et),Math.round(getHeight(xe)*et),canvasPool$1),Y||(tt.imageSmoothingEnabled=!1),o&&te){const nt=(o[0]-xe[0])*et,at=-(o[3]-xe[3])*et,st=getWidth(o)*et,ot=getHeight(o)*et;tt.rect(nt,at,st,ot),tt.clip()}f.forEach(function(nt,at,st){if(nt.image.width>0&&nt.image.height>0){if(nt.clipExtent){tt.save();const pt=(nt.clipExtent[0]-xe[0])*et,yt=-(nt.clipExtent[3]-xe[3])*et,mt=getWidth(nt.clipExtent)*et,St=getHeight(nt.clipExtent)*et;tt.rect(Y?pt:Math.round(pt),Y?yt:Math.round(yt),Y?mt:Math.round(pt+mt)-Math.round(pt),Y?St:Math.round(yt+St)-Math.round(yt)),tt.clip()}const ot=(nt.extent[0]-xe[0])*et,ut=-(nt.extent[3]-xe[3])*et,ht=getWidth(nt.extent)*et,dt=getHeight(nt.extent)*et;tt.drawImage(nt.image,g,g,nt.image.width-2*g,nt.image.height-2*g,Y?ot:Math.round(ot),Y?ut:Math.round(ut),Y?ht:Math.round(ot+ht)-Math.round(ot),Y?dt:Math.round(ut+dt)-Math.round(ut)),nt.clipExtent&&tt.restore()}})}const rt=getTopLeft(c);return u.getTriangles().forEach(function(nt,at,st){const ot=nt.source,ut=nt.target;let ht=ot[0][0],dt=ot[0][1],pt=ot[1][0],yt=ot[1][1],mt=ot[2][0],St=ot[2][1];const wt=Ye((ut[0][0]-rt[0])/l),Rt=Ye(-(ut[0][1]-rt[1])/l),Lt=Ye((ut[1][0]-rt[0])/l),Gt=Ye(-(ut[1][1]-rt[1])/l),vt=Ye((ut[2][0]-rt[0])/l),Et=Ye(-(ut[2][1]-rt[1])/l),_t=ht,Ct=dt;ht=0,dt=0,pt-=_t,yt-=Ct,mt-=_t,St-=Ct;const ct=[[pt,yt,0,0,Lt-wt],[mt,St,0,0,vt-wt],[0,0,pt,yt,Gt-Rt],[0,0,mt,St,Et-Rt]],ft=solveLinearSystem(ct);if(!ft)return;if(ne.save(),ne.beginPath(),isBrokenDiagonalRendering()||!Y){ne.moveTo(Lt,Gt);const Ft=4,Bt=wt-Lt,Xt=Rt-Gt;for(let Ot=0;Ot<Ft;Ot++)ne.lineTo(Lt+Ye((Ot+1)*Bt/Ft),Gt+Ye(Ot*Xt/(Ft-1))),Ot!=Ft-1&&ne.lineTo(Lt+Ye((Ot+1)*Bt/Ft),Gt+Ye((Ot+1)*Xt/(Ft-1)));ne.lineTo(vt,Et)}else ne.moveTo(Lt,Gt),ne.lineTo(wt,Rt),ne.lineTo(vt,Et);ne.clip(),ne.transform(ft[0],ft[2],ft[1],ft[3],wt,Rt),ne.translate(xe[0]-_t,xe[3]-Ct);let bt;if(tt)bt=tt.canvas,ne.scale(it,-it);else{const Ft=f[0],Bt=Ft.extent;bt=Ft.image,ne.scale(getWidth(Bt)/bt.width,-getHeight(Bt)/bt.height)}ne.drawImage(bt,0,0),ne.restore()}),tt&&(releaseCanvas(tt),canvasPool$1.push(tt.canvas)),H&&(ne.save(),ne.globalCompositeOperation="source-over",ne.strokeStyle="black",ne.lineWidth=1,u.getTriangles().forEach(function(nt,at,st){const ot=nt.target,ut=(ot[0][0]-rt[0])/l,ht=-(ot[0][1]-rt[1])/l,dt=(ot[1][0]-rt[0])/l,pt=-(ot[1][1]-rt[1])/l,yt=(ot[2][0]-rt[0])/l,mt=-(ot[2][1]-rt[1])/l;ne.beginPath(),ne.moveTo(dt,pt),ne.lineTo(ut,ht),ne.lineTo(yt,mt),ne.closePath(),ne.stroke()}),ne.restore()),ne.canvas}const ImageState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class ImageWrapper extends Target{constructor(e,i,s,o){super(),this.extent=e,this.pixelRatio_=s,this.resolution=i,this.state=typeof o=="function"?ImageState.IDLE:o,this.image_=null,this.loader=typeof o=="function"?o:null}changed(){this.dispatchEvent(EventType$1.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==ImageState.IDLE&&this.loader){this.state=ImageState.LOADING,this.changed();const e=this.getResolution(),i=Array.isArray(e)?e[0]:e;toPromise(()=>this.loader(this.getExtent(),i,this.getPixelRatio())).then(s=>{"image"in s&&(this.image_=s.image),"extent"in s&&(this.extent=s.extent),"resolution"in s&&(this.resolution=s.resolution),"pixelRatio"in s&&(this.pixelRatio_=s.pixelRatio),(s instanceof HTMLImageElement||CREATE_IMAGE_BITMAP&&s instanceof ImageBitmap||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement)&&(this.image_=s),this.state=ImageState.LOADED}).catch(s=>{this.state=ImageState.ERROR,console.error(s)}).finally(()=>this.changed())}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}}function listenImage(n,e,i){const s=n;let o=!0,l=!1,c=!1;const u=[listenOnce(s,EventType$1.LOAD,function(){c=!0,l||e()})];return s.src&&IMAGE_DECODE?(l=!0,s.decode().then(function(){o&&e()}).catch(function(f){o&&(c?e():i())})):u.push(listenOnce(s,EventType$1.ERROR,i)),function(){o=!1,u.forEach(unlistenByKey)}}function load(n,e){return new Promise((i,s)=>{function o(){c(),i(n)}function l(){c(),s(new Error("Image load error"))}function c(){n.removeEventListener("load",o),n.removeEventListener("error",l)}n.addEventListener("load",o),n.addEventListener("error",l)})}function decodeFallback(n,e){return e&&(n.src=e),n.src&&IMAGE_DECODE?new Promise((i,s)=>n.decode().then(()=>i(n)).catch(o=>n.complete&&n.width?i(n):s(o))):load(n)}function decode$1(n,e){return e&&(n.src=e),n.src&&IMAGE_DECODE&&CREATE_IMAGE_BITMAP?n.decode().then(()=>createImageBitmap(n)).catch(i=>{if(n.complete&&n.width)return n;throw i}):decodeFallback(n)}class ImageTile extends Tile{constructor(e,i,s,o,l,c){super(e,i,c),this.crossOrigin_=o,this.src_=s,this.key=s,this.image_=new Image,o!==null&&(this.image_.crossOrigin=o),this.unlisten_=null,this.tileLoadFunction_=l}getImage(){return this.image_}setImage(e){this.image_=e,this.state=TileState.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=TileState.ERROR,this.unlistenImage_(),this.image_=getBlankImage(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=TileState.LOADED:this.state=TileState.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==TileState.ERROR&&(this.state=TileState.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==TileState.IDLE&&(this.state=TileState.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=listenImage(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function getBlankImage(){const n=createCanvasContext2D(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}const MAX_SUBDIVISION=10,MAX_TRIANGLE_WIDTH=.25;class Triangulation{constructor(e,i,s,o,l,c,u){this.sourceProj_=e,this.targetProj_=i;let f={};const g=u?createTransformFromCoordinateTransform(it=>apply(u,transform$1(it,this.targetProj_,this.sourceProj_))):getTransform(this.targetProj_,this.sourceProj_);this.transformInv_=function(it){const rt=it[0]+"/"+it[1];return f[rt]||(f[rt]=g(it)),f[rt]},this.maxSourceExtent_=o,this.errorThresholdSquared_=l*l,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!o&&!!this.sourceProj_.getExtent()&&getWidth(o)>=getWidth(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?getWidth(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?getWidth(this.targetProj_.getExtent()):null;const H=getTopLeft(s),Y=getTopRight(s),ee=getBottomRight(s),te=getBottomLeft(s),ne=this.transformInv_(H),Ye=this.transformInv_(Y),xe=this.transformInv_(ee),tt=this.transformInv_(te),et=MAX_SUBDIVISION+(c?Math.max(0,Math.ceil(Math.log2(getArea$1(s)/(c*c*256*256)))):0);if(this.addQuad_(H,Y,ee,te,ne,Ye,xe,tt,et),this.wrapsXInSource_){let it=1/0;this.triangles_.forEach(function(rt,nt,at){it=Math.min(it,rt.source[0][0],rt.source[1][0],rt.source[2][0])}),this.triangles_.forEach(rt=>{if(Math.max(rt.source[0][0],rt.source[1][0],rt.source[2][0])-it>this.sourceWorldWidth_/2){const nt=[[rt.source[0][0],rt.source[0][1]],[rt.source[1][0],rt.source[1][1]],[rt.source[2][0],rt.source[2][1]]];nt[0][0]-it>this.sourceWorldWidth_/2&&(nt[0][0]-=this.sourceWorldWidth_),nt[1][0]-it>this.sourceWorldWidth_/2&&(nt[1][0]-=this.sourceWorldWidth_),nt[2][0]-it>this.sourceWorldWidth_/2&&(nt[2][0]-=this.sourceWorldWidth_);const at=Math.min(nt[0][0],nt[1][0],nt[2][0]);Math.max(nt[0][0],nt[1][0],nt[2][0])-at<this.sourceWorldWidth_/2&&(rt.source=nt)}})}f={}}addTriangle_(e,i,s,o,l,c){this.triangles_.push({source:[o,l,c],target:[e,i,s]})}addQuad_(e,i,s,o,l,c,u,f,g){const H=boundingExtent([l,c,u,f]),Y=this.sourceWorldWidth_?getWidth(H)/this.sourceWorldWidth_:null,ee=this.sourceWorldWidth_,te=this.sourceProj_.canWrapX()&&Y>.5&&Y<1;let ne=!1;if(g>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const xe=boundingExtent([e,i,s,o]);ne=getWidth(xe)/this.targetWorldWidth_>MAX_TRIANGLE_WIDTH||ne}!te&&this.sourceProj_.isGlobal()&&Y&&(ne=Y>MAX_TRIANGLE_WIDTH||ne)}if(!ne&&this.maxSourceExtent_&&isFinite(H[0])&&isFinite(H[1])&&isFinite(H[2])&&isFinite(H[3])&&!intersects$1(H,this.maxSourceExtent_))return;let Ye=0;if(!ne&&(!isFinite(l[0])||!isFinite(l[1])||!isFinite(c[0])||!isFinite(c[1])||!isFinite(u[0])||!isFinite(u[1])||!isFinite(f[0])||!isFinite(f[1]))){if(g>0)ne=!0;else if(Ye=(!isFinite(l[0])||!isFinite(l[1])?8:0)+(!isFinite(c[0])||!isFinite(c[1])?4:0)+(!isFinite(u[0])||!isFinite(u[1])?2:0)+(!isFinite(f[0])||!isFinite(f[1])?1:0),Ye!=1&&Ye!=2&&Ye!=4&&Ye!=8)return}if(g>0){if(!ne){const xe=[(e[0]+s[0])/2,(e[1]+s[1])/2],tt=this.transformInv_(xe);let et;te?et=(modulo(l[0],ee)+modulo(u[0],ee))/2-modulo(tt[0],ee):et=(l[0]+u[0])/2-tt[0];const it=(l[1]+u[1])/2-tt[1];ne=et*et+it*it>this.errorThresholdSquared_}if(ne){if(Math.abs(e[0]-s[0])<=Math.abs(e[1]-s[1])){const xe=[(i[0]+s[0])/2,(i[1]+s[1])/2],tt=this.transformInv_(xe),et=[(o[0]+e[0])/2,(o[1]+e[1])/2],it=this.transformInv_(et);this.addQuad_(e,i,xe,et,l,c,tt,it,g-1),this.addQuad_(et,xe,s,o,it,tt,u,f,g-1)}else{const xe=[(e[0]+i[0])/2,(e[1]+i[1])/2],tt=this.transformInv_(xe),et=[(s[0]+o[0])/2,(s[1]+o[1])/2],it=this.transformInv_(et);this.addQuad_(e,xe,et,o,l,tt,it,f,g-1),this.addQuad_(xe,i,s,et,tt,c,u,it,g-1)}return}}if(te){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(Ye&11)==0&&this.addTriangle_(e,s,o,l,u,f),(Ye&14)==0&&this.addTriangle_(e,s,i,l,u,c),Ye&&((Ye&13)==0&&this.addTriangle_(i,o,e,c,f,l),(Ye&7)==0&&this.addTriangle_(i,o,s,c,f,u))}calculateSourceExtent(){const e=createEmpty();return this.triangles_.forEach(function(i,s,o){const l=i.source;extendCoordinate(e,l[0]),extendCoordinate(e,l[1]),extendCoordinate(e,l[2])}),e}getTriangles(){return this.triangles_}}const ERROR_THRESHOLD=.5;class ReprojTile extends Tile{constructor(e,i,s,o,l,c,u,f,g,H,Y,ee){super(l,TileState.IDLE,ee),this.renderEdges_=Y!==void 0?Y:!1,this.pixelRatio_=u,this.gutter_=f,this.canvas_=null,this.sourceTileGrid_=i,this.targetTileGrid_=o,this.wrappedTileCoord_=c||l,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;const te=o.getTileCoordExtent(this.wrappedTileCoord_),ne=this.targetTileGrid_.getExtent();let Ye=this.sourceTileGrid_.getExtent();const xe=ne?getIntersection(te,ne):te;if(getArea$1(xe)===0){this.state=TileState.EMPTY;return}const tt=e.getExtent();tt&&(Ye?Ye=getIntersection(Ye,tt):Ye=tt);const et=o.getResolution(this.wrappedTileCoord_[0]),it=calculateSourceExtentResolution(e,s,xe,et);if(!isFinite(it)||it<=0){this.state=TileState.EMPTY;return}const rt=H!==void 0?H:ERROR_THRESHOLD;if(this.triangulation_=new Triangulation(e,s,xe,Ye,it*rt,et),this.triangulation_.getTriangles().length===0){this.state=TileState.EMPTY;return}this.sourceZ_=i.getZForResolution(it);let nt=this.triangulation_.calculateSourceExtent();if(Ye&&(e.canWrapX()?(nt[1]=clamp$1(nt[1],Ye[1],Ye[3]),nt[3]=clamp$1(nt[3],Ye[1],Ye[3])):nt=getIntersection(nt,Ye)),!getArea$1(nt))this.state=TileState.EMPTY;else{let at=0,st=0;e.canWrapX()&&(at=getWidth(tt),st=Math.floor((nt[0]-tt[0])/at)),wrapAndSliceX(nt.slice(),e,!0).forEach(ut=>{const ht=i.getTileRangeForExtentAndZ(ut,this.sourceZ_);for(let dt=ht.minX;dt<=ht.maxX;dt++)for(let pt=ht.minY;pt<=ht.maxY;pt++){const yt=g(this.sourceZ_,dt,pt,u);if(yt){const mt=st*at;this.sourceTiles_.push({tile:yt,offset:mt})}}++st}),this.sourceTiles_.length===0&&(this.state=TileState.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(i=>{var o;const s=i.tile;if(s&&s.getState()==TileState.LOADED){const l=this.sourceTileGrid_.getTileCoordExtent(s.tileCoord);l[0]+=i.offset,l[2]+=i.offset;const c=(o=this.clipExtent_)==null?void 0:o.slice();c&&(c[0]+=i.offset,c[2]+=i.offset),e.push({extent:l,clipExtent:c,image:s.getImage()})}}),this.sourceTiles_.length=0,e.length===0)this.state=TileState.ERROR;else{const i=this.wrappedTileCoord_[0],s=this.targetTileGrid_.getTileSize(i),o=typeof s=="number"?s:s[0],l=typeof s=="number"?s:s[1],c=this.targetTileGrid_.getResolution(i),u=this.sourceTileGrid_.getResolution(this.sourceZ_),f=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=render(o,l,this.pixelRatio_,u,this.sourceTileGrid_.getExtent(),c,f,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=TileState.LOADED}this.changed()}load(){if(this.state==TileState.IDLE){this.state=TileState.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:i})=>{const s=i.getState();if(s==TileState.IDLE||s==TileState.LOADING){e++;const o=listen(i,EventType$1.CHANGE,l=>{const c=i.getState();(c==TileState.LOADED||c==TileState.ERROR||c==TileState.EMPTY)&&(unlistenByKey(o),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(o)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:i},s,o){i.getState()==TileState.IDLE&&i.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(unlistenByKey),this.sourcesListenerKeys_=null}release(){this.canvas_&&(releaseCanvas(this.canvas_.getContext("2d")),canvasPool$1.push(this.canvas_),this.canvas_=null),super.release()}}class TileImage extends UrlTile{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:defaultTileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:ImageTile,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!equivalent$1(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){const i=this.getProjection();if(this.tileGrid&&(!i||equivalent$1(i,e)))return this.tileGrid;const s=getUid(e);return s in this.tileGridForProjection||(this.tileGridForProjection[s]=getForProjection(e)),this.tileGridForProjection[s]}createTile_(e,i,s,o,l,c){const u=[e,i,s],f=this.getTileCoordForTileUrlFunction(u,l),g=f?this.tileUrlFunction(f,o,l):void 0,H=new this.tileClass(u,g!==void 0?TileState.IDLE:TileState.EMPTY,g!==void 0?g:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return H.key=c,H.addEventListener(EventType$1.CHANGE,this.handleTileChange.bind(this)),H}getTile(e,i,s,o,l){const c=this.getProjection();if(!c||!l||equivalent$1(c,l))return this.getTileInternal(e,i,s,o,c||l);const u=[e,i,s],f=this.getKey(),g=this.getTileGridForProjection(c),H=this.getTileGridForProjection(l),Y=this.getTileCoordForTileUrlFunction(u,l),ee=new ReprojTile(c,g,l,H,u,Y,this.getTilePixelRatio(o),this.getGutter(),(te,ne,Ye,xe)=>this.getTileInternal(te,ne,Ye,xe,c),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return ee.key=f,ee}getTileInternal(e,i,s,o,l){const c=this.getKey();return this.createTile_(e,i,s,o,l,c)}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,i){const s=get$3(e);if(s){const o=getUid(s);o in this.tileGridForProjection||(this.tileGridForProjection[o]=i)}}}function defaultTileLoadFunction(n,e){n.getImage().src=e}function fromResolutionLike(n){return Array.isArray(n)?Math.min(...n):n}class ReprojImage extends ImageWrapper{constructor(e,i,s,o,l,c,u){let f=e.getExtent();f&&e.canWrapX()&&(f=f.slice(),f[0]=-1/0,f[2]=1/0);let g=i.getExtent();g&&i.canWrapX()&&(g=g.slice(),g[0]=-1/0,g[2]=1/0);const H=g?getIntersection(s,g):s,Y=getCenter(H),ee=calculateSourceResolution(e,i,Y,o),te=ERROR_THRESHOLD,ne=new Triangulation(e,i,H,f,ee*te,o),Ye=ne.calculateSourceExtent(),xe=isEmpty(Ye)?null:c(Ye,ee,l),tt=xe?ImageState.IDLE:ImageState.EMPTY,et=xe?xe.getPixelRatio():1;super(s,o,et,tt),this.targetProj_=i,this.maxSourceExtent_=f,this.triangulation_=ne,this.targetResolution_=o,this.targetExtent_=s,this.sourceImage_=xe,this.sourcePixelRatio_=et,this.interpolate_=u,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==ImageState.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==ImageState.LOADED){const i=getWidth(this.targetExtent_)/this.targetResolution_,s=getHeight(this.targetExtent_)/this.targetResolution_;this.canvas_=render(i,s,this.sourcePixelRatio_,fromResolutionLike(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==ImageState.IDLE){this.state=ImageState.LOADING,this.changed();const e=this.sourceImage_.getState();e==ImageState.LOADED||e==ImageState.ERROR?this.reproject_():(this.sourceListenerKey_=listen(this.sourceImage_,EventType$1.CHANGE,i=>{const s=this.sourceImage_.getState();(s==ImageState.LOADED||s==ImageState.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){unlistenByKey(this.sourceListenerKey_),this.sourceListenerKey_=null}}const DECIMALS=4,ImageSourceEventType={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class ImageSourceEvent extends BaseEvent{constructor(e,i){super(e),this.image=i}}class ImageSource extends Source{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const i=this.getResolutions();if(i){const s=linearFindNearest(i,e,0);e=i[s]}return e}getImage(e,i,s,o){const l=this.getProjection();if(!l||!o||equivalent$1(l,o))return l&&(o=l),this.getImageInternal(e,i,s,o);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&equivalent$1(this.reprojectedImage_.getProjection(),o)&&this.reprojectedImage_.getResolution()==i&&equals$1(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new ReprojImage(l,o,e,i,s,(c,u,f)=>this.getImageInternal(c,u,f,l),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,i,s,o){if(this.loader){const l=getRequestExtent(e,i,s,1),c=this.findNearestResolution(i);if(this.image&&(this.static_||this.wantedProjection_===o&&(this.wantedExtent_&&containsExtent(this.wantedExtent_,l)||containsExtent(this.image.getExtent(),l))&&(this.wantedResolution_&&fromResolutionLike(this.wantedResolution_)===c||fromResolutionLike(this.image.getResolution())===c)))return this.image;this.wantedProjection_=o,this.wantedExtent_=l,this.wantedResolution_=c,this.image=new ImageWrapper(l,c,s,this.loader),this.image.addEventListener(EventType$1.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const i=e.target;let s;switch(i.getState()){case ImageState.LOADING:this.loading=!0,s=ImageSourceEventType.IMAGELOADSTART;break;case ImageState.LOADED:this.loading=!1,s=ImageSourceEventType.IMAGELOADEND;break;case ImageState.ERROR:this.loading=!1,s=ImageSourceEventType.IMAGELOADERROR;break;default:return}this.hasListener(s)&&this.dispatchEvent(new ImageSourceEvent(s,i))}}function defaultImageLoadFunction(n,e){n.getImage().src=e}function getRequestExtent(n,e,i,s){const o=e/i,l=getCenter(n),c=ceil(getWidth(n)/o,DECIMALS),u=ceil(getHeight(n)/o,DECIMALS),f=ceil((s-1)*c/2,DECIMALS),g=c+2*f,H=ceil((s-1)*u/2,DECIMALS),Y=u+2*H;return getForViewAndSize(l,o,0,[g,Y])}const DEFAULT_VERSION="1.3.0",GETFEATUREINFO_IMAGE_SIZE=[101,101];function getRequestUrl(n,e,i,s,o){o.WIDTH=i[0],o.HEIGHT=i[1];const l=s.getAxisOrientation(),c=compareVersions(o.VERSION,"1.3")>=0;o[c?"CRS":"SRS"]=s.getCode();const u=c&&l.startsWith("ne")?[e[1],e[0],e[3],e[2]]:e;return o.BBOX=u.join(","),appendParams(n,o)}function getImageSrc(n,e,i,s,o,l,c){l=Object.assign({REQUEST:"GetMap"},l);const u=e/i,f=[round(getWidth(n)/u,DECIMALS),round(getHeight(n)/u,DECIMALS)];if(i!=1)switch(c){case"geoserver":const H=90*i+.5|0;"FORMAT_OPTIONS"in l?l.FORMAT_OPTIONS+=";dpi:"+H:l.FORMAT_OPTIONS="dpi:"+H;break;case"mapserver":l.MAP_RESOLUTION=90*i;break;case"carmentaserver":case"qgis":l.DPI=90*i;break;default:throw new Error("Unknown `serverType` configured")}return getRequestUrl(o,n,f,s,l)}function getRequestParams(n,e){return Object.assign({REQUEST:e,SERVICE:"WMS",VERSION:DEFAULT_VERSION,FORMAT:"image/png",STYLES:"",TRANSPARENT:"TRUE"},n)}function createLoader(n){const e=n.hidpi===void 0?!0:n.hidpi,i=get$3(n.projection||"EPSG:3857"),s=n.ratio||1.5,o=n.load||decode$1,l=n.crossOrigin??null;return(c,u,f)=>{c=getRequestExtent(c,u,f,s),f!=1&&(!e||n.serverType===void 0)&&(f=1);const g=getImageSrc(c,u,f,i,n.url,getRequestParams(n.params,"GetMap"),n.serverType),H=new Image;return H.crossOrigin=l,o(H,g).then(Y=>({image:Y,extent:c,pixelRatio:f}))}}function getFeatureInfoUrl(n,e,i){if(n.url===void 0)return;const s=get$3(n.projection||"EPSG:3857"),o=getForViewAndSize(e,i,0,GETFEATUREINFO_IMAGE_SIZE),l={QUERY_LAYERS:n.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(l,getRequestParams(n.params,"GetFeatureInfo"),n.params);const c=floor((e[0]-o[0])/i,DECIMALS),u=floor((o[3]-e[1])/i,DECIMALS),f=compareVersions(l.VERSION,"1.3")>=0;return l[f?"I":"X"]=c,l[f?"J":"Y"]=u,getRequestUrl(n.url,o,GETFEATUREINFO_IMAGE_SIZE,s,l)}function getLegendUrl(n,e){if(n.url===void 0)return;const i={SERVICE:"WMS",VERSION:DEFAULT_VERSION,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(e!==void 0){const s=get$3(n.projection||"EPSG:3857").getMetersPerUnit()||1,o=28e-5;i.SCALE=e*s/o}if(Object.assign(i,n.params),n.params!==void 0&&i.LAYER===void 0){const s=i.LAYERS;if(!(!Array.isArray(s)||s.length!==1))return;i.LAYER=s}return appendParams(n.url,i)}class TileWMS extends TileImage{constructor(e){e=e||{};const i=Object.assign({},e.params);super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.params_=i,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=createEmpty(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,i,s,o){const l=get$3(s),c=this.getProjection()||l;let u=this.getTileGrid();u||(u=this.getTileGridForProjection(c));const f=transform$1(e,l,c),g=calculateSourceResolution(c,l,e,i),H=u.getZForResolution(g,this.zDirection),Y=u.getResolution(H),ee=u.getTileCoordForCoordAndZ(f,H);if(u.getResolutions().length<=ee[0])return;let te=u.getTileCoordExtent(ee,this.tmpExtent_);const ne=this.gutter_;ne!==0&&(te=buffer(te,Y*ne,te));const Ye={QUERY_LAYERS:this.params_.LAYERS};Object.assign(Ye,getRequestParams(this.params_,"GetFeatureInfo"),o);const xe=Math.floor((f[0]-te[0])/Y),tt=Math.floor((te[3]-f[1])/Y);return Ye[this.v13_?"I":"X"]=xe,Ye[this.v13_?"J":"Y"]=tt,this.getRequestUrl_(ee,te,1,c||l,Ye)}getLegendUrl(e,i){if(this.urls[0]===void 0)return;const s={SERVICE:"WMS",VERSION:DEFAULT_VERSION,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(i===void 0||i.LAYER===void 0){const o=this.params_.LAYERS;if(!(!Array.isArray(o)||o.length===1))return;s.LAYER=o}if(e!==void 0){const o=this.getProjection()?this.getProjection().getMetersPerUnit():1,l=28e-5;s.SCALE=e*o/l}return Object.assign(s,i),appendParams(this.urls[0],s)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,i,s,o,l){const c=this.urls;if(!c)return;let u;if(c.length==1)u=c[0];else{const f=modulo(hash(e),c.length);u=c[f]}return getImageSrc(i,(this.tileGrid||this.getTileGridForProjection(o)).getResolution(e[0]),s,o,u,l,this.serverType_)}getTilePixelRatio(e){return!this.hidpi_||this.serverType_===void 0?1:e}getKeyForParams_(){let e=0;const i=[];for(const s in this.params_)i[e++]=s+"-"+this.params_[s];return i.join("/")}setParams_(e){this.params_=e,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(e){this.setParams_(Object.assign({},e))}updateParams(e){this.setParams_(Object.assign(this.params_,e))}updateV13_(){const e=this.params_.VERSION||DEFAULT_VERSION;this.v13_=compareVersions(e,"1.3")>=0}tileUrlFunction(e,i,s){let o=this.getTileGrid();if(o||(o=this.getTileGridForProjection(s)),o.getResolutions().length<=e[0])return;i!=1&&(!this.hidpi_||this.serverType_===void 0)&&(i=1);const l=o.getResolution(e[0]);let c=o.getTileCoordExtent(e,this.tmpExtent_);const u=this.gutter_;u!==0&&(c=buffer(c,l*u,c));const f=Object.assign({},getRequestParams(this.params_,"GetMap"));return this.getRequestUrl_(e,c,i,s,f)}}let WMTS$1=class extends TileImage{constructor(e){const i=e.requestEncoding!==void 0?e.requestEncoding:"KVP",s=e.tileGrid;let o=e.urls;o===void 0&&e.url!==void 0&&(o=expandUrl(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:s,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:o,wrapX:e.wrapX!==void 0?e.wrapX:!1,transition:e.transition,zDirection:e.zDirection}),this.version_=e.version!==void 0?e.version:"1.0.0",this.format_=e.format!==void 0?e.format:"image/jpeg",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=i,this.setKey(this.getKeyForDimensions_()),o&&o.length>0&&(this.tileUrlFunction=createFromTileUrlFunctions(o.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const i=e.join(`
`);this.setTileUrlFunction(createFromTileUrlFunctions(e.map(this.createFromWMTSTemplate.bind(this))),i)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const i in this.dimensions_)e.push(i+"-"+this.dimensions_[i]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const i=this.requestEncoding_,s={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};i=="KVP"&&Object.assign(s,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=i=="KVP"?appendParams(e,s):e.replace(/\{(\w+?)\}/g,function(c,u){return u.toLowerCase()in s?s[u.toLowerCase()]:c});const o=this.tileGrid,l=this.dimensions_;return(function(c,u,f){if(!c)return;const g={TileMatrix:o.getMatrixId(c[0]),TileCol:c[1],TileRow:c[2]};Object.assign(g,l);let H=e;return i=="KVP"?H=appendParams(H,g):H=H.replace(/\{(\w+?)\}/g,function(Y,ee){return encodeURIComponent(g[ee])}),H})}};class ImageWMS extends ImageSource{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:defaultImageLoadFunction,this.params_=Object.assign({},e.params),this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,i,s,o){const l=get$3(s),c=this.getProjection();c&&c!==l&&(i=calculateSourceResolution(c,l,e,i),e=transform$1(e,l,c));const u={url:this.url_,params:{...this.params_,...o},projection:c||l};return getFeatureInfoUrl(u,e,i)}getLegendUrl(e,i){return getLegendUrl({url:this.url_,params:{...this.params_,...i}},e)}getParams(){return this.params_}getImageInternal(e,i,s,o){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==o)&&(this.loaderProjection_=o,this.loader=createLoader({crossOrigin:this.crossOrigin_,params:this.params_,projection:o,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(l,c)=>(this.image.setImage(l),this.imageLoadFunction_(this.image,c),decode$1(l))})),super.getImageInternal(e,i,s,o))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}const MapBrowserEventType={SINGLECLICK:"singleclick",CLICK:EventType$1.CLICK,DBLCLICK:EventType$1.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},InteractionProperty={ACTIVE:"active"};class Interaction extends BaseObject{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(InteractionProperty.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(InteractionProperty.ACTIVE,e)}setMap(e){this.map_=e}}function pan(n,e,i){const s=n.getCenterInternal();if(s){const o=[s[0]+e[0],s[1]+e[1]];n.animateInternal({duration:i!==void 0?i:250,easing:linear,center:n.getConstrainedCenter(o)})}}function zoomByDelta(n,e,i,s){const o=n.getZoom();if(o===void 0)return;const l=n.getConstrainedZoom(o+e),c=n.getResolutionForZoom(l);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:c,anchor:i,duration:s!==void 0?s:250,easing:easeOut})}class DoubleClickZoom extends Interaction{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let i=!1;if(e.type==MapBrowserEventType.DBLCLICK){const s=e.originalEvent,o=e.map,l=e.coordinate,c=s.shiftKey?-this.delta_:this.delta_,u=o.getView();zoomByDelta(u,c,l,this.duration_),s.preventDefault(),i=!0}return!i}}function all(n){const e=arguments;return function(i){let s=!0;for(let o=0,l=e.length;o<l&&(s=s&&e[o](i),!!s);++o);return s}}const altKeyOnly=function(n){const e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},altShiftKeysOnly=function(n){const e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},focus=function(n){const e=n.map.getTargetElement(),i=e.getRootNode(),s=n.map.getOwnerDocument().activeElement;return i instanceof ShadowRoot?i.host.contains(s):e.contains(s)},focusWithTabindex=function(n){const e=n.map.getTargetElement(),i=e.getRootNode();return(i instanceof ShadowRoot?i.host:e).hasAttribute("tabindex")?focus(n):!0},always$1=TRUE,mouseActionButton=function(n){const e=n.originalEvent;return"pointerId"in e&&e.button==0&&!(WEBKIT&&MAC&&e.ctrlKey)},never=FALSE,pointerMove=function(n){return n.type=="pointermove"},singleClick=function(n){return n.type==MapBrowserEventType.SINGLECLICK},noModifierKeys=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},platformModifierKey=function(n){const e=n.originalEvent;return MAC?e.metaKey:e.ctrlKey},shiftKeyOnly=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},targetNotEditable=function(n){const e=n.originalEvent,i=e.target.tagName;return i!=="INPUT"&&i!=="SELECT"&&i!=="TEXTAREA"&&!e.target.isContentEditable},mouseOnly=function(n){const e=n.originalEvent;return"pointerId"in e&&e.pointerType=="mouse"},primaryAction=function(n){const e=n.originalEvent;return"pointerId"in e&&e.isPrimary&&e.button===0};class RenderBox extends Disposable{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,i=this.endPixel_,s="px",o=this.element_.style;o.left=Math.min(e[0],i[0])+s,o.top=Math.min(e[1],i[1])+s,o.width=Math.abs(i[0]-e[0])+s,o.height=Math.abs(i[1]-e[1])+s}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const i=this.element_.style;i.left="inherit",i.top="inherit",i.width="inherit",i.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,i){this.startPixel_=e,this.endPixel_=i,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const e=this.startPixel_,i=this.endPixel_,o=[e,[e[0],i[1]],i,[i[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);o[4]=o[0].slice(),this.geometry_?this.geometry_.setCoordinates([o]):this.geometry_=new Polygon([o])}getGeometry(){return this.geometry_}}class PointerInteraction extends Interaction{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let i=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==MapBrowserEventType.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==MapBrowserEventType.POINTERUP){const s=this.handleUpEvent(e);this.handlingDownUpSequence=s&&this.targetPointers.length>0}}else if(e.type==MapBrowserEventType.POINTERDOWN){const s=this.handleDownEvent(e);this.handlingDownUpSequence=s,i=this.stopDown(s)}else e.type==MapBrowserEventType.POINTERMOVE&&this.handleMoveEvent(e);return!i}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function centroid(n){const e=n.length;let i=0,s=0;for(let o=0;o<e;o++)i+=n[o].clientX,s+=n[o].clientY;return{clientX:i/e,clientY:s/e}}const DragBoxEventType={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class DragBoxEvent extends BaseEvent{constructor(e,i,s){super(e),this.coordinate=i,this.mapBrowserEvent=s}}class DragBox extends PointerInteraction{constructor(e){super(),this.on,this.once,this.un,e=e??{},this.box_=new RenderBox(e.className||"ol-dragbox"),this.minArea_=e.minArea??64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition??mouseActionButton,this.boxEndCondition_=e.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(e,i,s){const o=s[0]-i[0],l=s[1]-i[1];return o*o+l*l>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXDRAG,e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;const i=this.boxEndCondition_(e,this.startPixel_,e.pixel);return i&&this.onBoxEnd(e),this.dispatchEvent(new DragBoxEvent(i?DragBoxEventType.BOXEND:DragBoxEventType.BOXCANCEL,e.coordinate,e)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(e)}setMap(e){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(e)}}class DragPan extends PointerInteraction{constructor(e){super({stopDown:FALSE}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const i=e.condition?e.condition:all(noModifierKeys,primaryAction);this.condition_=e.onFocusOnly?all(focusWithTabindex,i):i,this.noKinetic_=!1}handleDragEvent(e){const i=e.map;this.panning_||(this.panning_=!0,i.getView().beginInteraction());const s=this.targetPointers,o=i.getEventPixel(centroid(s));if(s.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(o[0],o[1]),this.lastCentroid){const l=[this.lastCentroid[0]-o[0],o[1]-this.lastCentroid[1]],u=e.map.getView();scale$3(l,u.getResolution()),rotate$1(l,u.getRotation()),u.adjustCenterInternal(l)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=o,this.lastPointersCount_=s.length,e.originalEvent.preventDefault()}handleUpEvent(e){const i=e.map,s=i.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const o=this.kinetic_.getDistance(),l=this.kinetic_.getAngle(),c=s.getCenterInternal(),u=i.getPixelFromCoordinateInternal(c),f=i.getCoordinateFromPixelInternal([u[0]-o*Math.cos(l),u[1]-o*Math.sin(l)]);s.animateInternal({center:s.getConstrainedCenter(f),duration:500,easing:easeOut})}return this.panning_&&(this.panning_=!1,s.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const s=e.map.getView();return this.lastCentroid=null,s.getAnimating()&&s.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}function disable(n){if(n!==void 0)return 0}function none$1(n){if(n!==void 0)return n}function createSnapToN(n){const e=2*Math.PI/n;return(function(i,s){if(s)return i;if(i!==void 0)return i=Math.floor(i/e+.5)*e,i})}function createSnapToZero(n){const e=toRadians(5);return(function(i,s){return s||i===void 0?i:Math.abs(i)<=e?0:i})}class DragRotate extends PointerInteraction{constructor(e){e=e||{},super({stopDown:FALSE}),this.condition_=e.condition?e.condition:altShiftKeysOnly,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!mouseOnly(e))return;const i=e.map,s=i.getView();if(s.getConstraints().rotation===disable)return;const o=i.getSize(),l=e.pixel,c=Math.atan2(o[1]/2-l[1],l[0]-o[0]/2);if(this.lastAngle_!==void 0){const u=c-this.lastAngle_;s.adjustRotationInternal(-u)}this.lastAngle_=c}handleUpEvent(e){return mouseOnly(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return mouseOnly(e)&&mouseActionButton(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class DragZoom extends DragBox{constructor(e){e=e||{};const i=e.condition?e.condition:shiftKeyOnly;super({condition:i,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const s=this.getMap().getView();let o=this.getGeometry();if(this.out_){const l=s.rotatedExtentForGeometry(o),c=s.getResolutionForExtentInternal(l),u=s.getResolution()/c;o=o.clone(),o.scale(u*u)}s.fitInternal(o,{duration:this.duration_,easing:easeOut})}}class MapEvent extends BaseEvent{constructor(e,i,s){super(e),this.map=i,this.frameState=s!==void 0?s:null}}class MapBrowserEvent extends MapEvent{constructor(e,i,s,o,l,c){super(e,i,l),this.originalEvent=s,this.pixel_=null,this.coordinate_=null,this.dragging=o!==void 0?o:!1,this.activePointers=c}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const ViewHint={ANIMATING:0,INTERACTING:1},EventType={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},NO_COLOR=[NaN,NaN,NaN,0];let colorParseContext;function getColorParseContext(){return colorParseContext||(colorParseContext=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),colorParseContext}const rgbModernRegEx=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,rgbLegacyAbsoluteRegEx=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,rgbLegacyPercentageRegEx=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,hexRegEx=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function toColorComponent(n,e){return n.endsWith("%")?Number(n.substring(0,n.length-1))/e:Number(n)}function throwInvalidColor(n){throw new Error('failed to parse "'+n+'" as color')}function parseRgba(n){if(n.toLowerCase().startsWith("rgb")){const l=n.match(rgbLegacyAbsoluteRegEx)||n.match(rgbModernRegEx)||n.match(rgbLegacyPercentageRegEx);if(l){const c=l[4],u=100/255;return[clamp$1(toColorComponent(l[1],u)+.5|0,0,255),clamp$1(toColorComponent(l[2],u)+.5|0,0,255),clamp$1(toColorComponent(l[3],u)+.5|0,0,255),c!==void 0?clamp$1(toColorComponent(c,100),0,1):1]}throwInvalidColor(n)}if(n.startsWith("#")){if(hexRegEx.test(n)){const l=n.substring(1),c=l.length<=4?1:2,u=[0,0,0,255];for(let f=0,g=l.length;f<g;f+=c){let H=parseInt(l.substring(f,f+c),16);c===1&&(H+=H<<4),u[f/c]=H}return u[3]=u[3]/255,u}throwInvalidColor(n)}const e=getColorParseContext();e.fillStyle="#abcdef";let i=e.fillStyle;e.fillStyle=n,e.fillStyle===i&&(e.fillStyle="#fedcba",i=e.fillStyle,e.fillStyle=n,e.fillStyle===i&&throwInvalidColor(n));const s=e.fillStyle;if(s.startsWith("#")||s.startsWith("rgba"))return parseRgba(s);e.clearRect(0,0,1,1),e.fillRect(0,0,1,1);const o=Array.from(e.getImageData(0,0,1,1).data);return o[3]=toFixed(o[3]/255,3),o}function asString(n){return typeof n=="string"?n:toString(n)}const MAX_CACHE_SIZE=1024,cache={};let cacheSize=0;function withAlpha(n){if(n.length===4)return n;const e=n.slice();return e[3]=1,e}function b1(n){return n>.0031308?Math.pow(n,1/2.4)*269.025-14.025:n*3294.6}function b2(n){return n>.2068965?Math.pow(n,3):(n-4/29)*(108/841)}function a1(n){return n>10.314724?Math.pow((n+14.025)/269.025,2.4):n/3294.6}function a2(n){return n>.0088564?Math.pow(n,1/3):n/(108/841)+4/29}function rgbaToLcha(n){const e=a1(n[0]),i=a1(n[1]),s=a1(n[2]),o=a2(e*.222488403+i*.716873169+s*.06060791),l=500*(a2(e*.452247074+i*.399439023+s*.148375274)-o),c=200*(o-a2(e*.016863605+i*.117638439+s*.865350722)),u=Math.atan2(c,l)*(180/Math.PI);return[116*o-16,Math.sqrt(l*l+c*c),u<0?u+360:u,n[3]]}function lchaToRgba(n){const e=(n[0]+16)/116,i=n[1],s=n[2]*Math.PI/180,o=b2(e),l=b2(e+i/500*Math.cos(s)),c=b2(e-i/200*Math.sin(s)),u=b1(l*3.021973625-o*1.617392459-c*.404875592),f=b1(l*-.943766287+o*1.916279586+c*.027607165),g=b1(l*.069407491-o*.22898585+c*1.159737864);return[clamp$1(u+.5|0,0,255),clamp$1(f+.5|0,0,255),clamp$1(g+.5|0,0,255),n[3]]}function fromString(n){if(n==="none")return NO_COLOR;if(cache.hasOwnProperty(n))return cache[n];if(cacheSize>=MAX_CACHE_SIZE){let i=0;for(const s in cache)(i++&3)===0&&(delete cache[s],--cacheSize)}const e=parseRgba(n);e.length!==4&&throwInvalidColor(n);for(const i of e)isNaN(i)&&throwInvalidColor(n);return cache[n]=e,++cacheSize,e}function asArray(n){return Array.isArray(n)?n:fromString(n)}function toString(n){let e=n[0];e!=(e|0)&&(e=e+.5|0);let i=n[1];i!=(i|0)&&(i=i+.5|0);let s=n[2];s!=(s|0)&&(s=s+.5|0);const o=n[3]===void 0?1:Math.round(n[3]*1e3)/1e3;return"rgba("+e+","+i+","+s+","+o+")"}class IconImageCache{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const i in this.cache_){const s=this.cache_[i];(e++&3)===0&&!s.hasListener()&&(delete this.cache_[i],delete this.patternCache_[i],--this.cacheSize_)}}}get(e,i,s){const o=getCacheKey$1(e,i,s);return o in this.cache_?this.cache_[o]:null}getPattern(e,i,s){const o=getCacheKey$1(e,i,s);return o in this.patternCache_?this.patternCache_[o]:null}set(e,i,s,o,l){const c=getCacheKey$1(e,i,s),u=c in this.cache_;this.cache_[c]=o,l&&(o.getImageState()===ImageState.IDLE&&o.load(),o.getImageState()===ImageState.LOADING?o.ready().then(()=>{this.patternCache_[c]=getSharedCanvasContext2D().createPattern(o.getImage(1),"repeat")}):this.patternCache_[c]=getSharedCanvasContext2D().createPattern(o.getImage(1),"repeat")),u||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function getCacheKey$1(n,e,i){const s=i?asArray(i):"null";return e+":"+n+":"+s}const shared=new IconImageCache;let taintedTestContext=null;class IconImage extends Target{constructor(e,i,s,o,l){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=s,this.canvas_={},this.color_=l,this.imageState_=o===void 0?ImageState.IDLE:o,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=i,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===ImageState.LOADED){taintedTestContext||(taintedTestContext=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0})),taintedTestContext.drawImage(this.image_,0,0);try{taintedTestContext.getImageData(0,0,1,1),this.tainted_=!1}catch{taintedTestContext=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(EventType$1.CHANGE)}handleImageError_(){this.imageState_=ImageState.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=ImageState.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],i=this.size_[1],s=createCanvasContext2D(e,i);s.fillRect(0,0,e,i),this.hitDetectionImage_=s.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===ImageState.IDLE){this.image_||this.initializeImage_(),this.imageState_=ImageState.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&decodeFallback(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==ImageState.LOADED)return;const i=this.image_,s=createCanvasContext2D(Math.ceil(i.width*e),Math.ceil(i.height*e)),o=s.canvas;s.scale(e,e),s.drawImage(i,0,0),s.globalCompositeOperation="multiply",s.fillStyle=asString(this.color_),s.fillRect(0,0,o.width/e,o.height/e),s.globalCompositeOperation="destination-in",s.drawImage(i,0,0),this.canvas_[e]=o}ready(){return this.ready_||(this.ready_=new Promise(e=>{if(this.imageState_===ImageState.LOADED||this.imageState_===ImageState.ERROR)e();else{const i=()=>{(this.imageState_===ImageState.LOADED||this.imageState_===ImageState.ERROR)&&(this.removeEventListener(EventType$1.CHANGE,i),e())};this.addEventListener(EventType$1.CHANGE,i)}})),this.ready_}}function get$2(n,e,i,s,o,l){let c=e===void 0?void 0:shared.get(e,i,o);return c||(c=new IconImage(n,n&&"src"in n?n.src||void 0:e,i,s,o),shared.set(e,i,o,c,l)),l&&c&&!shared.getPattern(e,i,o)&&shared.set(e,i,o,c,l),c}function asColorLike(n){return n?Array.isArray(n)?toString(n):typeof n=="object"&&"src"in n?asCanvasPattern(n):n:null}function asCanvasPattern(n){if(!n.offset||!n.size)return shared.getPattern(n.src,"anonymous",n.color);const e=n.src+":"+n.offset,i=shared.getPattern(e,void 0,n.color);if(i)return i;const s=shared.get(n.src,"anonymous",null);if(s.getImageState()!==ImageState.LOADED)return null;const o=createCanvasContext2D(n.size[0],n.size[1]);return o.drawImage(s.getImage(1),n.offset[0],n.offset[1],n.size[0],n.size[1],0,0,n.size[0],n.size[1]),get$2(o.canvas,e,void 0,ImageState.LOADED,n.color,!0),shared.getPattern(e,void 0,n.color)}class VectorContext{drawCustom(e,i,s,o,l){}drawGeometry(e){}setStyle(e){}drawCircle(e,i,s){}drawFeature(e,i,s){}drawGeometryCollection(e,i,s){}drawLineString(e,i,s){}drawMultiLineString(e,i,s){}drawMultiPoint(e,i,s){}drawMultiPolygon(e,i,s){}drawPoint(e,i,s){}drawPolygon(e,i,s){}drawText(e,i,s){}setFillStrokeStyle(e,i){}setImageStyle(e,i){}setTextStyle(e,i){}}const defaultFont="10px sans-serif",defaultFillStyle="#000",defaultLineCap="round",defaultLineDash=[],defaultLineDashOffset=0,defaultLineJoin="round",defaultMiterLimit=10,defaultStrokeStyle="#000",defaultTextAlign="center",defaultTextBaseline="middle",defaultPadding=[0,0,0,0],defaultLineWidth=1,checkedFonts=new BaseObject;let measureContext$1=null,measureFont;const textHeights={},genericFontFamilies=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"]);function getFontKey(n,e,i){return`${n} ${e} 16px "${i}"`}const registerFont=(function(){let e,i;async function s(l){await i.ready;const c=await i.load(l);if(c.length===0)return!1;const u=getFontParameters(l),f=u.families[0].toLowerCase(),g=u.weight;return c.some(H=>{const Y=H.family.replace(/^['"]|['"]$/g,"").toLowerCase(),ee=fontWeights$1[H.weight]||H.weight;return Y===f&&H.style===u.style&&ee==g})}async function o(){await i.ready;let l=!0;const c=checkedFonts.getProperties(),u=Object.keys(c).filter(f=>c[f]<100);for(let f=u.length-1;f>=0;--f){const g=u[f];let H=c[g];H<100&&(await s(g)?(clear$1(textHeights),checkedFonts.set(g,100)):(H+=10,checkedFonts.set(g,H,!0),H<100&&(l=!1)))}e=void 0,l||(e=setTimeout(o,100))}return async function(l){i||(i=WORKER_OFFSCREEN_CANVAS?self.fonts:document.fonts);const c=getFontParameters(l);if(!c)return;const u=c.families;let f=!1;for(const g of u){if(genericFontFamilies.has(g))continue;const H=getFontKey(c.style,c.weight,g);checkedFonts.get(H)===void 0&&(checkedFonts.set(H,0,!0),f=!0)}f&&(clearTimeout(e),e=setTimeout(o,100))}})(),measureTextHeight=(function(){let n;return function(e){let i=textHeights[e];if(i==null){if(WORKER_OFFSCREEN_CANVAS){const s=getFontParameters(e),o=measureText$1(e,"g");i=(isNaN(Number(s.lineHeight))?1.2:Number(s.lineHeight))*(o.actualBoundingBoxAscent+o.actualBoundingBoxDescent)}else n||(n=document.createElement("div"),n.innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=e,document.body.appendChild(n),i=n.offsetHeight,document.body.removeChild(n);textHeights[e]=i}return i}})();function measureText$1(n,e){return measureContext$1||(measureContext$1=createCanvasContext2D(1,1)),n!=measureFont&&(measureContext$1.font=n,measureFont=measureContext$1.font),measureContext$1.measureText(e)}function measureTextWidth(n,e){return measureText$1(n,e).width}function measureAndCacheTextWidth(n,e,i){if(e in i)return i[e];const s=e.split(`
`).reduce((o,l)=>Math.max(o,measureTextWidth(n,l)),0);return i[e]=s,s}function getTextDimensions(n,e){const i=[],s=[],o=[];let l=0,c=0,u=0,f=0;for(let g=0,H=e.length;g<=H;g+=2){const Y=e[g];if(Y===`
`||g===H){l=Math.max(l,c),o.push(c),c=0,u+=f,f=0;continue}const ee=e[g+1]||n.font,te=measureTextWidth(ee,Y);i.push(te),c+=te;const ne=measureTextHeight(ee);s.push(ne),f=Math.max(f,ne)}return{width:l,height:u,widths:i,heights:s,lineWidths:o}}function drawImageOrLabel(n,e,i,s,o,l,c,u,f,g,H){n.save(),i!==1&&(n.globalAlpha===void 0?n.globalAlpha=Y=>Y.globalAlpha*=i:n.globalAlpha*=i),e&&n.transform.apply(n,e),s.contextInstructions?(n.translate(f,g),n.scale(H[0],H[1]),executeLabelInstructions(s,n)):H[0]<0||H[1]<0?(n.translate(f,g),n.scale(H[0],H[1]),n.drawImage(s,o,l,c,u,0,0,c,u)):n.drawImage(s,o,l,c,u,f,g,c*H[0],u*H[1]),n.restore()}function executeLabelInstructions(n,e){const i=n.contextInstructions;for(let s=0,o=i.length;s<o;s+=2)Array.isArray(i[s+1])?e[i[s]].apply(e,i[s+1]):e[i[s]]=i[s+1]}const Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},fillInstruction=[Instruction.FILL],strokeInstruction=[Instruction.STROKE],beginPathInstruction=[Instruction.BEGIN_PATH],closePathInstruction=[Instruction.CLOSE_PATH];class CanvasBuilder extends VectorContext{constructor(e,i,s,o){super(),this.tolerance=e,this.maxExtent=i,this.pixelRatio=o,this.maxLineWidth=0,this.resolution=s,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const i=this.pixelRatio;return i==1?e:e.map(function(s){return s*i})}appendFlatPointCoordinates(e,i){const s=this.getBufferedMaxExtent(),o=this.tmpCoordinate_,l=this.coordinates;let c=l.length;for(let u=0,f=e.length;u<f;u+=i)o[0]=e[u],o[1]=e[u+1],containsCoordinate(s,o)&&(l[c++]=o[0],l[c++]=o[1]);return c}appendFlatLineCoordinates(e,i,s,o,l,c){const u=this.coordinates;let f=u.length;const g=this.getBufferedMaxExtent();c&&(i+=o);let H=e[i],Y=e[i+1];const ee=this.tmpCoordinate_;let te=!0,ne,Ye,xe;for(ne=i+o;ne<s;ne+=o)ee[0]=e[ne],ee[1]=e[ne+1],xe=coordinateRelationship(g,ee),xe!==Ye?(te&&(u[f++]=H,u[f++]=Y,te=!1),u[f++]=ee[0],u[f++]=ee[1]):xe===Relationship.INTERSECTING?(u[f++]=ee[0],u[f++]=ee[1],te=!1):te=!0,H=ee[0],Y=ee[1],Ye=xe;return(l&&te||ne===i+o)&&(u[f++]=H,u[f++]=Y),f}drawCustomCoordinates_(e,i,s,o,l){for(let c=0,u=s.length;c<u;++c){const f=s[c],g=this.appendFlatLineCoordinates(e,i,f,o,!1,!1);l.push(g),i=f}return i}drawCustom(e,i,s,o,l){this.beginGeometry(e,i,l);const c=e.getType(),u=e.getStride(),f=this.coordinates.length;let g,H,Y,ee,te;switch(c){case"MultiPolygon":g=e.getOrientedFlatCoordinates(),ee=[];const ne=e.getEndss();te=0;for(let Ye=0,xe=ne.length;Ye<xe;++Ye){const tt=[];te=this.drawCustomCoordinates_(g,te,ne[Ye],u,tt),ee.push(tt)}this.instructions.push([Instruction.CUSTOM,f,ee,e,s,inflateMultiCoordinatesArray,l]),this.hitDetectionInstructions.push([Instruction.CUSTOM,f,ee,e,o||s,inflateMultiCoordinatesArray,l]);break;case"Polygon":case"MultiLineString":Y=[],g=c=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),te=this.drawCustomCoordinates_(g,0,e.getEnds(),u,Y),this.instructions.push([Instruction.CUSTOM,f,Y,e,s,inflateCoordinatesArray,l]),this.hitDetectionInstructions.push([Instruction.CUSTOM,f,Y,e,o||s,inflateCoordinatesArray,l]);break;case"LineString":case"Circle":g=e.getFlatCoordinates(),H=this.appendFlatLineCoordinates(g,0,g.length,u,!1,!1),this.instructions.push([Instruction.CUSTOM,f,H,e,s,inflateCoordinates,l]),this.hitDetectionInstructions.push([Instruction.CUSTOM,f,H,e,o||s,inflateCoordinates,l]);break;case"MultiPoint":g=e.getFlatCoordinates(),H=this.appendFlatPointCoordinates(g,u),H>f&&(this.instructions.push([Instruction.CUSTOM,f,H,e,s,inflateCoordinates,l]),this.hitDetectionInstructions.push([Instruction.CUSTOM,f,H,e,o||s,inflateCoordinates,l]));break;case"Point":g=e.getFlatCoordinates(),this.coordinates.push(g[0],g[1]),H=this.coordinates.length,this.instructions.push([Instruction.CUSTOM,f,H,e,s,void 0,l]),this.hitDetectionInstructions.push([Instruction.CUSTOM,f,H,e,o||s,void 0,l]);break}this.endGeometry(i)}beginGeometry(e,i,s){this.beginGeometryInstruction1_=[Instruction.BEGIN_GEOMETRY,i,0,e,s],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Instruction.BEGIN_GEOMETRY,i,0,e,s],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let i;const s=e.length;let o,l,c=-1;for(i=0;i<s;++i)o=e[i],l=o[0],l==Instruction.END_GEOMETRY?c=i:l==Instruction.BEGIN_GEOMETRY&&(o[2]=i,reverseSubArray(this.hitDetectionInstructions,c,i),c=-1)}fillStyleToState(e,i={}){if(e){const s=e.getColor();i.fillPatternScale=s&&typeof s=="object"&&"src"in s?this.pixelRatio:1,i.fillStyle=asColorLike(s||defaultFillStyle)}else i.fillStyle=void 0;return i}strokeStyleToState(e,i={}){if(e){const s=e.getColor();i.strokeStyle=asColorLike(s||defaultStrokeStyle);const o=e.getLineCap();i.lineCap=o!==void 0?o:defaultLineCap;const l=e.getLineDash();i.lineDash=l?l.slice():defaultLineDash;const c=e.getLineDashOffset();i.lineDashOffset=c||defaultLineDashOffset;const u=e.getLineJoin();i.lineJoin=u!==void 0?u:defaultLineJoin;const f=e.getWidth();i.lineWidth=f!==void 0?f:defaultLineWidth;const g=e.getMiterLimit();i.miterLimit=g!==void 0?g:defaultMiterLimit,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0;return i}setFillStrokeStyle(e,i){const s=this.state;this.fillStyleToState(e,s),this.strokeStyleToState(i,s)}createFill(e){const i=e.fillStyle,s=[Instruction.SET_FILL_STYLE,i];return typeof i!="string"&&s.push(e.fillPatternScale),s}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[Instruction.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash?this.applyPixelRatio(e.lineDash):null,e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,i){const s=e.fillStyle;(typeof s!="string"||e.currentFillStyle!=s)&&(this.instructions.push(i.call(this,e)),e.currentFillStyle=s)}updateStrokeStyle(e,i){const s=e.strokeStyle,o=e.lineCap,l=e.lineDash,c=e.lineDashOffset,u=e.lineJoin,f=e.lineWidth,g=e.miterLimit;(e.currentStrokeStyle!=s||e.currentLineCap!=o||l!=e.currentLineDash&&!equals$2(e.currentLineDash,l)||e.currentLineDashOffset!=c||e.currentLineJoin!=u||e.currentLineWidth!=f||e.currentMiterLimit!=g)&&(i.call(this,e),e.currentStrokeStyle=s,e.currentLineCap=o,e.currentLineDash=l,e.currentLineDashOffset=c,e.currentLineJoin=u,e.currentLineWidth=f,e.currentMiterLimit=g)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const i=[Instruction.END_GEOMETRY,e];this.instructions.push(i),this.hitDetectionInstructions.push(i)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=clone$1(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;buffer(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class CanvasImageBuilder extends CanvasBuilder{constructor(e,i,s,o){super(e,i,s,o),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,i,s){if(!this.image_||this.maxExtent&&!containsCoordinate(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,i,s);const o=e.getFlatCoordinates(),l=e.getStride(),c=this.coordinates.length,u=this.appendFlatPointCoordinates(o,l);this.instructions.push([Instruction.DRAW_IMAGE,c,u,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,c,u,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(i)}drawMultiPoint(e,i,s){if(!this.image_)return;this.beginGeometry(e,i,s);const o=e.getFlatCoordinates(),l=[];for(let f=0,g=o.length;f<g;f+=e.getStride())(!this.maxExtent||containsCoordinate(this.maxExtent,o.slice(f,f+2)))&&l.push(o[f],o[f+1]);const c=this.coordinates.length,u=this.appendFlatPointCoordinates(l,2);this.instructions.push([Instruction.DRAW_IMAGE,c,u,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,c,u,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(i)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,i){const s=e.getAnchor(),o=e.getSize(),l=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=s[0],this.anchorY_=s[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=o[1],this.opacity_=e.getOpacity(),this.originX_=l[0],this.originY_=l[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=o[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=i}}class CanvasLineStringBuilder extends CanvasBuilder{constructor(e,i,s,o){super(e,i,s,o)}drawFlatCoordinates_(e,i,s,o){const l=this.coordinates.length,c=this.appendFlatLineCoordinates(e,i,s,o,!1,!1),u=[Instruction.MOVE_TO_LINE_TO,l,c];return this.instructions.push(u),this.hitDetectionInstructions.push(u),s}drawLineString(e,i,s){const o=this.state,l=o.strokeStyle,c=o.lineWidth;if(l===void 0||c===void 0)return;this.updateStrokeStyle(o,this.applyStroke),this.beginGeometry(e,i,s),this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,defaultLineDash,defaultLineDashOffset],beginPathInstruction);const u=e.getFlatCoordinates(),f=e.getStride();this.drawFlatCoordinates_(u,0,u.length,f),this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(i)}drawMultiLineString(e,i,s){const o=this.state,l=o.strokeStyle,c=o.lineWidth;if(l===void 0||c===void 0)return;this.updateStrokeStyle(o,this.applyStroke),this.beginGeometry(e,i,s),this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,defaultLineDash,defaultLineDashOffset],beginPathInstruction);const u=e.getEnds(),f=e.getFlatCoordinates(),g=e.getStride();let H=0;for(let Y=0,ee=u.length;Y<ee;++Y)H=this.drawFlatCoordinates_(f,H,u[Y],g);this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(i)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(strokeInstruction),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(strokeInstruction),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(beginPathInstruction)}}class CanvasPolygonBuilder extends CanvasBuilder{constructor(e,i,s,o){super(e,i,s,o)}drawFlatCoordinatess_(e,i,s,o){const l=this.state,c=l.fillStyle!==void 0,u=l.strokeStyle!==void 0,f=s.length;this.instructions.push(beginPathInstruction),this.hitDetectionInstructions.push(beginPathInstruction);for(let g=0;g<f;++g){const H=s[g],Y=this.coordinates.length,ee=this.appendFlatLineCoordinates(e,i,H,o,!0,!u),te=[Instruction.MOVE_TO_LINE_TO,Y,ee];this.instructions.push(te),this.hitDetectionInstructions.push(te),u&&(this.instructions.push(closePathInstruction),this.hitDetectionInstructions.push(closePathInstruction)),i=H}return c&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),u&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),i}drawCircle(e,i,s){const o=this.state,l=o.fillStyle,c=o.strokeStyle;if(l===void 0&&c===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,i,s),o.fillStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),o.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,defaultLineDash,defaultLineDashOffset]);const u=e.getFlatCoordinates(),f=e.getStride(),g=this.coordinates.length;this.appendFlatLineCoordinates(u,0,u.length,f,!1,!1);const H=[Instruction.CIRCLE,g];this.instructions.push(beginPathInstruction,H),this.hitDetectionInstructions.push(beginPathInstruction,H),o.fillStyle!==void 0&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),o.strokeStyle!==void 0&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),this.endGeometry(i)}drawPolygon(e,i,s){const o=this.state,l=o.fillStyle,c=o.strokeStyle;if(l===void 0&&c===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,i,s),o.fillStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),o.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,defaultLineDash,defaultLineDashOffset]);const u=e.getEnds(),f=e.getOrientedFlatCoordinates(),g=e.getStride();this.drawFlatCoordinatess_(f,0,u,g),this.endGeometry(i)}drawMultiPolygon(e,i,s){const o=this.state,l=o.fillStyle,c=o.strokeStyle;if(l===void 0&&c===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,i,s),o.fillStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),o.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,defaultLineDash,defaultLineDashOffset]);const u=e.getEndss(),f=e.getOrientedFlatCoordinates(),g=e.getStride();let H=0;for(let Y=0,ee=u.length;Y<ee;++Y)H=this.drawFlatCoordinatess_(f,H,u[Y],g);this.endGeometry(i)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const i=this.coordinates;for(let s=0,o=i.length;s<o;++s)i[s]=snap(i[s],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;this.updateFillStyle(e,this.createFill),this.updateStrokeStyle(e,this.applyStroke)}}function lineChunk(n,e,i,s,o){const l=[];let c=i,u=0,f=e.slice(i,2);for(;u<n&&c+o<s;){const[g,H]=f.slice(-2),Y=e[c+o],ee=e[c+o+1],te=Math.sqrt((Y-g)*(Y-g)+(ee-H)*(ee-H));if(u+=te,u>=n){const ne=(n-u+te)/te,Ye=lerp(g,Y,ne),xe=lerp(H,ee,ne);f.push(Ye,xe),l.push(f),f=[Ye,xe],u==n&&(c+=o),u=0}else if(u<n)f.push(e[c+o],e[c+o+1]),c+=o;else{const ne=te-u,Ye=lerp(g,Y,ne/te),xe=lerp(H,ee,ne/te);f.push(Ye,xe),l.push(f),f=[Ye,xe],u=0,c+=o}}return u>0&&l.push(f),l}function matchingChunk(n,e,i,s,o){let l=i,c=i,u=0,f=0,g=i,H,Y,ee,te,ne,Ye,xe,tt,et,it;for(Y=i;Y<s;Y+=o){const rt=e[Y],nt=e[Y+1];ne!==void 0&&(et=rt-ne,it=nt-Ye,te=Math.sqrt(et*et+it*it),xe!==void 0&&(f+=ee,H=Math.acos((xe*et+tt*it)/(ee*te)),H>n&&(f>u&&(u=f,l=g,c=Y),f=0,g=Y-o)),ee=te,xe=et,tt=it),ne=rt,Ye=nt}return f+=te,f>u?[g,Y]:[l,c]}const TEXT_ALIGN={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class CanvasTextBuilder extends CanvasBuilder{constructor(e,i,s,o){super(e,i,s,o),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[defaultFillStyle]={fillStyle:defaultFillStyle},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,i,s){const o=this.textFillState_,l=this.textStrokeState_,c=this.textState_;if(this.text_===""||!c||!o&&!l)return;const u=this.coordinates;let f=u.length;const g=e.getType();let H=null,Y=e.getStride();if(c.placement==="line"&&(g=="LineString"||g=="MultiLineString"||g=="Polygon"||g=="MultiPolygon")){if(!intersects$1(this.maxExtent,e.getExtent()))return;let ee;if(H=e.getFlatCoordinates(),g=="LineString")ee=[H.length];else if(g=="MultiLineString")ee=e.getEnds();else if(g=="Polygon")ee=e.getEnds().slice(0,1);else if(g=="MultiPolygon"){const xe=e.getEndss();ee=[];for(let tt=0,et=xe.length;tt<et;++tt)ee.push(xe[tt][0])}this.beginGeometry(e,i,s);const te=c.repeat,ne=te?void 0:c.textAlign;let Ye=0;for(let xe=0,tt=ee.length;xe<tt;++xe){let et;te?et=lineChunk(te*this.resolution,H,Ye,ee[xe],Y):et=[H.slice(Ye,ee[xe])];for(let it=0,rt=et.length;it<rt;++it){const nt=et[it];let at=0,st=nt.length;if(ne==null){const ut=matchingChunk(c.maxAngle,nt,0,nt.length,2);at=ut[0],st=ut[1]}for(let ut=at;ut<st;ut+=Y)u.push(nt[ut],nt[ut+1]);const ot=u.length;Ye=ee[xe],this.drawChars_(f,ot),f=ot}}this.endGeometry(i)}else{let ee=c.overflow?null:[];switch(g){case"Point":case"MultiPoint":H=e.getFlatCoordinates();break;case"LineString":H=e.getFlatMidpoint();break;case"Circle":H=e.getCenter();break;case"MultiLineString":H=e.getFlatMidpoints(),Y=2;break;case"Polygon":H=e.getFlatInteriorPoint(),c.overflow||ee.push(H[2]/this.resolution),Y=3;break;case"MultiPolygon":const rt=e.getFlatInteriorPoints();H=[];for(let nt=0,at=rt.length;nt<at;nt+=3)c.overflow||ee.push(rt[nt+2]/this.resolution),H.push(rt[nt],rt[nt+1]);if(H.length===0)return;Y=2;break}const te=this.appendFlatPointCoordinates(H,Y);if(te===f)return;if(ee&&(te-f)/2!==H.length/Y){let rt=f/2;ee=ee.filter((nt,at)=>{const st=u[(rt+at)*2]===H[at*Y]&&u[(rt+at)*2+1]===H[at*Y+1];return st||--rt,st})}this.saveTextStates_();const ne=c.backgroundFill?this.createFill(this.fillStyleToState(c.backgroundFill)):null,Ye=c.backgroundStroke?this.createStroke(this.strokeStyleToState(c.backgroundStroke)):null;this.beginGeometry(e,i,s);let xe=c.padding;if(xe!=defaultPadding&&(c.scale[0]<0||c.scale[1]<0)){let rt=c.padding[0],nt=c.padding[1],at=c.padding[2],st=c.padding[3];c.scale[0]<0&&(nt=-nt,st=-st),c.scale[1]<0&&(rt=-rt,at=-at),xe=[rt,nt,at,st]}const tt=this.pixelRatio;this.instructions.push([Instruction.DRAW_IMAGE,f,te,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,xe==defaultPadding?defaultPadding:xe.map(function(rt){return rt*tt}),ne,Ye,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,ee]);const et=1/tt,it=ne?ne.slice(0):null;it&&(it[1]=defaultFillStyle),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,f,te,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[et,et],NaN,this.declutterMode_,this.declutterImageWithText_,xe,it,Ye,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?defaultFillStyle:this.fillKey_,this.textOffsetX_,this.textOffsetY_,ee]),this.endGeometry(i)}}saveTextStates_(){const e=this.textStrokeState_,i=this.textState_,s=this.textFillState_,o=this.strokeKey_;e&&(o in this.strokeStates||(this.strokeStates[o]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const l=this.textKey_;l in this.textStates||(this.textStates[l]={font:i.font,textAlign:i.textAlign||defaultTextAlign,justify:i.justify,textBaseline:i.textBaseline||defaultTextBaseline,scale:i.scale});const c=this.fillKey_;s&&(c in this.fillStates||(this.fillStates[c]={fillStyle:s.fillStyle}))}drawChars_(e,i){const s=this.textStrokeState_,o=this.textState_,l=this.strokeKey_,c=this.textKey_,u=this.fillKey_;this.saveTextStates_();const f=this.pixelRatio,g=TEXT_ALIGN[o.textBaseline],H=this.textOffsetY_*f,Y=this.text_,ee=s?s.lineWidth*Math.abs(o.scale[0])/2:0;this.instructions.push([Instruction.DRAW_CHARS,e,i,g,o.overflow,u,o.maxAngle,f,H,l,ee*f,Y,c,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([Instruction.DRAW_CHARS,e,i,g,o.overflow,u&&defaultFillStyle,o.maxAngle,f,H,l,ee*f,Y,c,1/f,this.declutterMode_,this.textKeepUpright_])}setTextStyle(e,i){let s,o,l;if(!e)this.text_="";else{const c=e.getFill();c?(o=this.textFillState_,o||(o={},this.textFillState_=o),o.fillStyle=asColorLike(c.getColor()||defaultFillStyle)):(o=null,this.textFillState_=o);const u=e.getStroke();if(!u)l=null,this.textStrokeState_=l;else{l=this.textStrokeState_,l||(l={},this.textStrokeState_=l);const Ye=u.getLineDash(),xe=u.getLineDashOffset(),tt=u.getWidth(),et=u.getMiterLimit();l.lineCap=u.getLineCap()||defaultLineCap,l.lineDash=Ye?Ye.slice():defaultLineDash,l.lineDashOffset=xe===void 0?defaultLineDashOffset:xe,l.lineJoin=u.getLineJoin()||defaultLineJoin,l.lineWidth=tt===void 0?defaultLineWidth:tt,l.miterLimit=et===void 0?defaultMiterLimit:et,l.strokeStyle=asColorLike(u.getColor()||defaultStrokeStyle)}s=this.textState_;const f=e.getFont()||defaultFont;registerFont(f);const g=e.getScaleArray();s.overflow=e.getOverflow(),s.font=f,s.maxAngle=e.getMaxAngle(),s.placement=e.getPlacement(),s.textAlign=e.getTextAlign(),s.repeat=e.getRepeat(),s.justify=e.getJustify(),s.textBaseline=e.getTextBaseline()||defaultTextBaseline,s.backgroundFill=e.getBackgroundFill(),s.backgroundStroke=e.getBackgroundStroke(),s.padding=e.getPadding()||defaultPadding,s.scale=g===void 0?[1,1]:g;const H=e.getOffsetX(),Y=e.getOffsetY(),ee=e.getRotateWithView(),te=e.getKeepUpright(),ne=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=H===void 0?0:H,this.textOffsetY_=Y===void 0?0:Y,this.textRotateWithView_=ee===void 0?!1:ee,this.textKeepUpright_=te===void 0?!0:te,this.textRotation_=ne===void 0?0:ne,this.strokeKey_=l?(typeof l.strokeStyle=="string"?l.strokeStyle:getUid(l.strokeStyle))+l.lineCap+l.lineDashOffset+"|"+l.lineWidth+l.lineJoin+l.miterLimit+"["+l.lineDash.join()+"]":"",this.textKey_=s.font+s.scale+(s.textAlign||"?")+(s.repeat||"?")+(s.justify||"?")+(s.textBaseline||"?"),this.fillKey_=o&&o.fillStyle?typeof o.fillStyle=="string"?o.fillStyle:"|"+getUid(o.fillStyle):""}this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=i}}const BATCH_CONSTRUCTORS={Circle:CanvasPolygonBuilder,Default:CanvasBuilder,Image:CanvasImageBuilder,LineString:CanvasLineStringBuilder,Polygon:CanvasPolygonBuilder,Text:CanvasTextBuilder};class BuilderGroup{constructor(e,i,s,o){this.tolerance_=e,this.maxExtent_=i,this.pixelRatio_=o,this.resolution_=s,this.buildersByZIndex_={}}finish(){const e={};for(const i in this.buildersByZIndex_){e[i]=e[i]||{};const s=this.buildersByZIndex_[i];for(const o in s){const l=s[o].finish();e[i][o]=l}}return e}getBuilder(e,i){const s=e!==void 0?e.toString():"0";let o=this.buildersByZIndex_[s];o===void 0&&(o={},this.buildersByZIndex_[s]=o);let l=o[i];if(l===void 0){const c=BATCH_CONSTRUCTORS[i];l=new c(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),o[i]=l}return l}}function drawTextOnPath(n,e,i,s,o,l,c,u,f,g,H,Y,ee=!0){let te=n[e],ne=n[e+1],Ye=0,xe=0,tt=0,et=0;function it(){Ye=te,xe=ne,e+=s,te=n[e],ne=n[e+1],et+=tt,tt=Math.sqrt((te-Ye)*(te-Ye)+(ne-xe)*(ne-xe))}do it();while(e<i-s&&et+tt<l);let rt=tt===0?0:(l-et)/tt;const nt=lerp(Ye,te,rt),at=lerp(xe,ne,rt),st=e-s,ot=et,ut=l+u*f(g,o,H);for(;e<i-s&&et+tt<ut;)it();rt=tt===0?0:(ut-et)/tt;const ht=lerp(Ye,te,rt),dt=lerp(xe,ne,rt);let pt=!1;if(ee)if(Y){const Rt=[nt,at,ht,dt];rotate(Rt,0,4,2,Y,Rt,Rt),pt=Rt[0]>Rt[2]}else pt=nt>ht;const yt=Math.PI,mt=[],St=st+s===e;e=st,tt=0,et=ot,te=n[e],ne=n[e+1];let wt;if(St){it(),wt=Math.atan2(ne-xe,te-Ye),pt&&(wt+=wt>0?-yt:yt);const Rt=(ht+nt)/2,Lt=(dt+at)/2;return mt[0]=[Rt,Lt,(ut-l)/2,wt,o],mt}o=o.replace(/\n/g," ");for(let Rt=0,Lt=o.length;Rt<Lt;){it();let Gt=Math.atan2(ne-xe,te-Ye);if(pt&&(Gt+=Gt>0?-yt:yt),wt!==void 0){let ft=Gt-wt;if(ft+=ft>yt?-2*yt:ft<-yt?2*yt:0,Math.abs(ft)>c)return null}wt=Gt;const vt=Rt;let Et=0;for(;Rt<Lt;++Rt){const ft=pt?Lt-Rt-1:Rt,bt=u*f(g,o[ft],H);if(e+s<i&&et+tt<l+Et+bt/2)break;Et+=bt}if(Rt===vt)continue;const _t=pt?o.substring(Lt-vt,Lt-Rt):o.substring(vt,Rt);rt=tt===0?0:(l+Et/2-et)/tt;const Ct=lerp(Ye,te,rt),ct=lerp(xe,ne,rt);mt.push([Ct,ct,Et/2,Gt,_t]),l+=Et}return mt}class ZIndexContext{constructor(){ii(this,"pushMethodArgs_",(...e)=>(this.push_(e),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(getSharedCanvasContext2D(),{get:(e,i)=>{if(typeof getSharedCanvasContext2D()[i]=="function")return this.push_(i),this.pushMethodArgs_},set:(e,i,s)=>(this.push_(i,s),!0)})}push_(...e){const i=this.instructions_,s=this.zIndex+this.offset_;i[s]||(i[s]=[]),i[s].push(...e)}pushFunction(e){this.push_(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach(i=>{for(let s=0,o=i.length;s<o;++s){const l=i[s];if(typeof l=="function"){l(e);continue}const c=i[++s];if(typeof e[l]=="function")e[l](...c);else{if(typeof c=="function"){e[l]=c(e);continue}e[l]=c}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const tmpExtent=createEmpty(),p1=[],p2=[],p3=[],p4=[];function getDeclutterBox(n){return n[3].declutterBox}const rtlRegEx=new RegExp("[-----]");function horizontalTextAlign(n,e){return e==="start"?e=rtlRegEx.test(n)?"right":"left":e==="end"&&(e=rtlRegEx.test(n)?"left":"right"),TEXT_ALIGN[e]}function createTextChunks(n,e,i){return i>0&&n.push(`
`,""),n.push(e,""),n}function richTextToPlainText(n,e,i){return i%2===0&&(n+=e),n}class Executor{constructor(e,i,s,o,l){this.overlaps=s,this.pixelRatio=i,this.resolution=e,this.alignAndScaleFill_,this.instructions=o.instructions,this.coordinates=o.coordinates,this.coordinateCache_={},this.renderedTransform_=create(),this.hitDetectionInstructions=o.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=o.fillStates||{},this.strokeStates=o.strokeStates||{},this.textStates=o.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=l?new ZIndexContext:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,i,s,o){const l=e+i+s+o;if(this.labels_[l])return this.labels_[l];const c=o?this.strokeStates[o]:null,u=s?this.fillStates[s]:null,f=this.textStates[i],g=this.pixelRatio,H=[f.scale[0]*g,f.scale[1]*g],Y=f.justify?TEXT_ALIGN[f.justify]:horizontalTextAlign(Array.isArray(e)?e[0]:e,f.textAlign||defaultTextAlign),ee=o&&c.lineWidth?c.lineWidth:0,te=Array.isArray(e)?e:String(e).split(`
`).reduce(createTextChunks,[]),{width:ne,height:Ye,widths:xe,heights:tt,lineWidths:et}=getTextDimensions(f,te),it=ne+ee,rt=[],nt=(it+2)*H[0],at=(Ye+ee)*H[1],st={width:nt<0?Math.floor(nt):Math.ceil(nt),height:at<0?Math.floor(at):Math.ceil(at),contextInstructions:rt};(H[0]!=1||H[1]!=1)&&rt.push("scale",H),o&&(rt.push("strokeStyle",c.strokeStyle),rt.push("lineWidth",ee),rt.push("lineCap",c.lineCap),rt.push("lineJoin",c.lineJoin),rt.push("miterLimit",c.miterLimit),rt.push("setLineDash",[c.lineDash]),rt.push("lineDashOffset",c.lineDashOffset)),s&&rt.push("fillStyle",u.fillStyle),rt.push("textBaseline","middle"),rt.push("textAlign","center");const ot=.5-Y;let ut=Y*it+ot*ee;const ht=[],dt=[];let pt=0,yt=0,mt=0,St=0,wt;for(let Rt=0,Lt=te.length;Rt<Lt;Rt+=2){const Gt=te[Rt];if(Gt===`
`){yt+=pt,pt=0,ut=Y*it+ot*ee,++St;continue}const vt=te[Rt+1]||f.font;vt!==wt&&(o&&ht.push("font",vt),s&&dt.push("font",vt),wt=vt),pt=Math.max(pt,tt[mt]);const Et=[Gt,ut+ot*xe[mt]+Y*(xe[mt]-et[St]),.5*(ee+pt)+yt];ut+=xe[mt],o&&ht.push("strokeText",Et),s&&dt.push("fillText",Et),++mt}return Array.prototype.push.apply(rt,ht),Array.prototype.push.apply(rt,dt),this.labels_[l]=st,st}replayTextBackground_(e,i,s,o,l,c,u){e.beginPath(),e.moveTo.apply(e,i),e.lineTo.apply(e,s),e.lineTo.apply(e,o),e.lineTo.apply(e,l),e.lineTo.apply(e,i),c&&(this.alignAndScaleFill_=c[2],e.fillStyle=c[1],this.fill_(e)),u&&(this.setStrokeStyle_(e,u),e.stroke())}calculateImageOrLabelDimensions_(e,i,s,o,l,c,u,f,g,H,Y,ee,te,ne,Ye,xe){u*=ee[0],f*=ee[1];let tt=s-u,et=o-f;const it=l+g>e?e-g:l,rt=c+H>i?i-H:c,nt=ne[3]+it*ee[0]+ne[1],at=ne[0]+rt*ee[1]+ne[2],st=tt-ne[3],ot=et-ne[0];(Ye||Y!==0)&&(p1[0]=st,p4[0]=st,p1[1]=ot,p2[1]=ot,p2[0]=st+nt,p3[0]=p2[0],p3[1]=ot+at,p4[1]=p3[1]);let ut;return Y!==0?(ut=compose(create(),s,o,1,1,Y,-s,-o),apply(ut,p1),apply(ut,p2),apply(ut,p3),apply(ut,p4),createOrUpdate$2(Math.min(p1[0],p2[0],p3[0],p4[0]),Math.min(p1[1],p2[1],p3[1],p4[1]),Math.max(p1[0],p2[0],p3[0],p4[0]),Math.max(p1[1],p2[1],p3[1],p4[1]),tmpExtent)):createOrUpdate$2(Math.min(st,st+nt),Math.min(ot,ot+at),Math.max(st,st+nt),Math.max(ot,ot+at),tmpExtent),te&&(tt=Math.round(tt),et=Math.round(et)),{drawImageX:tt,drawImageY:et,drawImageW:it,drawImageH:rt,originX:g,originY:H,declutterBox:{minX:tmpExtent[0],minY:tmpExtent[1],maxX:tmpExtent[2],maxY:tmpExtent[3],value:xe},canvasTransform:ut,scale:ee}}replayImageOrLabel_(e,i,s,o,l,c,u){const f=!!(c||u),g=o.declutterBox,H=u?u[2]*o.scale[0]/2:0;return g.minX-H<=i[0]&&g.maxX+H>=0&&g.minY-H<=i[1]&&g.maxY+H>=0&&(f&&this.replayTextBackground_(e,p1,p2,p3,p4,c,u),drawImageOrLabel(e,o.canvasTransform,l,s,o.originX,o.originY,o.drawImageW,o.drawImageH,o.drawImageX,o.drawImageY,o.scale)),!0}fill_(e){const i=this.alignAndScaleFill_;if(i){const s=apply(this.renderedTransform_,[0,0]),o=512*this.pixelRatio;e.save(),e.translate(s[0]%o,s[1]%o),i!==1&&e.scale(i,i),e.rotate(this.viewRotation_)}e.fill(),i&&e.restore()}setStrokeStyle_(e,i){e.strokeStyle=i[1],i[1]&&(e.lineWidth=i[2],e.lineCap=i[3],e.lineJoin=i[4],e.miterLimit=i[5],e.lineDashOffset=i[7],e.setLineDash(i[6]))}drawLabelWithPointPlacement_(e,i,s,o){const l=this.textStates[i],c=this.createLabel(e,i,o,s),u=this.strokeStates[s],f=this.pixelRatio,g=horizontalTextAlign(Array.isArray(e)?e[0]:e,l.textAlign||defaultTextAlign),H=TEXT_ALIGN[l.textBaseline||defaultTextBaseline],Y=u&&u.lineWidth?u.lineWidth:0,ee=c.width/f-2*l.scale[0],te=g*ee+2*(.5-g)*Y,ne=H*c.height/f+2*(.5-H)*Y;return{label:c,anchorX:te,anchorY:ne}}execute_(e,i,s,o,l,c,u,f){const g=this.zIndexContext_;let H;this.pixelCoordinates_&&equals$2(s,this.renderedTransform_)?H=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),H=transform2D(this.coordinates,0,this.coordinates.length,2,s,this.pixelCoordinates_),setFromArray(this.renderedTransform_,s));let Y=0;const ee=o.length;let te=0,ne,Ye,xe,tt,et,it,rt,nt,at,st,ot,ut,ht,dt=0,pt=0;const yt=this.coordinateCache_,mt=this.viewRotation_,St=Math.round(Math.atan2(-s[1],s[0])*1e12)/1e12,wt={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:mt},Rt=this.instructions!=o||this.overlaps?0:200;let Lt,Gt,vt,Et;for(;Y<ee;){const _t=o[Y];switch(_t[0]){case Instruction.BEGIN_GEOMETRY:Lt=_t[1],Et=_t[3],Lt.getGeometry()?u!==void 0&&!intersects$1(u,Et.getExtent())?Y=_t[2]+1:++Y:Y=_t[2],g&&(g.zIndex=_t[4]);break;case Instruction.BEGIN_PATH:dt>Rt&&(this.fill_(e),dt=0),pt>Rt&&(e.stroke(),pt=0),!dt&&!pt&&(e.beginPath(),et=NaN,it=NaN),++Y;break;case Instruction.CIRCLE:te=_t[1];const ct=H[te],ft=H[te+1],bt=H[te+2],Ft=H[te+3],Bt=bt-ct,Xt=Ft-ft,Ot=Math.sqrt(Bt*Bt+Xt*Xt);e.moveTo(ct+Ot,ft),e.arc(ct,ft,Ot,0,2*Math.PI,!0),++Y;break;case Instruction.CLOSE_PATH:e.closePath(),++Y;break;case Instruction.CUSTOM:te=_t[1],ne=_t[2];const It=_t[3],xt=_t[4],Tt=_t[5];wt.geometry=It,wt.feature=Lt,Y in yt||(yt[Y]=[]);const Ht=yt[Y];Tt?Tt(H,te,ne,2,Ht):(Ht[0]=H[te],Ht[1]=H[te+1],Ht.length=2),g&&(g.zIndex=_t[6]),xt(Ht,wt),++Y;break;case Instruction.DRAW_IMAGE:te=_t[1],ne=_t[2],at=_t[3],Ye=_t[4],xe=_t[5];let Dt=_t[6];const qt=_t[7],kt=_t[8],$t=_t[9],Ut=_t[10];let zt=_t[11];const Yt=_t[12];let Jt=_t[13];tt=_t[14]||"declutter";const Pt=_t[15];if(!at&&_t.length>=20){st=_t[19],ot=_t[20],ut=_t[21],ht=_t[22];const di=this.drawLabelWithPointPlacement_(st,ot,ut,ht);at=di.label,_t[3]=at;const xi=_t[23];Ye=(di.anchorX-xi)*this.pixelRatio,_t[4]=Ye;const Ai=_t[24];xe=(di.anchorY-Ai)*this.pixelRatio,_t[5]=xe,Dt=at.height,_t[6]=Dt,Jt=at.width,_t[13]=Jt}let Mt;_t.length>25&&(Mt=_t[25]);let Nt,Wt,Vt;_t.length>17?(Nt=_t[16],Wt=_t[17],Vt=_t[18]):(Nt=defaultPadding,Wt=null,Vt=null),Ut&&St?zt+=mt:!Ut&&!St&&(zt-=mt);let Kt=0;for(;te<ne;te+=2){if(Mt&&Mt[Kt++]<Jt/this.pixelRatio)continue;const di=this.calculateImageOrLabelDimensions_(at.width,at.height,H[te],H[te+1],Jt,Dt,Ye,xe,kt,$t,zt,Yt,l,Nt,!!Wt||!!Vt,Lt),xi=[e,i,at,di,qt,Wt,Vt];if(f){let Ai,Ii,ti;if(Pt){const ci=ne-te;if(!Pt[ci]){Pt[ci]={args:xi,declutterMode:tt};continue}const yi=Pt[ci];Ai=yi.args,Ii=yi.declutterMode,delete Pt[ci],ti=getDeclutterBox(Ai)}let _i,wi;if(Ai&&(Ii!=="declutter"||!f.collides(ti))&&(_i=!0),(tt!=="declutter"||!f.collides(di.declutterBox))&&(wi=!0),Ii==="declutter"&&tt==="declutter"){const ci=_i&&wi;_i=ci,wi=ci}_i&&(Ii!=="none"&&f.insert(ti),this.replayImageOrLabel_.apply(this,Ai)),wi&&(tt!=="none"&&f.insert(di.declutterBox),this.replayImageOrLabel_.apply(this,xi))}else this.replayImageOrLabel_.apply(this,xi)}++Y;break;case Instruction.DRAW_CHARS:const Zt=_t[1],Qt=_t[2],ri=_t[3],ai=_t[4];ht=_t[5];const hi=_t[6],ui=_t[7],pi=_t[8];ut=_t[9];const oi=_t[10];st=_t[11],Array.isArray(st)&&(st=st.reduce(richTextToPlainText,"")),ot=_t[12];const ei=[_t[13],_t[13]];tt=_t[14]||"declutter";const li=_t[15],si=this.textStates[ot],ni=si.font,fi=[si.scale[0]*ui,si.scale[1]*ui];let Ei;ni in this.widths_?Ei=this.widths_[ni]:(Ei={},this.widths_[ni]=Ei);const mi=lineStringLength(H,Zt,Qt,2),Ci=Math.abs(fi[0])*measureAndCacheTextWidth(ni,st,Ei);if(ai||Ci<=mi){const di=this.textStates[ot].textAlign,xi=(mi-Ci)*horizontalTextAlign(st,di),Ai=drawTextOnPath(H,Zt,Qt,2,st,xi,hi,Math.abs(fi[0]),measureAndCacheTextWidth,ni,Ei,St?0:this.viewRotation_,li);e:if(Ai){const Ii=[];let ti,_i,wi,ci,yi;if(ut)for(ti=0,_i=Ai.length;ti<_i;++ti){yi=Ai[ti],wi=yi[4],ci=this.createLabel(wi,ot,"",ut),Ye=yi[2]+(fi[0]<0?-oi:oi),xe=ri*ci.height+(.5-ri)*2*oi*fi[1]/fi[0]-pi;const bi=this.calculateImageOrLabelDimensions_(ci.width,ci.height,yi[0],yi[1],ci.width,ci.height,Ye,xe,0,0,yi[3],ei,!1,defaultPadding,!1,Lt);if(f&&tt==="declutter"&&f.collides(bi.declutterBox))break e;Ii.push([e,i,ci,bi,1,null,null])}if(ht)for(ti=0,_i=Ai.length;ti<_i;++ti){yi=Ai[ti],wi=yi[4],ci=this.createLabel(wi,ot,ht,""),Ye=yi[2],xe=ri*ci.height-pi;const bi=this.calculateImageOrLabelDimensions_(ci.width,ci.height,yi[0],yi[1],ci.width,ci.height,Ye,xe,0,0,yi[3],ei,!1,defaultPadding,!1,Lt);if(f&&tt==="declutter"&&f.collides(bi.declutterBox))break e;Ii.push([e,i,ci,bi,1,null,null])}f&&tt!=="none"&&f.load(Ii.map(getDeclutterBox));for(let bi=0,ki=Ii.length;bi<ki;++bi)this.replayImageOrLabel_.apply(this,Ii[bi])}}++Y;break;case Instruction.END_GEOMETRY:if(c!==void 0){Lt=_t[1];const di=c(Lt,Et,tt);if(di)return di}++Y;break;case Instruction.FILL:Rt?dt++:this.fill_(e),++Y;break;case Instruction.MOVE_TO_LINE_TO:for(te=_t[1],ne=_t[2],Gt=H[te],vt=H[te+1],e.moveTo(Gt,vt),et=Gt+.5|0,it=vt+.5|0,te+=2;te<ne;te+=2)Gt=H[te],vt=H[te+1],rt=Gt+.5|0,nt=vt+.5|0,(te==ne-2||rt!==et||nt!==it)&&(e.lineTo(Gt,vt),et=rt,it=nt);++Y;break;case Instruction.SET_FILL_STYLE:this.alignAndScaleFill_=_t[2],dt&&(this.fill_(e),dt=0,pt&&(e.stroke(),pt=0)),e.fillStyle=_t[1],++Y;break;case Instruction.SET_STROKE_STYLE:pt&&(e.stroke(),pt=0),this.setStrokeStyle_(e,_t),++Y;break;case Instruction.STROKE:Rt?pt++:e.stroke(),++Y;break;default:++Y;break}}dt&&this.fill_(e),pt&&e.stroke()}execute(e,i,s,o,l,c){this.viewRotation_=o,this.execute_(e,i,s,this.instructions,l,void 0,void 0,c)}executeHitDetection(e,i,s,o,l){return this.viewRotation_=s,this.execute_(e,[e.canvas.width,e.canvas.height],i,this.hitDetectionInstructions,!0,o,l)}}const ALL=["Polygon","Circle","LineString","Image","Text","Default"],DECLUTTER=["Image","Text"],NON_DECLUTTER=ALL.filter(n=>!DECLUTTER.includes(n));class ExecutorGroup{constructor(e,i,s,o,l,c,u){this.maxExtent_=e,this.overlaps_=o,this.pixelRatio_=s,this.resolution_=i,this.renderBuffer_=c,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=create(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(l,u)}clip(e,i){const s=this.getClipCoords(i);e.beginPath(),e.moveTo(s[0],s[1]),e.lineTo(s[2],s[3]),e.lineTo(s[4],s[5]),e.lineTo(s[6],s[7]),e.clip()}createExecutors_(e,i){for(const s in e){let o=this.executorsByZIndex_[s];o===void 0&&(o={},this.executorsByZIndex_[s]=o);const l=e[s];for(const c in l){const u=l[c];o[c]=new Executor(this.resolution_,this.pixelRatio_,this.overlaps_,u,i)}}}hasExecutors(e){for(const i in this.executorsByZIndex_){const s=this.executorsByZIndex_[i];for(let o=0,l=e.length;o<l;++o)if(e[o]in s)return!0}return!1}forEachFeatureAtCoordinate(e,i,s,o,l,c){o=Math.round(o);const u=o*2+1,f=compose(this.hitDetectionTransform_,o+.5,o+.5,1/i,-1/i,-s,-e[0],-e[1]),g=!this.hitDetectionContext_;g&&(this.hitDetectionContext_=createCanvasContext2D(u,u));const H=this.hitDetectionContext_;H.canvas.width!==u||H.canvas.height!==u?(H.canvas.width=u,H.canvas.height=u):g||H.clearRect(0,0,u,u);let Y;this.renderBuffer_!==void 0&&(Y=createEmpty(),extendCoordinate(Y,e),buffer(Y,i*(this.renderBuffer_+o),Y));const ee=getPixelIndexArray(o);let te;function ne(nt,at,st){const ot=H.getImageData(0,0,u,u).data;for(let ut=0,ht=ee.length;ut<ht;ut++)if(ot[ee[ut]]>0){if(!c||st==="none"||te!=="Image"&&te!=="Text"||c.includes(nt)){const dt=(ee[ut]-3)/4,pt=o-dt%u,yt=o-(dt/u|0),mt=l(nt,at,pt*pt+yt*yt);if(mt)return mt}H.clearRect(0,0,u,u);break}}const Ye=Object.keys(this.executorsByZIndex_).map(Number);Ye.sort(ascending);let xe,tt,et,it,rt;for(xe=Ye.length-1;xe>=0;--xe){const nt=Ye[xe].toString();for(et=this.executorsByZIndex_[nt],tt=ALL.length-1;tt>=0;--tt)if(te=ALL[tt],it=et[te],it!==void 0&&(rt=it.executeHitDetection(H,f,s,ne,Y),rt))return rt}}getClipCoords(e){const i=this.maxExtent_;if(!i)return null;const s=i[0],o=i[1],l=i[2],c=i[3],u=[s,o,s,c,l,c,l,o];return transform2D(u,0,8,2,e,u),u}isEmpty(){return isEmpty$1(this.executorsByZIndex_)}execute(e,i,s,o,l,c,u){const f=Object.keys(this.executorsByZIndex_).map(Number);f.sort(u?descending:ascending),c=c||ALL;const g=ALL.length;for(let H=0,Y=f.length;H<Y;++H){const ee=f[H].toString(),te=this.executorsByZIndex_[ee];for(let ne=0,Ye=c.length;ne<Ye;++ne){const xe=c[ne],tt=te[xe];if(tt!==void 0){const et=u===null?void 0:tt.getZIndexContext(),it=et?et.getContext():e,rt=this.maxExtent_&&xe!=="Image"&&xe!=="Text";if(rt&&(it.save(),this.clip(it,s)),!et||xe==="Text"||xe==="Image"?tt.execute(it,i,s,o,l,u):et.pushFunction(nt=>tt.execute(nt,i,s,o,l,u)),rt&&it.restore(),et){et.offset();const nt=f[H]*g+ALL.indexOf(xe);this.deferredZIndexContexts_[nt]||(this.deferredZIndexContexts_[nt]=[]),this.deferredZIndexContexts_[nt].push(et)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const e=this.deferredZIndexContexts_,i=Object.keys(e).map(Number).sort(ascending);for(let s=0,o=i.length;s<o;++s)e[i[s]].forEach(l=>{l.draw(this.renderedContext_),l.clear()}),e[i[s]].length=0}}const circlePixelIndexArrayCache={};function getPixelIndexArray(n){if(circlePixelIndexArrayCache[n]!==void 0)return circlePixelIndexArrayCache[n];const e=n*2+1,i=n*n,s=new Array(i+1);for(let l=0;l<=n;++l)for(let c=0;c<=n;++c){const u=l*l+c*c;if(u>i)break;let f=s[u];f||(f=[],s[u]=f),f.push(((n+l)*e+(n+c))*4+3),l>0&&f.push(((n-l)*e+(n+c))*4+3),c>0&&(f.push(((n+l)*e+(n-c))*4+3),l>0&&f.push(((n-l)*e+(n-c))*4+3))}const o=[];for(let l=0,c=s.length;l<c;++l)s[l]&&o.push(...s[l]);return circlePixelIndexArrayCache[n]=o,o}class ImageStyle{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=toSize(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new ImageStyle({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return abstract()}getImage(e){return abstract()}getHitDetectionImage(){return abstract()}getPixelRatio(e){return 1}getImageState(){return abstract()}getImageSize(){return abstract()}getOrigin(){return abstract()}getSize(){return abstract()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=toSize(e)}listenImageChange(e){abstract()}load(){abstract()}unlistenImageChange(e){abstract()}ready(){return Promise.resolve()}}class RegularShape extends ImageStyle{constructor(e){super({opacity:1,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius=e.radius,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?ImageState.LOADING:ImageState.LOADED,this.imageState_===ImageState.LOADING&&this.ready().then(()=>this.imageState_=ImageState.LOADED),this.render()}clone(){const e=this.getScale(),i=new RegularShape({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return i.setOpacity(this.getOpacity()),i}getAnchor(){const e=this.size_,i=this.getDisplacement(),s=this.getScaleArray();return[e[0]/2-i[0]/s[0],e[1]/2+i[1]/s[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){var l,c;const i=(l=this.fill_)==null?void 0:l.getKey(),s=`${e},${this.angle_},${this.radius},${this.radius2_},${this.points_},${i}`+Object.values(this.renderOptions_).join(",");let o=(c=shared.get(s,null,null))==null?void 0:c.getImage(1);if(!o){const u=this.renderOptions_,f=Math.ceil(u.size*e),g=createCanvasContext2D(f,f);this.draw_(u,g,e),o=g.canvas,shared.set(s,null,null,new IconImage(o,void 0,null,ImageState.LOADED,null))}return o}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,i,s){if(i===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return i;let o=this.radius,l=this.radius2_===void 0?o:this.radius2_;if(o<l){const at=o;o=l,l=at}const c=this.radius2_===void 0?this.points_:this.points_*2,u=2*Math.PI/c,f=l*Math.sin(u),g=Math.sqrt(l*l-f*f),H=o-g,Y=Math.sqrt(f*f+H*H),ee=Y/f;if(e==="miter"&&ee<=s)return ee*i;const te=i/2/ee,ne=i/2*(H/Y),xe=Math.sqrt((o+te)*(o+te)+ne*ne)-o;if(this.radius2_===void 0||e==="bevel")return xe*2;const tt=o*Math.sin(u),et=Math.sqrt(o*o-tt*tt),it=l-et,nt=Math.sqrt(tt*tt+it*it)/tt;if(nt<=s){const at=nt*i/2-l-o;return 2*Math.max(xe,at)}return xe*2}createRenderOptions(){let e=defaultLineCap,i=defaultLineJoin,s=0,o=null,l=0,c,u=0;this.stroke_&&(c=asColorLike(this.stroke_.getColor()??defaultStrokeStyle),u=this.stroke_.getWidth()??defaultLineWidth,o=this.stroke_.getLineDash(),l=this.stroke_.getLineDashOffset()??0,i=this.stroke_.getLineJoin()??defaultLineJoin,e=this.stroke_.getLineCap()??defaultLineCap,s=this.stroke_.getMiterLimit()??defaultMiterLimit);const f=this.calculateLineJoinSize_(i,u,s),g=Math.max(this.radius,this.radius2_||0),H=Math.ceil(2*g+f);return{strokeStyle:c,strokeWidth:u,size:H,lineCap:e,lineDash:o,lineDashOffset:l,lineJoin:i,miterLimit:s}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,i,s){if(i.scale(s,s),i.translate(e.size/2,e.size/2),this.createPath_(i),this.fill_){let o=this.fill_.getColor();o===null&&(o=defaultFillStyle),i.fillStyle=asColorLike(o),i.fill()}e.strokeStyle&&(i.strokeStyle=e.strokeStyle,i.lineWidth=e.strokeWidth,e.lineDash&&(i.setLineDash(e.lineDash),i.lineDashOffset=e.lineDashOffset),i.lineCap=e.lineCap,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit,i.stroke())}createHitDetectionCanvas_(e){let i;if(this.fill_){let s=this.fill_.getColor(),o=0;typeof s=="string"&&(s=asArray(s)),s===null?o=1:Array.isArray(s)&&(o=s.length===4?s[3]:1),o===0&&(i=createCanvasContext2D(e.size,e.size),this.drawHitDetectionCanvas_(e,i))}return i?i.canvas:this.getImage(1)}createPath_(e){let i=this.points_;const s=this.radius;if(i===1/0)e.arc(0,0,s,0,2*Math.PI);else{const o=this.radius2_===void 0?s:this.radius2_;this.radius2_!==void 0&&(i*=2);const l=this.angle_-Math.PI/2,c=2*Math.PI/i;for(let u=0;u<i;u++){const f=l+u*c,g=u%2===0?s:o;e.lineTo(g*Math.cos(f),g*Math.sin(f))}e.closePath()}}drawHitDetectionCanvas_(e,i){i.translate(e.size/2,e.size/2),this.createPath_(i),i.fillStyle=defaultFillStyle,i.fill(),e.strokeStyle&&(i.strokeStyle=e.strokeStyle,i.lineWidth=e.strokeWidth,e.lineDash&&(i.setLineDash(e.lineDash),i.lineDashOffset=e.lineDashOffset),i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit,i.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class CircleStyle extends RegularShape{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),i=new CircleStyle({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return i.setOpacity(this.getOpacity()),i}setRadius(e){this.radius=e,this.render()}}class Fill{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,e.color!==void 0&&this.setColor(e.color)}clone(){const e=this.getColor();return new Fill({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(e!==null&&typeof e=="object"&&"src"in e){const i=get$2(null,e.src,"anonymous",void 0,e.offset?null:e.color?e.color:null,!(e.offset&&e.size));i.ready().then(()=>{this.patternImage_=null}),i.getImageState()===ImageState.IDLE&&i.load(),i.getImageState()===ImageState.LOADING&&(this.patternImage_=i)}this.color_=e}getKey(){const e=this.getColor();return e?e instanceof CanvasPattern||e instanceof CanvasGradient?getUid(e):typeof e=="object"&&"src"in e?e.src+":"+e.offset:asArray(e).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function calculateScale(n,e,i,s){return i!==void 0&&s!==void 0?[i/n,s/e]:i!==void 0?i/n:s!==void 0?s/e:1}class Icon extends ImageStyle{constructor(e){e=e||{};const i=e.opacity!==void 0?e.opacity:1,s=e.rotation!==void 0?e.rotation:0,o=e.scale!==void 0?e.scale:1,l=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:i,rotation:s,scale:o,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:l,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const c=e.img!==void 0?e.img:null;let u=e.src;assert(!(u!==void 0&&c),"`image` and `src` cannot be provided at the same time"),(u===void 0||u.length===0)&&c&&(u=c.src||getUid(c)),assert(u!==void 0&&u.length>0,"A defined and non-empty `src` or `image` must be provided"),assert(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let f;if(e.src!==void 0?f=ImageState.IDLE:c!==void 0&&("complete"in c?c.complete?f=c.src?ImageState.LOADED:ImageState.IDLE:f=ImageState.LOADING:f=ImageState.LOADED),this.color_=e.color!==void 0?asArray(e.color):null,this.iconImage_=get$2(c,u,this.crossOrigin_,f,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,this.initialOptions_,e.width!==void 0||e.height!==void 0){let g,H;if(e.size)[g,H]=e.size;else{const Y=this.getImage(1);if(Y.width&&Y.height)g=Y.width,H=Y.height;else if(Y instanceof HTMLImageElement){this.initialOptions_=e;const ee=()=>{if(this.unlistenImageChange(ee),!this.initialOptions_)return;const te=this.iconImage_.getSize();this.setScale(calculateScale(te[0],te[1],e.width,e.height))};this.listenImageChange(ee);return}}g!==void 0&&this.setScale(calculateScale(g,H,e.width,e.height))}}clone(){let e,i,s;return this.initialOptions_?(i=this.initialOptions_.width,s=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new Icon({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:i,height:s,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const o=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!o)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=o[0]),this.anchorYUnits_=="fraction"&&(e[1]*=o[1])}if(this.anchorOrigin_!="top-left"){if(!o)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+o[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+o[1])}this.normalizedAnchor_=e}const i=this.getDisplacement(),s=this.getScaleArray();return[e[0]-i[0]/s[0],e[1]+i[1]/s[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const i=this.getSize(),s=this.iconImage_.getSize();if(!i||!s)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=s[0]-i[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=s[1]-i[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==ImageState.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==ImageState.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(EventType$1.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(EventType$1.CHANGE,e)}ready(){return this.iconImage_.ready()}}class Stroke{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new Stroke({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}let Style$1=class Xi{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=defaultGeometryFunction,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new Xi({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(i){return i.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=defaultGeometryFunction,this.geometry_=e}setZIndex(e){this.zIndex_=e}};function toFunction(n){let e;if(typeof n=="function")e=n;else{let i;Array.isArray(n)?i=n:(assert(typeof n.getZIndex=="function","Expected an `Style` or an array of `Style`"),i=[n]),e=function(){return i}}return e}let defaultStyles=null;function createDefaultStyle(n,e){if(!defaultStyles){const i=new Fill({color:"rgba(255,255,255,0.4)"}),s=new Stroke({color:"#3399CC",width:1.25});defaultStyles=[new Style$1({image:new CircleStyle({fill:i,stroke:s,radius:5}),fill:i,stroke:s})]}return defaultStyles}function createEditingStyle(){const n={},e=[255,255,255,1],i=[0,153,255,1],s=3;return n.Polygon=[new Style$1({fill:new Fill({color:[255,255,255,.5]})})],n.MultiPolygon=n.Polygon,n.LineString=[new Style$1({stroke:new Stroke({color:e,width:s+2})}),new Style$1({stroke:new Stroke({color:i,width:s})})],n.MultiLineString=n.LineString,n.Circle=n.Polygon.concat(n.LineString),n.Point=[new Style$1({image:new CircleStyle({radius:s*2,fill:new Fill({color:i}),stroke:new Stroke({color:e,width:s/2})}),zIndex:1/0})],n.MultiPoint=n.Point,n.GeometryCollection=n.Polygon.concat(n.LineString,n.Point),n}function defaultGeometryFunction(n){return n.getGeometry()}const DEFAULT_FILL_COLOR="#333";class Text{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.keepUpright_=e.keepUpright,this.scale_=e.scale,this.scaleArray_=toSize(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new Fill({color:DEFAULT_FILL_COLOR}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new Text({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setKeepUpright(e){this.keepUpright_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=toSize(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}class CanvasImmediateRenderer extends VectorContext{constructor(e,i,s,o,l,c,u){super(),this.context_=e,this.pixelRatio_=i,this.extent_=s,this.transform_=o,this.transformRotation_=o?toFixed(Math.atan2(o[1],o[0]),10):0,this.viewRotation_=l,this.squaredTolerance_=c,this.userTransform_=u,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=create()}drawImages_(e,i,s,o){if(!this.image_)return;const l=transform2D(e,i,s,o,this.transform_,this.pixelCoordinates_),c=this.context_,u=this.tmpLocalTransform_,f=c.globalAlpha;this.imageOpacity_!=1&&(c.globalAlpha=f*this.imageOpacity_);let g=this.imageRotation_;this.transformRotation_===0&&(g-=this.viewRotation_),this.imageRotateWithView_&&(g+=this.viewRotation_);for(let H=0,Y=l.length;H<Y;H+=2){const ee=l[H]-this.imageAnchorX_,te=l[H+1]-this.imageAnchorY_;if(g!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const ne=ee+this.imageAnchorX_,Ye=te+this.imageAnchorY_;compose(u,ne,Ye,1,1,g,-ne,-Ye),c.save(),c.transform.apply(c,u),c.translate(ne,Ye),c.scale(this.imageScale_[0],this.imageScale_[1]),c.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),c.restore()}else c.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,ee,te,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(c.globalAlpha=f)}drawText_(e,i,s,o){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const l=transform2D(e,i,s,o,this.transform_,this.pixelCoordinates_),c=this.context_;let u=this.textRotation_;for(this.transformRotation_===0&&(u-=this.viewRotation_),this.textRotateWithView_&&(u+=this.viewRotation_);i<s;i+=o){const f=l[i]+this.textOffsetX_,g=l[i+1]+this.textOffsetY_;u!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(c.save(),c.translate(f-this.textOffsetX_,g-this.textOffsetY_),c.rotate(u),c.translate(this.textOffsetX_,this.textOffsetY_),c.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&c.strokeText(this.text_,0,0),this.textFillState_&&c.fillText(this.text_,0,0),c.restore()):(this.textStrokeState_&&c.strokeText(this.text_,f,g),this.textFillState_&&c.fillText(this.text_,f,g))}}moveToLineTo_(e,i,s,o,l){const c=this.context_,u=transform2D(e,i,s,o,this.transform_,this.pixelCoordinates_);c.moveTo(u[0],u[1]);let f=u.length;l&&(f-=2);for(let g=2;g<f;g+=2)c.lineTo(u[g],u[g+1]);return l&&c.closePath(),s}drawRings_(e,i,s,o){for(let l=0,c=s.length;l<c;++l)i=this.moveToLineTo_(e,i,s[l],o,!0);return i}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const i=transformGeom2D(e,this.transform_,this.pixelCoordinates_),s=i[2]-i[0],o=i[3]-i[1],l=Math.sqrt(s*s+o*o),c=this.context_;c.beginPath(),c.arc(i[0],i[1],l,0,2*Math.PI),this.fillState_&&c.fill(),this.strokeState_&&c.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,i){const s=i.getGeometryFunction()(e);s&&(this.setStyle(i),this.drawGeometry(s))}drawGeometryCollection(e){const i=e.getGeometriesArray();for(let s=0,o=i.length;s<o;++s)this.drawGeometry(i[s])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const i=e.getFlatCoordinates(),s=e.getStride();this.image_&&this.drawImages_(i,0,i.length,s),this.text_!==""&&this.drawText_(i,0,i.length,s)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const i=e.getFlatCoordinates(),s=e.getStride();this.image_&&this.drawImages_(i,0,i.length,s),this.text_!==""&&this.drawText_(i,0,i.length,s)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,s=e.getFlatCoordinates();i.beginPath(),this.moveToLineTo_(s,0,s.length,e.getStride(),!1),i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoint();this.drawText_(i,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const i=e.getExtent();if(intersects$1(this.extent_,i)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const s=this.context_,o=e.getFlatCoordinates();let l=0;const c=e.getEnds(),u=e.getStride();s.beginPath();for(let f=0,g=c.length;f<g;++f)l=this.moveToLineTo_(o,l,c[f],u,!1);s.stroke()}if(this.text_!==""){const s=e.getFlatMidpoints();this.drawText_(s,0,s.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const i=this.context_;i.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&i.fill(),this.strokeState_&&i.stroke()}if(this.text_!==""){const i=e.getFlatInteriorPoint();this.drawText_(i,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const i=this.context_,s=e.getOrientedFlatCoordinates();let o=0;const l=e.getEndss(),c=e.getStride();i.beginPath();for(let u=0,f=l.length;u<f;++u){const g=l[u];o=this.drawRings_(s,o,g,c)}this.fillState_&&i.fill(),this.strokeState_&&i.stroke()}if(this.text_!==""){const i=e.getFlatInteriorPoints();this.drawText_(i,0,i.length,2)}}}setContextFillState_(e){const i=this.context_,s=this.contextFillState_;s?s.fillStyle!=e.fillStyle&&(s.fillStyle=e.fillStyle,i.fillStyle=e.fillStyle):(i.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const i=this.context_,s=this.contextStrokeState_;s?(s.lineCap!=e.lineCap&&(s.lineCap=e.lineCap,i.lineCap=e.lineCap),equals$2(s.lineDash,e.lineDash)||i.setLineDash(s.lineDash=e.lineDash),s.lineDashOffset!=e.lineDashOffset&&(s.lineDashOffset=e.lineDashOffset,i.lineDashOffset=e.lineDashOffset),s.lineJoin!=e.lineJoin&&(s.lineJoin=e.lineJoin,i.lineJoin=e.lineJoin),s.lineWidth!=e.lineWidth&&(s.lineWidth=e.lineWidth,i.lineWidth=e.lineWidth),s.miterLimit!=e.miterLimit&&(s.miterLimit=e.miterLimit,i.miterLimit=e.miterLimit),s.strokeStyle!=e.strokeStyle&&(s.strokeStyle=e.strokeStyle,i.strokeStyle=e.strokeStyle)):(i.lineCap=e.lineCap,i.setLineDash(e.lineDash),i.lineDashOffset=e.lineDashOffset,i.lineJoin=e.lineJoin,i.lineWidth=e.lineWidth,i.miterLimit=e.miterLimit,i.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const i=this.context_,s=this.contextTextState_,o=e.textAlign?e.textAlign:defaultTextAlign;s?(s.font!=e.font&&(s.font=e.font,i.font=e.font),s.textAlign!=o&&(s.textAlign=o,i.textAlign=o),s.textBaseline!=e.textBaseline&&(s.textBaseline=e.textBaseline,i.textBaseline=e.textBaseline)):(i.font=e.font,i.textAlign=o,i.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:o,textBaseline:e.textBaseline})}setFillStrokeStyle(e,i){if(!e)this.fillState_=null;else{const s=e.getColor();this.fillState_={fillStyle:asColorLike(s||defaultFillStyle)}}if(!i)this.strokeState_=null;else{const s=i.getColor(),o=i.getLineCap(),l=i.getLineDash(),c=i.getLineDashOffset(),u=i.getLineJoin(),f=i.getWidth(),g=i.getMiterLimit(),H=l||defaultLineDash;this.strokeState_={lineCap:o!==void 0?o:defaultLineCap,lineDash:this.pixelRatio_===1?H:H.map(Y=>Y*this.pixelRatio_),lineDashOffset:(c||defaultLineDashOffset)*this.pixelRatio_,lineJoin:u!==void 0?u:defaultLineJoin,lineWidth:(f!==void 0?f:defaultLineWidth)*this.pixelRatio_,miterLimit:g!==void 0?g:defaultMiterLimit,strokeStyle:asColorLike(s||defaultStrokeStyle)}}}setImageStyle(e){let i;if(!e||!(i=e.getSize())){this.image_=null;return}const s=e.getPixelRatio(this.pixelRatio_),o=e.getAnchor(),l=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=o[0]*s,this.imageAnchorY_=o[1]*s,this.imageHeight_=i[1]*s,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=l[0],this.imageOriginY_=l[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const c=e.getScaleArray();this.imageScale_=[c[0]*this.pixelRatio_/s,c[1]*this.pixelRatio_/s],this.imageWidth_=i[0]*s}setTextStyle(e){if(!e)this.text_="";else{const i=e.getFill();if(!i)this.textFillState_=null;else{const te=i.getColor();this.textFillState_={fillStyle:asColorLike(te||defaultFillStyle)}}const s=e.getStroke();if(!s)this.textStrokeState_=null;else{const te=s.getColor(),ne=s.getLineCap(),Ye=s.getLineDash(),xe=s.getLineDashOffset(),tt=s.getLineJoin(),et=s.getWidth(),it=s.getMiterLimit();this.textStrokeState_={lineCap:ne!==void 0?ne:defaultLineCap,lineDash:Ye||defaultLineDash,lineDashOffset:xe||defaultLineDashOffset,lineJoin:tt!==void 0?tt:defaultLineJoin,lineWidth:et!==void 0?et:defaultLineWidth,miterLimit:it!==void 0?it:defaultMiterLimit,strokeStyle:asColorLike(te||defaultStrokeStyle)}}const o=e.getFont(),l=e.getOffsetX(),c=e.getOffsetY(),u=e.getRotateWithView(),f=e.getRotation(),g=e.getScaleArray(),H=e.getText(),Y=e.getTextAlign(),ee=e.getTextBaseline();this.textState_={font:o!==void 0?o:defaultFont,textAlign:Y!==void 0?Y:defaultTextAlign,textBaseline:ee!==void 0?ee:defaultTextBaseline},this.text_=H!==void 0?Array.isArray(H)?H.reduce((te,ne,Ye)=>te+=Ye%2?" ":ne,""):H:"",this.textOffsetX_=l!==void 0?this.pixelRatio_*l:0,this.textOffsetY_=c!==void 0?this.pixelRatio_*c:0,this.textRotateWithView_=u!==void 0?u:!1,this.textRotation_=f!==void 0?f:0,this.textScale_=[this.pixelRatio_*g[0],this.pixelRatio_*g[1]]}}}const HIT_DETECT_RESOLUTION=.5;function createHitDetectionImageData(n,e,i,s,o,l,c,u,f){const g=f?toUserExtent(o):o,H=n[0]*HIT_DETECT_RESOLUTION,Y=n[1]*HIT_DETECT_RESOLUTION,ee=createCanvasContext2D(H,Y);ee.imageSmoothingEnabled=!1;const te=ee.canvas,ne=new CanvasImmediateRenderer(ee,HIT_DETECT_RESOLUTION,o,null,c,u,f?getTransformFromProjections(getUserProjection(),f):null),Ye=i.length,xe=Math.floor((256*256*256-1)/Ye),tt={};for(let it=1;it<=Ye;++it){const rt=i[it-1],nt=rt.getStyleFunction()||s;if(!nt)continue;let at=nt(rt,l);if(!at)continue;Array.isArray(at)||(at=[at]);const ot=(it*xe).toString(16).padStart(7,"#00000");for(let ut=0,ht=at.length;ut<ht;++ut){const dt=at[ut],pt=dt.getGeometryFunction()(rt);if(!pt||!intersects$1(g,pt.getExtent()))continue;const yt=dt.clone(),mt=yt.getFill();mt&&mt.setColor(ot);const St=yt.getStroke();St&&(St.setColor(ot),St.setLineDash(null)),yt.setText(void 0);const wt=dt.getImage();if(wt){const vt=wt.getImageSize();if(!vt)continue;const Et=createCanvasContext2D(vt[0],vt[1],void 0,{alpha:!1}),_t=Et.canvas;Et.fillStyle=ot,Et.fillRect(0,0,_t.width,_t.height),yt.setImage(new Icon({img:_t,anchor:wt.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:wt.getOrigin(),opacity:1,size:wt.getSize(),scale:wt.getScale(),rotation:wt.getRotation(),rotateWithView:wt.getRotateWithView()}))}const Rt=yt.getZIndex()||0;let Lt=tt[Rt];Lt||(Lt={},tt[Rt]=Lt,Lt.Polygon=[],Lt.Circle=[],Lt.LineString=[],Lt.Point=[]);const Gt=pt.getType();if(Gt==="GeometryCollection"){const vt=pt.getGeometriesArrayRecursive();for(let Et=0,_t=vt.length;Et<_t;++Et){const Ct=vt[Et];Lt[Ct.getType().replace("Multi","")].push(Ct,yt)}}else Lt[Gt.replace("Multi","")].push(pt,yt)}}const et=Object.keys(tt).map(Number).sort(ascending);for(let it=0,rt=et.length;it<rt;++it){const nt=tt[et[it]];for(const at in nt){const st=nt[at];for(let ot=0,ut=st.length;ot<ut;ot+=2){ne.setStyle(st[ot+1]);for(let ht=0,dt=e.length;ht<dt;++ht)ne.setTransform(e[ht]),ne.drawGeometry(st[ot])}}}return ee.getImageData(0,0,te.width,te.height)}function hitDetect(n,e,i){const s=[];if(i){const o=Math.floor(Math.round(n[0])*HIT_DETECT_RESOLUTION),l=Math.floor(Math.round(n[1])*HIT_DETECT_RESOLUTION),c=(clamp$1(o,0,i.width-1)+clamp$1(l,0,i.height-1)*i.width)*4,u=i.data[c],f=i.data[c+1],H=i.data[c+2]+256*(f+256*u),Y=Math.floor((256*256*256-1)/e.length);H&&H%Y===0&&s.push(e[H/Y-1])}return s}const SIMPLIFY_TOLERANCE=.5,GEOMETRY_RENDERERS={Point:renderPointGeometry,LineString:renderLineStringGeometry,Polygon:renderPolygonGeometry,MultiPoint:renderMultiPointGeometry,MultiLineString:renderMultiLineStringGeometry,MultiPolygon:renderMultiPolygonGeometry,GeometryCollection:renderGeometryCollectionGeometry,Circle:renderCircleGeometry};function defaultOrder(n,e){return parseInt(getUid(n),10)-parseInt(getUid(e),10)}function getSquaredTolerance(n,e){const i=getTolerance(n,e);return i*i}function getTolerance(n,e){return SIMPLIFY_TOLERANCE*n/e}function renderCircleGeometry(n,e,i,s,o){const l=i.getFill(),c=i.getStroke();if(l||c){const f=n.getBuilder(i.getZIndex(),"Circle");f.setFillStrokeStyle(l,c),f.drawCircle(e,s,o)}const u=i.getText();if(u&&u.getText()){const f=n.getBuilder(i.getZIndex(),"Text");f.setTextStyle(u),f.drawText(e,s)}}function renderFeature$1(n,e,i,s,o,l,c,u){const f=[],g=i.getImage();if(g){let ee=!0;const te=g.getImageState();te==ImageState.LOADED||te==ImageState.ERROR?ee=!1:te==ImageState.IDLE&&g.load(),ee&&f.push(g.ready())}const H=i.getFill();H&&H.loading()&&f.push(H.ready());const Y=f.length>0;return Y&&Promise.all(f).then(()=>o(null)),renderFeatureInternal(n,e,i,s,l,c,u),Y}function renderFeatureInternal(n,e,i,s,o,l,c){const u=i.getGeometryFunction()(e);if(!u)return;const f=u.simplifyTransformed(s,o);if(i.getRenderer())renderGeometry(n,f,i,e,c);else{const H=GEOMETRY_RENDERERS[f.getType()];H(n,f,i,e,c,l)}}function renderGeometry(n,e,i,s,o){if(e.getType()=="GeometryCollection"){const c=e.getGeometries();for(let u=0,f=c.length;u<f;++u)renderGeometry(n,c[u],i,s,o);return}n.getBuilder(i.getZIndex(),"Default").drawCustom(e,s,i.getRenderer(),i.getHitDetectionRenderer(),o)}function renderGeometryCollectionGeometry(n,e,i,s,o,l){const c=e.getGeometriesArray();let u,f;for(u=0,f=c.length;u<f;++u){const g=GEOMETRY_RENDERERS[c[u].getType()];g(n,c[u],i,s,o,l)}}function renderLineStringGeometry(n,e,i,s,o){const l=i.getStroke();if(l){const u=n.getBuilder(i.getZIndex(),"LineString");u.setFillStrokeStyle(null,l),u.drawLineString(e,s,o)}const c=i.getText();if(c&&c.getText()){const u=n.getBuilder(i.getZIndex(),"Text");u.setTextStyle(c),u.drawText(e,s,o)}}function renderMultiLineStringGeometry(n,e,i,s,o){const l=i.getStroke();if(l){const u=n.getBuilder(i.getZIndex(),"LineString");u.setFillStrokeStyle(null,l),u.drawMultiLineString(e,s,o)}const c=i.getText();if(c&&c.getText()){const u=n.getBuilder(i.getZIndex(),"Text");u.setTextStyle(c),u.drawText(e,s,o)}}function renderMultiPolygonGeometry(n,e,i,s,o){const l=i.getFill(),c=i.getStroke();if(c||l){const f=n.getBuilder(i.getZIndex(),"Polygon");f.setFillStrokeStyle(l,c),f.drawMultiPolygon(e,s,o)}const u=i.getText();if(u&&u.getText()){const f=n.getBuilder(i.getZIndex(),"Text");f.setTextStyle(u),f.drawText(e,s,o)}}function renderPointGeometry(n,e,i,s,o,l){const c=i.getImage(),u=i.getText(),f=u&&u.getText(),g=l&&c&&f?{}:void 0;if(c){if(c.getImageState()!=ImageState.LOADED)return;const H=n.getBuilder(i.getZIndex(),"Image");H.setImageStyle(c,g),H.drawPoint(e,s,o)}if(f){const H=n.getBuilder(i.getZIndex(),"Text");H.setTextStyle(u,g),H.drawText(e,s,o)}}function renderMultiPointGeometry(n,e,i,s,o,l){const c=i.getImage(),u=c&&c.getOpacity()!==0,f=i.getText(),g=f&&f.getText(),H=l&&u&&g?{}:void 0;if(u){if(c.getImageState()!=ImageState.LOADED)return;const Y=n.getBuilder(i.getZIndex(),"Image");Y.setImageStyle(c,H),Y.drawMultiPoint(e,s,o)}if(g){const Y=n.getBuilder(i.getZIndex(),"Text");Y.setTextStyle(f,H),Y.drawText(e,s,o)}}function renderPolygonGeometry(n,e,i,s,o){const l=i.getFill(),c=i.getStroke();if(l||c){const f=n.getBuilder(i.getZIndex(),"Polygon");f.setFillStrokeStyle(l,c),f.drawPolygon(e,s,o)}const u=i.getText();if(u&&u.getText()){const f=n.getBuilder(i.getZIndex(),"Text");f.setTextStyle(u),f.drawText(e,s,o)}}class RenderEvent extends BaseEvent{constructor(e,i,s,o){super(e),this.inversePixelTransform=i,this.frameState=s,this.context=o}}const maxStaleKeys=5;class LayerRenderer extends Observable{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.staleKeys_=new Array,this.maxStaleKeys=maxStaleKeys}getStaleKeys(){return this.staleKeys_}prependStaleKey(e){this.staleKeys_.unshift(e),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(e){return abstract()}getData(e){return null}prepareFrame(e){return abstract()}renderFrame(e,i){return abstract()}forEachFeatureAtCoordinate(e,i,s,o,l){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const i=e.target;(i.getState()===ImageState.LOADED||i.getState()===ImageState.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let i=e.getState();return i!=ImageState.LOADED&&i!=ImageState.ERROR&&e.addEventListener(EventType$1.CHANGE,this.boundHandleImageChange_),i==ImageState.IDLE&&(e.load(),i=e.getState()),i==ImageState.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}renderDeferred(e){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const canvasPool=[];let pixelContext=null;function createPixelContext(){pixelContext=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0})}class CanvasLayerRenderer extends LayerRenderer{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=create(),this.pixelTransform=create(),this.inversePixelTransform=create(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(e,i,s){pixelContext||createPixelContext(),pixelContext.clearRect(0,0,1,1);let o;try{pixelContext.drawImage(e,i,s,1,1,0,0,1,1),o=pixelContext.getImageData(0,0,1,1).data}catch{return pixelContext=null,null}return o}getBackground(e){let s=this.getLayer().getBackground();return typeof s=="function"&&(s=s(e.viewState.resolution)),s||void 0}useContainer(e,i,s){const o=this.getLayer().getClassName();let l,c;if(e&&e.className===o&&(!s||e&&e.style.backgroundColor&&equals$2(asArray(e.style.backgroundColor),asArray(s)))){const u=e.firstElementChild;u instanceof HTMLCanvasElement&&(c=u.getContext("2d"))}if(c&&equivalent(c.canvas.style.transform,i)?(this.container=e,this.context=c,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){l=document.createElement("div"),l.className=o;let u=l.style;u.position="absolute",u.width="100%",u.height="100%",c=createCanvasContext2D();const f=c.canvas;l.appendChild(f),u=f.style,u.position="absolute",u.left="0",u.transformOrigin="top left",this.container=l,this.context=c}!this.containerReused&&s&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=s)}clipUnrotated(e,i,s){const o=getTopLeft(s),l=getTopRight(s),c=getBottomRight(s),u=getBottomLeft(s);apply(i.coordinateToPixelTransform,o),apply(i.coordinateToPixelTransform,l),apply(i.coordinateToPixelTransform,c),apply(i.coordinateToPixelTransform,u);const f=this.inversePixelTransform;apply(f,o),apply(f,l),apply(f,c),apply(f,u),e.save(),e.beginPath(),e.moveTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(l[0]),Math.round(l[1])),e.lineTo(Math.round(c[0]),Math.round(c[1])),e.lineTo(Math.round(u[0]),Math.round(u[1])),e.clip()}prepareContainer(e,i){const s=e.extent,o=e.viewState.resolution,l=e.viewState.rotation,c=e.pixelRatio,u=Math.round(getWidth(s)/o*c),f=Math.round(getHeight(s)/o*c);compose(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/c,1/c,l,-u/2,-f/2),makeInverse(this.inversePixelTransform,this.pixelTransform);const g=toString$1(this.pixelTransform);if(this.useContainer(i,g,this.getBackground(e)),!this.containerReused){const H=this.context.canvas;H.width!=u||H.height!=f?(H.width=u,H.height=f):this.context.clearRect(0,0,u,f),g!==H.style.transform&&(H.style.transform=g)}}dispatchRenderEvent_(e,i,s){const o=this.getLayer();if(o.hasListener(e)){const l=new RenderEvent(e,this.inversePixelTransform,s,i);o.dispatchEvent(l)}}preRender(e,i){this.frameState=i,!i.declutter&&this.dispatchRenderEvent_(EventType.PRERENDER,e,i)}postRender(e,i){i.declutter||this.dispatchRenderEvent_(EventType.POSTRENDER,e,i)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new ZIndexContext),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(EventType.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(EventType.POSTRENDER,this.context,e))}getRenderTransform(e,i,s,o,l,c,u){const f=l/2,g=c/2,H=o/i,Y=-H,ee=-e[0]+u,te=-e[1];return compose(this.tempTransform,f,g,H,Y,-s,ee,te)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class CanvasVectorLayerRenderer extends CanvasLayerRenderer{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=createEmpty(),this.wrappedRenderedExtent_=createEmpty(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,i,s){const o=i.extent,l=i.viewState,c=l.center,u=l.resolution,f=l.projection,g=l.rotation,H=f.getExtent(),Y=this.getLayer().getSource(),ee=this.getLayer().getDeclutter(),te=i.pixelRatio,ne=i.viewHints,Ye=!(ne[ViewHint.ANIMATING]||ne[ViewHint.INTERACTING]),xe=this.context,tt=Math.round(getWidth(o)/u*te),et=Math.round(getHeight(o)/u*te),it=Y.getWrapX()&&f.canWrapX(),rt=it?getWidth(H):null,nt=it?Math.ceil((o[2]-H[2])/rt)+1:1;let at=it?Math.floor((o[0]-H[0])/rt):0;do{let st=this.getRenderTransform(c,u,0,te,tt,et,at*rt);i.declutter&&(st=st.slice(0)),e.execute(xe,[xe.canvas.width,xe.canvas.height],st,g,Ye,s===void 0?ALL:s?DECLUTTER:NON_DECLUTTER,s?ee&&i.declutter[ee]:void 0)}while(++at<nt)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=createCanvasContext2D(this.context.canvas.width,this.context.canvas.height,canvasPool))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,releaseCanvas(this.context),canvasPool.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,i){const s=e.layerStatesArray[e.layerIndex];this.opacity_=s.opacity;const o=e.viewState;this.prepareContainer(e,i);const l=this.context,c=this.replayGroup_;let u=c&&!c.isEmpty();if(!u&&!(this.getLayer().hasListener(EventType.PRERENDER)||this.getLayer().hasListener(EventType.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(l,e),o.projection,this.clipped_=!1,u&&s.extent&&this.clipping){const f=fromUserExtent(s.extent);u=intersects$1(f,e.extent),this.clipped_=u&&!containsExtent(f,e.extent),this.clipped_&&this.clipUnrotated(l,e,f)}return u&&this.renderWorlds(c,e,this.getLayer().getDeclutter()?!1:void 0),!e.declutter&&this.clipped_&&l.restore(),this.postRender(l,e),this.renderedRotation_!==o.rotation&&(this.renderedRotation_=o.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(i=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const s=this.frameState.size.slice(),o=this.renderedCenter_,l=this.renderedResolution_,c=this.renderedRotation_,u=this.renderedProjection_,f=this.wrappedRenderedExtent_,g=this.getLayer(),H=[],Y=s[0]*HIT_DETECT_RESOLUTION,ee=s[1]*HIT_DETECT_RESOLUTION;H.push(this.getRenderTransform(o,l,c,HIT_DETECT_RESOLUTION,Y,ee,0).slice());const te=g.getSource(),ne=u.getExtent();if(te.getWrapX()&&u.canWrapX()&&!containsExtent(ne,f)){let Ye=f[0];const xe=getWidth(ne);let tt=0,et;for(;Ye<ne[0];)--tt,et=xe*tt,H.push(this.getRenderTransform(o,l,c,HIT_DETECT_RESOLUTION,Y,ee,et).slice()),Ye+=xe;for(tt=0,Ye=f[2];Ye>ne[2];)++tt,et=xe*tt,H.push(this.getRenderTransform(o,l,c,HIT_DETECT_RESOLUTION,Y,ee,et).slice()),Ye-=xe}this.hitDetectionImageData_=createHitDetectionImageData(s,H,this.renderedFeatures_,g.getStyleFunction(),f,l,c,getSquaredTolerance(l,this.renderedPixelRatio_),null)}i(hitDetect(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,i,s,o,l){var ee,te;if(!this.replayGroup_)return;const c=i.viewState.resolution,u=i.viewState.rotation,f=this.getLayer(),g={},H=function(ne,Ye,xe){const tt=getUid(ne),et=g[tt];if(et){if(et!==!0&&xe<et.distanceSq){if(xe===0)return g[tt]=!0,l.splice(l.lastIndexOf(et),1),o(ne,f,Ye);et.geometry=Ye,et.distanceSq=xe}}else{if(xe===0)return g[tt]=!0,o(ne,f,Ye);l.push(g[tt]={feature:ne,layer:f,geometry:Ye,distanceSq:xe,callback:o})}},Y=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,c,u,s,H,Y?(te=(ee=i.declutter)==null?void 0:ee[Y])==null?void 0:te.all().map(ne=>ne.value):null)}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const i=this.getLayer(),s=i.getSource();if(!s)return!1;const o=e.viewHints[ViewHint.ANIMATING],l=e.viewHints[ViewHint.INTERACTING],c=i.getUpdateWhileAnimating(),u=i.getUpdateWhileInteracting();if(this.ready&&!c&&o||!u&&l)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const f=e.extent,g=e.viewState,H=g.projection,Y=g.resolution,ee=e.pixelRatio,te=i.getRevision(),ne=i.getRenderBuffer();let Ye=i.getRenderOrder();Ye===void 0&&(Ye=defaultOrder);const xe=g.center.slice(),tt=buffer(f,ne*Y),et=tt.slice(),it=[tt.slice()],rt=H.getExtent();if(s.getWrapX()&&H.canWrapX()&&!containsExtent(rt,e.extent)){const mt=getWidth(rt),St=Math.max(getWidth(tt)/2,mt);tt[0]=rt[0]-St,tt[2]=rt[2]+St,wrapX$1(xe,H);const wt=wrapX$2(it[0],H);wt[0]<rt[0]&&wt[2]<rt[2]?it.push([wt[0]+mt,wt[1],wt[2]+mt,wt[3]]):wt[0]>rt[0]&&wt[2]>rt[2]&&it.push([wt[0]-mt,wt[1],wt[2]-mt,wt[3]])}if(this.ready&&this.renderedResolution_==Y&&this.renderedRevision_==te&&this.renderedRenderOrder_==Ye&&this.renderedFrameDeclutter_===!!e.declutter&&containsExtent(this.wrappedRenderedExtent_,tt))return equals$2(this.renderedExtent_,et)||(this.hitDetectionImageData_=null,this.renderedExtent_=et),this.renderedCenter_=xe,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const nt=new BuilderGroup(getTolerance(Y,ee),tt,Y,ee);let at;for(let mt=0,St=it.length;mt<St;++mt)s.loadFeatures(it[mt],Y,H);const st=getSquaredTolerance(Y,ee);let ot=!0;const ut=(mt,St)=>{let wt;const Rt=mt.getStyleFunction()||i.getStyleFunction();if(Rt&&(wt=Rt(mt,Y)),wt){const Lt=this.renderFeature(mt,st,wt,nt,at,this.getLayer().getDeclutter(),St);ot=ot&&!Lt}},ht=toUserExtent(tt),dt=s.getFeaturesInExtent(ht);Ye&&dt.sort(Ye);for(let mt=0,St=dt.length;mt<St;++mt)ut(dt[mt],mt);this.renderedFeatures_=dt,this.ready=ot;const pt=nt.finish(),yt=new ExecutorGroup(tt,Y,ee,s.getOverlaps(),pt,i.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=Y,this.renderedRevision_=te,this.renderedRenderOrder_=Ye,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=et,this.wrappedRenderedExtent_=tt,this.renderedCenter_=xe,this.renderedProjection_=H,this.renderedPixelRatio_=ee,this.replayGroup_=yt,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,i,s,o,l,c,u){if(!s)return!1;let f=!1;if(Array.isArray(s))for(let g=0,H=s.length;g<H;++g)f=renderFeature$1(o,e,s[g],i,this.boundHandleStyleImageChange_,l,c,u)||f;else f=renderFeature$1(o,e,s,i,this.boundHandleStyleImageChange_,l,c,u);return f}}let numTypes=0;const BooleanType$1=1<<numTypes++,NumberType$1=1<<numTypes++,StringType$1=1<<numTypes++,ColorType$1=1<<numTypes++,NumberArrayType$1=1<<numTypes++,SizeType=1<<numTypes++,AnyType=Math.pow(2,numTypes)-1,typeNames={[BooleanType$1]:"boolean",[NumberType$1]:"number",[StringType$1]:"string",[ColorType$1]:"color",[NumberArrayType$1]:"number[]",[SizeType]:"size"},namedTypes=Object.keys(typeNames).map(Number).sort(ascending);function isSpecific(n){return n in typeNames}function typeName(n){const e=[];for(const i of namedTypes)includesType(n,i)&&e.push(typeNames[i]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function includesType(n,e){return(n&e)===e}function isType(n,e){return n===e}class LiteralExpression{constructor(e,i){if(!isSpecific(e))throw new Error(`literal expressions must have a specific type, got ${typeName(e)}`);this.type=e,this.value=i}}class CallExpression{constructor(e,i,...s){this.type=e,this.operator=i,this.args=s}}function newParsingContext(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function parse$2(n,e,i){switch(typeof n){case"boolean":{if(isType(e,StringType$1))return new LiteralExpression(StringType$1,n?"true":"false");if(!includesType(e,BooleanType$1))throw new Error(`got a boolean, but expected ${typeName(e)}`);return new LiteralExpression(BooleanType$1,n)}case"number":{if(isType(e,SizeType))return new LiteralExpression(SizeType,toSize(n));if(isType(e,BooleanType$1))return new LiteralExpression(BooleanType$1,!!n);if(isType(e,StringType$1))return new LiteralExpression(StringType$1,n.toString());if(!includesType(e,NumberType$1))throw new Error(`got a number, but expected ${typeName(e)}`);return new LiteralExpression(NumberType$1,n)}case"string":{if(isType(e,ColorType$1))return new LiteralExpression(ColorType$1,fromString(n));if(isType(e,BooleanType$1))return new LiteralExpression(BooleanType$1,!!n);if(!includesType(e,StringType$1))throw new Error(`got a string, but expected ${typeName(e)}`);return new LiteralExpression(StringType$1,n)}}if(!Array.isArray(n))throw new Error("expression must be an array or a primitive value");if(n.length===0)throw new Error("empty expression");if(typeof n[0]=="string")return parseCallExpression(n,e,i);for(const s of n)if(typeof s!="number")throw new Error("expected an array of numbers");if(isType(e,SizeType)){if(n.length!==2)throw new Error(`expected an array of two values for a size, got ${n.length}`);return new LiteralExpression(SizeType,n)}if(isType(e,ColorType$1)){if(n.length===3)return new LiteralExpression(ColorType$1,[...n,1]);if(n.length===4)return new LiteralExpression(ColorType$1,n);throw new Error(`expected an array of 3 or 4 values for a color, got ${n.length}`)}if(!includesType(e,NumberArrayType$1))throw new Error(`got an array of numbers, but expected ${typeName(e)}`);return new LiteralExpression(NumberArrayType$1,n)}const Ops={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},parsers={[Ops.Get]:createCallExpressionParser(hasArgsCount(1,1/0),withGetArgs),[Ops.Var]:createCallExpressionParser(hasArgsCount(1,1),withVarArgs),[Ops.Has]:createCallExpressionParser(hasArgsCount(1,1/0),withGetArgs),[Ops.Id]:createCallExpressionParser(usesFeatureId,withNoArgs),[Ops.Concat]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfType(StringType$1)),[Ops.GeometryType]:createCallExpressionParser(usesGeometryType,withNoArgs),[Ops.LineMetric]:createCallExpressionParser(withNoArgs),[Ops.Resolution]:createCallExpressionParser(usesMapState,withNoArgs),[Ops.Zoom]:createCallExpressionParser(usesMapState,withNoArgs),[Ops.Time]:createCallExpressionParser(usesMapState,withNoArgs),[Ops.Any]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfType(BooleanType$1)),[Ops.All]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfType(BooleanType$1)),[Ops.Not]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(BooleanType$1)),[Ops.Equal]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(AnyType)),[Ops.NotEqual]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(AnyType)),[Ops.GreaterThan]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.GreaterThanOrEqualTo]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.LessThan]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.LessThanOrEqualTo]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.Multiply]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfReturnType),[Ops.Coalesce]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfReturnType),[Ops.Divide]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.Add]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfType(NumberType$1)),[Ops.Subtract]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.Clamp]:createCallExpressionParser(hasArgsCount(3,3),withArgsOfType(NumberType$1)),[Ops.Mod]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.Pow]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.Abs]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Floor]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Ceil]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Round]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Sin]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Cos]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Atan]:createCallExpressionParser(hasArgsCount(1,2),withArgsOfType(NumberType$1)),[Ops.Sqrt]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Match]:createCallExpressionParser(hasArgsCount(4,1/0),hasEvenArgs,withMatchArgs),[Ops.Between]:createCallExpressionParser(hasArgsCount(3,3),withArgsOfType(NumberType$1)),[Ops.Interpolate]:createCallExpressionParser(hasArgsCount(6,1/0),hasEvenArgs,withInterpolateArgs),[Ops.Case]:createCallExpressionParser(hasArgsCount(3,1/0),hasOddArgs,withCaseArgs),[Ops.In]:createCallExpressionParser(hasArgsCount(2,2),withInArgs),[Ops.Number]:createCallExpressionParser(hasArgsCount(1,1/0),withArgsOfType(AnyType)),[Ops.String]:createCallExpressionParser(hasArgsCount(1,1/0),withArgsOfType(AnyType)),[Ops.Array]:createCallExpressionParser(hasArgsCount(1,1/0),withArgsOfType(NumberType$1)),[Ops.Color]:createCallExpressionParser(hasArgsCount(1,4),withArgsOfType(NumberType$1)),[Ops.Band]:createCallExpressionParser(hasArgsCount(1,3),withArgsOfType(NumberType$1)),[Ops.Palette]:createCallExpressionParser(hasArgsCount(2,2),withPaletteArgs),[Ops.ToString]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(BooleanType$1|NumberType$1|StringType$1|ColorType$1))};function withGetArgs(n,e,i){const s=n.length-1,o=new Array(s);for(let l=0;l<s;++l){const c=n[l+1];switch(typeof c){case"number":{o[l]=new LiteralExpression(NumberType$1,c);break}case"string":{o[l]=new LiteralExpression(StringType$1,c);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${c}`)}l===0&&i.properties.add(String(c))}return o}function withVarArgs(n,e,i){const s=n[1];if(typeof s!="string")throw new Error("expected a string argument for var operation");return i.variables.add(s),[new LiteralExpression(StringType$1,s)]}function usesFeatureId(n,e,i){i.featureId=!0}function usesGeometryType(n,e,i){i.geometryType=!0}function usesMapState(n,e,i){i.mapState=!0}function withNoArgs(n,e,i){const s=n[0];if(n.length!==1)throw new Error(`expected no arguments for ${s} operation`);return[]}function hasArgsCount(n,e){return function(i,s,o){const l=i[0],c=i.length-1;if(n===e){if(c!==n){const u=n===1?"":"s";throw new Error(`expected ${n} argument${u} for ${l}, got ${c}`)}}else if(c<n||c>e){const u=e===1/0?`${n} or more`:`${n} to ${e}`;throw new Error(`expected ${u} arguments for ${l}, got ${c}`)}}}function withArgsOfReturnType(n,e,i){const s=n.length-1,o=new Array(s);for(let l=0;l<s;++l){const c=parse$2(n[l+1],e,i);o[l]=c}return o}function withArgsOfType(n){return function(e,i,s){const o=e.length-1,l=new Array(o);for(let c=0;c<o;++c){const u=parse$2(e[c+1],n,s);l[c]=u}return l}}function hasOddArgs(n,e,i){const s=n[0],o=n.length-1;if(o%2===0)throw new Error(`expected an odd number of arguments for ${s}, got ${o} instead`)}function hasEvenArgs(n,e,i){const s=n[0],o=n.length-1;if(o%2===1)throw new Error(`expected an even number of arguments for operation ${s}, got ${o} instead`)}function withMatchArgs(n,e,i){const s=n.length-1,o=StringType$1|NumberType$1|BooleanType$1,l=parse$2(n[1],o,i),c=parse$2(n[n.length-1],e,i),u=new Array(s-2);for(let f=0;f<s-2;f+=2){try{const g=parse$2(n[f+2],l.type,i);u[f]=g}catch(g){throw new Error(`failed to parse argument ${f+1} of match expression: ${g.message}`)}try{const g=parse$2(n[f+3],c.type,i);u[f+1]=g}catch(g){throw new Error(`failed to parse argument ${f+2} of match expression: ${g.message}`)}}return[l,...u,c]}function withInterpolateArgs(n,e,i){const s=n[1];let o;switch(s[0]){case"linear":o=1;break;case"exponential":const f=s[1];if(typeof f!="number"||f<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(f)} instead`);o=f;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(s)}`)}const l=new LiteralExpression(NumberType$1,o);let c;try{c=parse$2(n[2],NumberType$1,i)}catch(f){throw new Error(`failed to parse argument 1 in interpolate expression: ${f.message}`)}const u=new Array(n.length-3);for(let f=0;f<u.length;f+=2){try{const g=parse$2(n[f+3],NumberType$1,i);u[f]=g}catch(g){throw new Error(`failed to parse argument ${f+2} for interpolate expression: ${g.message}`)}try{const g=parse$2(n[f+4],e,i);u[f+1]=g}catch(g){throw new Error(`failed to parse argument ${f+3} for interpolate expression: ${g.message}`)}}return[l,c,...u]}function withCaseArgs(n,e,i){const s=parse$2(n[n.length-1],e,i),o=new Array(n.length-1);for(let l=0;l<o.length-1;l+=2){try{const c=parse$2(n[l+1],BooleanType$1,i);o[l]=c}catch(c){throw new Error(`failed to parse argument ${l} of case expression: ${c.message}`)}try{const c=parse$2(n[l+2],s.type,i);o[l+1]=c}catch(c){throw new Error(`failed to parse argument ${l+1} of case expression: ${c.message}`)}}return o[o.length-1]=s,o}function withInArgs(n,e,i){let s=n[2];if(!Array.isArray(s))throw new Error('the second argument for the "in" operator must be an array');let o;if(typeof s[0]=="string"){if(s[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(s[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');s=s[1],o=StringType$1}else o=NumberType$1;const l=new Array(s.length);for(let u=0;u<l.length;u++)try{const f=parse$2(s[u],o,i);l[u]=f}catch(f){throw new Error(`failed to parse haystack item ${u} for "in" expression: ${f.message}`)}return[parse$2(n[1],o,i),...l]}function withPaletteArgs(n,e,i){let s;try{s=parse$2(n[1],NumberType$1,i)}catch(c){throw new Error(`failed to parse first argument in palette expression: ${c.message}`)}const o=n[2];if(!Array.isArray(o))throw new Error("the second argument of palette must be an array");const l=new Array(o.length);for(let c=0;c<l.length;c++){let u;try{u=parse$2(o[c],ColorType$1,i)}catch(f){throw new Error(`failed to parse color at index ${c} in palette expression: ${f.message}`)}if(!(u instanceof LiteralExpression))throw new Error(`the palette color at index ${c} must be a literal value`);l[c]=u}return[s,...l]}function createCallExpressionParser(...n){return function(e,i,s){const o=e[0];let l;for(let c=0;c<n.length;c++){const u=n[c](e,i,s);if(c==n.length-1){if(!u)throw new Error("expected last argument validator to return the parsed args");l=u}}return new CallExpression(i,o,...l)}}function parseCallExpression(n,e,i){const s=n[0],o=parsers[s];if(!o)throw new Error(`unknown operator: ${s}`);return o(n,e,i)}function computeGeometryType(n){if(!n)return"";const e=n.getType();switch(e){case"Point":case"LineString":case"Polygon":return e;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return e.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return computeGeometryType(n.getGeometries()[0]);default:return""}}function newEvaluationContext(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function buildExpression(n,e,i){const s=parse$2(n,e,i);return compileExpression(s)}function compileExpression(n,e){if(n instanceof LiteralExpression){if(n.type===ColorType$1&&typeof n.value=="string"){const s=fromString(n.value);return function(){return s}}return function(){return n.value}}const i=n.operator;switch(i){case Ops.Number:case Ops.String:case Ops.Coalesce:return compileAssertionExpression(n);case Ops.Get:case Ops.Var:case Ops.Has:return compileAccessorExpression(n);case Ops.Id:return s=>s.featureId;case Ops.GeometryType:return s=>s.geometryType;case Ops.Concat:{const s=n.args.map(o=>compileExpression(o));return o=>"".concat(...s.map(l=>l(o).toString()))}case Ops.Resolution:return s=>s.resolution;case Ops.Any:case Ops.All:case Ops.Between:case Ops.In:case Ops.Not:return compileLogicalExpression(n);case Ops.Equal:case Ops.NotEqual:case Ops.LessThan:case Ops.LessThanOrEqualTo:case Ops.GreaterThan:case Ops.GreaterThanOrEqualTo:return compileComparisonExpression(n);case Ops.Multiply:case Ops.Divide:case Ops.Add:case Ops.Subtract:case Ops.Clamp:case Ops.Mod:case Ops.Pow:case Ops.Abs:case Ops.Floor:case Ops.Ceil:case Ops.Round:case Ops.Sin:case Ops.Cos:case Ops.Atan:case Ops.Sqrt:return compileNumericExpression(n);case Ops.Case:return compileCaseExpression(n);case Ops.Match:return compileMatchExpression(n);case Ops.Interpolate:return compileInterpolateExpression(n);case Ops.ToString:return compileConvertExpression(n);default:throw new Error(`Unsupported operator ${i}`)}}function compileAssertionExpression(n,e){const i=n.operator,s=n.args.length,o=new Array(s);for(let l=0;l<s;++l)o[l]=compileExpression(n.args[l]);switch(i){case Ops.Coalesce:return l=>{for(let c=0;c<s;++c){const u=o[c](l);if(typeof u<"u"&&u!==null)return u}throw new Error("Expected one of the values to be non-null")};case Ops.Number:case Ops.String:return l=>{for(let c=0;c<s;++c){const u=o[c](l);if(typeof u===i)return u}throw new Error(`Expected one of the values to be a ${i}`)};default:throw new Error(`Unsupported assertion operator ${i}`)}}function compileAccessorExpression(n,e){const s=n.args[0].value;switch(n.operator){case Ops.Get:return o=>{const l=n.args;let c=o.properties[s];for(let u=1,f=l.length;u<f;++u){const H=l[u].value;c=c[H]}return c};case Ops.Var:return o=>o.variables[s];case Ops.Has:return o=>{const l=n.args;if(!(s in o.properties))return!1;let c=o.properties[s];for(let u=1,f=l.length;u<f;++u){const H=l[u].value;if(!c||!Object.hasOwn(c,H))return!1;c=c[H]}return!0};default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}function compileComparisonExpression(n,e){const i=n.operator,s=compileExpression(n.args[0]),o=compileExpression(n.args[1]);switch(i){case Ops.Equal:return l=>s(l)===o(l);case Ops.NotEqual:return l=>s(l)!==o(l);case Ops.LessThan:return l=>s(l)<o(l);case Ops.LessThanOrEqualTo:return l=>s(l)<=o(l);case Ops.GreaterThan:return l=>s(l)>o(l);case Ops.GreaterThanOrEqualTo:return l=>s(l)>=o(l);default:throw new Error(`Unsupported comparison operator ${i}`)}}function compileLogicalExpression(n,e){const i=n.operator,s=n.args.length,o=new Array(s);for(let l=0;l<s;++l)o[l]=compileExpression(n.args[l]);switch(i){case Ops.Any:return l=>{for(let c=0;c<s;++c)if(o[c](l))return!0;return!1};case Ops.All:return l=>{for(let c=0;c<s;++c)if(!o[c](l))return!1;return!0};case Ops.Between:return l=>{const c=o[0](l),u=o[1](l),f=o[2](l);return c>=u&&c<=f};case Ops.In:return l=>{const c=o[0](l);for(let u=1;u<s;++u)if(c===o[u](l))return!0;return!1};case Ops.Not:return l=>!o[0](l);default:throw new Error(`Unsupported logical operator ${i}`)}}function compileNumericExpression(n,e){const i=n.operator,s=n.args.length,o=new Array(s);for(let l=0;l<s;++l)o[l]=compileExpression(n.args[l]);switch(i){case Ops.Multiply:return l=>{let c=1;for(let u=0;u<s;++u)c*=o[u](l);return c};case Ops.Divide:return l=>o[0](l)/o[1](l);case Ops.Add:return l=>{let c=0;for(let u=0;u<s;++u)c+=o[u](l);return c};case Ops.Subtract:return l=>o[0](l)-o[1](l);case Ops.Clamp:return l=>{const c=o[0](l),u=o[1](l);if(c<u)return u;const f=o[2](l);return c>f?f:c};case Ops.Mod:return l=>o[0](l)%o[1](l);case Ops.Pow:return l=>Math.pow(o[0](l),o[1](l));case Ops.Abs:return l=>Math.abs(o[0](l));case Ops.Floor:return l=>Math.floor(o[0](l));case Ops.Ceil:return l=>Math.ceil(o[0](l));case Ops.Round:return l=>Math.round(o[0](l));case Ops.Sin:return l=>Math.sin(o[0](l));case Ops.Cos:return l=>Math.cos(o[0](l));case Ops.Atan:return s===2?l=>Math.atan2(o[0](l),o[1](l)):l=>Math.atan(o[0](l));case Ops.Sqrt:return l=>Math.sqrt(o[0](l));default:throw new Error(`Unsupported numeric operator ${i}`)}}function compileCaseExpression(n,e){const i=n.args.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=compileExpression(n.args[o]);return o=>{for(let l=0;l<i-1;l+=2)if(s[l](o))return s[l+1](o);return s[i-1](o)}}function compileMatchExpression(n,e){const i=n.args.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=compileExpression(n.args[o]);return o=>{const l=s[0](o);for(let c=1;c<i-1;c+=2)if(l===s[c](o))return s[c+1](o);return s[i-1](o)}}function compileInterpolateExpression(n,e){const i=n.args.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=compileExpression(n.args[o]);return o=>{const l=s[0](o),c=s[1](o);let u,f;for(let g=2;g<i;g+=2){const H=s[g](o);let Y=s[g+1](o);const ee=Array.isArray(Y);if(ee&&(Y=withAlpha(Y)),H>=c)return g===2?Y:ee?interpolateColor(l,c,u,f,H,Y):interpolateNumber$1(l,c,u,f,H,Y);u=H,f=Y}return f}}function compileConvertExpression(n,e){const i=n.operator,s=n.args.length,o=new Array(s);for(let l=0;l<s;++l)o[l]=compileExpression(n.args[l]);switch(i){case Ops.ToString:return l=>{const c=o[0](l);return n.args[0].type===ColorType$1?toString(c):c.toString()};default:throw new Error(`Unsupported convert operator ${i}`)}}function interpolateNumber$1(n,e,i,s,o,l){const c=o-i;if(c===0)return s;const u=e-i,f=n===1?u/c:(Math.pow(n,u)-1)/(Math.pow(n,c)-1);return s+f*(l-s)}function interpolateColor(n,e,i,s,o,l){if(o-i===0)return s;const u=rgbaToLcha(s),f=rgbaToLcha(l);let g=f[2]-u[2];g>180?g-=360:g<-180&&(g+=360);const H=[interpolateNumber$1(n,e,i,u[0],o,f[0]),interpolateNumber$1(n,e,i,u[1],o,f[1]),u[2]+interpolateNumber$1(n,e,i,0,o,g),interpolateNumber$1(n,e,i,s[3],o,l[3])];return lchaToRgba(H)}function always(n){return!0}function rulesToStyleFunction(n){const e=newParsingContext(),i=buildRuleSet(n,e),s=newEvaluationContext();return function(o,l){if(s.properties=o.getPropertiesInternal(),s.resolution=l,e.featureId){const c=o.getId();c!==void 0?s.featureId=c:s.featureId=null}return e.geometryType&&(s.geometryType=computeGeometryType(o.getGeometry())),i(s)}}function flatStylesToStyleFunction(n){const e=newParsingContext(),i=n.length,s=new Array(i);for(let c=0;c<i;++c)s[c]=buildStyle(n[c],e);const o=newEvaluationContext(),l=new Array(i);return function(c,u){if(o.properties=c.getPropertiesInternal(),o.resolution=u,e.featureId){const g=c.getId();g!==void 0?o.featureId=g:o.featureId=null}let f=0;for(let g=0;g<i;++g){const H=s[g](o);H&&(l[f]=H,f+=1)}return l.length=f,l}}function buildRuleSet(n,e){const i=n.length,s=new Array(i);for(let o=0;o<i;++o){const l=n[o],c="filter"in l?buildExpression(l.filter,BooleanType$1,e):always;let u;if(Array.isArray(l.style)){const f=l.style.length;u=new Array(f);for(let g=0;g<f;++g)u[g]=buildStyle(l.style[g],e)}else u=[buildStyle(l.style,e)];s[o]={filter:c,styles:u}}return function(o){const l=[];let c=!1;for(let u=0;u<i;++u){const f=s[u].filter;if(f(o)&&!(n[u].else&&c)){c=!0;for(const g of s[u].styles){const H=g(o);H&&l.push(H)}}}return l}}function buildStyle(n,e){const i=buildFill(n,"",e),s=buildStroke(n,"",e),o=buildText(n,e),l=buildImage(n,e),c=numberEvaluator(n,"z-index",e);if(!i&&!s&&!o&&!l&&!isEmpty$1(n))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(n));const u=new Style$1;return function(f){let g=!0;if(i){const H=i(f);H&&(g=!1),u.setFill(H)}if(s){const H=s(f);H&&(g=!1),u.setStroke(H)}if(o){const H=o(f);H&&(g=!1),u.setText(H)}if(l){const H=l(f);H&&(g=!1),u.setImage(H)}return c&&u.setZIndex(c(f)),g?null:u}}function buildFill(n,e,i){let s;if(e+"fill-pattern-src"in n)s=patternEvaluator(n,e+"fill-",i);else{if(n[e+"fill-color"]==="none")return l=>null;s=colorLikeEvaluator(n,e+"fill-color",i)}if(!s)return null;const o=new Fill;return function(l){const c=s(l);return c===NO_COLOR?null:(o.setColor(c),o)}}function buildStroke(n,e,i){const s=numberEvaluator(n,e+"stroke-width",i),o=colorLikeEvaluator(n,e+"stroke-color",i);if(!s&&!o)return null;const l=stringEvaluator(n,e+"stroke-line-cap",i),c=stringEvaluator(n,e+"stroke-line-join",i),u=numberArrayEvaluator(n,e+"stroke-line-dash",i),f=numberEvaluator(n,e+"stroke-line-dash-offset",i),g=numberEvaluator(n,e+"stroke-miter-limit",i),H=new Stroke;return function(Y){if(o){const ee=o(Y);if(ee===NO_COLOR)return null;H.setColor(ee)}if(s&&H.setWidth(s(Y)),l){const ee=l(Y);if(ee!=="butt"&&ee!=="round"&&ee!=="square")throw new Error("Expected butt, round, or square line cap");H.setLineCap(ee)}if(c){const ee=c(Y);if(ee!=="bevel"&&ee!=="round"&&ee!=="miter")throw new Error("Expected bevel, round, or miter line join");H.setLineJoin(ee)}return u&&H.setLineDash(u(Y)),f&&H.setLineDashOffset(f(Y)),g&&H.setMiterLimit(g(Y)),H}}function buildText(n,e){const i="text-",s=stringEvaluator(n,i+"value",e);if(!s)return null;const o=buildFill(n,i,e),l=buildFill(n,i+"background-",e),c=buildStroke(n,i,e),u=buildStroke(n,i+"background-",e),f=stringEvaluator(n,i+"font",e),g=numberEvaluator(n,i+"max-angle",e),H=numberEvaluator(n,i+"offset-x",e),Y=numberEvaluator(n,i+"offset-y",e),ee=booleanEvaluator(n,i+"overflow",e),te=stringEvaluator(n,i+"placement",e),ne=numberEvaluator(n,i+"repeat",e),Ye=sizeLikeEvaluator(n,i+"scale",e),xe=booleanEvaluator(n,i+"rotate-with-view",e),tt=numberEvaluator(n,i+"rotation",e),et=stringEvaluator(n,i+"align",e),it=stringEvaluator(n,i+"justify",e),rt=stringEvaluator(n,i+"baseline",e),nt=booleanEvaluator(n,i+"keep-upright",e),at=numberArrayEvaluator(n,i+"padding",e),st=optionalDeclutterMode(n,i+"declutter-mode"),ot=new Text({declutterMode:st});return function(ut){if(ot.setText(s(ut)),o&&ot.setFill(o(ut)),l&&ot.setBackgroundFill(l(ut)),c&&ot.setStroke(c(ut)),u&&ot.setBackgroundStroke(u(ut)),f&&ot.setFont(f(ut)),g&&ot.setMaxAngle(g(ut)),H&&ot.setOffsetX(H(ut)),Y&&ot.setOffsetY(Y(ut)),ee&&ot.setOverflow(ee(ut)),te){const ht=te(ut);if(ht!=="point"&&ht!=="line")throw new Error("Expected point or line for text-placement");ot.setPlacement(ht)}if(ne&&ot.setRepeat(ne(ut)),Ye&&ot.setScale(Ye(ut)),xe&&ot.setRotateWithView(xe(ut)),tt&&ot.setRotation(tt(ut)),et){const ht=et(ut);if(ht!=="left"&&ht!=="center"&&ht!=="right"&&ht!=="end"&&ht!=="start")throw new Error("Expected left, right, center, start, or end for text-align");ot.setTextAlign(ht)}if(it){const ht=it(ut);if(ht!=="left"&&ht!=="right"&&ht!=="center")throw new Error("Expected left, right, or center for text-justify");ot.setJustify(ht)}if(rt){const ht=rt(ut);if(ht!=="bottom"&&ht!=="top"&&ht!=="middle"&&ht!=="alphabetic"&&ht!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");ot.setTextBaseline(ht)}return at&&ot.setPadding(at(ut)),nt&&ot.setKeepUpright(nt(ut)),ot}}function buildImage(n,e){return"icon-src"in n?buildIcon(n,e):"shape-points"in n?buildShape(n,e):"circle-radius"in n?buildCircle(n,e):null}function buildIcon(n,e){const i="icon-",s=i+"src",o=requireString(n[s],s),l=coordinateEvaluator(n,i+"anchor",e),c=sizeLikeEvaluator(n,i+"scale",e),u=numberEvaluator(n,i+"opacity",e),f=coordinateEvaluator(n,i+"displacement",e),g=numberEvaluator(n,i+"rotation",e),H=booleanEvaluator(n,i+"rotate-with-view",e),Y=optionalIconOrigin(n,i+"anchor-origin"),ee=optionalIconAnchorUnits(n,i+"anchor-x-units"),te=optionalIconAnchorUnits(n,i+"anchor-y-units"),ne=optionalColorLike(n,i+"color"),Ye=optionalString(n,i+"cross-origin"),xe=optionalNumberArray(n,i+"offset"),tt=optionalIconOrigin(n,i+"offset-origin"),et=optionalNumber(n,i+"width"),it=optionalNumber(n,i+"height"),rt=optionalSize(n,i+"size"),nt=optionalDeclutterMode(n,i+"declutter-mode"),at=new Icon({src:o,anchorOrigin:Y,anchorXUnits:ee,anchorYUnits:te,color:ne,crossOrigin:Ye,offset:xe,offsetOrigin:tt,height:it,width:et,size:rt,declutterMode:nt});return function(st){return u&&at.setOpacity(u(st)),f&&at.setDisplacement(f(st)),g&&at.setRotation(g(st)),H&&at.setRotateWithView(H(st)),c&&at.setScale(c(st)),l&&at.setAnchor(l(st)),at}}function buildShape(n,e){const i="shape-",s=i+"points",o=i+"radius",l=requireNumber(n[s],s),c=requireNumber(n[o],o),u=buildFill(n,i,e),f=buildStroke(n,i,e),g=sizeLikeEvaluator(n,i+"scale",e),H=coordinateEvaluator(n,i+"displacement",e),Y=numberEvaluator(n,i+"rotation",e),ee=booleanEvaluator(n,i+"rotate-with-view",e),te=optionalNumber(n,i+"radius2"),ne=optionalNumber(n,i+"angle"),Ye=optionalDeclutterMode(n,i+"declutter-mode"),xe=new RegularShape({points:l,radius:c,radius2:te,angle:ne,declutterMode:Ye});return function(tt){return u&&xe.setFill(u(tt)),f&&xe.setStroke(f(tt)),H&&xe.setDisplacement(H(tt)),Y&&xe.setRotation(Y(tt)),ee&&xe.setRotateWithView(ee(tt)),g&&xe.setScale(g(tt)),xe}}function buildCircle(n,e){const i="circle-",s=buildFill(n,i,e),o=buildStroke(n,i,e),l=numberEvaluator(n,i+"radius",e),c=sizeLikeEvaluator(n,i+"scale",e),u=coordinateEvaluator(n,i+"displacement",e),f=numberEvaluator(n,i+"rotation",e),g=booleanEvaluator(n,i+"rotate-with-view",e),H=optionalDeclutterMode(n,i+"declutter-mode"),Y=new CircleStyle({radius:5,declutterMode:H});return function(ee){return l&&Y.setRadius(l(ee)),s&&Y.setFill(s(ee)),o&&Y.setStroke(o(ee)),u&&Y.setDisplacement(u(ee)),f&&Y.setRotation(f(ee)),g&&Y.setRotateWithView(g(ee)),c&&Y.setScale(c(ee)),Y}}function numberEvaluator(n,e,i){if(!(e in n))return;const s=buildExpression(n[e],NumberType$1,i);return function(o){return requireNumber(s(o),e)}}function stringEvaluator(n,e,i){if(!(e in n))return null;const s=buildExpression(n[e],StringType$1,i);return function(o){return requireString(s(o),e)}}function patternEvaluator(n,e,i){const s=stringEvaluator(n,e+"pattern-src",i),o=sizeEvaluator(n,e+"pattern-offset",i),l=sizeEvaluator(n,e+"pattern-size",i),c=colorLikeEvaluator(n,e+"color",i);return function(u){return{src:s(u),offset:o&&o(u),size:l&&l(u),color:c&&c(u)}}}function booleanEvaluator(n,e,i){if(!(e in n))return null;const s=buildExpression(n[e],BooleanType$1,i);return function(o){const l=s(o);if(typeof l!="boolean")throw new Error(`Expected a boolean for ${e}`);return l}}function colorLikeEvaluator(n,e,i){if(!(e in n))return null;const s=buildExpression(n[e],ColorType$1,i);return function(o){return requireColorLike(s(o),e)}}function numberArrayEvaluator(n,e,i){if(!(e in n))return null;const s=buildExpression(n[e],NumberArrayType$1,i);return function(o){return requireNumberArray(s(o),e)}}function coordinateEvaluator(n,e,i){if(!(e in n))return null;const s=buildExpression(n[e],NumberArrayType$1,i);return function(o){const l=requireNumberArray(s(o),e);if(l.length!==2)throw new Error(`Expected two numbers for ${e}`);return l}}function sizeEvaluator(n,e,i){if(!(e in n))return null;const s=buildExpression(n[e],NumberArrayType$1,i);return function(o){return requireSize(s(o),e)}}function sizeLikeEvaluator(n,e,i){if(!(e in n))return null;const s=buildExpression(n[e],NumberArrayType$1|NumberType$1,i);return function(o){return requireSizeLike(s(o),e)}}function optionalNumber(n,e){const i=n[e];if(i!==void 0){if(typeof i!="number")throw new Error(`Expected a number for ${e}`);return i}}function optionalSize(n,e){const i=n[e];if(i!==void 0){if(typeof i=="number")return toSize(i);if(!Array.isArray(i))throw new Error(`Expected a number or size array for ${e}`);if(i.length!==2||typeof i[0]!="number"||typeof i[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return i}}function optionalString(n,e){const i=n[e];if(i!==void 0){if(typeof i!="string")throw new Error(`Expected a string for ${e}`);return i}}function optionalIconOrigin(n,e){const i=n[e];if(i!==void 0){if(i!=="bottom-left"&&i!=="bottom-right"&&i!=="top-left"&&i!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return i}}function optionalIconAnchorUnits(n,e){const i=n[e];if(i!==void 0){if(i!=="pixels"&&i!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return i}}function optionalNumberArray(n,e){const i=n[e];if(i!==void 0)return requireNumberArray(i,e)}function optionalDeclutterMode(n,e){const i=n[e];if(i!==void 0){if(typeof i!="string")throw new Error(`Expected a string for ${e}`);if(i!=="declutter"&&i!=="obstacle"&&i!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return i}}function optionalColorLike(n,e){const i=n[e];if(i!==void 0)return requireColorLike(i,e)}function requireNumberArray(n,e){if(!Array.isArray(n))throw new Error(`Expected an array for ${e}`);const i=n.length;for(let s=0;s<i;++s)if(typeof n[s]!="number")throw new Error(`Expected an array of numbers for ${e}`);return n}function requireString(n,e){if(typeof n!="string")throw new Error(`Expected a string for ${e}`);return n}function requireNumber(n,e){if(typeof n!="number")throw new Error(`Expected a number for ${e}`);return n}function requireColorLike(n,e){if(typeof n=="string")return n;const i=requireNumberArray(n,e),s=i.length;if(s<3||s>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return i}function requireSize(n,e){const i=requireNumberArray(n,e);if(i.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return i}function requireSizeLike(n,e){return typeof n=="number"?n:requireSize(n,e)}const ViewProperty={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function createExtent(n,e,i){return(function(s,o,l,c,u){if(!s)return;if(!o&&!e)return s;const f=e?0:l[0]*o,g=e?0:l[1]*o,H=u?u[0]:0,Y=u?u[1]:0;let ee=n[0]+f/2+H,te=n[2]-f/2+H,ne=n[1]+g/2+Y,Ye=n[3]-g/2+Y;ee>te&&(ee=(te+ee)/2,te=ee),ne>Ye&&(ne=(Ye+ne)/2,Ye=ne);let xe=clamp$1(s[0],ee,te),tt=clamp$1(s[1],ne,Ye);if(c&&i&&o){const et=30*o;xe+=-et*Math.log(1+Math.max(0,ee-s[0])/et)+et*Math.log(1+Math.max(0,s[0]-te)/et),tt+=-et*Math.log(1+Math.max(0,ne-s[1])/et)+et*Math.log(1+Math.max(0,s[1]-Ye)/et)}return[xe,tt]})}function none(n){return n}function getViewportClampedResolution(n,e,i,s){const o=getWidth(e)/i[0],l=getHeight(e)/i[1];return s?Math.min(n,Math.max(o,l)):Math.min(n,Math.min(o,l))}function getSmoothClampedResolution(n,e,i){let s=Math.min(n,e);const o=50;return s*=Math.log(1+o*Math.max(0,n/e-1))/o+1,i&&(s=Math.max(s,i),s/=Math.log(1+o*Math.max(0,i/n-1))/o+1),clamp$1(s,i/2,e*2)}function createSnapToResolutions(n,e,i,s){return e=e!==void 0?e:!0,(function(o,l,c,u){if(o!==void 0){const f=n[0],g=n[n.length-1],H=i?getViewportClampedResolution(f,i,c,s):f;if(u)return e?getSmoothClampedResolution(o,H,g):clamp$1(o,g,H);const Y=Math.min(H,o),ee=Math.floor(linearFindNearest(n,Y,l));return n[ee]>H&&ee<n.length-1?n[ee+1]:n[ee]}})}function createSnapToPower(n,e,i,s,o,l){return s=s!==void 0?s:!0,i=i!==void 0?i:0,(function(c,u,f,g){if(c!==void 0){const H=o?getViewportClampedResolution(e,o,f,l):e;if(g)return s?getSmoothClampedResolution(c,H,i):clamp$1(c,i,H);const Y=1e-9,ee=Math.ceil(Math.log(e/H)/Math.log(n)-Y),te=-u*(.5-Y)+.5,ne=Math.min(H,c),Ye=Math.floor(Math.log(e/ne)/Math.log(n)+te),xe=Math.max(ee,Ye),tt=e/Math.pow(n,xe);return clamp$1(tt,i,H)}})}function createMinMaxResolution(n,e,i,s,o){return i=i!==void 0?i:!0,(function(l,c,u,f){if(l!==void 0){const g=s?getViewportClampedResolution(n,s,u,o):n;return!i||!f?clamp$1(l,e,g):getSmoothClampedResolution(l,g,e)}})}const DEFAULT_MIN_ZOOM=0;class View extends BaseObject{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=createProjection(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&disableCoordinateWarning(),e.center&&(e.center=fromUserCoordinate(e.center,this.projection_)),e.extent&&(e.extent=fromUserExtent(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const i=Object.assign({},e);for(const u in ViewProperty)delete i[u];this.setProperties(i,!0);const s=createResolutionConstraint(e);this.maxResolution_=s.maxResolution,this.minResolution_=s.minResolution,this.zoomFactor_=s.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=s.minZoom;const o=createCenterConstraint(e),l=s.constraint,c=createRotationConstraint(e);this.constraints_={center:o,resolution:l,rotation:c},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let i=this.padding_;this.padding_=e;const s=this.getCenterInternal();if(s){const o=e||[0,0,0,0];i=i||[0,0,0,0];const l=this.getResolution(),c=l/2*(o[3]-i[3]+i[1]-o[1]),u=l/2*(o[0]-i[0]+i[2]-o[2]);this.setCenterInternal([s[0]+c,s[1]-u])}}getUpdatedOptions_(e){const i=this.getProperties();return i.resolution!==void 0?i.resolution=this.getResolution():i.zoom=this.getZoom(),i.center=this.getCenterInternal(),i.rotation=this.getRotation(),Object.assign({},i,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const i=new Array(arguments.length);for(let s=0;s<i.length;++s){let o=arguments[s];o.center&&(o=Object.assign({},o),o.center=fromUserCoordinate(o.center,this.getProjection())),o.anchor&&(o=Object.assign({},o),o.anchor=fromUserCoordinate(o.anchor,this.getProjection())),i[s]=o}this.animateInternal.apply(this,i)}animateInternal(e){let i=arguments.length,s;i>1&&typeof arguments[i-1]=="function"&&(s=arguments[i-1],--i);let o=0;for(;o<i&&!this.isDef();++o){const H=arguments[o];H.center&&this.setCenterInternal(H.center),H.zoom!==void 0?this.setZoom(H.zoom):H.resolution&&this.setResolution(H.resolution),H.rotation!==void 0&&this.setRotation(H.rotation)}if(o===i){s&&animationCallback(s,!0);return}let l=Date.now(),c=this.targetCenter_.slice(),u=this.targetResolution_,f=this.targetRotation_;const g=[];for(;o<i;++o){const H=arguments[o],Y={start:l,complete:!1,anchor:H.anchor,duration:H.duration!==void 0?H.duration:1e3,easing:H.easing||inAndOut,callback:s};if(H.center&&(Y.sourceCenter=c,Y.targetCenter=H.center.slice(),c=Y.targetCenter),H.zoom!==void 0?(Y.sourceResolution=u,Y.targetResolution=this.getResolutionForZoom(H.zoom),u=Y.targetResolution):H.resolution&&(Y.sourceResolution=u,Y.targetResolution=H.resolution,u=Y.targetResolution),H.rotation!==void 0){Y.sourceRotation=f;const ee=modulo(H.rotation-f+Math.PI,2*Math.PI)-Math.PI;Y.targetRotation=f+ee,f=Y.targetRotation}isNoopAnimation(Y)?Y.complete=!0:l+=Y.duration,g.push(Y)}this.animations_.push(g),this.setHint(ViewHint.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ViewHint.ANIMATING]>0}getInteracting(){return this.hints_[ViewHint.INTERACTING]>0}cancelAnimations(){this.setHint(ViewHint.ANIMATING,-this.hints_[ViewHint.ANIMATING]);let e;for(let i=0,s=this.animations_.length;i<s;++i){const o=this.animations_[i];if(o[0].callback&&animationCallback(o[0].callback,!1),!e)for(let l=0,c=o.length;l<c;++l){const u=o[l];if(!u.complete){e=u.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let i=!1;for(let s=this.animations_.length-1;s>=0;--s){const o=this.animations_[s];let l=!0;for(let c=0,u=o.length;c<u;++c){const f=o[c];if(f.complete)continue;const g=e-f.start;let H=f.duration>0?g/f.duration:1;H>=1?(f.complete=!0,H=1):l=!1;const Y=f.easing(H);if(f.sourceCenter){const ee=f.sourceCenter[0],te=f.sourceCenter[1],ne=f.targetCenter[0],Ye=f.targetCenter[1];this.nextCenter_=f.targetCenter;const xe=ee+Y*(ne-ee),tt=te+Y*(Ye-te);this.targetCenter_=[xe,tt]}if(f.sourceResolution&&f.targetResolution){const ee=Y===1?f.targetResolution:f.sourceResolution+Y*(f.targetResolution-f.sourceResolution);if(f.anchor){const te=this.getViewportSize_(this.getRotation()),ne=this.constraints_.resolution(ee,0,te,!0);this.targetCenter_=this.calculateCenterZoom(ne,f.anchor)}this.nextResolution_=f.targetResolution,this.targetResolution_=ee,this.applyTargetState_(!0)}if(f.sourceRotation!==void 0&&f.targetRotation!==void 0){const ee=Y===1?modulo(f.targetRotation+Math.PI,2*Math.PI)-Math.PI:f.sourceRotation+Y*(f.targetRotation-f.sourceRotation);if(f.anchor){const te=this.constraints_.rotation(ee,!0);this.targetCenter_=this.calculateCenterRotate(te,f.anchor)}this.nextRotation_=f.targetRotation,this.targetRotation_=ee}if(this.applyTargetState_(!0),i=!0,!f.complete)break}if(l){this.animations_[s]=null,this.setHint(ViewHint.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const c=o[0].callback;c&&animationCallback(c,!0)}}this.animations_=this.animations_.filter(Boolean),i&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,i){let s;const o=this.getCenterInternal();return o!==void 0&&(s=[o[0]-i[0],o[1]-i[1]],rotate$1(s,e-this.getRotation()),add$3(s,i)),s}calculateCenterZoom(e,i){let s;const o=this.getCenterInternal(),l=this.getResolution();if(o!==void 0&&l!==void 0){const c=i[0]-e*(i[0]-o[0])/l,u=i[1]-e*(i[1]-o[1])/l;s=[c,u]}return s}getViewportSize_(e){const i=this.viewportSize_;if(e){const s=i[0],o=i[1];return[Math.abs(s*Math.cos(e))+Math.abs(o*Math.sin(e)),Math.abs(s*Math.sin(e))+Math.abs(o*Math.cos(e))]}return i}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&toUserCoordinate(e,this.getProjection())}getCenterInternal(){return this.get(ViewProperty.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const i=this.calculateExtentInternal(e);return toUserExtent(i,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const i=this.getCenterInternal();assert(i,"The view center is not defined");const s=this.getResolution();assert(s!==void 0,"The view resolution is not defined");const o=this.getRotation();return assert(o!==void 0,"The view rotation is not defined"),getForViewAndSize(i,s,o,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(ViewProperty.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,i){return this.getResolutionForExtentInternal(fromUserExtent(e,this.getProjection()),i)}getResolutionForExtentInternal(e,i){i=i||this.getViewportSizeMinusPadding_();const s=getWidth(e)/i[0],o=getHeight(e)/i[1];return Math.max(s,o)}getResolutionForValueFunction(e){e=e||2;const i=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,o=Math.log(i/s)/Math.log(e);return(function(l){return i/Math.pow(e,l*o)})}getRotation(){return this.get(ViewProperty.ROTATION)}getValueForResolutionFunction(e){const i=Math.log(e||2),s=this.getConstrainedResolution(this.maxResolution_),o=this.minResolution_,l=Math.log(s/o)/i;return(function(c){return Math.log(s/c)/i/l})}getViewportSizeMinusPadding_(e){let i=this.getViewportSize_(e);const s=this.padding_;return s&&(i=[i[0]-s[1]-s[3],i[1]-s[0]-s[2]]),i}getState(){const e=this.getProjection(),i=this.getResolution(),s=this.getRotation();let o=this.getCenterInternal();const l=this.padding_;if(l){const c=this.getViewportSizeMinusPadding_();o=calculateCenterOn(o,this.getViewportSize_(),[c[0]/2+l[3],c[1]/2+l[0]],i,s)}return{center:o.slice(0),projection:e!==void 0?e:null,resolution:i,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:s,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const i=this.getResolution();return i!==void 0&&(e=this.getZoomForResolution(i)),e}getZoomForResolution(e){let i=this.minZoom_||0,s,o;if(this.resolutions_){const l=linearFindNearest(this.resolutions_,e,1);i=l,s=this.resolutions_[l],l==this.resolutions_.length-1?o=2:o=s/this.resolutions_[l+1]}else s=this.maxResolution_,o=this.zoomFactor_;return i+Math.log(s/e)/Math.log(o)}getResolutionForZoom(e){var i;if((i=this.resolutions_)!=null&&i.length){if(this.resolutions_.length===1)return this.resolutions_[0];const s=clamp$1(Math.floor(e),0,this.resolutions_.length-2),o=this.resolutions_[s]/this.resolutions_[s+1];return this.resolutions_[s]/Math.pow(o,clamp$1(e-s,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,i){let s;if(assert(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){assert(!isEmpty(e),"Cannot fit empty extent provided as `geometry`");const o=fromUserExtent(e,this.getProjection());s=fromExtent(o)}else if(e.getType()==="Circle"){const o=fromUserExtent(e.getExtent(),this.getProjection());s=fromExtent(o),s.rotate(this.getRotation(),getCenter(o))}else s=e;this.fitInternal(s,i)}rotatedExtentForGeometry(e){const i=this.getRotation(),s=Math.cos(i),o=Math.sin(-i),l=e.getFlatCoordinates(),c=e.getStride();let u=1/0,f=1/0,g=-1/0,H=-1/0;for(let Y=0,ee=l.length;Y<ee;Y+=c){const te=l[Y]*s-l[Y+1]*o,ne=l[Y]*o+l[Y+1]*s;u=Math.min(u,te),f=Math.min(f,ne),g=Math.max(g,te),H=Math.max(H,ne)}return[u,f,g,H]}fitInternal(e,i){i=i||{};let s=i.size;s||(s=this.getViewportSizeMinusPadding_());const o=i.padding!==void 0?i.padding:[0,0,0,0],l=i.nearest!==void 0?i.nearest:!1;let c;i.minResolution!==void 0?c=i.minResolution:i.maxZoom!==void 0?c=this.getResolutionForZoom(i.maxZoom):c=0;const u=this.rotatedExtentForGeometry(e);let f=this.getResolutionForExtentInternal(u,[s[0]-o[1]-o[3],s[1]-o[0]-o[2]]);f=isNaN(f)?c:Math.max(f,c),f=this.getConstrainedResolution(f,l?0:1);const g=this.getRotation(),H=Math.sin(g),Y=Math.cos(g),ee=getCenter(u);ee[0]+=(o[1]-o[3])/2*f,ee[1]+=(o[0]-o[2])/2*f;const te=ee[0]*Y-ee[1]*H,ne=ee[1]*Y+ee[0]*H,Ye=this.getConstrainedCenter([te,ne],f),xe=i.callback?i.callback:VOID;i.duration!==void 0?this.animateInternal({resolution:f,center:Ye,duration:i.duration,easing:i.easing},xe):(this.targetResolution_=f,this.targetCenter_=Ye,this.applyTargetState_(!1,!0),animationCallback(xe,!0))}centerOn(e,i,s){this.centerOnInternal(fromUserCoordinate(e,this.getProjection()),i,s)}centerOnInternal(e,i,s){this.setCenterInternal(calculateCenterOn(e,i,s,this.getResolution(),this.getRotation()))}calculateCenterShift(e,i,s,o){let l;const c=this.padding_;if(c&&e){const u=this.getViewportSizeMinusPadding_(-s),f=calculateCenterOn(e,o,[u[0]/2+c[3],u[1]/2+c[0]],i,s);l=[e[0]-f[0],e[1]-f[1]]}return l}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const i=toUserCoordinate(this.targetCenter_,this.getProjection());this.setCenter([i[0]+e[0],i[1]+e[1]])}adjustCenterInternal(e){const i=this.targetCenter_;this.setCenterInternal([i[0]+e[0],i[1]+e[1]])}adjustResolution(e,i){i=i&&fromUserCoordinate(i,this.getProjection()),this.adjustResolutionInternal(e,i)}adjustResolutionInternal(e,i){const s=this.getAnimating()||this.getInteracting(),o=this.getViewportSize_(this.getRotation()),l=this.constraints_.resolution(this.targetResolution_*e,0,o,s);i&&(this.targetCenter_=this.calculateCenterZoom(l,i)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,i){this.adjustResolution(Math.pow(this.zoomFactor_,-e),i)}adjustRotation(e,i){i&&(i=fromUserCoordinate(i,this.getProjection())),this.adjustRotationInternal(e,i)}adjustRotationInternal(e,i){const s=this.getAnimating()||this.getInteracting(),o=this.constraints_.rotation(this.targetRotation_+e,s);i&&(this.targetCenter_=this.calculateCenterRotate(o,i)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&fromUserCoordinate(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,i){return this.hints_[e]+=i,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,i){const s=this.getAnimating()||this.getInteracting()||i,o=this.constraints_.rotation(this.targetRotation_,s),l=this.getViewportSize_(o),c=this.constraints_.resolution(this.targetResolution_,0,l,s),u=this.constraints_.center(this.targetCenter_,c,l,s,this.calculateCenterShift(this.targetCenter_,c,o,l));this.get(ViewProperty.ROTATION)!==o&&this.set(ViewProperty.ROTATION,o),this.get(ViewProperty.RESOLUTION)!==c&&(this.set(ViewProperty.RESOLUTION,c),this.set("zoom",this.getZoom(),!0)),(!u||!this.get(ViewProperty.CENTER)||!equals(this.get(ViewProperty.CENTER),u))&&this.set(ViewProperty.CENTER,u),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,i,s){e=e!==void 0?e:200;const o=i||0,l=this.constraints_.rotation(this.targetRotation_),c=this.getViewportSize_(l),u=this.constraints_.resolution(this.targetResolution_,o,c),f=this.constraints_.center(this.targetCenter_,u,c,!1,this.calculateCenterShift(this.targetCenter_,u,l,c));if(e===0&&!this.cancelAnchor_){this.targetResolution_=u,this.targetRotation_=l,this.targetCenter_=f,this.applyTargetState_();return}s=s||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==u||this.getRotation()!==l||!this.getCenterInternal()||!equals(this.getCenterInternal(),f))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:l,center:f,resolution:u,duration:e,easing:easeOut,anchor:s}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ViewHint.INTERACTING,1)}endInteraction(e,i,s){s=s&&fromUserCoordinate(s,this.getProjection()),this.endInteractionInternal(e,i,s)}endInteractionInternal(e,i,s){this.getInteracting()&&(this.setHint(ViewHint.INTERACTING,-1),this.resolveConstraints(e,i,s))}getConstrainedCenter(e,i){const s=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,i||this.getResolution(),s)}getConstrainedZoom(e,i){const s=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(s,i))}getConstrainedResolution(e,i){i=i||0;const s=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,i,s)}}function animationCallback(n,e){setTimeout(function(){n(e)},0)}function createCenterConstraint(n){if(n.extent!==void 0){const i=n.smoothExtentConstraint!==void 0?n.smoothExtentConstraint:!0;return createExtent(n.extent,n.constrainOnlyCenter,i)}const e=createProjection(n.projection,"EPSG:3857");if(n.multiWorld!==!0&&e.isGlobal()){const i=e.getExtent().slice();return i[0]=-1/0,i[2]=1/0,createExtent(i,!1,!1)}return none}function createResolutionConstraint(n){let e,i,s,c=n.minZoom!==void 0?n.minZoom:DEFAULT_MIN_ZOOM,u=n.maxZoom!==void 0?n.maxZoom:28;const f=n.zoomFactor!==void 0?n.zoomFactor:2,g=n.multiWorld!==void 0?n.multiWorld:!1,H=n.smoothResolutionConstraint!==void 0?n.smoothResolutionConstraint:!0,Y=n.showFullExtent!==void 0?n.showFullExtent:!1,ee=createProjection(n.projection,"EPSG:3857"),te=ee.getExtent();let ne=n.constrainOnlyCenter,Ye=n.extent;if(!g&&!Ye&&ee.isGlobal()&&(ne=!1,Ye=te),n.resolutions!==void 0){const xe=n.resolutions;i=xe[c],s=xe[u]!==void 0?xe[u]:xe[xe.length-1],n.constrainResolution?e=createSnapToResolutions(xe,H,!ne&&Ye,Y):e=createMinMaxResolution(i,s,H,!ne&&Ye,Y)}else{const tt=(te?Math.max(getWidth(te),getHeight(te)):360*METERS_PER_UNIT$1.degrees/ee.getMetersPerUnit())/DEFAULT_TILE_SIZE/Math.pow(2,DEFAULT_MIN_ZOOM),et=tt/Math.pow(2,28-DEFAULT_MIN_ZOOM);i=n.maxResolution,i!==void 0?c=0:i=tt/Math.pow(f,c),s=n.minResolution,s===void 0&&(n.maxZoom!==void 0?n.maxResolution!==void 0?s=i/Math.pow(f,u):s=tt/Math.pow(f,u):s=et),u=c+Math.floor(Math.log(i/s)/Math.log(f)),s=i/Math.pow(f,u-c),n.constrainResolution?e=createSnapToPower(f,i,s,H,!ne&&Ye,Y):e=createMinMaxResolution(i,s,H,!ne&&Ye,Y)}return{constraint:e,maxResolution:i,minResolution:s,minZoom:c,zoomFactor:f}}function createRotationConstraint(n){if(n.enableRotation!==void 0?n.enableRotation:!0){const i=n.constrainRotation;return i===void 0||i===!0?createSnapToZero():i===!1?none$1:typeof i=="number"?createSnapToN(i):none$1}return disable}function isNoopAnimation(n){return!(n.sourceCenter&&n.targetCenter&&!equals(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function calculateCenterOn(n,e,i,s,o){const l=Math.cos(-o);let c=Math.sin(-o),u=n[0]*l-n[1]*c,f=n[1]*l+n[0]*c;u+=(e[0]/2-i[0])*s,f+=(i[1]-e[1]/2)*s,c=-c;const g=u*l-f*c,H=f*l+u*c;return[g,H]}const LayerProperty={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class BaseLayer extends BaseObject{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const i=Object.assign({},e);typeof e.properties=="object"&&(delete i.properties,Object.assign(i,e.properties)),i[LayerProperty.OPACITY]=e.opacity!==void 0?e.opacity:1,assert(typeof i[LayerProperty.OPACITY]=="number","Layer opacity must be a number"),i[LayerProperty.VISIBLE]=e.visible!==void 0?e.visible:!0,i[LayerProperty.Z_INDEX]=e.zIndex,i[LayerProperty.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,i[LayerProperty.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,i[LayerProperty.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,i[LayerProperty.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=i.className!==void 0?i.className:"ol-layer",delete i.className,this.setProperties(i),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const i=this.state_||{layer:this,managed:e===void 0?!0:e},s=this.getZIndex();return i.opacity=clamp$1(Math.round(this.getOpacity()*100)/100,0,1),i.visible=this.getVisible(),i.extent=this.getExtent(),i.zIndex=s===void 0&&!i.managed?1/0:s,i.maxResolution=this.getMaxResolution(),i.minResolution=Math.max(this.getMinResolution(),0),i.minZoom=this.getMinZoom(),i.maxZoom=this.getMaxZoom(),this.state_=i,i}getLayersArray(e){return abstract()}getLayerStatesArray(e){return abstract()}getExtent(){return this.get(LayerProperty.EXTENT)}getMaxResolution(){return this.get(LayerProperty.MAX_RESOLUTION)}getMinResolution(){return this.get(LayerProperty.MIN_RESOLUTION)}getMinZoom(){return this.get(LayerProperty.MIN_ZOOM)}getMaxZoom(){return this.get(LayerProperty.MAX_ZOOM)}getOpacity(){return this.get(LayerProperty.OPACITY)}getSourceState(){return abstract()}getVisible(){return this.get(LayerProperty.VISIBLE)}getZIndex(){return this.get(LayerProperty.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(LayerProperty.EXTENT,e)}setMaxResolution(e){this.set(LayerProperty.MAX_RESOLUTION,e)}setMinResolution(e){this.set(LayerProperty.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(LayerProperty.MAX_ZOOM,e)}setMinZoom(e){this.set(LayerProperty.MIN_ZOOM,e)}setOpacity(e){assert(typeof e=="number","Layer opacity must be a number"),this.set(LayerProperty.OPACITY,e)}setVisible(e){this.set(LayerProperty.VISIBLE,e)}setZIndex(e){this.set(LayerProperty.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}let Layer$1=class extends BaseLayer{constructor(e){const i=Object.assign({},e);delete i.source,super(i),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(LayerProperty.SOURCE,this.handleSourcePropertyChange_);const s=e.source?e.source:null;this.setSource(s)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(LayerProperty.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(unlistenByKey(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=listen(e,EventType$1.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let i;const s=this.getMapInternal();!e&&s&&(e=s.getView()),e instanceof View?i={viewState:e.getState(),extent:e.calculateExtent()}:i=e,!i.layerStatesArray&&s&&(i.layerStatesArray=s.getLayerGroup().getLayerStatesArray());let o;if(i.layerStatesArray){if(o=i.layerStatesArray.find(c=>c.layer===this),!o)return!1}else o=this.getLayerState();const l=this.getExtent();return inView(o,i.viewState)&&(!l||intersects$1(l,i.extent))}getAttributions(e){var l;if(!this.isVisible(e))return[];const i=(l=this.getSource())==null?void 0:l.getAttributions();if(!i)return[];const s=e instanceof View?e.getViewStateAndExtent():e;let o=i(s);return Array.isArray(o)||(o=[o]),o}render(e,i){const s=this.getRenderer();return s.prepareFrame(e)?(this.rendered=!0,s.renderFrame(e,i)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,i){}renderDeferred(e){const i=this.getRenderer();i&&i.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(LayerProperty.MAP,e)}getMapInternal(){return this.get(LayerProperty.MAP)}setMap(e){this.mapPrecomposeKey_&&(unlistenByKey(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(unlistenByKey(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=listen(e,EventType.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=listen(this,EventType$1.CHANGE,e.render,e),this.changed())}handlePrecompose_(e){const i=e.frameState.layerStatesArray,s=this.getLayerState(!1);assert(!i.some(o=>o.layer===s.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),i.push(s)}setSource(e){this.set(LayerProperty.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}};function inView(n,e){if(!n.visible)return!1;const i=e.resolution;if(i<n.minResolution||i>=n.maxResolution)return!1;const s=e.zoom;return s>n.minZoom&&s<=n.maxZoom}const Property$1={RENDER_ORDER:"renderOrder"};class BaseVectorLayer extends Layer$1{constructor(e){e=e||{};const i=Object.assign({},e);delete i.style,delete i.renderBuffer,delete i.updateWhileAnimating,delete i.updateWhileInteracting,super(i),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Property$1.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,i){const s=this.getDeclutter();s in e.declutter||(e.declutter[s]=new RBush$1(9)),this.getRenderer().renderDeclutter(e,i)}setRenderOrder(e){this.set(Property$1.RENDER_ORDER,e)}setStyle(e){this.style_=e===void 0?createDefaultStyle:e;const i=toStyleLike(e);this.styleFunction_=e===null?void 0:toFunction(i),this.changed()}setDeclutter(e){this.declutter_=e?String(e):void 0,this.changed()}}function toStyleLike(n){if(n===void 0)return createDefaultStyle;if(!n)return null;if(typeof n=="function"||n instanceof Style$1)return n;if(!Array.isArray(n))return flatStylesToStyleFunction([n]);if(n.length===0)return[];const e=n.length,i=n[0];if(i instanceof Style$1){const o=new Array(e);for(let l=0;l<e;++l){const c=n[l];if(!(c instanceof Style$1))throw new Error("Expected a list of style instances");o[l]=c}return o}if("style"in i){const o=new Array(e);for(let l=0;l<e;++l){const c=n[l];if(!("style"in c))throw new Error("Expected a list of rules with a style property");o[l]=c}return rulesToStyleFunction(o)}return flatStylesToStyleFunction(n)}class VectorLayer extends BaseVectorLayer{constructor(e){super(e)}createRenderer(){return new CanvasVectorLayerRenderer(this)}}const DrawEventType={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class DrawEvent extends BaseEvent{constructor(e,i){super(e),this.feature=i}}function getTraceTargets(n,e){const i=[];for(let s=0;s<e.length;++s){const l=e[s].getGeometry();appendGeometryTraceTargets(n,l,i)}return i}function getSquaredDistance(n,e){return squaredDistance$1(n[0],n[1],e[0],e[1])}function getCoordinate(n,e){const i=n.length;return e<0?n[e+i]:e>=i?n[e-i]:n[e]}function getCumulativeSquaredDistance(n,e,i){let s,o;e<i?(s=e,o=i):(s=i,o=e);const l=Math.ceil(s),c=Math.floor(o);if(l>c){const f=interpolateCoordinate(n,s),g=interpolateCoordinate(n,o);return getSquaredDistance(f,g)}let u=0;if(s<l){const f=interpolateCoordinate(n,s),g=getCoordinate(n,l);u+=getSquaredDistance(f,g)}if(c<o){const f=getCoordinate(n,c),g=interpolateCoordinate(n,o);u+=getSquaredDistance(f,g)}for(let f=l;f<c-1;++f){const g=getCoordinate(n,f),H=getCoordinate(n,f+1);u+=getSquaredDistance(g,H)}return u}function appendGeometryTraceTargets(n,e,i){if(e instanceof LineString){appendTraceTarget(n,e.getCoordinates(),!1,i);return}if(e instanceof MultiLineString){const s=e.getCoordinates();for(let o=0,l=s.length;o<l;++o)appendTraceTarget(n,s[o],!1,i);return}if(e instanceof Polygon){const s=e.getCoordinates();for(let o=0,l=s.length;o<l;++o)appendTraceTarget(n,s[o],!0,i);return}if(e instanceof MultiPolygon){const s=e.getCoordinates();for(let o=0,l=s.length;o<l;++o){const c=s[o];for(let u=0,f=c.length;u<f;++u)appendTraceTarget(n,c[u],!0,i)}return}if(e instanceof GeometryCollection){const s=e.getGeometries();for(let o=0;o<s.length;++o)appendGeometryTraceTargets(n,s[o],i);return}}const sharedUpdateInfo={index:-1,endIndex:NaN};function getTraceTargetUpdate(n,e,i,s){const o=n[0],l=n[1];let c=1/0,u=-1,f=NaN;for(let Y=0;Y<e.targets.length;++Y){const ee=e.targets[Y],te=ee.coordinates;let ne=1/0,Ye;for(let xe=0;xe<te.length-1;++xe){const tt=te[xe],et=te[xe+1],it=getPointSegmentRelationship(o,l,tt,et);it.squaredDistance<ne&&(ne=it.squaredDistance,Ye=xe+it.along)}ne<c&&(c=ne,ee.ring&&e.targetIndex===Y&&(ee.endIndex>ee.startIndex?Ye<ee.startIndex&&(Ye+=te.length):ee.endIndex<ee.startIndex&&Ye>ee.startIndex&&(Ye-=te.length)),f=Ye,u=Y)}const g=e.targets[u];let H=g.ring;if(e.targetIndex===u&&H){const Y=interpolateCoordinate(g.coordinates,f),ee=i.getPixelFromCoordinate(Y);distance(ee,e.startPx)>s&&(H=!1)}if(H){const Y=g.coordinates,ee=Y.length,te=g.startIndex,ne=f;if(te<ne){const Ye=getCumulativeSquaredDistance(Y,te,ne);getCumulativeSquaredDistance(Y,te,ne-ee)<Ye&&(f-=ee)}else{const Ye=getCumulativeSquaredDistance(Y,te,ne);getCumulativeSquaredDistance(Y,te,ne+ee)<Ye&&(f+=ee)}}return sharedUpdateInfo.index=u,sharedUpdateInfo.endIndex=f,sharedUpdateInfo}function appendTraceTarget(n,e,i,s){const o=n[0],l=n[1];for(let c=0,u=e.length-1;c<u;++c){const f=e[c],g=e[c+1],H=getPointSegmentRelationship(o,l,f,g);if(H.squaredDistance===0){const Y=c+H.along;s.push({coordinates:e,ring:i,startIndex:Y,endIndex:Y});return}}}const sharedRel={along:0,squaredDistance:0};function getPointSegmentRelationship(n,e,i,s){const o=i[0],l=i[1],c=s[0],u=s[1],f=c-o,g=u-l;let H=0,Y=o,ee=l;return(f!==0||g!==0)&&(H=clamp$1(((n-o)*f+(e-l)*g)/(f*f+g*g),0,1),Y+=f*H,ee+=g*H),sharedRel.along=H,sharedRel.squaredDistance=toFixed(squaredDistance$1(n,e,Y,ee),10),sharedRel}function interpolateCoordinate(n,e){const i=n.length;let s=Math.floor(e);const o=e-s;s>=i?s-=i:s<0&&(s+=i);let l=s+1;l>=i&&(l-=i);const c=n[s],u=c[0],f=c[1],g=n[l],H=g[0]-u,Y=g[1]-f;return[u+H*o,f+Y*o]}class Draw extends PointerInteraction{constructor(e){const i=e;i.stopDown||(i.stopDown=FALSE),super(i),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=getMode(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:TRUE,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let s=e.geometryFunction;if(!s){const o=this.mode_;if(o==="Circle")s=(l,c,u)=>{const f=c||new Circle([NaN,NaN]),g=fromUserCoordinate(l[0]),H=squaredDistance(g,fromUserCoordinate(l[l.length-1]));return f.setCenterAndRadius(g,Math.sqrt(H),this.geometryLayout_),f};else{let l;o==="Point"?l=Point$1:o==="LineString"?l=LineString:o==="Polygon"&&(l=Polygon),s=(c,u,f)=>(u?o==="Polygon"?c[0].length?u.setCoordinates([c[0].concat([c[0][0]])],this.geometryLayout_):u.setCoordinates([],this.geometryLayout_):u.setCoordinates(c,this.geometryLayout_):u=new l(c,this.geometryLayout_),u)}}this.geometryFunction_=s,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:getDefaultStyleFunction$2(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:noModifierKeys,this.freehandCondition_,e.freehand?this.freehandCondition_=always$1:this.freehandCondition_=e.freehandCondition?e.freehandCondition:shiftKeyOnly,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(InteractionProperty.ACTIVE,this.updateState_)}setTrace(e){let i;e?e===!0?i=always$1:i=e:i=never,this.traceCondition_=i}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===EventType$1.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let i=e.type===MapBrowserEventType.POINTERMOVE,s=!0;return!this.freehand_&&this.lastDragTime_&&e.type===MapBrowserEventType.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,i=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===MapBrowserEventType.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),s=!1):this.freehand_&&e.type===MapBrowserEventType.POINTERDOWN?s=!1:i&&this.getPointerCount()<2?(s=e.type===MapBrowserEventType.POINTERMOVE,s&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===MapBrowserEventType.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===MapBrowserEventType.DBLCLICK&&(s=!1),super.handleEvent(e)&&s}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new MapBrowserEvent(MapBrowserEventType.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const i=this.getMap(),s=i.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),o=i.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),l=boundingExtent([s,o]),c=this.traceSource_.getFeaturesInExtent(l);if(c.length===0)return;const u=getTraceTargets(e.coordinate,c);u.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:u,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,i){const s=e.startIndex<=e.endIndex,o=e.startIndex<=i;s===o?s&&i>e.endIndex||!s&&i<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,i):(s&&i<e.endIndex||!s&&i>e.endIndex)&&this.removeTracedCoordinates_(i,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,i))}removeTracedCoordinates_(e,i){if(e===i)return;let s=0;if(e<i){const o=Math.ceil(e);let l=Math.floor(i);l===i&&(l-=1),s=l-o+1}else{const o=Math.floor(e);let l=Math.ceil(i);l===i&&(l+=1),s=o-l+1}s>0&&this.removeLastPoints_(s)}addTracedCoordinates_(e,i,s){if(i===s)return;const o=[];if(i<s){const l=Math.ceil(i);let c=Math.floor(s);c===s&&(c-=1);for(let u=l;u<=c;++u)o.push(getCoordinate(e.coordinates,u))}else{const l=Math.floor(i);let c=Math.ceil(s);c===s&&(c+=1);for(let u=l;u>=c;--u)o.push(getCoordinate(e.coordinates,u))}o.length&&this.appendCoordinates(o)}updateTrace_(e){const i=this.traceState_;if(!i.active||i.targetIndex===-1&&distance(i.startPx,e.pixel)<this.snapTolerance_)return;const s=getTraceTargetUpdate(e.coordinate,i,this.getMap(),this.snapTolerance_);if(i.targetIndex!==s.index){if(i.targetIndex!==-1){const f=i.targets[i.targetIndex];this.removeTracedCoordinates_(f.startIndex,f.endIndex)}const u=i.targets[s.index];this.addTracedCoordinates_(u,u.startIndex,s.endIndex)}else{const u=i.targets[i.targetIndex];this.addOrRemoveTracedCoordinates_(u,s.endIndex)}i.targetIndex=s.index;const o=i.targets[i.targetIndex];o.endIndex=s.endIndex;const l=interpolateCoordinate(o.coordinates,o.endIndex),c=this.getMap().getPixelFromCoordinate(l);e.coordinate=l,e.pixel=[Math.round(c[0]),Math.round(c[1])]}handleUpEvent(e){let i=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const s=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const o=!this.finishCoordinate_;o&&this.startDrawing_(e.coordinate),!o&&this.freehand_?this.finishDrawing():!this.freehand_&&(!o||this.mode_==="Point")&&(this.atFinish_(e.pixel,s)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),i=!1}else this.freehand_&&this.abortDrawing()}return!i&&this.stopClick_&&e.preventDefault(),i}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const i=this.downPx_,s=e.pixel,o=i[0]-s[0],l=i[1]-s[1],c=o*o+l*l;if(this.shouldHandle_=this.freehand_?c>this.squaredClickTolerance_:c<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,i){let s=!1;if(this.sketchFeature_){let o=!1,l=[this.finishCoordinate_];const c=this.mode_;if(c==="Point")s=!0;else if(c==="Circle")s=this.sketchCoords_.length===2;else if(c==="LineString")o=!i&&this.sketchCoords_.length>this.minPoints_;else if(c==="Polygon"){const u=this.sketchCoords_;o=u[0].length>this.minPoints_,l=[u[0][0],u[0][u[0].length-2]],i?l=[u[0][0]]:l=[u[0][0],u[0][u[0].length-2]]}if(o){const u=this.getMap();for(let f=0,g=l.length;f<g;f++){const H=l[f],Y=u.getPixelFromCoordinate(H),ee=e[0]-Y[0],te=e[1]-Y[1],ne=this.freehand_?1:this.snapTolerance_;if(s=Math.sqrt(ee*ee+te*te)<=ne,s){this.finishCoordinate_=H;break}}}}return s}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new Feature(new Point$1(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new Feature);const i=e.getLinearRing(0);let s=this.sketchLine_.getGeometry();s?(s.setFlatCoordinates(i.getLayout(),i.getFlatCoordinates()),s.changed()):(s=new LineString(i.getFlatCoordinates(),i.getLayout()),this.sketchLine_.setGeometry(s))}startDrawing_(e){const i=this.getMap().getView().getProjection(),s=getStrideForLayout(this.geometryLayout_);for(;e.length<s;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Feature(new LineString(this.sketchLineCoords_)));const o=this.geometryFunction_(this.sketchCoords_,void 0,i);this.sketchFeature_=new Feature,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(o),this.updateSketchFeatures_(),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const i=this.getMap(),s=this.sketchFeature_.getGeometry(),o=i.getView().getProjection(),l=getStrideForLayout(this.geometryLayout_);let c,u;for(;e.length<l;)e.push(0);this.mode_==="Point"?u=this.sketchCoords_:this.mode_==="Polygon"?(c=this.sketchCoords_[0],u=c[c.length-1],this.atFinish_(i.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(c=this.sketchCoords_,u=c[c.length-1]),u[0]=e[0],u[1]=e[1],this.geometryFunction_(this.sketchCoords_,s,o),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),s.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(s):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const i=this.sketchFeature_.getGeometry(),s=this.getMap().getView().getProjection();let o,l;const c=this.mode_;return c==="LineString"||c==="Circle"?(this.finishCoordinate_=e.slice(),l=this.sketchCoords_,l.length>=this.maxPoints_&&(this.freehand_?l.pop():o=!0),l.push(e.slice()),this.geometryFunction_(l,i,s)):c==="Polygon"&&(l=this.sketchCoords_[0],l.length>=this.maxPoints_&&(this.freehand_?l.pop():o=!0),l.push(e.slice()),o&&(this.finishCoordinate_=l[0]),this.geometryFunction_(this.sketchCoords_,i,s)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),o?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const i=this.sketchFeature_.getGeometry(),s=this.getMap().getView().getProjection(),o=this.mode_;for(let l=0;l<e;++l){let c;if(o==="LineString"||o==="Circle"){if(c=this.sketchCoords_,c.splice(-2,1),c.length>=2){this.finishCoordinate_=c[c.length-2].slice();const u=this.finishCoordinate_.slice();c[c.length-1]=u,this.createOrUpdateSketchPoint_(u)}this.geometryFunction_(c,i,s),i.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(i)}else if(o==="Polygon"){c=this.sketchCoords_[0],c.splice(-2,1);const u=this.sketchLine_.getGeometry();if(c.length>=2){const f=c[c.length-2].slice();c[c.length-1]=f,this.createOrUpdateSketchPoint_(f)}u.setCoordinates(c),this.geometryFunction_(this.sketchCoords_,i,s)}if(c.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let i=this.sketchCoords_;const s=e.getGeometry(),o=this.getMap().getView().getProjection();return this.mode_==="LineString"?(i.pop(),this.geometryFunction_(i,s,o)):this.mode_==="Polygon"&&(i[0].pop(),this.geometryFunction_(i,s,o),i=s.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new MultiPoint([i])):this.type_==="MultiLineString"?e.setGeometry(new MultiLineString([i])):this.type_==="MultiPolygon"&&e.setGeometry(new MultiPolygon([i])),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new DrawEvent(DrawEventType.DRAWABORT,e))}appendCoordinates(e){const i=this.mode_,s=!this.sketchFeature_;s&&this.startDrawing_(e[0]);let o;if(i==="LineString"||i==="Circle")o=this.sketchCoords_;else if(i==="Polygon")o=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;s&&o.shift(),o.pop();for(let c=0;c<e.length;c++)this.addToDrawing_(e[c]);const l=e[e.length-1];this.sketchFeature_=this.addToDrawing_(l),this.modifyDrawing_(l)}extend(e){const s=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=s.getCoordinates();const o=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=o.slice(),this.sketchCoords_.push(o.slice()),this.sketchPoint_=new Feature(new Point$1(o)),this.updateSketchFeatures_(),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const i=this.overlay_.getSource();i.clear(!0),i.addFeatures(e)}updateState_(){const e=this.getMap(),i=this.getActive();(!e||!i)&&this.abortDrawing(),this.overlay_.setMap(i?e:null)}}function getDefaultStyleFunction$2(){const n=createEditingStyle();return function(e,i){return n[e.getGeometry().getType()]}}function getMode(n){switch(n){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+n)}}const Key={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class KeyboardPan extends Interaction{constructor(e){super(),e=e||{},this.defaultCondition_=function(i){return noModifierKeys(i)&&targetNotEditable(i)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let i=!1;if(e.type==EventType$1.KEYDOWN){const s=e.originalEvent,o=s.key;if(this.condition_(e)&&(o==Key.DOWN||o==Key.LEFT||o==Key.RIGHT||o==Key.UP)){const c=e.map.getView(),u=c.getResolution()*this.pixelDelta_;let f=0,g=0;o==Key.DOWN?g=-u:o==Key.LEFT?f=-u:o==Key.RIGHT?f=u:g=u;const H=[f,g];rotate$1(H,c.getRotation()),pan(c,H,this.duration_),s.preventDefault(),i=!0}}return!i}}class KeyboardZoom extends Interaction{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(i){return!platformModifierKey(i)&&targetNotEditable(i)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let i=!1;if(e.type==EventType$1.KEYDOWN||e.type==EventType$1.KEYPRESS){const s=e.originalEvent,o=s.key;if(this.condition_(e)&&(o==="+"||o==="-")){const l=e.map,c=o==="+"?this.delta_:-this.delta_,u=l.getView();zoomByDelta(u,c,void 0,this.duration_),s.preventDefault(),i=!0}}return!i}}const CIRCLE_CENTER_INDEX=0,CIRCLE_CIRCUMFERENCE_INDEX=1,tempExtent=[0,0,0,0],tempSegment=[],ModifyEventType={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class ModifyEvent extends BaseEvent{constructor(e,i,s){super(e),this.features=i,this.mapBrowserEvent=s}}class Modify extends PointerInteraction{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:primaryAction,this.defaultDeleteCondition_=function(s){return altKeyOnly(s)&&singleClick(s)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:always$1,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new RBush,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:getDefaultStyleFunction$1(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let i;if(e.features?i=e.features:e.source&&(this.source_=e.source,i=new Collection(this.source_.getFeatures()),this.source_.addEventListener(VectorEventType.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(VectorEventType.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!i)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=i,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(CollectionEventType.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(CollectionEventType.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const i=e.getGeometry();if(i){const o=this.SEGMENT_WRITERS_[i.getType()];o&&o(e,i)}const s=this.getMap();s&&s.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(s.getCoordinateFromPixel(this.lastPixel_)),e.addEventListener(EventType$1.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,i){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Collection;const s=this.featuresBeingModified_.getArray();for(let o=0,l=i.length;o<l;++o){const c=i[o].feature;c&&!s.includes(c)&&this.featuresBeingModified_.push(c)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(EventType$1.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const i=this.rBush_,s=[];i.forEach(function(o){e===o.feature&&s.push(o)});for(let o=s.length-1;o>=0;--o){const l=s[o];for(let c=this.dragSegments_.length-1;c>=0;--c)this.dragSegments_[c][0]===l&&this.dragSegments_.splice(c,1);i.remove(l)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const i=e.target;this.removeFeature_(i),this.addFeature_(i)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,i){const s=i.getCoordinates(),o={feature:e,geometry:i,segment:[s,s]};this.rBush_.insert(i.getExtent(),o)}writeMultiPointGeometry_(e,i){const s=i.getCoordinates();for(let o=0,l=s.length;o<l;++o){const c=s[o],u={feature:e,geometry:i,depth:[o],index:o,segment:[c,c]};this.rBush_.insert(i.getExtent(),u)}}writeLineStringGeometry_(e,i){const s=i.getCoordinates();for(let o=0,l=s.length-1;o<l;++o){const c=s.slice(o,o+2),u={feature:e,geometry:i,index:o,segment:c};this.rBush_.insert(boundingExtent(c),u)}}writeMultiLineStringGeometry_(e,i){const s=i.getCoordinates();for(let o=0,l=s.length;o<l;++o){const c=s[o];for(let u=0,f=c.length-1;u<f;++u){const g=c.slice(u,u+2),H={feature:e,geometry:i,depth:[o],index:u,segment:g};this.rBush_.insert(boundingExtent(g),H)}}}writePolygonGeometry_(e,i){const s=i.getCoordinates();for(let o=0,l=s.length;o<l;++o){const c=s[o];for(let u=0,f=c.length-1;u<f;++u){const g=c.slice(u,u+2),H={feature:e,geometry:i,depth:[o],index:u,segment:g};this.rBush_.insert(boundingExtent(g),H)}}}writeMultiPolygonGeometry_(e,i){const s=i.getCoordinates();for(let o=0,l=s.length;o<l;++o){const c=s[o];for(let u=0,f=c.length;u<f;++u){const g=c[u];for(let H=0,Y=g.length-1;H<Y;++H){const ee=g.slice(H,H+2),te={feature:e,geometry:i,depth:[u,o],index:H,segment:ee};this.rBush_.insert(boundingExtent(ee),te)}}}}writeCircleGeometry_(e,i){const s=i.getCenter(),o={feature:e,geometry:i,index:CIRCLE_CENTER_INDEX,segment:[s,s]},l={feature:e,geometry:i,index:CIRCLE_CIRCUMFERENCE_INDEX,segment:[s,s]},c=[o,l];o.featureSegments=c,l.featureSegments=c,this.rBush_.insert(createOrUpdateFromCoordinate(s),o);let u=i;this.rBush_.insert(u.getExtent(),l)}writeGeometryCollectionGeometry_(e,i){const s=i.getGeometriesArray();for(let o=0;o<s.length;++o){const l=s[o],c=this.SEGMENT_WRITERS_[l.getType()];c(e,l)}}createOrUpdateVertexFeature_(e,i,s,o){let l=this.vertexFeature_;return l?l.getGeometry().setCoordinates(e):(l=new Feature(new Point$1(e)),this.vertexFeature_=l,this.overlay_.getSource().addFeature(l)),l.set("features",i),l.set("geometries",s),l.set("existing",o),l}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let i;return!e.map.getView().getInteracting()&&e.type==MapBrowserEventType.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=MapBrowserEventType.SINGLECLICK||!this.ignoreNextSingleClick_?i=this.removePoint():i=!0),e.type==MapBrowserEventType.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!i}findInsertVerticesAndUpdateDragSegments_(e){this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(!i)return;this.getMap().getView().getProjection();const s=[],o=i.getGeometry().getCoordinates(),l=boundingExtent([o]),c=this.rBush_.getInExtent(l),u={};c.sort(compareIndexes);for(let f=0,g=c.length;f<g;++f){const H=c[f],Y=H.segment;let ee=getUid(H.geometry);const te=H.depth;if(te&&(ee+="-"+te.join("-")),u[ee]||(u[ee]=new Array(2)),H.geometry.getType()==="Circle"&&H.index===CIRCLE_CIRCUMFERENCE_INDEX){const ne=closestOnSegmentData(e,H);equals(ne,o)&&!u[ee][0]&&(this.dragSegments_.push([H,0]),u[ee][0]=H);continue}if(equals(Y[0],o)&&!u[ee][0]){this.dragSegments_.push([H,0]),u[ee][0]=H;continue}if(equals(Y[1],o)&&!u[ee][1]){if(u[ee][0]&&u[ee][0].index===0){let ne=H.geometry.getCoordinates();switch(H.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":ne=ne[te[1]];case"Polygon":if(H.index!==ne[te[0]].length-2)continue;break}}this.dragSegments_.push([H,1]),u[ee][1]=H;continue}getUid(Y)in this.vertexSegments_&&!u[ee][0]&&!u[ee][1]&&s.push(H)}return s}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([l])=>l));const i=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],s=[],o=[];for(let l=0,c=this.dragSegments_.length;l<c;++l){const u=this.dragSegments_[l],f=u[0],g=f.feature;s.includes(g)||s.push(g);const H=f.geometry;o.includes(H)||o.push(H);const Y=f.depth;let ee;const te=f.segment,ne=u[1];for(;i.length<H.getStride();)i.push(te[ne][i.length]);switch(H.getType()){case"Point":ee=i,te[0]=i,te[1]=i;break;case"MultiPoint":ee=H.getCoordinates(),ee[f.index]=i,te[0]=i,te[1]=i;break;case"LineString":ee=H.getCoordinates(),ee[f.index+ne]=i,te[ne]=i;break;case"MultiLineString":ee=H.getCoordinates(),ee[Y[0]][f.index+ne]=i,te[ne]=i;break;case"Polygon":ee=H.getCoordinates(),ee[Y[0]][f.index+ne]=i,te[ne]=i;break;case"MultiPolygon":ee=H.getCoordinates(),ee[Y[1]][Y[0]][f.index+ne]=i,te[ne]=i;break;case"Circle":const Ye=H;if(te[0]=i,te[1]=i,f.index===CIRCLE_CENTER_INDEX)this.changingFeature_=!0,Ye.setCenter(i),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let xe=distance(fromUserCoordinate(Ye.getCenter()),fromUserCoordinate(i));Ye.setRadius(xe),this.changingFeature_=!1}break}ee&&this.setGeometryCoordinates_(H,ee)}this.createOrUpdateVertexFeature_(i,s,o,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const i=e.coordinate,s=this.findInsertVerticesAndUpdateDragSegments_(i);if(s!=null&&s.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,s),this.vertexFeature_)){const o=this.vertexFeature_.getGeometry().getCoordinates();for(let l=s.length-1;l>=0;--l)this.insertVertex_(s[l],o);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let i=this.dragSegments_.length-1;i>=0;--i){const s=this.dragSegments_[i][0],o=s.geometry;if(o.getType()==="Circle"){const l=o,c=l.getCenter(),u=s.featureSegments[0],f=s.featureSegments[1];u.segment[0]=c,u.segment[1]=c,f.segment[0]=c,f.segment[1]=c,this.rBush_.update(createOrUpdateFromCoordinate(c),u);let g=l;this.rBush_.update(g.getExtent(),f)}else this.rBush_.update(boundingExtent(s.segment),s)}return this.featuresBeingModified_&&(this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.coordinate)}handlePointerAtPixel_(e){const i=this.getMap(),s=i.getPixelFromCoordinate(e);i.getView().getProjection();const o=function(u,f){return projectedDistanceToSegmentDataSquared(e,u)-projectedDistanceToSegmentDataSquared(e,f)};let l,c;if(this.hitDetection_){const u=typeof this.hitDetection_=="object"?f=>f===this.hitDetection_:void 0;i.forEachFeatureAtPixel(s,(f,g,H)=>{H&&H.getType()==="Point"&&(H=new Point$1(toUserCoordinate(H.getCoordinates())));const Y=H||f.getGeometry();if(Y&&Y.getType()==="Point"&&f instanceof Feature&&this.features_.getArray().includes(f)){c=Y;const ee=f.getGeometry().getFlatCoordinates().slice(0,2);l=[{feature:f,geometry:c,segment:[ee,ee]}]}return!0},{layerFilter:u})}if(!l){const u=fromUserExtent(createOrUpdateFromCoordinate(e,tempExtent)),f=i.getView().getResolution()*this.pixelTolerance_,g=toUserExtent(buffer(u,f,tempExtent));l=this.rBush_.getInExtent(g)}if(l&&l.length>0){const u=l.sort(o)[0],f=u.segment;let g=closestOnSegmentData(e,u);const H=i.getPixelFromCoordinate(g);let Y=distance(s,H);if(c||Y<=this.pixelTolerance_){const ee={};if(ee[getUid(f)]=!0,this.snapToPointer_||(this.delta_[0]=g[0]-e[0],this.delta_[1]=g[1]-e[1]),u.geometry.getType()==="Circle"&&u.index===CIRCLE_CIRCUMFERENCE_INDEX)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(g,[u.feature],[u.geometry],this.snappedToVertex_);else{const te=i.getPixelFromCoordinate(f[0]),ne=i.getPixelFromCoordinate(f[1]),Ye=squaredDistance(H,te),xe=squaredDistance(H,ne);if(Y=Math.sqrt(Math.min(Ye,xe)),this.snappedToVertex_=Y<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(g=Ye>xe?f[1]:f[0]),this.createOrUpdateVertexFeature_(g,[u.feature],[u.geometry],this.snappedToVertex_);const tt={};tt[getUid(u.geometry)]=!0;for(let et=1,it=l.length;et<it;++et){const rt=l[et].segment;if(equals(f[0],rt[0])&&equals(f[1],rt[1])||equals(f[0],rt[1])&&equals(f[1],rt[0])){const nt=getUid(l[et].geometry);nt in tt||(tt[nt]=!0,ee[getUid(rt)]=!0)}else break}}this.vertexSegments_=ee;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,i){const s=e.segment,o=e.feature,l=e.geometry,c=e.depth,u=e.index;let f;for(;i.length<l.getStride();)i.push(0);switch(l.getType()){case"MultiLineString":f=l.getCoordinates(),f[c[0]].splice(u+1,0,i);break;case"Polygon":f=l.getCoordinates(),f[c[0]].splice(u+1,0,i);break;case"MultiPolygon":f=l.getCoordinates(),f[c[1]][c[0]].splice(u+1,0,i);break;case"LineString":f=l.getCoordinates(),f.splice(u+1,0,i);break;default:return!1}this.setGeometryCoordinates_(l,f);const g=this.rBush_;g.remove(e),this.updateSegmentIndices_(l,u,c,1);const H={segment:[s[0],i],feature:o,geometry:l,depth:c,index:u};g.insert(boundingExtent(H.segment),H),this.dragSegments_.push([H,1]);const Y={segment:[i,s[1]],feature:o,geometry:l,depth:c,index:u+1};return g.insert(boundingExtent(Y.segment),Y),this.dragSegments_.push([Y,0]),!0}updatePointer_(e){var i;return e&&this.findInsertVerticesAndUpdateDragSegments_(e),(i=this.vertexFeature_)==null?void 0:i.getGeometry().getCoordinates()}getPoint(){var i;const e=(i=this.vertexFeature_)==null?void 0:i.getGeometry().getCoordinates();return e?toUserCoordinate(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(s=>s.getType()==="Circle"||s.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(boundingExtent([e])).some(({segment:s})=>equals(s[0],e)||equals(s[1],e))}removePoint(e){if(e&&(e=fromUserCoordinate(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=MapBrowserEventType.POINTERDRAG){const i=this.lastPointerEvent_;this.willModifyFeatures_(i,this.dragSegments_.map(([o])=>o));const s=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYEND,this.featuresBeingModified_,i)),this.featuresBeingModified_=null,s}return!1}removeVertex_(){const e=this.dragSegments_,i={};let s=!1,o,l,c,u,f,g,H,Y,ee,te,ne;for(f=e.length-1;f>=0;--f)c=e[f],te=c[0],ne=getUid(te.feature),te.depth&&(ne+="-"+te.depth.join("-")),ne in i||(i[ne]={}),c[1]===0?(i[ne].right=te,i[ne].index=te.index):c[1]==1&&(i[ne].left=te,i[ne].index=te.index+1);for(ne in i){switch(ee=i[ne].right,H=i[ne].left,g=i[ne].index,Y=g-1,H!==void 0?te=H:te=ee,Y<0&&(Y=0),u=te.geometry,l=u.getCoordinates(),o=l,s=!1,u.getType()){case"MultiLineString":l[te.depth[0]].length>2&&(l[te.depth[0]].splice(g,1),s=!0);break;case"LineString":l.length>2&&(l.splice(g,1),s=!0);break;case"MultiPolygon":o=o[te.depth[1]];case"Polygon":o=o[te.depth[0]],o.length>4&&(g==o.length-1&&(g=0),o.splice(g,1),s=!0,g===0&&(o.pop(),o.push(o[0]),Y=o.length-1));break}if(s){this.setGeometryCoordinates_(u,l);const Ye=[];if(H!==void 0&&(this.rBush_.remove(H),Ye.push(H.segment[0])),ee!==void 0&&(this.rBush_.remove(ee),Ye.push(ee.segment[1])),H!==void 0&&ee!==void 0){const xe={depth:te.depth,feature:te.feature,geometry:te.geometry,index:Y,segment:Ye};this.rBush_.insert(boundingExtent(xe.segment),xe)}this.updateSegmentIndices_(u,g,te.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return s}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(s=>s.getType()==="Circle"||s.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(boundingExtent([e])).some(({segment:s})=>!(equals(s[0],e)||equals(s[1],e)))}insertPoint(e){var o;const i=e?fromUserCoordinate(e,this.getMap().getView().getProjection()):(o=this.vertexFeature_)==null?void 0:o.getGeometry().getCoordinates();return i?this.findInsertVerticesAndUpdateDragSegments_(i).reduce((l,c)=>l||this.insertVertex_(c,i),!1):!1}setGeometryCoordinates_(e,i){this.changingFeature_=!0,e.setCoordinates(i),this.changingFeature_=!1}updateSegmentIndices_(e,i,s,o){this.rBush_.forEachInExtent(e.getExtent(),function(l){l.geometry===e&&(s===void 0||l.depth===void 0||equals$2(l.depth,s))&&l.index>i&&(l.index+=o)})}}function compareIndexes(n,e){return n.index-e.index}function projectedDistanceToSegmentDataSquared(n,e,i){const s=e.geometry;if(s.getType()==="Circle"){let l=s;if(e.index===CIRCLE_CIRCUMFERENCE_INDEX){const c=squaredDistance(l.getCenter(),fromUserCoordinate(n)),u=Math.sqrt(c)-l.getRadius();return u*u}}const o=fromUserCoordinate(n);return tempSegment[0]=fromUserCoordinate(e.segment[0]),tempSegment[1]=fromUserCoordinate(e.segment[1]),squaredDistanceToSegment(o,tempSegment)}function closestOnSegmentData(n,e,i){const s=e.geometry;if(s.getType()==="Circle"&&e.index===CIRCLE_CIRCUMFERENCE_INDEX)return toUserCoordinate(s.getClosestPoint(fromUserCoordinate(n)));const o=fromUserCoordinate(n);return tempSegment[0]=fromUserCoordinate(e.segment[0]),tempSegment[1]=fromUserCoordinate(e.segment[1]),toUserCoordinate(closestOnSegment(o,tempSegment))}function getDefaultStyleFunction$1(){const n=createEditingStyle();return function(e,i){return n.Point}}const DELTA_LINE_MULTIPLIER=40,DELTA_PAGE_MULTIPLIER=300;class MouseWheelZoom extends Interaction{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const i=e.condition?e.condition:always$1;this.condition_=e.onFocusOnly?all(focusWithTabindex,i):i,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(e){if(!this.condition_(e)||e.type!==EventType$1.WHEEL)return!0;const s=e.map,o=e.originalEvent;o.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.pixel);let l=o.deltaY;switch(o.deltaMode){case WheelEvent.DOM_DELTA_LINE:l*=DELTA_LINE_MULTIPLIER;break;case WheelEvent.DOM_DELTA_PAGE:l*=DELTA_PAGE_MULTIPLIER;break}if(l===0)return!1;this.lastDelta_=l;const c=Date.now();this.startTime_===void 0&&(this.startTime_=c),(!this.mode_||c-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(l)<4?"trackpad":"wheel");const u=s.getView();if(this.mode_==="trackpad"&&!(u.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(u.getAnimating()&&u.cancelAnimations(),u.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),u.adjustZoom(-l/this.deltaPerZoom_,this.lastAnchor_?s.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=c,!1;this.totalDelta_+=l;const f=Math.max(this.timeout_-(c-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,s),f),!1}handleWheelZoom_(e){const i=e.getView();i.getAnimating()&&i.cancelAnimations();let s=-clamp$1(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(i.getConstrainResolution()||this.constrainResolution_)&&(s=s?s>0?1:-1:0),zoomByDelta(i,s,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class PinchRotate extends PointerInteraction{constructor(e){e=e||{};const i=e;i.stopDown||(i.stopDown=FALSE),super(i),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let i=0;const s=this.targetPointers[0],o=this.targetPointers[1],l=Math.atan2(o.clientY-s.clientY,o.clientX-s.clientX);if(this.lastAngle_!==void 0){const f=l-this.lastAngle_;this.rotationDelta_+=f,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),i=f}this.lastAngle_=l;const c=e.map,u=c.getView();u.getConstraints().rotation!==disable&&(this.anchor_=c.getCoordinateFromPixelInternal(c.getEventPixel(centroid(this.targetPointers))),this.rotating_&&(c.render(),u.adjustRotationInternal(i,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const i=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||i.getView().beginInteraction(),!0}return!1}}class PinchZoom extends PointerInteraction{constructor(e){e=e||{};const i=e;i.stopDown||(i.stopDown=FALSE),super(i),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let i=1;const s=this.targetPointers[0],o=this.targetPointers[1],l=s.clientX-o.clientX,c=s.clientY-o.clientY,u=Math.sqrt(l*l+c*c);this.lastDistance_!==void 0&&(i=this.lastDistance_/u),this.lastDistance_=u;const f=e.map,g=f.getView();i!=1&&(this.lastScaleDelta_=i),this.anchor_=f.getCoordinateFromPixelInternal(f.getEventPixel(centroid(this.targetPointers))),f.render(),g.adjustResolutionInternal(i,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const s=e.map.getView(),o=this.lastScaleDelta_>1?1:-1;return s.endInteraction(this.duration_,o),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const i=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||i.getView().beginInteraction(),!0}return!1}}const SelectEventType={SELECT:"select"};class SelectEvent extends BaseEvent{constructor(e,i,s,o){super(e),this.selected=i,this.deselected=s,this.mapBrowserEvent=o}}const originalFeatureStyles={};class Select extends Interaction{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:singleClick,this.addCondition_=e.addCondition?e.addCondition:never,this.removeCondition_=e.removeCondition?e.removeCondition:never,this.toggleCondition_=e.toggleCondition?e.toggleCondition:shiftKeyOnly,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:TRUE,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:getDefaultStyleFunction(),this.features_=e.features||new Collection;let i;if(e.layers)if(typeof e.layers=="function")i=e.layers;else{const s=e.layers;i=function(o){return s.includes(o)}}else i=TRUE;this.layerFilter_=i,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,i){this.featureLayerAssociation_[getUid(e)]=i}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[getUid(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(CollectionEventType.ADD,this.boundAddFeature_),this.features_.addEventListener(CollectionEventType.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(CollectionEventType.ADD,this.boundAddFeature_),this.features_.removeEventListener(CollectionEventType.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const i=e.element;if(this.style_&&this.applySelectedStyle_(i),!this.getLayer(i)){const s=this.getMap().getAllLayers().find(function(o){if(o instanceof VectorLayer&&o.getSource()&&o.getSource().hasFeature(i))return o});s&&this.addFeatureLayerAssociation_(i,s)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const i=getUid(e);i in originalFeatureStyles||(originalFeatureStyles[i]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const i=this.getMap().getInteractions().getArray();for(let o=i.length-1;o>=0;--o){const l=i[o];if(l!==this&&l instanceof Select&&l.getStyle()&&l.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(l.getStyle());return}}const s=getUid(e);e.setStyle(originalFeatureStyles[s]),delete originalFeatureStyles[s]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[getUid(e)]}handleEvent(e){if(!this.condition_(e))return!0;const i=this.addCondition_(e),s=this.removeCondition_(e),o=this.toggleCondition_(e),l=!i&&!s&&!o,c=e.map,u=this.getFeatures(),f=[],g=[];if(l){clear$1(this.featureLayerAssociation_),c.forEachFeatureAtPixel(e.pixel,(H,Y)=>{if(!(!(H instanceof Feature)||!this.filter_(H,Y)))return this.addFeatureLayerAssociation_(H,Y),g.push(H),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let H=u.getLength()-1;H>=0;--H){const Y=u.item(H),ee=g.indexOf(Y);ee>-1?g.splice(ee,1):(u.remove(Y),f.push(Y))}g.length!==0&&u.extend(g)}else{c.forEachFeatureAtPixel(e.pixel,(H,Y)=>{if(!(!(H instanceof Feature)||!this.filter_(H,Y)))return(i||o)&&!u.getArray().includes(H)?(this.addFeatureLayerAssociation_(H,Y),g.push(H)):(s||o)&&u.getArray().includes(H)&&(f.push(H),this.removeFeatureLayerAssociation_(H)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let H=f.length-1;H>=0;--H)u.remove(f[H]);u.extend(g)}return(g.length>0||f.length>0)&&this.dispatchEvent(new SelectEvent(SelectEventType.SELECT,g,f,e)),!0}}function getDefaultStyleFunction(){const n=createEditingStyle();return extend$4(n.Polygon,n.LineString),extend$4(n.GeometryCollection,n.LineString),function(e){return e.getGeometry()?n[e.getGeometry().getType()]:null}}class Kinetic{constructor(e,i,s){this.decay_=e,this.minVelocity_=i,this.delay_=s,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,i){this.points_.push(e,i,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,i=this.points_.length-3;if(this.points_[i+2]<e)return!1;let s=i-3;for(;s>0&&this.points_[s+2]>e;)s-=3;const o=this.points_[i+2]-this.points_[s+2];if(o<1e3/60)return!1;const l=this.points_[i]-this.points_[s],c=this.points_[i+1]-this.points_[s+1];return this.angle_=Math.atan2(c,l),this.initialVelocity_=Math.sqrt(l*l+c*c)/o,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}function defaults$3(n){n=n||{};const e=new Collection,i=new Kinetic(-.005,.05,100);return(n.altShiftDragRotate!==void 0?n.altShiftDragRotate:!0)&&e.push(new DragRotate),(n.doubleClickZoom!==void 0?n.doubleClickZoom:!0)&&e.push(new DoubleClickZoom({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan!==void 0?n.dragPan:!0)&&e.push(new DragPan({onFocusOnly:n.onFocusOnly,kinetic:i})),(n.pinchRotate!==void 0?n.pinchRotate:!0)&&e.push(new PinchRotate),(n.pinchZoom!==void 0?n.pinchZoom:!0)&&e.push(new PinchZoom({duration:n.zoomDuration})),(n.keyboard!==void 0?n.keyboard:!0)&&(e.push(new KeyboardPan),e.push(new KeyboardZoom({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom!==void 0?n.mouseWheelZoom:!0)&&e.push(new MouseWheelZoom({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom!==void 0?n.shiftDragZoom:!0)&&e.push(new DragZoom({duration:n.zoomDuration})),e}var loglevel$1={exports:{}},loglevel=loglevel$1.exports,hasRequiredLoglevel;function requireLoglevel(){return hasRequiredLoglevel||(hasRequiredLoglevel=1,(function(n){(function(e,i){n.exports?n.exports=i():e.log=i()})(loglevel,function(){var e=function(){},i="undefined",s=typeof window!==i&&typeof window.navigator!==i&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"],l={},c=null;function u(Ye,xe){var tt=Ye[xe];if(typeof tt.bind=="function")return tt.bind(Ye);try{return Function.prototype.bind.call(tt,Ye)}catch{return function(){return Function.prototype.apply.apply(tt,[Ye,arguments])}}}function f(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function g(Ye){return Ye==="debug"&&(Ye="log"),typeof console===i?!1:Ye==="trace"&&s?f:console[Ye]!==void 0?u(console,Ye):console.log!==void 0?u(console,"log"):e}function H(){for(var Ye=this.getLevel(),xe=0;xe<o.length;xe++){var tt=o[xe];this[tt]=xe<Ye?e:this.methodFactory(tt,Ye,this.name)}if(this.log=this.debug,typeof console===i&&Ye<this.levels.SILENT)return"No console available for logging"}function Y(Ye){return function(){typeof console!==i&&(H.call(this),this[Ye].apply(this,arguments))}}function ee(Ye,xe,tt){return g(Ye)||Y.apply(this,arguments)}function te(Ye,xe){var tt=this,et,it,rt,nt="loglevel";typeof Ye=="string"?nt+=":"+Ye:typeof Ye=="symbol"&&(nt=void 0);function at(dt){var pt=(o[dt]||"silent").toUpperCase();if(!(typeof window===i||!nt)){try{window.localStorage[nt]=pt;return}catch{}try{window.document.cookie=encodeURIComponent(nt)+"="+pt+";"}catch{}}}function st(){var dt;if(!(typeof window===i||!nt)){try{dt=window.localStorage[nt]}catch{}if(typeof dt===i)try{var pt=window.document.cookie,yt=encodeURIComponent(nt),mt=pt.indexOf(yt+"=");mt!==-1&&(dt=/^([^;]+)/.exec(pt.slice(mt+yt.length+1))[1])}catch{}return tt.levels[dt]===void 0&&(dt=void 0),dt}}function ot(){if(!(typeof window===i||!nt)){try{window.localStorage.removeItem(nt)}catch{}try{window.document.cookie=encodeURIComponent(nt)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function ut(dt){var pt=dt;if(typeof pt=="string"&&tt.levels[pt.toUpperCase()]!==void 0&&(pt=tt.levels[pt.toUpperCase()]),typeof pt=="number"&&pt>=0&&pt<=tt.levels.SILENT)return pt;throw new TypeError("log.setLevel() called with invalid level: "+dt)}tt.name=Ye,tt.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},tt.methodFactory=xe||ee,tt.getLevel=function(){return rt??it??et},tt.setLevel=function(dt,pt){return rt=ut(dt),pt!==!1&&at(rt),H.call(tt)},tt.setDefaultLevel=function(dt){it=ut(dt),st()||tt.setLevel(dt,!1)},tt.resetLevel=function(){rt=null,ot(),H.call(tt)},tt.enableAll=function(dt){tt.setLevel(tt.levels.TRACE,dt)},tt.disableAll=function(dt){tt.setLevel(tt.levels.SILENT,dt)},tt.rebuild=function(){if(c!==tt&&(et=ut(c.getLevel())),H.call(tt),c===tt)for(var dt in l)l[dt].rebuild()},et=ut(c?c.getLevel():"WARN");var ht=st();ht!=null&&(rt=ut(ht)),H.call(tt)}c=new te,c.getLogger=function(xe){if(typeof xe!="symbol"&&typeof xe!="string"||xe==="")throw new TypeError("You must supply a name when creating a logger.");var tt=l[xe];return tt||(tt=l[xe]=new te(xe,c.methodFactory)),tt};var ne=typeof window!==i?window.log:void 0;return c.noConflict=function(){return typeof window!==i&&window.log===c&&(window.log=ne),c},c.getLoggers=function(){return l},c.default=c,c})})(loglevel$1)),loglevel$1.exports}var loglevelExports=requireLoglevel(),LoggerByDefault$1={getLogger:function(n){if(typeof e>"u"){var e={};e.env={VERBOSE:!1}}e.env.VERBOSE?loglevelExports.enableAll():loglevelExports.disableAll();var i=n||"default";return loglevelExports.getLogger(i)}},MessagesResources={PARAM_MISSING:"Parameter(s) '%var%' missing",PARAM_EMPTY:"Parameter(s) '%var%' empty",PARAM_TYPE:"Wrong type(s) for parameter(s) '%var%'",PARAM_FORMAT:"Parameter(s) '%var%' not correctly formatted",PARAM_NOT_SUPPORT:"Value(s) for parameter(s) '%var%' not supported",PARAM_NOT_SUPPORT_NODEJS:"Value(s) for parameter(s) '%var%' not supported to NodeJS",PARAM_UNKNOWN:"Value(s) for parameter(s) '%var%' unknown",SERVICE_REQUEST_BUILD:"An error occurred during the request building of the service",SERVICE_REQUEST_EMPTY:"The request sent to the service is empty",SERVICE_RESPONSE_EXCEPTION:"The service returned an exception : '%var%'",SERVICE_RESPONSE_EXCEPTION_2:"The service returned an exception",SERVICE_RESPONSE_ANALYSE:"An error occurred while parsing the response '%var%' of the service",SERVICE_RESPONSE_ANALYSE_2:"An unknown error occurred while parsing the response",SERVICE_RESPONSE_EMPTY:"The response of the service is empty",SERVICE_RESPONSE_EMPTY_2:"The response from the service could not be analyzed or is empty",SERVICE_RESPONSE_FORMAT:"The format of the service response is not supported (handled format(s) : '%var%')",SERVICE_RESPONSE_FORMAT_2:"The format of the service response is not supported",SERVICE_RESPONSE_FORMAT_3:"No suggestion matching the search",CLASS_CONSTRUCTOR:"'%var%' constructor cannot be called as a function.",getMessage:function(n,e){if(Object.keys(arguments).length===0)return"Message indefined !";var i=Array.prototype.slice.call(arguments),s=i.shift(),o=i,l=this[s];try{Array.isArray(o)&&o.length>0?l=l.replace("%var%",o.join(" - ")):l=l.replace("%var%","%var% (not specified)")}catch{}return l}},Helper$1={normalyzeParameters:function(n){var e=null;if(n){var i=[];for(var s in n)if(n.hasOwnProperty(s)){var o=n[s];o||(o=""),i.push(s+"="+o)}e=i.join("&")}return e},normalyzeUrl:function(n,e,i){var s=n;if(n){if(n.split("?").length-1>=2){var o=n.search(/\?/)+1;s=n.substring(0,o)+n.slice(o).replace(/\?/g,"&")}var l=n.indexOf("?");l===-1&&(s+="?"),l!==-1&&l!==n.length-1&&(s+="&")}return e&&(typeof e=="string"?(e=e.replace("?",""),s+=e):s+=this.normalyzeParameters(e)),i&&(s=encodeURIComponent(s)),s},indent:function(n,e){var i=n||0;return new Array(i+1).join("	")+e}};function commonjsRequire(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var es6Promise$1={exports:{}};/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var es6Promise=es6Promise$1.exports,hasRequiredEs6Promise;function requireEs6Promise(){return hasRequiredEs6Promise||(hasRequiredEs6Promise=1,(function(n,e){(function(i,s){n.exports=s()})(es6Promise,(function(){function i(Pt){var Mt=typeof Pt;return Pt!==null&&(Mt==="object"||Mt==="function")}function s(Pt){return typeof Pt=="function"}var o=void 0;Array.isArray?o=Array.isArray:o=function(Pt){return Object.prototype.toString.call(Pt)==="[object Array]"};var l=o,c=0,u=void 0,f=void 0,g=function(Mt,Nt){at[c]=Mt,at[c+1]=Nt,c+=2,c===2&&(f?f(st):ut())};function H(Pt){f=Pt}function Y(Pt){g=Pt}var ee=typeof window<"u"?window:void 0,te=ee||{},ne=te.MutationObserver||te.WebKitMutationObserver,Ye=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",xe=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function tt(){return function(){return process.nextTick(st)}}function et(){return typeof u<"u"?function(){u(st)}:nt()}function it(){var Pt=0,Mt=new ne(st),Nt=document.createTextNode("");return Mt.observe(Nt,{characterData:!0}),function(){Nt.data=Pt=++Pt%2}}function rt(){var Pt=new MessageChannel;return Pt.port1.onmessage=st,function(){return Pt.port2.postMessage(0)}}function nt(){var Pt=setTimeout;return function(){return Pt(st,1)}}var at=new Array(1e3);function st(){for(var Pt=0;Pt<c;Pt+=2){var Mt=at[Pt],Nt=at[Pt+1];Mt(Nt),at[Pt]=void 0,at[Pt+1]=void 0}c=0}function ot(){try{var Pt=Function("return this")().require("vertx");return u=Pt.runOnLoop||Pt.runOnContext,et()}catch{return nt()}}var ut=void 0;Ye?ut=tt():ne?ut=it():xe?ut=rt():ee===void 0&&typeof commonjsRequire=="function"?ut=ot():ut=nt();function ht(Pt,Mt){var Nt=this,Wt=new this.constructor(yt);Wt[pt]===void 0&&Tt(Wt);var Vt=Nt._state;if(Vt){var Kt=arguments[Vt-1];g(function(){return Xt(Vt,Wt,Kt,Nt._result)})}else Ft(Nt,Wt,Pt,Mt);return Wt}function dt(Pt){var Mt=this;if(Pt&&typeof Pt=="object"&&Pt.constructor===Mt)return Pt;var Nt=new Mt(yt);return Ct(Nt,Pt),Nt}var pt=Math.random().toString(36).substring(2);function yt(){}var mt=void 0,St=1,wt=2;function Rt(){return new TypeError("You cannot resolve a promise with itself")}function Lt(){return new TypeError("A promises callback cannot return that same promise.")}function Gt(Pt,Mt,Nt,Wt){try{Pt.call(Mt,Nt,Wt)}catch(Vt){return Vt}}function vt(Pt,Mt,Nt){g(function(Wt){var Vt=!1,Kt=Gt(Nt,Mt,function(Zt){Vt||(Vt=!0,Mt!==Zt?Ct(Wt,Zt):ft(Wt,Zt))},function(Zt){Vt||(Vt=!0,bt(Wt,Zt))},"Settle: "+(Wt._label||" unknown promise"));!Vt&&Kt&&(Vt=!0,bt(Wt,Kt))},Pt)}function Et(Pt,Mt){Mt._state===St?ft(Pt,Mt._result):Mt._state===wt?bt(Pt,Mt._result):Ft(Mt,void 0,function(Nt){return Ct(Pt,Nt)},function(Nt){return bt(Pt,Nt)})}function _t(Pt,Mt,Nt){Mt.constructor===Pt.constructor&&Nt===ht&&Mt.constructor.resolve===dt?Et(Pt,Mt):Nt===void 0?ft(Pt,Mt):s(Nt)?vt(Pt,Mt,Nt):ft(Pt,Mt)}function Ct(Pt,Mt){if(Pt===Mt)bt(Pt,Rt());else if(i(Mt)){var Nt=void 0;try{Nt=Mt.then}catch(Wt){bt(Pt,Wt);return}_t(Pt,Mt,Nt)}else ft(Pt,Mt)}function ct(Pt){Pt._onerror&&Pt._onerror(Pt._result),Bt(Pt)}function ft(Pt,Mt){Pt._state===mt&&(Pt._result=Mt,Pt._state=St,Pt._subscribers.length!==0&&g(Bt,Pt))}function bt(Pt,Mt){Pt._state===mt&&(Pt._state=wt,Pt._result=Mt,g(ct,Pt))}function Ft(Pt,Mt,Nt,Wt){var Vt=Pt._subscribers,Kt=Vt.length;Pt._onerror=null,Vt[Kt]=Mt,Vt[Kt+St]=Nt,Vt[Kt+wt]=Wt,Kt===0&&Pt._state&&g(Bt,Pt)}function Bt(Pt){var Mt=Pt._subscribers,Nt=Pt._state;if(Mt.length!==0){for(var Wt=void 0,Vt=void 0,Kt=Pt._result,Zt=0;Zt<Mt.length;Zt+=3)Wt=Mt[Zt],Vt=Mt[Zt+Nt],Wt?Xt(Nt,Wt,Vt,Kt):Vt(Kt);Pt._subscribers.length=0}}function Xt(Pt,Mt,Nt,Wt){var Vt=s(Nt),Kt=void 0,Zt=void 0,Qt=!0;if(Vt){try{Kt=Nt(Wt)}catch(ri){Qt=!1,Zt=ri}if(Mt===Kt){bt(Mt,Lt());return}}else Kt=Wt;Mt._state!==mt||(Vt&&Qt?Ct(Mt,Kt):Qt===!1?bt(Mt,Zt):Pt===St?ft(Mt,Kt):Pt===wt&&bt(Mt,Kt))}function Ot(Pt,Mt){try{Mt(function(Wt){Ct(Pt,Wt)},function(Wt){bt(Pt,Wt)})}catch(Nt){bt(Pt,Nt)}}var It=0;function xt(){return It++}function Tt(Pt){Pt[pt]=It++,Pt._state=void 0,Pt._result=void 0,Pt._subscribers=[]}function Ht(){return new Error("Array Methods must be provided an Array")}var Dt=(function(){function Pt(Mt,Nt){this._instanceConstructor=Mt,this.promise=new Mt(yt),this.promise[pt]||Tt(this.promise),l(Nt)?(this.length=Nt.length,this._remaining=Nt.length,this._result=new Array(this.length),this.length===0?ft(this.promise,this._result):(this.length=this.length||0,this._enumerate(Nt),this._remaining===0&&ft(this.promise,this._result))):bt(this.promise,Ht())}return Pt.prototype._enumerate=function(Nt){for(var Wt=0;this._state===mt&&Wt<Nt.length;Wt++)this._eachEntry(Nt[Wt],Wt)},Pt.prototype._eachEntry=function(Nt,Wt){var Vt=this._instanceConstructor,Kt=Vt.resolve;if(Kt===dt){var Zt=void 0,Qt=void 0,ri=!1;try{Zt=Nt.then}catch(hi){ri=!0,Qt=hi}if(Zt===ht&&Nt._state!==mt)this._settledAt(Nt._state,Wt,Nt._result);else if(typeof Zt!="function")this._remaining--,this._result[Wt]=Nt;else if(Vt===Yt){var ai=new Vt(yt);ri?bt(ai,Qt):_t(ai,Nt,Zt),this._willSettleAt(ai,Wt)}else this._willSettleAt(new Vt(function(hi){return hi(Nt)}),Wt)}else this._willSettleAt(Kt(Nt),Wt)},Pt.prototype._settledAt=function(Nt,Wt,Vt){var Kt=this.promise;Kt._state===mt&&(this._remaining--,Nt===wt?bt(Kt,Vt):this._result[Wt]=Vt),this._remaining===0&&ft(Kt,this._result)},Pt.prototype._willSettleAt=function(Nt,Wt){var Vt=this;Ft(Nt,void 0,function(Kt){return Vt._settledAt(St,Wt,Kt)},function(Kt){return Vt._settledAt(wt,Wt,Kt)})},Pt})();function qt(Pt){return new Dt(this,Pt).promise}function kt(Pt){var Mt=this;return l(Pt)?new Mt(function(Nt,Wt){for(var Vt=Pt.length,Kt=0;Kt<Vt;Kt++)Mt.resolve(Pt[Kt]).then(Nt,Wt)}):new Mt(function(Nt,Wt){return Wt(new TypeError("You must pass an array to race."))})}function $t(Pt){var Mt=this,Nt=new Mt(yt);return bt(Nt,Pt),Nt}function Ut(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function zt(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var Yt=(function(){function Pt(Mt){this[pt]=xt(),this._result=this._state=void 0,this._subscribers=[],yt!==Mt&&(typeof Mt!="function"&&Ut(),this instanceof Pt?Ot(this,Mt):zt())}return Pt.prototype.catch=function(Nt){return this.then(null,Nt)},Pt.prototype.finally=function(Nt){var Wt=this,Vt=Wt.constructor;return s(Nt)?Wt.then(function(Kt){return Vt.resolve(Nt()).then(function(){return Kt})},function(Kt){return Vt.resolve(Nt()).then(function(){throw Kt})}):Wt.then(Nt,Nt)},Pt})();Yt.prototype.then=ht,Yt.all=qt,Yt.race=kt,Yt.resolve=dt,Yt.reject=$t,Yt._setScheduler=H,Yt._setAsap=Y,Yt._asap=g;function Jt(){var Pt=void 0;if(typeof commonjsGlobal<"u")Pt=commonjsGlobal;else if(typeof self<"u")Pt=self;else try{Pt=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var Mt=Pt.Promise;if(Mt){var Nt=null;try{Nt=Object.prototype.toString.call(Mt.resolve())}catch{}if(Nt==="[object Promise]"&&!Mt.cast)return}Pt.Promise=Yt}return Yt.polyfill=Jt,Yt.Promise=Yt,Yt}))})(es6Promise$1)),es6Promise$1.exports}var es6PromiseExports=requireEs6Promise();const ES6Promise=getDefaultExportFromCjs$1(es6PromiseExports);var XHR={call:function(n){var e=LoggerByDefault$1.getLogger("XHR");if(e.trace("[XHR::call()]"),ES6Promise.polyfill(),!n.url)throw new Error("missing parameter : url is not defined !");if(!n.method)throw new Error("missing parameter : method is not defined !");n.format||(n.format="text");var i={};switch(i.url=n.url,i.data=n.data?n.data:null,i.method=n.method,i.timeOut=n.timeOut||0,i.scope=n.scope||this,i.proxy=n.proxy||null,i.content=n.content||null,i.headers=n.headers||{referer:"http://localhost"},n.method){case"DELETE":case"GET":break;case"PUT":case"POST":i.content=n.content?n.content:"application/x-www-form-urlencoded",i.headers=n.headers?n.headers:{referer:"http://localhost"};break;case"HEAD":case"OPTIONS":throw new Error("HTTP method not yet supported !");default:throw new Error("HTTP method unknown !")}switch(n.format){case"text":this.__call(i).then(function(s){e.trace(s),n.onResponse.call(this,s)}).catch(function(s){n.onFailure.call(this,s)});break;case"json":this.__callJSON(i).then(function(s){e.trace(s),n.onResponse.call(this,s)}).catch(function(s){n.onFailure.call(this,s)});break;case"xml":this.__callXML(i).then(function(s){e.trace(s),n.onResponse.call(this,s)}).catch(function(s){n.onFailure.call(this,s)});break;default:throw new Error("This output Format is not yet supported !")}},__call:function(n){var e=LoggerByDefault$1.getLogger("XHR");e.trace("[XHR::__call()]");var i=new Promise(function(s,o){var l=n.method==="POST"||n.method==="PUT"?1:0;n.data&&(typeof n.data=="object"&&Object.keys(n.data).length||typeof n.data=="string"&&n.data.length)&&!l&&(n.url=Helper$1.normalyzeUrl(n.url,n.data)),e.trace("URL = ",n.url);var c=null;if(typeof window>"u"){var u=require("node-fetch"),f={headers:{Referer:"https://localhost"}};return n.data&&typeof n.data=="string"&&l&&(f={method:n.method,body:n.data,headers:{"Content-Type":n.content,Referer:"https://localhost"}}),u(n.url,f).then(function(ee){if(ee.ok)s(ee.text());else{var te="Errors Occured on Http Request (status : '"+ee.statusText+"' | url : '"+ee.url+"')",ne=ee.status;o({message:te,status:ne})}}).catch(function(ee){o({message:ee,status:-1})})}else if(window.XMLHttpRequest){e.trace("XMLHttpRequest"),c=new XMLHttpRequest,c.open(n.method,n.url,!0),c.overrideMimeType=n.content;var g=null;n.timeOut>0&&(e.trace("XHR - TimeOut actif !"),g=window.setTimeout(function(){var ee="TimeOut Occured on Http Request with XMLHttpRequest !";o({message:ee,status:-1})},n.timeOut)),l&&(e.trace("data = ",n.data),c.setRequestHeader("Content-type",n.content)),c.onerror=function(ee){console.log(ee),o(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},c.ontimeout=function(ee){console.log(ee),o(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},c.onreadystatechange=function(ee){if(c.readyState===4)if(c.status===200)window.clearTimeout(g),s(c.response);else{var te="Errors Occured on Http Request (status : '"+ee.target.statusText+"' | url : '"+ee.target.responseURL+"' | response : '"+ee.target.response+"')",ne=ee.target.status;o({message:te,status:ne})}};var H=n.data&&l?n.data:null;c.send(H)}else if(window.XDomainRequest){e.trace("XDomainRequest"),c=new XDomainRequest,c.open(n.method,n.url),c.overrideMimeType=n.content,n.timeOut>0&&(c.timeout=n.timeout,e.trace("XHR - TimeOut actif !")),l&&c.setRequestHeader("Content-type",n.content),c.onerror=function(){o(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},c.ontimeout=function(){o(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},c.onload=function(ee){if(c.status===200)s(c.responseText);else{var te="Errors Occured on Http Request (status : '"+ee.target.statusText+"' | url : '"+ee.target.responseURL+"')",ne=ee.target.status;o({message:te,status:ne})}};var Y=n.data&&l?n.data:null;c.send(Y)}else throw new Error("CORS not supported")});return i},__callJSON:function(n){return this.__call(n).then(JSON.parse).catch(function(e){console.log("_callJSON failed on : ",n.url,e)})},__callXML:function(n){return this.__call(n).then(function(e){var i;if(typeof window>"u"){var s=require("@xmldom/xmldom").DOMParser;i=new s().parseFromString(e,"text/xml")}else if(window.DOMParser){var o=new window.DOMParser;i=o.parseFromString(e,"text/xml")}else i=new window.ActiveXObject("Microsoft.XMLDOM"),i.async=!1,i.loadXML(e);return i}).catch(function(e){console.log("__callXML failed on : ",n.url,e)})}},JSONP={uuid:(function(){var n=Math.floor(Date.now());return function(){return n++}})(),call:function(n){var e=LoggerByDefault$1.getLogger("JSONP");if(e.trace("[JSONP::call ()]"),!n)throw e.error("missing parameter : options !"),new Error("missing parameter : options !");if(!n.url)throw e.error("missing parameter : options.url !"),new Error("missing parameter : options.url !");if(n.timeOut||(e.info("setting 'options.timeOut' default value"),n.timeOut=0),!n.onResponse)throw e.error("missing parameter : options.onResponse !"),new Error("missing parameter : options.onResponse !");var i=typeof n.callbackSuffix=="string"?n.callbackSuffix:this.uuid(),s=!1,o=!1,l=n.url.indexOf("callback=");if(l!==-1){s=!0;var c=n.url.indexOf("&",l);c===-1&&(c=n.url.length);var u=n.url.substring(l+9,c);u&&(o=!0,n.callbackName=u,e.info("setting 'options.callbackName' value ("+n.callbackName+") from 'options.url' parameter"))}if(!s){var f=n.url.indexOf("?");f===-1?n.url=n.url+"?callback=":f===n.url.length?n.url=n.url+"callback=":n.url=n.url+"&callback=",e.info("setting callback default key in 'options.url' : "+n.url)}var g=n.callbackName?!0:o;if(o||(n.callbackName||(e.info("setting 'options.callbackName' default value"),n.callbackName="callback",(i||i==="")&&(n.callbackName+=i)),n.url=n.url.replace("callback=","callback="+n.callbackName),e.info("setting callback function name in 'options.url' : "+n.url)),n.onTimeOut||(e.info("setting 'options.onTimeOut' default value"),n.onTimeOut=function(){console.log("TimeOut while invoking url : "+n.url)}),!g){var H=this,Y=null;n.timeOut>0&&(Y=window.setTimeout(function(){window[n.callbackName]=function(){},n.onTimeOut(),H._deleteScript(i)},n.timeOut)),window[n.callbackName]=function(ee){window.clearTimeout(Y),n.onResponse(ee),H._deleteScript(i)}}this._createScript(i,n.url)},_createScript:function(n,e){var i,s=document.getElementById("results"+n);i=document.createElement("script"),i.setAttribute("type","text/javascript"),i.setAttribute("src",e),i.setAttribute("charset","UTF-8"),i.setAttribute("id","results"+n),i.setAttribute("async","true");var o=document.documentElement||document.getElementsByTagName("head")[0];s===null?o.appendChild(i):o.replaceChild(i,s)},_deleteScript:function(n){var e=document.getElementById("results"+n);if(e){var i=e.parentNode||document.documentElement;if(!i)return;i.removeChild(e)}}},Protocol={send:function(n){var e=n||{method:"GET",protocol:"XHR",timeOut:0,format:null,wrap:!0,nocache:!0,output:"json",callback:null,callbackSuffix:null};if(typeof window>"u"&&n.protocol==="JSONP"){console.log("Value (s) for parameter (s) 'protocol=JSONP (instead use XHR)' not supported to NodeJS");return}if(n.protocol==="XHR"||n.format==="json"?e.wrap=!1:n.protocol==="JSONP"&&n.format==="xml"&&(e.wrap=!0),e.callback=null,e.output=e.wrap?"json":null,e.wrap){var i={};i.output=e.output,i.callback=e.callback,delete i.callback,e.url=Helper$1.normalyzeUrl(n.url,i)}switch(e.protocol){case"XHR":n.method==="GET"&&n.nocache&&(e.url=Helper$1.normalyzeUrl(e.url,{t:new Date().getTime()})),XHR.call(e);break;case"JSONP":e.data&&(e.url=Helper$1.normalyzeUrl(e.url,e.data)),JSONP.call(e);break;default:throw new Error("protocol not supported (XHR|JSONP) !")}}};function ErrorService(n){if(!(this instanceof ErrorService))throw new TypeError("ErrorService constructor cannot be called as a function.");var e=n;typeof n=="string"||n instanceof String?(this.message=n,this.status=-1,this.type=ErrorService.TYPE_UNKERR):(this.message=e.message||"undefined!?",this.type=e.type,this.status=e.status||-1),this.name="ErrorService",this.stack=new Error().stack}ErrorService.TYPE_SRVERR="SERVICE_ERROR";ErrorService.TYPE_USEERR="USAGE_ERROR";ErrorService.TYPE_UNKERR="UNKNOWN_ERROR";ErrorService.prototype=Object.create(Error.prototype,{constructor:{value:ErrorService,writable:!0,configurable:!0}});const version$1="3.4.6",date="19/12/2024",Pkg={version:version$1,date};function CommonService(n){if(!(this instanceof CommonService))throw new TypeError(MessagesResources.getMessage("CLASS_CONSTRUCTOR"));this.logger=LoggerByDefault$1.getLogger("CommonService"),this.logger.trace("[Constructeur CommonService (options)]"),this.options={protocol:"XHR",ssl:!0,proxyURL:"",callbackSuffix:null,httpMethod:"GET",timeOut:0,rawResponse:!1,scope:this,onSuccess:function(s){console.log("onSuccess - la reponse est la suivante : ",s)},onFailure:function(s){s.status===200||!s.status?console.log("onFailure : ",s.message):console.log("onFailure - Erreur (",s.status,") : ",s.message)}};for(var e in n)n.hasOwnProperty(e)&&(this.options[e]=n[e]);this.options.rawResponse&&!this.options.onSuccess&&(this.options.onSuccess=function(s){console.log("onSuccess - la rponse brute du service est la suivante : ",s)});var i=this.options.onSuccess!==null&&typeof this.options.onSuccess=="function";if(!i)throw new Error(MessagesResources.getMessage("PARAM_MISSING","onSuccess()"));switch(this.options.httpMethod=typeof n.httpMethod=="string"?n.httpMethod.toUpperCase():"GET",this.options.httpMethod){case"POST":case"GET":break;case"PUT":case"DELETE":case"HEAD":case"OPTIONS":throw new Error(MessagesResources.getMessage("PARAM_NOT_SUPPORT","httpMethod"));default:throw new Error(MessagesResources.getMessage("PARAM_UNKNOWN","httpMethod"))}switch(this.options.protocol=typeof n.protocol=="string"?n.protocol.toUpperCase():"XHR",this.options.protocol){case"JSONP":case"XHR":break;default:throw new Error(MessagesResources.getMessage("PARAM_UNKNOWN","protocol"))}if(typeof window>"u"&&this.options.protocol==="JSONP")throw new Error(MessagesResources.getMessage("PARAM_NOT_SUPPORT_NODEJS","protocol=JSONP (instead use XHR)"));this.options.protocol==="JSONP"&&(this.options.httpMethod="GET"),this.options.nocache=n.nocache||!1,this.options.outputFormat=null,this.request=null,this.response=null}CommonService.prototype={constructor:CommonService,call:function(){this.logger.trace("CommonService::call ()");var n=this;function e(){this.logger.trace("CommonService::run ()"),this.buildRequest.call(n,l,i)}e.call(n);function i(c){this.logger.trace("CommonService::onBuildRequest : ",c),this.callService.call(n,l,s)}function s(c){this.logger.trace("CommonService::onCallService : ",c),this.analyzeResponse.call(n,l,o)}function o(c){if(this.logger.trace("CommonService::onAnalyzeResponse : ",c),c)this.options.onSuccess.call(this,c);else return l.call(this,new ErrorService("Analyse de la reponse en chec !?"))}function l(c){this.logger.trace("CommonService::onError()");var u=c;u instanceof ErrorService||(u=new ErrorService(c.message)),this.options.onFailure.call(this,u)}},buildRequest:function(n,e){this.logger.error("overwritten method !"),n&&n.call(this,"This method must be overwritten !"),e.call(this,"This method must be overwritten !")},callService:function(n,e){var i=null,s=this.request,o=!!(this.options.proxyURL&&this.options.protocol==="XHR"),l={"gp-access-lib":Pkg.version};this.options.apiKey&&(l.apiKey=this.options.apiKey),this.options.serverUrl=Helper$1.normalyzeUrl(this.options.serverUrl,l,!1),o&&(this.options.httpMethod==="GET"&&(i=this.options.proxyURL+Helper$1.normalyzeUrl(this.options.serverUrl,this.request,!0),s=null),this.options.httpMethod==="POST"&&(i=this.options.proxyURL+Helper$1.normalyzeUrl(this.options.serverUrl,null,!0),s=this.request));var c=this,u={url:i||this.options.serverUrl,method:this.options.httpMethod,protocol:this.options.protocol,timeOut:this.options.timeOut||0,format:this.options.outputFormat,nocache:this.options.nocache||!1,wrap:this.options.protocol!=="XHR",callbackSuffix:this.options.callbackSuffix,data:s,headers:null,content:this.options.contentType||"application/xml",scope:this.options.scope||this,onResponse:function(f){c.logger.trace("callService::onResponse()");var g=null;if(c.options.protocol==="XHR"&&(c.logger.trace("Response XHR",f),g=f),c.options.protocol==="JSONP")if(c.logger.trace("Response JSON",f),f)if(f.http)if(f.http.status!==200){n.call(c,new ErrorService({status:f.http.status,message:f.http.error,type:ErrorService.TYPE_SRVERR}));return}else g=f.xml,c.options.rawResponse&&(g=f);else g=f;else{n.call(c,new ErrorService("Le contenu de la reponse est vide !?"));return}if(typeof c.options.onBeforeParse=="function"){var H=c.options.onBeforeParse(g);typeof H=="string"&&(g=H)}c.response=g,e.call(c,g)},onFailure:function(f){c.logger.trace("callService::onFailure()"),f.type=ErrorService.TYPE_SRVERR,n.call(c,new ErrorService(f))},onTimeOut:function(){c.logger.trace("callService::onTimeOut()"),n.call(c,new ErrorService("TimeOut!"))}};Protocol.send(u)},analyzeResponse:function(n,e){this.logger.error("overwritten method !"),n&&n.call(this,"This method must be overwritten !"),e.call(this,"This method must be overwritten !")}};var DefaultUrlService={ssl:!0,newUrl:function(n){var e="data.geopf.fr",i;return DefaultUrlService.ssl===!1?i="http://":i="https://",i+e+n},Alti:{new_key:{"elevation-json":"/altimetrie/1.0/calcul/alti/rest/elevation.json","elevation-xml":"/altimetrie/1.0/calcul/alti/rest/elevation.xml","profil-json":"/altimetrie/1.0/calcul/alti/rest/elevationLine.json","profil-xml":"/altimetrie/1.0/calcul/alti/rest/elevationLine.xml"},newUrl:function(){return{"elevation-json":DefaultUrlService.newUrl(this.new_key["elevation-json"]),"elevation-xml":DefaultUrlService.newUrl(this.new_key["elevation-xml"]),"profil-json":DefaultUrlService.newUrl(this.new_key["profil-json"]),"profil-xml":DefaultUrlService.newUrl(this.new_key["profil-xml"])}}},ProcessIsoCurve:{new_key:"/navigation/isochrone",newUrl:function(){return DefaultUrlService.newUrl(this.new_key)}},Config:{_key:"https://raw.githubusercontent.com/IGNF/geoportal-configuration/new-url/dist/",url:function(n){Array.isArray(n)||(n=n.split(","));for(var e=[],i=0;i<n.length;i++)e[i]=this._key+n[i]+"Config.json";return e}},AutoComplete:{new_key:"/geocodage/completion",newUrl:function(){return DefaultUrlService.newUrl(this.new_key)}},ReverseGeocode:{new_key:"/geocodage/reverse",newUrl:function(){return DefaultUrlService.newUrl(this.new_key)}},Geocode:{new_key:"/geocodage/search",newUrl:function(){return DefaultUrlService.newUrl(this.new_key)}},Route:{new_key:"/navigation/itineraire",newUrl:function(){return DefaultUrlService.newUrl(this.new_key)}}};function ConfigInterface(){if(!(this instanceof ConfigInterface))throw new TypeError("ConfigInterface constructor cannot be called as a function.");this.generalOptions={apiKeys:{},title:null,defaultGMLGFIStyle:null,theme:null,wgs84Resolutions:[]},this.layers={},this.tileMatrixSets={}}ConfigInterface.prototype={constructor:ConfigInterface,isKeyConfLoaded:function(n){if(n)return!!this.generalOptions.apiKeys[n]},getLayersId:function(n){return this.generalOptions.apiKeys[n]},getLayerId:function(n,e){if(!(!n||!e)){var i=null;if(this.layers){var s=this.layers;for(var o in s)if(s.hasOwnProperty(o)){var l=o.split("$");if(n===l[0]&&l[1]){var c=l[1].split(":"),u=l[1].split(";");if(u[1]===e.toUpperCase()){i=o;break}if(c[2]===e.toUpperCase()){i=o;break}}}}if(i)return i}},getLayersConf:function(n){var e={},i=this.getLayersId(n);if(i)for(var s=0;s<i.length;s++){var o=i[s];e[o]=this.layers[o]}return e},getLayerConf:function(n){if(this.layers)return this.layers[n]},getLayerParams:function(n,e){var i={};if((e==="WMS"||Object.keys(this.tileMatrixSets).length!==0)&&Object.keys(this.layers).length!==0){var s=this.getLayerId(n,e);if(s){var o=this.getLayerConf(s),l=this.getLayerKey(s);if(l.length===0)return;for(var c=0;c<l.length;c++)o.serviceParams.serverUrl[l[c]]&&(i.url=o.serviceParams.serverUrl[l[c]]);if(e!=="WFS"&&(/\/v\//.test(i.url)?i.styles=" ":i.styles=o.styles[0].name),i.version=o.serviceParams.version,i.format=o.formats&&o.formats.length?o.formats[0].name:"",i.projection=o.defaultProjection,i.minScale=o.globalConstraint.minScaleDenominator,i.maxScale=o.globalConstraint.maxScaleDenominator,i.extent=o.globalConstraint.bbox,i.legends=o.legends,i.title=o.title,i.description=o.description,e==="WMS"&&(i.metadata=o.metadata),o.wmtsOptions){i.tileMatrixSetLimits=o.wmtsOptions.tileMatrixSetLimits;var u=o.wmtsOptions.tileMatrixSetLink;if(u){i.TMSLink=u;var f=this.getTMSConf(u);i.matrixIds=Object.keys(f.tileMatrices),i.tileMatrices=f.tileMatrices,i.nativeResolutions=f.nativeResolutions||this.getTMSConf("PM").nativeResolutions}}}}return i},getLayerKey:function(n){var e=[];if(this.generalOptions&&this.generalOptions.apiKeys&&Object.keys(this.generalOptions.apiKeys).length!==0){var i=this.generalOptions.apiKeys;for(var s in i){var o=i[s];o.forEach(function(l){l===n&&e.push(s)})}}return e},getTileMatrixSets:function(){return this.tileMatrixSets},getTMSConf:function(n){if(this.tileMatrixSets)return this.tileMatrixSets[n]},getGlobalConstraints:function(n){var e={};if(n){var i=this.getLayerConf(n);e.projection=i.defaultProjection,e.minScale=i.globalConstraint.minScaleDenominator,e.maxScale=i.globalConstraint.maxScaleDenominator,e.extent=i.globalConstraint.bbox}return e}};function Config$1(n){if(!(this instanceof Config$1))throw new TypeError(MessagesResources.getMessage("CLASS_CONSTRUCTOR","Config"));this.CLASSNAME="Config",this.logger=LoggerByDefault$1.getLogger("Gp.Config"),this.logger.trace("[Constructeur Config (options)]");var e=n.onSuccess!==null&&typeof n.onSuccess=="function";if(!e)throw new Error(MessagesResources.getMessage("PARAM_MISSING","onSuccess()"));!n.apiKey&&!n.customConfigFile&&(n.apiKey="full"),this.options={},this.options.onSuccess=n.onSuccess,this.options.onFailure=n.onFailure,this.options.sync=n.sync||!1,this.options.listConfigUrls=n.customConfigFile?[n.customConfigFile]:Array.isArray(n.apiKey)?DefaultUrlService.Config.url(n.apiKey):DefaultUrlService.Config.url(n.apiKey.split(","))}Config$1.prototype=Object.create(CommonService.prototype,{});Config$1.prototype.constructor=Config$1;Config$1.prototype.buildRequest=function(n,e){if(this.listConfigUrls=this.options.listConfigUrls,!this.listConfigUrls){n.call(this,new Error("url by default not found !"));return}e.call(this,this.listConfigUrls)};Config$1.prototype.callService=function(n,e){this.options.sync?__callServiceSync.call(this,n,e):__callService.call(this,n,e)};var __callService=function(n,e){this.listConfigResults=[];let i=null;if(typeof window>"u"){var s=require("node-fetch");i=s}else i=window.fetch;var o=c=>i(c,{credentials:"same-origin"}).then(u=>{if(u.ok)return u.json().then(f=>f).catch(f=>{throw new Error("Exception Json : "+f)});throw new Error("Exception HTTP : "+u.status+" (status code) !")}).catch(u=>new Promise((f,g)=>{g(u)})),l=[];for(let c=0;c<this.listConfigUrls.length;c++){const u=this.listConfigUrls[c];l.push(o(u))}Promise.all(l).then(c=>{if(!c)throw new Error("results config empty !?");c.forEach(u=>{this.listConfigResults.push(u)})}).then(()=>{e.call(this,this.listConfigResults)}).catch(c=>{n.call(this,c)})},__callServiceSync=function(n,e){this.listConfigResults=[];for(var i=0;i<this.listConfigUrls.length;i++){const o=this.listConfigUrls[i],l=new XMLHttpRequest;if(l.open("GET",o,!1),l.send(null),l.status===200){var s=JSON.parse(l.responseText);this.listConfigResults.push(s)}}this.listConfigResults.length!==0?e.call(this,this.listConfigResults):n.call(this,new Error("..."))};Config$1.prototype.analyzeResponse=function(n,e){var i=function(u){for(var f={},g={},H={},Y=0;Y<u.length;Y++){if(!u[Y].generalOptions||!u[Y].layers)return;g={...g,...u[Y].generalOptions.apiKeys},f={...f,...u[Y].layers},H={...H,...u[Y].tileMatrixSets}}var ee={generalOptions:{apiKeys:g},layers:f,tileMatrixSets:H};return ee},s=i(this.listConfigResults);if(!s){n.call(this,new Error("configuration structure not conforme !"));return}var o=new ConfigInterface;Object.assign(o,s);var l=typeof window<"u"?window:{};if(l.Gp||(l.Gp={}),l.Gp.Config){Object.assign(l.Gp.Config,o);for(var c in o)l.Gp.Config[c]=o[c]}else l.Gp.Config=o;e.call(this,l.Gp.Config)};function AltiRequest(n){if(!(this instanceof AltiRequest))throw new TypeError("AltiRequest constructor cannot be called as a function.");this.logger=LoggerByDefault$1.getLogger(),this.logger.trace("[Constructeur AltiRequest ()]"),this.options=n||{},this.positions=this.options.positions||[],this.delimiter=this.options.delimiter||"|",this.indent=this.options.indent||!1,this.crs=this.options.crs||"CRS:84",this.format=this.options.format||"json",this.resource=this.options.resource,this.measures=this.options.measures||!1}AltiRequest.CLASSNAME="AltiRequest";AltiRequest.prototype={constructor:AltiRequest,setPositions:function(n){for(var e=[],i=0;i<n.length;i++){var s=n[i];s.lon&&s.lat&&e.push(s)}this.positions=e},getPositions:function(n){if(!n)return this.positions;var e=this.positions.length-1;return n>e||n<e?(this.logger.warn("index out of range !"),this.positions):this.positions[n]},addPositions:function(n){for(var e=0;e<n.length;e++){var i=n[e];i.lon&&i.lat&&this.positions.push(n[e])}},getLon:function(){for(var n=[],e=0;e<this.positions.length;e++)n.push(this.positions[e].lon);return this.logger.trace(n),n.join(this.delimiter)},getLat:function(){for(var n=[],e=0;e<this.positions.length;e++)n.push(this.positions[e].lat);return this.logger.trace(n),n.join(this.delimiter)}};AltiRequest.prototype.getData=function(){var n=[];return n.push({k:"lon",v:this.getLon()}),n.push({k:"lat",v:this.getLat()}),n.push({k:"delimiter",v:this.delimiter}),n.push({k:"indent",v:this.indent}),n.push({k:"crs",v:this.crs}),n.push({k:"format",v:this.format}),n};function AltiElevationRequest(n){if(!(this instanceof AltiElevationRequest))throw new TypeError("AltiElevationRequest constructor cannot be called as a function.");this.CLASSNAME="AltiElevationRequest",AltiRequest.apply(this,arguments),this.logger=LoggerByDefault$1.getLogger(),this.logger.trace("[Constructeur AltiElevationRequest ()]"),this.zonly=this.options.zonly||!1}AltiElevationRequest.prototype=Object.create(AltiRequest.prototype,{zonly:{get:function(){return this._zonly},set:function(n){this._zonly=n}}});AltiElevationRequest.prototype.constructor=AltiElevationRequest;AltiElevationRequest.prototype.getData=function(){var n=[];return n.push({k:"lon",v:this.getLon()}),n.push({k:"lat",v:this.getLat()}),n.push({k:"indent",v:this.indent}),n.push({k:"crs",v:this.crs}),n.push({k:"zonly",v:this.zonly}),n.push({k:"format",v:this.format}),n.push({k:"resource",v:this.resource}),n};function AltiProfilRequest(n){if(!(this instanceof AltiProfilRequest))throw new TypeError("AltiProfilRequest constructor cannot be called as a function.");this.CLASSNAME="AltiProfilRequest",AltiRequest.apply(this,arguments),this.logger=LoggerByDefault$1.getLogger(),this.logger.trace("[Constructeur AltiProfilRequest ()]"),this.sampling=this.options.sampling||3}AltiProfilRequest.prototype=Object.create(AltiRequest.prototype,{sampling:{get:function(){return this._sampling},set:function(n){this._sampling=n}}});AltiProfilRequest.prototype.constructor=AltiProfilRequest;AltiProfilRequest.prototype.getData=function(){var n=[];return n.push({k:"lon",v:this.getLon()}),n.push({k:"lat",v:this.getLat()}),n.push({k:"indent",v:this.indent}),n.push({k:"crs",v:this.crs}),n.push({k:"sampling",v:this.sampling}),n.push({k:"format",v:this.format}),n.push({k:"resource",v:this.resource}),n};function AltiRequestREST(n){if(this.logger=LoggerByDefault$1.getLogger("AltiRequestREST"),this.logger.trace("[Constructeur AltiRequestREST ()]"),!(this instanceof AltiRequestREST))throw new TypeError("AltiRequestREST constructor cannot be called as a function.");if(this.options=n||{},!this.options)throw new Error(MessagesResources.getMessage("PARAM_EMPTY","options"));if(!this.options.type)throw new Error(MessagesResources.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));switch(this.DataObject=null,this.options.type){case"Elevation":this.DataObject=new AltiElevationRequest(this.options.param);break;case"Profil":this.DataObject=new AltiProfilRequest(this.options.param);break;default:throw new Error(MessagesResources.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}this.method=this.options.method||"GET"}AltiRequestREST.prototype={requestString:null,constructor:AltiRequestREST,template:{get:{value:"lon=__LON__&lat=__LAT__&indent=__INDENT__&crs='__CRS__'&resource=__RESOURCE__&measures=__MEASURES__",input:{point:"&zonly=__ZONLY__",profil:"&sampling=__SAMPLING__"}},post:{value:`lon=__LON__
lat=__LAT__
indent=__INDENT__
crs='__CRS__'
resource='__RESOURCE__'
measures='__MEASURES__'
`,input:{point:`zonly=__ZONLY__
`,profil:"sampling=__SAMPLING__"}}},processRequestString:function(){this.logger.trace("AltiRequestREST::processRequestString ()");var n="";return this.method==="POST"?n=this.template.post.value:this.method==="GET"&&(n=this.template.get.value),n=n.replace(/__LON__/g,this.DataObject.getLon()),n=n.replace(/__LAT__/g,this.DataObject.getLat()),n=n.replace(/__INDENT__/g,this.DataObject.indent),n=n.replace(/__CRS__/g,this.DataObject.crs),n=n.replace(/__RESOURCE__/g,this.DataObject.resource),n=n.replace(/__MEASURES__/g,this.DataObject.measures),n=n+this.__addDataInputs(),this.logger.trace("traduction tmpl",n),this.requestString=n,this.requestString},__addDataInputs:function(){this.logger.trace("AltiRequestREST::addDataInput ()");var n;if(this.method==="POST")n=this.template.post;else if(this.method==="GET")n=this.template.get;else throw new Error("No other HTTP method supported by the service !");var e=null;if(this.DataObject.CLASSNAME==="AltiElevationRequest")return e=n.input.point,e.replace(/__ZONLY__/g,this.DataObject.zonly.toString());if(this.DataObject.CLASSNAME==="AltiProfilRequest")return e=n.input.profil,e.replace(/__SAMPLING__/g,this.DataObject.sampling);throw new Error("No other object supported than elevation or profil !?")}};function WPS(n){if(this.logger=LoggerByDefault$1.getLogger(),this.logger.trace("[Constructeur WPS()]"),!(this instanceof WPS))throw new TypeError("WPS constructor cannot be called as a function.");if(this.options=n||{},this.DataObject=this.options.data,!this.DataObject)throw new TypeError("This data object is not defined !");this.paramservice=this.options.param.service||"WPS",this.paramversion=this.options.param.version||"1.0.0",this.paramidentifier=this.options.param.identifier||"gs:WPS",this.paramrawdataoutput=this.options.param.rawdataoutput||"result",this.paramrequest=this.options.param.request||"Execute",this.method=this.options.method||"GET"}WPS.prototype={requestString:null,constructor:WPS,template:{get:{value:"service=__SERVICE__&version=__VERSION__&rawdataoutput=__RAWDATAOUTPUT__&identifier=__IDENTIFIER__&request=__REQUEST__&datainputs=<!-- __DATAINPUTS__ -->",input:"__KEY__=__DATA__"},post:{value:'<?xml version="1.0" encoding="UTF-8"?><wps:__REQUEST__ version="__VERSION__" service="__SERVICE__" __NAMESPACE__ __SCHEMALOCATION__><ows:Identifier>__IDENTIFIER__</ows:Identifier><wps:DataInputs><!-- __DATAINPUTS__ --></wps:DataInputs><wps:ResponseForm><wps:RawDataOutput><ows:Identifier>__RAWDATAOUTPUT__</ows:Identifier></wps:RawDataOutput></wps:ResponseForm></wps:__REQUEST__>',input:"<wps:Input><ows:Identifier>__KEY__</ows:Identifier><wps:Data><wps:LiteralData>__DATA__</wps:LiteralData></wps:Data></wps:Input>"}},namespaceByDefault:function(){var n=['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns="http://www.opengis.net/wps/1.0.0"','xmlns:wfs="http://www.opengis.net/wfs"','xmlns:wps="http://www.opengis.net/wps/1.0.0"','xmlns:ows="http://www.opengis.net/ows/1.1"','xmlns:gml="http://www.opengis.net/gml"','xmlns:ogc="http://www.opengis.net/ogc"','xmlns:wcs="http://www.opengis.net/wcs/1.1.1"','xmlns:xlink="http://www.w3.org/1999/xlink"'];return n.join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd"'},processRequestString:function(){this.logger.trace("WPS::processRequestString ()");var n="";if(this.method==="POST")n=this.template.post.value;else if(this.method==="GET")n=this.template.get.value;else return this.logger.error("No other method supported by the service !"),!1;return n=n.replace(/__SERVICE__/g,this.paramservice),n=n.replace(/__VERSION__/g,this.paramversion),n=n.replace(/__RAWDATAOUTPUT__/g,this.paramrawdataoutput),n=n.replace(/__IDENTIFIER__/g,this.paramidentifier),n=n.replace(/__REQUEST__/g,this.paramrequest),this.method==="POST"&&(n=n.replace(/__NAMESPACE__/g,this.namespaceByDefault),n=n.replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault)),n=n.replace(/<!-- __DATAINPUTS__ -->/g,this.__addDataInputs()),n?(this.requestString=n,this.logger.trace("traduction tmpl",n),!0):(this.logger.warn("traduction tmpl : empty request !?"),!1)},__addDataInputs:function(){this.logger.trace("WPS::__addDataInputs ()");for(var n=this.method==="GET"?this.template.get.input:this.template.post.input,e=this.method==="GET"?";":"",i="",s=this,o=this.DataObject.getData(),l=0;l<o.length;l++)(function(c){e&&(e=c===o.length-1?"":";"),i=i.concat(s.__addDataInput(n,o[c].k,o[c].v),e)})(l);return i},__addDataInput:function(n,e,i){var s=n;return s=s.replace(/__KEY__/g,e),s=s.replace(/__DATA__/g,i),s},setMethod:function(n){n==="GET"||n==="POST"?this.method=n:this.logger.warn("support only GET and POST method !")},getMethod:function(){return this.method}};var AltiRequestWPS={build:function(n){var e=LoggerByDefault$1.getLogger("AltiRequestWPS");if(e.trace(["AltiRequestWPS::build()"]),!n)throw new Error(MessagesResources.getMessage("PARAM_EMPTY","options"));if(!n.type)throw new Error(MessagesResources.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));var i=null;switch(n.type){case"Elevation":n.wps.identifier="gs:WPSElevation",i=new AltiElevationRequest(n.param);break;case"Profil":n.wps.identifier="gs:WPSLineElevation",i=new AltiProfilRequest(n.param);break;default:throw new Error(MessagesResources.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}var s={data:i,method:n.method,param:n.wps},o=new WPS(s);if(!o.processRequestString())throw new Error("Enable to process request !");return o.requestString}},AltiRequestFactory={build:function(n){var e=LoggerByDefault$1.getLogger("AltiRequestFactory");e.trace(["AltiRequestFactory::build()"]);var i=null,s={type:n.sampling?"Profil":"Elevation",method:n.httpMethod,param:{positions:null,delimiter:null,indent:null,crs:null,format:null,sampling:null,zonly:null,measures:null}};s.param.positions=n.positions,s.param.format=n.outputFormat,s.param.sampling=n.sampling,s.param.zonly=n.zonly,s.param.measures=n.measures,s.param.resource=n.resource;var o=n.onError!==null&&typeof n.onError=="function",l=n.onSuccess!==null&&typeof n.onSuccess=="function",c=null;switch(n.api){case"REST":var u=new AltiRequestREST(s);if(!u.processRequestString()){if(c="Error in process request (rest) !",o){n.onError.call(n.scope,new ErrorService(c));return}throw new Error(c)}i=u.requestString;break;case"WPS":if(s.wps={service:null,version:null,identifier:null,rawdataoutput:null,request:null},i=AltiRequestWPS.build(s),!i){if(c="Error in process request (wps) !",o){n.onError.call(n.scope,new ErrorService(c));return}throw new Error(c)}break;default:if(c="Type of API is not supported by service (REST or WPS) !",o){n.onError.call(n.scope,new ErrorService(c));return}throw new Error(c)}return l&&n.onSuccess.call(n.scope,i),i}};function XML$1(n){if(!(this instanceof XML$1))throw new TypeError("XML constructor cannot be called as a function.");this.logger=LoggerByDefault$1.getLogger(),this.logger.trace("[Constructeur XML ()]"),this.xmlString=null,this.xmlDoc=null,this.reader=null,n&&(n.xmlString&&typeof n.xmlString=="string"&&(this.xmlString=n.xmlString,this.xmlDoc=__getXMLDOC(n.xmlString)),n.reader&&this.setReader(n.reader))}XML$1.prototype={constructor:XML$1,getXMLString:function(){return this.xmlString},setXMLString:function(n){n&&typeof n=="string"&&(this.xmlString=n,this.xmlDoc=__getXMLDOC(n))},getReader:function(){return this.reader},setReader:function(n){n&&n.read&&typeof n.read=="function"&&(this.reader=n)},getXMLDoc:function(){return this.xmlDoc},setXMLDoc:function(n){this.xmlDoc=n},parse:function(){if(!this.xmlDoc&&this.xmlString&&(this.xmlDoc=__getXMLDOC(this.xmlString)),this.xmlDoc){var n=__getRootNode(this.xmlDoc);if(n){var e;return this.reader&&this.reader.read?e=this.reader.read(n):(e={},e[n.nodeName]=__readDefault(n)),e}else return{}}}};function __getXMLDOC(n){if(typeof window>"u"){var e=require("@xmldom/xmldom").DOMParser;return new e().parseFromString(n,"text/xml")}else{var i,s,o="Erreur lors du parsing de la rponse du service : XML non conforme";if(window.ActiveXObject){s=new window.ActiveXObject("Microsoft.XMLDOM"),s.async=!1,s.loadXML(n);var l=s.parseError;if(l.errorCode)throw l.line&&l.linepos&&(o+="( ligne "+l.line+", colonne "+l.linepos),l.reason&&(o+=":  "+l.reason+")"),new Error(o);return s}else if(window.DOMParser){i=new window.DOMParser;try{s=i.parseFromString(n,"text/xml")}catch(g){throw g.message==="SyntaxError"?new Error(o):new Error("Erreur lors du parsing de la rponse du service : "+g.message)}if(s.getElementsByTagName("parsererror").length>0)for(var c=s.getElementsByTagName("parsererror"),u=0;u<c.length;u++){var f=c[u].innerHTML;if(f.indexOf("Huge input lookup")===-1)throw o+="("+f+")",new Error(o)}else if(!s.documentElement)throw new Error(o);return s}else throw new Error("Incompatible DOM Parser pour ce navigateur !")}}function __getRootNode(n){var e;return n.nodeType===9?e=n.documentElement:n.nodeType===1&&(e=n),e}function __readDefault(n){var e={};if(n.attributes.length>0){var i=__getAttributes(n);e.attributes=i}if(n.hasChildNodes()){for(var s={},o,l=n.childNodes,c=0;c<l.length;c++)if(o=l[c],o.nodeType===3)e.textContent=o.nodeValue;else if(o.nodeType===1)if(s=__readDefault(o),!e[o.nodeName])e[o.nodeName]=s;else{if(!Array.isArray(e[o.nodeName])){var u=e[o.nodeName];e[o.nodeName]=[],e[o.nodeName].push(u)}e[o.nodeName].push(s)}}return e}function __getAttributes(n){if(n.attributes.length>0){for(var e={},i=n.attributes,s=0;s<i.length;s++){var o=i[s];e[o.nodeName]=o.nodeValue}return e}}function AltiResponse(){if(!(this instanceof AltiResponse))throw new TypeError("AltiResponse constructor cannot be called as a function.");this.elevations=[]}AltiResponse.prototype={constructor:AltiResponse};function Elevation(){if(!(this instanceof Elevation))throw new TypeError("Elevation constructor cannot be called as a function.");this.z=null}Elevation.prototype={constructor:Elevation};function Measure(){if(!(this instanceof Measure))throw new TypeError("Measure constructor cannot be called as a function.");this.source_name=null,this.source_measure=null,this.z=null,this.acc=null}Measure.prototype={constructor:Measure};var AltiResponseReader={};AltiResponseReader.READERS={elevations:function(n){var e=new AltiResponse;if(n.hasChildNodes())for(var i=n.childNodes,s,o,l=0;l<i.length;l++)s=i[l],AltiResponseReader.READERS[s.nodeName]&&(o=AltiResponseReader.READERS[s.nodeName](s),e.elevations.push(o));return e},elevation:function(n){var e=new Elevation;if(n.hasChildNodes())for(var i=n.childNodes,s,o=0;o<i.length;o++)s=i[o],AltiResponseReader.READERS[s.nodeName]&&AltiResponseReader.READERS[s.nodeName](s,e);return e},lat:function(n,e){var i=n.firstChild;if(i&&i.nodeType===3)e.lat=parseFloat(i.nodeValue);else throw new Error("Erreur dans la lecture de la rponse du service : latitude attendue mais absente")},lon:function(n,e){var i=n.firstChild;if(i&&i.nodeType===3)e.lon=parseFloat(i.nodeValue);else throw new Error("Erreur dans la lecture de la rponse du service : longitude attendue mais absente")},z:function(n,e){var i=n.firstChild;if(i&&i.nodeType===3)if(e)e.z=parseFloat(i.nodeValue);else return e=new Elevation,e.z=parseFloat(i.nodeValue),e;else throw new Error("Erreur dans la lecture de la rponse du service : altitude attendue mais absente")},acc:function(n,e){var i=n.firstChild;if(i&&i.nodeType===3)e.acc=parseFloat(i.nodeValue);else throw new Error("Erreur dans la lecture de la rponse du service : prcision (acc) attendue mais absente")},source_name:function(n,e){var i=n.firstChild;if(i&&i.nodeType===3)e.source_name=i.nodeValue;else throw new Error("Erreur dans la lecture de la rponse du service : source_name attendue mais absente")},source_measure:function(n,e){var i=n.firstChild;if(i&&i.nodeType===3)e.source_measure=i.nodeValue;else throw new Error("Erreur dans la lecture de la rponse du service : source_measure attendue mais absente")},measures:function(n,e){e.measures=[];var i;if(n.hasChildNodes())for(var s=n.childNodes,o,l,c=0;c<s.length;c++){i=new Measure,o=s[c],l=o.childNodes;for(var u=0;u<l.length;u++)if(AltiResponseReader.READERS[l[u].nodeName])AltiResponseReader.READERS[l[u].nodeName](l[u],i);else throw new Error("Erreur dans la lecture de la rponse du service : measures attendues mais absentes");e.measures.push(i)}},exceptionreport:function(n){var e={};if(n.hasChildNodes())for(var i=n.childNodes,s,o=0;o<i.length;o++)s=i[o],s.nodeName==="Exception"&&(e.exceptionReport=AltiResponseReader.READERS.exception(s));return e},exception:function(n){var e={},i=n.getAttribute("exceptionCode");i&&(e.exceptionCode=i);var s=n.firstChild;return s&&s.nodeType===3&&(e.exception=s.nodeValue),e},error:function(n){var e={error:{}};if(n.hasChildNodes())for(var i=n.childNodes,s,o=0;o<i.length;o++){s=i[o];var l;s.nodeType===1&&s.nodeName==="code"&&(l=s.firstChild,l&&l.nodeType===3&&(e.error.code=l.nodeValue)),s.nodeType===1&&s.nodeName==="description"&&(l=s.firstChild,l&&l.nodeType===3&&(e.error.description=l.nodeValue))}return e}};AltiResponseReader.read=function(n){if(n.nodeName==="elevations"){var e=AltiResponseReader.READERS.elevations(n);return e}else if(n.nodeName==="ExceptionReport"){var i=AltiResponseReader.READERS.exceptionreport(n);return i}else if(n.nodeName==="error"){var s=AltiResponseReader.READERS.error(n);return s}else throw new Error("Erreur lors de la lecture de la rponse : elle n'est pas au format attendu.")};var AltiResponseFactory={build:function(n){var e=LoggerByDefault$1.getLogger("AltiResponseFactory");e.trace(["AltiResponseFactory::build()"]);var i=null;if(n.response)if(n.rawResponse)e.trace("analyze response : raw"),i=n.response;else{switch(n.outputFormat){case"xml":e.trace("analyze response : xml");try{var s=new XML$1({reader:AltiResponseReader});if(typeof n.response=="string"?s.setXMLString(n.response):s.setXMLDoc(n.response),i=s.parse(),!i)throw new Error(MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(Y){var o=Y.message;n.onError.call(n.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",o),status:200,type:ErrorService.TYPE_SRVERR}));return}break;case"json":e.trace("analyze response : json"),e.trace("analyze response : ",typeof n.response);var l=null;if(typeof n.response=="string"?l=JSON.parse(n.response):l=n.response,l&&l.error){n.onError.call(n.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",l.error.description),status:200,type:ErrorService.TYPE_SRVERR}));return}if(l){var c=l.elevations,u=new AltiResponse,f;if(Array.isArray(c)&&c.length)for(var g=0;g<c.length;g++)f=new Elevation,typeof c[g]=="object"?(c[g].lon&&(f.lon=c[g].lon),c[g].lat&&(f.lat=c[g].lat),c[g].z&&(f.z=c[g].z),c[g].acc&&(f.acc=c[g].acc),c[g].measures&&(f.measures=c[g].measures)):typeof c[g]=="number"&&(f.z=c[g]),Array.isArray(u.elevations)&&u.elevations.push(f);i=u}if(!i){n.onError.call(n.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:ErrorService.TYPE_UNKERR,status:-1}));return}break;default:n.onError.call(n.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_FORMAT_2"),type:ErrorService.TYPE_UNKERR,status:-1}));return}if(i.exceptionReport){n.onError.call(n.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",i.exceptionReport),type:ErrorService.TYPE_SRVERR,status:200}));return}else if(i.error){var H=i.error.description;n.onError.call(n.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",H),type:ErrorService.TYPE_SRVERR,status:200}));return}}else{n.onError.call(n.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")));return}n.onSuccess.call(n.scope,i)}};function Alti(n){if(!(this instanceof Alti))throw new TypeError(MessagesResources.getMessage("CLASS_CONSTRUCTOR","Alti"));if(this.CLASSNAME="Alti",CommonService.apply(this,arguments),this.logger=LoggerByDefault$1.getLogger("Gp.Services.Alti"),this.logger.trace("[Constructeur Alti (options)]"),!n.positions)throw new Error(MessagesResources.getMessage("PARAM_MISSING","positions"));if(n.positions.length===0)throw new Error(MessagesResources.getMessage("PARAM_EMPTY","positions"));if(this.options.positions=n.positions,this.options.outputFormat=typeof n.outputFormat=="string"?n.outputFormat.toLowerCase():"xml",this.options.resource=n.resource||"ign_rge_alti_wld",this.options.sampling=n.sampling||null,this.options.api=typeof n.api=="string"?n.api.toUpperCase():"REST",this.options.api==="REST"&&(this.options.httpMethod="GET"),this.options.zonly=n.zonly||!1,this.options.measures=n.measures||!1,!this.options.serverUrl){var e=DefaultUrlService.Alti.newUrl(),i=null;switch(this.options.api){case"WPS":i=e.wps;break;case"REST":var s=(n.sampling?"profil":"elevation")+"-"+this.options.outputFormat;i=e[s];break;default:throw new Error(MessagesResources.getMessage("PARAM_UNKNOWN","api"))}if(!i)throw new Error("Url by default not found !");this.options.serverUrl=i,this.logger.trace("Server URL by default : "+this.options.serverUrl)}var o=this.options.serverUrl.lastIndexOf(".");if(o!==-1){var l=this.options.serverUrl.substring(o+1);if(l&&l.length<5)switch(this.logger.trace("Server Extension URL : "+l),l.toLowerCase()){case"json":case"xml":this.options.outputFormat=l.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}Alti.prototype=Object.create(CommonService.prototype,{});Alti.prototype.constructor=Alti;Alti.prototype.buildRequest=function(n,e){var i={httpMethod:this.options.httpMethod,onSuccess:function(s){this.request=s,e.call(this,this.request)},onError:n,scope:this,resource:this.options.resource,positions:this.options.positions,outputFormat:this.options.outputFormat,sampling:this.options.sampling,api:this.options.api,zonly:this.options.zonly,measures:this.options.measures};AltiRequestFactory.build(i)};Alti.prototype.analyzeResponse=function(n,e){if(this.response){var i={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:n,onSuccess:e,scope:this};AltiResponseFactory.build(i)}else n.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")))};function GeocodeParamREST(n){if(!(this instanceof GeocodeParamREST))throw new TypeError("GeocodeParamREST constructor cannot be called as a function.");if(this.logger=LoggerByDefault$1.getLogger(),this.logger.trace("[Constructeur GeocodeParamREST ()]"),this.options=n||{},!this.options.geocodeMethod||this.options.geocodeMethod!=="search"&&this.options.geocodeMethod!=="reverse")throw new Error("Error geocodeMethod not valid");this.geocodeMethod=this.options.geocodeMethod,this.query=typeof this.options<"u"?this.options.query:null,this.searchGeometry=this.options.searchGeometry||null,this.index=this.options.index||null,this.lon=this.options.position&&this.options.position.lon?this.options.position.lon:null,this.lat=this.options.position&&this.options.position.lat?this.options.position.lat:null,this.maxResp=this.options.maxResp||null,this.returnTrueGeometry=this.options.returnTrueGeometry||null,this.filters=this.options.filters||{}}GeocodeParamREST.CLASSNAME="GeocodeParamREST";GeocodeParamREST.prototype={constructor:GeocodeParamREST,getFilters:function(){var n={};for(var e in this.filters)this.filters.hasOwnProperty(e)&&(n[e]=this.filters[e]);return n},getIndex:function(){return this.index===void 0?null:this.index==="StreetAddress"?"address":this.index==="CadastralParcel"?"parcel":this.index==="PositionOfInterest"?"poi":this.index==="location"?"location":this.index},getSearchGeometry:function(){return JSON.stringify(this.searchGeometry)}};GeocodeParamREST.prototype.getParams=function(){var n=[];this.geocodeMethod==="search"&&n.push({k:"q",v:this.query}),this.index&&n.push({k:"index",v:this.getIndex()}),this.geocodeMethod==="reverse"&&this.searchGeometry&&n.push({k:"searchgeom",v:this.getSearchGeometry()}),this.lon&&this.lat&&(n.push({k:"lon",v:this.lon}),n.push({k:"lat",v:this.lat})),this.maxResp&&n.push({k:"limit",v:this.maxResp}),this.returnTrueGeometry&&n.push({k:"returntruegeometry",v:this.returnTrueGeometry});const e=this.getFilters();for(var i in e)n.push({k:i,v:e[i]});return n};function GeocodeRequestREST(n){if(this.logger=LoggerByDefault$1.getLogger("GeocodeRequestREST"),this.logger.trace("[Constructeur GeocodeRequestREST ()]"),!(this instanceof GeocodeRequestREST))throw new TypeError("GeocodeRequestREST constructor cannot be called as a function.");if(!n)throw new Error(MessagesResources.getMessage("PARAM_EMPTY","options"));this.settings=n}GeocodeRequestREST.prototype={requestString:null,constructor:GeocodeRequestREST,processRequestString:function(){var n="";const i=new GeocodeParamREST(this.settings).getParams();for(var s=0;s<i.length;s++){var o=i[s];n&&(n+="&"),n+=o.k+"="+o.v}if(!this.settings.geocodeMethod||this.settings.geocodeMethod!=="search"&&this.settings.geocodeMethod!=="reverse")throw new Error("Error geocodeMethod not valid");return this.requestString="?"+n,this.logger.trace(this.requestString),this.requestString}};var GeocodeRequestFactory={build:function(n){var e=LoggerByDefault$1.getLogger("GeocodeRequestFactory");e.trace(["GeocodeRequestFactory::build()"]);var i=n||{},s=new GeocodeRequestREST(i);if(!s.processRequestString())throw new Error("Error process request (rest) !");var o=s.requestString;return e.trace(o),o}};function GeocodeResponse(){if(!(this instanceof GeocodeResponse))throw new TypeError("GeocodeResponse constructor cannot be called as a function.");this.locations=[]}GeocodeResponse.prototype={constructor:GeocodeResponse};function GeocodedLocation(){if(!(this instanceof GeocodedLocation))throw new TypeError("GeocodedLocation constructor cannot be called as a function.");this.position=null,this.matchType=null,this.placeAttributes={},this.type=null,this.accuracy=null,this.CLASSNAME="GeocodedLocation"}GeocodedLocation.prototype={constructor:GeocodedLocation};function GeocodeResponseParser(){if(!(this instanceof GeocodeResponseParser))throw new TypeError("GeocodeResponseParser constructor cannot be called as a function.")}GeocodeResponseParser.prototype={constructor:GeocodeResponseParser,parse:function(n){var e=new GeocodeResponse;const i=JSON.parse(n);if(i.type==="FeatureCollection")for(var s=0;s<i.features.length;++s)_parseFeature(i.features[s],e);else if(i.type==="Feature")_parseFeature(i,e);else{if(i.type==="SERVICE_ERROR")return _parseError(i);var o=MessagesResources.getMessage("SERVICE_RESPONSE_ANALYSE",i.type);throw new ErrorService({message:o,type:ErrorService.TYPE_UNKERR,status:200})}return e}};function _parseFeature(n,e){var i=new GeocodedLocation;if(n.geometry&&n.geometry.type==="Point"&&(i.position={lon:n.geometry.coordinates[0],lat:n.geometry.coordinates[1]}),n.properties){for(var s in n.properties)s==="score"?i.accuracy=n.properties[s]:s==="_type"?n.properties[s]==="address"?i.type="StreetAddress":n.properties[s]==="poi"?i.type="PositionOfInterest":(n.properties[s]==="parcel"||n.properties[s]==="cadastral")&&(i.type="CadastralParcel"):i.placeAttributes[s]=n.properties[s];n.properties._type==="address"&&(i.matchType=n.properties.number!==void 0&&n.properties.number!==null?"street number":"street")}e.locations.push(i)}function _parseError(n){return{exceptionReport:n}}var GeocodeReponseFactory={build:function(n){var e=null;if(n.response)if(n.rawResponse)e=n.response;else{try{if(e=new GeocodeResponseParser().parse(n.response),!e)throw new Error("L'analyse de la rponse du service !?")}catch(s){var i=s.message;typeof n.response=="string"?i+="('"+n.response+"')":i+="('"+n.response.documentElement.innerHTML+"')",n.onError.call(n.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_ANALYSE",i),type:ErrorService.TYPE_UNKERR,status:-1}));return}if(e.exceptionReport){n.onError.call(n.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",e.exceptionReport),type:ErrorService.TYPE_SRVERR,status:200}));return}}else{n.onError.call(n.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY"),type:ErrorService.TYPE_SRVERR,status:-1}));return}n.onSuccess.call(n.scope,e)}};function Geocode(n){if(!(this instanceof Geocode))throw new TypeError(MessagesResources.getMessage("CLASS_CONSTRUCTOR","Geocode"));this.CLASSNAME="Geocode",this.logger=LoggerByDefault$1.getLogger("Gp.Services.Geocode"),this.logger.trace("[Constructeur Geocode (options)]");var e=this.patchOptionConvertor(n);if(e.serverUrl||(e.serverUrl=DefaultUrlService.Geocode.newUrl()),CommonService.apply(this,[e]),!e.hasOwnProperty("query"))throw new Error(MessagesResources.getMessage("PARAM_MISSING","query"));if(this.options.query=e.query,e.index||(this.options.index=e.index="StreetAddress"),e.filters)for(var i=Object.keys(e.filters),s=0;s<i.length;s++){var o=i[s];(typeof e.filters[o]>"u"||typeof e.filters[o]=="object"&&Object.keys(e.filters[o]).length===0||typeof e.filters[o]=="string"&&e.filters[o].length===0||Array.isArray(e.filters[o])&&e.filters[o].length===0)&&delete this.options.filters[o]}this.options.index=e.index||"StreetAddress",this.options.maximumResponses=e.maximumResponses||20}Geocode.prototype=Object.create(CommonService.prototype,{});Geocode.prototype.constructor=Geocode;Geocode.prototype.patchOptionConvertor=function(n){const e=n;return e.hasOwnProperty("location")&&(this.logger.warn("The parameter 'location' is deprecated"),e.query||(e.query=e.location),delete e.location),e.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),e.filters||(e.filters=e.filterOptions,e.filters.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),e.index||(Array.isArray(e.filters.type)&&e.filters.type.length>0?e.index=e.filters.type[0]:e.index=e.filters.type),delete e.filters.type),e.filters.bbox&&(this.logger.warn("The parameter 'filterOptions.bbox' is deprecated"),delete e.filters.bbox)),delete e.filterOptions),e.position&&(e.position.x&&(this.logger.warn("The parameter 'position.x' is deprecated"),e.position.lon||(e.position.lon=e.position.x),delete e.position.x),e.position.y&&(this.logger.warn("The parameter 'position.y' is deprecated"),e.position.lat||(e.position.lat=e.position.y),delete e.position.y)),e.returnFreeForm&&(this.logger.warn("The parameter 'returnFreeForm' is deprecated"),delete e.returnFreeForm),e.srs&&(this.logger.warn("The parameter 'srs' is deprecated"),delete e.srs),e};Geocode.prototype.buildRequest=function(n,e){var i={httpMethod:this.options.httpMethod,geocodeMethod:"search",query:this.options.query,index:this.options.index,returnTrueGeometry:this.options.returnTrueGeometry,position:this.options.position,maxResp:this.options.maximumResponses,filters:this.options.filters};this.request=GeocodeRequestFactory.build(i),this.request?e.call(this,this.request):n.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_REQUEST_BUILD")))};Geocode.prototype.analyzeResponse=function(n,e){if(this.response){var i={response:this.response,rawResponse:this.options.rawResponse,onError:n,onSuccess:e,scope:this};GeocodeReponseFactory.build(i)}else n.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")))};function ReverseGeocode$1(n){if(!(this instanceof ReverseGeocode$1))throw new TypeError(MessagesResources.getMessage("CLASS_CONSTRUCTOR","ReverseGeocode"));this.CLASSNAME="ReverseGeocode",this.logger=LoggerByDefault$1.getLogger("Gp.Services.ReverseGeocode"),this.logger.trace("[Constructeur ReverseGeocode (options)]");var e=this.patchOptionConvertor(n);if(e.serverUrl||(e.serverUrl=DefaultUrlService.ReverseGeocode.newUrl()),CommonService.apply(this,[e]),e.searchGeometry)this.options.searchGeometry=e.searchGeometry;else if(!e.position)throw new Error(MessagesResources.getMessage("PARAM_MISSING","searchGeometry"));if(e.index||(this.options.index=e.index="StreetAddress"),e.filters)for(var i=Object.keys(e.filters),s=0;s<i.length;s++){var o=i[s];(typeof e.filters[o]>"u"||typeof e.filters[o]=="object"&&Object.keys(e.filters[o]).length===0||typeof e.filters[o]=="string"&&e.filters[o].length===0||Array.isArray(e.filters[o])&&e.filters[o].length===0)&&delete this.options.filters[o]}this.options.position=e.position,this.options.index=e.index||"StreetAddress",this.options.maximumResponses=e.maximumResponses||20}ReverseGeocode$1.prototype=Object.create(CommonService.prototype,{});ReverseGeocode$1.prototype.constructor=ReverseGeocode$1;ReverseGeocode$1.prototype.patchOptionConvertor=function(n){var e=n;return e.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),e.filterOptions.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),e.index||(Array.isArray(e.filterOptions.type)&&e.filterOptions.type.length>0?e.index=e.filterOptions.type[0]:e.index=e.filterOptions.type),delete e.filterOptions.type),e.filterOptions.bbox&&(this.logger.warn("The parameter 'filterOptions.bbox' is deprecated"),e.searchGeometry||(e.searchGeometry=this.bbox2Json(e.filterOptions.bbox)),delete e.filterOptions.bbox),e.filterOptions.circle&&(this.logger.warn("The parameter 'filterOptions.circle' is deprecated"),e.searchGeometry||(e.searchGeometry=this.circle2Json(e.filterOptions.circle)),delete e.filterOptions.circle),e.filterOptions.polygon&&(this.logger.warn("The parameter 'filterOptions.polygon' is deprecated"),e.searchGeometry||(e.searchGeometry=this.polygon2Json(e.filterOptions.polygon)),delete e.filterOptions.polygon),!e.filters&&Object.keys(e.filterOptions).length>0&&(e.filters=e.filterOptions),delete e.filterOptions),e.position&&(e.position.x&&(this.logger.warn("The parameter 'position.x' is deprecated"),e.position.lon||(e.position.lon=e.position.x),delete e.position.x),e.position.y&&(this.logger.warn("The parameter 'position.y' is deprecated"),e.position.lat||(e.position.lat=e.position.y),delete e.position.y)),e.srs&&(this.logger.warn("The parameter 'srs' is deprecated"),delete e.srs),e};ReverseGeocode$1.prototype.buildRequest=function(n,e){var i={httpMethod:this.options.httpMethod,geocodeMethod:"reverse",searchGeometry:this.options.searchGeometry,index:this.options.index,position:this.options.position,returnTrueGeometry:this.options.returnTrueGeometry,maxResp:this.options.maximumResponses,filters:this.options.filters};this.request=GeocodeRequestFactory.build(i),this.request?e.call(this,this.request):n.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_REQUEST_BUILD")))};ReverseGeocode$1.prototype.analyzeResponse=function(n,e){if(this.response){var i={response:this.response,rawResponse:this.options.rawResponse,onError:n,onSuccess:e,scope:this};GeocodeReponseFactory.build(i)}else n.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")))};ReverseGeocode$1.prototype.bbox2Json=function(n){return{type:"Polygon",coordinates:[[[n.left,n.top],[n.right,n.top],[n.right,n.bottom],[n.left,n.bottom],[n.left,n.top]]]}};ReverseGeocode$1.prototype.circle2Json=function(n){return{type:"Circle",radius:n.radius,coordinates:[n.x,n.y]}};ReverseGeocode$1.prototype.polygon2Json=function(n){for(var e={type:"Polygon",coordinates:[[]]},i=0;i<n.length;++i)e.coordinates[0].push([n[i].x,n[i].y]);return e};ReverseGeocode$1.geoEPSG=["EPSG:4326"];function AutoCompleteResponse(){if(!(this instanceof AutoCompleteResponse))throw new TypeError("AutoCompleteResponse constructor cannot be called as a function.");this.suggestedLocations=[]}AutoCompleteResponse.prototype={constructor:AutoCompleteResponse};function SuggestedLocation(){if(!(this instanceof SuggestedLocation))throw new TypeError("SuggestedLocation constructor cannot be called as a function.");this.type=null,this.position={x:null,y:null},this.commune=null,this.fullText=null,this.postalCode=null,this.classification=null,this.street=null,this.poi=null,this.kind=null}SuggestedLocation.prototype={constructor:SuggestedLocation};var AutoCompleteResponseFactory={build:function(n){var e=LoggerByDefault$1.getLogger("AutoCompleteResponseFactory");e.trace(["AutoCompleteResponseFactory::build()"]);var i=null;if(n.response)if(n.rawResponse)e.trace("analyze response : raw"),i=n.response;else{var s=null;if(typeof n.response=="string"?s=JSON.parse(n.response):s=n.response,s){if(s.error){n.onError.call(n.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",s.error.description),status:s.error.code,type:ErrorService.TYPE_SRVERR}));return}if(i=new AutoCompleteResponse,s.results&&Array.isArray(s.results))for(var o=null,l=0;l<s.results.length;l++){var c=s.results[l];o=new SuggestedLocation,c&&(c.country==="StreetAddress"?(o.street=c.street,o.type="StreetAddress"):c.country==="PositionOfInterest"&&(o.poi=c.street,o.type="PositionOfInterest",o.poiType=c.poiType),o.position&&(o.position.x=c.x,o.position.y=c.y),o.kind=c.kind,o.commune=c.city,o.fullText=c.fulltext,o.postalCode=c.zipcode,o.classification=c.classification),i.suggestedLocations.push(o)}else{n.onError.call(n.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_FORMAT_3")));return}if(!i.suggestedLocations.length){n.onError.call(n.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_FORMAT_3")));return}}if(!i){n.onError.call(n.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:ErrorService.TYPE_UNKERR,status:-1}));return}if(i.exceptionReport){n.onError.call(n.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",i.exceptionReport),type:ErrorService.TYPE_SRVERR,status:200}));return}}else{n.onError.call(n.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")));return}n.onSuccess.call(n.scope,i)}};function AutoComplete(n){if(!(this instanceof AutoComplete))throw new TypeError(MessagesResources.getMessage("CLASS_CONSTRUCTOR","AutoComplete"));this.CLASSNAME="AutoComplete",this.logger=LoggerByDefault$1.getLogger("Gp.Services.AutoComplete"),this.logger.trace("[Constructeur AutoComplete (options)]");var e=this.patchOptionConvertor(n);if(e.serverUrl||(e.serverUrl=DefaultUrlService.AutoComplete.newUrl()),CommonService.apply(this,arguments),!e.text)throw new Error(MessagesResources.getMessage("PARAM_MISSING","text"));this.options.text=e.text,e.type||(e.type=["StreetAddress,PositionOfInterest"]),this.options.type=e.type,this.options.territory=e.terr||"",this.options.maximumResponses=e.maximumResponses||10,this.options.protocol==="XHR"&&this.options.httpMethod==="POST"&&(this.logger.warn("Le service ne gre pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"json"}AutoComplete.prototype=Object.create(CommonService.prototype,{});AutoComplete.prototype.constructor=AutoComplete;AutoComplete.prototype.patchOptionConvertor=function(n){const e=n;return e.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),e.filterOptions.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),e.type||(e.type=e.filterOptions.type)),e.filterOptions.territory&&(this.logger.warn("The parameter 'filterOptions.territory' is deprecated"),e.terr||(e.terr=e.filterOptions.territory)),delete e.filterOptions),e};AutoComplete.prototype.buildRequest=function(n,e){var i="";this.options.territory&&(i=this.options.territory);var s="";this.options.type&&(s=this.options.type.join(",")),this.request=Helper$1.normalyzeParameters({text:encodeURIComponent(this.options.text),type:s,terr:i,maximumResponses:this.options.maximumResponses}),this.request?e.call(this,this.request):n.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_REQUEST_BUILD")))};AutoComplete.prototype.analyzeResponse=function(n,e){if(this.response){var i={response:this.response,rawResponse:this.options.rawResponse,onSuccess:e,onError:n,scope:this};AutoCompleteResponseFactory.build(i)}else n.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")))};function RouteParamREST(n){if(!(this instanceof RouteParamREST))throw new TypeError("RouteParamREST constructor cannot be called as a function.");this.logger=LoggerByDefault$1.getLogger(),this.logger.trace("[Constructeur RouteParamREST ()]"),this.options=n||{},this.resource=this.options.resource,this.start=this.options.startPoint.x+","+this.options.startPoint.y,this.end=this.options.endPoint.x+","+this.options.endPoint.y,this.intermediates=this.options.viaPoints,this.profile=this.options.graph,this.crs=this.options.srs,this.constraints=this.options.constraints,this.optimization=this.options.routePreference,this.getSteps=this.options.geometryInInstructions?"true":"false",this.distanceUnit=this.options.distanceUnit,this.timeUnit=this.options.timeUnit,this.waysAttributes=this.options.waysAttributes}RouteParamREST.CLASSNAME="RouteParamREST";RouteParamREST.prototype={constructor:RouteParamREST,getIntermediates:function(){var n=[];if(this.intermediates.length!==0)for(var e=0;e<this.intermediates.length;e++){var i=this.intermediates[e];n.push(i.x+","+i.y)}return n.join("|")},getWaysAttributes:function(){return this.waysAttributes.join("|")},getProfile:function(){return this.profile},getDistanceUnit:function(){return this.distanceUnit==="m"?"meter":this.distanceUnit==="km"?"kilometer":""},getOptimization:function(){return this.optimization?this.optimization:""},getConstraints:function(){var n=[];if(this.constraints.length!==0)for(var e=0;e<this.constraints.length;e++)n.push(JSON.stringify(this.constraints[e]));return n.join("|")}};RouteParamREST.prototype.getParams=function(){var n=[];return n.push({k:"resource",v:this.resource}),n.push({k:"start",v:this.start}),n.push({k:"end",v:this.end}),n.push({k:"geometryFormat",v:"geojson"}),this.optimization&&n.push({k:"optimization",v:this.getOptimization()}),this.intermediates&&n.push({k:"intermediates",v:this.getIntermediates()}),this.profile&&n.push({k:"profile",v:this.getProfile()}),this.constraints&&n.push({k:"constraints",v:this.getConstraints()}),this.crs&&n.push({k:"crs",v:this.crs}),this.distanceUnit&&n.push({k:"distanceUnit",v:this.getDistanceUnit()}),this.timeUnit&&n.push({k:"timeUnit",v:this.timeUnit}),this.waysAttributes&&n.push({k:"waysAttributes",v:this.getWaysAttributes()}),n};function RouteRequestREST(n){if(this.logger=LoggerByDefault$1.getLogger("RouteRequestREST"),this.logger.trace("[Constructeur RouteRequestREST ()]"),!(this instanceof RouteRequestREST))throw new TypeError("RouteRequestREST constructor cannot be called as a function.");if(!n)throw new Error(MessagesResources.getMessage("PARAM_EMPTY","options"));this.settings=n}RouteRequestREST.prototype={requestString:null,constructor:RouteRequestREST,processRequestString:function(){this.logger.warn(" PROTOTYPE !");for(var n=new RouteParamREST(this.settings),e=n.getParams(),i="",s=0;s<e.length;s++){var o=e[s];i&&(i+="&"),i+=o.k+"="+o.v}return this.logger.trace(i),this.requestString=i,this.requestString}};var RouteRequestFactory={build:function(n){var e=LoggerByDefault$1.getLogger("RouteRequestFactory");e.trace(["RouteRequestFactory::build()"]);var i=null,s=n||{},o=n.onError!==null&&typeof n.onError=="function",l=null,c=new RouteRequestREST(s);if(!c.processRequestString()){if(l="Error process request (rest) !",o){n.onError.call(n.scope,new ErrorService(l));return}throw new Error(l)}return i=c.requestString,i}};function RouteResponse(){if(!(this instanceof RouteResponse))throw new TypeError("RouteResponse constructor cannot be called as a function.");this.totalTime=null,this.totalDistance=null,this.bbox={left:null,right:null,top:null,bottom:null},this.routeGeometry=null,this.routeInstructions=[]}RouteResponse.prototype={constructor:RouteResponse};function RouteInstruction(){if(!(this instanceof RouteInstruction))throw new TypeError("RouteInstruction constructor cannot be called as a function.");this.duration=null,this.distance=null,this.code=null,this.instruction=null,this.geometry=null}RouteInstruction.prototype={constructor:RouteInstruction};var RouteResponseFactory={build:function(n){var e=LoggerByDefault$1.getLogger("RouteResponseFactory");e.trace("RouteResponseFactory::build()");var i=null;if(n.response)if(n.rawResponse)e.trace("analyze response : raw"),i=n.response;else{e.trace("analyze response : json");var s;if(typeof n.response=="string"?s=JSON.parse(n.response):s=n.response,s){if(s.message){n.onError.call(n.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",s.message)));return}var o=[],l=[],c=[];if(i=new RouteResponse,i.hasOwnProperty("totalTime")&&(i.totalTime=parseFloat(s.duration)),i.hasOwnProperty("totalDistance")&&(i.totalDistance=parseFloat(s.distance)),i.hasOwnProperty("bbox")&&(i.bbox.left=parseFloat(s.bbox[0]),i.bbox.bottom=parseFloat(s.bbox[1]),i.bbox.right=parseFloat(s.bbox[2]),i.bbox.top=parseFloat(s.bbox[3])),i.hasOwnProperty("routeGeometry")&&!n.geometryInInstructions&&(i.routeGeometry=s.geometry),i.hasOwnProperty("routeInstructions")&&n.geometryInInstructions){var u=s.portions,f;if(Array.isArray(u)&&u.length)for(f=0;f<u.length;f++)o.push(u[f]);if(o.length)for(f=0;f<o.length;f++)l.push(o[f].steps);if(l.length)for(f=0;f<l.length;f++)c=c.concat(l[f]);c.forEach(function(g){switch(i.routeInstructions.push(new RouteInstruction),i.routeInstructions[i.routeInstructions.length-1].duration=g.duration,i.routeInstructions[i.routeInstructions.length-1].distance=g.distance,i.routeInstructions[i.routeInstructions.length-1].code="",i.routeInstructions[i.routeInstructions.length-1].instruction="",i.routeInstructions[i.routeInstructions.length-1].geometry=g.geometry,g.name==="Valeur non renseigne"&&(g.name=""),g.instruction.type){case"turn":i.routeInstructions[i.routeInstructions.length-1].instruction+="Tourner";break;case"new name":i.routeInstructions[i.routeInstructions.length-1].instruction+="Continuer tout droit";break;case"depart":i.routeInstructions[i.routeInstructions.length-1].instruction+="Dpart";break;case"arrive":i.routeInstructions[i.routeInstructions.length-1].instruction+="Arrive";break;case"merge":i.routeInstructions[i.routeInstructions.length-1].instruction+="Rejoindre";break;case"ramp":i.routeInstructions[i.routeInstructions.length-1].instruction+="Prendre la bretelle";break;case"on ramp":i.routeInstructions[i.routeInstructions.length-1].instruction+="Prendre la bretelle";break;case"off ramp":i.routeInstructions[i.routeInstructions.length-1].instruction+="Prendre la sortie";break;case"fork":i.routeInstructions[i.routeInstructions.length-1].instruction+="Sur la bifurcation, prendre";break;case"end of road":i.routeInstructions[i.routeInstructions.length-1].instruction+=" la fin de la route, prendre";break;case"use lane":i.routeInstructions[i.routeInstructions.length-1].instruction+="Utiliser la file";break;case"continue":i.routeInstructions[i.routeInstructions.length-1].instruction+="Continuer";break;case"roundabout":i.routeInstructions[i.routeInstructions.length-1].instruction+="Au rond-point";break;case"rotary":i.routeInstructions[i.routeInstructions.length-1].instruction+="Au rond-point";break;case"roundabout turn":i.routeInstructions[i.routeInstructions.length-1].instruction+="Au rond point, tourner";break;case"notification":i.routeInstructions[i.routeInstructions.length-1].instruction+="";break;default:i.routeInstructions[i.routeInstructions.length-1].instruction+="?"+g.instruction.type+"?";break}if(g.instruction.modifier)switch(g.instruction.modifier){case"uturn":i.routeInstructions[i.routeInstructions.length-1].instruction="Faire demi-tour";break;case"sharp right":i.routeInstructions[i.routeInstructions.length-1].instruction+=" compltement  droite";break;case"right":i.routeInstructions[i.routeInstructions.length-1].instruction+="  droite";break;case"slight right":i.routeInstructions[i.routeInstructions.length-1].instruction+=" lgrement  droite";break;case"straight":i.routeInstructions[i.routeInstructions.length-1].instruction="Continuer tout droit";break;case"slight left":i.routeInstructions[i.routeInstructions.length-1].instruction+=" lgrement  gauche";break;case"left":i.routeInstructions[i.routeInstructions.length-1].instruction+="  gauche";break;case"sharp left":i.routeInstructions[i.routeInstructions.length-1].instruction+=" compltement  gauche";break;default:i.routeInstructions[i.routeInstructions.length-1].instruction+=" ?"+g.instruction.modifier+"?";break}g.instruction.exit&&(i.routeInstructions[i.routeInstructions.length-1].instruction+=`${g.instruction.exit}e sortie`),g.attributes.name&&((g.attributes.name.nom_1_droite||g.attributes.name.toponyme)&&(i.routeInstructions[i.routeInstructions.length-1].instruction+=" sur"),g.attributes.name.nom_1_droite&&(i.routeInstructions[i.routeInstructions.length-1].instruction+=` ${g.attributes.name.nom_1_droite}`),g.attributes.name.toponyme&&(i.routeInstructions[i.routeInstructions.length-1].instruction+=` ${g.attributes.name.toponyme}`))})}}if(!i){n.onError.call(n.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_ANALYSE","json")));return}if(i.exceptionReport){n.onError.call(n.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION_2")));return}}else{n.onError.call(n.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")));return}n.onSuccess.call(n.scope,i)}};function Route$1(n){if(!(this instanceof Route$1))throw new TypeError(MessagesResources.getMessage("CLASS_CONSTRUCTOR","Route"));if(this.CLASSNAME="Route",CommonService.apply(this,arguments),this.logger=LoggerByDefault$1.getLogger("Gp.Services.Route"),this.logger.trace("[Constructeur Route (options)]"),!n.startPoint)throw new Error(MessagesResources.getMessage("PARAM_MISSING","startPoint"));if(n.startPoint.x===null)throw new Error(MessagesResources.getMessage("PARAM_MISSING","startPoint.x"));if(n.startPoint.y===null)throw new Error(MessagesResources.getMessage("PARAM_MISSING","startPoint.y"));if(!n.endPoint)throw new Error(MessagesResources.getMessage("PARAM_MISSING","endPoint"));if(n.endPoint.x===null)throw new Error(MessagesResources.getMessage("PARAM_MISSING","endPoint.x"));if(n.endPoint.y===null)throw new Error(MessagesResources.getMessage("PARAM_MISSING","endPoint.y"));if(n.outputFormat&&n.outputFormat!=="json"&&this.logger.warn("options.outputFormat could only be json"),this.options.outputFormat="json",this.options.resource=n.resource||"bdtopo-osrm",this.options.startPoint=n.startPoint,this.options.endPoint=n.endPoint,this.options.viaPoints=n.viaPoints||[],this.options.routePreference=n.routePreference||"fastest",n.graph?(n.graph==="Voiture"&&(this.options.graph="car"),n.graph==="Pieton"&&(this.options.graph="pedestrian")):this.options.graph="car",this.options.constraints=[],n.constraints)if(Array.isArray(n.constraints))for(var e=0;e<n.constraints.length;e++)this.options.constraints.push(n.constraints[e]);else throw new Error(MessagesResources.getMessage("PARAM_TYPE","constraints"));var i={},s={},o={};if(n.exclusions&&n.exclusions.length!==0){this.logger.warn("options.exclusions is DEPRECATED !!");for(var l=0;l<n.exclusions.length;l++){if(typeof n.exclusions[l]=="string")n.exclusions[l]=n.exclusions[l].toLowerCase();else continue;n.exclusions[l]==="toll"&&(o.constraintType="banned",o.key="wayType",o.operator="=",o.value="autoroute",this.options.constraints.push(o)),n.exclusions[l]==="tunnel"&&(i.constraintType="banned",i.key="wayType",i.operator="=",i.value="tunnel",this.options.constraints.push(i)),n.exclusions[l]==="bridge"&&(s.constraintType="banned",s.key="wayType",s.operator="=",s.value="pont",this.options.constraints.push(s))}}if(this.options.geometryInInstructions=n.geometryInInstructions||!1,this.options.provideBbox=n.provideBbox||!0,this.options.distanceUnit=n.distanceUnit||"m",this.options.timeUnit=n.timeUnit||"second",this.options.expectedStartTime=null,this.options.srs=n.srs||"EPSG:4326",this.options.waysAttributes=n.waysAttributes||[],!this.options.serverUrl){var c=DefaultUrlService.Route.newUrl();if(!c)throw new Error("Url by default not found !");this.options.serverUrl=c,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}}Route$1.prototype=Object.create(CommonService.prototype,{});Route$1.prototype.constructor=Route$1;Route$1.prototype.buildRequest=function(n,e){var i={resource:this.options.resource,startPoint:this.options.startPoint,endPoint:this.options.endPoint,viaPoints:this.options.viaPoints,provideBbox:this.options.provideBbox,constraints:this.options.constraints,distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,graph:this.options.graph,geometryInInstructions:this.options.geometryInInstructions,routePreference:this.options.routePreference,srs:this.options.srs,waysAttributes:this.options.waysAttributes};this.request=RouteRequestFactory.build(i),this.request?e.call(this,this.request):n.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_REQUEST_BUILD")))};Route$1.prototype.analyzeResponse=function(n,e){if(this.response){var i={distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:n,onSuccess:e,scope:this,geometryInInstructions:this.options.geometryInInstructions};RouteResponseFactory.build(i)}else n.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")))};function ProcessIsoCurveParam(n){if(!(this instanceof ProcessIsoCurveParam))throw new TypeError("ProcessIsoCurveParam constructor cannot be called as a function.");this.logger=LoggerByDefault$1.getLogger(),this.logger.trace("[Constructeur ProcessIsoCurveParam ()]"),this.options=n||{},this.id=this.options.id,this.resource=this.options.resource,this.point=this.options.position,this.crs=this.options.srs,this.profile=this.options.graph,this.constraints=this.options.constraints,this.reverse=this.options.reverse,this.timeUnit=this.options.timeUnit,this.distanceUnit=this.options.distanceUnit,this.options.method==="distance"?(this.costType="distance",this.costValue=this.options.distance,this.distanceUnit==="m"&&this.costValue>=5e4&&(this.distanceUnit="km",this.costValue/=1e3)):(this.costType="time",this.costValue=this.options.time)}ProcessIsoCurveParam.CLASSNAME="ProcessIsoCurveParam";ProcessIsoCurveParam.prototype={constructor:ProcessIsoCurveParam,getLocation:function(){return this.point.x+","+this.point.y},getDistanceUnit:function(){return this.distanceUnit==="m"?"meter":this.distanceUnit==="km"?"kilometer":""},getConstraints:function(){var n=[];if(this.constraints.length!==0)for(var e=0;e<this.constraints.length;e++)n.push(JSON.stringify(this.constraints[e]));return n.join("|")},getDirection:function(){return this.reverse?"arrival":"departure"}};ProcessIsoCurveParam.prototype.getParams=function(){var n=[];return n.push({k:"resource",v:this.resource}),n.push({k:"point",v:this.getLocation()}),n.push({k:"direction",v:this.getDirection()}),n.push({k:"costType",v:this.costType}),n.push({k:"costValue",v:this.costValue}),n.push({k:"profile",v:this.profile}),n.push({k:"timeUnit",v:this.timeUnit}),n.push({k:"distanceUnit",v:this.getDistanceUnit()}),this.crs&&n.push({k:"crs",v:this.crs}),this.constraints&&n.push({k:"constraints",v:this.getConstraints()}),n};function ProcessIsoCurveRequest(n){if(this.logger=LoggerByDefault$1.getLogger("ProcessIsoCurveRequest"),this.logger.trace("[Constructeur ProcessIsoCurveRequest ()]"),!(this instanceof ProcessIsoCurveRequest))throw new TypeError("ProcessIsoCurveRequest constructor cannot be called as a function.");if(!n)throw new Error(MessagesResources.getMessage("PARAM_EMPTY","options"));this.settings=n,this.mode=this.settings.httpMethod||"GET"}ProcessIsoCurveRequest.prototype={requestString:null,constructor:ProcessIsoCurveRequest,processRequestString:function(){var n="",e=0;switch(this.mode){case"GET":this.logger.trace("Process GET Request");var i=new ProcessIsoCurveParam(this.settings),s=i.getParams();for(e=0;e<s.length;e++){var o=s[e];n&&(n+="&"),n+=o.k+"="+o.v}break;case"POST":this.logger.trace("Process POST Request");var l={};l.resource=this.settings.resource,l.point=this.settings.position.x+","+this.settings.position.y,this.settings.method==="distance"?(l.costType="distance",l.costValue=this.settings.distance):(l.costType="time",l.costValue=this.settings.time),l.profile=this.settings.graph,this.settings.reverse?l.direction="arrival":l.direction="departure",l.constraints=this.settings.constraints,l.distanceUnit=this.settings.distanceUnit,l.timeUnit=this.settings.timeUnit,l.crs=this.settings.srs,n=JSON.stringify(l);break;default:this.logger.error("No other HTTP method supported by the service !")}return this.logger.trace(n),this.requestString=n,this.requestString}};function ProcessIsoCurveResponse(){if(!(this instanceof ProcessIsoCurveResponse))throw new TypeError("ProcessIsoCurveResponse constructor cannot be called as a function.");this.message=null,this.id=null,this.location={},this.location.x=null,this.location.y=null,this.srs=null,this.geometry=null,this.time=null,this.distance=null}ProcessIsoCurveResponse.prototype={constructor:ProcessIsoCurveResponse};var ProcessIsoCurveResponseFactory={build:function(n){var e=LoggerByDefault$1.getLogger("ProcessIsoCurveResponseFactory");e.trace(["ProcessIsoCurveResponseFactory::build()"]);var i=null;if(n.response)if(n.rawResponse)e.trace("analyze response : raw"),i=n.response;else{e.trace("analyze response : json");var s;if(typeof n.response=="string"?s=JSON.parse(n.response):s=n.response,i=new ProcessIsoCurveResponse,s){s.costType==="distance"?(i.time="",i.distance=s.costValue):(i.time=s.costValue,i.distance=""),i.message="",i.id="",i.srs=s.crs,i.geometry=s.geometry;var o=s.point.split(",");i.location&&(i.location.x=o[0],i.location.y=o[1])}else{n.onError.call(n.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_ANALYSE",n.response)));return}if(i.exceptionReport){n.onError.call(n.scope,new ErrorService({message:MessagesResources.getMessage("SERVICE_RESPONSE_EXCEPTION",i.exceptionReport),type:ErrorService.TYPE_SRVERR,status:200}));return}}else{n.onError.call(n.scope,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")));return}n.onSuccess.call(n.scope,i)}};function ProcessIsoCurve(n){if(!(this instanceof ProcessIsoCurve))throw new TypeError(MessagesResources.getMessage("CLASS_CONSTRUCTOR","ProcessIsoCurve"));if(this.CLASSNAME="ProcessIsoCurve",CommonService.apply(this,arguments),this.logger=LoggerByDefault$1.getLogger("Gp.Services.ProcessIsoCurve"),this.logger.trace("[Constructeur ProcessIsoCurve (options)]"),!n.position)throw new Error(MessagesResources.getMessage("PARAM_MISSING","position"));if(n.position.x===null)throw new Error(MessagesResources.getMessage("PARAM_MISSING","position.x"));if(n.position.y===null)throw new Error(MessagesResources.getMessage("PARAM_MISSING","position.y"));if(!n.time&&!n.distance)throw new Error("Parameter (s) 'distance' missing. Parameter time to calculate an isochrone, parameter distance for an isodistance");if(!n.time&&n.distance&&(this.options.method="distance",this.options.time&&delete this.options.time),n.time&&!n.distance&&(this.options.method="time",this.options.distance&&delete this.options.distance),this.options.method=this.options.method||"time",this.options.resource=n.resource||"bdtopo-valhalla",this.options.exclusions=n.exclusions||[],this.options.reverse=n.reverse||!1,this.options.srs=n.srs||"EPSG:4326",this.options.distanceUnit=n.distanceUnit||"m",this.options.timeUnit=n.timeUnit||"second",n.smoothing&&this.logger.warn("options.smoothing is DEPRECATED"),this.options.smoothing=!1,n.holes&&this.logger.warn("options.holes is DEPRECATED"),this.options.holes=!1,n.graph?(n.graph==="Voiture"&&(this.options.graph="car"),n.graph==="Pieton"&&(this.options.graph="pedestrian")):this.options.graph="car",this.options.constraints=[],n.constraints)if(Array.isArray(n.constraints))for(var e=0;e<n.constraints.length;e++)this.options.constraints.push(n.constraints[e]);else throw new Error(MessagesResources.getMessage("PARAM_TYPE","constraints"));var i={},s={},o={};if(n.exclusions&&n.exclusions.length!==0){this.logger.warn("options.exclusions is DEPRECATED !!");for(var l=0;l<n.exclusions.length;l++){if(typeof n.exclusions[l]=="string")n.exclusions[l]=n.exclusions[l].toLowerCase();else continue;n.exclusions[l]==="toll"&&(o.constraintType="banned",o.key="wayType",o.operator="=",o.value="autoroute",this.options.constraints.push(o)),n.exclusions[l]==="tunnel"&&(i.constraintType="banned",i.key="wayType",i.operator="=",i.value="tunnel",this.options.constraints.push(i)),n.exclusions[l]==="bridge"&&(s.constraintType="banned",s.key="wayType",s.operator="=",s.value="pont",this.options.constraints.push(s))}}if(this.options.outputFormat=typeof n.outputFormat=="string"?n.outputFormat.toLowerCase():"json",n.outputFormat&&n.outputFormat!=="json")throw new Error(MessagesResources.getMessage("PARAM_NOT_SUPPORT","outputFormat"));if(this.options.outputFormat="json",!this.options.serverUrl){var c=DefaultUrlService.ProcessIsoCurve.newUrl();if(!c)throw new Error("Url by default not found !");this.options.serverUrl=c,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}}ProcessIsoCurve.prototype=Object.create(CommonService.prototype,{});ProcessIsoCurve.prototype.constructor=ProcessIsoCurve;ProcessIsoCurve.prototype.buildRequest=function(n,e){try{var i=new ProcessIsoCurveRequest(this.options);if(!i.processRequestString())throw new Error(MessagesResources.getMessage("SERVICE_REQUEST_BUILD"));this.request=i.requestString}catch(s){n.call(this,new ErrorService(s.message));return}e.call(this,this.request)};ProcessIsoCurve.prototype.analyzeResponse=function(n,e){if(this.response){var i={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onSuccess:e,onError:n,scope:this};ProcessIsoCurveResponseFactory.build(i)}else n.call(this,new ErrorService(MessagesResources.getMessage("SERVICE_RESPONSE_EMPTY")))};var Services={getConfig:function(n){var e=new Config$1(n);e.call()},getAltitude:function(n){var e=new Alti(n);e.call()},geocode:function(n){var e=new Geocode(n);e.call()},reverseGeocode:function(n){var e=new ReverseGeocode$1(n);e.call()},autoComplete:function(n){var e=new AutoComplete(n);e.call()},route:function(n){var e=new Route$1(n);e.call()},isoCurve:function(n){var e=new ProcessIsoCurve(n);e.call()}};const servicesVersion=Pkg.version,servicesDate=Pkg.date;var Gp={};Gp.servicesVersion=servicesVersion;Gp.servicesDate=servicesDate;Gp.Protocols={};Gp.Protocols.XHR=XHR;Gp.Services=Services;Gp.Services.DefaultUrl=DefaultUrlService;Gp.Services.AltiResponse=AltiResponse;Gp.Services.Alti={};Gp.Services.Alti.Elevation=Elevation;Gp.Services.AutoCompleteResponse=AutoCompleteResponse;Gp.Services.AutoComplete={};Gp.Services.AutoComplete.SuggestedLocation=SuggestedLocation;Gp.Services.Config=Config$1;Gp.Services.IsoCurveResponse=ProcessIsoCurveResponse;Gp.Services.RouteResponse=RouteResponse;Gp.Services.Route={};Gp.Services.Route.RouteInstruction=RouteInstruction;Gp.Error=ErrorService;Gp.Helper=Helper$1;var LoggerByDefault={getLogger:function(n){if(typeof e>"u"){var e={};e.env={VERBOSE:!1}}e.env.VERBOSE?loglevelExports.enableAll():loglevelExports.disableAll();var i=n||"default";return loglevelExports.getLogger(i)},disableAll:function(){var n=loglevelExports.getLoggers();for(const e in n)Object.hasOwnProperty.call(n,e)&&n[e].disableAll()},enableAll:function(){var n=loglevelExports.getLoggers();for(const e in n)Object.hasOwnProperty.call(n,e)&&n[e].enableAll()}};window.Gp&&(window.Gp.Logger=LoggerByDefault);var ProxyUtils={proxifyUrl:function(n,e){var i=LoggerByDefault.getLogger("proxifyUrl");if(!e||!e.hasOwnProperty("proxyUrl")||e.proxyUrl===null||e.proxyUrl.trim().length===0)return n;if(e.noProxyDomains&&Array.isArray(e.noProxyDomains)&&e.noProxyDomains.length>0){for(var s in e.noProxyDomains)if(i.trace("[ProxyUtils] proxifyUrl : analyzing "+e.noProxyDomains[s]),n.indexOf(e.noProxyDomains[s])!==-1)return i.info("[ProxyUtils] proxifyUrl : "+n+" found in noProxyDomains list ("+e.noProxyDomains[s]+")."),n}return e.proxyUrl+encodeURIComponent(n)}},logger$F=LoggerByDefault.getLogger("GfiUtils"),Gfi={getLayerFormat:function(n){var e=typeof n.getType=="function"?n.getType():null,i=n.getSource();if(e){if(e==="VECTOR"||e==="VECTOR_TILE")return"vector";if(e==="TILE")return i.tileGrid?"wmts":"wms";if(e==="IMAGE")return"wms"}else{if(i instanceof TileWMS||i instanceof ImageWMS)return"wms";if(i instanceof WMTS$1)return"wmts";if(i instanceof VectorSource||i instanceof VectorTile)return"vector"}return"unknown"},displayInfo:function(n,e,i,s,o){if(logger$F.trace("[Gfi] : displayInfo..."),s||(s="text/html"),i!==null){var l=null,c=null,u=i;u=u.replace(/\n/g,""),u=u.replace(/(>)\s*(<)/g,"$1$2");var f=typeof window<"u"?window:null;if(typeof exports=="object"&&window===null){var g=require("@xmldom/xmldom").DOMParser;c=new g,l=c.parseFromString(u,s)}else if(f.DOMParser)c=new f.DOMParser,l=c.parseFromString(u,s);else if(f.ActiveXObject)l=new f.ActiveXObject("Microsoft.XMLDOM"),l.async=!1,l.loadXML(u);else return logger$F.log("Incompatible environment for DOM Parser !"),!1;var H=l.getElementsByTagName("body");if(H&&H.length===1&&!H[0].hasChildNodes())return!1;var Y=document.createElement("div");Y.className="gp-feature-info-div";var ee=document.createElement("button");ee.className="gp-styling-button closer",ee.onclick=function(){return n.featuresOverlay&&(n.removeOverlay(n.featuresOverlay),n.featuresOverlay=null),!1};var te=document.createElement("div");return te.className="gp-features-content-div",te.innerHTML=i,Y.appendChild(te),Y.appendChild(ee),n.featuresOverlay&&(n.removeOverlay(n.featuresOverlay),n.featuresOverlay=null),n.featuresOverlay=new Overlay({element:Y,autoPan:o.autoPan,autoPanAnimation:o.autoPanAnimation,autoPanMargin:o.autoPanMargin,positioning:"bottom-center",insertFirst:!1,stopEvent:!0}),n.addOverlay(n.featuresOverlay),n.featuresOverlay.setPosition(e),n.featuresOverlay.render(),!0}},features2html:function(n,e){var i=document.createElement("div");return e.forEach(function(s){var o=s.getProperties();if(o.hasOwnProperty("render"))i.insertAdjacentHTML("beforeend",o.render);else{if(o.hasOwnProperty("name")){var l=document.createElement("div");l.className="gp-att-name-div",l.insertAdjacentHTML("afterbegin",o.name),i.appendChild(l)}if(o.hasOwnProperty("description")){var c=document.createElement("div");c.className="gp-att-description-div",c.insertAdjacentHTML("afterbegin",o.description),i.appendChild(c)}var u=null,f=!1,g=null,H=null,Y=null,ee=["fill","fill-opacity","label-stroke","stroke","stroke-opacity","stroke-width","marker-symbol","marker-color","marker-size","geometry","value","name","description","styleUrl","extensionsNode_","icon"];for(u in o)if(o[u]!==void 0&&ee.indexOf(u)===-1){f||(g=document.createElement("div"),g.className="gp-att-others-div",H=document.createElement("ul"),f=!0),Y=document.createElement("li");var te=document.createElement("span");te.className="gp-attname-others-span",te.appendChild(document.createTextNode(u+" : ")),Y.appendChild(te),Y.appendChild(document.createTextNode(o[u])),H.appendChild(Y)}H&&(g.appendChild(H),i.appendChild(g))}},n),i.hasChildNodes()||(i=null),i},layerGetFeatureAtCoordinates:function(n,e,i){var s=n.getPixelFromCoordinate(i);return n.hasFeatureAtPixel(s,function(o){return o===e})},displayVectorFeatureInfo:function(n,e,i,s){var o=n.getPixelFromCoordinate(e),l=[];if(n.forEachFeatureAtPixel(o,function(u,f){(!i||i.indexOf(f)>-1)&&l.push(u)}),l.length===0)return!1;var c=this.features2html(n,l);return c===null?!1:(this.displayInfo(n,e,c.innerHTML,"text/html",s),!0)},displayFeatureInfo:function(n,e,i,s,o){for(var l={},c=0;c<i.length;c++){var u=i[c],f=u.obj.getZIndex();l[f]||(l[f]=[]),l[f].push(u)}var g=[],H=Object.keys(l);H.sort(function(st,ot){return ot-st});for(var Y=0;Y<H.length;Y++)for(var ee=H[Y],te=0;te<l[ee].length;++te){var ne=l[ee][te].obj,Ye=l[ee][te].infoFormat||"text/html",xe=!0;if(ne.minResolution&&ne.minResolution>n.getResolution()&&(xe=!1),xe&&ne.maxResolution&&ne.maxResolution<n.getResolution()&&(xe=!1),ne.getVisible()&&xe){var tt=this.getLayerFormat(ne);if(tt==="vector"){this.layerGetFeatureAtCoordinates(n,ne,e)&&g.push({format:tt,scope:this,coordinate:e});continue}else if(tt!=="wms"&&tt!=="wmts"){logger$F.log("[ERROR] DisplayFeatureInfo - layer format '"+tt+"' not allowed");continue}var et=n.getView().getResolution(),it=null;tt==="wmts"?it=ne.getSource().getFeatureInfoUrl.call(ne.getSource(),e,et,n.getView().getProjection(),{INFOFORMAT:Ye}):it=ne.getSource().getFeatureInfoUrl.call(ne.getSource(),e,et,n.getView().getProjection(),{INFO_FORMAT:Ye}),g.push({format:Ye,url:ProxyUtils.proxifyUrl(it,s),scope:this,coordinate:e})}}var rt=null;function nt(st,ot,ut){if(st.length===0)return;var ht=0;function dt(pt){ht++,pt||ht===st.length?ut():ot(st[ht],dt)}ot(st[0],dt)}var at=this;nt(g,function(st,ot){if(st.format==="vector"){if(!rt){rt=[];for(var ut=0;ut<H.length;ut++)for(var ht=H[ut],dt=0;dt<l[ht].length;++dt)rt.push(l[ht][dt].obj)}ot(st.scope.displayVectorFeatureInfo(n,st.coordinate,rt,o))}else Gp.Protocols.XHR.call({url:st.url,method:"GET",scope:st.scope,onResponse:function(pt){var yt=!1;(pt.trim().length===0||pt.indexOf("ServiceExceptionReport")!==-1||pt.indexOf("java.lang.NullPointerException")!==-1||pt.indexOf("java.lang.OutOfMemoryError")!==-1||pt.indexOf("not queryable")!==-1)&&(yt=!0);var mt=!yt&&at.displayInfo(n,st.coordinate,pt,"text/html",o);ot(mt)},onFailure:function(pt){logger$F.log(pt),ot(!1)}})},function(){logger$F.trace("Finish sync to GFI !")})},getPosition:function(n,e){if(n.coordinate)return n.coordinate;var i=[0,0];if(n.offsetX||n.offsetY)i[0]=n.offsetX,i[1]=n.offsetY;else if(n.pointerType==="touch"){var s=n.pointers[0];i[0]=s.pageX,i[1]=s.pageY}var o=e.getCoordinateFromPixel(i);return o},onDisplayFeatureInfo:function(n,e){if(e.isActive()){logger$F.trace(n);var i=e.getMap();if(n.type==="contextmenu"||n.type==="dblclick")n.preventDefault();else if(n.type==="singleclick"){for(var s=i.getInteractions().getArray(),o=0;o<s.length;o++)if(s[o].getActive()&&(s[o]instanceof Select||s[o]instanceof Modify||s[o]instanceof Draw))return}var l={};e._proxyUrl&&(l.proxyUrl=e._proxyUrl),e._noProxyDomains&&(l.noProxyDomains=e._noProxyDomains);var c={};e._autoPan&&(c.autoPan=e._autoPan),e._autoPanAnimation&&(c.autoPanAnimation=e._autoPanAnimation),e._autoPanMargin&&(c.autoPanMargin=e._autoPanMargin);for(var u=[],f=0;f<e._layers.length;++f){var g=e._layers[f].event?e._layers[f].event:e._defaultEvent;if(g===n.type){var H=u.push(e._layers[f])-1;u[H].infoFormat||(u[H].infoFormat=e._defaultInfoFormat)}}var Y=this.getPosition(n,i);this.displayFeatureInfo(i,Y,u,l,c)}}};window.ol&&(window.ol.gp?window.ol.gp.GfiUtils=Gfi:window.ol.gp={GfiUtils:Gfi});class Control extends BaseObject{constructor(e){super();const i=e.element;i&&!e.target&&!i.style.pointerEvents&&(i.style.pointerEvents="auto"),this.element=i||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){var e;(e=this.element)==null||e.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(e){var i;this.map_&&((i=this.element)==null||i.remove());for(let s=0,o=this.listenerKeys.length;s<o;++s)unlistenByKey(this.listenerKeys[s]);if(this.listenerKeys.length=0,this.map_=e,e){const s=this.target_??e.getOverlayContainerStopEvent();this.element&&s.appendChild(this.element),this.render!==VOID&&this.listenerKeys.push(listen(e,MapEventType.POSTRENDER,this.render,this)),e.render()}}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}var Helper={detectSupport:function(){var n=!0,e=window.navigator.userAgent.toLowerCase();return(e.indexOf("iphone")!==-1||e.indexOf("ipod")!==-1||e.indexOf("ipad")!==-1||e.indexOf("android")!==-1||e.indexOf("mobile")!==-1||e.indexOf("blackberry")!==-1||e.indexOf("tablet")!==-1||e.indexOf("phone")!==-1||e.indexOf("touch")!==-1)&&(n=!1),(e.indexOf("msie")!==-1||e.indexOf("trident")!==-1)&&(n=!0),n},assign:function(n,e){n=n||{};for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);return n},mergeParams:function(n,e,i){if(!(typeof n>"u"||typeof e>"u")){typeof i>"u"&&(i=!0);for(var s in e)e.hasOwnProperty(s)&&(typeof e[s]=="object"?n.hasOwnProperty(s)?this.mergeParams(n[s],e[s],i):n[s]=e[s]:n.hasOwnProperty(s)?i&&(n[s]=e[s]):n[s]=e[s])}}},logger$E=LoggerByDefault.getLogger("interactions"),Interactions={_extensions:["Measures","ElevationPath","Drawing"],_options:{current:null,clean:null},unset:function(n,e){logger$E.trace("unset()");var i={};Helper.mergeParams(i,this._options),Helper.mergeParams(i,e);for(var s=n.getInteractions().getArray(),o=0;o<s.length;o++)if(s[o].getActive()&&(s[o]instanceof Draw||s[o]instanceof Select||s[o]instanceof Modify)){var l=s[o].getProperties(),c=l.name;if(typeof c<"u"&&this._extensions.indexOf(c)>-1){if(i.current&&i.current===c)continue;s[o].setActive(!1);var u=l.source;if(typeof u<"u"&&u instanceof Control){for(var f in i)if(i.hasOwnProperty(f)){if(f==="current")continue;if(typeof u[f]=="function"){var g=Array.isArray(i[f])?i[f]:[i[f]];u[f].apply(u,g)}}}}else s[o].setActive(!1)}}},Marker={lightOrange:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAgCAYAAAC/40AfAAASf3pUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHjapZpptuO4DYX/cxVZAsEBIJfD8ZzsIMvPB8mvpq5OupN6Xc8uW5Yo4OIOdIfzr3/e8A/+lNo1lGpNu2rkT+mlp8GTFt8/4/ktsTy/nz85f96Tn18P6fN6TLzkB30ObPo5/ut1+XaC92HwrP5worY+b8yf3+jlc/72y4k+F8q+Il/F/pyof06U0/uGfE4w3tuK2pv9eAvzvI/7607a+zf4r/tVE3sffv13Maq3K9fJKZ0sOfL7U6ycsv/NIQ+eVH6nXDhQsj3P31fssxIK8rs6ffvTWdH1pZbfHvRTV749+6Vbnwpwa790q6TPIfmXIuu3x9++HqT+vitP6X+4cmmfZ+nn10eVz4p+qf5T/Lvbfe6ZuxhFKbV+burrFp9nHDe5hF+6BZamdEfBUOPRfzo/jZtfQGHHFSc/S7ok2nWlyJYhV87zuGSxxJJOSMaTlFbKz4stW+ppZe9f8R+5yXLPOze6uJ62l5y+rUWey/a4wnO1xpW3cGgSTiZ85G//hL/7gXt9FES8luOtFetKyYvNMrxz/pvD6IjcT1HrU+Cvn1//eF8zHaxeZR+Rzqnne4r5NvPFVn4anTmw8vjOoNj+nIAScenKYiTTAbomuYpKtJRMhEI2GjRYus/MpANSa9osMpWcld605JfmIybPoakmXg68DpnRiZqVOWt0aNCsUir4sdLA0Ki5llqrVqut9jo0a9GqqqZOisOylWDV1MyadRstt9Jq02attd5GTz1DmhBpt95672NwzcGZB58eHDDGTDPPMmuYOm222edYwGeVVZcuW231NXbaecMfW7fttvseRw5QOuXUo8dOO/2MC9RuDrfcevXabbff8a1rn7b+4edvdE0+XUtPp/xA+9Y1XjX7OoU4nVTvGQ1LoQgdN28BgE7es9iklOSd857FDv3lmlhk9Z5t8Y7RwXIk1StfvQvp7ah37v/qW7DyU9/S/9q54K37m537Y99+17XtJLyejr1T6EWNmenjmJEa/zGtf3wMnycdEnrmgScKh+W2rFIB58FVtiU7CVaLdS1hHXPoPkvVW5b2oXDBZM5kyN7VVS1pzsLdAoljo1+6tE5b+ciweuqaTNwEgrpb3atwvSOzw3Aa7Git98o4VD3nq3Nz/50yiEw9MXMCh+hOfU+a3euZl0IjZX1tW/VQIF0lHO5kjFqF2hvlvCOvrEi+yhlzzHKu6fCXapZzFpUqw+TMUoU1TrM8K8eEt2CcvwpvlcXjErqqEPqJVIoz1cQ7CdQOB0qqW1QrkrCsK6Afva0R7pobdpd7pG47/Z7UpwDkCm4ql9Y8G2Oi4+S0rJ3LiVdtruM9Jb1Ja6ESIbdenfb7pXSsmRIcyTStcG9xoGh7gbLD1W/ra462dTTubFKUsWyMLTThhmZUszvGdgZEZizn7D1Pvb3VmlkuoOsHSOIrxmpt0EbpgB81ynTMBlDt4TB1Vq5U0EsVt3mfgfWpNiTznwumVxaPWHprbym/Svr9MfzZG/QkgrS9IGdlYQ6i4zdpbQ/m9sbCKqv0ZKwrI5D8c+V9b9uzAIzM/Z4lm07xdl/X4aOlTekLNI+orHQcAKRJpdnQM8CoBLRYV9plleJl8yJpa3OPe+a+2ljD2pnF7GnxzrzWZijn2Ke3SytrYTJHl3CK9lQgFlNNC3tc+vJx88VLOxAB9avWjwIU0L+9m61oK7lrkrd4DEFof16knx/5sM6pOzqQ89r9dFase7a2kvXApdQOnAIH5T1mG+BM+ikt1QrNMltZKx0fC2XliVbK2enAuDk5P93TQXSY4nS4IchETYYPGGuNXfPJe8dboIixZ13bJ3mSES4KnZel1RgaaOZA8OcESKbuDaQOmjUXww93t1szsyHSFGynylw7HKfe096ywI75p6qE/1AWLgx4tMx14z2j6kyisec64EDuBCwwy/Hkm8cNzHK6iw7YiNbnVQpjdjOH0neUT9rCo7fozG2DjiOBKQKQC/0ivclYZtIwF7fDPLR2xsKkM0cZc3h3ubjIPgBmOYr3S+fTa5Zz1mfVLToJjbVH2GgN1DhKaQuluyAVe7PRRMRsWBqIgqYBoNC+NuDliY1RKG/iF5V5dztbGlQLAybsk82qaE3fzPS1zo1n5ygmKC4wsUvbiNBGerilBnJoSE4DG6x13BXWzXBv4vYFstG1VoOoC6oGPXX/UIRoN9Ib52D6Juin06jZss0ksVys5ZihjGxtMgDdLmq0EzXjzAC3GYCBXfJmwiQVEFzdurMKcZKkpyctqt0wSD0I04f4UnjXutEEdDzPuPOKKFPiKejaATr81NlRGzDe3HRwNPkVbr8UG4ZhJjM8BolsXMthNArGnMEfadoZhuRvosTdXPLOb6A0JOrIp3/hv06r4ESq1wpWZVzvZn6y/7vgYoE/RL0HgLxUNSFWB62gtiN2hhEcIbWpICkUOvvAoA/4gwScv+C0v8MJXQ+Nhqg1bgvZyqdP8vWsKBV8RUCGpsq1Orzz87Z547iFBkQcRUQrWKA86w2AavJxAguRhd6xoAOTYog6816YrroLXcGYxwUwoyFHxbtxwRY8c6zO2TQAYZkL53DIRQdBfHU1oxhJNzYpyVhcSYrFDSNPjwSTWZx0C7pf0DkOS8j9rA2q42RUpIpREda6Y4OVDMScySKSXydzjIPsENagrkkhcCt4BqZhB/N2onoPdi7ctdN3/3Qrd4qgPo8DCaYdnU9QE0W7h/vF5XGz3/AdFCBL/iqDfzDxQUSMGzfioPgJEvYDInjPyQaugchuEgbt4iCQY5ZDnwpnKTiqgj3mLhg1NCq+QwLyYPY43chRPVrq0WriYlciCNXr9VZ3eICCMIBS4nhvGEAIw0qEhaAkDex6p7qYKmQHB1AbnfAkxigx1QyOzGYXWYL/CubfGEbWGIDhxA3eiL9PpQDHRUgAbReX0ZAINyI0tQyUgcVzKFiDBOCFjXMlQ6QIYkMb7saZZliZxQwEHn7o2G6Dw8gKBXCjW9HZ5/SKXUR+OGGzMloZaAvkmmvAMyBcC4kU4YA7WToAmhlidyGKa0VSxUljYxnPcmeRgXsRbqRzbRBckHloBPPrw4Zr9/nkeMzb5VrMpFf9AdVcbrK+uoGUwtqrX/d3dJMJxvohLt7qvV04IsR7p1zM26eJ1/k1x//g+d/H8D4BAfSL+aSxxKRFa8VwUdeY6QURKy/NDAFrToKxoZTYfM331eZeAgxflY4XBZ69YaDqBP0056yGHyqnI9Rm+K1p4rSSFV9wIQGusB4PwEsdXUP9DnZtZ94jN0xuBSPBvXtoV2+0IasUFkXDKp3lXoDfe5DX9kLTOsqO9cOHgM9dqcdiEIusVMgFQy508wSbpxADbn2mkuCEx6EsXBGIAZaI1QujONgyMWaU1cti1qaQEDl1Vj7vsZFkI2m+A1t7/N49QJhK5OIUe/mWkE5sXwYa+J+lLKYCuDVajRjq3pAsYg3SQnkfQcb5LTz7xuPjv3k+dmCWUDi39Gl2ps4dXcYVJ+59d99wRJHQ9LtAD2XCRjYYkN8YUkIsrfFM5Bua5BDFyIKdxluACNO7zFkGegGi99np8n9j/ehWp2oYY4SOQWj9XHz1WcHWQL0BTYasCIpgkjyEg2C5TjD10bCGFz/PM8b5+O4Qk/m+Q5382uG5+CN3633jvfzjO4W5+TohQ8+pxIiNEfMI6VGFDe3Vd7VByDt4j0ebGrIEM2FxoZRLB0ld8XEkKBgMwyDC7QsJysobUBnjBgjRwxnsynv/tfjqx2VNJC2GPT4rjSDBV4jDl/3nVG6B+hHJ/bY9TyerWAXsIZHtzugCQWRAOXCVZl5Xxtv3fWErmHaDtJp8l2EikIXuKSylj/uCveU2fazmTH53yCEnm+KTd2E8hu4qTrIvHDJGlUkZS4IXFcPl7A8fAbrNqGf3Qh0xQTZ0SOsbIwDBLK/x9DWhsopPIiRsgHCMYjfP9wzMjbM37G0lr8B9aaI3NOogBL6Xs2HMOSH289KUQKo/Buvw+9qVTK6UUwqBuBPJFVPro5AfXk+Hn4zJjMj3RBR5J8BC2PqEG63CIG16OTfx+pr5fu30UWcS0DFuDuKHtdFjnLuM6psYkD2+oF5CjVvhS0CnoHwa/WNusfqXim5qQpjM1ZuFIjyYKi4vxKw4DZoiVeu6o4ZKaXzoURuq4nOHt6Fa9ATnU7ncxo7g6UE+0kYg8fExDzwLcq3ErIGXRo5wH+cRiu336mjg3/3hG2IT6ohLvVXuTCXB0dhTZ+++gRgyV/xAITch2WCqEVVrzPAxLgXRI1voOfSbmnM3/CXgYh8rPhxfDFL225b2jePCd7J7H2GzAwgjZgFyJj8SfsUItFBpFvCwUUQDA4ArY0Ch61SNvFZ8rw4vVhHyw5p9f3bEFDt1PjrID05RjBzVgqbJUJXSLARoRkQCNSZf5olAkobc12LqI73yrQJsCI4mLYS/rubukwKjPDlOFkPFgSrnRyNwuAcbiRm94aPI9zdmLUkujYQqcYLjaGRIFnZ9jYRcLJlv/hX30BiQgE6j5A+dU2RwwDKwGdzTAYnH2f2ctN0O7I1HTtBURMBcroAlYgjM8GYBFvPdA+imolWmjWHi4gzYfRqHKRuMrUQIsUDygBhBxs1jo+CJ/IRoNDEAuvemMJCC/Xg00L/U+v7I1Ly3qnhB/Jnv36SmOB4fM0A35hihOAcqHpM4x/zAdUx8e02G/BVzGxEpEBsqKathzVgltlb3EfNtLcNVGPPt0TpvbA+eMs3SfMcK04ln8fXDhgIiSOwUm4lj8jugXZhmRg6AHMb9gijciwnTDnNhKBXDI9m3iD38ciZ0YLpbxWho2ISpAY66Q2ZZgwv9YyzHM2QkASaOBrCM9OP4q+8xXnvSaycEuDbB4cHeJeEM08EstvvA765nu7r4RjF5YxNiO742DawE9XUMghITWK87c1sOWHBLFCdbxFqYR1wcoI8cBOX6jFuFBLCGvrO4QGX1bQxLMyX1IOX6X7bSfq7geCNzFbDeFfsL4sAm9acvxwtCFjQCGbaQ5SXYzrfVaxzOdTr6hCG35oVdOc2NjGrlX48wehxksic+UH1zZFGbgTZ0K7g4w03xafwEKo3qmAT1ovmmWMLjkxQfaNJsfbCSfP/Bjam3D72Oor77aumCQix5g05JlNJPOM40mKCcXes2BgAqwbwjX9C6YD5GLvF1Btsafh9ONbfSezJDaSKHSLBCtccxqI9oQpBKdPOW8ElM6cLAUEp480Jj9F8ZWZlutjwrw34IF3Ru/nXGEPVdmdKGfy3h2xPSckwZ++JVZyTNxYgPu4Xr7t9dEwC884PvdGPaUoDyS8JT24R1WOfECBGsahPUmDtm+cTW6WDpaAjUzlyS1kncYJEIDAiZyxN0E5/siGdvg+9mUv9KxWpkpJZHQvPvaxZnxBcgaAiXh+X94PwInyIy3xvwy/LG3eRYB/K+3Rv/0tbkr5t1/t2Cf/2ywR63xthCV3sBUwghIvm+R2nAiiQx9m1ALsHxHN59A48pBKgBad+otn9vQ+k4H3eDprO46VGMaI8i2WtEMWRIDaGfMTZn+VEuSgW8+gwAObmZIcwd38EfjH/1vT7fEMfSUMtuvYNP3y02Lp8384OnnB5SE3yl2JVLXkupN8SeLMR0edpWPOdiYAzEoLsnU06ADN0M4jS0g3qw/pl6ie/3qbB8IAwhZKSSWdYi2UeyRcdX7oYRIJHqRg3ohnS35cvNC0hB48rizpKbfgIpJ4K8UTXsMyPJS8f3molSYALLgj3yJXXfIQUczfMrnTGm9vXmbqT9Cxm1gL0Av0xdB/GsoGePVRtqwDiU7NkOC5OoSHUj2313k5QM26h2luk7Bj3ZCNe/pU0Qy4KK4CUIssMEE7uGyWV2uHjb+uw+wh8kX2daUJevGzUyICdt1kJizKnhNN9fJdvgDiNkP/wLw3jTrngRHBUjR54lJbBuOeAjo47O6yybKKQ1+BYN9E7SdXSh7kg7fhkCp+XcFTAgpvpIdDeDnincsPl3LFAaQHpywRwhptNoKXGKHlun1+/eKorKDU6M+vPdy4TRM3hBqOByFyqMtsOze740DPsC8pAEAoG/Lv5/CMA8eARSjpFJ/D3fpm7bv13y/1/gYgKdVn1LkvDNrMDBe5OOZLrnE6TOLjSDqjEAmIBNMzyKH+RuFd8whbrQq0Eg9sSGkBz/Ho6Yxe0G6mANNHo8de/ikteZX99WyNEZrVJf5T6opO+8RJLMjhgqGLMdsOXbSlqCutkhdPhvUMPc/H7Tgqm9nnHDvwF6YngoNZcUVAAAAYRpQ0NQSUNDIHByb2ZpbGUAAHicfZE9SMNAHMVfU0tFKh3sUMUhQ3WyICriqFUoQoVSK7TqYHLpFzRpSFJcHAXXgoMfi1UHF2ddHVwFQfADxNXFSdFFSvxfUmgR48FxP97de9y9A4RmlalmzzigapaRSSbEXH5VDL4igCjCGERIYqY+l06n4Dm+7uHj612cZ3mf+3P0KwWTAT6ReJbphkW8QTy9aemc94kjrCwpxOfEYwZdkPiR67LLb5xLDgs8M2JkM/PEEWKx1MVyF7OyoRJPEccUVaN8IeeywnmLs1qts/Y9+QtDBW1lmes0h5HEIpaQhggZdVRQhYU4rRopJjK0n/DwDzn+NLlkclXAyLGAGlRIjh/8D353axYnJ9ykUAIIvNj2xwgQ3AVaDdv+Prbt1gngfwautI6/1gRmPklvdLTYERDeBi6uO5q8B1zuANEnXTIkR/LTFIpF4P2MvikPDNwCfWtub+19nD4AWeoqdQMcHAKjJcpe93h3b3dv/55p9/cDPGdykYtTXU4AAA0aaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA0LjQuMC1FeGl2MiI+CiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICB4bWxuczpHSU1QPSJodHRwOi8vd3d3LmdpbXAub3JnL3htcC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgeG1wTU06RG9jdW1lbnRJRD0iZ2ltcDpkb2NpZDpnaW1wOjkyYWVkNjM2LWY3MDMtNDAzOC1hNzM4LWZiYzYxYzZlMTljNCIKICAgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5NWMzZWI3NC0zYWRmLTRkYzUtOWZjZS1iODQ4NTc3Nzg4ODQiCiAgIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo0NjI3ZDg3NC1lZDIyLTRiZTUtYTlkNS00NDlmMzVhZDIxYzgiCiAgIGRjOkZvcm1hdD0iaW1hZ2UvcG5nIgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJMaW51eCIKICAgR0lNUDpUaW1lU3RhbXA9IjE2ODQ5NDE5Mjc4OTUzMDYiCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4zMCIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgeG1wOkNyZWF0b3JUb29sPSJHSU1QIDIuMTAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDphM2U3ZWQ1MS0xNTI4LTRhYjAtODVjOS0zNzNkNzgxZGM2ZmMiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoTGludXgpIgogICAgICBzdEV2dDp3aGVuPSIyMDIzLTA1LTI0VDE3OjI1OjI3KzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PofUkY4AAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAADdcAAA3XAUIom3gAAAAHdElNRQfnBRgPGRuA4VZTAAAFcElEQVRYw82YW2xbVRaGv7XP8bHjXByHQkNhWigdVX1AikRBMBoQ8wASl4fRqPDAAxIPKAVxeRqQRohHBEVCaoGKUBCl4qHcNKCZVKMRRQxtgTaACLRKqlwB14NzM2ni2D2XvXjgBFXQOnFiA1uy/HB89u9/7bX+vf4l1HnpK57hTNCE0AzqAS5gAAuEID5KiWSiLPf4tp7YUjcSu4yLZzdi2IJyNXANcBlwAdAKzAHTwDhwDKEPywC+GZWHbPi7IKOvZIWguAnlr8BtwJ+AxDJeDYCPgF6Ed0hkh+Weov5mZLTHJMDeBjwYk0itYJtKTOpZML3SbYNfnYz2SBr0buARYENcFytdFvga2AGyT7p14Vcjoz3ShOgdKDuAi+pUewpMIDyCypvSreWGk9HdroOEV2F4A1hfTxGJCX2D5U7U/UzuD6NaXq49NRJhBsOjwMVLEtE4gaL4W5cV3IsxPEoizDT0ZLTHcSH6M/BWLLlVwpQKuPzhb+i8sRkv04Y/e5rvPigxtnM9trKU2k0D28A5LN3RsmXbrbFOU8DtQLpqfJqu97nh6TydmzvwWpOI8VDbxqbrkmz62yk+/Ps6yoe8KkeV/hHHfgrMNyrNEkBX1SAktgRs3T7ApV1rSWayiEkDLmLSJDNZLu1ay9btAyS2BEsEuWuZ99WKyRhgHeCcn8wGw/qbOnAS3jmfOwmP9Td1kNhQDduJcUwjyciS0RJXMMkWkPPUo/z4XFxZRhZII8mEwFCsT+f5xXTE7FAOteduItVaZodyhNPVZDeKccJGkxmsChIMOvTt6aRSzIP+7A9rRKWYp29PJ8GgsyqcVauZSADaj+IDTecWvBlD4e01HKjM07XtOOuuy+A2X0BYmib/8SxfvLWRYm8LdqZaCvkI/SDBci6nld0ze7KCLa4F3gSurR4MB5x1FnMhiCeor9hJiPKmWpbGp3EU2IbJFuTe5XfStbczLxgP7K0IPcCFDWhnJoFuMAek2/oNbWdku/WxHATejT1JPZcPvINysFYiK+gAFkXTK6H+MyhXADeseJ9fmrVDM6X080/+p1M2/yFsD1zjEIauEeMAqNpQE16oaKiqwfjYeLk+fuYl10HDq7DsBTavxs8o6FzFKez/dM3rLx9LjUyVxcb7yVkfzmpXFbACJURHIxgyxkyu1ml6qL0Z4YX4xl7Jfrrgm9Ov9bX/e++x1tHCgkQ11lgELGA4sBp3iHRbH5GDwJPAFLXo6KJnDmTh/aG2w2/3t47VSGQxs1zAE9U2s9pEjx3hXuBloCa7G1rxv8o3f/7SkUz/UFFWMqGRWMpHAqsDbl00KGotIXM7MawF7gKSS5oJJRospI7v+rD96Ikp8aV2EgrkVPW4OnIy6SVL9ZubvZgyaOVyYDfwl2oNqVWiXNEb231oTe+/BrzvK9Gy01MFyoiOKzIEmqsEfjGf/39U1yHgosJFUXhlFMl+z9E/nkvhVNHZsjux+9Caf77RnyzMBaJLmW4RrWAlB3Y4Uh13HLOA4wQjo6O2IRPNxVV4JuG5Et2SSelzjtFLzsZQ0NIZ8/2rx7K9+/paxqbKvyh4Bc4AFQxzau23Dow7FS+nHmfEUz05OqINH8+evXJPJVOuE93XkY4eSziaXcQpB2b+vZNt7+/8IPPl2OxPRMJ4dDsLzIho3hpzamJ6aqJ0ei6qtZAasmZ2OS1RyOMd6egBIzSFVoKj4y1Hnvhv+8cD02ZOkEmgIKITVnXKWDs1ksvNrgbTbRSZ46cypY50aWcllIsyKXvr8GTyi9f6WvePFGVQhO8EPW2NzI+OfV2pF2bDTgbg8D/aJeVUspd1BK3/G24u7/skO3+iYP3h3LdhI/B+AGodUpo8WKwoAAAAAElFTkSuQmCC",darkOrange:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAgCAYAAAC/40AfAAAStXpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHjapZpplmO5boT/cxVeAkeQWA4H8BzvwMv3B0pV7qou26/tyk5JeXXFAQgEIqgO9h//fsO/8a/2KKG2PkRFIv+qVs2TFyN+/s33mGJ9j+9fKd/30q/XQ/5ej5lLftP3xiHf+39cTz8H+DxNXrW/DDT294316xtav+OP3wb6TlR8Rb6K8x1IvwOV/HkjfQeYn21F0dH/uoVln+fzYyfj8xv84f6ISf88/f537UTvNOYpOVtJJfL4DVbJxX9LKJMXjcdcKjem0t/r9q7/2BIB+VOcfv5TVnR9qfWPN/2SlZ+vfsvWNwJs7bds1fy9pfwWZPn5/MfrIbU/Z+WF/i8z1/F9lX+9nkpKnxX9Fv0X/HvGfXtmF7MKoZbvpn5s8b3ivsUUPvUILE3IjoChwbP/KD+DzW+gcOKOi5+dNGXSdVNNJ810k73nnTZLrNlC7rzIeefyLo7Ss+ZdPH/Vf9LNvWg5ZZDL/dJeS/65lvSm1bjDm20w80ncmhODJT7yj3/CP/3AvV4KBHi81KdPfnP2YLMMz5w/chsZSfcb1PYC/OPn93+e10IGm0fZS0QZen2GWC39FxOUl+jCjY3nTw2mfr4DECKmbiwGBNRE1lJpSVLsOfeUCOQgQZOle80sMpBay4dF5lqKkJuRfWo+0tO7NbfM5cB1yIxMtCLU2SBDk2TV2sBPrwMMzVZaba1J6200bVOKVGki0sVJcfbSa+itS+99dO1zlFFHGzL6GEPH1KwF0mwq2nWo6pzMORl58unJDXOuvMqqq4Ulq6+xdM0NfHbdbcvue2zd8+RTDvxx5PQzjp5pyYCSVWsm1m2Y2rxA7ZZw621Xbr/j6p0/s/ZN699+/kHW0jdr+WXKb+w/s8bV3n8MkZxOmueMhOVQExnvngIAnT1ncaRas2fOcxYV+ists8jmOTvJM0YGq6XcbvqRu5A/GfXM/b/yFnr9JW/5/5q54Kn7h5n7e97+lLXjJLxfxj5V+BiwUH3cM/PgP6r178/h+2IWNXr3IZDKnG1YHtrtFtaVWu1ilevx7tYtr7VXOy3nSum0NHSeHSC4lcbIFUozk32J9iFdrXthMcaFq0z0Wlp6+qg7HfZer+Z0+zpjlQ5fRmKkS8fOua1j1CP7llovW7E816hHdHtUrZ5+oz0IDLDFuIMOT2Rma2CHreke6c5TYFqCY9puXmPuPRcL6KvoarLOvlBpNrRL37lJbySs733aav2UesPNIHA2O7WlZr3tW+ML4QSvXKsuLPpsgL0u/mbyXnZpdPGZjOttnz2khypsW2Jt5Fozqdl8qnedcofdunR20BHbANt15T1WAltjrZ53p6nfQqC6rqBWe6l0nMIi9+69RD0LYHu7WZT7SBuQzttKZNQmaIJGvHZZtrsC2T07siMATFvb7ja2C4/eLpMY6Y3jssO25l3SrxyZyBE7R4kTA+Zia60CIJVPnhkqFFtZ7lbmX7OMuH2OHEEBv42VEN66HZf+st21L32sSZIpaVIuvZie0Ge0B9BFHxzfMMd/8DzkZjNwFFdW4zWFApTWlpP3vCOzxUm1FWKkBtHMW+zI2iReZFFt7DcKsCld21qB8OQjdRDXQhXmKB1CEcC+q2c0bT7SjLbfG228GPk7hRnhmQNmEQOdQj6htHgI3AZ5KV/KSy5Qvz4ukCY1hWWM0YhnSa3Uk9dmzdAdoeYHkiPXuQbNHUoZk0+U1KEXyZnw7UUCFyAmnmlQI1tjE1u3fEp+abX5p+r/Iz2QS1Kc9umzQg1lt3Lhw1NuHXclsLDiGHcfUBnKZe/sIx0kz6JICFA+2cTpDpqVDFCytG0wMyxRxibwdjZ7Il4ytbdVoBED6TSBNCbLX7lBnKTOUXZxF2o2nAngN2KboX6uU13NKlAVjWsOwqVSAwGjKo22ARgudUtcr3jbr7JqqgS73qGbknEAGrMVbrKz7oxe06mx+Z3Ct8DT//JMvxjD+NC4EX461F1OUiEZ9Fo6PQak4+Q9cFXp/RXYwfqdetl701wUChFKMN42b+9HHuVV8vC2TBo2vXVGDSCqz6sQl2sSK9HIcSu0Boa7ZhMwb2bxhfVtCl19V/kBwlpSpmxq7XRkqEtPSbqTM/gr6VupkEZLO4fWYHXTxiKN58CCXNsCME6+O0Pc7LgEgroA87HqGzRqHg7g1iwoZdilXwZ1KQgjzcFdjZZAWs+iOv16vVkgmkBYdJF2PuA6s/DJnibdlxZzJwDhCu6LAGRQmeH6TpWowl4bxmBRWhagC2iAc05T0HOmEgY2Au9Qj3bpoMwJCCe7bsTXYPTvhMNbNy35wNACBQfebVUHW6cb07j9jtu4NhM6gGYFw2/BSEz7shWMncc+X1RAvc6jEiaCB4r2pC2MMTlBMZVELQMZ8sm87CGvc2yZLlbHzL5AGkM370hIm3UtpL4vKf2U9EEeSP1X6XGmaf1u5kU+BYRD0+6xqOhky2zr/PWGv79/S1EEBfVpo592XV3EGVjeB2AddoXuX/mwwVzp5WiI5K2oRm6nfGNeDSKS00DeGClvsFMQXpYCssEzwwNTL5wNayGwm/Z/EJA80jz7ukpsB3THWulMHV13IAfym+m+VAleRFOX4kRD6SEbCCQl4mKfAWCOJhC9AtoeUZMtbl7SD8aBayBoffyKhlwj0/zovihoCM2J6cwrkAYIoUEAvaO8n82lBUATNBjkBuFAz2jX69Gii1xgw/YFTl9mr6KFjXbxEih0lDTYKeQDaGlYWEA21FAdcME9yQnMc3hDivcvCX9w+QmbsVAVDI0MBeQQnLNu/lxhFsL3+SBgK+Gf4ebcDyzS32AR/jFu+gc3v8IG6fcDNwhHF3qHHr2JKxWOxa4GvSBc5MDZFQxAfgK1S3NJHLvz9aTBQRjBdTjkIZooUtwD+YcX9bWmaXD04mOOlQcfkghzo2hSvcz6GCkT/9bCKBEhhWrfyE6KFNm7EVoFtQCBILKAYro1Ge9EBFtVWGDZhCwaHNAQyAnJH8MtiKZVBxYBAYpEVEJZkQkoCMNQb2xFRX4AJ8iqpu7AqLZ9YXR/yB6mA/BBYR6iTfPcvZZ4yvTwcA3VjiY/9MkL6fVUNBu690BZQJXyQOShufFPKAW2dg6qJaPqaRfwIi2p+/pxEpdcokQK3RHJqILUAfKsNV1uRStfGq4e8Or4COhH4vE/IvJ3PCqY/hWNgDH8y2hcU3c+NAb0VY2If0FNd5zlrVtbph0h75BRgNL7LH/ePtT7LAouIZ6E5v/6rFs9Yo8NQaluBzGOrKGMHVkrFJe+bVOGy7B/GAhBBjJg75Wx8G/e6RgXkjmsCy14jXxw+63UNLEr04kNyoc4BNw3rJ0r0a7S3L/ebkgoIU3XOR/oYyHZFn+IkR8FYWQQfYgUa8hjrIJMUtkPsgHxr191N/JPtdzzIlqomkJs0dZIJ0rB1wCVQlNSLeBzyAw6N4vEM1B34oIfH5zBSOXNT4Mp+a8iHItfoMZdELWsAuILvO7QH/VNQo6rWzx9o4niuNx/Alw25XGqqBW8GS0x0TSN1TcuirqCbick1OFedZ+IZm00BUGeI6Iw5+7wwDNekAElOjrPoEAQ7vlaLndsJwZlnb25zTqYKdmUHgoVoW/TbQoQRyzdJ6egYhzH0x7R4sddUrh0GdT7wJTo0UAhkp5zgScViyGnkayJFFkIPW9+h05xySh/5Sdw8JFU/JvgRGjuWkxoyPeWx5SFsobrf+Nz3o0uOrgyBhFBfZHXtly3UTF9g4+Bw4iobQRTCahTcObjlt7co60nhwsZBdPNRKhMbYcFF39nVRsJk77A2qiMd8yPxDQUc8qtLjMhaH6n4s/cxkTEKvwwky/eF/Bx3lD7/INVCN8X0LRRg/vNekelk+FYGNfdY8IvYHUQXnZN7B5cyj2zAWqmX/idg86erDH7wYsiP5GtFcqPFEfCn70MQZ7AFbbod2La6ap4VgiTKoVgGoaku4ZMKOzW+TVv1V7KG4HMipBvtHCASd/Jxc+astMWOkDIOk0ZW1vOVZT5PrWESpfBRY423JcjvphjR0FHIPgorIt1VCrZGzjsbhQQ5EDFYudxaui3LJk1YPxw5fQVGo1+Gp47uF9F+R+dGKUKbcEHMIR1Cdk7Iu02D0X1WK4R4+7apqMdkDdMookuMgfea/phsvh3H8go/AOWFZZiQWWFjHhGiqSCUySO9FC6wXN41dWxHwSYPTG2l6cpDTYLzeNgMRqHoqKfdoJN53Syk04No6vmpGJKrscZchpwv8fe+U9EdomvwN1Pxh3Mi6LVtAFtaQitxVbBbSWOWKFnwA4suZPO5n+75os4exayDhZ83KN+ZnjdpGdaHAvut4Y5n/LGW7RKye3E/CiA5Qt87ANeWC14hAhGfLUIVEg+1oduAjaf1Apo9P/W9KFvcN2jEGpgDBoLPJz/puvRFGyNlWOhEhtxu9DRKNV0ozFB9xP1Y3WUTfFGRM+1om4xKgHeKeGMB2oEFje6CDRa0cBIJz/FchGAmHATTihQBojPgf5160WbqQpsN1IgDWFfup1Yd4KzMXjXpZQlbpWOIE+U1UkKqT+bTyXjre0dZ1U/Tft64hr/65nghzq2nw+q0zs0kw+2aMCBLR3UZZ2IMJQz0sUD0Zz9E5YS4vfmQTy2lwziI7RSITFofBE5qbGwBD/NOE8rUi/gqnk3AjzIJef0w/4+X58ISyh8hDQEQu1npzAGoCHoSE8IzskbcY76Wl9z/8HWH/JLInx7oUFd7APzRdOjJQgM7vYYyUTSucMPiunOIMij04t9FLqfV/81VuGXoH0VLjIL+d/84G/gxPMp3vAuQo6OFxH+Ha5Cd7k5Ue8bNUtwn1txU2cWDOIUJOeC7JSST8MPjXZVVAP9TEmddbQdoQX64PA08TZsxi82SzY2G95A/0CUbjSKwxIiq610mIy9IJmmH7AOQFE9KJQe8pgxyi4EAM6mC1HLSsshbMJO1Pzgjj6DWb906nvgnn7xBgoPQENyHul725zomKKEDXMMs0A/AitvQzdvNDVvmDMo5BCJd6e14c2Vhr4GmYGAzVHUq3+TMEv207ca/HAPoda7Vcyklg77X+9nFfXgehp7dyraEC1HyG8FTlOyOsSRlbGgWSjAFHCnAnfDZ2jq/NqAkGzsQETfUyaHlZXL6ogHrTopSECq09eoP4llyTvWC24H4NTNJhpcpAhXq09Wt+GYbnul7vb+nbF/TL0r9NcFqh8PrYoK2OHRb3QHiysgU2DERaHhACp967hQTKgmcN2JWUreSXNZHUshBZOCLnI7GlCFKArV+U7Vp94l5xB9MgRbH2gYGQOZOj46DQeF3tG9hrDU9mQOThdP8mTNfCrnwJwISKQPnT0uR7VNigXpWiEFP0Lxr98KaVRvvbFK9W99yFLG00LSEBRM6N9hdpSdn1v1xajAaNI5aoM1RvOvbtFmReiHev0we/lXd/QOdgDhk35za4XWdq2Kq0CLNKSaZSMmiFa3b52utEkcBgkaBtPuvCgUnUfhvWgjBioKqFKmzXuYpxTl/eQshPPO2ShJRza2dD8dmfb8nMrEf/mI9cczhuFgqAQhsyhVlS50UbeZhXJw12E90H4zEaXeyEpzm1hL9S8p8IDmB3Uoe0SMkyiamhaFiUZRkxc/jhjIoYNyQNaQfNBIVzUIyF2vZUKndnGxeMRUKB8atHpXwjJENI834Aua3xE9HrDApxJwLZAABnp544Cu6gTzDanTXSRBCgWnZa1TIFQX/aCR3IJnEahlwKxX5PoZ2xzJv1FDSTHR2I/yJ5bIE+PfISQqkGpHdqMYFqq1uu8F/1n8izQPIr5lhztexUKSUDfKYvHn8KA6E7wzR1wtru04SeGJVKUgRZzL9yofVU7H6QEpk7p/0zasYFQpSSG90K2fcl64K5m79bFoTBb91AYHjv+/uSLhYRe6bvajej/vvKkVHJ0TPF4buZAoev8WpEDemJctMADcTzd4GkafL0juiyEKwG0XETEBfR4bioCLBmZlDprvZuGtR/zHJPHinE9Ok5/YQ3yYCfrV8iOC1oAVOgDBDksbjH9wOmwIuBPo5icdgiwS1wbND9YU/UHbRZBMgo0IV1jpSUKhQlaYrnkehdAkrI/jgs7JwVWXutTfHbKGdLO6gSFyCyp2j738tB41BgTSDRFYZZQCTKx0bOZkVEiuHFbhtecqYjkv107p0VeeJ6GFqZ+UMrS5tr5BQKz3toOfxbe3a1dtvW+oRnvdOiOWQK+fRFWJgk9hWwgNBvX6peddODKw713i8VM+1Bw+zzXE80FMMd0LY9XoxN0P/Nty75bP4xRkTPHvFMwzuwKeBW3l38aB4uaPlBEG8s8HGwhv/x9y/hPOIdIfHx3GqQAAAYRpQ0NQSUNDIHByb2ZpbGUAAHicfZE9SMNQFIVPU0tFKh3sUMQhQ3WyIFrEUatQhAqhVmjVweSlf9CkJUlxcRRcCw7+LFYdXJx1dXAVBMEfEFcXJ0UXKfG+pNAixgeX93HeO4f77gOEVpVpZt8EoOmWkUklxVx+VQy+IoAowlQJmZn1OUlKw3N93cPH97s4z/K+9+caVAsmA3wi8SyrGxbxBvH0plXnvE8cYWVZJT4nHjeoQeJHrisuv3EuOSzwzIiRzcwTR4jFUg8rPczKhkacII6pmk75Qs5llfMWZ63aYJ0++QtDBX1lmetUI0hhEUuQIEJBAxVUYSFOu06KiQydJz38w45fIpdCrgoYORZQgwbZ8YP/we/ZmsWpSTcplAQCL7b9MQoEd4F207a/j227fQL4n4ErveuvtYCZT9KbXS12BIS3gYvrrqbsAZc7QPSpLhuyI/mphGIReD+jb8oDQ7fAwJo7t845Th+ALM0qfQMcHAJjJcpe93h3f+/c/r3Tmd8PnXByuOaabnkAAA0aaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA0LjQuMC1FeGl2MiI+CiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICB4bWxuczpHSU1QPSJodHRwOi8vd3d3LmdpbXAub3JnL3htcC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgeG1wTU06RG9jdW1lbnRJRD0iZ2ltcDpkb2NpZDpnaW1wOjIxNDZjMzUzLWIxZjItNGVjOC04NzQ3LTIwMGEyYWExM2ViMyIKICAgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo2NGViNmI2Ni03Y2I2LTRkZGUtYTI3OS01MGY0ZWFiZGFhODAiCiAgIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1ODRhM2VjZC1kNGFmLTQ3NjItYjA1ZS04ODk2MGQ4ZTk0Y2MiCiAgIGRjOkZvcm1hdD0iaW1hZ2UvcG5nIgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJMaW51eCIKICAgR0lNUDpUaW1lU3RhbXA9IjE2ODQ5NDE5MDM3ODI2MTQiCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4zMCIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgeG1wOkNyZWF0b3JUb29sPSJHSU1QIDIuMTAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoxYzNjOGRkZi1kMjVkLTQ4YzQtYTAwYS0yMmU3ZDYwMzg1YjYiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoTGludXgpIgogICAgICBzdEV2dDp3aGVuPSIyMDIzLTA1LTI0VDE3OjI1OjAzKzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PuhCAHgAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAADdcAAA3XAUIom3gAAAAHdElNRQfnBRgPGQOTjc4FAAAFdklEQVRYw82YW2gcZRTHf+eb2dlkc9lsrFYr2notfSgWxKKiog8VvIFI9UFQEaWtYPFJfREfRRSEeqlttViLD/WGisYXrShWpfWC1WpSN5eN3cZumkuTzWY3c/mOD9lI0WSTTXbVA8M8zMz3n//5zvl/5xyhxqb3ewYvaERpAvUAFzCABUIQH6GAHyvKa76tJbbUjMRW4+LbC7GsQbgCWA+sAs4AWoA8MAxkgEMo32LoxDO98oIN/xdk9IGUYEYvRrgduAW4Gogt4NMA+BroQHkfm+qW3aP6n5HRTSYG9hZga5lEwyKWKZVJvQCmQ3bZ4F8no5skAXov8BiwspwXizUL9APPgOyVXTr5r5HRzdKI1TsRngHOqlHuKTCI8hhG3padWqw7GX3IddDwcixvAefXUkTKhH7HcBfifi8vh1E1H1cfGkGYxPI4cM68RGw5zf3y3S7IuedgeZwgTNZ1Z3Sz46LRNcA7Zcmd25yGgPWP/M7q65toTLZSHBvn6OcFDm07n6g0n9oNAxsR54DsjBYs2251QWAbgFuBREX/tF3rc9+zA6xa3U5jSxwxHmpbueyqOOvvOM7rj67g1JfedFTNagngVtR+B0zUK8xiwLqKTmhcE3Dblk4uXbecRDKFmATgIiZBIpni0nXLuW1LJ41rgnmcvG6B59WiyRhgBeDM+UZipWHthnbcmDf7b8Y81m5oJ7GyErZTxjH1JCPzesu4ghtvBpkjH2X6uXFlAVEg9SMjhEAamFsyp4Yjcuks1s6uXdZacuksU8OVZDcC0mW8OpFRQqBruvqdwwpdDh+9cjaF0QHQv/2wRhRGB6afdzkVkKZxtDoyVaqZBKCHEXygcXafjhi63l3G9tIEGzYe4ZKrksSbzmCqMEz6mzE+eedC+juaiUYqhZCPchgkqKB4SzxntqQEO7oceBu4srIzHIitsMTOBOMJ1leCkxAMmEpRWt6Vg8BGTConOxZeSVdfzmwxHmpvRtkJnFmHcuYksBkxH8tO69e1nJEd1sdhP/BBuUippfnA+3jsr5ZI9TnzV33mFcB/DuEi4LpFr/PPZu3LkanES08fOltWnxe2Ba5xCEPXiHEAVG2oMS9UNFTVINOXKdamn3nQdSC8HMMeYPVS+hkFzQdObl9m2Zu7+xt6hkKx5fXktGumdNXyZQUKiPZGkDbGnFxqp+kh9kaUHeUTezHr6WRkxt/oa/toT39Lby6QqMoci4BJDB8vpTtEdlkflf3A08AQ1ejoTM8cyeRnudYD72Zb+qokMhNZLuCJaqtZaqDLLi0i7EHYDVTV7oZW/J9PNf3wanfycLoki5nQSFnKewKrnW5NNMhtKRDlt6EsB+4G4vM2/UrUNd5w5Pl028FfiuJL9SQUyKrqEXXkaNyLF2o3N9vUYKB0AbAduKFSQWqVKFv0+rYfXdbx4aB3qqQLDk8VKCKaUSQNmi0F/ujAwB9RTYeAMwoXabg2QvZ5jl4ym8Ip6FjgDm7/bdl7bw3Ec/lItEJyWyAS0RJWsmC7I9WM45hJHCfo6e21dZlozlju3pjnSnRT0tMXHdFzT8dQ0EJoTr2eSXXs7W/uG/pnwiswBZQw5NXaYw5knJKXVY8p8VSP9vZo3cezp1v2nniDK9FD7V70RMxoaganGJmJT0+0frbtt+RPfVN/EQnLo9sxYEREB6wxxweHhwYL4/mo2kSqi43c5zRH8GS7Fz1shMZQJTg41PzVU7+2fdNZNHlBTgI5ER20qkPG2qGebHZsSTpULzJH8slCe6ywrWTlrGTM3tw9Ef/xjUzLvp6idIlwQtBxa2Sit6+/VCvMuu0MwIE726RBSqlViaDli6Gm4t6e1MQveet3Z4+F9cD7Ewo4WRJBbaaSAAAAAElFTkSuQmCC",red:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAgCAYAAAC/40AfAAATbHpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHjapZppchuxEUb/4xQ5AvYGjgOgG1W5QY6f10NKtmW5EieiTVLDIQbo5VswCvavf97wD37qyD3UJqPP3iM/ddaZF29GfP2s5znF+jw/P6W8P0u/Hg/5fTxmDvlJ7xNHf5//cTx9DvB6WbxrPw00zvuD/esHs77HH18Gel+o+Ix8FvoeaL4HKvn1QXoPsF7Lin0O+XkJ216v+rGS8fof/Ol+xEReL19/r0L0tHGdkrOVVCLP72CVXPx/CWXxpvGcS+XEVOR5H3mu5SMmBOS7OH3+TGZ0far125N+ycrnuy/ZekeApX3JVs3vU8qXIPfP12+Ph9S+z8oT+p+uXMf7Xf71+NgpvWb0JfpP8K+O+6yZVazaCXV/L+ozak9Srm4u4Zcegal1stOpocGrPyaPweIPpaDxxM3jpJky6bqpJk0r3WTP60mHKdZsIQtvcj65PAdHkTzzKZ6/6o90s5RZtAxyeZ6015I/55Key854wnO1wZU1cWpODJb4yl8/wt9+4V5vBQI8ntSnV35z9mAzDc+cP3MaGUn3HdT2BPjj8fXH81rIYPMoe4tMht6vIXZLP5CgPIkunNh4ffVgEn0PQIi4dGMyqZABspZKSz1FyVlSIpCDBC2m7j2zyUBqLSuTzLWUTm5G9kvzFUnPqbllDgeOA2ZkopVOnw0ytEhWrY36kTqoodVKq6213qSNNtvqpdfeeu/SHRSXFKlBmnQRGTJljTLqaKMPGWPMsWaeBdBss0+ZY865FtdcjLz49uKEtXbeZdfdwu5b9thzr0P5nHra6UfOOPMszVoU/NCuokOnLktGKVm1Zt3Ehk1bl1K7Jdx62+1X7rjzrs+svdP62+MvspbeWctPpvxE+cwaR0U+hkgOJ81zRsJyqImMi6eAgs6eszhSrdkz5zmLE/grLTPJ5jnT5Bkjg9VSbjd95C7kV0Y9c/9X3oLUX/KW/9fMBU/dX2bu97x9lzV1ED5Pxl5d6EGNhe7jnJUH/+jW31/D+83KPiEmlrd0ZremEblUT7eZm0BzexaimmXYgubnuEPvkbQGa9wthiOWrraVZNfSbR0D3dM5e18pXeZJJmnLWKdvldHSuKUOsxOt3bbTboUw2gyslJWdOaVdy9qByFHOHqbkHGo8yhf7pMzaZaS57phW01Jel0mrG5SmjUNddDez7oydWuXyM2lNdiFWXboPJVg7FGLzCt/lNwpH8zahiOZobe1kVcJOl4zlA+HOkZfx6ZCqda7d110dOqk5j555J51FiWZST5Qtdd1klCVRBYFSJPLQBhVUm0uIVsH9rLkAPGR3mNdLnms6F9jxCstcglo/til6U1v7hJm27l3rQ7HE7SzZVqiFqgKlzQ0BSa17KIOX6mWnnHzLOfToTkNLH9lgkXjuufNIsdmoM5nGyaSbACl51ihnS4t7TBrI9uikqdFIpLPGdaGkO4e2QBHMZEe8Ls6U6DWk+dBZ9VLGu98lM11aIjXjakwmrUP6KF24IvLlTbBSMKXAz7ibZFg6JtIZFqmoicKJlpnItETwSSfBphrjGTYkkzzqgArxS9wA7/o/amHMG4VpUQ4naZO6llRb63b19J1i3g9Lqy/ptx4Jf2yej95JmyqnPp40nD1FZ6eEE5GkmCLLXyizGgweEiqMDJ59WrKiWnajjLNcFMFdh/WCApcKnDU3Ymiqex46z4jy0O5rCny1U8sU44naDrlFlpBoiqK2FSlQEkHj0YlVtbmq2OSJIt9n3XKPnkuWEFrHx1cmu67wCdWWb26RPgIq6cbWQSCh7ae1mavXCLiYj//UCeia5L5SWHfOUy1nmsah0qgDFAnlMSvhAGM7iEUB9aZX4xO7Zb2Agc/b+D4UPt78/jq64wBC6Jaup8vuDiT7JCo/slSKKILbA1xMusPOqh2o3McIKmivFJLa3bxx2ChgFek5k49tFcrJazxJPZAlqmxVaMSQfstACssdyhDQIDJr+rfDSzfXCzFsBrte200pvE5xAkmDNjbIohNm5klmgx9YnSeanMqY5A/FTwObIRibOeDRqguEXKfVlYUsDBao9WTlykDd1C2A/6v6HDLrn8L19fWACeBm7jfSqwkmzehsIIaOBraQNtfrp43aAEzqpEvhK1NPFeC4qG2jkWBXunMnuOISRcCYsAdsF3O7fUNnujpInQp4DZ8KwV2FmvtIOsh0MU0/t5EmSrcCsRpAyod4KFVKDYGfrdIxkSyVp42oJ1W+RLmRdmi0Esc0V7UIzJJ//A+4FBq6GJDSNahvqK0ceqdOtLOlCY7I3aUpxTsUdtOZL6m/rVwjKAPk2qwfngswTfY1DlqXBA1y3zIyIc/qRPHoW5SIy37KpWFJjHxD3I6/c2bOA3y2hQ4pYTZgbjokXWhk5NuoOmZiZwI/XVUnUEJFcawCmm1Ta/tw3ZnakHNtNGbUWEmVz6sXlxuq5lNV4lOqIJuQU5QHEMeyooAIrnXphlkdMea0QBdhgMjIKxu4ijyOJsAkNkSA4nW3zegoRhLwGvsiwsZFjaA+vJ+Pgl41LFqKTBzKJzeY4y4K5XoNc7nis0wgQnLKo12glDFaehPgz6/h64EaExPNTwJAe1DE3wFUMBxd4DV7naTKl3PCl5MMxeG/EgQoy39r+w5UIWwAZ7wmNqNo/ZhYKgiEmkMjJViEcWAN4ggPgzAdfloCgu4iHEgRDTcRcXnedsSBlODF7lLlgOpER4KNup9IZKHakS9TXDhct95PHzZaH3cFI3KsEcHSDhw4pxZUZEFXqYrF0L1DQXjKGS3CVVwx8nDWQ8lEU9eXCBiEat99LPSlgWplOVQDS2NDg3WSNSQYde+YyYCuVZNkYNUgND126YEyidh4loQEG2DBs/cx8KWQNz0yTgqCTkMLmclevB/oQSuswMNCWvYAHh277jmLiswGO2w9Q1IplD35KTr5Hkwr71QA1z9KYTfXDe9ie6JJUVGMgMsSH6YhBvcTN5Z+bw/6BkhdiOf4X0Pk+Qpv4YVvn/BmtOy3CPg+A8gw+v/J82EJl0ikfsma0i508WtNQFu6GJ5nsZ7sTacCgBfB1FmObYVEFLW3GkrRWXPP3mc5A+7fEinK4mqRU5D8gGpdNjZaTx7lfU3nAo5S7q6ZuzncQWjEbqGSyCJeBLuCbu5dB2B0NAvwQyBz0dO4KqIKUmzL6q2DRavRClhgVIC4xaAFJtpuxYBysKndvZhDL1fAUIGdSPVI1pj/IDsdOKzaO8oQp+O6V3E/4NI4XnZr1TBg9+zyic6BWbfzLUlOLB6VgvGd9dJlG2R3DQsnLrRb6tTGFEK3xB7SD1RT3S59Z7c2jisR42rokoQEIGggP4WMs4k1IYD3cOfVdnNjhiKwU8dM8YaSfVVYkKt2aOTuqsgBZY7jUazQPnqrocQgNSYPRF9E+SvLGIzVnyRDRzT5U7xUMb2wAFgAhqoHIja8Y7WQRurG2vHdnqeq6N53vShmnb5r4SmYj8L506vjGsLOMErgHKOchXNdCpdq3QKvrjCj24kXD1E11zUiyyQP1MMjC1GiLD4NtFbhbGXGdkY8i7TXDL5BETfhadPCzeugxtwL4lmKYfiQ+XpIzLxwA9hIky+ggMIqYFfDmiPa8AX7XMRUP+GAPciSQmZh4Q3ckRH3wIhZAsCijAbKl3J+pBtLw3pYK7n4IYHuIwk8Qdyjb+veV3i3lQFXjE95i470ifEZ34URpc53BJVKlIXJwbJgCB41Ag71DFpSqxtLXgf2MW3cvBmvhAaOZEiIFY4AVBNM8UITXn7AS1iF7J6pAoWAjmh4y5Wmx51o7qBVgkfol4MYBDQ6qnu60cLlwDyLZYLAnBUqs8u49IqKPjh1RKKDN4iOh8DC90kXJ3xR8Z3IXSKZY8wTHxaiwMkIazyh4r9Gh4PQgzQ5mi1l/HgDodGAEMOgPtzPUKjxDvqs3BfQ2QO0J2IC73XMhu3pL5h3OK0uF1GF9tgFiBzAEbEjPTfS0cXuhVAaV2toiWcgvopYcMpGI0r0rdl00vNRBbx+vXb6+do4CCDx7s8BhYZKAbGVsYEF33o6xfVwbB6PDhm42oxaeA0Pis6BgJjTlTqIdcdjI5CuK9YAEKmrYea3ZUCxeBgkMLVzXT48dD4WLX4TigKZ1x4yfWTZoIw5Yfj9Abj/j9QD9LCQRHR8r8ZAtosh4YsTZzwE6+t04rsoc2+g1h5gIHF4+O1J7Vg+NGbz7SfwOlPzvqVFhJCQ4mnAXHYqSrG5AGNBbEqAGmFR7CdXyA2PXUBbZDh04fz6OMUM3MHoVfGpA62Ch3LlCzVgC7l8h8oDzdHdYxXflJvm2zGM3fYpvodExdcdIZQVxzzLN/gLhzHDXBEgfgFpqgumRYc6Z2AyvCqVChakJ3UFShQaws6WkvrLRGBZ2vdBDT8fmO5ZrS1WV7AY6aEvuGNBCy6dENU+H7cj+IjURXxTlPiK5oBpiACdbw2ydEwhPeXgVeb0ZnPzCSk4aFIe3c7D+pQqdIRsEnklqk/0kTRiCrR5Cwx7NlvcKcK/+C842Hscz4SUBV8uHsfcFaHWDgNiVHyPq2tg2I0GwSGsCArBXY9aaonlIA/89/xSTMxu0YksrZC3USmjxhTd1OydAjy7HAWjs35LiSTJJGK+1fLY/jYha/Vtoc6KLD7NAwjBqov6ivQQKv+1N5Lit2LeX0kyrAOWwx4Y324Y6Ta1Pfe28KB+o20SyxGKged8rR68DLyOIPFZ8CylJuyKu1OIFtC7cUjNvv1wXNFyGgVX0BpryQgwPEYaTYyRPB4XzBaiaPdjDIqGRRW4knDdjsiAkxdzpWuOpxqgQMMzl0uLjOmW/UD7ziKzeymC3sVo9mXbwe1RmQix8c2+EFYJ2pqhsAx6apOdEn2fGXY9rvHJmE1Ae+fyqD0sH6o6dwh1wtUz6c6+XccvEf4MCg1gEJAu+DwazG+DVNf1RCkDYkgs37VXmFBbf21t9YRme7YS1HcXi284Q9kfNGWse323t0VlvTrImQsPsQe6oMLeHd2EbPNN6ub3aUuCjRDEcgcWHxX+kvCkf/xHvW1E1jcoJZxauvcKydiCv48V37kWZQxtw4qJNODPVsIU+R44zQtroi0Be+hQX63ZyRriAqWJJEBGzKI6HJPsdjpG3Vc3onja7pSJW3QaDu/lW8PjGISJQeEi9QZyj2GseK/BcVrkzo6CmB6a4tMCg2mQY5Ir7qkXBGGv51Yy496L2SD5l4UJHQG9D4NFJC5gLAA8HHMB1ULcWPqjb/FcfCK03wHQM64NAO9+x/lQNAHAAX2YIPJ5gjLOmy259gcgyvU7L8idDkJ2yr1iWAUkKo7aIk9uF+QrKQAFiq4u8yDdIZJNQ+Ts+x2oKKSDb5VtVDdyAHQi/ANtRPG4NK/Z8W1ilCdNK4egJtQD80GKITglgrcAvDm7GAgUvenMrdOOvrlEwcpEut/RfSe/eJeHm6vvwhdX3gi1lwnEsNAm/jZX13mIJM+UrhGdBlhhvig38IwcJ8W9zsAUzqpRN4VOZ6jfC6b+sS/Y0+VtHOmH6PwKZYMjbnwus9HtO0/IURgRkxFYTHJapCqYIzWFN4BpySEpeKAeD6PzeaflxfmdVkq7ynBzOtqlqAW/BkrR0Y7mINvwbWv4iO6GSDPJHdmbG+xH+UW+DEnHia4hqdQ2ohfBna6CR8CN+u0CFILsuJOLZ99dv72NlBM1hBDGM8IP5TFZ/QAQhDXKyVAIySckQWg/67gP6hDcqVNQlTt3Z3Bp5Ksj2JAxfs+OKrZqmi8nKzhDDVK6ie+cEli83+7BM4qzhKseI23xey7482t4xHg1VjMBA+zFo89895p+Rfr4Ni6Ek+j4+ayNAovkBd00m7iCQrQSvXB97wCkxqsPopP00DnR7zRQIHs2uowUsjA8dPG/jrjS/UYoEgyM9Xs/FSUpLaAjORmgMNyebyyd3G82egkJ4rfESLTf/Lfie7SAK4GFZyh/GrsDyRW3gxoNiJjVkPK++Ygp9T1h3BB4xirxqpZXj7YAtoUcBcCwBRv9j0xh9EFhGOyOMwoO4rmNW/1GTWx0/FnUAZN0P19SxougYiS7BzkOfe63MH3Nd29lMhC6UvG0g7Pwn4sCXag3v1t6XXfn5RrBnc4hwNv3CiYVAk75nhTtZy6QhgFusIEE1Gf1sTiISULf0Q1Ukd8PtZuzAzk1bA2fbRAJUoZT0iWiKGNFpKKLerkngI3DN5P83tEsCCValn5tCSSoAFZ8NE5iZCGOFvnI2+fc0hSMyOP6hgheBC/JqM0XtzPY4ff3CcRZGFPQp+eT9FGVEXZAx5l6MPfTxBAh6p9mAdsCes1v4slb46vGhDSdrI7iP3whocfnC9FXoxzU/6gk3T51NDqRmqXEDBZpfvMByw0xUJeUSzQ5viPcMHg1uzxlzOnc9szCN1b5NBH44/uD8eVHwoMzBAdw5t/eZ7uSp4CG3yd2DETwEdbr9O8QEP3Wg28roCeRYRkHdKL6HzKxMGDwGRf0vRjBi75j7X6nFNW/ckp20Z7t7ZL6fRp0CBMDCbLfwU4hteMuyDWR35qZvpvj1ZDwnfkxnjWhUnmmRRqK67v2d+On/kdI/wa+GQTprDiGjAAAAYRpQ0NQSUNDIHByb2ZpbGUAAHicfZE9SMNAHMVfU0tFKh0MUsQhQ3WyICriqFUoQoVQK7TqYD76BU0akhQXR8G14ODHYtXBxVlXB1dBEPwAcXVxUnSREv+XFFrEeHDcj3f3HnfvAK5ZVTSrZxzQdNvMpJJCLr8qhF8RQgxR8BiUFMuYE8U0fMfXPQJsvUuwLP9zf45+tWApQEAgnlUM0ybeIJ7etA3G+8S8UpZU4nPiMZMuSPzIdNnjN8YllzmWyZvZzDwxTyyUuljuYqVsasRTxHFV0ymfy3msMt5irFXrSvue7IWRgr6yzHSaw0hhEUsQIUBGHRVUYSNBq06KhQztJ338Q65fJJdMrgoUciygBg2S6wf7g9/dWsXJCS8pkgRCL47zMQKEd4FWw3G+jx2ndQIEn4ErveOvNYGZT9IbHS1+BES3gYvrjibvAZc7QOzJkEzJlYI0uWIReD+jb8oDA7dA35rXW3sfpw9AlrpK3wAHh8BoibLXfd7d293bv2fa/f0ASM5yljz/NiUAAA0aaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA0LjQuMC1FeGl2MiI+CiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICB4bWxuczpHSU1QPSJodHRwOi8vd3d3LmdpbXAub3JnL3htcC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgeG1wTU06RG9jdW1lbnRJRD0iZ2ltcDpkb2NpZDpnaW1wOmI5YjA2YTAwLWZkOTQtNDc5MC1hNzIzLTlkMGUwNGRiNTRlNyIKICAgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo1MTQ3ZGU5Yi1kOTA0LTRlNWYtYjIyYy0wZmMzOGRmMWI3ZGEiCiAgIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo4YzBjNTI2YS1lYTkyLTQxYWItODM5Yy05OWFhYTM0YjdlYzciCiAgIGRjOkZvcm1hdD0iaW1hZ2UvcG5nIgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJMaW51eCIKICAgR0lNUDpUaW1lU3RhbXA9IjE2ODQ5NDE2NDAxNTU0MjYiCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4zMCIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgeG1wOkNyZWF0b3JUb29sPSJHSU1QIDIuMTAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDowMjQ4MDc5ZS1kMTYyLTQxZmItOGViYS1lMzY2NTRiNGRjMjYiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoTGludXgpIgogICAgICBzdEV2dDp3aGVuPSIyMDIzLTA1LTI0VDE3OjIwOjQwKzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PkaovgIAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAADdcAAA3XAUIom3gAAAAHdElNRQfnBRgPFCiKn0kIAAAFfUlEQVRYw82YTWxc1RXHf+e+N2/GH+Px2IEEV02AgqIsIkwgoYS2ahepVGCBUOiCRRdsAAnECthErBBCICGFj4gqRQqBRSABUrVm1URtCSATJ5ASZCPHH0kGgx1/xJl5nvH7uIcFY4iIM/GzZyhHenqL994993/u+f/fOUeos+nNnkHCJoQWRD0UFzCARYhQCVB8NFWWTwNbT99SNxC3GZfIXg9sADYDWxCuRekEskARYQplFPgEOAr045ph6bXRzwKM3pEX5mduQLkHuAvYCqSW8GkIfAT0IBwknT8lH87o/w2M3mpSqL0LeLQKIrOMZSpVUC8hpkf6bPiTg9FbpBn0L8ATwLoqL5ZrFjgNPAeyV47p3E8GRjdLE6r3oTwHXF0n7ikwgfAEIvvlqJYbDkY3uw4a3YLyNrC2niJSBXQG4c+Ie0yORnGSj5OnRhzlUJ4ErrkikBAoAjPVe7ik4F6D8iRxlGvoyegmx4X4NwgHgM6a8fUyIfc8doZbf99Ca66N0uwF+v7tc3DnWoJK6gqep1C2g3NEjsdLlm03GXSbAe4GmmvGZ91vA3Y8P8aN6ztoyaYxxsPaNrbcnmbbvV/x9ONdnPnA+w71otaMcDfYPqDUmDQTUgjdNYPQsSHkgYf62di9mmwujzHNgIsxzWRzeTZ2r+aBh/rp2BDWDLLQjSzpf7VMMIpB6QKcy77Tuc6wdVsHbspbfJspj63bOuhcV8u3g9KFJtufWQbHakfLdQUv3YrI4qwQ+e65616Jr6mknE4KJgIGgctLZnEq5vRgAWsXLyKttZweLFCcqiW7cdVP1DgwQoQwUNPJxIDDG7vXMDszBvqjDWvM7MwYb+xew8SAUzNowgCSDEwyNVMJQU8AAdC06DvBtOG/76xirlLi3u0nufn2HJmWTir+FJ9+PMu7B66nr6eVYLpWCgUoJ0DCGoq3wv/MbXkhmlkN7Ad+XTMY4kBTl6XlKnA8IQ4U/xyUx8wlB3ZpKvcC23Hz49K79Ep6GeWM8VB7J8pfgasaUM6cAx5EzPvSZ4OGljNy1AYIh4C/L6lASWYBcBCHQ0mBJOfM94rk+WjwAsKvgN8te51LK7kPpm3zK89OrZH1v4zaQ9c4RJFrxDgAqjbSlBcpGqlqODoyWq5TP1OtnoU9wPqV9DMKWlRnfJ+/6q3XKpmhSRVbXU8uuhb6Hq1eVsBHdDiGQWPMuZV1mpuMB/aPCK8CXcsMjs6pufCm3/7PPZXs8LhKnJBjMTCH4f2VdIfIcRsgcgh4FpgkiY4u9Mwqc4fn2468M58dSQhkIbNcwBPVNrPSRJdjWgb2AK8BidrdSCX4PGw5/re53IlBK8uZ0EhVyodCq/1uXTTIzfrExZ0oq4H7gfQSmv54IMqcfNFv7/0ilkCSg1CgoKon1ZEv017ar9/cbEvGEFeuQ9mF8IdaBamFuBB7I7tKq3r+EXjnK0tPTxUoIzqqyCBooRIGM2NjX8d1HQIuKFys0cYY2eeJ3riYwinorHUndvmr3nt7Pj1eVNEa5LZALKIVrBTAnopVRx3HzOE44dDwsG3IRHPBxrtTnkv8p5yjLzvoLy72oaC+mvOvz+V79pZbRyYvJbwC80AFQ1GtPevAqFPxCuoxL57ql8ND2vDx7MVW2JTOuMQPdxDvSInmF/yU1ZT+Nd92eGcp97+RH4BE1XHHLDAtomPWmK8mpiYn/AvFOCmRGmLTm53WOOKpDhM/YqApQsLe+dYPnym1f9xvTVGQc8C4iE5Y1Ulj7eRQoTC7Ih1qFJiTQc7vwN9ZUbk6Z+ydp6L0Z2+Ws/uGrAyI8I2gF6yR0vDI6Uq9fDbsZACO3NQuGa3kr3XC7H+ClvJeP1/6IrbBqbNno0b4+xbMlmARngcRbAAAAABJRU5ErkJggg==",turquoiseBlue:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAgCAYAAAC/40AfAAAQDHpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHjapZlrciO5joX/cxWzhCRB8LEckiAjZgez/PnAlD1drrpxu+/YUZJKSmWSwMF5pMP+n/8+4b/4yTHmkLW20kt5+Mk99zR40Z73Z9zH+OT7eH9EPp/FX98P6fP+k3jLD/oc2Mrn+K/34/cJ3qfBK/3Lidr6fDB//aDnz/nbjxN9LiS+Il+FfU7UPyeS9H4QPycY77ae0lv96xbmfp/tayft/Rf84XzVpL5PP/+fK9Uz5TqS0pYoD4+fYkkS/ydBBi+UxySZA6PU9/V9LJ+VUJA/1en7p7Oi40vNfzzol658v/rRrU8F2NqPbuX0OUR+FLl8P//x/RD1z125pf/LlXP7vEq/vr/k2e+KflT/Fv9YO3fP7GLkQqnLZ1NfW7yvOG5yCb90Cyyt0J0ChhrP/tv5bWx+AQV71jP5XbHHRLtOzNHiiCfu+7ziYok57ZAqL1JaSe6bTWrqifXSv+y/8aQqXUwaXVy37VnS91rivWx/VrhXa1zZIoemyMkiX/nHv+GffuEcH4UYvZbjrRXrSsmLzTK8c/7IYXQknk9R9Rb46/fnj/dV6KB6lX1EOqee7ymmxv9jArmNFg5Unt8ZjNU+J6BEXFpZTBQ6QNeiaCzxqSlVCEpSo0GDpfvMTDoQVZOxyJRFCr1pyS/NV2q8hyZNvB14HzKjEyqFOWt0aNCsnBX81NzA0FDRrKpFqzbtOoqUXLSUUouT4qhSc6haS6211V5Hk5abttJqa6230VMXSFN76bW33vsYXHNw5sG3BweMMdOUmaeGWWadbfY5FvBZeekqq662+hqWTAz+sGLVmnUbO26gtPPWXXbdbfc9DlA7Ek4+esqpp51+xnfXPm397fcfdC1+upZup/zA+t013q316xTR6US9ZzQshRzpePUWAOjkPXtazDl557xnT4f+RBOLVO+ZRe8YHcw7Jj3xq3chvR31zv2/+hZq/qVv6T/tXPDW/cPO/d63P3XNnITX7dg7hV7UR5g+Pt9tpDZc7H57Dl8vmBBZjQJKZuNivLe6qJ0KRa10Ri3sSNYUdlTSNhm2fHrW3q2WHUz5Uoy2+qhR1zpd42Kfqyg8pnJK5+GxtfY5jWIPR8pZTsbIJJvx55WD1SrglQsUYzWZesXZ6EkvyWy2BWNz5ii8eI4Oy0Oimkb6skc7bSy6pxpOdJYYfF/3mc9YVbJGen163LX5y4iCvNVAAtgR2sr6lTeca5byylbY04Zy0lkYmkRfF1ReNGUqriVaiyxjp7FhRh2DtvV1qia+03tuAKqzuDlD4XICE9HCqRXrsGVorgIPmcFOOteac6Su7GnsGruyokw9o4BjmR0ARLQ/jwP6BpXm2fXsKYML5BPnaTWtkxc79oIWNTBfe9+FB/A3Oe2s0XJfVYMAPuF6JY3l7goPEzen6iXzT9eoNnwSlc5YYkriFIq5D4N668YUQbg5qBuit6R/55niMfQdTow+0WNvrlaf1sLs3mChUH0c5PChozp06pmlnrJKn4+UbX1r7SOmvPuc0vZs2/wMjDgk0VtYqxjIM1dYscoJtGQYvTb2n5n30Tkf6BursV16Av77ZMB90ucZjDxYsOCHFZuw/1vDvlhJ2YKlPEbd6M9gX8Of00jJTeEY176YG8UDIkBnDqWu7YSyZCM+pjMmOzPXqic9Xsw0s7SV/vW4vs+h3T69/xsRhPcJA/Sdzz51OUPUep69F73eWyzNJidiM5NDYiJEZ04GNnB1WcvGinPN48iEv549+ZStTUt7SN8AY5cIG9bWk7bOPPaUgcRz+LSVmWDI8kBTtZh2O42TplnioNGx7n0YJGe0/MGpMZq1AeLCRxkQIcHZWtMZWkOYa88AP85ZhWvSFmu7zEatE3LewfssC3ZnGhI96iseCHaPafkLlUH/LhpjPVm8LgypZPNX44wGO2V4BWJzCQCLcAzitjMDL/VsLue27FlaJ3tjC3UIVH0aX20MX/5u6a6/UK2/lR05de6JOMTWtzzmBhEZYzQ5Tc+QRtkKC9YEqcF9A/RZKmUGwysy8sNYYWlXNWiILrihT3uAes1rQlP7OTTjHJGzo8IDA+YjV1BReKcFo2UGWgBGbZy/l2nQtwGauIVsUNEpOtFTNdaky7kYApqIyuqMhM7HAEsYYApVU0e+i1uMrCdDT3PpQT+o20OXgEPZwBKiy8REeBwv22wNhA5Bw0S4okzNG35mqDMMaVTl0jZunyl6QV/5IMFkSB8EhX0DGTOBi1E3FHh6YICd/fbZ4/06lbX8tzHBVIELRJmYhTI5dvUigxWcYq4Df0CDx70vPGi03hkp6OEsbTWM9+TQzpH22dKT0T0MjdSiEHJh5OJZggTYdLMzQTrDW3BGMmGpBZcF9X0z4AtKWwK71Mlw8mpfgj5HYVNo7UEJEzPBtxjkTEBt6xiDdAYsVyTggptVFBK7tJCwXhycUQBHmk9VZ/3J+pb3qKMXk1kDsJQHfRGmOO1mD64WS8OJ0Eeqv1D4zfekuw8Alrkkx9LjBMkc3TpyalBHtw5Xm1+VDScVdJByj0tUsFq2crIXUjrAbSZdLdHUDWjevuKdTvvuH+xOA8I2f1EAKCEsU6bqJ4QXzzao7UMTENho75h6mPnDc/jLGx7P0oco6u9EYdiMpB/YXNQAhxc37C0AG5j2d1zgmN99oAv7G39lrE2WwVFQSAFzbnfZdi/BBwI23hOlS9XNbWHOC2yaHOWQ9oTRCrS1eQCsRiZNyb0OeIoHcMQ9FRzlZgfXBoPgG/YqcPO5y4YO8EsTN94fJ4UOxYCqOfjFF1d8ImG042Oa7BbE+CgSfPkaACzizdHSzO8HQQSivWFjk/uYPAm08ML0Oxlj5EZNYNeJky5h4/oWxdnIP68xUhgQCmDb/TYGDPUfczW4nmnWYhgam4adQQ9nq24MODXIPlg1aQgIBmG4KYBBB/XDdGW3ZoYLVazkgYAIVFTlwK4oWesYQAwzSyS9Bwwc9beJo2LIKe9nhuPWn5j7E+S+ARf+NuJ+AI5xvnBboOjArMH78+INjoT6cnMQWNkJokBBi1tjvoBTcpOw0GLGKTvF6zLyB5RSqzEiWyhCQviNkiMvIpQOx4LrwlWnOuDTzs49wpNvcMOgHkfsdhrCByEJeJQAQAYxI/9cPgrQYWbsg7iGRgjlDKlb4Xckeidy0ioTqwt/kXRC58hFGsNjt4ovxYBjL5W8R/hT7XnW99wkrPYXxgYc+FmK293mkftBSbYluHaDfDay1ODagSwdcVET7CMc1zkXWy7L8wYA5IChD6II2pNLesCUUOmHHDST05V6iKiQq8PmoDmMeNcbZK6FWBVCpawscajPgdd3bJw/1UBI8UH1ysPGVCYlDDnj6tmki5t/5Jb7oL554rFh39P35a524lgrMIZUxqLORIcNkO7x/RXcZPyxGhIwZcMpmacKIm3vHoF2AEv6TCwP0XopjZ/uAeBiPC7ChlawzcowIPcoBGrObFFLl9TmbeE0fk8y/Abey4xQX2OPm2TjWefgu434eMCaE7EJlhrXcpAJ5sr1MLB+qkP21oEJngtlRWw20WXjJTHJfIOMRjlLYYc7ERNIxcL2ngjaKRDb3zm4D0JVkQ76ZejoBgasfHm8w+27PrWH/0ZoMvZ9PDrgEzzjEkOQzDnJbkQI1HJBrBNpg1bh54gCP57oSZoZzBG/1hJscm+5OwOcymQAn3kqafWSBWYU7/MR/H/57Gk5ne7UuGEn0+RqeW0SRBrZ8rM2bkQBoHtdbCbaCiHS3GevBXYqChEHkZM98k4io4Fq0ihehV0el5yi7vcsRCzHvmBbM4Oo4a4x9YohJUqwb6FgdoRVVSNIMP8kIi3drSHjMD0erTpCd1qn2+IAyR4Xn+OxoVV4EW9CcmBAS3FzARHEKOWgUXZ3TSn9Bpt/xqxBOeJI1a6CyMAwjRiF3/e/JahO+ALcwOUv1OKf3VvwF9jMhkhgPI3gb9uQQhJJzbXjfvMaxLbtaRxOwNgCb3X4uRYOiz7osgKpTT2ZiC2mA9JthP7l4XQXDvNIZH6Nx/1KvNcgGfl9pfVeY7x3uIN7qsn6VckwqA/DCE/hAwWjS0bT5PMFh6KIU2K5UgGJ/Ix+4YFxAUUpGO0Me16HlBLJ7N7AQusY3EcIWpSY/uKmPCBwIAFCvQYH4Sq0P7IYOMwnxzWcdIWHncQITB62vKWGnQbwwIIh89FHLkkihUyJojCjWwnCoSMnqNp+Ch1HL15exsqP9K8hT6ZgXSU7pmveB8AGGhsxIxlEyHRUR3cGFd8hfjvtNrz92ygnOfjoHMkd29zd1JwEFSO/SCM5lh17sqkGRs7usAhuExZRQktLhdkDmdiGOJg1RK3xBb/1jrvVxQA0D7/QbBloVoU3K/pM/Ohk1Qaj8QVcNmkrI0FV3QSH6Dcw8A5GhK24M4zXqUJ92Tk05ARIVVudK89Xbcltox5yHiNKxriMivWDmO/UTi/bMKIGLoOeM0TEp1z9htwS1HXZ5c5l8EYb+G+mFgEnw/UmWgJenLHN08Coma6DCSK7em/xWlxCM3XiubnDtT08jiIgBFVwljwbIIS6gjMmRtygIiwfowtA/G9kD21jsjGMrXa/fSBQYuxsTByznPXeSirOK3q7VisGrAOqjgQwRMAcYSSn5ERQfKN0QqVcZ5YyKPgX9sls0HlmaeJ8KromfhsYSNjoiZHmlExMo4iwUqrYCl+y3HtnfmNQi9f5yJWlV4OH5YUc0dd7/39TXvB8ovgND7Sdo/e9twbhx/fmZU7YeMcrEsCM0TDfzGyM9AxM+IgMBLI9JsPKaY+TeInkhPeW30IgFsQJbPrUODmW2UTFoTGuACs4sW1K0akJGvg1Cf/+ZtHnmbX67RbAU2uwXvYoDS8GzzKM5LRNYql+H/NQs4gJEjDb88GPp/sXRsyH39RdW+vohMhra6bf0T0EU4pL1EBKRvV8yMCw/e5BHtJwrJAeico3PhZTupL9jk71O511WcC+53vPadEifNmqD/6+Ca1a+B57arkpfxFk/S4oBApPH1aOizMC7lK/D7cCm8Gpmdv8LMsTKPbUoy1mXBbBt/uYUu7kt8X4iEBJVtkKezRr12rliBml/GgfMnphhinBrj0+tkwZfgmFOlagbcwpjomMXOgZY+i+WTBVpb6OMbB3ZnOgIMktAhxTMxLpZXCJvwYdgJdOAiLLEXEflQefJrV5ANNaUX5MRN1kPYPqoWe/TcPEkUmoDPyNRmNehZrh+bo7Yohe/P4KKbNMwW7XxCDD7hYmLI3RhiJ8hjBiC6vitzy3/9nFcwD2X+tecsqjzW1bh3oWs0z623xJIO5TgydMFMUaXh1X4RiCLcheaIZHJKDKqm4NMcBcTmjxGP3GAdIIVtIepjocEsqDaI07Tyi2npk9YovfGDpzY4E8CST/O91aOT5FPS24MRIS9Ze+hF+Ehmaa/4H7fwGCg3GYVGiblAAAAYRpQ0NQSUNDIHByb2ZpbGUAAHicfZE9SMNQFIVPW0tFKx3sUMQhQ3WyICriqFUoQoVQK7TqYPLSP2jSkKS4OAquBQd/FqsOLs66OrgKguAPiKuLk6KLlHhfUmgR44PL+zjvncN99wH+ZpWpZs84oGqWkUklhVx+VQi9IogYIlT9EjP1OVFMw3N93cPH97sEz/K+9+caUAomA3wC8SzTDYt4g3h609I57xNHWVlSiM+JxwxqkPiR67LLb5xLDvt5ZtTIZuaJo8RCqYvlLmZlQyWeIo4rqkb5/pzLCuctzmq1ztp98heGC9rKMtephpHCIpYgQoCMOiqowkKCdo0UExk6T3r4hxy/SC6ZXBUwciygBhWS4wf/g9+zNYuTE25SOAkEX2z7YwQI7QKthm1/H9t26wQIPANXWsdfawIzn6Q3Olr8CIhsAxfXHU3eAy53gNiTLhmSIwWo/MUi8H5G35QHBm+BvjV3bu1znD4AWZpV+gY4OARGS5S97vHu3u65/XunPb8fN2tyj8UDOK0AAA0aaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA0LjQuMC1FeGl2MiI+CiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICB4bWxuczpHSU1QPSJodHRwOi8vd3d3LmdpbXAub3JnL3htcC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgeG1wTU06RG9jdW1lbnRJRD0iZ2ltcDpkb2NpZDpnaW1wOjEwNGNlNWFhLTE1YzctNGI4Yi1iOGU1LTFmYWQyNWFiYzBhZCIKICAgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpkNDMyZTY1Zi0xOThhLTQxM2EtYWYyMy1jNzhlNzczNGRlN2QiCiAgIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoyNzExODVkMi03MWZiLTRhZDMtYTJmMi1iNjM3OWU3MDc1OTEiCiAgIGRjOkZvcm1hdD0iaW1hZ2UvcG5nIgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJMaW51eCIKICAgR0lNUDpUaW1lU3RhbXA9IjE2ODQ5NDE4NjYyMzgzMjQiCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4zMCIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgeG1wOkNyZWF0b3JUb29sPSJHSU1QIDIuMTAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo1NGFiYzNkYS1lZWJiLTRlZjctYjdjNS04ZDRjODY5OGVjODMiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoTGludXgpIgogICAgICBzdEV2dDp3aGVuPSIyMDIzLTA1LTI0VDE3OjI0OjI2KzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/Pj0tlUwAAAAJcEhZcwAADdcAAA3XAUIom3gAAAAHdElNRQfnBRgPGBru/VeEAAAABmJLR0QA/wD/AP+gvaeTAAAFO0lEQVRYw9WYe2xTVRzHTx97dYS5B1UHa+/tY12dDoOKWyIGlfgHkCkSNTHGwHxA3NiAP/A5x4CMKEzdYL29YyAyBxKQZbI+NvYIaowaH9Ogi2GRbGjcFrbBNrq2a2/9nq5LCFnbbfSOeZJPTs/t6Tm/7/39zu+cU0IiXc7WSImNX0BsZiVYAhigmah5tHklsZrjSYtJSuZtaeSiiJU3gHUwfC9oARfBIHBP1DzaPH1eRuzmp0E6aTgSNX9EWMwSvOkMGPgG+CpguG8a0H7nA78zkMYqye0V0lYXDSHrYUw7cE5TxM04/b+38+vJ+RPRt0eIjVeAAhhyCQizFDKJEBjndaCY49Di4+CRlzFxfwSE3Ciol9i4DSBujoRUy7HIszFxdwSF3CioBy8qm1g5ufhirHwyJqwHrrDGWTlg8hFL1URN2+EF0XFPkyYuSWwhUVgnT2CygXBG3dFcM7bz1/au1u7OK9/93eWidUlHe1dCc810EsUAsXOPQZCI3rGZ6Wb4EXAEM0SCUFnZduz6T/09l4bHXYOCz+f0+XxeWg+7XYM/4vnKtlqHJHSIOrAHlYMFYmawRNCKycaDGZLVfMRdf/nPDpfXM+abotDnpy93dtzXfNgdZg+im2uimJ6h66UTeIMZsrat1jvkdPRRb/imLt4hl6N3DfqFEIPvOMzDJYspJsWfbUKEyFNttcKoyzkKo4UgYoRRt3OE9guT1br984nsmQ7gCWbIipaj4xeu9v/hFQTPlG7B89+u9v9O+4UQQ8f/BSlaVM8kgBOhji4p9mpvwQ+Wfwddjp6bQw2u8g44HT3535/tTUa/0Eccvg4sFDE1m2PBZkx2LVRqVcLQvG/PDDX1/tVxze38x+UZH6O1He28b764qgwtxOcf327eBGLFE9NikiD3qzDZhVBJgCJH3KubDnkfbD4s5Jw74qM1bcvDnxq8/vHt1SrS9InIJ2m7OQ4UYsKhCB9lJqHj0gPsHJzPvsS9w8rRRPDptI40M8PlH9fOJ5M5K008rsZmIwi5gc4QN9Zja8zn+5epch9PTFepU1iGuVunVqeyS9g0iv8zy96l0WiSjIsXx28iJEJhaONkMGB5YP14bkmI1SzIz1T0pRa9VKnNzCjUMcwWUAS2BtgWYLJN+xTo1OyrOhW7xsAwqnSGkd3i+uGjkT5Xw6DLt3AdEKQNB4YXbdtwQpuVuRtG7pwhxWA7vJgRib0nDuSDvtkIkjYcHE3aVWjRLL9/zyyETPK2Vq3OidAaOhiPDLcbxo3MRIik0eReWPnO15pHHiqbpYhS6hkNw7wAz0To6GM5hAzH3wkDa6b7x4bEwnkUfMnP6idX7Nex7GxElIDNerV6hU6jSdbp9RHck2w0w/FaGGoJm7KtnCfmWNlF1fOrK3Q6bekMRFABO7QM8yxewFLUi+5JSxPpAmcxy0gjt1Rytir4NcHKCfJTH/al5j1j1hr0pWEML55YD+x2GP6cVqNZZjQYEvUsG4vP4v8jKju5L1p6qnytxGKa6qogyOorBpVbXvxMe69xdxABb9I0DAGvIIRWp7NsBsJIoWVZKfaXuf+jMKp2b6z8+Adb4aErNwpCCh5J2pnfoH0ga08g7invBfaQjXjjuQifhyEgLdNolJP5UqR17y+QnSwvk1i565OZK6F8RzubvWwvDH8LvKZnmHXY8HKws+sNLJtI5muJ/7hYElOzJ1V+fN9R7CVDClPJOVXuqo06vS4HQjTwgDKDZRXk/1JiD7wrieFLk6T1lczCXUVK7aPZinS9XrTw+Q+Tql7SUmvGuQAAAABJRU5ErkJggg==",defaultOffset:[-25.5,-32]};const XML_SCHEMA_INSTANCE_URI="http://www.w3.org/2001/XMLSchema-instance";function createElementNS(n,e){return getDocument().createElementNS(n,e)}function getAllTextContent(n,e){return getAllTextContent_(n,e,[]).join("")}function getAllTextContent_(n,e,i){if(n.nodeType==Node.CDATA_SECTION_NODE||n.nodeType==Node.TEXT_NODE)i.push(n.nodeValue);else{let s;for(s=n.firstChild;s;s=s.nextSibling)getAllTextContent_(s,e,i)}return i}function isDocument(n){return"documentElement"in n}function parse$1(n){return new DOMParser().parseFromString(n,"application/xml")}function makeArrayExtender(n,e){return(function(i,s){const o=n.call(e??this,i,s);if(o!==void 0){const l=s[s.length-1];extend$4(l,o)}})}function makeArrayPusher(n,e){return(function(i,s){const o=n.call(e??this,i,s);o!==void 0&&s[s.length-1].push(o)})}function makeReplacer(n,e){return(function(i,s){const o=n.call(this,i,s);o!==void 0&&(s[s.length-1]=o)})}function makeObjectPropertyPusher(n,e,i){return(function(s,o){const l=n.call(this,s,o);if(l!==void 0){const c=o[o.length-1],u=s.localName;let f;u in c?f=c[u]:(f=[],c[u]=f),f.push(l)}})}function makeObjectPropertySetter(n,e,i){return(function(s,o){const l=n.call(this,s,o);if(l!==void 0){const c=o[o.length-1],u=e!==void 0?e:s.localName;c[u]=l}})}function makeChildAppender(n,e){return(function(i,s,o){n.call(this,i,s,o),o[o.length-1].node.appendChild(i)})}function makeArraySerializer(n,e){let i,s;return function(o,l,c){if(i===void 0){i={};const u={};u[o.localName]=n,i[o.namespaceURI]=u,s=makeSimpleNodeFactory(o.localName)}serialize(i,s,l,c)}}function makeSimpleNodeFactory(n,e){return(function(i,s,o){const c=s[s.length-1].node;let u=n;u===void 0&&(u=o);const f=c.namespaceURI;return createElementNS(f,u)})}const OBJECT_PROPERTY_NODE_FACTORY=makeSimpleNodeFactory();function makeSequence(n,e){const i=e.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=n[e[o]];return s}function makeStructureNS(n,e,i){i=i!==void 0?i:{};let s,o;for(s=0,o=n.length;s<o;++s)i[n[s]]=e;return i}function parseNode(n,e,i,s){let o;for(o=e.firstElementChild;o;o=o.nextElementSibling){const l=n[o.namespaceURI];if(l!==void 0){const c=l[o.localName];c!==void 0&&c.call(s,o,i)}}}function pushParseAndPop(n,e,i,s,o){return s.push(n),parseNode(e,i,s,o),s.pop()}function serialize(n,e,i,s,o,l){const c=(o!==void 0?o:i).length;let u,f;for(let g=0;g<c;++g)u=i[g],u!==void 0&&(f=e.call(l,u,s,o!==void 0?o[g]:void 0),f!==void 0&&n[f.namespaceURI][f.localName].call(l,f,u,s))}function pushSerializeAndPop(n,e,i,s,o,l,c){return o.push(n),serialize(e,i,s,o,l,c),o.pop()}let xmlSerializer_;function getXMLSerializer(){return xmlSerializer_===void 0&&typeof XMLSerializer<"u"&&(xmlSerializer_=new XMLSerializer),xmlSerializer_}let document_;function getDocument(){return document_===void 0&&typeof document<"u"&&(document_=document.implementation.createDocument("","",null)),document_}class FeatureFormat{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Feature,this.supportedMediaTypes=null}getReadOptions(e,i){if(i){let s=i.dataProjection?get$3(i.dataProjection):this.readProjection(e);i.extent&&s&&s.getUnits()==="tile-pixels"&&(s=get$3(s),s.setWorldExtent(i.extent)),i={dataProjection:s,featureProjection:i.featureProjection}}return this.adaptOptions(i)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return abstract()}readFeature(e,i){return abstract()}readFeatures(e,i){return abstract()}readGeometry(e,i){return abstract()}readProjection(e){return abstract()}writeFeature(e,i){return abstract()}writeFeatures(e,i){return abstract()}writeGeometry(e,i){return abstract()}}function transformGeometryWithOptions(n,e,i){const s=i?get$3(i.featureProjection):null,o=i?get$3(i.dataProjection):null;let l=n;if(s&&o&&!equivalent$1(s,o)){e&&(l=n.clone());const c=e?s:o,u=e?o:s;c.getUnits()==="tile-pixels"?l.transform(c,u):l.applyTransform(getTransform(c,u))}if(e&&i&&i.decimals!==void 0){const c=Math.pow(10,i.decimals),u=function(f){for(let g=0,H=f.length;g<H;++g)f[g]=Math.round(f[g]*c)/c;return f};l===n&&(l=n.clone()),l.applyTransform(u)}return l}const GeometryConstructor={Point:Point$1,LineString,Polygon,MultiPoint,MultiLineString,MultiPolygon};function orientFlatCoordinates(n,e,i){return Array.isArray(e[0])?(linearRingssAreOriented(n,0,e,i)||(n=n.slice(),orientLinearRingsArray(n,0,e,i)),n):(linearRingsAreOriented(n,0,e,i)||(n=n.slice(),orientLinearRings(n,0,e,i)),n)}function createRenderFeature(n,e){var l;const i=n.geometry;if(!i)return[];if(Array.isArray(i))return i.map(c=>createRenderFeature({...n,geometry:c})).flat();const s=i.type==="MultiPolygon"?"Polygon":i.type;if(s==="GeometryCollection"||s==="Circle")throw new Error("Unsupported geometry type: "+s);const o=i.layout.length;return transformGeometryWithOptions(new RenderFeature(s,s==="Polygon"?orientFlatCoordinates(i.flatCoordinates,i.ends,o):i.flatCoordinates,(l=i.ends)==null?void 0:l.flat(),o,n.properties||{},n.id).enableSimplifyTransformed(),!1,e)}function createGeometry(n,e){if(!n)return null;if(Array.isArray(n)){const s=n.map(o=>createGeometry(o,e));return new GeometryCollection(s)}const i=GeometryConstructor[n.type];return transformGeometryWithOptions(new i(n.flatCoordinates,n.layout||"XY",n.ends),!1,e)}class XMLFeature extends FeatureFormat{constructor(){super(),this.xmlSerializer_=getXMLSerializer()}getType(){return"xml"}readFeature(e,i){if(!e)return null;if(typeof e=="string"){const s=parse$1(e);return this.readFeatureFromDocument(s,i)}return isDocument(e)?this.readFeatureFromDocument(e,i):this.readFeatureFromNode(e,i)}readFeatureFromDocument(e,i){const s=this.readFeaturesFromDocument(e,i);return s.length>0?s[0]:null}readFeatureFromNode(e,i){return null}readFeatures(e,i){if(!e)return[];if(typeof e=="string"){const s=parse$1(e);return this.readFeaturesFromDocument(s,i)}return isDocument(e)?this.readFeaturesFromDocument(e,i):this.readFeaturesFromNode(e,i)}readFeaturesFromDocument(e,i){const s=[];for(let o=e.firstChild;o;o=o.nextSibling)o.nodeType==Node.ELEMENT_NODE&&extend$4(s,this.readFeaturesFromNode(o,i));return s}readFeaturesFromNode(e,i){return abstract()}readGeometry(e,i){if(!e)return null;if(typeof e=="string"){const s=parse$1(e);return this.readGeometryFromDocument(s,i)}return isDocument(e)?this.readGeometryFromDocument(e,i):this.readGeometryFromNode(e,i)}readGeometryFromDocument(e,i){return null}readGeometryFromNode(e,i){return null}readProjection(e){if(!e)return null;if(typeof e=="string"){const i=parse$1(e);return this.readProjectionFromDocument(i)}return isDocument(e)?this.readProjectionFromDocument(e):this.readProjectionFromNode(e)}readProjectionFromDocument(e){return this.dataProjection}readProjectionFromNode(e){return this.dataProjection}writeFeature(e,i){const s=this.writeFeatureNode(e,i);return this.xmlSerializer_.serializeToString(s)}writeFeatureNode(e,i){return null}writeFeatures(e,i){const s=this.writeFeaturesNode(e,i);return this.xmlSerializer_.serializeToString(s)}writeFeaturesNode(e,i){return null}writeGeometry(e,i){const s=this.writeGeometryNode(e,i);return this.xmlSerializer_.serializeToString(s)}writeGeometryNode(e,i){return null}}function readBoolean(n){const e=getAllTextContent(n,!1);return readBooleanString(e)}function readBooleanString(n){const e=/^\s*(true|1)|(false|0)\s*$/.exec(n);if(e)return e[1]!==void 0||!1}function readDateTime(n){const e=getAllTextContent(n,!1),i=Date.parse(e);return isNaN(i)?void 0:i/1e3}function readDecimal(n){const e=getAllTextContent(n,!1);return readDecimalString(e)}function readDecimalString(n){const e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(n);if(e)return parseFloat(e[1])}function readPositiveInteger(n){const e=getAllTextContent(n,!1);return readNonNegativeIntegerString(e)}function readNonNegativeIntegerString(n){const e=/^\s*(\d+)\s*$/.exec(n);if(e)return parseInt(e[1],10)}function readString(n){return getAllTextContent(n,!1).trim()}function writeBooleanTextNode(n,e){writeStringTextNode(n,e?"1":"0")}function writeCDATASection(n,e){n.appendChild(getDocument().createCDATASection(e))}function writeDateTimeTextNode(n,e){const i=new Date(e*1e3),s=i.getUTCFullYear()+"-"+padNumber(i.getUTCMonth()+1,2)+"-"+padNumber(i.getUTCDate(),2)+"T"+padNumber(i.getUTCHours(),2)+":"+padNumber(i.getUTCMinutes(),2)+":"+padNumber(i.getUTCSeconds(),2)+"Z";n.appendChild(getDocument().createTextNode(s))}function writeDecimalTextNode(n,e){const i=e.toPrecision();n.appendChild(getDocument().createTextNode(i))}function writeNonNegativeIntegerTextNode(n,e){const i=e.toString();n.appendChild(getDocument().createTextNode(i))}const whiteSpaceStart=/^\s/,whiteSpaceEnd=/\s$/,cdataCharacters=/(\n|\t|\r|<|&| {2})/;function writeStringTextNode(n,e){typeof e=="string"&&(whiteSpaceStart.test(e)||whiteSpaceEnd.test(e)||cdataCharacters.test(e))?e.split("]]>").forEach((i,s,o)=>{s<o.length-1&&(i+="]]"),s>0&&(i=">"+i),writeCDATASection(n,i)}):n.appendChild(getDocument().createTextNode(e))}const GX_NAMESPACE_URIS=["http://www.google.com/kml/ext/2.2"],NAMESPACE_URIS$4=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],SCHEMA_LOCATION$1="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",ICON_ANCHOR_UNITS_MAP={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},PLACEMARK_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{ExtendedData:extendedDataParser,Region:regionParser,MultiGeometry:makeObjectPropertySetter(readMultiGeometry,"geometry"),LineString:makeObjectPropertySetter(readLineString,"geometry"),LinearRing:makeObjectPropertySetter(readLinearRing,"geometry"),Point:makeObjectPropertySetter(readPoint,"geometry"),Polygon:makeObjectPropertySetter(readPolygon,"geometry"),Style:makeObjectPropertySetter(readStyle$2),StyleMap:placemarkStyleMapParser,address:makeObjectPropertySetter(readString),description:makeObjectPropertySetter(readString),name:makeObjectPropertySetter(readString),open:makeObjectPropertySetter(readBoolean),phoneNumber:makeObjectPropertySetter(readString),styleUrl:makeObjectPropertySetter(readStyleURL),visibility:makeObjectPropertySetter(readBoolean)},makeStructureNS(GX_NAMESPACE_URIS,{MultiTrack:makeObjectPropertySetter(readGxMultiTrack,"geometry"),Track:makeObjectPropertySetter(readGxTrack,"geometry")})),NETWORK_LINK_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{ExtendedData:extendedDataParser,Region:regionParser,Link:linkParser,address:makeObjectPropertySetter(readString),description:makeObjectPropertySetter(readString),name:makeObjectPropertySetter(readString),open:makeObjectPropertySetter(readBoolean),phoneNumber:makeObjectPropertySetter(readString),visibility:makeObjectPropertySetter(readBoolean)}),LINK_PARSERS$1=makeStructureNS(NAMESPACE_URIS$4,{href:makeObjectPropertySetter(readURI)}),CAMERA_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{Altitude:makeObjectPropertySetter(readDecimal),Longitude:makeObjectPropertySetter(readDecimal),Latitude:makeObjectPropertySetter(readDecimal),Tilt:makeObjectPropertySetter(readDecimal),AltitudeMode:makeObjectPropertySetter(readString),Heading:makeObjectPropertySetter(readDecimal),Roll:makeObjectPropertySetter(readDecimal)}),REGION_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{LatLonAltBox:latLonAltBoxParser,Lod:lodParser}),KML_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["Document","Placemark"]),KML_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{Document:makeChildAppender(writeDocument),Placemark:makeChildAppender(writePlacemark)});let DEFAULT_COLOR,DEFAULT_FILL_STYLE=null,DEFAULT_IMAGE_STYLE_ANCHOR,DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS,DEFAULT_IMAGE_STYLE_SIZE,DEFAULT_IMAGE_STYLE_SRC,DEFAULT_IMAGE_STYLE=null,DEFAULT_NO_IMAGE_STYLE,DEFAULT_STROKE_STYLE=null,DEFAULT_TEXT_STROKE_STYLE,DEFAULT_TEXT_STYLE=null,DEFAULT_STYLE$1=null,DEFAULT_STYLE_ARRAY=null;function scaleForSize(n){return 32/Math.min(n[0],n[1])}function createStyleDefaults(){DEFAULT_COLOR=[255,255,255,1],DEFAULT_FILL_STYLE=new Fill({color:DEFAULT_COLOR}),DEFAULT_IMAGE_STYLE_ANCHOR=[20,2],DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS="pixels",DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS="pixels",DEFAULT_IMAGE_STYLE_SIZE=[64,64],DEFAULT_IMAGE_STYLE_SRC="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",DEFAULT_IMAGE_STYLE=new Icon({anchor:DEFAULT_IMAGE_STYLE_ANCHOR,anchorOrigin:"bottom-left",anchorXUnits:DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,anchorYUnits:DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS,crossOrigin:"anonymous",rotation:0,scale:scaleForSize(DEFAULT_IMAGE_STYLE_SIZE),size:DEFAULT_IMAGE_STYLE_SIZE,src:DEFAULT_IMAGE_STYLE_SRC}),DEFAULT_NO_IMAGE_STYLE="NO_IMAGE",DEFAULT_STROKE_STYLE=new Stroke({color:DEFAULT_COLOR,width:1}),DEFAULT_TEXT_STROKE_STYLE=new Stroke({color:[51,51,51,1],width:2}),DEFAULT_TEXT_STYLE=new Text({font:"bold 16px Helvetica",fill:DEFAULT_FILL_STYLE,stroke:DEFAULT_TEXT_STROKE_STYLE,scale:.8}),DEFAULT_STYLE$1=new Style$1({fill:DEFAULT_FILL_STYLE,image:DEFAULT_IMAGE_STYLE,text:DEFAULT_TEXT_STYLE,stroke:DEFAULT_STROKE_STYLE,zIndex:0}),DEFAULT_STYLE_ARRAY=[DEFAULT_STYLE$1]}let TEXTAREA;function defaultIconUrlFunction(n){return n}let KML$1=class extends XMLFeature{constructor(e){super(),e=e||{},DEFAULT_STYLE_ARRAY||createStyleDefaults(),this.dataProjection=get$3("EPSG:4326"),this.defaultStyle_=e.defaultStyle?e.defaultStyle:DEFAULT_STYLE_ARRAY,this.extractStyles_=e.extractStyles!==void 0?e.extractStyles:!0,this.writeStyles_=e.writeStyles!==void 0?e.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=e.showPointNames!==void 0?e.showPointNames:!0,this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",this.iconUrlFunction_=e.iconUrlFunction?e.iconUrlFunction:defaultIconUrlFunction,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(e,i){const s=makeStructureNS(NAMESPACE_URIS$4,{Document:makeArrayExtender(this.readDocumentOrFolder_,this),Folder:makeArrayExtender(this.readDocumentOrFolder_,this),Placemark:makeArrayPusher(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),o=pushParseAndPop([],s,e,i,this);if(o)return o}readPlacemark_(e,i){const s=pushParseAndPop({geometry:null},PLACEMARK_PARSERS,e,i,this);if(!s)return;const o=new Feature,l=e.getAttribute("id");l!==null&&o.setId(l);const c=i[0],u=s.geometry;if(u&&transformGeometryWithOptions(u,!1,c),o.setGeometry(u),delete s.geometry,this.extractStyles_){const f=s.Style,g=s.styleUrl,H=createFeatureStyleFunction(f,g,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);o.setStyle(H)}return delete s.Style,o.setProperties(s,!0),o}readSharedStyle_(e,i){const s=e.getAttribute("id");if(s!==null){const o=readStyle$2.call(this,e,i);if(o){let l,c=e.baseURI;(!c||c=="about:blank")&&(c=window.location.href),c?l=new URL("#"+s,c).href:l="#"+s,this.sharedStyles_[l]=o}}}readSharedStyleMap_(e,i){const s=e.getAttribute("id");if(s===null)return;const o=readStyleMapValue.call(this,e,i);if(!o)return;let l,c=e.baseURI;(!c||c=="about:blank")&&(c=window.location.href),c?l=new URL("#"+s,c).href:l="#"+s,this.sharedStyles_[l]=o}readFeatureFromNode(e,i){if(!NAMESPACE_URIS$4.includes(e.namespaceURI))return null;const s=this.readPlacemark_(e,[this.getReadOptions(e,i)]);return s||null}readFeaturesFromNode(e,i){if(!NAMESPACE_URIS$4.includes(e.namespaceURI))return[];let s;const o=e.localName;if(o=="Document"||o=="Folder")return s=this.readDocumentOrFolder_(e,[this.getReadOptions(e,i)]),s||[];if(o=="Placemark"){const l=this.readPlacemark_(e,[this.getReadOptions(e,i)]);return l?[l]:[]}if(o=="kml"){s=[];for(let l=e.firstElementChild;l;l=l.nextElementSibling){const c=this.readFeaturesFromNode(l,i);c&&extend$4(s,c)}return s}return[]}readName(e){if(e){if(typeof e=="string"){const i=parse$1(e);return this.readNameFromDocument(i)}return isDocument(e)?this.readNameFromDocument(e):this.readNameFromNode(e)}}readNameFromDocument(e){for(let i=e.firstChild;i;i=i.nextSibling)if(i.nodeType==Node.ELEMENT_NODE){const s=this.readNameFromNode(i);if(s)return s}}readNameFromNode(e){for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(NAMESPACE_URIS$4.includes(i.namespaceURI)&&i.localName=="name")return readString(i);for(let i=e.firstElementChild;i;i=i.nextElementSibling){const s=i.localName;if(NAMESPACE_URIS$4.includes(i.namespaceURI)&&(s=="Document"||s=="Folder"||s=="Placemark"||s=="kml")){const o=this.readNameFromNode(i);if(o)return o}}}readNetworkLinks(e){const i=[];if(typeof e=="string"){const s=parse$1(e);extend$4(i,this.readNetworkLinksFromDocument(s))}else isDocument(e)?extend$4(i,this.readNetworkLinksFromDocument(e)):extend$4(i,this.readNetworkLinksFromNode(e));return i}readNetworkLinksFromDocument(e){const i=[];for(let s=e.firstChild;s;s=s.nextSibling)s.nodeType==Node.ELEMENT_NODE&&extend$4(i,this.readNetworkLinksFromNode(s));return i}readNetworkLinksFromNode(e){const i=[];for(let s=e.firstElementChild;s;s=s.nextElementSibling)if(NAMESPACE_URIS$4.includes(s.namespaceURI)&&s.localName=="NetworkLink"){const o=pushParseAndPop({},NETWORK_LINK_PARSERS,s,[]);i.push(o)}for(let s=e.firstElementChild;s;s=s.nextElementSibling){const o=s.localName;NAMESPACE_URIS$4.includes(s.namespaceURI)&&(o=="Document"||o=="Folder"||o=="kml")&&extend$4(i,this.readNetworkLinksFromNode(s))}return i}readRegion(e){const i=[];if(typeof e=="string"){const s=parse$1(e);extend$4(i,this.readRegionFromDocument(s))}else isDocument(e)?extend$4(i,this.readRegionFromDocument(e)):extend$4(i,this.readRegionFromNode(e));return i}readRegionFromDocument(e){const i=[];for(let s=e.firstChild;s;s=s.nextSibling)s.nodeType==Node.ELEMENT_NODE&&extend$4(i,this.readRegionFromNode(s));return i}readRegionFromNode(e){const i=[];for(let s=e.firstElementChild;s;s=s.nextElementSibling)if(NAMESPACE_URIS$4.includes(s.namespaceURI)&&s.localName=="Region"){const o=pushParseAndPop({},REGION_PARSERS,s,[]);i.push(o)}for(let s=e.firstElementChild;s;s=s.nextElementSibling){const o=s.localName;NAMESPACE_URIS$4.includes(s.namespaceURI)&&(o=="Document"||o=="Folder"||o=="kml")&&extend$4(i,this.readRegionFromNode(s))}return i}readCamera(e){const i=[];if(typeof e=="string"){const s=parse$1(e);extend$4(i,this.readCameraFromDocument(s))}else isDocument(e)?extend$4(i,this.readCameraFromDocument(e)):extend$4(i,this.readCameraFromNode(e));return i}readCameraFromDocument(e){const i=[];for(let s=e.firstChild;s;s=s.nextSibling)s.nodeType===Node.ELEMENT_NODE&&extend$4(i,this.readCameraFromNode(s));return i}readCameraFromNode(e){const i=[];for(let s=e.firstElementChild;s;s=s.nextElementSibling)if(NAMESPACE_URIS$4.includes(s.namespaceURI)&&s.localName==="Camera"){const o=pushParseAndPop({},CAMERA_PARSERS,s,[]);i.push(o)}for(let s=e.firstElementChild;s;s=s.nextElementSibling){const o=s.localName;NAMESPACE_URIS$4.includes(s.namespaceURI)&&(o==="Document"||o==="Folder"||o==="Placemark"||o==="kml")&&extend$4(i,this.readCameraFromNode(s))}return i}writeFeaturesNode(e,i){i=this.adaptOptions(i);const s=createElementNS(NAMESPACE_URIS$4[4],"kml"),o="http://www.w3.org/2000/xmlns/";s.setAttributeNS(o,"xmlns:gx",GX_NAMESPACE_URIS[0]),s.setAttributeNS(o,"xmlns:xsi",XML_SCHEMA_INSTANCE_URI),s.setAttributeNS(XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",SCHEMA_LOCATION$1);const l={node:s},c={};e.length>1?c.Document=e:e.length==1&&(c.Placemark=e[0]);const u=KML_SEQUENCE[s.namespaceURI],f=makeSequence(c,u);return pushSerializeAndPop(l,KML_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,f,[i],u,this),s}};function createNameStyleFunction(n,e){const i=[0,0];let s="start";const o=n.getImage();if(o){const u=o.getSize();if(u&&u.length==2){const f=o.getScaleArray(),g=o.getAnchor();i[0]=f[0]*(u[0]-g[0]),i[1]=f[1]*(u[1]/2-g[1]),s="left"}}let l=n.getText();return l?(l=l.clone(),l.setFont(l.getFont()||DEFAULT_TEXT_STYLE.getFont()),l.setScale(l.getScale()||DEFAULT_TEXT_STYLE.getScale()),l.setFill(l.getFill()||DEFAULT_TEXT_STYLE.getFill()),l.setStroke(l.getStroke()||DEFAULT_TEXT_STROKE_STYLE)):l=DEFAULT_TEXT_STYLE.clone(),l.setText(e),l.setOffsetX(i[0]),l.setOffsetY(i[1]),l.setTextAlign(s),new Style$1({image:o,text:l})}function createFeatureStyleFunction(n,e,i,s,o){return(function(l,c){let u=o,f="",g=[];if(u){const Y=l.getGeometry();if(Y)if(Y instanceof GeometryCollection)g=Y.getGeometriesArrayRecursive().filter(function(ee){const te=ee.getType();return te==="Point"||te==="MultiPoint"}),u=g.length>0;else{const ee=Y.getType();u=ee==="Point"||ee==="MultiPoint"}}u&&(f=l.get("name"),u=u&&!!f,u&&/&[^&]+;/.test(f)&&(TEXTAREA||(TEXTAREA=document.createElement("textarea")),TEXTAREA.innerHTML=f,f=TEXTAREA.value));let H=i;if(n?H=n:e&&(H=findStyle(e,i,s)),u){const Y=createNameStyleFunction(H[0],f);if(g.length>0){Y.setGeometry(new GeometryCollection(g));const ee=new Style$1({geometry:H[0].getGeometry(),image:null,fill:H[0].getFill(),stroke:H[0].getStroke(),text:null});return[Y,ee].concat(H.slice(1))}return Y}return H})}function findStyle(n,e,i){return Array.isArray(n)?n:typeof n=="string"?findStyle(i[n],e,i):e}function readColor(n){const e=getAllTextContent(n,!1),i=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(i){const s=i[1];return[parseInt(s.substr(6,2),16),parseInt(s.substr(4,2),16),parseInt(s.substr(2,2),16),parseInt(s.substr(0,2),16)/255]}}function readFlatCoordinates(n){let e=getAllTextContent(n,!1);const i=[];e=e.replace(/\s*,\s*/g,",");const s=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let o;for(;o=s.exec(e);){const l=parseFloat(o[1]),c=parseFloat(o[2]),u=o[3]?parseFloat(o[3]):0;i.push(l,c,u),e=e.substr(o[0].length)}if(e==="")return i}function readURI(n){const e=getAllTextContent(n,!1).trim();let i=n.baseURI;return(!i||i=="about:blank")&&(i=window.location.href),i?new URL(e,i).href:e}function readStyleURL(n){const e=getAllTextContent(n,!1).trim().replace(/^(?!.*#)/,"#");let i=n.baseURI;return(!i||i=="about:blank")&&(i=window.location.href),i?new URL(e,i).href:e}function readVec2(n){const e=n.getAttribute("xunits"),i=n.getAttribute("yunits");let s;return e!=="insetPixels"?i!=="insetPixels"?s="bottom-left":s="top-left":i!=="insetPixels"?s="bottom-right":s="top-right",{x:parseFloat(n.getAttribute("x")),xunits:ICON_ANCHOR_UNITS_MAP[e],y:parseFloat(n.getAttribute("y")),yunits:ICON_ANCHOR_UNITS_MAP[i],origin:s}}function readScale(n){return readDecimal(n)}const STYLE_MAP_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{Pair:pairDataParser});function readStyleMapValue(n,e){return pushParseAndPop(void 0,STYLE_MAP_PARSERS,n,e,this)}const ICON_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{Icon:makeObjectPropertySetter(readIcon),color:makeObjectPropertySetter(readColor),heading:makeObjectPropertySetter(readDecimal),hotSpot:makeObjectPropertySetter(readVec2),scale:makeObjectPropertySetter(readScale)});function iconStyleParser(n,e){const i=pushParseAndPop({},ICON_STYLE_PARSERS,n,e);if(!i)return;const s=e[e.length-1],o="Icon"in i?i.Icon:{},l=!("Icon"in i)||Object.keys(o).length>0;let c;const u=o.href;u?c=u:l&&(c=DEFAULT_IMAGE_STYLE_SRC);let f,g,H,Y="bottom-left";const ee=i.hotSpot;ee?(f=[ee.x,ee.y],g=ee.xunits,H=ee.yunits,Y=ee.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(c)&&(c.includes("pushpin")?(f=DEFAULT_IMAGE_STYLE_ANCHOR,g=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,H=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS):c.includes("arrow-reverse")?(f=[54,42],g=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,H=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS):c.includes("paddle")&&(f=[32,1],g=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,H=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS));let te;const ne=o.x,Ye=o.y;ne!==void 0&&Ye!==void 0&&(te=[ne,Ye]);let xe;const tt=o.w,et=o.h;tt!==void 0&&et!==void 0&&(xe=[tt,et]);let it;const rt=i.heading;rt!==void 0&&(it=toRadians(rt));const nt=i.scale,at=i.color;if(l){c==DEFAULT_IMAGE_STYLE_SRC&&(xe=DEFAULT_IMAGE_STYLE_SIZE);const st=new Icon({anchor:f,anchorOrigin:Y,anchorXUnits:g,anchorYUnits:H,crossOrigin:this.crossOrigin_,offset:te,offsetOrigin:"bottom-left",rotation:it,scale:nt,size:xe,src:this.iconUrlFunction_(c),color:at}),ot=st.getScaleArray()[0],ut=st.getSize();if(ut===null){const ht=st.getImageState();if(ht===ImageState.IDLE||ht===ImageState.LOADING){const dt=function(){const pt=st.getImageState();if(!(pt===ImageState.IDLE||pt===ImageState.LOADING)){const yt=st.getSize();if(yt&&yt.length==2){const mt=scaleForSize(yt);st.setScale(ot*mt)}st.unlistenImageChange(dt)}};st.listenImageChange(dt),ht===ImageState.IDLE&&st.load()}}else if(ut.length==2){const ht=scaleForSize(ut);st.setScale(ot*ht)}s.imageStyle=st}else s.imageStyle=DEFAULT_NO_IMAGE_STYLE}const LABEL_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{color:makeObjectPropertySetter(readColor),scale:makeObjectPropertySetter(readScale)});function labelStyleParser(n,e){const i=pushParseAndPop({},LABEL_STYLE_PARSERS,n,e);if(!i)return;const s=e[e.length-1],o=new Text({fill:new Fill({color:"color"in i?i.color:DEFAULT_COLOR}),scale:i.scale});s.textStyle=o}const LINE_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{color:makeObjectPropertySetter(readColor),width:makeObjectPropertySetter(readDecimal)});function lineStyleParser(n,e){const i=pushParseAndPop({},LINE_STYLE_PARSERS,n,e);if(!i)return;const s=e[e.length-1],o=new Stroke({color:"color"in i?i.color:DEFAULT_COLOR,width:"width"in i?i.width:1});s.strokeStyle=o}const POLY_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{color:makeObjectPropertySetter(readColor),fill:makeObjectPropertySetter(readBoolean),outline:makeObjectPropertySetter(readBoolean)});function polyStyleParser(n,e){const i=pushParseAndPop({},POLY_STYLE_PARSERS,n,e);if(!i)return;const s=e[e.length-1],o=new Fill({color:"color"in i?i.color:DEFAULT_COLOR});s.fillStyle=o;const l=i.fill;l!==void 0&&(s.fill=l);const c=i.outline;c!==void 0&&(s.outline=c)}const FLAT_LINEAR_RING_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{coordinates:makeReplacer(readFlatCoordinates)});function readFlatLinearRing(n,e){return pushParseAndPop(null,FLAT_LINEAR_RING_PARSERS,n,e)}function gxCoordParser(n,e){const s=e[e.length-1].coordinates,o=getAllTextContent(n,!1),c=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(o);if(c){const u=parseFloat(c[1]),f=parseFloat(c[2]),g=parseFloat(c[3]);s.push([u,f,g])}else s.push([])}const GX_MULTITRACK_GEOMETRY_PARSERS=makeStructureNS(GX_NAMESPACE_URIS,{Track:makeArrayPusher(readGxTrack)});function readGxMultiTrack(n,e){const i=pushParseAndPop([],GX_MULTITRACK_GEOMETRY_PARSERS,n,e);if(i)return new MultiLineString(i)}const GX_TRACK_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{when:whenParser},makeStructureNS(GX_NAMESPACE_URIS,{coord:gxCoordParser}));function readGxTrack(n,e){const i=pushParseAndPop({coordinates:[],whens:[]},GX_TRACK_PARSERS,n,e);if(!i)return;const s=[],o=i.coordinates,l=i.whens;for(let c=0,u=Math.min(o.length,l.length);c<u;++c)o[c].length==3&&s.push(o[c][0],o[c][1],o[c][2],l[c]);return new LineString(s,"XYZM")}const ICON_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{href:makeObjectPropertySetter(readURI)},makeStructureNS(GX_NAMESPACE_URIS,{x:makeObjectPropertySetter(readDecimal),y:makeObjectPropertySetter(readDecimal),w:makeObjectPropertySetter(readDecimal),h:makeObjectPropertySetter(readDecimal)}));function readIcon(n,e){const i=pushParseAndPop({},ICON_PARSERS,n,e);return i||null}const GEOMETRY_FLAT_COORDINATES_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{coordinates:makeReplacer(readFlatCoordinates)});function readFlatCoordinatesFromNode(n,e){return pushParseAndPop(null,GEOMETRY_FLAT_COORDINATES_PARSERS,n,e)}const EXTRUDE_AND_ALTITUDE_MODE_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{extrude:makeObjectPropertySetter(readBoolean),tessellate:makeObjectPropertySetter(readBoolean),altitudeMode:makeObjectPropertySetter(readString)});function readLineString(n,e){const i=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,n,e),s=readFlatCoordinatesFromNode(n,e);if(s){const o=new LineString(s,"XYZ");return o.setProperties(i,!0),o}}function readLinearRing(n,e){const i=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,n,e),s=readFlatCoordinatesFromNode(n,e);if(s){const o=new Polygon(s,"XYZ",[s.length]);return o.setProperties(i,!0),o}}const MULTI_GEOMETRY_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{LineString:makeArrayPusher(readLineString),LinearRing:makeArrayPusher(readLinearRing),MultiGeometry:makeArrayPusher(readMultiGeometry),Point:makeArrayPusher(readPoint),Polygon:makeArrayPusher(readPolygon)});function readMultiGeometry(n,e){const i=pushParseAndPop([],MULTI_GEOMETRY_PARSERS,n,e);if(!i)return null;if(i.length===0)return new GeometryCollection(i);let s,o=!0;const l=i[0].getType();let c;for(let u=1,f=i.length;u<f;++u)if(c=i[u],c.getType()!=l){o=!1;break}if(o){let u,f;if(l=="Point"){const g=i[0];u=g.getLayout(),f=g.getFlatCoordinates();for(let H=1,Y=i.length;H<Y;++H)c=i[H],extend$4(f,c.getFlatCoordinates());s=new MultiPoint(f,u),setCommonGeometryProperties(s,i)}else if(l=="LineString")s=new MultiLineString(i),setCommonGeometryProperties(s,i);else if(l=="Polygon")s=new MultiPolygon(i),setCommonGeometryProperties(s,i);else if(l=="GeometryCollection"||l.startsWith("Multi"))s=new GeometryCollection(i);else throw new Error("Unknown geometry type found")}else s=new GeometryCollection(i);return s}function readPoint(n,e){const i=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,n,e),s=readFlatCoordinatesFromNode(n,e);if(s){const o=new Point$1(s,"XYZ");return o.setProperties(i,!0),o}}const FLAT_LINEAR_RINGS_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{innerBoundaryIs:innerBoundaryIsParser,outerBoundaryIs:outerBoundaryIsParser});function readPolygon(n,e){const i=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,n,e),s=pushParseAndPop([null],FLAT_LINEAR_RINGS_PARSERS,n,e);if(s&&s[0]){const o=s[0],l=[o.length];for(let u=1,f=s.length;u<f;++u)extend$4(o,s[u]),l.push(o.length);const c=new Polygon(o,"XYZ",l);return c.setProperties(i,!0),c}}const STYLE_PARSERS$2=makeStructureNS(NAMESPACE_URIS$4,{IconStyle:iconStyleParser,LabelStyle:labelStyleParser,LineStyle:lineStyleParser,PolyStyle:polyStyleParser});function readStyle$2(n,e){const i=pushParseAndPop({},STYLE_PARSERS$2,n,e,this);if(!i)return null;let s="fillStyle"in i?i.fillStyle:DEFAULT_FILL_STYLE;const o=i.fill;o!==void 0&&!o&&(s=null);let l;"imageStyle"in i?i.imageStyle!=DEFAULT_NO_IMAGE_STYLE&&(l=i.imageStyle):l=DEFAULT_IMAGE_STYLE;const c="textStyle"in i?i.textStyle:DEFAULT_TEXT_STYLE,u="strokeStyle"in i?i.strokeStyle:DEFAULT_STROKE_STYLE,f=i.outline;return f!==void 0&&!f?[new Style$1({geometry:function(g){const H=g.getGeometry(),Y=H.getType();if(Y==="GeometryCollection"){const ee=H;return new GeometryCollection(ee.getGeometriesArrayRecursive().filter(function(te){const ne=te.getType();return ne!=="Polygon"&&ne!=="MultiPolygon"}))}if(Y!=="Polygon"&&Y!=="MultiPolygon")return H},fill:s,image:l,stroke:u,text:c,zIndex:void 0}),new Style$1({geometry:function(g){const H=g.getGeometry(),Y=H.getType();if(Y==="GeometryCollection"){const ee=H;return new GeometryCollection(ee.getGeometriesArrayRecursive().filter(function(te){const ne=te.getType();return ne==="Polygon"||ne==="MultiPolygon"}))}if(Y==="Polygon"||Y==="MultiPolygon")return H},fill:s,stroke:null,zIndex:void 0})]:[new Style$1({fill:s,image:l,stroke:u,text:c,zIndex:void 0})]}function setCommonGeometryProperties(n,e){const i=e.length,s=new Array(e.length),o=new Array(e.length),l=new Array(e.length);let c,u,f;c=!1,u=!1,f=!1;for(let g=0;g<i;++g){const H=e[g];s[g]=H.get("extrude"),o[g]=H.get("tessellate"),l[g]=H.get("altitudeMode"),c=c||s[g]!==void 0,u=u||o[g]!==void 0,f=f||l[g]}c&&n.set("extrude",s),u&&n.set("tessellate",o),f&&n.set("altitudeMode",l)}const DATA_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{displayName:makeObjectPropertySetter(readString),value:makeObjectPropertySetter(readString)});function dataParser(n,e){const i=n.getAttribute("name");parseNode(DATA_PARSERS,n,e);const s=e[e.length-1];i&&s.displayName?s[i]={value:s.value,displayName:s.displayName,toString:function(){return s.value}}:i!==null?s[i]=s.value:s.displayName!==null&&(s[s.displayName]=s.value),delete s.value}const EXTENDED_DATA_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{Data:dataParser,SchemaData:schemaDataParser});function extendedDataParser(n,e){parseNode(EXTENDED_DATA_PARSERS,n,e)}function regionParser(n,e){parseNode(REGION_PARSERS,n,e)}const PAIR_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{Style:makeObjectPropertySetter(readStyle$2),key:makeObjectPropertySetter(readString),styleUrl:makeObjectPropertySetter(readStyleURL)});function pairDataParser(n,e){const i=pushParseAndPop({},PAIR_PARSERS,n,e,this);if(!i)return;const s=i.key;if(s&&s=="normal"){const o=i.styleUrl;o&&(e[e.length-1]=o);const l=i.Style;l&&(e[e.length-1]=l)}}function placemarkStyleMapParser(n,e){const i=readStyleMapValue.call(this,n,e);if(!i)return;const s=e[e.length-1];if(Array.isArray(i))s.Style=i;else if(typeof i=="string")s.styleUrl=i;else throw new Error("`styleMapValue` has an unknown type")}const SCHEMA_DATA_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{SimpleData:simpleDataParser});function schemaDataParser(n,e){parseNode(SCHEMA_DATA_PARSERS,n,e)}function simpleDataParser(n,e){const i=n.getAttribute("name");if(i!==null){const s=readString(n),o=e[e.length-1];o[i]=s}}const LAT_LON_ALT_BOX_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{altitudeMode:makeObjectPropertySetter(readString),minAltitude:makeObjectPropertySetter(readDecimal),maxAltitude:makeObjectPropertySetter(readDecimal),north:makeObjectPropertySetter(readDecimal),south:makeObjectPropertySetter(readDecimal),east:makeObjectPropertySetter(readDecimal),west:makeObjectPropertySetter(readDecimal)});function latLonAltBoxParser(n,e){const i=pushParseAndPop({},LAT_LON_ALT_BOX_PARSERS,n,e);if(!i)return;const s=e[e.length-1],o=[parseFloat(i.west),parseFloat(i.south),parseFloat(i.east),parseFloat(i.north)];s.extent=o,s.altitudeMode=i.altitudeMode,s.minAltitude=parseFloat(i.minAltitude),s.maxAltitude=parseFloat(i.maxAltitude)}const LOD_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{minLodPixels:makeObjectPropertySetter(readDecimal),maxLodPixels:makeObjectPropertySetter(readDecimal),minFadeExtent:makeObjectPropertySetter(readDecimal),maxFadeExtent:makeObjectPropertySetter(readDecimal)});function lodParser(n,e){const i=pushParseAndPop({},LOD_PARSERS,n,e);if(!i)return;const s=e[e.length-1];s.minLodPixels=parseFloat(i.minLodPixels),s.maxLodPixels=parseFloat(i.maxLodPixels),s.minFadeExtent=parseFloat(i.minFadeExtent),s.maxFadeExtent=parseFloat(i.maxFadeExtent)}const INNER_BOUNDARY_IS_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{LinearRing:makeArrayPusher(readFlatLinearRing)});function innerBoundaryIsParser(n,e){const i=pushParseAndPop([],INNER_BOUNDARY_IS_PARSERS,n,e);i.length>0&&e[e.length-1].push(...i)}const OUTER_BOUNDARY_IS_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{LinearRing:makeReplacer(readFlatLinearRing)});function outerBoundaryIsParser(n,e){const i=pushParseAndPop(void 0,OUTER_BOUNDARY_IS_PARSERS,n,e);if(i){const s=e[e.length-1];s[0]=i}}function linkParser(n,e){parseNode(LINK_PARSERS$1,n,e)}function whenParser(n,e){const s=e[e.length-1].whens,o=getAllTextContent(n,!1),l=Date.parse(o);s.push(isNaN(l)?0:l)}function writeColorTextNode(n,e){const i=asArray(e),o=[(i.length==4?i[3]:1)*255,i[2],i[1],i[0]];for(let l=0;l<4;++l){const c=Math.floor(o[l]).toString(16);o[l]=c.length==1?"0"+c:c}writeStringTextNode(n,o.join(""))}function writeCoordinatesTextNode(n,e,i){const s=i[i.length-1],o=s.layout,l=s.stride;let c;if(o=="XY"||o=="XYM")c=2;else if(o=="XYZ"||o=="XYZM")c=3;else throw new Error("Invalid geometry layout");const u=e.length;let f="";if(u>0){f+=e[0];for(let g=1;g<c;++g)f+=","+e[g];for(let g=l;g<u;g+=l){f+=" "+e[g];for(let H=1;H<c;++H)f+=","+e[g+H]}}writeStringTextNode(n,f)}const EXTENDEDDATA_NODE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{Data:makeChildAppender(writeDataNode),value:makeChildAppender(writeDataNodeValue),displayName:makeChildAppender(writeDataNodeName)});function writeDataNode(n,e,i){n.setAttribute("name",e.name);const s={node:n},o=e.value;typeof o=="object"?(o!==null&&o.displayName&&pushSerializeAndPop(s,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[o.displayName],i,["displayName"]),o!==null&&o.value&&pushSerializeAndPop(s,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[o.value],i,["value"])):pushSerializeAndPop(s,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[o],i,["value"])}function writeDataNodeName(n,e){writeStringTextNode(n,e)}function writeDataNodeValue(n,e){writeStringTextNode(n,e)}const DOCUMENT_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{Placemark:makeChildAppender(writePlacemark)}),DOCUMENT_NODE_FACTORY=function(n,e,i){const s=e[e.length-1].node;return createElementNS(s.namespaceURI,"Placemark")};function writeDocument(n,e,i){pushSerializeAndPop({node:n},DOCUMENT_SERIALIZERS,DOCUMENT_NODE_FACTORY,e,i,void 0,this)}const DATA_NODE_FACTORY=makeSimpleNodeFactory("Data");function writeExtendedData(n,e,i){const s={node:n},o=e.names,l=e.values,c=o.length;for(let u=0;u<c;u++)pushSerializeAndPop(s,EXTENDEDDATA_NODE_SERIALIZERS,DATA_NODE_FACTORY,[{name:o[u],value:l[u]}],i)}const ICON_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["href"],makeStructureNS(GX_NAMESPACE_URIS,["x","y","w","h"])),ICON_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{href:makeChildAppender(writeStringTextNode)},makeStructureNS(GX_NAMESPACE_URIS,{x:makeChildAppender(writeDecimalTextNode),y:makeChildAppender(writeDecimalTextNode),w:makeChildAppender(writeDecimalTextNode),h:makeChildAppender(writeDecimalTextNode)})),GX_NODE_FACTORY=function(n,e,i){return createElementNS(GX_NAMESPACE_URIS[0],"gx:"+i)};function writeIcon(n,e,i){const s={node:n},o=i[i.length-1].node;let l=ICON_SEQUENCE[o.namespaceURI],c=makeSequence(e,l);pushSerializeAndPop(s,ICON_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,c,i,l),l=ICON_SEQUENCE[GX_NAMESPACE_URIS[0]],c=makeSequence(e,l),pushSerializeAndPop(s,ICON_SERIALIZERS,GX_NODE_FACTORY,c,i,l)}const ICON_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["scale","heading","Icon","color","hotSpot"]),ICON_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{Icon:makeChildAppender(writeIcon),color:makeChildAppender(writeColorTextNode),heading:makeChildAppender(writeDecimalTextNode),hotSpot:makeChildAppender(writeVec2),scale:makeChildAppender(writeScaleTextNode)});function writeIconStyle(n,e,i){const s={node:n},o={},l=e.getSrc(),c=e.getSize(),u=e.getImageSize(),f={href:l};if(c){f.w=c[0],f.h=c[1];const xe=e.getAnchor(),tt=e.getOrigin();if(tt&&u&&tt[0]!==0&&tt[1]!==c[1]&&(f.x=tt[0],f.y=u[1]-(tt[1]+c[1])),xe&&(xe[0]!==c[0]/2||xe[1]!==c[1]/2)){const et={x:xe[0],xunits:"pixels",y:c[1]-xe[1],yunits:"pixels"};o.hotSpot=et}}o.Icon=f;let g=e.getScaleArray()[0],H=c;if(H===null&&(H=DEFAULT_IMAGE_STYLE_SIZE),H.length==2){const xe=scaleForSize(H);g=g/xe}g!==1&&(o.scale=g);const Y=e.getRotation();Y!==0&&(o.heading=Y);const ee=e.getColor();ee&&(o.color=ee);const te=i[i.length-1].node,ne=ICON_STYLE_SEQUENCE[te.namespaceURI],Ye=makeSequence(o,ne);pushSerializeAndPop(s,ICON_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,Ye,i,ne)}const LABEL_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["color","scale"]),LABEL_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{color:makeChildAppender(writeColorTextNode),scale:makeChildAppender(writeScaleTextNode)});function writeLabelStyle(n,e,i){const s={node:n},o={},l=e.getFill();l&&(o.color=l.getColor());const c=e.getScale();c&&c!==1&&(o.scale=c);const u=i[i.length-1].node,f=LABEL_STYLE_SEQUENCE[u.namespaceURI],g=makeSequence(o,f);pushSerializeAndPop(s,LABEL_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,g,i,f)}const LINE_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["color","width"]),LINE_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{color:makeChildAppender(writeColorTextNode),width:makeChildAppender(writeDecimalTextNode)});function writeLineStyle(n,e,i){const s={node:n},o={color:e.getColor(),width:Number(e.getWidth())||1},l=i[i.length-1].node,c=LINE_STYLE_SEQUENCE[l.namespaceURI],u=makeSequence(o,c);pushSerializeAndPop(s,LINE_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,u,i,c)}const GEOMETRY_TYPE_TO_NODENAME$1={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},GEOMETRY_NODE_FACTORY=function(n,e,i){if(n){const s=e[e.length-1].node;return createElementNS(s.namespaceURI,GEOMETRY_TYPE_TO_NODENAME$1[n.getType()])}},POINT_NODE_FACTORY=makeSimpleNodeFactory("Point"),LINE_STRING_NODE_FACTORY=makeSimpleNodeFactory("LineString"),LINEAR_RING_NODE_FACTORY=makeSimpleNodeFactory("LinearRing"),POLYGON_NODE_FACTORY=makeSimpleNodeFactory("Polygon"),MULTI_GEOMETRY_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{LineString:makeChildAppender(writePrimitiveGeometry),Point:makeChildAppender(writePrimitiveGeometry),Polygon:makeChildAppender(writePolygon),GeometryCollection:makeChildAppender(writeMultiGeometry)});function writeMultiGeometry(n,e,i){const s={node:n},o=e.getType();let l=[],c;if(o==="GeometryCollection")e.getGeometriesArrayRecursive().forEach(function(u){const f=u.getType();if(f==="MultiPoint")l=l.concat(u.getPoints());else if(f==="MultiLineString")l=l.concat(u.getLineStrings());else if(f==="MultiPolygon")l=l.concat(u.getPolygons());else if(f==="Point"||f==="LineString"||f==="Polygon")l.push(u);else throw new Error("Unknown geometry type")}),c=GEOMETRY_NODE_FACTORY;else if(o==="MultiPoint")l=e.getPoints(),c=POINT_NODE_FACTORY;else if(o==="MultiLineString")l=e.getLineStrings(),c=LINE_STRING_NODE_FACTORY;else if(o==="MultiPolygon")l=e.getPolygons(),c=POLYGON_NODE_FACTORY;else throw new Error("Unknown geometry type");pushSerializeAndPop(s,MULTI_GEOMETRY_SERIALIZERS,c,l,i)}const BOUNDARY_IS_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{LinearRing:makeChildAppender(writePrimitiveGeometry)});function writeBoundaryIs(n,e,i){pushSerializeAndPop({node:n},BOUNDARY_IS_SERIALIZERS,LINEAR_RING_NODE_FACTORY,[e],i)}const PLACEMARK_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{ExtendedData:makeChildAppender(writeExtendedData),MultiGeometry:makeChildAppender(writeMultiGeometry),LineString:makeChildAppender(writePrimitiveGeometry),LinearRing:makeChildAppender(writePrimitiveGeometry),Point:makeChildAppender(writePrimitiveGeometry),Polygon:makeChildAppender(writePolygon),Style:makeChildAppender(writeStyle),address:makeChildAppender(writeStringTextNode),description:makeChildAppender(writeStringTextNode),name:makeChildAppender(writeStringTextNode),open:makeChildAppender(writeBooleanTextNode),phoneNumber:makeChildAppender(writeStringTextNode),styleUrl:makeChildAppender(writeStringTextNode),visibility:makeChildAppender(writeBooleanTextNode)}),PLACEMARK_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),EXTENDEDDATA_NODE_FACTORY=makeSimpleNodeFactory("ExtendedData");function writePlacemark(n,e,i){const s={node:n};e.getId()&&n.setAttribute("id",e.getId());const o=e.getProperties(),l={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};l[e.getGeometryName()]=1;const c=Object.keys(o||{}).sort().filter(function(te){return!l[te]}),u=e.getStyleFunction();if(u){const te=u(e,0);if(te){const ne=Array.isArray(te)?te:[te];let Ye=ne;if(e.getGeometry()&&(Ye=ne.filter(function(xe){const tt=xe.getGeometryFunction()(e);if(tt){const et=tt.getType();return et==="GeometryCollection"?tt.getGeometriesArrayRecursive().filter(function(it){const rt=it.getType();return rt==="Point"||rt==="MultiPoint"}).length:et==="Point"||et==="MultiPoint"}})),this.writeStyles_){let xe=ne,tt=ne;e.getGeometry()&&(xe=ne.filter(function(et){const it=et.getGeometryFunction()(e);if(it){const rt=it.getType();return rt==="GeometryCollection"?it.getGeometriesArrayRecursive().filter(function(nt){const at=nt.getType();return at==="LineString"||at==="MultiLineString"}).length:rt==="LineString"||rt==="MultiLineString"}}),tt=ne.filter(function(et){const it=et.getGeometryFunction()(e);if(it){const rt=it.getType();return rt==="GeometryCollection"?it.getGeometriesArrayRecursive().filter(function(nt){const at=nt.getType();return at==="Polygon"||at==="MultiPolygon"}).length:rt==="Polygon"||rt==="MultiPolygon"}})),o.Style={pointStyles:Ye,lineStyles:xe,polyStyles:tt}}if(Ye.length&&o.name===void 0){const xe=Ye[0].getText();xe&&(o.name=xe.getText())}}}const f=i[i.length-1].node,g=PLACEMARK_SEQUENCE[f.namespaceURI],H=makeSequence(o,g);if(pushSerializeAndPop(s,PLACEMARK_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,H,i,g),c.length>0){const te=makeSequence(o,c);pushSerializeAndPop(s,PLACEMARK_SERIALIZERS,EXTENDEDDATA_NODE_FACTORY,[{names:c,values:te}],i)}const Y=i[0];let ee=e.getGeometry();ee&&(ee=transformGeometryWithOptions(ee,!0,Y)),pushSerializeAndPop(s,PLACEMARK_SERIALIZERS,GEOMETRY_NODE_FACTORY,[ee],i)}const PRIMITIVE_GEOMETRY_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["extrude","tessellate","altitudeMode","coordinates"]),PRIMITIVE_GEOMETRY_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{extrude:makeChildAppender(writeBooleanTextNode),tessellate:makeChildAppender(writeBooleanTextNode),altitudeMode:makeChildAppender(writeStringTextNode),coordinates:makeChildAppender(writeCoordinatesTextNode)});function writePrimitiveGeometry(n,e,i){const s=e.getFlatCoordinates(),o={node:n};o.layout=e.getLayout(),o.stride=e.getStride();const l=e.getProperties();l.coordinates=s;const c=i[i.length-1].node,u=PRIMITIVE_GEOMETRY_SEQUENCE[c.namespaceURI],f=makeSequence(l,u);pushSerializeAndPop(o,PRIMITIVE_GEOMETRY_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,f,i,u)}const POLY_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["color","fill","outline"]),POLYGON_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{outerBoundaryIs:makeChildAppender(writeBoundaryIs),innerBoundaryIs:makeChildAppender(writeBoundaryIs)}),INNER_BOUNDARY_NODE_FACTORY=makeSimpleNodeFactory("innerBoundaryIs"),OUTER_BOUNDARY_NODE_FACTORY=makeSimpleNodeFactory("outerBoundaryIs");function writePolygon(n,e,i){const s=e.getLinearRings(),o=s.shift(),l={node:n};pushSerializeAndPop(l,POLYGON_SERIALIZERS,INNER_BOUNDARY_NODE_FACTORY,s,i),pushSerializeAndPop(l,POLYGON_SERIALIZERS,OUTER_BOUNDARY_NODE_FACTORY,[o],i)}const POLY_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{color:makeChildAppender(writeColorTextNode),fill:makeChildAppender(writeBooleanTextNode),outline:makeChildAppender(writeBooleanTextNode)});function writePolyStyle(n,e,i){const s={node:n},o=e.getFill(),l=e.getStroke(),c={color:o?o.getColor():void 0,fill:o?void 0:!1,outline:l?void 0:!1},u=i[i.length-1].node,f=POLY_STYLE_SEQUENCE[u.namespaceURI],g=makeSequence(c,f);pushSerializeAndPop(s,POLY_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,g,i,f)}function writeScaleTextNode(n,e){writeDecimalTextNode(n,Math.round(e*1e6)/1e6)}const STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$4,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$4,{IconStyle:makeChildAppender(writeIconStyle),LabelStyle:makeChildAppender(writeLabelStyle),LineStyle:makeChildAppender(writeLineStyle),PolyStyle:makeChildAppender(writePolyStyle)});function writeStyle(n,e,i){const s={node:n},o={};if(e.pointStyles.length){const f=e.pointStyles[0].getText();f&&(o.LabelStyle=f);const g=e.pointStyles[0].getImage();g&&typeof g.getSrc=="function"&&(o.IconStyle=g)}if(e.lineStyles.length){const f=e.lineStyles[0].getStroke();f&&(o.LineStyle=f)}if(e.polyStyles.length){const f=e.polyStyles[0].getStroke();f&&!o.LineStyle&&(o.LineStyle=f),o.PolyStyle=e.polyStyles[0]}const l=i[i.length-1].node,c=STYLE_SEQUENCE[l.namespaceURI],u=makeSequence(o,c);pushSerializeAndPop(s,STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,u,i,c)}function writeVec2(n,e){n.setAttribute("x",String(e.x)),n.setAttribute("y",String(e.y)),n.setAttribute("xunits",e.xunits),n.setAttribute("yunits",e.yunits)}var ColorUtils={hex:function(n){if(n>255)throw new Error("'"+n+"'' is greater than 255(0xff);");var e=Number(n).toString(16);return("0"+e).slice(-2)},num:function(n){return parseInt(n,16)},arrayToRgba:function(n){if(!Array.isArray(n))throw new Error("Not an array !");var e=n[0],i=n[1],s=n[2],o=n[3]||1,l="rgba("+e+", "+i+", "+s+", "+parseFloat(o)+")";return l},arrayToHex:function(n){if(!Array.isArray(n))throw new Error("Not an array !");var e=n[0],i=n[1],s=n[2],o=n[3],l=[this.hex(e),this.hex(i),this.hex(s)],c={};return c.hex="#"+l.join(""),o&&(c.opacity=parseFloat(o)),c},rgbaToHex:function(n){var e=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(0?.?\d+)\s*)?\)/,i=e.exec(n);if(!i)throw new Error("Invalid format: "+n);var s=i[1],o=i[2],l=i[3],c=i[4],u=[this.hex(s),this.hex(o),this.hex(l)],f={};return f.hex="#"+u.join(""),c&&(f.opacity=parseFloat(c)),f},hexToRgba:function(n,e){var i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;if(!n)throw new Error("Invalid format");n=n.replace(i,function(l,c,u,f){return c+c+u+u+f+f});var s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);s=s?{r:parseInt(s[1],16),g:parseInt(s[2],16),b:parseInt(s[3],16)}:null;var o=s?"rgba("+s.r+", "+s.g+", "+s.b+", "+e+")":null;return o},isHex:function(n){if(!n||n.charAt(0)!=="#")return!1;var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,i=e.exec(n);return!!i},isRGB:function(n){if(!n)return!1;var e=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(0?.?\d+)\s*)?\)/,i=e.exec(n);return!!i}},logger$D=LoggerByDefault.getLogger("styling");Feature.prototype.setPropertyFill=function(){var n=this.getStyle();if(n&&!(Array.isArray(n)&&n.length===0)){var e=n.getFill();if(e){var i=e.getColor();if(Array.isArray(i)){var s="rgba(";s+=i[0]+",",s+=i[1]+",",s+=i[2]+",",s+=i[3]+")",i=s}if(ColorUtils.isRGB(i)){var o=ColorUtils.rgbaToHex(i);this.set("fill",o.hex),this.set("fill-opacity",o.opacity)}else this.set("fill",i),this.set("fill-opacity",1)}}};Feature.prototype.setPropertyStroke=function(){var n=this.getStyle();if(n&&!(Array.isArray(n)&&n.length===0)){var e=n.getStroke();if(e){var i=e.getColor();if(Array.isArray(i)){var s="rgba(";s+=i[0]+",",s+=i[1]+",",s+=i[2]+",",s+=i[3]+")",i=s}if(ColorUtils.isRGB(i)){var o=ColorUtils.rgbaToHex(i);this.set("stroke",o.hex),this.set("stroke-opacity",o.opacity)}else this.set("stroke",i),this.set("stroke-opacity",1);this.set("stroke-width",e.getWidth())}}};Feature.prototype.setPropertyLabel=function(){var n=this.getStyle();if(n&&!(Array.isArray(n)&&n.length===0)){var e=this.get("name")!==void 0,i=n.getText();if(i&&e){var s=n.getText().getFill();if(s){var o=s.getColor();if(Array.isArray(o)){var l="rgba(";l+=o[0]+",",l+=o[1]+",",l+=o[2]+",",l+=o[3]+")",o=l}if(ColorUtils.isRGB(o)){var c=ColorUtils.rgbaToHex(o);this.set("label-fill",c.hex),this.set("label-fill-opacity",c.opacity)}else this.set("label-fill",o),this.set("label-fill-opacity",1)}var u=n.getText().getStroke();if(u){var f=u.getColor();if(Array.isArray(f)){var g="rgba(";g+=f[0]+",",g+=f[1]+",",g+=f[2]+",",g+=f[3]+")",f=g}if(ColorUtils.isRGB(f)){var H=ColorUtils.rgbaToHex(f);this.set("label-stroke",H.hex),this.set("label-stroke-opacity",H.opacity)}else this.set("label-stroke",f),this.set("label-stroke-opacity",1);this.set("label-stroke-width",u.getWidth())}this.set("label-font",n.getText().getFont()||Styling.DEFAULT_TEXT.font),this.set("label-textAlign",n.getText().getTextAlign()||Styling.DEFAULT_TEXT.textAlign)}}};Feature.prototype.setPropertyMarker=function(){var n=this.getStyle();if(n&&!(Array.isArray(n)&&n.length===0)){var e=n.getImage();if(e)if(e instanceof Icon){var i=e.getColor();if(Array.isArray(i)){var s="rgba(";s+=i[0]+",",s+=i[1]+",",s+=i[2]+",",s+=i[3]+")",i=s}if(i){var o=ColorUtils.rgbaToHex(i);this.set("marker-color",o.hex)}var l=e.getScale();switch(Math.round(l*2)/2){case 0:case .5:this.set("marker-size","small");break;case 1:this.set("marker-size","medium");break;case 1.5:case 2:this.set("marker-size","large");break}var c=e.getSrc();c&&this.set("marker-symbol",c),this.unset("circle-fill"),this.unset("circle-fill-opacity"),this.unset("circle-stroke"),this.unset("circle-stroke-width"),this.unset("circle-stroke-opacity"),this.unset("circle-radius")}else{var u=e.getFill();if(u){var f=u.getColor();if(Array.isArray(f)){var g="rgba(";g+=f[0]+",",g+=f[1]+",",g+=f[2]+",",g+=f[3]+")",f=g}if(ColorUtils.isRGB(f)){var H=ColorUtils.rgbaToHex(f);this.set("circle-fill",H.hex),this.set("circle-fill-opacity",H.opacity)}else this.set("circle-fill",f),this.set("circle-fill-opacity",1)}var Y=e.getStroke();if(Y){var ee=Y.getColor();if(Array.isArray(ee)){var te="rgba(";te+=ee[0]+",",te+=ee[1]+",",te+=ee[2]+",",te+=ee[3]+")",ee=te}if(ColorUtils.isRGB(ee)){var ne=ColorUtils.rgbaToHex(ee);this.set("circle-stroke",ne.hex),this.set("circle-stroke-opacity",ne.opacity)}else this.set("circle-stroke",ee),this.set("circle-stroke-opacity",1);this.set("circle-stroke-width",Y.getWidth())}var Ye=e.getRadius();this.set("circle-radius",Ye)}}};var Styling={APPLY_CONVERT_GEOM_GPX:!0,DEFAULT_ICON:{src:Marker.lightOrange,anchor:[.5,1],scale:1},DEFAULT_CIRCLE:{radius:10,fill:{opacity:1,color:[0,0,0,1]},stroke:{width:1,opacity:1,color:[0,0,0,1]}},DEFAULT_STROKE:{width:5,opacity:1,color:[250,250,250,1]},DEFAULT_FILL:{opacity:1,color:[0,0,0,1]},DEFAULT_TEXT:{font:"16px sans",textAlign:"left",stroke:{color:[250,250,250,1],width:5,opactity:1},fill:{opacity:1,color:[0,0,0,1]}},getListTags:function(){return["type","fill","fill-opacity","stroke","stroke-opacity","stroke-width","circle-fill","circle-fill-opacity","circle-stroke","circle-stroke-opacity","circle-stroke-width","circle-radius","marker-symbol","marker-color","marker-size","label-fill","label-fill-opacity","label-stroke","label-stroke-width","label-stroke-opacity","label-font","label-textAlign"]},defineStyleFromProperties:function(n){var e=null,i={},s=null;if(n.get("marker-color")||n.get("marker-size")||n.get("marker-symbol")){s={},s.src=this.DEFAULT_ICON.src,s.anchor=this.DEFAULT_ICON.anchor;var o=n.get("marker-symbol");o&&o.search("data:image/png;base64")!==-1&&(s.src=o);var l=n.get("marker-color");ColorUtils.isHex(l)&&(s.color=ColorUtils.hexToRgba(l,1));var c=n.get("marker-size");if(c)switch(c){case"small":s.scale=.5;break;case"medium":s.scale=1;break;case"large":s.scale=1.5;break;default:s.scale=this.DEFAULT_ICON.scale;break}}var u=null;(n.get("stroke")||n.get("stroke-opacity")||n.get("stroke-width"))&&(u={},u.color=ColorUtils.hexToRgba(n.get("stroke"),+n.get("stroke-opacity")||this.DEFAULT_STROKE.opacity),u.width=+n.get("stroke-width")||this.DEFAULT_STROKE.width);var f=null;(n.get("fill")||n.get("fill-opacity"))&&(f={},f.color=ColorUtils.hexToRgba(n.get("fill"),+n.get("fill-opacity")||this.DEFAULT_FILL.opacity));var g=null,H=null,Y=n.get("name")!=="";Y&&((n.get("label-fill")||n.get("label-fill-opacity"))&&(H={},H.color=ColorUtils.hexToRgba(n.get("label-fill"),+n.get("label-fill-opacity")||this.DEFAULT_TEXT.fill.opacity)),(n.get("label-stroke")||n.get("label-stroke-opacity")||n.get("label-stroke-width"))&&(g={},g.color=ColorUtils.hexToRgba(n.get("label-stroke"),+n.get("label-stroke-opacity")||this.DEFAULT_TEXT.stroke.opacity),g.width=+n.get("label-stroke-width")||this.DEFAULT_TEXT.stroke.width));var ee=n.get("circle-radius")||this.DEFAULT_CIRCLE.radius,te=null;(n.get("circle-stroke")||n.get("circle-stroke-opacity")||n.get("circle-stroke-width"))&&(te={},te.color=ColorUtils.hexToRgba(n.get("circle-stroke"),+n.get("circle-stroke-opacity")||this.DEFAULT_CIRCLE.stroke.opacity),te.width=+n.get("circle-stroke-width")||this.DEFAULT_CIRCLE.stroke.width);var ne=null;if((n.get("circle-fill")||n.get("circle-fill-opacity"))&&(ne={},ne.color=ColorUtils.hexToRgba(n.get("circle-fill"),+n.get("circle-fill-opacity")||this.DEFAULT_CIRCLE.fill.opacity)),n.getGeometry()){var Ye=n.getGeometry().getType();switch(Ye){case"Circle":case"Point":case"MultiPoint":var xe=!1,tt={};if(te&&(tt.stroke=new Stroke(te)),ne&&(tt.fill=new Fill(ne)),Object.keys(tt).length!==0&&(xe=!0,tt.radius=+ee,i.image=new CircleStyle(tt)),s&&(i.image=new Icon(s)),Y){var et={};if(g&&(et.stroke=new Stroke(g)),H&&(et.fill=new Fill(H)),Object.keys(et).length!==0)et.text=n.get("name"),et.textAlign=n.get("label-textAlign")||this.DEFAULT_TEXT.textAlign,et.font=n.get("label-font")||this.DEFAULT_TEXT.font,i.text=new Text(Object.assign({},this.DEFAULT_TEXT,et));else if(s||xe){var it=new Text(Object.assign({},this.DEFAULT_TEXT,{fill:new Fill(this.DEFAULT_TEXT.fill),stroke:new Stroke(this.DEFAULT_TEXT.stroke)}));if(it){var rt=it.clone();rt.setText(n.get("name")),i.text=rt}}}break;case"Polygon":case"MultiPolygon":u&&(i.stroke=new Stroke(u)),f&&(i.fill=new Fill(f));break;case"LineString":case"MultiLineString":if(u&&(i.stroke=new Stroke(u)),this.APPLY_CONVERT_GEOM_GPX&&f){var nt=n.get("type");if(nt&&(nt==="Polygon"||nt==="MultiPolygon")){i.fill=new Fill(f);var at=n.clone(),st=Ye==="LineString"?Polygon:MultiPolygon;n.setGeometry(new st([at.getGeometry().getCoordinates()]))}}break}}return Object.keys(i).length!==0&&(e=new Style$1(i)),e},defineStyleFunctionByDefault:function(n){if(!n)return[];if(Object.keys(n).length===0)return[];var e=(i,s)=>{if(i.getGeometry()){var o=null,l=i.getGeometry().getType();switch(l){case"Point":case"MultiPoint":var c={};if(n.getImage()&&(c.image=n.getImage()),n.getText()&&i.get("name")){var u=n.getText().clone();u.setText(i.get("name")),c.text=u}o=new Style$1(c);break;case"Circle":var f={},g={};if(n.getFill()&&(g.fill=n.getFill()),n.getStroke()&&(g.stroke=n.getStroke()),n.getText()&&i.get("name")){var H=n.getText().clone();H.setText(i.get("name")),f.text=H}Object.keys(g).length!==0&&(g.radius=3,f.image=new CircleStyle(g)),o=new Style$1(f);break;case"Polygon":case"MultiPolygon":var Y={};n.getFill()&&(Y.fill=n.getFill()),n.getStroke()&&(Y.stroke=n.getStroke()),o=new Style$1(Y);break;case"LineString":case"LinearRing":case"MultiLineString":var ee={};n.getStroke()&&(ee.stroke=n.getStroke()),o=new Style$1(ee);break}return[o]}};return e},definePropertiesFromStyleByType:function(n){if(n.getGeometry()){var e=n.getGeometry().getType();switch(e){case"Point":case"MultiPoint":n.setPropertyMarker(),n.setPropertyLabel();break;case"LineString":case"MultiLineString":n.setPropertyStroke();break;case"Polygon":case"MultiPolygon":n.setPropertyStroke(),n.setPropertyFill();break}}},definePropertiesFromStyle:function(n){var e=n.getStyle()||n.getStyleFunction();if(e){if(typeof e=="function"){var i=e.call(this,n,0);if(i&&i.length!==0)e=Array.isArray(i)?i[0]:i,n.setStyle(e);else return}this.definePropertiesFromStyleByType(n)}},defineTagFromStyle:function(n,e){return logger$D.trace("todo..."),null}},logger$C=LoggerByDefault.getLogger("parser"),Parser$1={parse:function(n){var e=null,i=null,s=typeof window<"u"?window:null;if(typeof exports=="object"&&window===null){var o=require("@xmldom/xmldom").DOMParser;i=new o,e=i.parseFromString(n,"text/xml")}else s.DOMParser?(i=new s.DOMParser,e=i.parseFromString(n,"text/xml")):s.ActiveXObject?(e=new s.ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.loadXML(n)):logger$C.log("Incompatible environment for DOM Parser !");var l=e.querySelector("parsererror");return l?(console.error(l),null):(logger$C.trace(e),e)},toString:function(n){var e=new XMLSerializer,i=e.serializeToString(n);return logger$C.trace(i),i},format:function(n){var e=/(>)\s*(<)(\/*)/g,i=/ *(.*) +\n/g,s=/(<.+>)(.+\n)/g;n=n.replace(e,`$1
$2$3`).replace(i,`$1
`).replace(s,`$1
$2`);for(var o="",l=n.split(`
`),c=0,u="other",f={"single->single":0,"single->closing":-1,"single->opening":0,"single->other":0,"closing->single":0,"closing->closing":-1,"closing->opening":0,"closing->other":0,"opening->single":1,"opening->closing":0,"opening->opening":1,"opening->other":1,"other->single":0,"other->closing":-1,"other->opening":0,"other->other":0},g=0;g<l.length;g++){var H=l[g],Y=!!H.match(/<.+\/>/),ee=!!H.match(/<\/.+>/),te=!!H.match(/<[^!].*>/),ne=Y?"single":ee?"closing":te?"opening":"other",Ye=u+"->"+ne;u=ne;var xe="";c+=f[Ye];for(var tt=0;tt<c;tt++)xe+="	";Ye==="opening->closing"?o=o.substr(0,o.length-1)+H+`
`:o+=xe+H+`
`}return logger$C.trace(o),o}},logger$B=LoggerByDefault.getLogger("extended KML format");class KML extends KML$1{constructor(e){if(super(e),!(this instanceof KML))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return e=e||{},this.source=null,this.extensions=e.extensions||null,e.defaultStyle&&!Array.isArray(e.defaultStyle)&&(e.defaultStyle=[e.defaultStyle]),(e.defaultStyle===null||typeof e.defaultStyle>"u")&&(e.defaultStyle=[]),this}_processKml(e,i,s){for(var o=e.nodeName==="#document"?e.childNodes[0].childNodes:e.childNodes,l=o,c=0;c<o.length;c++){const Ft=o[c];if(Ft.nodeName==="Document"){l=Ft.childNodes;break}if(Ft.nodeName==="Placemark"){l=[Ft];break}}for(var u={},f=-1,g=0;g<l.length;g++){var H=l[g];switch(H.nodeName){case"Style":var Y=H.attributes[0];if(Y&&Y.nodeName==="id"){var ee=Y.nodeValue,te=H;u[ee]=te}break;case"Placemark":f++;for(var ne=H.childNodes,Ye=!1,xe=!1,tt=!1,et=null,it=null,rt=null,nt=H,at=0;at<ne.length;at++)switch(ne[at].nodeName){case"Polygon":tt=!0;break;case"LineString":xe=!0;break;case"Point":Ye=!0;break;case"Style":it=ne[at],et=ne[at].childNodes;break;case"styleUrl":var st=ne[at].textContent.slice(1);u[st]&&(et=u[st].childNodes);break;case"ExtendedData":rt=ne[at].childNodes;break;case"name":nt=null;break}if(rt){logger$B.log("ExtendedData :",rt);var ot=s.extendedData;ot&&typeof ot=="function"&&ot(i[f],rt)}if(nt){logger$B.log("Name :",nt);var ut=s.nameData;ut&&typeof ut=="function"&&ut(i[f],nt)}if(Ye&&et&&et.length!==0){for(var ht=null,dt=null,pt=0;pt<et.length;pt++)switch(et[pt].nodeName){case"LabelStyle":ht=et[pt];break;case"IconStyle":dt=et[pt];break}var yt=i[f].getProperties().name,mt=i[f].getProperties().description,St=yt||mt;if(logger$B.trace(St),!dt&&ht){var wt=s.labelStyle;wt&&typeof wt=="function"&&wt(i[f],ht)}else if(dt&&!ht){var Rt=s.iconStyle;Rt&&typeof Rt=="function"&&Rt(i[f],dt)}else if(dt&&ht){var Lt=s.iconLabelStyle;Lt&&typeof Lt=="function"&&Lt(i[f],dt,ht)}}else{var Gt=i[f],vt=Gt.getStyle();if(vt&&typeof vt=="function"){var Et=vt.call(this,Gt,0);Et&&Et.length!==0&&(vt=Et[0])}if(tt){var _t=s.polygonStyle;_t&&typeof _t=="function"&&_t(i[f],et)}if(xe){var Ct=s.lineStringStyle;Ct&&typeof Ct=="function"&&Ct(i[f],et)}if(Ye&&vt){var ct=vt.getImage();if(ct&&ct instanceof CircleStyle){var ft=s.circleStyle;ft&&typeof ft=="function"&&ft(i[f],it)}else if(ct&&ct instanceof Icon){var bt=s.pointStyle;bt&&typeof bt=="function"&&bt(i[f],it)}}}break;default:logger$B.trace("tag is not processing !")}}}writeFeatures(e,i){logger$B.log("overload : ol.format.KML.writeFeatures");var s=super.writeFeaturesNode(e,i);if(s===null)return null;this.hasOwnProperty("extensions")&&this._writeRootExtensions(s,this.extensions);var o=this._writeExtendStylesFeatures(s,e,i),l=Parser$1.format(o);return l===""?null:l}_writeExtendStylesFeatures(e,i,s){function o(te,ne){var Ye=te.toString(16);Ye.charAt(0)==="#"&&(Ye=Ye.slice(1)),ne=ne||1,ne=parseInt(ne*255,10),ne=ne.toString(16);var xe=ne;return xe=xe+Ye.substr(4,2),xe=xe+Ye.substr(2,2),xe=xe+Ye.substr(0,2),xe.toLowerCase()}var l=function(te,ne){if(logger$B.trace("label with style :",ne),!!te&&te.getStyle()instanceof Style$1){var Ye=te.getStyle().getText();if(!Ye)return;var xe="Sans",tt="16px",et=Ye.getFont();if(et){var it=et.split(" ",2);tt=it[0],xe=it[1]}var rt=te.getStyle().getText().getStroke();if(!rt)return;if(rt instanceof Stroke){var nt=o("#FFFFFF"),at=rt.getColor();if(Array.isArray(at)){var st="rgba(";st+=at[0]+",",st+=at[1]+",",st+=at[2]+",",st+=at[3]+")",at=st}if(ColorUtils.isRGB(at)){var ot=ColorUtils.rgbaToHex(at);nt=o(ot.hex,ot.opacity)}else nt=o(at);var ut=rt.getWidth()||"0",ht="1";if(ne&&ne.getElementsByTagName("LabelStyleSimpleExtensionGroup").length===0){var dt=document.createElementNS(e.namespaceURI,"LabelStyleSimpleExtensionGroup");dt.setAttribute("fontSize",tt),dt.setAttribute("fontFamily",xe),dt.setAttribute("haloColor",nt),dt.setAttribute("haloRadius",ut),dt.setAttribute("haloOpacity",ht),ne.appendChild(dt)}}var pt=te.getStyle().getImage();if(!pt)return;if(pt instanceof CircleStyle){var yt=null,mt=null;if(pt.getStroke()){if(mt=pt.getStroke().getWidth(),yt=pt.getStroke().getColor(),Array.isArray(yt)){var St="rgba(";St+=yt[0]+",",St+=yt[1]+",",St+=yt[2]+",",St+=yt[3]+")",yt=St}if(ColorUtils.isRGB(yt)){var wt=ColorUtils.rgbaToHex(yt);yt=o(wt.hex,wt.opacity)}else yt=o(yt)}var Rt=null;if(pt.getFill()){if(Rt=pt.getFill().getColor(),Array.isArray(Rt)){var Lt="rgba(";Lt+=Rt[0]+",",Lt+=Rt[1]+",",Lt+=Rt[2]+",",Lt+=Rt[3]+")",Rt=Lt}if(ColorUtils.isRGB(Rt)){var Gt=ColorUtils.rgbaToHex(Rt);Rt=o(Gt.hex,Gt.opacity)}else Rt=o(Rt)}if(ne&&ne.getElementsByTagName("ObjectSimpleExtensionGroup").length===0){var vt=document.createElementNS(e.namespaceURI,"ObjectSimpleExtensionGroup");vt.setAttribute("type","circle"),vt.setAttribute("radius",pt.getRadius()),vt.setAttribute("fillColor",Rt),vt.setAttribute("strokeColor",yt),vt.setAttribute("strokeWidth",mt),ne.appendChild(vt)}}}},c=function(te,ne){if(logger$B.trace("marker with style (hotspot):",ne),!!te&&te.getStyle()instanceof Style$1){var Ye=te.getStyle().getImage();if(!Ye)return;if(Ye instanceof Icon){var xe=0,tt=0,et="pixels",it="pixels",rt=Ye.getSize(),nt=Ye.getAnchor();if(nt.length&&(xe=nt[0],tt=nt[1],it==="fraction"?tt=tt===1?0:1-tt:tt=it==="pixels"&&tt===rt[1]?0:rt[1]-tt),ne&&ne.getElementsByTagName("hotSpot").length===0){var at=document.createElementNS(e.namespaceURI,"hotSpot");at.setAttribute("x",xe),at.setAttribute("y",tt),at.setAttribute("xunits",et),at.setAttribute("yunits",it),ne.appendChild(at)}}}},u=function(te,ne){if(te&&te.getStyle()instanceof Style$1){var Ye=te.getStyle().getImage();if(!Ye)return;if(Ye instanceof CircleStyle){var xe=null,tt=null;if(Ye.getStroke()){if(tt=Ye.getStroke().getWidth(),xe=Ye.getStroke().getColor(),Array.isArray(xe)){var et="rgba(";et+=xe[0]+",",et+=xe[1]+",",et+=xe[2]+",",et+=xe[3]+")",xe=et}if(ColorUtils.isRGB(xe)){var it=ColorUtils.rgbaToHex(xe);xe=o(it.hex,it.opacity)}else xe=o(xe)}var rt=null;if(Ye.getFill()){if(rt=Ye.getFill().getColor(),Array.isArray(rt)){var nt="rgba(";nt+=rt[0]+",",nt+=rt[1]+",",nt+=rt[2]+",",nt+=rt[3]+")",rt=nt}if(ColorUtils.isRGB(rt)){var at=ColorUtils.rgbaToHex(rt);rt=o(at.hex,at.opacity)}else rt=o(rt)}if(ne&&ne.getElementsByTagName("ObjectSimpleExtensionGroup").length===0){var st=document.createElementNS(e.namespaceURI,"LabelStyle"),ot=document.createElementNS(e.namespaceURI,"ObjectSimpleExtensionGroup");ot.setAttribute("type","circle"),ot.setAttribute("radius",Ye.getRadius()),ot.setAttribute("fillColor",rt),ot.setAttribute("strokeColor",xe),ot.setAttribute("strokeWidth",tt),st.appendChild(ot),ne.appendChild(st)}}}},f=function(te,ne){},g=function(te,ne,Ye){logger$B.trace("write an icon with a label"),c(te,ne),l(te,Ye)},H=function(te,ne){for(var Ye=0;Ye<ne.length;Ye++){var xe=ne[Ye];if(xe.nodeName==="name")return}var tt=te.getProperties().name;if(tt){var et=document.createElement("name");et.innerHTML=tt,ne.appendChild(et)}},Y=function(te,ne){if(ne&&ne.length){for(var Ye=[],xe=0;xe<ne.length;xe++){const et=ne[xe];if(et.nodeName==="Data"){var tt=et.getAttribute("name");Styling.getListTags().includes(tt)&&Ye.push(et)}}Ye&&Ye.length&&Ye.forEach(et=>{et.remove()})}};this._processKml(e,i,{labelStyle:l,iconStyle:c,iconLabelStyle:g,circleStyle:u,pointStyle:f,nameData:H,extendedData:Y});var ee=Parser$1.toString(e);return ee||null}_writeRootExtensions(e,i){var s=document.createElementNS(e.namespaceURI,"ExtendedData");for(const u in i)if(Object.hasOwnProperty.call(i,u)){const f=i[u];var o=document.createElementNS(e.namespaceURI,"Data");o.setAttribute("name",u);var l=document.createTextNode(JSON.stringify(f));o.appendChild(l),s.appendChild(o)}var c=e.firstChild;e.insertBefore(s,c)}readFeatures(e,i){logger$B.log("overload : ol.format.KML.readFeatures"),typeof e=="string"?this.source=Parser$1.parse(e):e!==null&&(this.source=e);var s=this._readExtendStylesFeatures(e,i);return logger$B.trace("Styles tendus",s),s.forEach(o=>{Styling.definePropertiesFromStyle(o)}),s}_readExtendStylesFeatures(e,i){var s=super.readFeatures(e,i),o=null,l="";if(typeof e=="string"?l=e:l=e.documentElement.outerHTML,l=l.replace(/\n/g,""),l=l.replace(/(>)\s*(<)/g,"$1$2"),o=Parser$1.parse(l),o===null)return s;function c(ee){var te="";te=te+ee.substr(6,2),te=te+ee.substr(4,2),te=te+ee.substr(2,2);for(var ne=parseInt(te,16).toString(16),Ye="",xe=ne.length||0,tt=0;tt<6-xe;tt++)Ye+="0";return ne="#"+Ye+ne,ne}var u=function(ee,te){if(logger$B.trace("label with style :",te),!!ee){for(var ne=ee.getProperties().name,Ye=c("ff000000"),xe="#FFFFFF",tt=0,et="Sans",it="16px",rt=null,nt=5,at="#000000",st="#ffffff",ot=1,ut=!1,ht=!1,dt=te.childNodes,pt=0;pt<dt.length;pt++)switch(dt[pt].nodeName){case"scale":break;case"colorMode":break;case"color":Ye=c(dt[pt].textContent);break;case"LabelStyleSimpleExtensionGroup":ut=!0;for(var yt=dt[pt].attributes,mt=0;mt<yt.length;mt++)switch(yt[mt].nodeName){case"fontFamily":et=yt[mt].nodeValue;break;case"fontSize":it=yt[mt].nodeValue;break;case"haloColor":xe=c(yt[mt].nodeValue);break;case"haloRadius":tt=parseInt(yt[mt].nodeValue,10);break}break;case"ObjectSimpleExtensionGroup":ht=!0;for(var St=dt[pt].attributes,wt=0;wt<St.length;wt++)switch(St[wt].nodeName){case"type":rt=St[wt].nodeValue;break;case"radius":nt=parseInt(St[wt].nodeValue,10);break;case"fillColor":var Rt=St[wt].nodeValue,Lt=Math.round(ColorUtils.num(Rt.substr(0,2))/255*10)/10,Gt=c(Rt);at=ColorUtils.hexToRgba(Gt,Lt);break;case"strokeColor":var vt=St[wt].nodeValue,Et=Math.round(ColorUtils.num(vt.substr(0,2))/255*10)/10,_t=c(vt);st=ColorUtils.hexToRgba(_t,Et);break;case"strokeWidth":ot=parseInt(St[wt].nodeValue,10);break}break}var Ct=null;ht&&rt==="circle"?Ct=new CircleStyle({radius:nt,fill:new Fill({color:at}),stroke:new Stroke({color:st,width:ot})}):ut&&(Ct=new Icon({src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNiYAAAAAkAAxkR2eQAAAAASUVORK5CYII=",size:[51,38],anchor:[25.5,38],anchorOrigin:"top-left",anchorXUnits:"pixels",anchorYUnits:"pixels"})),ee.setStyle(new Style$1({image:Ct,text:new Text({font:it+" "+et,textAlign:"left",text:ne,fill:new Fill({color:Ye}),stroke:new Stroke({color:xe,width:tt})})}))}},f=function(ee,te){logger$B.trace("hotspot :",te);for(var ne=null,Ye=null,xe=c("ffffffff"),tt=!1,et=51,it=38,rt=!1,nt=25.5,at="pixels",st=38,ot="pixels",ut=te.childNodes,ht=!1,dt=0;dt<ut.length;dt++)switch(ut[dt].nodeName){case"Icon":ht=!0;for(var pt=ut[dt].childNodes,yt=0;yt<pt.length;yt++)switch(pt[yt].nodeName){case"href":ne=pt[yt].textContent;break;case"gx:w":tt=!0,et=parseFloat(pt[yt].textContent);break;case"gx:h":tt=!0,it=parseFloat(pt[yt].textContent);break}break;case"hotSpot":rt=!0;for(var mt=ut[dt].attributes,St=0;St<mt.length;St++)switch(mt[St].nodeName){case"x":nt=parseFloat(mt[St].nodeValue);break;case"y":st=parseFloat(mt[St].nodeValue);break;case"yunits":at=mt[St].nodeValue;break;case"xunits":ot=mt[St].nodeValue;break}break;case"scale":Ye=parseFloat(ut[dt].textContent);break;case"color":xe=c(ut[dt].textContent);break}var wt=null;if(ht){var Rt={src:ne||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNiYAAAAAkAAxkR2eQAAAAASUVORK5CYII=",color:xe,crossOrigin:"anonymous",scale:Ye||1};tt&&Helper.mergeParams(Rt,{size:[et,it]}),rt&&Helper.mergeParams(Rt,{anchor:[nt,st],anchorOrigin:"bottom-left",anchorXUnits:at||"pixels",anchorYUnits:ot||"pixels"}),wt=new Icon(Rt)}var Lt=ee.getStyleFunction();if(Lt){var Gt=Lt(ee,0);if(Gt&&!Array.isArray(Gt)&&(Gt=[Gt]),Gt&&Gt.length!==0){var vt=Gt.length===1?Gt[0]:Gt[Gt.length-1];ee.setStyle(new Style$1({image:wt,text:vt.getText()}))}}},g=function(ee,te){if(logger$B.trace("extendData :",te),!!ee){for(var ne={},Ye=ee.get("name")||"",xe=ee.get("description")||"",tt=null,et=0;et<te.length;et++){var it=te[et],rt=it.attributes[0],nt=it.childNodes;if(rt.nodeName==="name")switch(rt.nodeValue){case"label":Ye=it.textContent,ne.name=Ye;break;case"title":case"attributetitle":for(var at=0;at<nt.length;at++)nt[at].nodeName==="value"&&(tt=nt[at].textContent);break;default:ne[rt.nodeValue]=it.textContent;break}}tt&&(xe=xe?tt+" : "+xe:tt,ne.description=xe),Object.keys(ne).length&&ee.setProperties(ne,!0)}},H=function(ee,te,ne){logger$B.trace("display icon and label"),u(ee,ne),f(ee,te)},Y=function(ee,te){};return this._processKml(o,s,{lineStringStyle:Y,polygonStyle:Y,pointStyle:Y,labelStyle:this.showPointNames_?u:null,iconStyle:f,iconLabelStyle:this.showPointNames_?H:f,extendedData:g}),s}readRootExtensions(e){for(var i={},s=this.source.nodeName==="#document"?this.source.childNodes[0]:this.source,o=s.childNodes,l=0;l<o.length;l++){var c=o[l];if(c.nodeName==="ExtendedData")for(var u=c.childNodes,f=0;f<u.length;f++){var g=u[f];if(g.nodeName==="Data"){var H=g.attributes[0];if(H&&H.nodeName==="name"&&H.nodeValue===e){i=JSON.parse(g.textContent);break}}}}return i}}window.ol&&window.ol.format&&(window.ol.format.KMLExtended=KML);const NAMESPACE_URIS$3=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],SCHEMA_LOCATION="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",FEATURE_READER={rte:readRte,trk:readTrk,wpt:readWpt},GPX_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{rte:makeArrayPusher(readRte),trk:makeArrayPusher(readTrk),wpt:makeArrayPusher(readWpt)}),LINK_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{text:makeObjectPropertySetter(readString,"linkText"),type:makeObjectPropertySetter(readString,"linkType")}),AUTHOR_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{name:makeObjectPropertySetter(readString),email:parseEmail,link:parseLink}),METADATA_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{name:makeObjectPropertySetter(readString),desc:makeObjectPropertySetter(readString),author:makeObjectPropertySetter(readAuthor),copyright:makeObjectPropertySetter(readCopyright),link:parseLink,time:makeObjectPropertySetter(readDateTime),keywords:makeObjectPropertySetter(readString),bounds:parseBounds,extensions:parseExtensions}),COPYRIGHT_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{year:makeObjectPropertySetter(readPositiveInteger),license:makeObjectPropertySetter(readString)}),GPX_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$3,{rte:makeChildAppender(writeRte),trk:makeChildAppender(writeTrk),wpt:makeChildAppender(writeWpt)});let GPX$1=class extends XMLFeature{constructor(e){super(),e=e||{},this.dataProjection=get$3("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let i=0,s=e.length;i<s;++i){const o=e[i];if(this.readExtensions_){const l=o.get("extensionsNode_")||null;this.readExtensions_(o,l)}o.set("extensionsNode_",void 0)}}readMetadata(e){return e?typeof e=="string"?this.readMetadataFromDocument(parse$1(e)):isDocument(e)?this.readMetadataFromDocument(e):this.readMetadataFromNode(e):null}readMetadataFromDocument(e){for(let i=e.firstChild;i;i=i.nextSibling)if(i.nodeType===Node.ELEMENT_NODE){const s=this.readMetadataFromNode(i);if(s)return s}return null}readMetadataFromNode(e){if(!NAMESPACE_URIS$3.includes(e.namespaceURI))return null;for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(NAMESPACE_URIS$3.includes(i.namespaceURI)&&i.localName==="metadata")return pushParseAndPop({},METADATA_PARSERS,i,[]);return null}readFeatureFromNode(e,i){if(!NAMESPACE_URIS$3.includes(e.namespaceURI))return null;const s=FEATURE_READER[e.localName];if(!s)return null;const o=s(e,[this.getReadOptions(e,i)]);return o?(this.handleReadExtensions_([o]),o):null}readFeaturesFromNode(e,i){if(!NAMESPACE_URIS$3.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const s=pushParseAndPop([],GPX_PARSERS,e,[this.getReadOptions(e,i)]);return s?(this.handleReadExtensions_(s),s):[]}return[]}writeFeaturesNode(e,i){i=this.adaptOptions(i);const s=createElementNS("http://www.topografix.com/GPX/1/1","gpx");return s.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",XML_SCHEMA_INSTANCE_URI),s.setAttributeNS(XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",SCHEMA_LOCATION),s.setAttribute("version","1.1"),s.setAttribute("creator","OpenLayers"),pushSerializeAndPop({node:s},GPX_SERIALIZERS,GPX_NODE_FACTORY,e,[i]),s}};const RTE_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{name:makeObjectPropertySetter(readString),cmt:makeObjectPropertySetter(readString),desc:makeObjectPropertySetter(readString),src:makeObjectPropertySetter(readString),link:parseLink,number:makeObjectPropertySetter(readPositiveInteger),extensions:parseExtensions,type:makeObjectPropertySetter(readString),rtept:parseRtePt}),RTEPT_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{ele:makeObjectPropertySetter(readDecimal),time:makeObjectPropertySetter(readDateTime)}),TRK_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{name:makeObjectPropertySetter(readString),cmt:makeObjectPropertySetter(readString),desc:makeObjectPropertySetter(readString),src:makeObjectPropertySetter(readString),link:parseLink,number:makeObjectPropertySetter(readPositiveInteger),type:makeObjectPropertySetter(readString),extensions:parseExtensions,trkseg:parseTrkSeg}),TRKSEG_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{trkpt:parseTrkPt}),TRKPT_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{ele:makeObjectPropertySetter(readDecimal),time:makeObjectPropertySetter(readDateTime)}),WPT_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{ele:makeObjectPropertySetter(readDecimal),time:makeObjectPropertySetter(readDateTime),magvar:makeObjectPropertySetter(readDecimal),geoidheight:makeObjectPropertySetter(readDecimal),name:makeObjectPropertySetter(readString),cmt:makeObjectPropertySetter(readString),desc:makeObjectPropertySetter(readString),src:makeObjectPropertySetter(readString),link:parseLink,sym:makeObjectPropertySetter(readString),type:makeObjectPropertySetter(readString),fix:makeObjectPropertySetter(readString),sat:makeObjectPropertySetter(readPositiveInteger),hdop:makeObjectPropertySetter(readDecimal),vdop:makeObjectPropertySetter(readDecimal),pdop:makeObjectPropertySetter(readDecimal),ageofdgpsdata:makeObjectPropertySetter(readDecimal),dgpsid:makeObjectPropertySetter(readPositiveInteger),extensions:parseExtensions}),LINK_SEQUENCE=["text","type"],LINK_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$3,{text:makeChildAppender(writeStringTextNode),type:makeChildAppender(writeStringTextNode)}),RTE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$3,["name","cmt","desc","src","link","number","type","rtept"]),RTE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$3,{name:makeChildAppender(writeStringTextNode),cmt:makeChildAppender(writeStringTextNode),desc:makeChildAppender(writeStringTextNode),src:makeChildAppender(writeStringTextNode),link:makeChildAppender(writeLink),number:makeChildAppender(writeNonNegativeIntegerTextNode),type:makeChildAppender(writeStringTextNode),rtept:makeArraySerializer(makeChildAppender(writeWptType))}),RTEPT_TYPE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$3,["ele","time"]),TRK_SEQUENCE=makeStructureNS(NAMESPACE_URIS$3,["name","cmt","desc","src","link","number","type","trkseg"]),TRK_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$3,{name:makeChildAppender(writeStringTextNode),cmt:makeChildAppender(writeStringTextNode),desc:makeChildAppender(writeStringTextNode),src:makeChildAppender(writeStringTextNode),link:makeChildAppender(writeLink),number:makeChildAppender(writeNonNegativeIntegerTextNode),type:makeChildAppender(writeStringTextNode),trkseg:makeArraySerializer(makeChildAppender(writeTrkSeg))}),TRKSEG_NODE_FACTORY=makeSimpleNodeFactory("trkpt"),TRKSEG_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$3,{trkpt:makeChildAppender(writeWptType)}),WPT_TYPE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$3,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),WPT_TYPE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$3,{ele:makeChildAppender(writeDecimalTextNode),time:makeChildAppender(writeDateTimeTextNode),magvar:makeChildAppender(writeDecimalTextNode),geoidheight:makeChildAppender(writeDecimalTextNode),name:makeChildAppender(writeStringTextNode),cmt:makeChildAppender(writeStringTextNode),desc:makeChildAppender(writeStringTextNode),src:makeChildAppender(writeStringTextNode),link:makeChildAppender(writeLink),sym:makeChildAppender(writeStringTextNode),type:makeChildAppender(writeStringTextNode),fix:makeChildAppender(writeStringTextNode),sat:makeChildAppender(writeNonNegativeIntegerTextNode),hdop:makeChildAppender(writeDecimalTextNode),vdop:makeChildAppender(writeDecimalTextNode),pdop:makeChildAppender(writeDecimalTextNode),ageofdgpsdata:makeChildAppender(writeDecimalTextNode),dgpsid:makeChildAppender(writeNonNegativeIntegerTextNode)}),GEOMETRY_TYPE_TO_NODENAME={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function GPX_NODE_FACTORY(n,e,i){const s=n.getGeometry();if(s){const o=GEOMETRY_TYPE_TO_NODENAME[s.getType()];if(o){const l=e[e.length-1].node;return createElementNS(l.namespaceURI,o)}}}function appendCoordinate(n,e,i,s){return n.push(parseFloat(i.getAttribute("lon")),parseFloat(i.getAttribute("lat"))),"ele"in s?(n.push(s.ele),delete s.ele,e.hasZ=!0):n.push(0),"time"in s?(n.push(s.time),delete s.time,e.hasM=!0):n.push(0),n}function applyLayoutOptions(n,e,i){let s="XY",o=2;if(n.hasZ&&n.hasM?(s="XYZM",o=4):n.hasZ?(s="XYZ",o=3):n.hasM&&(s="XYM",o=3),o!==4){for(let l=0,c=e.length/4;l<c;l++)e[l*o]=e[l*4],e[l*o+1]=e[l*4+1],n.hasZ&&(e[l*o+2]=e[l*4+2]),n.hasM&&(e[l*o+2]=e[l*4+3]);if(e.length=e.length/4*o,i)for(let l=0,c=i.length;l<c;l++)i[l]=i[l]/4*o}return s}function readAuthor(n,e){const i=pushParseAndPop({},AUTHOR_PARSERS,n,e);if(i)return i}function readCopyright(n,e){const i=pushParseAndPop({},COPYRIGHT_PARSERS,n,e);if(i){const s=n.getAttribute("author");return s!==null&&(i.author=s),i}}function parseBounds(n,e){const i=e[e.length-1],s=n.getAttribute("minlat"),o=n.getAttribute("minlon"),l=n.getAttribute("maxlat"),c=n.getAttribute("maxlon");o!==null&&s!==null&&c!==null&&l!==null&&(i.bounds=[[parseFloat(o),parseFloat(s)],[parseFloat(c),parseFloat(l)]])}function parseEmail(n,e){const i=e[e.length-1],s=n.getAttribute("id"),o=n.getAttribute("domain");s!==null&&o!==null&&(i.email=`${s}@${o}`)}function parseLink(n,e){const i=e[e.length-1],s=n.getAttribute("href");s!==null&&(i.link=s),parseNode(LINK_PARSERS,n,e)}function parseExtensions(n,e){const i=e[e.length-1];i.extensionsNode_=n}function parseRtePt(n,e){const i=pushParseAndPop({},RTEPT_PARSERS,n,e);if(i){const s=e[e.length-1],o=s.flatCoordinates,l=s.layoutOptions;appendCoordinate(o,l,n,i)}}function parseTrkPt(n,e){const i=pushParseAndPop({},TRKPT_PARSERS,n,e);if(i){const s=e[e.length-1],o=s.flatCoordinates,l=s.layoutOptions;appendCoordinate(o,l,n,i)}}function parseTrkSeg(n,e){const i=e[e.length-1];parseNode(TRKSEG_PARSERS,n,e);const s=i.flatCoordinates;i.ends.push(s.length)}function readRte(n,e){const i=e[0],s=pushParseAndPop({flatCoordinates:[],layoutOptions:{}},RTE_PARSERS,n,e);if(!s)return;const o=s.flatCoordinates;delete s.flatCoordinates;const l=s.layoutOptions;delete s.layoutOptions;const c=applyLayoutOptions(l,o),u=new LineString(o,c);transformGeometryWithOptions(u,!1,i);const f=new Feature(u);return f.setProperties(s,!0),f}function readTrk(n,e){const i=e[0],s=pushParseAndPop({flatCoordinates:[],ends:[],layoutOptions:{}},TRK_PARSERS,n,e);if(!s)return;const o=s.flatCoordinates;delete s.flatCoordinates;const l=s.ends;delete s.ends;const c=s.layoutOptions;delete s.layoutOptions;const u=applyLayoutOptions(c,o,l),f=new MultiLineString(o,u,l);transformGeometryWithOptions(f,!1,i);const g=new Feature(f);return g.setProperties(s,!0),g}function readWpt(n,e){const i=e[0],s=pushParseAndPop({},WPT_PARSERS,n,e);if(!s)return;const o={},l=appendCoordinate([],o,n,s),c=applyLayoutOptions(o,l),u=new Point$1(l,c);transformGeometryWithOptions(u,!1,i);const f=new Feature(u);return f.setProperties(s,!0),f}function writeLink(n,e,i){n.setAttribute("href",e);const o=i[i.length-1].properties,l=[o.linkText,o.linkType];pushSerializeAndPop({node:n},LINK_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,l,i,LINK_SEQUENCE)}function writeWptType(n,e,i){const s=i[i.length-1],l=s.node.namespaceURI,c=s.properties;switch(n.setAttributeNS(null,"lat",String(e[1])),n.setAttributeNS(null,"lon",String(e[0])),s.geometryLayout){case"XYZM":e[3]!==0&&(c.time=e[3]);case"XYZ":e[2]!==0&&(c.ele=e[2]);break;case"XYM":e[2]!==0&&(c.time=e[2]);break}const f=n.nodeName=="rtept"?RTEPT_TYPE_SEQUENCE[l]:WPT_TYPE_SEQUENCE[l],g=makeSequence(c,f);pushSerializeAndPop({node:n,properties:c},WPT_TYPE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,g,i,f)}function writeRte(n,e,i){const s=i[0],o=e.getProperties(),l={node:n};l.properties=o;const c=e.getGeometry();if(c.getType()=="LineString"){const H=transformGeometryWithOptions(c,!0,s);l.geometryLayout=H.getLayout(),o.rtept=H.getCoordinates()}const u=i[i.length-1].node,f=RTE_SEQUENCE[u.namespaceURI],g=makeSequence(o,f);pushSerializeAndPop(l,RTE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,g,i,f)}function writeTrk(n,e,i){const s=i[0],o=e.getProperties(),l={node:n};l.properties=o;const c=e.getGeometry();if(c.getType()=="MultiLineString"){const H=transformGeometryWithOptions(c,!0,s);o.trkseg=H.getLineStrings()}const u=i[i.length-1].node,f=TRK_SEQUENCE[u.namespaceURI],g=makeSequence(o,f);pushSerializeAndPop(l,TRK_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,g,i,f)}function writeTrkSeg(n,e,i){const s={node:n};s.geometryLayout=e.getLayout(),s.properties={},pushSerializeAndPop(s,TRKSEG_SERIALIZERS,TRKSEG_NODE_FACTORY,e.getCoordinates(),i)}function writeWpt(n,e,i){const s=i[0],o=i[i.length-1];o.properties=e.getProperties();const l=e.getGeometry();if(l.getType()=="Point"){const c=transformGeometryWithOptions(l,!0,s);o.geometryLayout=c.getLayout(),writeWptType(n,c.getCoordinates(),i)}}class GPX extends GPX$1{constructor(e){if(super(e),!(this instanceof GPX))throw new TypeError("ERROR CLASS_CONSTRUCTOR");if(this.options=e||{},this.options.readExtensions&&typeof this.options.readExtensions=="function"){var i=this.options.readExtensions;this.options.readExtensions=function(s,o){this.readExtensions(s,o),i.call(this,s,o)}}else this.options.readExtensions=this.readExtensions;return(this.options.defaultStyle===null||typeof this.options.defaultStyle>"u")&&(this.options.defaultStyle={}),this.source=null,this}readFeatures(e,i){var s=super.readFeatures(e,i);typeof e=="string"?this.source=Parser$1.parse(e):e!==null&&(this.source=e);var o=this;return s.forEach(function(l,c,u){l.setId(c+1);var f=l.getProperties().desc;f&&l.setProperties({description:f});var g=l.getStyleFunction();if(!g){var H=Styling.defineStyleFunctionByDefault(o.options.defaultStyle);H&&l.setStyle(H)}}),s}writeFeatures(e,i){if(e.forEach(function(f,g,H){var Y=f.getProperties().description;Y&&f.setProperties({desc:Y}),Styling.definePropertiesFromStyle(f);var ee=f.getGeometry().getType();if(ee==="Polygon"){var te=f.clone();te.set("type",ee),te.setGeometry(new LineString(f.getGeometry().getCoordinates())),e.push(te),H.splice(g,1)}else if(ee==="MultiPolygon"){var ne=f.clone();ne.set("type",ee),ne.setGeometry(new MultiLineString(f.getGeometry().getCoordinates())),e.push(ne),H.splice(g,1)}}),this.options.orderBy!==void 0){var s=this.options.orderBy;if(s){var o=function(f,g){var H=f.get(s)||0,Y=g.get(s)||0;return H.toString().localeCompare(Y.toString(),void 0,{numeric:!0})};e.sort(o)}}var l=super.writeFeaturesNode(e,i);if(l===null)return null;this.options.hasOwnProperty("extensions")&&this.writeRootExtensions_(l,this.options.extensions),this.processExtensions_(l,e,{extensions:this.writeExtensions_});var c=Parser$1.toString(l);if(!c)return null;var u=Parser$1.format(c);return u===""?null:u}readExtensions(e,i){var s=i;if(!i){var o=e.getProperties();for(const f in o)if(Object.hasOwnProperty.call(o,f)){const g=o[f];if(g instanceof Node){s=g;break}}}if(!s){console.warn("node not found !");return}for(var l=0;l<s.childNodes.length;l++){var c=s.childNodes[l];c.nodeType===1&&e.set(c.nodeName,c.textContent)}Styling.APPLY_CONVERT_GEOM_GPX=!0;var u=Styling.defineStyleFromProperties(e);u&&e.setStyle(u)}readRootExtensions(e){for(var i={},s=this.source.childNodes[0],o=s.childNodes,l=0;l<o.length;l++){var c=o[l];if(c.nodeName==="metadata")for(var u=c.childNodes,f=0;f<u.length;f++){var g=u[f];if(g.nodeName==="extensions")for(var H=g.childNodes,Y=0;Y<H.length;Y++){var ee=H[Y];if(ee.nodeName==="data"){var te=ee.attributes[0];if(te&&te.nodeName==="name"&&te.nodeValue===e){i=JSON.parse(ee.textContent);break}}}}}return i}writeRootExtensions_(e,i,s){var o=document.createElement("metadata"),l=document.createElement("extensions");function c(H,Y){for(const et in Y)if(Object.hasOwnProperty.call(Y,et)){var ee=Y[et]||"",te=document.createElement(et);if(typeof ee=="string"||typeof ee=="number")te.innerHTML=ee,H.appendChild(te);else if(ee instanceof Array){te.setAttribute("type","array"),te.setAttribute("index",ee.length);for(let it=0;it<ee.length;it++){var ne=ee[it]||"",Ye=document.createElement("value");if(typeof ne=="string"||typeof ne=="number")Ye.innerHTML=ne,te.appendChild(Ye);else if(ne instanceof Array){Ye.setAttribute("type","array"),Ye.setAttribute("index",ne.length);for(let rt=0;rt<ne.length;rt++){var xe=ne[rt]||"",tt=document.createElement("value");(typeof xe=="string"||typeof xe=="number")&&(tt.innerHTML=xe,Ye.appendChild(tt))}te.appendChild(Ye)}else ne instanceof Object&&te.appendChild(c(Ye,ne))}H.appendChild(te)}else ee instanceof Object&&H.appendChild(c(te,ee))}return H}if(s)c(l,i);else for(const H in i)if(Object.hasOwnProperty.call(i,H)){const Y=i[H];var u=document.createElement("data");u.setAttribute("name",H);var f=document.createTextNode(JSON.stringify(Y));u.appendChild(f),l.appendChild(u)}o.appendChild(l);var g=e.firstChild;e.insertBefore(o,g)}writeExtensions_(e,i){var s=document.createElementNS(i.parentNode.namespaceURI,"extensions");Styling.getListTags().forEach(o=>{if(e.get(o)){var l=document.createElementNS(i.parentNode.namespaceURI,o);l.innerHTML=e.get(o),s.appendChild(l)}}),i.appendChild(s)}processExtensions_(e,i,s){for(var o=-1,l=e.childNodes,c=0;c<l.length;c++){var u=l[c];switch(u.nodeName){case"wpt":case"rte":case"trk":o++;var f=i[o],g=f.getStyle();if(g){var H=s.extensions;H&&typeof H=="function"&&H(f,u)}break;case"metadata":break;default:console.warn("nodename unknown :",u.nodeName);break}}}}window.ol&&window.ol.format&&(window.ol.format.GPXExtended=GPX);class JSONFeature extends FeatureFormat{constructor(){super()}getType(){return"json"}readFeature(e,i){return this.readFeatureFromObject(getObject(e),this.getReadOptions(e,i))}readFeatures(e,i){return this.readFeaturesFromObject(getObject(e),this.getReadOptions(e,i))}readFeatureFromObject(e,i){return abstract()}readFeaturesFromObject(e,i){return abstract()}readGeometry(e,i){return this.readGeometryFromObject(getObject(e),this.getReadOptions(e,i))}readGeometryFromObject(e,i){return abstract()}readProjection(e){return this.readProjectionFromObject(getObject(e))}readProjectionFromObject(e){return abstract()}writeFeature(e,i){return JSON.stringify(this.writeFeatureObject(e,i))}writeFeatureObject(e,i){return abstract()}writeFeatures(e,i){return JSON.stringify(this.writeFeaturesObject(e,i))}writeFeaturesObject(e,i){return abstract()}writeGeometry(e,i){return JSON.stringify(this.writeGeometryObject(e,i))}writeGeometryObject(e,i){return abstract()}}function getObject(n){if(typeof n=="string"){const e=JSON.parse(n);return e||null}return n!==null?n:null}let GeoJSON$1=class extends JSONFeature{constructor(e){e=e||{},super(),this.dataProjection=get$3(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=get$3(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,i){let s=null;e.type==="Feature"?s=e:s={type:"Feature",geometry:e,properties:null};const o=readGeometryInternal(s.geometry);if(this.featureClass===RenderFeature)return createRenderFeature({geometry:o,id:s.id,properties:s.properties},i);const l=new Feature;return this.geometryName_?l.setGeometryName(this.geometryName_):this.extractGeometryName_&&s.geometry_name&&l.setGeometryName(s.geometry_name),l.setGeometry(createGeometry(o,i)),"id"in s&&l.setId(s.id),s.properties&&l.setProperties(s.properties,!0),l}readFeaturesFromObject(e,i){const s=e;let o=null;if(s.type==="FeatureCollection"){const l=e;o=[];const c=l.features;for(let u=0,f=c.length;u<f;++u){const g=this.readFeatureFromObject(c[u],i);g&&o.push(g)}}else o=[this.readFeatureFromObject(e,i)];return o.flat()}readGeometryFromObject(e,i){return readGeometry(e,i)}readProjectionFromObject(e){const i=e.crs;let s;if(i)if(i.type=="name")s=get$3(i.properties.name);else if(i.type==="EPSG")s=get$3("EPSG:"+i.properties.code);else throw new Error("Unknown SRS type");else s=this.dataProjection;return s}writeFeatureObject(e,i){i=this.adaptOptions(i);const s={type:"Feature",geometry:null,properties:null},o=e.getId();if(o!==void 0&&(s.id=o),!e.hasProperties())return s;const l=e.getProperties(),c=e.getGeometry();return c&&(s.geometry=writeGeometry(c,i),delete l[e.getGeometryName()]),isEmpty$1(l)||(s.properties=l),s}writeFeaturesObject(e,i){i=this.adaptOptions(i);const s=[];for(let o=0,l=e.length;o<l;++o)s.push(this.writeFeatureObject(e[o],i));return{type:"FeatureCollection",features:s}}writeGeometryObject(e,i){return writeGeometry(e,this.adaptOptions(i))}};function readGeometryInternal(n,e){if(!n)return null;let i;switch(n.type){case"Point":{i=readPointGeometry(n);break}case"LineString":{i=readLineStringGeometry(n);break}case"Polygon":{i=readPolygonGeometry(n);break}case"MultiPoint":{i=readMultiPointGeometry(n);break}case"MultiLineString":{i=readMultiLineStringGeometry(n);break}case"MultiPolygon":{i=readMultiPolygonGeometry(n);break}case"GeometryCollection":{i=readGeometryCollectionGeometry(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return i}function readGeometry(n,e){const i=readGeometryInternal(n);return createGeometry(i,e)}function readGeometryCollectionGeometry(n,e){return n.geometries.map(function(s){return readGeometryInternal(s)})}function readPointGeometry(n){const e=n.coordinates;return{type:"Point",flatCoordinates:e,layout:getLayoutForStride(e.length)}}function readLineStringGeometry(n){var s;const e=n.coordinates,i=e.flat();return{type:"LineString",flatCoordinates:i,ends:[i.length],layout:getLayoutForStride(((s=e[0])==null?void 0:s.length)||2)}}function readMultiLineStringGeometry(n){var l,c;const e=n.coordinates,i=((c=(l=e[0])==null?void 0:l[0])==null?void 0:c.length)||2,s=[],o=deflateCoordinatesArray(s,0,e,i);return{type:"MultiLineString",flatCoordinates:s,ends:o,layout:getLayoutForStride(i)}}function readMultiPointGeometry(n){var i;const e=n.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:getLayoutForStride(((i=e[0])==null?void 0:i.length)||2)}}function readMultiPolygonGeometry(n){var l,c;const e=n.coordinates,i=[],s=((c=(l=e[0])==null?void 0:l[0])==null?void 0:c[0].length)||2,o=deflateMultiCoordinatesArray(i,0,e,s);return{type:"MultiPolygon",flatCoordinates:i,ends:o,layout:getLayoutForStride(s)}}function readPolygonGeometry(n){var l,c;const e=n.coordinates,i=[],s=(c=(l=e[0])==null?void 0:l[0])==null?void 0:c.length,o=deflateCoordinatesArray(i,0,e,s);return{type:"Polygon",flatCoordinates:i,ends:o,layout:getLayoutForStride(s)}}function writeGeometry(n,e){n=transformGeometryWithOptions(n,!0,e);const i=n.getType();let s;switch(i){case"Point":{s=writePointGeometry(n);break}case"LineString":{s=writeLineStringGeometry(n);break}case"Polygon":{s=writePolygonGeometry(n,e);break}case"MultiPoint":{s=writeMultiPointGeometry(n);break}case"MultiLineString":{s=writeMultiLineStringGeometry(n);break}case"MultiPolygon":{s=writeMultiPolygonGeometry(n,e);break}case"GeometryCollection":{s=writeGeometryCollectionGeometry(n,e);break}case"Circle":{s={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+i)}return s}function writeGeometryCollectionGeometry(n,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(s){return writeGeometry(s,e)})}}function writeLineStringGeometry(n,e){return{type:"LineString",coordinates:n.getCoordinates()}}function writeMultiLineStringGeometry(n,e){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function writeMultiPointGeometry(n,e){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function writeMultiPolygonGeometry(n,e){let i;return e&&(i=e.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(i)}}function writePointGeometry(n,e){return{type:"Point",coordinates:n.getCoordinates()}}function writePolygonGeometry(n,e){let i;return e&&(i=e.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(i)}}class GeoJSON extends GeoJSON$1{constructor(e){if(super(e),!(this instanceof GeoJSON))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.options=e||{},(this.options.defaultStyle===null||typeof this.options.defaultStyle>"u")&&(this.options.defaultStyle={}),this.source=null,this}readFeatures(e,i){var s=super.readFeatures(e,i);return typeof e=="string"?this.source=JSON.parse(e):e!==null&&(this.source=e),s.forEach(o=>{var l=o.getStyleFunction();if(l){var c=l.call(this,o,0);c&&c.length!==0&&o.setStyle(c[0])}else{var u=Styling.defineStyleFromProperties(o);if(u)o.setStyle(u);else{var f=Styling.defineStyleFunctionByDefault(this.options.defaultStyle);f&&(o.setStyle(f),Styling.definePropertiesFromStyle(o))}}}),s}writeFeatures(e,i){e.forEach(function(o){Styling.definePropertiesFromStyle(o)});var s=this.writeFeaturesObject(e,i);return this.options.hasOwnProperty("extensions")&&Object.assign(s,this.options.extensions),JSON.stringify(s)}readRootExtensions(e){return this.source[e]}}window.ol&&window.ol.format&&(window.ol.format.GeoJSONExtended=GeoJSON);class WMTS extends WMTS$1{constructor(e){super(e)}getFeatureInfoUrl(e,i,s,o){var l=this.options&&this.options.tilePixelRatio?this.options.tilePixelRatio:1,c=this.tileGrid,u=this.tileGrid.getTileCoordForCoordAndResolution(e,i),f=function(it,rt,nt){var at=[0,0,0],st=createEmpty(),ot=it[1],ut=it[2],ht=rt.getTileCoordExtent(it),dt=nt.getExtent();if(dt!=null&&nt.isGlobal()){var pt=Math.ceil(getWidth(dt)/getWidth(ht));ot=ot%pt,at[0]=it[0],at[1]=ot,at[2]=it[2],ht=rt.getTileCoordExtent(at,st)}return intersects$1(ht,dt)?[it[0],ot,ut]:null},g=c.getTileCoordExtent(u),H=f(u,c,s);if(!(c.getResolutions().length<=u[0])){var Y=c.getResolution(u[0]),ee=c.getMatrixIds()[u[0]],te={SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetFeatureInfo",LAYER:this.getLayer(),TILECOL:H[1],TILEROW:H[2],TILEMATRIX:ee,TILEMATRIXSET:this.getMatrixSet(),FORMAT:this.getFormat()||"image/png",STYLE:this.getStyle()||"normal"};Helper.assign(te,o);var ne=Math.floor((e[0]-g[0])/(Y/l)),Ye=Math.floor((g[3]-e[1])/(Y/l)),xe=c.getTileSize(u[0]);ne=Math.min(ne,(xe[0]|xe)-1),Ye=Math.max(Ye,0),te.I=ne,te.J=Ye;var tt=this.urls[0],et=Gp.Helper.normalyzeUrl(tt,te);return et}}}window.ol&&window.ol.source&&(window.ol.source.WMTSExtended=WMTS);var LayerUtils={getZoomLevelFromScaleDenominator:function(n,e){var i={};switch(e){case"EPSG:2154":i={0:104579.224549894,1:52277.5323537905,2:26135.4870785954,3:13066.8913818,4:6533.2286041135,5:3266.5595244627,6:1633.2660045974,7:816.629554986,8:408.3139146768,9:204.1567415109,10:102.0783167832,11:51.0391448966,12:25.5195690743,13:12.7597836936,14:6.379891636,15:3.1899457653,16:1.5949728695,17:.7974864315,18:.3987432149,19:.1993716073,20:.0996858037,21:.0498429018};break;default:i={0:156543.033928041,1:78271.51696402048,2:39135.758482010235,3:19567.87924100512,4:9783.93962050256,5:4891.96981025128,6:2445.98490512564,7:1222.99245256282,8:611.49622628141,9:305.7481131407048,10:152.8740565703525,11:76.43702828517624,12:38.21851414258813,13:19.10925707129406,14:9.554628535647032,15:4.777314267823516,16:2.388657133911758,17:1.194328566955879,18:.5971642834779395,19:.2985821417389697,20:.1492910708694849,21:.0746455354347424};break}var s=n*28e-5;for(var o in i)if(i.hasOwnProperty(o)&&i[o]<=s)return o=parseInt(o,10),o;return 0},getAttributions:function(n){var e=n.zoom,i=[];if(n.originators!=null&&n.visibility)for(var s,o=0,l=n.originators.length;o<l;o++){s=!0;for(var c=n.originators[o],u=n.originators[o].constraints||[],f=0,g=u.length;f<g;f++){var H=u[f];s=!0;var Y=this.getZoomLevelFromScaleDenominator(H.maxScaleDenominator,n.crs),ee=this.getZoomLevelFromScaleDenominator(H.minScaleDenominator,n.crs)||21;Y&&Y>e&&(s=!1),s&&ee&&ee<e&&(s=!1);var te=H.bbox;if(s&&te){s=!1;var ne=n.extent;if(ne){var Ye=[te.top,te.left,te.bottom,te.right];if(this.intersects(ne,Ye)){s=!0;break}}}}if(s){var xe=c.logo,tt=c.url,et=c.name?c.name:"",it=c.attribution,rt=document.createElement("div");rt.className="gp-control-attribution";var nt=null;nt=document.createElement("a"),nt.className="gp-control-attribution-link",nt.target="_blank",rt.appendChild(nt),tt&&(nt.href=tt);var at=!!xe,st=null;at?(st=document.createElement("img"),nt?(st.className="gp-control-attribution-image",nt.appendChild(st)):(st.className="",rt.appendChild(st)),st.src=xe,st.title=it||et,st.style.height="30px",st.style.width="30px"):et?nt.textContent=et:it?nt.textContent=it:tt?nt.textContent=tt:nt.textContent="",i.push(rt.innerHTML+" ")}}return i},intersects:function(n,e){var i=n[1]<=e[3]&&e[1]<=n[3],s=n[2]<=e[0]&&e[2]<=n[0];return i&&s}},Config={configuration:{},isConfigLoaded:function(){if(this.configuration&&Object.keys(this.configuration).length!==0)return!0;var n=typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:{};return n.Gp&&n.Gp.Config&&n.Gp.Config.layers&&Object.keys(n.Gp.Config.layers).length!==0?(this.configuration=n.Gp.Config,!0):!1}};LoggerByDefault.getLogger("sourcewmts");class SourceWMTS extends WMTS{constructor(e){if(!e.layer)throw new Error("ERROR PARAM_MISSING : layer");if(typeof e.layer!="string")throw new Error("ERROR WRONG TYPE : layer");typeof e.ssl>"u"&&(e.ssl=!0);var i=e.configuration,s=i?i.params:null,o=e.apiKey;if(!i){if(!Config.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers.");var l=Config.configuration.getLayerId(e.layer,"WMTS");if(!l)throw new Error(`ERROR : WMTS Layer ID ${e.layer} cannot be found in Geoportal Configuration. Make sure that this resource is included in your contract key.`);if(i=Config.configuration.getLayerConf(l),!i)throw new Error("ERROR : WMTS Layer configuration cannot be found in Geoportal.");o=Config.configuration.getLayerKey(l)[0],s=Config.configuration.getLayerParams(e.layer,"WMTS")}var c=e.ssl===!1?"http://":"https://",u={"gp-ol-ext":Pkg$1.olExtVersion||Pkg$1.version};if(s.url.includes("/private/")){var f=e.apiKey||o;if(!f)throw new Error("ERROR : WMS Layer apiKey cannot be found in Geoportal Configuration.");u.apikey=f}var g={url:Gp.Helper.normalyzeUrl(s.url.replace(/(http|https):\/\//,c),u,!1),version:s.version,style:s.styles,format:s.format,projection:s.projection,maxZoom:LayerUtils.getZoomLevelFromScaleDenominator(s.minScale),layer:e.layer,matrixSet:s.TMSLink,tileGrid:new WMTSTileGrid({resolutions:s.nativeResolutions,matrixIds:s.matrixIds,origin:[Object.values(s.tileMatrices)[0].topLeftCorner.x,Object.values(s.tileMatrices)[0].topLeftCorner.y]}),crossOrigin:"anonymous"};return Helper.mergeParams(g,e.olParams),e.olParams&&!s.originators&&(s.originators=e.olParams.attributions),super(g),this._originators=s.originators,this._legends=e.legends||s.legends,this._metadata=e.metadata||s.metadata,this._description=e.description||s.description,this._title=e.title||s.title,this._quicklookUrl=e.quicklookUrl||s.quicklookUrl,this.name=e.layer,this.service="WMTS",this}}window.ol&&window.ol.source&&(window.ol.source.GeoportalWMTS=SourceWMTS);LoggerByDefault.getLogger("sourcewms");class SourceWMS extends TileWMS{constructor(e){if(!e.layer)throw new Error("ERROR PARAM_MISSING : layer");if(typeof e.layer!="string")throw new Error("ERROR WRONG TYPE : layer");typeof e.ssl>"u"&&(e.ssl=!0);var i=e.configuration,s=i?i.params:null,o=e.apiKey;if(!i){if(!Config.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers.");var l=Config.configuration.getLayerId(e.layer,"WMS");if(!l)throw new Error(`ERROR : WMS Layer ID ${e.layer} cannot be found in Geoportal Configuration. Make sure that this resource is included in your contract key.`);if(i=Config.configuration.getLayerConf(l),!i)throw new Error("ERROR : WMS Layer configuration cannot be found in Geoportal.");o=Config.configuration.getLayerKey(l)[0],s=Config.configuration.getLayerParams(e.layer,"WMS")}var c=e.ssl===!1?"http://":"https://",u={"gp-ol-ext":Pkg$1.olExtVersion||Pkg$1.version};if(s.url.includes("/private/")){var f=e.apiKey||o;if(!f)throw new Error("ERROR : WMS Layer apiKey cannot be found in Geoportal Configuration.");u.apikey=f}var g={url:Gp.Helper.normalyzeUrl(s.url.replace(/(http|https):\/\//,c),u,!1),params:{SERVICE:"WMS",LAYERS:e.layer,VERSION:s.version,STYLES:s.styles,FORMAT:s.format},crossOrigin:"anonymous"};return Helper.mergeParams(g,e.olParams),e.olParams&&!s.originators&&(s.originators=e.olParams.attributions),super(g),this._originators=s.originators,this._legends=e.legends||s.legends,this._metadata=e.metadata||s.metadata,this._title=e.title||s.title,this._description=e.description||s.description,this._quicklookUrl=e.quicklookUrl||s.quicklookUrl,this.name=e.layer,this.service="WMS",this}}window.ol&&window.ol.source&&(window.ol.source.GeoportalWMS=SourceWMS);LoggerByDefault.getLogger("sourcewfs");class SourceWFS extends VectorSource{constructor(e){if(!e.layer)throw new Error("ERROR PARAM_MISSING : layer");if(typeof e.layer!="string")throw new Error("ERROR WRONG TYPE : layer");typeof e.ssl>"u"&&(e.ssl=!0);var i=e.configuration,s=i?i.params:null,o=e.apiKey;if(!i){if(!Config.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers.");var l=Config.configuration.getLayerId(e.layer,"WFS");if(!l)throw new Error(`ERROR : WFS Layer ID ${e.layer} cannot be found in Geoportal Configuration. Make sure that this resource is included in your contract key.`);if(i=Config.configuration.getLayerConf(l),!i)throw new Error("ERROR : WFS Layer configuration cannot be found in Geoportal.");o=Config.configuration.getLayerKey(l)[0],s=Config.configuration.getLayerParams(e.layer,"WFS")}var c=e.ssl===!1?"http://":"https://",u={"gp-ol-ext":Pkg$1.olExtVersion||Pkg$1.version};if(s.url.includes("/private/")){var f=e.apiKey||o;if(!f)throw new Error("ERROR : WFS Layer apiKey cannot be found in Geoportal Configuration.");u.apikey=f}var g=(Y,ee,te,ne,Ye)=>{const xe=new XMLHttpRequest;xe.open("POST",ee);const tt=function(){Y.removeLoadedExtent(te),Ye()};xe.onerror=tt,xe.onload=function(){if(xe.status==200){var et=JSON.parse(xe.responseText);const it=Y.getFormat().readFeatures(et);if(Y.addFeatures(it),ne(it),et.links)for(let rt=0;rt<et.links.length;rt++){const nt=et.links[rt];nt.rel==="next"&&g(Y,nt.href,te,ne,Ye)}}else tt()},xe.send()},H={format:new GeoJSON$1,loader:function(Y,ee,te,ne,Ye){var xe=this;const tt=e.maxFeatures,et=e.layer,it=te.getCode(),rt=Gp.Helper.normalyzeUrl(s.url.replace(/(http|https):\/\//,c),u,!1)+"&SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&typename="+et+"&outputFormat=application/json&srsname="+it+"&bbox="+Y.join(",")+","+it+"&maxFeatures="+tt+"&count="+tt+"&startIndex=0";g(xe,rt,Y,ne,Ye)},strategy:tile(createXYZ({minZoom:e.olParams.minZoom||15,maxZoom:e.olParams.maxZoom||21,tileSize:512})),crossOrigin:"anonymous"};return Helper.mergeParams(H,e.olParams),e.olParams&&!s.originators&&(s.originators=e.olParams.attributions),super(H),this._originators=s.originators,this._legends=e.legends||s.legends,this._metadata=e.metadata||s.metadata,this._title=e.title||s.title,this._description=e.description||s.description,this._quicklookUrl=e.quicklookUrl||s.quicklookUrl,this.name=e.layer,this.service="WFS",this}}window.ol&&window.ol.source&&(window.ol.source.GeoportalWFS=SourceWFS);function asImageLike(n){return n instanceof Image||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageBitmap?n:null}const disposedError=new Error("disposed"),defaultSize=[256,256];class DataTile extends Tile{constructor(e){const i=TileState.IDLE;super(e.tileCoord,i,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=asImageLike(this.data_);return e?[e.width,e.height]:defaultSize}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==TileState.IDLE&&this.state!==TileState.ERROR)return;this.state=TileState.LOADING,this.changed();const e=this;this.loader_().then(function(i){e.data_=i,e.state=TileState.LOADED,e.changed()}).catch(function(i){e.error_=i,e.state=TileState.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(disposedError),this.controller_=null),super.disposeInternal()}}class LRUCache{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof Disposable&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let i=this.oldest_;for(;i;)e(i.value_,i.key_,this),i=i.newer}get(e,i){const s=this.entries_[e];return assert(s!==void 0,"Tried to get a value for a key that does not exist in the cache"),s===this.newest_||(s===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(s.newer.older=s.older,s.older.newer=s.newer),s.newer=null,s.older=this.newest_,this.newest_.newer=s,this.newest_=s),s.value_}remove(e){const i=this.entries_[e];return assert(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_?(this.newest_=i.older,this.newest_&&(this.newest_.newer=null)):i===this.oldest_?(this.oldest_=i.newer,this.oldest_&&(this.oldest_.older=null)):(i.newer.older=i.older,i.older.newer=i.newer),delete this.entries_[e],--this.count_,i.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let i=0,s;for(s=this.newest_;s;s=s.older)e[i++]=s.key_;return e}getValues(){const e=new Array(this.count_);let i=0,s;for(s=this.newest_;s;s=s.older)e[i++]=s.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){var i;return(i=this.entries_[e])==null?void 0:i.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,i){this.get(e),this.entries_[e].value_=i}set(e,i){assert(!(e in this.entries_),"Tried to set a value for a key that is used already");const s={key_:e,newer:null,older:this.newest_,value_:i};this.newest_?this.newest_.newer=s:this.oldest_=s,this.newest_=s,this.entries_[e]=s,++this.count_}setSize(e){this.highWaterMark=e}}function getCacheKey(n,e,i,s,o){return`${getUid(n)},${e},${getKeyZXY(i,s,o)}`}function addTileToLookup(n,e,i){if(!(i in n))return n[i]=new Set([e]),!0;const s=n[i],o=s.has(e);return o||s.add(e),!o}function removeTileFromLookup(n,e,i){const s=n[i];return s?s.delete(e):!1}function getRenderExtent(n,e){const i=n.layerStatesArray[n.layerIndex];i.extent&&(e=getIntersection(e,fromUserExtent(i.extent,n.viewState.projection)));const s=i.layer.getRenderSource();if(!s.getWrapX()){const o=s.getTileGridForProjection(n.viewState.projection).getExtent();o&&(e=getIntersection(e,o))}return e}class CanvasTileLayerRenderer extends CanvasLayerRenderer{constructor(e,i){super(e),i=i||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=createEmpty(),this.tempTileRange_=new TileRange(0,0,0,0),this.tempTileCoord_=createOrUpdate(0,0,0);const s=i.cacheSize!==void 0?i.cacheSize:512;this.tileCache_=new LRUCache(s),this.maxStaleKeys=s*.5}getTileCache(){return this.tileCache_}getOrCreateTile(e,i,s,o){const l=this.tileCache_,u=this.getLayer().getSource(),f=getCacheKey(u,u.getKey(),e,i,s);let g;if(l.containsKey(f))g=l.get(f);else{if(g=u.getTile(e,i,s,o.pixelRatio,o.viewState.projection),!g)return null;l.set(f,g)}return g}getTile(e,i,s,o){const l=this.getOrCreateTile(e,i,s,o);return l||null}getData(e){const i=this.frameState;if(!i)return null;const s=this.getLayer(),o=apply(i.pixelToCoordinateTransform,e.slice()),l=s.getExtent();if(l&&!containsCoordinate(l,o))return null;const c=i.viewState,u=s.getRenderSource(),f=u.getTileGridForProjection(c.projection),g=u.getTilePixelRatio(i.pixelRatio);for(let H=f.getZForResolution(c.resolution);H>=f.getMinZoom();--H){const Y=f.getTileCoordForCoordAndZ(o,H),ee=this.getTile(H,Y[1],Y[2],i);if(!ee||ee.getState()!==TileState.LOADED)continue;const te=f.getOrigin(H),ne=toSize(f.getTileSize(H)),Ye=f.getResolution(H);let xe;if(ee instanceof ImageTile||ee instanceof ReprojTile)xe=ee.getImage();else if(ee instanceof DataTile){if(xe=asImageLike(ee.getData()),!xe)continue}else continue;const tt=Math.floor(g*((o[0]-te[0])/Ye-Y[1]*ne[0])),et=Math.floor(g*((te[1]-o[1])/Ye-Y[2]*ne[1])),it=Math.round(g*u.getGutterForProjection(c.projection));return this.getImageData(xe,tt+it,et+it)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const i=this.getLayer().getSource();if(!i)return!1;const s=i.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==s&&(this.renderedSourceRevision_=s,this.renderedSourceKey_===i.getKey()&&this.tileCache_.clear()):this.renderedSourceRevision_=s,!0}enqueueTiles(e,i,s,o,l){const c=e.viewState,u=this.getLayer(),f=u.getRenderSource(),g=f.getTileGridForProjection(c.projection),H=getUid(f);H in e.wantedTiles||(e.wantedTiles[H]={});const Y=e.wantedTiles[H],ee=u.getMapInternal(),te=Math.max(s-l,g.getMinZoom(),g.getZForResolution(Math.min(u.getMaxResolution(),ee?ee.getView().getResolutionForZoom(Math.max(u.getMinZoom(),0)):g.getResolution(0)),f.zDirection)),ne=c.rotation,Ye=ne?getRotatedViewport(c.center,c.resolution,ne,e.size):void 0;for(let xe=s;xe>=te;--xe){const tt=g.getTileRangeForExtentAndZ(i,xe,this.tempTileRange_),et=g.getResolution(xe);for(let it=tt.minX;it<=tt.maxX;++it)for(let rt=tt.minY;rt<=tt.maxY;++rt){if(ne&&!g.tileCoordIntersectsViewport([xe,it,rt],Ye))continue;const nt=this.getTile(xe,it,rt,e);if(!nt||!addTileToLookup(o,nt,xe))continue;const st=nt.getKey();if(Y[st]=!0,nt.getState()===TileState.IDLE&&!e.tileQueue.isKeyQueued(st)){const ot=createOrUpdate(xe,it,rt,this.tempTileCoord_);e.tileQueue.enqueue([nt,H,g.getTileCoordCenter(ot),et])}}}}findStaleTile_(e,i){const s=this.tileCache_,o=e[0],l=e[1],c=e[2],u=this.getStaleKeys();for(let f=0;f<u.length;++f){const g=getCacheKey(this.getLayer().getSource(),u[f],o,l,c);if(s.containsKey(g)){const H=s.peek(g);if(H.getState()===TileState.LOADED)return H.endTransition(getUid(this)),addTileToLookup(i,H,o),!0}}return!1}findAltTiles_(e,i,s,o){const l=e.getTileRangeForTileCoordAndZ(i,s,this.tempTileRange_);if(!l)return!1;let c=!0;const u=this.tileCache_,f=this.getLayer().getRenderSource(),g=f.getKey();for(let H=l.minX;H<=l.maxX;++H)for(let Y=l.minY;Y<=l.maxY;++Y){const ee=getCacheKey(f,g,s,H,Y);let te=!1;if(u.containsKey(ee)){const ne=u.peek(ee);ne.getState()===TileState.LOADED&&(addTileToLookup(o,ne,s),te=!0)}te||(c=!1)}return c}renderFrame(e,i){this.renderComplete=!0;const s=e.layerStatesArray[e.layerIndex],o=e.viewState,l=o.projection,c=o.resolution,u=o.center,f=e.pixelRatio,g=this.getLayer(),H=g.getSource(),Y=H.getTileGridForProjection(l),ee=Y.getZForResolution(c,H.zDirection),te=Y.getResolution(ee),ne=H.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==ne&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=ne):this.renderedSourceKey_=ne;let Ye=e.extent;const xe=H.getTilePixelRatio(f);this.prepareContainer(e,i);const tt=this.context.canvas.width,et=this.context.canvas.height,it=s.extent&&fromUserExtent(s.extent);it&&(Ye=getIntersection(Ye,fromUserExtent(s.extent)));const rt=te*tt/2/xe,nt=te*et/2/xe,at=[u[0]-rt,u[1]-nt,u[0]+rt,u[1]+nt],st={};this.renderedTiles.length=0;const ot=g.getPreload();if(e.nextExtent){const Lt=Y.getZForResolution(o.nextResolution,H.zDirection),Gt=getRenderExtent(e,e.nextExtent);this.enqueueTiles(e,Gt,Lt,st,ot)}const ut=getRenderExtent(e,Ye);if(this.enqueueTiles(e,ut,ee,st,0),ot>0&&setTimeout(()=>{this.enqueueTiles(e,ut,ee-1,st,ot-1)},0),!(ee in st))return this.container;const ht=getUid(this),dt=e.time;for(const Lt of st[ee]){const Gt=Lt.getState();if(Gt===TileState.EMPTY)continue;const vt=Lt.tileCoord;if(Gt===TileState.LOADED&&Lt.getAlpha(ht,dt)===1){Lt.endTransition(ht);continue}if(Gt!==TileState.ERROR&&(this.renderComplete=!1),this.findStaleTile_(vt,st)){removeTileFromLookup(st,Lt,ee),e.animate=!0;continue}if(this.findAltTiles_(Y,vt,ee+1,st))continue;const Ct=Y.getMinZoom();for(let ct=ee-1;ct>=Ct&&!this.findAltTiles_(Y,vt,ct,st);--ct);}const pt=te/c*f/xe,yt=this.getRenderContext(e);compose(this.tempTransform,tt/2,et/2,pt,pt,0,-tt/2,-et/2),s.extent&&this.clipUnrotated(yt,e,it),H.getInterpolate()||(yt.imageSmoothingEnabled=!1),this.preRender(yt,e);const mt=Object.keys(st).map(Number);mt.sort(ascending);let St;const wt=[],Rt=[];for(let Lt=mt.length-1;Lt>=0;--Lt){const Gt=mt[Lt],vt=H.getTilePixelSize(Gt,f,l),_t=Y.getResolution(Gt)/te,Ct=vt[0]*_t*pt,ct=vt[1]*_t*pt,ft=Y.getTileCoordForCoordAndZ(getTopLeft(at),Gt),bt=Y.getTileCoordExtent(ft),Ft=apply(this.tempTransform,[xe*(bt[0]-at[0])/te,xe*(at[3]-bt[3])/te]),Bt=xe*H.getGutterForProjection(l);for(const Xt of st[Gt]){if(Xt.getState()!==TileState.LOADED)continue;const Ot=Xt.tileCoord,It=ft[1]-Ot[1],xt=Math.round(Ft[0]-(It-1)*Ct),Tt=ft[2]-Ot[2],Ht=Math.round(Ft[1]-(Tt-1)*ct),Dt=Math.round(Ft[0]-It*Ct),qt=Math.round(Ft[1]-Tt*ct),kt=xt-Dt,$t=Ht-qt,Ut=mt.length===1;let zt=!1;St=[Dt,qt,Dt+kt,qt,Dt+kt,qt+$t,Dt,qt+$t];for(let Yt=0,Jt=wt.length;Yt<Jt;++Yt)if(!Ut&&Gt<Rt[Yt]){const Pt=wt[Yt];intersects$1([Dt,qt,Dt+kt,qt+$t],[Pt[0],Pt[3],Pt[4],Pt[7]])&&(zt||(yt.save(),zt=!0),yt.beginPath(),yt.moveTo(St[0],St[1]),yt.lineTo(St[2],St[3]),yt.lineTo(St[4],St[5]),yt.lineTo(St[6],St[7]),yt.moveTo(Pt[6],Pt[7]),yt.lineTo(Pt[4],Pt[5]),yt.lineTo(Pt[2],Pt[3]),yt.lineTo(Pt[0],Pt[1]),yt.clip())}wt.push(St),Rt.push(Gt),this.drawTile(Xt,e,Dt,qt,kt,$t,Bt,Ut),zt&&yt.restore(),this.renderedTiles.unshift(Xt),this.updateUsedTiles(e.usedTiles,H,Xt)}}if(this.renderedResolution=te,this.extentChanged=!this.renderedExtent_||!equals$1(this.renderedExtent_,at),this.renderedExtent_=at,this.renderedPixelRatio=f,this.postRender(this.context,e),s.extent&&yt.restore(),yt.imageSmoothingEnabled=!0,this.renderComplete){const Lt=(Gt,vt)=>{const Et=getUid(H),_t=vt.wantedTiles[Et],Ct=_t?Object.keys(_t).length:0;this.updateCacheSize(Ct),this.tileCache_.expireCache()};e.postRenderFunctions.push(Lt)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,i,s,o,l,c,u,f){let g;if(e instanceof DataTile){if(g=asImageLike(e.getData()),!g)throw new Error("Rendering array data is not yet supported")}else g=this.getTileImage(e);if(!g)return;const H=this.getRenderContext(i),Y=getUid(this),ee=i.layerStatesArray[i.layerIndex],te=ee.opacity*(f?e.getAlpha(Y,i.time):1),ne=te!==H.globalAlpha;ne&&(H.save(),H.globalAlpha=te),H.drawImage(g,u,u,g.width-2*u,g.height-2*u,s,o,l,c),ne&&H.restore(),te!==ee.opacity?i.animate=!0:f&&e.endTransition(Y)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,i,s){const o=getUid(i);o in e||(e[o]={}),e[o][s.getKey()]=!0}}const TileProperty={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class BaseTileLayer extends Layer$1{constructor(e){e=e||{};const i=Object.assign({},e),s=e.cacheSize;delete e.cacheSize,delete i.preload,delete i.useInterimTilesOnError,super(i),this.on,this.once,this.un,this.cacheSize_=s,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(TileProperty.PRELOAD)}setPreload(e){this.set(TileProperty.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}class TileLayer extends BaseTileLayer{constructor(e){super(e)}createRenderer(){return new CanvasTileLayerRenderer(this,{cacheSize:this.getCacheSize()})}}class LayerWMTS extends TileLayer{constructor(e){if(!e.layer)throw new Error("ERROR PARAM_MISSING : layer");if(typeof e.layer!="string")throw new Error("ERROR WRONG TYPE : layer");typeof e.ssl>"u"&&(e.ssl=!0);var i=e.configuration;if(!i){if(!Config.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers.");var s=Config.configuration.getLayerId(e.layer,"WMTS");if(i=Config.configuration.getLayerConf(s),!i)throw new Error("ERROR : Layer ID not found into the catalogue !?")}var o;e.olParams&&e.olParams.sourceParams&&(o=e.olParams.sourceParams);var l=new SourceWMTS({layer:e.layer,configuration:e.configuration,ssl:e.ssl,apiKey:e.apiKey,olParams:o}),c={source:l};if(l.getLayer()!==void 0&&i.globalConstraint){var u=[i.globalConstraint.bbox.left,i.globalConstraint.bbox.bottom,i.globalConstraint.bbox.right,i.globalConstraint.bbox.top];c.extent=transformExtent(u,"EPSG:4326",i.globalConstraint.projection||"EPSG:3857");var f;typeof i.globalConstraint.projection=="string"?f=get$3(i.globalConstraint.projection):f=get$3("EPSG:3857"),f&&f.getUnits()&&(f.getUnits()==="m"?(c.minResolution=(i.globalConstraint.minScaleDenominator-1)*28e-5,c.maxResolution=(i.globalConstraint.maxScaleDenominator+1)*28e-5):f.getUnits()==="degrees"&&(c.minResolution=(i.globalConstraint.minScaleDenominator-1)*28e-5*180/(Math.PI*6378137),c.maxResolution=(i.globalConstraint.maxScaleDenominator+1)*28e-5*180/(Math.PI*6378137)))}return Helper.mergeParams(c,e.olParams),super(c),this.name=e.layer,this.service="WMTS",this.config=i,this}getConfiguration(){return this.config}getLegends(){return this.getSource()._legends}getMetadata(){return this.getSource()._metadata}getDescription(){return this.getSource()._description}getTitle(){return this.getSource()._title}getQuicklookUrl(){return this.getSource()._quicklookUrl}getOriginators(){return this.getSource()._originators}}window.ol&&window.ol.layer&&(window.ol.layer.GeoportalWMTS=LayerWMTS);class LayerWMS extends TileLayer{constructor(e){if(!e.layer)throw new Error("ERROR PARAM_MISSING : layer");if(typeof e.layer!="string")throw new Error("ERROR WRONG TYPE : layer");typeof e.ssl>"u"&&(e.ssl=!0);var i=e.configuration;if(!i){if(!Config.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers.");var s=Config.configuration.getLayerId(e.layer,"WMS");if(i=Config.configuration.getLayerConf(s),!i)throw new Error("ERROR : Layer ID not found into the catalogue !?")}var o;e.olParams&&e.olParams.sourceParams&&(o=e.olParams.sourceParams);var l=new SourceWMS({layer:e.layer,configuration:e.configuration,ssl:e.ssl,apiKey:e.apiKey,olParams:o}),c={source:l};if(l.getParams().LAYERS!==void 0&&o&&o.projection){var u=[i.globalConstraint.bbox.left,i.globalConstraint.bbox.bottom,i.globalConstraint.bbox.right,i.globalConstraint.bbox.top];c.extent=transformExtent(u,"EPSG:4326",o.projection);var f;typeof o.projection=="string"?f=get$3(o.projection):typeof o.projection=="object"&&o.projection.getCode()&&(f=get$3(o.projection.getCode())),f&&f.getUnits()&&(f.getUnits()==="m"?(c.minResolution=(i.globalConstraint.minScaleDenominator-1)*28e-5,c.maxResolution=(i.globalConstraint.maxScaleDenominator+1)*28e-5):f.getUnits()==="degrees"&&(c.minResolution=(i.globalConstraint.minScaleDenominator-1)*28e-5*180/(Math.PI*6378137),c.maxResolution=(i.globalConstraint.maxScaleDenominator+1)*28e-5*180/(Math.PI*6378137)))}return Helper.mergeParams(c,e.olParams),super(c),this.name=e.layer,this.service="WMS",this.config=i,this}getConfiguration(){return this.config}getLegends(){return this.getSource()._legends}getMetadata(){return this.getSource()._metadata}getDescription(){return this.getSource()._description}getTitle(){return this.getSource()._title}getQuicklookUrl(){return this.getSource()._quicklookUrl}getOriginators(){return this.getSource()._originators}}window.ol&&window.ol.layer&&(window.ol.layer.GeoportalWMS=LayerWMS);const MAXFEATURES=500,MINZOOMDEFAULT=15,MAXZOOMDEFAULT=21,STYLEBYDEFAULT=new Style$1({stroke:new Stroke({color:"rgba(0, 0, 255, 1.0)",width:2}),fill:new Fill({color:"rgba(0, 0, 255, 0.5)"})});class LayerWFS extends VectorLayer{constructor(e){if(!e.layer)throw new Error("ERROR PARAM_MISSING : layer");if(typeof e.layer!="string")throw new Error("ERROR WRONG TYPE : layer");typeof e.ssl>"u"&&(e.ssl=!0);var i=e.configuration;if(!i){if(!Config.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers.");var s=Config.configuration.getLayerId(e.layer,"WFS");if(i=Config.configuration.getLayerConf(s),!i)throw new Error("ERROR : Layer ID not found into the catalogue !?")}var o;e.olParams&&e.olParams.sourceParams&&(o=e.olParams.sourceParams);var l=new SourceWFS({layer:e.layer,configuration:e.configuration,maxFeatures:e.maxFeatures||MAXFEATURES,ssl:e.ssl,apiKey:e.apiKey,olParams:o||{minZoom:MINZOOMDEFAULT,maxZoom:MAXZOOMDEFAULT}}),c={source:l};return e.olParams?Helper.mergeParams({minZoom:MINZOOMDEFAULT,maxZoom:MAXZOOMDEFAULT,style:STYLEBYDEFAULT},e.olParams):e.olParams={minZoom:MINZOOMDEFAULT,maxZoom:MAXZOOMDEFAULT,style:STYLEBYDEFAULT},Helper.mergeParams(c,e.olParams),super(c),this.name=e.layer,this.service="WFS",this.config=i,this}getConfiguration(){return this.config}getLegends(){return this.getSource()._legends}getMetadata(){return this.getSource()._metadata}getDescription(){return this.getSource()._description}getTitle(){return this.getSource()._title}getQuicklookUrl(){return this.getSource()._quicklookUrl}getOriginators(){return this.getSource()._originators}}window.ol&&window.ol.layer&&(window.ol.layer.GeoportalWFS=LayerWFS);const IMAGE_REPLAYS={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},VECTOR_REPLAYS={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class CanvasVectorTileLayerRenderer extends CanvasTileLayerRenderer{constructor(e,i){super(e,i),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=create(),this.tileClipContexts_=null}drawTile(e,i,s,o,l,c,u,f){this.updateExecutorGroup_(e,i.pixelRatio,i.viewState.projection),this.tileImageNeedsRender_(e)&&this.renderTileImage_(e,i),super.drawTile(e,i,s,o,l,c,u,f)}getTile(e,i,s,o){const l=this.getOrCreateTile(e,i,s,o);if(!l)return null;const u=o.viewState.resolution,f=o.viewHints;return(!(f[ViewHint.ANIMATING]||f[ViewHint.INTERACTING])||!l.wantedResolution)&&(l.wantedResolution=u),l}prepareFrame(e){const i=this.getLayer().getRevision();return this.renderedLayerRevision_!==i&&(this.renderedLayerRevision_=i,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,i,s){const o=this.getLayer(),l=o.getRevision(),c=o.getRenderOrder()||null,u=e.wantedResolution,f=e.getReplayState(o);if(!f.dirty&&f.renderedResolution===u&&f.renderedRevision==l&&f.renderedRenderOrder==c)return;const g=o.getSource(),H=!!o.getDeclutter(),Y=g.getTileGrid(),te=g.getTileGridForProjection(s).getTileCoordExtent(e.wrappedTileCoord),ne=g.getSourceTiles(i,s,e),Ye=getUid(o);delete e.hitDetectionImageData[Ye],e.executorGroups[Ye]=[],f.dirty=!1;for(let xe=0,tt=ne.length;xe<tt;++xe){const et=ne[xe];if(et.getState()!=TileState.LOADED)continue;const it=et.tileCoord,rt=Y.getTileCoordExtent(it),nt=getIntersection(te,rt),at=buffer(nt,o.getRenderBuffer()*u,this.tempExtent),st=equals$1(rt,nt)?null:at,ot=new BuilderGroup(0,nt,u,i),ut=getSquaredTolerance(u,i),ht=function(St,wt){let Rt;const Lt=St.getStyleFunction()||o.getStyleFunction();if(Lt&&(Rt=Lt(St,u)),Rt){const Gt=this.renderFeature(St,ut,Rt,ot,H,wt);f.dirty=f.dirty||Gt}},dt=et.getFeatures();c&&c!==f.renderedRenderOrder&&dt.sort(c);for(let St=0,wt=dt.length;St<wt;++St){const Rt=dt[St];(!st||intersects$1(st,Rt.getGeometry().getExtent()))&&ht.call(this,Rt,St)}const pt=ot.finish(),yt=o.getRenderMode()!=="vector"&&H&&ne.length===1?null:nt,mt=new ExecutorGroup(yt,u,i,g.getOverlaps(),pt,o.getRenderBuffer(),!0);e.executorGroups[Ye].push(mt)}f.renderedRevision=l,f.renderedRenderOrder=c,f.renderedResolution=u}forEachFeatureAtCoordinate(e,i,s,o,l){var it,rt;const c=i.viewState.resolution,u=i.viewState.rotation;s=s??0;const f=this.getLayer(),H=f.getSource().getTileGridForProjection(i.viewState.projection),Y=boundingExtent([e]);buffer(Y,c*s,Y);const ee={},te=function(nt,at,st){let ot=nt.getId();ot===void 0&&(ot=getUid(nt));const ut=ee[ot];if(ut){if(ut!==!0&&st<ut.distanceSq){if(st===0)return ee[ot]=!0,l.splice(l.lastIndexOf(ut),1),o(nt,f,at);ut.geometry=at,ut.distanceSq=st}}else{if(st===0)return ee[ot]=!0,o(nt,f,at);l.push(ee[ot]={feature:nt,layer:f,geometry:at,distanceSq:st,callback:o})}},ne=this.renderedTiles,Ye=getUid(f),xe=f.getDeclutter(),tt=xe?(rt=(it=i.declutter)==null?void 0:it[xe])==null?void 0:rt.all().map(nt=>nt.value):null;let et;e:for(let nt=0,at=ne.length;nt<at;++nt){const st=ne[nt],ot=H.getTileCoordExtent(st.wrappedTileCoord);if(!intersects$1(ot,Y))continue;const ut=st.executorGroups[Ye];for(let ht=0,dt=ut.length;ht<dt;++ht)if(et=ut[ht].forEachFeatureAtCoordinate(e,c,u,s,te,tt),et)break e}return et}getFeatures(e){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((i,s)=>{const o=this.getLayer(),l=o.getSource(),c=this.renderedProjection,u=c.getExtent(),f=this.renderedResolution,g=l.getTileGridForProjection(c),H=apply(this.renderedPixelToCoordinateTransform_,e.slice()),Y=g.getTileCoordForCoordAndResolution(H,f).toString(),ee=this.renderedTiles.find(it=>it.tileCoord.toString()===Y&&it.getState()===TileState.LOADED);if(!ee||ee.loadingSourceTiles>0){i([]);return}l.getWrapX()&&c.canWrapX()&&!containsExtent(u,g.getTileCoordExtent(ee.tileCoord))&&wrapX$1(H,c);const te=getUid(o),ne=g.getTileCoordExtent(ee.wrappedTileCoord),Ye=getTopLeft(ne),xe=[(H[0]-Ye[0])/f,(Ye[1]-H[1])/f],tt=ee.getSourceTiles().reduce((it,rt)=>it.concat(rt.getFeatures()),[]);let et=ee.hitDetectionImageData[te];if(!et){const it=toSize(g.getTileSize(g.getZForResolution(f,l.zDirection))),rt=this.renderedRotation_,nt=[this.getRenderTransform(g.getTileCoordCenter(ee.wrappedTileCoord),f,0,HIT_DETECT_RESOLUTION,it[0]*HIT_DETECT_RESOLUTION,it[1]*HIT_DETECT_RESOLUTION,0)];et=createHitDetectionImageData(it,nt,tt,o.getStyleFunction(),g.getTileCoordExtent(ee.wrappedTileCoord),ee.getReplayState(o).renderedResolution,rt),ee.hitDetectionImageData[te]=et}i(hitDetect(xe,tt,et))})}getFeaturesInExtent(e){const i=[],s=this.getTileCache();if(s.getCount()===0)return i;const l=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),c=l.getZForResolution(this.renderedResolution),u={};return s.forEach(f=>{if(f.tileCoord[0]!==c||f.getState()!==TileState.LOADED)return;const g=f.getSourceTiles();for(let H=0,Y=g.length;H<Y;++H){const ee=g[H],te=ee.getKey();if(te in u)continue;u[te]=!0;const ne=ee.tileCoord;if(intersects$1(e,l.getTileCoordExtent(ne))){const Ye=ee.getFeatures();if(Ye)for(let xe=0,tt=Ye.length;xe<tt;++xe){const et=Ye[xe],it=et.getGeometry();intersects$1(e,it.getExtent())&&i.push(et)}}}}),i}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,i){var ee;const s=this.context,o=s.globalAlpha;s.globalAlpha=i.opacity;const l=e.viewHints,c=!(l[ViewHint.ANIMATING]||l[ViewHint.INTERACTING]),u=[this.context.canvas.width,this.context.canvas.height],f=this.getLayer().getDeclutter(),g=f?(ee=e.declutter)==null?void 0:ee[f]:void 0,H=getUid(this.getLayer()),Y=this.renderedTiles;for(let te=0,ne=Y.length;te<ne;++te){const Ye=Y[te],xe=Ye.executorGroups[H];if(xe)for(let tt=xe.length-1;tt>=0;--tt)xe[tt].execute(this.context,u,this.getTileRenderTransform(Ye,e),e.viewState.rotation,c,DECLUTTER,g)}s.globalAlpha=o}renderDeferredInternal(e){const i=this.renderedTiles,s=getUid(this.getLayer()),o=i.reduce((f,g,H)=>(g.executorGroups[s].forEach(Y=>f.push({executorGroup:Y,index:H})),f),[]),l=o.map(({executorGroup:f})=>f.getDeferredZIndexContexts()),c={};for(let f=0,g=o.length;f<g;++f){const H=o[f].executorGroup.getDeferredZIndexContexts();for(const Y in H)c[Y]=!0}Object.keys(c).map(Number).sort(ascending).forEach(f=>{l.forEach((g,H)=>{g[f]&&(g[f].forEach(Y=>{const{executorGroup:ee,index:te}=o[H],ne=ee.getRenderedContext(),Ye=ne.globalAlpha;ne.globalAlpha=this.renderedOpacity_;const xe=this.tileClipContexts_[te];xe&&xe.draw(ne),Y.draw(ne),xe&&ne.restore(),ne.globalAlpha=Ye,Y.clear()}),g[f].length=0)})})}getTileRenderTransform(e,i){const s=i.pixelRatio,o=i.viewState,l=o.center,c=o.resolution,u=o.rotation,f=i.size,g=Math.round(f[0]*s),H=Math.round(f[1]*s),ee=this.getLayer().getSource().getTileGridForProjection(i.viewState.projection),te=e.tileCoord,ne=ee.getTileCoordExtent(e.wrappedTileCoord),Ye=ee.getTileCoordExtent(te,this.tempExtent)[0]-ne[0];return multiply(scale(this.inversePixelTransform.slice(),1/s,1/s),this.getRenderTransform(l,c,u,s,g,H,Ye))}postRender(e,i){var nt;const s=i.viewHints,o=!(s[ViewHint.ANIMATING]||s[ViewHint.INTERACTING]);this.renderedPixelToCoordinateTransform_=i.pixelToCoordinateTransform.slice(),this.renderedRotation_=i.viewState.rotation,this.renderedOpacity_=i.layerStatesArray[i.layerIndex].opacity;const l=this.getLayer(),c=l.getRenderMode(),u=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;const f=l.getDeclutter(),g=f?VECTOR_REPLAYS[c].filter(at=>!DECLUTTER.includes(at)):VECTOR_REPLAYS[c],H=i.viewState,Y=H.rotation,ee=l.getSource(),ne=ee.getTileGridForProjection(H.projection).getZForResolution(H.resolution,ee.zDirection),Ye=this.renderedTiles,xe=[],tt=[],et=[],it=getUid(l);let rt=!0;for(let at=Ye.length-1;at>=0;--at){const st=Ye[at];rt=rt&&!st.getReplayState(l).dirty;const ot=st.executorGroups[it].filter(St=>St.hasExecutors(g));if(ot.length===0)continue;const ut=this.getTileRenderTransform(st,i),ht=st.tileCoord[0];let dt=!1;const pt=ot[0].getClipCoords(ut);let yt=e,mt;if(pt){mt=new ZIndexContext,yt=mt.getContext();for(let St=0,wt=xe.length;St<wt;++St)if(ne!==ht&&ht<tt[St]){const Rt=xe[St];intersects$1([pt[0],pt[3],pt[4],pt[7]],[Rt[0],Rt[3],Rt[4],Rt[7]])&&(dt||(yt.save(),dt=!0),yt.beginPath(),yt.moveTo(pt[0],pt[1]),yt.lineTo(pt[2],pt[3]),yt.lineTo(pt[4],pt[5]),yt.lineTo(pt[6],pt[7]),yt.moveTo(Rt[6],Rt[7]),yt.lineTo(Rt[4],Rt[5]),yt.lineTo(Rt[2],Rt[3]),yt.lineTo(Rt[0],Rt[1]),yt.clip())}xe.push(pt),tt.push(ht)}for(let St=0,wt=ot.length;St<wt;++St)ot[St].execute(e,[e.canvas.width,e.canvas.height],ut,Y,o,g,(nt=i.declutter)==null?void 0:nt[f]);dt&&(yt===e?yt.restore():et[at]=mt)}e.globalAlpha=u,this.ready=rt,this.tileClipContexts_=et,i.declutter||this.renderDeferredInternal(i),super.postRender(e,i)}renderFeature(e,i,s,o,l,c){if(!s)return!1;let u=!1;if(Array.isArray(s))for(let f=0,g=s.length;f<g;++f)u=renderFeature$1(o,e,s[f],i,this.boundHandleStyleImageChange_,void 0,l,c)||u;else u=renderFeature$1(o,e,s,i,this.boundHandleStyleImageChange_,void 0,l,c);return u}tileImageNeedsRender_(e){const i=this.getLayer();if(i.getRenderMode()==="vector")return!1;const s=e.getReplayState(i),o=i.getRevision(),l=e.wantedResolution;return s.renderedTileResolution!==l||s.renderedTileRevision!==o}renderTileImage_(e,i){const s=this.getLayer(),o=e.getReplayState(s),l=s.getRevision(),c=e.executorGroups[getUid(s)];o.renderedTileRevision=l;const u=e.wrappedTileCoord,f=u[0],g=s.getSource();let H=i.pixelRatio;const ee=i.viewState.projection,te=g.getTileGridForProjection(ee),ne=te.getResolution(e.tileCoord[0]),Ye=i.pixelRatio/e.wantedResolution*ne,xe=te.getResolution(f),tt=e.getContext();H=Math.round(Math.max(H,Ye/H));const et=g.getTilePixelSize(f,H,ee);tt.canvas.width=et[0],tt.canvas.height=et[1];const it=H/Ye;if(it!==1){const st=reset(this.tmpTransform_);scale(st,it,it),tt.setTransform.apply(tt,st)}const rt=te.getTileCoordExtent(u,this.tempExtent),nt=Ye/xe,at=reset(this.tmpTransform_);scale(at,nt,-nt),translate(at,-rt[0],-rt[3]);for(let st=0,ot=c.length;st<ot;++st)c[st].execute(tt,[tt.canvas.width*it,tt.canvas.height*it],at,0,!0,IMAGE_REPLAYS[s.getRenderMode()],null);o.renderedTileResolution=e.wantedResolution}}class VectorTileLayer extends BaseVectorLayer{constructor(e){e=e||{};const i=Object.assign({},e);delete i.preload;const s=e.cacheSize===void 0?0:e.cacheSize;delete e.cacheSize,delete i.useInterimTilesOnError,super(i),this.on,this.once,this.un,this.cacheSize_=s;const o=e.renderMode||"hybrid";assert(o=="hybrid"||o=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=o,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new CanvasVectorTileLayerRenderer(this,{cacheSize:this.cacheSize_})}getFeatures(e){return super.getFeatures(e)}getFeaturesInExtent(e){return this.getRenderer().getFeaturesInExtent(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(TileProperty.PRELOAD)}getUseInterimTilesOnError(){return this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(TileProperty.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR,e)}}function jsonp(n,e,i,s){const o=document.createElement("script"),l="olc_"+getUid(e);function c(){delete window[l],o.parentNode.removeChild(o)}o.async=!0,o.src=n+(n.includes("?")?"&":"?")+"callback="+l;const u=setTimeout(function(){c(),i&&i()},1e4);window[l]=function(f){clearTimeout(u),c(),e(f)},document.head.appendChild(o)}class TileJSON extends TileImage{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:get$3("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)jsonp(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const i=new XMLHttpRequest;i.addEventListener("load",this.onXHRLoad_.bind(this)),i.addEventListener("error",this.onXHRError_.bind(this)),i.open("GET",e.url),i.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const i=e.target;if(!i.status||i.status>=200&&i.status<300){let s;try{s=JSON.parse(i.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(s)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const i=get$3("EPSG:4326"),s=this.getProjection();let o;if(e.bounds!==void 0){const g=getTransformFromProjections(i,s);o=applyTransform(e.bounds,g)}const l=extentFromProjection(s),c=e.minzoom||0,u=e.maxzoom||22,f=createXYZ({extent:l,maxZoom:u,minZoom:c,tileSize:this.tileSize_});if(this.tileGrid=f,this.tileUrlFunction=createFromTemplates(e.tiles,f),e.attribution&&!this.getAttributions()){const g=o!==void 0?o:l;this.setAttributions(function(H){return intersects$1(g,H.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}const SHIFT_LEFT_32=65536*65536,SHIFT_RIGHT_32=1/SHIFT_LEFT_32,TEXT_DECODER_MIN_LENGTH=12,utf8TextDecoder=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),PBF_VARINT=0,PBF_FIXED64=1,PBF_BYTES=2,PBF_FIXED32=5;class Pbf{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,i,s=this.length){for(;this.pos<s;){const o=this.readVarint(),l=o>>3,c=this.pos;this.type=o&7,e(l,i,this),this.pos===c&&this.skip(o)}return i}readMessage(e,i){return this.readFields(e,i,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*SHIFT_LEFT_32;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*SHIFT_LEFT_32;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const i=this.buf;let s,o;return o=i[this.pos++],s=o&127,o<128||(o=i[this.pos++],s|=(o&127)<<7,o<128)||(o=i[this.pos++],s|=(o&127)<<14,o<128)||(o=i[this.pos++],s|=(o&127)<<21,o<128)?s:(o=i[this.pos],s|=(o&15)<<28,readVarintRemainder(s,e,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2===1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,i=this.pos;return this.pos=e,e-i>=TEXT_DECODER_MIN_LENGTH&&utf8TextDecoder?utf8TextDecoder.decode(this.buf.subarray(i,e)):readUtf8(this.buf,i,e)}readBytes(){const e=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,e);return this.pos=e,i}readPackedVarint(e=[],i){const s=this.readPackedEnd();for(;this.pos<s;)e.push(this.readVarint(i));return e}readPackedSVarint(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===PBF_BYTES?this.readVarint()+this.pos:this.pos+1}skip(e){const i=e&7;if(i===PBF_VARINT)for(;this.buf[this.pos++]>127;);else if(i===PBF_BYTES)this.pos=this.readVarint()+this.pos;else if(i===PBF_FIXED32)this.pos+=4;else if(i===PBF_FIXED64)this.pos+=8;else throw new Error(`Unimplemented type: ${i}`)}writeTag(e,i){this.writeVarint(e<<3|i)}realloc(e){let i=this.length||16;for(;i<this.pos+e;)i*=2;if(i!==this.length){const s=new Uint8Array(i);s.set(this.buf),this.buf=s,this.dataView=new DataView(s.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*SHIFT_RIGHT_32),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*SHIFT_RIGHT_32),!0),this.pos+=8}writeVarint(e){if(e=+e||0,e>268435455||e<0){writeBigVarint(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))}writeSVarint(e){this.writeVarint(e<0?-e*2-1:e*2)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(e.length*4),this.pos++;const i=this.pos;this.pos=writeUtf8(this.buf,e,this.pos);const s=this.pos-i;s>=128&&makeRoomForExtraLength(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const i=e.length;this.writeVarint(i),this.realloc(i);for(let s=0;s<i;s++)this.buf[this.pos++]=e[s]}writeRawMessage(e,i){this.pos++;const s=this.pos;e(i,this);const o=this.pos-s;o>=128&&makeRoomForExtraLength(s,o,this),this.pos=s-1,this.writeVarint(o),this.pos+=o}writeMessage(e,i,s){this.writeTag(e,PBF_BYTES),this.writeRawMessage(i,s)}writePackedVarint(e,i){i.length&&this.writeMessage(e,writePackedVarint,i)}writePackedSVarint(e,i){i.length&&this.writeMessage(e,writePackedSVarint,i)}writePackedBoolean(e,i){i.length&&this.writeMessage(e,writePackedBoolean,i)}writePackedFloat(e,i){i.length&&this.writeMessage(e,writePackedFloat,i)}writePackedDouble(e,i){i.length&&this.writeMessage(e,writePackedDouble,i)}writePackedFixed32(e,i){i.length&&this.writeMessage(e,writePackedFixed32,i)}writePackedSFixed32(e,i){i.length&&this.writeMessage(e,writePackedSFixed32,i)}writePackedFixed64(e,i){i.length&&this.writeMessage(e,writePackedFixed64,i)}writePackedSFixed64(e,i){i.length&&this.writeMessage(e,writePackedSFixed64,i)}writeBytesField(e,i){this.writeTag(e,PBF_BYTES),this.writeBytes(i)}writeFixed32Field(e,i){this.writeTag(e,PBF_FIXED32),this.writeFixed32(i)}writeSFixed32Field(e,i){this.writeTag(e,PBF_FIXED32),this.writeSFixed32(i)}writeFixed64Field(e,i){this.writeTag(e,PBF_FIXED64),this.writeFixed64(i)}writeSFixed64Field(e,i){this.writeTag(e,PBF_FIXED64),this.writeSFixed64(i)}writeVarintField(e,i){this.writeTag(e,PBF_VARINT),this.writeVarint(i)}writeSVarintField(e,i){this.writeTag(e,PBF_VARINT),this.writeSVarint(i)}writeStringField(e,i){this.writeTag(e,PBF_BYTES),this.writeString(i)}writeFloatField(e,i){this.writeTag(e,PBF_FIXED32),this.writeFloat(i)}writeDoubleField(e,i){this.writeTag(e,PBF_FIXED64),this.writeDouble(i)}writeBooleanField(e,i){this.writeVarintField(e,+i)}}function readVarintRemainder(n,e,i){const s=i.buf;let o,l;if(l=s[i.pos++],o=(l&112)>>4,l<128||(l=s[i.pos++],o|=(l&127)<<3,l<128)||(l=s[i.pos++],o|=(l&127)<<10,l<128)||(l=s[i.pos++],o|=(l&127)<<17,l<128)||(l=s[i.pos++],o|=(l&127)<<24,l<128)||(l=s[i.pos++],o|=(l&1)<<31,l<128))return toNum(n,o,e);throw new Error("Expected varint not more than 10 bytes")}function toNum(n,e,i){return i?e*4294967296+(n>>>0):(e>>>0)*4294967296+(n>>>0)}function writeBigVarint(n,e){let i,s;if(n>=0?(i=n%4294967296|0,s=n/4294967296|0):(i=~(-n%4294967296),s=~(-n/4294967296),i^4294967295?i=i+1|0:(i=0,s=s+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),writeBigVarintLow(i,s,e),writeBigVarintHigh(s,e)}function writeBigVarintLow(n,e,i){i.buf[i.pos++]=n&127|128,n>>>=7,i.buf[i.pos++]=n&127|128,n>>>=7,i.buf[i.pos++]=n&127|128,n>>>=7,i.buf[i.pos++]=n&127|128,n>>>=7,i.buf[i.pos]=n&127}function writeBigVarintHigh(n,e){const i=(n&7)<<4;e.buf[e.pos++]|=i|((n>>>=3)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127)))))}function makeRoomForExtraLength(n,e,i){const s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));i.realloc(s);for(let o=i.pos-1;o>=n;o--)i.buf[o+s]=i.buf[o]}function writePackedVarint(n,e){for(let i=0;i<n.length;i++)e.writeVarint(n[i])}function writePackedSVarint(n,e){for(let i=0;i<n.length;i++)e.writeSVarint(n[i])}function writePackedFloat(n,e){for(let i=0;i<n.length;i++)e.writeFloat(n[i])}function writePackedDouble(n,e){for(let i=0;i<n.length;i++)e.writeDouble(n[i])}function writePackedBoolean(n,e){for(let i=0;i<n.length;i++)e.writeBoolean(n[i])}function writePackedFixed32(n,e){for(let i=0;i<n.length;i++)e.writeFixed32(n[i])}function writePackedSFixed32(n,e){for(let i=0;i<n.length;i++)e.writeSFixed32(n[i])}function writePackedFixed64(n,e){for(let i=0;i<n.length;i++)e.writeFixed64(n[i])}function writePackedSFixed64(n,e){for(let i=0;i<n.length;i++)e.writeSFixed64(n[i])}function readUtf8(n,e,i){let s="",o=e;for(;o<i;){const l=n[o];let c=null,u=l>239?4:l>223?3:l>191?2:1;if(o+u>i)break;let f,g,H;u===1?l<128&&(c=l):u===2?(f=n[o+1],(f&192)===128&&(c=(l&31)<<6|f&63,c<=127&&(c=null))):u===3?(f=n[o+1],g=n[o+2],(f&192)===128&&(g&192)===128&&(c=(l&15)<<12|(f&63)<<6|g&63,(c<=2047||c>=55296&&c<=57343)&&(c=null))):u===4&&(f=n[o+1],g=n[o+2],H=n[o+3],(f&192)===128&&(g&192)===128&&(H&192)===128&&(c=(l&15)<<18|(f&63)<<12|(g&63)<<6|H&63,(c<=65535||c>=1114112)&&(c=null))),c===null?(c=65533,u=1):c>65535&&(c-=65536,s+=String.fromCharCode(c>>>10&1023|55296),c=56320|c&1023),s+=String.fromCharCode(c),o+=u}return s}function writeUtf8(n,e,i){for(let s=0,o,l;s<e.length;s++){if(o=e.charCodeAt(s),o>55295&&o<57344)if(l)if(o<56320){n[i++]=239,n[i++]=191,n[i++]=189,l=o;continue}else o=l-55296<<10|o-56320|65536,l=null;else{o>56319||s+1===e.length?(n[i++]=239,n[i++]=191,n[i++]=189):l=o;continue}else l&&(n[i++]=239,n[i++]=191,n[i++]=189,l=null);o<128?n[i++]=o:(o<2048?n[i++]=o>>6|192:(o<65536?n[i++]=o>>12|224:(n[i++]=o>>18|240,n[i++]=o>>12&63|128),n[i++]=o>>6&63|128),n[i++]=o&63|128)}return i}class MVT extends FeatureFormat{constructor(e){super(),e=e||{},this.dataProjection=new Projection$1({code:"",units:"tile-pixels"}),this.featureClass=e.featureClass?e.featureClass:RenderFeature,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,i,s,o){e.pos=i.geometry;const l=e.readVarint()+e.pos;let c=1,u=0,f=0,g=0,H=0,Y=0;for(;e.pos<l;){if(!u){const ee=e.readVarint();c=ee&7,u=ee>>3}if(u--,c===1||c===2)f+=e.readSVarint(),g+=e.readSVarint(),c===1&&H>Y&&(o.push(H),Y=H),s.push(f,g),H+=2;else if(c===7)H>Y&&(s.push(s[Y],s[Y+1]),H+=2);else throw new Error("Invalid command found in the PBF")}H>Y&&(o.push(H),Y=H)}createFeature_(e,i,s){const o=i.type;if(o===0)return null;let l;const c=i.properties;let u;this.idProperty_?(u=c[this.idProperty_],delete c[this.idProperty_]):u=i.id,c[this.layerName_]=i.layer.name;const f=[],g=[];this.readRawGeometry_(e,i,f,g);const H=getGeometryType(o,g.length);if(this.featureClass===RenderFeature)l=new this.featureClass(H,f,g,2,c,u),l.transform(s.dataProjection);else{let Y;if(H=="Polygon"){const ne=inflateEnds(f,g);Y=ne.length>1?new MultiPolygon(f,"XY",ne):new Polygon(f,"XY",g)}else Y=H==="Point"?new Point$1(f,"XY"):H==="LineString"?new LineString(f,"XY"):H==="MultiPoint"?new MultiPoint(f,"XY"):H==="MultiLineString"?new MultiLineString(f,"XY",g):null;const ee=this.featureClass;l=new ee,this.geometryName_&&l.setGeometryName(this.geometryName_);const te=transformGeometryWithOptions(Y,!1,s);l.setGeometry(te),u!==void 0&&l.setId(u),l.setProperties(c,!0)}return l}getType(){return"arraybuffer"}readFeatures(e,i){const s=this.layers_;i=this.adaptOptions(i);const o=get$3(i.dataProjection);o.setWorldExtent(i.extent),i.dataProjection=o;const l=new Pbf(e),c=l.readFields(layersPBFReader,{}),u=[];for(const f in c){if(s&&!s.includes(f))continue;const g=c[f],H=g?[0,0,g.extent,g.extent]:null;o.setExtent(H);for(let Y=0,ee=g.length;Y<ee;++Y){const te=readRawFeature(l,g,Y),ne=this.createFeature_(l,te,i);ne!==null&&u.push(ne)}}return u}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}}function layersPBFReader(n,e,i){if(n===3){const s={keys:[],values:[],features:[]},o=i.readVarint()+i.pos;i.readFields(layerPBFReader,s,o),s.length=s.features.length,s.length&&(e[s.name]=s)}}function layerPBFReader(n,e,i){if(n===15)e.version=i.readVarint();else if(n===1)e.name=i.readString();else if(n===5)e.extent=i.readVarint();else if(n===2)e.features.push(i.pos);else if(n===3)e.keys.push(i.readString());else if(n===4){let s=null;const o=i.readVarint()+i.pos;for(;i.pos<o;)n=i.readVarint()>>3,s=n===1?i.readString():n===2?i.readFloat():n===3?i.readDouble():n===4?i.readVarint64():n===5?i.readVarint():n===6?i.readSVarint():n===7?i.readBoolean():null;e.values.push(s)}}function featurePBFReader(n,e,i){if(n==1)e.id=i.readVarint();else if(n==2){const s=i.readVarint()+i.pos;for(;i.pos<s;){const o=e.layer.keys[i.readVarint()],l=e.layer.values[i.readVarint()];e.properties[o]=l}}else n==3?e.type=i.readVarint():n==4&&(e.geometry=i.pos)}function readRawFeature(n,e,i){n.pos=e.features[i];const s=n.readVarint()+n.pos,o={layer:e,type:0,properties:{}};return n.readFields(featurePBFReader,o,s),o}function getGeometryType(n,e){let i;return n===1?i=e===1?"Point":"MultiPoint":n===2?i=e===1?"LineString":"MultiLineString":n===3&&(i="Polygon"),i}var $version=8,$root={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources={"*":{type:"source"}},source=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter={type:"array",value:"*"},filter_operator={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function_stop={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression$1={type:"array",value:"*",minimum:1},light={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},paint_line={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_background={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},promoteId={"*":{type:"string"}},v8Spec={$version,$root,sources,source,source_vector,source_raster,source_raster_dem,source_geojson,source_video,source_image,layer,layout,layout_background,layout_fill,layout_circle,layout_heatmap,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line,layout_symbol,layout_raster,layout_hillshade,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter,filter_operator,geometry_type,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop,expression:expression$1,light,sky,terrain,projection,paint,paint_fill,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line,paint_circle,paint_heatmap,paint_symbol,paint_raster,paint_hillshade,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background,transition,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId};const refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function deref(n,e){const i={};for(const s in n)s!=="ref"&&(i[s]=n[s]);return refProperties.forEach(s=>{s in e&&(i[s]=e[s])}),i}function derefLayers(n){n=n.slice();const e=Object.create(null);for(let i=0;i<n.length;i++)e[n[i].id]=n[i];for(let i=0;i<n.length;i++)"ref"in n[i]&&(n[i]=deref(n[i],e[n[i].ref]));return n}class ExpressionParsingError extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Scope{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,o]of i)this.bindings[s]=o}concat(e){return new Scope(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}const NullType={kind:"null"},NumberType={kind:"number"},StringType={kind:"string"},BooleanType={kind:"boolean"},ColorType={kind:"color"},ProjectionDefinitionType={kind:"projectionDefinition"},ObjectType={kind:"object"},ValueType={kind:"value"},ErrorType={kind:"error"},CollatorType={kind:"collator"},FormattedType={kind:"formatted"},PaddingType={kind:"padding"},ColorArrayType={kind:"colorArray"},NumberArrayType={kind:"numberArray"},ResolvedImageType={kind:"resolvedImage"},VariableAnchorOffsetCollectionType={kind:"variableAnchorOffsetCollection"};function array(n,e){return{kind:"array",itemType:n,N:e}}function typeToString(n){if(n.kind==="array"){const e=typeToString(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}else return n.kind}const valueMemberTypes=[NullType,NumberType,StringType,BooleanType,ColorType,ProjectionDefinitionType,FormattedType,ObjectType,array(ValueType),PaddingType,NumberArrayType,ColorArrayType,ResolvedImageType,VariableAnchorOffsetCollectionType];function checkSubtype(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!checkSubtype(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of valueMemberTypes)if(!checkSubtype(i,e))return null}}return`Expected ${typeToString(n)} but found ${typeToString(e)} instead.`}function isValidType(n,e){return e.some(i=>i.kind===n.kind)}function isValidNativeType(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}function verifyType(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const Xn=.96422,Yn=1,Zn=.82521,t0=4/29,t1=6/29,t2=3*t1*t1,t3=t1*t1*t1,deg2rad$1=Math.PI/180,rad2deg=180/Math.PI;function constrainAngle(n){return n=n%360,n<0&&(n+=360),n}function rgbToLab([n,e,i,s]){n=rgb2xyz(n),e=rgb2xyz(e),i=rgb2xyz(i);let o,l;const c=xyz2lab((.2225045*n+.7168786*e+.0606169*i)/Yn);n===e&&e===i?o=l=c:(o=xyz2lab((.4360747*n+.3850649*e+.1430804*i)/Xn),l=xyz2lab((.0139322*n+.0971045*e+.7141733*i)/Zn));const u=116*c-16;return[u<0?0:u,500*(o-c),200*(c-l),s]}function rgb2xyz(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function xyz2lab(n){return n>t3?Math.pow(n,1/3):n/t2+t0}function labToRgb([n,e,i,s]){let o=(n+16)/116,l=isNaN(e)?o:o+e/500,c=isNaN(i)?o:o-i/200;return o=Yn*lab2xyz(o),l=Xn*lab2xyz(l),c=Zn*lab2xyz(c),[xyz2rgb(3.1338561*l-1.6168667*o-.4906146*c),xyz2rgb(-.9787684*l+1.9161415*o+.033454*c),xyz2rgb(.0719453*l-.2289914*o+1.4052427*c),s]}function xyz2rgb(n){return n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055,n<0?0:n>1?1:n}function lab2xyz(n){return n>t1?n*n*n:t2*(n-t0)}function rgbToHcl(n){const[e,i,s,o]=rgbToLab(n),l=Math.sqrt(i*i+s*s);return[Math.round(l*1e4)?constrainAngle(Math.atan2(s,i)*rad2deg):NaN,l,e,o]}function hclToRgb([n,e,i,s]){return n=isNaN(n)?0:n*deg2rad$1,labToRgb([i,Math.cos(n)*e,Math.sin(n)*e,s])}function hslToRgb([n,e,i,s]){n=constrainAngle(n),e/=100,i/=100;function o(l){const c=(l+n/30)%12,u=e*Math.min(i,1-i);return i-u*Math.max(-1,Math.min(c-3,9-c,1))}return[o(0),o(8),o(4),s]}const hasOwnProperty=Object.hasOwn||function(e,i){return Object.prototype.hasOwnProperty.call(e,i)};function getOwn(n,e){return hasOwnProperty(n,e)?n[e]:void 0}function parseCssColor(n){if(n=n.toLowerCase().trim(),n==="transparent")return[0,0,0,0];const e=getOwn(namedColors,n);if(e){const[o,l,c]=e;return[o/255,l/255,c/255,1]}if(n.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(n)){const l=n.length<6?1:2;let c=1;return[parseHex(n.slice(c,c+=l)),parseHex(n.slice(c,c+=l)),parseHex(n.slice(c,c+=l)),parseHex(n.slice(c,c+l)||"ff")]}if(n.startsWith("rgb")){const o=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,l=n.match(o);if(l){const[c,u,f,g,H,Y,ee,te,ne,Ye,xe,tt]=l,et=[g||" ",ee||" ",Ye].join("");if(et==="  "||et==="  /"||et===",,"||et===",,,"){const it=[f,Y,ne].join(""),rt=it==="%%%"?100:it===""?255:0;if(rt){const nt=[clamp(+u/rt,0,1),clamp(+H/rt,0,1),clamp(+te/rt,0,1),xe?parseAlpha(+xe,tt):1];if(validateNumbers(nt))return nt}}return}}const i=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,s=n.match(i);if(s){const[o,l,c,u,f,g,H,Y,ee]=s,te=[c||" ",f||" ",H].join("");if(te==="  "||te==="  /"||te===",,"||te===",,,"){const ne=[+l,clamp(+u,0,100),clamp(+g,0,100),Y?parseAlpha(+Y,ee):1];if(validateNumbers(ne))return hslToRgb(ne)}}}function parseHex(n){return parseInt(n.padEnd(2,n),16)/255}function parseAlpha(n,e){return clamp(e?n/100:n,0,1)}function clamp(n,e,i){return Math.min(Math.max(e,n),i)}function validateNumbers(n){return!n.some(Number.isNaN)}const namedColors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function interpolateNumber(n,e,i){return n+i*(e-n)}function interpolateArray(n,e,i){return n.map((s,o)=>interpolateNumber(s,e[o],i))}class Color{constructor(e,i,s,o=1,l=!0){this.r=e,this.g=i,this.b=s,this.a=o,l||(this.r*=o,this.g*=o,this.b*=o,o||this.overwriteGetter("rgb",[e,i,s,o]))}static parse(e){if(e instanceof Color)return e;if(typeof e!="string")return;const i=parseCssColor(e);if(i)return new Color(...i,!1)}get rgb(){const{r:e,g:i,b:s,a:o}=this,l=o||1/0;return this.overwriteGetter("rgb",[e/l,i/l,s/l,o])}get hcl(){return this.overwriteGetter("hcl",rgbToHcl(this.rgb))}get lab(){return this.overwriteGetter("lab",rgbToLab(this.rgb))}overwriteGetter(e,i){return Object.defineProperty(this,e,{value:i}),i}toString(){const[e,i,s,o]=this.rgb;return`rgba(${[e,i,s].map(l=>Math.round(l*255)).join(",")},${o})`}static interpolate(e,i,s,o="rgb"){switch(o){case"rgb":{const[l,c,u,f]=interpolateArray(e.rgb,i.rgb,s);return new Color(l,c,u,f,!1)}case"hcl":{const[l,c,u,f]=e.hcl,[g,H,Y,ee]=i.hcl;let te,ne;if(!isNaN(l)&&!isNaN(g)){let it=g-l;g>l&&it>180?it-=360:g<l&&l-g>180&&(it+=360),te=l+s*it}else isNaN(l)?isNaN(g)?te=NaN:(te=g,(u===1||u===0)&&(ne=H)):(te=l,(Y===1||Y===0)&&(ne=c));const[Ye,xe,tt,et]=hclToRgb([te,ne??interpolateNumber(c,H,s),interpolateNumber(u,Y,s),interpolateNumber(f,ee,s)]);return new Color(Ye,xe,tt,et,!1)}case"lab":{const[l,c,u,f]=labToRgb(interpolateArray(e.lab,i.lab,s));return new Color(l,c,u,f,!1)}}}}Color.black=new Color(0,0,0,1);Color.white=new Color(1,1,1,1);Color.transparent=new Color(0,0,0,0);Color.red=new Color(1,0,0,1);class Collator{constructor(e,i,s){e?this.sensitivity=i?"variant":"case":this.sensitivity=i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const VERTICAL_ALIGN_OPTIONS=["bottom","center","top"];class FormattedSection{constructor(e,i,s,o,l,c){this.text=e,this.image=i,this.scale=s,this.fontStack=o,this.textColor=l,this.verticalAlign=c}}class Formatted{constructor(e){this.sections=e}static fromString(e){return new Formatted([new FormattedSection(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Formatted?e:Formatted.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Padding{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Padding)return e;if(typeof e=="number")return new Padding([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const i of e)if(typeof i!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]];break}return new Padding(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,s){return new Padding(interpolateArray(e.values,i.values,s))}}class NumberArray{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof NumberArray)return e;if(typeof e=="number")return new NumberArray([e]);if(Array.isArray(e)){for(const i of e)if(typeof i!="number")return;return new NumberArray(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,s){return new NumberArray(interpolateArray(e.values,i.values,s))}}class ColorArray{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ColorArray)return e;if(typeof e=="string"){const s=Color.parse(e);return s?new ColorArray([s]):void 0}if(!Array.isArray(e))return;const i=[];for(const s of e){if(typeof s!="string")return;const o=Color.parse(s);if(!o)return;i.push(o)}return new ColorArray(i)}toString(){return JSON.stringify(this.values)}static interpolate(e,i,s,o="rgb"){const l=[];if(e.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let c=0;c<e.values.length;c++)l.push(Color.interpolate(e.values[c],i.values[c],s,o));return new ColorArray(l)}}class RuntimeError extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const anchors=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class VariableAnchorOffsetCollection{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof VariableAnchorOffsetCollection)return e;if(!(!Array.isArray(e)||e.length<1||e.length%2!==0)){for(let i=0;i<e.length;i+=2){const s=e[i],o=e[i+1];if(typeof s!="string"||!anchors.has(s)||!Array.isArray(o)||o.length!==2||typeof o[0]!="number"||typeof o[1]!="number")return}return new VariableAnchorOffsetCollection(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,s){const o=e.values,l=i.values;if(o.length!==l.length)throw new RuntimeError(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${i.toString()}`);const c=[];for(let u=0;u<o.length;u+=2){if(o[u]!==l[u])throw new RuntimeError(`Cannot interpolate values containing mismatched anchors. from[${u}]: ${o[u]}, to[${u}]: ${l[u]}`);c.push(o[u]);const[f,g]=o[u+1],[H,Y]=l[u+1];c.push([interpolateNumber(f,H,s),interpolateNumber(g,Y,s)])}return new VariableAnchorOffsetCollection(c)}}class ResolvedImage{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ResolvedImage({name:e,available:!1}):null}}class ProjectionDefinition{constructor(e,i,s){this.from=e,this.to=i,this.transition=s}static interpolate(e,i,s){return new ProjectionDefinition(e,i,s)}static parse(e){if(e instanceof ProjectionDefinition)return e;if(Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number")return new ProjectionDefinition(e[0],e[1],e[2]);if(typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number")return new ProjectionDefinition(e.from,e.to,e.transition);if(typeof e=="string")return new ProjectionDefinition(e,e,1)}}function validateRGBA(n,e,i,s){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?typeof s>"u"||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[n,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[n,e,i,s]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function isValue(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof ProjectionDefinition||n instanceof Color||n instanceof Collator||n instanceof Formatted||n instanceof Padding||n instanceof NumberArray||n instanceof ColorArray||n instanceof VariableAnchorOffsetCollection||n instanceof ResolvedImage)return!0;if(Array.isArray(n)){for(const e of n)if(!isValue(e))return!1;return!0}else if(typeof n=="object"){for(const e in n)if(!isValue(n[e]))return!1;return!0}else return!1}function typeOf(n){if(n===null)return NullType;if(typeof n=="string")return StringType;if(typeof n=="boolean")return BooleanType;if(typeof n=="number")return NumberType;if(n instanceof Color)return ColorType;if(n instanceof ProjectionDefinition)return ProjectionDefinitionType;if(n instanceof Collator)return CollatorType;if(n instanceof Formatted)return FormattedType;if(n instanceof Padding)return PaddingType;if(n instanceof NumberArray)return NumberArrayType;if(n instanceof ColorArray)return ColorArrayType;if(n instanceof VariableAnchorOffsetCollection)return VariableAnchorOffsetCollectionType;if(n instanceof ResolvedImage)return ResolvedImageType;if(Array.isArray(n)){const e=n.length;let i;for(const s of n){const o=typeOf(s);if(!i)i=o;else{if(i===o)continue;i=ValueType;break}}return array(i||ValueType,e)}else return ObjectType}function valueToString(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Color||n instanceof ProjectionDefinition||n instanceof Formatted||n instanceof Padding||n instanceof NumberArray||n instanceof ColorArray||n instanceof VariableAnchorOffsetCollection||n instanceof ResolvedImage?n.toString():JSON.stringify(n)}class Literal{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!isValue(e[1]))return i.error("invalid value");const s=e[1];let o=typeOf(s);const l=i.expectedType;return o.kind==="array"&&o.N===0&&l&&l.kind==="array"&&(typeof l.N!="number"||l.N===0)&&(o=l),new Literal(o,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const types$1$1={string:StringType,number:NumberType,boolean:BooleanType,object:ObjectType};class Assertion{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s=1,o;const l=e[0];if(l==="array"){let u;if(e.length>2){const g=e[1];if(typeof g!="string"||!(g in types$1$1)||g==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);u=types$1$1[g],s++}else u=ValueType;let f;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);f=e[2],s++}o=array(u,f)}else{if(!types$1$1[l])throw new Error(`Types doesn't contain name = ${l}`);o=types$1$1[l]}const c=[];for(;s<e.length;s++){const u=i.parse(e[s],s,ValueType);if(!u)return null;c.push(u)}return new Assertion(o,c)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(checkSubtype(this.type,typeOf(s))){if(i===this.args.length-1)throw new RuntimeError(`Expected value to be of type ${typeToString(this.type)}, but found ${typeToString(typeOf(s))} instead.`)}else return s}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const types$2={"to-boolean":BooleanType,"to-color":ColorType,"to-number":NumberType,"to-string":StringType};class Coercion{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0];if(!types$2[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return i.error("Expected one argument.");const o=types$2[s],l=[];for(let c=1;c<e.length;c++){const u=i.parse(e[c],c,ValueType);if(!u)return null;l.push(u)}return new Coercion(o,l)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let i,s;for(const o of this.args){if(i=o.evaluate(e),s=null,i instanceof Color)return i;if(typeof i=="string"){const l=e.parseColor(i);if(l)return l}else if(Array.isArray(i)&&(i.length<3||i.length>4?s=`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:s=validateRGBA(i[0],i[1],i[2],i[3]),!s))return new Color(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new RuntimeError(s||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const s of this.args){i=s.evaluate(e);const o=Padding.parse(i);if(o)return o}throw new RuntimeError(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(const s of this.args){i=s.evaluate(e);const o=NumberArray.parse(i);if(o)return o}throw new RuntimeError(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(const s of this.args){i=s.evaluate(e);const o=ColorArray.parse(i);if(o)return o}throw new RuntimeError(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const s of this.args){i=s.evaluate(e);const o=VariableAnchorOffsetCollection.parse(i);if(o)return o}throw new RuntimeError(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const s of this.args){if(i=s.evaluate(e),i===null)return 0;const o=Number(i);if(!isNaN(o))return o}throw new RuntimeError(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return Formatted.fromString(valueToString(this.args[0].evaluate(e)));case"resolvedImage":return ResolvedImage.fromString(valueToString(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return valueToString(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const geometryTypes=["Unknown","Point","LineString","Polygon"];class EvaluationContext{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?geometryTypes[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let i=this._parseColorCache.get(e);return i||(i=Color.parse(e),this._parseColorCache.set(e,i)),i}}class ParsingContext{constructor(e,i,s=[],o,l=new Scope,c=[]){this.registry=e,this.path=s,this.key=s.map(u=>`[${u}]`).join(""),this.scope=l,this.errors=c,this.expectedType=o,this._isConstant=i}parse(e,i,s,o,l={}){return i?this.concat(i,s,o)._parse(e,l):this._parse(e,l)}_parse(e,i){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function s(o,l,c){return c==="assert"?new Assertion(l,[o]):c==="coerce"?new Coercion(l,[o]):o}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const o=e[0];if(typeof o!="string")return this.error(`Expression name must be a string, but found ${typeof o} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const l=this.registry[o];if(l){let c=l.parse(e,this);if(!c)return null;if(this.expectedType){const u=this.expectedType,f=c.type;if((u.kind==="string"||u.kind==="number"||u.kind==="boolean"||u.kind==="object"||u.kind==="array")&&f.kind==="value")c=s(c,u,i.typeAnnotation||"assert");else if(u.kind==="projectionDefinition"&&["string","array"].includes(f.kind)||["color","formatted","resolvedImage"].includes(u.kind)&&["value","string"].includes(f.kind)||["padding","numberArray"].includes(u.kind)&&["value","number","array"].includes(f.kind)||u.kind==="colorArray"&&["value","string","array"].includes(f.kind)||u.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(f.kind))c=s(c,u,i.typeAnnotation||"coerce");else if(this.checkSubtype(u,f))return null}if(!(c instanceof Literal)&&c.type.kind!=="resolvedImage"&&this._isConstant(c)){const u=new EvaluationContext;try{c=new Literal(c.type,c.evaluate(u))}catch(f){return this.error(f.message),null}}return c}return this.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s){const o=typeof e=="number"?this.path.concat(e):this.path,l=s?this.scope.concat(s):this.scope;return new ParsingContext(this.registry,this._isConstant,o,i||null,l,this.errors)}error(e,...i){const s=`${this.key}${i.map(o=>`[${o}]`).join("")}`;this.errors.push(new ExpressionParsingError(s,e))}checkSubtype(e,i){const s=checkSubtype(e,i);return s&&this.error(s),s}}class Let{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let l=1;l<e.length-1;l+=2){const c=e[l];if(typeof c!="string")return i.error(`Expected string, but found ${typeof c} instead.`,l);if(/[^a-zA-Z0-9_]/.test(c))return i.error("Variable names must contain only alphanumeric characters or '_'.",l);const u=i.parse(e[l+1],l+1);if(!u)return null;s.push([c,u])}const o=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return o?new Let(s,o):null}outputDefined(){return this.result.outputDefined()}}class Var{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new Var(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class At{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,NumberType),o=i.parse(e[2],2,array(i.expectedType||ValueType));if(!s||!o)return null;const l=o.type;return new At(l.itemType,s,o)}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new RuntimeError(`Array index out of bounds: ${i} < 0.`);if(i>=s.length)throw new RuntimeError(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i!==Math.floor(i))throw new RuntimeError(`Array index must be an integer, but found ${i} instead.`);return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class In{constructor(e,i){this.type=BooleanType,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,ValueType),o=i.parse(e[2],2,ValueType);return!s||!o?null:isValidType(s.type,[BooleanType,StringType,NumberType,NullType,ValueType])?new In(s,o):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${typeToString(s.type)} instead`)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!isValidNativeType(i,["boolean","string","number","null"]))throw new RuntimeError(`Expected first argument to be of type boolean, string, number or null, but found ${typeToString(typeOf(i))} instead.`);if(!isValidNativeType(s,["string","array"]))throw new RuntimeError(`Expected second argument to be of type array or string, but found ${typeToString(typeOf(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class IndexOf{constructor(e,i,s){this.type=NumberType,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,ValueType),o=i.parse(e[2],2,ValueType);if(!s||!o)return null;if(!isValidType(s.type,[BooleanType,StringType,NumberType,NullType,ValueType]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${typeToString(s.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,NumberType);return l?new IndexOf(s,o,l):null}else return new IndexOf(s,o)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!isValidNativeType(i,["boolean","string","number","null"]))throw new RuntimeError(`Expected first argument to be of type boolean, string, number or null, but found ${typeToString(typeOf(i))} instead.`);let o;if(this.fromIndex&&(o=this.fromIndex.evaluate(e)),isValidNativeType(s,["string"])){const l=s.indexOf(i,o);return l===-1?-1:[...s.slice(0,l)].length}else{if(isValidNativeType(s,["array"]))return s.indexOf(i,o);throw new RuntimeError(`Expected second argument to be of type array or string, but found ${typeToString(typeOf(s))} instead.`)}}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Match{constructor(e,i,s,o,l,c){this.inputType=e,this.type=i,this.input=s,this.cases=o,this.outputs=l,this.otherwise=c}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return i.error("Expected an even number of arguments.");let s,o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const l={},c=[];for(let g=2;g<e.length-1;g+=2){let H=e[g];const Y=e[g+1];Array.isArray(H)||(H=[H]);const ee=i.concat(g);if(H.length===0)return ee.error("Expected at least one branch label.");for(const ne of H){if(typeof ne!="number"&&typeof ne!="string")return ee.error("Branch labels must be numbers or strings.");if(typeof ne=="number"&&Math.abs(ne)>Number.MAX_SAFE_INTEGER)return ee.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ne=="number"&&Math.floor(ne)!==ne)return ee.error("Numeric branch labels must be integer values.");if(!s)s=typeOf(ne);else if(ee.checkSubtype(s,typeOf(ne)))return null;if(typeof l[String(ne)]<"u")return ee.error("Branch labels must be unique.");l[String(ne)]=c.length}const te=i.parse(Y,g,o);if(!te)return null;o=o||te.type,c.push(te)}const u=i.parse(e[1],1,ValueType);if(!u)return null;const f=i.parse(e[e.length-1],e.length-1,o);return!f||u.type.kind!=="value"&&i.concat(1).checkSubtype(s,u.type)?null:new Match(s,o,u,l,c,f)}evaluate(e){const i=this.input.evaluate(e);return(typeOf(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Case{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const o=[];for(let c=1;c<e.length-1;c+=2){const u=i.parse(e[c],c,BooleanType);if(!u)return null;const f=i.parse(e[c+1],c+1,s);if(!f)return null;o.push([u,f]),s=s||f.type}const l=i.parse(e[e.length-1],e.length-1,s);if(!l)return null;if(!s)throw new Error("Can't infer output type");return new Case(s,o,l)}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}}class Slice{constructor(e,i,s,o){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,ValueType),o=i.parse(e[2],2,NumberType);if(!s||!o)return null;if(!isValidType(s.type,[array(ValueType),StringType,ValueType]))return i.error(`Expected first argument to be of type array or string, but found ${typeToString(s.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,NumberType);return l?new Slice(s.type,s,o,l):null}else return new Slice(s.type,s,o)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);let o;if(this.endIndex&&(o=this.endIndex.evaluate(e)),isValidNativeType(i,["string"]))return[...i].slice(s,o).join("");if(isValidNativeType(i,["array"]))return i.slice(s,o);throw new RuntimeError(`Expected first argument to be of type array or string, but found ${typeToString(typeOf(i))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function findStopLessThanOrEqualTo(n,e){const i=n.length-1;let s=0,o=i,l=0,c,u;for(;s<=o;)if(l=Math.floor((s+o)/2),c=n[l],u=n[l+1],c<=e){if(l===i||e<u)return l;s=l+1}else if(c>e)o=l-1;else throw new RuntimeError("Input is not a number.");return 0}class Step{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[o,l]of s)this.labels.push(o),this.outputs.push(l)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,NumberType);if(!s)return null;const o=[];let l=null;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);for(let c=1;c<e.length;c+=2){const u=c===1?-1/0:e[c],f=e[c+1],g=c,H=c+1;if(typeof u!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',g);if(o.length&&o[o.length-1][0]>=u)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',g);const Y=i.parse(f,H,l);if(!Y)return null;l=l||Y.type,o.push([u,Y])}return new Step(l,s,o)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const o=this.input.evaluate(e);if(o<=i[0])return s[0].evaluate(e);const l=i.length;if(o>=i[l-1])return s[l-1].evaluate(e);const c=findStopLessThanOrEqualTo(i,o);return s[c].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function getDefaultExportFromCjs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var unitbezier,hasRequiredUnitbezier;function requireUnitbezier(){if(hasRequiredUnitbezier)return unitbezier;hasRequiredUnitbezier=1,unitbezier=n;function n(e,i,s,o){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(o-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=s,this.p2y=o}return n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,o=0;o<8;o++){var l=this.sampleCurveX(s)-e;if(Math.abs(l)<i)return s;var c=this.sampleCurveDerivativeX(s);if(Math.abs(c)<1e-6)break;s=s-l/c}var u=0,f=1;for(s=e,o=0;o<20&&(l=this.sampleCurveX(s),!(Math.abs(l-e)<i));o++)e>l?u=s:f=s,s=(f-u)*.5+u;return s},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},unitbezier}var unitbezierExports=requireUnitbezier(),UnitBezier=getDefaultExportFromCjs(unitbezierExports);class Interpolate{constructor(e,i,s,o,l){this.type=e,this.operator=i,this.interpolation=s,this.input=o,this.labels=[],this.outputs=[];for(const[c,u]of l)this.labels.push(c),this.outputs.push(u)}static interpolationFactor(e,i,s,o){let l=0;if(e.name==="exponential")l=exponentialInterpolation(i,e.base,s,o);else if(e.name==="linear")l=exponentialInterpolation(i,1,s,o);else if(e.name==="cubic-bezier"){const c=e.controlPoints;l=new UnitBezier(c[0],c[1],c[2],c[3]).solve(exponentialInterpolation(i,1,s,o))}return l}static parse(e,i){let[s,o,l,...c]=e;if(!Array.isArray(o)||o.length===0)return i.error("Expected an interpolation type expression.",1);if(o[0]==="linear")o={name:"linear"};else if(o[0]==="exponential"){const g=o[1];if(typeof g!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);o={name:"exponential",base:g}}else if(o[0]==="cubic-bezier"){const g=o.slice(1);if(g.length!==4||g.some(H=>typeof H!="number"||H<0||H>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);o={name:"cubic-bezier",controlPoints:g}}else return i.error(`Unknown interpolation type ${String(o[0])}`,1,0);if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return i.error("Expected an even number of arguments.");if(l=i.parse(l,2,NumberType),!l)return null;const u=[];let f=null;(s==="interpolate-hcl"||s==="interpolate-lab")&&i.expectedType!=ColorArrayType?f=ColorType:i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let g=0;g<c.length;g+=2){const H=c[g],Y=c[g+1],ee=g+3,te=g+4;if(typeof H!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ee);if(u.length&&u[u.length-1][0]>=H)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ee);const ne=i.parse(Y,te,f);if(!ne)return null;f=f||ne.type,u.push([H,ne])}return!verifyType(f,NumberType)&&!verifyType(f,ProjectionDefinitionType)&&!verifyType(f,ColorType)&&!verifyType(f,PaddingType)&&!verifyType(f,NumberArrayType)&&!verifyType(f,ColorArrayType)&&!verifyType(f,VariableAnchorOffsetCollectionType)&&!verifyType(f,array(NumberType))?i.error(`Type ${typeToString(f)} is not interpolatable.`):new Interpolate(f,s,o,l,u)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const o=this.input.evaluate(e);if(o<=i[0])return s[0].evaluate(e);const l=i.length;if(o>=i[l-1])return s[l-1].evaluate(e);const c=findStopLessThanOrEqualTo(i,o),u=i[c],f=i[c+1],g=Interpolate.interpolationFactor(this.interpolation,o,u,f),H=s[c].evaluate(e),Y=s[c+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return interpolateNumber(H,Y,g);case"color":return Color.interpolate(H,Y,g);case"padding":return Padding.interpolate(H,Y,g);case"colorArray":return ColorArray.interpolate(H,Y,g);case"numberArray":return NumberArray.interpolate(H,Y,g);case"variableAnchorOffsetCollection":return VariableAnchorOffsetCollection.interpolate(H,Y,g);case"array":return interpolateArray(H,Y,g);case"projectionDefinition":return ProjectionDefinition.interpolate(H,Y,g)}case"interpolate-hcl":switch(this.type.kind){case"color":return Color.interpolate(H,Y,g,"hcl");case"colorArray":return ColorArray.interpolate(H,Y,g,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Color.interpolate(H,Y,g,"lab");case"colorArray":return ColorArray.interpolate(H,Y,g,"lab")}}}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function exponentialInterpolation(n,e,i,s){const o=s-i,l=n-i;return o===0?0:e===1?l/o:(Math.pow(e,l)-1)/(Math.pow(e,o)-1)}class Coalesce{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s=null;const o=i.expectedType;o&&o.kind!=="value"&&(s=o);const l=[];for(const u of e.slice(1)){const f=i.parse(u,1+l.length,s,void 0,{typeAnnotation:"omit"});if(!f)return null;s=s||f.type,l.push(f)}if(!s)throw new Error("No output type");return o&&l.some(u=>checkSubtype(o,u.type))?new Coalesce(ValueType,l):new Coalesce(s,l)}evaluate(e){let i=null,s=0,o;for(const l of this.args)if(s++,i=l.evaluate(e),i&&i instanceof ResolvedImage&&!i.available&&(o||(o=i.name),i=null,s===this.args.length&&(i=o)),i!==null)break;return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function isComparableType(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function eq(n,e,i){return e===i}function neq(n,e,i){return e!==i}function lt(n,e,i){return e<i}function gt(n,e,i){return e>i}function lteq(n,e,i){return e<=i}function gteq(n,e,i){return e>=i}function eqCollate(n,e,i,s){return s.compare(e,i)===0}function neqCollate(n,e,i,s){return!eqCollate(n,e,i,s)}function ltCollate(n,e,i,s){return s.compare(e,i)<0}function gtCollate(n,e,i,s){return s.compare(e,i)>0}function lteqCollate(n,e,i,s){return s.compare(e,i)<=0}function gteqCollate(n,e,i,s){return s.compare(e,i)>=0}function makeComparison(n,e,i){const s=n!=="=="&&n!=="!=";return class Ki{constructor(l,c,u){this.type=BooleanType,this.lhs=l,this.rhs=c,this.collator=u,this.hasUntypedArgument=l.type.kind==="value"||c.type.kind==="value"}static parse(l,c){if(l.length!==3&&l.length!==4)return c.error("Expected two or three arguments.");const u=l[0];let f=c.parse(l[1],1,ValueType);if(!f)return null;if(!isComparableType(u,f.type))return c.concat(1).error(`"${u}" comparisons are not supported for type '${typeToString(f.type)}'.`);let g=c.parse(l[2],2,ValueType);if(!g)return null;if(!isComparableType(u,g.type))return c.concat(2).error(`"${u}" comparisons are not supported for type '${typeToString(g.type)}'.`);if(f.type.kind!==g.type.kind&&f.type.kind!=="value"&&g.type.kind!=="value")return c.error(`Cannot compare types '${typeToString(f.type)}' and '${typeToString(g.type)}'.`);s&&(f.type.kind==="value"&&g.type.kind!=="value"?f=new Assertion(g.type,[f]):f.type.kind!=="value"&&g.type.kind==="value"&&(g=new Assertion(f.type,[g])));let H=null;if(l.length===4){if(f.type.kind!=="string"&&g.type.kind!=="string"&&f.type.kind!=="value"&&g.type.kind!=="value")return c.error("Cannot use collator to compare non-string types.");if(H=c.parse(l[3],3,CollatorType),!H)return null}return new Ki(f,g,H)}evaluate(l){const c=this.lhs.evaluate(l),u=this.rhs.evaluate(l);if(s&&this.hasUntypedArgument){const f=typeOf(c),g=typeOf(u);if(f.kind!==g.kind||!(f.kind==="string"||f.kind==="number"))throw new RuntimeError(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${f.kind}, ${g.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const f=typeOf(c),g=typeOf(u);if(f.kind!=="string"||g.kind!=="string")return e(l,c,u)}return this.collator?i(l,c,u,this.collator.evaluate(l)):e(l,c,u)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}}}const Equals=makeComparison("==",eq,eqCollate),NotEquals=makeComparison("!=",neq,neqCollate),LessThan=makeComparison("<",lt,ltCollate),GreaterThan=makeComparison(">",gt,gtCollate),LessThanOrEqual=makeComparison("<=",lteq,lteqCollate),GreaterThanOrEqual=makeComparison(">=",gteq,gteqCollate);class CollatorExpression{constructor(e,i,s){this.type=CollatorType,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const o=i.parse(s["case-sensitive"]===void 0?!1:s["case-sensitive"],1,BooleanType);if(!o)return null;const l=i.parse(s["diacritic-sensitive"]===void 0?!1:s["diacritic-sensitive"],1,BooleanType);if(!l)return null;let c=null;return s.locale&&(c=i.parse(s.locale,1,StringType),!c)?null:new CollatorExpression(o,l,c)}evaluate(e){return new Collator(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class NumberFormat{constructor(e,i,s,o,l){this.type=StringType,this.number=e,this.locale=i,this.currency=s,this.minFractionDigits=o,this.maxFractionDigits=l}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const s=i.parse(e[1],1,NumberType);if(!s)return null;const o=e[2];if(typeof o!="object"||Array.isArray(o))return i.error("NumberFormat options argument must be an object.");let l=null;if(o.locale&&(l=i.parse(o.locale,1,StringType),!l))return null;let c=null;if(o.currency&&(c=i.parse(o.currency,1,StringType),!c))return null;let u=null;if(o["min-fraction-digits"]&&(u=i.parse(o["min-fraction-digits"],1,NumberType),!u))return null;let f=null;return o["max-fraction-digits"]&&(f=i.parse(o["max-fraction-digits"],1,NumberType),!f)?null:new NumberFormat(s,l,c,u,f)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class FormatExpression{constructor(e){this.type=FormattedType,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const o=[];let l=!1;for(let c=1;c<=e.length-1;++c){const u=e[c];if(l&&typeof u=="object"&&!Array.isArray(u)){l=!1;let f=null;if(u["font-scale"]&&(f=i.parse(u["font-scale"],1,NumberType),!f))return null;let g=null;if(u["text-font"]&&(g=i.parse(u["text-font"],1,array(StringType)),!g))return null;let H=null;if(u["text-color"]&&(H=i.parse(u["text-color"],1,ColorType),!H))return null;let Y=null;if(u["vertical-align"]){if(typeof u["vertical-align"]=="string"&&!VERTICAL_ALIGN_OPTIONS.includes(u["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${u["vertical-align"]}' instead.`);if(Y=i.parse(u["vertical-align"],1,StringType),!Y)return null}const ee=o[o.length-1];ee.scale=f,ee.font=g,ee.textColor=H,ee.verticalAlign=Y}else{const f=i.parse(e[c],1,ValueType);if(!f)return null;const g=f.type.kind;if(g!=="string"&&g!=="value"&&g!=="null"&&g!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,o.push({content:f,scale:null,font:null,textColor:null,verticalAlign:null})}}return new FormatExpression(o)}evaluate(e){const i=s=>{const o=s.content.evaluate(e);return typeOf(o)===ResolvedImageType?new FormattedSection("",o,null,null,null,s.verticalAlign?s.verticalAlign.evaluate(e):null):new FormattedSection(valueToString(o),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null,s.verticalAlign?s.verticalAlign.evaluate(e):null)};return new Formatted(this.sections.map(i))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor),i.verticalAlign&&e(i.verticalAlign)}outputDefined(){return!1}}class ImageExpression{constructor(e){this.type=ResolvedImageType,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const s=i.parse(e[1],1,StringType);return s?new ImageExpression(s):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),s=ResolvedImage.fromString(i);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(i)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class Length{constructor(e){this.type=NumberType,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${typeToString(s.type)} instead.`):new Length(s):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new RuntimeError(`Expected value to be of type string or array, but found ${typeToString(typeOf(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const EXTENT=8192;function getTileCoordinates(n,e){const i=mercatorXfromLng(n[0]),s=mercatorYfromLat(n[1]),o=Math.pow(2,e.z);return[Math.round(i*o*EXTENT),Math.round(s*o*EXTENT)]}function getLngLatFromTileCoord(n,e){const i=Math.pow(2,e.z),s=(n[0]/EXTENT+e.x)/i,o=(n[1]/EXTENT+e.y)/i;return[lngFromMercatorXfromLng(s),latFromMercatorY(o)]}function mercatorXfromLng(n){return(180+n)/360}function lngFromMercatorXfromLng(n){return n*360-180}function mercatorYfromLat(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function latFromMercatorY(n){return 360/Math.PI*Math.atan(Math.exp((180-n*360)*Math.PI/180))-90}function updateBBox(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function boxWithinBox(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function rayIntersect(n,e,i){return e[1]>n[1]!=i[1]>n[1]&&n[0]<(i[0]-e[0])*(n[1]-e[1])/(i[1]-e[1])+e[0]}function pointOnBoundary(n,e,i){const s=n[0]-e[0],o=n[1]-e[1],l=n[0]-i[0],c=n[1]-i[1];return s*c-l*o===0&&s*l<=0&&o*c<=0}function segmentIntersectSegment(n,e,i,s){const o=[e[0]-n[0],e[1]-n[1]],l=[s[0]-i[0],s[1]-i[1]];return perp(l,o)===0?!1:!!(twoSided(n,e,i,s)&&twoSided(i,s,n,e))}function lineIntersectPolygon(n,e,i){for(const s of i)for(let o=0;o<s.length-1;++o)if(segmentIntersectSegment(n,e,s[o],s[o+1]))return!0;return!1}function pointWithinPolygon(n,e,i=!1){let s=!1;for(const o of e)for(let l=0;l<o.length-1;l++){if(pointOnBoundary(n,o[l],o[l+1]))return i;rayIntersect(n,o[l],o[l+1])&&(s=!s)}return s}function pointWithinPolygons(n,e){for(const i of e)if(pointWithinPolygon(n,i))return!0;return!1}function lineStringWithinPolygon(n,e){for(const i of n)if(!pointWithinPolygon(i,e))return!1;for(let i=0;i<n.length-1;++i)if(lineIntersectPolygon(n[i],n[i+1],e))return!1;return!0}function lineStringWithinPolygons(n,e){for(const i of e)if(lineStringWithinPolygon(n,i))return!0;return!1}function perp(n,e){return n[0]*e[1]-n[1]*e[0]}function twoSided(n,e,i,s){const o=n[0]-i[0],l=n[1]-i[1],c=e[0]-i[0],u=e[1]-i[1],f=s[0]-i[0],g=s[1]-i[1],H=o*g-f*l,Y=c*g-f*u;return H>0&&Y<0||H<0&&Y>0}function getTilePolygon(n,e,i){const s=[];for(let o=0;o<n.length;o++){const l=[];for(let c=0;c<n[o].length;c++){const u=getTileCoordinates(n[o][c],i);updateBBox(e,u),l.push(u)}s.push(l)}return s}function getTilePolygons(n,e,i){const s=[];for(let o=0;o<n.length;o++){const l=getTilePolygon(n[o],e,i);s.push(l)}return s}function updatePoint(n,e,i,s){if(n[0]<i[0]||n[0]>i[2]){const o=s*.5;let l=n[0]-i[0]>o?-s:i[0]-n[0]>o?s:0;l===0&&(l=n[0]-i[2]>o?-s:i[2]-n[0]>o?s:0),n[0]+=l}updateBBox(e,n)}function resetBBox(n){n[0]=n[1]=1/0,n[2]=n[3]=-1/0}function getTilePoints(n,e,i,s){const o=Math.pow(2,s.z)*EXTENT,l=[s.x*EXTENT,s.y*EXTENT],c=[];for(const u of n)for(const f of u){const g=[f.x+l[0],f.y+l[1]];updatePoint(g,e,i,o),c.push(g)}return c}function getTileLines(n,e,i,s){const o=Math.pow(2,s.z)*EXTENT,l=[s.x*EXTENT,s.y*EXTENT],c=[];for(const u of n){const f=[];for(const g of u){const H=[g.x+l[0],g.y+l[1]];updateBBox(e,H),f.push(H)}c.push(f)}if(e[2]-e[0]<=o/2){resetBBox(e);for(const u of c)for(const f of u)updatePoint(f,e,i,o)}return c}function pointsWithinPolygons(n,e){const i=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],o=n.canonicalID();if(e.type==="Polygon"){const l=getTilePolygon(e.coordinates,s,o),c=getTilePoints(n.geometry(),i,s,o);if(!boxWithinBox(i,s))return!1;for(const u of c)if(!pointWithinPolygon(u,l))return!1}if(e.type==="MultiPolygon"){const l=getTilePolygons(e.coordinates,s,o),c=getTilePoints(n.geometry(),i,s,o);if(!boxWithinBox(i,s))return!1;for(const u of c)if(!pointWithinPolygons(u,l))return!1}return!0}function linesWithinPolygons(n,e){const i=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],o=n.canonicalID();if(e.type==="Polygon"){const l=getTilePolygon(e.coordinates,s,o),c=getTileLines(n.geometry(),i,s,o);if(!boxWithinBox(i,s))return!1;for(const u of c)if(!lineStringWithinPolygon(u,l))return!1}if(e.type==="MultiPolygon"){const l=getTilePolygons(e.coordinates,s,o),c=getTileLines(n.geometry(),i,s,o);if(!boxWithinBox(i,s))return!1;for(const u of c)if(!lineStringWithinPolygons(u,l))return!1}return!0}class Within{constructor(e,i){this.type=BooleanType,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(isValue(e[1])){const s=e[1];if(s.type==="FeatureCollection"){const o=[];for(const l of s.features){const{type:c,coordinates:u}=l.geometry;c==="Polygon"&&o.push(u),c==="MultiPolygon"&&o.push(...u)}if(o.length){const l={type:"MultiPolygon",coordinates:o};return new Within(s,l)}}else if(s.type==="Feature"){const o=s.geometry.type;if(o==="Polygon"||o==="MultiPolygon")return new Within(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Within(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return pointsWithinPolygons(e,this.geometries);if(e.geometryType()==="LineString")return linesWithinPolygons(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class TinyQueue{constructor(e=[],i=(s,o)=>s<o?-1:s>o?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,o=i[e];for(;e>0;){const l=e-1>>1,c=i[l];if(s(o,c)>=0)break;i[e]=c,e=l}i[e]=o}_down(e){const{data:i,compare:s}=this,o=this.length>>1,l=i[e];for(;e<o;){let c=(e<<1)+1;const u=c+1;if(u<this.length&&s(i[u],i[c])<0&&(c=u),s(i[c],l)>=0)break;i[e]=i[c],e=c}i[e]=l}}function classifyRings(n,e){if(n.length<=1)return[n];const s=[];let o,l;for(const c of n){const u=calculateSignedArea(c);u!==0&&(c.area=Math.abs(u),l===void 0&&(l=u<0),l===u<0?(o&&s.push(o),o=[c]):o.push(c))}return o&&s.push(o),s}function calculateSignedArea(n){let e=0;for(let i=0,s=n.length,o=s-1,l,c;i<s;o=i++)l=n[i],c=n[o],e+=(c.x-l.x)*(l.y+c.y);return e}const RE=6378.137,FE=1/298.257223563,E2=FE*(2-FE),RAD=Math.PI/180;class CheapRuler{constructor(e){const i=RAD*RE*1e3,s=Math.cos(e*RAD),o=1/(1-E2*(1-s*s)),l=Math.sqrt(o);this.kx=i*l*s,this.ky=i*l*o*(1-E2)}distance(e,i){const s=this.wrap(e[0]-i[0])*this.kx,o=(e[1]-i[1])*this.ky;return Math.sqrt(s*s+o*o)}pointOnLine(e,i){let s=1/0,o,l,c,u;for(let f=0;f<e.length-1;f++){let g=e[f][0],H=e[f][1],Y=this.wrap(e[f+1][0]-g)*this.kx,ee=(e[f+1][1]-H)*this.ky,te=0;(Y!==0||ee!==0)&&(te=(this.wrap(i[0]-g)*this.kx*Y+(i[1]-H)*this.ky*ee)/(Y*Y+ee*ee),te>1?(g=e[f+1][0],H=e[f+1][1]):te>0&&(g+=Y/this.kx*te,H+=ee/this.ky*te)),Y=this.wrap(i[0]-g)*this.kx,ee=(i[1]-H)*this.ky;const ne=Y*Y+ee*ee;ne<s&&(s=ne,o=g,l=H,c=f,u=te)}return{point:[o,l],index:c,t:Math.max(0,Math.min(1,u))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}const MinPointsSize=100,MinLinePointsSize=50;function compareDistPair(n,e){return e[0]-n[0]}function getRangeSize(n){return n[1]-n[0]+1}function isRangeSafe(n,e){return n[1]>=n[0]&&n[1]<e}function splitRange(n,e){if(n[0]>n[1])return[null,null];const i=getRangeSize(n);if(e){if(i===2)return[n,null];const o=Math.floor(i/2);return[[n[0],n[0]+o],[n[0]+o,n[1]]]}if(i===1)return[n,null];const s=Math.floor(i/2)-1;return[[n[0],n[0]+s],[n[0]+s+1,n[1]]]}function getBBox(n,e){if(!isRangeSafe(e,n.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let s=e[0];s<=e[1];++s)updateBBox(i,n[s]);return i}function getPolygonBBox(n){const e=[1/0,1/0,-1/0,-1/0];for(const i of n)for(const s of i)updateBBox(e,s);return e}function isValidBBox(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function bboxToBBoxDistance(n,e,i){if(!isValidBBox(n)||!isValidBBox(e))return NaN;let s=0,o=0;return n[2]<e[0]&&(s=e[0]-n[2]),n[0]>e[2]&&(s=n[0]-e[2]),n[1]>e[3]&&(o=n[1]-e[3]),n[3]<e[1]&&(o=e[1]-n[3]),i.distance([0,0],[s,o])}function pointToLineDistance(n,e,i){const s=i.pointOnLine(e,n);return i.distance(n,s.point)}function segmentToSegmentDistance(n,e,i,s,o){const l=Math.min(pointToLineDistance(n,[i,s],o),pointToLineDistance(e,[i,s],o)),c=Math.min(pointToLineDistance(i,[n,e],o),pointToLineDistance(s,[n,e],o));return Math.min(l,c)}function lineToLineDistance(n,e,i,s,o){if(!(isRangeSafe(e,n.length)&&isRangeSafe(s,i.length)))return 1/0;let c=1/0;for(let u=e[0];u<e[1];++u){const f=n[u],g=n[u+1];for(let H=s[0];H<s[1];++H){const Y=i[H],ee=i[H+1];if(segmentIntersectSegment(f,g,Y,ee))return 0;c=Math.min(c,segmentToSegmentDistance(f,g,Y,ee,o))}}return c}function pointsToPointsDistance(n,e,i,s,o){if(!(isRangeSafe(e,n.length)&&isRangeSafe(s,i.length)))return NaN;let c=1/0;for(let u=e[0];u<=e[1];++u)for(let f=s[0];f<=s[1];++f)if(c=Math.min(c,o.distance(n[u],i[f])),c===0)return c;return c}function pointToPolygonDistance(n,e,i){if(pointWithinPolygon(n,e,!0))return 0;let s=1/0;for(const o of e){const l=o[0],c=o[o.length-1];if(l!==c&&(s=Math.min(s,pointToLineDistance(n,[c,l],i)),s===0))return s;const u=i.pointOnLine(o,n);if(s=Math.min(s,i.distance(n,u.point)),s===0)return s}return s}function lineToPolygonDistance(n,e,i,s){if(!isRangeSafe(e,n.length))return NaN;for(let l=e[0];l<=e[1];++l)if(pointWithinPolygon(n[l],i,!0))return 0;let o=1/0;for(let l=e[0];l<e[1];++l){const c=n[l],u=n[l+1];for(const f of i)for(let g=0,H=f.length,Y=H-1;g<H;Y=g++){const ee=f[Y],te=f[g];if(segmentIntersectSegment(c,u,ee,te))return 0;o=Math.min(o,segmentToSegmentDistance(c,u,ee,te,s))}}return o}function polygonIntersect(n,e){for(const i of n)for(const s of i)if(pointWithinPolygon(s,e,!0))return!0;return!1}function polygonToPolygonDistance(n,e,i,s=1/0){const o=getPolygonBBox(n),l=getPolygonBBox(e);if(s!==1/0&&bboxToBBoxDistance(o,l,i)>=s)return s;if(boxWithinBox(o,l)){if(polygonIntersect(n,e))return 0}else if(polygonIntersect(e,n))return 0;let c=1/0;for(const u of n)for(let f=0,g=u.length,H=g-1;f<g;H=f++){const Y=u[H],ee=u[f];for(const te of e)for(let ne=0,Ye=te.length,xe=Ye-1;ne<Ye;xe=ne++){const tt=te[xe],et=te[ne];if(segmentIntersectSegment(Y,ee,tt,et))return 0;c=Math.min(c,segmentToSegmentDistance(Y,ee,tt,et,i))}}return c}function updateQueue(n,e,i,s,o,l){if(!l)return;const c=bboxToBBoxDistance(getBBox(s,l),o,i);c<e&&n.push([c,l,[0,0]])}function updateQueueTwoSets(n,e,i,s,o,l,c){if(!l||!c)return;const u=bboxToBBoxDistance(getBBox(s,l),getBBox(o,c),i);u<e&&n.push([u,l,c])}function pointsToPolygonDistance(n,e,i,s,o=1/0){let l=Math.min(s.distance(n[0],i[0][0]),o);if(l===0)return l;const c=new TinyQueue([[0,[0,n.length-1],[0,0]]],compareDistPair),u=getPolygonBBox(i);for(;c.length>0;){const f=c.pop();if(f[0]>=l)continue;const g=f[1],H=e?MinLinePointsSize:MinPointsSize;if(getRangeSize(g)<=H){if(!isRangeSafe(g,n.length))return NaN;if(e){const Y=lineToPolygonDistance(n,g,i,s);if(isNaN(Y)||Y===0)return Y;l=Math.min(l,Y)}else for(let Y=g[0];Y<=g[1];++Y){const ee=pointToPolygonDistance(n[Y],i,s);if(l=Math.min(l,ee),l===0)return 0}}else{const Y=splitRange(g,e);updateQueue(c,l,s,n,u,Y[0]),updateQueue(c,l,s,n,u,Y[1])}}return l}function pointSetToPointSetDistance(n,e,i,s,o,l=1/0){let c=Math.min(l,o.distance(n[0],i[0]));if(c===0)return c;const u=new TinyQueue([[0,[0,n.length-1],[0,i.length-1]]],compareDistPair);for(;u.length>0;){const f=u.pop();if(f[0]>=c)continue;const g=f[1],H=f[2],Y=e?MinLinePointsSize:MinPointsSize,ee=s?MinLinePointsSize:MinPointsSize;if(getRangeSize(g)<=Y&&getRangeSize(H)<=ee){if(!isRangeSafe(g,n.length)&&isRangeSafe(H,i.length))return NaN;let te;if(e&&s)te=lineToLineDistance(n,g,i,H,o),c=Math.min(c,te);else if(e&&!s){const ne=n.slice(g[0],g[1]+1);for(let Ye=H[0];Ye<=H[1];++Ye)if(te=pointToLineDistance(i[Ye],ne,o),c=Math.min(c,te),c===0)return c}else if(!e&&s){const ne=i.slice(H[0],H[1]+1);for(let Ye=g[0];Ye<=g[1];++Ye)if(te=pointToLineDistance(n[Ye],ne,o),c=Math.min(c,te),c===0)return c}else te=pointsToPointsDistance(n,g,i,H,o),c=Math.min(c,te)}else{const te=splitRange(g,e),ne=splitRange(H,s);updateQueueTwoSets(u,c,o,n,i,te[0],ne[0]),updateQueueTwoSets(u,c,o,n,i,te[0],ne[1]),updateQueueTwoSets(u,c,o,n,i,te[1],ne[0]),updateQueueTwoSets(u,c,o,n,i,te[1],ne[1])}}return c}function pointToGeometryDistance(n,e){const i=n.geometry(),s=i.flat().map(c=>getLngLatFromTileCoord([c.x,c.y],n.canonical));if(i.length===0)return NaN;const o=new CheapRuler(s[0][1]);let l=1/0;for(const c of e){switch(c.type){case"Point":l=Math.min(l,pointSetToPointSetDistance(s,!1,[c.coordinates],!1,o,l));break;case"LineString":l=Math.min(l,pointSetToPointSetDistance(s,!1,c.coordinates,!0,o,l));break;case"Polygon":l=Math.min(l,pointsToPolygonDistance(s,!1,c.coordinates,o,l));break}if(l===0)return l}return l}function lineStringToGeometryDistance(n,e){const i=n.geometry(),s=i.flat().map(c=>getLngLatFromTileCoord([c.x,c.y],n.canonical));if(i.length===0)return NaN;const o=new CheapRuler(s[0][1]);let l=1/0;for(const c of e){switch(c.type){case"Point":l=Math.min(l,pointSetToPointSetDistance(s,!0,[c.coordinates],!1,o,l));break;case"LineString":l=Math.min(l,pointSetToPointSetDistance(s,!0,c.coordinates,!0,o,l));break;case"Polygon":l=Math.min(l,pointsToPolygonDistance(s,!0,c.coordinates,o,l));break}if(l===0)return l}return l}function polygonToGeometryDistance(n,e){const i=n.geometry();if(i.length===0||i[0].length===0)return NaN;const s=classifyRings(i).map(c=>c.map(u=>u.map(f=>getLngLatFromTileCoord([f.x,f.y],n.canonical)))),o=new CheapRuler(s[0][0][0][1]);let l=1/0;for(const c of e)for(const u of s){switch(c.type){case"Point":l=Math.min(l,pointsToPolygonDistance([c.coordinates],!1,u,o,l));break;case"LineString":l=Math.min(l,pointsToPolygonDistance(c.coordinates,!0,u,o,l));break;case"Polygon":l=Math.min(l,polygonToPolygonDistance(u,c.coordinates,o,l));break}if(l===0)return l}return l}function toSimpleGeometry(n){return n.type==="MultiPolygon"?n.coordinates.map(e=>({type:"Polygon",coordinates:e})):n.type==="MultiLineString"?n.coordinates.map(e=>({type:"LineString",coordinates:e})):n.type==="MultiPoint"?n.coordinates.map(e=>({type:"Point",coordinates:e})):[n]}class Distance{constructor(e,i){this.type=NumberType,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(isValue(e[1])){const s=e[1];if(s.type==="FeatureCollection")return new Distance(s,s.features.map(o=>toSimpleGeometry(o.geometry)).flat());if(s.type==="Feature")return new Distance(s,toSimpleGeometry(s.geometry));if("type"in s&&"coordinates"in s)return new Distance(s,toSimpleGeometry(s))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return pointToGeometryDistance(e,this.geometries);if(e.geometryType()==="LineString")return lineStringToGeometryDistance(e,this.geometries);if(e.geometryType()==="Polygon")return polygonToGeometryDistance(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class GlobalState{constructor(e){this.type=ValueType,this.key=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=e[1];return s==null?i.error("Global state property must be defined."):typeof s!="string"?i.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new GlobalState(s)}evaluate(e){var i;const s=(i=e.globals)===null||i===void 0?void 0:i.globalState;return!s||Object.keys(s).length===0?null:getOwn(s,this.key)}eachChild(){}outputDefined(){return!1}}const expressions$1={"==":Equals,"!=":NotEquals,">":GreaterThan,"<":LessThan,">=":GreaterThanOrEqual,"<=":LessThanOrEqual,array:Assertion,at:At,boolean:Assertion,case:Case,coalesce:Coalesce,collator:CollatorExpression,format:FormatExpression,image:ImageExpression,in:In,"index-of":IndexOf,interpolate:Interpolate,"interpolate-hcl":Interpolate,"interpolate-lab":Interpolate,length:Length,let:Let,literal:Literal,match:Match,number:Assertion,"number-format":NumberFormat,object:Assertion,slice:Slice,step:Step,string:Assertion,"to-boolean":Coercion,"to-color":Coercion,"to-number":Coercion,"to-string":Coercion,var:Var,within:Within,distance:Distance,"global-state":GlobalState};class CompoundExpression{constructor(e,i,s,o){this.name=e,this.type=i,this._evaluate=s,this.args=o}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,i){const s=e[0],o=CompoundExpression.definitions[s];if(!o)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const l=Array.isArray(o)?o[0]:o.type,c=Array.isArray(o)?[[o[1],o[2]]]:o.overloads,u=c.filter(([g])=>!Array.isArray(g)||g.length===e.length-1);let f=null;for(const[g,H]of u){f=new ParsingContext(i.registry,isExpressionConstant,i.path,null,i.scope);const Y=[];let ee=!1;for(let te=1;te<e.length;te++){const ne=e[te],Ye=Array.isArray(g)?g[te-1]:g.type,xe=f.parse(ne,1+Y.length,Ye);if(!xe){ee=!0;break}Y.push(xe)}if(!ee){if(Array.isArray(g)&&g.length!==Y.length){f.error(`Expected ${g.length} arguments, but found ${Y.length} instead.`);continue}for(let te=0;te<Y.length;te++){const ne=Array.isArray(g)?g[te]:g.type,Ye=Y[te];f.concat(te+1).checkSubtype(ne,Ye.type)}if(f.errors.length===0)return new CompoundExpression(s,l,H,Y)}}if(u.length===1)i.errors.push(...f.errors);else{const H=(u.length?u:c).map(([ee])=>stringifySignature(ee)).join(" | "),Y=[];for(let ee=1;ee<e.length;ee++){const te=i.parse(e[ee],1+Y.length);if(!te)return null;Y.push(typeToString(te.type))}i.error(`Expected arguments of type ${H}, but found (${Y.join(", ")}) instead.`)}return null}static register(e,i){CompoundExpression.definitions=i;for(const s in i)e[s]=CompoundExpression}}function rgba(n,[e,i,s,o]){e=e.evaluate(n),i=i.evaluate(n),s=s.evaluate(n);const l=o?o.evaluate(n):1,c=validateRGBA(e,i,s,l);if(c)throw new RuntimeError(c);return new Color(e/255,i/255,s/255,l,!1)}function has(n,e){return n in e}function get$1(n,e){const i=e[n];return typeof i>"u"?null:i}function binarySearch(n,e,i,s){for(;i<=s;){const o=i+s>>1;if(e[o]===n)return!0;e[o]>n?s=o-1:i=o+1}return!1}function varargs(n){return{type:n}}CompoundExpression.register(expressions$1,{error:[ErrorType,[StringType],(n,[e])=>{throw new RuntimeError(e.evaluate(n))}],typeof:[StringType,[ValueType],(n,[e])=>typeToString(typeOf(e.evaluate(n)))],"to-rgba":[array(NumberType,4),[ColorType],(n,[e])=>{const[i,s,o,l]=e.evaluate(n).rgb;return[i*255,s*255,o*255,l]}],rgb:[ColorType,[NumberType,NumberType,NumberType],rgba],rgba:[ColorType,[NumberType,NumberType,NumberType,NumberType],rgba],has:{type:BooleanType,overloads:[[[StringType],(n,[e])=>has(e.evaluate(n),n.properties())],[[StringType,ObjectType],(n,[e,i])=>has(e.evaluate(n),i.evaluate(n))]]},get:{type:ValueType,overloads:[[[StringType],(n,[e])=>get$1(e.evaluate(n),n.properties())],[[StringType,ObjectType],(n,[e,i])=>get$1(e.evaluate(n),i.evaluate(n))]]},"feature-state":[ValueType,[StringType],(n,[e])=>get$1(e.evaluate(n),n.featureState||{})],properties:[ObjectType,[],n=>n.properties()],"geometry-type":[StringType,[],n=>n.geometryType()],id:[ValueType,[],n=>n.id()],zoom:[NumberType,[],n=>n.globals.zoom],"heatmap-density":[NumberType,[],n=>n.globals.heatmapDensity||0],elevation:[NumberType,[],n=>n.globals.elevation||0],"line-progress":[NumberType,[],n=>n.globals.lineProgress||0],accumulated:[ValueType,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[NumberType,varargs(NumberType),(n,e)=>{let i=0;for(const s of e)i+=s.evaluate(n);return i}],"*":[NumberType,varargs(NumberType),(n,e)=>{let i=1;for(const s of e)i*=s.evaluate(n);return i}],"-":{type:NumberType,overloads:[[[NumberType,NumberType],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[NumberType],(n,[e])=>-e.evaluate(n)]]},"/":[NumberType,[NumberType,NumberType],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[NumberType,[NumberType,NumberType],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[NumberType,[],()=>Math.LN2],pi:[NumberType,[],()=>Math.PI],e:[NumberType,[],()=>Math.E],"^":[NumberType,[NumberType,NumberType],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[NumberType,[NumberType],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[NumberType,[NumberType],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[NumberType,[NumberType],(n,[e])=>Math.log(e.evaluate(n))],log2:[NumberType,[NumberType],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[NumberType,[NumberType],(n,[e])=>Math.sin(e.evaluate(n))],cos:[NumberType,[NumberType],(n,[e])=>Math.cos(e.evaluate(n))],tan:[NumberType,[NumberType],(n,[e])=>Math.tan(e.evaluate(n))],asin:[NumberType,[NumberType],(n,[e])=>Math.asin(e.evaluate(n))],acos:[NumberType,[NumberType],(n,[e])=>Math.acos(e.evaluate(n))],atan:[NumberType,[NumberType],(n,[e])=>Math.atan(e.evaluate(n))],min:[NumberType,varargs(NumberType),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[NumberType,varargs(NumberType),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[NumberType,[NumberType],(n,[e])=>Math.abs(e.evaluate(n))],round:[NumberType,[NumberType],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[NumberType,[NumberType],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[NumberType,[NumberType],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[BooleanType,[StringType,ValueType],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[BooleanType,[ValueType],(n,[e])=>n.id()===e.value],"filter-type-==":[BooleanType,[StringType],(n,[e])=>n.geometryType()===e.value],"filter-<":[BooleanType,[StringType,ValueType],(n,[e,i])=>{const s=n.properties()[e.value],o=i.value;return typeof s==typeof o&&s<o}],"filter-id-<":[BooleanType,[ValueType],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[BooleanType,[StringType,ValueType],(n,[e,i])=>{const s=n.properties()[e.value],o=i.value;return typeof s==typeof o&&s>o}],"filter-id->":[BooleanType,[ValueType],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[BooleanType,[StringType,ValueType],(n,[e,i])=>{const s=n.properties()[e.value],o=i.value;return typeof s==typeof o&&s<=o}],"filter-id-<=":[BooleanType,[ValueType],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[BooleanType,[StringType,ValueType],(n,[e,i])=>{const s=n.properties()[e.value],o=i.value;return typeof s==typeof o&&s>=o}],"filter-id->=":[BooleanType,[ValueType],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[BooleanType,[ValueType],(n,[e])=>e.value in n.properties()],"filter-has-id":[BooleanType,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[BooleanType,[array(StringType)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[BooleanType,[array(ValueType)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[BooleanType,[StringType,array(ValueType)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[BooleanType,[StringType,array(ValueType)],(n,[e,i])=>binarySearch(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:BooleanType,overloads:[[[BooleanType,BooleanType],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[varargs(BooleanType),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:BooleanType,overloads:[[[BooleanType,BooleanType],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[varargs(BooleanType),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[BooleanType,[BooleanType],(n,[e])=>!e.evaluate(n)],"is-supported-script":[BooleanType,[StringType],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return i?i(e.evaluate(n)):!0}],upcase:[StringType,[StringType],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[StringType,[StringType],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[StringType,varargs(ValueType),(n,e)=>e.map(i=>valueToString(i.evaluate(n))).join("")],"resolved-locale":[StringType,[CollatorType],(n,[e])=>e.evaluate(n).resolvedLocale()]});function stringifySignature(n){return Array.isArray(n)?`(${n.map(typeToString).join(", ")})`:`(${typeToString(n.type)}...)`}function isExpressionConstant(n){if(n instanceof Var)return isExpressionConstant(n.boundExpression);if(n instanceof CompoundExpression&&n.name==="error")return!1;if(n instanceof CollatorExpression)return!1;if(n instanceof Within)return!1;if(n instanceof Distance)return!1;if(n instanceof GlobalState)return!1;const e=n instanceof Coercion||n instanceof Assertion;let i=!0;return n.eachChild(s=>{e?i=i&&isExpressionConstant(s):i=i&&s instanceof Literal}),i?isFeatureConstant(n)&&isGlobalPropertyConstant(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function isFeatureConstant(n){if(n instanceof CompoundExpression){if(n.name==="get"&&n.args.length===1)return!1;if(n.name==="feature-state")return!1;if(n.name==="has"&&n.args.length===1)return!1;if(n.name==="properties"||n.name==="geometry-type"||n.name==="id")return!1;if(/^filter-/.test(n.name))return!1}if(n instanceof Within||n instanceof Distance)return!1;let e=!0;return n.eachChild(i=>{e&&!isFeatureConstant(i)&&(e=!1)}),e}function isStateConstant(n){if(n instanceof CompoundExpression&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!isStateConstant(i)&&(e=!1)}),e}function isGlobalPropertyConstant(n,e){if(n instanceof CompoundExpression&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(s=>{i&&!isGlobalPropertyConstant(s,e)&&(i=!1)}),i}function success(n){return{result:"success",value:n}}function error(n){return{result:"error",value:n}}function supportsPropertyExpression(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function supportsZoomExpression(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function supportsInterpolation(n){return!!n.expression&&n.expression.interpolated}function isFunction$1(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&typeOf(n)===ObjectType}class StyleExpression{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new EvaluationContext,this._defaultValue=i?getDefaultValue(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,s,o,l,c){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=o,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=c,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,o,l,c){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=o,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=c||null;try{const u=this.expression.evaluate(this._evaluator);if(u==null||typeof u=="number"&&u!==u)return this._defaultValue;if(this._enumValues&&!(u in this._enumValues))throw new RuntimeError(`Expected value to be one of ${Object.keys(this._enumValues).map(f=>JSON.stringify(f)).join(", ")}, but found ${JSON.stringify(u)} instead.`);return u}catch(u){return this._warningHistory[u.message]||(this._warningHistory[u.message]=!0,typeof console<"u"&&console.warn(u.message)),this._defaultValue}}}function isExpression(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in expressions$1}function createExpression(n,e){const i=new ParsingContext(expressions$1,isExpressionConstant,[],e?getExpectedType(e):void 0),s=i.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?success(new StyleExpression(s,e)):error(i.errors)}class ZoomConstantExpression{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!isStateConstant(i.expression),this.globalStateRefs=findGlobalStateRefs(i.expression)}evaluateWithoutErrorHandling(e,i,s,o,l,c){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,o,l,c)}evaluate(e,i,s,o,l,c){return this._styleExpression.evaluate(e,i,s,o,l,c)}}class ZoomDependentExpression{constructor(e,i,s,o){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!isStateConstant(i.expression),this.globalStateRefs=findGlobalStateRefs(i.expression),this.interpolationType=o}evaluateWithoutErrorHandling(e,i,s,o,l,c){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,o,l,c)}evaluate(e,i,s,o,l,c){return this._styleExpression.evaluate(e,i,s,o,l,c)}interpolationFactor(e,i,s){return this.interpolationType?Interpolate.interpolationFactor(this.interpolationType,e,i,s):0}}function createPropertyExpression(n,e){const i=createExpression(n,e);if(i.result==="error")return i;const s=i.value.expression,o=isFeatureConstant(s);if(!o&&!supportsPropertyExpression(e))return error([new ExpressionParsingError("","data expressions not supported")]);const l=isGlobalPropertyConstant(s,["zoom"]);if(!l&&!supportsZoomExpression(e))return error([new ExpressionParsingError("","zoom expressions not supported")]);const c=findZoomCurve(s);if(!c&&!l)return error([new ExpressionParsingError("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(c instanceof ExpressionParsingError)return error([c]);if(c instanceof Interpolate&&!supportsInterpolation(e))return error([new ExpressionParsingError("",'"interpolate" expressions cannot be used with this property')]);if(!c)return success(o?new ZoomConstantExpression("constant",i.value):new ZoomConstantExpression("source",i.value));const u=c instanceof Interpolate?c.interpolation:void 0;return success(o?new ZoomDependentExpression("camera",i.value,c.labels,u):new ZoomDependentExpression("composite",i.value,c.labels,u))}function findZoomCurve(n){let e=null;if(n instanceof Let)e=findZoomCurve(n.result);else if(n instanceof Coalesce){for(const i of n.args)if(e=findZoomCurve(i),e)break}else(n instanceof Step||n instanceof Interpolate)&&n.input instanceof CompoundExpression&&n.input.name==="zoom"&&(e=n);return e instanceof ExpressionParsingError||n.eachChild(i=>{const s=findZoomCurve(i);s instanceof ExpressionParsingError?e=s:!e&&s?e=new ExpressionParsingError("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new ExpressionParsingError("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function findGlobalStateRefs(n,e=new Set){return n instanceof GlobalState&&e.add(n.key),n.eachChild(i=>{findGlobalStateRefs(i,e)}),e}function getExpectedType(n){const e={color:ColorType,string:StringType,number:NumberType,enum:StringType,boolean:BooleanType,formatted:FormattedType,padding:PaddingType,numberArray:NumberArrayType,colorArray:ColorArrayType,projectionDefinition:ProjectionDefinitionType,resolvedImage:ResolvedImageType,variableAnchorOffsetCollection:VariableAnchorOffsetCollectionType};return n.type==="array"?array(e[n.value]||ValueType,n.length):e[n.type]}function getDefaultValue(n){if(n.type==="color"&&isFunction$1(n.default))return new Color(0,0,0,0);switch(n.type){case"color":return Color.parse(n.default)||null;case"padding":return Padding.parse(n.default)||null;case"numberArray":return NumberArray.parse(n.default)||null;case"colorArray":return ColorArray.parse(n.default)||null;case"variableAnchorOffsetCollection":return VariableAnchorOffsetCollection.parse(n.default)||null;case"projectionDefinition":return ProjectionDefinition.parse(n.default)||null;default:return n.default===void 0?null:n.default}}function isExpressionFilter(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!isExpressionFilter(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const filterSpec={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function featureFilter(n){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};isExpressionFilter(n)||(n=convertFilter$1(n));const e=createExpression(n,filterSpec);if(e.result==="error")throw new Error(e.value.map(i=>`${i.key}: ${i.message}`).join(", "));{const i=geometryNeeded(n);return{filter:(s,o,l)=>e.value.evaluate(s,o,{},l),needGeometry:i,getGlobalStateRefs:()=>findGlobalStateRefs(e.value.expression)}}}function compare(n,e){return n<e?-1:n>e?1:0}function geometryNeeded(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(geometryNeeded(n[e]))return!0;return!1}function convertFilter$1(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?convertComparisonOp$1(n[1],n[2],"=="):e==="!="?convertNegation(convertComparisonOp$1(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?convertComparisonOp$1(n[1],n[2],e):e==="any"?convertDisjunctionOp(n.slice(1)):e==="all"?["all"].concat(n.slice(1).map(convertFilter$1)):e==="none"?["all"].concat(n.slice(1).map(convertFilter$1).map(convertNegation)):e==="in"?convertInOp$1(n[1],n.slice(2)):e==="!in"?convertNegation(convertInOp$1(n[1],n.slice(2))):e==="has"?convertHasOp$1(n[1]):e==="!has"?convertNegation(convertHasOp$1(n[1])):!0}function convertComparisonOp$1(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function convertDisjunctionOp(n){return["any"].concat(n.map(convertFilter$1))}function convertInOp$1(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(compare)]]:["filter-in-small",n,["literal",e]]}}function convertHasOp$1(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function convertNegation(n){return["!",n]}function convertLiteral(n){return typeof n=="object"?["literal",n]:n}function convertFunction(n,e){let i=n.stops;if(!i)return convertIdentityFunction(n,e);const s=i&&typeof i[0][0]=="object",o=s||n.property!==void 0,l=s||!o;return i=i.map(c=>!o&&e.tokens&&typeof c[1]=="string"?[c[0],convertTokenString(c[1])]:[c[0],convertLiteral(c[1])]),s?convertZoomAndPropertyFunction(n,e,i):l?convertZoomFunction(n,e,i):convertPropertyFunction(n,e,i)}function convertIdentityFunction(n,e){const i=["get",n.property];if(n.default===void 0)return e.type==="string"?["string",i]:i;if(e.type==="enum")return["match",i,Object.keys(e.values),i,n.default];{const s=[e.type==="color"?"to-color":e.type,i,convertLiteral(n.default)];return e.type==="array"&&s.splice(1,0,e.value,e.length||null),s}}function getInterpolateOperator(n){switch(n.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function convertZoomAndPropertyFunction(n,e,i){const s={},o={},l=[];for(let u=0;u<i.length;u++){const f=i[u],g=f[0].zoom;s[g]===void 0&&(s[g]={zoom:g,type:n.type,property:n.property,default:n.default},o[g]=[],l.push(g)),o[g].push([f[0].value,f[1]])}if(getFunctionType({},e)==="exponential"){const u=[getInterpolateOperator(n),["linear"],["zoom"]];for(const f of l){const g=convertPropertyFunction(s[f],e,o[f]);appendStopPair(u,f,g,!1)}return u}else{const u=["step",["zoom"]];for(const f of l){const g=convertPropertyFunction(s[f],e,o[f]);appendStopPair(u,f,g,!0)}return fixupDegenerateStepCurve(u),u}}function coalesce(n,e){if(n!==void 0)return n;if(e!==void 0)return e}function getFallback(n,e){const i=convertLiteral(coalesce(n.default,e.default));return i===void 0&&e.type==="resolvedImage"?"":i}function convertPropertyFunction(n,e,i){const s=getFunctionType(n,e),o=["get",n.property];if(s==="categorical"&&typeof i[0][0]=="boolean"){const l=["case"];for(const c of i)l.push(["==",o,c[0]],c[1]);return l.push(getFallback(n,e)),l}else if(s==="categorical"){const l=["match",o];for(const c of i)appendStopPair(l,c[0],c[1],!1);return l.push(getFallback(n,e)),l}else if(s==="interval"){const l=["step",["number",o]];for(const c of i)appendStopPair(l,c[0],c[1],!0);return fixupDegenerateStepCurve(l),n.default===void 0?l:["case",["==",["typeof",o],"number"],l,convertLiteral(n.default)]}else if(s==="exponential"){const l=n.base!==void 0?n.base:1,c=[getInterpolateOperator(n),l===1?["linear"]:["exponential",l],["number",o]];for(const u of i)appendStopPair(c,u[0],u[1],!1);return n.default===void 0?c:["case",["==",["typeof",o],"number"],c,convertLiteral(n.default)]}else throw new Error(`Unknown property function type ${s}`)}function convertZoomFunction(n,e,i,s=["zoom"]){const o=getFunctionType(n,e);let l,c=!1;if(o==="interval")l=["step",s],c=!0;else if(o==="exponential"){const u=n.base!==void 0?n.base:1;l=[getInterpolateOperator(n),u===1?["linear"]:["exponential",u],s]}else throw new Error(`Unknown zoom function type "${o}"`);for(const u of i)appendStopPair(l,u[0],u[1],c);return fixupDegenerateStepCurve(l),l}function fixupDegenerateStepCurve(n){n[0]==="step"&&n.length===3&&(n.push(0),n.push(n[3]))}function appendStopPair(n,e,i,s){n.length>3&&e===n[n.length-2]||(s&&n.length===2||n.push(e),n.push(i))}function getFunctionType(n,e){return n.type?n.type:e.expression.interpolated?"exponential":"interval"}function convertTokenString(n){const e=["concat"],i=/{([^{}]+)}/g;let s=0;for(let o=i.exec(n);o!==null;o=i.exec(n)){const l=n.slice(s,i.lastIndex-o[0].length);s=i.lastIndex,l.length>0&&e.push(l),e.push(["get",o[1]])}if(e.length===1)return n;if(s<n.length)e.push(n.slice(s));else if(e.length===2)return["to-string",e[1]];return e}const v8=v8Spec;var fontWeights={thin:100,hairline:100,"ultra-light":200,"extra-light":200,light:300,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,"extra-bold":800,"ultra-bold":800,heavy:900,black:900,"heavy-black":900,fat:900,poster:900,"ultra-black":950,"extra-black":950},sp=" ",italicRE=/(italic|oblique)$/i,fontCache={};function mb2css(n,e,i){var s=fontCache[n];if(!s){Array.isArray(n)||(n=[n]);for(var o=400,l="normal",c=[],u,f,g=0,H=n.length;g<H;++g){var Y=n[g],ee=Y.split(" "),te=ee[ee.length-1].toLowerCase();te=="normal"||te=="italic"||te=="oblique"?(l=f?l:te,f=!0,ee.pop(),te=ee[ee.length-1].toLowerCase()):italicRE.test(te)&&(te=te.replace(italicRE,""),l=f?l:ee[ee.length-1].replace(te,""),f=!0);for(var ne in fontWeights){var Ye=ee.length>1?ee[ee.length-2].toLowerCase():"";if(te==ne||te==ne.replace("-","")||Ye+"-"+te==ne){o=u?o:fontWeights[ne],ee.pop(),Ye&&ne.startsWith(Ye)&&ee.pop();break}}!u&&typeof te=="number"&&(o=te,u=!0);var xe=ee.join(sp).replace("Klokantech Noto Sans","Noto Sans").replace("DIN Pro","Barlow").replace("Arial Unicode MS","Arial");xe.indexOf(sp)!==-1&&(xe='"'+xe+'"'),c.push(xe)}s=fontCache[n]=[l,o,c]}return s[0]+sp+s[1]+sp+e+"px"+(i?"/"+i:"")+sp+s[2]}const PointerEventType={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"};class MapBrowserEventHandler extends Target{constructor(e,i){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=i===void 0?1:i,this.down_=null;const s=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=s,this.pointerdownListenerKey_=listen(s,PointerEventType.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=listen(s,PointerEventType.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(EventType$1.TOUCHMOVE,this.boundHandleTouchMove_,PASSIVE_EVENT_LISTENERS?{passive:!1}:!1)}emulateClick_(e){let i=new MapBrowserEvent(MapBrowserEventType.CLICK,this.map_,e);this.dispatchEvent(i),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,i=new MapBrowserEvent(MapBrowserEventType.DBLCLICK,this.map_,e),this.dispatchEvent(i)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const s=new MapBrowserEvent(MapBrowserEventType.SINGLECLICK,this.map_,e);this.dispatchEvent(s)},250)}updateActivePointers_(e){const i=e,s=i.pointerId;if(i.type==MapBrowserEventType.POINTERUP||i.type==MapBrowserEventType.POINTERCANCEL){delete this.trackedTouches_[s];for(const o in this.trackedTouches_)if(this.trackedTouches_[o].target!==i.target){delete this.trackedTouches_[o];break}}else(i.type==MapBrowserEventType.POINTERDOWN||i.type==MapBrowserEventType.POINTERMOVE)&&(this.trackedTouches_[s]=i);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const i=new MapBrowserEvent(MapBrowserEventType.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(i),this.emulateClicks_&&!i.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const i=new MapBrowserEvent(MapBrowserEventType.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(i),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const s=this.map_.getOwnerDocument();this.dragListenerKeys_.push(listen(s,MapBrowserEventType.POINTERMOVE,this.handlePointerMove_,this),listen(s,MapBrowserEventType.POINTERUP,this.handlePointerUp_,this),listen(this.element_,MapBrowserEventType.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==s&&this.dragListenerKeys_.push(listen(this.element_.getRootNode(),MapBrowserEventType.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const i=new MapBrowserEvent(MapBrowserEventType.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(i)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const i=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new MapBrowserEvent(MapBrowserEventType.POINTERMOVE,this.map_,e,i))}handleTouchMove_(e){const i=this.originalPointerMoveEvent_;(!i||i.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(unlistenByKey(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(EventType$1.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(unlistenByKey(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const MapProperty={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},DROP=1/0;class PriorityQueue{constructor(e,i){this.priorityFunction_=e,this.keyFunction_=i,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,clear$1(this.queuedElements_)}dequeue(){const e=this.elements_,i=this.priorities_,s=e[0];e.length==1?(e.length=0,i.length=0):(e[0]=e.pop(),i[0]=i.pop(),this.siftUp_(0));const o=this.keyFunction_(s);return delete this.queuedElements_[o],s}enqueue(e){assert(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const i=this.priorityFunction_(e);return i!=DROP?(this.elements_.push(e),this.priorities_.push(i),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const i=this.elements_,s=this.priorities_,o=i.length,l=i[e],c=s[e],u=e;for(;e<o>>1;){const f=this.getLeftChildIndex_(e),g=this.getRightChildIndex_(e),H=g<o&&s[g]<s[f]?g:f;i[e]=i[H],s[e]=s[H],e=H}i[e]=l,s[e]=c,this.siftDown_(u,e)}siftDown_(e,i){const s=this.elements_,o=this.priorities_,l=s[i],c=o[i];for(;i>e;){const u=this.getParentIndex_(i);if(o[u]>c)s[i]=s[u],o[i]=o[u],i=u;else break}s[i]=l,o[i]=c}reprioritize(){const e=this.priorityFunction_,i=this.elements_,s=this.priorities_;let o=0;const l=i.length;let c,u,f;for(u=0;u<l;++u)c=i[u],f=e(c),f==DROP?delete this.queuedElements_[this.keyFunction_(c)]:(s[o]=f,i[o++]=c);i.length=o,s.length=o,this.heapify_()}}class TileQueue extends PriorityQueue{constructor(e,i){super(s=>e.apply(null,s),s=>s[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=i,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const i=super.enqueue(e);return i&&e[0].addEventListener(EventType$1.CHANGE,this.boundHandleTileChange_),i}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const i=e.target,s=i.getState();if(s===TileState.LOADED||s===TileState.ERROR||s===TileState.EMPTY){s!==TileState.ERROR&&i.removeEventListener(EventType$1.CHANGE,this.boundHandleTileChange_);const o=i.getKey();o in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[o],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,i){let s=0;for(;this.tilesLoading_<e&&s<i&&this.getCount()>0;){const o=this.dequeue()[0],l=o.getKey();o.getState()===TileState.IDLE&&!(l in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[l]=!0,++this.tilesLoading_,++s,o.load())}}}function getTilePriority(n,e,i,s,o){if(!n||!(i in n.wantedTiles)||!n.wantedTiles[i][e.getKey()])return DROP;const l=n.viewState.center,c=s[0]-l[0],u=s[1]-l[1];return 65536*Math.log(o)+Math.sqrt(c*c+u*u)/o}class Attribution extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=e.attributions;const i=e.className!==void 0?e.className:"ol-attribution",s=e.tipLabel!==void 0?e.tipLabel:"Attributions",o=e.expandClassName!==void 0?e.expandClassName:i+"-expand",l=e.collapseLabel!==void 0?e.collapseLabel:"",c=e.collapseClassName!==void 0?e.collapseClassName:i+"-collapse";typeof l=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=l,this.collapseLabel_.className=c):this.collapseLabel_=l;const u=e.label!==void 0?e.label:"i";typeof u=="string"?(this.label_=document.createElement("span"),this.label_.textContent=u,this.label_.className=o):this.label_=u;const f=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=s,this.toggleButton_.appendChild(f),this.toggleButton_.addEventListener(EventType$1.CLICK,this.handleClick_.bind(this),!1);const g=i+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" "+CLASS_COLLAPSED:"")+(this.collapsible_?"":" ol-uncollapsible"),H=this.element;H.className=g,H.appendChild(this.toggleButton_),H.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const i=this.getMap().getAllLayers(),s=new Set(i.flatMap(o=>o.getAttributions(e)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(o=>s.add(o)):s.add(this.attributions_)),!this.overrideCollapsible_){const o=!i.some(l=>{var c;return((c=l.getSource())==null?void 0:c.getAttributionsCollapsible())===!1});this.setCollapsible(o)}return Array.from(s)}async updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const i=await Promise.all(this.collectSourceAttributions_(e).map(o=>toPromise(()=>o))),s=i.length>0;if(this.renderedVisible_!=s&&(this.element.style.display=s?"":"none",this.renderedVisible_=s),!equals$2(i,this.renderedAttributions_)){removeChildren(this.ulElement_);for(let o=0,l=i.length;o<l;++o){const c=document.createElement("li");c.innerHTML=i[o],this.ulElement_.appendChild(c)}this.renderedAttributions_=i}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(CLASS_COLLAPSED),this.collapsed_?replaceNode(this.collapseLabel_,this.label_):replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class Rotate extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const i=e.className!==void 0?e.className:"ol-rotate",s=e.label!==void 0?e.label:"",o=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof s=="string"?(this.label_=document.createElement("span"),this.label_.className=o,this.label_.textContent=s):(this.label_=s,this.label_.classList.add(o));const l=e.tipLabel?e.tipLabel:"Reset rotation",c=document.createElement("button");c.className=i+"-reset",c.setAttribute("type","button"),c.title=l,c.appendChild(this.label_),c.addEventListener(EventType$1.CLICK,this.handleClick_.bind(this),!1);const u=i+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,f=this.element;f.className=u,f.appendChild(c),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(CLASS_HIDDEN)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const i=this.getMap().getView();if(!i)return;const s=i.getRotation();s!==void 0&&(this.duration_>0&&s%(2*Math.PI)!==0?i.animate({rotation:0,duration:this.duration_,easing:easeOut}):i.setRotation(0))}render(e){const i=e.frameState;if(!i)return;const s=i.viewState.rotation;if(s!=this.rotation_){const o="rotate("+s+"rad)";if(this.autoHide_){const l=this.element.classList.contains(CLASS_HIDDEN);!l&&s===0?this.element.classList.add(CLASS_HIDDEN):l&&s!==0&&this.element.classList.remove(CLASS_HIDDEN)}this.label_.style.transform=o}this.rotation_=s}}class Zoom extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const i=e.className!==void 0?e.className:"ol-zoom",s=e.delta!==void 0?e.delta:1,o=e.zoomInClassName!==void 0?e.zoomInClassName:i+"-in",l=e.zoomOutClassName!==void 0?e.zoomOutClassName:i+"-out",c=e.zoomInLabel!==void 0?e.zoomInLabel:"+",u=e.zoomOutLabel!==void 0?e.zoomOutLabel:"",f=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",g=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",H=document.createElement("button");H.className=o,H.setAttribute("type","button"),H.title=f,H.appendChild(typeof c=="string"?document.createTextNode(c):c),H.addEventListener(EventType$1.CLICK,this.handleClick_.bind(this,s),!1);const Y=document.createElement("button");Y.className=l,Y.setAttribute("type","button"),Y.title=g,Y.appendChild(typeof u=="string"?document.createTextNode(u):u),Y.addEventListener(EventType$1.CLICK,this.handleClick_.bind(this,-s),!1);const ee=i+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,te=this.element;te.className=ee,te.appendChild(H),te.appendChild(Y),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,i){i.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const s=this.getMap().getView();if(!s)return;const o=s.getZoom();if(o!==void 0){const l=s.getConstrainedZoom(o+e);this.duration_>0?(s.getAnimating()&&s.cancelAnimations(),s.animate({zoom:l,duration:this.duration_,easing:easeOut})):s.setZoom(l)}}}function defaults$2(n){n=n||{};const e=new Collection;return(n.zoom!==void 0?n.zoom:!0)&&e.push(new Zoom(n.zoomOptions)),(n.rotate!==void 0?n.rotate:!0)&&e.push(new Rotate(n.rotateOptions)),(n.attribution!==void 0?n.attribution:!0)&&e.push(new Attribution(n.attributionOptions)),e}class GroupEvent extends BaseEvent{constructor(e,i){super(e),this.layer=i}}const Property={LAYERS:"layers"};class LayerGroup extends BaseLayer{constructor(e){e=e||{};const i=Object.assign({},e);delete i.layers;let s=e.layers;super(i),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Property.LAYERS,this.handleLayersChanged_),s?Array.isArray(s)?s=new Collection(s.slice(),{unique:!0}):assert(typeof s.getArray=="function","Expected `layers` to be an array or a `Collection`"):s=new Collection(void 0,{unique:!0}),this.setLayers(s)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(unlistenByKey),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(listen(e,CollectionEventType.ADD,this.handleLayersAdd_,this),listen(e,CollectionEventType.REMOVE,this.handleLayersRemove_,this));for(const s in this.listenerKeys_)this.listenerKeys_[s].forEach(unlistenByKey);clear$1(this.listenerKeys_);const i=e.getArray();for(let s=0,o=i.length;s<o;s++){const l=i[s];this.registerLayerListeners_(l),this.dispatchEvent(new GroupEvent("addlayer",l))}this.changed()}registerLayerListeners_(e){const i=[listen(e,ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),listen(e,EventType$1.CHANGE,this.handleLayerChange_,this)];e instanceof LayerGroup&&i.push(listen(e,"addlayer",this.handleLayerGroupAdd_,this),listen(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[getUid(e)]=i}handleLayerGroupAdd_(e){this.dispatchEvent(new GroupEvent("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new GroupEvent("removelayer",e.layer))}handleLayersAdd_(e){const i=e.element;this.registerLayerListeners_(i),this.dispatchEvent(new GroupEvent("addlayer",i)),this.changed()}handleLayersRemove_(e){const i=e.element,s=getUid(i);this.listenerKeys_[s].forEach(unlistenByKey),delete this.listenerKeys_[s],this.dispatchEvent(new GroupEvent("removelayer",i)),this.changed()}getLayers(){return this.get(Property.LAYERS)}setLayers(e){const i=this.getLayers();if(i){const s=i.getArray();for(let o=0,l=s.length;o<l;++o)this.dispatchEvent(new GroupEvent("removelayer",s[o]))}this.set(Property.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(i){i.getLayersArray(e)}),e}getLayerStatesArray(e){const i=e!==void 0?e:[],s=i.length;this.getLayers().forEach(function(c){c.getLayerStatesArray(i)});const o=this.getLayerState();let l=o.zIndex;!e&&o.zIndex===void 0&&(l=0);for(let c=s,u=i.length;c<u;c++){const f=i[c];f.opacity*=o.opacity,f.visible=f.visible&&o.visible,f.maxResolution=Math.min(f.maxResolution,o.maxResolution),f.minResolution=Math.max(f.minResolution,o.minResolution),f.minZoom=Math.max(f.minZoom,o.minZoom),f.maxZoom=Math.min(f.maxZoom,o.maxZoom),o.extent!==void 0&&(f.extent!==void 0?f.extent=getIntersection(f.extent,o.extent):f.extent=o.extent),f.zIndex===void 0&&(f.zIndex=l)}return i}getSourceState(){return"ready"}}class MapRenderer extends Disposable{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,i){abstract()}calculateMatrices2D(e){const i=e.viewState,s=e.coordinateToPixelTransform,o=e.pixelToCoordinateTransform;compose(s,e.size[0]/2,e.size[1]/2,1/i.resolution,-1/i.resolution,-i.rotation,-i.center[0],-i.center[1]),makeInverse(o,s)}forEachFeatureAtCoordinate(e,i,s,o,l,c,u,f){let g;const H=i.viewState;function Y(rt,nt,at,st){return l.call(c,nt,rt?at:null,st)}const ee=H.projection,te=wrapX$1(e.slice(),ee),ne=[[0,0]];if(ee.canWrapX()&&o){const rt=ee.getExtent(),nt=getWidth(rt);ne.push([-nt,0],[nt,0])}const Ye=i.layerStatesArray,xe=Ye.length,tt=[],et=[];for(let rt=0;rt<ne.length;rt++)for(let nt=xe-1;nt>=0;--nt){const at=Ye[nt],st=at.layer;if(st.hasRenderer()&&inView(at,H)&&u.call(f,st)){const ot=st.getRenderer(),ut=st.getSource();if(ot&&ut){const ht=ut.getWrapX()?te:e,dt=Y.bind(null,at.managed);et[0]=ht[0]+ne[rt][0],et[1]=ht[1]+ne[rt][1],g=ot.forEachFeatureAtCoordinate(et,i,s,dt,tt)}if(g)return g}}if(tt.length===0)return;const it=1/tt.length;return tt.forEach((rt,nt)=>rt.distanceSq+=nt*it),tt.sort((rt,nt)=>rt.distanceSq-nt.distanceSq),tt.some(rt=>g=rt.callback(rt.feature,rt.layer,rt.geometry)),g}hasFeatureAtCoordinate(e,i,s,o,l,c){return this.forEachFeatureAtCoordinate(e,i,s,o,TRUE,this,l,c)!==void 0}getMap(){return this.map_}renderFrame(e){abstract()}scheduleExpireIconCache(e){shared.canExpireCache()&&e.postRenderFunctions.push(expireIconCache)}}function expireIconCache(n,e){shared.expire()}class CompositeMapRenderer extends MapRenderer{constructor(e){super(e),this.fontChangeListenerKey_=listen(checkedFonts,ObjectEventType.PROPERTYCHANGE,e.redrawText,e),this.element_=document.createElement("div");const i=this.element_.style;i.position="absolute",i.width="100%",i.height="100%",i.zIndex="0",this.element_.className=CLASS_UNSELECTABLE+" ol-layers";const s=e.getViewport();s.insertBefore(this.element_,s.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,i){const s=this.getMap();if(s.hasListener(e)){const o=new RenderEvent(e,void 0,i);s.dispatchEvent(o)}}disposeInternal(){unlistenByKey(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(EventType.PRECOMPOSE,e);const i=e.layerStatesArray.sort((u,f)=>u.zIndex-f.zIndex);i.some(u=>u.layer instanceof BaseVectorLayer&&u.layer.getDeclutter())&&(e.declutter={});const o=e.viewState;this.children_.length=0;const l=[];let c=null;for(let u=0,f=i.length;u<f;++u){const g=i[u];e.layerIndex=u;const H=g.layer,Y=H.getSourceState();if(!inView(g,o)||Y!="ready"&&Y!="undefined"){H.unrender();continue}const ee=H.render(e,c);ee&&(ee!==c&&(this.children_.push(ee),c=ee),l.push(g))}this.declutter(e,l),replaceChildren(this.element_,this.children_),this.dispatchRenderEvent(EventType.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,i){if(e.declutter){for(let s=i.length-1;s>=0;--s){const o=i[s],l=o.layer;l.getDeclutter()&&l.renderDeclutter(e,o)}i.forEach(s=>s.layer.renderDeferred(e))}}}function removeLayerMapProperty(n){if(n instanceof Layer$1){n.setMapInternal(null);return}n instanceof LayerGroup&&n.getLayers().forEach(removeLayerMapProperty)}function setLayerMapProperty(n,e){if(n instanceof Layer$1){n.setMapInternal(e);return}if(n instanceof LayerGroup){const i=n.getLayers().getArray();for(let s=0,o=i.length;s<o;++s)setLayerMapProperty(i[s],e)}}let Map$1=class extends BaseObject{constructor(e){super(),e=e||{},this.on,this.once,this.un;const i=createOptionsInternal(e);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:DEVICE_PIXEL_RATIO,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=create(),this.pixelToCoordinateTransform_=create(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=i.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=i.controls||defaults$2(),this.interactions=i.interactions||defaults$3({onFocusOnly:!0}),this.overlays_=i.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new TileQueue(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(MapProperty.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(MapProperty.VIEW,this.handleViewChanged_),this.addChangeListener(MapProperty.SIZE,this.handleSizeChanged_),this.addChangeListener(MapProperty.TARGET,this.handleTargetChanged_),this.setProperties(i.values);const s=this;e.view&&!(e.view instanceof View)&&e.view.then(function(o){s.setView(new View(o))}),this.controls.addEventListener(CollectionEventType.ADD,o=>{o.element.setMap(this)}),this.controls.addEventListener(CollectionEventType.REMOVE,o=>{o.element.setMap(null)}),this.interactions.addEventListener(CollectionEventType.ADD,o=>{o.element.setMap(this)}),this.interactions.addEventListener(CollectionEventType.REMOVE,o=>{o.element.setMap(null)}),this.overlays_.addEventListener(CollectionEventType.ADD,o=>{this.addOverlayInternal_(o.element)}),this.overlays_.addEventListener(CollectionEventType.REMOVE,o=>{const l=o.element.getId();l!==void 0&&delete this.overlayIdIndex_[l.toString()],o.element.setMap(null)}),this.controls.forEach(o=>{o.setMap(this)}),this.interactions.forEach(o=>{o.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){setLayerMapProperty(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const i=e.getId();i!==void 0&&(this.overlayIdIndex_[i.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,i,s){if(!this.frameState_||!this.renderer_)return;const o=this.getCoordinateFromPixelInternal(e);s=s!==void 0?s:{};const l=s.hitTolerance!==void 0?s.hitTolerance:0,c=s.layerFilter!==void 0?s.layerFilter:TRUE,u=s.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(o,this.frameState_,l,u,i,null,c,null)}getFeaturesAtPixel(e,i){const s=[];return this.forEachFeatureAtPixel(e,function(o){s.push(o)},i),s}getAllLayers(){const e=[];function i(s){s.forEach(function(o){o instanceof LayerGroup?i(o.getLayers()):e.push(o)})}return i(this.getLayers()),e}hasFeatureAtPixel(e,i){if(!this.frameState_||!this.renderer_)return!1;const s=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const o=i.layerFilter!==void 0?i.layerFilter:TRUE,l=i.hitTolerance!==void 0?i.hitTolerance:0,c=i.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(s,this.frameState_,l,c,o,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const s=this.viewport_.getBoundingClientRect(),o=this.getSize(),l=s.width/o[0],c=s.height/o[1],u="changedTouches"in e?e.changedTouches[0]:e;return[(u.clientX-s.left)/l,(u.clientY-s.top)/c]}getTarget(){return this.get(MapProperty.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return toUserCoordinate(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const i=this.frameState_;return i?apply(i.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const i=this.overlayIdIndex_[e.toString()];return i!==void 0?i:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(MapProperty.LAYERGROUP)}setLayers(e){const i=this.getLayerGroup();if(e instanceof Collection){i.setLayers(e);return}const s=i.getLayers();s.clear(),s.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let i=0,s=e.length;i<s;++i){const o=e[i];if(!o.visible)continue;const l=o.layer.getRenderer();if(l&&!l.ready)return!0;const c=o.layer.getSource();if(c&&c.loading)return!0}return!1}getPixelFromCoordinate(e){const i=fromUserCoordinate(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(i)}getPixelFromCoordinateInternal(e){const i=this.frameState_;return i?apply(i.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(MapProperty.SIZE)}getView(){return this.get(MapProperty.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,i,s,o){return getTilePriority(this.frameState_,e,i,s,o)}handleBrowserEvent(e,i){i=i||e.type;const s=new MapBrowserEvent(i,this,e);this.handleMapBrowserEvent(s)}handleMapBrowserEvent(e){if(!this.frameState_)return;const i=e.originalEvent,s=i.type;if(s===PointerEventType.POINTERDOWN||s===EventType$1.WHEEL||s===EventType$1.KEYDOWN){const o=this.getOwnerDocument(),l=this.viewport_.getRootNode?this.viewport_.getRootNode():o,c=i.target,u=l instanceof ShadowRoot?l.host===c?l.host.ownerDocument:l:l===o?o.documentElement:l;if(this.overlayContainerStopEvent_.contains(c)||!u.contains(c))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const o=this.getInteractions().getArray().slice();for(let l=o.length-1;l>=0;l--){const c=o[l];if(c.getMap()!==this||!c.getActive()||!this.getTargetElement())continue;if(!c.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,i=this.tileQueue_;if(!i.isEmpty()){let o=this.maxTilesLoading_,l=o;if(e){const c=e.viewHints;if(c[ViewHint.ANIMATING]||c[ViewHint.INTERACTING]){const u=Date.now()-e.time>8;o=u?0:8,l=u?0:2}}i.getTilesLoading()<o&&(i.reprioritize(),i.loadMoreTiles(o,l))}e&&this.renderer_&&!e.animate&&(this.renderComplete_?(this.hasListener(EventType.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(EventType.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new MapEvent(MapEventType.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new MapEvent(MapEventType.LOADSTART,this,e))));const s=this.postRenderFunctions_;if(e)for(let o=0,l=s.length;o<l;++o)s[o](this,e);s.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let s=0,o=this.targetChangeHandlerKeys_.length;s<o;++s)unlistenByKey(this.targetChangeHandlerKeys_[s]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(EventType$1.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(EventType$1.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const s=this.targetElement_.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.unobserve(s.host),this.setSize(void 0)}const e=this.getTarget(),i=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=i,!i)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{i.appendChild(this.viewport_),this.renderer_||(this.renderer_=new CompositeMapRenderer(this)),this.mapBrowserEventHandler_=new MapBrowserEventHandler(this,this.moveTolerance_);for(const l in MapBrowserEventType)this.mapBrowserEventHandler_.addEventListener(MapBrowserEventType[l],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(EventType$1.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(EventType$1.WHEEL,this.boundHandleBrowserEvent_,PASSIVE_EVENT_LISTENERS?{passive:!1}:!1);let s;if(this.keyboardEventTarget_)s=this.keyboardEventTarget_;else{const l=i.getRootNode();s=l instanceof ShadowRoot?l.host:i}this.targetChangeHandlerKeys_=[listen(s,EventType$1.KEYDOWN,this.handleBrowserEvent,this),listen(s,EventType$1.KEYPRESS,this.handleBrowserEvent,this)];const o=i.getRootNode();o instanceof ShadowRoot&&this.resizeObserver_.observe(o.host),this.resizeObserver_.observe(i)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(unlistenByKey(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(unlistenByKey(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=listen(e,ObjectEventType.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=listen(e,EventType$1.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(unlistenByKey),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new GroupEvent("addlayer",e)),this.layerGroupPropertyListenerKeys_=[listen(e,ObjectEventType.PROPERTYCHANGE,this.render,this),listen(e,EventType$1.CHANGE,this.render,this),listen(e,"addlayer",this.handleLayerAdd_,this),listen(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;const e=this.frameState_.layerStatesArray;for(let i=0,s=e.length;i<s;++i){const o=e[i].layer;o.hasRenderer()&&o.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){removeLayerMapProperty(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const i=this.getSize(),s=this.getView(),o=this.frameState_;let l=null;if(i!==void 0&&hasArea(i)&&s&&s.isDef()){const c=s.getHints(this.frameState_?this.frameState_.viewHints:void 0),u=s.getState();if(l={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:getForViewAndSize(u.center,u.resolution,u.rotation,i),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:i,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:u,viewHints:c,wantedTiles:{},mapId:getUid(this),renderTargets:{}},u.nextCenter&&u.nextResolution){const f=isNaN(u.nextRotation)?u.rotation:u.nextRotation;l.nextExtent=getForViewAndSize(u.nextCenter,u.nextResolution,f,i)}}this.frameState_=l,this.renderer_.renderFrame(l),l&&(l.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,l.postRenderFunctions),o&&(!this.previousExtent_||!isEmpty(this.previousExtent_)&&!equals$1(l.extent,this.previousExtent_))&&(this.dispatchEvent(new MapEvent(MapEventType.MOVESTART,this,o)),this.previousExtent_=createOrUpdateEmpty(this.previousExtent_)),this.previousExtent_&&!l.viewHints[ViewHint.ANIMATING]&&!l.viewHints[ViewHint.INTERACTING]&&!equals$1(l.extent,this.previousExtent_)&&(this.dispatchEvent(new MapEvent(MapEventType.MOVEEND,this,l)),clone$1(l.extent,this.previousExtent_))),this.dispatchEvent(new MapEvent(MapEventType.POSTRENDER,this,l)),this.renderComplete_=(this.hasListener(MapEventType.LOADSTART)||this.hasListener(MapEventType.LOADEND)||this.hasListener(EventType.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const i=this.getLayerGroup();i&&this.handleLayerRemove_(new GroupEvent("removelayer",i)),this.set(MapProperty.LAYERGROUP,e)}setSize(e){this.set(MapProperty.SIZE,e)}setTarget(e){this.set(MapProperty.TARGET,e)}setView(e){if(!e||e instanceof View){this.set(MapProperty.VIEW,e);return}this.set(MapProperty.VIEW,new View);const i=this;e.then(function(s){i.setView(new View(s))})}updateSize(){const e=this.getTargetElement();let i;if(e){const o=getComputedStyle(e),l=e.offsetWidth-parseFloat(o.borderLeftWidth)-parseFloat(o.paddingLeft)-parseFloat(o.paddingRight)-parseFloat(o.borderRightWidth),c=e.offsetHeight-parseFloat(o.borderTopWidth)-parseFloat(o.paddingTop)-parseFloat(o.paddingBottom)-parseFloat(o.borderBottomWidth);!isNaN(l)&&!isNaN(c)&&(i=[Math.max(0,l),Math.max(0,c)],!hasArea(i)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&warn("No map visible because the map container's width or height are 0."))}const s=this.getSize();i&&(!s||!equals$2(i,s))&&(this.setSize(i),this.updateViewportSize_(i))}updateViewportSize_(e){const i=this.getView();i&&i.setViewportSize(e)}};function createOptionsInternal(n){let e=null;n.keyboardEventTarget!==void 0&&(e=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const i={},s=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new LayerGroup({layers:n.layers});i[MapProperty.LAYERGROUP]=s,i[MapProperty.TARGET]=n.target,i[MapProperty.VIEW]=n.view instanceof View?n.view:new View;let o;n.controls!==void 0&&(Array.isArray(n.controls)?o=new Collection(n.controls.slice()):(assert(typeof n.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),o=n.controls));let l;n.interactions!==void 0&&(Array.isArray(n.interactions)?l=new Collection(n.interactions.slice()):(assert(typeof n.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),l=n.interactions));let c;return n.overlays!==void 0?Array.isArray(n.overlays)?c=new Collection(n.overlays.slice()):(assert(typeof n.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),c=n.overlays):c=new Collection,{controls:o,interactions:l,keyboardEventTarget:e,overlays:c,values:i}}const mapboxBaseUrl="https://api.mapbox.com";function getMapboxPath(n){const e="mapbox://";return n.indexOf(e)!==0?"":n.slice(e.length)}function normalizeSpriteDefinition(n,e,i){if(typeof n=="string")return[{id:"default",url:normalizeSpriteUrl(n,e,i)}];for(const s of n)s.url=normalizeSpriteUrl(s.url,e,i);return n}function normalizeSpriteUrl(n,e,i){const s=getMapboxPath(n);if(!s)return decodeURI(new URL(n,i).href);const o="sprites/";if(s.indexOf(o)!==0)throw new Error(`unexpected sprites url: ${n}`);const l=s.slice(o.length);return`${mapboxBaseUrl}/styles/v1/${l}/sprite?access_token=${e}`}function normalizeStyleUrl(n,e){const i=getMapboxPath(n);if(!i)return decodeURI(new URL(n,location.href).href);const s="styles/";if(i.indexOf(s)!==0)throw new Error(`unexpected style url: ${n}`);const o=i.slice(s.length);return`${mapboxBaseUrl}/styles/v1/${o}?&access_token=${e}`}const mapboxSubdomains=["a","b","c","d"];function normalizeSourceUrl(n,e,i,s){const o=new URL(n,s||location.href),l=getMapboxPath(n);if(!l)return e?(o.searchParams.has(i)||o.searchParams.set(i,e),[decodeURI(o.href)]):[decodeURI(o.href)];if(l==="mapbox.satellite"){const c=window.devicePixelRatio>=1.5?"@2x":"";return[`https://api.mapbox.com/v4/${l}/{z}/{x}/{y}${c}.webp?access_token=${e}`]}return mapboxSubdomains.map(c=>`https://${c}.tiles.mapbox.com/v4/${l}/{z}/{x}/{y}.vector.pbf?access_token=${e}`)}const emptyObj=Object.freeze({}),functionCacheByStyleId={},filterCacheByStyleId={};let styleId=0;function getStyleId(n){return n.id||(n.id=styleId++),n.id}function getStyleFunctionKey(n,e){return getStyleId(n)+"."+getUid(e)}function getFunctionCache(n){let e=functionCacheByStyleId[n.id];return e||(e={},functionCacheByStyleId[getStyleId(n)]=e),e}function getFilterCache(n){let e=filterCacheByStyleId[n.id];return e||(e={},filterCacheByStyleId[getStyleId(n)]=e),e}function deg2rad(n){return n*Math.PI/180}const defaultResolutions=(function(){const n=[];for(let e=78271.51696402048;n.length<=24;e/=2)n.push(e);return n})();function createCanvas(n,e){if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof OffscreenCanvas<"u")return new OffscreenCanvas(n,e);const i=document.createElement("canvas");return i.width=n,i.height=e,i}function getZoomForResolution(n,e){let i=0;const s=e.length;for(;i<s;++i)if(e[i]<n&&i+1<s){const l=e[i]/e[i+1];return i+Math.log(e[i]/n)/Math.log(l)}return s-1}function getResolutionForZoom(n,e){const i=Math.floor(n),s=Math.pow(2,n-i);return e[i]/s}const pendingRequests={};function fetchResource(n,e,i={},s){if(e in pendingRequests)return s&&(s.url=pendingRequests[e][0].url),pendingRequests[e][1];const o=i.transformRequest&&i.transformRequest(e,n)||e,l=function(f){return delete pendingRequests[e],Promise.reject(new Error("Error fetching source "+e))},c=function(f){return delete pendingRequests[e],f.ok?f.json():Promise.reject(new Error("Error fetching source "+e))},u=toPromise(()=>o).then(f=>f instanceof Response?(s&&(s.url=f.url),c(f)):(f instanceof Request||(f=new Request(f)),f.headers.get("Accept")||f.headers.set("Accept","application/json"),s&&(s.url=f.url),fetch(f).then(c).catch(l))).catch(l);return pendingRequests[e]=[o,u],u}function getGlStyle(n,e){if(typeof n=="string")if(n.trim().startsWith("{"))try{const i=JSON.parse(n);return Promise.resolve(i)}catch(i){return Promise.reject(i)}else return n=normalizeStyleUrl(n,e.accessToken),fetchResource("Style",n,e);else return Promise.resolve(n)}const tilejsonCache={};function getTileJson(n,e,i={}){const s=[e,JSON.stringify(n)].toString();let o=tilejsonCache[s];if(!o||i.transformRequest){let l;i.transformRequest&&(l=(u,f)=>{const g=i.transformRequest&&i.transformRequest(f,"Tiles")||f;if(u instanceof VectorTile$1)u.setLoader((H,Y,ee)=>{const te=function(ne){ne.arrayBuffer().then(Ye=>{const tt=u.getFormat().readFeatures(Ye,{extent:H,featureProjection:ee});u.setFeatures(tt)})};toPromise(()=>g).then(ne=>{if(ne instanceof Response)return te(ne);fetch(ne).then(te).catch(Ye=>u.setState(TileState.ERROR))}).catch(ne=>u.setState(TileState.ERROR))});else{const H=u.getImage();toPromise(()=>g).then(Y=>{if(typeof Y=="string"){H.src=Y;return}const ee=te=>te.blob().then(ne=>{const Ye=URL.createObjectURL(ne);H.addEventListener("load",()=>URL.revokeObjectURL(Ye)),H.addEventListener("error",()=>URL.revokeObjectURL(Ye)),H.src=Ye});if(Y instanceof Response)return ee(Y);fetch(Y).then(ee).catch(te=>u.setState(TileState.ERROR))}).catch(Y=>u.setState(TileState.ERROR))}});const c=n.url;if(c&&!n.tiles){const u=normalizeSourceUrl(c,i.accessToken,i.accessTokenParam||"access_token",e||location.href);if(c.startsWith("mapbox://"))o=Promise.resolve({tileJson:Object.assign({},n,{url:void 0,tiles:u}),tileLoadFunction:l});else{const f={};o=fetchResource("Source",u[0],i,f).then(function(g){return g.tiles=g.tiles.map(function(H){return g.scheme==="tms"&&(H=H.replace("{y}","{-y}")),normalizeSourceUrl(H,i.accessToken,i.accessTokenParam||"access_token",f.url)[0]}),Promise.resolve({tileJson:g,tileLoadFunction:l})})}}else n.tiles?(n=Object.assign({},n,{tiles:n.tiles.map(function(u){return n.scheme==="tms"&&(u=u.replace("{y}","{-y}")),normalizeSourceUrl(u,i.accessToken,i.accessTokenParam||"access_token",e||location.href)[0]})}),o=Promise.resolve({tileJson:Object.assign({},n),tileLoadFunction:l})):o=Promise.reject(new Error("source has no `tiles` nor `url`"));tilejsonCache[s]=o}return o}function drawIconHalo(n,e,i,s){const o=[2*i*e.pixelRatio+e.width,2*i*e.pixelRatio+e.height],l=createCanvas(o[0],o[1]),c=l.getContext("2d");c.drawImage(n,e.x,e.y,e.width,e.height,i*e.pixelRatio,i*e.pixelRatio,e.width,e.height);const u=c.getImageData(0,0,o[0],o[1]);c.globalCompositeOperation="destination-over",c.fillStyle=`rgba(${s.r*255},${s.g*255},${s.b*255},${s.a})`;const f=u.data;for(let g=0,H=u.width;g<H;++g)for(let Y=0,ee=u.height;Y<ee;++Y){const te=(Y*H+g)*4;f[te+3]>0&&c.arc(g,Y,i*e.pixelRatio,0,2*Math.PI)}return c.fill(),l}function smoothstep(n,e,i){const s=Math.max(0,Math.min(1,(i-n)/(e-n)));return s*s*(3-2*s)}function drawSDF(n,e,i){const s=createCanvas(e.width,e.height),o=s.getContext("2d");o.drawImage(n,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const l=o.getImageData(0,0,e.width,e.height),c=l.data;for(let u=0,f=l.width;u<f;++u)for(let g=0,H=l.height;g<H;++g){const Y=(g*f+u)*4,ee=c[Y+3]/255,te=.75,ne=.1,Ye=smoothstep(te-ne,te+ne,ee);Ye>0?(c[Y+0]=Math.round(255*i.r*Ye),c[Y+1]=Math.round(255*i.g*Ye),c[Y+2]=Math.round(255*i.b*Ye),c[Y+3]=Math.round(255*Ye)):c[Y+3]=0}return o.putImageData(l,0,0),s}const hairSpacePool=Array(256).join("");function applyLetterSpacing(n,e){if(e>=.05){let i="";const s=n.split(`
`),o=hairSpacePool.slice(0,Math.round(e/.1));for(let l=0,c=s.length;l<c;++l)l>0&&(i+=`
`),i+=s[l].split("").join(o);return i}return n}let measureContext;function getMeasureContext(){return measureContext||(measureContext=createCanvas(1,1).getContext("2d")),measureContext}function measureText(n,e){return getMeasureContext().measureText(n).width+(n.length-1)*e}const measureCache={};function wrapText(n,e,i,s){if(n.indexOf(`
`)!==-1){const c=n.split(`
`),u=[];for(let f=0,g=c.length;f<g;++f)u.push(wrapText(c[f],e,i,s));return u.join(`
`)}const o=i+","+e+","+n+","+s;let l=measureCache[o];if(!l){const c=n.split(" ");if(c.length>1){const u=getMeasureContext();u.font=e;const g=u.measureText("M").width*i;let H="";const Y=[];for(let ee=0,te=c.length;ee<te;++ee){const ne=c[ee],Ye=H+(H?" ":"")+ne;measureText(Ye,s)<=g?H=Ye:(H&&Y.push(H),H=ne)}H&&Y.push(H);for(let ee=0,te=Y.length;ee<te&&te>1;++ee){const ne=Y[ee];if(measureText(ne,s)<g*.35){const Ye=ee>0?measureText(Y[ee-1],s):1/0,xe=ee<te-1?measureText(Y[ee+1],s):1/0;Y.splice(ee,1),te-=1,Ye<xe?(Y[ee-1]+=" "+ne,ee-=1):Y[ee]=ne+" "+Y[ee]}}for(let ee=0,te=Y.length-1;ee<te;++ee){const ne=Y[ee],Ye=Y[ee+1];if(measureText(ne,s)>g*.7&&measureText(Ye,s)<g*.6){const xe=ne.split(" "),tt=xe.pop();measureText(tt,s)<g*.2&&(Y[ee]=xe.join(" "),Y[ee+1]=tt+" "+Ye),te-=1}}l=Y.join(`
`)}else l=n;l=applyLetterSpacing(l,s),measureCache[o]=l}return l}const fontFamilyRegEx=/font-family: ?([^;]*);/,stripQuotesRegEx=/("|')/g;let loadedFontFamilies;function hasFontFamily(n){if(!loadedFontFamilies){loadedFontFamilies={};const e=document.styleSheets;for(let i=0,s=e.length;i<s;++i){const o=e[i];try{const l=o.rules||o.cssRules;if(l)for(let c=0,u=l.length;c<u;++c){const f=l[c];if(f.type==5){const g=f.cssText.match(fontFamilyRegEx);loadedFontFamilies[g[1].replace(stripQuotesRegEx,"")]=!0}}}catch{}}}return n in loadedFontFamilies}const processedFontFamilies={};function getFonts(n,e="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){const i=n.toString();if(i in processedFontFamilies)return processedFontFamilies[i];const s=[];for(let o=0,l=n.length;o<l;++o){n[o]=n[o].replace("Arial Unicode MS","Arial");const c=n[o],u=mb2css(c,1);registerFont(u);const f=u.split(" ");s.push([f.slice(3).join(" ").replace(/"/g,""),f[1],f[0]])}for(let o=0,l=s.length;o<l;++o){const c=s[o],u=c[0];if(!hasFontFamily(u)&&checkedFonts.get(`${c[2]}
${c[1]} 
${u}`)!==100){const f=e.replace("{font-family}",u.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",u.replace(/ /g,"+")).replace("{fontweight}",c[1]).replace("{-fontstyle}",c[2].replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",c[2]);if(!document.querySelector('link[href="'+f+'"]')){const g=document.createElement("link");g.href=f,g.rel="stylesheet",document.head.appendChild(g)}}}return processedFontFamilies[i]=n,n}const types$1={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},anchor={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},expressionData=function(n,e){const i=createPropertyExpression(n,e);if(i.result==="error")throw new Error(i.value.map(s=>`${s.key}: ${s.message}`).join(", "));return i.value},cameraObj={zoom:0,distanceFromCenter:0};CompoundExpression.register(expressions$1,{...CompoundExpression.definitions,pitch:[{kind:"number"},[],n=>cameraObj.pitch||90],"distance-from-center":[{kind:"number"},[],n=>cameraObj.distanceFromCenter||0]});let renderFeatureCoordinates,renderFeature;function getValue(n,e,i,s,o,l){const c=n.id;o||(o={},console.warn("No functionCache provided to getValue()")),o[c]||(o[c]={});const u=o[c];if(!u[i]){let f=(n[e]||emptyObj)[i];const g=v8[`${e}_${n.type}`][i];f===void 0&&(f=g.default);let H=isExpression(f);if(!H&&isFunction$1(f)&&(f=convertFunction(f,g),H=!0),H){const Y=expressionData(f,g);u[i]=Y.evaluate.bind(Y)}else g.type=="color"&&(f=Color.parse(f)),u[i]=function(){return f}}return u[i](cameraObj,s,l)}function getDeclutterMode(n,e,i,s){return getValue(n,"layout",`${i}-allow-overlap`,e,s)?getValue(n,"layout",`${i}-ignore-placement`,e,s)?"none":"obstacle":"declutter"}function evaluateFilter(n,e,i,s){if(s||console.warn("No filterCache provided to evaluateFilter()"),!(n in s))try{s[n]=featureFilter(e).filter}catch(o){console.warn("Filter will evaluate to false: "+o.message),s[n]=function(){return!1}}return s[n](cameraObj,i)}function colorWithOpacity(n,e){if(n){if(n.a===0||e===0)return;const i=n.a;return e=e===void 0?1:e,i===0?"transparent":"rgba("+Math.round(n.r*255/i)+","+Math.round(n.g*255/i)+","+Math.round(n.b*255/i)+","+i*e+")"}return n}const templateRegEx=/\{[^{}}]*\}/g;function fromTemplate(n,e){return n.replace(templateRegEx,function(i){return e[i.slice(1,-1)]||""})}function getSpriteImageForIcon(n,e){let i=n.split(":")[0];return i===n&&(i="default"),e[i]}const styleFunctionArgs={};function stylefunction(n,e,i,s=defaultResolutions,o=void 0,l=void 0,c=void 0,u=void 0){if(typeof e=="string"&&(e=JSON.parse(e)),e.version!=8)throw new Error("glStyle version 8 required.");styleFunctionArgs[getStyleFunctionKey(e,n)]=Array.from(arguments);const f={};(typeof l=="string"||l instanceof Request||l instanceof Response||l instanceof Promise)&&(l={default:l});for(const nt in l){const at=l[nt];toPromise(()=>at).then(async st=>{let ot;if(typeof Image<"u"){const ut=new Image;if(typeof st=="string")ut.crossOrigin="anonymous",ut.src=st;else{let ht;st instanceof Request?ht=await fetch(st):st instanceof Response&&(ht=st);const dt=await ht.blob();ot=URL.createObjectURL(dt),ut.src=ot}ut.addEventListener("load",function ht(){ut.removeEventListener("load",ht),f[nt]={image:ut,size:[ut.width,ut.height]},n.changed(),ot&&URL.revokeObjectURL(ot)}),ut.addEventListener("error",function ht(){URL.revokeObjectURL(ot),ut.removeEventListener("error",ht)})}else if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){const ut=self;ut.postMessage({action:"loadImage",src:st}),ut.addEventListener("message",function(dt){dt.data.action==="imageLoaded"&&dt.data.src===st&&(f[nt]={image:dt.data.image,size:[dt.data.image.width,dt.data.image.height]})})}})}const g=derefLayers(e.layers),H={},Y=[],ee={},te={},ne=getFunctionCache(e),Ye=getFilterCache(e);let xe;for(let nt=0,at=g.length;nt<at;++nt){const st=g[nt],ot=st.id;if(typeof i=="string"&&st.source==i||Array.isArray(i)&&i.indexOf(ot)!==-1){const ut=st["source-layer"];if(xe){if(st.source!==xe)throw new Error(`Layer "${ot}" does not use source "${xe}`)}else{xe=st.source;const dt=e.sources[xe];if(!dt)throw new Error(`Source "${xe}" is not defined`);const pt=dt.type;if(pt!=="vector"&&pt!=="geojson")throw new Error(`Source "${xe}" is not of type "vector" or "geojson", but "${pt}"`)}let ht=H[ut];ht||(ht=[],H[ut]=ht),ht.push({layer:st,index:nt}),Y.push(ot)}}const tt=new Stroke,et=new Fill,it=[],rt=function(nt,at,st){const ot=nt.getProperties(),ut=H[ot.layer];if(!ut)return;let ht=s.indexOf(at);ht==-1&&(ht=getZoomForResolution(at,s)),cameraObj.zoom=ht,cameraObj.distanceFromCenter=0;const dt=nt.getGeometry(),pt=types$1[dt.getType()],yt=n.get("map");if(yt&&yt instanceof Map$1&&pt===1){const Rt=yt.getSize();if(Rt){const Lt=yt.getView().getCenter(),Gt=getCenter(dt.getExtent());cameraObj.distanceFromCenter=distance(Lt,Gt)/at/Rt[1]}}const mt={id:nt.getId(),properties:ot,type:pt},St=n.get("mapbox-featurestate")[nt.getId()];let wt=-1;for(let Rt=0,Lt=ut.length;Rt<Lt;++Rt){const Gt=ut[Rt],vt=Gt.layer,Et=vt.id;if(st!==void 0&&st!==Et)continue;const _t=vt.layout||emptyObj,Ct=vt.paint||emptyObj;if(_t.visibility==="none"||"minzoom"in vt&&ht<vt.minzoom||"maxzoom"in vt&&ht>=vt.maxzoom)continue;const ct=vt.filter;if(!ct||evaluateFilter(Et,ct,mt,Ye)){let ft,bt,Ft,Bt,Xt,Ot;const It=Gt.index;if(pt==3&&(vt.type=="fill"||vt.type=="fill-extrusion"))if(bt=getValue(vt,"paint",vt.type+"-opacity",mt,ne,St),vt.type+"-pattern"in Ct){const Mt=getValue(vt,"paint",vt.type+"-pattern",mt,ne,St);if(Mt){const Nt=typeof Mt=="string"?fromTemplate(Mt,ot):Mt.toString(),Wt=getSpriteImageForIcon(Nt,f);if(o&&o[Nt]&&Wt){++wt,Ot=it[wt],(!Ot||!Ot.getFill()||Ot.getStroke()||Ot.getText())&&(Ot=new Style$1({fill:new Fill}),it[wt]=Ot),Ft=Ot.getFill(),Ot.setZIndex(It);const Vt=Nt+"."+bt;let Kt=te[Vt];if(!Kt){const Zt=o[Nt],Qt=createCanvas(Zt.width,Zt.height),ri=Qt.getContext("2d");ri.globalAlpha=bt,ri.drawImage(Wt.image,Zt.x,Zt.y,Zt.width,Zt.height,0,0,Zt.width,Zt.height),Kt=ri.createPattern(Qt,"repeat"),te[Vt]=Kt}Ft.setColor(Kt)}}}else ft=colorWithOpacity(getValue(vt,"paint",vt.type+"-color",mt,ne,St),bt),vt.type+"-outline-color"in Ct&&(Xt=colorWithOpacity(getValue(vt,"paint",vt.type+"-outline-color",mt,ne,St),bt)),Xt||(Xt=ft),(ft||Xt)&&(++wt,Ot=it[wt],(!Ot||ft&&!Ot.getFill()||!ft&&Ot.getFill()||Xt&&!Ot.getStroke()||!Xt&&Ot.getStroke()||Ot.getText())&&(Ot=new Style$1({fill:ft?new Fill:void 0,stroke:Xt?new Stroke:void 0}),it[wt]=Ot),ft&&(Ft=Ot.getFill(),Ft.setColor(ft)),Xt&&(Bt=Ot.getStroke(),Bt.setColor(Xt),Bt.setWidth(.5)),Ot.setZIndex(It));if(pt!=1&&vt.type=="line"){"line-pattern"in Ct?ft=void 0:ft=colorWithOpacity(getValue(vt,"paint","line-color",mt,ne,St),getValue(vt,"paint","line-opacity",mt,ne,St));const Mt=getValue(vt,"paint","line-width",mt,ne,St);ft&&Mt>0&&(++wt,Ot=it[wt],(!Ot||!Ot.getStroke()||Ot.getFill()||Ot.getText())&&(Ot=new Style$1({stroke:new Stroke}),it[wt]=Ot),Bt=Ot.getStroke(),Bt.setLineCap(getValue(vt,"layout","line-cap",mt,ne,St)),Bt.setLineJoin(getValue(vt,"layout","line-join",mt,ne,St)),Bt.setMiterLimit(getValue(vt,"layout","line-miter-limit",mt,ne,St)),Bt.setColor(ft),Bt.setWidth(Mt),Bt.setLineDash(Ct["line-dasharray"]?getValue(vt,"paint","line-dasharray",mt,ne,St).map(function(Nt){return Nt*Mt}):null),Ot.setZIndex(It))}let xt=!1,Tt=null,Ht=0,Dt,qt,kt;if((pt==1||pt==2)&&"icon-image"in _t){const Mt=getValue(vt,"layout","icon-image",mt,ne,St);if(Mt){Dt=typeof Mt=="string"?fromTemplate(Mt,ot):Mt.toString();let Nt;const Wt=u?u(n,Dt):void 0,Vt=getSpriteImageForIcon(Dt,f);if(o&&o[Dt]&&Vt||Wt){const Kt=getValue(vt,"layout","icon-rotation-alignment",mt,ne,St);if(pt==2){const Zt=nt.getGeometry();if(Zt.getFlatMidpoint||Zt.getFlatMidpoints){const Qt=Zt.getExtent();if(Math.sqrt(Math.max(Math.pow((Qt[2]-Qt[0])/at,2),Math.pow((Qt[3]-Qt[1])/at,2)))>150){const ai=Zt.getType()==="MultiLineString"?Zt.getFlatMidpoints():Zt.getFlatMidpoint();if(renderFeature||(renderFeatureCoordinates=[NaN,NaN],renderFeature=new RenderFeature("Point",renderFeatureCoordinates,[],2,{},void 0)),Nt=renderFeature,renderFeatureCoordinates[0]=ai[0],renderFeatureCoordinates[1]=ai[1],getValue(vt,"layout","symbol-placement",mt,ne,St)==="line"&&Kt==="map"){const ui=Zt.getStride(),pi=Zt.getFlatCoordinates();for(let oi=0,ei=pi.length-ui;oi<ei;oi+=ui){const li=pi[oi],si=pi[oi+1],ni=pi[oi+ui],fi=pi[oi+ui+1],Ei=Math.min(li,ni),mi=Math.max(li,ni),Ci=ai[0],di=ai[1],xi=(fi-si)*(Ci-li)-(ni-li)*(di-si);if(Math.abs(xi)<.001&&Ci<=mi&&Ci>=Ei){Ht=Math.atan2(si-fi,ni-li);break}}}}}}if(pt!==2||Nt){const Zt=getValue(vt,"layout","icon-size",mt,ne,St),Qt=Ct["icon-color"]!==void 0?getValue(vt,"paint","icon-color",mt,ne,St):null;if(!Qt||Qt.a!==0){const ri=getValue(vt,"paint","icon-halo-color",mt,ne,St),ai=getValue(vt,"paint","icon-halo-width",mt,ne,St);let hi=`${Dt}.${Zt}.${ai}.${ri}`;if(Qt!==null&&(hi+=`.${Qt}`),qt=ee[hi],!qt){const ui=getDeclutterMode(vt,mt,"icon",ne);let pi;"icon-offset"in _t&&(pi=getValue(vt,"layout","icon-offset",mt,ne,St).slice(0),pi[0]*=Zt,pi[1]*=-Zt);let oi=Qt?[Qt.r*255,Qt.g*255,Qt.b*255,Qt.a]:void 0;if(Wt){const ei={color:oi,rotateWithView:Kt==="map",displacement:pi,declutterMode:ui,scale:Zt};typeof Wt=="string"?ei.src=Wt:(ei.img=Wt,ei.imgSize=[Wt.width,Wt.height]),qt=new Icon(ei)}else{const ei=o[Dt];let li,si,ni;if(ai)ei.sdf?(li=drawIconHalo(drawSDF(Vt.image,ei,Qt||[0,0,0,1]),{x:0,y:0,width:ei.width,height:ei.height,pixelRatio:ei.pixelRatio},ai,ri),oi=void 0):li=drawIconHalo(Vt.image,ei,ai,ri);else{if(ei.sdf&&!Vt.unSDFed){const fi=drawSDF(Vt.image,{x:0,y:0,width:Vt.size[0],height:Vt.size[1]},{r:1,g:1,b:1});Vt.image=fi,Vt.unSDFed=!0}li=Vt.image,si=[ei.width,ei.height],ni=[ei.x,ei.y]}qt=new Icon({color:oi,img:li,imgSize:Vt.size,size:si,offset:ni,rotateWithView:Kt==="map",scale:Zt/ei.pixelRatio,displacement:pi,declutterMode:ui})}ee[hi]=qt}}qt&&(++wt,Ot=it[wt],(!Ot||!Ot.getImage()||Ot.getFill()||Ot.getStroke())&&(Ot=new Style$1,it[wt]=Ot),Ot.setGeometry(Nt),qt.setRotation(Ht+deg2rad(getValue(vt,"layout","icon-rotate",mt,ne,St))),qt.setOpacity(getValue(vt,"paint","icon-opacity",mt,ne,St)),qt.setAnchor(anchor[getValue(vt,"layout","icon-anchor",mt,ne,St)]),Ot.setImage(qt),Tt=Ot.getText(),Ot.setText(void 0),Ot.setZIndex(It),xt=!0,kt=!1)}else kt=!0}}}if(pt==1&&vt.type==="circle"){++wt,Ot=it[wt],(!Ot||!Ot.getImage()||Ot.getFill()||Ot.getStroke())&&(Ot=new Style$1,it[wt]=Ot);const Mt="circle-radius"in Ct?getValue(vt,"paint","circle-radius",mt,ne,St):5,Nt=colorWithOpacity(getValue(vt,"paint","circle-stroke-color",mt,ne,St),getValue(vt,"paint","circle-stroke-opacity",mt,ne,St)),Wt=getValue(vt,"paint","circle-translate",mt,ne,St),Vt=colorWithOpacity(getValue(vt,"paint","circle-color",mt,ne,St),getValue(vt,"paint","circle-opacity",mt,ne,St)),Kt=getValue(vt,"paint","circle-stroke-width",mt,ne,St),Zt=Mt+"."+Nt+"."+Vt+"."+Kt+"."+Wt[0]+"."+Wt[1];qt=ee[Zt],qt||(qt=new CircleStyle({radius:Mt,displacement:[Wt[0],-Wt[1]],stroke:Nt&&Kt>0?new Stroke({width:Kt,color:Nt}):void 0,fill:Vt?new Fill({color:Vt}):void 0,declutterMode:"none"}),ee[Zt]=qt),Ot.setImage(qt),Tt=Ot.getText(),Ot.setText(void 0),Ot.setGeometry(void 0),Ot.setZIndex(It),xt=!0}let $t,Ut,zt,Yt,Jt,Pt;if("text-field"in _t){Yt=Math.round(getValue(vt,"layout","text-size",mt,ne,St));const Mt=getValue(vt,"layout","text-font",mt,ne,St);zt=getValue(vt,"layout","text-line-height",mt,ne,St),Ut=mb2css(c?c(Mt,e.metadata?e.metadata["ol:webfonts"]:void 0):Mt,Yt,zt),Ut.includes("sans-serif")||(Ut+=",sans-serif"),Jt=getValue(vt,"layout","text-letter-spacing",mt,ne,St),Pt=getValue(vt,"layout","text-max-width",mt,ne,St);const Nt=getValue(vt,"layout","text-field",mt,ne,St);typeof Nt=="object"&&Nt.sections?Nt.sections.length===1?$t=Nt.toString():$t=Nt.sections.reduce((Wt,Vt,Kt)=>{const Zt=Vt.fontStack?Vt.fontStack.split(","):Mt,Qt=mb2css(c?c(Zt):Zt,Yt*(Vt.scale||1),zt);let ri=Vt.text;if(ri===`
`)return Wt.push(`
`,""),Wt;if(pt==2)return Wt.push(applyLetterSpacing(ri,Jt),Qt),Wt;ri=wrapText(ri,Qt,Pt,Jt).split(`
`);for(let ai=0,hi=ri.length;ai<hi;++ai)ai>0&&Wt.push(`
`,""),Wt.push(ri[ai],Qt);return Wt},[]):$t=fromTemplate(Nt,ot).trim(),bt=getValue(vt,"paint","text-opacity",mt,ne,St)}if($t&&bt&&!kt){xt||(++wt,Ot=it[wt],(!Ot||!Ot.getText()||Ot.getFill()||Ot.getStroke())&&(Ot=new Style$1,it[wt]=Ot),Ot.setImage(void 0),Ot.setGeometry(void 0));const Mt=getDeclutterMode(vt,mt,"text",ne);Ot.getText()||Ot.setText(Tt),Tt=Ot.getText(),(!Tt||"getDeclutterMode"in Tt&&Tt.getDeclutterMode()!==Mt)&&(Tt=new Text({padding:[2,2,2,2],declutterMode:Mt}),Ot.setText(Tt));const Nt=getValue(vt,"layout","text-transform",mt,ne,St);Nt=="uppercase"?$t=Array.isArray($t)?$t.map((ni,fi)=>fi%2?ni:ni.toUpperCase()):$t.toUpperCase():Nt=="lowercase"&&($t=Array.isArray($t)?$t.map((ni,fi)=>fi%2?ni:ni.toLowerCase()):$t.toLowerCase());const Wt=Array.isArray($t)?$t:pt==2?applyLetterSpacing($t,Jt):wrapText($t,Ut,Pt,Jt);if(Tt.setText(Wt),Tt.setFont(Ut),Tt.setRotation(deg2rad(getValue(vt,"layout","text-rotate",mt,ne,St))),typeof Tt.setKeepUpright=="function"){const ni=getValue(vt,"layout","text-keep-upright",mt,ne,St);Tt.setKeepUpright(ni)}const Vt=getValue(vt,"layout","text-anchor",mt,ne,St),Kt=xt||pt==1?"point":getValue(vt,"layout","symbol-placement",mt,ne,St);let Zt;if(Kt==="line-center"?(Tt.setPlacement("line"),Zt="center"):Tt.setPlacement(Kt),Kt==="line"&&typeof Tt.setRepeat=="function"){const ni=getValue(vt,"layout","symbol-spacing",mt,ne,St);Tt.setRepeat(ni*2)}Tt.setOverflow(Kt==="point");let Qt=getValue(vt,"paint","text-halo-width",mt,ne,St);const ri=getValue(vt,"layout","text-offset",mt,ne,St),ai=getValue(vt,"paint","text-translate",mt,ne,St);let hi=0,ui=0;if(Kt=="point"){Zt="center",Vt.indexOf("left")!==-1?(Zt="left",ui=Qt):Vt.indexOf("right")!==-1&&(Zt="right",ui=-Qt);const ni=getValue(vt,"layout","text-rotation-alignment",mt,ne,St);Tt.setRotateWithView(ni=="map")}else Tt.setMaxAngle(deg2rad(getValue(vt,"layout","text-max-angle",mt,ne,St))*$t.length/Wt.length),Tt.setRotateWithView(!1);Tt.setTextAlign(Zt);let pi="middle";Vt.indexOf("bottom")==0?(pi="bottom",hi=-Qt-.5*(zt-1)*Yt):Vt.indexOf("top")==0&&(pi="top",hi=Qt+.5*(zt-1)*Yt),Tt.setTextBaseline(pi);const oi=getValue(vt,"layout","text-justify",mt,ne,St);Tt.setJustify(oi==="auto"?void 0:oi),Tt.setOffsetX(ri[0]*Yt+ui+ai[0]),Tt.setOffsetY(ri[1]*Yt+hi+ai[1]),et.setColor(colorWithOpacity(getValue(vt,"paint","text-color",mt,ne,St),bt)),Tt.setFill(et);const ei=colorWithOpacity(getValue(vt,"paint","text-halo-color",mt,ne,St),bt);if(ei&&Qt>0){tt.setColor(ei),Qt*=2;const ni=.5*Yt;tt.setWidth(Qt<=ni?Qt:ni),Tt.setStroke(tt)}else Tt.setStroke(void 0);const li=getValue(vt,"layout","text-padding",mt,ne,St),si=Tt.getPadding();li!==si[0]&&(si[0]=li,si[1]=li,si[2]=li,si[3]=li),Ot.setZIndex(It)}}}if(wt>-1)return it.length=wt+1,it};return n.setStyle(rt),n.set("mapbox-layers",Y),n.set("mapbox-source",xe),n.set("mapbox-featurestate",n.get("mapbox-featurestate")||{}),rt}function getTileResolutions(n,e=512){return n.getExtent()?createXYZ({extent:n.getExtent(),tileSize:e,maxZoom:22}).getResolutions():defaultResolutions}function completeOptions(n,e){return e.accessToken||(e=Object.assign({},e),new URL(n).searchParams.forEach((s,o)=>{e.accessToken=s,e.accessTokenParam=o})),e}function applyStyle(n,e,i="",s={},o=void 0){let l,c,u,f,g=!0;return typeof i!="string"&&!Array.isArray(i)?(u=i,f=u.source||u.layers,s=u):f=i,typeof s=="string"?(l=s,u={}):(l=s.styleUrl,u=s),u.updateSource===!1&&(g=!1),o||(o=u.resolutions),!l&&typeof e=="string"&&!e.trim().startsWith("{")&&(l=e),l&&(l=l.startsWith("data:")?location.href:normalizeStyleUrl(l,u.accessToken),u=completeOptions(l,u)),new Promise(function(H,Y){getGlStyle(e,u).then(function(ee){if(ee.version!=8)return Y(new Error("glStyle version 8 required."));if(!(n instanceof VectorLayer||n instanceof VectorTileLayer))return Y(new Error("Can only apply to VectorLayer or VectorTileLayer"));const te=n instanceof VectorTileLayer?"vector":"geojson";if(f?Array.isArray(f)?c=ee.layers.find(function(rt){return rt.id===f[0]}).source:c=f:(c=ee.layers.find(function(rt){return rt.source&&ee.sources[rt.source].type===te}).source,f=c),!c)return Y(new Error(`No ${te} source found in the glStyle.`));function ne(){if(!g)return Promise.resolve();if(n instanceof VectorTileLayer)return setupVectorSource(ee.sources[c],l,u).then(function(st){const ot=n.getSource();ot?st!==ot&&(ot.setTileUrlFunction(st.getTileUrlFunction()),typeof ot.setUrls=="function"&&typeof st.getUrls=="function"&&ot.setUrls(st.getUrls()),ot.format_||(ot.format_=st.format_),ot.getAttributions()||ot.setAttributions(st.getAttributions()),ot.getTileLoadFunction()===defaultLoadFunction&&ot.setTileLoadFunction(st.getTileLoadFunction()),equivalent$1(ot.getProjection(),st.getProjection())&&(ot.tileGrid=st.getTileGrid())):n.setSource(st);const ut=n.getSource().getTileGrid();!isFinite(n.getMaxResolution())&&!isFinite(n.getMinZoom())&&ut.getMinZoom()>0&&n.setMaxResolution(getResolutionForZoom(Math.max(0,ut.getMinZoom()-1e-12),ut.getResolutions()))});const rt=ee.sources[c];let nt=n.getSource();(!nt||nt.get("mapbox-source")!==rt)&&(nt=setupGeoJSONSource(rt,l,u));const at=n.getSource();return at?nt!==at&&(at.getAttributions()||at.setAttributions(nt.getAttributions()),at.format_||(at.format_=nt.getFormat()),at.url_=nt.getUrl()):n.setSource(nt),Promise.resolve()}let Ye,xe;const tt={},et={};function it(){if(!xe&&(!ee.sprite||tt)){if(u.projection&&!o){const nt=get$3(u.projection).getUnits();nt!=="m"&&(o=defaultResolutions.map(at=>at/METERS_PER_UNIT$1[nt]))}xe=stylefunction(n,ee,f,o,tt,et,(rt,nt=u.webfonts)=>getFonts(rt,nt),u.getImage),n.getStyle()?ne().then(H).catch(Y):Y(new Error(`Nothing to show for source [${c}]`))}else xe?(n.setStyle(xe),ne().then(H).catch(Y)):Y(new Error("Something went wrong trying to apply style."))}if(ee.sprite){const rt=normalizeSpriteDefinition(ee.sprite,u.accessToken,l||location.href);Ye=window.devicePixelRatio>=1.5?.5:1;const nt=Ye==.5?"@2x":"";Promise.all(rt.map(function(at){const st=new URL(at.url);let ot=st.origin+st.pathname+nt+".json"+st.search;return new Promise(function(ut,ht){fetchResource("Sprite",ot,u).then(ut).catch(function(dt){ot=st.origin+st.pathname+".json"+st.search,fetchResource("Sprite",ot,u).then(ut).catch(ht)})}).then(function(ut){ut===void 0&&Y(new Error("No sprites found."));let ht;if(ht=st.origin+st.pathname+nt+".png"+st.search,u.transformRequest){const dt=u.transformRequest(ht,"SpriteImage")||ht;(dt instanceof Request||dt instanceof Promise)&&(ht=dt)}et[at.id]=ht;for(const dt in ut){const pt=at.id=="default"?dt:`${at.id}:${dt}`;tt[pt]=ut[dt]}}).catch(function(ut){Y(new Error(`Sprites cannot be loaded: ${ot}: ${ut.message}`))})})).then(it).catch(Y)}else it()}).catch(Y)})}function extentFromTileJSON(n,e){const i=n.bounds;if(i){const s=fromLonLat([i[0],i[1]],e),o=fromLonLat([i[2],i[3]],e);return[s[0],s[1],o[0],o[1]]}return get$3(e).getExtent()}function sourceOptionsFromTileJSON(n,e,i){const s=new TileJSON({tileJSON:e,tileSize:n.tileSize||e.tileSize||512}),o=s.getTileJSON(),l=s.getTileGrid(),c=get$3(i.projection||"EPSG:3857"),u=extentFromTileJSON(o,c),f=c.getExtent(),g=o.minzoom||0,H=o.maxzoom||22,Y={attributions:s.getAttributions(),projection:c,tileGrid:new TileGrid({origin:f?getTopLeft(f):l.getOrigin(0),extent:u||l.getExtent(),minZoom:g,resolutions:getTileResolutions(c,e.tileSize).slice(0,H+1),tileSize:l.getTileSize(0)})};return Array.isArray(o.tiles)?Y.urls=o.tiles:Y.url=o.tiles,Y}function setupVectorSource(n,e,i){return new Promise(function(s,o){getTileJson(n,e,i).then(function({tileJson:l,tileLoadFunction:c}){const u=sourceOptionsFromTileJSON(n,l,i);u.tileLoadFunction=c,u.format=new MVT;const f=new VectorTile(u);f.set("mapbox-source",n),s(f)}).catch(o)})}function getBboxTemplate(n){return`{bbox-${(n?n.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function setupGeoJSONSource(n,e,i){const s=i.projection?new GeoJSON$1({dataProjection:i.projection}):new GeoJSON$1,o=n.data,l={};if(typeof o=="string"){const[u]=normalizeSourceUrl(o,i.accessToken,i.accessTokenParam||"access_token",e||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(u)){const g=(Y,ee,te)=>{const ne=getBboxTemplate(te);return u.replace(ne,`${Y.join(",")}`)},H=new VectorSource({attributions:n.attribution,format:s,loader:(Y,ee,te,ne,Ye)=>{const xe=typeof g=="function"?g(Y,ee,te):g;fetchResource("GeoJSON",xe,i).then(tt=>{const et=H.getFormat().readFeatures(tt,{featureProjection:te});H.addFeatures(et),ne(et)}).catch(tt=>{H.removeLoadedExtent(Y),Ye()})},strategy:bbox});return H.set("mapbox-source",n),H}const f=new VectorSource({attributions:n.attribution,format:s,url:u,loader:(g,H,Y,ee,te)=>{fetchResource("GeoJSON",u,i).then(ne=>{const Ye=f.getFormat().readFeatures(ne,{featureProjection:Y});f.addFeatures(Ye),ee(Ye)}).catch(ne=>{f.removeLoadedExtent(g),te()})}});return f}l.features=s.readFeatures(o,{featureProjection:"EPSG:3857"});const c=new VectorSource(Object.assign({attributions:n.attribution,format:s},l));return c.set("mapbox-source",n),c}function updateMapboxLayer(n,e){const i=n.get("mapbox-style"),s=i.layers,o=s.findIndex(function(u){return u.id===e.id});if(o===-1)throw new Error(`Layer with id "${e.id}" not found.`);if(s[o].source!==e.source)throw new Error("Updated layer and previous version must use the same source.");delete getFunctionCache(i)[e.id],delete getFilterCache(i)[e.id],s[o]=e;const c=styleFunctionArgs[getStyleFunctionKey(n.get("mapbox-style"),getLayer(n,e.id))];c?stylefunction.apply(void 0,c):getLayer(n,e.id).changed()}function getLayer(n,e){const i=n.getLayers().getArray();for(let s=0,o=i.length;s<o;++s){const l=i[s].get("mapbox-layers");if(l&&l.indexOf(e)!==-1)return i[s]}}class LayerMapBox extends VectorTileLayer{constructor(e,i){if(!e.layer)throw new Error("ERROR PARAM_MISSING : layer");if(typeof e.layer!="string")throw new Error("ERROR WRONG TYPE : layer");typeof e.ssl>"u"&&(e.ssl=!0);var s=e.ssl===!1?"http://":"https://",o=e.configuration;if(!o){if(!Config.isConfigLoaded())throw new Error("ERROR : contract key configuration has to be loaded to load Geoportal layers.");var l=e.layer+"$GEOPORTAIL:GPP:TMS";if(o=Config.configuration.getLayerConf(l),!o)throw new Error("ERROR : Layer ID not found into the catalogue !?")}for(var c=null,u="",f=e.style,g=0;g<o.styles.length;g++){var H=o.styles[g];if(f&&H.name===f){c=H.url,u=H.title;break}else if(!f&&H.current){f=H.name,c=H.url,u=H.title;break}}if(!c)throw new Error("ERROR : Style URL not found !?");c.replace(/(http|https):\/\//,s);var Y=new VectorTile({state:"loading",format:new MVT});Y._originators=o.originators,Y._legends=o.legends,Y._metadata=o.metadata,Y._description=o.description,Y._title=o.title+" ("+u+")",Y._quicklookUrl=o.quicklookUrl;var ee={source:Y};return Helper.mergeParams(ee,i),e.olParams&&!o.originators&&(Y._originators=e.olParams.attributions),super(ee),this.name=e.layer,this.service="TMS",this.protocol=s,this.sourceId=e.source,this.styleUrl=c,this.styleName=f,this.config=o,this.setStyleMapBox(),this}setStyleMapBox(){var e=this;fetch(this.styleUrl,{credentials:"same-origin"}).then(function(i){i.ok&&i.json().then(function(s){e.onStyleMapBoxLoad(s)})}).catch(function(i){e.onStyleMapBoxError(i)})}onStyleMapBoxLoad(e){this.sourceId||(this.sourceId=Object.keys(e.sources)[0]);var i=e.sources[this.sourceId];if(!i){this.onStyleMapBoxError({message:"ERROR : Source ID not found !? !"});return}if(i.type!=="vector"){this.onStyleMapBoxError({message:"ERROR : Source TYPE not permitted !"});return}var s=this.getSource();if(i.url){i.url.replace(/(http|https):\/\//,this.protocol);var o=new TileJSON({url:i.url}),l=this,c=o.on("change",function(){if(o.getState()==="ready"){var f=o.getTileJSON();if(!f)return;l.set("mapbox-extensions",f);for(var g=Array.isArray(f.tiles)?f.tiles:[f.tiles],H=0;H<i.tiles.length;H++)g[H].replace(/(http|https):\/\//,this.protocol);s.setUrls(g),unByKey(c)}})}if(i.tiles){for(var u=0;u<i.tiles.length;u++)i.tiles[u].replace(/(http|https):\/\//,this.protocol);s.setUrls(i.tiles)}applyStyle(this,e,this.sourceId).then(()=>{s.setState("ready"),this.set("mapbox-styles",e)}).then(()=>{this.dispatchEvent({type:"mapbox:style:loaded",style:this.styleUrl,name:this.styleName})}).catch(f=>{this.onStyleMapBoxError(f)})}onStyleMapBoxError(e){var i=this.getSource();i.setState("error"),console.error(e.message)}getConfiguration(){return this.config}getLegends(){return this.getSource()._legends}getMetadata(){return this.getSource()._metadata}getDescription(){return this.getSource()._description}getTitle(){return this.getSource()._title}getQuicklookUrl(){return this.getSource()._quicklookUrl}getOriginators(){return this.getSource()._originators}}window.ol&&window.ol.layer&&(window.ol.layer.GeoportalMapBox=LayerMapBox);const exceptions=["GPoverviewMap","GPfullScreen"];function getSameSideOpenedPanel(n,e){var i=[...exceptions,e],s=[];if(n&&n.includes("left")){var o=document.getElementById("position-container-bottom-left"),l=document.getElementById("position-container-top-left");s=[...o.children,...l.children]}if(n&&n.includes("right")){var c=document.getElementById("position-container-bottom-right"),u=document.getElementById("position-container-top-right");s=[...c.children,...u.children]}return s.filter(f=>{var g=f.id.match(/(\w+)-[0-9]+/)[1],H=i.includes(g),Y=f.getElementsByTagName("button")[0].getAttribute("aria-pressed");if(Y==="true"&&!H)return f})}var PanelManager=function(n,e){var i=getSameSideOpenedPanel(n,e);i.length>0&&i[0].getElementsByTagName("button")[0].click()},Widget={onPanelOpen:function(){PanelManager(this.options.position,this.element.id.match(/(\w+)-[0-9]+/)[1])}},checkDsfr=function(){var n=getComputedStyle(document.documentElement),e=n.getPropertyValue("--blue-france-sun-113-625");return e!==""};class ControlExtended extends Control{constructor(e){e=e||{},super({element:e.element,target:e.target,render:e.render}),e&&e.listable?this.listable=!0:this.listable=!1,e&&e.description?this.description=e.description:this.description=""}setPosition(e){if(this.getMap()){var i=new PositionFactory(this);i.set(e)}}updatePosition(e){if(this.getMap()){var i=new PositionFactory(this);i.update(e)}}}const ANCHORS=["top-left","top-right","bottom-left","bottom-right"];var Pi,Zi,Gi,ji;class PositionFactory{constructor(e){Bi(this,Pi);return this.caller=e,this.container=null,Ti(this,Pi,Gi).call(this,"top-left"),Ti(this,Pi,Gi).call(this,"top-right"),Ti(this,Pi,Gi).call(this,"bottom-left"),Ti(this,Pi,Gi).call(this,"bottom-right"),this}set(e){ANCHORS.includes(e.toLowerCase())&&(Ti(this,Pi,ji).call(this,e,!1),e.includes("bottom")?this.container.children["position-container-"+e].prepend(this.caller.element):this.container.children["position-container-"+e].appendChild(this.caller.element))}update(e){ANCHORS.includes(e.toLowerCase())&&Ti(this,Pi,ji).call(this,e,!0)}}Pi=new WeakSet,Zi=function(e){var i=this.container.children["position-container-"+e];return!!i},Gi=function(e){if(this.container=this.caller.getMap().getOverlayContainerStopEvent(),!Ti(this,Pi,Zi).call(this,e)){var i=document.createElement("div");i.id="position-container-"+e,i.className="position position-container-"+e,this.container.appendChild(i)}},ji=function(e,i){var s=this;const o=H=>{var Y=s.container.children["position-container-"+H];return Y.children.length},l=H=>{var Y=s.container.children["position-container-"+H],ee=Y.offsetWidth;return ee},c=H=>{var Y=s.container.children["position-container-"+H],ee=Y.offsetHeight;if(i){H.includes("top")&&(ee=0);for(let te=0;te<Y.children.length;te++){if(Y.children[te].id===s.caller.element.id){ee=H.includes("bottom")?ee-s.caller.element.offsetHeight:ee*-1;break}ee-=Y.children[te].offsetHeight}}return ee},u=H=>{H.style.top="unset",H.style.bottom="unset",H.style.left="unset",H.style.right="unset"};u(this.caller.element),this.caller.element.style.position="unset";var f=Array.from(this.caller.element.getElementsByClassName("GPpanel"));if(f.length!==0){var g=0;f.forEach(H=>{if(H.nodeName.toLowerCase()==="dialog"){switch(u(H),e.toLowerCase()){case"top-left":checkDsfr()?H.style.top="0px":H.style.top=o(e)?c(e)+"px":"0px",H.style.left=l(e)+g+"px";break;case"bottom-left":checkDsfr()?H.style.top="0px":H.style.bottom=o(e)?c(e)+"px":"0px",H.style.left=l(e)+g+"px";break;case"top-right":checkDsfr()?H.style.top="0px":H.style.top=o(e)?c(e)+"px":"0px",H.style.right=l(e)+g+"px";break;case"bottom-right":checkDsfr()?H.style.top="0px":H.style.bottom=o(e)?c(e)+"px":"0px",H.style.right=l(e)+g+"px";break}g+=H.offsetWidth}})}};var SelectorID={generate:(function(){var n=Math.floor(Date.now());return function(){return n++}})(),name:function(n){var e=null,i=n.lastIndexOf("-");return i===-1?e=n:e=n.substring(0,i),e},index:function(n){var e=null,i=this.name(n),s=i.lastIndexOf("_");return s!==-1&&(e=i.substring(s+1)),e},uuid:function(n){var e=null,i=n.lastIndexOf("-");return i!==-1&&(e=parseInt(n.substring(i+1),10)),e}},ToolTips={id:"gpf-tooltips-html",init:function(n={}){if(document.getElementById(this.id))return;const e=document.createElement("div");e.id=this.id,Object.assign(e.style,n),document.body.appendChild(e)},active:function(n){var e=this,i=n.getAttribute("data-tooltip");i&&(n.addEventListener("mouseenter",s=>{var o=document.getElementById(e.id);if(!o)return;o.innerHTML=i;const l=n.getBoundingClientRect();o.style.top=`${l.top-o.offsetHeight-10}px`,o.style.left=`${l.left+l.width/2}px`,o.style.transform="translateX(-50%)",o.style.opacity="1"}),n.addEventListener("mouseleave",()=>{var s=document.getElementById(e.id);s&&(s.style.opacity="0")}))}};/**!
 * Sortable 1.15.3
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function ownKeys(n,e){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),i.push.apply(i,s)}return i}function _objectSpread2(n){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?ownKeys(Object(i),!0).forEach(function(s){_defineProperty(n,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(i,s))})}return n}function _typeof(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof=function(e){return typeof e}:_typeof=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(n)}function _defineProperty(n,e,i){return e in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function _extends(){return _extends=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])}return n},_extends.apply(this,arguments)}function _objectWithoutPropertiesLoose(n,e){if(n==null)return{};var i={},s=Object.keys(n),o,l;for(l=0;l<s.length;l++)o=s[l],!(e.indexOf(o)>=0)&&(i[o]=n[o]);return i}function _objectWithoutProperties(n,e){if(n==null)return{};var i=_objectWithoutPropertiesLoose(n,e),s,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);for(o=0;o<l.length;o++)s=l[o],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(n,s)&&(i[s]=n[s])}return i}var version="1.15.3";function userAgent(n){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(n)}var IE11OrLess=userAgent(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Edge=userAgent(/Edge/i),FireFox=userAgent(/firefox/i),Safari=userAgent(/safari/i)&&!userAgent(/chrome/i)&&!userAgent(/android/i),IOS=userAgent(/iP(ad|od|hone)/i),ChromeForAndroid=userAgent(/chrome/i)&&userAgent(/android/i),captureMode={capture:!1,passive:!1};function on(n,e,i){n.addEventListener(e,i,!IE11OrLess&&captureMode)}function off(n,e,i){n.removeEventListener(e,i,!IE11OrLess&&captureMode)}function matches(n,e){if(e){if(e[0]===">"&&(e=e.substring(1)),n)try{if(n.matches)return n.matches(e);if(n.msMatchesSelector)return n.msMatchesSelector(e);if(n.webkitMatchesSelector)return n.webkitMatchesSelector(e)}catch{return!1}return!1}}function getParentOrHost(n){return n.host&&n!==document&&n.host.nodeType?n.host:n.parentNode}function closest(n,e,i,s){if(n){i=i||document;do{if(e!=null&&(e[0]===">"?n.parentNode===i&&matches(n,e):matches(n,e))||s&&n===i)return n;if(n===i)break}while(n=getParentOrHost(n))}return null}var R_SPACE=/\s+/g;function toggleClass(n,e,i){if(n&&e)if(n.classList)n.classList[i?"add":"remove"](e);else{var s=(" "+n.className+" ").replace(R_SPACE," ").replace(" "+e+" "," ");n.className=(s+(i?" "+e:"")).replace(R_SPACE," ")}}function css(n,e,i){var s=n&&n.style;if(s){if(i===void 0)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(n,""):n.currentStyle&&(i=n.currentStyle),e===void 0?i:i[e];!(e in s)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),s[e]=i+(typeof i=="string"?"":"px")}}function matrix(n,e){var i="";if(typeof n=="string")i=n;else do{var s=css(n,"transform");s&&s!=="none"&&(i=s+" "+i)}while(!e&&(n=n.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(i)}function find(n,e,i){if(n){var s=n.getElementsByTagName(e),o=0,l=s.length;if(i)for(;o<l;o++)i(s[o],o);return s}return[]}function getWindowScrollingElement(){var n=document.scrollingElement;return n||document.documentElement}function getRect(n,e,i,s,o){if(!(!n.getBoundingClientRect&&n!==window)){var l,c,u,f,g,H,Y;if(n!==window&&n.parentNode&&n!==getWindowScrollingElement()?(l=n.getBoundingClientRect(),c=l.top,u=l.left,f=l.bottom,g=l.right,H=l.height,Y=l.width):(c=0,u=0,f=window.innerHeight,g=window.innerWidth,H=window.innerHeight,Y=window.innerWidth),(e||i)&&n!==window&&(o=o||n.parentNode,!IE11OrLess))do if(o&&o.getBoundingClientRect&&(css(o,"transform")!=="none"||i&&css(o,"position")!=="static")){var ee=o.getBoundingClientRect();c-=ee.top+parseInt(css(o,"border-top-width")),u-=ee.left+parseInt(css(o,"border-left-width")),f=c+l.height,g=u+l.width;break}while(o=o.parentNode);if(s&&n!==window){var te=matrix(o||n),ne=te&&te.a,Ye=te&&te.d;te&&(c/=Ye,u/=ne,Y/=ne,H/=Ye,f=c+H,g=u+Y)}return{top:c,left:u,bottom:f,right:g,width:Y,height:H}}}function isScrolledPast(n,e,i){for(var s=getParentAutoScrollElement(n,!0),o=getRect(n)[e];s;){var l=getRect(s)[i],c=void 0;if(c=o>=l,!c)return s;if(s===getWindowScrollingElement())break;s=getParentAutoScrollElement(s,!1)}return!1}function getChild(n,e,i,s){for(var o=0,l=0,c=n.children;l<c.length;){if(c[l].style.display!=="none"&&c[l]!==Sortable.ghost&&(s||c[l]!==Sortable.dragged)&&closest(c[l],i.draggable,n,!1)){if(o===e)return c[l];o++}l++}return null}function lastChild(n,e){for(var i=n.lastElementChild;i&&(i===Sortable.ghost||css(i,"display")==="none"||e&&!matches(i,e));)i=i.previousElementSibling;return i||null}function index(n,e){var i=0;if(!n||!n.parentNode)return-1;for(;n=n.previousElementSibling;)n.nodeName.toUpperCase()!=="TEMPLATE"&&n!==Sortable.clone&&(!e||matches(n,e))&&i++;return i}function getRelativeScrollOffset(n){var e=0,i=0,s=getWindowScrollingElement();if(n)do{var o=matrix(n),l=o.a,c=o.d;e+=n.scrollLeft*l,i+=n.scrollTop*c}while(n!==s&&(n=n.parentNode));return[e,i]}function indexOfObject(n,e){for(var i in n)if(n.hasOwnProperty(i)){for(var s in e)if(e.hasOwnProperty(s)&&e[s]===n[i][s])return Number(i)}return-1}function getParentAutoScrollElement(n,e){if(!n||!n.getBoundingClientRect)return getWindowScrollingElement();var i=n,s=!1;do if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var o=css(i);if(i.clientWidth<i.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||i.clientHeight<i.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!i.getBoundingClientRect||i===document.body)return getWindowScrollingElement();if(s||e)return i;s=!0}}while(i=i.parentNode);return getWindowScrollingElement()}function extend$1(n,e){if(n&&e)for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);return n}function isRectEqual(n,e){return Math.round(n.top)===Math.round(e.top)&&Math.round(n.left)===Math.round(e.left)&&Math.round(n.height)===Math.round(e.height)&&Math.round(n.width)===Math.round(e.width)}var _throttleTimeout;function throttle(n,e){return function(){if(!_throttleTimeout){var i=arguments,s=this;i.length===1?n.call(s,i[0]):n.apply(s,i),_throttleTimeout=setTimeout(function(){_throttleTimeout=void 0},e)}}}function cancelThrottle(){clearTimeout(_throttleTimeout),_throttleTimeout=void 0}function scrollBy(n,e,i){n.scrollLeft+=e,n.scrollTop+=i}function clone(n){var e=window.Polymer,i=window.jQuery||window.Zepto;return e&&e.dom?e.dom(n).cloneNode(!0):i?i(n).clone(!0)[0]:n.cloneNode(!0)}function getChildContainingRectFromElement(n,e,i){var s={};return Array.from(n.children).forEach(function(o){var l,c,u,f;if(!(!closest(o,e.draggable,n,!1)||o.animated||o===i)){var g=getRect(o);s.left=Math.min((l=s.left)!==null&&l!==void 0?l:1/0,g.left),s.top=Math.min((c=s.top)!==null&&c!==void 0?c:1/0,g.top),s.right=Math.max((u=s.right)!==null&&u!==void 0?u:-1/0,g.right),s.bottom=Math.max((f=s.bottom)!==null&&f!==void 0?f:-1/0,g.bottom)}}),s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}var expando="Sortable"+new Date().getTime();function AnimationStateManager(){var n=[],e;return{captureAnimationState:function(){if(n=[],!!this.options.animation){var s=[].slice.call(this.el.children);s.forEach(function(o){if(!(css(o,"display")==="none"||o===Sortable.ghost)){n.push({target:o,rect:getRect(o)});var l=_objectSpread2({},n[n.length-1].rect);if(o.thisAnimationDuration){var c=matrix(o,!0);c&&(l.top-=c.f,l.left-=c.e)}o.fromRect=l}})}},addAnimationState:function(s){n.push(s)},removeAnimationState:function(s){n.splice(indexOfObject(n,{target:s}),1)},animateAll:function(s){var o=this;if(!this.options.animation){clearTimeout(e),typeof s=="function"&&s();return}var l=!1,c=0;n.forEach(function(u){var f=0,g=u.target,H=g.fromRect,Y=getRect(g),ee=g.prevFromRect,te=g.prevToRect,ne=u.rect,Ye=matrix(g,!0);Ye&&(Y.top-=Ye.f,Y.left-=Ye.e),g.toRect=Y,g.thisAnimationDuration&&isRectEqual(ee,Y)&&!isRectEqual(H,Y)&&(ne.top-Y.top)/(ne.left-Y.left)===(H.top-Y.top)/(H.left-Y.left)&&(f=calculateRealTime(ne,ee,te,o.options)),isRectEqual(Y,H)||(g.prevFromRect=H,g.prevToRect=Y,f||(f=o.options.animation),o.animate(g,ne,Y,f)),f&&(l=!0,c=Math.max(c,f),clearTimeout(g.animationResetTimer),g.animationResetTimer=setTimeout(function(){g.animationTime=0,g.prevFromRect=null,g.fromRect=null,g.prevToRect=null,g.thisAnimationDuration=null},f),g.thisAnimationDuration=f)}),clearTimeout(e),l?e=setTimeout(function(){typeof s=="function"&&s()},c):typeof s=="function"&&s(),n=[]},animate:function(s,o,l,c){if(c){css(s,"transition",""),css(s,"transform","");var u=matrix(this.el),f=u&&u.a,g=u&&u.d,H=(o.left-l.left)/(f||1),Y=(o.top-l.top)/(g||1);s.animatingX=!!H,s.animatingY=!!Y,css(s,"transform","translate3d("+H+"px,"+Y+"px,0)"),this.forRepaintDummy=repaint(s),css(s,"transition","transform "+c+"ms"+(this.options.easing?" "+this.options.easing:"")),css(s,"transform","translate3d(0,0,0)"),typeof s.animated=="number"&&clearTimeout(s.animated),s.animated=setTimeout(function(){css(s,"transition",""),css(s,"transform",""),s.animated=!1,s.animatingX=!1,s.animatingY=!1},c)}}}}function repaint(n){return n.offsetWidth}function calculateRealTime(n,e,i,s){return Math.sqrt(Math.pow(e.top-n.top,2)+Math.pow(e.left-n.left,2))/Math.sqrt(Math.pow(e.top-i.top,2)+Math.pow(e.left-i.left,2))*s.animation}var plugins=[],defaults$1={initializeByDefault:!0},PluginManager={mount:function(e){for(var i in defaults$1)defaults$1.hasOwnProperty(i)&&!(i in e)&&(e[i]=defaults$1[i]);plugins.forEach(function(s){if(s.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),plugins.push(e)},pluginEvent:function(e,i,s){var o=this;this.eventCanceled=!1,s.cancel=function(){o.eventCanceled=!0};var l=e+"Global";plugins.forEach(function(c){i[c.pluginName]&&(i[c.pluginName][l]&&i[c.pluginName][l](_objectSpread2({sortable:i},s)),i.options[c.pluginName]&&i[c.pluginName][e]&&i[c.pluginName][e](_objectSpread2({sortable:i},s)))})},initializePlugins:function(e,i,s,o){plugins.forEach(function(u){var f=u.pluginName;if(!(!e.options[f]&&!u.initializeByDefault)){var g=new u(e,i,e.options);g.sortable=e,g.options=e.options,e[f]=g,_extends(s,g.defaults)}});for(var l in e.options)if(e.options.hasOwnProperty(l)){var c=this.modifyOption(e,l,e.options[l]);typeof c<"u"&&(e.options[l]=c)}},getEventProperties:function(e,i){var s={};return plugins.forEach(function(o){typeof o.eventProperties=="function"&&_extends(s,o.eventProperties.call(i[o.pluginName],e))}),s},modifyOption:function(e,i,s){var o;return plugins.forEach(function(l){e[l.pluginName]&&l.optionListeners&&typeof l.optionListeners[i]=="function"&&(o=l.optionListeners[i].call(e[l.pluginName],s))}),o}};function dispatchEvent(n){var e=n.sortable,i=n.rootEl,s=n.name,o=n.targetEl,l=n.cloneEl,c=n.toEl,u=n.fromEl,f=n.oldIndex,g=n.newIndex,H=n.oldDraggableIndex,Y=n.newDraggableIndex,ee=n.originalEvent,te=n.putSortable,ne=n.extraEventProperties;if(e=e||i&&i[expando],!!e){var Ye,xe=e.options,tt="on"+s.charAt(0).toUpperCase()+s.substr(1);window.CustomEvent&&!IE11OrLess&&!Edge?Ye=new CustomEvent(s,{bubbles:!0,cancelable:!0}):(Ye=document.createEvent("Event"),Ye.initEvent(s,!0,!0)),Ye.to=c||i,Ye.from=u||i,Ye.item=o||i,Ye.clone=l,Ye.oldIndex=f,Ye.newIndex=g,Ye.oldDraggableIndex=H,Ye.newDraggableIndex=Y,Ye.originalEvent=ee,Ye.pullMode=te?te.lastPutMode:void 0;var et=_objectSpread2(_objectSpread2({},ne),PluginManager.getEventProperties(s,e));for(var it in et)Ye[it]=et[it];i&&i.dispatchEvent(Ye),xe[tt]&&xe[tt].call(e,Ye)}}var _excluded=["evt"],pluginEvent=function(e,i){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.evt,l=_objectWithoutProperties(s,_excluded);PluginManager.pluginEvent.bind(Sortable)(e,i,_objectSpread2({dragEl,parentEl,ghostEl,rootEl,nextEl,lastDownEl,cloneEl,cloneHidden,dragStarted:moved,putSortable,activeSortable:Sortable.active,originalEvent:o,oldIndex,oldDraggableIndex,newIndex,newDraggableIndex,hideGhostForTarget:_hideGhostForTarget,unhideGhostForTarget:_unhideGhostForTarget,cloneNowHidden:function(){cloneHidden=!0},cloneNowShown:function(){cloneHidden=!1},dispatchSortableEvent:function(u){_dispatchEvent({sortable:i,name:u,originalEvent:o})}},l))};function _dispatchEvent(n){dispatchEvent(_objectSpread2({putSortable,cloneEl,targetEl:dragEl,rootEl,oldIndex,oldDraggableIndex,newIndex,newDraggableIndex},n))}var dragEl,parentEl,ghostEl,rootEl,nextEl,lastDownEl,cloneEl,cloneHidden,oldIndex,newIndex,oldDraggableIndex,newDraggableIndex,activeGroup,putSortable,awaitingDragStarted=!1,ignoreNextClick=!1,sortables=[],tapEvt,touchEvt,lastDx,lastDy,tapDistanceLeft,tapDistanceTop,moved,lastTarget,lastDirection,pastFirstInvertThresh=!1,isCircumstantialInvert=!1,targetMoveDistance,ghostRelativeParent,ghostRelativeParentInitialScroll=[],_silent=!1,savedInputChecked=[],documentExists=typeof document<"u",PositionGhostAbsolutely=IOS,CSSFloatProperty=Edge||IE11OrLess?"cssFloat":"float",supportDraggable=documentExists&&!ChromeForAndroid&&!IOS&&"draggable"in document.createElement("div"),supportCssPointerEvents=(function(){if(documentExists){if(IE11OrLess)return!1;var n=document.createElement("x");return n.style.cssText="pointer-events:auto",n.style.pointerEvents==="auto"}})(),_detectDirection=function(e,i){var s=css(e),o=parseInt(s.width)-parseInt(s.paddingLeft)-parseInt(s.paddingRight)-parseInt(s.borderLeftWidth)-parseInt(s.borderRightWidth),l=getChild(e,0,i),c=getChild(e,1,i),u=l&&css(l),f=c&&css(c),g=u&&parseInt(u.marginLeft)+parseInt(u.marginRight)+getRect(l).width,H=f&&parseInt(f.marginLeft)+parseInt(f.marginRight)+getRect(c).width;if(s.display==="flex")return s.flexDirection==="column"||s.flexDirection==="column-reverse"?"vertical":"horizontal";if(s.display==="grid")return s.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(l&&u.float&&u.float!=="none"){var Y=u.float==="left"?"left":"right";return c&&(f.clear==="both"||f.clear===Y)?"vertical":"horizontal"}return l&&(u.display==="block"||u.display==="flex"||u.display==="table"||u.display==="grid"||g>=o&&s[CSSFloatProperty]==="none"||c&&s[CSSFloatProperty]==="none"&&g+H>o)?"vertical":"horizontal"},_dragElInRowColumn=function(e,i,s){var o=s?e.left:e.top,l=s?e.right:e.bottom,c=s?e.width:e.height,u=s?i.left:i.top,f=s?i.right:i.bottom,g=s?i.width:i.height;return o===u||l===f||o+c/2===u+g/2},_detectNearestEmptySortable=function(e,i){var s;return sortables.some(function(o){var l=o[expando].options.emptyInsertThreshold;if(!(!l||lastChild(o))){var c=getRect(o),u=e>=c.left-l&&e<=c.right+l,f=i>=c.top-l&&i<=c.bottom+l;if(u&&f)return s=o}}),s},_prepareGroup=function(e){function i(l,c){return function(u,f,g,H){var Y=u.options.group.name&&f.options.group.name&&u.options.group.name===f.options.group.name;if(l==null&&(c||Y))return!0;if(l==null||l===!1)return!1;if(c&&l==="clone")return l;if(typeof l=="function")return i(l(u,f,g,H),c)(u,f,g,H);var ee=(c?u:f).options.group.name;return l===!0||typeof l=="string"&&l===ee||l.join&&l.indexOf(ee)>-1}}var s={},o=e.group;(!o||_typeof(o)!="object")&&(o={name:o}),s.name=o.name,s.checkPull=i(o.pull,!0),s.checkPut=i(o.put),s.revertClone=o.revertClone,e.group=s},_hideGhostForTarget=function(){!supportCssPointerEvents&&ghostEl&&css(ghostEl,"display","none")},_unhideGhostForTarget=function(){!supportCssPointerEvents&&ghostEl&&css(ghostEl,"display","")};documentExists&&!ChromeForAndroid&&document.addEventListener("click",function(n){if(ignoreNextClick)return n.preventDefault(),n.stopPropagation&&n.stopPropagation(),n.stopImmediatePropagation&&n.stopImmediatePropagation(),ignoreNextClick=!1,!1},!0);var nearestEmptyInsertDetectEvent=function(e){if(dragEl){e=e.touches?e.touches[0]:e;var i=_detectNearestEmptySortable(e.clientX,e.clientY);if(i){var s={};for(var o in e)e.hasOwnProperty(o)&&(s[o]=e[o]);s.target=s.rootEl=i,s.preventDefault=void 0,s.stopPropagation=void 0,i[expando]._onDragOver(s)}}},_checkOutsideTargetEl=function(e){dragEl&&dragEl.parentNode[expando]._isOutsideThisEl(e.target)};function Sortable(n,e){if(!(n&&n.nodeType&&n.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(n));this.el=n,this.options=e=_extends({},e),n[expando]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(n.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return _detectDirection(n,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(c,u){c.setData("Text",u.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:Sortable.supportPointer!==!1&&"PointerEvent"in window&&!Safari,emptyInsertThreshold:5};PluginManager.initializePlugins(this,n,i);for(var s in i)!(s in e)&&(e[s]=i[s]);_prepareGroup(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:supportDraggable,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?on(n,"pointerdown",this._onTapStart):(on(n,"mousedown",this._onTapStart),on(n,"touchstart",this._onTapStart)),this.nativeDraggable&&(on(n,"dragover",this),on(n,"dragenter",this)),sortables.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),_extends(this,AnimationStateManager())}Sortable.prototype={constructor:Sortable,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(lastTarget=null)},_getDirection:function(e,i){return typeof this.options.direction=="function"?this.options.direction.call(this,e,i,dragEl):this.options.direction},_onTapStart:function(e){if(e.cancelable){var i=this,s=this.el,o=this.options,l=o.preventOnFilter,c=e.type,u=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,f=(u||e).target,g=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||f,H=o.filter;if(_saveInputCheckedState(s),!dragEl&&!(/mousedown|pointerdown/.test(c)&&e.button!==0||o.disabled)&&!g.isContentEditable&&!(!this.nativeDraggable&&Safari&&f&&f.tagName.toUpperCase()==="SELECT")&&(f=closest(f,o.draggable,s,!1),!(f&&f.animated)&&lastDownEl!==f)){if(oldIndex=index(f),oldDraggableIndex=index(f,o.draggable),typeof H=="function"){if(H.call(this,e,f,this)){_dispatchEvent({sortable:i,rootEl:g,name:"filter",targetEl:f,toEl:s,fromEl:s}),pluginEvent("filter",i,{evt:e}),l&&e.cancelable&&e.preventDefault();return}}else if(H&&(H=H.split(",").some(function(Y){if(Y=closest(g,Y.trim(),s,!1),Y)return _dispatchEvent({sortable:i,rootEl:Y,name:"filter",targetEl:f,fromEl:s,toEl:s}),pluginEvent("filter",i,{evt:e}),!0}),H)){l&&e.cancelable&&e.preventDefault();return}o.handle&&!closest(g,o.handle,s,!1)||this._prepareDragStart(e,u,f)}}},_prepareDragStart:function(e,i,s){var o=this,l=o.el,c=o.options,u=l.ownerDocument,f;if(s&&!dragEl&&s.parentNode===l){var g=getRect(s);if(rootEl=l,dragEl=s,parentEl=dragEl.parentNode,nextEl=dragEl.nextSibling,lastDownEl=s,activeGroup=c.group,Sortable.dragged=dragEl,tapEvt={target:dragEl,clientX:(i||e).clientX,clientY:(i||e).clientY},tapDistanceLeft=tapEvt.clientX-g.left,tapDistanceTop=tapEvt.clientY-g.top,this._lastX=(i||e).clientX,this._lastY=(i||e).clientY,dragEl.style["will-change"]="all",f=function(){if(pluginEvent("delayEnded",o,{evt:e}),Sortable.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!FireFox&&o.nativeDraggable&&(dragEl.draggable=!0),o._triggerDragStart(e,i),_dispatchEvent({sortable:o,name:"choose",originalEvent:e}),toggleClass(dragEl,c.chosenClass,!0)},c.ignore.split(",").forEach(function(H){find(dragEl,H.trim(),_disableDraggable)}),on(u,"dragover",nearestEmptyInsertDetectEvent),on(u,"mousemove",nearestEmptyInsertDetectEvent),on(u,"touchmove",nearestEmptyInsertDetectEvent),on(u,"mouseup",o._onDrop),on(u,"touchend",o._onDrop),on(u,"touchcancel",o._onDrop),FireFox&&this.nativeDraggable&&(this.options.touchStartThreshold=4,dragEl.draggable=!0),pluginEvent("delayStart",this,{evt:e}),c.delay&&(!c.delayOnTouchOnly||i)&&(!this.nativeDraggable||!(Edge||IE11OrLess))){if(Sortable.eventCanceled){this._onDrop();return}on(u,"mouseup",o._disableDelayedDrag),on(u,"touchend",o._disableDelayedDrag),on(u,"touchcancel",o._disableDelayedDrag),on(u,"mousemove",o._delayedDragTouchMoveHandler),on(u,"touchmove",o._delayedDragTouchMoveHandler),c.supportPointer&&on(u,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(f,c.delay)}else f()}},_delayedDragTouchMoveHandler:function(e){var i=e.touches?e.touches[0]:e;Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){dragEl&&_disableDraggable(dragEl),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;off(e,"mouseup",this._disableDelayedDrag),off(e,"touchend",this._disableDelayedDrag),off(e,"touchcancel",this._disableDelayedDrag),off(e,"mousemove",this._delayedDragTouchMoveHandler),off(e,"touchmove",this._delayedDragTouchMoveHandler),off(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,i){i=i||e.pointerType=="touch"&&e,!this.nativeDraggable||i?this.options.supportPointer?on(document,"pointermove",this._onTouchMove):i?on(document,"touchmove",this._onTouchMove):on(document,"mousemove",this._onTouchMove):(on(dragEl,"dragend",this),on(rootEl,"dragstart",this._onDragStart));try{document.selection?_nextTick(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,i){if(awaitingDragStarted=!1,rootEl&&dragEl){pluginEvent("dragStarted",this,{evt:i}),this.nativeDraggable&&on(document,"dragover",_checkOutsideTargetEl);var s=this.options;!e&&toggleClass(dragEl,s.dragClass,!1),toggleClass(dragEl,s.ghostClass,!0),Sortable.active=this,e&&this._appendGhost(),_dispatchEvent({sortable:this,name:"start",originalEvent:i})}else this._nulling()},_emulateDragOver:function(){if(touchEvt){this._lastX=touchEvt.clientX,this._lastY=touchEvt.clientY,_hideGhostForTarget();for(var e=document.elementFromPoint(touchEvt.clientX,touchEvt.clientY),i=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(touchEvt.clientX,touchEvt.clientY),e!==i);)i=e;if(dragEl.parentNode[expando]._isOutsideThisEl(e),i)do{if(i[expando]){var s=void 0;if(s=i[expando]._onDragOver({clientX:touchEvt.clientX,clientY:touchEvt.clientY,target:e,rootEl:i}),s&&!this.options.dragoverBubble)break}e=i}while(i=getParentOrHost(i));_unhideGhostForTarget()}},_onTouchMove:function(e){if(tapEvt){var i=this.options,s=i.fallbackTolerance,o=i.fallbackOffset,l=e.touches?e.touches[0]:e,c=ghostEl&&matrix(ghostEl,!0),u=ghostEl&&c&&c.a,f=ghostEl&&c&&c.d,g=PositionGhostAbsolutely&&ghostRelativeParent&&getRelativeScrollOffset(ghostRelativeParent),H=(l.clientX-tapEvt.clientX+o.x)/(u||1)+(g?g[0]-ghostRelativeParentInitialScroll[0]:0)/(u||1),Y=(l.clientY-tapEvt.clientY+o.y)/(f||1)+(g?g[1]-ghostRelativeParentInitialScroll[1]:0)/(f||1);if(!Sortable.active&&!awaitingDragStarted){if(s&&Math.max(Math.abs(l.clientX-this._lastX),Math.abs(l.clientY-this._lastY))<s)return;this._onDragStart(e,!0)}if(ghostEl){c?(c.e+=H-(lastDx||0),c.f+=Y-(lastDy||0)):c={a:1,b:0,c:0,d:1,e:H,f:Y};var ee="matrix(".concat(c.a,",").concat(c.b,",").concat(c.c,",").concat(c.d,",").concat(c.e,",").concat(c.f,")");css(ghostEl,"webkitTransform",ee),css(ghostEl,"mozTransform",ee),css(ghostEl,"msTransform",ee),css(ghostEl,"transform",ee),lastDx=H,lastDy=Y,touchEvt=l}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!ghostEl){var e=this.options.fallbackOnBody?document.body:rootEl,i=getRect(dragEl,!0,PositionGhostAbsolutely,!0,e),s=this.options;if(PositionGhostAbsolutely){for(ghostRelativeParent=e;css(ghostRelativeParent,"position")==="static"&&css(ghostRelativeParent,"transform")==="none"&&ghostRelativeParent!==document;)ghostRelativeParent=ghostRelativeParent.parentNode;ghostRelativeParent!==document.body&&ghostRelativeParent!==document.documentElement?(ghostRelativeParent===document&&(ghostRelativeParent=getWindowScrollingElement()),i.top+=ghostRelativeParent.scrollTop,i.left+=ghostRelativeParent.scrollLeft):ghostRelativeParent=getWindowScrollingElement(),ghostRelativeParentInitialScroll=getRelativeScrollOffset(ghostRelativeParent)}ghostEl=dragEl.cloneNode(!0),toggleClass(ghostEl,s.ghostClass,!1),toggleClass(ghostEl,s.fallbackClass,!0),toggleClass(ghostEl,s.dragClass,!0),css(ghostEl,"transition",""),css(ghostEl,"transform",""),css(ghostEl,"box-sizing","border-box"),css(ghostEl,"margin",0),css(ghostEl,"top",i.top),css(ghostEl,"left",i.left),css(ghostEl,"width",i.width),css(ghostEl,"height",i.height),css(ghostEl,"opacity","0.8"),css(ghostEl,"position",PositionGhostAbsolutely?"absolute":"fixed"),css(ghostEl,"zIndex","100000"),css(ghostEl,"pointerEvents","none"),Sortable.ghost=ghostEl,e.appendChild(ghostEl),css(ghostEl,"transform-origin",tapDistanceLeft/parseInt(ghostEl.style.width)*100+"% "+tapDistanceTop/parseInt(ghostEl.style.height)*100+"%")}},_onDragStart:function(e,i){var s=this,o=e.dataTransfer,l=s.options;if(pluginEvent("dragStart",this,{evt:e}),Sortable.eventCanceled){this._onDrop();return}pluginEvent("setupClone",this),Sortable.eventCanceled||(cloneEl=clone(dragEl),cloneEl.removeAttribute("id"),cloneEl.draggable=!1,cloneEl.style["will-change"]="",this._hideClone(),toggleClass(cloneEl,this.options.chosenClass,!1),Sortable.clone=cloneEl),s.cloneId=_nextTick(function(){pluginEvent("clone",s),!Sortable.eventCanceled&&(s.options.removeCloneOnHide||rootEl.insertBefore(cloneEl,dragEl),s._hideClone(),_dispatchEvent({sortable:s,name:"clone"}))}),!i&&toggleClass(dragEl,l.dragClass,!0),i?(ignoreNextClick=!0,s._loopId=setInterval(s._emulateDragOver,50)):(off(document,"mouseup",s._onDrop),off(document,"touchend",s._onDrop),off(document,"touchcancel",s._onDrop),o&&(o.effectAllowed="move",l.setData&&l.setData.call(s,o,dragEl)),on(document,"drop",s),css(dragEl,"transform","translateZ(0)")),awaitingDragStarted=!0,s._dragStartId=_nextTick(s._dragStarted.bind(s,i,e)),on(document,"selectstart",s),moved=!0,Safari&&css(document.body,"user-select","none")},_onDragOver:function(e){var i=this.el,s=e.target,o,l,c,u=this.options,f=u.group,g=Sortable.active,H=activeGroup===f,Y=u.sort,ee=putSortable||g,te,ne=this,Ye=!1;if(_silent)return;function xe(Lt,Gt){pluginEvent(Lt,ne,_objectSpread2({evt:e,isOwner:H,axis:te?"vertical":"horizontal",revert:c,dragRect:o,targetRect:l,canSort:Y,fromSortable:ee,target:s,completed:et,onMove:function(Et,_t){return _onMove(rootEl,i,dragEl,o,Et,getRect(Et),e,_t)},changed:it},Gt))}function tt(){xe("dragOverAnimationCapture"),ne.captureAnimationState(),ne!==ee&&ee.captureAnimationState()}function et(Lt){return xe("dragOverCompleted",{insertion:Lt}),Lt&&(H?g._hideClone():g._showClone(ne),ne!==ee&&(toggleClass(dragEl,putSortable?putSortable.options.ghostClass:g.options.ghostClass,!1),toggleClass(dragEl,u.ghostClass,!0)),putSortable!==ne&&ne!==Sortable.active?putSortable=ne:ne===Sortable.active&&putSortable&&(putSortable=null),ee===ne&&(ne._ignoreWhileAnimating=s),ne.animateAll(function(){xe("dragOverAnimationComplete"),ne._ignoreWhileAnimating=null}),ne!==ee&&(ee.animateAll(),ee._ignoreWhileAnimating=null)),(s===dragEl&&!dragEl.animated||s===i&&!s.animated)&&(lastTarget=null),!u.dragoverBubble&&!e.rootEl&&s!==document&&(dragEl.parentNode[expando]._isOutsideThisEl(e.target),!Lt&&nearestEmptyInsertDetectEvent(e)),!u.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),Ye=!0}function it(){newIndex=index(dragEl),newDraggableIndex=index(dragEl,u.draggable),_dispatchEvent({sortable:ne,name:"change",toEl:i,newIndex,newDraggableIndex,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),s=closest(s,u.draggable,i,!0),xe("dragOver"),Sortable.eventCanceled)return Ye;if(dragEl.contains(e.target)||s.animated&&s.animatingX&&s.animatingY||ne._ignoreWhileAnimating===s)return et(!1);if(ignoreNextClick=!1,g&&!u.disabled&&(H?Y||(c=parentEl!==rootEl):putSortable===this||(this.lastPutMode=activeGroup.checkPull(this,g,dragEl,e))&&f.checkPut(this,g,dragEl,e))){if(te=this._getDirection(e,s)==="vertical",o=getRect(dragEl),xe("dragOverValid"),Sortable.eventCanceled)return Ye;if(c)return parentEl=rootEl,tt(),this._hideClone(),xe("revert"),Sortable.eventCanceled||(nextEl?rootEl.insertBefore(dragEl,nextEl):rootEl.appendChild(dragEl)),et(!0);var rt=lastChild(i,u.draggable);if(!rt||_ghostIsLast(e,te,this)&&!rt.animated){if(rt===dragEl)return et(!1);if(rt&&i===e.target&&(s=rt),s&&(l=getRect(s)),_onMove(rootEl,i,dragEl,o,s,l,e,!!s)!==!1)return tt(),rt&&rt.nextSibling?i.insertBefore(dragEl,rt.nextSibling):i.appendChild(dragEl),parentEl=i,it(),et(!0)}else if(rt&&_ghostIsFirst(e,te,this)){var nt=getChild(i,0,u,!0);if(nt===dragEl)return et(!1);if(s=nt,l=getRect(s),_onMove(rootEl,i,dragEl,o,s,l,e,!1)!==!1)return tt(),i.insertBefore(dragEl,nt),parentEl=i,it(),et(!0)}else if(s.parentNode===i){l=getRect(s);var at=0,st,ot=dragEl.parentNode!==i,ut=!_dragElInRowColumn(dragEl.animated&&dragEl.toRect||o,s.animated&&s.toRect||l,te),ht=te?"top":"left",dt=isScrolledPast(s,"top","top")||isScrolledPast(dragEl,"top","top"),pt=dt?dt.scrollTop:void 0;lastTarget!==s&&(st=l[ht],pastFirstInvertThresh=!1,isCircumstantialInvert=!ut&&u.invertSwap||ot),at=_getSwapDirection(e,s,l,te,ut?1:u.swapThreshold,u.invertedSwapThreshold==null?u.swapThreshold:u.invertedSwapThreshold,isCircumstantialInvert,lastTarget===s);var yt;if(at!==0){var mt=index(dragEl);do mt-=at,yt=parentEl.children[mt];while(yt&&(css(yt,"display")==="none"||yt===ghostEl))}if(at===0||yt===s)return et(!1);lastTarget=s,lastDirection=at;var St=s.nextElementSibling,wt=!1;wt=at===1;var Rt=_onMove(rootEl,i,dragEl,o,s,l,e,wt);if(Rt!==!1)return(Rt===1||Rt===-1)&&(wt=Rt===1),_silent=!0,setTimeout(_unsilent,30),tt(),wt&&!St?i.appendChild(dragEl):s.parentNode.insertBefore(dragEl,wt?St:s),dt&&scrollBy(dt,0,pt-dt.scrollTop),parentEl=dragEl.parentNode,st!==void 0&&!isCircumstantialInvert&&(targetMoveDistance=Math.abs(st-getRect(s)[ht])),it(),et(!0)}if(i.contains(dragEl))return et(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){off(document,"mousemove",this._onTouchMove),off(document,"touchmove",this._onTouchMove),off(document,"pointermove",this._onTouchMove),off(document,"dragover",nearestEmptyInsertDetectEvent),off(document,"mousemove",nearestEmptyInsertDetectEvent),off(document,"touchmove",nearestEmptyInsertDetectEvent)},_offUpEvents:function(){var e=this.el.ownerDocument;off(e,"mouseup",this._onDrop),off(e,"touchend",this._onDrop),off(e,"pointerup",this._onDrop),off(e,"touchcancel",this._onDrop),off(document,"selectstart",this)},_onDrop:function(e){var i=this.el,s=this.options;if(newIndex=index(dragEl),newDraggableIndex=index(dragEl,s.draggable),pluginEvent("drop",this,{evt:e}),parentEl=dragEl&&dragEl.parentNode,newIndex=index(dragEl),newDraggableIndex=index(dragEl,s.draggable),Sortable.eventCanceled){this._nulling();return}awaitingDragStarted=!1,isCircumstantialInvert=!1,pastFirstInvertThresh=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),_cancelNextTick(this.cloneId),_cancelNextTick(this._dragStartId),this.nativeDraggable&&(off(document,"drop",this),off(i,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Safari&&css(document.body,"user-select",""),css(dragEl,"transform",""),e&&(moved&&(e.cancelable&&e.preventDefault(),!s.dropBubble&&e.stopPropagation()),ghostEl&&ghostEl.parentNode&&ghostEl.parentNode.removeChild(ghostEl),(rootEl===parentEl||putSortable&&putSortable.lastPutMode!=="clone")&&cloneEl&&cloneEl.parentNode&&cloneEl.parentNode.removeChild(cloneEl),dragEl&&(this.nativeDraggable&&off(dragEl,"dragend",this),_disableDraggable(dragEl),dragEl.style["will-change"]="",moved&&!awaitingDragStarted&&toggleClass(dragEl,putSortable?putSortable.options.ghostClass:this.options.ghostClass,!1),toggleClass(dragEl,this.options.chosenClass,!1),_dispatchEvent({sortable:this,name:"unchoose",toEl:parentEl,newIndex:null,newDraggableIndex:null,originalEvent:e}),rootEl!==parentEl?(newIndex>=0&&(_dispatchEvent({rootEl:parentEl,name:"add",toEl:parentEl,fromEl:rootEl,originalEvent:e}),_dispatchEvent({sortable:this,name:"remove",toEl:parentEl,originalEvent:e}),_dispatchEvent({rootEl:parentEl,name:"sort",toEl:parentEl,fromEl:rootEl,originalEvent:e}),_dispatchEvent({sortable:this,name:"sort",toEl:parentEl,originalEvent:e})),putSortable&&putSortable.save()):newIndex!==oldIndex&&newIndex>=0&&(_dispatchEvent({sortable:this,name:"update",toEl:parentEl,originalEvent:e}),_dispatchEvent({sortable:this,name:"sort",toEl:parentEl,originalEvent:e})),Sortable.active&&((newIndex==null||newIndex===-1)&&(newIndex=oldIndex,newDraggableIndex=oldDraggableIndex),_dispatchEvent({sortable:this,name:"end",toEl:parentEl,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){pluginEvent("nulling",this),rootEl=dragEl=parentEl=ghostEl=nextEl=cloneEl=lastDownEl=cloneHidden=tapEvt=touchEvt=moved=newIndex=newDraggableIndex=oldIndex=oldDraggableIndex=lastTarget=lastDirection=putSortable=activeGroup=Sortable.dragged=Sortable.ghost=Sortable.clone=Sortable.active=null,savedInputChecked.forEach(function(e){e.checked=!0}),savedInputChecked.length=lastDx=lastDy=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":dragEl&&(this._onDragOver(e),_globalDragOver(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],i,s=this.el.children,o=0,l=s.length,c=this.options;o<l;o++)i=s[o],closest(i,c.draggable,this.el,!1)&&e.push(i.getAttribute(c.dataIdAttr)||_generateId(i));return e},sort:function(e,i){var s={},o=this.el;this.toArray().forEach(function(l,c){var u=o.children[c];closest(u,this.options.draggable,o,!1)&&(s[l]=u)},this),i&&this.captureAnimationState(),e.forEach(function(l){s[l]&&(o.removeChild(s[l]),o.appendChild(s[l]))}),i&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,i){return closest(e,i||this.options.draggable,this.el,!1)},option:function(e,i){var s=this.options;if(i===void 0)return s[e];var o=PluginManager.modifyOption(this,e,i);typeof o<"u"?s[e]=o:s[e]=i,e==="group"&&_prepareGroup(s)},destroy:function(){pluginEvent("destroy",this);var e=this.el;e[expando]=null,off(e,"mousedown",this._onTapStart),off(e,"touchstart",this._onTapStart),off(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(off(e,"dragover",this),off(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(i){i.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),sortables.splice(sortables.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!cloneHidden){if(pluginEvent("hideClone",this),Sortable.eventCanceled)return;css(cloneEl,"display","none"),this.options.removeCloneOnHide&&cloneEl.parentNode&&cloneEl.parentNode.removeChild(cloneEl),cloneHidden=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(cloneHidden){if(pluginEvent("showClone",this),Sortable.eventCanceled)return;dragEl.parentNode==rootEl&&!this.options.group.revertClone?rootEl.insertBefore(cloneEl,dragEl):nextEl?rootEl.insertBefore(cloneEl,nextEl):rootEl.appendChild(cloneEl),this.options.group.revertClone&&this.animate(dragEl,cloneEl),css(cloneEl,"display",""),cloneHidden=!1}}};function _globalDragOver(n){n.dataTransfer&&(n.dataTransfer.dropEffect="move"),n.cancelable&&n.preventDefault()}function _onMove(n,e,i,s,o,l,c,u){var f,g=n[expando],H=g.options.onMove,Y;return window.CustomEvent&&!IE11OrLess&&!Edge?f=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(f=document.createEvent("Event"),f.initEvent("move",!0,!0)),f.to=e,f.from=n,f.dragged=i,f.draggedRect=s,f.related=o||e,f.relatedRect=l||getRect(e),f.willInsertAfter=u,f.originalEvent=c,n.dispatchEvent(f),H&&(Y=H.call(g,f,c)),Y}function _disableDraggable(n){n.draggable=!1}function _unsilent(){_silent=!1}function _ghostIsFirst(n,e,i){var s=getRect(getChild(i.el,0,i.options,!0)),o=getChildContainingRectFromElement(i.el,i.options,ghostEl),l=10;return e?n.clientX<o.left-l||n.clientY<s.top&&n.clientX<s.right:n.clientY<o.top-l||n.clientY<s.bottom&&n.clientX<s.left}function _ghostIsLast(n,e,i){var s=getRect(lastChild(i.el,i.options.draggable)),o=getChildContainingRectFromElement(i.el,i.options,ghostEl),l=10;return e?n.clientX>o.right+l||n.clientY>s.bottom&&n.clientX>s.left:n.clientY>o.bottom+l||n.clientX>s.right&&n.clientY>s.top}function _getSwapDirection(n,e,i,s,o,l,c,u){var f=s?n.clientY:n.clientX,g=s?i.height:i.width,H=s?i.top:i.left,Y=s?i.bottom:i.right,ee=!1;if(!c){if(u&&targetMoveDistance<g*o){if(!pastFirstInvertThresh&&(lastDirection===1?f>H+g*l/2:f<Y-g*l/2)&&(pastFirstInvertThresh=!0),pastFirstInvertThresh)ee=!0;else if(lastDirection===1?f<H+targetMoveDistance:f>Y-targetMoveDistance)return-lastDirection}else if(f>H+g*(1-o)/2&&f<Y-g*(1-o)/2)return _getInsertDirection(e)}return ee=ee||c,ee&&(f<H+g*l/2||f>Y-g*l/2)?f>H+g/2?1:-1:0}function _getInsertDirection(n){return index(dragEl)<index(n)?1:-1}function _generateId(n){for(var e=n.tagName+n.className+n.src+n.href+n.textContent,i=e.length,s=0;i--;)s+=e.charCodeAt(i);return s.toString(36)}function _saveInputCheckedState(n){savedInputChecked.length=0;for(var e=n.getElementsByTagName("input"),i=e.length;i--;){var s=e[i];s.checked&&savedInputChecked.push(s)}}function _nextTick(n){return setTimeout(n,0)}function _cancelNextTick(n){return clearTimeout(n)}documentExists&&on(document,"touchmove",function(n){(Sortable.active||awaitingDragStarted)&&n.cancelable&&n.preventDefault()});Sortable.utils={on,off,css,find,is:function(e,i){return!!closest(e,i,e,!1)},extend:extend$1,throttle,closest,toggleClass,clone,index,nextTick:_nextTick,cancelNextTick:_cancelNextTick,detectDirection:_detectDirection,getChild,expando};Sortable.get=function(n){return n[expando]};Sortable.mount=function(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];e[0].constructor===Array&&(e=e[0]),e.forEach(function(s){if(!s.prototype||!s.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(s));s.utils&&(Sortable.utils=_objectSpread2(_objectSpread2({},Sortable.utils),s.utils)),PluginManager.mount(s)})};Sortable.create=function(n,e){return new Sortable(n,e)};Sortable.version=version;var autoScrolls=[],scrollEl,scrollRootEl,scrolling=!1,lastAutoScrollX,lastAutoScrollY,touchEvt$1,pointerElemChangedInterval;function AutoScrollPlugin(){function n(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return n.prototype={dragStarted:function(i){var s=i.originalEvent;this.sortable.nativeDraggable?on(document,"dragover",this._handleAutoScroll):this.options.supportPointer?on(document,"pointermove",this._handleFallbackAutoScroll):s.touches?on(document,"touchmove",this._handleFallbackAutoScroll):on(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(i){var s=i.originalEvent;!this.options.dragOverBubble&&!s.rootEl&&this._handleAutoScroll(s)},drop:function(){this.sortable.nativeDraggable?off(document,"dragover",this._handleAutoScroll):(off(document,"pointermove",this._handleFallbackAutoScroll),off(document,"touchmove",this._handleFallbackAutoScroll),off(document,"mousemove",this._handleFallbackAutoScroll)),clearPointerElemChangedInterval(),clearAutoScrolls(),cancelThrottle()},nulling:function(){touchEvt$1=scrollRootEl=scrollEl=scrolling=pointerElemChangedInterval=lastAutoScrollX=lastAutoScrollY=null,autoScrolls.length=0},_handleFallbackAutoScroll:function(i){this._handleAutoScroll(i,!0)},_handleAutoScroll:function(i,s){var o=this,l=(i.touches?i.touches[0]:i).clientX,c=(i.touches?i.touches[0]:i).clientY,u=document.elementFromPoint(l,c);if(touchEvt$1=i,s||this.options.forceAutoScrollFallback||Edge||IE11OrLess||Safari){autoScroll(i,this.options,u,s);var f=getParentAutoScrollElement(u,!0);scrolling&&(!pointerElemChangedInterval||l!==lastAutoScrollX||c!==lastAutoScrollY)&&(pointerElemChangedInterval&&clearPointerElemChangedInterval(),pointerElemChangedInterval=setInterval(function(){var g=getParentAutoScrollElement(document.elementFromPoint(l,c),!0);g!==f&&(f=g,clearAutoScrolls()),autoScroll(i,o.options,g,s)},10),lastAutoScrollX=l,lastAutoScrollY=c)}else{if(!this.options.bubbleScroll||getParentAutoScrollElement(u,!0)===getWindowScrollingElement()){clearAutoScrolls();return}autoScroll(i,this.options,getParentAutoScrollElement(u,!1),!1)}}},_extends(n,{pluginName:"scroll",initializeByDefault:!0})}function clearAutoScrolls(){autoScrolls.forEach(function(n){clearInterval(n.pid)}),autoScrolls=[]}function clearPointerElemChangedInterval(){clearInterval(pointerElemChangedInterval)}var autoScroll=throttle(function(n,e,i,s){if(e.scroll){var o=(n.touches?n.touches[0]:n).clientX,l=(n.touches?n.touches[0]:n).clientY,c=e.scrollSensitivity,u=e.scrollSpeed,f=getWindowScrollingElement(),g=!1,H;scrollRootEl!==i&&(scrollRootEl=i,clearAutoScrolls(),scrollEl=e.scroll,H=e.scrollFn,scrollEl===!0&&(scrollEl=getParentAutoScrollElement(i,!0)));var Y=0,ee=scrollEl;do{var te=ee,ne=getRect(te),Ye=ne.top,xe=ne.bottom,tt=ne.left,et=ne.right,it=ne.width,rt=ne.height,nt=void 0,at=void 0,st=te.scrollWidth,ot=te.scrollHeight,ut=css(te),ht=te.scrollLeft,dt=te.scrollTop;te===f?(nt=it<st&&(ut.overflowX==="auto"||ut.overflowX==="scroll"||ut.overflowX==="visible"),at=rt<ot&&(ut.overflowY==="auto"||ut.overflowY==="scroll"||ut.overflowY==="visible")):(nt=it<st&&(ut.overflowX==="auto"||ut.overflowX==="scroll"),at=rt<ot&&(ut.overflowY==="auto"||ut.overflowY==="scroll"));var pt=nt&&(Math.abs(et-o)<=c&&ht+it<st)-(Math.abs(tt-o)<=c&&!!ht),yt=at&&(Math.abs(xe-l)<=c&&dt+rt<ot)-(Math.abs(Ye-l)<=c&&!!dt);if(!autoScrolls[Y])for(var mt=0;mt<=Y;mt++)autoScrolls[mt]||(autoScrolls[mt]={});(autoScrolls[Y].vx!=pt||autoScrolls[Y].vy!=yt||autoScrolls[Y].el!==te)&&(autoScrolls[Y].el=te,autoScrolls[Y].vx=pt,autoScrolls[Y].vy=yt,clearInterval(autoScrolls[Y].pid),(pt!=0||yt!=0)&&(g=!0,autoScrolls[Y].pid=setInterval((function(){s&&this.layer===0&&Sortable.active._onTouchMove(touchEvt$1);var St=autoScrolls[this.layer].vy?autoScrolls[this.layer].vy*u:0,wt=autoScrolls[this.layer].vx?autoScrolls[this.layer].vx*u:0;typeof H=="function"&&H.call(Sortable.dragged.parentNode[expando],wt,St,n,touchEvt$1,autoScrolls[this.layer].el)!=="continue"||scrollBy(autoScrolls[this.layer].el,wt,St)}).bind({layer:Y}),24))),Y++}while(e.bubbleScroll&&ee!==f&&(ee=getParentAutoScrollElement(ee,!1)));scrolling=g}},30),drop=function(e){var i=e.originalEvent,s=e.putSortable,o=e.dragEl,l=e.activeSortable,c=e.dispatchSortableEvent,u=e.hideGhostForTarget,f=e.unhideGhostForTarget;if(i){var g=s||l;u();var H=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:i,Y=document.elementFromPoint(H.clientX,H.clientY);f(),g&&!g.el.contains(Y)&&(c("spill"),this.onSpill({dragEl:o,putSortable:s}))}};function Revert(){}Revert.prototype={startIndex:null,dragStart:function(e){var i=e.oldDraggableIndex;this.startIndex=i},onSpill:function(e){var i=e.dragEl,s=e.putSortable;this.sortable.captureAnimationState(),s&&s.captureAnimationState();var o=getChild(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(i,o):this.sortable.el.appendChild(i),this.sortable.animateAll(),s&&s.animateAll()},drop};_extends(Revert,{pluginName:"revertOnSpill"});function Remove(){}Remove.prototype={onSpill:function(e){var i=e.dragEl,s=e.putSortable,o=s||this.sortable;o.captureAnimationState(),i.parentNode&&i.parentNode.removeChild(i),o.animateAll()},drop};_extends(Remove,{pluginName:"removeOnSpill"});Sortable.mount(new AutoScrollPlugin);Sortable.mount(Remove,Revert);var LayerSwitcherDOM={_createDraggableElement:function(n,e){let i=[".GPtitle"];checkDsfr()&&i.push(".GPlayerDragNDrop"),navigator.userAgent.match(/chrome|chromium|crios/i),e._sortables=[],i.forEach(s=>{const o=Sortable.create(n,{handle:s,dataIdAttr:"data-sortable-id",draggable:".draggable-layer",ghostClass:"GPghostLayer",animation:200,onEnd:function(l){e._onEndDragAndDropLayerClick(l)}});e._sortables.push(o)})},_moveElement:function(n,e){const i=this._sortables[0];if(["up","down"].includes(e)==!1||typeof n.dataset.sortableId>"u")return!1;let s=n.dataset.sortableId,o=i.toArray(),l=o.indexOf(s);return o.splice(l,1),e=="down"?o.splice(l+1,0,s):e=="up"&&o.splice(l-1,0,s),i.sort(o,!0),this._onEndDragAndDropLayerClick({newIndex:o.indexOf(s)}),!0},_onMoveElement:function(n,e){if(["Enter","Space"].includes(e.code)){const i=n?"up":"down",s=n?"down":"up";e.stopPropagation(),e.preventDefault(),this._moveElement(e.currentTarget.closest(".draggable-layer"),i),window.getComputedStyle(e.currentTarget).visibility=="hidden"?e.currentTarget.parentNode.querySelector(`[data-direction=${s}]`).focus():e.currentTarget.focus()}},_addUID:function(n){var e=this._uid?n+"-"+this._uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPlayerSwitcher"),n.className="GPwidget gpf-widget gpf-mobile-fullscreen gpf-widget-button",n},_createMainLayersShowElement:function(){var n=document.createElement("input");return n.id=this._addUID("GPshowLayersList"),n.type="checkbox",n},_createMainLayersElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPlayersList"),n.className="GPpanel gpf-panel fr-modal",n},_createMainLayersDivElement:function(){var n=document.createElement("div");return n.className="GPpanelBody gpf-panel__body_ls fr-modal__body",n},_createMainLayerListElement:function(){var n=document.createElement("div");return n.className="GPLayerListBody",n.setAttribute("role","list"),n},_createMainPictoElement:function(){var n=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowLayersListPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowLayersListPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-layerswitcher fr-btn fr-btn--tertiary",e.htmlFor=this._addUID("GPshowLayersList"),e.setAttribute("aria-label","Afficher/masquer le gestionnaire de couches"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),document.getElementById(n._addUID("GPshowLayersList")).checked=o,document.getElementById(n._addUID("GPshowLayersList")).checked&&(document.getElementById(n._addUID("GPlayerInfoPanel")).classList.remove("GPlayerInfoPanelOpened","gpf-visible"),document.getElementById(n._addUID("GPlayerInfoPanel")).classList.add("GPlayerInfoPanelClosed","gpf-hidden"),document.getElementById(n._addUID("GPlayerStylePanel")).classList.add("GPlayerStylePanelClosed","gpf-hidden"),document.getElementById(n._addUID("GPlayerStylePanel")).classList.remove("GPlayerStylePanelOpened","gpf-visible")),n.onShowLayerSwitcherClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),document.getElementById(n._addUID("GPshowLayersList")).checked&&(document.getElementById(n._addUID("GPlayerInfoPanel")).classList.remove("GPlayerInfoPanelOpened","gpf-visible"),document.getElementById(n._addUID("GPlayerInfoPanel")).classList.add("GPlayerInfoPanelClosed","gpf-hidden"),document.getElementById(n._addUID("GPlayerStylePanel")).classList.add("GPlayerStylePanelClosed","gpf-hidden"),document.getElementById(n._addUID("GPlayerStylePanel")).classList.remove("GPlayerStylePanelOpened","gpf-visible")),n.onShowLayerSwitcherClick(s)}),e},_createMainCounterLayersElement:function(){var n=document.createElement("span");return n.id=this._addUID("GPlayerCounter"),n.className="GPlayerCounter",n.innerHTML="0",n},_createMainInfoElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPlayerInfoPanel"),n.className="GPpanel GPlayerInfoPanelClosed gpf-panel fr-modal",n},_createMainInfoDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__body fr-modal__body",n},_createMainStyleElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPlayerStylePanel"),n.className="GPpanel GPlayerStylePanelClosed gpf-panel fr-modal",n},_createMainStyleDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__body fr-modal__body",n},_createLayersPanelHeaderElement:function(){var n=document.createElement("div");return n.className="GPpanelHeader gpf-panel__header_ls",n},_createLayersPanelIconElement:function(){var n=document.createElement("label");return n.className="GPpanelIcon gpf-btn-header gpf-btn-icon-layers",n.title="Couches",n},_createLayersPanelTitleElement:function(){var n=document.createElement("div");return n.className="GPpanelTitle gpf-panel__title_ls",n.id=this._addUID("GPlayersHeaderTitle"),n.innerHTML="Couches",n},_createLayersPanelCloseElement:function(){var n=this,e=document.createElement("button");e.id=this._addUID("GPlayersPanelClose"),e.className="GPpanelClose GPlayersPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",e.title="Fermer le panneau";var i=document.createElement("span");return i.className="GPelementHidden gpf-visible fr-mx-1w",i.innerText="Fermer",e.appendChild(i),e.addEventListener?e.addEventListener("click",function(){document.getElementById(n._addUID("GPshowLayersListPicto")).click()},!1):e.attachEvent&&e.attachEvent("onclick",function(){document.getElementById(n._addUID("GPshowLayersListPicto")).click()}),e},_createHeaderButtonsDivElement:function(){var n=document.createElement("div");return n.className="GPbodyHeader",n.id=this._addUID("GPbodyHeader"),n},_createButtonsGroupElement:function(n){n=n||{};let e=n.className?n.className:"",i=n.left?"left":"right",s="";switch(n.size=n.size?n.size:"",n.size.toLowerCase()){case"sm":s="fr-btns-group--sm";break;case"lg":s="fr-btns-group--lg";break}var o=document.createElement("div");o.className=`${e} GPbtnsGroup GPbtnsGroup--${i} fr-btns-group fr-btns-group--${i} fr-btns-group--inline-reverse fr-btns-group--inline ${s} fr-btns-group--icon-left`;let l=n.id!==null?`${e}_ID_${n.id}`:e;return o.id=this._addUID(l),o},_createButtonHeaderElement:function(n){let e=document.createElement("button");if(e.className="fr-btn fr-btn--tertiary gpf-btn ",n.className&&(e.className+=n.className),n.icon&&(e.className+=n.icon),n.label&&(e.innerHTML=n.label),n.title&&(e.title=n.title,e.ariaLabel=n.title),e.id=n.id?n.id:this._addUID("GPtools-"+n.label.toLowerCase()),n.attributes)for(const s in n.attributes){if(!Object.hasOwn(n.attributes,s))continue;const o=n.attributes[s];e.setAttribute(s,o)}let i=this;return e.addEventListener("click",s=>{i._onClickHeaderButtons(s,n.label,n.cb)}),e},_createContainerLayerElement:function(n,e){var i=document.createElement("div");return i.id=this._addUID("GPlayerSwitcher_ID_"+n.id),i.className="GPlayerSwitcher_layer gpf-panel__content fr-modal__content draggable-layer",i.appendChild(this._createBasicToolElement(n,e)),i.appendChild(this._createAdvancedToolDivElement(n)),i.setAttribute("tabindex",0),i.setAttribute("role","listitem"),["click","keydown"].forEach(s=>{i.addEventListener(s,o=>{this._onSelectLayer(o)})}),i},_createBasicToolElement:function(n,e){var i=document.createElement("div");return i.id=this._addUID("GPbasicTools_ID_"+n.id),i.className="GPlayerBasicTools",i.appendChild(this._createBasicToolButtons(n)),i.appendChild(this._createBasicToolTitleElement(n,e)),n.draggable&&i.appendChild(this._createDragNDropElement(n)),i},_createBasicToolButtons:function(n){let e=document.createElement("div");return e.id=this._addUID("GPbasicToolButtons_ID_"+n.id),e.className="GPbasicToolButtons",e.appendChild(this._createAdvancedToolShowElement(n)),e.appendChild(this._createVisibilityElement(n)),n.deletable&&e.appendChild(this._createDeleteElement(n.id)),e},_createBasicToolTitleElement:function(n,e){let i=document.createElement("div");return i.id=this._addUID("GPtitle_ID_"+n.id),i.className="GPtitle",i.appendChild(this._createLayerThumbnailElement(n)),i.appendChild(this._createLayerNameDivElement(n,e)),i},_createLayerNameDivElement:function(n,e){let i=document.createElement("div");return i.id=this._addUID("GPlayerTitle_ID_"+n.id),i.className="GPlayerTitle",i.appendChild(this._createLayerNameElement(n,e)),i.appendChild(this._createLayerProducerElement(n,e)),i},_createLayerThumbnailElement:function(n){let e=document.createElement("img");return e.id=this._addUID("GPtitleImage_ID_"+n.id),e.className="GPtitleImage GPtitleDefaultImage",e.alt="",n.thumbnail&&typeof n.thumbnail=="string"&&n.thumbnail!=="default"&&(e.classList.remove("GPtitleDefaultImage"),e.src=n.thumbnail),e},_createLayerNameElement:function(n,e){var i=document.createElement("div");return i.id=this._addUID("GPname_ID_"+n.id),i.className="GPlayerName",i.title=n.description||n.title,e&&(i.dataset.tooltip=n.description||n.title,ToolTips.active(i),i.title=n.name),i.innerHTML=n.title,n.layer.config&&n.layer.config.serviceParams.id==="GPP:TMS"&&(i.innerHTML=n.description),i},_createLayerProducerElement:function(n,e){let i=document.createElement("div");return i.id=this._addUID("GPlayerProducer_ID_"+n.id),i.className="GPlayerProducer",i.innerHTML=n.producer,e&&(i.dataset.tooltip=n.producer,ToolTips.active(i)),i},_createDragNDropElement:function(n){let e=document.createElement("div");e.id=this._addUID("GPdragndropPicto_ID_"+n.id),e.className="GPelementHidden GPlayerDragNDrop gpf-btn gpf-btn-icon-ls-draggable gpf-btn--tertiary",e.title="Deplacer la couche";let i=this,s=document.createElement("div");s.className="keyboard-navigation";let o=document.createElement("span");o.tabIndex=0,o.dataset.direction="up",o.title=o.ariaLabel="Dplacer la couche vers le haut",o.className="fr-icon-arrow-up-line fr-icon--sm",o.onkeydown=this._onMoveElement.bind(this,!0);let l=document.createElement("span");return l.tabIndex=0,l.dataset.direction="down",l.title=l.ariaLabel="Dplacer la couche vers le bas",l.className="fr-icon-arrow-down-line fr-icon--sm",l.onkeydown=this._onMoveElement.bind(this,!1),s.appendChild(l),s.appendChild(o),e.appendChild(s),e.addEventListener?e.addEventListener("click",function(c){i._onStartDragAndDropLayerClick(c)}):e.attachEvent&&e.attachEvent("onclick",function(c){i._onStartDragAndDropLayerClick(c)}),e},_createVisibilityElement:function(n){var e=typeof n.visibility<"u"?n.visibility:!0;let i=document.createElement("button");i.id=this._addUID("GPvisibilityPicto_ID_"+n.id);let s="gpf-btn-icon-ls-visibility gpf-btn-icon";checkDsfr()&&(s=e?"fr-icon-eye-line":"fr-icon-eye-off-line"),i.className=`GPlayerVisibility gpf-btn ${s} fr-btn fr-btn--sm gpf-btn--tertiary fr-btn--tertiary-no-outline`,i.title="Afficher/masquer la couche",i.setAttribute("tabindex","0"),i.setAttribute("aria-pressed",e),i.setAttribute("type","button");var o=this;let l=function(c){var u=c.target.ariaPressed==="true";c.target.setAttribute("aria-pressed",!u),checkDsfr()&&(i.classList.toggle("fr-icon-eye-off-line",u),i.classList.toggle("fr-icon-eye-line",!u)),o._onVisibilityLayerClick(c)};return i.addEventListener?i.addEventListener("click",l):i.attachEvent&&i.attachEvent("onclick",l),i},_createAdvancedToolShowElement:function(n){let e=document.createElement("button");e.id=this._addUID("GPshowAdvancedTools_ID_"+n.id),e.className="GPshowAdvancedToolPicto GPshowMoreOptionsImage GPshowMoreOptions GPshowLayerAdvancedTools gpf-btn fr-icon-arrow-down-s-line fr-btn--sm fr-btn--tertiary-no-outline",e.title="Plus d'outils",e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button");let i=this;const s=o=>{let l=o.target.ariaPressed==="true";o.target.setAttribute("aria-pressed",!l);let c=document.getElementById(i._addUID("GPadvancedTools_ID_"+n.id));l?(c.classList.replace("GPelementVisible","GPelementHidden"),c.classList.replace("gpf-visible","gpf-hidden")):(c.classList.replace("GPelementHidden","GPelementVisible"),c.classList.replace("gpf-hidden","gpf-visible"))};return e.addEventListener?e.addEventListener("click",s):e.attachEvent&&e.attachEvent("onclick",s),e},_createAdvancedToolDivElement:function(n){let e=document.createElement("div");e.id=this._addUID("GPadvancedTools_ID_"+n.id),e.className="GPelementHidden GPlayerAdvancedTools gpf-hidden";let i=document.createElement("div");i.id=this._addUID("GPopacityContainer_ID_"+n.id),i.className="GPopacityContainer";let s=this._createOpacityElement(n.id,n.opacity);for(let l=0;l<s.length;l++)i.appendChild(s[l]);e.appendChild(i);let o=this._createButtonsGroupElement({className:"GPAdvancedToolBtnsGroup",id:n.id,left:!0,size:"sm"});if(n.advancedTools&&n.advancedTools instanceof Array){const l=this.constructor.switcherButtons;if(!n.advancedTools.length)return;n.advancedTools.forEach(c=>{const u=c.key;if(u&&Object.values(l).includes(u)){let f;switch(u){case l.INFO:f=this._createInformationElement;break;case l.EDIT:f=this._createEditionElement;break;case l.GREYSCALE:f=this._createGreyscaleElement;break;case l.EXTENT:f=this._createExtentElement;break}typeof f=="function"&&o.appendChild(f.call(this,n,c))}else c&&o.appendChild(this._createAdvancedToolElement(n,c))}),e.appendChild(o)}else checkDsfr()?(o.appendChild(this._createInformationElement(n,{})),o.appendChild(this._createEditionElement(n,{})),o.appendChild(this._createGreyscaleElement(n,{})),o.appendChild(this._createExtentElement(n,{}))):(o.appendChild(this._createInformationElement(n,{})),o.appendChild(this._createGreyscaleElement(n,{}))),e.appendChild(o);return e},_setAdvancedToolOptions:function(n,e,i=!0){if(!n)return;let s;e.label?s=e.label.toLowerCase().replaceAll(" ","-"):s=e.icon;const o=`gpf-btn-icon-ls-tools-${s}`;if(e.className&&(n.className+=` ${e.className} `),e.icon&&this._setButtonIconStyle(n,o,e.icon),e.label&&(n.innerHTML=e.label),e.title&&(n.title=e.title,n.ariaLabel=e.title),e.attributes)for(const c in e.attributes){if(!Object.hasOwn(e.attributes,c))continue;const u=e.attributes[c];n.setAttribute(c,u)}n.setAttribute("tabindex","0"),n.setAttribute("type","button");let l=this;return i&&n.addEventListener("click",c=>{l._onClickAdvancedToolsMore(c,e.label,e.cb)}),n},_setButtonIconStyle:function(n,e,i){let s=!1;const o=/(\.|\\)/;if(i&&(i.startsWith("<svg")?(i="data:image/svg+xml;base64,"+btoa(i),s=!0):o.test(i)?s=!0:n.className+=i),s&&(n.classList.add(e),!document.querySelector(`style[data-injected="${e.toLowerCase()}"]`))){const l=document.createElement("style");l.dataset.injected=e.toLowerCase(),l.textContent=`
                    .${e.toLowerCase()}::before {
                        width: 100%;
                        height: 100%;
                        -webkit-mask-image: url('${i}');
                        -webkit-mask-repeat: no-repeat;
                        -webkit-mask-position: center;

                        mask-image: url('${i}');
                        mask-repeat: no-repeat;
                        mask-position: center;
                    }
                `,document.head.appendChild(l)}},_createDeleteElement:function(n){let e=document.createElement("button");e.id=this._addUID("GPremove_ID_"+n);let i="gpf-btn-icon-ls-remove gpf-btn-icon";checkDsfr()&&(i="fr-icon-delete-line"),e.className=`GPlayerRemove gpf-btn ${i} fr-btn fr-btn--sm gpf-btn--tertiary fr-btn--tertiary-no-outline`,e.title="Supprimer la couche",e.layerId=n,e.setAttribute("tabindex","0"),e.setAttribute("type","button");var s=this;return e.addEventListener?e.addEventListener("click",function(o){s._onDropLayerClick(o)}):e.attachEvent&&e.attachEvent("onclick",function(o){s._onDropLayerClick(o)}),e},_createEditionElement:function(n,e){let i=n.id,s=n.editable,o=n.layer.config&&n.layer.config.serviceParams.id==="GPP:TMS",l=o?n.layer.config.styles:null,c=document.createElement("button");c.id=this._addUID("GPedit_ID_"+i),c.layerId=i;let u="gpf-btn-icon-ls-edit gpf-btn-icon",f;checkDsfr()&&(u="fr-icon-pencil-line",f="Style");let g="GPlayerEdit gpf-btn gpf-btn--tertiary fr-btn fr-btn--tertiary-no-outline";const H={icon:u,label:f},Y=Helper.assign(H,e);Y.className=g,e&&e.className&&(Y.className+=` ${e.className}`),this._setAdvancedToolOptions(c,Y,!1),(!s||o&&l.length===1)&&(c.disabled=!0);let ee=this;return o&&l.length>1?c.addEventListener?c.addEventListener("click",function(te){ee._onEditLayerStyleClick(te,l)}):c.attachEvent&&c.attachEvent("onclick",function(te){ee._onEditLayerStyleClick(te,l)}):c.addEventListener?c.addEventListener("click",function(te){ee._onEditLayerClick(te)}):c.attachEvent&&c.attachEvent("onclick",function(te){ee._onEditLayerClick(te)}),c},_createInformationElement:function(n,e){let i=n.id,s=n.title,o=n.description,l=document.createElement("button");l.id=this._addUID("GPinfo_ID_"+i),l.layerId=i;let c="gpf-btn-icon-ls-info gpf-btn-icon",u;checkDsfr()&&(c="fr-icon-information-line",u="Infos");let f="GPlayerInfo GPlayerInfoClosed gpf-btn gpf-btn--tertiary fr-btn fr-btn--tertiary-no-outline";const g={icon:c,label:u},H=Helper.assign(g,e);H.className=f,e&&e.className&&(H.className+=` ${e.className}`),this._setAdvancedToolOptions(l,H,!1),(!s||!o)&&(l.disabled=!0);var Y=this;return l.addEventListener?l.addEventListener("click",function(ee){Y._onOpenLayerInfoClick(ee)}):l.attachEvent&&l.attachEvent("onclick",function(ee){Y._onOpenLayerInfoClick(ee)}),l},_createGreyscaleElement:function(n,e){let i=n.id,s=n.grayable,o=n.grayscale;e=e||{};var l=typeof o<"u"?o:!1;let c=document.createElement("button");c.id=this._addUID("GPgreyscale_ID_"+i),c.layerId=i;let u="gpf-btn-icon-ls-greyscale gpf-btn-icon",f;checkDsfr()&&(u="fr-icon-contrast-line",f="Noir et blanc");let g="GPlayerGreyscale GPlayerGreyscaleOff gpf-btn gpf-btn--tertiary fr-btn fr-btn--tertiary-no-outline";const H={icon:u,label:f},Y=Helper.assign(H,e);Y.className=g,e&&e.className&&(Y.className+=` ${e.className}`),this._setAdvancedToolOptions(c,Y,!1),l&&c.classList.replace("GPlayerGreyscaleOff","GPlayerGreyscaleOn"),c.setAttribute("aria-pressed",l),s||(c.disabled=!0);var ee=this;return c.addEventListener?c.addEventListener("click",function(te){var ne=te.target.ariaPressed==="true";te.target.setAttribute("aria-pressed",!ne),ee._onToggleLayerGreyscaleClick(te)}):c.attachEvent&&c.attachEvent("onclick",function(te){var ne=te.target.ariaPressed==="true";te.target.setAttribute("aria-pressed",!ne),ee._onToggleLayerGreyscaleClick(te)}),c},_createOpacityElement:function(n,e){var i=[],s=document.createElement("div");s.id=this._addUID("GPopacity_ID_"+n),s.className="GPlayerOpacity fr-range fr-range--sm",s.dataset.frJsRange="true",s.title="Opacit";var o=typeof e<"u"?e:1;o=Math.round(o*100),s.style.setProperty("--progress-right",o+"%");var l=document.createElement("input");l.id=this._addUID("GPopacityValueDiv_ID_"+n),l.type="range",l.value=o,l.ariaLabel="Opacit";var c=this;l.addEventListener?l.addEventListener("change",function(g){c._onChangeLayerOpacity(g)}):l.attachEvent&&l.attachEvent("onchange",function(g){c._onChangeLayerOpacity(g)}),l.addEventListener?l.addEventListener("input",function(g){c._onChangeLayerOpacity(g)}):l.attachEvent&&l.attachEvent("oninput",function(g){c._onChangeLayerOpacity(g)}),s.appendChild(l);var u=document.createElement("div");u.id=this._addUID("GPopacityValueDiv_ID_"+n),u.className="GPlayerOpacityValue";var f=document.createElement("span");return f.id=this._addUID("GPopacityValue_ID_"+n),f.className="gpf-range__output fr-range__output gpf-visible",f.innerHTML=o+"%",u.appendChild(f),i.push(s),i.push(u),i},_createExtentElement:function(n,e){let i=n.id,s=document.createElement("button");s.id=this._addUID("GPextent_ID_"+i),s.layerId=i,e=e||{};let o="gpf-btn-icon-ls-extent gpf-btn-icon",l;checkDsfr()&&(o="fr-icon-zoom-in-line",l="Recentrer");let c="GPelementHidden GPlayerExtent gpf-btn--tertiary gpf-btn fr-btn fr-btn--tertiary-no-outline";const u={icon:o,label:l},f=Helper.assign(u,e);f.className=c,e&&e.className&&(f.className+=` ${e.className}`),this._setAdvancedToolOptions(s,f,!1),s.setAttribute("aria-pressed",!0);var g=this;return s.addEventListener?s.addEventListener("click",function(H){var Y=H.target.ariaPressed==="true";H.target.setAttribute("aria-pressed",!Y),g._onZoomToExtentClick(H)}):s.attachEvent&&s.attachEvent("onclick",function(H){var Y=H.target.ariaPressed==="true";H.target.setAttribute("aria-pressed",!Y),g._onZoomToExtentClick(H)}),s},_createAdvancedToolElement:function(n,e){let i=n.id,s=document.createElement("button");const o=e.label.toLowerCase().replaceAll(" ","-");s.id=this._addUID("GPtools-"+o+"_ID_"+i),s.layerId=i,e=e||{};let l=e.icon,c;checkDsfr()&&(c=e.label);let u="GPlayerTools gpf-btn gpf-btn--tertiary fr-btn fr-btn--tertiary-no-outline";const f={icon:l,label:c},g=Helper.assign(f,e);if(g.className=u,e&&e.className&&(g.className+=` ${e.className}`),this._setAdvancedToolOptions(s,g,!1),Object.assign(s.style,e.styles),e.accepted&&e.accepted.length){const Y=n.layer,ee=Y.constructor.name;let te=!0;for(const ne of e.accepted)if(typeof ne=="string"&&ne===ee||ne.prototype instanceof BaseLayer&&Y instanceof ne){te=!1;break}s.disabled=te}var H=this;return s.addEventListener?s.addEventListener("click",Y=>{H._onClickAdvancedToolsMore(Y,e.label,e.cb)}):s.attachEvent&&s.attachEvent("onclick",Y=>{H._onClickAdvancedToolsMore(Y,e.label,e.cb)}),s},_createContainerLayerInfoElement:function(n){var e=document.createElement("div"),i=document.createElement("div");i.className="gpf-panel__header_ls",e.appendChild(i);var s=document.createElement("label");s.className="GPlayerInfo gpf-btn-header gpf-btn-icon-ls-info",s.title="Informations",i.appendChild(s);var o=document.createElement("div");o.id=this._addUID("GPlayerInfoTitle"),o.innerHTML=n.title,o.className="gpf-panel__title_ls",i.appendChild(o);var l=document.createElement("button");l.id=this._addUID("GPlayerInfoClose"),l.className="GPpanelClose GPlayersPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",l.title="Fermer la fentre";var c=this,u=function(){document.getElementById(c._addUID("GPlayerInfoPanel")).classList.add("GPlayerInfoPanelClosed","gpf-hidden"),document.getElementById(c._addUID("GPlayerInfoPanel")).classList.remove("GPlayerInfoPanelOpened","gpf-visible"),document.getElementById(n.id).classList.add("GPlayerInfoClosed"),document.getElementById(n.id).classList.remove("GPlayerInfoOpened")};l.addEventListener?l.addEventListener("click",u):l.attachEvent&&l.attachEvent("onclick",u),this.addEventListener("layerswitcher:remove",yt=>{parseInt(n.id.split("-")[0].split("GPinfo_ID_")[1])===yt.layer.id&&(document.getElementById(c._addUID("GPlayerInfoPanel")).classList.add("GPlayerInfoPanelClosed","gpf-hidden"),document.getElementById(c._addUID("GPlayerInfoPanel")).classList.remove("GPlayerInfoPanelOpened","gpf-visible"))}),i.appendChild(l),e.appendChild(i);var f=document.createElement("div");if(f.id=this._addUID("GPlayerInfoContent"),f.className="gpf-panel__content fr-modal__content",e.appendChild(f),n.quicklookUrl){var g=document.createElement("div");g.id=this._addUID("GPlayerInfoQuicklook"),g.title="Afficher un aperu de la couche";var H=document.createElement("a");H.href=n.quicklookUrl,H.appendChild(g),f.appendChild(H)}var Y=document.createElement("div");if(Y.id=this._addUID("GPlayerInfoDescription"),Y.innerHTML=n.description,f.appendChild(Y),n.metadata){var ee=document.createElement("div");ee.id=this._addUID("GPlayerInfoMetadata");var te=document.createElement("div");te.className="GPlayerInfoSubtitle",te.innerHTML="Mtadonnes",ee.appendChild(te);for(var ne=0;ne<n.metadata.length;ne++){var Ye=n.metadata[ne].url,xe=document.createElement("div");xe.className="GPlayerInfoLink";var tt=document.createElement("a");tt.href=Ye,tt.innerHTML=Ye,xe.appendChild(tt),ee.appendChild(xe)}n.metadata.length!==0&&f.appendChild(ee)}if(n.legends){var et=document.createElement("div");et.id=this._addUID("GPlayerInfoLegend");var it=document.createElement("div");it.className="GPlayerInfoSubtitle",it.innerHTML="Lgende",et.appendChild(it);for(var rt={},nt=n.maxScaleDenominator||56e7,at=0;at<n.legends.length;at++){var st=n.legends[at].minScaleDenominator;if(st){var ot=st.toString();st=Math.round(parseInt(ot.substring(0,3),10)/10)*Math.pow(10,ot.length-2)}else st=270;rt[st]=n.legends[at]}for(var ut in rt)if(rt.hasOwnProperty(ut)){var ht=rt[ut].url;if(typeof ht=="string"&&ht.toLowerCase().indexOf("nolegend.jpg")===-1){var dt=document.createElement("div");dt.className="GPlayerInfoLink",nt=rt[ut].maxScaleDenominator||nt;var pt=document.createElement("a");pt.className="fr-link",pt.href=ht,pt.target="_blank",pt.innerHTML="Du 1/"+ut+" au 1/"+nt,dt.appendChild(pt),et.appendChild(dt)}else delete rt[ut]}Object.keys(rt).length!==0&&f.appendChild(et)}return e},_createContainerLayerStyleElement:function(n){var e=document.createElement("div"),i=document.createElement("div");i.className="gpf-panel__header_ls",e.appendChild(i);var s=document.createElement("label");s.className="GPlayerStyle gpf-btn-header gpf-btn-icon-ls-info",s.title="Informations",i.appendChild(s);var o=document.createElement("div");o.id=this._addUID("GPlayerStyleTitle"),o.innerHTML="Options de style",o.className="gpf-panel__title_ls",i.appendChild(o);var l=document.createElement("button");l.id=this._addUID("GPlayerStyleClose"),l.className="GPpanelClose GPlayersPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",l.title="Fermer la fentre";var c=this,u=function(){document.getElementById(c._addUID("GPlayerStylePanel")).classList.add("GPlayerStylePanelClosed","gpf-hidden"),document.getElementById(c._addUID("GPlayerStylePanel")).classList.remove("GPlayerStylePanelOpened","gpf-visible"),document.getElementById(n.div).classList.add("GPlayerStyleClosed"),document.getElementById(n.div).classList.remove("GPlayerStyleOpened")};l.addEventListener?l.addEventListener("click",u):l.attachEvent&&l.attachEvent("onclick",u),this.addEventListener("layerswitcher:remove",ne=>{parseInt(n.id.split("-")[0].split("GPinfo_ID_")[1])===ne.layer.id&&(document.getElementById(c._addUID("GPlayerStylePanel")).classList.add("GPlayerStylePanelClosed","gpf-hidden"),document.getElementById(c._addUID("GPlayerStylePanel")).classList.remove("GPlayerStylePanelOpened","gpf-visible"))}),i.appendChild(l),e.appendChild(i);var f=document.createElement("div");f.id=this._addUID("GPlayerStyleContent"),f.className="gpf-panel__content fr-modal__content",e.appendChild(f);var g=document.createElement("div");g.id=this._addUID("GPlayerStyleList");const H=/^([0-9a-f]{8}(-[0-9a-f]{4}){3}-[0-9a-f]{12}_)/i;for(let ne=0;ne<n.styles.length;ne++){var Y=n.styles[ne],o=Y.title?Y.title:Y.name;o=o.replace(H,"");var ee=document.createElement("div");ee.className="gpf-flex gpf-radio-group fr-radio-group fr-my-1w";var te=document.createElement("input");te.type="radio",te.name=this._addUID("styleradio_ID_"+n.id),te.id=this._addUID("styleradio_"+Y.name+"_ID_"+n.id),te.value=Y.url,te.dataset.name=Y.name;var s=document.createElement("label");s.className="gpf-label fr-label",s.innerText=o,s.htmlFor=this._addUID("styleradio_"+Y.name+"_ID_"+n.id),ee.appendChild(te),ee.appendChild(s),g.appendChild(ee),n.layerInfo.layer.styleUrl===Y.url&&(te.checked=!0),te.addEventListener("change",tt=>{c._onChangeStyleLayerClick(tt)})}return f.appendChild(g),e}},logger$A=LoggerByDefault.getLogger("layerswitcher");const Ui=class Ui extends ControlExtended{constructor(e){e=e||{};var i=e.options||{},s=e.layers||[];if(super(i),!(this instanceof Ui))throw new TypeError("ERROR CLASS_CONSTRUCTOR");if(!Array.isArray(s))throw new Error("ERROR WRONG_TYPE : layers should be an array");if(typeof i!="object")throw new Error("ERROR WRONG_TYPE : options should be an object");return this.CLASSNAME="LayerSwitcher",this._initialize(i,s),this.container=this._initContainer(i),this.element?this.element.appendChild(this.container):this.element=this.container,this}setMap(e){if(e)this._addMapLayers(e),this.collapsed||this._showLayerSwitcherButton.setAttribute("aria-pressed",!0),this._listeners.onMoveListener=e.on("moveend",()=>this._onMapMoveEnd(e)),this._listeners.onAddListener=e.getLayers().on("add",s=>{logger$A.debug("LayerSwitcher:onAddListener",s);var o=s.element,l;o.hasOwnProperty("gpLayerId")?l=o.gpLayerId:(l=this._layerId,o.gpLayerId=l,this._layerId++),this._layers[l]||this.addLayer(o)}),this._listeners.onRemoveListener=e.getLayers().on("remove",s=>{logger$A.debug("LayerSwitcher:onRemoveListener",s);var o=s.element,l=o.gpLayerId;this._layers[l]&&this.removeLayer(o)});else{unByKey(this._listeners.onMoveListener),unByKey(this._listeners.onAddListener),unByKey(this._listeners.onRemoveListener);for(var i=this._layersOrder.length-1;i>=0;i--);}super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter"),this.options.allowTooltips&&ToolTips.init()}addLayer(e,i){var s=this.getMap();if(i=i||e.config||{},!e){logger$A.log("[ERROR] LayerSwitcher:addLayer - missing layer parameter");return}var o=e.gpLayerId;if(typeof o>"u"){logger$A.trace("[WARN] LayerSwitcher:addLayer - configuration cannot be set for this layer (layer id not found)",e);return}var l=!1;if(s.getLayers().forEach(it=>{it.gpLayerId===o&&(l=!0)}),!l){logger$A.log("[ERROR] LayerSwitcher:addLayer - configuration cannot be set for ",e," layer (layer is not in map.getLayers() )");return}if(this._layers[o]){for(var ne in i)i.hasOwnProperty(ne)&&(this._layers[o][ne]=i[ne]);if(i.title){var Ye=document.getElementById(this._addUID("GPname_ID_"+o));Ye&&(Ye.innerHTML=i.title,Ye.title=i.description||i.title)}if(i.producer){let it=document.getElementById(this._addUID("GPlayerProducer_ID_"+o));it?it.innerHTML=i.producer:this.setLayerProducer(o,i.producer)}var xe=document.getElementById(this._addUID("GPinfo_ID_"+o));if(!document.getElementById(this._addUID("GPinfo_ID_"+o))&&i.description){var tt=document.getElementById(this._addUID("GPadvancedTools_ID_"+o));tt&&tt.appendChild(this._createInformationElement({id:o}))}xe&&xe.className==="GPlayerInfoOpened"&&document.getElementById(this._addUID("GPlayerInfoPanel")).classList.add("GPlayerInfoPanelClosed","gpf-hidden")}else{var c=this.getLayerInfo(e)||{},u=e.getOpacity(),f=e.getVisible(),g=e.get("grayscale"),H=e.get("locked"),Y=this.isInRange(e,s),ee={layer:e,id:o,name:e.name,service:e.service,type:"",opacity:u??1,visibility:f??!0,grayscale:g,locked:H,inRange:Y??!0,producer:i.producer!=null?i.producer:c._producer||null,title:i.title!=null?i.title:c._title||o,thumbnail:i.thumbnail!=null?i.thumbnail:c._thumbnail||null,description:i.description||c._description||null,legends:i.legends||c._legends||[],metadata:i.metadata||c._metadata||[],quicklookUrl:i.quicklookUrl||c._quicklookUrl||null};this._layers[o]=ee;var te=this._createLayerDiv(ee);this._layers[o].div=te,e.getZIndex&&e.getZIndex()!==0&&typeof e.getZIndex()<"u"||e._forceNullzIndex?this._updateLayersOrder():(this._layersOrder.unshift(ee),this._lastZIndex++,e.setZIndex(this._lastZIndex),te.dataset.sortableId=this._layerId,this._layerListContainer.insertBefore(te,this._layerListContainer.firstChild)),this._listeners.updateLayerOpacity=e.on("change:opacity",it=>this._updateLayerOpacity(it)),this._listeners.updateLayerVisibility=e.on("change:visible",it=>this._updateLayerVisibility(it)),this._listeners.updateLayerGrayScale=e.on("change:grayscale",it=>this._updateLayerGrayScale(it)),this._listeners.updateLayerLocked=e.on("change:locked",it=>this._updateLayerLocked(it)),this._listeners.updateProperties=e.on("propertychange",it=>this._updateGenericProperty(it)),this._layers[o].onZIndexChangeEvent==null&&(this._layers[o].onZIndexChangeEvent=e.on("change:zIndex",()=>this._updateLayersOrder()))}this._updateLayerCounter();var et=this;setTimeout(()=>{et._updateLayerGrayScale({target:{gpLayerId:o}})},0),this.dispatchEvent({type:this.ADD_LAYER_EVENT,layer:this._layers[o]})}removeLayer(e){if(e){unByKey(this._listeners.updateLayerOpacity),unByKey(this._listeners.updateLayerVisibility),unByKey(this._listeners.updateLayerGrayScale),unByKey(this._listeners.updateLayerLocked),unByKey(this._listeners.updateProperties),logger$A.trace(e);var i=e.gpLayerId,s=document.getElementById(this._addUID("GPinfo_ID_"+i));s&&s.className==="GPlayerInfoOpened"&&document.getElementById(this._addUID("GPlayerInfoPanel")).classList.add("GPlayerInfoPanelClosed","gpf-hidden");var o=document.getElementById(this._addUID("GPedit_ID_"+i));o&&o.classList.contains("GPlayerStyleOpened")&&document.getElementById(this._addUID("GPlayerStylePanel")).classList.add("GPlayerStylePanelClosed","gpf-hidden");var l=document.getElementById(this._addUID("GPlayerSwitcher_ID_"+i));l&&this._layerListContainer.removeChild(l);var c=Math.abs(e.getZIndex()-this._lastZIndex);this._layersOrder.splice(c,1),this._lastZIndex--;for(var u=this._layersOrder,f=0;f<u.length;f++)u[f].layer.setZIndex(this._lastZIndex-f);this.dispatchEvent({type:this.REMOVE_LAYER_EVENT,layer:this._layers[i]}),e===this.getSelectedLayer()&&this.setSelectedLayer(),delete this._layers[i],this._updateLayerCounter()}}lockLayer(e,i){if(e){var s=e.gpLayerId,o=document.getElementById(this._addUID("GPlayerSwitcher_ID_"+s));o&&(i?o.setAttribute("disabled",!0):o.removeAttribute("disabled")),e.set("locked",i),this.dispatchEvent({type:this.LOCK_LAYER_EVENT,layer:this._layers[s],locked:i})}}setCollapsed(e){if(e===void 0){logger$A.log("[ERROR] LayerSwitcher:setCollapsed - missing collapsed parameter");return}var i=!document.getElementById(this._addUID("GPshowLayersList")).checked;e&&i||!e&&!i||(i||(document.getElementById(this._addUID("GPlayerInfoPanel")).classList.add("GPlayerInfoPanelClosed","gpf-hidden"),document.getElementById(this._addUID("GPlayerStylePanel")).classList.add("GPlayerStylePanelClosed","gpf-hidden")),document.getElementById(this._addUID("GPshowLayersList")).checked=!e)}getCollapsed(){return this.collapsed}setRemovable(e,i){if(e){var s=e.gpLayerId;if(s==null){logger$A.log("[LayerSwitcher:setRemovable] layer should be added to map before calling setRemovable method");return}var o=document.getElementById(this._addUID("GPremove_ID_"+s));o&&(i===!1?o.style.display="none":i===!0&&(o.style.display="block"))}}getContainer(){return this.container}forget(){unByKey(this._listeners.onAddListener)}listen(){var e=this.getMap();e&&(this._listeners.onAddListener=e.getLayers().on("add",i=>{logger$A.debug("LayerSwitcher:onAddListener",i);var s=i.element,o;s.hasOwnProperty("gpLayerId")?o=s.gpLayerId:(o=this._layerId,s.gpLayerId=o,this._layerId++),this._layers[o]||this.addLayer(s)}))}_initialize(e,i){this.options={id:"",collapsed:!0,draggable:!1,counter:!1,panel:!1,gutter:!1,allowEdit:!0,allowGrayScale:!0,allowDraggable:!0,allowDelete:!0,allowTooltips:!1,headerButtons:[],advancedTools:null},Helper.assign(this.options,e),this.options.layers=i,this._uid=this.options.id||SelectorID.generate(),this._layers={},this._layersOrder=[],this._layersIndex={},this._lastZIndex=0,this._layerId=0,this.collapsed=this.options.collapsed!==void 0?this.options.collapsed:!0,this._layerListContainer=null,this._listeners={};for(var s=0;s<i.length;s++){var o=i[s].layer;if(o){var l;o.hasOwnProperty("gpLayerId")?l=o.gpLayerId:(l=this._layerId,o.gpLayerId=l,this._layerId++);var c=i[s].config||{},u=this.getLayerInfo(o),f=o.getOpacity(),g=o.getVisible(),H=o.get("grayscale"),Y={layer:o,id:l,name:o.name,service:o.service,opacity:f??1,visibility:g??!0,grayscale:H,title:c.title||u._title,description:c.description||u._description,legends:c.legends||u._legends,metadata:c.metadata||u._metadata,quicklookUrl:c.quicklookUrl||u._quicklookUrl,thumbnail:c.thumbnail||u._thumbnail,producer:c.producer||u._producer};this._layers[l]=Y}}this._layerListContainer=null,this._layerSwitcherCounter=null,this._showLayerSwitcherButton=null,this.PROPERTY_CHANGE_EVENT="layerswitcher:propertychange",this.ADD_LAYER_EVENT="layerswitcher:add",this.REMOVE_LAYER_EVENT="layerswitcher:remove",this.LOCK_LAYER_EVENT="layerswitcher:lock",this.EXTENT_LAYER_EVENT="layerswitcher:extent",this.EDIT_LAYER_EVENT="layerswitcher:edit",this.CUSTOM_LAYER_EVENT="layerswitcher:custom",this.HEADER_BUTTON_EVENT="layerswitcher:header:button",this.CHANGE_LAYER_OPACITY_EVENT="layerswitcher:change:opacity",this.CHANGE_LAYER_VISIBILITY_EVENT="layerswitcher:change:visibility",this.CHANGE_LAYER_GRAYSCALE_EVENT="layerswitcher:change:grayscale",this.CHANGE_LAYER_LOCKED_EVENT="layerswitcher:change:locked",this.CHANGE_LAYER_SELECTED_EVENT="layerswitcher:change:selected"}_initContainer(){var e=this._createMainContainerElement(),i=this._createMainLayersShowElement();e.appendChild(i),this.collapsed?this.collapsed=!0:(i.checked="checked",this.collapsed=!1);var s=this,o=function(et){this.collapsed=!et.target.checked,this.dispatchEvent("change:collapsed")};i.addEventListener("click",function(et){o.call(s,et)});var l=this._showLayerSwitcherButton=this._createMainPictoElement();if(e.appendChild(l),e.classList.add("GplayerSwitcher-counterRemoved"),this.options.counter){e.classList.remove("GplayerSwitcher-counterRemoved"),e.classList.add("GplayerSwitcher-counterAdded");var c=this._layerSwitcherCounter=this._createMainCounterLayersElement();l.appendChild(c)}var u=this._createMainLayersElement();if(e.appendChild(u),this.options.panel){var f=this._createLayersPanelHeaderElement();u.appendChild(f);var g=this._createLayersPanelIconElement();f.appendChild(g);var H=this._createLayersPanelTitleElement();f.appendChild(H);var Y=this._createLayersPanelCloseElement();f.appendChild(Y)}var ee=this._createMainLayersDivElement();if(u.appendChild(ee),this.options.headerButtons.length){let et=this._createHeaderButtonsDivElement(),it=this._createButtonsGroupElement({className:"GPbodyHeaderBtnsGroup",size:"sm"});this.options.headerButtons.forEach(rt=>{let nt=this._createButtonHeaderElement(rt);it.appendChild(nt)}),et.appendChild(it),ee.appendChild(et)}var te=this._layerListContainer=this._createMainLayerListElement();ee.appendChild(te),this._createDraggableElement(te,this);var ne=this._createMainInfoElement(),Ye=this._createMainInfoDivElement();ne.appendChild(Ye),e.appendChild(ne);var xe=this._createMainStyleElement(),tt=this._createMainStyleDivElement();return xe.appendChild(tt),e.appendChild(xe),e}_addMapLayers(e){this._layersIndex={},e.getLayers().forEach(f=>{var g=null;f.hasOwnProperty("gpLayerId")?g=f.gpLayerId:(g=this._layerId,f.gpLayerId=g,this._layerId++);var H=this.getLayerInfo(f)||{};if(this._layers[g])this._layers[g].opacity=f.getOpacity(),this._layers[g].visibility=f.getVisible(),this._layers[g].grayscale=f.get("grayscale"),this._layers[g].locked=f.get("locked"),this._layers[g].inRange=this.isInRange(f,e);else{var Y=f.getOpacity(),ee=f.getVisible(),te=f.get("grayscale"),ne=f.get("locked"),Ye=this.isInRange(f,e),xe={layer:f,id:g,name:f.name,service:f.service,opacity:Y??1,visibility:ee??!0,grayscale:te,locked:ne,inRange:Ye??!0,producer:H._producer||null,thumbnail:H._thumbnail||null,title:H._title||g,description:H._description||null,legends:H._legends||[],metadata:H._metadata||[],quicklookUrl:H._quicklookUrl||null};this._layers[g]=xe}this._updateLayerCounter(),this._listeners.updateLayerOpacity=f.on("change:opacity",it=>this._updateLayerOpacity(it)),this._listeners.updateLayerVisibility=f.on("change:visible",it=>this._updateLayerVisibility(it)),this._listeners.updateLayerGrayScale=f.on("change:grayscale",it=>this._updateLayerGrayScale(it)),this._listeners.updateLayerLocked=f.on("change:locked",it=>this._updateLayerLocked(it)),this._listeners.updateProperties=f.on("propertychange",it=>this._updateGenericProperty(it));var tt=this;if(setTimeout(()=>{tt._updateLayerGrayScale({target:{gpLayerId:g}})},0),f.getZIndex!==void 0){var et=f.getZIndex()||0;(!this._layersIndex[et]||!Array.isArray(this._layersIndex[et]))&&(this._layersIndex[et]=[]),this._layersIndex[et].push(this._layers[g])}});for(var i in this._layersIndex)if(this._layersIndex.hasOwnProperty(i))for(var s=this._layersIndex[i],o=0;o<s.length;o++)this._layersOrder.unshift(s[o]),this._lastZIndex++,s[o].layer.setZIndex(this._lastZIndex),this._layers[s[o].layer.gpLayerId].onZIndexChangeEvent==null&&(this._layers[s[o].layer.gpLayerId].onZIndexChangeEvent=s[o].layer.on("change:zIndex",()=>this._updateLayersOrder()));for(var l=0;l<this._layersOrder.length;l++){var c=this._layersOrder[l],u=this._createLayerDiv(c);u.dataset.sortableId=c.id,this._layerListContainer.querySelector("#"+u.id)||this._layerListContainer.appendChild(u),this._layers[c.id].div=u}}_createLayerDiv(e){var i=e.legends&&e.legends.length!==0,s=e.metadata&&e.metadata.length!==0,o=e.quicklookUrl;(i||s||o)&&(e.displayInformationElement=!0),e.editable=!1,this.options.allowEdit&&(e.layer instanceof VectorLayer||e.layer instanceof VectorTileLayer)&&(e.editable=!0),e.grayable=!1,this.options.allowGrayScale&&(e.layer instanceof TileLayer||e.layer instanceof VectorTileLayer)&&(e.grayable=!0),e.draggable=!1,this.options.allowDraggable&&(e.draggable=!0),e.deletable=!1,this.options.allowDelete&&(e.deletable=!0),e.advancedTools=this.options.advancedTools;var l=this._createContainerLayerElement(e,this.options.allowTooltips);return e.inRange||l.classList.add("outOfRange"),l}onShowLayerSwitcherClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen();var i=this._showLayerSwitcherButton.ariaPressed;this.collapsed=i!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position)}_updateLayerCounter(){this._layerSwitcherCounter&&(this._layerSwitcherCounter.innerHTML=Object.keys(this._layers).length)}_onChangeLayerOpacity(e){e.target.parentNode.style.setProperty("--progress-right",e.target.value+"%");var i=e.target.id,s=SelectorID.index(i),o=this._layers[s].layer,l=e.target.value,c=document.getElementById(this._addUID("GPopacityValue_ID_"+s));c.innerHTML=l+"%",o.setOpacity(l/100)}_updateLayerOpacity(e){var i=e.target.getOpacity();i>1&&(i=1),i<0&&(i=0);var s=e.target.gpLayerId,o=document.getElementById(this._addUID("GPopacityValueDiv_ID_"+s));o&&(o.value=Math.round(i*100));var l=document.getElementById(this._addUID("GPopacityValue_ID_"+s));l&&(l.innerHTML=Math.round(i*100)+"%"),this.dispatchEvent({type:this.CHANGE_LAYER_OPACITY_EVENT,opacity:i,layer:this._layers[s]})}_onVisibilityLayerClick(e){var i=e.target.id,s=SelectorID.index(i),o=this._layers[s].layer;o.setVisible(e.target.ariaPressed==="true")}_updateLayerVisibility(e){var i=e.target.getVisible(),s=e.target.gpLayerId,o=document.getElementById(this._addUID("GPvisibilityPicto_ID_"+s));o&&(o.ariaPressed=i),this.dispatchEvent({type:this.CHANGE_LAYER_VISIBILITY_EVENT,visibility:i,layer:this._layers[s]})}_onChangeStyleLayerClick(e){var i=e.target.id,l=SelectorID.index(i),s=this._layers[l].layer;s.set("grayscale",!1);var o=e.target.id,l=SelectorID.index(o),c=document.getElementById(this._addUID("GPgreyscale_ID_"+l));c&&(c.classList.add("GPlayerGreyscaleOff"),c.classList.remove("GPlayerGreyscaleOn")),s.styleUrl=e.target.value,s.styleName=e.target.dataset.name,s.setStyleMapBox(),this.dispatchEvent({type:"layerswitcher:change:style",name:s.styleName,url:s.styleUrl,layer:this._layers[l]})}_updateLayersOrder(){var e=this.getMap();if(e){this._layersIndex={};var i,s;e.getLayers().forEach(g=>{s=g.gpLayerId,unByKey(this._layers[s].onZIndexChangeEvent),this._layers[s].onZIndexChangeEvent=null,i=null,g.getZIndex!==void 0&&(i=g.getZIndex(),(!this._layersIndex[i]||!Array.isArray(this._layersIndex[i]))&&(this._layersIndex[i]=[]),this._layersIndex[i].push(this._layers[s]))}),this._lastZIndex=0,this._layersOrder=[];for(var o in this._layersIndex)if(this._layersIndex.hasOwnProperty(o))for(var l=this._layersIndex[o],c=0;c<l.length;c++)this._layersOrder.unshift(l[c]),this._lastZIndex++,this._layers[l[c].layer.gpLayerId].onZIndexChangeEvent==null&&(this._layers[l[c].layer.gpLayerId].onZIndexChangeEvent=l[c].layer.on("change:zIndex",()=>this._updateLayersOrder()));if(this._layerListContainer){for(let g=0;g<this._layerListContainer.childNodes.length;g++){const H=this._layerListContainer.childNodes[g];H.id!==""&&H.remove()}for(var u=0;u<this._layersOrder.length;u++){var f=this._layersOrder[u];this._layerListContainer.appendChild(f.div)}}else logger$A.log("[ol.control.LayerSwitcher] _updateLayersOrder : layer list container not found to update layers order ?!")}}_onOpenLayerInfoClick(e){var i=e.target.id,s=SelectorID.index(i),o=this._layers[s],l,c,u=document.getElementById(e.target.id);if(u.classList.contains("GPlayerInfoOpened")){u.classList.remove("GPlayerInfoOpened"),u.classList.add("GPlayerInfoClosed"),l=document.getElementById(this._addUID("GPlayerInfoPanel")),l.classList.remove("GPlayerInfoPanelOpened","gpf-visible"),l.classList.add("GPlayerInfoPanelClosed","gpf-hidden"),c=document.getElementById(this._addUID("GPlayerInfoContent")),c&&c.parentNode.remove();return}u.classList.contains("GPlayerInfoClosed")&&(u.classList.remove("GPlayerInfoClosed"),u.classList.add("GPlayerInfoOpened")),l=document.getElementById(this._addUID("GPlayerInfoPanel")),l.classList.remove("GPlayerInfoPanelClosed","gpf-hidden"),l.classList.add("GPlayerInfoPanelOpened","gpf-visible"),c=document.getElementById(this._addUID("GPlayerInfoContent")),c&&c.parentNode.remove();var f={id:i,title:o.title,description:o.description,quicklookUrl:o.quicklookUrl,metadata:o.metadata,legends:o.legends},g=o.layer.getMaxResolution();g===1/0?f._maxScaleDenominator=56e7:f._maxScaleDenominator=Math.round(g/28e-5);var H=this._createContainerLayerInfoElement(f);l.firstChild.appendChild(H)}_onEditLayerStyleClick(e,i){var s=e.target.id,o=SelectorID.index(s),l=this._layers[o],c,u,f=document.getElementById(e.target.id);if(f.classList.contains("GPlayerStyleOpened")){f.classList.remove("GPlayerStyleOpened"),f.classList.add("GPlayerStyleClosed"),c=document.getElementById(this._addUID("GPlayerStylePanel")),c.classList.remove("GPlayerStylePanelOpened","gpf-visible"),c.classList.add("GPlayerStylePanelClosed","gpf-hidden"),u=document.getElementById(this._addUID("GPlayerStyleContent")),u&&u.parentNode.remove();return}f.classList.contains("GPlayerStyleClosed")&&(f.classList.remove("GPlayerStyleClosed"),f.classList.add("GPlayerStyleOpened")),c=document.getElementById(this._addUID("GPlayerStylePanel")),c.classList.remove("GPlayerStylePanelClosed","gpf-hidden"),c.classList.add("GPlayerStylePanelOpened","gpf-visible"),u=document.getElementById(this._addUID("GPlayerStyleContent")),u&&u.parentNode.remove();var g={id:o,div:s,styles:i,layerInfo:l},H=l.layer.getMaxResolution();H===1/0?g._maxScaleDenominator=56e7:g._maxScaleDenominator=Math.round(H/28e-5);var Y=this._createContainerLayerStyleElement(g);c.firstChild.appendChild(Y)}_onDropLayerClick(e){var i=e.target.id,s=SelectorID.index(i),o=this._layers[s].layer;this.getMap().getLayers().remove(o)}_onEditLayerClick(e){var i=e.target.id,s=SelectorID.index(i),o=this._layers[s],l=this._layers[s].layer;this.dispatchEvent({type:this.EDIT_LAYER_EVENT,layer:l,options:o})}_onEndDragAndDropLayerClick(e){logger$A.trace(e);var i=this.getMap(),s=document.querySelectorAll("div.GPlayerSwitcher_layer"),o=s.length;this._layersOrder=[];for(var l=0;l<s.length;l++){var c=s[l].id,u=SelectorID.index(c),f=this._layers[u].layer;unByKey(this._layers[u].onZIndexChangeEvent),this._layers[u].onZIndexChangeEvent=null,f.setZIndex&&(f.setZIndex(o),this._layersOrder.push(this._layers[u]),o--),this._layers[u].onZIndexChangeEvent==null&&(this._layers[u].onZIndexChangeEvent=f.on("change:zIndex",()=>this._updateLayersOrder()))}i.updateSize(),this.dispatchEvent({type:"layerswitcher:change:position",position:e.newIndex,layer:this._layersOrder[e.newIndex],layers:this._layersOrder})}_onStartDragAndDropLayerClick(e){logger$A.debug(e)}_updateLayerGrayScale(e){function i(xe){xe.crossOrigin="anonymous";var tt=document.createElement("canvas"),et=tt.getContext("2d");xe.width=xe.width||256,xe.height=xe.height||256,tt.width=xe.width,tt.height=xe.height,et.drawImage(xe,0,0);for(var it=et.getImageData(0,0,xe.width,xe.height),rt=it.data,nt=0;nt<rt.length;nt+=4){var at=(rt[nt]+rt[nt+1]+rt[nt+2])/3;rt[nt]=at,rt[nt+1]=at,rt[nt+2]=at}return et.putImageData(it,0,0),tt.toDataURL()}function s(xe,tt){var et=i(xe);xe.src="",xe.src=et}function o(xe){xe.image.getImage().crossOrigin="Anonymous"}function l(xe){xe.tile.getImage().crossOrigin="Anonymous"}function c(xe){s(xe.image.getImage(),xe.target)}function u(xe){s(xe.tile.getImage(),xe.target)}function f(xe){if(!xe||typeof xe!="string"||!xe.startsWith("#"))return xe;const tt=parseInt(xe.slice(1,3),16),et=parseInt(xe.slice(3,5),16),it=parseInt(xe.slice(5,7),16),nt=Math.round(.3*tt+.59*et+.11*it).toString(16).padStart(2,"0");return`#${nt}${nt}${nt}`}async function g(xe){var tt=await Y(xe);tt.layers.forEach(et=>{et.paint&&Object.keys(et.paint).forEach(it=>{let rt=et.paint[it];if(Array.isArray(rt)&&rt[0]==="interpolate"&&rt[2]==="zoom")for(let nt=4;nt<rt.length;nt+=2)rt[nt]=f(rt[nt]);else if(Array.isArray(rt)&&rt[0]==="step")for(let nt=2;nt<rt.length;nt+=2)rt[nt]=f(rt[nt]);else if(rt instanceof Object&&rt.stops)for(let nt=0;nt<rt.stops.length;nt+=1)rt.stops[nt][1]=f(rt.stops[nt][1]);else et.paint[it]=f(rt)})}),applyStyle(xe,tt)}async function H(xe){var tt=await Y(xe);applyStyle(xe,tt)}async function Y(xe){return await(await fetch(xe.styleUrl)).json()}var ee=e.target.gpLayerId,te=this._layers[ee].layer,ne=te.getSource();if(!(ne instanceof ImageSource||ne instanceof TileWMS||ne instanceof WMTS$1||ne instanceof VectorTile)){console.warn("Greyscale only implemented for raster and vector tiles");return}var Ye=te.get("grayscale");Ye?ne instanceof VectorTile?g(te):ne instanceof ImageSource?(ne.loadstartListenerKey=ne.on("imageloadstart",o),ne.loadendListenerKey=ne.on("imageloadend",c)):(ne.loadstartListenerKey=ne.on("tileloadstart",l),ne.loadendListenerKey=ne.on("tileloadend",u)):ne instanceof VectorTile?H(te):(unByKey(ne.loadstartListenerKey),unByKey(ne.loadendListenerKey),ne.loadstartListenerKey=null,ne.loadendListenerKey=null),ne instanceof VectorTile||ne.refresh(),this.dispatchEvent({type:this.CHANGE_LAYER_GRAYSCALE_EVENT,grayscale:Ye,layer:this._layers[ee]})}_onToggleLayerGreyscaleClick(e){console.trace(e);var i=e.target.id,s=SelectorID.index(i),o=this._layers[s].layer,l=!0;e.target.classList.contains("GPlayerGreyscaleOff")?(e.target.classList.remove("GPlayerGreyscaleOff"),e.target.classList.add("GPlayerGreyscaleOn")):(e.target.classList.add("GPlayerGreyscaleOff"),e.target.classList.remove("GPlayerGreyscaleOn"),l=!1),o.set("grayscale",l)}_updateLayerLocked(e){var i=e.target.gpLayerId,s=this._layers[i].layer,o=s.get("locked"),l=document.getElementById(this._addUID("GPlayerSwitcher_ID_"+i));l&&(o?l.setAttribute("disabled",!0):l.removeAttribute("disabled")),this.dispatchEvent({type:this.CHANGE_LAYER_LOCKED_EVENT,locked:o,layer:this._layers[i]})}_updateGenericProperty(e){var i=e.target.gpLayerId,s=this._layers[i].layer,o=s.get(e.key);switch(e.key){case"title":this._layers[i].title=o;var l=document.getElementById(this._addUID("GPname_ID_"+i));l&&(l.innerHTML=o,l.title=o);break;case"description":this._layers[i].description=o;var l=document.getElementById(this._addUID("GPname_ID_"+i));l&&(l.title=o);break;case"producer":this._layers[i].producer=o;var c=document.getElementById(this._addUID("GPlayerProducer_ID_"+i));c&&(c.innerHTML=o);break}this.dispatchEvent({type:this.PROPERTY_CHANGE_EVENT,key:e.key,value:o,layer:this._layers[i]})}_onToggleLayerLockedClick(e){var i=e.target.id,s=SelectorID.index(i),o=this._layers[s].layer,l=e.target.ariaPressed==="true";o.set("locked",l)}_onZoomToExtentClick(e){logger$A.debug(e);var i=e.target.id,s=SelectorID.index(i),o=this._layers[s],l=null,c=null,u=this.getMap();if(o.layer.hasOwnProperty("gpResultLayerId")&&(o.layer.gpResultLayerId.split(":")[0]==="layerimport"||o.layer.gpResultLayerId.split(":")[0]==="drawing"||o.layer.gpResultLayerId.split(":")[0]==="compute"||o.layer.gpResultLayerId.split(":")[0]==="bookmark")){if(u.getView()&&u.getSize()){var f=o.layer.getExtent();if(!f){var g=o.layer.getSource();g&&g.getExtent?f=g.getExtent():f=g.getTileGrid().getExtent()}f&&f[0]!==1/0&&u.getView().fit(f,u.getSize())}}else try{if(!Config.isConfigLoaded())throw"ERROR : contract key configuration has to be loaded to load Geoportal layers.";var H=o.layer.name||o.layer.getSource().name,Y=o.layer.service||o.layer.getSource().service,ee=Config.configuration.getLayerId(H,Y);if(!ee)throw"ERROR : Layer ID not found into the catalogue !?";var te=Config.configuration.getGlobalConstraints(ee);if(te){if(!u||!u.getView())return;var ne=u.getView(),Ye=ne.getProjection(),xe=[te.extent.left,te.extent.bottom,te.extent.right,te.extent.top],tt=te.crs;tt||(tt="EPSG:4326"),l=transformExtent(xe,tt,Ye),l&&ne.fit(l)}}catch(et){c=et}this.dispatchEvent({type:this.EXTENT_LAYER_EVENT,extent:l,layer:o,error:c})}_onClickAdvancedToolsMore(e,i,s){var o=e.target.id,l=SelectorID.index(o),c=this._layers[l],u=this._layers[l].layer;if(s){s(e,this,u,c);return}this.dispatchEvent({type:this.CUSTOM_LAYER_EVENT,action:i,layer:u,options:c})}_onClickHeaderButtons(e,i,s){if(s){s(e,this);return}this.dispatchEvent({type:this.HEADER_BUTTON_EVENT,action:i})}_onSelectLayer(e){if(e.type!=="keydown"||["Enter","Space"].includes(e.code)&&e.target.id.startsWith("GPlayerSwitcher_ID_")){const s=e.target.id,o=SelectorID.index(s);if(this._layers[o]){const c=this._layers[o].layer;c!==this.getSelectedLayer()&&this.setSelectedLayer(c,!0)}}}getSelectedLayer(){return this.selectedLayer}setSelectedLayer(e,i){let s=this.getSelectedLayer();if(e===s&&s&&s.get("selected")!==i?(e.set("selected",i),this.selectedLayer=null):!e&&s?(s.set("selected",!1),this.selectedLayer=null):(e.set("selected",!!i),i?this.selectedLayer=e:this.selectedLayer=null,s&&s.set("selected",!1)),this.getSelectedLayer()){const o=this._layers[this.getSelectedLayer().gpLayerId].div;o.ariaCurrent=!0}if(s){const o=this._layers[s.gpLayerId].div;o.ariaCurrent=!1}this.dispatchEvent({type:this.CHANGE_LAYER_SELECTED_EVENT,layer:this.getSelectedLayer(),previous:s})}_onMapMoveEnd(e){e.getLayers().forEach(i=>{var s=i.gpLayerId;if(this._layers[s]){var o=this._layers[s],l;if(this.isInRange(i,e)&&!o.inRange){o.inRange=!0,l=document.getElementById(this._addUID("GPlayerSwitcher_ID_"+s)),l.classList.remove("outOfRange");var c=this.getLayerInfo(i),u=c._title,f=c._description,g=document.getElementById(this._addUID("GPname_ID_"+s));g&&(g.title=f||u)}else!this.isInRange(i,e)&&o.inRange&&(o.inRange=!1,l=document.getElementById(this._addUID("GPlayerSwitcher_ID_"+s)),l.classList.add("outOfRange"))}})}getLayerDOMId(e){var i=null;return this.getMap().getLayers().forEach(s=>{s===e&&(i=s.hasOwnProperty("gpLayerId")?s.gpLayerId:null)}),i!==null?this._addUID("GPlayerSwitcher_ID_"+i):null}isInRange(e,i){if(i){var s=e.gpLayerId,o=document.getElementById(this._addUID("GPname_ID_"+s)),l=i.getView().getResolution();if(l>e.getMaxResolution()||l<e.getMinResolution()){var c="Cette couche n'est pas visible  ce niveau de zoom";return o&&(o.title=c),!1}var u=i.getView().calculateExtent(i.getSize()),f=e.getExtent();if(f&&!intersects$1(u,f)){var c="Cette couche n'est pas visible  cet endroit";return o&&(o.title=c),!1}return!0}}getLayerInfo(e){var i={};if(e.getProperties!==void 0&&e.getSource!==void 0){var s=e.getProperties(),o=s.source;o&&(i._title=o._title||s.title||s.id||"",i._description=o._description||s.description||"",i._producer=o._producer||s.producer||"",i._thumbnail=o._thumbnail||s.thumbnail||"",i._quicklookUrl=o._quicklookUrl||s.quicklookUrl||"",i._metadata=o._metadata||s.metadata||[],i._legends=o._legends||s.legends||[])}return i}setLayerProducer(e,i){let s=e.gpLayerId,o=this._layers[s].div;if(o){let l=o.querySelector(".GPlayerTitle");if(l.childElementCount===2&&l.querySelector(".GPlayerProducer").remove(),i){let c=this._createLayerProducerElement({producer:i},this.options.allowTooltips);l.appendChild(c)}}}};ii(Ui,"switcherButtons",{INFO:"info",EDIT:"edition",GREYSCALE:"greyscale",EXTENT:"extent"});let LayerSwitcher=Ui;Object.assign(LayerSwitcher.prototype,LayerSwitcherDOM);Object.assign(LayerSwitcher.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.LayerSwitcher=LayerSwitcher);LoggerByDefault.getLogger("draggable");var Draggable={dragElement:function(n,e,i){let s=0,o=0,l=0,c=0,u=0,f=0;e?e.addEventListener("mousedown",Y,!0):n.addEventListener("mousedown",Y,!0);var g,H={bottom:0,left:0,right:0,top:0};function Y(ne){ne=ne||window.event,ne.preventDefault(),s=ne.clientX,o=ne.clientY,g=n.getBoundingClientRect();const Ye=i.getBoundingClientRect();H={bottom:Ye.bottom,left:Ye.left,right:Ye.right,top:Ye.top},document.addEventListener("mouseup",ee,!0),document.addEventListener("mousemove",te,!0)}function ee(){u-=l,f-=c,document.removeEventListener("mouseup",ee,!0),document.removeEventListener("mousemove",te,!0)}function te(ne){ne=ne||window.event;let Ye=ne.clientX,xe=ne.clientY,tt=l,et=c;l=s-Ye,c=o-xe;var it=g.left-l,rt=g.top-c;if(it<H.left||rt<H.top||it+g.width>H.right||rt+g.height>H.bottom)l=tt,c=et;else{let nt=u-l,at=f-c;n.style.transform="translate("+nt+"px,"+at+"px)"}}}};class AsyncData{constructor(e){this.data=e,this.subscribers=[]}subscribe(e){if(typeof e!="function")throw new Error("Callback must be a function");this.subscribers.push(e)}async set(e,i){this.data[e]=i;const s=this.subscribers.map(async o=>{await o(e,i)});await Promise.allSettled(s)}get(e){return this.data[e]}}var GetFeatureInfoDOM={_addUID:function(n){var e=this.uid?n+"-"+this.uid:n;return e},stringToHTML:function(n){var e=function(){if(!window.DOMParser)return!1;var l=new DOMParser;try{l.parseFromString("x","text/html")}catch{return!1}return!0};if(e()){var i=new DOMParser,s=i.parseFromString(n,"text/html");return s.body}var o=document.createElement("div");return o.innerHTML=n,o},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPgetFeatureInfo"),n.className="GPgetFeatureInfo gpf-widget gpf-widget-button gpf-mobile-fullscreen",n},_createShowGetFeatureInfoPictoElement:function(){var n=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPgetFeatureInfoPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto GPgetFeatureInfoPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-getfeatureinfo fr-btn fr-btn--tertiary",e.setAttribute("aria-label","Activer/dsactiver l'interrogation des couches"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowGetFeatureInfoClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowGetFeatureInfoClick(s)}),e},_createGetFeatureInfoPanelElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPgetFeatureInfoPanel"),n.className="GPpanel gpf-panel fr-modal",n},_createGetFeatureInfoPanelDivElement:function(){var n=document.createElement("div");return n.className="GPpanelBody fr-modal__body",n},_createGetFeatureInfoPanelHeaderElement:function(){var n=document.createElement("div");return n.className="GPpanelHeader gpf-panel__header_gfi",n},_createGetFeatureInfoPanelIconElement:function(){var n=document.createElement("label");return n.className="GPpanelIcon gpf-btn-header_gfi gpf-btn-icon-header_gfi",n.title="Get Feature Info",n},_createGetFeatureInfoPanelTitleElement:function(){var n=document.createElement("div");return n.className="GPpanelTitle gpf-panel__title_gfi fr-modal__title",n.innerHTML="Infos sur les couches",n},_createGetFeatureInfoPanelCloseElement:function(){var n=this,e=document.createElement("button");e.className="GPpanelClose GPcloseGetFeatureInfo gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline",e.title="Fermer le panneau",e.addEventListener?e.addEventListener("click",function(s){e.setAttribute("aria-pressed",!1),n.onCloseGetFeatureInfoClick()},!1):e.attachEvent&&e.attachEvent("onclick",function(s){e.setAttribute("aria-pressed",!1),n.onCloseGetFeatureInfoClick()});var i=document.createElement("span");return i.className="GPelementHidden gpf-visible",i.innerText="Fermer",e.appendChild(i),e},_createGetFeatureInfoWaitingDiv:function(){var n=`
        <div class="waiting-div-container"><div class="lds-ring"><div></div><div></div><div></div><div></div></div><div>
        `;return n},_createGetFeatureInfoNoData:function(n){var e=document.createElement("div");return e.className="GPgetFeatureInfoNoData fr-py-2w fr-px-2w",console.log(this.stringToHTML(n)),e.insertAdjacentHTML("beforeend",n),e},_createGetFeatureInfoAccordionGroup:function(){var n=document.createElement("div");return n.id=this._addUID("GPgetFeatureInfoAccordionGroup"),n.className="GPgetFeatureInfoAccordionGroup fr-accordions-group",n},_createGetFeatureInfoLayerAccordion:function(n){var e=this.stringToHTML(`
            <section class="fr-accordion">
                <h3 class="fr-accordion__title">
                    <button class="GPgfiLayerButton fr-accordion__btn" aria-expanded="false" aria-controls="accordion-${n}">
                        <span class="GPshowGfiLayerFeature"></span>
                        <span id="gfiLayerName">${n}</span>
                    </button>
                </h3>
                <div class="fr-collapse GPgetFeatureInfoAccordionContent GPelementHidden" id="accordion-${n}" style="margin:unset;">
                    ${this._createGetFeatureInfoWaitingDiv()}
                </div>
            </section>
        `),i=e.firstChild,s=i.querySelector("button, button.fr-accordion__btn");return s.addEventListener("click",o=>{o.currentTarget.ariaExpanded=o.currentTarget.ariaExpanded!=="true";var l=document.getElementById(o.currentTarget.getAttribute("aria-controls"));o.currentTarget.ariaExpanded==="true"?(l.classList.add("fr-collapse--expanded"),l.classList.remove("GPelementHidden"),requestAnimationFrame(()=>{s.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})})):(l.classList.remove("fr-collapse--expanded"),l.classList.add("GPelementHidden"))}),i}},logger$z=LoggerByDefault.getLogger("getFeatureInfo");class GetFeatureInfo extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof GetFeatureInfo))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="GetFeatureInfo",this.initialize(e),this.container=this.initContainer(),this.element?this.element.appendChild(this.container):this.element=this.container,this}setMap(e){e?(this.draggable&&Draggable.dragElement(this.panelGetFeatureInfoContainer,this.panelGetFeatureInfoHeaderContainer,e.getTargetElement()),this.collapsed||this.buttonGetFeatureInfoShow.setAttribute("aria-pressed",!0),this.auto&&this.addEventsListeners(e)):this.auto&&this.removeEventsListeners(),super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.element.classList.add("gpf-button-no-gutter")}initialize(e){this.uid=e.id||SelectorID.generate(),this.options={collapsed:!0,draggable:!1,auto:!0},Helper.assign(this.options,e),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this.noDataMessage=this.options.noDataMessage,this.auto=this.options.auto,this.buttonGetFeatureInfoShow=null,this.panelGetFeatureInfoContainer=null,this.getFeatureInfoPanelDiv=null,this.panelGetFeatureInfoHeaderContainer=null,this.buttonGetFeatureInfoClose=null,this.getFeatureInfoAccordionGroup=null,this.panelGetFeatureInfoEntriesContainer=null,this.noDataMessageDiv=null,this.eventsListeners=[],this.pixel=[],this.coordinates=[],this.layers=[],this.res=null}initContainer(){var e=this._createMainContainerElement(),i=this.buttonGetFeatureInfoShow=this._createShowGetFeatureInfoPictoElement();e.appendChild(i);var s=this.panelGetFeatureInfoContainer=this._createGetFeatureInfoPanelElement(),o=this.getFeatureInfoPanelDiv=this._createGetFeatureInfoPanelDivElement();s.appendChild(o);var l=this.panelGetFeatureInfoHeaderContainer=this._createGetFeatureInfoPanelHeaderElement(),c=this._createGetFeatureInfoPanelIconElement();l.appendChild(c);var u=this._createGetFeatureInfoPanelTitleElement();l.appendChild(u);var f=this.buttonGetFeatureInfoClose=this._createGetFeatureInfoPanelCloseElement();l.appendChild(f),o.appendChild(l);var g=this.getFeatureInfoAccordionGroup=this._createGetFeatureInfoAccordionGroup();return o.appendChild(g),this.noDataMessage&&(this.noDataMessageDiv=this._createGetFeatureInfoNoData(this.noDataMessage)),e.appendChild(s),logger$z.log(e),e}addEventsListeners(e){var i=this;this.eventsListeners.singleclick=function(s){logger$z.trace(s),i.onMapClick(s)},e.on("singleclick",this.eventsListeners.singleclick)}removeEventsListeners(){var e=this.getMap();e.getLayers().un("singleclick",this.eventsListeners.singleclick),delete this.eventsListeners.singleclick}getFeatureInfoIsActive(){return this.buttonGetFeatureInfoShow.getAttribute("aria-pressed")}onMapClick(e){if(this.getFeatureInfoIsActive()==="true")if(this.getFeatureInfoAccordionGroup.remove(),this.noDataMessage&&this.noDataMessageDiv.remove(),this.buttonGetFeatureInfoClose.setAttribute("aria-pressed",!0),this.layers=e.map.getLayers().getArray().filter(s=>{if(s.isVisible(e.map.getView())&&s.getOpacity()>0)return s}).sort((s,o)=>o.getZIndex()-s.getZIndex()),this.layers.length>0){var i=this.getFeatureInfoAccordionGroup=this._createGetFeatureInfoAccordionGroup();this.getFeatureInfoPanelDiv.appendChild(i),this.map=e.map,this.pixel=e.pixel,this.coordinates=e.coordinate,this.res=e.map.getView().getResolution(),this.displayGetFeatureInfo()}else{this.noDataMessage&&this.getFeatureInfoPanelDiv.append(this.noDataMessageDiv);return}}getGetFeatureInfoLayer(e){var i={};let s=this.getLayerFormat(e);if(i={format:s,layer:e},s==="wmts"){let o=e.getSource().getFeatureInfoUrl(this.coordinates,this.res,this.map.getView().getProjection(),{INFOFORMAT:"text/html",STYLES:""});i={...i,url:o}}if(s==="wms"){let o=e.getSource().getFeatureInfoUrl(this.coordinates,this.res,this.map.getView().getProjection(),{INFO_FORMAT:"text/html",STYLES:""});i={...i,url:o}}return i}getFeaturesAtClick(e){var i=[];return this.getMap().forEachFeatureAtPixel(this.pixel,function(s,o){e==o&&i.push(s)}),i}async getGetFeatureInfoContent(e){var i=null;if(e.format==="vector"){var s=this.getFeaturesAtClick(e.layer);return s&&(i=this.features2html(s)),i}else return fetch(e.url).then(o=>o.text()).then(o=>{var l=!1;if((o.trim().length===0||o.indexOf("ServiceExceptionReport")!==-1||o.indexOf("java.lang.NullPointerException")!==-1||o.indexOf("java.lang.OutOfMemoryError")!==-1||o.indexOf("not queryable")!==-1||o.indexOf("No data")!==-1||o.indexOf("non interrogeable")!==-1)&&(l=!0),l)return null;var c=this.stringToHTML(o);return c&&c.innerHTML&&c.innerHTML.trim().length>0?o:null}).catch(o=>(logger$z.log(o),o))}getLayerTitle(e){if(e.layer.getProperties!==void 0&&e.layer.getSource!==void 0){var i=e.layer.getProperties(),s=i.source,o="";s&&(o=s._title||s.name||i.title||i.name||s.url_||"Couche de donnes")}return o}displayGetFeatureInfo(){var e=this.layers.map(s=>this.getGetFeatureInfoLayer(s)),i=e.map(s=>{var o=this.getLayerTitle(s),l=null,c=this._createGetFeatureInfoLayerAccordion(o);c.style.display="none";var u=!0;return new AsyncData({...s,layername:o,content:l,contentDiv:c,pending:u})});for(let s=0;s<i.length;s++)this.getFeatureInfoAccordionGroup.append(i[s].data.contentDiv);i.forEach(s=>{s.subscribe((o,l)=>{o=="content"&&(s.set("pending",!1),s.get("content")?(s.get("contentDiv").querySelector("div.fr-collapse").innerHTML=s.get("content"),this.buttonGetFeatureInfoClose.setAttribute("aria-pressed",!0),s.get("contentDiv").style.display="block"):s.get("contentDiv").remove(),i.filter(c=>c.get("pending")===!0).length==0&&i.filter(c=>c.get("content")).length==0&&(this.noDataMessage?this.getFeatureInfoPanelDiv.append(this.noDataMessageDiv):this.buttonGetFeatureInfoClose.setAttribute("aria-pressed",!1)))})}),i.forEach(s=>{this.getGetFeatureInfoContent(s.data).then(o=>{s.set("content",o)})})}getLayerFormat(e){var i=typeof e.getType=="function"?e.getType():null,s=e.getSource();if(i){if(i==="VECTOR"||i==="VECTOR_TILE")return"vector";if(i==="TILE")return s.tileGrid?"wmts":"wms";if(i==="IMAGE")return"wms"}else{if(s instanceof TileWMS||s instanceof ImageWMS)return"wms";if(s instanceof WMTS$1)return"wmts";if(s instanceof VectorSource||s instanceof VectorTile)return"vector"}return"unknown"}features2html(e){var i=document.createElement("div");return e.forEach(function(s){var o=s.getProperties();if(o.hasOwnProperty("render"))i.insertAdjacentHTML("beforeend",o.render);else{if(o.hasOwnProperty("name")){var l=document.createElement("div");l.className="gp-att-name-div",l.insertAdjacentHTML("afterbegin",o.name),i.appendChild(l)}if(o.hasOwnProperty("description")){var c=document.createElement("div");c.className="gp-att-description-div",c.insertAdjacentHTML("afterbegin",o.description),i.appendChild(c)}var u=null,f=!1,g=null,H=null,Y=null,ee=["fill","fill-opacity","label-fill","label-fill-opacity","label-stroke","label-stroke-opacity","label-stroke-width","label-font","label-textAlign","stroke","stroke-opacity","stroke-width","marker-symbol","marker-color","marker-size","geometry","value","name","description","styleUrl","extensionsNode_","icon"];for(u in o)if(o[u]!==void 0&&ee.indexOf(u)===-1){f||(g=document.createElement("div"),g.className="gp-att-others-div",H=document.createElement("ul"),f=!0),Y=document.createElement("li");var te=document.createElement("span");te.className="gp-attname-others-span",te.appendChild(document.createTextNode(u+" : ")),Y.appendChild(te),Y.appendChild(document.createTextNode(o[u])),H.appendChild(Y)}H&&(g.appendChild(H),i.appendChild(g))}}),i.hasChildNodes()?i=i.innerHTML:i="",i}onShowGetFeatureInfoClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen(),e.target.ariaPressed==="false"&&this.buttonGetFeatureInfoClose.setAttribute("aria-pressed",!1),logger$z.trace(e)}onCloseGetFeatureInfoClick(e){logger$z.trace(e)}onGetFeatureInfoComputationSubmit(e){logger$z.trace(e)}}Object.assign(GetFeatureInfo.prototype,GetFeatureInfoDOM);Object.assign(GetFeatureInfo.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.GetFeatureInfo=GetFeatureInfo);var MathUtils={modulo:function(n,e){var i=n%e;return i*e<0?i+e:i},decimalToDMS:function(n,e,i){var s=this.modulo(n+180,360)-180,o=Math.abs(3600*s),l=i||0,c=Math.pow(10,l),u=Math.floor(o/3600),f=Math.floor((o-u*3600)/60),g=o-u*3600-f*60;g=Math.ceil(g*c)/c,g>=60&&(g=0,f+=1),f>=60&&(f=0,u+=1);var H=e.charAt(s<0?1:0);return{d:u,m:f,s:g,direction:H}},dmsToDecimal(n,e,i,s){var o=n+e/60+i/3600;return(s=="S"||s=="O")&&(o=o*-1),o},coordinateToDecimal(n){var e={};return e.lat=n[1].toFixed(6),e.lng=n[0].toFixed(6),e.unit="",e},coordinateToDMS(n){return{lng:MathUtils.decimalToDMS(n[0],"EO",2),lat:MathUtils.decimalToDMS(n[1],"NS",2),unit:"DMS"}},coordinateToRad(n){var e={},i=.017453292519943295;return e.lng=n[0]*i,e.lng=e.lng.toFixed(8),e.lat=n[1]*i,e.lat=e.lat.toFixed(8),e.unit="rad",e},coordinateToGon(n){var e={},i=1.1111111111111112;return e.lng=n[0]*i,e.lng=e.lng.toFixed(8),e.lat=n[1]*i,e.lat=e.lat.toFixed(8),e.unit="gon",e},coordinateToMeter(n){var e={};return e.x=n[0].toFixed(2),e.y=n[1].toFixed(2),e.unit="m",e},coordinateToKMeter(n){var e={};return e.x=(n[0]/1e3).toFixed(2),e.y=(n[1]/1e3).toFixed(2),e.unit="km",e},toInteger:function(n,e){var i=e||10,s=parseInt(n,i);return!isNaN(s)&&isFinite(s)?s:null},isInteger:function(n){if(isNaN(n))return!1;var e=parseFloat(n);return(e|0)===e},toFloat:function(n){var e=parseFloat(n);return!isNaN(e)&&isFinite(e)?e:null},convertSecondsToTime:function(n){var e="";n=Math.round(n);var i=Math.floor(n/3600),s=n%3600,o=Math.floor(s/60);return i&&(e=i+"h "),e+=o+" min",e},convertDistance:function(n){var e="",i=parseInt(n/1e3,10);return i?e=i+" km":e=parseInt(n,10)+" m",e}},SearchEngineUtils={advancedSearchFiltersByDefault:{PositionOfInterest:[{name:"q",title:"Chercher un lieu"},{name:"category",title:"Type",value:["cimetire","arodrome","rservoir","administratif","construction linaire","construction ponctuelle","construction surfacique","cours d'eau","dtail hydrographique","dtail orographique","quipement de transport","plan d'eau","poste de transformation","terrain de sport","transport par cble","zone d'activit ou d'intrt","zone d'habitation","lieu-dit non habit"]},{name:"postcode",title:"Code postal"},{name:"citycode",title:"Code INSEE"}],StreetAddress:[{name:"address",title:"Adresse"},{name:"city",title:"Ville"},{name:"postcode",title:"Code postal"}],CadastralParcel:[{name:"departmentcode",title:"Code dpartement (INSEE)",description:"Code INSEE du dpartement (ex: 01, 94)"},{name:"municipalitycode",title:"Code commune (INSEE)",description:"Code INSEE de la commune : 3 chiffres (ex: 067)"},{name:"oldmunicipalitycode",title:"Commune absorbe",description:"Commune absorbe : 3 chiffres (ex: 000, 001)"},{name:"districtcode",title:"Arrondissement",description:"Arrondissement : 3 chiffres (ex: 004, 012)"},{name:"section",title:"Section",description:"Section Cadastrale : 2 caractres (chiffre et/ou lettre)"},{name:"number",title:"Numro",description:"Numro de la parcelle : 4 chiffres (ex: 0041, 0250)"},{name:"sheet",title:"Feuille",description:"Numro de la feuille cadastrale"}]},zoomToResultsByDefault:function(n){var e=15,i=n.service,s=n.fields,o=n.type,l={1:11,2:12,3:13,4:14,5:15,6:16,7:17,8:17};return i==="SuggestedLocation"&&o==="PositionOfInterest"&&(e=l[s.classification]),i==="GeocodedLocation"&&o==="PositionOfInterest"&&(e=l[s.importance]||14),o==="StreetAddress"&&(e=17),o==="CadastralParcel"&&(e=17),e}},GeocodeUtils={getGeocodedLocationFreeform:function(n){var e=n.placeAttributes;if(e.label)return e.label;if(n.type==="PositionOfInterest"){var i=e.toponym;return e.category&&Array.isArray(e.category)&&e.category.length>=2&&e.category[0]==="administratif"?i=i+", "+e.category[1]:e.postcode&&(i=i+", "+e.postcode[0],e.city&&(i=i+" "+e.city[0])),i}else return n.type==="StreetAddress"?(e.housenumber?e.housenumber+" ":"")+e.street+" "+(e.postcode?e.postcode+", ":"")+e.city:n.type==="CadastralParcel"?e.id:"..."},getSuggestedLocationFreeform:function(n){if(n.fullText)return n.fullText;var e=[];return e.push(n.street||""),e.push(n.postalCode||""),e.push(n.commune||""),n.type==="PositionOfInterest"&&(e.push(n.poi||""),e.push(n.kind||"")),e.join(" - ")}};function globals(n){n("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),n("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),n("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var e=1;e<=60;++e)n("EPSG:"+(32600+e),"+proj=utm +zone="+e+" +datum=WGS84 +units=m"),n("EPSG:"+(32700+e),"+proj=utm +zone="+e+" +south +datum=WGS84 +units=m");n.WGS84=n["EPSG:4326"],n["EPSG:3785"]=n["EPSG:3857"],n.GOOGLE=n["EPSG:3857"],n["EPSG:900913"]=n["EPSG:3857"],n["EPSG:102113"]=n["EPSG:3857"]}var PJD_3PARAM=1,PJD_7PARAM=2,PJD_GRIDSHIFT=3,PJD_WGS84=4,PJD_NODATUM=5,SRS_WGS84_SEMIMAJOR=6378137,SRS_WGS84_SEMIMINOR=6356752314e-3,SRS_WGS84_ESQUARED=.0066943799901413165,SEC_TO_RAD=484813681109536e-20,HALF_PI=Math.PI/2,SIXTH=.16666666666666666,RA4=.04722222222222222,RA6=.022156084656084655,EPSLN=1e-10,D2R$1=.017453292519943295,R2D=57.29577951308232,FORTPI=Math.PI/4,TWO_PI=Math.PI*2,SPI=3.14159265359,exports$2={};exports$2.greenwich=0;exports$2.lisbon=-9.131906111111;exports$2.paris=2.337229166667;exports$2.bogota=-74.080916666667;exports$2.madrid=-3.687938888889;exports$2.rome=12.452333333333;exports$2.bern=7.439583333333;exports$2.jakarta=106.807719444444;exports$2.ferro=-17.666666666667;exports$2.brussels=4.367975;exports$2.stockholm=18.058277777778;exports$2.athens=23.7163375;exports$2.oslo=10.722916666667;const units={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.01},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var ignoredChar=/[\s_\-\/\(\)]/g;function match(n,e){if(n[e])return n[e];for(var i=Object.keys(n),s=e.toLowerCase().replace(ignoredChar,""),o=-1,l,c;++o<i.length;)if(l=i[o],c=l.toLowerCase().replace(ignoredChar,""),c===s)return n[l]}function projStr(n){var e={},i=n.split("+").map(function(u){return u.trim()}).filter(function(u){return u}).reduce(function(u,f){var g=f.split("=");return g.push(!0),u[g[0].toLowerCase()]=g[1],u},{}),s,o,l,c={proj:"projName",datum:"datumCode",rf:function(u){e.rf=parseFloat(u)},lat_0:function(u){e.lat0=u*D2R$1},lat_1:function(u){e.lat1=u*D2R$1},lat_2:function(u){e.lat2=u*D2R$1},lat_ts:function(u){e.lat_ts=u*D2R$1},lon_0:function(u){e.long0=u*D2R$1},lon_1:function(u){e.long1=u*D2R$1},lon_2:function(u){e.long2=u*D2R$1},alpha:function(u){e.alpha=parseFloat(u)*D2R$1},gamma:function(u){e.rectified_grid_angle=parseFloat(u)},lonc:function(u){e.longc=u*D2R$1},x_0:function(u){e.x0=parseFloat(u)},y_0:function(u){e.y0=parseFloat(u)},k_0:function(u){e.k0=parseFloat(u)},k:function(u){e.k0=parseFloat(u)},a:function(u){e.a=parseFloat(u)},b:function(u){e.b=parseFloat(u)},r:function(u){e.a=e.b=parseFloat(u)},r_a:function(){e.R_A=!0},zone:function(u){e.zone=parseInt(u,10)},south:function(){e.utmSouth=!0},towgs84:function(u){e.datum_params=u.split(",").map(function(f){return parseFloat(f)})},to_meter:function(u){e.to_meter=parseFloat(u)},units:function(u){e.units=u;var f=match(units,u);f&&(e.to_meter=f.to_meter)},from_greenwich:function(u){e.from_greenwich=u*D2R$1},pm:function(u){var f=match(exports$2,u);e.from_greenwich=(f||parseFloat(u))*D2R$1},nadgrids:function(u){u==="@null"?e.datumCode="none":e.nadgrids=u},axis:function(u){var f="ewnsud";u.length===3&&f.indexOf(u.substr(0,1))!==-1&&f.indexOf(u.substr(1,1))!==-1&&f.indexOf(u.substr(2,1))!==-1&&(e.axis=u)},approx:function(){e.approx=!0}};for(s in i)o=i[s],s in c?(l=c[s],typeof l=="function"?l(o):e[l]=o):e[s]=o;return typeof e.datumCode=="string"&&e.datumCode!=="WGS84"&&(e.datumCode=e.datumCode.toLowerCase()),e}class PROJJSONBuilderBase{static getId(e){const i=e.find(s=>Array.isArray(s)&&s[0]==="ID");return i&&i.length>=3?{authority:i[1],code:parseInt(i[2],10)}:null}static convertUnit(e,i="unit"){if(!e||e.length<3)return{type:i,name:"unknown",conversion_factor:null};const s=e[1],o=parseFloat(e[2])||null,l=e.find(u=>Array.isArray(u)&&u[0]==="ID"),c=l?{authority:l[1],code:parseInt(l[2],10)}:null;return{type:i,name:s,conversion_factor:o,id:c}}static convertAxis(e){const i=e[1]||"Unknown";let s;const o=i.match(/^\((.)\)$/);if(o){const g=o[1].toUpperCase();if(g==="E")s="east";else if(g==="N")s="north";else if(g==="U")s="up";else throw new Error(`Unknown axis abbreviation: ${g}`)}else s=e[2]?e[2].toLowerCase():"unknown";const l=e.find(g=>Array.isArray(g)&&g[0]==="ORDER"),c=l?parseInt(l[1],10):null,u=e.find(g=>Array.isArray(g)&&(g[0]==="LENGTHUNIT"||g[0]==="ANGLEUNIT"||g[0]==="SCALEUNIT")),f=this.convertUnit(u);return{name:i,direction:s,unit:f,order:c}}static extractAxes(e){return e.filter(i=>Array.isArray(i)&&i[0]==="AXIS").map(i=>this.convertAxis(i)).sort((i,s)=>(i.order||0)-(s.order||0))}static convert(e,i={}){switch(e[0]){case"PROJCRS":i.type="ProjectedCRS",i.name=e[1],i.base_crs=e.find(ee=>Array.isArray(ee)&&ee[0]==="BASEGEOGCRS")?this.convert(e.find(ee=>Array.isArray(ee)&&ee[0]==="BASEGEOGCRS")):null,i.conversion=e.find(ee=>Array.isArray(ee)&&ee[0]==="CONVERSION")?this.convert(e.find(ee=>Array.isArray(ee)&&ee[0]==="CONVERSION")):null;const s=e.find(ee=>Array.isArray(ee)&&ee[0]==="CS");s&&(i.coordinate_system={type:s[1],axis:this.extractAxes(e)});const o=e.find(ee=>Array.isArray(ee)&&ee[0]==="LENGTHUNIT");if(o){const ee=this.convertUnit(o);i.coordinate_system.unit=ee}i.id=this.getId(e);break;case"BASEGEOGCRS":case"GEOGCRS":i.type="GeographicCRS",i.name=e[1];const l=e.find(ee=>Array.isArray(ee)&&(ee[0]==="DATUM"||ee[0]==="ENSEMBLE"));if(l){const ee=this.convert(l);l[0]==="ENSEMBLE"?i.datum_ensemble=ee:i.datum=ee;const te=e.find(ne=>Array.isArray(ne)&&ne[0]==="PRIMEM");te&&te[1]!=="Greenwich"&&(ee.prime_meridian={name:te[1],longitude:parseFloat(te[2])})}i.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(e)},i.id=this.getId(e);break;case"DATUM":i.type="GeodeticReferenceFrame",i.name=e[1],i.ellipsoid=e.find(ee=>Array.isArray(ee)&&ee[0]==="ELLIPSOID")?this.convert(e.find(ee=>Array.isArray(ee)&&ee[0]==="ELLIPSOID")):null;break;case"ENSEMBLE":i.type="DatumEnsemble",i.name=e[1],i.members=e.filter(ee=>Array.isArray(ee)&&ee[0]==="MEMBER").map(ee=>({type:"DatumEnsembleMember",name:ee[1],id:this.getId(ee)}));const c=e.find(ee=>Array.isArray(ee)&&ee[0]==="ENSEMBLEACCURACY");c&&(i.accuracy=parseFloat(c[1]));const u=e.find(ee=>Array.isArray(ee)&&ee[0]==="ELLIPSOID");u&&(i.ellipsoid=this.convert(u)),i.id=this.getId(e);break;case"ELLIPSOID":i.type="Ellipsoid",i.name=e[1],i.semi_major_axis=parseFloat(e[2]),i.inverse_flattening=parseFloat(e[3]),e.find(ee=>Array.isArray(ee)&&ee[0]==="LENGTHUNIT")&&this.convert(e.find(ee=>Array.isArray(ee)&&ee[0]==="LENGTHUNIT"),i);break;case"CONVERSION":i.type="Conversion",i.name=e[1],i.method=e.find(ee=>Array.isArray(ee)&&ee[0]==="METHOD")?this.convert(e.find(ee=>Array.isArray(ee)&&ee[0]==="METHOD")):null,i.parameters=e.filter(ee=>Array.isArray(ee)&&ee[0]==="PARAMETER").map(ee=>this.convert(ee));break;case"METHOD":i.type="Method",i.name=e[1],i.id=this.getId(e);break;case"PARAMETER":i.type="Parameter",i.name=e[1],i.value=parseFloat(e[2]),i.unit=this.convertUnit(e.find(ee=>Array.isArray(ee)&&(ee[0]==="LENGTHUNIT"||ee[0]==="ANGLEUNIT"||ee[0]==="SCALEUNIT"))),i.id=this.getId(e);break;case"BOUNDCRS":i.type="BoundCRS";const f=e.find(ee=>Array.isArray(ee)&&ee[0]==="SOURCECRS");if(f){const ee=f.find(te=>Array.isArray(te));i.source_crs=ee?this.convert(ee):null}const g=e.find(ee=>Array.isArray(ee)&&ee[0]==="TARGETCRS");if(g){const ee=g.find(te=>Array.isArray(te));i.target_crs=ee?this.convert(ee):null}const H=e.find(ee=>Array.isArray(ee)&&ee[0]==="ABRIDGEDTRANSFORMATION");H?i.transformation=this.convert(H):i.transformation=null;break;case"ABRIDGEDTRANSFORMATION":if(i.type="Transformation",i.name=e[1],i.method=e.find(ee=>Array.isArray(ee)&&ee[0]==="METHOD")?this.convert(e.find(ee=>Array.isArray(ee)&&ee[0]==="METHOD")):null,i.parameters=e.filter(ee=>Array.isArray(ee)&&(ee[0]==="PARAMETER"||ee[0]==="PARAMETERFILE")).map(ee=>{if(ee[0]==="PARAMETER")return this.convert(ee);if(ee[0]==="PARAMETERFILE")return{name:ee[1],value:ee[2],id:{authority:"EPSG",code:8656}}}),i.parameters.length===7){const ee=i.parameters[6];ee.name==="Scale difference"&&(ee.value=Math.round((ee.value-1)*1e12)/1e6)}i.id=this.getId(e);break;case"AXIS":i.coordinate_system||(i.coordinate_system={type:"unspecified",axis:[]}),i.coordinate_system.axis.push(this.convertAxis(e));break;case"LENGTHUNIT":const Y=this.convertUnit(e,"LinearUnit");i.coordinate_system&&i.coordinate_system.axis&&i.coordinate_system.axis.forEach(ee=>{ee.unit||(ee.unit=Y)}),Y.conversion_factor&&Y.conversion_factor!==1&&i.semi_major_axis&&(i.semi_major_axis={value:i.semi_major_axis,unit:Y});break;default:i.keyword=e[0];break}return i}}class PROJJSONBuilder2015 extends PROJJSONBuilderBase{static convert(e,i={}){return super.convert(e,i),i.coordinate_system&&i.coordinate_system.subtype==="Cartesian"&&delete i.coordinate_system,i.usage&&delete i.usage,i}}class PROJJSONBuilder2019 extends PROJJSONBuilderBase{static convert(e,i={}){super.convert(e,i);const s=e.find(l=>Array.isArray(l)&&l[0]==="CS");s&&(i.coordinate_system={subtype:s[1],axis:this.extractAxes(e)});const o=e.find(l=>Array.isArray(l)&&l[0]==="USAGE");if(o){const l=o.find(f=>Array.isArray(f)&&f[0]==="SCOPE"),c=o.find(f=>Array.isArray(f)&&f[0]==="AREA"),u=o.find(f=>Array.isArray(f)&&f[0]==="BBOX");i.usage={},l&&(i.usage.scope=l[1]),c&&(i.usage.area=c[1]),u&&(i.usage.bbox=u.slice(1))}return i}}function detectWKT2Version(n){return n.find(e=>Array.isArray(e)&&e[0]==="USAGE")?"2019":(n.find(e=>Array.isArray(e)&&e[0]==="CS")||n[0]==="BOUNDCRS"||n[0]==="PROJCRS"||n[0]==="GEOGCRS","2015")}function buildPROJJSON(n){return(detectWKT2Version(n)==="2019"?PROJJSONBuilder2019:PROJJSONBuilder2015).convert(n)}function detectWKTVersion(n){const e=n.toUpperCase();return e.includes("PROJCRS")||e.includes("GEOGCRS")||e.includes("BOUNDCRS")||e.includes("VERTCRS")||e.includes("LENGTHUNIT")||e.includes("ANGLEUNIT")||e.includes("SCALEUNIT")?"WKT2":(e.includes("PROJCS")||e.includes("GEOGCS")||e.includes("LOCAL_CS")||e.includes("VERT_CS")||e.includes("UNIT"),"WKT1")}var NEUTRAL=1,KEYWORD=2,NUMBER=3,QUOTED=4,AFTERQUOTE=5,ENDED=-1,whitespace=/\s/,latin=/[A-Za-z]/,keyword$1=/[A-Za-z84_]/,endThings=/[,\]]/,digets=/[\d\.E\-\+]/;function Parser(n){if(typeof n!="string")throw new Error("not a string");this.text=n.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=NEUTRAL}Parser.prototype.readCharicter=function(){var n=this.text[this.place++];if(this.state!==QUOTED)for(;whitespace.test(n);){if(this.place>=this.text.length)return;n=this.text[this.place++]}switch(this.state){case NEUTRAL:return this.neutral(n);case KEYWORD:return this.keyword(n);case QUOTED:return this.quoted(n);case AFTERQUOTE:return this.afterquote(n);case NUMBER:return this.number(n);case ENDED:return}};Parser.prototype.afterquote=function(n){if(n==='"'){this.word+='"',this.state=QUOTED;return}if(endThings.test(n)){this.word=this.word.trim(),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in afterquote yet, index '+this.place)};Parser.prototype.afterItem=function(n){if(n===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=NEUTRAL;return}if(n==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=NEUTRAL,this.currentObject=this.stack.pop(),this.currentObject||(this.state=ENDED);return}};Parser.prototype.number=function(n){if(digets.test(n)){this.word+=n;return}if(endThings.test(n)){this.word=parseFloat(this.word),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in number yet, index '+this.place)};Parser.prototype.quoted=function(n){if(n==='"'){this.state=AFTERQUOTE;return}this.word+=n};Parser.prototype.keyword=function(n){if(keyword$1.test(n)){this.word+=n;return}if(n==="["){var e=[];e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=NEUTRAL;return}if(endThings.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in keyword yet, index '+this.place)};Parser.prototype.neutral=function(n){if(latin.test(n)){this.word=n,this.state=KEYWORD;return}if(n==='"'){this.word="",this.state=QUOTED;return}if(digets.test(n)){this.word=n,this.state=NUMBER;return}if(endThings.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in neutral yet, index '+this.place)};Parser.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===ENDED)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function parseString(n){var e=new Parser(n);return e.output()}function mapit(n,e,i){Array.isArray(e)&&(i.unshift(e),e=null);var s=e?{}:n,o=i.reduce(function(l,c){return sExpr(c,l),l},s);e&&(n[e]=o)}function sExpr(n,e){if(!Array.isArray(n)){e[n]=!0;return}var i=n.shift();if(i==="PARAMETER"&&(i=n.shift()),n.length===1){if(Array.isArray(n[0])){e[i]={},sExpr(n[0],e[i]);return}e[i]=n[0];return}if(!n.length){e[i]=!0;return}if(i==="TOWGS84"){e[i]=n;return}if(i==="AXIS"){i in e||(e[i]=[]),e[i].push(n);return}Array.isArray(i)||(e[i]={});var s;switch(i){case"UNIT":case"PRIMEM":case"VERT_DATUM":e[i]={name:n[0].toLowerCase(),convert:n[1]},n.length===3&&sExpr(n[2],e[i]);return;case"SPHEROID":case"ELLIPSOID":e[i]={name:n[0],a:n[1],rf:n[2]},n.length===4&&sExpr(n[3],e[i]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":n[0]=["name",n[0]],mapit(e,i,n);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":n[0]=["name",n[0]],mapit(e,i,n),e[i].type=i;return;default:for(s=-1;++s<n.length;)if(!Array.isArray(n[s]))return sExpr(n,e[i]);return mapit(e,i,n)}}var D2R=.017453292519943295;function d2r(n){return n*D2R}function applyProjectionDefaults(n){const e=(n.projName||"").toLowerCase().replace(/_/g," ");!n.long0&&n.longc&&(e==="albers conic equal area"||e==="lambert azimuthal equal area")&&(n.long0=n.longc),!n.lat_ts&&n.lat1&&(e==="stereographic south pole"||e==="polar stereographic (variant b)")?(n.lat0=d2r(n.lat1>0?90:-90),n.lat_ts=n.lat1,delete n.lat1):!n.lat_ts&&n.lat0&&(e==="polar stereographic"||e==="polar stereographic (variant a)")&&(n.lat_ts=n.lat0,n.lat0=d2r(n.lat0>0?90:-90),delete n.lat1)}function processUnit(n){let e={units:null,to_meter:void 0};return typeof n=="string"?(e.units=n.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.units==="meter"&&(e.to_meter=1)):n&&n.name&&(e.units=n.name.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.to_meter=n.conversion_factor),e}function toValue(n){return typeof n=="object"?n.value*n.unit.conversion_factor:n}function calculateEllipsoid(n,e){n.ellipsoid.radius?(e.a=n.ellipsoid.radius,e.rf=0):(e.a=toValue(n.ellipsoid.semi_major_axis),n.ellipsoid.inverse_flattening!==void 0?e.rf=n.ellipsoid.inverse_flattening:n.ellipsoid.semi_major_axis!==void 0&&n.ellipsoid.semi_minor_axis!==void 0&&(e.rf=e.a/(e.a-toValue(n.ellipsoid.semi_minor_axis))))}function transformPROJJSON(n,e={}){return!n||typeof n!="object"?n:n.type==="BoundCRS"?(transformPROJJSON(n.source_crs,e),n.transformation&&(n.transformation.method&&n.transformation.method.name==="NTv2"?e.nadgrids=n.transformation.parameters[0].value:e.datum_params=n.transformation.parameters.map(i=>i.value)),e):(Object.keys(n).forEach(i=>{const s=n[i];if(s!==null)switch(i){case"name":if(e.srsCode)break;e.name=s,e.srsCode=s;break;case"type":s==="GeographicCRS"?e.projName="longlat":s==="ProjectedCRS"&&n.conversion&&n.conversion.method&&(e.projName=n.conversion.method.name);break;case"datum":case"datum_ensemble":s.ellipsoid&&(e.ellps=s.ellipsoid.name,calculateEllipsoid(s,e)),s.prime_meridian&&(e.from_greenwich=s.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":e.ellps=s.name,calculateEllipsoid(s,e);break;case"prime_meridian":e.long0=(s.longitude||0)*Math.PI/180;break;case"coordinate_system":if(s.axis){if(e.axis=s.axis.map(o=>{const l=o.direction;if(l==="east")return"e";if(l==="north")return"n";if(l==="west")return"w";if(l==="south")return"s";throw new Error(`Unknown axis direction: ${l}`)}).join("")+"u",s.unit){const{units:o,to_meter:l}=processUnit(s.unit);e.units=o,e.to_meter=l}else if(s.axis[0]&&s.axis[0].unit){const{units:o,to_meter:l}=processUnit(s.axis[0].unit);e.units=o,e.to_meter=l}}break;case"id":s.authority&&s.code&&(e.title=s.authority+":"+s.code);break;case"conversion":s.method&&s.method.name&&(e.projName=s.method.name),s.parameters&&s.parameters.forEach(o=>{const l=o.name.toLowerCase().replace(/\s+/g,"_"),c=o.value;o.unit&&o.unit.conversion_factor?e[l]=c*o.unit.conversion_factor:o.unit==="degree"?e[l]=c*Math.PI/180:e[l]=c});break;case"unit":s.name&&(e.units=s.name.toLowerCase(),e.units==="metre"&&(e.units="meter")),s.conversion_factor&&(e.to_meter=s.conversion_factor);break;case"base_crs":transformPROJJSON(s,e),e.datumCode=s.id?s.id.authority+"_"+s.id.code:s.name;break}}),e.latitude_of_false_origin!==void 0&&(e.lat0=e.latitude_of_false_origin),e.longitude_of_false_origin!==void 0&&(e.long0=e.longitude_of_false_origin),e.latitude_of_standard_parallel!==void 0&&(e.lat0=e.latitude_of_standard_parallel,e.lat1=e.latitude_of_standard_parallel),e.latitude_of_1st_standard_parallel!==void 0&&(e.lat1=e.latitude_of_1st_standard_parallel),e.latitude_of_2nd_standard_parallel!==void 0&&(e.lat2=e.latitude_of_2nd_standard_parallel),e.latitude_of_projection_centre!==void 0&&(e.lat0=e.latitude_of_projection_centre),e.longitude_of_projection_centre!==void 0&&(e.longc=e.longitude_of_projection_centre),e.easting_at_false_origin!==void 0&&(e.x0=e.easting_at_false_origin),e.northing_at_false_origin!==void 0&&(e.y0=e.northing_at_false_origin),e.latitude_of_natural_origin!==void 0&&(e.lat0=e.latitude_of_natural_origin),e.longitude_of_natural_origin!==void 0&&(e.long0=e.longitude_of_natural_origin),e.longitude_of_origin!==void 0&&(e.long0=e.longitude_of_origin),e.false_easting!==void 0&&(e.x0=e.false_easting),e.easting_at_projection_centre&&(e.x0=e.easting_at_projection_centre),e.false_northing!==void 0&&(e.y0=e.false_northing),e.northing_at_projection_centre&&(e.y0=e.northing_at_projection_centre),e.standard_parallel_1!==void 0&&(e.lat1=e.standard_parallel_1),e.standard_parallel_2!==void 0&&(e.lat2=e.standard_parallel_2),e.scale_factor_at_natural_origin!==void 0&&(e.k0=e.scale_factor_at_natural_origin),e.scale_factor_at_projection_centre!==void 0&&(e.k0=e.scale_factor_at_projection_centre),e.scale_factor_on_pseudo_standard_parallel!==void 0&&(e.k0=e.scale_factor_on_pseudo_standard_parallel),e.azimuth!==void 0&&(e.alpha=e.azimuth),e.azimuth_at_projection_centre!==void 0&&(e.alpha=e.azimuth_at_projection_centre),e.angle_from_rectified_to_skew_grid&&(e.rectified_grid_angle=e.angle_from_rectified_to_skew_grid),applyProjectionDefaults(e),e)}var knownTypes=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function rename(n,e){var i=e[0],s=e[1];!(i in n)&&s in n&&(n[i]=n[s],e.length===3&&(n[i]=e[2](n[i])))}function cleanWKT(n){for(var e=Object.keys(n),i=0,s=e.length;i<s;++i){var o=e[i];knownTypes.indexOf(o)!==-1&&setPropertiesFromWkt(n[o]),typeof n[o]=="object"&&cleanWKT(n[o])}}function setPropertiesFromWkt(n){if(n.AUTHORITY){var e=Object.keys(n.AUTHORITY)[0];e&&e in n.AUTHORITY&&(n.title=e+":"+n.AUTHORITY[e])}if(n.type==="GEOGCS"?n.projName="longlat":n.type==="LOCAL_CS"?(n.projName="identity",n.local=!0):typeof n.PROJECTION=="object"?n.projName=Object.keys(n.PROJECTION)[0]:n.projName=n.PROJECTION,n.AXIS){for(var i="",s=0,o=n.AXIS.length;s<o;++s){var l=[n.AXIS[s][0].toLowerCase(),n.AXIS[s][1].toLowerCase()];l[0].indexOf("north")!==-1||(l[0]==="y"||l[0]==="lat")&&l[1]==="north"?i+="n":l[0].indexOf("south")!==-1||(l[0]==="y"||l[0]==="lat")&&l[1]==="south"?i+="s":l[0].indexOf("east")!==-1||(l[0]==="x"||l[0]==="lon")&&l[1]==="east"?i+="e":(l[0].indexOf("west")!==-1||(l[0]==="x"||l[0]==="lon")&&l[1]==="west")&&(i+="w")}i.length===2&&(i+="u"),i.length===3&&(n.axis=i)}n.UNIT&&(n.units=n.UNIT.name.toLowerCase(),n.units==="metre"&&(n.units="meter"),n.UNIT.convert&&(n.type==="GEOGCS"?n.DATUM&&n.DATUM.SPHEROID&&(n.to_meter=n.UNIT.convert*n.DATUM.SPHEROID.a):n.to_meter=n.UNIT.convert));var c=n.GEOGCS;n.type==="GEOGCS"&&(c=n),c&&(c.DATUM?n.datumCode=c.DATUM.name.toLowerCase():n.datumCode=c.name.toLowerCase(),n.datumCode.slice(0,2)==="d_"&&(n.datumCode=n.datumCode.slice(2)),n.datumCode==="new_zealand_1949"&&(n.datumCode="nzgd49"),(n.datumCode==="wgs_1984"||n.datumCode==="world_geodetic_system_1984")&&(n.PROJECTION==="Mercator_Auxiliary_Sphere"&&(n.sphere=!0),n.datumCode="wgs84"),n.datumCode==="belge_1972"&&(n.datumCode="rnb72"),c.DATUM&&c.DATUM.SPHEROID&&(n.ellps=c.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),n.ellps.toLowerCase().slice(0,13)==="international"&&(n.ellps="intl"),n.a=c.DATUM.SPHEROID.a,n.rf=parseFloat(c.DATUM.SPHEROID.rf,10)),c.DATUM&&c.DATUM.TOWGS84&&(n.datum_params=c.DATUM.TOWGS84),~n.datumCode.indexOf("osgb_1936")&&(n.datumCode="osgb36"),~n.datumCode.indexOf("osni_1952")&&(n.datumCode="osni52"),(~n.datumCode.indexOf("tm65")||~n.datumCode.indexOf("geodetic_datum_of_1965"))&&(n.datumCode="ire65"),n.datumCode==="ch1903+"&&(n.datumCode="ch1903"),~n.datumCode.indexOf("israel")&&(n.datumCode="isr93")),n.b&&!isFinite(n.b)&&(n.b=n.a),n.rectified_grid_angle&&(n.rectified_grid_angle=d2r(n.rectified_grid_angle));function u(H){var Y=n.to_meter||1;return H*Y}var f=function(H){return rename(n,H)},g=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",d2r],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",d2r],["x0","false_easting",u],["y0","false_northing",u],["long0","central_meridian",d2r],["lat0","latitude_of_origin",d2r],["lat0","standard_parallel_1",d2r],["lat1","standard_parallel_1",d2r],["lat2","standard_parallel_2",d2r],["azimuth","Azimuth"],["alpha","azimuth",d2r],["srsCode","name"]];g.forEach(f),applyProjectionDefaults(n)}function wkt(n){if(typeof n=="object")return transformPROJJSON(n);const e=detectWKTVersion(n);var i=parseString(n);if(e==="WKT2"){const l=buildPROJJSON(i);return transformPROJJSON(l)}var s=i[0],o={};return sExpr(i,o),cleanWKT(o),o[s]}function defs(n){var e=this;if(arguments.length===2){var i=arguments[1];typeof i=="string"?i.charAt(0)==="+"?defs[n]=projStr(arguments[1]):defs[n]=wkt(arguments[1]):defs[n]=i}else if(arguments.length===1){if(Array.isArray(n))return n.map(function(s){Array.isArray(s)?defs.apply(e,s):defs(s)});if(typeof n=="string"){if(n in defs)return defs[n]}else"EPSG"in n?defs["EPSG:"+n.EPSG]=n:"ESRI"in n?defs["ESRI:"+n.ESRI]=n:"IAU2000"in n?defs["IAU2000:"+n.IAU2000]=n:console.log(n);return}}globals(defs);function testObj(n){return typeof n=="string"}function testDef(n){return n in defs}var codeWords=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function testWKT(n){return codeWords.some(function(e){return n.indexOf(e)>-1})}var codes=["3857","900913","3785","102113"];function checkMercator(n){var e=match(n,"authority");if(e){var i=match(e,"epsg");return i&&codes.indexOf(i)>-1}}function checkProjStr(n){var e=match(n,"extension");if(e)return match(e,"proj4")}function testProj(n){return n[0]==="+"}function parse(n){if(testObj(n)){if(testDef(n))return defs[n];if(testWKT(n)){var e=wkt(n);if(checkMercator(e))return defs["EPSG:3857"];var i=checkProjStr(e);return i?projStr(i):e}if(testProj(n))return projStr(n)}else return n}function extend(n,e){n=n||{};var i,s;if(!e)return n;for(s in e)i=e[s],i!==void 0&&(n[s]=i);return n}function msfnz(n,e,i){var s=n*e;return i/Math.sqrt(1-s*s)}function sign(n){return n<0?-1:1}function adjust_lon(n){return Math.abs(n)<=SPI?n:n-sign(n)*TWO_PI}function tsfnz(n,e,i){var s=n*i,o=.5*n;return s=Math.pow((1-s)/(1+s),o),Math.tan(.5*(HALF_PI-e))/s}function phi2z(n,e){for(var i=.5*n,s,o,l=HALF_PI-2*Math.atan(e),c=0;c<=15;c++)if(s=n*Math.sin(l),o=HALF_PI-2*Math.atan(e*Math.pow((1-s)/(1+s),i))-l,l+=o,Math.abs(o)<=1e-10)return l;return-9999}function init$x(){var n=this.b/this.a;this.es=1-n*n,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=msfnz(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function forward$v(n){var e=n.x,i=n.y;if(i*R2D>90&&i*R2D<-90&&e*R2D>180&&e*R2D<-180)return null;var s,o;if(Math.abs(Math.abs(i)-HALF_PI)<=EPSLN)return null;if(this.sphere)s=this.x0+this.a*this.k0*adjust_lon(e-this.long0),o=this.y0+this.a*this.k0*Math.log(Math.tan(FORTPI+.5*i));else{var l=Math.sin(i),c=tsfnz(this.e,i,l);s=this.x0+this.a*this.k0*adjust_lon(e-this.long0),o=this.y0-this.a*this.k0*Math.log(c)}return n.x=s,n.y=o,n}function inverse$v(n){var e=n.x-this.x0,i=n.y-this.y0,s,o;if(this.sphere)o=HALF_PI-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var l=Math.exp(-i/(this.a*this.k0));if(o=phi2z(this.e,l),o===-9999)return null}return s=adjust_lon(this.long0+e/(this.a*this.k0)),n.x=s,n.y=o,n}var names$y=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const merc={init:init$x,forward:forward$v,inverse:inverse$v,names:names$y};function init$w(){}function identity(n){return n}var names$x=["longlat","identity"];const longlat={init:init$w,forward:identity,inverse:identity,names:names$x};var projs=[merc,longlat],names$w={},projStore=[];function add(n,e){var i=projStore.length;return n.names?(projStore[i]=n,n.names.forEach(function(s){names$w[s.toLowerCase()]=i}),this):(console.log(e),!0)}function get(n){if(!n)return!1;var e=n.toLowerCase();if(typeof names$w[e]<"u"&&projStore[names$w[e]])return projStore[names$w[e]]}function start(){projs.forEach(add)}const projections={start,add,get};var exports$1={};exports$1.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};exports$1.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};exports$1.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};exports$1.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};exports$1.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};exports$1.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};exports$1.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};exports$1.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};exports$1.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};exports$1.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};exports$1.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};exports$1.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};exports$1.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};exports$1.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};exports$1.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};exports$1.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};exports$1.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};exports$1.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};exports$1.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};exports$1.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};exports$1.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};exports$1.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};exports$1.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};exports$1.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};exports$1.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};exports$1.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};exports$1.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};exports$1.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};exports$1.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};exports$1.hough={a:6378270,rf:297,ellipseName:"Hough"};exports$1.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};exports$1.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};exports$1.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};exports$1.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};exports$1.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};exports$1.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};exports$1.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};exports$1.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};exports$1.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};exports$1.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};exports$1.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};exports$1.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var WGS84=exports$1.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};exports$1.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function eccentricity(n,e,i,s){var o=n*n,l=e*e,c=(o-l)/o,u=0;s?(n*=1-c*(SIXTH+c*(RA4+c*RA6)),o=n*n,c=0):u=Math.sqrt(c);var f=(o-l)/l;return{es:c,e:u,ep2:f}}function sphere(n,e,i,s,o){if(!n){var l=match(exports$1,s);l||(l=WGS84),n=l.a,e=l.b,i=l.rf}return i&&!e&&(e=(1-1/i)*n),(i===0||Math.abs(n-e)<EPSLN)&&(o=!0,e=n),{a:n,b:e,rf:i,sphere:o}}var datums={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}};for(var key in datums){var datum$1=datums[key];datums[datum$1.datumName]=datum$1}function datum(n,e,i,s,o,l,c){var u={};return n===void 0||n==="none"?u.datum_type=PJD_NODATUM:u.datum_type=PJD_WGS84,e&&(u.datum_params=e.map(parseFloat),(u.datum_params[0]!==0||u.datum_params[1]!==0||u.datum_params[2]!==0)&&(u.datum_type=PJD_3PARAM),u.datum_params.length>3&&(u.datum_params[3]!==0||u.datum_params[4]!==0||u.datum_params[5]!==0||u.datum_params[6]!==0)&&(u.datum_type=PJD_7PARAM,u.datum_params[3]*=SEC_TO_RAD,u.datum_params[4]*=SEC_TO_RAD,u.datum_params[5]*=SEC_TO_RAD,u.datum_params[6]=u.datum_params[6]/1e6+1)),c&&(u.datum_type=PJD_GRIDSHIFT,u.grids=c),u.a=i,u.b=s,u.es=o,u.ep2=l,u}var loadedNadgrids={};function nadgrid(n,e){var i=new DataView(e),s=detectLittleEndian(i),o=readHeader(i,s),l=readSubgrids(i,o,s),c={header:o,subgrids:l};return loadedNadgrids[n]=c,c}function getNadgrids(n){if(n===void 0)return null;var e=n.split(",");return e.map(parseNadgridString)}function parseNadgridString(n){if(n.length===0)return null;var e=n[0]==="@";return e&&(n=n.slice(1)),n==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:n,mandatory:!e,grid:loadedNadgrids[n]||null,isNull:!1}}function secondsToRadians(n){return n/3600*Math.PI/180}function detectLittleEndian(n){var e=n.getInt32(8,!1);return e===11?!1:(e=n.getInt32(8,!0),e!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function readHeader(n,e){return{nFields:n.getInt32(8,e),nSubgridFields:n.getInt32(24,e),nSubgrids:n.getInt32(40,e),shiftType:decodeString(n,56,64).trim(),fromSemiMajorAxis:n.getFloat64(120,e),fromSemiMinorAxis:n.getFloat64(136,e),toSemiMajorAxis:n.getFloat64(152,e),toSemiMinorAxis:n.getFloat64(168,e)}}function decodeString(n,e,i){return String.fromCharCode.apply(null,new Uint8Array(n.buffer.slice(e,i)))}function readSubgrids(n,e,i){for(var s=176,o=[],l=0;l<e.nSubgrids;l++){var c=readGridHeader(n,s,i),u=readGridNodes(n,s,c,i),f=Math.round(1+(c.upperLongitude-c.lowerLongitude)/c.longitudeInterval),g=Math.round(1+(c.upperLatitude-c.lowerLatitude)/c.latitudeInterval);o.push({ll:[secondsToRadians(c.lowerLongitude),secondsToRadians(c.lowerLatitude)],del:[secondsToRadians(c.longitudeInterval),secondsToRadians(c.latitudeInterval)],lim:[f,g],count:c.gridNodeCount,cvs:mapNodes(u)}),s+=176+c.gridNodeCount*16}return o}function mapNodes(n){return n.map(function(e){return[secondsToRadians(e.longitudeShift),secondsToRadians(e.latitudeShift)]})}function readGridHeader(n,e,i){return{name:decodeString(n,e+8,e+16).trim(),parent:decodeString(n,e+24,e+24+8).trim(),lowerLatitude:n.getFloat64(e+72,i),upperLatitude:n.getFloat64(e+88,i),lowerLongitude:n.getFloat64(e+104,i),upperLongitude:n.getFloat64(e+120,i),latitudeInterval:n.getFloat64(e+136,i),longitudeInterval:n.getFloat64(e+152,i),gridNodeCount:n.getInt32(e+168,i)}}function readGridNodes(n,e,i,s){for(var o=e+176,l=16,c=[],u=0;u<i.gridNodeCount;u++){var f={latitudeShift:n.getFloat32(o+u*l,s),longitudeShift:n.getFloat32(o+u*l+4,s),latitudeAccuracy:n.getFloat32(o+u*l+8,s),longitudeAccuracy:n.getFloat32(o+u*l+12,s)};c.push(f)}return c}function Projection(n,e){if(!(this instanceof Projection))return new Projection(n);e=e||function(g){if(g)throw g};var i=parse(n);if(typeof i!="object"){e("Could not parse to valid json: "+n);return}var s=Projection.projections.get(i.projName);if(!s){e("Could not get projection name from: "+n);return}if(i.datumCode&&i.datumCode!=="none"){var o=match(datums,i.datumCode);o&&(i.datum_params=i.datum_params||(o.towgs84?o.towgs84.split(","):null),i.ellps=o.ellipse,i.datumName=o.datumName?o.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu",i.ellps=i.ellps||"wgs84",i.lat1=i.lat1||i.lat0;var l=sphere(i.a,i.b,i.rf,i.ellps,i.sphere),c=eccentricity(l.a,l.b,l.rf,i.R_A),u=getNadgrids(i.nadgrids),f=i.datum||datum(i.datumCode,i.datum_params,l.a,l.b,c.es,c.ep2,u);extend(this,i),extend(this,s),this.a=l.a,this.b=l.b,this.rf=l.rf,this.sphere=l.sphere,this.es=c.es,this.e=c.e,this.ep2=c.ep2,this.datum=f,this.init(),e(null,this)}Projection.projections=projections;Projection.projections.start();function compareDatums(n,e){return n.datum_type!==e.datum_type||n.a!==e.a||Math.abs(n.es-e.es)>5e-11?!1:n.datum_type===PJD_3PARAM?n.datum_params[0]===e.datum_params[0]&&n.datum_params[1]===e.datum_params[1]&&n.datum_params[2]===e.datum_params[2]:n.datum_type===PJD_7PARAM?n.datum_params[0]===e.datum_params[0]&&n.datum_params[1]===e.datum_params[1]&&n.datum_params[2]===e.datum_params[2]&&n.datum_params[3]===e.datum_params[3]&&n.datum_params[4]===e.datum_params[4]&&n.datum_params[5]===e.datum_params[5]&&n.datum_params[6]===e.datum_params[6]:!0}function geodeticToGeocentric(n,e,i){var s=n.x,o=n.y,l=n.z?n.z:0,c,u,f,g;if(o<-HALF_PI&&o>-1.001*HALF_PI)o=-HALF_PI;else if(o>HALF_PI&&o<1.001*HALF_PI)o=HALF_PI;else{if(o<-HALF_PI)return{x:-1/0,y:-1/0,z:n.z};if(o>HALF_PI)return{x:1/0,y:1/0,z:n.z}}return s>Math.PI&&(s-=2*Math.PI),u=Math.sin(o),g=Math.cos(o),f=u*u,c=i/Math.sqrt(1-e*f),{x:(c+l)*g*Math.cos(s),y:(c+l)*g*Math.sin(s),z:(c*(1-e)+l)*u}}function geocentricToGeodetic(n,e,i,s){var o=1e-12,l=o*o,c=30,u,f,g,H,Y,ee,te,ne,Ye,xe,tt,et,it,rt=n.x,nt=n.y,at=n.z?n.z:0,st,ot,ut;if(u=Math.sqrt(rt*rt+nt*nt),f=Math.sqrt(rt*rt+nt*nt+at*at),u/i<o){if(st=0,f/i<o)return ot=HALF_PI,ut=-s,{x:n.x,y:n.y,z:n.z}}else st=Math.atan2(nt,rt);g=at/f,H=u/f,Y=1/Math.sqrt(1-e*(2-e)*H*H),ne=H*(1-e)*Y,Ye=g*Y,it=0;do it++,te=i/Math.sqrt(1-e*Ye*Ye),ut=u*ne+at*Ye-te*(1-e*Ye*Ye),ee=e*te/(te+ut),Y=1/Math.sqrt(1-ee*(2-ee)*H*H),xe=H*(1-ee)*Y,tt=g*Y,et=tt*ne-xe*Ye,ne=xe,Ye=tt;while(et*et>l&&it<c);return ot=Math.atan(tt/Math.abs(xe)),{x:st,y:ot,z:ut}}function geocentricToWgs84(n,e,i){if(e===PJD_3PARAM)return{x:n.x+i[0],y:n.y+i[1],z:n.z+i[2]};if(e===PJD_7PARAM){var s=i[0],o=i[1],l=i[2],c=i[3],u=i[4],f=i[5],g=i[6];return{x:g*(n.x-f*n.y+u*n.z)+s,y:g*(f*n.x+n.y-c*n.z)+o,z:g*(-u*n.x+c*n.y+n.z)+l}}}function geocentricFromWgs84(n,e,i){if(e===PJD_3PARAM)return{x:n.x-i[0],y:n.y-i[1],z:n.z-i[2]};if(e===PJD_7PARAM){var s=i[0],o=i[1],l=i[2],c=i[3],u=i[4],f=i[5],g=i[6],H=(n.x-s)/g,Y=(n.y-o)/g,ee=(n.z-l)/g;return{x:H+f*Y-u*ee,y:-f*H+Y+c*ee,z:u*H-c*Y+ee}}}function checkParams(n){return n===PJD_3PARAM||n===PJD_7PARAM}function datum_transform(n,e,i){if(compareDatums(n,e)||n.datum_type===PJD_NODATUM||e.datum_type===PJD_NODATUM)return i;var s=n.a,o=n.es;if(n.datum_type===PJD_GRIDSHIFT){var l=applyGridShift(n,!1,i);if(l!==0)return;s=SRS_WGS84_SEMIMAJOR,o=SRS_WGS84_ESQUARED}var c=e.a,u=e.b,f=e.es;if(e.datum_type===PJD_GRIDSHIFT&&(c=SRS_WGS84_SEMIMAJOR,u=SRS_WGS84_SEMIMINOR,f=SRS_WGS84_ESQUARED),o===f&&s===c&&!checkParams(n.datum_type)&&!checkParams(e.datum_type))return i;if(i=geodeticToGeocentric(i,o,s),checkParams(n.datum_type)&&(i=geocentricToWgs84(i,n.datum_type,n.datum_params)),checkParams(e.datum_type)&&(i=geocentricFromWgs84(i,e.datum_type,e.datum_params)),i=geocentricToGeodetic(i,f,c,u),e.datum_type===PJD_GRIDSHIFT){var g=applyGridShift(e,!0,i);if(g!==0)return}return i}function applyGridShift(n,e,i){if(n.grids===null||n.grids.length===0)return console.log("Grid shift grids not found"),-1;var s={x:-i.x,y:i.y},o={x:Number.NaN,y:Number.NaN},l=[];e:for(var c=0;c<n.grids.length;c++){var u=n.grids[c];if(l.push(u.name),u.isNull){o=s;break}if(u.mandatory,u.grid===null){if(u.mandatory)return console.log("Unable to find mandatory grid '"+u.name+"'"),-1;continue}for(var f=u.grid.subgrids,g=0,H=f.length;g<H;g++){var Y=f[g],ee=(Math.abs(Y.del[1])+Math.abs(Y.del[0]))/1e4,te=Y.ll[0]-ee,ne=Y.ll[1]-ee,Ye=Y.ll[0]+(Y.lim[0]-1)*Y.del[0]+ee,xe=Y.ll[1]+(Y.lim[1]-1)*Y.del[1]+ee;if(!(ne>s.y||te>s.x||xe<s.y||Ye<s.x)&&(o=applySubgridShift(s,e,Y),!isNaN(o.x)))break e}}return isNaN(o.x)?(console.log("Failed to find a grid shift table for location '"+-s.x*R2D+" "+s.y*R2D+" tried: '"+l+"'"),-1):(i.x=-o.x,i.y=o.y,0)}function applySubgridShift(n,e,i){var s={x:Number.NaN,y:Number.NaN};if(isNaN(n.x))return s;var o={x:n.x,y:n.y};o.x-=i.ll[0],o.y-=i.ll[1],o.x=adjust_lon(o.x-Math.PI)+Math.PI;var l=nadInterpolate(o,i);if(e){if(isNaN(l.x))return s;l.x=o.x-l.x,l.y=o.y-l.y;var c=9,u=1e-12,f,g;do{if(g=nadInterpolate(l,i),isNaN(g.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}f={x:o.x-(g.x+l.x),y:o.y-(g.y+l.y)},l.x+=f.x,l.y+=f.y}while(c--&&Math.abs(f.x)>u&&Math.abs(f.y)>u);if(c<0)return console.log("Inverse grid shift iterator failed to converge."),s;s.x=adjust_lon(l.x+i.ll[0]),s.y=l.y+i.ll[1]}else isNaN(l.x)||(s.x=n.x+l.x,s.y=n.y+l.y);return s}function nadInterpolate(n,e){var i={x:n.x/e.del[0],y:n.y/e.del[1]},s={x:Math.floor(i.x),y:Math.floor(i.y)},o={x:i.x-1*s.x,y:i.y-1*s.y},l={x:Number.NaN,y:Number.NaN},c;if(s.x<0||s.x>=e.lim[0]||s.y<0||s.y>=e.lim[1])return l;c=s.y*e.lim[0]+s.x;var u={x:e.cvs[c][0],y:e.cvs[c][1]};c++;var f={x:e.cvs[c][0],y:e.cvs[c][1]};c+=e.lim[0];var g={x:e.cvs[c][0],y:e.cvs[c][1]};c--;var H={x:e.cvs[c][0],y:e.cvs[c][1]},Y=o.x*o.y,ee=o.x*(1-o.y),te=(1-o.x)*(1-o.y),ne=(1-o.x)*o.y;return l.x=te*u.x+ee*f.x+ne*H.x+Y*g.x,l.y=te*u.y+ee*f.y+ne*H.y+Y*g.y,l}function adjust_axis(n,e,i){var s=i.x,o=i.y,l=i.z||0,c,u,f,g={};for(f=0;f<3;f++)if(!(e&&f===2&&i.z===void 0))switch(f===0?(c=s,"ew".indexOf(n.axis[f])!==-1?u="x":u="y"):f===1?(c=o,"ns".indexOf(n.axis[f])!==-1?u="y":u="x"):(c=l,u="z"),n.axis[f]){case"e":g[u]=c;break;case"w":g[u]=-c;break;case"n":g[u]=c;break;case"s":g[u]=-c;break;case"u":i[u]!==void 0&&(g.z=c);break;case"d":i[u]!==void 0&&(g.z=-c);break;default:return null}return g}function common(n){var e={x:n[0],y:n[1]};return n.length>2&&(e.z=n[2]),n.length>3&&(e.m=n[3]),e}function checkSanity(n){checkCoord(n.x),checkCoord(n.y)}function checkCoord(n){if(typeof Number.isFinite=="function"){if(Number.isFinite(n))return;throw new TypeError("coordinates must be finite numbers")}if(typeof n!="number"||n!==n||!isFinite(n))throw new TypeError("coordinates must be finite numbers")}function checkNotWGS(n,e){return(n.datum.datum_type===PJD_3PARAM||n.datum.datum_type===PJD_7PARAM||n.datum.datum_type===PJD_GRIDSHIFT)&&e.datumCode!=="WGS84"||(e.datum.datum_type===PJD_3PARAM||e.datum.datum_type===PJD_7PARAM||e.datum.datum_type===PJD_GRIDSHIFT)&&n.datumCode!=="WGS84"}function transform(n,e,i,s){var o;Array.isArray(i)?i=common(i):i={x:i.x,y:i.y,z:i.z,m:i.m};var l=i.z!==void 0;if(checkSanity(i),n.datum&&e.datum&&checkNotWGS(n,e)&&(o=new Projection("WGS84"),i=transform(n,o,i,s),n=o),s&&n.axis!=="enu"&&(i=adjust_axis(n,!1,i)),n.projName==="longlat")i={x:i.x*D2R$1,y:i.y*D2R$1,z:i.z||0};else if(n.to_meter&&(i={x:i.x*n.to_meter,y:i.y*n.to_meter,z:i.z||0}),i=n.inverse(i),!i)return;if(n.from_greenwich&&(i.x+=n.from_greenwich),i=datum_transform(n.datum,e.datum,i),!!i)return e.from_greenwich&&(i={x:i.x-e.from_greenwich,y:i.y,z:i.z||0}),e.projName==="longlat"?i={x:i.x*R2D,y:i.y*R2D,z:i.z||0}:(i=e.forward(i),e.to_meter&&(i={x:i.x/e.to_meter,y:i.y/e.to_meter,z:i.z||0})),s&&e.axis!=="enu"?adjust_axis(e,!0,i):(i&&!l&&delete i.z,i)}var wgs84=Projection("WGS84");function transformer(n,e,i,s){var o,l,c;return Array.isArray(i)?(o=transform(n,e,i,s)||{x:NaN,y:NaN},i.length>2?typeof n.name<"u"&&n.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof o.z=="number"?[o.x,o.y,o.z].concat(i.slice(3)):[o.x,o.y,i[2]].concat(i.slice(3)):[o.x,o.y].concat(i.slice(2)):[o.x,o.y]):(l=transform(n,e,i,s),c=Object.keys(i),c.length===2||c.forEach(function(u){if(typeof n.name<"u"&&n.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(u==="x"||u==="y"||u==="z")return}else if(u==="x"||u==="y")return;l[u]=i[u]}),l)}function checkProj(n){return n instanceof Projection?n:n.oProj?n.oProj:Projection(n)}function proj4(n,e,i){n=checkProj(n);var s=!1,o;return typeof e>"u"?(e=n,n=wgs84,s=!0):(typeof e.x<"u"||Array.isArray(e))&&(i=e,e=n,n=wgs84,s=!0),e=checkProj(e),i?transformer(n,e,i):(o={forward:function(l,c){return transformer(n,e,l,c)},inverse:function(l,c){return transformer(e,n,l,c)}},s&&(o.oProj=e),o)}var NUM_100K_SETS=6,SET_ORIGIN_COLUMN_LETTERS="AJSAJS",SET_ORIGIN_ROW_LETTERS="AFAFAF",A=65,I$2=73,O=79,V$1=86,Z=90;const mgrs={forward:forward$u,inverse:inverse$u,toPoint};function forward$u(n,e){return e=e||5,encode(LLtoUTM({lat:n[1],lon:n[0]}),e)}function inverse$u(n){var e=UTMtoLL(decode(n.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function toPoint(n){var e=UTMtoLL(decode(n.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function degToRad(n){return n*(Math.PI/180)}function radToDeg(n){return 180*(n/Math.PI)}function LLtoUTM(n){var e=n.lat,i=n.lon,s=6378137,o=.00669438,l=.9996,c,u,f,g,H,Y,ee,te=degToRad(e),ne=degToRad(i),Ye,xe;xe=Math.floor((i+180)/6)+1,i===180&&(xe=60),e>=56&&e<64&&i>=3&&i<12&&(xe=32),e>=72&&e<84&&(i>=0&&i<9?xe=31:i>=9&&i<21?xe=33:i>=21&&i<33?xe=35:i>=33&&i<42&&(xe=37)),c=(xe-1)*6-180+3,Ye=degToRad(c),u=o/(1-o),f=s/Math.sqrt(1-o*Math.sin(te)*Math.sin(te)),g=Math.tan(te)*Math.tan(te),H=u*Math.cos(te)*Math.cos(te),Y=Math.cos(te)*(ne-Ye),ee=s*((1-o/4-3*o*o/64-5*o*o*o/256)*te-(3*o/8+3*o*o/32+45*o*o*o/1024)*Math.sin(2*te)+(15*o*o/256+45*o*o*o/1024)*Math.sin(4*te)-35*o*o*o/3072*Math.sin(6*te));var tt=l*f*(Y+(1-g+H)*Y*Y*Y/6+(5-18*g+g*g+72*H-58*u)*Y*Y*Y*Y*Y/120)+5e5,et=l*(ee+f*Math.tan(te)*(Y*Y/2+(5-g+9*H+4*H*H)*Y*Y*Y*Y/24+(61-58*g+g*g+600*H-330*u)*Y*Y*Y*Y*Y*Y/720));return e<0&&(et+=1e7),{northing:Math.round(et),easting:Math.round(tt),zoneNumber:xe,zoneLetter:getLetterDesignator(e)}}function UTMtoLL(n){var e=n.northing,i=n.easting,s=n.zoneLetter,o=n.zoneNumber;if(o<0||o>60)return null;var l=.9996,c=6378137,u=.00669438,f,g=(1-Math.sqrt(1-u))/(1+Math.sqrt(1-u)),H,Y,ee,te,ne,Ye,xe,tt,et,it=i-5e5,rt=e;s<"N"&&(rt-=1e7),xe=(o-1)*6-180+3,f=u/(1-u),Ye=rt/l,tt=Ye/(c*(1-u/4-3*u*u/64-5*u*u*u/256)),et=tt+(3*g/2-27*g*g*g/32)*Math.sin(2*tt)+(21*g*g/16-55*g*g*g*g/32)*Math.sin(4*tt)+151*g*g*g/96*Math.sin(6*tt),H=c/Math.sqrt(1-u*Math.sin(et)*Math.sin(et)),Y=Math.tan(et)*Math.tan(et),ee=f*Math.cos(et)*Math.cos(et),te=c*(1-u)/Math.pow(1-u*Math.sin(et)*Math.sin(et),1.5),ne=it/(H*l);var nt=et-H*Math.tan(et)/te*(ne*ne/2-(5+3*Y+10*ee-4*ee*ee-9*f)*ne*ne*ne*ne/24+(61+90*Y+298*ee+45*Y*Y-252*f-3*ee*ee)*ne*ne*ne*ne*ne*ne/720);nt=radToDeg(nt);var at=(ne-(1+2*Y+ee)*ne*ne*ne/6+(5-2*ee+28*Y-3*ee*ee+8*f+24*Y*Y)*ne*ne*ne*ne*ne/120)/Math.cos(et);at=xe+radToDeg(at);var st;if(n.accuracy){var ot=UTMtoLL({northing:n.northing+n.accuracy,easting:n.easting+n.accuracy,zoneLetter:n.zoneLetter,zoneNumber:n.zoneNumber});st={top:ot.lat,right:ot.lon,bottom:nt,left:at}}else st={lat:nt,lon:at};return st}function getLetterDesignator(n){var e="Z";return 84>=n&&n>=72?e="X":72>n&&n>=64?e="W":64>n&&n>=56?e="V":56>n&&n>=48?e="U":48>n&&n>=40?e="T":40>n&&n>=32?e="S":32>n&&n>=24?e="R":24>n&&n>=16?e="Q":16>n&&n>=8?e="P":8>n&&n>=0?e="N":0>n&&n>=-8?e="M":-8>n&&n>=-16?e="L":-16>n&&n>=-24?e="K":-24>n&&n>=-32?e="J":-32>n&&n>=-40?e="H":-40>n&&n>=-48?e="G":-48>n&&n>=-56?e="F":-56>n&&n>=-64?e="E":-64>n&&n>=-72?e="D":-72>n&&n>=-80&&(e="C"),e}function encode(n,e){var i="00000"+n.easting,s="00000"+n.northing;return n.zoneNumber+n.zoneLetter+get100kID(n.easting,n.northing,n.zoneNumber)+i.substr(i.length-5,e)+s.substr(s.length-5,e)}function get100kID(n,e,i){var s=get100kSetForZone(i),o=Math.floor(n/1e5),l=Math.floor(e/1e5)%20;return getLetter100kID(o,l,s)}function get100kSetForZone(n){var e=n%NUM_100K_SETS;return e===0&&(e=NUM_100K_SETS),e}function getLetter100kID(n,e,i){var s=i-1,o=SET_ORIGIN_COLUMN_LETTERS.charCodeAt(s),l=SET_ORIGIN_ROW_LETTERS.charCodeAt(s),c=o+n-1,u=l+e,f=!1;c>Z&&(c=c-Z+A-1,f=!0),(c===I$2||o<I$2&&c>I$2||(c>I$2||o<I$2)&&f)&&c++,(c===O||o<O&&c>O||(c>O||o<O)&&f)&&(c++,c===I$2&&c++),c>Z&&(c=c-Z+A-1),u>V$1?(u=u-V$1+A-1,f=!0):f=!1,(u===I$2||l<I$2&&u>I$2||(u>I$2||l<I$2)&&f)&&u++,(u===O||l<O&&u>O||(u>O||l<O)&&f)&&(u++,u===I$2&&u++),u>V$1&&(u=u-V$1+A-1);var g=String.fromCharCode(c)+String.fromCharCode(u);return g}function decode(n){if(n&&n.length===0)throw"MGRSPoint coverting from nothing";for(var e=n.length,i=null,s="",o,l=0;!/[A-Z]/.test(o=n.charAt(l));){if(l>=2)throw"MGRSPoint bad conversion from: "+n;s+=o,l++}var c=parseInt(s,10);if(l===0||l+3>e)throw"MGRSPoint bad conversion from: "+n;var u=n.charAt(l++);if(u<="A"||u==="B"||u==="Y"||u>="Z"||u==="I"||u==="O")throw"MGRSPoint zone letter "+u+" not handled: "+n;i=n.substring(l,l+=2);for(var f=get100kSetForZone(c),g=getEastingFromChar(i.charAt(0),f),H=getNorthingFromChar(i.charAt(1),f);H<getMinNorthing(u);)H+=2e6;var Y=e-l;if(Y%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+n;var ee=Y/2,te=0,ne=0,Ye,xe,tt,et,it;return ee>0&&(Ye=1e5/Math.pow(10,ee),xe=n.substring(l,l+ee),te=parseFloat(xe)*Ye,tt=n.substring(l+ee),ne=parseFloat(tt)*Ye),et=te+g,it=ne+H,{easting:et,northing:it,zoneLetter:u,zoneNumber:c,accuracy:Ye}}function getEastingFromChar(n,e){for(var i=SET_ORIGIN_COLUMN_LETTERS.charCodeAt(e-1),s=1e5,o=!1;i!==n.charCodeAt(0);){if(i++,i===I$2&&i++,i===O&&i++,i>Z){if(o)throw"Bad character: "+n;i=A,o=!0}s+=1e5}return s}function getNorthingFromChar(n,e){if(n>"V")throw"MGRSPoint given invalid Northing "+n;for(var i=SET_ORIGIN_ROW_LETTERS.charCodeAt(e-1),s=0,o=!1;i!==n.charCodeAt(0);){if(i++,i===I$2&&i++,i===O&&i++,i>V$1){if(o)throw"Bad character: "+n;i=A,o=!0}s+=1e5}return s}function getMinNorthing(n){var e;switch(n){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+n}function Point(n,e,i){if(!(this instanceof Point))return new Point(n,e,i);if(Array.isArray(n))this.x=n[0],this.y=n[1],this.z=n[2]||0;else if(typeof n=="object")this.x=n.x,this.y=n.y,this.z=n.z||0;else if(typeof n=="string"&&typeof e>"u"){var s=n.split(",");this.x=parseFloat(s[0],10),this.y=parseFloat(s[1],10),this.z=parseFloat(s[2],10)||0}else this.x=n,this.y=e,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Point.fromMGRS=function(n){return new Point(toPoint(n))};Point.prototype.toMGRS=function(n){return forward$u([this.x,this.y],n)};var C00=1,C02=.25,C04=.046875,C06=.01953125,C08=.01068115234375,C22=.75,C44=.46875,C46=.013020833333333334,C48=.007120768229166667,C66=.3645833333333333,C68=.005696614583333333,C88=.3076171875;function pj_enfn(n){var e=[];e[0]=C00-n*(C02+n*(C04+n*(C06+n*C08))),e[1]=n*(C22-n*(C04+n*(C06+n*C08)));var i=n*n;return e[2]=i*(C44-n*(C46+n*C48)),i*=n,e[3]=i*(C66-n*C68),e[4]=i*n*C88,e}function pj_mlfn(n,e,i,s){return i*=e,e*=e,s[0]*n-i*(s[1]+e*(s[2]+e*(s[3]+e*s[4])))}var MAX_ITER$3=20;function pj_inv_mlfn(n,e,i){for(var s=1/(1-e),o=n,l=MAX_ITER$3;l;--l){var c=Math.sin(o),u=1-e*c*c;if(u=(pj_mlfn(o,c,Math.cos(o),i)-n)*(u*Math.sqrt(u))*s,o-=u,Math.abs(u)<EPSLN)return o}return o}function init$v(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=pj_enfn(this.es),this.ml0=pj_mlfn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function forward$t(n){var e=n.x,i=n.y,s=adjust_lon(e-this.long0),o,l,c,u=Math.sin(i),f=Math.cos(i);if(this.es){var H=f*s,Y=Math.pow(H,2),ee=this.ep2*Math.pow(f,2),te=Math.pow(ee,2),ne=Math.abs(f)>EPSLN?Math.tan(i):0,Ye=Math.pow(ne,2),xe=Math.pow(Ye,2);o=1-this.es*Math.pow(u,2),H=H/Math.sqrt(o);var tt=pj_mlfn(i,u,f,this.en);l=this.a*(this.k0*H*(1+Y/6*(1-Ye+ee+Y/20*(5-18*Ye+xe+14*ee-58*Ye*ee+Y/42*(61+179*xe-xe*Ye-479*Ye)))))+this.x0,c=this.a*(this.k0*(tt-this.ml0+u*s*H/2*(1+Y/12*(5-Ye+9*ee+4*te+Y/30*(61+xe-58*Ye+270*ee-330*Ye*ee+Y/56*(1385+543*xe-xe*Ye-3111*Ye))))))+this.y0}else{var g=f*Math.sin(s);if(Math.abs(Math.abs(g)-1)<EPSLN)return 93;if(l=.5*this.a*this.k0*Math.log((1+g)/(1-g))+this.x0,c=f*Math.cos(s)/Math.sqrt(1-Math.pow(g,2)),g=Math.abs(c),g>=1){if(g-1>EPSLN)return 93;c=0}else c=Math.acos(c);i<0&&(c=-c),c=this.a*this.k0*(c-this.lat0)+this.y0}return n.x=l,n.y=c,n}function inverse$t(n){var e,i,s,o,l=(n.x-this.x0)*(1/this.a),c=(n.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+c/this.k0,i=pj_inv_mlfn(e,this.es,this.en),Math.abs(i)<HALF_PI){var Y=Math.sin(i),ee=Math.cos(i),te=Math.abs(ee)>EPSLN?Math.tan(i):0,ne=this.ep2*Math.pow(ee,2),Ye=Math.pow(ne,2),xe=Math.pow(te,2),tt=Math.pow(xe,2);e=1-this.es*Math.pow(Y,2);var et=l*Math.sqrt(e)/this.k0,it=Math.pow(et,2);e=e*te,s=i-e*it/(1-this.es)*.5*(1-it/12*(5+3*xe-9*ne*xe+ne-4*Ye-it/30*(61+90*xe-252*ne*xe+45*tt+46*ne-it/56*(1385+3633*xe+4095*tt+1574*tt*xe)))),o=adjust_lon(this.long0+et*(1-it/6*(1+2*xe+ne-it/20*(5+28*xe+24*tt+8*ne*xe+6*ne-it/42*(61+662*xe+1320*tt+720*tt*xe))))/ee)}else s=HALF_PI*sign(c),o=0;else{var u=Math.exp(l/this.k0),f=.5*(u-1/u),g=this.lat0+c/this.k0,H=Math.cos(g);e=Math.sqrt((1-Math.pow(H,2))/(1+Math.pow(f,2))),s=Math.asin(e),c<0&&(s=-s),f===0&&H===0?o=0:o=adjust_lon(Math.atan2(f,H)+this.long0)}return n.x=o,n.y=s,n}var names$v=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const tmerc={init:init$v,forward:forward$t,inverse:inverse$t,names:names$v};function sinh(n){var e=Math.exp(n);return e=(e-1/e)/2,e}function hypot(n,e){n=Math.abs(n),e=Math.abs(e);var i=Math.max(n,e),s=Math.min(n,e)/(i||1);return i*Math.sqrt(1+Math.pow(s,2))}function log1py(n){var e=1+n,i=e-1;return i===0?n:n*Math.log(e)/i}function asinhy(n){var e=Math.abs(n);return e=log1py(e*(1+e/(hypot(1,e)+1))),n<0?-e:e}function gatg(n,e){for(var i=2*Math.cos(2*e),s=n.length-1,o=n[s],l=0,c;--s>=0;)c=-l+i*o+n[s],l=o,o=c;return e+c*Math.sin(2*e)}function clens(n,e){for(var i=2*Math.cos(e),s=n.length-1,o=n[s],l=0,c;--s>=0;)c=-l+i*o+n[s],l=o,o=c;return Math.sin(e)*c}function cosh(n){var e=Math.exp(n);return e=(e+1/e)/2,e}function clens_cmplx(n,e,i){for(var s=Math.sin(e),o=Math.cos(e),l=sinh(i),c=cosh(i),u=2*o*c,f=-2*s*l,g=n.length-1,H=n[g],Y=0,ee=0,te=0,ne,Ye;--g>=0;)ne=ee,Ye=Y,ee=H,Y=te,H=-ne+u*ee-f*Y+n[g],te=-Ye+f*ee+u*Y;return u=s*c,f=o*l,[u*H-f*te,u*te+f*H]}function init$u(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(tmerc.init.apply(this),this.forward=tmerc.forward,this.inverse=tmerc.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var n=this.es/(1+Math.sqrt(1-this.es)),e=n/(2-n),i=e;this.cgb[0]=e*(2+e*(-2/3+e*(-2+e*(116/45+e*(26/45+e*(-2854/675)))))),this.cbg[0]=e*(-2+e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))),i=i*e,this.cgb[1]=i*(7/3+e*(-8/5+e*(-227/45+e*(2704/315+e*(2323/945))))),this.cbg[1]=i*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),i=i*e,this.cgb[2]=i*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=i*(-26/15+e*(34/21+e*(8/5+e*(-12686/2835)))),i=i*e,this.cgb[3]=i*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=i*(1237/630+e*(-12/5+e*(-24832/14175))),i=i*e,this.cgb[4]=i*(4174/315+e*(-144838/6237)),this.cbg[4]=i*(-734/315+e*(109598/31185)),i=i*e,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+i*(1/4+i*(1/64+i/256))),this.utg[0]=e*(-.5+e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=i*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=i*(13/48+e*(-3/5+e*(557/1440+e*(281/630+e*(-1983433/1935360))))),i=i*e,this.utg[2]=i*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=i*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),i=i*e,this.utg[3]=i*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=i*(49561/161280+e*(-179/168+e*(6601661/7257600))),i=i*e,this.utg[4]=i*(-4583/161280+e*(108847/3991680)),this.gtu[4]=i*(34729/80640+e*(-3418889/1995840)),i=i*e,this.utg[5]=i*(-20648693/638668800),this.gtu[5]=i*(212378941/319334400);var s=gatg(this.cbg,this.lat0);this.Zb=-this.Qn*(s+clens(this.gtu,2*s))}function forward$s(n){var e=adjust_lon(n.x-this.long0),i=n.y;i=gatg(this.cbg,i);var s=Math.sin(i),o=Math.cos(i),l=Math.sin(e),c=Math.cos(e);i=Math.atan2(s,c*o),e=Math.atan2(l*o,hypot(s,o*c)),e=asinhy(Math.tan(e));var u=clens_cmplx(this.gtu,2*i,2*e);i=i+u[0],e=e+u[1];var f,g;return Math.abs(e)<=2.623395162778?(f=this.a*(this.Qn*e)+this.x0,g=this.a*(this.Qn*i+this.Zb)+this.y0):(f=1/0,g=1/0),n.x=f,n.y=g,n}function inverse$s(n){var e=(n.x-this.x0)*(1/this.a),i=(n.y-this.y0)*(1/this.a);i=(i-this.Zb)/this.Qn,e=e/this.Qn;var s,o;if(Math.abs(e)<=2.623395162778){var l=clens_cmplx(this.utg,2*i,2*e);i=i+l[0],e=e+l[1],e=Math.atan(sinh(e));var c=Math.sin(i),u=Math.cos(i),f=Math.sin(e),g=Math.cos(e);i=Math.atan2(c*g,hypot(f,g*u)),e=Math.atan2(f,g*u),s=adjust_lon(e+this.long0),o=gatg(this.cgb,i)}else s=1/0,o=1/0;return n.x=s,n.y=o,n}var names$u=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const etmerc={init:init$u,forward:forward$s,inverse:inverse$s,names:names$u};function adjust_zone(n,e){if(n===void 0){if(n=Math.floor((adjust_lon(e)+Math.PI)*30/Math.PI)+1,n<0)return 0;if(n>60)return 60}return n}var dependsOn="etmerc";function init$t(){var n=adjust_zone(this.zone,this.long0);if(n===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(n)-183)*D2R$1,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,etmerc.init.apply(this),this.forward=etmerc.forward,this.inverse=etmerc.inverse}var names$t=["Universal Transverse Mercator System","utm"];const utm={init:init$t,names:names$t,dependsOn};function srat(n,e){return Math.pow((1-n)/(1+n),e)}var MAX_ITER$2=20;function init$s(){var n=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*n*n),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(n/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+FORTPI)/(Math.pow(Math.tan(.5*this.lat0+FORTPI),this.C)*srat(this.e*n,this.ratexp))}function forward$r(n){var e=n.x,i=n.y;return n.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+FORTPI),this.C)*srat(this.e*Math.sin(i),this.ratexp))-HALF_PI,n.x=this.C*e,n}function inverse$r(n){for(var e=1e-14,i=n.x/this.C,s=n.y,o=Math.pow(Math.tan(.5*s+FORTPI)/this.K,1/this.C),l=MAX_ITER$2;l>0&&(s=2*Math.atan(o*srat(this.e*Math.sin(n.y),-.5*this.e))-HALF_PI,!(Math.abs(s-n.y)<e));--l)n.y=s;return l?(n.x=i,n.y=s,n):null}const gauss={init:init$s,forward:forward$r,inverse:inverse$r};function init$r(){gauss.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function forward$q(n){var e,i,s,o;return n.x=adjust_lon(n.x-this.long0),gauss.forward.apply(this,[n]),e=Math.sin(n.y),i=Math.cos(n.y),s=Math.cos(n.x),o=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*i*s),n.x=o*i*Math.sin(n.x),n.y=o*(this.cosc0*e-this.sinc0*i*s),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function inverse$q(n){var e,i,s,o,l;if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,l=hypot(n.x,n.y)){var c=2*Math.atan2(l,this.R2);e=Math.sin(c),i=Math.cos(c),o=Math.asin(i*this.sinc0+n.y*e*this.cosc0/l),s=Math.atan2(n.x*e,l*this.cosc0*i-n.y*this.sinc0*e)}else o=this.phic0,s=0;return n.x=s,n.y=o,gauss.inverse.apply(this,[n]),n.x=adjust_lon(n.x+this.long0),n}var names$s=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const sterea={init:init$r,forward:forward$q,inverse:inverse$q,names:names$s};function ssfn_(n,e,i){return e*=i,Math.tan(.5*(HALF_PI+n))*Math.pow((1-e)/(1+e),.5*i)}function init$q(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=EPSLN&&(this.k0=.5*(1+sign(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=EPSLN&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=EPSLN&&Math.abs(Math.cos(this.lat_ts))>EPSLN&&(this.k0=.5*this.cons*msfnz(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/tsfnz(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=msfnz(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-HALF_PI,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function forward$p(n){var e=n.x,i=n.y,s=Math.sin(i),o=Math.cos(i),l,c,u,f,g,H,Y=adjust_lon(e-this.long0);return Math.abs(Math.abs(e-this.long0)-Math.PI)<=EPSLN&&Math.abs(i+this.lat0)<=EPSLN?(n.x=NaN,n.y=NaN,n):this.sphere?(l=2*this.k0/(1+this.sinlat0*s+this.coslat0*o*Math.cos(Y)),n.x=this.a*l*o*Math.sin(Y)+this.x0,n.y=this.a*l*(this.coslat0*s-this.sinlat0*o*Math.cos(Y))+this.y0,n):(c=2*Math.atan(this.ssfn_(i,s,this.e))-HALF_PI,f=Math.cos(c),u=Math.sin(c),Math.abs(this.coslat0)<=EPSLN?(g=tsfnz(this.e,i*this.con,this.con*s),H=2*this.a*this.k0*g/this.cons,n.x=this.x0+H*Math.sin(e-this.long0),n.y=this.y0-this.con*H*Math.cos(e-this.long0),n):(Math.abs(this.sinlat0)<EPSLN?(l=2*this.a*this.k0/(1+f*Math.cos(Y)),n.y=l*u):(l=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*u+this.cosX0*f*Math.cos(Y))),n.y=l*(this.cosX0*u-this.sinX0*f*Math.cos(Y))+this.y0),n.x=l*f*Math.sin(Y)+this.x0,n))}function inverse$p(n){n.x-=this.x0,n.y-=this.y0;var e,i,s,o,l,c=Math.sqrt(n.x*n.x+n.y*n.y);if(this.sphere){var u=2*Math.atan(c/(2*this.a*this.k0));return e=this.long0,i=this.lat0,c<=EPSLN?(n.x=e,n.y=i,n):(i=Math.asin(Math.cos(u)*this.sinlat0+n.y*Math.sin(u)*this.coslat0/c),Math.abs(this.coslat0)<EPSLN?this.lat0>0?e=adjust_lon(this.long0+Math.atan2(n.x,-1*n.y)):e=adjust_lon(this.long0+Math.atan2(n.x,n.y)):e=adjust_lon(this.long0+Math.atan2(n.x*Math.sin(u),c*this.coslat0*Math.cos(u)-n.y*this.sinlat0*Math.sin(u))),n.x=e,n.y=i,n)}else if(Math.abs(this.coslat0)<=EPSLN){if(c<=EPSLN)return i=this.lat0,e=this.long0,n.x=e,n.y=i,n;n.x*=this.con,n.y*=this.con,s=c*this.cons/(2*this.a*this.k0),i=this.con*phi2z(this.e,s),e=this.con*adjust_lon(this.con*this.long0+Math.atan2(n.x,-1*n.y))}else o=2*Math.atan(c*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,c<=EPSLN?l=this.X0:(l=Math.asin(Math.cos(o)*this.sinX0+n.y*Math.sin(o)*this.cosX0/c),e=adjust_lon(this.long0+Math.atan2(n.x*Math.sin(o),c*this.cosX0*Math.cos(o)-n.y*this.sinX0*Math.sin(o)))),i=-1*phi2z(this.e,Math.tan(.5*(HALF_PI+l)));return n.x=e,n.y=i,n}var names$r=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const stere={init:init$q,forward:forward$p,inverse:inverse$p,names:names$r,ssfn_};function init$p(){var n=this.lat0;this.lambda0=this.long0;var e=Math.sin(n),i=this.a,s=this.rf,o=1/s,l=2*o-Math.pow(o,2),c=this.e=Math.sqrt(l);this.R=this.k0*i*Math.sqrt(1-l)/(1-l*Math.pow(e,2)),this.alpha=Math.sqrt(1+l/(1-l)*Math.pow(Math.cos(n),4)),this.b0=Math.asin(e/this.alpha);var u=Math.log(Math.tan(Math.PI/4+this.b0/2)),f=Math.log(Math.tan(Math.PI/4+n/2)),g=Math.log((1+c*e)/(1-c*e));this.K=u-this.alpha*f+this.alpha*c/2*g}function forward$o(n){var e=Math.log(Math.tan(Math.PI/4-n.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(n.y))/(1-this.e*Math.sin(n.y))),s=-this.alpha*(e+i)+this.K,o=2*(Math.atan(Math.exp(s))-Math.PI/4),l=this.alpha*(n.x-this.lambda0),c=Math.atan(Math.sin(l)/(Math.sin(this.b0)*Math.tan(o)+Math.cos(this.b0)*Math.cos(l))),u=Math.asin(Math.cos(this.b0)*Math.sin(o)-Math.sin(this.b0)*Math.cos(o)*Math.cos(l));return n.y=this.R/2*Math.log((1+Math.sin(u))/(1-Math.sin(u)))+this.y0,n.x=this.R*c+this.x0,n}function inverse$o(n){for(var e=n.x-this.x0,i=n.y-this.y0,s=e/this.R,o=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),l=Math.asin(Math.cos(this.b0)*Math.sin(o)+Math.sin(this.b0)*Math.cos(o)*Math.cos(s)),c=Math.atan(Math.sin(s)/(Math.cos(this.b0)*Math.cos(s)-Math.sin(this.b0)*Math.tan(o))),u=this.lambda0+c/this.alpha,f=0,g=l,H=-1e3,Y=0;Math.abs(g-H)>1e-7;){if(++Y>20)return;f=1/this.alpha*(Math.log(Math.tan(Math.PI/4+l/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(g))/2)),H=g,g=2*Math.atan(Math.exp(f))-Math.PI/2}return n.x=u,n.y=g,n}var names$q=["somerc"];const somerc={init:init$p,forward:forward$o,inverse:inverse$o,names:names$q};var TOL=1e-7;function isTypeA(n){var e=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],i=typeof n.PROJECTION=="object"?Object.keys(n.PROJECTION)[0]:n.PROJECTION;return"no_uoff"in n||"no_off"in n||e.indexOf(i)!==-1}function init$o(){var n,e,i,s,o,l,c,u,f,g,H=0,Y,ee=0,te=0,ne=0,Ye=0,xe=0,tt=0;this.no_off=isTypeA(this),this.no_rot="no_rot"in this;var et=!1;"alpha"in this&&(et=!0);var it=!1;if("rectified_grid_angle"in this&&(it=!0),et&&(tt=this.alpha),it&&(H=this.rectified_grid_angle*D2R$1),et||it)ee=this.longc;else if(te=this.long1,Ye=this.lat1,ne=this.long2,xe=this.lat2,Math.abs(Ye-xe)<=TOL||(n=Math.abs(Ye))<=TOL||Math.abs(n-HALF_PI)<=TOL||Math.abs(Math.abs(this.lat0)-HALF_PI)<=TOL||Math.abs(Math.abs(xe)-HALF_PI)<=TOL)throw new Error;var rt=1-this.es;e=Math.sqrt(rt),Math.abs(this.lat0)>EPSLN?(u=Math.sin(this.lat0),i=Math.cos(this.lat0),n=1-this.es*u*u,this.B=i*i,this.B=Math.sqrt(1+this.es*this.B*this.B/rt),this.A=this.B*this.k0*e/n,s=this.B*e/(i*Math.sqrt(n)),o=s*s-1,o<=0?o=0:(o=Math.sqrt(o),this.lat0<0&&(o=-o)),this.E=o+=s,this.E*=Math.pow(tsfnz(this.e,this.lat0,u),this.B)):(this.B=1/e,this.A=this.k0,this.E=s=o=1),et||it?(et?(Y=Math.asin(Math.sin(tt)/s),it||(H=tt)):(Y=H,tt=Math.asin(s*Math.sin(Y))),this.lam0=ee-Math.asin(.5*(o-1/o)*Math.tan(Y))/this.B):(l=Math.pow(tsfnz(this.e,Ye,Math.sin(Ye)),this.B),c=Math.pow(tsfnz(this.e,xe,Math.sin(xe)),this.B),o=this.E/l,f=(c-l)/(c+l),g=this.E*this.E,g=(g-c*l)/(g+c*l),n=te-ne,n<-Math.pi?ne-=TWO_PI:n>Math.pi&&(ne+=TWO_PI),this.lam0=adjust_lon(.5*(te+ne)-Math.atan(g*Math.tan(.5*this.B*(te-ne))/f)/this.B),Y=Math.atan(2*Math.sin(this.B*adjust_lon(te-this.lam0))/(o-1/o)),H=tt=Math.asin(s*Math.sin(Y))),this.singam=Math.sin(Y),this.cosgam=Math.cos(Y),this.sinrot=Math.sin(H),this.cosrot=Math.cos(H),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(s*s-1)/Math.cos(tt))),this.lat0<0&&(this.u_0=-this.u_0)),o=.5*Y,this.v_pole_n=this.ArB*Math.log(Math.tan(FORTPI-o)),this.v_pole_s=this.ArB*Math.log(Math.tan(FORTPI+o))}function forward$n(n){var e={},i,s,o,l,c,u,f,g;if(n.x=n.x-this.lam0,Math.abs(Math.abs(n.y)-HALF_PI)>EPSLN){if(c=this.E/Math.pow(tsfnz(this.e,n.y,Math.sin(n.y)),this.B),u=1/c,i=.5*(c-u),s=.5*(c+u),l=Math.sin(this.B*n.x),o=(i*this.singam-l*this.cosgam)/s,Math.abs(Math.abs(o)-1)<EPSLN)throw new Error;g=.5*this.ArB*Math.log((1-o)/(1+o)),u=Math.cos(this.B*n.x),Math.abs(u)<TOL?f=this.A*n.x:f=this.ArB*Math.atan2(i*this.cosgam+l*this.singam,u)}else g=n.y>0?this.v_pole_n:this.v_pole_s,f=this.ArB*n.y;return this.no_rot?(e.x=f,e.y=g):(f-=this.u_0,e.x=g*this.cosrot+f*this.sinrot,e.y=f*this.cosrot-g*this.sinrot),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function inverse$n(n){var e,i,s,o,l,c,u,f={};if(n.x=(n.x-this.x0)*(1/this.a),n.y=(n.y-this.y0)*(1/this.a),this.no_rot?(i=n.y,e=n.x):(i=n.x*this.cosrot-n.y*this.sinrot,e=n.y*this.cosrot+n.x*this.sinrot+this.u_0),s=Math.exp(-this.BrA*i),o=.5*(s-1/s),l=.5*(s+1/s),c=Math.sin(this.BrA*e),u=(c*this.cosgam+o*this.singam)/l,Math.abs(Math.abs(u)-1)<EPSLN)f.x=0,f.y=u<0?-HALF_PI:HALF_PI;else{if(f.y=this.E/Math.sqrt((1+u)/(1-u)),f.y=phi2z(this.e,Math.pow(f.y,1/this.B)),f.y===1/0)throw new Error;f.x=-this.rB*Math.atan2(o*this.cosgam-c*this.singam,Math.cos(this.BrA*e))}return f.x+=this.lam0,f}var names$p=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const omerc={init:init$o,forward:forward$n,inverse:inverse$n,names:names$p};function init$n(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<EPSLN)){var n=this.b/this.a;this.e=Math.sqrt(1-n*n);var e=Math.sin(this.lat1),i=Math.cos(this.lat1),s=msfnz(this.e,e,i),o=tsfnz(this.e,this.lat1,e),l=Math.sin(this.lat2),c=Math.cos(this.lat2),u=msfnz(this.e,l,c),f=tsfnz(this.e,this.lat2,l),g=tsfnz(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>EPSLN?this.ns=Math.log(s/u)/Math.log(o/f):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=s/(this.ns*Math.pow(o,this.ns)),this.rh=this.a*this.f0*Math.pow(g,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function forward$m(n){var e=n.x,i=n.y;Math.abs(2*Math.abs(i)-Math.PI)<=EPSLN&&(i=sign(i)*(HALF_PI-2*EPSLN));var s=Math.abs(Math.abs(i)-HALF_PI),o,l;if(s>EPSLN)o=tsfnz(this.e,i,Math.sin(i)),l=this.a*this.f0*Math.pow(o,this.ns);else{if(s=i*this.ns,s<=0)return null;l=0}var c=this.ns*adjust_lon(e-this.long0);return n.x=this.k0*(l*Math.sin(c))+this.x0,n.y=this.k0*(this.rh-l*Math.cos(c))+this.y0,n}function inverse$m(n){var e,i,s,o,l,c=(n.x-this.x0)/this.k0,u=this.rh-(n.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(c*c+u*u),i=1):(e=-Math.sqrt(c*c+u*u),i=-1);var f=0;if(e!==0&&(f=Math.atan2(i*c,i*u)),e!==0||this.ns>0){if(i=1/this.ns,s=Math.pow(e/(this.a*this.f0),i),o=phi2z(this.e,s),o===-9999)return null}else o=-HALF_PI;return l=adjust_lon(f/this.ns+this.long0),n.x=l,n.y=o,n}var names$o=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const lcc={init:init$n,forward:forward$m,inverse:inverse$m,names:names$o};function init$m(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function forward$l(n){var e,i,s,o,l,c,u,f=n.x,g=n.y,H=adjust_lon(f-this.long0);return e=Math.pow((1+this.e*Math.sin(g))/(1-this.e*Math.sin(g)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(g/2+this.s45),this.alfa)/e)-this.s45),s=-H*this.alfa,o=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(s)),l=Math.asin(Math.cos(i)*Math.sin(s)/Math.cos(o)),c=this.n*l,u=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(o/2+this.s45),this.n),n.y=u*Math.cos(c)/1,n.x=u*Math.sin(c)/1,this.czech||(n.y*=-1,n.x*=-1),n}function inverse$l(n){var e,i,s,o,l,c,u,f,g=n.x;n.x=n.y,n.y=g,this.czech||(n.y*=-1,n.x*=-1),c=Math.sqrt(n.x*n.x+n.y*n.y),l=Math.atan2(n.y,n.x),o=l/Math.sin(this.s0),s=2*(Math.atan(Math.pow(this.ro0/c,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(s)-Math.sin(this.ad)*Math.cos(s)*Math.cos(o)),i=Math.asin(Math.cos(s)*Math.sin(o)/Math.cos(e)),n.x=this.long0-i/this.alfa,u=e,f=0;var H=0;do n.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(u))/(1-this.e*Math.sin(u)),this.e/2))-this.s45),Math.abs(u-n.y)<1e-10&&(f=1),u=n.y,H+=1;while(f===0&&H<15);return H>=15?null:n}var names$n=["Krovak","krovak"];const krovak={init:init$m,forward:forward$l,inverse:inverse$l,names:names$n};function mlfn(n,e,i,s,o){return n*o-e*Math.sin(2*o)+i*Math.sin(4*o)-s*Math.sin(6*o)}function e0fn(n){return 1-.25*n*(1+n/16*(3+1.25*n))}function e1fn(n){return .375*n*(1+.25*n*(1+.46875*n))}function e2fn(n){return .05859375*n*n*(1+.75*n)}function e3fn(n){return n*n*n*(35/3072)}function gN(n,e,i){var s=e*i;return n/Math.sqrt(1-s*s)}function adjust_lat(n){return Math.abs(n)<HALF_PI?n:n-sign(n)*Math.PI}function imlfn(n,e,i,s,o){var l,c;l=n/e;for(var u=0;u<15;u++)if(c=(n-(e*l-i*Math.sin(2*l)+s*Math.sin(4*l)-o*Math.sin(6*l)))/(e-2*i*Math.cos(2*l)+4*s*Math.cos(4*l)-6*o*Math.cos(6*l)),l+=c,Math.abs(c)<=1e-10)return l;return NaN}function init$l(){this.sphere||(this.e0=e0fn(this.es),this.e1=e1fn(this.es),this.e2=e2fn(this.es),this.e3=e3fn(this.es),this.ml0=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0))}function forward$k(n){var e,i,s=n.x,o=n.y;if(s=adjust_lon(s-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(o)*Math.sin(s)),i=this.a*(Math.atan2(Math.tan(o),Math.cos(s))-this.lat0);else{var l=Math.sin(o),c=Math.cos(o),u=gN(this.a,this.e,l),f=Math.tan(o)*Math.tan(o),g=s*Math.cos(o),H=g*g,Y=this.es*c*c/(1-this.es),ee=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,o);e=u*g*(1-H*f*(1/6-(8-f+8*Y)*H/120)),i=ee-this.ml0+u*l/c*H*(.5+(5-f+6*Y)*H/24)}return n.x=e+this.x0,n.y=i+this.y0,n}function inverse$k(n){n.x-=this.x0,n.y-=this.y0;var e=n.x/this.a,i=n.y/this.a,s,o;if(this.sphere){var l=i+this.lat0;s=Math.asin(Math.sin(l)*Math.cos(e)),o=Math.atan2(Math.tan(e),Math.cos(l))}else{var c=this.ml0/this.a+i,u=imlfn(c,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(u)-HALF_PI)<=EPSLN)return n.x=this.long0,n.y=HALF_PI,i<0&&(n.y*=-1),n;var f=gN(this.a,this.e,Math.sin(u)),g=f*f*f/this.a/this.a*(1-this.es),H=Math.pow(Math.tan(u),2),Y=e*this.a/f,ee=Y*Y;s=u-f*Math.tan(u)/g*Y*Y*(.5-(1+3*H)*Y*Y/24),o=Y*(1-ee*(H/3+(1+3*H)*H*ee/15))/Math.cos(u)}return n.x=adjust_lon(o+this.long0),n.y=adjust_lat(s),n}var names$m=["Cassini","Cassini_Soldner","cass"];const cass={init:init$l,forward:forward$k,inverse:inverse$k,names:names$m};function qsfnz(n,e){var i;return n>1e-7?(i=n*e,(1-n*n)*(e/(1-i*i)-.5/n*Math.log((1-i)/(1+i)))):2*e}var S_POLE=1,N_POLE=2,EQUIT=3,OBLIQ=4;function init$k(){var n=Math.abs(this.lat0);if(Math.abs(n-HALF_PI)<EPSLN?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(n)<EPSLN?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=qsfnz(this.e,1),this.mmf=.5/(1-this.es),this.apa=authset(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=qsfnz(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function forward$j(n){var e,i,s,o,l,c,u,f,g,H,Y=n.x,ee=n.y;if(Y=adjust_lon(Y-this.long0),this.sphere){if(l=Math.sin(ee),H=Math.cos(ee),s=Math.cos(Y),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(i=this.mode===this.EQUIT?1+H*s:1+this.sinph0*l+this.cosph0*H*s,i<=EPSLN)return null;i=Math.sqrt(2/i),e=i*H*Math.sin(Y),i*=this.mode===this.EQUIT?l:this.cosph0*l-this.sinph0*H*s}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(s=-s),Math.abs(ee+this.lat0)<EPSLN)return null;i=FORTPI-ee*.5,i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)),e=i*Math.sin(Y),i*=s}}else{switch(u=0,f=0,g=0,s=Math.cos(Y),o=Math.sin(Y),l=Math.sin(ee),c=qsfnz(this.e,l),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(u=c/this.qp,f=Math.sqrt(1-u*u)),this.mode){case this.OBLIQ:g=1+this.sinb1*u+this.cosb1*f*s;break;case this.EQUIT:g=1+f*s;break;case this.N_POLE:g=HALF_PI+ee,c=this.qp-c;break;case this.S_POLE:g=ee-HALF_PI,c=this.qp+c;break}if(Math.abs(g)<EPSLN)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:g=Math.sqrt(2/g),this.mode===this.OBLIQ?i=this.ymf*g*(this.cosb1*u-this.sinb1*f*s):i=(g=Math.sqrt(2/(1+f*s)))*u*this.ymf,e=this.xmf*g*f*o;break;case this.N_POLE:case this.S_POLE:c>=0?(e=(g=Math.sqrt(c))*o,i=s*(this.mode===this.S_POLE?g:-g)):e=i=0;break}}return n.x=this.a*e+this.x0,n.y=this.a*i+this.y0,n}function inverse$j(n){n.x-=this.x0,n.y-=this.y0;var e=n.x/this.a,i=n.y/this.a,s,o,l,c,u,f,g;if(this.sphere){var H=0,Y,ee=0;if(Y=Math.sqrt(e*e+i*i),o=Y*.5,o>1)return null;switch(o=2*Math.asin(o),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(ee=Math.sin(o),H=Math.cos(o)),this.mode){case this.EQUIT:o=Math.abs(Y)<=EPSLN?0:Math.asin(i*ee/Y),e*=ee,i=H*Y;break;case this.OBLIQ:o=Math.abs(Y)<=EPSLN?this.lat0:Math.asin(H*this.sinph0+i*ee*this.cosph0/Y),e*=ee*this.cosph0,i=(H-Math.sin(o)*this.sinph0)*Y;break;case this.N_POLE:i=-i,o=HALF_PI-o;break;case this.S_POLE:o-=HALF_PI;break}s=i===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(e,i)}else{if(g=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e/=this.dd,i*=this.dd,f=Math.sqrt(e*e+i*i),f<EPSLN)return n.x=this.long0,n.y=this.lat0,n;c=2*Math.asin(.5*f/this.rq),l=Math.cos(c),e*=c=Math.sin(c),this.mode===this.OBLIQ?(g=l*this.sinb1+i*c*this.cosb1/f,u=this.qp*g,i=f*this.cosb1*l-i*this.sinb1*c):(g=i*c/f,u=this.qp*g,i=f*l)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),u=e*e+i*i,!u)return n.x=this.long0,n.y=this.lat0,n;g=1-u/this.qp,this.mode===this.S_POLE&&(g=-g)}s=Math.atan2(e,i),o=authlat(Math.asin(g),this.apa)}return n.x=adjust_lon(this.long0+s),n.y=o,n}var P00=.3333333333333333,P01=.17222222222222222,P02=.10257936507936508,P10=.06388888888888888,P11=.0664021164021164,P20=.016415012942191543;function authset(n){var e,i=[];return i[0]=n*P00,e=n*n,i[0]+=e*P01,i[1]=e*P10,e*=n,i[0]+=e*P02,i[1]+=e*P11,i[2]=e*P20,i}function authlat(n,e){var i=n+n;return n+e[0]*Math.sin(i)+e[1]*Math.sin(i+i)+e[2]*Math.sin(i+i+i)}var names$l=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const laea={init:init$k,forward:forward$j,inverse:inverse$j,names:names$l,S_POLE,N_POLE,EQUIT,OBLIQ};function asinz(n){return Math.abs(n)>1&&(n=n>1?1:-1),Math.asin(n)}function init$j(){Math.abs(this.lat1+this.lat2)<EPSLN||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=msfnz(this.e3,this.sin_po,this.cos_po),this.qs1=qsfnz(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=msfnz(this.e3,this.sin_po,this.cos_po),this.qs2=qsfnz(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=qsfnz(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>EPSLN?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function forward$i(n){var e=n.x,i=n.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var s=qsfnz(this.e3,this.sin_phi),o=this.a*Math.sqrt(this.c-this.ns0*s)/this.ns0,l=this.ns0*adjust_lon(e-this.long0),c=o*Math.sin(l)+this.x0,u=this.rh-o*Math.cos(l)+this.y0;return n.x=c,n.y=u,n}function inverse$i(n){var e,i,s,o,l,c;return n.x-=this.x0,n.y=this.rh-n.y+this.y0,this.ns0>=0?(e=Math.sqrt(n.x*n.x+n.y*n.y),s=1):(e=-Math.sqrt(n.x*n.x+n.y*n.y),s=-1),o=0,e!==0&&(o=Math.atan2(s*n.x,s*n.y)),s=e*this.ns0/this.a,this.sphere?c=Math.asin((this.c-s*s)/(2*this.ns0)):(i=(this.c-s*s)/this.ns0,c=this.phi1z(this.e3,i)),l=adjust_lon(o/this.ns0+this.long0),n.x=l,n.y=c,n}function phi1z(n,e){var i,s,o,l,c,u=asinz(.5*e);if(n<EPSLN)return u;for(var f=n*n,g=1;g<=25;g++)if(i=Math.sin(u),s=Math.cos(u),o=n*i,l=1-o*o,c=.5*l*l/s*(e/(1-f)-i/l+.5/n*Math.log((1-o)/(1+o))),u=u+c,Math.abs(c)<=1e-7)return u;return null}var names$k=["Albers_Conic_Equal_Area","Albers","aea"];const aea={init:init$j,forward:forward$i,inverse:inverse$i,names:names$k,phi1z};function init$i(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function forward$h(n){var e,i,s,o,l,c,u,f,g=n.x,H=n.y;return s=adjust_lon(g-this.long0),e=Math.sin(H),i=Math.cos(H),o=Math.cos(s),c=this.sin_p14*e+this.cos_p14*i*o,l=1,c>0||Math.abs(c)<=EPSLN?(u=this.x0+this.a*l*i*Math.sin(s)/c,f=this.y0+this.a*l*(this.cos_p14*e-this.sin_p14*i*o)/c):(u=this.x0+this.infinity_dist*i*Math.sin(s),f=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*i*o)),n.x=u,n.y=f,n}function inverse$h(n){var e,i,s,o,l,c;return n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,(e=Math.sqrt(n.x*n.x+n.y*n.y))?(o=Math.atan2(e,this.rc),i=Math.sin(o),s=Math.cos(o),c=asinz(s*this.sin_p14+n.y*i*this.cos_p14/e),l=Math.atan2(n.x*i,e*this.cos_p14*s-n.y*this.sin_p14*i),l=adjust_lon(this.long0+l)):(c=this.phic0,l=0),n.x=l,n.y=c,n}var names$j=["gnom"];const gnom={init:init$i,forward:forward$h,inverse:inverse$h,names:names$j};function iqsfnz(n,e){var i=1-(1-n*n)/(2*n)*Math.log((1-n)/(1+n));if(Math.abs(Math.abs(e)-i)<1e-6)return e<0?-1*HALF_PI:HALF_PI;for(var s=Math.asin(.5*e),o,l,c,u,f=0;f<30;f++)if(l=Math.sin(s),c=Math.cos(s),u=n*l,o=Math.pow(1-u*u,2)/(2*c)*(e/(1-n*n)-l/(1-u*u)+.5/n*Math.log((1-u)/(1+u))),s+=o,Math.abs(o)<=1e-10)return s;return NaN}function init$h(){this.sphere||(this.k0=msfnz(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function forward$g(n){var e=n.x,i=n.y,s,o,l=adjust_lon(e-this.long0);if(this.sphere)s=this.x0+this.a*l*Math.cos(this.lat_ts),o=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var c=qsfnz(this.e,Math.sin(i));s=this.x0+this.a*this.k0*l,o=this.y0+this.a*c*.5/this.k0}return n.x=s,n.y=o,n}function inverse$g(n){n.x-=this.x0,n.y-=this.y0;var e,i;return this.sphere?(e=adjust_lon(this.long0+n.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(n.y/this.a*Math.cos(this.lat_ts))):(i=iqsfnz(this.e,2*n.y*this.k0/this.a),e=adjust_lon(this.long0+n.x/(this.a*this.k0))),n.x=e,n.y=i,n}var names$i=["cea"];const cea={init:init$h,forward:forward$g,inverse:inverse$g,names:names$i};function init$g(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function forward$f(n){var e=n.x,i=n.y,s=adjust_lon(e-this.long0),o=adjust_lat(i-this.lat0);return n.x=this.x0+this.a*s*this.rc,n.y=this.y0+this.a*o,n}function inverse$f(n){var e=n.x,i=n.y;return n.x=adjust_lon(this.long0+(e-this.x0)/(this.a*this.rc)),n.y=adjust_lat(this.lat0+(i-this.y0)/this.a),n}var names$h=["Equirectangular","Equidistant_Cylindrical","eqc"];const eqc={init:init$g,forward:forward$f,inverse:inverse$f,names:names$h};var MAX_ITER$1=20;function init$f(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=e0fn(this.es),this.e1=e1fn(this.es),this.e2=e2fn(this.es),this.e3=e3fn(this.es),this.ml0=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)}function forward$e(n){var e=n.x,i=n.y,s,o,l,c=adjust_lon(e-this.long0);if(l=c*Math.sin(i),this.sphere)Math.abs(i)<=EPSLN?(s=this.a*c,o=-1*this.a*this.lat0):(s=this.a*Math.sin(l)/Math.tan(i),o=this.a*(adjust_lat(i-this.lat0)+(1-Math.cos(l))/Math.tan(i)));else if(Math.abs(i)<=EPSLN)s=this.a*c,o=-1*this.ml0;else{var u=gN(this.a,this.e,Math.sin(i))/Math.tan(i);s=u*Math.sin(l),o=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+u*(1-Math.cos(l))}return n.x=s+this.x0,n.y=o+this.y0,n}function inverse$e(n){var e,i,s,o,l,c,u,f,g;if(s=n.x-this.x0,o=n.y-this.y0,this.sphere)if(Math.abs(o+this.a*this.lat0)<=EPSLN)e=adjust_lon(s/this.a+this.long0),i=0;else{c=this.lat0+o/this.a,u=s*s/this.a/this.a+c*c,f=c;var H;for(l=MAX_ITER$1;l;--l)if(H=Math.tan(f),g=-1*(c*(f*H+1)-f-.5*(f*f+u)*H)/((f-c)/H-1),f+=g,Math.abs(g)<=EPSLN){i=f;break}e=adjust_lon(this.long0+Math.asin(s*Math.tan(f)/this.a)/Math.sin(i))}else if(Math.abs(o+this.ml0)<=EPSLN)i=0,e=adjust_lon(this.long0+s/this.a);else{c=(this.ml0+o)/this.a,u=s*s/this.a/this.a+c*c,f=c;var Y,ee,te,ne,Ye;for(l=MAX_ITER$1;l;--l)if(Ye=this.e*Math.sin(f),Y=Math.sqrt(1-Ye*Ye)*Math.tan(f),ee=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,f),te=this.e0-2*this.e1*Math.cos(2*f)+4*this.e2*Math.cos(4*f)-6*this.e3*Math.cos(6*f),ne=ee/this.a,g=(c*(Y*ne+1)-ne-.5*Y*(ne*ne+u))/(this.es*Math.sin(2*f)*(ne*ne+u-2*c*ne)/(4*Y)+(c-ne)*(Y*te-2/Math.sin(2*f))-te),f-=g,Math.abs(g)<=EPSLN){i=f;break}Y=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),e=adjust_lon(this.long0+Math.asin(s*Y/this.a)/Math.sin(i))}return n.x=e,n.y=i,n}var names$g=["Polyconic","poly"];const poly={init:init$f,forward:forward$e,inverse:inverse$e,names:names$g};function init$e(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function forward$d(n){var e,i=n.x,s=n.y,o=s-this.lat0,l=i-this.long0,c=o/SEC_TO_RAD*1e-5,u=l,f=1,g=0;for(e=1;e<=10;e++)f=f*c,g=g+this.A[e]*f;var H=g,Y=u,ee=1,te=0,ne,Ye,xe=0,tt=0;for(e=1;e<=6;e++)ne=ee*H-te*Y,Ye=te*H+ee*Y,ee=ne,te=Ye,xe=xe+this.B_re[e]*ee-this.B_im[e]*te,tt=tt+this.B_im[e]*ee+this.B_re[e]*te;return n.x=tt*this.a+this.x0,n.y=xe*this.a+this.y0,n}function inverse$d(n){var e,i=n.x,s=n.y,o=i-this.x0,l=s-this.y0,c=l/this.a,u=o/this.a,f=1,g=0,H,Y,ee=0,te=0;for(e=1;e<=6;e++)H=f*c-g*u,Y=g*c+f*u,f=H,g=Y,ee=ee+this.C_re[e]*f-this.C_im[e]*g,te=te+this.C_im[e]*f+this.C_re[e]*g;for(var ne=0;ne<this.iterations;ne++){var Ye=ee,xe=te,tt,et,it=c,rt=u;for(e=2;e<=6;e++)tt=Ye*ee-xe*te,et=xe*ee+Ye*te,Ye=tt,xe=et,it=it+(e-1)*(this.B_re[e]*Ye-this.B_im[e]*xe),rt=rt+(e-1)*(this.B_im[e]*Ye+this.B_re[e]*xe);Ye=1,xe=0;var nt=this.B_re[1],at=this.B_im[1];for(e=2;e<=6;e++)tt=Ye*ee-xe*te,et=xe*ee+Ye*te,Ye=tt,xe=et,nt=nt+e*(this.B_re[e]*Ye-this.B_im[e]*xe),at=at+e*(this.B_im[e]*Ye+this.B_re[e]*xe);var st=nt*nt+at*at;ee=(it*nt+rt*at)/st,te=(rt*nt-it*at)/st}var ot=ee,ut=te,ht=1,dt=0;for(e=1;e<=9;e++)ht=ht*ot,dt=dt+this.D[e]*ht;var pt=this.lat0+dt*SEC_TO_RAD*1e5,yt=this.long0+ut;return n.x=yt,n.y=pt,n}var names$f=["New_Zealand_Map_Grid","nzmg"];const nzmg={init:init$e,forward:forward$d,inverse:inverse$d,names:names$f};function init$d(){}function forward$c(n){var e=n.x,i=n.y,s=adjust_lon(e-this.long0),o=this.x0+this.a*s,l=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return n.x=o,n.y=l,n}function inverse$c(n){n.x-=this.x0,n.y-=this.y0;var e=adjust_lon(this.long0+n.x/this.a),i=2.5*(Math.atan(Math.exp(.8*n.y/this.a))-Math.PI/4);return n.x=e,n.y=i,n}var names$e=["Miller_Cylindrical","mill"];const mill={init:init$d,forward:forward$c,inverse:inverse$c,names:names$e};var MAX_ITER=20;function init$c(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=pj_enfn(this.es)}function forward$b(n){var e,i,s=n.x,o=n.y;if(s=adjust_lon(s-this.long0),this.sphere){if(!this.m)o=this.n!==1?Math.asin(this.n*Math.sin(o)):o;else for(var l=this.n*Math.sin(o),c=MAX_ITER;c;--c){var u=(this.m*o+Math.sin(o)-l)/(this.m+Math.cos(o));if(o-=u,Math.abs(u)<EPSLN)break}e=this.a*this.C_x*s*(this.m+Math.cos(o)),i=this.a*this.C_y*o}else{var f=Math.sin(o),g=Math.cos(o);i=this.a*pj_mlfn(o,f,g,this.en),e=this.a*s*g/Math.sqrt(1-this.es*f*f)}return n.x=e,n.y=i,n}function inverse$b(n){var e,i,s,o;return n.x-=this.x0,s=n.x/this.a,n.y-=this.y0,e=n.y/this.a,this.sphere?(e/=this.C_y,s=s/(this.C_x*(this.m+Math.cos(e))),this.m?e=asinz((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=asinz(Math.sin(e)/this.n)),s=adjust_lon(s+this.long0),e=adjust_lat(e)):(e=pj_inv_mlfn(n.y/this.a,this.es,this.en),o=Math.abs(e),o<HALF_PI?(o=Math.sin(e),i=this.long0+n.x*Math.sqrt(1-this.es*o*o)/(this.a*Math.cos(e)),s=adjust_lon(i)):o-EPSLN<HALF_PI&&(s=this.long0)),n.x=s,n.y=e,n}var names$d=["Sinusoidal","sinu"];const sinu={init:init$c,forward:forward$b,inverse:inverse$b,names:names$d};function init$b(){}function forward$a(n){for(var e=n.x,i=n.y,s=adjust_lon(e-this.long0),o=i,l=Math.PI*Math.sin(i);;){var c=-(o+Math.sin(o)-l)/(1+Math.cos(o));if(o+=c,Math.abs(c)<EPSLN)break}o/=2,Math.PI/2-Math.abs(i)<EPSLN&&(s=0);var u=.900316316158*this.a*s*Math.cos(o)+this.x0,f=1.4142135623731*this.a*Math.sin(o)+this.y0;return n.x=u,n.y=f,n}function inverse$a(n){var e,i;n.x-=this.x0,n.y-=this.y0,i=n.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),e=Math.asin(i);var s=adjust_lon(this.long0+n.x/(.900316316158*this.a*Math.cos(e)));s<-Math.PI&&(s=-Math.PI),s>Math.PI&&(s=Math.PI),i=(2*e+Math.sin(2*e))/Math.PI,Math.abs(i)>1&&(i=1);var o=Math.asin(i);return n.x=s,n.y=o,n}var names$c=["Mollweide","moll"];const moll={init:init$b,forward:forward$a,inverse:inverse$a,names:names$c};function init$a(){Math.abs(this.lat1+this.lat2)<EPSLN||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=e0fn(this.es),this.e1=e1fn(this.es),this.e2=e2fn(this.es),this.e3=e3fn(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=msfnz(this.e,this.sinphi,this.cosphi),this.ml1=mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<EPSLN?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=msfnz(this.e,this.sinphi,this.cosphi),this.ml2=mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function forward$9(n){var e=n.x,i=n.y,s;if(this.sphere)s=this.a*(this.g-i);else{var o=mlfn(this.e0,this.e1,this.e2,this.e3,i);s=this.a*(this.g-o)}var l=this.ns*adjust_lon(e-this.long0),c=this.x0+s*Math.sin(l),u=this.y0+this.rh-s*Math.cos(l);return n.x=c,n.y=u,n}function inverse$9(n){n.x-=this.x0,n.y=this.rh-n.y+this.y0;var e,i,s,o;this.ns>=0?(i=Math.sqrt(n.x*n.x+n.y*n.y),e=1):(i=-Math.sqrt(n.x*n.x+n.y*n.y),e=-1);var l=0;if(i!==0&&(l=Math.atan2(e*n.x,e*n.y)),this.sphere)return o=adjust_lon(this.long0+l/this.ns),s=adjust_lat(this.g-i/this.a),n.x=o,n.y=s,n;var c=this.g-i/this.a;return s=imlfn(c,this.e0,this.e1,this.e2,this.e3),o=adjust_lon(this.long0+l/this.ns),n.x=o,n.y=s,n}var names$b=["Equidistant_Conic","eqdc"];const eqdc={init:init$a,forward:forward$9,inverse:inverse$9,names:names$b};function init$9(){this.R=this.a}function forward$8(n){var e=n.x,i=n.y,s=adjust_lon(e-this.long0),o,l;Math.abs(i)<=EPSLN&&(o=this.x0+this.R*s,l=this.y0);var c=asinz(2*Math.abs(i/Math.PI));(Math.abs(s)<=EPSLN||Math.abs(Math.abs(i)-HALF_PI)<=EPSLN)&&(o=this.x0,i>=0?l=this.y0+Math.PI*this.R*Math.tan(.5*c):l=this.y0+Math.PI*this.R*-Math.tan(.5*c));var u=.5*Math.abs(Math.PI/s-s/Math.PI),f=u*u,g=Math.sin(c),H=Math.cos(c),Y=H/(g+H-1),ee=Y*Y,te=Y*(2/g-1),ne=te*te,Ye=Math.PI*this.R*(u*(Y-ne)+Math.sqrt(f*(Y-ne)*(Y-ne)-(ne+f)*(ee-ne)))/(ne+f);s<0&&(Ye=-Ye),o=this.x0+Ye;var xe=f+Y;return Ye=Math.PI*this.R*(te*xe-u*Math.sqrt((ne+f)*(f+1)-xe*xe))/(ne+f),i>=0?l=this.y0+Ye:l=this.y0-Ye,n.x=o,n.y=l,n}function inverse$8(n){var e,i,s,o,l,c,u,f,g,H,Y,ee,te;return n.x-=this.x0,n.y-=this.y0,Y=Math.PI*this.R,s=n.x/Y,o=n.y/Y,l=s*s+o*o,c=-Math.abs(o)*(1+l),u=c-2*o*o+s*s,f=-2*c+1+2*o*o+l*l,te=o*o/f+(2*u*u*u/f/f/f-9*c*u/f/f)/27,g=(c-u*u/3/f)/f,H=2*Math.sqrt(-g/3),Y=3*te/g/H,Math.abs(Y)>1&&(Y>=0?Y=1:Y=-1),ee=Math.acos(Y)/3,n.y>=0?i=(-H*Math.cos(ee+Math.PI/3)-u/3/f)*Math.PI:i=-(-H*Math.cos(ee+Math.PI/3)-u/3/f)*Math.PI,Math.abs(s)<EPSLN?e=this.long0:e=adjust_lon(this.long0+Math.PI*(l-1+Math.sqrt(1+2*(s*s-o*o)+l*l))/2/s),n.x=e,n.y=i,n}var names$a=["Van_der_Grinten_I","VanDerGrinten","vandg"];const vandg={init:init$9,forward:forward$8,inverse:inverse$8,names:names$a};function init$8(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function forward$7(n){var e=n.x,i=n.y,s=Math.sin(n.y),o=Math.cos(n.y),l=adjust_lon(e-this.long0),c,u,f,g,H,Y,ee,te,ne,Ye,xe,tt,et,it,rt,nt,at,st,ot,ut,ht,dt,pt;return this.sphere?Math.abs(this.sin_p12-1)<=EPSLN?(n.x=this.x0+this.a*(HALF_PI-i)*Math.sin(l),n.y=this.y0-this.a*(HALF_PI-i)*Math.cos(l),n):Math.abs(this.sin_p12+1)<=EPSLN?(n.x=this.x0+this.a*(HALF_PI+i)*Math.sin(l),n.y=this.y0+this.a*(HALF_PI+i)*Math.cos(l),n):(st=this.sin_p12*s+this.cos_p12*o*Math.cos(l),nt=Math.acos(st),at=nt?nt/Math.sin(nt):1,n.x=this.x0+this.a*at*o*Math.sin(l),n.y=this.y0+this.a*at*(this.cos_p12*s-this.sin_p12*o*Math.cos(l)),n):(c=e0fn(this.es),u=e1fn(this.es),f=e2fn(this.es),g=e3fn(this.es),Math.abs(this.sin_p12-1)<=EPSLN?(H=this.a*mlfn(c,u,f,g,HALF_PI),Y=this.a*mlfn(c,u,f,g,i),n.x=this.x0+(H-Y)*Math.sin(l),n.y=this.y0-(H-Y)*Math.cos(l),n):Math.abs(this.sin_p12+1)<=EPSLN?(H=this.a*mlfn(c,u,f,g,HALF_PI),Y=this.a*mlfn(c,u,f,g,i),n.x=this.x0+(H+Y)*Math.sin(l),n.y=this.y0+(H+Y)*Math.cos(l),n):(ee=s/o,te=gN(this.a,this.e,this.sin_p12),ne=gN(this.a,this.e,s),Ye=Math.atan((1-this.es)*ee+this.es*te*this.sin_p12/(ne*o)),xe=Math.atan2(Math.sin(l),this.cos_p12*Math.tan(Ye)-this.sin_p12*Math.cos(l)),xe===0?ot=Math.asin(this.cos_p12*Math.sin(Ye)-this.sin_p12*Math.cos(Ye)):Math.abs(Math.abs(xe)-Math.PI)<=EPSLN?ot=-Math.asin(this.cos_p12*Math.sin(Ye)-this.sin_p12*Math.cos(Ye)):ot=Math.asin(Math.sin(l)*Math.cos(Ye)/Math.sin(xe)),tt=this.e*this.sin_p12/Math.sqrt(1-this.es),et=this.e*this.cos_p12*Math.cos(xe)/Math.sqrt(1-this.es),it=tt*et,rt=et*et,ut=ot*ot,ht=ut*ot,dt=ht*ot,pt=dt*ot,nt=te*ot*(1-ut*rt*(1-rt)/6+ht/8*it*(1-2*rt)+dt/120*(rt*(4-7*rt)-3*tt*tt*(1-7*rt))-pt/48*it),n.x=this.x0+nt*Math.sin(xe),n.y=this.y0+nt*Math.cos(xe),n))}function inverse$7(n){n.x-=this.x0,n.y-=this.y0;var e,i,s,o,l,c,u,f,g,H,Y,ee,te,ne,Ye,xe,tt,et,it,rt,nt,at,st,ot;return this.sphere?(e=Math.sqrt(n.x*n.x+n.y*n.y),e>2*HALF_PI*this.a?void 0:(i=e/this.a,s=Math.sin(i),o=Math.cos(i),l=this.long0,Math.abs(e)<=EPSLN?c=this.lat0:(c=asinz(o*this.sin_p12+n.y*s*this.cos_p12/e),u=Math.abs(this.lat0)-HALF_PI,Math.abs(u)<=EPSLN?this.lat0>=0?l=adjust_lon(this.long0+Math.atan2(n.x,-n.y)):l=adjust_lon(this.long0-Math.atan2(-n.x,n.y)):l=adjust_lon(this.long0+Math.atan2(n.x*s,e*this.cos_p12*o-n.y*this.sin_p12*s))),n.x=l,n.y=c,n)):(f=e0fn(this.es),g=e1fn(this.es),H=e2fn(this.es),Y=e3fn(this.es),Math.abs(this.sin_p12-1)<=EPSLN?(ee=this.a*mlfn(f,g,H,Y,HALF_PI),e=Math.sqrt(n.x*n.x+n.y*n.y),te=ee-e,c=imlfn(te/this.a,f,g,H,Y),l=adjust_lon(this.long0+Math.atan2(n.x,-1*n.y)),n.x=l,n.y=c,n):Math.abs(this.sin_p12+1)<=EPSLN?(ee=this.a*mlfn(f,g,H,Y,HALF_PI),e=Math.sqrt(n.x*n.x+n.y*n.y),te=e-ee,c=imlfn(te/this.a,f,g,H,Y),l=adjust_lon(this.long0+Math.atan2(n.x,n.y)),n.x=l,n.y=c,n):(e=Math.sqrt(n.x*n.x+n.y*n.y),xe=Math.atan2(n.x,n.y),ne=gN(this.a,this.e,this.sin_p12),tt=Math.cos(xe),et=this.e*this.cos_p12*tt,it=-et*et/(1-this.es),rt=3*this.es*(1-it)*this.sin_p12*this.cos_p12*tt/(1-this.es),nt=e/ne,at=nt-it*(1+it)*Math.pow(nt,3)/6-rt*(1+3*it)*Math.pow(nt,4)/24,st=1-it*at*at/2-nt*at*at*at/6,Ye=Math.asin(this.sin_p12*Math.cos(at)+this.cos_p12*Math.sin(at)*tt),l=adjust_lon(this.long0+Math.asin(Math.sin(xe)*Math.sin(at)/Math.cos(Ye))),ot=Math.sin(Ye),c=Math.atan2((ot-this.es*st*this.sin_p12)*Math.tan(Ye),ot*(1-this.es)),n.x=l,n.y=c,n))}var names$9=["Azimuthal_Equidistant","aeqd"];const aeqd={init:init$8,forward:forward$7,inverse:inverse$7,names:names$9};function init$7(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function forward$6(n){var e,i,s,o,l,c,u,f,g=n.x,H=n.y;return s=adjust_lon(g-this.long0),e=Math.sin(H),i=Math.cos(H),o=Math.cos(s),c=this.sin_p14*e+this.cos_p14*i*o,l=1,(c>0||Math.abs(c)<=EPSLN)&&(u=this.a*l*i*Math.sin(s),f=this.y0+this.a*l*(this.cos_p14*e-this.sin_p14*i*o)),n.x=u,n.y=f,n}function inverse$6(n){var e,i,s,o,l,c,u;return n.x-=this.x0,n.y-=this.y0,e=Math.sqrt(n.x*n.x+n.y*n.y),i=asinz(e/this.a),s=Math.sin(i),o=Math.cos(i),c=this.long0,Math.abs(e)<=EPSLN?(u=this.lat0,n.x=c,n.y=u,n):(u=asinz(o*this.sin_p14+n.y*s*this.cos_p14/e),l=Math.abs(this.lat0)-HALF_PI,Math.abs(l)<=EPSLN?(this.lat0>=0?c=adjust_lon(this.long0+Math.atan2(n.x,-n.y)):c=adjust_lon(this.long0-Math.atan2(-n.x,n.y)),n.x=c,n.y=u,n):(c=adjust_lon(this.long0+Math.atan2(n.x*s,e*this.cos_p14*o-n.y*this.sin_p14*s)),n.x=c,n.y=u,n))}var names$8=["ortho"];const ortho={init:init$7,forward:forward$6,inverse:inverse$6,names:names$8};var FACE_ENUM={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},AREA_ENUM={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function init$6(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=HALF_PI-FORTPI/2?this.face=FACE_ENUM.TOP:this.lat0<=-(HALF_PI-FORTPI/2)?this.face=FACE_ENUM.BOTTOM:Math.abs(this.long0)<=FORTPI?this.face=FACE_ENUM.FRONT:Math.abs(this.long0)<=HALF_PI+FORTPI?this.face=this.long0>0?FACE_ENUM.RIGHT:FACE_ENUM.LEFT:this.face=FACE_ENUM.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function forward$5(n){var e={x:0,y:0},i,s,o,l,c,u,f={value:0};if(n.x-=this.long0,this.es!==0?i=Math.atan(this.one_minus_f_squared*Math.tan(n.y)):i=n.y,s=n.x,this.face===FACE_ENUM.TOP)l=HALF_PI-i,s>=FORTPI&&s<=HALF_PI+FORTPI?(f.value=AREA_ENUM.AREA_0,o=s-HALF_PI):s>HALF_PI+FORTPI||s<=-(HALF_PI+FORTPI)?(f.value=AREA_ENUM.AREA_1,o=s>0?s-SPI:s+SPI):s>-(HALF_PI+FORTPI)&&s<=-FORTPI?(f.value=AREA_ENUM.AREA_2,o=s+HALF_PI):(f.value=AREA_ENUM.AREA_3,o=s);else if(this.face===FACE_ENUM.BOTTOM)l=HALF_PI+i,s>=FORTPI&&s<=HALF_PI+FORTPI?(f.value=AREA_ENUM.AREA_0,o=-s+HALF_PI):s<FORTPI&&s>=-FORTPI?(f.value=AREA_ENUM.AREA_1,o=-s):s<-FORTPI&&s>=-(HALF_PI+FORTPI)?(f.value=AREA_ENUM.AREA_2,o=-s-HALF_PI):(f.value=AREA_ENUM.AREA_3,o=s>0?-s+SPI:-s-SPI);else{var g,H,Y,ee,te,ne,Ye;this.face===FACE_ENUM.RIGHT?s=qsc_shift_lon_origin(s,+HALF_PI):this.face===FACE_ENUM.BACK?s=qsc_shift_lon_origin(s,+SPI):this.face===FACE_ENUM.LEFT&&(s=qsc_shift_lon_origin(s,-HALF_PI)),ee=Math.sin(i),te=Math.cos(i),ne=Math.sin(s),Ye=Math.cos(s),g=te*Ye,H=te*ne,Y=ee,this.face===FACE_ENUM.FRONT?(l=Math.acos(g),o=qsc_fwd_equat_face_theta(l,Y,H,f)):this.face===FACE_ENUM.RIGHT?(l=Math.acos(H),o=qsc_fwd_equat_face_theta(l,Y,-g,f)):this.face===FACE_ENUM.BACK?(l=Math.acos(-g),o=qsc_fwd_equat_face_theta(l,Y,-H,f)):this.face===FACE_ENUM.LEFT?(l=Math.acos(-H),o=qsc_fwd_equat_face_theta(l,Y,g,f)):(l=o=0,f.value=AREA_ENUM.AREA_0)}return u=Math.atan(12/SPI*(o+Math.acos(Math.sin(o)*Math.cos(FORTPI))-HALF_PI)),c=Math.sqrt((1-Math.cos(l))/(Math.cos(u)*Math.cos(u))/(1-Math.cos(Math.atan(1/Math.cos(o))))),f.value===AREA_ENUM.AREA_1?u+=HALF_PI:f.value===AREA_ENUM.AREA_2?u+=SPI:f.value===AREA_ENUM.AREA_3&&(u+=1.5*SPI),e.x=c*Math.cos(u),e.y=c*Math.sin(u),e.x=e.x*this.a+this.x0,e.y=e.y*this.a+this.y0,n.x=e.x,n.y=e.y,n}function inverse$5(n){var e={lam:0,phi:0},i,s,o,l,c,u,f,g,H,Y={value:0};if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,s=Math.atan(Math.sqrt(n.x*n.x+n.y*n.y)),i=Math.atan2(n.y,n.x),n.x>=0&&n.x>=Math.abs(n.y)?Y.value=AREA_ENUM.AREA_0:n.y>=0&&n.y>=Math.abs(n.x)?(Y.value=AREA_ENUM.AREA_1,i-=HALF_PI):n.x<0&&-n.x>=Math.abs(n.y)?(Y.value=AREA_ENUM.AREA_2,i=i<0?i+SPI:i-SPI):(Y.value=AREA_ENUM.AREA_3,i+=HALF_PI),H=SPI/12*Math.tan(i),c=Math.sin(H)/(Math.cos(H)-1/Math.sqrt(2)),u=Math.atan(c),o=Math.cos(i),l=Math.tan(s),f=1-o*o*l*l*(1-Math.cos(Math.atan(1/Math.cos(u)))),f<-1?f=-1:f>1&&(f=1),this.face===FACE_ENUM.TOP)g=Math.acos(f),e.phi=HALF_PI-g,Y.value===AREA_ENUM.AREA_0?e.lam=u+HALF_PI:Y.value===AREA_ENUM.AREA_1?e.lam=u<0?u+SPI:u-SPI:Y.value===AREA_ENUM.AREA_2?e.lam=u-HALF_PI:e.lam=u;else if(this.face===FACE_ENUM.BOTTOM)g=Math.acos(f),e.phi=g-HALF_PI,Y.value===AREA_ENUM.AREA_0?e.lam=-u+HALF_PI:Y.value===AREA_ENUM.AREA_1?e.lam=-u:Y.value===AREA_ENUM.AREA_2?e.lam=-u-HALF_PI:e.lam=u<0?-u-SPI:-u+SPI;else{var ee,te,ne;ee=f,H=ee*ee,H>=1?ne=0:ne=Math.sqrt(1-H)*Math.sin(u),H+=ne*ne,H>=1?te=0:te=Math.sqrt(1-H),Y.value===AREA_ENUM.AREA_1?(H=te,te=-ne,ne=H):Y.value===AREA_ENUM.AREA_2?(te=-te,ne=-ne):Y.value===AREA_ENUM.AREA_3&&(H=te,te=ne,ne=-H),this.face===FACE_ENUM.RIGHT?(H=ee,ee=-te,te=H):this.face===FACE_ENUM.BACK?(ee=-ee,te=-te):this.face===FACE_ENUM.LEFT&&(H=ee,ee=te,te=-H),e.phi=Math.acos(-ne)-HALF_PI,e.lam=Math.atan2(te,ee),this.face===FACE_ENUM.RIGHT?e.lam=qsc_shift_lon_origin(e.lam,-HALF_PI):this.face===FACE_ENUM.BACK?e.lam=qsc_shift_lon_origin(e.lam,-SPI):this.face===FACE_ENUM.LEFT&&(e.lam=qsc_shift_lon_origin(e.lam,+HALF_PI))}if(this.es!==0){var Ye,xe,tt;Ye=e.phi<0?1:0,xe=Math.tan(e.phi),tt=this.b/Math.sqrt(xe*xe+this.one_minus_f_squared),e.phi=Math.atan(Math.sqrt(this.a*this.a-tt*tt)/(this.one_minus_f*tt)),Ye&&(e.phi=-e.phi)}return e.lam+=this.long0,n.x=e.lam,n.y=e.phi,n}function qsc_fwd_equat_face_theta(n,e,i,s){var o;return n<EPSLN?(s.value=AREA_ENUM.AREA_0,o=0):(o=Math.atan2(e,i),Math.abs(o)<=FORTPI?s.value=AREA_ENUM.AREA_0:o>FORTPI&&o<=HALF_PI+FORTPI?(s.value=AREA_ENUM.AREA_1,o-=HALF_PI):o>HALF_PI+FORTPI||o<=-(HALF_PI+FORTPI)?(s.value=AREA_ENUM.AREA_2,o=o>=0?o-SPI:o+SPI):(s.value=AREA_ENUM.AREA_3,o+=HALF_PI)),o}function qsc_shift_lon_origin(n,e){var i=n+e;return i<-SPI?i+=TWO_PI:i>+SPI&&(i-=TWO_PI),i}var names$7=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const qsc={init:init$6,forward:forward$5,inverse:inverse$5,names:names$7};var COEFS_X=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],COEFS_Y=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],FXC=.8487,FYC=1.3523,C1=R2D/5,RC1=1/C1,NODES=18,poly3_val=function(n,e){return n[0]+e*(n[1]+e*(n[2]+e*n[3]))},poly3_der=function(n,e){return n[1]+e*(2*n[2]+e*3*n[3])};function newton_rapshon(n,e,i,s){for(var o=e;s;--s){var l=n(o);if(o-=l,Math.abs(l)<i)break}return o}function init$5(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function forward$4(n){var e=adjust_lon(n.x-this.long0),i=Math.abs(n.y),s=Math.floor(i*C1);s<0?s=0:s>=NODES&&(s=NODES-1),i=R2D*(i-RC1*s);var o={x:poly3_val(COEFS_X[s],i)*e,y:poly3_val(COEFS_Y[s],i)};return n.y<0&&(o.y=-o.y),o.x=o.x*this.a*FXC+this.x0,o.y=o.y*this.a*FYC+this.y0,o}function inverse$4(n){var e={x:(n.x-this.x0)/(this.a*FXC),y:Math.abs(n.y-this.y0)/(this.a*FYC)};if(e.y>=1)e.x/=COEFS_X[NODES][0],e.y=n.y<0?-HALF_PI:HALF_PI;else{var i=Math.floor(e.y*NODES);for(i<0?i=0:i>=NODES&&(i=NODES-1);;)if(COEFS_Y[i][0]>e.y)--i;else if(COEFS_Y[i+1][0]<=e.y)++i;else break;var s=COEFS_Y[i],o=5*(e.y-s[0])/(COEFS_Y[i+1][0]-s[0]);o=newton_rapshon(function(l){return(poly3_val(s,l)-e.y)/poly3_der(s,l)},o,EPSLN,100),e.x/=poly3_val(COEFS_X[i],o),e.y=(5*i+o)*D2R$1,n.y<0&&(e.y=-e.y)}return e.x=adjust_lon(e.x+this.long0),e}var names$6=["Robinson","robin"];const robin={init:init$5,forward:forward$4,inverse:inverse$4,names:names$6};function init$4(){this.name="geocent"}function forward$3(n){var e=geodeticToGeocentric(n,this.es,this.a);return e}function inverse$3(n){var e=geocentricToGeodetic(n,this.es,this.a,this.b);return e}var names$5=["Geocentric","geocentric","geocent","Geocent"];const geocent={init:init$4,forward:forward$3,inverse:inverse$3,names:names$5};var mode={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},params={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function init$3(){if(Object.keys(params).forEach((function(i){if(typeof this[i]>"u")this[i]=params[i].def;else{if(params[i].num&&isNaN(this[i]))throw new Error("Invalid parameter value, must be numeric "+i+" = "+this[i]);params[i].num&&(this[i]=parseFloat(this[i]))}params[i].degrees&&(this[i]=this[i]*D2R$1)}).bind(this)),Math.abs(Math.abs(this.lat0)-HALF_PI)<EPSLN?this.mode=this.lat0<0?mode.S_POLE:mode.N_POLE:Math.abs(this.lat0)<EPSLN?this.mode=mode.EQUIT:(this.mode=mode.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var n=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(n),this.sw=Math.sin(n)}function forward$2(n){n.x-=this.long0;var e=Math.sin(n.y),i=Math.cos(n.y),s=Math.cos(n.x),o,l;switch(this.mode){case mode.OBLIQ:l=this.sinph0*e+this.cosph0*i*s;break;case mode.EQUIT:l=i*s;break;case mode.S_POLE:l=-e;break;case mode.N_POLE:l=e;break}switch(l=this.pn1/(this.p-l),o=l*i*Math.sin(n.x),this.mode){case mode.OBLIQ:l*=this.cosph0*e-this.sinph0*i*s;break;case mode.EQUIT:l*=e;break;case mode.N_POLE:l*=-(i*s);break;case mode.S_POLE:l*=i*s;break}var c,u;return c=l*this.cg+o*this.sg,u=1/(c*this.sw*this.h1+this.cw),o=(o*this.cg-l*this.sg)*this.cw*u,l=c*u,n.x=o*this.a,n.y=l*this.a,n}function inverse$2(n){n.x/=this.a,n.y/=this.a;var e={x:n.x,y:n.y},i,s,o;o=1/(this.pn1-n.y*this.sw),i=this.pn1*n.x*o,s=this.pn1*n.y*this.cw*o,n.x=i*this.cg+s*this.sg,n.y=s*this.cg-i*this.sg;var l=hypot(n.x,n.y);if(Math.abs(l)<EPSLN)e.x=0,e.y=n.y;else{var c,u;switch(u=1-l*l*this.pfact,u=(this.p-Math.sqrt(u))/(this.pn1/l+l/this.pn1),c=Math.sqrt(1-u*u),this.mode){case mode.OBLIQ:e.y=Math.asin(c*this.sinph0+n.y*u*this.cosph0/l),n.y=(c-this.sinph0*Math.sin(e.y))*l,n.x*=u*this.cosph0;break;case mode.EQUIT:e.y=Math.asin(n.y*u/l),n.y=c*l,n.x*=u;break;case mode.N_POLE:e.y=Math.asin(c),n.y=-n.y;break;case mode.S_POLE:e.y=-Math.asin(c);break}e.x=Math.atan2(n.x,n.y)}return n.x=e.x+this.long0,n.y=e.y,n}var names$4=["Tilted_Perspective","tpers"];const tpers={init:init$3,forward:forward$2,inverse:inverse$2,names:names$4};function init$2(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var n=1-this.es,e=1/n;this.radius_p=Math.sqrt(n),this.radius_p2=n,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function forward$1(n){var e=n.x,i=n.y,s,o,l,c;if(e=e-this.long0,this.shape==="ellipse"){i=Math.atan(this.radius_p2*Math.tan(i));var u=this.radius_p/hypot(this.radius_p*Math.cos(i),Math.sin(i));if(o=u*Math.cos(e)*Math.cos(i),l=u*Math.sin(e)*Math.cos(i),c=u*Math.sin(i),(this.radius_g-o)*o-l*l-c*c*this.radius_p_inv2<0)return n.x=Number.NaN,n.y=Number.NaN,n;s=this.radius_g-o,this.flip_axis?(n.x=this.radius_g_1*Math.atan(l/hypot(c,s)),n.y=this.radius_g_1*Math.atan(c/s)):(n.x=this.radius_g_1*Math.atan(l/s),n.y=this.radius_g_1*Math.atan(c/hypot(l,s)))}else this.shape==="sphere"&&(s=Math.cos(i),o=Math.cos(e)*s,l=Math.sin(e)*s,c=Math.sin(i),s=this.radius_g-o,this.flip_axis?(n.x=this.radius_g_1*Math.atan(l/hypot(c,s)),n.y=this.radius_g_1*Math.atan(c/s)):(n.x=this.radius_g_1*Math.atan(l/s),n.y=this.radius_g_1*Math.atan(c/hypot(l,s))));return n.x=n.x*this.a,n.y=n.y*this.a,n}function inverse$1(n){var e=-1,i=0,s=0,o,l,c,u;if(n.x=n.x/this.a,n.y=n.y/this.a,this.shape==="ellipse"){this.flip_axis?(s=Math.tan(n.y/this.radius_g_1),i=Math.tan(n.x/this.radius_g_1)*hypot(1,s)):(i=Math.tan(n.x/this.radius_g_1),s=Math.tan(n.y/this.radius_g_1)*hypot(1,i));var f=s/this.radius_p;if(o=i*i+f*f+e*e,l=2*this.radius_g*e,c=l*l-4*o*this.C,c<0)return n.x=Number.NaN,n.y=Number.NaN,n;u=(-l-Math.sqrt(c))/(2*o),e=this.radius_g+u*e,i*=u,s*=u,n.x=Math.atan2(i,e),n.y=Math.atan(s*Math.cos(n.x)/e),n.y=Math.atan(this.radius_p_inv2*Math.tan(n.y))}else if(this.shape==="sphere"){if(this.flip_axis?(s=Math.tan(n.y/this.radius_g_1),i=Math.tan(n.x/this.radius_g_1)*Math.sqrt(1+s*s)):(i=Math.tan(n.x/this.radius_g_1),s=Math.tan(n.y/this.radius_g_1)*Math.sqrt(1+i*i)),o=i*i+s*s+e*e,l=2*this.radius_g*e,c=l*l-4*o*this.C,c<0)return n.x=Number.NaN,n.y=Number.NaN,n;u=(-l-Math.sqrt(c))/(2*o),e=this.radius_g+u*e,i*=u,s*=u,n.x=Math.atan2(i,e),n.y=Math.atan(s*Math.cos(n.x)/e)}return n.x=n.x+this.long0,n}var names$3=["Geostationary Satellite View","Geostationary_Satellite","geos"];const geos={init:init$2,forward:forward$1,inverse:inverse$1,names:names$3};var A1=1.340264,A2=-.081106,A3=893e-6,A4=.003796,M$2=Math.sqrt(3)/2;function init$1(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function forward(n){var e=adjust_lon(n.x-this.long0),i=n.y,s=Math.asin(M$2*Math.sin(i)),o=s*s,l=o*o*o;return n.x=e*Math.cos(s)/(M$2*(A1+3*A2*o+l*(7*A3+9*A4*o))),n.y=s*(A1+A2*o+l*(A3+A4*o)),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function inverse(n){n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a;var e=1e-9,i=12,s=n.y,o,l,c,u,f,g;for(g=0;g<i&&(o=s*s,l=o*o*o,c=s*(A1+A2*o+l*(A3+A4*o))-n.y,u=A1+3*A2*o+l*(7*A3+9*A4*o),s-=f=c/u,!(Math.abs(f)<e));++g);return o=s*s,l=o*o*o,n.x=M$2*n.x*(A1+3*A2*o+l*(7*A3+9*A4*o))/Math.cos(s),n.y=Math.asin(Math.sin(s)/M$2),n.x=adjust_lon(n.x+this.long0),n}var names$2=["eqearth","Equal Earth","Equal_Earth"];const eqearth={init:init$1,forward,inverse,names:names$2};var EPS10=1e-10;function init(){var n;if(this.phi1=this.lat1,Math.abs(this.phi1)<EPS10)throw new Error;this.es?(this.en=pj_enfn(this.es),this.m1=pj_mlfn(this.phi1,this.am1=Math.sin(this.phi1),n=Math.cos(this.phi1),this.en),this.am1=n/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=e_inv,this.forward=e_fwd):(Math.abs(this.phi1)+EPS10>=HALF_PI?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=s_inv,this.forward=s_fwd)}function e_fwd(n){var e=adjust_lon(n.x-(this.long0||0)),i=n.y,s,o,l;return s=this.am1+this.m1-pj_mlfn(i,o=Math.sin(i),l=Math.cos(i),this.en),o=l*e/(s*Math.sqrt(1-this.es*o*o)),n.x=s*Math.sin(o),n.y=this.am1-s*Math.cos(o),n.x=this.a*n.x+(this.x0||0),n.y=this.a*n.y+(this.y0||0),n}function e_inv(n){n.x=(n.x-(this.x0||0))/this.a,n.y=(n.y-(this.y0||0))/this.a;var e,i,s,o;if(i=hypot(n.x,n.y=this.am1-n.y),o=pj_inv_mlfn(this.am1+this.m1-i,this.es,this.en),(e=Math.abs(o))<HALF_PI)e=Math.sin(o),s=i*Math.atan2(n.x,n.y)*Math.sqrt(1-this.es*e*e)/Math.cos(o);else if(Math.abs(e-HALF_PI)<=EPS10)s=0;else throw new Error;return n.x=adjust_lon(s+(this.long0||0)),n.y=adjust_lat(o),n}function s_fwd(n){var e=adjust_lon(n.x-(this.long0||0)),i=n.y,s,o;return o=this.cphi1+this.phi1-i,Math.abs(o)>EPS10?(n.x=o*Math.sin(s=e*Math.cos(i)/o),n.y=this.cphi1-o*Math.cos(s)):n.x=n.y=0,n.x=this.a*n.x+(this.x0||0),n.y=this.a*n.y+(this.y0||0),n}function s_inv(n){n.x=(n.x-(this.x0||0))/this.a,n.y=(n.y-(this.y0||0))/this.a;var e,i,s=hypot(n.x,n.y=this.cphi1-n.y);if(i=this.cphi1+this.phi1-s,Math.abs(i)>HALF_PI)throw new Error;return Math.abs(Math.abs(i)-HALF_PI)<=EPS10?e=0:e=s*Math.atan2(n.x,n.y)/Math.cos(i),n.x=adjust_lon(e+(this.long0||0)),n.y=adjust_lat(i),n}var names$1=["bonne","Bonne (Werner lat_1=90)"];const bonne={init,names:names$1};function includedProjections(n){n.Proj.projections.add(tmerc),n.Proj.projections.add(etmerc),n.Proj.projections.add(utm),n.Proj.projections.add(sterea),n.Proj.projections.add(stere),n.Proj.projections.add(somerc),n.Proj.projections.add(omerc),n.Proj.projections.add(lcc),n.Proj.projections.add(krovak),n.Proj.projections.add(cass),n.Proj.projections.add(laea),n.Proj.projections.add(aea),n.Proj.projections.add(gnom),n.Proj.projections.add(cea),n.Proj.projections.add(eqc),n.Proj.projections.add(poly),n.Proj.projections.add(nzmg),n.Proj.projections.add(mill),n.Proj.projections.add(sinu),n.Proj.projections.add(moll),n.Proj.projections.add(eqdc),n.Proj.projections.add(vandg),n.Proj.projections.add(aeqd),n.Proj.projections.add(ortho),n.Proj.projections.add(qsc),n.Proj.projections.add(robin),n.Proj.projections.add(geocent),n.Proj.projections.add(tpers),n.Proj.projections.add(geos),n.Proj.projections.add(eqearth),n.Proj.projections.add(bonne)}proj4.defaultDatum="WGS84";proj4.Proj=Projection;proj4.WGS84=new proj4.Proj("WGS84");proj4.Point=Point;proj4.toPoint=common;proj4.defs=defs;proj4.nadgrid=nadgrid;proj4.transform=transform;proj4.mgrs=mgrs;proj4.version="__VERSION__";includedProjections(proj4);var logger$y=LoggerByDefault.getLogger("CRS");function register(n){const e=Object.keys(n.defs);logger$y.trace("proj. codes :",e);const i=e.length;let s,o;for(s=0;s<i;++s){const l=e[s];if(!get$3(l)){const c=n.defs(l);addProjection(new Projection$1({code:l,axisOrientation:c.axis,metersPerUnit:c.to_meter,units:c.units}))}}for(s=0;s<i;++s){const l=e[s],c=get$3(l);for(o=0;o<i;++o){const u=e[o],f=get$3(u);if(!get$4(l,u))if(n.defs[l]===n.defs[u])addEquivalentProjections([c,f]);else{const g=n(l,u);addCoordinateTransforms(c,f,g.forward,g.inverse)}}}}var Register={isLoaded:!1,get:function(n){if(!(n===""||n===null||typeof n>"u")){var e=n.split(":");if(e.length===2){var i=e[0],s=e[1];if(this.hasOwnProperty(i)&&this[i].hasOwnProperty(s))return this[i][s]}}},exist:function(n){if(n===""||n===null||typeof n>"u")return!1;var e=n.split(":");if(e.length!==2)return!1;var i=e[0],s=e[1];return!(!this.hasOwnProperty(i)||!this[i].hasOwnProperty(s))},load:function(n){if(!this.isLoaded){for(var e=["IGNF","EPSG","CRS"],i=0;i<e.length;i++){var s=e[i],o=this[s];for(var l in o)if(o.hasOwnProperty(l)){var c=s+":"+l;n.defs(c,this.get(c))}}this.isLoaded=!0}},loadByDefault:function(n){var e={EPSG:{2154:Register.EPSG[2154],27571:Register.EPSG[27571],27572:Register.EPSG[27572],27573:Register.EPSG[27573],27574:Register.EPSG[27574]},CRS:{84:Register.CRS[84]},IGNF:{LAMB93:Register.IGNF.LAMB93,LAMBE:Register.IGNF.LAMBE,LAMB1:Register.IGNF.LAMB1,LAMB2:Register.IGNF.LAMB2,LAMB3:Register.IGNF.LAMB3,LAMB4:Register.IGNF.LAMB4,RGF93G:Register.IGNF.RGF93G,WGS84G:Register.IGNF.WGS84G}};for(var i in e)if(e.hasOwnProperty(i)){var s=e[i];for(var o in s)if(s.hasOwnProperty(o)){var l=i+":"+o;n.defs(l,s[o])}}},loadByName:function(n,e){if(!this.exist(e))return!1;try{n.defs(e,this.get(e))}catch{return!1}return!0},EPSG:{4978:"+proj=geocent +datum=WGS84 +units=m +no_defs ",3857:"+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs",3785:"+title=WGS 84 / Pseudo-Mercator (deprecated) +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs",4149:"+title=CH1903 +proj=longlat +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +no_defs ",4150:"+title=CH1903plus +proj=longlat +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +no_defs ",4151:"+title=CHTRF95 +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ",4171:"+title=RGF93 +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ",4230:"+title=ED50 +proj=longlat +ellps=intl +no_defs ",4235:"+title=Guyane Francaise +proj=longlat +ellps=intl +no_defs ",4258:"+title=ETRS89 +proj=longlat +ellps=GRS80 +no_defs ",4275:"+title=NTF +proj=longlat +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +no_defs ",4322:"+title=WGS 72 +proj=longlat +ellps=WGS72 +no_defs ",4326:"+title=WGS 84 +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ",4467:"+proj=utm +zone=21 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",4470:"+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ",4471:"+proj=utm +zone=38 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",4474:"+proj=utm +zone=38 +south +ellps=intl +towgs84=-382,-59,-262,0,0,0,0 +units=m +no_defs ",4558:"+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ",4559:"+proj=utm +zone=20 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",4621:"+title=Fort Marigot +proj=longlat +ellps=intl +towgs84=137,248,-430,0,0,0,0 +no_defs ",4622:"+title=Guadeloupe 1948 +proj=longlat +ellps=intl +no_defs ",4623:"+title=CSG67 +proj=longlat +ellps=intl +towgs84=-186,230,110,0,0,0,0 +no_defs ",4624:"+title=RGFG95 +proj=longlat +ellps=GRS80 +towgs84=2,2,-2,0,0,0,0 +no_defs ",4625:"+title=Martinique 1938 +proj=longlat +ellps=intl +no_defs ",4626:"+title=Reunion 1947 +proj=longlat +ellps=intl +no_defs ",4627:"+title=RGR92 +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ",4628:"+title=Tahiti 52 +proj=longlat +ellps=intl +towgs84=162,117,154,0,0,0,0 +no_defs ",4629:"+title=Tahaa 54 +proj=longlat +ellps=intl +no_defs ",4630:"+title=IGN72 Nuku Hiva +proj=longlat +ellps=intl +no_defs ",4632:"+title=Combani 1950 +proj=longlat +ellps=intl +towgs84=-382,-59,-262,0,0,0,0 +no_defs ",4633:"+title=IGN56 Lifou +proj=longlat +ellps=intl +no_defs ",4634:"+title=IGN72 Grand Terre +proj=longlat +ellps=intl +no_defs ",4637:"+title=Perroud 1950 +proj=longlat +ellps=intl +towgs84=325,154,172,0,0,0,0 +no_defs ",4638:"+title=Saint Pierre et Miquelon 1950 +proj=longlat +ellps=clrk66 +towgs84=30,430,368,0,0,0,0 +no_defs ",4640:"+title=RRAF 1991 +proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs ",4641:"+title=IGN53 Mare +proj=longlat +ellps=intl +no_defs ",4645:"+title=RGNC 1991 +proj=longlat +ellps=intl +towgs84=0,0,0,0,0,0,0 +no_defs ",4687:"+proj=longlat +ellps=GRS80 +no_defs ",4662:"+title=IGN72 Grande Terre +proj=longlat +ellps=intl +no_defs ",4689:"+title=IGN63 Hiva Oa +proj=longlat +ellps=intl +no_defs ",4690:"+title=Tahiti 79 +proj=longlat +ellps=intl +no_defs ",4691:"+title=Moorea 87 +proj=longlat +ellps=intl +towgs84=215.525,149.593,176.229,-3.2624,-1.692,-1.1571,10.4773 +no_defs ",4692:"+title=Maupiti 83 +proj=longlat +ellps=intl +towgs84=217.037,86.959,23.956,0,0,0,0 +no_defs ",4698:"+title=IGN 1962 Kerguelen +proj=longlat +ellps=intl +towgs84=145,-187,103,0,0,0,0 +no_defs ",4749:"+title=RGNC91-93 +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ",4750:"+title=ST87 Ouvea +proj=longlat +ellps=WGS84 +towgs84=-56.263,16.136,-22.856,0,0,0,0 +no_defs ",4807:"+title=NTF (Paris) +proj=longlat +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +no_defs ",2056:"+title=CH1903+ / LV95 +proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +x_0=2600000 +y_0=1200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs ",2154:"+title=RGF93 / Lambert-93 +proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",2213:"+title=ETRS89 / TM 30 NE +proj=tmerc +lat_0=0 +lon_0=30 +k=0.9996 +x_0=500000 +y_0=0 +ellps=GRS80 +units=m +no_defs ",2969:"+title=Fort Marigot / UTM zone 20N +proj=utm +zone=20 +ellps=intl +towgs84=137,248,-430,0,0,0,0 +units=m +no_defs ",2970:"+title=Guadeloupe 1948 / UTM zone 20N +proj=utm +zone=20 +ellps=intl +units=m +no_defs ",2971:"+title=CSG67 / UTM zone 22N +proj=utm +zone=22 +ellps=intl +towgs84=-186,230,110,0,0,0,0 +units=m +no_defs ",2972:"+title=RGFG95 / UTM zone 22N +proj=utm +zone=22 +ellps=GRS80 +towgs84=2,2,-2,0,0,0,0 +units=m +no_defs ",2973:"+title=Martinique 1938 / UTM zone 20N +proj=utm +zone=20 +ellps=intl +units=m +no_defs ",2975:"+title=RGR92 / UTM zone 40S +proj=utm +zone=40 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",2976:"+title=Tahiti 52 / UTM zone 6S +proj=utm +zone=6 +south +ellps=intl +towgs84=162,117,154,0,0,0,0 +units=m +no_defs ",2977:"+title=Tahaa 54 / UTM zone 5S +proj=utm +zone=5 +south +ellps=intl +units=m +no_defs ",2978:"+title=IGN72 Nuku Hiva / UTM zone 7S +proj=utm +zone=7 +south +ellps=intl +units=m +no_defs ",2980:"+title=Combani 1950 / UTM zone 38S +proj=utm +zone=38 +south +ellps=intl +towgs84=-382,-59,-262,0,0,0,0 +units=m +no_defs ",2981:"+title=IGN56 Lifou / UTM zone 58S +proj=utm +zone=58 +south +ellps=intl +units=m +no_defs ",2982:"+title=IGN72 Grand Terre / UTM zone 58S (deprecated) +proj=utm +zone=58 +south +ellps=intl +units=m +no_defs ",2984:"+title=RGNC 1991 / Lambert New Caledonia (deprecated) +proj=lcc +lat_1=-20.66666666666667 +lat_2=-22.33333333333333 +lat_0=-21.5 +lon_0=166 +x_0=400000 +y_0=300000 +ellps=intl +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",2986:"+title=Terre Adelie 1950 +proj=stere +towgs84=324.9120,153.2820,172.0260 +a=6378388.0000 +rf=297.0000000000000 +lat_0=-90.000000000 +lon_0=140.000000000 +lat_ts=-67.000000000 +k=0.96027295 +x_0=300000.000 +y_0=-2299363.482 +units=m +no_defs",2987:"+title=Saint Pierre et Miquelon 1950 / UTM zone 21N +proj=utm +zone=21 +ellps=clrk66 +towgs84=30,430,368,0,0,0,0 +units=m +no_defs ",2989:"+title=RRAF 1991 / UTM zone 20N +proj=utm +zone=20 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",2990:"+title=Reunion 1947 / TM Reunion (deprecated) +proj=tmerc +lat_0=-21.11666666666667 +lon_0=55.53333333333333 +k=1 +x_0=50000 +y_0=160000 +ellps=intl +units=m +no_defs ",2995:"+title=IGN53 Mare / UTM zone 58S +proj=utm +zone=58 +south +ellps=intl +units=m +no_defs ",3038:"+proj=utm +zone=26 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3039:"+proj=utm +zone=27 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3040:"+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3041:"+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3045:"+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3046:"+proj=utm +zone=34 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3047:"+proj=utm +zone=35 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3048:"+proj=utm +zone=36 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3049:"+proj=utm +zone=37 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3050:"+proj=utm +zone=38 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3051:"+proj=utm +zone=39 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3034:"+title=ETRS89 / ETRS-LCC +proj=lcc +lat_1=35 +lat_2=65 +lat_0=52 +lon_0=10 +x_0=4000000 +y_0=2800000 +ellps=GRS80 +units=m +no_defs ",3035:"+title=ETRS89 / ETRS-LAEA +proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs ",3042:"+title=ETRS89 / ETRS-TM30 +proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs ",3043:"+title=ETRS89 / ETRS-TM31 +proj=utm +zone=31 +ellps=GRS80 +units=m +no_defs ",3044:"+title=ETRS89 / ETRS-TM32 +proj=utm +zone=32 +ellps=GRS80 +units=m +no_defs ",25828:"+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",25829:"+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",25833:"+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",25834:"+proj=utm +zone=34 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",25835:"+proj=utm +zone=35 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",25836:"+proj=utm +zone=36 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",25837:"+proj=utm +zone=37 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",25838:"+proj=utm +zone=38 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3060:"+title=IGN72 Grande Terre / UTM zone 58S +proj=utm +zone=58 +south +ellps=intl +units=m +no_defs ",3163:"+title=RGNC91-93 / Lambert New Caledonia +proj=lcc +lat_1=-20.66666666666667 +lat_2=-22.33333333333333 +lat_0=-21.5 +lon_0=166 +x_0=400000 +y_0=300000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3164:"+title=ST87 Ouvea / UTM zone 58S +proj=utm +zone=58 +south +ellps=WGS84 +towgs84=-56.263,16.136,-22.856,0,0,0,0 +units=m +no_defs ",3165:"+title=NEA74 Noumea / Noumea Lambert +proj=lcc +lat_1=-22.24469175 +lat_2=-22.29469175 +lat_0=-22.26969175 +lon_0=166.44242575 +x_0=0.66 +y_0=1.02 +ellps=intl +units=m +no_defs ",3166:"+title=NEA74 Noumea / Noumea Lambert 2 +proj=lcc +lat_1=-22.24472222222222 +lat_2=-22.29472222222222 +lat_0=-22.26972222222222 +lon_0=166.4425 +x_0=8.313000000000001 +y_0=-2.354 +ellps=intl +units=m +no_defs ",3169:"+title=RGNC91-93 / UTM zone 57S +proj=utm +zone=57 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3170:"+title=RGNC91-93 / UTM zone 58S +proj=utm +zone=58 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3171:"+title=RGNC91-93 / UTM zone 59S +proj=utm +zone=59 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ",3172:"+title=IGN53 Mare / UTM zone 59S +proj=utm +zone=59 +south +ellps=intl +units=m +no_defs ",3296:"+title=RGPF / UTM zone 5S +proj=utm +zone=5 +south +ellps=GRS80 +units=m +no_defs ",3297:"+title=RGPF / UTM zone 6S +proj=utm +zone=6 +south +ellps=GRS80 +units=m +no_defs ",3298:"+title=RGPF / UTM zone 7S +proj=utm +zone=7 +south +ellps=GRS80 +units=m +no_defs ",3299:"+title=RGPF / UTM zone 8S +proj=utm +zone=8 +south +ellps=GRS80 +units=m +no_defs ",3302:"+title=IGN63 Hiva Oa / UTM zone 7S +proj=utm +zone=7 +south +ellps=intl +units=m +no_defs ",3303:"+title=Fatu Iva 72 / UTM zone 7S +proj=utm +zone=7 +south +ellps=intl +towgs84=347.103,1078.12,2623.92,-33.8875,70.6773,-9.3943,186.074 +units=m +no_defs ",3304:"+title=Tahiti 79 / UTM zone 6S +proj=utm +zone=6 +south +ellps=intl +units=m +no_defs ",3305:"+title=Moorea 87 / UTM zone 6S +proj=utm +zone=6 +south +ellps=intl +towgs84=215.525,149.593,176.229,-3.2624,-1.692,-1.1571,10.4773 +units=m +no_defs ",3306:"+title=Maupiti 83 / UTM zone 5S +proj=utm +zone=5 +south +ellps=intl +towgs84=217.037,86.959,23.956,0,0,0,0 +units=m +no_defs ",3312:"+title=CSG67 / UTM zone 21N +proj=utm +zone=21 +ellps=intl +towgs84=-186,230,110,0,0,0,0 +units=m +no_defs ",3313:"+title=RGFG95 / UTM zone 21N +proj=utm +zone=21 +ellps=GRS80 +towgs84=2,2,-2,0,0,0,0 +units=m +no_defs ",3336:"+title=IGN 1962 Kerguelen / UTM zone 42S +proj=utm +zone=42 +south +ellps=intl +towgs84=145,-187,103,0,0,0,0 +units=m +no_defs ",3395:"+title=WGS 84 / World Mercator +proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",3727:"+title=Reunion 1947 / TM Reunion +proj=tmerc +lat_0=-21.11666666666667 +lon_0=55.53333333333333 +k=1 +x_0=160000 +y_0=50000 +ellps=intl +units=m +no_defs ",21781:"+title=CH1903 / LV03 +proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +x_0=600000 +y_0=200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs ",25830:"+title=ETRS89 / UTM zone 30N +proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs ",25831:"+title=ETRS89 / UTM zone 31N +proj=utm +zone=31 +ellps=GRS80 +units=m +no_defs ",25832:"+title=ETRS89 / UTM zone 32N +proj=utm +zone=32 +ellps=GRS80 +units=m +no_defs ",27561:"+title=NTF (Paris) / Lambert Nord France +proj=lcc +lat_1=49.50000000000001 +lat_0=49.50000000000001 +lon_0=0 +k_0=0.999877341 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27562:"+title=NTF (Paris) / Lambert Centre France +proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27563:"+title=NTF (Paris) / Lambert Sud France +proj=lcc +lat_1=44.10000000000001 +lat_0=44.10000000000001 +lon_0=0 +k_0=0.9998774990000001 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27564:"+title=NTF (Paris) / Lambert Corse +proj=lcc +lat_1=42.16500000000001 +lat_0=42.16500000000001 +lon_0=0 +k_0=0.9999447100000001 +x_0=234.358 +y_0=185861.369 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27571:"+title=NTF (Paris) / Lambert zone I +proj=lcc +lat_1=49.50000000000001 +lat_0=49.50000000000001 +lon_0=0 +k_0=0.999877341 +x_0=600000 +y_0=1200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27572:"+title=NTF (Paris) / Lambert zone II +proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=2200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27573:"+title=NTF (Paris) / Lambert zone III +proj=lcc +lat_1=44.10000000000001 +lat_0=44.10000000000001 +lon_0=0 +k_0=0.9998774990000001 +x_0=600000 +y_0=3200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27574:"+title=NTF (Paris) / Lambert zone IV +proj=lcc +lat_1=42.16500000000001 +lat_0=42.16500000000001 +lon_0=0 +k_0=0.9999447100000001 +x_0=234.358 +y_0=4185861.369 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27581:"+title=NTF (Paris) / France I (deprecated) +proj=lcc +lat_1=49.50000000000001 +lat_0=49.50000000000001 +lon_0=0 +k_0=0.999877341 +x_0=600000 +y_0=1200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27582:"+title=NTF (Paris) / France II (deprecated) +proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=2200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27583:"+title=NTF (Paris) / France III (deprecated) +proj=lcc +lat_1=44.10000000000001 +lat_0=44.10000000000001 +lon_0=0 +k_0=0.9998774990000001 +x_0=600000 +y_0=3200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27584:"+title=NTF (Paris) / France IV (deprecated) +proj=lcc +lat_1=42.16500000000001 +lat_0=42.16500000000001 +lon_0=0 +k_0=0.9999447100000001 +x_0=234.358 +y_0=4185861.369 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27591:"+title=NTF (Paris) / Nord France (deprecated) +proj=lcc +lat_1=49.50000000000001 +lat_0=49.50000000000001 +lon_0=0 +k_0=0.999877341 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27592:"+title=NTF (Paris) / Centre France (deprecated) +proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27593:"+title=NTF (Paris) / Sud France (deprecated) +proj=lcc +lat_1=44.10000000000001 +lat_0=44.10000000000001 +lon_0=0 +k_0=0.9998774990000001 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",27594:"+title=NTF (Paris) / Corse (deprecated) +proj=lcc +lat_1=42.16500000000001 +lat_0=42.16500000000001 +lon_0=0 +k_0=0.9999447100000001 +x_0=234.358 +y_0=185861.369 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ",32601:"+proj=utm +zone=1 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32602:"+proj=utm +zone=2 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32603:"+proj=utm +zone=3 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32604:"+proj=utm +zone=4 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32605:"+proj=utm +zone=5 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32606:"+proj=utm +zone=6 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32607:"+proj=utm +zone=7 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32608:"+proj=utm +zone=8 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32609:"+proj=utm +zone=9 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32610:"+proj=utm +zone=10 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32611:"+proj=utm +zone=11 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32612:"+proj=utm +zone=12 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32613:"+proj=utm +zone=13 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32614:"+proj=utm +zone=14 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32615:"+proj=utm +zone=15 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32616:"+proj=utm +zone=16 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32617:"+proj=utm +zone=17 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32618:"+proj=utm +zone=18 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32619:"+proj=utm +zone=19 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32620:"+proj=utm +zone=20 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32621:"+proj=utm +zone=21 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32622:"+proj=utm +zone=22 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32623:"+proj=utm +zone=23 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32624:"+proj=utm +zone=24 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32625:"+proj=utm +zone=25 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32626:"+proj=utm +zone=26 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32627:"+proj=utm +zone=27 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32628:"+proj=utm +zone=28 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32629:"+proj=utm +zone=29 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32630:"+proj=utm +zone=30 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32631:"+proj=utm +zone=31 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32632:"+proj=utm +zone=32 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32633:"+proj=utm +zone=33 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32634:"+proj=utm +zone=34 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32635:"+proj=utm +zone=35 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32636:"+proj=utm +zone=36 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32637:"+proj=utm +zone=37 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32638:"+proj=utm +zone=38 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32639:"+proj=utm +zone=39 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32640:"+proj=utm +zone=40 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32641:"+proj=utm +zone=41 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32642:"+proj=utm +zone=42 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32643:"+proj=utm +zone=43 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32644:"+proj=utm +zone=44 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32645:"+proj=utm +zone=45 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32646:"+proj=utm +zone=46 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32647:"+proj=utm +zone=47 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32648:"+proj=utm +zone=48 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32649:"+proj=utm +zone=49 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32650:"+proj=utm +zone=50 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32651:"+proj=utm +zone=51 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32652:"+proj=utm +zone=52 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32653:"+proj=utm +zone=53 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32654:"+proj=utm +zone=54 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32655:"+proj=utm +zone=55 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32656:"+proj=utm +zone=56 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32657:"+proj=utm +zone=57 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32658:"+proj=utm +zone=58 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32659:"+proj=utm +zone=59 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32660:"+proj=utm +zone=60 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32661:"+proj=stere +lat_0=90 +lat_ts=90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32662:"+title=WGS 84 / Plate Carree +proj=eqc +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32701:"+proj=utm +zone=1 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32702:"+proj=utm +zone=2 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32703:"+proj=utm +zone=3 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32704:"+proj=utm +zone=4 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32705:"+proj=utm +zone=5 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32706:"+proj=utm +zone=6 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32707:"+proj=utm +zone=7 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32708:"+proj=utm +zone=8 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32709:"+proj=utm +zone=9 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32710:"+proj=utm +zone=10 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32711:"+proj=utm +zone=11 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32712:"+proj=utm +zone=12 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32713:"+proj=utm +zone=13 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32714:"+proj=utm +zone=14 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32715:"+proj=utm +zone=15 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32716:"+proj=utm +zone=16 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32717:"+proj=utm +zone=17 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32718:"+proj=utm +zone=18 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32719:"+proj=utm +zone=19 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32720:"+proj=utm +zone=20 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32721:"+proj=utm +zone=21 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32722:"+proj=utm +zone=22 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32723:"+proj=utm +zone=23 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32724:"+proj=utm +zone=24 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32725:"+proj=utm +zone=25 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32726:"+proj=utm +zone=26 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32727:"+proj=utm +zone=27 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32728:"+proj=utm +zone=28 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32729:"+proj=utm +zone=29 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32730:"+proj=utm +zone=30 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32731:"+proj=utm +zone=31 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32732:"+proj=utm +zone=32 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32733:"+proj=utm +zone=33 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32734:"+proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32735:"+proj=utm +zone=35 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32736:"+proj=utm +zone=36 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32737:"+proj=utm +zone=37 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32738:"+proj=utm +zone=38 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32739:"+proj=utm +zone=39 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32740:"+proj=utm +zone=40 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32741:"+proj=utm +zone=41 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32742:"+proj=utm +zone=42 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32743:"+proj=utm +zone=43 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32744:"+proj=utm +zone=44 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32745:"+proj=utm +zone=45 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32746:"+proj=utm +zone=46 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32747:"+proj=utm +zone=47 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32748:"+proj=utm +zone=48 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32749:"+proj=utm +zone=49 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32750:"+proj=utm +zone=50 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32751:"+proj=utm +zone=51 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32752:"+proj=utm +zone=52 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32753:"+proj=utm +zone=53 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32754:"+proj=utm +zone=54 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32755:"+proj=utm +zone=55 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32756:"+proj=utm +zone=56 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32757:"+proj=utm +zone=57 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32758:"+proj=utm +zone=58 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32759:"+proj=utm +zone=59 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32760:"+proj=utm +zone=60 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",32761:"+proj=stere +lat_0=-90 +lat_ts=-90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ",310024802:"+title=Geoportail - France metropolitaine +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=46.500000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310915814:"+title=Geoportail - Antilles francaises +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=15.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310486805:"+title=Geoportail - Guyane +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=4.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310700806:"+title=Geoportail - Reunion et dependances +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-21.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310702807:"+title=Geoportail - Mayotte +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-12.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310706808:"+title=Geoportail - Saint-Pierre et Miquelon +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=47.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310547809:"+title=Geoportail - Nouvelle-Caledonie +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-22.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310642810:"+title=Geoportail - Wallis et Futuna +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000,0.0000,0.0000,0.0000,0.000000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-14.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310032811:"+title=Geoportail - Polynesie francaise +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-15.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310642812:"+title=Geoportail - Kerguelen +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-49.500000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310642801:"+title=Geoportail - Crozet +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-46.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310642813:"+title=Geoportail - Amsterdam et Saint-Paul +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-38.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",310642901:"+title=Geoportail - Monde +proj=mill +towgs84=0.0000,0.0000,0.0000,0.0000,0.0000,0.0000,0.000000 +a=6378137.0000 +rf=298.2572221010000 +lon_0=0.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",5489:"+title=RGAF09 geographiques (dms) +proj=longlat +nadgrids=@null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137 +rf=298.257222101 +units=m +no_defs",5490:"+title=RGAF09 UTM Nord Fuseau 20 +proj=tmerc +nadgrids=@null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137 +rf=298.257222101 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs"},CRS:{84:"+title=WGS 84 longitude-latitude +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs "},IGNF:{AMST63:"+title=Amsterdam 1963 +proj=geocent +towgs84=109.753,-528.133,-362.244,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",CROZ63:"+title=Crozet 1963 +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",CSG67:"+title=Guyane CSG67 +proj=geocent +towgs84=-193.0660,236.9930,105.4470,0.4814,-0.8074,0.1276,1.564900 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",ED50:"+title=ED50 +proj=geocent +towgs84=-84.0000,-97.0000,-117.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",ETRS89:"+title=Systeme de reference terrestre Europeen (1989) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",GUAD48:"+title=Guadeloupe Ste Anne +proj=geocent +towgs84=-472.2900,-5.6300,-304.1200,0.4362,-0.8374,0.2563,1.898400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",GUADFM49:"+title=Guadeloupe Fort Marigot +proj=geocent +towgs84=136.5960,248.1480,-429.7890 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",IGN63:"+title=IGN 1963 (Hiva Oa, Tahuata, Mohotani) +proj=geocent +towgs84=410.7210,55.0490,80.7460,-2.5779,-2.3514,-0.6664,17.331100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",IGN72:"+title=IGN 1972 Grande-Terre / Ile des Pins +proj=geocent +towgs84=-11.6400,-348.6000,291.6800 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",KERG62CAR:"+title=Kerguelen - K0 +proj=geocent +towgs84=144.8990,-186.7700,100.9230 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",MART38:"+title=Martinique Fort-Desaix +proj=geocent +towgs84=126.9260,547.9390,130.4090,-2.7867,5.1612,-0.8584,13.822650 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",MAYO50:"+title=Mayotte Combani +proj=geocent +towgs84=-599.9280,-275.5520,-195.6650,-0.0835,-0.4715,0.0602,49.281400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",MOOREA87:"+title=Moorea 1987 +proj=geocent +towgs84=215.9820,149.5930,176.2290,3.2624,1.6920,1.1571,10.477300 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",NTF:"+title=Nouvelle Triangulation Francaise +proj=geocent +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +units=m +no_defs",NUKU72:"+title=IGN 1972 Nuku Hiva +proj=geocent +towgs84=165.7320,216.7200,180.5050,-0.6434,-0.4512,-0.0791,7.420400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",REUN47:"+title=Reunion 1947 +proj=geocent +towgs84=789.5240,-626.4860,-89.9040,0.6006,76.7946,-10.5788,-32.324100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",RGF93:"+title=Reseau geodesique francais 1993 +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGFG95:"+title=Reseau geodesique francais de Guyane 1995 +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGM04:"+title=RGM04 (Reseau Geodesique de Mayotte 2004) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGNC:"+title=Reseau Geodesique de Nouvelle-Caledonie +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGPF:"+title=RGPF (Reseau Geodesique de Polynesie Francaise) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGR92:"+title=Reseau geodesique Reunion 1992 +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGSPM06:"+title=Reseau Geodesique Saint-Pierre-et-Miquelon (2006) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGTAAF07:"+title=Reseau Geodesique des TAAF (2007) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RRAF91:"+title=RRAF 1991 (Reseau de Reference des Antilles Francaises) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",STPL69:"+title=Saint-Paul 1969 +proj=geocent +towgs84=225.571,-346.608,-46.567,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",STPM50:"+title=St Pierre et Miquelon 1950 +proj=geocent +towgs84=-95.5930,573.7630,173.4420,-0.9602,1.2510,-1.3918,42.626500 +a=6378206.4000 +rf=294.9786982000000 +units=m +no_defs",TAHAA:"+title=Raiatea - Tahaa 51-54 (Tahaa, Base Terme Est) +proj=geocent +towgs84=72.4380,345.9180,79.4860,-1.6045,-0.8823,-0.5565,1.374600 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",TAHI79:"+title=IGN79 (Tahiti) Iles de la Societe +proj=geocent +towgs84=221.5250,152.9480,176.7680,2.3847,1.3896,0.8770,11.474100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",TERA50:"+title=Pointe Geologie - Perroud 1950 +proj=geocent +towgs84=324.9120,153.2820,172.0260 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",WALL78:"+title=Wallis-Uvea 1978 (MOP78) +proj=geocent +towgs84=253.0000,-133.0000,-127.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",WGS72:"+title=World Geodetic System 1972 +proj=geocent +towgs84=0.0000,12.0000,6.0000 +a=6378135.0000 +rf=298.2600000000000 +units=m +no_defs",WGS84:"+title=World Geodetic System 1984 +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",AMST63GEO:"+title=Amsterdam 1963 +proj=longlat +towgs84=109.753,-528.133,-362.244,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",CROZ63GEO:"+title=Crozet 1963 +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",CSG67GEO:"+title=Guyane CSG67 +proj=longlat +towgs84=-193.0660,236.9930,105.4470,0.4814,-0.8074,0.1276,1.564900 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",ED50G:"+title=ED50 +proj=longlat +towgs84=-84.0000,-97.0000,-117.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",GUAD48GEO:"+title=Guadeloupe Ste Anne +proj=longlat +towgs84=-472.2900,-5.6300,-304.1200,0.4362,-0.8374,0.2563,1.898400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",GUADFM49GEO:"+title=Guadeloupe Fort Marigot +proj=longlat +towgs84=136.5960,248.1480,-429.7890 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",IGN63GEO:"+title=IGN 1963 (Hiva Oa, Tahuata, Mohotani) +proj=longlat +towgs84=410.7210,55.0490,80.7460,-2.5779,-2.3514,-0.6664,17.331100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",IGN72GEO:"+title=IGN 1972 Grande-Terre / Ile des Pins +proj=longlat +towgs84=-11.6400,-348.6000,291.6800 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",KERG62GEO:"+title=Kerguelen - K0 +proj=longlat +towgs84=144.8990,-186.7700,100.9230 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",MART38GEO:"+title=Martinique Fort-Desaix +proj=longlat +towgs84=126.9260,547.9390,130.4090,-2.7867,5.1612,-0.8584,13.822650 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",MAYO50GEO:"+title=Mayotte Combani +proj=longlat +towgs84=-599.9280,-275.5520,-195.6650,-0.0835,-0.4715,0.0602,49.281400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",MOOREA87GEO:"+title=Moorea 1987 +proj=longlat +towgs84=215.9820,149.5930,176.2290,3.2624,1.6920,1.1571,10.477300 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",NTFG:"+title=Nouvelle Triangulation Francaise Greenwich degres sexagesimaux +proj=longlat +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +units=m +no_defs",NTFP:"+title=Nouvelle Triangulation Francaise Paris grades +proj=longlat +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +units=m +no_defs",NUKU72GEO:"+title=IGN 1972 Nuku Hiva +proj=longlat +towgs84=165.7320,216.7200,180.5050,-0.6434,-0.4512,-0.0791,7.420400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",REUN47GEO:"+title=Reunion 1947 +proj=longlat +towgs84=789.5240,-626.4860,-89.9040,0.6006,76.7946,-10.5788,-32.324100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",RGF93G:"+title=Reseau geodesique francais 1993 +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGFG95GEO:"+title=Reseau geodesique francais de Guyane 1995 +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGM04GEO:"+title=RGM04 (Reseau Geodesique de Mayotte 2004) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGNCGEO:"+title=Reseau Geodesique de Nouvelle-Caledonie +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGPFGEO:"+title=RGPF (Reseau Geodesique de Polynesie Francaise) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGR92GEO:"+title=Reseau geodesique de la Reunion 1992 +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGSPM06GEO:"+title=Saint-Pierre-et-Miquelon (2006) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",RGTAAF07G:"+title=Reseau Geodesique des TAAF (2007) (dms) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",STPL69GEO:"+title=Saint-Paul 1969 +proj=longlat +towgs84=225.571,-346.608,-46.567,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",STPM50GEO:"+title=St Pierre et Miquelon 1950  +proj=longlat +towgs84=-95.5930,573.7630,173.4420,-0.9602,1.2510,-1.3918,42.626500 +a=6378206.4000 +rf=294.9786982000000 +units=m +no_defs",TAHAAGEO:"+title=Raiatea - Tahaa 51-54 (Tahaa, Base Terme Est) +proj=longlat +towgs84=72.4380,345.9180,79.4860,-1.6045,-0.8823,-0.5565,1.374600 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",TAHI79GEO:"+title=IGN79 (Tahiti) Iles de la Societe +proj=longlat +towgs84=221.5250,152.9480,176.7680,2.3847,1.3896,0.8770,11.474100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",TERA50G:"+title=Pointe Geologie - Perroud 1950 +proj=longlat +towgs84=324.9120,153.2820,172.0260 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",WALL78GEO:"+title=Wallis - Uvea 1978 (MOP78) +proj=longlat +towgs84=253.0000,-133.0000,-127.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs",WGS72G:"+title=WGS72 +proj=longlat +towgs84=0.0000,12.0000,6.0000 +a=6378135.0000 +rf=298.2600000000000 +units=m +no_defs",WGS84G:"+title=World Geodetic System 1984 +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",WGS84RRAFGEO:"+title=Reseau de reference des Antilles francaises (1988-1991) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",XGEO:"+title=Systeme CIO-BIH +proj=longlat +towgs84=0.0000,0.0000,0.5000,0.0000,0.0000,0.0140,-0.100000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",AMST63UTM43S:"+title=Amsterdam 1963 UTM fuseau 43 Sud +proj=tmerc +towgs84=109.753,-528.133,-362.244,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=75.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",CROZ63UTM39S:"+title=Crozet 1963 +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=51.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",CSG67UTM21:"+title=Guyane CSG67 UTM fuseau 21 +proj=tmerc +towgs84=-193.0660,236.9930,105.4470,0.4814,-0.8074,0.1276,1.564900 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-57.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",CSG67UTM22:"+title=Guyane CSG67 UTM fuseau 22 +proj=tmerc +towgs84=-193.0660,236.9930,105.4470,0.4814,-0.8074,0.1276,1.564900 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-51.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",GEOPORTALANF:"+title=Geoportail - Antilles francaises +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=15.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALASP:"+title=Geoportail - Amsterdam et Saint-Paul +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-38.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALCRZ:"+title=Geoportail - Crozet +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-46.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALFXX:"+title=Geoportail - France metropolitaine +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=46.500000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALGUF:"+title=Geoportail - Guyane +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=4.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALKER:"+title=Geoportail - Kerguelen +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-49.500000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALMYT:"+title=Geoportail - Mayotte +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-12.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALNCL:"+title=Geoportail - Nouvelle-Caledonie +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-22.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALPYF:"+title=Geoportail - Polynesie francaise +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-15.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALREU:"+title=Geoportail - Reunion et dependances +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-21.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALSPM:"+title=Geoportail - Saint-Pierre et Miquelon +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=47.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GEOPORTALWLF:"+title=Geoportail - Wallis et Futuna +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-14.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",GUAD48UTM20:"+title=Guadeloupe Ste Anne +proj=tmerc +towgs84=-472.2900,-5.6300,-304.1200,0.4362,-0.8374,0.2563,1.898400 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",GUADFM49U20:"+title=Guadeloupe Fort Marigot  +proj=tmerc +towgs84=136.5960,248.1480,-429.7890 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",IGN63UTM7S:"+title=IGN 1963 - Hiva Oa, Tahuata, Mohotani - UTM fuseau 7 Sud +proj=tmerc +towgs84=410.7210,55.0490,80.7460,-2.5779,-2.3514,-0.6664,17.331100 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-141.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",IGN72UTM58S:"+title=IGN 1972 - UTM fuseau 58 Sud +proj=tmerc +towgs84=-11.6400,-348.6000,291.6800 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=165.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",KERG62UTM42S:"+title=Kerguelen 1962 +proj=tmerc +towgs84=144.8990,-186.7700,100.9230 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=69.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",LAMB1:"+title=Lambert I +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=49.500000000 +lon_0=0.000000000 +k_0=0.99987734 +lat_1=49.500000000 +x_0=600000.000 +y_0=200000.000 +units=m +no_defs",LAMB1C:"+title=Lambert I Carto +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=49.500000000 +lon_0=0.000000000 +k_0=0.99987734 +lat_1=49.500000000 +x_0=600000.000 +y_0=1200000.000 +units=m +no_defs",LAMB2:"+title=Lambert II +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=46.800000000 +lon_0=0.000000000 +k_0=0.99987742 +lat_1=46.800000000 +x_0=600000.000 +y_0=200000.000 +units=m +no_defs",LAMB2C:"+title=Lambert II Carto +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=46.800000000 +lon_0=0.000000000 +k_0=0.99987742 +lat_1=46.800000000 +x_0=600000.000 +y_0=2200000.000 +units=m +no_defs",LAMB3:"+title=Lambert III +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=44.100000000 +lon_0=0.000000000 +k_0=0.99987750 +lat_1=44.100000000 +x_0=600000.000 +y_0=200000.000 +units=m +no_defs",LAMB3C:"+title=Lambert III Carto +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=44.100000000 +lon_0=0.000000000 +k_0=0.99987750 +lat_1=44.100000000 +x_0=600000.000 +y_0=3200000.000 +units=m +no_defs",LAMB4:"+title=Lambert IV +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=42.165000000 +lon_0=0.000000000 +k_0=0.99994471 +lat_1=42.165000000 +x_0=234.358 +y_0=185861.369 +units=m +no_defs",LAMB4C:"+title=Lambert IV Carto +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=42.165000000 +lon_0=0.000000000 +k_0=0.99994471 +lat_1=42.165000000 +x_0=234.358 +y_0=4185861.369 +units=m +no_defs",LAMB93:"+title=Lambert 93 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=46.500000000 +lon_0=3.000000000 +lat_1=44.000000000 +lat_2=49.000000000 +x_0=700000.000 +y_0=6600000.000 +units=m +no_defs",RGF93CC42:"+title=Lambert conique conforme Zone 1 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=42.000000000 +lon_0=3.000000000 +lat_1=41.200000000 +lat_2=42.800000000 +x_0=1700000.000 +y_0=1200000.000 +units=m +no_defs",RGF93CC43:"+title=Lambert conique conforme Zone 2 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=43.000000000 +lon_0=3.000000000 +lat_1=42.200000000 +lat_2=43.800000000 +x_0=1700000.000 +y_0=2200000.000 +units=m +no_defs",RGF93CC44:"+title=Lambert conique conforme Zone 3 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=44.000000000 +lon_0=3.000000000 +lat_1=43.200000000 +lat_2=44.800000000 +x_0=1700000.000 +y_0=3200000.000 +units=m +no_defs",RGF93CC45:"+title=Lambert conique conforme Zone 4 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=45.000000000 +lon_0=3.000000000 +lat_1=44.200000000 +lat_2=45.800000000 +x_0=1700000.000 +y_0=4200000.000 +units=m +no_defs",RGF93CC46:"+title=Lambert conique conforme Zone 5 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=46.000000000 +lon_0=3.000000000 +lat_1=45.200000000 +lat_2=46.800000000 +x_0=1700000.000 +y_0=5200000.000 +units=m +no_defs",RGF93CC47:"+title=Lambert conique conforme Zone 6 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=47.000000000 +lon_0=3.000000000 +lat_1=46.200000000 +lat_2=47.800000000 +x_0=1700000.000 +y_0=6200000.000 +units=m +no_defs",RGF93CC48:"+title=Lambert conique conforme Zone 7 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=48.000000000 +lon_0=3.000000000 +lat_1=47.200000000 +lat_2=48.800000000 +x_0=1700000.000 +y_0=7200000.000 +units=m +no_defs",RGF93CC49:"+title=Lambert conique conforme Zone 8 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=49.000000000 +lon_0=3.000000000 +lat_1=48.200000000 +lat_2=49.800000000 +x_0=1700000.000 +y_0=8200000.000 +units=m +no_defs",RGF93CC50:"+title=Lambert conique conforme Zone 9 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=50.000000000 +lon_0=3.000000000 +lat_1=49.200000000 +lat_2=50.800000000 +x_0=1700000.000 +y_0=9200000.000 +units=m +no_defs",LAMBE:"+title=Lambert II etendu +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=46.800000000 +lon_0=0.000000000 +k_0=0.99987742 +lat_1=46.800000000 +x_0=600000.000 +y_0=2200000.000 +units=m +no_defs",MART38UTM20:"+title=Martinique Fort-Desaix +proj=tmerc +towgs84=126.9260,547.9390,130.4090,-2.7867,5.1612,-0.8584,13.822650 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",MAYO50UTM38S:"+title=Mayotte Combani +proj=tmerc +towgs84=-599.9280,-275.5520,-195.6650,-0.0835,-0.4715,0.0602,49.281400 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=45.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",MILLER:"+title=Geoportail - Monde +proj=mill +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lon_0=0.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs",MOOREA87U6S:"+title=Moorea 1987 - UTM fuseau 6 Sud +proj=tmerc +towgs84=215.9820,149.5930,176.2290,3.2624,1.6920,1.1571,10.477300 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-147.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",NUKU72U7S:"+title=IGN 1972 Nuku Hiva - UTM fuseau 7 Sud +proj=tmerc +towgs84=165.7320,216.7200,180.5050,-0.6434,-0.4512,-0.0791,7.420400 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-141.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGM04UTM38S:"+title=UTM fuseau 38 Sud (Reseau Geodesique de Mayotte 2004) +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=45.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGNCUTM57S:"+title=Reseau Geodesique de Nouvelle-Caledonie - UTM fuseau 57 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=159.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGNCUTM58S:"+title=Reseau Geodesique de Nouvelle-Caledonie - UTM fuseau 58 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=165.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGNCUTM59S:"+title=Reseau Geodesique de Nouvelle-Caledonie - UTM fuseau 59 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=171.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGPFUTM5S:"+title=RGPF - UTM fuseau 5 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-153.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGPFUTM6S:"+title=RGPF - UTM fuseau 6 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-147.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGPFUTM7S:"+title=RGPF - UTM fuseau 7 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-141.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGR92UTM40S:"+title=RGR92 UTM fuseau 40 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=57.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",RGSPM06U21:"+title=Saint-Pierre-et-Miquelon (2006) UTM Fuseau 21 Nord +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-57.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",STPL69UTM43S:"+title=Saint-Paul 1969 UTM fuseau 43 Sud +proj=tmerc +towgs84=225.571,-346.608,-46.567,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=75.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",STPM50UTM21:"+title=St Pierre et Miquelon 1950 +proj=tmerc +towgs84=-95.5930,573.7630,173.4420,-0.9602,1.2510,-1.3918,42.626500 +a=6378206.4000 +rf=294.9786982000000 +lat_0=0.000000000 +lon_0=-57.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",TAHAAUTM05S:"+title=Tahaa 1951 +proj=tmerc +towgs84=72.4380,345.9180,79.4860,-1.6045,-0.8823,-0.5565,1.374600 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-153.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",TAHI51UTM06S:"+title=Tahiti-Terme Nord UTM fuseau 6 Sud +proj=tmerc +towgs84=162.0000,117.0000,154.0000 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-147.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",TAHI79UTM6S:"+title=Tahiti 1979 +proj=tmerc +towgs84=221.5250,152.9480,176.7680,2.3847,1.3896,0.8770,11.474100 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-147.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",TERA50STEREO:"+title=Terre Adelie 1950 +proj=stere +towgs84=324.9120,153.2820,172.0260 +a=6378388.0000 +rf=297.0000000000000 +lat_0=-90.000000000 +lon_0=140.000000000 +lat_ts=-67 +k=0.96027295 +x_0=300000.000 +y_0=-2299363.482 +units=m +no_defs",UTM01SW84:"+title=World Geodetic System 1984 UTM fuseau 01 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-177.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",UTM20W84GUAD:"+title=World Geodetic System 1984 UTM fuseau 20 Nord-Guadeloupe +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM20W84MART:"+title=World Geodetic System 1984 UTM fuseau 20 Nord-Martinique +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM22RGFG95:"+title=RGFG95 UTM fuseau 22 Nord-Guyane +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-51.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM39SW84:"+title=World Geodetic System 1984 UTM fuseau 39 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=51.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",UTM42SW84:"+title=World Geodetic System 1984 UTM fuseau 42 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=69.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",UTM43SW84:"+title=World Geodetic System 1984 UTM fuseau 43 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=75.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",WALL78UTM1S:"+title=Wallis-Uvea 1978 (MOP78) UTM 1 SUD +proj=tmerc +towgs84=253.0000,-133.0000,-127.0000 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-177.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs",ETRS89GEO:"+title=ETRS89 geographiques (dms) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs",ETRS89LAEA:"+title=ETRS89 Lambert Azimutal Equal Area +proj=laea +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=52.000000000 +lon_0=10.000000000 +x_0=4321000.000 +y_0=3210000.000 +units=m +no_defs",ETRS89LCC:"+title=ETRS89 Lambert Conformal Conic +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=52.000000000 +lon_0=9.999999995 +lat_1=35.000000000 +lat_2=65.000000000 +x_0=4000000.000 +y_0=2800000.000 +units=m +no_defs",UTM26ETRS89:"+title=Europe - de 30d a 24d Ouest +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-27.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM27ETRS89:"+title=Europe - de 24d a 18d Ouest +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-21.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM28ETRS89:"+title=Europe - de 18d a 12d Ouest +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-15.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM29ETRS89:"+title=Europe - de 12d a 6d Ouest +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-9.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM30ETRS89:"+title=Europe - de -6d a 0d Ouest +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-3.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM31ETRS89:"+title=Europe - de 0d a 6d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=3.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM32ETRS89:"+title=Europe - de 6d a 12d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=9.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM33ETRS89:"+title=Europe - de 12d a 18d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=15.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM34ETRS89:"+title=Europe - de 18d a 24d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=21.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM35ETRS89:"+title=Europe - de 24d a 30d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=27.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM36ETRS89:"+title=Europe - de 30d a 36d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=33.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM37ETRS89:"+title=Europe - de 36d a 42d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=39.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs",UTM38ETRS89:"+title=Europe - de 42d a 48d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=45.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs"}},logger$x=LoggerByDefault.getLogger("CRS"),CRS={projectionsExtent:{"EPSG:2154":{left:-9.62,bottom:41.18,right:10.3,top:51.54},"EPSG:27572":{left:-4.87,bottom:42.33,right:8.23,top:51.14}},load:function(){if(logger$x.trace("Loading custom definitions projections"),!Register.isLoaded){Register.load(proj4);try{register(proj4),window.ol&&window.ol.proj&&window.ol.proj.proj4&&(window.ol.proj.proj4.register=register,window.ol.proj.proj4.register(proj4))}catch(n){logger$x.error(n)}}},loadByDefault:function(){if(logger$x.trace("Loading custom definitions projections by default"),!Register.isLoaded){Register.loadByDefault(proj4);try{register(proj4),window.ol&&window.ol.proj&&window.ol.proj.proj4&&(window.ol.proj.proj4.register=register,window.ol.proj.proj4.register(proj4))}catch(n){logger$x.error(n)}}},loadByName:function(n){if(logger$x.trace("Loading a custom definition projection : ",n),!Register.isLoaded){Register.loadByName(proj4,n);try{register(proj4),window.ol&&window.ol.proj&&window.ol.proj.proj4&&(window.ol.proj.proj4.register=register,window.ol.proj.proj4.register(proj4))}catch(e){logger$x.error(e)}}},overload:function(){logger$x.trace("Loading projections aera (extent)");for(var n in this.projectionsExtent)if(this.projectionsExtent.hasOwnProperty(n)){var e=this.projectionsExtent[n],i=get$3(n),s=getTransform("EPSG:4326",i),o=applyTransform([e.bottom,e.right,e.top,e.left],s);i.setExtent(o),addProjection(i),window.ol&&window.ol.proj&&window.ol.proj.addProjection&&window.ol.proj.addProjection(i)}}};window.ol&&window.ol.proj&&window.ol.proj.proj4&&(window.ol.proj.proj4.register=register);let m_suggestions=[],controller=new AbortController,m_index="geoplateforme",m_fields="title,layer_name",m_size="1000",m_maximumResponses=10,m_filterByService=["WMTS","TMS"],m_filterByProjection=[],m_filterByLayerPriority=[],m_filterWMTSPriority=!1,m_filterTMS=!0,m_url=`https://data.geopf.fr/recherche/api/indexes/${m_index}/suggest`;const target=new EventTarget,suggest=async n=>{clear(),controller=new AbortController;let e=new URL(m_url),i={text:n,fields:m_fields,size:m_size};Object.keys(i).forEach(f=>e.searchParams.append(f,i[f]));var s=await fetch(e,{}),o=await s.json();if(s.status!==200)throw new Error(s.message);if(!(!o||o.length===0)){for(let f=0;f<o.length;f++){const g=o[f];m_filterByLayerPriority.findIndex(Y=>Y.includes(g.source.layer_name))>=0&&(o[f].score+=100)}o.sort((f,g)=>g.score-f.score);var l=null;m_filterWMTSPriority&&(l=inventory(o));for(let f=0;f<o.length;f++){const g=o[f];var c=m_filterByService.length===0||m_filterByService.includes(g.source.type);if(c){if(unique().length>=m_maximumResponses)break;var u={attribution:g.source.attribution||{},srs:g.source.srs||[],keywords:g.source.keywords||[],extent:g.source.extent||{},metadata:g.source.metadata_urls||[],name:g.source.layer_name||"",title:g.source.title||"",description:g.source.description,service:g.source.type||"",url:g.source.url||"",tech:g.source.tech||{},tags:g.source.tags||{},theme:g.source.theme||"",producer:g.source.producer||""};if(m_filterByProjection.length&&m_filterByProjection.includes(u.srs[0])||l&&l[u.name]&&u.service==="WMS"||u.service==="TMS"&&(u.styles=!1,u.metadata.length!==0&&/(\.json)$/i.test(u.metadata[0])&&(u.styles=!0),!u.styles&&m_filterTMS)||u.service==="WMTS"&&u.metadata.length!==0&&/(.json)$/i.test(u.metadata[0])&&m_filterTMS===!0)continue;m_suggestions.push(u)}}return target.dispatchEvent(new CustomEvent("suggest",{bubbles:!0,detail:getSuggestions()})),getSuggestions()}},unique=()=>m_suggestions.filter((n,e,i)=>e===i.findIndex(s=>s.service===n.service&&s.name===n.name&&s.title===n.title&&s.description===n.description)),clear=()=>{controller.abort(),m_suggestions=[]},inventory=n=>{var e={};for(let i=0;i<n.length;i++){const s=n[i].source.type,o=n[i].source.layer_name;(s==="WMTS"||s==="WMS")&&(e[o]===void 0&&(e[o]=s==="WMTS"),e[o]||(e[o]=s==="WMTS"))}return e},getSuggestions=()=>unique(),getNames=()=>unique().map(n=>n.name),getTitles=()=>unique().map(n=>n.title),setIndex=n=>{m_index=n},setFields=n=>{m_fields=n},setSuggestions=n=>{m_suggestions=n},setSize=n=>{m_size=parseInt(n)},setUrl=value=>{m_url=eval("`"+value+"`")},setMaximumResponses=n=>{m_maximumResponses=parseInt(n)},setFiltersByService=n=>{m_filterByService=n===""?[]:n.split(",")},setFiltersByProjection=n=>{m_filterByProjection=n===""?[]:n.split(",")},setFiltersByLayerPriority=n=>{m_filterByLayerPriority=n===""?[]:n.split(",")},setFilterWMTSPriority=n=>{m_filterWMTSPriority=n},setFilterTMS=n=>{m_filterTMS=n},Search$1={target,suggest,clear,getSuggestions,getNames,getTitles,setIndex,setFields,setSuggestions,setSize,setUrl,setMaximumResponses,setFiltersByService,setFiltersByProjection,setFiltersByLayerPriority,setFilterWMTSPriority,setFilterTMS};var SearchEngineDOM={_addUID:function(n){var e=this._uid?n+"-"+this._uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPsearchEngine"),n.className="GPwidget gpf-widget",n},_createSearchDivElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPshowSearchDiv"),n},_createShowSearchEnginePictoElement:function(n){var e=this;checkDsfr()&&(n=!0);var i=document.createElement("button");return i.id=this._addUID("GPshowSearchEnginePicto"),i.className="GPshowOpen GPshowAdvancedToolPicto GPshowSearchEnginePicto gpf-btn gpf-btn-icon-search fr-btn",i.title="Afficher/masquer la recherche par lieux",checkDsfr()&&(i.title="Rechercher"),i.setAttribute("tabindex","0"),i.setAttribute("aria-pressed",!n),i.disabled=!n,i.setAttribute("type","button"),i.addEventListener("click",function(s){if(checkDsfr()){var o=document.getElementById(e._addUID("GPautocompleteResults")),l=o.getElementsByClassName("GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine current"),c=o.getElementsByClassName("GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine"),u=c.length;if(!u)return;var f=null;l.length?f=l[0]:(f=c[0],f.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine current",f.style.color="#000000",f.style["background-color"]="#CEDBEF"),f.click();return}var g=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!g),document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden"),document.getElementById(e._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(e._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden");var H=document.getElementById(e._addUID("GPshowAdvancedSearch"));H&&(H.style.display=null,document.getElementById(e._addUID("GPadvancedSearchPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(e._addUID("GPadvancedSearchPanel")).classList.replace("gpf-visible","gpf-hidden"));var Y=document.getElementById(e._addUID("GPshowGeolocate"));Y&&(Y.style.display=null);var ee=document.getElementById(e._addUID("GPshowSearchByCoordinate"));ee&&(ee.style.display=null);var te="#GPsearchInput-"+e._uid;document.querySelector(te+" input").disabled=!1,checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+e._uid).disabled=!1),e.onShowSearchEngineClick(s)}),i},_createSearchInputElement:function(n){var e=this,i=document.createElement("form");i.id=this._addUID("GPsearchInput"),i.className="gpf-panel__content fr-modal__content",i.addEventListener("submit",function(l){return l.preventDefault(),document.getElementById(e._addUID("GPsearchInputText")).value===""||(document.getElementById(e._addUID("GPgeocodeResultsList")).classList.replace("GPelementHidden","GPelementVisible"),document.getElementById(e._addUID("GPgeocodeResultsList")).classList.replace("gpf-hidden","gpf-visible"),document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden"),e.onGeocodingSearchSubmit(l)),!1});var s=document.createElement("input");s.id=this._addUID("GPsearchInputText"),s.className="GPsearchInputText gpf-input fr-input",s.type="text",s.placeholder=n,s.autocomplete="off",s.addEventListener("keyup",function(l){var c=l.which||l.keyCode;c===13||c===10||c===38||c===40||(document.getElementById(e._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(e._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden"),s.value.length>2?(document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("GPelementHidden","GPelementVisible"),document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("gpf-hidden","gpf-visible")):(document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden")),e.onAutoCompleteSearchText(l))});var o=null;return document.addEventListener("pointerdown",function(l){o=l.target}),s.addEventListener("blur",function(l){o.classList.contains("GPautoCompleteProposal")||(document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(e._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden"))}),s.addEventListener("keydown",function(l){var c=l.which||l.keyCode;c===13&&l.preventDefault();var u=document.getElementById(e._addUID("GPautocompleteResults"));if(u){var f=u.getElementsByClassName("GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine current"),g=u.getElementsByClassName("GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine"),H=g.length;if(H){var Y=null;if(f.length)Y=f[0];else if(Y=g[0],Y.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine current",Y.style.color="#000000",Y.style["background-color"]="#CEDBEF",c!==13)return;var ee=parseInt(SelectorID.index(Y.id),10),te=ee===H-1?g[0]:g[ee+1],ne=ee===0?g[H-1]:g[ee-1];switch(Y.style["background-color"]="",Y.style.color="",ne.style["background-color"]="",ne.style.color="",te.style["background-color"]="",te.style.color="",c){case 38:Y.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine",ne.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine current",ne.style.color="#000000",ne.style["background-color"]="#CEDBEF",Y.scrollIntoView();break;case 40:Y.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine",te.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine current",te.style.color="#000000",te.style["background-color"]="#CEDBEF",Y.scrollIntoView();break;case 13:l.preventDefault(),Y.click(l);break}Y.focus()}}}),i.appendChild(s),i},_createSearchResetElement:function(){var n=this,e=document.createElement("button");return e.id=this._addUID("GPsearchInputReset"),e.className="GPshowOpen GPsearchInputReset gpf-btn gpf-btn-icon-reset gpf-btn-icon-search-reset fr-btn fr-btn--secondary gpf-btn--secondary",e.setAttribute("aria-label","Supprimer la recherche"),e.addEventListener("click",function(i){document.getElementById(n._addUID("GPsearchInputText")).value="",document.getElementById(n._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden"),document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden"),n.onSearchResetClick()}),e},_createButtonsElement:function(){var n=document.createElement("div");return n.className="GPbuttonsContainer",n},_createFirstLineWrapper:function(){var n=document.createElement("div");return n.className="GPsearchFirstLineWrapper",n},_createRadioContainer:function(){var n=document.createElement("div");return n.className="GPsearchRadioContainer",n},_createRadioElements:function(){var n=document.createElement("div");n.className="GPsearchRadioElements";var e=document.createElement("div");e.className="GPsearchSplitChoice gpf-flex gpf-radio-group fr-radio-group fr-my-1w";var i=document.createElement("input");i.id=this._addUID("GPsearchSplitLocations"),i.type="radio",i.name="GPsearchSplit",i.value="address",i.checked=!0,e.appendChild(i);var s=document.createElement("label");s.className="gpf-label fr-label",s.htmlFor=this._addUID("GPsearchSplitLocations"),s.title="Adresses",s.innerHTML="Adresses",e.appendChild(s),i.addEventListener?i.addEventListener("change",function(){i.checked?(document.querySelector("[id^='GPautocompleteResultsSuggest']").classList.add("gpf-hidden","GPelementHidden"),document.querySelector("[id^='GPautocompleteResultsLocation']").classList.remove("gpf-hidden","GPelementHidden")):(document.querySelector("[id^='GPautocompleteResultsSuggest']").classList.remove("gpf-hidden","GPelementHidden"),document.querySelector("[id^='GPautocompleteResultsLocation']").classList.add("gpf-hidden","GPelementHidden"))}):i.attachEvent&&i.attachEvent("onchange",function(){i.checked?(document.querySelector("[id^='GPautocompleteResultsSuggest']").classList.add("gpf-hidden","GPelementHidden"),document.querySelector("[id^='GPautocompleteResultsLocation']").classList.remove("gpf-hidden","GPelementHidden")):(document.querySelector("[id^='GPautocompleteResultsSuggest']").classList.remove("gpf-hidden","GPelementHidden"),document.querySelector("[id^='GPautocompleteResultsLocation']").classList.add("gpf-hidden","GPelementHidden"))});var o=document.createElement("div");o.className="GPsearchSplitChoice gpf-flex gpf-radio-group fr-radio-group fr-my-1w";var l=document.createElement("input");l.id=this._addUID("GPsearchSplitData"),l.type="radio",l.name="GPsearchSplit",l.value="data",o.appendChild(l);var c=document.createElement("label");return c.className="gpf-label fr-label",c.htmlFor=this._addUID("GPsearchSplitData"),c.title="Cartes et donnes",c.innerHTML="Cartes et donnes",o.appendChild(c),l.addEventListener?l.addEventListener("change",function(){l.checked?(document.querySelector("[id^='GPautocompleteResultsSuggest']").classList.remove("gpf-hidden","GPelementHidden"),document.querySelector("[id^='GPautocompleteResultsLocation']").classList.add("gpf-hidden","GPelementHidden")):(document.querySelector("[id^='GPautocompleteResultsSuggest']").classList.add("gpf-hidden","GPelementHidden"),document.querySelector("[id^='GPautocompleteResultsLocation']").classList.remove("gpf-hidden","GPelementHidden"))}):l.attachEvent&&l.attachEvent("onchange",function(){l.checked?(document.querySelector("[id^='GPautocompleteResultsSuggest']").classList.remove("gpf-hidden","GPelementHidden"),document.querySelector("[id^='GPautocompleteResultsLocation']").classList.remove("gpf-hidden","GPelementHidden")):(document.querySelector("[id^='GPautocompleteResultsSuggest']").classList.remove("gpf-hidden","GPelementHidden"),document.querySelector("[id^='GPautocompleteResultsLocation']").classList.add("gpf-hidden","GPelementHidden"))}),n.appendChild(e),n.appendChild(o),[n,i,l]},_createShowAdvancedSearchElement:function(){var n=this,e=document.createElement("button");return e.id=this._addUID("GPshowAdvancedSearch"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowAdvancedSearch GPshowOpen gpf-btn gpf-btn-icon-search-advanced fr-btn fr-btn--secondary gpf-btn--secondary fr-m-1w",e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.addEventListener("click",function(i){var s=i.target.ariaPressed==="true";i.target.setAttribute("aria-pressed",!s);var o="#GPsearchInput-"+n._uid;s?(document.getElementById(n._addUID("GPadvancedSearchPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPadvancedSearchPanel")).classList.replace("gpf-visible","gpf-hidden"),document.querySelector(o+" input").disabled=!1,document.querySelector(o+" .GPsearchInputReset")&&(document.querySelector(o+" .GPsearchInputReset").disabled=!1),checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+n._uid).disabled=!1)):(document.getElementById(n._addUID("GPadvancedSearchPanel")).classList.replace("GPelementHidden","GPelementVisible"),document.getElementById(n._addUID("GPadvancedSearchPanel")).classList.replace("gpf-hidden","gpf-visible"),document.querySelector(o+" input").disabled=!0,document.querySelector(o+" .GPsearchInputReset")&&(document.querySelector(o+" .GPsearchInputReset").disabled=!0),checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+n._uid).disabled=!0)),document.getElementById(n._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden"),document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden");var l=document.getElementById(n._addUID("GPcoordinateSearchPanel"));l&&(l.classList.replace("GPelementVisible","GPelementHidden"),l.classList.replace("gpf-visible","gpf-hidden"));var c=document.getElementById(n._addUID("GPshowSearchByCoordinate"));c&&c.setAttribute("aria-pressed",!1)}),e},_createShowGeolocateElement:function(){var n=this,e=document.createElement("button");return e.id=this._addUID("GPshowGeolocate"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowGeolocate gpf-btn gpf-btn-icon-search-geolocate fr-btn fr-btn--secondary gpf-btn--secondary fr-m-1w",e.title="Activer la golocalisation",e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.addEventListener("click",function(i){var s=i.target.ariaPressed==="true";i.target.setAttribute("aria-pressed",!s),n.onShowSearchGeolocateClick(i)}),e},_createShowSearchByCoordinateElement:function(){var n=this,e=document.createElement("button");return e.id=this._addUID("GPshowSearchByCoordinate"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowSearchByCoordinate gpf-btn gpf-btn-icon-search-coordinate fr-btn fr-btn--secondary gpf-btn--secondary fr-m-1w",e.title="Ouvrir la recherche par coordonnes",e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.addEventListener("click",function(i){var s=i.target.ariaPressed==="true";i.target.setAttribute("aria-pressed",!s);var o="#GPsearchInput-"+n._uid;s?(document.getElementById(n._addUID("GPcoordinateSearchPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPcoordinateSearchPanel")).classList.replace("gpf-visible","gpf-hidden"),document.querySelector(o+" input").disabled=!1,document.querySelector(o+" .GPsearchInputReset").disabled=!1,checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+n._uid).disabled=!1)):(document.getElementById(n._addUID("GPcoordinateSearchPanel")).classList.replace("GPelementHidden","GPelementVisible"),document.getElementById(n._addUID("GPcoordinateSearchPanel")).classList.replace("gpf-hidden","gpf-visible"),document.querySelector(o+" input").disabled=!0,document.querySelector(o+" .GPsearchInputReset").disabled=!0,checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+n._uid).disabled=!0)),document.getElementById(n._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden"),document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden"),document.getElementById(n._addUID("GPadvancedSearchPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPadvancedSearchPanel")).classList.replace("gpf-visible","gpf-hidden"),document.getElementById(n._addUID("GPshowAdvancedSearch")).setAttribute("aria-pressed",!1)}),e},_createAdvancedSearchPanelElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPadvancedSearchPanel"),n.className="GPpanel GPelementHidden gpf-panel gpf-hidden fr-modal",n},_createAdvancedSearchPanelDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__body fr-modal__body",n},_createGeocodeResultsElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPgeocodeResultsList"),n.className="GPpanel GPelementHidden gpf-panel gpf-hidden fr-modal",n},_createGeocodeResultsDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__body fr-modal__body",n.appendChild(this._createGeocodeResultsHeaderElement()),n},_createAutoCompleteElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPautoCompleteList"),n.className="GPautoCompleteList GPelementHidden gpf-panel fr-modal gpf-hidden ",n},_createCoordinateSearchPanelElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPcoordinateSearchPanel"),n.className="GPpanel GPelementHidden gpf-panel gpf-hidden fr-modal",n},_createCoordinateSearchPanelDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__body fr-modal__body",n},_createAutoCompleteListElement:function(){var n=this,e=document.createElement("div");return e.id=this._addUID("GPautocompleteResults"),e.className="",e.addEventListener?e.addEventListener("click",function(i){document.getElementById(n._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden")},!1):e.attachEvent&&e.attachEvent("onclick",function(i){document.getElementById(n._addUID("GPautoCompleteList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPautoCompleteList")).classList.replace("gpf-visible","gpf-hidden")}),e},_createAutoCompletedLocationContainer(){var n=document.createElement("div");return n.id=this._addUID("GPautocompleteResultsLocation"),n.className="GPelementHidden gpf-hidden gpf-select",n.size=20,n.autofocus=!0,n},_createAutoCompletedLocationTitleElement(){var n=document.getElementById(this._addUID("GPautocompleteResultsLocation")),e=document.createElement("p");e.className="GPlabel GPlabelTitle gpf-label fr-label search-results-loc",e.innerHTML="Lieux et adresses",n.appendChild(e)},_createAutoCompletedLocationElement:function(n,e){var i=this,s=document.getElementById(this._addUID("GPautocompleteResultsLocation")),o=document.createElement("p");o.id=this._addUID("AutoCompletedLocation_"+e),o.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine";var l=GeocodeUtils.getSuggestedLocationFreeform(n);o.innerHTML=l,o.title=l,o.addEventListener?o.addEventListener("click",function(c){i.onAutoCompletedResultsItemClick(c)},!1):o.attachEvent&&o.attachEvent("onclick",function(c){i.onAutoCompletedResultsItemClick(c)}),s.appendChild(o)},_createSearchedSuggestContainer(){var n=document.createElement("div");return n.id=this._addUID("GPautocompleteResultsSuggest"),n.className="GPelementHidden gpf-hidden gpf-select",n.size=6,n.autofocus=!0,n},_createSearchedSuggestTitleElement(){var n=document.getElementById(this._addUID("GPautocompleteResultsSuggest")),e=document.createElement("p");e.className="GPlabel GPlabelTitle gpf-label fr-label search-results-data",e.innerHTML="Cartes et donnes",n.appendChild(e)},_createSearchedSuggestElement:function(n,e){var i=this,s=document.getElementById(this._addUID("GPautocompleteResultsSuggest")),o=document.createElement("p");o.id=this._addUID("AutoCompletedSuggest_"+e),o.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine",o.innerHTML=n.title+" ("+n.service+")",o.dataset.layer=n.name,o.title=`${n.description} (nom technique : ${n.name})`,o.addEventListener?o.addEventListener("click",function(l){i.onSearchedResultsItemClick(l)},!1):o.attachEvent&&o.attachEvent("onclick",function(l){i.onSearchedResultsItemClick(l)}),s.appendChild(o)},_createAdvancedSearchPanelHeaderElement:function(){var n=this,e=document.createElement("div");e.className="GPpanelHeader gpf-panel__header fr-modal__header";var i=document.createElement("div");i.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",i.innerHTML="Recherche avance",e.appendChild(i);var s=document.createElement("button");s.id=this._addUID("GPadvancedSearchClose"),s.className="GPpanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",s.title="Fermer la recherche avance",s.addEventListener?s.addEventListener("click",function(){var l="#GPsearchInput-"+n._uid;document.querySelector(l+" input").disabled=!1,document.querySelector(l+" .GPsearchInputReset")&&(document.querySelector(l+" .GPsearchInputReset").disabled=!1),checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+n._uid).disabled=!1),document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden"),document.getElementById(n._addUID("GPshowAdvancedSearch")).setAttribute("aria-pressed",!1),document.getElementById(n._addUID("GPadvancedSearchPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPadvancedSearchPanel")).classList.replace("gpf-visible","gpf-hidden")},!1):s.attachEvent&&s.attachEvent("onclick",function(){var l="#GPsearchInput-"+n._uid;document.querySelector(l+" input").disabled=!1,document.querySelector(l+" .GPsearchInputReset")&&(document.querySelector(l+" .GPsearchInputReset").disabled=!1),checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+n._uid).disabled=!1),document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden"),document.getElementById(n._addUID("GPshowAdvancedSearch")).setAttribute("aria-pressed",!1),document.getElementById(n._addUID("GPadvancedSearchPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPadvancedSearchPanel")).classList.replace("gpf-visible","gpf-hidden")});var o=document.createElement("span");return o.className="GPelementHidden gpf-visible",o.innerText="Fermer",s.appendChild(o),e.appendChild(s),e},_createAdvancedSearchPanelFormElement:function(n,e){var i=this,s=document.createElement("form");s.id=this._addUID("GPadvancedSearchForm"),s.className="gpf-panel__content fr-modal__content",s.addEventListener("submit",function(u){u.preventDefault();for(var f=[],g="#GPadvancedSearchFilters-"+i._uid,H=document.querySelectorAll(g+" > div > div > input,select#category"),Y=0;Y<H.length;Y++){var ee=H[Y];f.push({key:ee.name,value:ee.value})}return i.onGeocodingAdvancedSearchSubmit(u,f),document.getElementById(i._addUID("GPgeocodeResultsList")).classList.replace("GPelementHidden","GPelementVisible"),document.getElementById(i._addUID("GPgeocodeResultsList")).classList.replace("gpf-hidden","gpf-visible"),!1});var o=document.createElement("div");o.className="GPflexInput gpf-flex-column ";var l=document.createElement("label");l.className="GPadvancedSearchCodeLabel gpf-label fr-label",l.innerHTML="Recherche par",o.appendChild(l);var c=this._createAdvancedSearchFormCodeElement(n,e);return o.appendChild(c),s.appendChild(o),s},_createAdvancedSearchFormCodeElement:function(n,e){var i=this,s=document.createElement("select");s.id=this._addUID("GPadvancedSearchCode"),s.title="Choisir un type de recherche",s.className="GPadvancedSearchCode gpf-select fr-select",s.addEventListener("change",function(c){i.onGeocodingAdvancedSearchCodeChange(c)},!1),n||(n=[{id:"PositionOfInterest",title:"Lieux/toponymes"},{id:"StreetAddress",title:"Adresses"},{id:"CadastralParcel",title:"Parcelles cadastrales"}]);for(var o=0;o<n.length;o++){var l=document.createElement("option");l.value=n[o].id,l.text=n[o].title,s.appendChild(l)}if(e){var l=document.createElement("option");l.value="Coordinates",l.text="Coordonnes",s.appendChild(l)}return s},_createAdvancedSearchFormInputElement:function(){var n=document.createElement("input");return n.type="submit",n.id=this._addUID("GPadvancedSearchSubmit"),n.className="GPsubmit gpf-btn gpf-btn-icon-submit  fr-btn fr-btn--secondary gpf-btn--secondary",n.value="Chercher",n},_createAdvancedSearchFormFiltersElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPadvancedSearchFilters"),n},_createAdvancedSearchFiltersTableElement:function(n,e){var i=document.createElement("div");return i.id=this._addUID(n),e||(i.style.display="none"),i},_createAdvancedSearchFiltersAttributElement:function(n){var e=null,i=n.name,s=n.title,o=n.description,l=n.code,c=n.value,u=document.createElement("div");u.className="GPflexInput gpf-flex-column ";var f=document.createElement("label");if(f.className="GPadvancedSearchFilterLabel gpf-label fr-label",f.htmlFor=i,f.title=o||s,f.innerHTML=s,u.appendChild(f),i==="category"){var g=document.createElement("select");if(g.id=i,g.name=i,g.title=s,g.className="GPadvancedSearchFilterInput gpf-select fr-select",c&&Array.isArray(c))for(var H=0;H<c.length;H++){var Y=document.createElement("option");Y.value=c[H],Y.text=c[H],g.appendChild(Y)}u.appendChild(g)}else{var ee=document.createElement("input");if(ee.id=i,ee.className="GPadvancedSearchFilterInput gpf-input fr-input",ee.type="text",ee.name=i,c)if(Array.isArray(c)){var te=i+"_list";ee.setAttribute("list",te);var ne=document.createElement("datalist");ne.id=te;for(var H=0;H<c.length;++H){var Y=document.createElement("option");Y.value=c[H],ne.appendChild(Y)}u.appendChild(ne)}else ee.value=c;u.appendChild(ee)}return e=document.getElementById(this._addUID(l)),e?e.appendChild(u):e=u,e},_createGeocodeResultsHeaderElement:function(){var n=this,e=document.createElement("div");e.className="GPpanelHeader gpf-panel__header fr-modal__header";var i=document.createElement("div");i.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",i.innerHTML="Rsultats de la recherche",e.appendChild(i);var s=document.createElement("button");s.id=this._addUID("GPgeocodeResultsClose"),s.className="GPpanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",s.title="Fermer la fentre de rsultats",s.addEventListener?s.addEventListener("click",function(){document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden")},!1):s.attachEvent&&s.attachEvent("onclick",function(){document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden")});var o=document.createElement("span");return o.className="GPelementHidden gpf-visible",o.innerText="Fermer",s.appendChild(o),e.appendChild(s),e},_createGeocodeResultsListElement:function(){var n=this,e=document.createElement("div");return e.id=this._addUID("GPgeocodeResults"),e.className="gpf-panel__list",e.setAttribute("tabindex","0"),e.addEventListener?e.addEventListener("click",function(i){i.ctrlKey||(document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden")),n.onGeocodedResultsItemClick(i)},!1):e.attachEvent&&e.attachEvent("onclick",function(i){i.ctrlKey||(document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPgeocodeResultsList")).classList.replace("gpf-visible","gpf-hidden")),n.onGeocodedResultsItemClick(i)}),e},_createGeocodedLocationElement:function(n,e){var i=document.getElementById(this._addUID("GPgeocodeResults")),s=document.createElement("div");s.id=this._addUID("GeocodedLocation_"+e),s.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine",typeof n=="string"?s.innerHTML=n:s.innerHTML=GeocodeUtils.getGeocodedLocationFreeform(n),i.appendChild(s)},_createCoordinateSearchPanelHeaderElement(){var n=this,e=document.createElement("div");e.className="GPpanelHeader gpf-panel__header fr-modal__header";var i=document.createElement("div");i.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",i.innerHTML="Recherche par coordonnes",e.appendChild(i);var s=document.createElement("button");s.id=this._addUID("GPcoordinateSearchClose"),s.className="GPpanelClose GPcoordinateSearchClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",s.title="Fermer la recherche par coordonnes",s.addEventListener?s.addEventListener("click",function(){var l="#GPsearchInput-"+n._uid;document.querySelector(l+" input").disabled=!1,document.querySelector(l+" .GPsearchInputReset")&&(document.querySelector(l+" .GPsearchInputReset").disabled=!1),checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+n._uid).disabled=!1),document.getElementById(n._addUID("GPshowSearchByCoordinate")).setAttribute("aria-pressed",!1),document.getElementById(n._addUID("GPcoordinateSearchPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPcoordinateSearchPanel")).classList.replace("gpf-visible","gpf-hidden"),n.onCoordinateSearchClose()},!1):s.attachEvent&&s.attachEvent("onclick",function(){var l="#GPsearchInput-"+n._uid;document.querySelector(l+" input").disabled=!1,document.querySelector(l+" .GPsearchInputReset")&&(document.querySelector(l+" .GPsearchInputReset").disabled=!1),checkDsfr()&&(document.querySelector("#GPshowSearchEnginePicto-"+n._uid).disabled=!1),document.getElementById(n._addUID("GPshowSearchByCoordinate")).setAttribute("aria-pressed",!1),document.getElementById(n._addUID("GPcoordinateSearchPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPcoordinateSearchPanel")).classList.replace("gpf-visible","gpf-hidden"),n.onCoordinateSearchClose()});var o=document.createElement("span");return o.className="GPelementHidden gpf-visible",o.innerText="Fermer",s.appendChild(o),e.appendChild(s),e},_createCoordinateSearchPanelFormElement(){var n=this,e=document.createElement("form");return e.id=this._addUID("GPcoordinateSearchForm"),e.className="gpf-panel__content fr-modal__content",e.addEventListener("submit",function(i){return i.preventDefault(),n.onShowSearchByCoordinateClick(),!1}),e},__createCoordinateSearchDivElement(){var n=document.createElement("div");return n.className="GPflexInput gpf-flex-column ",n},_createCoordinateSearchSystemsLabelElement(){var n=document.createElement("label");return n.className="GPcoordinateSearchSystemsLabel gpf-label fr-label",n.innerHTML="Systme de rfrence",n},_setCoordinateSearchSystemsSelectElement(n){document.getElementById(this._addUID("GPcoordinateSearchSystem"))&&document.getElementById(this._addUID("GPcoordinateSearchSystem")).remove();var e=this,i=document.createElement("select");i.id=this._addUID("GPcoordinateSearchSystem"),i.title="Choisir un systme de rference",i.className="GPselect GPcoordinateSearchSystemsSelect gpf-select fr-select",i.addEventListener("change",function(c){e.onCoordinateSearchSystemChange(c)});for(var s=0;s<n.length;s++){var o=n[s],l=document.createElement("option");l.value=o.code,l.text=o.label||s,i.appendChild(l)}return i},_createCoordinateSearchUnitsLabelElement(){var n=document.createElement("label");return n.className="GPcoordinateSearchUnitsLabel gpf-label fr-label",n.innerHTML="Units",n},_setCoordinateSearchUnitsSelectElement(n){document.getElementById(this._addUID("GPcoordinateSearchUnits"))&&document.getElementById(this._addUID("GPcoordinateSearchUnits")).remove();var e=this,i=document.createElement("select");i.id=this._addUID("GPcoordinateSearchUnits"),i.title="Choisir un type d'unit",i.className="GPselect GPcoordinateSearchUnitsSelect gpf-select fr-select",i.addEventListener("change",function(c){e.onCoordinateSearchUnitsChange(c)});for(var s=0;s<n.length;s++){var o=n[s],l=document.createElement("option");l.value=o.code?o.code:s,l.text=o.label||s,i.appendChild(l)}return i},_setCoordinateSearchLngLabelElement(n){document.getElementById(this._addUID("GPcoordinateSearchLngLabel"))&&document.getElementById(this._addUID("GPcoordinateSearchLngLabel")).remove();var e=document.createElement("label");return e.className="GPcoordinateSearchLabel gpf-label fr-label",e.id=this._addUID("GPcoordinateSearchLngLabel"),e.htmlFor="coordinate-lng",e.innerHTML=n==="Geographical"?"Longitude :":"Y :",e},_setCoordinateSearchLngInputElement(n){document.getElementById(this._addUID("GPcoordinateSearchLngInput"))&&document.getElementById(this._addUID("GPcoordinateSearchLngInput")).remove(),document.getElementById(this._addUID("GPcoordinateSearchLngDMS"))&&document.getElementById(this._addUID("GPcoordinateSearchLngDMS")).remove();var e=document.createElement("input");switch(e.id=this._addUID("GPcoordinateSearchLngInput"),e.className="GPcoordinateSearchInput gpf-input fr-input",e.title="Saisir des coordonnes",e.name="coordinate-lng",e.type="number",e.step="any",e.required="",n){case"DMS":return e.title+=" gographiques (en sexa)",e.className="GPelementHidden gpf-hidden",this._setCoordinateSearchLngDMSElement();case"DEC":e.title+=" gographiques (en decimal)",e.min="-180",e.max="180";break;case"M":e.title+=" cartsiennes (en mtre)";break;case"KM":e.title+=" cartsiennes (en kilomtre)";break}return e},_setCoordinateSearchLngDMSElement(){var n=document.createElement("div");return n.id=this._addUID("GPcoordinateSearchLngDMS"),n.innerHTML=`
        <div class="GPflexInput gpf-flex">
            <input step="1"
                id="GPcoordinatSearchInputSexLonDeg"
                class="gpf-input fr-input"
                name="inputSexLonDeg"
                title="Saisir une valeur de degr entre 0 et 180"
                type="number"
                required=""
                min="0"
                max="180">
            <label></label>
            <input step="1"
                id="GPcoordinatSearchInputSexLonMin"
                class="gpf-input fr-input"
                name="inputSexLonMin"
                title="Saisir une valeur de minute entre 0' et 59'"
                type="number"
                required=""
                min="0"
                max="59">
            <label>'</label>
            <input step="any"
                id="GPcoordinatSearchInputSexLonSec"
                class="gpf-input fr-input"
                name="inputSexLonSec"
                title="Saisir une valeur de seconde entre 0'' et 59''"
                type="number"
                required=""
                min="0"
                max="59.9999">
            <label>"</label>
            <select
                id="GPcoordinatSearchInputSexLonToward"
                class="GPselect gpf-select fr-select"
                title="Saisir une direction pour Est et 0uest"
                name="inputSexLonToward">
                <option value="O">O</option>
                <option value="E" selected="">E</option>
            </select>
        </div>
        `,n},_setCoordinateSearchLatLabelElement(n){document.getElementById(this._addUID("GPcoordinateSearchLatLabel"))&&document.getElementById(this._addUID("GPcoordinateSearchLatLabel")).remove();var e=document.createElement("label");return e.className="GPcoordinateSearchLabel gpf-label fr-label",e.id=this._addUID("GPcoordinateSearchLatLabel"),e.htmlFor="coordinate-lat",e.innerHTML=n==="Geographical"?"Latitude :":"X :",e},_setCoordinateSearchLatInputElement(n){document.getElementById(this._addUID("GPcoordinateSearchLatInput"))&&document.getElementById(this._addUID("GPcoordinateSearchLatInput")).remove(),document.getElementById(this._addUID("GPcoordinateSearchLatDMS"))&&document.getElementById(this._addUID("GPcoordinateSearchLatDMS")).remove();var e=document.createElement("input");switch(e.id=this._addUID("GPcoordinateSearchLatInput"),e.className="GPcoordinateSearchInput gpf-input fr-input",e.title="Saisir des coordonnes",e.name="coordinate-lat",e.type="number",e.step="any",e.required="",n){case"DMS":return e.title+=" gographiques (en sexa)",e.className="GPelementHidden gpf-hidden",this._setCoordinateSearchLatDMSElement();case"DEC":e.title+=" gographiques (en decimal)",e.min="-180",e.max="180";break;case"M":e.title+=" cartsiennes (en mtre)";break;case"KM":e.title+=" cartsiennes (en kilomtre)";break}return e},_setCoordinateSearchLatDMSElement(){var n=document.createElement("div");return n.id=this._addUID("GPcoordinateSearchLatDMS"),n.innerHTML=`
        <div class="GPflexInput gpf-flex">
            <input step="1"
                id="GPcoordinatSearchInputSexLatDeg"
                class="gpf-input fr-input"
                name="inputSexLatDeg"
                title="Saisir une valeur de degr entre 0 et 85"
                type="number"
                required=""
                min="0"
                max="85">
            <label></label>
            <input step="1"
                id="GPcoordinatSearchInputSexLatMin"
                class="gpf-input fr-input"
                name="inputSexLatMin"
                title="Saisir une valeur de minute entre 0' et 59'"
                type="number"
                required=""
                min="0"
                max="59">
            <label>'</label>
            <input step="any"
                id="GPcoordinatSearchInputSexLatSec"
                class="gpf-input fr-input"
                name="inputSexLatSec"
                title="Saisir une valeur de seconde entre 0' et 59'"
                type="number"
                required=""
                min="0"
                max="59.9999">
            <label>"</label>
            <select
                id="GPcoordinatSearchInputSexLatToward"
                class="GPselect gpf-select fr-select"
                title="Saisir une direction pour Nord et Sud"
                name="inputSexLatToward">
                <option value="N">N</option>
                <option value="S">S</option>
            </select>
        </div>
        `,n},_createCoordinateSearchSubmitElement(){var n=document.createElement("input");return n.type="submit",n.id=this._addUID("GPcoordinateSearchSubmit"),n.className="GPsubmit gpf-btn gpf-btn-icon-submit  fr-btn fr-btn--secondary gpf-btn--secondary",n.value="Chercher",n}},logger$w=LoggerByDefault.getLogger("searchengine");class SearchEngine extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof SearchEngine))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="SearchEngine",this.initialize(e),this.container=this._initContainer(),this.element?this.element.appendChild(this.container):this.element=this.container,this}setMap(e){e||this._clearResults(),this.collapsed||this._showSearchEngineButton.setAttribute("aria-pressed",!0),super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getCollapsed(){return this.collapsed}setCollapsed(e){if(e===void 0){logger$w.log("[ERROR] SearchEngine:setCollapsed - missing collapsed parameter");return}this.options.collapsible&&(e&&this.collapsed||!e&&!this.collapsed||(this._showSearchEngineButton.click(),this.collapsed=e))}getData(){return this._geocodedLocations}getContainer(){return this.container}initialize(e){this._checkInputOptions(e),this.options={collapsed:!0,collapsible:!0,zoomTo:"",resources:{geocode:[],autocomplete:[],search:!1},displayButtonClose:!0,displayButtonAdvancedSearch:!1,displayButtonGeolocate:!1,displayButtonCoordinateSearch:!1,coordinateSearchInAdvancedSearch:!1,advancedSearch:{},coordinateSearch:{},searchOptions:{addToMap:!0,maximumEntries:5,serviceOptions:{maximumResponses:10},filterLayers:!0},geocodeOptions:{serviceOptions:{}},autocompleteOptions:{serviceOptions:{maximumResponses:5},triggerGeocode:!1,triggerDelay:1e3,prettifyResults:!1},displayMarker:!0,markerStyle:"lightOrange",markerUrl:"",placeholder:"Rechercher un lieu, une adresse",splitResults:!1},Helper.mergeParams(this.options,e),this.options.resources.geocode===""&&(this.options.resources.geocode=["PositionOfInterest","StreetAddress"]),this.options.resources.autocomplete.length===0&&(this.options.resources.autocomplete=["PositionOfInterest","StreetAddress"]),this.options.resources.search&&(this.options.searchOptions&&(this.options.searchOptions.serviceOptions&&(this.options.searchOptions.serviceOptions.url&&Search$1.setUrl(this.options.searchOptions.serviceOptions.url),this.options.searchOptions.serviceOptions.fields&&Search$1.setFields(this.options.searchOptions.serviceOptions.fields),this.options.searchOptions.serviceOptions.index&&Search$1.setIndex(this.options.searchOptions.serviceOptions.index),this.options.searchOptions.serviceOptions.size&&Search$1.setSize(this.options.searchOptions.serviceOptions.size),this.options.searchOptions.serviceOptions.maximumResponses&&Search$1.setMaximumResponses(this.options.searchOptions.serviceOptions.maximumResponses)),this.options.searchOptions.filterServices&&Search$1.setFiltersByService(this.options.searchOptions.filterServices),this.options.searchOptions.filterLayersPriority&&Search$1.setFiltersByLayerPriority(this.options.searchOptions.filterLayersPriority),this.options.searchOptions.filterWMTSPriority&&Search$1.setFilterWMTSPriority(this.options.searchOptions.filterWMTSPriority),this.options.searchOptions.filterTMS===!1&&Search$1.setFilterTMS(this.options.searchOptions.filterTMS),this.options.searchOptions.filterProjections&&Search$1.setFiltersByProjection(this.options.searchOptions.filterProjections)),Search$1.target.addEventListener("suggest",o=>{logger$w.debug(o);let l=o.detail;l=this._filterResultsFromConfigLayers(l),this._fillSearchedSuggestListContainer(l)})),this.options.collapsible||(this.options.collapsed=!1),this.collapsed=this.options.collapsed,this._uid=this.options.id||SelectorID.generate(),this._showSearchEngineButton=null,this._showSearchEngineAdvancedButton=null,this._inputSearchContainer=null,this._autocompleteContainer=null,this._containerResultsLocation=null,this._containerResultsSuggest=null,this._radioButtonLocation=null,this._radioButtonSuggest=null,this._suggestedLocations=[],this._geocodedContainer=null,this._geocodedLocations=[],this._filterContainer=null,this._currentGeocodingCode=null,this._currentGeocodingLocation=null,this._advancedSearchFilters={},this._initAdvancedSearchFilters(),this._advancedSearchCodes=[],this._initAdvancedSearchCodes(),this._coordinateSearchSystems=[],this.options.displayButtonCoordinateSearch&&(this._initCoordinateSearchSystems(),this._currentCoordinateSearchSystems=this._coordinateSearchSystems[0],this._currentCoordinateSearchType=this._coordinateSearchSystems[0].type),this._coordinateSearchUnits=[],this.options.displayButtonCoordinateSearch&&(this._initCoordinateSearchUnits(),this._currentCoordinateSearchUnits=this._coordinateSearchUnits[this._currentCoordinateSearchType][0].code),this._coordinateSearchLngInput=null,this._coordinateSearchLatInput=null,this._marker=null;var i=this.options.markerStyle,s=this.options.markerUrl;s?this._markerUrl=s:this._markerUrl=Object.keys(Marker).indexOf(i)===-1?Marker.lightOrange:Marker[i],this._displayMarker=this.options.displayMarker,this._popupContent=null,this._popupDiv=this._initPopupDiv(),this._popupOverlay=null,this._triggerHandler=null}_checkInputOptions(e){var i;if(e.resources)if(typeof e.resources=="object"){var s=e.resources.geocode;if(s)if(Array.isArray(s)){var o=["StreetAddress","PositionOfInterest","CadastralParcel","Administratif"];for(i=0;i<s.length;i++)o.indexOf(s[i])===-1&&logger$w.log("[SearchEngine] options.resources.geocode : "+s[i]+" is not a resource for geocode")}else logger$w.log("[SearchEngine] 'options.resources.geocode' parameter should be an array"),s=null;var l=e.resources.autocomplete;if(l)if(Array.isArray(l)){var c=["StreetAddress","PositionOfInterest"];for(i=0;i<l.length;i++)c.indexOf(l[i])===-1&&logger$w.log("[SearchEngine] options.resources.autocomplete : "+l[i]+" is not a resource for autocomplete")}else logger$w.log("[SearchEngine] 'options.resources.autocomplete' parameter should be an array"),l=null}else logger$w.log("[SearchEngine] 'resources' parameter should be an object"),e.resources=null}_initAdvancedSearchCodes(){var e=this.options.resources.geocode;e==="location"&&(e=["PositionOfInterest","StreetAddress","CadastralParcel"]),Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++)switch(e[i]){case"PositionOfInterest":this._advancedSearchCodes.push({id:"PositionOfInterest",title:"Lieux/toponymes"});break;case"StreetAddress":this._advancedSearchCodes.push({id:"StreetAddress",title:"Adresses"});break;case"CadastralParcel":this._advancedSearchCodes.push({id:"CadastralParcel",title:"Parcelles cadastrales"});break}this._advancedSearchCodes.length===0&&(this._advancedSearchCodes=[{id:"StreetAddress",title:"Adresses"},{id:"PositionOfInterest",title:"Lieux/toponymes"},{id:"CadastralParcel",title:"Cadastre"}]),logger$w.log("advancedSearchCodes",this._advancedSearchCodes)}_initAdvancedSearchFilters(){this._advancedSearchFilters=SearchEngineUtils.advancedSearchFiltersByDefault;var e=this.options.advancedSearch;Helper.assign(this._advancedSearchFilters,e),logger$w.log("advancedSearchFilters",this._advancedSearchFilters)}_initCoordinateSearchSystems(){var e=[{label:"Gographique",crs:"EPSG:4326",type:"Geographical"},{label:"Web Mercator",crs:"EPSG:3857",type:"Metric"},{label:"Lambert 93",crs:"EPSG:2154",type:"Metric"}],i=this.options.coordinateSearch.systems;if(i)for(var s=0;s<i.length;s++){var o=i[s];this._setSystem(o)}if(this._coordinateSearchSystems.length===0)for(var l=0;l<e.length;l++)this._setSystem(e[l])}_initCoordinateSearchUnits(){var e={Geographical:[{code:"DEC",label:"degrs dcimaux",format:MathUtils.coordinateToDecimal},{code:"DMS",label:"degrs sexagsimaux",format:MathUtils.coordinateToDMS}],Metric:[{code:"M",label:"mtres",format:MathUtils.coordinateToMeter},{code:"KM",label:"kilomtres",format:MathUtils.coordinateToKMeter}]},i=this.options.coordinateSearch.units;if(i){for(var s in e)if(e.hasOwnProperty(s)){for(var o=!1,l=0;l<e[s].length;l++)for(var c=e[s][l],u=0;u<i.length;u++){var f=i[u];c.code===f&&(o=!0,this._coordinateSearchUnits[s]||(this._coordinateSearchUnits[s]=[]),this._coordinateSearchUnits[s].push(c))}o||(this._coordinateSearchUnits[s]=e[s])}}typeof this._coordinateSearchUnits=="object"&&Object.keys(this._coordinateSearchUnits).length===0&&(this._coordinateSearchUnits=e)}_initPopupDiv(){var e=this,i=document.createElement("div");i.className="gp-feature-info-div gpf-widget-color";var s=document.createElement("button");s.title="Supprimer le marqueur",s.className="gp-styling-button remove gpf-btn gpf-btn-icon-remove fr-btn--remove fr-btn fr-btn--tertiary-no-outline fr-mt-1v fr-mr-2v",s.onclick=function(){var l=e.getMap();e._marker&&(l.removeOverlay(e._marker),e._marker=null),e._popupOverlay!=null&&e._popupOverlay.setPosition(void 0),e.dispatchEvent({type:"searchengine:geolocation:remove"})};var o=document.createElement("button");return o.title="Fermer la pop-up",o.className="gp-styling-button closer gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-mt-1v fr-mr-2v",o.onclick=function(){return e._popupOverlay!=null&&e._popupOverlay.setPosition(void 0),!1},this._popupContent=document.createElement("div"),this._popupContent.className="gp-features-content-div",this._popupContent.style["min-width"]="200px",i.appendChild(o),i.appendChild(this._popupContent),i.appendChild(s),i}_initContainer(){var e=this._createMainContainerElement(),i=this._createSearchDivElement(),s=this._showSearchEngineButton=this._createShowSearchEnginePictoElement(this.options.collapsible);i.appendChild(s),this.options.collapsible||e.classList.add("gpf-widget-color","gpf-widget-padding");var o=this._inputSearchContainer=this._createSearchInputElement(this.options.placeholder);this.options.displayButtonClose&&o.appendChild(this._createSearchResetElement());var l=this;o.addEventListener?o.addEventListener("click",function(){l.onAutoCompleteInputClick()}):o.attachEvent&&o.attachEvent("onclick",function(){l.onAutoCompleteInputClick()}),i.appendChild(o);var c=this._createButtonsElement(),u=this._createFirstLineWrapper();if(u.appendChild(i),u.appendChild(c),e.appendChild(u),checkDsfr()&&this.options.splitResults){var f=this._createRadioContainer();e.appendChild(f)}if(checkDsfr()&&this.options.splitResults){var g;[g,this._radioButtonLocation,this._radioButtonSuggest]=this._createRadioElements(),f.appendChild(g)}if(this.options.displayButtonGeolocate){var H=this._createShowGeolocateElement();c.appendChild(H)}if(this.options.displayButtonCoordinateSearch||this.options.coordinateSearchInAdvancedSearch){var Y=this._createShowSearchByCoordinateElement();this.options.coordinateSearchInAdvancedSearch||c.appendChild(Y);var ee=this._createCoordinateSearchPanelElement(),te=this._createCoordinateSearchPanelDivElement(),ne=this._createCoordinateSearchPanelHeaderElement(),Ye=this._createCoordinateSearchPanelFormElement(),xe=null;xe=this._containerSystems=this.__createCoordinateSearchDivElement(),Ye.appendChild(xe);var tt=this._createCoordinateSearchSystemsLabelElement(),et=this._setCoordinateSearchSystemsSelectElement(this._coordinateSearchSystems);xe.appendChild(tt),xe.appendChild(et),xe=this._containerUnits=this.__createCoordinateSearchDivElement(),Ye.appendChild(xe);var it=this._createCoordinateSearchUnitsLabelElement(),rt=this._setCoordinateSearchUnitsSelectElement(this._coordinateSearchUnits[this._currentCoordinateSearchType]);xe.appendChild(it),xe.appendChild(rt),xe=this._containerCoordinateLat=this.__createCoordinateSearchDivElement(),Ye.appendChild(xe);var nt=this._setCoordinateSearchLatLabelElement(this._currentCoordinateSearchType),at=this._coordinateSearchLatInput=this._setCoordinateSearchLatInputElement(this._currentCoordinateSearchUnits);xe.appendChild(nt),xe.appendChild(at),xe=this._containerCoordinateLng=this.__createCoordinateSearchDivElement(),Ye.appendChild(xe);var st=this._setCoordinateSearchLngLabelElement(this._currentCoordinateSearchType),ot=this._coordinateSearchLngInput=this._setCoordinateSearchLngInputElement(this._currentCoordinateSearchUnits);xe.appendChild(st),xe.appendChild(ot);var ut=this._createCoordinateSearchSubmitElement();Ye.appendChild(ut),te.appendChild(ne),te.appendChild(Ye),ee.appendChild(te),this.options.coordinateSearchInAdvancedSearch||e.appendChild(ee)}if(this.options.displayButtonAdvancedSearch){var ht=this._showSearchEngineAdvancedButton=this._createShowAdvancedSearchElement();c.appendChild(ht);var dt=this._createAdvancedSearchPanelElement(),pt=this._createAdvancedSearchPanelDivElement(),yt=this._createAdvancedSearchPanelHeaderElement(),mt=this._createAdvancedSearchPanelFormElement(this._advancedSearchCodes,this.options.coordinateSearchInAdvancedSearch),St=this._filterContainer=this._createAdvancedSearchFormFiltersElement();this._setFilter(this._advancedSearchCodes[0].id);var wt=this._createAdvancedSearchFormInputElement();mt.appendChild(St),this.options.coordinateSearchInAdvancedSearch&&mt.appendChild(Ye),mt.appendChild(wt),pt.appendChild(yt),pt.appendChild(mt),dt.appendChild(pt),e.appendChild(dt)}var Rt=this._autocompleteContainer=this._createAutoCompleteElement(),Lt=this._createAutoCompleteListElement(),Gt=this._containerResultsLocation=this._createAutoCompletedLocationContainer(),vt=this._containerResultsSuggest=this._createSearchedSuggestContainer();Lt.appendChild(Gt),Lt.appendChild(vt),Rt.appendChild(Lt),e.appendChild(Rt);var Et=this._createGeocodeResultsElement(),_t=this._createGeocodeResultsDivElement();Et.appendChild(_t);var Ct=this._geocodedContainer=this._createGeocodeResultsListElement();return _t.appendChild(Ct),e.appendChild(Et),e}_setFilter(e){for(var i=this._filterContainer,s=!1,o=0;o<this._advancedSearchCodes.length;o++)if(this._advancedSearchCodes[o].id===e){s=!0;break}if(!s){for(;i.firstChild;)i.removeChild(i.firstChild);return}for(this._currentGeocodingCode=e;i.firstChild;)i.removeChild(i.firstChild);var l=this._advancedSearchFilters[e];if(!(!l||l.length===0)){for(var c=this._createAdvancedSearchFiltersTableElement(e,!0),u=0;u<l.length;u++){var f=this._createAdvancedSearchFiltersAttributElement(l[u]);c.appendChild(f)}return i.appendChild(c),i}}_requestAutoComplete(e){if(!(!e||typeof e=="object"&&Object.keys(e).length===0)&&e.text){logger$w.log(e);var i={};Helper.assign(i,this.options.autocompleteOptions.serviceOptions),Helper.assign(i,e);var s=this.options.resources.autocomplete;s&&Array.isArray(s)&&(i.type||(i.type=s)),i.apiKey=i.apiKey||this.options.apiKey,typeof i.ssl!="boolean"&&(typeof this.options.ssl=="boolean"?i.ssl=this.options.ssl:i.ssl=!0),logger$w.log(i),Gp.Services.autoComplete(i)}}_fillAutoCompletedLocationListContainer(e){if(!(!e||e.length===0)){var i=this._containerResultsLocation;if(i.childElementCount)for(;i.firstChild;)i.removeChild(i.firstChild);if(i.classList.add("GPelementHidden","gpf-hidden"),e.length){(!this._radioButtonLocation||this._radioButtonLocation&&this._radioButtonLocation.checked)&&i.classList.remove("GPelementHidden","gpf-hidden"),this._displaySuggestedLocation(),(!checkDsfr()||!this.options.splitResults)&&this._createAutoCompletedLocationTitleElement();for(var s=0;s<e.length;s++)this._createAutoCompletedLocationElement(e[s],s)}}}_fillSearchedSuggestListContainer(e){this.options.searchOptions.maximumEntries&&(e=e.slice(0,this.options.searchOptions.maximumEntries));var i=this._containerResultsSuggest;if(i.childElementCount)for(;i.firstChild;)i.removeChild(i.firstChild);if(i.classList.add("GPelementHidden","gpf-hidden"),e.length){(!this._radioButtonSuggest||this._radioButtonSuggest&&this._radioButtonSuggest.checked)&&i.classList.remove("GPelementHidden","gpf-hidden"),(!checkDsfr()||!this.options.splitResults)&&this._createSearchedSuggestTitleElement();for(let s=0;s<e.length;s++){const o=e[s];this._createSearchedSuggestElement(o,s)}}}_filterResultsFromConfigLayers(e){if(this.options.searchOptions.filterLayers){var i={};if(this.options.searchOptions.filterLayersList)i=this.options.searchOptions.filterLayersList;else{var s=window.Gp.Config.layers;for(let l in s)s.hasOwnProperty(l)&&(i[s[l].name]=s[l].serviceParams.id.split(":")[1])}let o=e.length;for(;o--;)(!i[e[o].name]||e[o].service.toUpperCase()!==i[e[o].name].toUpperCase())&&e.splice(o,1)}return Search$1.setSuggestions(e),e}_requestGeocoding(e){if(!(!e||typeof e=="object"&&Object.keys(e).length===0)&&e.query!==null){logger$w.log(e);var i={};Helper.assign(i,this.options.geocodeOptions.serviceOptions),Helper.assign(i,e);var s=this,o=this.options.geocodeOptions.serviceOptions.onFailure!==null&&typeof this.options.geocodeOptions.serviceOptions.onFailure=="function",l=this.options.geocodeOptions.serviceOptions.onSuccess!==null&&typeof this.options.geocodeOptions.serviceOptions.onSuccess=="function";if(l){var c=function(g){e.onSuccess.call(s,g),s.options.geocodeOptions.serviceOptions.onSuccess.call(s,g)};i.onSuccess=c}if(o){var u=function(g){e.onFailure.call(s,g),s.options.geocodeOptions.serviceOptions.onFailure.call(s,g)};i.onFailure=u}var f=this.options.resources.geocode;f&&(i.index||(i.index=f)),i.apiKey=i.apiKey||this.options.apiKey,typeof i.ssl!="boolean"&&(typeof this.options.ssl=="boolean"?i.ssl=this.options.ssl:i.ssl=!0),logger$w.log(i),Gp.Services.geocode(i)}}_fillGeocodedLocationListContainer(e){if(!e||e.length===0){this._clearGeocodedLocation();return}var i=this._geocodedContainer;if(i.childElementCount)for(;i.firstChild;)i.removeChild(i.firstChild);for(var s=0;s<e.length;s++)logger$w.log(e[s]),this._createGeocodedLocationElement(e[s],s);this._geocodedLocations=e}_setLabel(e){document.getElementById("GPsearchInputText-"+this._uid).value=e}_setPosition(e,i){var s=this.getMap().getView();s.setCenter(e),s.setZoom(i)}_setPositionFromExtent(e){var i=this.getMap().getView();i.fit(e)}_setMarker(e,i){var s=this.getMap(),o=this;if(this._marker!=null&&(s.removeOverlay(this._marker),this._marker=null),e){var l=document.createElement("img");l.src=this._markerUrl,l.addEventListener?l.addEventListener("click",function(){o._onResultMarkerSelect(i,e)}):l.attachEvent&&l.attachEvent("onclick",function(){o._onResultMarkerSelect(i,e)}),this._marker=new Overlay({position:e,positioning:"center-center",element:l,stopEvent:!1}),s.addOverlay(this._marker)}}_getZoom(e){var i=this.getMap(),s=this.options.zoomTo,o=null;if(typeof s=="function"&&(logger$w.trace("zoom function"),o=s.call(this,e)),typeof s=="number"&&(logger$w.trace("zoom level"),o=s),typeof s=="string")if(s==="auto")logger$w.trace("zoom auto"),o=SearchEngineUtils.zoomToResultsByDefault(e);else{logger$w.trace("zoom level parsing");var l=parseInt(s,10);isNaN(l)||(logger$w.trace("zoom parsing"),o=l)}Number.isInteger=Number.isInteger||function(f){return typeof f=="number"&&isFinite(f)&&Math.floor(f)===f},(!o||o===""||!Number.isInteger(o))&&(logger$w.trace("zoom not found, current zoom..."),o=i.getView().getZoom());var c=i.minZoom,u=i.maxZoom;return o<c&&(logger$w.trace("zoom level min..."),o=c),o>u&&(logger$w.trace("zoom level max..."),o=u),logger$w.trace("zoom",o),o}_onResultMarkerSelect(e,i=null){var s=this.getMap();i&&s.getView().animate({center:i,duration:250});var o="";if(typeof e!="string")if(e.service==="GeocodedLocation"){o="<ul>";var l=e.location.placeAttributes;for(var c in l)l.hasOwnProperty(c)&&c!=="trueGeometry"&&c!=="extraFields"&&c!=="houseNumberInfos"&&c!=="_count"&&(o+="<li>",o+='<span class="gp-attname-others-span">'+c.toUpperCase()+" : </span>",o+=l[c],o+=" </li>");o+=" </ul>"}else e.service==="SuggestedLocation"?o=GeocodeUtils.getSuggestedLocationFreeform(e.location):o="sans informations.";else o=e;this._popupContent.innerHTML=o,this._popupOverlay?this._popupOverlay.setPosition(this._marker.getPosition()):(this._popupOverlay=new Overlay({element:this._popupDiv,positioning:"bottom-center",position:this._marker.getPosition(),offset:[0,-42]}),s.addOverlay(this._popupOverlay))}_setSystem(e){if(typeof e!="object"){logger$w.log("[ERROR] MousePosition:addSystem - system parameter should be an object");return}if(!e.crs){logger$w.error("crs not defined !");return}if(e.label||(logger$w.warn("crs label not defined, use crs code by default."),e.label=e.crs),e.type||(logger$w.warn("type srs not defined, use 'Metric' by default."),e.type="Metric"),CRS.loadByName(e.crs),!get$3(e.crs)){logger$w.error("crs '{}' not available into proj4 definitions !",e.crs);return}for(var i=0;i<this._coordinateSearchSystems.length;i++){var s=this._coordinateSearchSystems[i];e.crs===s.crs&&logger$w.info("crs '{}' already configured",s.crs)}e.code=this._coordinateSearchSystems.length,this._coordinateSearchSystems.push(e)}onShowSearchEngineClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen();var i=this.getMap();Interactions.unset(i);var s=this._showSearchEngineButton.ariaPressed;this.collapsed=s!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position),this.collapsed&&this._clearResults()}onSearchResetClick(){this._clearResults()}onShowSearchGeolocateClick(){"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(e=>{var i=this.getMap().getView(),s=i.getProjection().getCode(),o=[e.coords.longitude,e.coords.latitude],l;if(s!=="EPSG:4326"?l=transform$1(o,"EPSG:4326",s):l=o,isNaN(l[0])||isNaN(l[1])){this._setMarker();return}if(this._setPosition(l,15),this._displayMarker){var c="<h6> Ma position </h6> latitude : "+o[1]+"<br/> longitude : "+o[0];this._setMarker(l,c)}this.dispatchEvent({type:"searchengine:geolocation:click",coordinates:l})})}onShowSearchByCoordinateClick(){var e=null,i=null;if(this._coordinateSearchLngInput&&this._coordinateSearchLngInput.nodeName==="DIV"&&this._coordinateSearchLatInput&&this._coordinateSearchLatInput.nodeName==="DIV"?(e=this._getCoordinateSearchDMS(this._coordinateSearchLngInput),i=this._getCoordinateSearchDMS(this._coordinateSearchLatInput)):(e=this._coordinateSearchLngInput.value,i=this._coordinateSearchLatInput.value),!(!e||!i)){var s=[e,i],o=this.getMap().getView(),l=o.getProjection().getCode();if(l!=="EPSG:4326"&&(s=transform$1(s,"EPSG:4326",l)),isNaN(s[0])||isNaN(s[1])){this._setMarker();return}this._setPosition(s,10),this._displayMarker&&this._setMarker(s,i+", "+e),this.dispatchEvent({type:"searchengine:coordinates:click",coordinates:s})}}_getCoordinateSearchDMS(e){if(e&&e.nodeName==="DIV"){var i=e.querySelectorAll("[name]");if(i){var s=MathUtils.toInteger(i[0].value),o=MathUtils.toInteger(i[1].value),l=MathUtils.toInteger(i[2].value),c=i[3].options[i[3].selectedIndex].text;return!s||!o||!l||!c?void 0:MathUtils.dmsToDecimal(s,o,l,c)}}}onAutoCompleteInputClick(){var e=document.getElementById("GPsearchInputText-"+this._uid);e&&!e.disabled&&e.value.length>2&&this._displaySuggestedLocation()}onAutoCompleteSearchText(e){var i=e.target.value;if(i){if(this._currentGeocodingLocation=i,i.length<3){this._clearSuggestedLocation();return}var s=this.options.autocompleteOptions.triggerGeocode,o=this.options.autocompleteOptions.triggerDelay,l=this.options.autocompleteOptions.maximumEntries,c=this.options.autocompleteOptions.prettifyResults,u=this;this._requestAutoComplete({text:i,onSuccess:function(g){if(logger$w.log("request from AutoComplete",g),g){u._suggestedLocations=g.suggestedLocations,u._locationsToBeDisplayed=[];for(var H=0;H<u._suggestedLocations.length;H++){var Y=u._suggestedLocations[H];Y.position&&Y.position.x===0&&Y.position.y===0&&Y.fullText?u._getGeocodeCoordinatesFromFullText(Y,H):u._locationsToBeDisplayed.push(Y)}c===!0&&u._prettifyAutocompleteResults(u._locationsToBeDisplayed),l&&(u._locationsToBeDisplayed=u._locationsToBeDisplayed.slice(0,l)),u._fillAutoCompletedLocationListContainer(u._locationsToBeDisplayed),u._triggerHandler&&(clearTimeout(u._triggerHandler),u._triggerHandler=null,logger$w.warn("Cancel a geocode request !"))}},onFailure:function(g){u._clearSuggestedLocation(),logger$w.log(g.message),g.message==="No suggestion matching the search"&&s&&(u._triggerHandler&&(clearTimeout(u._triggerHandler),logger$w.warn("Cancel the last geocode request !")),u._triggerHandler=setTimeout(function(){logger$w.warn("Launch a geocode request !"),u._requestGeocoding({location:i,onSuccess:function(H){if(logger$w.log("request from Geocoding",H),H){u._locationsToBeDisplayed=[];for(var Y=H.locations,ee=0;ee<Y.length;ee++){var te=Y[ee];te.fullText=GeocodeUtils.getGeocodedLocationFreeform(te),te.position={x:te.position.lon,y:te.position.lat},u._locationsToBeDisplayed.push(te)}u._fillAutoCompletedLocationListContainer(Y)}},onFailure:function(H){logger$w.log(H.message)}})},o))}}),this.options.resources.search&&Search$1.suggest(i);var u=this,f=this.getMap();f.once("click",function(){u._hideSuggestedLocation()}),f.once("pointerdrag",function(){u._hideSuggestedLocation()})}}_getGeocodeCoordinatesFromFullText(e,i){var s=this;Gp.Services.geocode({apiKey:this.options.apiKey,ssl:this.options.ssl,q:GeocodeUtils.getSuggestedLocationFreeform(e),index:e.type,onSuccess:function(o){logger$w.log("request from Geocoding (coordinates null)",o),o.locations&&o.locations.length!==0&&o.locations[0].position&&s._suggestedLocations&&s._suggestedLocations[i]&&(s._suggestedLocations[i].position={lon:o.locations[0].position.y,lat:o.locations[0].position.x},s._locationsToBeDisplayed.unshift(s._suggestedLocations[i]),s._fillAutoCompletedLocationListContainer(s._locationsToBeDisplayed))},onFailure:function(){s._suggestedLocations&&s._suggestedLocations[i]&&s._createAutoCompletedLocationElement(s._suggestedLocations[i],i)}})}onAutoCompletedResultsItemClick(e){var i=SelectorID.index(e.target.id);if(logger$w.log(i),logger$w.log(this._locationsToBeDisplayed[i]),!!i){var s=[this._locationsToBeDisplayed[i].position.x,this._locationsToBeDisplayed[i].position.y],o={service:"SuggestedLocation",location:this._locationsToBeDisplayed[i]},l=GeocodeUtils.getSuggestedLocationFreeform(this._locationsToBeDisplayed[i]);this._setLabel(l),this._currentGeocodingLocation=l;var c=this.getMap().getView(),u=c.getProjection().getCode();u!=="EPSG:4326"&&(s=transform$1(s,"EPSG:4326",u)),this._requestGeocoding({index:"address,poi",limit:1,returnTrueGeometry:!0,location:l,onSuccess:f=>{if(f.locations[0].placeAttributes.truegeometry){var g=JSON.parse(f.locations[0].placeAttributes.truegeometry);if(g.type==="Point")this._setPosition(s,15);else{var H=new GeoJSON$1,Y=H.readGeometry(g,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}),ee=Y.getExtent();this._setPositionFromExtent(ee)}}else this._setPosition(s,15);this._displayMarker&&this._setMarker(s,o);var te=document.getElementById(this._addUID("GPautocompleteResults"));if(te){var ne=te.getElementsByClassName("GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine");for(let xe=0;xe<ne.length;xe++){const tt=ne[xe];tt.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine"}var Ye=ne[i];Ye.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine current",this.dispatchEvent({type:"searchengine:autocomplete:click",location:this._locationsToBeDisplayed[i]})}},onFailure:f=>{logger$w.warn(f);var g=this._getZoom(o);this._setPosition(s,g),this._displayMarker&&this._setMarker(s,o);var H=document.getElementById(this._addUID("GPautocompleteResults"));if(H){var Y=H.getElementsByClassName("GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine");for(let te=0;te<Y.length;te++){const ne=Y[te];ne.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine"}var ee=Y[i];ee.className="GPautoCompleteProposal gpf-panel__items gpf-panel__items_searchengine current",this.dispatchEvent({type:"searchengine:autocomplete:click",location:this._locationsToBeDisplayed[i]})}}})}}onSearchedResultsItemClick(e){var i=SelectorID.index(e.target.id),s=null;try{var o=Search$1.getSuggestions()[i];if(!o)throw"No suggestions found !";if(this.options.searchOptions.addToMap){if(!Config.isConfigLoaded())throw"ERROR : contract key configuration has to be loaded to load Geoportal layers.";var l=o.service,c=o.name,u=null;switch(l){case"WMS":u=new LayerWMS({layer:c});break;case"WMTS":u=new LayerWMTS({layer:c});break;case"WFS":u=new LayerWFS({layer:c});break;case"TMS":u=new LayerMapBox({layer:c},{declutter:!0});default:break}if(u){var f=this.getMap();f.addLayer(u)}}}catch(g){s=g}this.dispatchEvent({type:"searchengine:search:click",suggest:o,error:s})}onGeocodingSearchSubmit(e){var i=e.target[0].value;if(i){this._currentGeocodingLocation=i;var s=this;this._requestGeocoding({query:i,onSuccess:function(o){if(logger$w.log("request from Geocoding",o),o){var l=o.locations;s._fillGeocodedLocationListContainer(l)}},onFailure:function(o){s._clearGeocodedLocation(),logger$w.log(o.message)}})}}onGeocodedResultsItemClick(e){var i=SelectorID.index(e.target.id);if(i){var s=[this._geocodedLocations[i].position.lon,this._geocodedLocations[i].position.lat],o={service:"GeocodedLocation",location:this._geocodedLocations[i]},l=GeocodeUtils.getGeocodedLocationFreeform(this._geocodedLocations[i]);this._setLabel(l);var c=this.getMap().getView(),u=c.getProjection().getCode();u!=="EPSG:4326"&&(s=transform$1(s,"EPSG:4326",u));var f=this._getZoom(this.options.zoomTo);this._setPosition(s,f),this._displayMarker&&this._setMarker(s,o),this.dispatchEvent({type:"searchengine:geocode:click",location:this._geocodedLocations[i]}),this._clearSuggestedLocation(),this._showSearchEngineAdvancedButton.click()}}onGeocodingAdvancedSearchCodeChange(e){logger$w.log(e);var i=e.target.selectedIndex,s=e.target.options[i].value;s&&this._setFilter(s)}onGeocodingAdvancedSearchSubmit(e,i){if(logger$w.log(i),!(!i||i.length===0)){for(var s,o={},l=0;l<i.length;l++){var c=i[l];c.value&&(c.key==="section"&&(c.value=c.value.toUpperCase()),o[c.key]=c.value)}var u=document.getElementById("GPsearchInputText-"+this._uid);s=u.value,this._currentGeocodingCode==="CadastralParcel"&&(s=""),this._currentGeocodingCode==="StreetAddress"&&(s=`${o.address} ${o.postcode} ${o.city}`,o={}),this._currentGeocodingCode==="PositionOfInterest"&&(s=o.q,delete o.q);var f=this;this._requestGeocoding({query:s,index:this._currentGeocodingCode,filters:o,onSuccess:function(g){if(logger$w.log(g),g){var H=g.locations;f._fillGeocodedLocationListContainer(H)}},onFailure:function(g){f._clearGeocodedLocation(),logger$w.log(g.message)}})}}_getCadastralParcelRequestParams(e){var i="",s,o=e.department;o?(s=o.length,s===2?i=o:s===1?i="0"+o:i=o.substring(0,2)):i="__";var l=e.commune;l?(s=l.length,s===3?i+=l:s===2?i+="_"+l:s===1?i+="__"+l:i+=l.substring(0,3)):i+="___";var c=e.insee;c&&c.length===5&&(i=c);var u=e.absorbedCity;u?(s=u.length,s===3?i+=u:s<3?s===2?i+="_"+u:s===1&&(i+="__"+u):i+=u.substring(0,3)):i+="___";var f=e.section;f?(s=f.length,s===2?i+=f:s===1?i+="_"+f:i+=f.substring(0,2)):i+="__";var g=e.number;return g?(s=g.length,s===4?i+=g:s===3?i+="_"+g:s===2?i+="__"+g:s===1?i+="___"+g:i+=g.substring(0,4)):i+="___",logger$w.log("location : "+i),i}onCoordinateSearchSystemChange(e){var i=e.target.selectedIndex,s=e.target.options[i].value;this._coordinateSearchLngInput.value="",this._coordinateSearchLatInput.value="";for(var o=null,l=0;l<this._coordinateSearchSystems.length;++l)if(this._coordinateSearchSystems[l].code===Number(s)){o=this._coordinateSearchSystems[l].type;break}if(!o){logger$w.log("system not found in projection systems container");return}this._currentCoordinateSearchSystems=this._coordinateSearchSystems[Number(s)],o!==this._currentCoordinateSearchType&&(this._currentCoordinateSearchType=o,this._currentCoordinateSearchUnits=this._coordinateSearchUnits[o][0].code,this._containerUnits.appendChild(this._setCoordinateSearchUnitsSelectElement(this._coordinateSearchUnits[o])),this._updateCoordinateSearchElements())}onCoordinateSearchUnitsChange(e){var i=e.target.selectedIndex,s=e.target.options[i].value;this._coordinateSearchLngInput.value="",this._coordinateSearchLatInput.value="",this._currentCoordinateSearchUnits=s,this._updateCoordinateSearchElements()}onCoordinateSearchClose(){this._setMarker(),this._coordinateSearchLngInput.value="",this._coordinateSearchLatInput.value=""}_updateCoordinateSearchElements(){var e=this._setCoordinateSearchLngLabelElement(this._currentCoordinateSearchType),i=this._coordinateSearchLngInput=this._setCoordinateSearchLngInputElement(this._currentCoordinateSearchUnits);this._containerCoordinateLng.appendChild(e),this._containerCoordinateLng.appendChild(i),e=this._setCoordinateSearchLatLabelElement(this._currentCoordinateSearchType),i=this._coordinateSearchLatInput=this._setCoordinateSearchLatInputElement(this._currentCoordinateSearchUnits),this._containerCoordinateLat.appendChild(e),this._containerCoordinateLat.appendChild(i)}_clearResults(){var e=this.getMap();this._currentGeocodingLocation=null,this._clearSuggestedLocation(),this._clearGeocodedLocation(),this._setMarker(),this._popupOverlay!=null&&(e.removeOverlay(this._popupOverlay),this._popupOverlay=null)}_clearSuggestedLocation(){if(this._suggestedLocations=[],this._containerResultsLocation)for(;this._containerResultsLocation.firstChild;)this._containerResultsLocation.removeChild(this._containerResultsLocation.firstChild);if(this.options.resources.search&&(Search$1.clear(),this._containerResultsSuggest))for(;this._containerResultsSuggest.firstChild;)this._containerResultsSuggest.removeChild(this._containerResultsSuggest.firstChild)}_prettifyAutocompleteResults(e){for(var i=e.length-1;i>=0;i--){var s=e[i];(s.type==="StreetAddress"&&s.kind==="municipality"||s.type==="PositionOfInterest"&&s.poiType[0]==="lieu-dit habit"&&s.poiType[1]==="zone d'habitation")&&e.splice(i,1),s.type==="PositionOfInterest"&&s.poiType[0]==="administratif"&&(s.poiType[1]==="dpartement"||s.poiType[1]==="rgion")&&(s.fullText=s.fullText+", "+s.poiType[1])}}_hideSuggestedLocation(){this._autocompleteContainer&&(this._autocompleteContainer.classList.replace("GPelementVisible","GPelementHidden"),this._autocompleteContainer.classList.replace("gpf-visible","gpf-hidden"))}_displaySuggestedLocation(){this._autocompleteContainer&&(this._autocompleteContainer.classList.replace("GPelementHidden","GPelementVisible"),this._autocompleteContainer.classList.replace("gpf-hidden","gpf-visible"))}_clearGeocodedLocation(){if(this._geocodedLocations=[],this._geocodedContainer)for(;this._geocodedContainer.firstChild;)this._geocodedContainer.removeChild(this._geocodedContainer.firstChild)}}Object.assign(SearchEngine.prototype,SearchEngineDOM);Object.assign(SearchEngine.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.SearchEngine=SearchEngine);const stringToHTML$3=n=>{var e=function(){if(!window.DOMParser)return!1;var l=new DOMParser;try{l.parseFromString("x","text/html")}catch{return!1}return!0};if(e()){var i=new DOMParser,s=i.parseFromString(n,"text/html");return s.body}var o=document.createElement("div");return o.innerHTML=n,o};var MousePositionDOM={_addUID:function(n){var e=this._uid?n+"-"+this._uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPmousePosition"),n.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",n},_createShowMousePositionPictoElement:function(n){var e=this,i=document.createElement("button"),s=document.createElement("span");return i.appendChild(s),i.id=this._addUID("GPshowMousePositionPicto"),i.className="GPshowOpen GPshowAdvancedToolPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-position fr-btn fr-btn--tertiary",i.setAttribute("aria-label","Afficher les coordonnes du curseur"),i.setAttribute("tabindex","0"),i.setAttribute("aria-pressed",!1),i.setAttribute("type","button"),i.addEventListener?i.addEventListener("click",function(o){var l=o.target.ariaPressed==="true";o.target.setAttribute("aria-pressed",!l),e.onShowMousePositionClick(o)}):i.attachEvent&&i.attachEvent("onclick",function(o){var l=o.target.ariaPressed==="true";o.target.setAttribute("aria-pressed",!l),e.onShowMousePositionClick(o)}),i},_createMousePositionPanelElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPmousePositionPanel"),n.className="GPpanel gpf-panel fr-modal",n},_createMousePositionPanelDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__body fr-modal__body",n},_createMapCenter:function(){var n=document.createElement("div");return n.id="GPmapCenter",n.className="",n},_createMousePositionPanelTitleElement:function(){var n=document.createElement("div");return n.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",n.id=this._addUID("GPmousePositionHeaderTitle"),n.innerHTML="Coordonnes",n},_createMousePositionPanelHeaderElement:function(){var n=document.createElement("div");return n.className="GPpanelHeader gpf-panel__header fr-modal__header",n},_createMousePositionPanelCloseElement:function(){var n=this,e=document.createElement("button");e.id=this._addUID("GPmousePositionPanelClose"),e.className="GPpanelClose gpf-btn gpf-btn-icon-close  fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",e.title="Fermer le panneau",e.addEventListener?(e.addEventListener("click",function(){document.getElementById(n._addUID("GPshowMousePositionPicto")).click()},!1),e.addEventListener("keydown",function(s){s.keyCode===13&&document.getElementById(n._addUID("GPshowMousePositionPicto")).click()},!1)):e.attachEvent&&(e.attachEvent("onclick",function(){document.getElementById(n._addUID("GPshowMousePositionPicto")).click()}),e.attachEvent("onkeydown",function(s){s.keyCode===13&&document.getElementById(n._addUID("GPshowMousePositionPicto")).click()}));var i=document.createElement("span");return i.className="GPelementHidden gpf-visible",i.innerText="Fermer",e.appendChild(i),e},_createMousePositionPanelBasicElement:function(n,e,i,s){n=typeof n>"u"?!0:n,e=typeof e>"u"?!0:e,i=typeof i>"u"?!1:i;var o=document.createElement("div");return o.id=this._addUID("GPmousePositionBasicPanel"),o.classList.add("fr-mx-1w"),o.appendChild(this._createMousePositionPanelBasicCoordinateElement(e,i,s)),o.appendChild(this._createMousePositionPanelEditToolsElement(i)),o.appendChild(this._createMousePositionPanelBasicAltitudeElement(n)),o},_createCoordinateElement:function(n,e){var i=this;if(["Lon","Lat"].indexOf(n)===-1)return[];var s=[],o=document.createElement("input");o.id=this._addUID("GPmousePosition"+n),o.title=e===!0?"Cliquer pour saisir des coordonnes":"",o.readOnly=!0,e&&(o.addEventListener("click",function(){i.onMousePositionEditModeClick(!0)}),o.addEventListener("change",function(c){this.classList.remove("error");var u=i.validateExtentCoordinate(n,this.value,c);u?this.classList.remove("error"):this.classList.add("error")})),s.push(o);var l=document.createElement("span");return l.className="GPmousePositionUnits",s.push(l),s},_createDMSCoordinateElement:function(n,e){if(["Lon","Lat"].indexOf(n)===-1)return[];var i=this,s=[],o=document.createElement("input");o.id=this._addUID("GPmousePosition"+n+"Degrees"),o.className="GPSexagesimal",o.setAttribute("name","degrees"),o.title=e===!0?"Cliquer pour saisir des coordonnes":"",o.readOnly=!0,o.dataset.min=0,o.dataset.max=n==="Lon"?180:90,e&&(o.addEventListener("click",function(){i.onMousePositionEditModeClick(!0)}),o.addEventListener("change",function(){this.classList.remove("error");var te=i._checkDMSDegrees(n,this);te?this.classList.remove("error"):this.classList.add("error")})),s.push(o);var l=document.createElement("span");l.className="GPmousePositionSexagesimalLabel",l.innerHTML="",s.push(l);var c=document.createElement("input");c.id=this._addUID("GPmousePosition"+n+"Minutes"),c.className="GPSexagesimal",c.setAttribute("name","minutes"),c.title=e===!0?"Cliquer pour saisir des coordonnes":"",c.readOnly=!0,c.dataset.min=0,c.dataset.max=59,e&&(c.addEventListener("click",function(){i.onMousePositionEditModeClick(!0)}),c.addEventListener("change",function(){this.classList.remove("error");var te=i._checkDMSElement(this);te?this.classList.remove("error"):this.classList.add("error")})),s.push(c);var u=document.createElement("span");u.className="GPmousePositionSexagesimalLabel",u.innerHTML="'",s.push(u);var f=document.createElement("input");f.id=this._addUID("GPmousePosition"+n+"Seconds"),f.className="GPSexagesimalsec",f.setAttribute("name","seconds"),f.title=e===!0?"Cliquer pour saisir des coordonnes":"",f.readOnly=!0,f.dataset.min=0,f.dataset.max=59,e&&(f.addEventListener("click",function(){i.onMousePositionEditModeClick(!0)}),f.addEventListener("change",function(){this.classList.remove("error");var te=i._checkDMSElement(this,!0);te?this.classList.remove("error"):this.classList.add("error")})),s.push(f);var g=document.createElement("span");g.className="GPmousePositionSexagesimalLabel",g.innerHTML="''",s.push(g);var H=document.createElement("select");H.id=this._addUID("GPmousePosition"+n+"Direction"),H.className="GPmousePositionDirection",H.setAttribute("name","direction"),H.disabled=!0;var Y=document.createElement("option");Y.value=n==="Lon"?"E":"N",Y.innerHTML=n==="Lon"?"E":"N",H.appendChild(Y);var ee=document.createElement("option");return ee.value=n==="Lon"?"O":"S",ee.innerHTML=n==="Lon"?"O":"S",H.appendChild(ee),s.push(H),s},_createMousePositionPanelBasicCoordinateElement:function(n,e,i){var s=document.createElement("div");s.id=this._addUID("GPmousePositionCoordinate"),s.style.display=n?"block":"none";var o=document.createElement("div"),l=document.createElement("span");l.className="GPmousePositionLabel",l.id=this._addUID("GPmousePositionLatLabel"),l.innerHTML="Latitude : ",o.appendChild(l);var c=document.createElement("span");c.id=this._addUID("GPmousePositionLatCoordinate");var u;i==="DMS"?u=this._createDMSCoordinateElement("Lat",e):u=this._createCoordinateElement("Lat",e);for(var f=0;f<u.length;f++)c.appendChild(u[f]);o.appendChild(c),s.appendChild(o);var g=document.createElement("div"),H=document.createElement("span");H.className="GPmousePositionLabel",H.id=this._addUID("GPmousePositionLonLabel"),H.innerHTML="Longitude : ",g.appendChild(H);var Y=document.createElement("span");Y.id=this._addUID("GPmousePositionLonCoordinate");var ee;i==="DMS"?ee=this._createDMSCoordinateElement("Lon",e):ee=this._createCoordinateElement("Lon",e);for(var te=0;te<ee.length;te++)Y.appendChild(ee[te]);return g.appendChild(Y),s.appendChild(g),s},_createMousePositionPanelBasicAltitudeElement:function(n){var e=document.createElement("div");e.id=this._addUID("GPmousePositionAltitude"),e.style.display=n?"block":"none";var i=document.createElement("span");i.className="GPmousePositionLabel",i.innerHTML="Altitude : ",e.appendChild(i);var s=document.createElement("span");s.className="GPmousePositionCoords",s.id=this._addUID("GPmousePositionAlt"),s.innerHTML="...",e.appendChild(s);var o=document.createElement("span");return o.className="GPmousePositionAltitudeUnits",o.innerHTML="m",e.appendChild(o),e},_createMousePositionPanelEditToolsElement:function(n){var e=this,i=document.createElement("div");i.className="GPmousePositionPanelEditTools",i.id=this._addUID("GPmousePositionPanelEditTools"),n||(i.style.display="none");var s=document.createElement("span");s.className="GPmousePositionEditTool gpf-btn gpf-btn-icon gpf-btn-icon-mp-edit fr-btn fr-btn--tertiary gpf-btn--tertiary",s.id=this._addUID("GPmousePositionLocate"),s.title=n===!0?"Cliquer pour saisir des coordonnes":"",n&&s.addEventListener("click",function(){e.onMousePositionEditModeLocateClick()}),i.appendChild(s);var o=document.createElement("span");return o.className="GPmousePositionEditTool gpf-btn gpf-btn-icon gpf-btn-icon-mp-edit-close fr-btn fr-btn--tertiary gpf-btn--tertiary",o.id=this._addUID("GPmousePositionCloseEdit"),o.title="Quitter la saisie des coordonnes",o.style.display="none",n&&o.addEventListener("click",function(){e.onMousePositionEditModeClick(!1)}),i.appendChild(o),i},_createShowMousePositionSettingsElement:function(n){var e=this,i=document.createElement("button");return i.id=this._addUID("GPshowMousePositionSettings"),i.className="GPelementHidden GPshowAdvancedToolPicto GPshowMoreOptionsImage GPshowMoreOptions GPshowMousePositionSettingsPicto gpf-hidden gpf-btn fr-btn--sm fr-btn--tertiary gpf-btn--tertiary fr-icon-arrow-down-fill",i.title="Rglages",i.setAttribute("tabindex","0"),i.setAttribute("aria-pressed",!0),i.addEventListener?i.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),e.onShowMousePositionSettingsClick(s)}):i.attachEvent&&i.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),e.onShowMousePositionSettingsClick(s)}),i},_createMousePositionSettingsElement:function(n){var e=document.createElement("div");e.id=this._addUID("GPmousePositionSettings"),e.style.display=n===void 0||n?"block":"none",e.classList.add("fr-m-1w");var i=document.createElement("span");return i.className="GPmousePositionSettingsLabel",e.appendChild(i),e},_createMousePositionSettingsAccordion:function(n){var e=stringToHTML$3(`
                <section class="fr-accordion">
                               <div class="fr-accordion__title GPmousePositionSettingsLabel">
                                   <button type="button" class="fr-accordion__btn" aria-expanded="false" aria-controls="accordion-more-settings-1">
                                       <span class="GPshowMousePositionAdvancedTools gpf-hidden"></span>Systme de rfrence
                                   </button>
                               </div>
                               <div class="fr-collapse GPelementHidden" id="accordion-more-settings-1">
                               </div>
                    </section>
           `);return n.map(i=>e.getElementsByClassName("fr-collapse")[0].append(i)),e.getElementsByTagName("button")[0].addEventListener("click",function(i){var s=i.target.ariaExpanded==="true";i.target.setAttribute("aria-expanded",!s),s?(e.getElementsByClassName("fr-collapse")[0].classList.remove("fr-collapse--expanded"),e.getElementsByClassName("fr-collapse")[0].classList.add("GPelementHidden")):(e.getElementsByClassName("fr-collapse")[0].classList.add("fr-collapse--expanded"),e.getElementsByClassName("fr-collapse")[0].classList.remove("GPelementHidden"))}),e},_createMousePositionSettingsSystemsElement:function(n){var e=this,i=document.createElement("select");i.id=this._addUID("GPmousePositionProjectionSystem"),i.className="GPselect GPmousePositionSettingsSelect gpf-select fr-select fr-my-1w",i.addEventListener("change",function(c){e.onMousePositionProjectionSystemChange(c)}),i.addEventListener("mouseover",function(c){c.target.nodeName!=="OPTION"&&e.onMousePositionProjectionSystemMouseOver(c)}),i.title="Type de systme";for(var s=0;s<n.length;s++){var o=n[s],l=document.createElement("option");l.value=o.code,l.text=o.label||s,i.appendChild(l)}return i},_createMousePositionSettingsUnitsElement:function(n){var e=this,i=document.createElement("select");i.id=this._addUID("GPmousePositionProjectionUnits"),i.className="GPselect GPmousePositionSettingsSelect gpf-select fr-select",i.addEventListener("change",function(c){e.onMousePositionProjectionUnitsChange(c)}),i.title="Units du systme";for(var s=0;s<n.length;s++){var o=n[s],l=document.createElement("option");l.value=o.code?o.code:s,l.text=o.label||s,i.appendChild(l)}return i},_resetLabelElements:function(n){var e=document.getElementById(this._addUID("GPmousePositionLatLabel"));e.innerHTML=n==="Geographical"?"Latitude :":"X :";var i=document.getElementById(this._addUID("GPmousePositionLonLabel"));i.innerHTML=n==="Geographical"?"Longitude :":"Y :"},_resetUnitElements:function(n){var e="";(n==="M"||n==="KM")&&(e=n.toLowerCase());for(var i=document.getElementsByClassName("GPmousePositionUnits"),s=0;s<i.length;s++)i[s].innerHTML=e},_resetCoordinateElements:function(n,e,i){for(var s=document.getElementById(this._addUID("GPmousePositionLatCoordinate"));s.firstChild;)s.removeChild(s.firstChild);var o;i==="DMS"?o=this._createDMSCoordinateElement("Lat",n):o=this._createCoordinateElement("Lat",n);for(var l=0;l<o.length;l++)s.appendChild(o[l]);for(var c=document.getElementById(this._addUID("GPmousePositionLonCoordinate"));c.firstChild;)c.removeChild(c.firstChild);var u;i==="DMS"?u=this._createDMSCoordinateElement("Lon",n):u=this._createCoordinateElement("Lon",n);for(var f=0;f<u.length;f++)c.appendChild(u[f])},_setEditMode:function(n){var e=document.getElementById(this._addUID("GPmousePositionLocate"));e.title=n?"Aller  la position ...":"Cliquer pour saisir des coordonnes";var i=document.getElementById(this._addUID("GPmousePositionCloseEdit"));i.style.display=n?"inline-block":"none",n===!0?(e.classList.remove("gpf-btn-icon-mp-edit"),e.classList.add("gpf-btn-icon-mp-edit-center"),document.getElementById(this._addUID("GPmousePositionLat")).focus()):(e.classList.remove("gpf-btn-icon-mp-edit-center"),e.classList.add("gpf-btn-icon-mp-edit"));for(var s="div[id^="+this._addUID("GPmousePositionCoordinate")+"]",o=document.querySelectorAll(s+" input"),l=0;l<o.length;l++)o[l].readOnly=!n,n&&o[l].classList.remove("error");for(var c=document.querySelectorAll(s+" select"),u=0;u<c.length;u++)c[u].disabled=!n},_checkDMSElement:function(n,e){var i=e!==void 0,s=n.value;if(i&&(s=s.replace(",",".")),isNaN(s))return!1;var o=parseFloat(s);if(!i&&(o|0)!==o)return!1;var l=Number(n.dataset.min),c=Number(n.dataset.max);return o>=l&&o<=c},_checkDMSDegrees:function(n,e){if(isNaN(e.value))return!1;var i=parseFloat(e.value);if((i|0)!==i)return!1;var s=Number(e.dataset.min),o=Number(e.dataset.max);if(i<s||i>o)return!1;var l=document.getElementById(this._addUID("GPmousePosition"+n+"Minutes")),c=document.getElementById(this._addUID("GPmousePosition"+n+"Seconds"));return i>=o?(l.dataset.max=0,c.dataset.max=0):(l.dataset.max=59,c.dataset.max=59.9999),!0},GPdisplayCoords:function(n){if(n){var e=document.getElementById(this._addUID("GPmousePositionLonLabel")),i=document.getElementById(this._addUID("GPmousePositionLatLabel"));if(n.x||n.y?(i.innerHTML="X : ",e.innerHTML="Y : "):n.e||n.n?(i.innerHTML="E : ",e.innerHTML="N : "):(i.innerHTML="Latitude : ",e.innerHTML="Longitude : "),typeof n.lat=="object"&&typeof n.lng=="object"){var s={lng:"Lon",lat:"Lat"},o=["Degrees","Minutes","Seconds"];for(var l in s)for(var c=0;c<o.length;++c){var u="GPmousePosition"+s[l]+o[c],f=document.getElementById(this._addUID(u)),g=o[c].charAt(0).toLowerCase();f.value=n[l][g]}document.getElementById(this._addUID("GPmousePositionLonDirection")).value=n.lng.direction,document.getElementById(this._addUID("GPmousePositionLatDirection")).value=n.lat.direction}else{var H=document.getElementById(this._addUID("GPmousePositionLat")),Y=document.getElementById(this._addUID("GPmousePositionLon"));H.value=n.x||n.lat||n.e||"0",Y.value=n.y||n.lng||n.lon||n.n||"0",H.title="Latitude",Y.title="Longitude",H.type="text",Y.type="text";for(var ee=n.unit===void 0?"":n.unit,te=document.getElementsByClassName("GPmousePositionUnits"),ne=0;ne<te.length;++ne)te[ne].innerHTML=ee}}},GPdisplayElevation:function(n,e,i,s){var o=this,l;e||(e=500),clearTimeout(l),document.getElementById(this._addUID("GPmousePositionAlt")).innerHTML="...",i==null&&(i=-99999),s==null&&(s=99980);var c=i+s,u=i-s;n&&document.getElementById(this._addUID("GPmousePositionAltitude"))&&(l=setTimeout(function(){o.onRequestAltitude(n,function(f){u<f&&f<c?o.GPresetElevation():document.getElementById(o._addUID("GPmousePositionAlt")).innerHTML=f})},e))},GPresetElevation:function(){document.getElementById(this._addUID("GPmousePositionAltitude"))&&(document.getElementById(this._addUID("GPmousePositionAlt")).innerHTML="---")}},logger$v=LoggerByDefault.getLogger("GeoportalMousePosition");class MousePosition extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof MousePosition))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="MousePosition",this._initialize(e),this.container=this._initContainer(this.options),this.element?this.element.appendChild(this.container):this.element=this.container,this}setMap(e){var i=this;if(e){var s=this._createMapCenter();if(e.getViewport().appendChild(s),!this.collapsed&&!this._isDesktop&&(s.className="GPmapCenterVisible"),this.draggable&&Draggable.dragElement(this._panelMousePositionContainer,this._panelHeaderContainer,e.getTargetElement()),this.collapsed||(this._isDesktop?this.listenerKey=e.on("pointermove",c=>{this.onMouseMove(c)}):this.listenerKey=e.on("moveend",c=>this.onMapMove(c)),this._showMousePositionButton.setAttribute("aria-pressed",!0)),this.options.editCoordinates){var o=document.createElement("img");o.id=this._addUID("GPmousePositionMarker"),o.src=this._markerUrl,o.title="Cliquer pour supprimer",o.addEventListener("click",function(){i._markerOverlay.setPosition(void 0)}),this._markerOverlay=new Overlay({offset:this._markerOffset,element:o,stopEvent:!1}),e.addOverlay(this._markerOverlay)}}else unByKey(this.listenerKey);if(super.setMap(e),e!==null&&(this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter"),!this.collapsed)){var l=document.getElementById("GPshowMousePosition-"+this._uid);l.checked="checked",this._setElevationPanel(this.options.displayAltitude),this._setCoordinatesPanel(this.options.displayCoordinates),this.options.displayCoordinates||this._setSettingsPanel(!1)}}addSystem(e){if(typeof e!="object"){logger$v.log("[ERROR] MousePosition:addSystem - system parameter should be an object");return}if(!e.crs){logger$v.error("crs not defined !");return}if(e.label||(logger$v.warn("crs label not defined, use crs code by default."),e.label=e.crs),e.type||(logger$v.warn("type srs not defined, use 'Metric' by default."),e.type="Metric"),CRS.loadByName(e.crs),!get$3(e.crs)){logger$v.error("crs '{}' not available into proj4 definitions !",e.crs);return}for(var i=0;i<this._projectionSystems.length;i++){var s=this._projectionSystems[i];e.crs===s.crs&&logger$v.info("crs '{}' already configured",s.crs)}e.code=this._projectionSystems.length,this._projectionSystems.push(e);var o=document.getElementById("GPmousePositionProjectionSystem-"+this._uid);if(o){var l=document.createElement("option");l.value=e.code,l.text=e.label,o.appendChild(l)}}addSystems(e){if(e){if(!Array.isArray(e)){logger$v.log("[ERROR] MousePosition:addSystems - systems parameter should be an array");return}for(var i=0;i<e.length;i++)this.addSystem(e[i])}}removeSystem(e){if(!e||typeof e!="string"){logger$v.log("[ERROR] MousePosition:removeSystem - systemCode parameter should be a string");return}for(var i=document.getElementById("GPmousePositionProjectionSystem-"+this._uid),s=null,o=0;o<this._projectionSystems.length;o++){var l=this._projectionSystems[o];if(e===l.crs){s=l.code,this._projectionSystems.splice(o,1);break}}if(s==null){logger$v.log("[WARN] MousePosition:removeSystem - system not found");return}for(var c=[],u=0;u<this._projectionSystems.length;u++)c[Number(this._projectionSystems[u].code)]=u,this._projectionSystems[u].code=u;for(var f=null,g=0;g<i.childNodes.length;g++){if(s===i.childNodes[u].value){f=g;continue}i.childNodes[u].value=c[Number(i.childNodes[u].value)]}f!=null&&i.removeChild(i.childNodes[f]),this._currentProjectionSystems.code===Number(s)&&(i.childNodes[0].setAttribute("selected","selected"),this._setCurrentSystem(i.childNodes[0].value))}setUnits(e){!e||!Array.isArray(e)||(this.options.units=e,this._projectionUnits=[],this._initProjectionUnits(),this._currentProjectionType&&this._setTypeUnitsPanel(this._currentProjectionType))}setAltitudeOptions(e){if(!(!e||typeof e!="object")&&(this.options.altitude.triggerDelay=e.triggerDelay,this.options.altitude.responseDelay=e.responseDelay,e.serviceOptions))for(var i in e.serviceOptions)e.serviceOptions.hasOwnProperty(i)&&(this.options.altitude.serviceOptions[i]=e.serviceOptions[i])}displayAltitude(e){e!==void 0&&(this.options.displayAltitude=e,this._setElevationPanel(e))}displayCoordinates(e){e!==void 0&&(this.options.displayCoordinates=e,this._setCoordinatesPanel(e),this._setSettingsPanel(e))}setCollapsed(e){if(e===void 0){logger$v.log("[ERROR] MousePosition:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(this._isDesktop||(document.getElementById("GPmapCenter").className=e?"":"GPmapCenterVisible"),this.onShowMousePositionClick(),this._showMousePositionContainer.checked=!e)}getContainer(){return this.container}_initialize(e){if(e=e||{},this.options=e,this.options.collapsed=e.collapsed!==void 0?e.collapsed:!0,this.collapsed=this.options.collapsed,this.options.draggable=e.draggable!==void 0?e.draggable:!1,this.draggable=this.options.draggable,this._markerOverlay=null,this._markerUrl=null,this._markerOffset=[0,0],this._hideMarker=!1,this._initMarker(e.positionMarker),this.options.units=e.units||[],this.options.displayAltitude=e.displayAltitude!==void 0?e.displayAltitude:!0,this.options.displayCoordinates=e.displayCoordinates!==void 0?e.displayCoordinates:!0,this.options.displayCoordinates?this.options.editCoordinates=e.editCoordinates!==void 0?e.editCoordinates:!1:this.options.editCoordinates=!1,this.editing=!1,this.options.systems=e.systems||[],e.altitude){var i=e.altitude;this.options.altitude={triggerDelay:i.triggerDelay!==void 0?i.triggerDelay:200,responseDelay:i.responseDelay!==void 0?i.responseDelay:500,serviceOptions:i.serviceOptions||{},noDataValue:i.noDataValue!==void 0?i.noDataValue:-99999,noDataValueTolerance:i.noDataValueTolerance!==void 0?i.noDataValueTolerance:9e4}}else this.options.altitude={triggerDelay:200,responseDelay:500,serviceOptions:{}};this._uid=this.options.id||SelectorID.generate(),this._projectionSystems=[],this._initProjectionSystems(),this._projectionUnits={},this._initProjectionUnits(),this._isDesktop=Helper.detectSupport(),this.options.altitude.triggerDelay<100&&(this.options.altitude.triggerDelay=100),this._timer=this.options.altitude.triggerDelay,this._currentProjectionSystems=this._projectionSystems[0],this._currentProjectionType=this._projectionSystems[0].type,this._currentProjectionUnits=this._projectionUnits[this._currentProjectionType][0].code,this._projectionUnitsContainer=null,this._showMousePositionContainer=null,this._panelMousePositionContainer=null,this._panelHeaderMousePositionContainer=null,!this.options.displayAltitude&&!this.options.displayCoordinates&&(this.options.displayCoordinates=!0),this.listenerKey=null}_initMarker(e){if(this.options.editCoordinates){if(!e){this._markerUrl=Marker.lightOrange,this._markerOffset=Marker.defaultOffset;return}this._hideMarker=e.hide!==void 0?e.hide:!1,e.offset?Array.isArray(e.offset)&&e.offset.length===2?this._markerOffset=e.offset:(logger$v.log("positionMarker.offset should be an array. e.g. : [0,0]"),this._markerOffset=Marker.defaultOffset):this._markerOffset=Marker.defaultOffset;var i=e.url;i?i.match(/^[a-zA-Z]+$/)?this._markerUrl=Marker[i]!==void 0?Marker[i]:Marker.lightOrange:this._markerUrl=i:this._markerUrl=Marker.lightOrange}}_initProjectionSystems(){for(var e=[{label:"Gographique",crs:get$3("EPSG:4326").getCode(),type:"Geographical"},{label:"Web Mercator",crs:get$3("EPSG:3857").getCode(),type:"Metric"},{label:"Lambert 93",crs:get$3("EPSG:2154").getCode(),type:"Metric",geoBBox:{left:-9.86,bottom:41.15,right:10.38,top:51.56}},{label:"Lambert II tendu",crs:get$3("EPSG:27572").getCode(),type:"Metric",geoBBox:{left:-4.87,bottom:42.33,right:8.23,top:51.14}}],i=this.options.systems,s=0;s<i.length;s++){var o=i[s];this.addSystem(o)}if(this._projectionSystems.length===0)for(var l=0;l<e.length;l++)this.addSystem(e[l])}_initProjectionUnits(){var e={Geographical:[{code:"DEC",label:"Degrs dcimaux",format:MathUtils.coordinateToDecimal},{code:"DMS",label:"Degrs sexagsimaux",format:MathUtils.coordinateToDMS},{code:"RAD",label:"Radians",format:MathUtils.coordinateToRad},{code:"GON",label:"Grades",format:MathUtils.coordinateToGon}],Metric:[{code:"M",label:"Mtres",format:MathUtils.coordinateToMeter},{code:"KM",label:"Kilomtres",format:MathUtils.coordinateToKMeter}]},i=this.options.units;for(var s in e)if(e.hasOwnProperty(s)){for(var o=!1,l=0;l<e[s].length;l++)for(var c=e[s][l],u=0;u<i.length;u++){var f=i[u];c.code===f&&(o=!0,this._projectionUnits[s]||(this._projectionUnits[s]=[]),this._projectionUnits[s].push(c))}o||(this._projectionUnits[s]=e[s])}typeof this._projectionUnits=="object"&&Object.keys(this._projectionUnits).length===0&&(this._projectionUnits=e)}_getCurrentProjectionInformation(){for(var e=[this._currentProjectionSystems.label,"en"],i=this._projectionUnits[this._currentProjectionType],s=0;s<i.length;++s)if(i[s].code===this._currentProjectionUnits){e.push(i[s].label);break}return e.join(" ")}_initContainer(){var e=this._createMainContainerElement(),i=this._showMousePositionButton=this._createShowMousePositionPictoElement();e.appendChild(i);var s=this._panelMousePositionContainer=this._createMousePositionPanelElement(),o=this._createMousePositionPanelDivElement();s.appendChild(o);var l=this._panelHeaderContainer=this._createMousePositionPanelHeaderElement(),c=this._panelTitleContainer=this._createMousePositionPanelTitleElement();l.appendChild(c);var u=this._panelCloseButton=this._createMousePositionPanelCloseElement();l.appendChild(u),o.appendChild(l);var f=this._createMousePositionPanelBasicElement(this.options.displayAltitude,this.options.displayCoordinates,this.options.editCoordinates,this._currentProjectionUnits);o.appendChild(f);var g=this._createShowMousePositionSettingsElement(this.options.displayCoordinates);o.appendChild(g);var H=this._createMousePositionSettingsElement(),Y=this._projectionSystemsContainer=this._createMousePositionSettingsSystemsElement(this._projectionSystems),ee=this._projectionUnitsContainer=this._createMousePositionSettingsUnitsElement(this._projectionUnits[this._currentProjectionType]),te=this._createMousePositionSettingsAccordion([Y,ee]);return H.appendChild(te),o.appendChild(H),e.appendChild(s),e}_setElevationPanel(e){var i=null;e?(i=document.getElementById("GPmousePositionAltitude-"+this._uid),i.style.display=""):(i=document.getElementById("GPmousePositionAltitude-"+this._uid),i.style.display="none")}_setCoordinatesPanel(e){var i=document.getElementById("GPmousePositionCoordinate-"+this._uid);e?i.style.display="":i.style.display="none"}_setSettingsPanel(e){var i=document.getElementById("GPshowMousePositionSettingsPicto-"+this._uid),s=document.getElementById("GPmousePositionSettings-"+this._uid);e?(i.style.display="",s.style.display=""):(i.style.display="none",s.style.display="none")}_setTypeUnitsPanel(e){for(var i=this._projectionUnitsContainer;i.firstChild;)i.removeChild(i.firstChild);for(var s=this._projectionUnits[e],o=0;o<s.length;o++){var l=s[o],c=document.createElement("option");c.value=l.code?l.code:o,c.text=l.label||o,i.appendChild(c)}var u=this._projectionUnits[e][0].code;(this._currentProjectionUnits==="DMS"||u==="DMS")&&(this._resetCoordinateElements(this.options.editCoordinates,e,u),this._setEditMode(this.editing)),this._currentProjectionType=e,this._resetLabelElements(e),this._resetUnitElements(u),this._currentProjectionUnits=u}_setCoordinate(e,i){var s={},o=this._currentProjectionSystems.crs;if(!o){logger$v.log("ERROR : system crs not found");return}e=transform$1(e,i,o);for(var l=this._currentProjectionSystems.type,c=null,u=this._projectionUnits[l],f=0;f<u.length;f++)if(u[f].code===this._currentProjectionUnits){c=u[f].format;break}if(!c||typeof c!="function"){logger$v.log("WARNING : coordinates format function not found");return}else s=c(e);!s||Object.keys(s).length===0||this.GPdisplayCoords(s)}_setElevation(e){var i=this.options.altitude.responseDelay,s=this.options.altitude.noDataValue,o=this.options.altitude.noDataValueTolerance;this.GPdisplayElevation(e,i,s,o)}onMoveStopped(e,i){var s=transform$1(e,i,"EPSG:4326");this._setElevation(s)}onMouseMove(e){var i=this;const s=e.originalEvent||e;if(!this._panelMousePositionContainer.contains(s.target)){var o=e.coordinate;if(!(!e.map||!e.map.getView())){var l=e.map.getView().getProjection();this._setCoordinate(o,l),clearTimeout(this._timer),this._timer=setTimeout(function(){i.onMoveStopped(o,l)},this.options.altitude.triggerDelay)}}}onMapMove(){var e=this,i=this.getMap();if(!(!i||!i.getView())){var s=i.getView(),o=s.getCenter(),l=s.getProjection();this._setCoordinate(o,l),clearTimeout(this._timer),this._timer=setTimeout(function(){e.onMoveStopped(o,l)},this.options.altitude.triggerDelay)}}onRequestAltitude(e,i){if(!(!e||Object.keys(e).length===0)&&this.options.displayAltitude){var s=this.options.altitude.serviceOptions||{},o=s.protocol||"XHR",l=s.timeOut||0;o==="JSONP"&&l===0&&(l=15e3);var c=s.outputFormat||"json",u=!0,u;s.zonly===!1?u=s.zonly:u=!0;var f=s.measures||!1,g=[{lon:e[0],lat:e[1]}],H=s.resource,Y=this,ee=s.rawResponse||!1,te=s.onSuccess||null,ne=null,Ye=null;ee?ne=function(et){te&&te.call(this,et),logger$v.log("alti service raw response : ",et)}:ne=function(et){et&&Object.keys(et).length&&(te&&te.call(this,et),i.call(this,et.elevations[0].z))},Ye=function(et){logger$v.log("[getAltitude] ERROR : "+et.message)};var xe=s.apiKey||this.options.apiKey;typeof s.ssl!="boolean"&&(typeof this.options.ssl=="boolean"?s.ssl=this.options.ssl:s.ssl=!0);var tt=s.ssl;Gp.Services.getAltitude({apiKey:xe,protocol:o,ssl:tt,timeOut:l,scope:Y,outputFormat:c,rawResponse:ee,onSuccess:ne,onFailure:Ye,zonly:u,measures:f,resource:H,positions:g})}}onShowMousePositionClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen();var i=this.getMap();Interactions.unset(i);var s=this._showMousePositionButton.ariaPressed;this.collapsed=s!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position),s==="false"?unByKey(this.listenerKey):this.editing||(this._isDesktop?this.listenerKey=i.on("pointermove",o=>{this.onMouseMove(o)}):(this.listenerKey=i.on("moveend",o=>this.onMapMove(o)),this.onMapMove())),this._setElevationPanel(this.options.displayAltitude),this._setCoordinatesPanel(this.options.displayCoordinates),this.options.displayCoordinates||this._setSettingsPanel(!1)}onShowMousePositionSettingsClick(e){this.draggable||e.target.ariaPressed}onMousePositionEditModeClick(e){if(this.options.editCoordinates&&this.editing!==e){this.editing=e,this._setEditMode(this.editing);var i=this.getMap();this._isDesktop?this.editing?unByKey(this.listenerKey):(this.listenerKey=i.on("pointermove",s=>{this.onMouseMove(s)}),this.onMapMove()):this.editing?unByKey(this.listenerKey):(this.listenerKey=i.on("moveend",s=>this.onMapMove(s)),this.onMapMove()),!this.editing&&this._markerOverlay&&this._markerOverlay.setPosition(void 0)}}getCoordinate(e){var i=document.getElementById(this._addUID("GPmousePosition"+e+"Degrees")),s=i.value;if(!s||(s=s.replace(",","."),!MathUtils.isInteger(s)))return null;var o=MathUtils.toInteger(s);if(o<Number(i.dataset.min)||o>Number(i.dataset.max))return null;var l=document.getElementById(this._addUID("GPmousePosition"+e+"Direction")).value,c=document.getElementById(this._addUID("GPmousePosition"+e+"Minutes")),u=c.value;if(u&&(u=u.replace(",","."),MathUtils.isInteger(u))){var f=MathUtils.toInteger(u);f>=Number(c.dataset.min)&&f<=Number(c.dataset.max)&&(o+=f/60)}var g=document.getElementById(this._addUID("GPmousePosition"+e+"Seconds")),H=g.value;if(H){H=H.replace(",",".");var Y=MathUtils.toFloat(H);Y&&Y>=Number(g.dataset.min)&&Y<=Number(g.dataset.max)&&(o+=Y/3600)}return(l==="O"||l==="S")&&(o=-o),o}locateDMSCoordinates(){var e=[this.getCoordinate("Lon"),this.getCoordinate("Lat")];if(!(e[0]===null||e[1]===null)){var i=this._currentProjectionSystems.crs;if(!i){logger$v.log("ERROR : system crs not found");return}var s=this.getMap().getView(),o=transform$1(e,i,s.getProjection());s.setCenter(o),this._markerOverlay&&!this._hideMarker&&this._markerOverlay.setPosition(o)}}locateCoordinates(){var e=document.getElementById(this._addUID("GPmousePositionLon")).value;if(e=e.replace(",","."),e=MathUtils.toFloat(e),e!==null){var i=document.getElementById(this._addUID("GPmousePositionLat")).value;if(i=i.replace(",","."),i=MathUtils.toFloat(i),i!==null){var s=this._currentProjectionSystems.crs;if(!s){logger$v.log("ERROR : system crs not found");return}var o;this._currentProjectionSystems.type==="Geographical"?o=[this.convert(e),this.convert(i)]:o=[this.convert(i),this.convert(e)];var l=transform$1(o,this._currentProjectionSystems.crs,"EPSG:4326"),c=this._currentProjectionSystems.geoBBox;if(c){var u=[c.left,c.bottom,c.right,c.top];if(l[0]<u[0]||l[0]>u[2]||l[1]<u[1]||l[1]>u[3])return}var f=this.getMap().getView(),g=transform$1(o,s,f.getProjection());f.setCenter(g),this._markerOverlay&&!this._hideMarker&&this._markerOverlay.setPosition(g)}}}onMousePositionEditModeLocateClick(){if(this.options.editCoordinates){if(!this.editing){this.onMousePositionEditModeClick(!0);return}this._currentProjectionUnits==="DMS"?this.locateDMSCoordinates():this.locateCoordinates();var e=this.options.mapCenterCallback;if(typeof e=="function"){var i=this.getMap().getView(),s=i.getCenter();e.call(this,s)}}}onMousePositionProjectionSystemChange(e){var i=e.target.selectedIndex,s=e.target.options[i].value;this._setCurrentSystem(s)}_setCurrentSystem(e){for(var i=null,s=0;s<this._projectionSystems.length;++s)if(this._projectionSystems[s].code===Number(e)){i=this._projectionSystems[s].type;break}if(!i){logger$v.log("system not found in projection systems container");return}this._currentProjectionSystems=this._projectionSystems[Number(e)],i!==this._currentProjectionType&&this._setTypeUnitsPanel(i),this._isDesktop||this.onMapMove()}onMousePositionProjectionSystemMouseOver(e){logger$v.trace(e);var i=this.getMap();if(!(!i||!i.getView())){var s=i.getView(),o=s.getProjection(),l=s.calculateExtent(i.getSize());l=transformExtent(l,o,"EPSG:4326");var c=document.getElementById(this._addUID("GPmousePositionProjectionSystem"));c.innerHTML="";for(var u=0;u<this._projectionSystems.length;u++){var f=this._projectionSystems[u],g=null;if(f.geoBBox&&(l[0]>f.geoBBox.right||l[1]>f.geoBBox.top||l[2]<f.geoBBox.left||l[3]<f.geoBBox.bottom)){f===this._currentProjectionSystems&&(g=document.createElement("option"),g.value=f.code,g.text=f.label||u,g.setAttribute("selected","selected"),g.setAttribute("disabled","disabled"),c.appendChild(g));continue}var H=document.createElement("option");H.value=f.code,H.text=f.label||u,f===this._currentProjectionSystems&&H.setAttribute("selected","selected"),c.appendChild(H)}}}onMousePositionProjectionUnitsChange(e){var i=e.target.selectedIndex,s=e.target.options[i].value,o=this._currentProjectionUnits;this._currentProjectionUnits=s,this._resetLabelElements(this._currentProjectionType),this._resetUnitElements(this._currentProjectionUnits),(o==="DMS"||this._currentProjectionUnits==="DMS")&&(this._resetCoordinateElements(this.options.editCoordinates,this._currentProjectionType,this._currentProjectionUnits),this._setEditMode(this.editing)),this._isDesktop||this.onMapMove()}convert(e){var i;if(this._currentProjectionUnits==="M"||this._currentProjectionUnits==="DEC")i=e;else if(this._currentProjectionUnits==="KM")i=e*1e3;else if(this._currentProjectionUnits==="RAD"){var s=(180/Math.PI).toFixed(20);i=(e*s).toFixed(20)}else if(this._currentProjectionUnits==="GON"){var o=.9.toFixed(20);i=(e*o).toFixed(20)}return i}validateExtentCoordinate(e,i){if(["Lon","Lat"].indexOf(e)===-1)return!1;var s=i.replace(",",".");if(s=MathUtils.toFloat(s),s===null)return!1;s=this.convert(s);var o=this._currentProjectionSystems.geoBBox;if(o===void 0)return!0;var l=[o.left,o.bottom,o.right,o.top];return l=transformExtent(l,"EPSG:4326",this._currentProjectionSystems.crs),!(e==="Lat"&&(s<l[0]||s>l[2])||e==="Lon"&&(s<l[1]||s>l[3]))}}Object.assign(MousePosition.prototype,MousePositionDOM);Object.assign(MousePosition.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.GeoportalMousePosition=MousePosition);var MarkersOther={drawing_api:[{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABapJREFUWMO1mGtsFFUUgL9zZ6bdbaEP2kpRCYj4wlciRMHEHxo0MdHEqDFG/aExvmJiYmJ8G2P0B8YYYozC+oivCAl/VMRqIkTBUIygCAiNlr6oQAttd9vS7bQ7c48/pq0QdtvZFU9yM5nZOfd895xz7zmzQomibwFlgACVCCPUI1QDCcAFAsBHydBDP2ejOEAlyN2l2XRLhaUcyCDUsoQsK4DrgCuBRmAWcALoAfbQyDaUn1nGAZrRUk1KSV59DwhpRLgLuAe4JsZMPwPrsGzA0CuP/M+wugYwCMJFKM+g3IVQEU8ZgCywAeF1LH/ioPJwfPvFpUGA4LEYeBW4DSlCP3JLBXAfSgXCC7i0TS0jhpjYXk0BHjXAE8BtaMn57gK3IzxBjhpdE18xNiyKg3ADcD/glpbtExJF5AGUGwDnjMJqChBqgccRZhVYTDTCk8bks/zvzwIeBWr1vXiwcUNpgCuAqwuCgtKwtIcFtzqU19Ywls5waGPI8d8aUeS0SET3KxAuB34kRu7Gh1VuRCjPDyqWhbcMsGI1VJ1fCRPH/wX3DrHjyX46N9XlBY5O65XAT0RFZEaPxYMVlpAvvxSoXjTIsteGqTp/LvAvbNXiuSx7dZiqRZkCfnOAy9B4HHFhhagy5d9WsxcmmXN5XZ75DHOunEPVecmC8ypz0XjbtZjjJ5H3qQLGcxHJb1CkHPGcghkpFFrIaRL/6ILBAsbA7zvBWLov7+/+QB/+8ZFpfJc5s7CKRWlFCfPCDhxI0JKyaDh8ql44TMtaJd2SLAAbAn8BNg5GvDRQLEIzUdNy6iYTIMgm+H3VXMYz3Vz8UAavqoHc0HEOpMZpSc0nyJYVgM0RNTixYGMltq5BEM4DvkdYlGcxkRg3xKsAcR1sEBJkwQbONFbaEVYCnfLwzOds3JxV4CiwLq8XZGLYwGFsyMEfgPEhZwZQC3xO1PPGamZiV3hNAcqFCJ8Ay+PqTSM7EO6/86PGv347Uo6xEFqD41isiepHhe9zXU8Pk71Ocf1sCg+4HVgNzCuVUpWjA1nz3B3vn7PxSNZ4AbjGYkJrjOPY0BqxAuNJ389eMjjk7204i3meLRoWop70ZeBJwIuvHLnGKnZ7R2LbU183fHVs2PFdo65G6SiR71QRUcCiBChpA/vFaGvRjd4E8EKUtcBNeSv+NLxtfV778011m3YeSmSciYyWU94QUJ24CIAVGLXo98UUBQAmvp26UFYDHcXoDo6azPrds5t3dSfSjkElArFMDYmuIhbEiqgVQRStQLWmaNgJYCXNZuAdou+qGSUXEvzQmty1fvfsDiMgseIhgqqoyBE1prUkWACOESJ8DHzJdEePRlHd31Pe8vb2mt3jgdgYoAIYBR/YY6DJJBKHS//f4BIA0sAbqlwMXJUXQuDYsNOb2lHd3JX2sqe/ogKCTjbwgkU1CxxE5E+gO51MnqjO5YpqZE5leGTSb+zNhawOleGpJydd/RxjX+yb1bzlYLJXmAp/FF7FqAqoBsAI0KmwxXHdzxS+u7mzswU4MT+Tof3gwf/02RcxpaCzz6ltqLKvJD19zAju5KYOlfCntsTOF7+t33pkyPUdE9U6VUVExoERVdKCdomY1hCOqxCM9veHlbW14Di0tbdP2So9DU7y8M7nTAbHfFBfGSyt8PRaI5FjuwbcQx/+Uv3r34Ou7xp1VMkBaRE5BhwVkW7Xcw+j5KwNkFyouA71Cxbwx759+TLqzEjHKo8yx97RUBm+7TnMG/Rl+N3tNU1rm6v3ey5pgaOo/q3QU5FI9I6OjfkiguN5nLt8OZs//XRmx5wpWIDvnp6duLR+9KXaZPjgjs7k1mebGtals6bDiPY7IpnusrKReb5PeVkZB1pbi57/P6fByVKXDPzOtPtmwtX1f/Qm0u3pRL/b0+VXL2xEVbm+r49v+vtLnv8f2Pk64kl5WH4AAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjAyOjM4KzAwOjAwnw8TLgAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABm5JREFUWMO1mFtsXFcVhr+195mLx3bshNghKWkNpCglPEBpUYSAKg88gGigUftARSJzkbiIB54QalQkKvGISkGQSkTQplJBKQgQbbmUW6CkTZuGVq0pjV3n4jSOnUzG47HHM545++fhjNs6npDjISzpaDQ6s9f69tr/XnvtMTo0fbYfAhACbN5knJ1ch9QHlseIgAZSHbMyhRsvUj0qvIPeHPbd6Y5iRp3CIkGjy8jUtnJ28mbgg8B7gEGgB5gDpoCXmD92GOxZ3pt/haN1dRrSOuLcvQYitwHpNsTtwE0gj5kAXeLfkGLgKGaPgPslIZ62A7P/X9hk6YMRuB5nX8PYBeoBiy+BbBfHA3OIXyDdh7NRXFP24/nU8VcnA3OG6R047QXtTACsmWaeQBNUAO7E6Ea6B984cYVJLjOXOqvD/aC4D/gSxk7MPFhY1WSx0Bq3E/gizVyf9vSmHp0aloBH3ALcCeZIakEnFkgk8RmCfQTkryqshvshoh/4AtBNu6WTjBAbzUWjUYfmYvJdWrkvDLX8fB58n/b0p4JNp1lhBG0D3k+yWZbDJkCBd95c5H0fz1LoX0u1VOKfv11k/Ln1SNaqFMuR4SaMbYgnSaHddLAmD+wAsm0zigI33lrh09/OMzDUD3QBxvY7Zvjp3lmO/aYX4ZYBmwHkEDswPQVccaOm1KwcaCuJ1i55FWDDlgq79i4yMLSJZHkd0M3A0CZ23bXIhi0V1FbiHtNWTKk4UsKagQ22/X0IMDhU4JobBlhZt41r3j3A4FCB0BbWgW1YSvOVLK1mAfKAtTbHm18Kn4kwy11mnll8RpeRpLX8prK0pUvALO0imjMqF+aols+3HTk/c4HZC3NJtVvhVUhlpFQHQ1rNCvQqEK/04GFiJMuhB+uEUFn2LoQKhx6sc2Yki2tbTptgY8hSwaY9bgNwBNMdYMujmkG9muPR7/RTnZ3glt095HsHWKic59CBOf68fwP1agbXLi9qAs9i6Q6YVMLWcK8hfx3oVxhvZ6UcDAl8pkmuYPjIEzdj6lURN6LW/mlXZ09g9knUPG0PzF0xu+k1GzSFeAQRt5mkMCBuRFTLnkpRVMv+v4KKGHEQaRrSySB1i6jdfeDYAuzD2E47/aY3j/Q0xpd3He0de74S4QLEweF9IDjDgEKtxofPnWNfa1DqFtEeKqPhNSeR7UNch/FWVtHMSK3EGIY0WWy4n9z2zJriVMMGWxyu9cQtv4uC6vmuQu1dA4NszIRVNt/DfRAoYHwd01fBMlz2TBfSG8VeyCRzTaF/lKKnvvHv7sfPL7paZIqUQFqr7VDrWA6IJqLkYMScRld9rdGePjBdC9wLfHTlVeYNyCC5gHmBCZmBjc378W8e7/79c+Wo7F2SLHvTWLCkUtpSf0QwWAjoifT97JIcDpTBwgTSD4Fxlu5ZCEkWZC4WviGyTcgE4aQkc6WGK/1sMvfMsdloxhuyBCTw+mPJp1kAC2YKZphQAal/1bAA9sCcmF74K/AjpPmlbAaZb4pMLKKAnLBkp5hoBGv8pZh5/ueTuVOOtN2AGZLJ7KycG+0IFoCLzZhgD4M9KpliETUhkuRkMsPUWlAk00jFH7//dP6FxWAhBagBTlADXnDwuMvnX+v8f4MtfVDIzlCvf09ia4x9QBKtZC5p2Awxtein9p/JH5lY8AsrOWVLZwqtNh+pCoxh9gowUerqmutrNFZxB7t06g+Xod4QxCO12H4Qi7IlZUnQSimiHlvt11PZI4eKmWnj9eVPlle4pHdXE5gHTgr+5KPoIcHvPnby5MvA3OaZGcbHxjr7k2NZXoZ7GatE/etzujvn9RVnconMZEEW/n4xc/Rbo4UnJ+uu7pcULGFmi8C8RMnQKTM3GsN5Gc2FYjHuXrsWvOfV8fFl2vif7fAn1tr6vG1bn42/3+X5kFlyLTgx70/eM1b4w+FSphglV6MGUDKzaWDSzCZ8FL2GaITQJG7EUuQp9PTw0osvrlzNqwELcPz2deRd+NS6rO7NODaXG1a6/1T+if1nci9nnJUMJpHOCM4V8vmphXq9Zmb4TIa3bd/OHw8cuGKMqwYL8NitA7kb8s27+jL63NOl6G93j/UcnGnYCYeK3mxmIpud31irkctm+dfo6Kr9d14N2thbolA/VbP7rnc6ODIXzZyqZy76M6cX1ly7EUnsuHCBx4rFjv3/B5an/+2QIsMIAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowMjo1MCswMDowMGqPVM4AAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABPdJREFUWMO9mNtrXFUUh7+1z5nMmdhkkjZpE1RsWi1FqQWL0gp98EUQ7JP+AYJPPigIlvqgiIr4IFqxSFtQ1AqW4oMXUAreK7Zia0vv2Exz6SVNc5u0SZpJZ875+XBOa0oz6UwydcFimNln//a3195nrb3HmKPpxq8GtABZIAB8oAQUgFFgeHoXm+OY/lxhp417P7AOWA+sBtqABcA40A8cBvYAfwInbp7nbTbF3iZ4QfCnQBX4PsHzgiX/C20CaYKVgk8EExWCXvOJpN/KROe2wprgPsGXgmKVoNe8KNgluFdz374VRbVZsGUeoNOBP0j0bgusJ3hKMDZP0Gs+luh5tyOqLYKfawR6zX9IdCuySlOXAx4EHpl1TmvW9LNhg0dzcxP5/Cjffhty8GAb5ffmOmAV8Cu1SmkCX/B22b1qFmrDhkHlcn2SxiWVJI2rs7NPTz45KIhm2btvaf75/gbYOsE3ZQddvnxEhw93SQp1o4U6dKhLy5aNlIGNEt26Spe3EjPiyjTzci5dmmHVqkUz6DlWr15IR0dmFt0lVJjCqgl/ULYllfIxm3lAszSp1GxvfIYKrdLIAlwq2zI0NE4+PzRj28jIEIODE7PojtYaNgI6gXDG1hMnArZvjwjDsRt+D8Mxtm0TJ0+Wi14InEr0a2NJQXhWMFk2Z2azU9q0Kadc7owGBiaVy53Rxo05NTZOzZJnJxPd2hWG5EywTHB61iTv+yU1Npa0cKHU2FiS75duURROCzpqekZIKlhG8KYgrFH1CgVvJLoVWcUzSgRXAJ8Ba2sQg33AM0+3tZ06mE7jIggjh+dFRM4woL5QYH1/P1uTDhWnLouBu4H3gc1A+zxW6sKIc9ufuvPOwT7nFiccLvGQ+IW7KrgymKkvrGhdTHsqqm6vJNGtB14DXgRS1YJGEP0RBHteam39ZsDzCr7kK4a0JCTCTECEKCHyDo6bU2dVNTmJ7hVgK/F963Gq3EpdqVTPlqamIwOe1+yByWyagGI5xa+cYv52QUcofqimKFwHBnqJt0J3NX0vOTe6s6Fh74EgyHsgg8jiJU/c4k+zCCwyU2SGCdUjNVUNmwAL+BH4kDjSt7QilH7JZA7sbGjodhUvhxmSyaxPznXOCTaxEPgU+JpbnEUFHE+nT25pajp01SyqANQAp/h/h8MOvndBcH6+58g88I5gJfBQOYgBz7u4PZvd25tKXbn5GRkYUjIvI0K6AuQw+wc4m89kxrPFYlUHmZumngTtSBE2hzA203MFmPpqwYK9P2UyF+2/fvHyCicZSCVgAugR/OT5/ueC3U/09JwExu8eHaUrl5t/mRPQ43nNrVH0ekZ6zk3L3SGEvwfB/ldaWn7r8/2CF7OaJMzsKjAhkTfUa+Y6QxiUUZocHg7vaG4Gz+N0V9f1seZ9nTBgv3OjOPdRS6m0pl561CWT6PX9Mx9ns3+f8/2CL3mCIpA3swHggpmd9VP+eUQxikpYMRS+R8s993Ds6NGbxqrJ3efhYlHdqdSRy869lw7DDgftl83GdjU0/LUnk7mYigEvIJ0T9GfS6YuTU1OFeLbGXevW8uOOHRUFpma2u6EheGBy8tXmMHx2X5D57eXFrV/knet20rBnNnq2rm6ivVAgXVfHic7OqvVrd6sEFpVKhR7ffzeItPNYOsh3BcGw39tbyLa1IYnHhob4bnh4zvr/AlFvZYTScGjCAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowMzowMSswMDowMGvaOiAAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABfxJREFUWMO1mF1sXEcVx39n5u5613btOIlrp0lEhBr6RSmKLUiQIkQFSH0rLSoI8VCE1DSqVKkIAeVDCPECQhChClKXB0qBRKpoQbQNRbSUNIoTKW1NmsZW6vgjNbHXjje79q7Xd33vncPDjYuc7qZ3t+ZIq5V27sz5zZn/mXPuCk2a7vwlZNNgBK5vE/JLm0E6UTIIHhCi+KBFSrk8nTcokYVqGzL85aZ8es3C0tkCI0Xhpq5byVf2AHuBO4BeoB0oAzngNNf1vorTk8z1D9MzqM26lKaiuusJMFEvTu4DvgJ88t2l6q2onAQOoe5pxMzKG/v+v7DafxAiI4jchOi3Qe8DaU04G5QK8DTITxF3DmdVhh5I7L8xGdhQcKkbgR8Dd6PiJd+ugNAKfBXVVlS+h3pj8S6SmUke1QEIUxsQHgbuBm0A9KoACfeAPIwEG7TvYOKJiWFRtSB3AvfH2d4caWziAV9D9E7Arius9g2AkS7gIZD2OpsBpxBEsBLF307j32vyajvwII4u7X8iEWwyzSoGx8eAT9QFBeW27hx7P2TpaNnAYrXIq+9EjFzqRVWQq09CQNiDyO3Av0ig3WSwggH9HEhLHVDHp3dc5ht7YFtHG/HRtnHXzkV+cSLP0clNUAuYFuCzKMeA8P0wkmrWgNxKLX05hW2dC+zvL7Gtowf4H+z2jh7295fY3lHE1QycBT4KmogjGawiKL3UyioFtl6X5caNm2qsZ9i5cSNbO7J1DllAe0ATZWtSGQBkam9EwTMeIrUdirRgxdZNNCSbiCFxZGNbqAMDBb/MYnW+5viiP0/RX0LqBq+4zrDqQEdBo/cMWYGxyxmeHXE4La0Zc1rimRFlrJDF1oBVIpS3UVwSioTlVh3IIHHTsjbJRMAPMzz57x5KK1N84eYibaluloJLPDu8wjMj2/HDNKYGrBAAJ2E9YQVHxCsYpoEPv2fcAKVqmj+c3sGfhsGKJXI34IcQOlsTNLZpVP6JTQabVLOKZQY4VDsKEkc4dJZy1bLgQ3nFEjp7Da06lD8COTRZM5O4wGv/AET6EUR+h7A76bxr2AlU7v/iwm/ffiOcxjiInMFahzOCAK2+z95cjtVWp7F+tm8gBdwDHAC2NEup6MxlV3n03uJv/jrtKqkQPOMwkTPGWhc5I05gJev7lVsWFv03u69nS8o1/FoTAM8Bu4BHgFQjiCA4VXc8mDj3zfJzXXOu/CUP4xkwGMSauMcw8cPOb8mEQ92ZgoGzM5GMNtznad8AwA5UH0f4PNcQZS3csWh+/LvlI8+fCt4pWonvM1nzhMSFRkDjwuYElh36j0aKAgDy+j6AC4geACYambvglouH/aHB14KpgsWoxCCOdz8Sf4s4ECeiTgRRtBXVDQ3DXgFWsoWXgF8BlSRzAo3CV4LR1w77QxMGqVudr/IkqIqKTKsxo03BAtA+F6HyJMpfrn31KKrK2Sg38ljl+NCKhi4BqABGwQdOGzhiMpmLzf9vcOkWWKFAmp8pejPKrtoQwpwrzQ5UTgxeiAqVGm2bgKz2OYrgUK0A5xE5B0wVstlyZxA01MisRXh9H6RQhDcDogMRq33BlSBf8e67oPrn6pnBl4PzswKrxx8fr2JUBVRDYAmYVHjZet7vFV68a3JyBChvLxYZP3/+A731xUx9A0xG813dpuNHWVL7jYi3mtWRanQsGDv1/fLfjk67Rd+KEUBUFRFZAZZUKQh6QcSMRnBJhXA5n4/aurrAWsbGx9do4wPbqTselc3Seftm03awldSnjAgKTIT5iR8u/f3IsWB83sNY4nu6ICJzwIyITFnPu4gSOBcSBZGqZ2ltb+etM2dqCGqdbOLjPyEt9t5uaXssJXbLgvNLv14+fuTx5cGzKfEKAjOo/kch15rJzC5Xq76IYFMptu3ezUtPPfW+PtYNFuDFXd/K3Kabf9Al2a+fCC4c/c7SC4cKrjJhkLwVKU6l00tbfJ+WdJrh0dGG12/+NqhhmzTrT0aFn2esd/itaLYwTiHvXcz5nVt3oKp8Zn6eF/L5ptf/L2sInRchOhqOAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowNjo0OCswMDowMJwhuk0AAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABmRJREFUWMO1mF2MlFcZx3//887Ozs5O96OwZekupiq0ptJigFhaJaZNa9MbbTVBY5pYY0MlxiZ640XjhfHGxtheGFNFL7AIGmIbEy2Cix8sCSWxSCiyKyy7QGGXhd1hZnc+dnbfec/jxSwI7ADvjvhPJm/yvufj93ycc54zokHt+tYqMnMtOHN0lu7RdGt2KdBuWApTQqIKVgHy3d2F7PhYu7koork0y6d3DTQ0Z6JR2Ltn23m/Y1Crcw88OJ3OPgpsBNYA3UAGKALjwNHx8bv6kT+06r1LA/9+bJk1Oqca6fTnF9fiAtftzW8CvgI8IsAAzQ9p1yDNvzkE7DRnu5zXxSd/8c//L+y+l9bjfSRMDyB9V2ITRjrOKDV2Kwt2yXjVnE74yNvTvzwSe/5FpYESgRT6lQY/AJ4FS6B49tY8rzTG8yZLm9krvmrDV+2IIRe3Yd/m9VhY7QC9jHhWIrHYLJpPlYShL2C87JrUsfeldbH7x4Y1LDDjCeAFoYYX5nwgEoKvSXrCILijsHs3ryMw1wl8k9pKX2iMGeY9vhriwzl8NcS8x2xhlAWYlAG+EeA7+15cHws2pofMefzDwCdvBiqwtg9/fHzpwxuDRLqto1qezk8c7Y8KZwe7zUy6IbcFYHoU00PA34mRu7FgHXKIp4DmeqCAX7rmM5fv3/Qd0l29rdRC29r9yDPTJ3e9lp04un+JGQuAgWaDJ4UdAKq354gh1do9SL38Mk/6nt6plZ/fUkh39S4DrsKmu1Ys++jnthTSXSvymK83dCBYjeJxxGpkmMC6qbP8zYyWJT0trT0rl9QZz2V6V93dsrSnpV7uIoRYdvUkuY1i5qwAUvUtMRQkEvViDCCpWUEQYDdNyZZ4DHE9a2DGVH07xFwxVwzL05P1Poel6cm5Yr50i8Mjf0dhJbzEEBAt+OYCSmPDqdH+t715X7jOSO8L5/vfstLocItcve3UIjM7aVY/oW9UvDQQHuMgtaLlulklEc1VUmf2bFsWlgvnejc+lw9SrV1RpTRxvv/tufMH3loRhZWktNAvZgqBQ8CdgzXkRfQ3cGPARxZ63hGWC8kP+n593+j+30EQBETRvdFcBR9Vg3qg8xrD7K9GEAs27tZlEFww2HkzL0jCR9UgnCkGYXGKcKYY1EDr56oZHmyHwTi3WH03cMRT3+b1eKL7hX4ltCFuv1voXcle+OG7UyeHp6o4D5F3BIHHu9pelq5U2Dg+zhvzHWIXEdsPj/HVtT3TkqaATwF3NUppxoVC6F99pT9/ZLIctXlol9Fupg7nLGNSRtCcqFZJRz6q3tuj1UvbFlk9iRD4A7AW49smmuKGpnaLAG/mB7PhiW3Hip3Ts/5LgUg4cDgUOAMwV2vuK82p6pGuVM7B8QuRhhZ9renbvA7gPsN+BvqsFlnUjhejke0DxT8OXQ7zgZOuGHGdSWbzDwF4wYzH+mLXs1f01NbDeDiL9DpwOn6dD6U5n99/vnLwVC7MOdW8p9qCnf+p9pQ8yEvmJWRYGrOORcMCPL31sCU6W/YJfgqU4/SJvFWPTYbvHThXOS1qu8ftJWEmk8bMuaGGYAHC7kwkbBuy399q6zFqxc7ZQjT4znD5SNWbjwEqwBlUgKMOdrtUarTh60lyYAKfnMvZXPJHGB8zbG09CAH5WX9x70j54KVyVF7YwgS6Yq7VTksrA6eQTgDnci0txfYwjH8Hu1GPbz2MhU0m0/tV43UPBfivj6+UhGHkZw+NzR48NhFevCb8tfAazkxgVgVKwBmDvwSJxHaDPc+cOTMIFFfk84ycOtXYnxzXat/mdVyaiTrbku77TY4tTkqY1S6GZhYdnwz/sWOguP9yxVdcjVRWuzbMASUzcsLOSm4oggkT1ZlsNmrt7IQgYHhk5Loo/c/6+ZfXKJPQQ21J90ZzwGNX0mG8VD3928HS7uOT4WQgAiAEcpIuARcknQsSiVGM0PsqURiZJQLSmQz/OnasbkrdEe14/hM0SV+8q1k/STgtL4e+8KeRmd17Ts8cD5xygguYnTcYT6dSF2dmZyuSCJqa6N2wgX1vvnnbOe4YLMBrz61NLc/Y9zJN+vqJy+H+7cdLOwuhP+0gG0j5c8lkaXmlQnMyycDQ0KLHb3g3qKdMk1UuzUQ/TrrEbz4o+NzFClmNjlZaP9SDmfH45CTvZLMNj/8ffOgG6JpOcn4AAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjA3OjAwKzAwOjAwxEaR7gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABZ5JREFUWMO1mF1oXFUQx39z7r3Z3aQx2TYxCVo1aaviJyhqK/TBUgVBRVT6oD4oIiqFgiAoqIjogyIaoYgGFGrFVuuDWloRrWgrxmKrYmtbbZovY76z2e0m2W6ye8/4cLe1obvN3bUOHO7DOTPzP/+ZM2fOFSoUHQaygAVyCB4NKHUIUcAF8ihZIMUUCepQCGbkosp8upWCJQM0IoxxBS6rgNXAtUAzsAiYBkaA36hlD5a9xDlMsgC6ApGKWO0GhGaUdcD9wE3ogtb2AluAbSijsvx/Bqs9gEUQLgOeBtahVJdhJYOyDXgV5U9AZUV4/+WlgUFQlgMvodwNuGXGphp4sPB9ljzdED4tTFms+tQDG1DuRsoGGojgAvcgbMCjXrvL4Sq8EwdYAzxUcFi5BPoPI6wBnHMKtsBqHFhPcNKLLCoxSgNehPI4lnhYdsMyZBCuQbmxaOiDSqBErh8hdqeDE6/HJlPMbPeZ/aUZkBIpswrhapTvCJG74cAqBrgVIVIUKGKpuWOSxe3gLashCG0Nix5Ik3gywcyOJWgRwIG9tcD3QH5hxsKCVa6gVH55bcepf3kKb1kT8C9Yb3kT8Zem8NpSJSw7KFcVyFhQwh4wIbiZigfTuyRG1dVLitgzVF27GLc1VoIEAZoIWe/DpUFgKlp6geciUtyhSATxikdEACVGSAlfuuB4yRl/Yho/OVF8bnICOz5zFiJSYet12Jy1KF0oftH53OEo6Q6L+lPz9fwp0u8oc0dKsecDRwl6twUlbOmyQCdB0zI/pALYTJTUK03Y1ADnPZrCnNeITY+T7pgj3bEUm6kqwV6OoMEJBTZUALQLAVoRvkZoK8E+iOsj1SCug+Z9NAOad87ipQfDWpQ+aVu4zobNWUUYRthSkgUhAGbTDv4k2LSzAFALfIhlhJDNTOhWpHAlXgq8D6wMq3cW+RGHh+57rPnoL39EMBZ8a3AcizXB/VGdzbJ6ZIS3CwqhGxJZBnqMXoQ3gXagpVKUqgxPpkzHvesvGB8aMecXcJjC8AuszylkxmPV2Usbz6fFs2U23wG71cALwJOAF14ZELAW+8PP0T1PvdL4+VjCybpGXQ1ASiGXFBEFLEoeJWngkBjtKqvVk2Wg3WSAtwneW7cRNpUkwNsz4PVt3Fx/YGzCiTsOonJ6y1DYkWphvYDQotDqK1+XcymcAgz0o7Sj9JajezxtUlu313buPxhNOg4qgpUg5IUhwVfEglgRtSKIotWo1pcNtgBYGWMX8BbBO3dByeXJf7s3tn/rjtpeY0BCxUMEVVGRITWmqyKwAEzio2xC+Qw9S+nRIKqHjkaObNxc/+tcTmwIoAIYDf5M/GbgCxONDlb+PFkOKEmE1xQuR7muKAiBsQlntOOjus7+QS9z5hoVEFQLWxMsqhngGCJ/AgPJWGy6Lpcrq5GZj+FygteBcCCXo933mTrJ5Onf7Cyzn361qPObztioyKnwB+FVjKqAah6YAfoUvnFc9wOFL2/v6zsCTC9Npeg5dqyynxzzeOmGvkEn3rjYvhiL6BPG4J481L7F/35fdN9zrzfsHhpzs05wn4mqIiJzwIwqSUH7RUyXD+Mq5E8kEn5NPA6OQ3dPzylf/+2VSlAd9m03KdS827A4f311VG82JiC2f9D9671P6n7+e8TNuq46quSApIiMAcMiMuB67iBKzto8kvMV16Hh4ov5/eDBM3z9Z7AAN9yV097d3oH0lHkj4vmtxtCSnpapj3fW/rTnp9io55EUZBjVvxVGYpHI6InZ2WywW+HCVSvZtXnzwsScC7An5ctNtdErV5x4Pl7nP/Ljr7Hdz7zWuCV53PQa0YQjkhqoqpppyWaJVFVxuKurbPvnhNmTsiSez/YNua9HI7r1965osmcgmnCT/dm6S5pRVW6ZmGBnIlGx/X8AIXpAQWXTlG4AAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjA3OjE0KzAwOjAw/KO1YwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABh1JREFUWMO1mH+MXFUVxz/nvje/3s7+mLa72wqNSykIxEKCqKUJf0jQgGJCIGKC/AEaUSEh4R+NGv8wEMUY0xgjTI2J2Go1/EWA7hbBxELcboKh0tItZZfd7a50Z3dmdmZ3Z2dndt67xz9mt7bd2fbNUE/y8jL35d77eed83znnjtCqvfRrcKPgCBS7ha7sFtBOkDioC+KDVFAt0lXKU0wqvgu5Tvjm11ra0m0ZNhqDXFXYHLuJzuztwB3ALcBWIAmUQDPAu8y3vYnRId6+bZg9R7XVLaWlWf1pUN2K8CDIQ8DnEb1oufOZBGAI5SDoixgzw93f+T/DHkqDEUH1U6A/AHkQUS/UMgqIlkFeROQXqJ4Gq9zzeOjtm5SBFdTsBJ4G7kNwQ7+vAIqH8DCqHuiPwX7IhSG4pJnQnANpwHQBTyLch0jzehcBVRflfuBJ1HTV173SsKiDcCfwCB/nwxShHhEeBbkTxbmysAP7wJoU8ARCsvG7aP2ywf+utbHG1EmE72I0xeHnQmGE9ZBB9GbgcxuCCvqZjp7MV3s+6aTcaFehVi2+nJ0M3lnIbkVVkIbavh3YBfyDENoNCasG4YtArBGogL23p29u7w17uNbraAMcoO0bV12/8NT7g/lXZyY2bwAcQ7kLkbcA//IeC+tZuGkV4mJadnid889c99nFa72OXuAc7E6vo/fpnbct7vA6ihs4zgE+jYbjCAsr1CvT+lgq9HntiV3JTZsbrGduad+86RqvI7FBkAWlFw2X/5r5quONh5WIGFeksShFJBYR4zT2rIBoIixAE6mL+cbDQm6lUirUqrlGT+dqlVx2ZXmpYfFQQCmGLQvhYBWLMgIEDVzHcGkuvm/qlA1UF89/FKgupieH9VSpkGiYDYQAkQ8QsWEwwsrAgg6i8hBy0UcmQjnw48+OH+st+tWpb199Y7HDjXQv+LXsvqnhlX1Tw9vLgR9tnLq0BgwhhIINV9gPpQVHr0F5HWTH+j3rcXSNCTwngivi+KpBOajhW+tskGMBxkDuQvwJ7n7ismIIq1kFpoGDqK73ggiI4FvrLNSqztxKhYVa1bkkqKpF9c/1nldCqTZ8i3g4DVavR+SPwO7Q8za2o4g8sv3nL3zgTpzFWAiswXEs1ggCeJUKd2QyPN80LMBrv4sQBPcDexHZ1jKm6rQpLf/wqmd+/3J8finig2ssJrDGOI4NrBErsJKoVMo3zi9Ujnf3sC1im+yeVGuovoKRW4GngEgTc+tysWq99ydO9/zhlZQ7v/h1NcY1YDCIYxRATV12thKL+8e64wUDJ6cDGWn+WHPoOTCmDyUNfAlpLjqRTH6s50D/q4mRySKOc9FhaPVXvTFCVQCswLJFX2+mKNTtK4+DmjOI7kV0vJmpprRc7DzyzmBidKqAMboKYjl3Sf0uYkGsiFoRRFEP1a7mYQG+/JgSLbwB/BYoh5oTBH7bidF/db717/G17HF5E0FVVOSsGjPSGixA8myAygsoL3GpXnS1AY9PZk5t6v/nMfF9GwJUAKNQAd410G/i8Y9aP55kb4aIKWD9X6J6A3Br45IqOMXFma7XhgYjs4XyeoWrgKzVFUWwqJaBUUROA1OFRKLUWas11chcaPc+BjZQ0OP4di92tS9YO8as3mWlVm0fOjHYdnx0BmEt/PXwKkZVQNUHloAJhb87rntA4fA9ExOngNL2YpGx0dEW/+Q43wbSOLm5lG1P/lQjke9hxD2XplQD7+TY2z1/GjjiFhYqGCOAqCoisgIsqVIQ9IyIGQkgq4K/nM8HbakUOA4fjo1doI2PbZH0jwQvuctvb3teY9E9a3KIZPLj3X/9W793ciynjnGAGlAQkVlgWkSmHNf9CKVmrU9QC1RdBy+Z5L0TJ9Yr6krAAkT2/wzruA8EnW2/wXG2mXJlMTUw2J86fPQkrlMAplH9j0LGi8dnlqvViojgRCJcvXs3b+zff9k9rhgsQPuz348vb9/yk8CLf8s7feZI74H+g6ZUHkck74gUp6LRpW2VCrFolOGRkabXbz0bNDC/PVFxZwu/0k9s+UtscrYQny3ka9lMRfv6UFW+kMtxKJ9vef3/AgyZp3iOwsFtAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowNzozMyswMDowMHshjJAAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABjBJREFUWMO1mFFsXFcRhr//3F1713biOCVxotiolJiUlpLKtiBFiiqqgpS3tkhFQjwU8QBRpUr0BSHEA+IFVNoIIVQeQ4CAKiVCoUSIFokEKUSENGpCYxJnnUQmteN4u+v12r7ru+cMD+tESbOO727DSFfn4dwz852ZOXPmXtGmDE0NkY/zuODYnGxWMVv8GEavyXJCGaBuZjFQnp+fL/b29prHU8vUOP/x823ZzLQL27vYy9imMe2Y2fFIMVN8AtgN7AS2AD1AFZgG3l23bt3xEMLJmb6Z8/2lfmvXptpZNFwYxsltCRaeB74GfB5raNMqKg07CRw07A2Zrr+z/Z3/L+zoxCg+eEnaIfRd4HmMrrRaDFvEeAP4iUwXAsHODJ1Jbb+lNIhcpGBhO/AjjGcMy0jp9yvUBXzdsC7Dvm91KwCp08K14tW6r28QegnjGURLoLcRZ4SeQ7ykrDaMFEZSL00Na7IIeAp4QVLbB/MmMPANSU8B0X2FHZkYwXnXB7xI46TfvRkzggUSS1i2ZRJLCBawVaIsqQfj2yGEvtHCaCrYVB4yzAWFz2J8rtlhMjMQ9mjno9O787uj9dH6DZVQKR9fOO7HamNbDFOzlBF6QtJjGH8jRe6mgpXJAV9CdDYFhfBk95MfvLzxZQayA900Qtu9p2dP5bXia8VjC8cewLgbuKHvacP+DtTX4kiXs4bDeIQm+RUIDGQH5vZu2Ds/kB3oB27BDmYH+/f27Z0fzA6WA6GZ5gjjM1g6jlQvGSbDttCkLhvGtuy2/PaO7Q800eeGOoY2bstsyzfNXUNAPynrfbo0aIQvt8pGyJDJaJU6JqkzUhQ1hRVg5NMwpPbsisw1hUGUfKla8ZXZZvMVX5kth/LCatcwopz2BkybswFjHMN/eCoiopAUcocrh0OwMH/7XLAwf6hyyArLhXzUpJwa5g27aFgghaQt7gE4QaNpucOqJOIQ5/aX9/fPh/nJZ9c/W+523ZsWwsKNw5XDy4cqhwbjEHc43e0XoQQ4uaJ/TUkVgNHxUXn8J5zcW4iHmjrfjIwyPqcckaLIm/exxdStHt3jWp4wZ09HFl059dCpNets2py1SNEU4uBqXpBE3epRNVSjOT9HNVSjNUCDYb8lMG1YqmYmdScyWhjF4z8l9CuhXWnX3UP+YZG9sPituYu1/9RxAXxwRFEguMZx7Ipjdk9P83qrsAAjl0ayiOeAfcDWtjGNqVAO35t7sXwkmg7ZOmRcwPngXBQFH5yCYDkfx4ufnqvEZzdtZms2tPhZIxLgj8Aw8B0g2wIgCCxYqJ9OLiz9uNqnYviqOTIOHA5FzgDMNd4OcWeufmZTruTgvSmv8ZYb0pX+80HDfin05Vaj46/6icWfVt/0Z5OyIsl0u4KbO7KVQQBBsBSwt1q5FAA4/cnTAFdl2odxuZW1Vgnl5SPxCX8uKRFhiKDGgV151BilAAqSBQkZ1oXZhpZhV4AtP5N/G/gFsJgKtG715GTyr+U348u4W1f4GiJhJpPeN+fG24IF6Pmgx5vZfjP7g9k9So81arC/6MfiA4tnLLGQAlSAM4iBdx0cdbnctbY/T25sv8GyLZc61PEK8LCZDTeFENhsuF77/eKJcM0vNunbBLpZaQ0RMFsELiFdACZL+Xy1N0laamTukNMPnyarrEk6S8I+PPM3PdkYV6zXQm35L7UTyYnkOroV/kZ4DWcmMKsDC8AVg79GmcyvDf6858qVMaA6WC4zcelSez85bpeRwgj+mu9zG90P6WSvnDK3lSlfP5WcWnq1eizMhFiRBMjMkLQMLJhREnZVcuMebpioLxWLvruvD6KIwsTEHbnxkWXnkZ1Srx5zG93r5PiCnBqFcrJ+eelnC0fr/0xmyRABCVCSNANMSZqMMplrGEkIdXzizTIRXT09/PvcuWYZdX/k8WOPo6y+oo36ubLaatUwH/9m6Wjt4NJ7yqoETGH2X4Pprlzu+lKtFksiymYZ2LWLtw8cWNPGfYMFGN4/nLMh+4F69c36meRY/MrCQT8XLksUI6k82dGxsDWO6ezo4Pz4eMv6P9rPig+J9Vns3/evRp2Z3/nxULJJila6FuvBbZgZX5yd5U/FYtv6/weDRwGc3Jre9AAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMy0wNS0yNVQwMDoyODo1OSswMDowMDPIuVsAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjMtMDUtMjRUMjM6MDc6NDkrMDA6MDDVlNrHAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAABJRU5ErkJggg==",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABmJJREFUWMO1l1tsXFcVhr9/7zPjGY/jSy6NXVHVScsttCBVqElBFU0FFYiXqkitVPEQBA8ERBFPqCIUIZAQApSHFgchSEorAuoTUJJSNalTUNNQLs0FO0qcOE6d+D6ecXwbe+bsxcPYpYknyvE0LOloP5yz1/r22v9Ze21Rpz3zxlrcYgULMes2NCk/Prte0AJkDEWCCkbJsOKVcnu+OT1sFfNMqYGnto/XFTOqF1bzC6Q2NKuSn9kyOT53H3A/8DGgHWgCZoAR4ERzeuSvoGP/mr21d2tu0OqOWc+krldzBNEuuUdlPA62FRP2bqfLng2QYXAMtN9CeMF7Rnc+MPv/hX2mO4cHmfFBQ99GPApqvKETq0YybE7wgmQ/DsYZ55zt/NR04virk0GIZfJ3gn4APCxTlGjJqgILNSL7opkaZXzHOzu/tJRE5pJ+2HV4Dbio1aQnEA9LilAC0HcDCwxFZjwCPFGJ1dp1eE3iXCWGNTMv9CCwg+WM1mFVZkWgL2E8iJm/qbBdR3I479pkfF2mplrZNDPMYuKwSBwWiMMiZjFmNXZZgKzJsK+ad217DucSwSbNkDPCRxH31tp3MwNht6z5+Ejnus/6dNTaulgpFgcmXorHZo63m5mklfME92HhbuAICbSbDNbkDD4jaLgOaOhc//nJT97xI1qym3KAB3Lv3/jYldfPPZkfmDi4biWwABqQfdqkvwGVG2YsKaxMW0Ar9GUEWjKbp7Z27ppuyW7aCLwD25LdvPHeTbumW7KbikZY6Ra8obsMJeJIBiuEaKeGBswCzdnbs2tzH1lXw59bl7tr7ZpsZ9Ys1PYMG1GymrKavzpznbQjRVFNUQKSGpwiX0uSSxOySSttosxa9ZmqDeMolfMzC+XiRK33pXJholTOz6rWTlcdF28qrCAI+oB45TvP5OzpTO/w3mAWrjo7zcJ0z9Bem5ztzYqV5dREbOKsiUACSyQDCwTEUeBxXRNVEpV4LvPvt3dvXKhMDW7p2FFM+TUbyvH0eM/QvsXeob23VeL5dK3MCsrAMW4mbEDBQTeEIUybr/0dJMdCuZg+Pvh0Z8/lXyN5bxbfWg5zhFD215OAiSEz92okSwSbVAaG4mGJ/chCLY1JEELZL1SmfKk8yUJlyldBax13gCwIfisXRixhM5O4RezqzoHcBzB+g7Gtvk74KntDnh37v9d89lJ/hAsQB4f3geCqtayxVOL+kRH2rBYWoOtQcwofHgF2Y+qoF9jMhuem3ZP7nmr9U7moVAUiF3BxcM77EAenIFjMlkpzH566Ujq54RY6UmGV/awoI3uR4O4x8S1BKjkgSIYFhYu96TMv/bKpbb7oHvPOIgcOh7wzAHNVWYRSQ6by1oZMwUHPcKy+Veem60gOC64T+IXgoaSnz7IsJ4ei/pf35f586Uyq6L3JrnKwfKWwpUFQLZvzAXslcT+7bF97YJYguwi227ALq5k7P+OKJ7ozRy+fTRWcw0BBEHjnUXWUAihIFiRkWCNmrauGBfjG9hmb0vwhoZ9jzCXJaohV6T+R+ufJ7oYLUrV63NgkzGTSkDnXVxcswIVMHDvTs8AfanfYS5hW3c7RAX/62B8b36pUFBKACnAGJeCEg4Muk7lc9/Vk63Qb026+kFbqJ6APYdxTC0IyZgp+9M0DjUeLo36uRt8mEEvLNUTAbA44h3QGGCxkszMt5XLyO9i19pWHCjQoZZI7GSrstsA02HLQpdGoLGqh5/WGo+ePp0b53/ZXt9dwZgKzCjALDBgc9lH0vMFfPjcwcBqYua1YpP/cufde2ru6mymOubbG5vj7qTQ75SwyU7VMmeKBk6l/vPJs7rUrk77k3NLtywxJi8CsGQVhFyXXF8O4icp8Ph/n2trAe87391+ljfdsu361Vpmm+O5cc9iTzvAJaalMDfsLh5/PHRw4lZ5w3jzVxqUgaQwYljToo+gyRjmECnE5Nos8jU1N/OfUqZWSuhmwAD/8fQtRxBdyLeFpH1lHadZN//3FzME3DzT2uIiCYBizSwYjjZnM6PzCQkkSPpXifdu2cei5524Y46bBAnzzp+sz7beXv5ttCl8e7E2/9vLepv3zM+6CZHkvFQfT6dmOUomGdJrevr5V+6+7GtSyXHMoFcf8z1Jp+93Y26lCYawhz/jFUrazAzNj+8QEB/L5uv3/F2k1+QZ70J2JAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowODowMiswMDowMKLS20oAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABdtJREFUWMO1mFuMFFUax3/fqarp7ppLdzMDDCwmzAxegrIka7KLF2JkITFGE5NNfFAeNPuwGh8ML2rcbDYbXMNkszFmH7w8qYmYGB92jcuDwkYwQYzILEFmggODgDANc+menkvX0FXn24dqFJZuprrVf1KpTup85/zP/7uc77TQKv4KmNrvKoJHD0IWSAMuEKIEQIlZpsihGKAT+ENrS7otk3WBACHFejzuAjYDG4FeoAOYAwrAUTo5gOUQ9zLMAbTVJaUlq12A0IvyKMpjCL9JYHUI2I3wPsJFnvu5yQ7WbJRbgeeBRwE/ka0CwgLwPoZBLCewKC8mX77ZMBBgHbAT5RHATbxdARQfYTsWH+WPWE7VtpEITpOq5lFeALYjTRC9lrABbgUcDIf4LQH7kpmbZMO+39gW4Al+TGIKILjAk8AWJLlgyci+DCh5lGeIM/16KGCBCAhrb8uNnNwBPIUlz8vJyCZVyKD8Evh1XdfHyaN3rrqz8PC6h518Kp8rLhZLH45+GB0pHOlFkevs4pC4C2ED8CkJYjcZWcEA24BUPaKC2Idufmj6lS2vMJAbaCcOmfbH1z9e3rFvx9RHJz/qrksYUghbgc9q/lhCsaRkhfV140uhP98/89Lml2YHcgMrge/JrsuvW7lz887Z/lx/qa5ugoNwR02MJZE0wYT4ZLpeG4W12bWZDT0buuvMZzau2LisL9eXaeBkAVaSsN43k9XpRh88x3NFpO6CIpLyjNc445VMUgLNlK6ZRtpMLkzOFYPiZL3P08H05ERlYr6hdkIpab1OStYCo8QF6TqywxPD6Tf++4aNNJq9+lOk0ezrQ6/ryMRIpgGhCPimNv+SSFaQtyIo3cADtYJ+DdmqrbqHC4cz5cXyeF+ubz6yUaowXxgf/GKw/OpXr66euzyXakD2MvAmMMTepUtXMgfsQrD0IXyC0F93jILruJHv+bjiOqGG0UJ1gTAKnRusMlaT4lueX5ps0jBQhHFgN41cJhBGoVMOys50ZZpyUHaWIGpR3iXueRM1M8lbkV2AcgvC28CmxHaN8TnCEzd90PuNeymFsRBZg+NYrInPDz8I2Fwo8FrNIHnXtRfYRpm4KtxDfEFpDcq4qZjBNe+uGUrPeF0WsqJkVSVnjHaoSIdAyg1D/MhG4epfyB09XdJck7cLiJvtPwM7AK8Jglf6Aet/lz6wYt/yf7kLToCoq3E4Sm2AIhK3RUqIUjRwXIyOJlf2irpbqQInUW4HBuqe+PVQG+WVvNM9B5d9liq2CYYuFWkXET9+NH6rtovQAdKF0IPQH8Fcc2R/IDwDTAD3IOSTmprAlPJHs/s6T7VfqPW1KrHmtUfit4iCqIiqiIiiHqoXmyd7hfB9fIuLIb7VLh0OlrBjzD/YfTh/TFQ0mT9EUBUVuaAiXzRz3F6LEhHCWyj/RG9QemqapSdSI8u+yg1JJDYBUQGMQgAcNbDHpNPnW7+erAZmKOLzN4TbUH5Vl4SAM+dczA1lD3oz3kKd3QgIqrWtCRbVBeAkIieAc8VMZi5brTZRuv4fHwMPAB6XiJgHtiGkrsr6OL9DFrtGuv6THe4cE5UriRa7FzEgCBqCVIDzKhx2XfdTa+3xB8+cKZzM5S4vn59n5OzZFv/kuBqD4JScvPXtX9TVpxHcqwhH/tn0lyv29+x359wAE6eVqiIil4F5VYqCnhExoxFMqBBWpqai9nweHIdTY2PXxMaPhvesJ2TYEPrha+rp3T+UKff08gPde/xzmUk16gBVoCgil4BxETnnuO55lKq1IVE1UnUd/I4Ovj52rF5E/TTwXvCwrv1dlIn+gcMqsyiz+SO5Pfkj2eM4FIFxVL9TKPjp9MXK4mIgIjiex5pNm9j7zjtLrvGTkQXofLozXVlW+VOUin7vn8/sX7l/+W5TMacRnXJESufa2uZXBQGptjaGR0ebnr/1alAHYToM3JL7d+3W91KT6WK6nJ6qXjgT6NpeVJX7Jyf599RUy/P/D0pQLH84wUhqAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowODoxNiswMDowMJo3/8cAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABapJREFUWMO1mF1sFFUUgL9zZ6bd3ULbBUpBJVTwB1E0UaJg4oNGTUw0MZoYoz5ojKAxMeFFQ4wxBh8wxhB/sWriPyY+GH+RBDT+FhQVFaSBQrtQhRba7ral22l35h4fZosou3R2qSe5mWTm3nu+e+6555w7QrWizwI1gAB1AiOzQBqABOACAeCD5qCnH85QcIA6kNurUulWDUstkBNIL4b8cuAq4BJgDjANOAb0AL/BnG9At8HS3dCm1WqU6qz6ChDOAbkNuAO4IsZU24ANYN8H04us/J9hdT1gBOR80EdAbwNJxRwMkAfeB3kK7B5wFFkRW32FbhAIeOcAa4CbQSoYLwAp4C7QFMij4O6fWEUcMfGt2gp4jcBDEahW6+8ucAvIQ1BojHZrqmFRB+Qa4O5IYXXuHom4wD2g1xCFiCmE1VZA0sCDINPKdCq28IQ28a5k/2nA/UA6OrCTS9ytNMDFwOXlQdHLaOq5iflOmtrGLGO5jzkY/sLROaBy8k4IwHKQJcBXxPDdCmD1OpDaUqAC9kZaBtaxnIXU11GM/ndy7tAqtvZ/SmZmaWBqgWuBb4mSyKQWiwkriynpX8oCGgafZOnwQuqbgeOw51DfvIalwwuoz5UxnANcBBqLIy6sEGWmkqeqhenJJcyYWWI+cwkzZpxNfbL8vNocWX1yqST8JEq/VjyMK0hJhYLUeohT3iWl3EJOkgpCF4PljNOHfyzLWF+prwP4fUfxR04R6nJTDKsWtAM0LAW7m4FEK+02RIdP/BKiwy/Tru1kk2VgQ2AvYONQxHQDtSBtREXLfw6ZkCdIrOXX5hzj3fexKFeP1zRE4Wgru8dbaZ+XJ6gpA1sgKnBiwcZLQ7peQM4GNoMsKNGhuHITpvBwESfAhnkCAqxzCjWdINcCGWTFpHE2rs8qcBjYUNoKAggB1hlizBnAZ4hxZxJQC7xLVPPGKmbiJ3htBfQ8kDeBZbHHlZetIHfPu/n1ve6vhzAWQmtwHIs1ggAp3+eqnh4mSp0K69lWD7gFWAfMrRpT9bAZyK8+89ZXP05k8l4ArrGY0BrjODa0RqzAeNL38xcMDvm/N81mrmcrhoWoJn0cWAV4FQyObGPVpr7r+mb2qk8+co8M+zjG1cgdi+lYFREFLEqAkjXwhxjtqLzOi4BbQF8GrqdMMijH6+3v65z9yMZPkz8czOE68u+Kobgg1eJDAKzAqEU3V5IUIonuTgdA1wFdlQw1udFcwzs72pLbu7O4RhGsRAet2CR6ilgQK6JWBFE0hWpj5bARsEJ2C/Ai0b1qcimEQd2XHT81bNjRFV3j4myICKqiIofUmI7qYAE4EoK8AXzIKUOPgiqJXT3tM577foeMBzYGqABGwQd+M7DRJBJ/ncZ/gwsAssDTqC4CLi0NITi9w72N67e2eZls/uQjHXmtanFlgkU1D+xDZA/QnU0mjzUUChUVMv9hWFk0G79TCNcRTtQFE0aOnuIXxqZ/sLOt7ot9vVHukGgFqqKKURVQDYARIKPwheO6bytsuiGTaQeOzcvl6Ny377RufUWmVpxMX9o21T+hSe8BjLjHT3WgYerb/dtnr/78a/fQkI9jBBBVRUTGgRFVsoIeEDEdIRxVIRjt7w/r0mlwHPZ3dh5XdRpu8I+FzfbVOYPzWjCr7jJNeVdiJApTBwYONr7648/un4O+usZBtQBkReQIcFhEul3P/QulYG2AFELFdZg1fz67du4s4VBTJF7XWmyNc2vYVPc8njPXDPrD6Re+35h+qe0PatwscBjVPxV6UolE7+jYmC8iOJ7HWcuWseWttya3y1TBAkzf9HBi9MJZj4WNyXtTWw983fzwZxvMQL4LI/2OSK67pmZkru9TW1PD7o6Oiuc/fTc4QYKZSd/NZJ/RRe57tbt6s4nObH9hqMfXlhZUlav7+visv7/q+f8Gb188Ax2DNawAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjA4OjMyKzAwOjAwLF3cqQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABQ5JREFUWMO9mNtvFFUcxz+/M9N2d1HaQgEbNVy8hEiURIIBEx98MTGRhIR/wMQnHzThQXwyPhkfjBcwBg0mKiJiTIiYoCQKEWOoEZWLXCIt2+VWWnrZddvSLTszXx9ma8tll9m2+EtOJrtnzvd85nd+8zu/M8Z0TZr6y4A2oBlIAT4QACWgAAwCkwPMpjWlP23YSchHgLXAU8BK4B7gLmAE6AWOAT8DvwKnroP+X0wC6R6kl5F+RVKC1oH0EtKiG1bljkIa0nKkT5BGE4JOtNHKuOUVnTsKa0gPIX2NVK4TdKKVkb5CehBpesGb0KutSO/PAHQq8JaK3h2B9ZA2IA3PEHSiDVf0vDvh1TakA7MEOtF+qOgmwkiauhzwGPBErUdaBb3rwGuFljwUvoXwzziVVYvNtcCjwE/MWkqTfKQ3q8WqSeE6qb9L6pE0IimQNNIp9Twn9SNFNWL3DaSZ5vvrYBuR9lSb9AFp6JiUlRTqeguPSNll0lAV2Kii25h0eZOYUWM5l0D6UZh/Cz23EuYthXQN3UVUD5PrrB73p6p1NIBvVSY0aGqAWm98moSW1LMA/1TrGICRPAzcqm8IBvphtIZuYbZhI6ATCG/VeQpSH0EUwvDU/0MY/hB0urr3QuBMRX+WLN4QXkAaq5Yzm6XxV6WuLun8FWmsSzr/itQ1VxqvkWfHKrqzuDHENcEypLO1krwvBXOlYJ6kuVLgS8FtNoWzSEuT1ghJw0DAZWBnrSULwCuCNwQUwQtqv1gR8AVxzZtoQ0he9cRb4sPAZ8Ca6S7SFOsAnr9//foz/tGjuAjCyOF5EZEzDMiUSjzV28vWyoDkqcsMpG7gPeBdoH3amNJlNzT00b0bNvSncrmFQczhKi2seP2a4Gp/OlN6eMFC2huiOjw76d0M8DqwEWioGzSKoswvv/y8cOPGPf6VKyU8z1cMWUnVEmYCIkSAyDs4aU6d9e3JsXevAluJz1vPUGcoNWSzudbNm4/7fX2t+L7JbIqAYjkpvsT87YKlofihnk1hEhjOEYdCdz1DXaFQaN6x41D68OE8vi/MIouXvNIsvppFYJGZIjNMKIPUUj9sDCzgR+AD4GqiMeVyMOfAgd+bd+7sxrmEx3EzJJNZj5zrnB5sbCHwKfANt0s9EqkTJ07P27LliF27FiUANcAp/u5wzMF3LpW6NNM6Mg+8hbQceLwahNfX19eydeuhhlzu6s33yOC/g64wosp70YXZ38CFfDo90lwu11XI3PDsRsWjxymX3yUMh295W6k0fvfu3Yfm7N/fh9nEuHh5hZMMpIC42MkJ9nu+/7lg37O53Glg5P5CgWxX1wy/yMTZIfJ6evZGCxZ8KudexLlJzSAI0x0dR1q2bz9j5bLwPANMEmZ2zWBUIg+cc2adIfTLCIr9/eGc1la+X7aMs9nsf3IzP06Y4Q4fLjj4OGhrW6VM5kmci9PUuXPnW7Zt+8O/eLEk3/eQykDezK4Al83sgt/gX0KUoyjAyqHwPdoWL+bEX3/dNNWsnH3Kq1erobv7uCsW3wmbmpbiXLsrFofn7tr1W+bgwT4aG/MGl5EuCnrTTU19Y+PjpYmHvW/tGn7cvv32fpkN2Am7e9++1NiKFa+FLa0vZDoOHVy0adNONzTUjXODnlnhQmPjaHupRFNjI6c6O+vWn8VTJQTz55f8XO5tLU992XTiZD6VzQ6Wi8WSlixBEk8PDLB3cHDa+v8CFsk24crxS5QAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjA4OjQ3KzAwOjAwdKD6FwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIosGP4JQAABm5JREFUWMO1mFtsXFcVhr9/nzMXj8ceu4mVG1VSFwiq4iIqKClVHygFqQgkRKNAqjyk4gFC+gBPRYI8IISgIKgQjdKXiFKUi6IGVQKiirb0kjakCiJtrk0dO26cxHbsiWdsjz23sxcPdkJIxs3xpGxpdGZ0zt77m3/9a+01I5ocXd99lrJLUnfQPXGnBtr6FxuWk5QGC5HqZpRlVlgzkckfzU1b6Opks5cZ+sUPmtozbBZ2OkjRVaxotD1910Bb/33AA8CngaVAFmMKGAbePd4+84ZDhz6x+sDJ0ye+ZM3uqWYmtXx/D4H5pSbWgx41+DwyhOAqyuwbk+Y2skPALnm3N8JGZrZv+P/CZjfvJgIhrRb2hLD1JjKKsYwBMqYN9prxJI7THqyyLT70gmygyEmB/zjYzxDfAMI4oFdVERnMNkrKGPy4Cn1cE4ubjSDug61bdoKzTqQfgW2UCJtxkSSHbLVQEJodSt27rlw7vC/WXBd3E5MFJnsQbJOkpkD/q7JC4DEHD3ostmCxYLOP78HVw05MWxDZhl/GjMgb1bqnUo+o1j2RN8waR1mQRfpeaOrMPr4zFmxczzocdyPdOx+okH125W3DD/csDzoyyY7CdLWw/9iF6J1zl5eamaRGkbD7TPQArxHDu7FgzZsDvoyRuj76c8r5r9694vIvv/kZuruyrczmQuu3P7dy4onnj+T3H7+waB7glMFDwAGgfnPF4sAKZ+IudGNCeoPurrbi1q/1THZ3ZZcAV2G7u9qWbP16z+Qdi7MF31i3wGCNmWJxxHpIIM2eTDdI481Yuai1Zc3y3KIG67meFR23rVqcbfENvSvJtESmWNm6kDqbbqi6QSJw4TymRFIqESiw+R3ZEhcgZukywIqNcsAJ8lOVqcJ0dazRzPFSZWxsslJy82knCnGrYDxYw2P0AtH1twInTl4spHe8ecZ7b5PX3vPeJne81Wcnh4otQWPaCHgf8HEwYtrAebCDGI9en2SSmK5F6d/+/dSS4kxt8LH77yy0pRNdE+Xq6B/e7KvueKvv9plalHQNXGJQAzskUyzYWAFo3bxHTnaHh5cQ3Q3FNyMRuCiTDAmcgshbNF2tU4t8MI+dMazfyx4KzA2Utm24aZ2Ne9yaR0PALmyekEnUIh8UZ6rB5VKF4kw1+DBQzLyMnc4YJmYzE/uAb92yB8x/EumPGGtvoTWYU5V/Stq0+MDT77vCIM5D5B1B4PFutpfLlMs8MDzM9rk5sZuI2uHnSaxdNyGjCNyPaGue1IZctfTkon/86kiqNNbuIScjZ6YO5yxrUlaQCut1MpGP6stXaM3idi2snzVqGH8B7gH7ISixEC1nOwjzqbHe0x3v7O105YlvmVzoZnsPBc4AzM3awpdT6fqRrvS4gxNDkXoXHMzWLbuR2SqDZ0z6imJa6YopE5OX+nPH9v01mT9bwAUyrl1g7pPZ3EUAXjDjsZdi97NXRmnbBgLvPzDpKeBsnNS48oirThcy594+mLw8MI6czYF4rr40e5U8yEvmJWRYBrOOBcMCFJ/ZaJVc58uCbcim4ySzfFRPX3rvX5lzb5+92m3cfJYwk0kXzbnepmABokwucuJZgxfsQ2kNmZEoXjiV7X3liKK6jwEqwBmUgXcd7Hfp9IWm/zdYNDpIXonxjNV+LbNPgd1Dw1NKhJXiSLbvtYNhaWz6RoubQMw1OobwmE0DZ5BOA4PjLS1TuVot/m+w60f+d+tpsbrJ7Cg+egpscjaX50Q2wwBXr1XS5/99MDXy3sg14Z8Nr+HMBGZ1oAQMGLwShOGfDF58eGDgFDB1e6FA/5kzt1raZ6uDK412+lT7TwmSm00KZYZJyCxKjZ4+nDv659eDcrGMnACZGZKqQMmMcWEfSK43glET9Zl8Pmrt7IQgoK+//3+8ccujfcPPRSrXE6Wy2wmSX7jSS4dTo2dzx1/YnxrtHTO5AKgB45IuAUOSBoMwvIBR875OVIvMwoBMNsvxY8du2OcjgQVo3/Q05oJHfCr7e3PhMledmcyeeXV/tu/VE7hwHBjC7LzBcCadHpmpVMqSCBIJPrZ2LS8/99xN9/jIYAG61v0kXWlftjVKtH4nNdb3eufRfbtUK50F5QOpMJhMlpaVy6SSSU729i54/aarQaMRJbNlVxr7jW9L7E5MXBxPlvP52vmRMitXYWZ8cWyMv+XzTa//H6b399ILDmv5AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowOToxMyswMDowMCfNu14AAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABhBJREFUWMO1l0tsXGcVx3//e+94xmPHzsSxPXm4NK/adRKKQISUKjz6QIBKFIQUpMCiwIoFSF3RDQsELCIWCLEosKiggiyyQKWQSFV5pJRHUKpaVbDj2HnUedmOPR57xmOPPfd+h8Wk1JbH9Z1p+kmf7uK795zfd87/nu98otHxkScgbAYLYM4XbdFWsHZQCiNAhIgy2CwtTTmKy0YgaHfwj5cbchk0DLvcCh23xcyOftqiRzGOIB4BskArMI8xAbzFfOXv4J1nb2KIkWVr1KUa+qr/GMhlMR0HToA+gRlohbm1SOcRp/B0GucmGfrDBwy7/yg4T4he4HtgxzGl41kyQAvAabCTOF0GZwzHl4RfF2zXPoH2gn4MHMeURHG3LDASyA5gZIEBQsszM/IBwO4/CngZ4DlMXwcLVqU9Ji/IA/UifHzO0/VwmanhWJ97dbjyMR4HnkHUD7oaOgC+gfQ4ZrEDFu/F/i8DdAA/AXpr5t2sOsMIogicvftarY1JTaAtyDtDV99CnOjGLV0epg8jDtVcNQOwjx3cN/Glz3zcz7S1bM4XSrMvn7sQvTl4JYuZ1snEo2AHwc5Rq340Bmse4imM5JqgmiFwT3/20MxPn/sme3qyLVQz1vK1pz9VePbkC7k//e1CxzrASeBJ0OtAuHHE4sJi/aiGbJyx+4Hs3I++e6K4pyfbDfwfdu8D27p/+J0Txd092VlcjcAZPsYBXDyOmLASKEstsTrHgzu6mw8+9KGOGva8R3of3LJrZ3czztU0DNYNFutvree4Ta23kAj8QKotSknJRODX/pGrpaw5LkA9pWuutkMxnS/O5wvz07WWZ+aK01P5Quk9St3s/YU1c5iNAtGaNd9j6MpY6penX3GRc8WVS5FzxV+cfsUujd5oxq/pKsIYwXDEGPHqbGefgA7E50GrpSNRqYTBG0NXmwvFhfFdO7OlyLnkxHR+/OQLvy/87Ldnts+XFpN4tWBtGfgVaIDp4Q1LV7xjqO+o8LxdwKvA7nWiTxAEUbo5SeB7fhi5aGGxTBhG/voSsGvIniTy3mb4pQ1h42rWEONgp9ZPmQjD0C8US/7MbJFCseS/J2jVzu8wTRDjQIgfWYD9x8DcQ6DfYDrcYCe8kvbfwDM9iyMjgVvAcxA5D99397pQSJfLHJmY4Pl7X8TvuqaGoau3AJoDPYbY1DinjXsWntxZHhpIuaU2B+0y2s202fOs1aRWQTIIQ9KRi8LtO3Rga5vqvdZUMP0R+CjwLJBogNSlXfFy19JYJrDwqwaBBx4e8r1qj+FVZeHKyVQ40JnKezA4Hmm0vuZ76jJ09VUQV4D9wB4M1SOJhCtf31q583rSLQmpzaQWSenqtOrTrEWiFdSG2IrYHcF8fbBQlUN3/xzmpoDHQJm4sJ6Fs5lw6i+bwtk7AEimahTvTVWfkoFMMpMkwxKYTdYPC3D3EuzreZtyk4d0hDhyMAtbo7l/dVQmLgqzeM27hJlMumPSf+o5blePlrkI6dfAS2xUesxIuYVLWyoTAzLnYoAK8AzKwFsenPVSqduNRRag9RBAGeMqZocQ29arhL5VJjsq4682u1L+nYCt2IlAqrbFgHCYlYBBpH8K3syn09PJMIx//1kzJoehsw+Mu2Al0FNIyRUQgJC5pbYo99f2KHdN74JW01u9PCIsBC0Ct028EQTBOefc4BfHxiaubN683FkqcenGjfdf2uk/hh8uZZwf/MDkfbvaO1RBMYvSUfFC1/KN1wKrlKm2kTIzJC0DJTPywsYkbzSCKRPhYi4XtWQy4PtcvXZtlTbe90js/ZxI+AdDgucN75PvpDnhytc7l26dTbvCtCEfqAB5SXeBcUk3/SC4jVFxLiSqRGaBT7q1lf9evLjGz32BBUj0fwHn+ErkNf0ctM2zsJipTJ7NVCYHkZcHxjG7ZTCRTqUmF5eWypLwEwl2Hj7Mn198cUMf9w0WYNPDn04tkv5+RPCtdDT/Wnfl5inPwutAzpdmbzY1lbaVyySbmhgaHa3b/n2Fbe57AnO2peI3b2+v5PJZG89Vbtwq244ePGBfsciZXK5h+/8DFYWTIIiuQPwAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjA5OjIzKzAwOjAwqUK8vQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABilJREFUWMO1mF9sXEcVh78zd9fetZ04TkmcKDYqJSalpaSyLUiRooqqIOWtLVKREA9FPEBUqRJ9QQjxgHgBlTZCCJXHECCgSolQKBGiRSJBSiNCGjWhMYljJ5FJ7Tje7np3bd/duzM/HtZFCazju9twpNU83J0z3znzmzN/jA5tZGSWfD7GucDWrYkVCtmPgPoly5mRARqSYqBUqVQK/f398h5qtQwXL360ozEzncL29y8zMbHFdu2af6hQyDwG7AV2A9uAPqAKzAHvbNiw4WQI4fT8/MDFwcGiOh3TOuk0OjqFc7YtBD0LfAX4LAgwbA2PEqeBwxKvmenm22/v/P/Cjo9P430wM9tlxreBZ0E9ad1ILINeA35kpkshoHPnRlKP35YMoshZCNoJ/AD0lETGLH28ZvQAX5Xokfiu1JiiOSWpzLWT1UbDbzLjBdBTYG2B3oacMeMZsBfMspvGxqZS90wNK1kEPAE8Z2YdL8wPgIGvmdkTQHRPYcfGpnHODwDP01zpLYIRIYgkEfV6sw1BaI1JNrM+0DdDCAPj4+mymypDEi4E+zToM60WkyTA9PDD3XN79+ajjRujTeVyKJ08ueQnJmrbJKyVZMx4zMweAf2FFNpNBWsmB3wBrLs1KOHxx3vff/HFzQwNZXtpTm3vvn195VdeKRROnFi6D9QC2LqBJyX+CjTW40ipWTnQQ7TQVwgwNJRd3L9/U2VoKDsI/Ad2eDg7uH//QGV4OFsKoaXjCPSppv/1LdWfJExiGy00IMGOHdn8zp1d97Xw50ZGujbv2JHJt9auDBgkZaFOKQMDyK0RCJkMGVujjplZdxRZ1BrWAOXTMKTO7KottoaBYtFXy2W/0Op7uewXSqWwtHZJtlLaHTCtZgNoEuT/+0sUwdRUkjt6tBxCUOX2byGocuRIWVNT9XzUoppKeInLEoEUlra4B+AUzUPLHcOaGXEccgcPlgYrlTDz9NMbS729bsvSUrh19Gi5fuRIeTiOQ5dzLUtXApxe9b+upcr/+Pikec/HnLM3wB5omXuJTMZ8LmdEkUXey8exaDQU3WVbnpbck1Gka2fOPLBunU2rWUWRzYIdXisLZkajoahaDdHioqdaDdE6oEHi1xDmpHSHmdQnkfHxKbznE2b8wow9afvdxd6SoueWF79xudb4Jy6AD44oCgRnGNATx+ydm+PVdmEBxsauZMGeAQ4A2zvn1GwIpe8slp4/FoW5bAMyLuB8cC6Kgg/OgkE9H8fLn1wsx+e3bGV7NrR7rbEE+D0wCnwLyLYBCBhSCI3k7KWV6g8HLBS+LFzGgcNhkROsbpdAiLtzjXNbckUH7856m2z7QLp6/rxf4udmfLHd2fH++vRy9cev++R8ySwyYbc5aAaEtNoYQDBYCeiNdjYFAM6e/TjAdTMdAF1tp69CuVSPj53yyYUiRAIL1lywqz9rtmYBLJgpmGFCPUib2oZdBVY+P/8m8DNgORWoGo0kOf33evz6VXCku2WYIZnM3pNzkx3BAvT1ve8lHZT0O0l3KT1CEt5fnoiXD52TkpAC1AAniIF3HBx3udyNjq8nt27tpF5XsavLXgIelDTaGsJQWLhZW/7tqeBvLP+vxGXNhbcamRGQloErmF0CZor5fLU/Sdo6yNxhZ88+SDZrMrPzkBwAX/kgk81mdfRQq9VrfzqVJKduNt8VbDUCmYSTDKQGsARcE/w5ymR+KfjjvmvXJoDqcKnE9JUrnT1y3G5jY1N4f2PAuc3fh+79Zi5zW5nyjeTMmZXqyydCmI/NIgNMzXtOHViSKBq6buYmPdyS0VgpFHzvwABEEVPT03do40Pb7t3HzKz/Eec2vwq5z5m5ZqFszFxdWfrJ8UbytwXIREACFM1sHpg1s5kok7mBSEJo4BMvZSJ6+vr4x4ULLQR1j+zRR09glv2S2eafmmW3K1Qr8cqvjtdWDr9rli0Cs0j/Esz15HI3V2q12MyIslmG9uzhzUOH1h3jnsECjI4ezEkj3zPr/3ojOXciXnrpsA+LVw0rRGalma6upe1xTHdXFxcnJ9v2/yEfK+40aSD2/r2Xo6j7N95fKYqZgm4UY9txP5L4/MICfygUOvb/b4OFAZuQsv++AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowOTo0MSswMDowMPiypBMAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABfxJREFUWMOtmF1sHNUVgL9zZ3a9u97gXRITO4CwImhpAqXioQ2oeWgESPAUgRQk4AHEQ4uQqJAQP614QFVRItSi/tD0CRVo08gR/xAhkQRIIhMURJxAfm2vHdzY63g3Hv/P7s7c04dxCm7WYXbJkUZXmtl7znfPOffcc1doUn7/smJSgIHalUiiyApR2lBSCC4QKPiAN62Uc4IaB5al4Zd3SVM23WZh3Sz4g0hLF2sSo9wCrAduAjqALDADFIHDy4S9Fg78fC3H9h5Bm7XZ1BI3dyuidChsUrhP4GcxNB4AtonQLZaxJ+9t3HRDM7Z0Kwiiyg9RnkLYBGTizFUFEeZQug1ssYaTVtHfbIqP0FgaWATDtcDvFDYCblxTIqCQEXjAChlVfmuFAYifFqYhrxpyCo8BG0Xig/4PGFDBVbgbeMyx5J7fHj+FY8OiOMAG4EG+x8aU6HFRHgI2CDiXFPb5HYoa8gqPEu30C9eiYBVCC0EYjVaj90tIFviVFfJxvRvXQ0bhx8BP64V+YfNoZ57itZ04LUlylSpe3yhh8Rwdqoj830QRUOUWgRuBj4mRu7FgBQzK7UBLPVDAXreKcxtuglyWVqLQtq65hqndvZT7R1heDxhoEbgN2AcE3+mxWLCKEVhTL78UyGeZXL+W6VyWlfANbD7LyvU3MJ3L4tVzm4AjcINIPI54G0wRlA7q1GVVaGslvaKN5XX0mSvauDzXSlrr0wrCSiRevY+Xs5Gq1FKfHYMrSxgUocWYpXe8QjoWQ2zPRjK51DrmKsz4VUr1vvtVSvMVZpdynSiexCy1cWEt0AeEdTzH+CSp3gJWlelFXlOmDw2g45OkpT5tiHAKwcaBiFu6rEIPUdOyKKQiEISkDpxgpV9l+Cer8ZIJ2qs1xnsLVHsLXB2EJJeArRE1OJcQVrCqfCTKCMLqet71qyQPnqKrdwDE4KhlVS06HBxZKgeUEZQ9EtOzcdNAxTIKbEPrKxaJwPwaznwF/BrORUGjaP0LoYjEa2Zi9yKbtysq/EDgFYR1ceddRD4V4cG3/7Tx1OhwL8ZCaA2OY7EmKi0Z32d9scjWRmEBNndrgqhjehHobJZSVUfnZ849s+OP97wTzAwlAnCNxYTWGMexoTViBapp35/70eSUf6T9CjoTtuHuqQa8C9wMPA4k4gOe7wesPXNq/8mPtz+er0ydvdcYxzVgMIhjFEBNdDBavyUVHGpPTRg4OhpKX8N3i83dCtClyt+BOyTm6bOAjHd2oLB3x1PvFQufecZxRRcdXwrIwspAVQCswLxFP2zkUADg6egacpooFQYbmevPet6xT//ZUxw8OCHGVRArUdlaeCQaRSyIFVErgiiaQTXXMOwCsNZy7BJ4CWUuzhwb1oKvj+/5/MSBbYMipm4LdqGIoCoqMqLG9DUFC+BdSSjKPxTe0ov0oqqgqpTOfHX80K4/HwqDqo0BKkQ9tA8cNrDTpFJnmr6erDoMk2kmMgEviOr1CjfXgxCB2cmxscMfbe2ZKg3NccFvVEDO98WKYFGdA/oROQkMT6TTM221WkONzCJ54n4hHaAuHLFB7UW14fR5T357DGt+pe+LN3pOH9s9hsj58EfhVYyqgGoAzAJDCrsd131N4YM7h4aOAzNXex6F/v7m/uT4tmzpVrzSUD6zrP05N5F+RIxxvylTQTh8Yt/B/a8/88mMN+Ib4wggGl0bqsCsKhOCnhYxfSGMqxDMl8thaz4PjsNAobAoN763/PqFg5LOrLgxc9mKrYlk5lYRAyjeeGGw581ndw6f2FsyjusQ1ekJETkLjIrIsOO6Z1Bq1gaEtVDVdchks3z15ZcXptSlgAV4+qVB3GTynnS2/S+Ok+iszE1O9+75687ePX87atzkhMAoqv9RKGZSqbH5SsUXEZxEgqvWrWPXq69+p41LBgvwyHMfpC7vWPtsSyb/8Eh/zyf7dzy5bX723KCIKTsi3nAyOdvp+7Qkkxzr62tYf9PVoJ6kWpf7XnnoD8vd1L9LI0cnvFKhzNkpP9XVharyi1KJ98vlpvX/F5vAnOxV5r8nAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzowOTo1MiswMDowMAXwvhAAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABa9JREFUWMOtmGtoHFUUx3/nzkyym7R5tIlNfdCH9f0CLdoK/aCoICiUFkTUDxWxKoLQL0oREdEPikjxGaP9oLVW8IOo2GqpilqJlfporU2oaZKNaW3SZrOb12aSnbnHD7PV1O42s2sPDBdm773nd8/933PurFChvYxSBQhQCzIBTQL1QAJwgQDwFbIDkD4X1In6cjdSkU+3UthqIAvSCJfnYCWwCrgGaAHmAOPAALC/Bb5T2LMcOtpBK/VZ0RLfQgmhReAu4B7ghhgT7QG2WfjQwOBDFbgua0QrigERuEThCYW7BGrijC2EMwd8KPCChUMO6PoyEMqSQQDiwTLgWWC1lDG+gFQD3KdQI/CkC92UIQsTt2MbigcNwGPAaq1c7y6wRuCxPDS0liHh2LAKjsDNwDrArew8R1bYkfs1ms85q7BtKAKNwKMSnfRii0GBcMZz8l2J/nOAh4HGt2JGN+5WGuBq4PpSoIA2X8fAojtxqhtpmMqQ/fNTwhO/0KLRofxvdAFWClwFfEMM7caGVbhVovR6OqhgF9/B8MpNUHchtURbW3vRvYz+sIF06jPmFwMmmu8WYDdREZk1YrFgBS6niL4UqF/KyPLnGKu7kAXwL2zdMhYsf5axuqVkS4TNAa7UmBxxYYWoMhU9V3MXk5x3FfOLzGfmXcO8uiUkS82rsEBj5vty0k+i2EsFjIcrUtyhCNXi4ZQSpFByIadZ7NQFjJRwhj/E+FSGoWK/+8MM+SeYOEPosmcVVsEqdGmUkU6DHe4g0dmG1ZCxU8aFjHW+iWY6SZaADYE/ABuHI5YMFKxAO9Gl5ZRDJkCQI7HveRZMZ+m/9EGyXh3N+VFOdLQx3dnGBUGOqhKweaILTizYWMJuRUVgCbBLYGmRxQBgXEKvBsTFsQFhkAMb4JzBSY9EqSu1Hpk1z8bVrALHgG3FoiCFxwY4U6M4/jBMj+LMAmqB94nuvLFKWOwS34aicLHAu8CKuOPOYD8IrNvasvqP/up9GAuhNTiOxZootdT4PqsGBmgtF7YA7AFrgE3AwkopFT2WM8MbN5+39tO8SXkBuMZiQmuM49jQGrEC00nfz102Mur/1nwOCz1bNixEd9KngQ2AFx8wioxibSrx/Xfbmzd8Mu4c9x113EIFk0IPRUQBixKgZAwcFKNdZd/0CsCLFd4EbpOydkdJe909n89/4rMjiR+zDq4oM6tJYUmqhUYgykSTFt1VTlEAoPDt1KeRFHrLGTtpstl9c7e2H03szRhcBbESHbTCI1ErYkGsiFoRRNEaVBvKhi0Aawa+BF4n+q6a1ULyQXfy65/2z93WKxgk1oaIoCoq8pca01URLMBxCAXeAT7mDKknuoArg9W/d7Y3vPJrINM2BqgQXUt9YL+BHSaROFrx/waXRU0GeFHRS4Fri0EIMO4MDv5Y39qe9VK50yWuAoJqYW2CRTUHHEbkENCfSSbH6/P5si4yp1hBuwr8FpLfpIRjJ1/MbPP4UwfmfNR+OPnVIMjJ7Y+2VzGqAqoBMAGkFL5yXPc9hS9uT6U6gfELsll6Dh+u8H+cGdaGMuSkGuts8zOeJh8RjPtvmgrC3sTuvTubNn476v7lm6igiaoiItPAhCoZQftETFcIJ1QIJtPpsLaxERyH7p6ef3xVLIOZEd5o9mYdw+baoOk6T2tuFAygDLt9f+6tf/vnEfeIb9R1FM0DGRE5DhwTkX7Xc4+i5K0NkHyouA5Nixbx+4EDRSV1Vux5rxfHVq2tDZtfdfAW+jIytqfhtR176t84aKjKCBxD9YjCQE0iMTg5NeWLCI7ncf6KFXy5ZcusPs4aLMDjc79INE1e8VQybHygL9H+7c5zHt+WM8O9oibtiGT7q6omFvo+1VVVdHR1lT3//5bBTEsG8/2Mm3rJtYkPBqsPZoYTPWn6Rv1ky2JUlZuGhtieTlc8/98L/TvfZZ49dwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMy0wNS0yNVQwMDoyODo1OSswMDowMDPIuVsAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjMtMDUtMjRUMjM6MTA6MDQrMDA6MDATW3FEAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAABJRU5ErkJggg==",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABQpJREFUWMO9mNtvVFUUh7+1z5nOTKWUSsE2ahRUQiRootGIiQ++mJhIYoJ/gIlPPmhi4u3F+GR8MN4gBokaFRU0Jt4SlYSLQhSIKAhyibRMWy6l9xl6nTLnnJ8Pc4pFmOFMW1yTlZMz++y1v73WPmvtfYwZitD0WwOagUYgA/hAABSBAjAI/3YwbEZj+jOFnQZ5O7AKeAC4E2gB5gGjQA9wENgF7AWOTof+X0TlX4vQ00J7hZRA9wg9JXSd/g/eGNKElgt9KDSWEHRKx+J+y2M7VxXWhG4T+lKoVCPolJaEvhC6VWhmizehV5uE1s0CdDrw2tjeVYH1hNYIjcwSdEpHYnve1fBqs9COOQKd0q2x3UQcSVOXA+4A7q06p7vpYTUeTSwgT4HvCNlPC1RMrKuAlcDPzFVKE/KFXq24Vk2hVqtf7eqWNCopkDSqNnXrEfULRVXW7itCs833F8HWCX1bcdBbNKSDykkKdbGEOqCclmqoAmwU261LGt4kYlAlnDeTZSULL2PPcSfXsoRsFbvXQbL6W4v7MxVbUvgVC76RJkW1Nz5LQknqWYBzFVsGGCXPwGXbhhign7EqdgtzDRsBbUB42dajZNhARMjIRf+HjPAu4lhF74XA8dj+3EhcEJ4QmqiYMxs1qRfUrnadVJ8m1K6Tek7tmq/JKnl2IrY7d4Uh3hMsFTpRNcn7CjRfga6VNF+BfAVXKAonhJYk3SMkXQYCzgKbqoYswGMYjyFgGI+g6osVAZ9R3vMmKgiJdz1xSVwGfAzcN9MoTZM9wOOPtTx6fH/6T1wEYeTwvIjIlVNLfbHIAz09rI87JE5dhiHUAbwFvAm0zpRS6OyQG9qw5vo1/d2uc3HM4WINY6+fF4z3Z+uLyxYtpjUV1XYYir1bD7wMPAOkagWNiKJfM7/senbRM9/2eX1FX56vMqSVAy1hJiBCBIi8gyPm1FZTTY69Ow6sp3zeeogal1Iuletct+DtQ31eb5OHb7Lp1URlc1L5UuZvFSwJxdZaisIFYKCL8lLoqKXvOVcobG74dPfvmX15D1+GRVYOeaxWvppFYJGZIjNMqB5pQc2wMbCAbcA7wHiSPiVKwU/ZHb9vbtjU4XAJj+NmSCazbjnXNiPYWELgI+AbrpB6hDiSPnxs3YK1B87b+SgBqAFO5e8OBx384DKZM7PdR+aB14SWA3dVgujzens3NK7f3ZXqHL/0GRkYUjwvI0IaB9ox+xs4lc9mRxtLpZo2Mv+ZuhF79FCJ0psh4cjlnitSnPx63le7t2e39xo21a8cXuEkAykAxoBOwXbP9z8RbHm4s/MYMHpjoUCuvX12X2Ti7BB1e93fL4oWfeTknnS4CzZDgnBvZs+BTxs2Hg+sJA/PAJOEmZ03GJPIA13OrC2EfhnBcH9/eE1TEz8uXcqJXO7CeLM+ThjGPrevgOP95qD57nrV3+9wCNHld538oPG9P077p4u+fE+oBOTNrA84a2an/JR/BlGKogArhcL3aL7pJg7/9dclY83J2eee0j3qSHUcGnbDb6TD9BKHax224ZEvGj7/bVd2Z2+KurwZZ5FOC3qy6XTvxORksTxb44ZV97Ft48YEjplD2dKwJbNiYsVLTWHTE3syu3e+uPj5TXk31OHkBj2zwqm6urHWYpF0XR1H29pqtj93p0pgYbCw2Ol3vp6JMpsPp4/kc5ncoN81XGxsuRlJPDgwwPeDgzO2/w/IRTXCFJZFPwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMy0wNS0yNVQwMDoyODo1OSswMDowMDPIuVsAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjMtMDUtMjRUMjM6MTA6MTMrMDA6MDAaVk9UAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAABJRU5ErkJggg==",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABfVJREFUWMO9mE1sXFcVx3/nvnn2PI/leEZDHSNQ04gUUgGVQIIGqQuqgMSuYtEFRUoqNlRIlVixoKiqukIIwgZVhEr9CAS1Vj+Q2oJE+EijpmnTNiRNaxKnSWyntmM/z0wyiXnjmXf/LGZchXbGvHECR7q6i3vPub93znnnnveMDUq9XqfVaiGJarVqo6OjZTPbBOSBHNACEkm1hYWF5fHxcQE45xgdHd3QmbZR2DiOGRkZsXq9fhuwA7jTzG4HNgPDwBVgQdJx4BXgSD6ff6/RaKhUKv3/YKvVKmmabnbO3QN8B/hqBrUjwH4zewa4WCwW/7ewcRwTBIEBn5X0I0n3mNlQHyZWgGfM7KfAKUD9QOf6gfXem3PuM8AjwN1m1pe+pCEz+25n/rFz7n1AWfVd1o2VSoUgCEYlPQDcLakvUAAzo6P3bUkPeO9HK5VKZv3MsEBgZncBu4Gc2cbezY5eDrhP0l1AcENh4zhGUlHSD8xsuNseST1HDxmW9H1JxTiOM8FmDaUDvgh8pReomSkIgoUwDAMzG5VUazabaZqmmyVZj0jsAL4A/J0MuZvJs2bmgG8Agz1AfRiGy4VCgSiKCvl8PoiiqFAoFAjDcNnM1MPDg8BOM8uUCplhzey2Xkadc5eiKKoHQTAGFGjnYSEIgrEoiurOuVoP0wHw+awcWdPAaN9MXWPpnIucc0GXQ51zruScG0zTtJfdMTLW+37KT349O72S0swG6fHGd1SirAD9lK5LvRYkXZEU91iLJV1dR7e2TsXoH1aSlzQlqWss0zTNNxoNL6n+Eb16o9FQmqa9vJea2Wkz8zcM1sy8mR02s2aXNSTlkyQZS5Jk0Xs/671PvPezSZIsJkkyJmmwh+kmcCQrbKacdc75NE3/BsyZ2dZuwN77gSRJtjQaDWjn6Cc7l0KwtqeLzEn66w31rNoyD+yX1NVwx8OB9z7w3uO9DyQFZtYVtGPnd865BTI2M5kv+DiOMbNbgSfN7I6seus44LUgCHbvvvfe08dPnsR5SL0jCDzeGQYMJQl3LizwaEcnc+kql8tUKpVzwC+BPcD4dYDOV6vVX+/atWtp8cKFmzocrjNSwAOrgpWlaCi59RM3MR76/prvTjs3BDwE/BAI+wBcy23/xuuvv/LQgw/+YSmOk5xzObUhrR1oCTMBHtFCVB28a05TffWkpVKJSqWyAjwq6XYz+yYZU2ktb6enp8//Zu/eE0tLS8UgCExm1xhQ25zUntr844JbUvHnfi6FD4GBaTPbA5zLWtABLtVqtecmJg7/4+23q0EQyMy8tUPeGdaezTyYN5M3w4SGkEb7hu0Aa3h4+ADwKzNbyaLTarVahw4devO5Z58955wjW/NuhmQym5NzUxuCBQjDMDWzJ4AXtI571xrwycnJycf27j22urrqM4Aa4AQJcNzByy6f/6Dv76g1qdfrrK6uVsMw/JmZfU7Sl7pBmBmLi4sXn3z88cMXZmdXPr5HBkbncYXhkVaAM5idAmarUXRlU7PZVyPzHzIyMkIYhnLOnWg2m3vSNK2vefLaudFoNF5+8cXDhw4evHjNBdEOr3CSgdQCrgLnBX8Jcrl9gj996/z5SeDKp2s1zp4509+n+EelVCpRrVb9/Pz8S+Vy+Qnn3P3Oudw1ZSp96+jRYxNPP3261Wqp88/BOuurBlclqsC0M5tKYUlG6/LSUlooFvnj1q28f/bsh+ddFyxAsVjkwIEDNUmPlcvlL0dR9DXn2gGbnZmZ+e2+fW/Nzc0luVwukNQEqma2CMyb2WwuzH2AaHrfwpqpyAWUb76Zk++887GzrhsWYOfOnTp27NiJer3+i4GBgVucc+OXL1+uv/D882+89uqrF3MDA1WDeaQLgoVocPDivxqNBAAzPrXjDg489dR/PWfDP+a6ycTERH779u0/2bRp0/fePHr04CMPP7y/Vqudc2bLgVltdmDg6niSMDgwwHtTU33bvyGeXZNSqZTMzMz8fNu2bb//5+Sp6vT09HJQqyUjW7Ygia/HMS8tL2/Y/r8BRVECE4yt2dgAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjEwOjMxKzAwOjAwz+xZAAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABihJREFUWMO1mF9sW2cVwH/n+6597aRVbLykf0S0iiJGpwLSGkGHtAcmQOINDWlIEw9DvIAmTeKhoAnxgHhCCFVa1UIRDxBEkaZ1He2YUCnQDalUqdextmvnpUs60sVxbMdO4tROfO93eMhNadO4vXbLka6u7v3uOefn853zfeez0KMUCgWazSbOOWZnZyWXyz0EDIhICvBUNRCRFlDPZDLVubk5tdbi+z67d+/uyafXK+z8/Dy7du2SQqHwaC6Xexx4AvgcsBXYBDSAGeCder3+pjHm7NDQ0OVSqaS9+pRelPL5PM65rcaYp4FngC9s9J3q/7hE5CxwREReUtXSyMjI/xd2bGwMa62o6iOq+kPgaaBP5N5mVBURuQG8BPxMVQvGGN2zZ09s/12lQRiGYoz5JPBT4OsiEls/+kF9qvotEekTkR+JyAdA7LQw3UTV87yMqj7fLeg6aE9VnwKeV9VMPp+PrRsbVkQs8CTwLPdRmGvAwLdV9UlVtQ8UNiqoLPAcq5V+h6gqqopz7ua19q6DbAK+a63Njo2NxYKNGyFjjPmsiHy+Eyig/f39MwMDA9bzvEwQBPX5+flwaWlpq6pKhyJ8PAzDzwCniZG7sWBV1QBfUVV/vdMI1GUymbnh4WF83+8HLNCfy+UWpqamqvV6PbcRsKr6wJdF5J9AcM+IxY0s8GgEcYekUqn57du3L/q+vwW4Cev7/pbofb2DXQvsjssRK7JRSLbSYV1OJpPpdDptN3Bq0un0x3zf95eXlzc0DWwh5nrfTVWnNnoZLfZep6QUEV9EbPTd+jGAdFyA2EsXMN8BhiAIGkEQVDYaD4KgEgTBUqddTlXrd1kxuodVVaeq40C40Xiz2UyVy2Wnqovr9BbL5bI2m81O0QtF5H0RcXE44qaBA86o6jPR5nBbZJ1zqVKptCUMw6nBwcG6MWbQOVcul8srlUpl2DmX3CiyqtoGzkb2Hwysqjpr7T+cc9PAJ9aPR6mQLJVKOyqVCqxW+fYwDFFV2ykFRGQa+HsYhrFg4+ashmFYBI50ioKIoKo2CAIbBAFBENi7gUZ2/gDMiEispI3dIkbt4adU9XfA3rh6d5F/WWuffWHfvvcL4+MYB6EzWOtwRhCgr9XiiZkZftktLMC5c+cSIvIUsB/Y1iulqhYXFhZe+MG+fccXqtVEAJ5xmNAZY60LnREnsJJutW7sml9oXRgcYlvCddc9iUgbOAE8BnwfSHQBuFaM7uKFC4WDL76YrdVq37TGeAYMBrFmtccwq32Ca/mp4O3BVM3Au8VQxrs+1kT95w7gV8BXu52d69evTxw+dOi1K5cv1z3PE73NQPSkGt0EwAk0HfrXbjYFAKKz04equl9VJ7vRXVxcrJ86efJM4b33atZajUAcNy9ZvYs4ECeiTgRRtA/VTNewEbA2m81TwEFVvRFHJwiC4Hw+nz918uSkiBDn3AYiqIqKTKsx4z3BAjQajVBEfisir3KXXnStAZ+cmLhy9OWX32632y4GqABGoQW8Y+B1k0p91PPxZGhoiGQyWVtZWfm5qn4aeGwjCBFhbm6u9Kdjx87MFIs37vxGBYSoPVAEx+psXUWkAEzV0unGQLvdVSNzm4yMjNBut1VVLwRBsN85t7gWyVvvK8vLy2+ePn3mrXy+dMv0r06vYlQFVANgCbim8Dfreb9X+MvXrl27AjSG63Umrl7t7U+OWyWfzzM9PZ3NZrM/8X3/e8YYb22ZUtXw3+fPn/v14cNvVCuVljFGAInGV4AlVWqCfihixkMoqxA0q9WwP5sFa/lgYuKmr/s6pa5FeHR0tC4iv8lkMntSqdQX16a6WCz+57UTJ94qz862rLU2alxqIjILFEVkykt4H6G0nQuQdqh4locefphLFy/emVL3C7smx48fJ5FIfCObzR7wPG9bo9FYfPWVV14/dvTou14iURMoonpdYaYvlSo1l5dbIoJNJPj43r2cGh29p48HBgtw4MCB1M6dO3+8efPm71y6eOmNw4cOHllYXJw0IlUrUp9KJpe2tVr4ySSXx8e7tn/faXCrZDKZVqlU+kUymfzj5ORkbbpYrJpqtbVpxw5UlS9VKvy5Wu3Z/n8BcY8RVtNG93EAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjEwOjQwKzAwOjAwY15brQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABh5JREFUWMO1mF9sW3cVxz/nd23Xf26bhFGaNEyNKrTB0lFpD9Ah7QEESPRpAimVKA9DvIAmTdoTQoiHiidUsWpCZTxVMESJHG3lb4VEl64gteWPuiZjTZrUdqZQ203sxk7s1H/u/R0e7FTpZqfXXvlK1pX98zm/zz3n/H6/c6/Qp86cOUM0GsUYw+joqOTz+Y+r6oCqRkUkBHhADSipalFE1HEcYrEYR48e7WvOUL+wruuSyWRkbGzsqVwu9yzwHHAYGAZcoALkgRkR+RtwdXx8/Mbs7Kz2O6f0Y5RMJlHVYWAC+Cbw+fsOpavLq8BZEUlaa+8cO3bs/wubTCYREVHVJ1X1+yIyAcSD2KoqIrKpqkngJ8aYm6qqExMTgefvqQystWKM+RTwY+D5XuzbEY8D3xKRuKr+UERSQOCyML1E1RgzCLwEPN9eRD2rbfd14CVr7eDk5GRg28CwquoAXwJe6CWiXRRS1W+3/TmPFHZqagpjzBDwIq2V3ulmUFWstfi+j7X2/m9d5ALfFZGhoNENGiEDfBb4XDdQEdGhoaH8yMiIE4lEBhuNRimXy/l3794dVlX54C4hIqjqs8DTwNsEqN3AsKr6FWBXJ1DA7t+//+7hw4dxXTdBK7WJAwcOrF+/fr2YzWYf6wTc9vdl4O+0DpGHRuyhUlUDPEWX+nJdtzw+Pr7huu4+4D6s67r7Dh06tOG6bqmLawc4JCKBOILCSvsQkA5jJBKJ2MDAwGMd/JmBgYGPJRKJWKfalZb2yQ4nyXYFKoO2r2jXOzYm1G1CEdlljNlpxceCMASObFvlbgP1er3SaDQKncYajUahXq9Xu9mqammHHaMvWAssAn6HyFEul6PpdNqq6sYHQDZSqZSWy+VYl8D7IrIgIjYIRNDdwAKXaTUtD6RURPB9Pzo/P7+v0WgsHzx4sBQOh/c2m83VdDrdSKfTj/u+H+kC26TV4Dw6WBGxqnpRVbMicrBTdBuNRmRhYWEslUphjHGstfvbh4PTbf2oalZVp4NGNmgZqLU2B5xV1Y6ORQRrrdNsNp16vU6z2XR2Am1H8zcikheRQEUbuEWcnJxERJ4AfiUiR4La7aArIvLCz199dWFpeRljwbcGx7FYIwgQr9V4Lp/ntV5hAZLJZJhWx3QKGOmXUlVzlUrlB6deeeUP9Uol7EHIWIxvjXEc61sjVqARq9U2P1Ner83u/QQjYdtz99QE/gg8A7wMhHsA3OoH7OLCws2pycmh6vr6MceYkAGDQRyjAGpafYKt7Yp67+yNrhl4L+fLYs+PNclkEmBMVX8BfDXo6bOllZWV9JtTU3/KpNMlx3FE2Z7e9jfV9kUArMA9i/61l0MBgPZjyPu0SiHTi+1mtVr655Url5cymTVjjLZBLPc/0rqKWBArolYEUTSO6mDPsG1gHRwcvACcVtXNIDa+73vzc3P//sfVqxkRIVhCRFAVFcmqMYt9wQKMjo76qvpL4Hfs0ItuNeDZ27fn3rpw4R3P82wAUAGMtt47zBg4b6LR230/nszMzBCLxdY8zzupqp8GnukEISKsl8t3Ll28eLlYKGx++D8qILTbA0WwtLJ1C5GbwPJaLFYZaDZ7amQe0PHjx/E8T4FZz/NOWWs3tiK5/dpsNuvXrl27PHfjxp1t6W+lVzGqAqoeUAWWFN5yQqFfK/zla0tLc0Dl8VKJ9K1b/b3k2K5kMkmhUBjavXv3iXA4/D1jTGjbNuUvzM//69wbb1wqlUo1Y4wA0h5vAFVV1gR9X8Qs+rCqgnevWPQTQ0PgOKTS6Qdq4yPr5MmTEo/Hn96zZ89rkUjkC1upXl1dzfz+3Lnzi/PzBeM4Dq19ek1EVoCciCw7odBtlKa1Hn7TVw05xF2X/7z77odL6lHAApw+fZpIJPIN13V/5jjOyL3NzY2L09Pn356efs8JhdYEcqj+VyEfj0bv3KvXayKCEw7zySNHuPD66w+d45HBApw4cSI6PDz8o3g8/p3UrdSlN6eSZyvVasaIFB2R0nIkUh2p1dgViXBjcbFn/x/1ZcUDSiQStWKx+NNQKPTbbDa7tlooFGVlpRYfG0NV+WKhwJ+Lxb79/w9bQvQtKYEySwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMy0wNS0yNVQwMDoyODo1OSswMDowMDPIuVsAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjMtMDUtMjRUMjM6MTA6NTArMDA6MDCv9FszAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAABJRU5ErkJggg==",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABjJJREFUWMO1mE1sFOcZx3//d9beXePixQvCpFSp0qopNGlFKlGn2EhF5VIulSqlUsQhqDduPfClqqdeiEJPPeTApY1UKuVUCcIhaikpBrxRKEmJ7RrMR7CNd8GuP3a9O/bszNPDrhE4Xjy7oY80GmneeZ/nN8/832eed0SLduLECaIoAqCtrU1BEGw2sy5JKSBhZlVJPjCXyWRmZmZmLIoiisUip0+fbilmolXYarVKKpXS0tLSziAIXgf6gR8APUAnUALywGdzc3P/dM4NDgwMDO/du9dajalWJh09ehQz65H0hqQ3gR+ZGdLT7sye4hoEzpjZ+2ZWOHXq1P8X9siRIwCS9DJwDHhDUkfc+WZWBt6Pouht59yoc85OnjwZO36zMhDwbeB3kn7e7HxJHWZ20DnXIek3zrnbQGxZeE1mdZOk48BBSS3pXZKrvxnPzAb7+/v9gYGBWHNdE3E8YB/wVqugT1gCOATsM7PYCYt14/HjxwGykt4BXl69kKC2mMyMMAyJouhxWatncy237UC3c+6Dvr6+cpzsxs2Qk/R9YPdag/VKYNu3b8/v2LHDS6fTmUqlMjcyMhJOTEz0mJkaAL9uZq8CF4mh3ViwZuaA/UByLVAg2rlz538PHDhANpvdQO2Nbdi1a9fCuXPnZoaHh7MNgJNm9lPgElBdN2NxYc1sJ2vIxszIZrPz+/fvL2az2a3AY9hsNru1fn1uVc1dMc/MXqknY12LdZNq1sMaddnM6O7uTvf09GTX8Oe2bdvW3d3dnW4AK0lbG2lktTWzqlMNn9i5RKOAkpLOuWct5HRcgGZK13yjgXK5XKpUKtMNxqYXFxcX1xqrV5BGEmkZNgJuAeGXHDhHPp9P5XK5KIqi4lOToqg4ODhohUIh7dyaoULgZt3/uhZXBhFwBXiTVYtMEkEQpC5evLi1UqmM7969ey6VSm3xff9RLpdbzuVy3wiCoL2BSgJqDc7zhZX0DzN7ALy0elASlUql/dKlS98cHBzEOedFUfRCEASEYeg9Y/08AC6YWSzYuDIwM5sCzjTKgiTCMPR83/fK5TK+73vrgEaS/kyt540l2tgt4rFjxwC+A/wJ6I077xl2VdJbFz788OajmRlcBGHk8LyIyAkBHb5Pfz7Pu/UJsZuIy5cvs2fPngVJ88Ae4GutUprZ1NLS0tvnzp69XikWN0bQJaPLTBnnrNOkTkEyUa3SEUZh9YWv65XNG5vrniQFwFngNTP7taS2FkCjQj4/+kkutynw/V86KeHA4ZDnDMBcTRaRn0xVr29JzToYmgp1K3ZmV7Lb19cXAGOSvgd8iyZ3G8WFhbv//vTTSwvz83LObTRpg6SO2mG1s9kGiU7QRsRmxEshlJqCfQJ4HngE7DGzTTG/liwvLc3dGh39+8T4+ANJSDLVslg/VDtLBjKp1v0Y1oZZoWnYFeB9+/bdq1arDuiPI4coiqqTExNXhoeGblitBYsRScJMJj0wKdfM5/Ypy2QyoZn9UdJfWaf0mBmzs7Mjw8PD18MwjGKACnAGPvCZg/MulZpseXsyOTlJV1fXbLlcfsfMvgu81gjC9/3CzZGRK4vFYnmNRxGIentgiIjaLngMaRQYn02nS11BEL90rbarV6/S29uLmT2MomgR2C8pufL/YOUcVqtLd27fvnBnbOwOPN7i1F4vciCEVUEVYNLEJ4lE4mIURUM/++KL/Fgms7xlcZGR+/dbhwUYGBigr6/PSqXSuOd5m5xzP5TkngAOHxYK14Y///xfQRBU622kq+8aAokFYEpww8l9FEk5k+4vTk8X29Pp6lg2y+1798iXSo+18ZXt0KFD6ujoeDWZTL6bSCR+vCKH4sLC3evXrp0v5PPTkjxqjcuspIfAlKRxL5GYxAiiqEoYhGYJj47OTj6/ceNLcZ4LLMDhw4dxzv0inU7/wTm3bXl5ufifoaHzoyMjQ87zZoEpzCYM8h2pVKGytORLwmtrY3tvL3977711Yzw3WICDBw+mMpnMb5PJ5K8eFgofXfv44zNLy8t3BTOeNDfe3r64zfdJtrczfOtW0/6/6s+KpyyZTPqlUun3nuf9ZW5ufnaxXJ6JJif95IsvYmb8ZHqaD2ZmWvb/PzZaBDRi9tDdAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzoxMTowMCswMDowMAjWPmkAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABixJREFUWMO1mE1sVNcVx3//+549Y2MMDkTMTBHCNgpVmlApi2IagVQ0SFVXlYpSKcoC1BXLrlKp6qLqKoq66gKpqzZSqciGSnXYuEVJIwWjVkIRkAhMBtt82MYej8fz4fHMe/d0MQZR8Mcbhx7p6S3uu+f87rn/d+55T2zTTp8+TbVaxXtPqVRSf3//XmCXpDQQAhHQMLOl2dnZYjabtTiOWVlZYXx8fFsxw+3CLi4ucuTIEd28efP1/v7+Y8Bx4PtABugDqsAs8GUmk/mXmY1PT09/NTg4aNuNqe1MyufzeO8zzrl3gHeBo1vNMbNx4IKkj733c1euXPn/wp48eRLnnIDDwPtm9g7QKyV2Uzezj83sA0m3nXM2NjaWOH5HMjAzmdkhSb8DfiqpUxn1Au9J6pX0a+AbILEsgqQP5vN5gAFJv5L0npmFHWT0qUlykg4DgaTx4eHhRqFQSDTXdRAkkHQSOANsC/QZC4GzwElJiROW6MFTp04RRdEeSR+uZeUFMzPMjCiKiOMY7z1PFrTBwrqBV7z3nwwPD9eTZDep5pxz7oikH2wECtjhw4dnR0ZGgp07d+6uVCpL165di+/cuZMxM60HbGbHgDeBT0mg3USw3nsHnDKz1PNB10D9sWPHFs+dO0cul9tBe8d25PP55fPnzxevXr26Zz1gSSkgD3xO+xDZPGNJMwu8zjqyMTNyuVz57NmzlVwutw94CpvL5fadOXOmks1ml9YW9bwFwBtJORI9pLZl1ttL7z2ZTKZncHBwzzr+3NDQ0CvZbLbHe7+ua2AfCet9J3UyvaGTMAy1wVskKRUEwWYvck9SgMSlCyhvAEO5XK5Wq9WF9cYrlcpCuVyubVLqll4qrJl5M5sws/gFB84xOTmZHh0d9d77yrNj3vvK6OioTU5O9ji3bqgYuAN4EliiOjs0NCRgD/Dj549YSbRarXBiYqKnVqvNZDKZmvc+tbi4OHPx4sXlS5cu5er1emoD2CbwR+B6oVDYsnQlEnY+n5eZDQJjkoY2yD5hGMapVIogCII4juPV1VWiKAo2kUAByEuaHBsb2xI2qWYNmJF0gU22LIqioFarBcvLy9RqtWALUA/8RdIsCZuZxAd8Pp9H0mtm9mdgJOm8TeyqpDOPpqfv1BsNnIfYO4LA450Q0NtocHx2lvNrExI3EYVCgcHBwWVJZeBtYOe3AJ2J4/iDyXv3rvtWq9/DLhm7zLTbOeszqU+QCqOI3tjHUe47emNvf2f9qKQW8Hczewv4paSuTinNzDdWVm7Pz80NEMc/NwgdOBwKXLvHcG1Z+EYqHV1/NV1ycGsm1kTizD7J7tDQUAu4K+l7wDAdSMmAVrN5b7FY/LzVbEpSv0k71prxXsnad7MdEn2gfsRexFAM1Y5gnwAfOnSoDMwDb5vZQNLe1sfxUmVp6Z+1avXR2k6Z2mtYu9S+SwYyqd39GNaF2VzHsE+ADxw4MCnJAceTyMHMolq1+kW5VLph7RYsQSQJM5n0yKRrnRy3/2NdXV2xmf0J+BtblB4zY3V19eulUum6994nABXgDBrAlw4uu3T64bb/GzSbTXp6ekpRFH1oZt8F3toIwsfx3HKp9EXUbNbXWYpArHWQhvCY1YG7SLeB+6WenuquVit56XrepqamOHjwIMBjM6tJOrXWTD/NpiTM+9Xl5eUrlXK5AE8/cdrbixwIYRFoBXho4j9hGH7qvb/1k6mp2bu7dzdfrdX4enp6ez85nrV8Pk+j0Rjo6ur6rXPunKTwKahZ3KjX/73w+PFnURQ11tpIrY03gZoZJWFTkpuIYd5EtFIsxjsGBiAI+OaZb7NvDQswMjKi7u7uN8MwPC/ph0/k0Go27xXn5y+v1OsLtA+gFlCS9Jj28X0/CMOHGC3vI+JWbBYG9Pb1cfPGjRfivBRYgBMnTiDpZ2EY/kFSNo7jSnlx8fJSqXTLOVcCZjB7YDDbm07PrayuNiQRdHWxf2SEf3z00ZYxXhoswNGjR9PpdPo3QRD8olFf+aw4//hCFMf3BMVAWrrf3V3LNhqkurv5amKiY//brgbrWRAEjVar9Xsn99dms1WKvC/6Bw8awf79mBk/Wljgk2Jx2/7/C8D87PcyjeWGAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTI1VDAwOjI4OjU5KzAwOjAwM8i5WwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yNFQyMzoxMTowOSswMDowMJ1Oe7oAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",anchor:[.5,1]},{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAgCAYAAACLmoEDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH5wUZACIpx2TIswAABNVJREFUWMO9l8trXHUUxz/nd+/NPJK5k5kmzbRG2iRWijZmESit0qUbaVb+A0JXLhRclK5EVETcuNCFLQhiF4K4asFVtbT1UZ8JsSbBzjQ1qU3zntQkzCRz7z0u7kRazKSTzI0HDhd+j+/5/n7n/M45V4hGBGgD0kAcsAEPKANLwAKgURhpdP9TwHHgBNAH5IAWYAWYBoaBa8APwGgUpHciOeDVKgmtQ68DrwAd/ydJAQ4DnwCrdRLd0NXqvsM07tW6iB4CvgAq2yS6oRXgc+CJ3SacAT5sgOiDhD+o4u2KWMCLwHKDRDd0uYpn7QbZNuByREQ39FIVty6x61xngGeAo1us0f7+/umBgQErk8m0FovFpYsXL/qDg4M5asfmcaAXuEKEKc0G3qVGrIqIPzAwMFcoFKZUdUVVPVVdyefzUydPnpwDAmrH7jvbuLS6pAm4UMtoT0/P4vDw8Liq+vqw+ENDQ+Pd3d2LNcgGVdymekiYOskKYRHY1J0HDx5M9Pb27tkEz/T19WW7uroSW+B2UGcK2871x2tNOI5ji8imBkUk5jjOVi8+QZ1S780C3K81MT8/v1IsFuc3m1tcXJyfm5tb3QJ3KWqyAZAH/M0mR0dH4+fOnQt8319+cNz3/eWzZ8/q2NhYrdvzgZtV/MjEAk4BJWrkzHQ6vXbmzJlCoVCYnJ2dLRUKhcnTp08XXNddo3aeLVVxIy0MAnQDt7YwrLZte67retlsVl3X9Wzb9ti6KNwCutiFHiEBvE3ouiiqlw+8xTYe2HZP9CTwKXAsgsNfB156PJe7acdimAD8wGBZAYERBEiWy5yYnuaj6obtxsrfhFnhOSDVANF7xpj3Ojs7h+KO4waQFiWtKq3GaIuKtAjEbM8j6Qe+t/8xOdLmyk5iJQm8AbwGODvYHyTj8Wt729sv2JZVRtXWMCtJ6GhVRMLqpngoRQMjYjS/k1dYAQrA00AP2wwlx3Fut2Wz38SamgRwVaRZRJKhavhVbRahBcRFaEPo9mFlpynjPjBHGA51N9DGmKVMOv11qrl5qjqk8tCjk/AroiAqoioioqiD6kwj+e1PQvedoL5w8FqSye/3ZDI3JHRzHSKCqqjIlIr82AhZBf4gzL9HeEQ4xGOxkfZs9lvLstbrYQkYhbLAqIhckXj8bqOVo0yY2I8C+2otsixrZk8mcykRjxc3ObOAiGr1sEKA6iowgsh3AoPFZHI+5nkaRZmbJfzFfh6IbXJFa67rXk6nUuMPNGahexEDgqAeSAm4q8Ivtm1fCYJg5IWJielCa+t6++oqY5OT0ZQ5y7IyQRC8qaov83Db6Sfj8Z/3trVdtW27HHJHVBURWQdWVSkKOiFi8j7MqeCVFhb85kwGLItb4+P/gkXyO2GMWTLGfOx5Xr+qPrsx7tj2ZGs6/att22VVtQjTXlFEZoF7InLHduy7KJUg8JCKr9gWbQcO8PuNG/+xEwnZSqWijuP8Zox53/f9LmCfEVl2U6mfkonETJXgPVT/UphOxGIzpbW1chgQQufxY3x1/vwj7UTa7aRSqXipVHrd9/1TyXjiasfe9s+MMbdRXbBElu40Na3uK5eJNTUxms9vGz9SsolEAlXNVtYr+9NuupjraF+oTEyUNZfDAIeWl/lyYWHH+P8AZ0RW2q2R2psAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDUtMjVUMDA6Mjg6NTkrMDA6MDAzyLlbAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA1LTI0VDIzOjExOjE5KzAwOjAwUeR7JAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",anchor:[.5,1]}]},logger$u=LoggerByDefault.getLogger("DrawingDOM"),DrawingDOM={_addUID:function(n){var e=this._uid?n+"-"+this._uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPdrawing"),n.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",n},_createShowDrawingPictoElement:function(){var n=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowDrawingPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowDrawingPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-drawing fr-btn fr-btn--tertiary",e.setAttribute("aria-label",this.options.labels.control),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowDrawingClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowDrawingClick(s)}),e},_createDrawingPanelElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPdrawingPanel"),n.className="GPpanel gpf-panel fr-modal",n},_createDrawingPanelDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__body fr-modal__body",n},_createDrawingToolsDivSections:function(){var n=document.createElement("div");return n.className="gpf-panel__content fr-px-3w fr-modal__content",n},_createDrawingButtonsPluginDiv:function(){var n=document.createElement("div");return n.className="container-buttons-plugin fr-mx-2w",n},_createDrawingPanelHeaderElement:function(){var n=document.createElement("div");n.className="GPpanelHeader gpf-panel__header fr-modal__header fr-m-1w";var e=document.createElement("div");e.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",e.innerHTML=this.options.controlLabel||"Annoter la carte",n.appendChild(e);var i=document.createElement("button");i.id=this._addUID("GPdrawingPanelClose"),i.className="GPpanelClose GPdrawingPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",i.title="Fermer le panneau";var s=this;i.addEventListener?i.addEventListener("click",function(){document.getElementById(s._addUID("GPshowDrawingPicto")).click()},!1):i.attachEvent&&i.attachEvent("onclick",function(){document.getElementById(s._addUID("GPshowDrawingPicto")).click()});var o=document.createElement("span");return o.className="GPelementHidden gpf-visible",o.innerText="Fermer",i.appendChild(o),n.appendChild(i),n},_createDrawingToolsSections:function(){var n=[];return this.dtOptions={},this.options.tools.points&&(this.dtOptions.points={label:this.options.labels.points,active:!1,panel:"draw",id:"point"}),this.options.tools.lines&&(this.dtOptions.lines={label:this.options.labels.lines,active:!1,panel:"draw",id:"line"}),this.options.tools.polygons&&(this.dtOptions.polygons={label:this.options.labels.polygons,active:!1,panel:"draw",id:"polygon"}),this.options.tools.holes&&(this.dtOptions.holes={label:this.options.labels.holes,active:!1,panel:"draw",id:"holes"}),this.options.tools.text&&(this.dtOptions.text={label:this.options.labels.text,active:!1,panel:"draw",id:"text"}),this.options.tools.edit&&(this.dtOptions.edit={label:this.options.labels.edit,active:!1,panel:"edit",id:"edit"}),this.options.tools.display&&(this.dtOptions.display={label:this.options.labels.display,active:!1,panel:"edit",id:"display"}),this.options.tools.tooltip&&(this.dtOptions.tooltip={label:this.options.labels.tooltip,active:!1,panel:"edit",id:"tooltip"}),this.options.tools.remove&&(this.dtOptions.remove={label:this.options.labels.remove,active:!1,panel:"edit",id:"remove"}),(this.dtOptions.points||this.dtOptions.lines||this.dtOptions.polygons||this.dtOptions.text)&&n.push(this._createDrawingToolSection(this.options.labels.creatingTools,"draw")),(this.dtOptions.edit||this.dtOptions.display||this.dtOptions.tooltip||this.dtOptions.remove)&&n.push(this._createDrawingToolSection(this.options.labels.editingTools,"edit")),this.options.tools.export&&n.push(this._createSavingSection(this.options.labels.export,this.options.labels.exportTitle)),n},_createDrawingToolSection:function(n,e){var i=document.createElement("div");i.className="drawing-tool-section fr-mx-2w";var s=document.createElement("p");s.className="drawing-tool-section-title",s.innerHTML=n,i.appendChild(s);var o=document.createElement("div");o.className="drawing-tools-flex-display";var l=this;function c(g){l._handleDOMToolClick(g,this.id,l),l._handleToolClick(g,this.id,l)}for(var u in this.dtOptions)if(this.dtOptions[u].panel===e){var f=document.createElement("button");f.className="drawing-tool fr-btn fr-btn--tertiary gpf-btn--tertiary",f.id=this._addUID("drawing-tool-"+this.dtOptions[u].id),f.title=this.dtOptions[u].label,f.addEventListener("click",c),o.appendChild(f)}return i.appendChild(o),i},_createSavingSection:function(n,e){var i=document.createElement("div");i.className="drawing-tool-section drawing-tools-flex-display fr-m-1w";var s=document.createElement("button");s.title=e,s.className="tool-form-submit drawing-button fr-btn fr-btn--secondary gpf-btn--secondary fr-m-1w",s.id=this._addUID("drawing-export"),s.setAttribute("type","button"),s.textContent=n;var o=this;return s.onclick=function(){o.onExportFeatureClick()},i.appendChild(s),i},_createMarkersChooser:function(n){var e=document.createElement("div");e.className=n.className;var i=document.createElement("input");i.type="checkbox",i.className="gpf-custom-dropdown-toggle",i.id=this._addUID("gpf-custom-dropdown-toggle"),e.appendChild(i);var s=document.createElement("span");s.innerText="Slectionner le pictogramme :",e.appendChild(s);for(var o=0;o<this.options.markersList.length;o++){var l=document.createElement("input");l.type="radio",l.name="gpf-dropdown-radio-style",l.value=this.options.markersList[o].src,l.className="gpf-custom-dropdown-display",l.id=this._addUID(`gpf-custom-dropdown-display-${o}`),e.appendChild(l),o===0&&(l.checked=!0);var c=document.createElement("label");c.htmlFor=this._addUID("gpf-custom-dropdown-toggle"),c.className="fr-select GPselect gpf-select",e.appendChild(c);var u=document.createElement("img");u.src=this.options.markersList[o].src,u.alt=`Option ${o+1}`,c.appendChild(u)}var f=document.createElement("div");f.className="gpf-custom-dropdown-options",e.append(f);for(var o=0;o<this.options.markersList.length;o++){var g=document.createElement("label");g.htmlFor=this._addUID(`gpf-custom-dropdown-display-${o}`),g.className="gpf-custom-dropdown-option",f.appendChild(g);var H=document.createElement("img");H.src=this.options.markersList[o].src,H.alt=`Option ${o+1}`,g.appendChild(H),g.addEventListener("click",()=>{i.click()})}return e},_createStylingElement:function(n){var e=document.createElement("div");e.className=n.className;var i=document.createTextNode(n.label);e.appendChild(i);var s=document.createElement("input");try{s.type=n.type}catch{s.type="text"}if(n.type==="range"){e.dataset.frJsRange="true",e.title=n.label;var o=n.defaultValue;o=Math.round((o-n.min)/(n.max-n.min)*100),e.style.setProperty("--progress-right",o+"%"),s.addEventListener("change",l=>{l.target.parentNode.style.setProperty("--progress-right",`${(l.target.value-n.min)/(n.max-n.min)*100}%`)})}return s.id=n.id,s.value=n.defaultValue,n.title&&(s.title=n.title),n.checked!==void 0&&(s.checked=n.checked),n.min!==void 0&&(s.min=n.min),n.max!==void 0&&(s.max=n.max),n.step!==void 0&&(s.step=n.step),e.appendChild(s),e},_createStylingDiv:function(n){var e=document.createElement("dialog");e.className="gp-styling-div gpf-panel fr-modal gpf-visible GPelementVisible";var i=document.createElement("div");if(i.className="gpf-modal__body fr-modal__body",e.appendChild(i),checkDsfr()){var s=document.createElement("div");s.className="GPpanelHeader gpf-panel__header fr-modal__header fr-m-1w";var o=document.createElement("div");o.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",o.innerHTML="Modifier le style",s.appendChild(o);var l=document.createElement("button");l.id=this._addUID("GPdrawingStylePanelClose"),l.className="GPpanelClose GPdrawingStylePanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",l.title="Fermer le panneau",l.addEventListener?l.addEventListener("click",function(){n.applyFunc.call(this,"cancel")},!1):l.attachEvent&&l.attachEvent("onclick",function(){n.applyFunc.call(this,"cancel")});var c=document.createElement("span");c.className="GPelementHidden gpf-visible",c.innerText="Fermer",l.appendChild(c),s.appendChild(l),i.appendChild(s)}var u=document.createElement("div");u.className="gpf-panel__content fr-px-3w fr-modal__content",i.appendChild(u);var f=document.createElement("div"),g=null,H=n.geomType.toLowerCase();switch(H){case"point&text":case"point":g=this._createMarkersChooser({className:"gp-styling-option",defaultValue:n.initValues.markerSrc}),f.appendChild(g),g=this._createStylingElement({type:"range",className:"gp-styling-option fr-range fr-range--sm",label:this.options.labels.markerSize,title:"petit, moyen ou grand",id:this._addUID("markerSize"),min:5,max:15,step:5,defaultValue:n.initValues.markerSize*10}),f.appendChild(g),n.initValues.markerCustom,H==="point&text"&&(g=this._createStylingElement({type:"checkbox",className:"gp-styling-option",label:this.options.labels.labelDisplay,id:this._addUID("labelDisplay"),checked:n.initValues.labelDisplay,defaultValue:n.initValues.labelDisplay}),f.appendChild(g));break;case"text":g=this._createStylingElement({type:"color",className:"gp-styling-option",label:this.options.labels.fillColor,id:this._addUID("fillColor"),defaultValue:n.initValues.fillColor}),f.appendChild(g),g=this._createStylingElement({type:"color",className:"gp-styling-option",label:this.options.labels.strokeColor,id:this._addUID("strokeColor"),defaultValue:n.initValues.strokeColor}),f.appendChild(g),g=this._createStylingElement({type:"range",className:"gp-styling-option",label:this.options.labels.strokeWidth,title:"1  10 pixels",id:this._addUID("strokeWidth"),min:1,max:10,step:1,defaultValue:n.initValues.strokeWidth}),f.appendChild(g);break;case"line":g=this._createStylingElement({type:"color",className:"gp-styling-option",label:this.options.labels.strokeColor,id:this._addUID("strokeColor"),defaultValue:n.initValues.strokeColor}),f.appendChild(g),g=this._createStylingElement({type:"range",className:"gp-styling-option fr-range fr-range--sm",label:this.options.labels.strokeWidth,title:"1  10 pixels",id:this._addUID("strokeWidth"),min:1,max:10,step:1,defaultValue:n.initValues.strokeWidth}),f.appendChild(g);break;case"polygon":g=this._createStylingElement({type:"color",className:"gp-styling-option",label:this.options.labels.strokeColor,id:this._addUID("strokeColor"),defaultValue:n.initValues.strokeColor}),f.appendChild(g),g=this._createStylingElement({type:"range",className:"gp-styling-option fr-range fr-range--sm",label:this.options.labels.strokeWidth,title:"1  10 pixels",id:this._addUID("strokeWidth"),min:1,max:10,step:1,defaultValue:n.initValues.strokeWidth}),f.appendChild(g),g=this._createStylingElement({type:"color",className:"gp-styling-option",label:this.options.labels.fillColor,id:this._addUID("fillColor"),defaultValue:n.initValues.fillColor}),f.appendChild(g),g=this._createStylingElement({type:"range",className:"gp-styling-option fr-range fr-range--sm",label:this.options.labels.fillOpacity,title:"0 (transparent)  100% (opaque)",id:this._addUID("fillOpacity"),min:0,max:10,step:1,defaultValue:n.initValues.fillOpacity*10}),f.appendChild(g);break;default:logger$u.log("Unhandled geometry type for styling.")}u.appendChild(f);var Y=document.createElement("div");Y.className="gpf-flex-row",u.appendChild(Y);var ee=document.createElement("input");ee.type="button",ee.className="gp-styling-button fr-btn fr-btn--secondary",ee.value=this.options.labels.applyToObject,ee.onclick=function(){n.applyFunc.call(this,"apply")};var te=document.createElement("input");te.type="button",te.value=this.options.labels.setAsDefault,te.className="gp-styling-button fr-btn fr-btn--tertiary",te.onclick=function(){n.applyFunc.call(this,"default")},Y.appendChild(te),Y.appendChild(ee);var ne=document.createElement("input");return ne.type="button",ne.className="gp-styling-button closer",ne.onclick=function(){n.applyFunc.call(this,"cancel")},u.appendChild(ne),e},_createLabelDiv:function(n){var e=document.createElement("dialog");e.className="gp-label-div gpf-panel fr-modal gpf-visible GPelementVisible";var i=document.createElement("div");if(i.className="gpf-modal__body fr-modal__body",e.appendChild(i),checkDsfr()){var s=document.createElement("div");s.className="GPpanelHeader gpf-panel__header fr-modal__header fr-m-1w";var o=document.createElement("div");o.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",o.innerHTML="Ajouter une description",n.geomType==="Text"&&(o.innerHTML="Texte de l'annotation"),s.appendChild(o);var l=document.createElement("button");l.id=this._addUID("GPdrawingStylePanelClose"),l.className="GPpanelClose GPdrawingStylePanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",l.title="Fermer le panneau",l.addEventListener?l.addEventListener("click",function(){n.applyFunc.call(this,"cancel")},!1):l.attachEvent&&l.attachEvent("onclick",function(){n.applyFunc.call(this,"cancel")});var c=document.createElement("span");c.className="GPelementHidden gpf-visible",c.innerText="Fermer",l.appendChild(c),s.appendChild(l),i.appendChild(s)}var u=document.createElement("div");u.className="gpf-panel__content fr-px-3w fr-modal__content",i.appendChild(u);var f=null;if(n.geomType==="Text"?(f=document.createElement("input"),f.type="text",f.className="gp-input-label-style fr-input fr-mb-3w"):(f=document.createElement("textArea"),f.rows=2,f.cols=40,f.className="gp-textarea-att-label-style fr-input"),n.text&&(f.value=n.text),f.autocomplete="off",f.placeholder=n.placeholder,f.id=n.inputId,u.appendChild(f),f.onkeyup=function(ee){n.geomType==="Text"&&ee.keyCode===13&&n.applyFunc.call(this,n.key,f.value,!0),ee.keyCode===27&&n.applyFunc.call(this,n.key,f.value,!1)},n.measure&&n.geomType!=="Text"){var g=document.createElement("input");g.type="text",g.readonly=!0,g.className="gp-input-measure-style",g.value=n.measure,u.appendChild(g)}var H=document.createElement("input");H.type="button",H.className="gp-styling-button fr-btn fr-btn--tertiary",H.value=this.options.labels.saveDescription,H.onclick=function(){n.applyFunc.call(this,n.key,f.value,!0)},u.appendChild(H);var Y=document.createElement("input");return Y.type="button",Y.className="gp-styling-button closer",Y.onclick=function(){n.applyFunc.call(this,n.key,f.value,!1)},u.appendChild(Y),e},_handleDOMToolClick:function(n,e,i){for(var s in i.dtOptions){var o=i._addUID("drawing-tool-"+i.dtOptions[s].id),l=document.getElementById(o);if(o!==e){l.className="drawing-tool fr-btn fr-btn--tertiary gpf-btn--tertiary",i.dtOptions[s].active=!1;continue}i.dtOptions[s].active?l.className="drawing-tool fr-btn fr-btn--tertiary gpf-btn--tertiary":l.className="drawing-tool drawing-tool-active fr-btn fr-btn--tertiary gpf-btn--tertiary",i.dtOptions[s].active=!i.dtOptions[s].active}}},logger$t=LoggerByDefault.getLogger("Drawing");const vi=class vi extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof vi))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="Drawing",this._initialize(e),this._container=this._initContainer(),this.element?this.element.appendChild(this._container):this.element=this._container,this}setMap(e){super.setMap(e),this.getMap()&&this.eventKey&&unByKey(this.eventKey),e!=null&&(this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter"),this.draggable&&Draggable.dragElement(this._drawingPanel,this._drawingPanelHeader,e.getTargetElement()),this.collapsed||this._showDrawingButton.setAttribute("aria-pressed",!0),this.layer&&this.setLayer(this.layer),this.eventKey=this.getMap().getLayers().on("remove",i=>{i.element===this.layer&&(this.layer=null,this.interactionCurrent&&(this.getMap().removeInteraction(this.interactionCurrent),this.interactionCurrent=null))}))}exportFeatures(){var e=null;if(ControlExtended.prototype.getMap.call(this)==null)return logger$t.log("Impossible to export : control isn't attached to any map."),e;if(!this.layer)return logger$t.log("Impossible to export : no layer is hosting features."),e;if(!this.layer.getSource()||!this.layer.getSource().getFeatures()||!this.layer.getSource().getFeatures().length)return logger$t.log("Impossible to export : no features found."),e;this.featuresCollectionSelected&&this.featuresCollectionSelected.clear();var i=null;switch(this.getExportFormat()){case"KML":i=new KML({writeStyles:!0});break;case"GPX":i=new GPX({});break;case"GEOJSON":i=new GeoJSON({});break}if(!i)return logger$t.log("Impossible to export : format unknown !?"),e;var s=this.layer.getSource().getProjection();return s=s||this.getMap().getView().getProjection(),e=i.writeFeatures(this.layer.getSource().getFeatures(),{dataProjection:"EPSG:4326",featureProjection:s}),e}setCollapsed(e){if(e===void 0){logger$t.error("[ERROR] Drawing:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(this.onShowDrawingClick(),this._showDrawingButton.click())}setExportName(e){this._exportName=e}getExportName(){return this._exportName}setExportFormat(e){switch(this._exportFormat=e?e.toUpperCase():"KML",e.toUpperCase()){case"KML":this._exportExt=".kml",this._exportMimeType="application/vnd.google-earth.kml+xml";break;case"GPX":this._exportExt=".gpx",this._exportMimeType="application/gpx+xml";break;case"GEOJSON":this._exportExt=".geojson",this._exportMimeType="application/geo+json";break;default:this._exportFormat="KML";break}}getExportFormat(){return this._exportFormat}setLayer(e){if(!e){this.layer=null;return}if(!(e instanceof VectorLayer)){logger$t.log("no valid layer given for hosting drawn features.");return}var i=this.getMap().getLayers();if(i){var s=!1;i.forEach(o=>{o===e&&(logger$t.trace("layer already in map. Not adding."),s=!0)}),s||(this.getMap().addLayer(e),this.dispatchEvent({type:this.ADD_AFTER_DRAWING_LAYER_EVENT,layer:e})),e.getSource().getFeatures().forEach(o=>{var l=o.getStyle();if(typeof l=="function"){var c=o.getStyleFunction();if(c){var u=c.call(this,o,0);u&&u.length!==0&&o.setStyle(Array.isArray(u)?u[0]:u)}}}),this.layer=e,this.getMap().getControls().forEach(o=>{if(o instanceof LayerSwitcher){var l=this.layer.gpLayerId;l&&o._layers[l].title===l&&o.addLayer(this.layer,{title:this.options.layerDescription.title,description:this.options.layerDescription.description})}})}}getLayer(){return this.layer}getContainer(){return this._container}disable(){var e=this.getMap();Interactions.unset(e);for(var i in this.dtOptions)if(this.dtOptions.hasOwnProperty(i)&&this.dtOptions[i].active){var s=this._addUID("drawing-tool-"+this.dtOptions[i].id);document.getElementById(s).className="drawing-tool fr-btn fr-btn--tertiary gpf-btn--tertiary",this.dtOptions[i].active=!1}}_getsMarkersOptionsFromSrc(e){for(var i=null,s=0;s<this.options.markersList.length;s++)if(e&&this.options.markersList[s].src===e)return i=this.options.markersList[s],i;return i}_getIconStyleOptions(e){var i={};return Object.keys(e).forEach(s=>{switch(s){case"src":case"size":case"scale":case"color":case"anchor":case"anchorOrigin":case"anchorXUnits":case"anchorYUnits":i[s]=e[s];break}}),i}_initialize(e){this._uid=e.id||SelectorID.generate(),this._exportName="Croquis",this._exportFormat="KML",this._exportMimeType="application/vnd.google-earth.kml+xml",this._exportExt=".kml",e=e||{},this.options=e,this.options.layerDescription=Object.assign({title:"Croquis",description:"Mon croquis"},e.layerDescription),this.options.tools||(this.options.tools={}),Object.keys(vi.DefaultTools).forEach(i=>{this.options.tools.hasOwnProperty(i)||(this.options.tools[i]=vi.DefaultTools[i])}),this.options.cursorStyle||(this.options.cursorStyle={}),Object.keys(vi.DefaultCursorStyle).forEach(i=>{this.options.cursorStyle.hasOwnProperty(i)||(this.options.cursorStyle[i]=vi.DefaultCursorStyle[i])}),this.options.collapsed=e.collapsed!==void 0?e.collapsed:!0,this.collapsed=this.options.collapsed,this.options.draggable=e.draggable!==void 0?e.draggable:!1,this.draggable=this.options.draggable,this.options.markersList=e.markersList||MarkersOther.drawing_api,this.options.labels||(this.options.labels={}),Object.keys(vi.DefaultLabels).forEach(i=>{this.options.labels.hasOwnProperty(i)||(this.options.labels[i]=vi.DefaultLabels[i])}),this.options.defaultStyles||(this.options.defaultStyles={}),Object.keys(vi.DefaultStyles).forEach(i=>{if(!e.defaultStyles.hasOwnProperty(i)){this.options.defaultStyles[i]=vi.DefaultStyles[i];return}if(i==="polyFillOpacity"&&(e.defaultStyles[i]<0||e.defaultStyles[i]>1)){logger$t.log("Wrong value ("+e.defaultStyles[i]+") for defaultStyles.polyFillOpactity. Must be between 0 and 1"),this.options.defaultStyles[i]=vi.DefaultStyles[i];return}if(i==="strokeWidth"||i==="polyStrokeWidth"){var s=parseInt(e.defaultStyles[i],10);if(isNaN(s)||s<0){logger$t.log("Wrong value ("+e.defaultStyles[i]+") for defaultStyles.strokeWidth. Must be a positive interger value."),this.options.defaultStyles[i]=vi.DefaultStyles[i];return}this.options.defaultStyles[i]=s}if(i==="markerSize"){var o=parseFloat(e.defaultStyles[i]);if(isNaN(o)||o<0){logger$t.log("Wrong value ("+e.defaultStyles[i]+") for defaultStyles.markerSize. Must be a positive value."),this.options.defaultStyles[i]=vi.DefaultStyles[i];return}this.options.defaultStyles[i]=o}}),this.interactionCurrent=null,this.interactionSelectEdit=null,this.featuresCollectionSelected=null,this.stylingOvl=null,this.popupOvl=null,this.tooltipOvl=null,this.tooltipElem=null,this.layer=null,this.options.layer&&this.options.layer instanceof VectorLayer&&(this.layer=this.options.layer),this._isDesktop=this._detectSupport(),this.options.popup||(this.options.popup={display:!0,apply:null}),this.ADD_AFTER_DRAWING_LAYER_EVENT="drawing:add:after",this.ADD_BEFORE_DRAWING_LAYER_EVENT="drawing:add:before"}_createEmptyLayer(){var e=new Collection,i=new VectorLayer({source:new VectorSource({features:e}),title:this.options.layerDescription.title,description:this.options.layerDescription.description});i.gpResultLayerId="drawing",this.dispatchEvent({type:this.ADD_BEFORE_DRAWING_LAYER_EVENT,layer:i}),this.setLayer(i)}_detectSupport(){var e=!0,i=window.navigator.userAgent.toLowerCase();return(i.indexOf("iphone")!==-1||i.indexOf("ipod")!==-1||i.indexOf("ipad")!==-1||i.indexOf("android")!==-1||i.indexOf("mobile")!==-1||i.indexOf("blackberry")!==-1||i.indexOf("tablet")!==-1||i.indexOf("phone")!==-1||i.indexOf("touch")!==-1)&&(e=!1),(i.indexOf("msie")!==-1||i.indexOf("trident")!==-1)&&(e=!0),e}_initContainer(){var e=this._createMainContainerElement(),i=this._showDrawingButton=this._createShowDrawingPictoElement();e.appendChild(i);var s=this._drawingPanel=this._createDrawingPanelElement(),o=this._createDrawingPanelDivElement();s.appendChild(o);var l=this._drawingPanelHeader=this._createDrawingPanelHeaderElement();o.appendChild(l);var c=this._createDrawingToolsDivSections();o.appendChild(c);for(var u=this._createDrawingToolsSections(),f=0;f<u.length;f++)c.appendChild(u[f]);var g=this._createDrawingButtonsPluginDiv();return c.appendChild(g),e.appendChild(s),e}_drawEndFeature(e,i){var s=null;switch(i){case"Point":s=new Style$1({image:new Icon(this._getIconStyleOptions(this.options.markersList[0]))});break;case"LineString":s=new Style$1({stroke:new Stroke({color:this.options.defaultStyles.strokeColor,width:this.options.defaultStyles.strokeWidth})});break;case"Polygon":s=new Style$1({fill:new Fill({color:ColorUtils.hexToRgba(this.options.defaultStyles.polyFillColor,this.options.defaultStyles.polyFillOpacity)}),stroke:new Stroke({color:this.options.defaultStyles.polyStrokeColor,width:this.options.defaultStyles.polyStrokeWidth})});break}if(e.setStyle(s),this._updateMeasure(e,i),this.options.popup.display){var o=this,l=function(H,Y,ee){if(o.getMap().removeOverlay(o.popupOvl),o.popupOvl=null,ee&&Y&&Y.trim().length>0){var te={};te[H]=Y.replace(/\n/g,"<br>"),e.setProperties(te)}},c=null,u=!0,f=this.options.popup.function;f&&typeof f=="function"&&(c=f.call(o,{feature:e,geomType:i,closeFunc:function(){l(null,!1)},saveFunc:function(H){l(H,!0)}}),c&&(u=!1,c.tabIndex=-1,c.onblur=function(){o.getMap().removeOverlay(o.popupOvl),o.popupOvl=null})),u&&(c=this._createLabelDiv({applyFunc:l,inputId:this._addUID("att-input"),placeholder:"Saisir une description... (facultatif)",measure:this.options.tools.measure?e.getProperties().measure:null,geomType:i,key:"description"})),this.popupOvl&&(this.getMap().removeOverlay(this.popupOvl),this.popupOvl=null),this.popupOvl=new Overlay({element:c,positioning:"top-center"}),this.getMap().addOverlay(this.popupOvl);var g=e.getGeometry().getExtent();this.popupOvl.setPosition([(g[0]+g[2])/2,(g[1]+g[3])/2]),document.getElementById(this._addUID("att-input"))&&document.getElementById(this._addUID("att-input")).focus()}}_createRemoveInteraction(){var e=new Select({layers:[this.layer],style:!1});return e.on("select",i=>{!i||!i.selected||i.selected.length===0||(this.layer.getSource().removeFeature(i.selected[0]),this.getMap().removeInteraction(this.interactionCurrent),this.interactionCurrent=this._createRemoveInteraction(),this.getMap().addInteraction(this.interactionCurrent))}),e}_createStylingInteraction(){var e=new Select({layers:[this.layer],style:!1});return e.on("select",i=>{if(this.stylingOvl&&this.getMap().removeOverlay(this.stylingOvl),!(!i||!i.selected||i.selected.length===0)){var s=null,o=null,l=null,c=null,u={},f=i.selected[0].getGeometry(),g=i.selected[0].getStyle();if(f instanceof Point$1||f instanceof MultiPoint){if(g&&g.getImage()&&typeof g.getImage().getSrc=="function"&&g.getImage().getSrc()!==this.options.defaultStyles.textIcon1x1.src&&(c="Point",typeof g.getImage().getSrc=="function"?(u.markerSrc=g.getImage().getSrc(),u.markerSize=g.getImage().getScale()||1,u.markerAnchor=g.getImage().getAnchor(),g.getImage().getColor()?(s=g.getImage().getColor(),Array.isArray(s)?s="rgba("+s.join()+")":u.markerColor=s,o=ColorUtils.isRGB(s)?ColorUtils.rgbaToHex(s):{hex:s,opacity:1},u.markerColor=o.hex,u.markerOpacity=o.opacity):u.markerColor=this.options.markersList[0].color||"#ffffff"):(u.markerSrc=this.options.markersList[0].src,u.markerSize=this.options.markersList[0].scale||1,u.markerColor=this.options.markersList[0].color||"#ffffff",u.markerAnchor=this.options.markersList[0].anchor),u.markerCustom=!this._getsMarkersOptionsFromSrc(u.markerSrc)),g&&g.getText()){var H=i.selected[0].getProperties().name;if(H&&(c=c==="Point"?"Point&Text":"Text",g.getText().getStroke()&&g.getText().getStroke().getColor()&&(s=g.getText().getStroke().getColor(),Array.isArray(s)?s="rgba("+s.join()+")":u.strokeColor=s,o=ColorUtils.isRGB(s)?ColorUtils.rgbaToHex(s):{hex:s,opacity:1},u.strokeColor=o.hex,u.strokeOpacity=o.opacity),g.getText().getStroke()&&g.getText().getStroke().getWidth()&&(u.strokeWidth=g.getText().getStroke().getWidth()),g.getText().getFill()&&g.getText().getFill().getColor()&&(s=g.getText().getFill().getColor(),Array.isArray(s)?s="rgba("+s.join()+")":u.fillColor=s,o=ColorUtils.isRGB(s)?ColorUtils.rgbaToHex(s):{hex:s,opacity:1},u.fillColor=o.hex,u.fillOpacity=o.opacity),u.strokeColor=u.hasOwnProperty("strokeColor")?u.strokeColor:this.options.defaultStyles.textStrokeColor,u.strokeWidth=u.hasOwnProperty("strokeWidth")?u.strokeWidth:this.options.defaultStyles.textStrokeWidth,u.fillColor=u.hasOwnProperty("fillColor")?u.fillColor:this.options.defaultStyles.textFillColor,c==="Point&Text")){var Y=g.getText().getText();Y||g.getText().setText(H);var ee=i.selected[0].get("checked");u.labelDisplay=ee===void 0?this.options.defaultStyles.labelDisplay:ee}}}else f instanceof LineString||f instanceof MultiLineString?(c="Line",g&&g.getStroke()&&(g.getStroke().getWidth()&&(u.strokeWidth=g.getStroke().getWidth()),g.getStroke().getColor()&&(s=g.getStroke().getColor(),Array.isArray(s)?s="rgba("+s.join()+")":u.strokeColor=s,o=ColorUtils.isRGB(s)?ColorUtils.rgbaToHex(s):{hex:s,opacity:1},u.strokeColor=o.hex,u.strokeOpacity=o.opacity)),u.strokeWidth=u.hasOwnProperty("strokeWidth")?u.strokeWidth:this.options.defaultStyles.strokeWidth,u.strokeColor=u.hasOwnProperty("strokeColor")?u.strokeColor:this.options.defaultStyles.strokeColor):(f instanceof Polygon||f instanceof MultiPolygon)&&(c="Polygon",g&&g.getStroke()&&(g.getStroke().getWidth()&&(u.strokeWidth=g.getStroke().getWidth()),g.getStroke().getColor()&&(s=g.getStroke().getColor(),Array.isArray(s)?s="rgba("+s.join()+")":u.strokeColor=s,o=ColorUtils.isRGB(s)?ColorUtils.rgbaToHex(s):{hex:s,opacity:1},u.strokeColor=o.hex,u.strokeOpacity=o.opacity)),g&&g.getFill()&&g.getFill().getColor()&&(s=g.getFill().getColor(),Array.isArray(s)?s="rgba("+s.join()+")":u.fillColor=s,o=ColorUtils.isRGB(s)?ColorUtils.rgbaToHex(s):{hex:s,opacity:1},u.fillColor=o.hex,u.fillOpacity=o.opacity),u.strokeWidth=u.hasOwnProperty("strokeWidth")?u.strokeWidth:this.options.defaultStyles.polyStrokeWidth,u.strokeColor=u.hasOwnProperty("strokeColor")?u.strokeColor:this.options.defaultStyles.polyStrokeColor,u.fillColor=u.hasOwnProperty("fillColor")?u.fillColor:this.options.defaultStyles.polyFillColor,u.fillOpacity=u.hasOwnProperty("fillOpacity")?u.fillOpacity:this.options.defaultStyles.polyFillOpacity);if(!c){logger$t.log("Unhandled geometry type for styling.");return}var te=this,ne=function(xe){if(xe==="cancel"){te.getMap().removeOverlay(l);return}var tt=xe!=="apply",et=document.getElementById(te._addUID("fillColor")),it=document.getElementById(te._addUID("fillOpacity")),rt=document.getElementById(te._addUID("strokeColor")),nt=document.getElementById(te._addUID("strokeWidth")),at=document.getElementById(te._addUID("markerSize"));switch(c.toLowerCase()){case"text":tt?(te.options.defaultStyles.textStrokeColor=rt.value,te.options.defaultStyles.textStrokeWidth=nt.value,te.options.defaultStyles.textFillColor=et.value):i.selected[0].setStyle(new Style$1({text:new Text({font:"16px sans",textAlign:"left",text:g.getText().getText(),fill:new Fill({color:et.value}),stroke:new Stroke({color:rt.value,width:parseInt(nt.value,10)})})}));break;case"point&text":case"point":var st=document.querySelector("input[type='checkbox']"),ot=null,ut=parseInt(at.value,10)/10,ht=document.querySelector("input[name='gpf-dropdown-radio-style']:checked");if(ht&&(ot=te._getsMarkersOptionsFromSrc(ht.value),ot.scale=ut),tt){if(te.options.defaultStyles.markerSize=ut,te.options.markersList.length>1){var dt=te.options.markersList.findIndex(function(mt){return mt===ot});dt>0&&(te.options.markersList.splice(dt,1),te.options.markersList.splice(0,0,ot))}c.toLowerCase()==="point&text"&&(te.options.defaultStyles.textStrokeColor=u.strokeColor,te.options.defaultStyles.textStrokeWidth=u.strokeWidth,te.options.defaultStyles.textFillColor=u.fillColor,te.options.defaultStyles.labelDisplay=u.labelDisplay)}else{var pt={};c.toLowerCase()==="point&text"&&(i.selected[0].set("checked",st.checked),pt={text:new Text({font:"16px sans",textAlign:"left",text:st.checked?i.selected[0].get("name"):"",fill:new Fill({color:u.fillColor}),stroke:new Stroke({color:u.strokeColor,width:parseInt(u.strokeWidth,10)})})}),ot?i.selected[0].setStyle(new Style$1(Object.assign({image:new Icon(te._getIconStyleOptions(ot))},pt))):i.selected[0].setStyle(new Style$1(Object.assign({image:new Icon({src:u.markerSrc,anchor:u.markerAnchor,anchorOrigin:"top-left",anchorXUnits:"pixels",anchorYUnits:"pixels",scale:ut})},pt)))}break;case"line":tt?(te.options.defaultStyles.strokeColor=rt.value,te.options.defaultStyles.strokeWidth=parseInt(nt.value,10)):i.selected[0].setStyle(new Style$1({stroke:new Stroke({width:parseInt(nt.value,10),color:rt.value})}));break;case"polygon":var yt=parseInt(it.value,10)/10;tt?(te.options.defaultStyles.polyStrokeColor=rt.value,te.options.defaultStyles.polyFillColor=et.value,te.options.defaultStyles.polyFillOpacity=yt,te.options.defaultStyles.polyStrokeWidth=parseInt(nt.value,10)):i.selected[0].setStyle(new Style$1({stroke:new Stroke({width:parseInt(nt.value,10),color:rt.value}),fill:new Fill({color:ColorUtils.hexToRgba(et.value,yt)})}));break}tt||te.getMap().removeOverlay(l)},Ye=this._createStylingDiv({geomType:c,initValues:u,applyFunc:ne});l=new Overlay({element:Ye,positioning:"top-center"}),this.getMap().addOverlay(l),l.setPosition(i.mapBrowserEvent.coordinate),this.stylingOvl=l,this.getMap().removeInteraction(this.interactionCurrent),this.interactionCurrent=this._createStylingInteraction(),this.getMap().addInteraction(this.interactionCurrent)}}),e}_createLabelInteraction(){var e=new Select({layers:[this.layer],style:!1});return e.on("select",i=>{if(this.labelOvl&&this.getMap().removeOverlay(this.labelOvl),!(!i||!i.selected||i.selected.length===0)){var s=null,o=null,l=null,c=null,u=i.selected[0].getGeometry(),f=i.selected[0].getStyle();if(u instanceof Point$1||u instanceof MultiPoint){var g=i.selected[0].getProperties().name;f&&f.getText()&&g?o="Text":f&&f.getImage()&&(o="Point")}else if(u instanceof LineString||u instanceof MultiLineString)o="Line";else if(u instanceof Polygon||u instanceof MultiPolygon)o="Polygon";else{logger$t.log("Geometry type for styling not supported .");return}if(!o){logger$t.log("Unhandled geometry type for styling.");return}if(o==="Text")l=f.getText().getText();else{var H=i.selected[0].getProperties();H&&(H.hasOwnProperty("description")||H.hasOwnProperty("desc"))&&(l=H.description||H.desc),H&&H.hasOwnProperty("measure")&&(c=H.measure)}var Y=this,ee=function(ne,Ye,xe){if(Y.getMap().removeOverlay(s),!!xe){var tt=i.selected[0];if(o==="Text"){var et=tt.getStyle();et.getText().setText(Ye),tt.setProperties({name:Ye}),tt.setStyle(et);return}var it={};it[ne]=Ye.replace(/\n/g,"<br>"),tt.setProperties(it)}},te=this._createLabelDiv({applyFunc:ee,inputId:this._addUID("label-input"),placeholder:o==="Text"?"Saisir un label...":"Saisir une description... (facultatif)",text:l,key:"description",measure:this.options.tools.measure?c:null,geomType:o});s=new Overlay({element:te,positioning:"top-center"}),this.getMap().addOverlay(s),s.setPosition(i.mapBrowserEvent.coordinate),document.getElementById(this._addUID("label-input")).focus(),this.labelOvl=s,this.getMap().removeInteraction(this.interactionCurrent),this.interactionCurrent=this._createLabelInteraction(),this.getMap().addInteraction(this.interactionCurrent)}}),e}_updateMeasure(e,i){logger$t.log(e);var s=null,o=this.getMap().getView().getProjection();function l(nt,at){at=at||2;var st=Math.pow(10,at);return Math.round(nt*st)/st}var c=i||e.getProperties().type;switch(c){case"Point":var u=e.getGeometry().getCoordinates(),f=transform$1(u,o,"EPSG:4326");s="lon : ",s+=l(f[0],4)+"",s+=" / ",s+="lat : ",s+=l(f[1],4)+"";break;case"LineString":for(var g=0,H=e.getGeometry().getCoordinates(),Y=0,ee=H.length-1;Y<ee;++Y){var te=transform$1(H[Y],o,"EPSG:4326"),ne=transform$1(H[Y+1],o,"EPSG:4326");g+=getDistance(te,ne)}s=g>1e3?l(g/1e3,3)+" km":l(g,3)+" m";break;case"Polygon":var Ye=0,xe=e.getGeometry().clone(),tt=xe.getLinearRing(0).getCoordinates();Ye=Math.abs(getArea(new Polygon([tt])));var et=xe.getLinearRings();if(et.length>1)for(var it=1;it<et.length;it++){var rt=et[it].getCoordinates();Ye-=Math.abs(getArea(new Polygon([rt])))}s=Ye>1e6?l(Ye/1e6,3)+" km^2":l(Ye,2)+" m^2";break}e.setProperties({measure:s,type:c})}_handleToolClick(e,i,s){var o=s.getMap();if(!o){logger$t.trace("Drawing control not attached to any map.");return}Interactions.unset(o,{current:"Drawing"}),s.interactionCurrent&&(o.removeInteraction(s.interactionCurrent),s.interactionCurrent=null),s.interactionSelectEdit&&(o.removeInteraction(s.interactionSelectEdit),s.interactionSelectEdit=null),s.popupOvl&&(s.getMap().removeOverlay(s.popupOvl),s.popupOvl=null),s.stylingOvl&&(s.getMap().removeOverlay(s.stylingOvl),s.stylingOvl=null),s.tooltipOvl&&(s.getMap().removeOverlay(s.tooltipOvl),s.tooltipOvl=null),this.layer||this._createEmptyLayer();const l=u=>{if(u.dragging||!s.tooltipOvl)return;const f=u.coordinate;s.tooltipOvl.setPosition(f)},c=()=>{s.tooltipOvl&&(s.getMap().removeOverlay(s.tooltipOvl),s.tooltipOvl=null)};switch(i){case this._addUID("drawing-tool-point"):s.dtOptions.points.active&&(s.interactionCurrent=new Draw({stopClick:!0,source:s.layer.getSource(),style:new Style$1({image:new Icon(this._getIconStyleOptions(this.options.markersList[0]))}),type:"Point"}),s.interactionCurrent.on("drawend",function(u){s._drawEndFeature(u.feature,"Point")},s));break;case this._addUID("drawing-tool-line"):s.dtOptions.lines.active&&(s.interactionCurrent=new Draw({stopClick:!0,source:s.layer.getSource(),style:new Style$1({image:new CircleStyle({radius:this.options.cursorStyle.radius,stroke:new Stroke({color:this.options.cursorStyle.strokeColor,width:this.options.cursorStyle.strokeWidth}),fill:new Fill({color:this.options.cursorStyle.fillColor})}),stroke:new Stroke({color:this.options.defaultStyles.strokeColor,width:this.options.defaultStyles.strokeWidth})}),type:"LineString",handleMoveEvent:l}),s.tootlTipElem||(s.tootlTipElem=document.createElement("div"),s.tootlTipElem.className="gpf-draw-linestring-tooltip"),s.tootlTipElem.innerText="Double-cliquer pour terminer",s.tooltipOvl=new Overlay({element:s.tootlTipElem,positioning:"top-right"}),s.interactionCurrent.on("drawend",function(u){s._drawEndFeature(u.feature,"LineString"),c()},s),s.interactionCurrent.on("drawabort",c,s));break;case this._addUID("drawing-tool-polygon"):s.dtOptions.polygons.active&&(s.interactionCurrent=new Draw({stopClick:!0,source:s.layer.getSource(),style:new Style$1({image:new CircleStyle({radius:this.options.cursorStyle.radius,stroke:new Stroke({color:this.options.cursorStyle.strokeColor,width:this.options.cursorStyle.strokeWidth}),fill:new Fill({color:this.options.cursorStyle.fillColor})}),stroke:new Stroke({color:this.options.defaultStyles.polyStrokeColor,width:this.options.defaultStyles.polyStrokeWidth}),fill:new Fill({color:ColorUtils.hexToRgba(this.options.defaultStyles.polyFillColor,this.options.defaultStyles.polyFillOpacity)})}),type:"Polygon",handleMoveEvent:l}),s.tootlTipElem||(s.tootlTipElem=document.createElement("div"),s.tootlTipElem.className="gpf-draw-linestring-tooltip"),s.tootlTipElem.innerText="Double-cliquer pour terminer",s.tooltipOvl=new Overlay({element:s.tootlTipElem,positioning:"top-right"}),s.interactionCurrent.on("drawend",function(u){s._drawEndFeature(u.feature,"Polygon"),c()},s),s.interactionCurrent.on("drawabort",c,s));break;case this._addUID("drawing-tool-holes"):s.dtOptions.holes.active&&(s.interactionSelectEdit=new Select({stopClick:!0,condition:pointerMove,layers:[this.layer]}),s.interactionSelectEdit.setProperties({name:"Drawing",source:s}),o.addInteraction(s.interactionSelectEdit),s.interactionCurrent=new Draw({stopClick:!0,features:this.interactionSelectEdit.getFeatures(),style:new Style$1({image:new CircleStyle({radius:this.options.cursorStyle.radius,stroke:new Stroke({color:this.options.cursorStyle.strokeColor,width:this.options.cursorStyle.strokeWidth}),fill:new Fill({color:this.options.cursorStyle.fillColor})}),stroke:new Stroke({color:this.options.defaultStyles.polyStrokeColor,width:this.options.defaultStyles.polyStrokeWidth}),fill:new Fill({color:ColorUtils.hexToRgba(this.options.defaultStyles.polyFillColor,this.options.defaultStyles.polyFillOpacity)})}),type:"Polygon"}),s.interactionCurrent.on("drawstart",function(u){},s),s.interactionCurrent.on("drawend",function(u){var f=s.interactionSelectEdit.getFeatures();if(f.getLength()){for(var g=f.item(0),H=u.feature.getGeometry().getCoordinates()[0],Y=!0,ee=0;ee<H.length;ee++)if(!g.getGeometry().intersectsCoordinate(H[ee])){Y=!1;break}if(!Y)return;g.getGeometry().appendLinearRing(new LinearRing(H)),u.feature=g,s._drawEndFeature(u.feature,"Polygon")}},s));break;case this._addUID("drawing-tool-text"):s.dtOptions.text.active&&(s.interactionCurrent=new Draw({stopClick:!0,source:s.layer.getSource(),style:new Style$1({image:new CircleStyle({radius:this.options.cursorStyle.radius,stroke:new Stroke({color:this.options.cursorStyle.strokeColor,width:this.options.cursorStyle.strokeWidth}),fill:new Fill({color:this.options.cursorStyle.fillColor})})}),type:"Point"}),s.interactionCurrent.on("drawend",u=>{var f=function(H,Y,ee){if(s.getMap().removeOverlay(s.popupOvl),s.popupOvl=null,!ee||!Y){s.layer.getSource().removeFeature(u.feature);return}var te={};te[H]=Y,u.feature.setProperties(te),u.feature.setStyle(new Style$1({image:new Icon(s._getIconStyleOptions(s.options.defaultStyles.textIcon1x1)),text:new Text({textAlign:"left",font:"16px sans",text:Y,fill:new Fill({color:s.options.defaultStyles.textFillColor}),stroke:new Stroke({color:s.options.defaultStyles.textStrokeColor,width:3})})}))},g=this._createLabelDiv({applyFunc:f,inputId:s._addUID("label-input"),geomType:"Text",key:"name",placeholder:"Saisir un label..."});s.popupOvl&&s.popupOvl.element.querySelector(".gp-styling-button.closer").click(),s.popupOvl=new Overlay({element:g,positioning:"top-center"}),s.getMap().addOverlay(s.popupOvl),s.popupOvl.setPosition(u.feature.getGeometry().getCoordinates()),document.getElementById(s._addUID("label-input")).focus()}));break;case this._addUID("drawing-tool-edit"):s.dtOptions.edit.active&&(this.featuresCollectionSelected=new Collection,s.interactionSelectEdit=new Select({condition:singleClick,layers:[this.layer],features:this.featuresCollectionSelected}),s.interactionSelectEdit.on("select",u=>{}),s.interactionSelectEdit.setProperties({name:"Drawing",source:s}),o.addInteraction(s.interactionSelectEdit),s.interactionCurrent=new Modify({stopClick:!0,features:this.interactionSelectEdit.getFeatures(),style:new Style$1({image:new CircleStyle({radius:this.options.cursorStyle.radius,stroke:new Stroke({color:this.options.cursorStyle.strokeColor,width:this.options.cursorStyle.strokeWidth}),fill:new Fill({color:this.options.cursorStyle.fillColor})})})}),s.interactionCurrent.on("modifyend",u=>{var f=u.features.item(0);s._updateMeasure(f)}));break;case this._addUID("drawing-tool-display"):s.dtOptions.display.active&&(s.interactionCurrent=this._createStylingInteraction());break;case this._addUID("drawing-tool-tooltip"):s.dtOptions.tooltip.active&&(s.interactionCurrent=this._createLabelInteraction());break;case this._addUID("drawing-tool-remove"):s.dtOptions.remove.active&&(s.interactionCurrent=s._createRemoveInteraction());break;default:logger$t.trace("unhandled tool type")}s.interactionCurrent&&(s.interactionCurrent.setProperties({name:"Drawing",source:this}),o.addInteraction(s.interactionCurrent),s.tooltipOvl&&o.addOverlay(s.tooltipOvl)),logger$t.log("interactions",o.getInteractions())}onShowDrawingClick(e){var i=this._showDrawingButton.ariaPressed;i==="true"&&this.onPanelOpen(),this.disable(),this.collapsed=i!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position)}onExportFeatureClick(){var e=this.exportFeatures();if(e){var i=document.createElement("a"),s="utf-8";if(i.setAttribute("href","data:"+this._exportMimeType+";charset="+s+","+encodeURIComponent(e)),i.setAttribute("download",this.getExportName()+this._exportExt),document.createEvent){var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!0),i.dispatchEvent(o)}else i.click()}}};ii(vi,"DefaultTools",{points:!0,lines:!0,polygons:!0,holes:!1,text:!0,remove:!0,display:!0,tooltip:!0,edit:!0,export:!0,measure:!1}),ii(vi,"DefaultLabels",{control:"Annoter la carte",creatingTools:"Crer",points:"Placer des points",lines:"Dessiner des lignes",polygons:"Dessiner des polygones",holes:"Crer des trous sur un polygone",text:"Ecrire sur la carte",editingTools:"diter",edit:"Editer les tracs",display:"Modifier l'apparence des objets",tooltip:"Modifier les textes / infos-bulles",remove:"Supprimer des objets",export:"Exporter",exportTitle:"Exporter en KML",applyToObject:"Appliquer  l'objet",saveDescription:"Enregistrer",setAsDefault:"Dfinir par dfaut",strokeColor:"Couleur du trait : ",strokeWidth:"Epaisseur du trait : ",fillColor:"Couleur de remplissage : ",fillOpacity:"Opacit du remplissage : ",markerSize:"Taille du pictogramme : ",markerColor:"Couleur du pictogramme : ",labelDisplay:"Afficher le label : "}),ii(vi,"DefaultStyles",{textFillColor:"#000000",textStrokeColor:"#FFFFFF",textStrokeWidth:6,textIcon1x1:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNiYAAAAAkAAxkR2eQAAAAASUVORK5CYII=",anchor:[0,0]},polyFillColor:"#000091",polyFillOpacity:.7,polyStrokeColor:"#000091",polyStrokeWidth:4,strokeColor:"#FF7F00",strokeWidth:4,markerSize:1,markerColor:"#ffcc33",labelDisplay:!0}),ii(vi,"DefaultCursorStyle",{radius:6,strokeColor:"#FFF",strokeWidth:1,fillColor:"rgba(0, 153, 255, 1)"});let Drawing=vi;Object.assign(Drawing.prototype,DrawingDOM);Object.assign(Drawing.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.Drawing=Drawing);var logger$s=LoggerByDefault.getLogger("LocationSelectorDOM"),LocationSelectorDOM={_addUID:function(n){var e=this._uid?n+"-"+this._uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.className=this._addUID("GPlocationPoint"),n.className+=" GPwidget gpf-widget ",n},_createLocationPointElement:function(n,e){var i=document.createElement("div");return i.id=this._addUID("GPlocationPoint_"+n),i.className=e?"GPflexInput GPlocationStageFlexInput gpf-flex":"GPflexInput GPelementHidden gpf-flex gpf-hidden",i.style.cssText="",i},_createLocationPointLabelElement:function(n,e){var i=this,s=document.createElement("button");return s.id=this._addUID("GPlocationOriginLabel_"+n),s.innerHTML=e,s.className="GPlocationOriginLabel gpf-btn gpf-btn-icon-label fr-btn fr-btn--secondary gpf-btn--secondary",s.setAttribute("type","button"),s.addEventListener("click",function(o){for(var l=SelectorID.index(this.id),c=document.getElementsByClassName(i._addUID("GPlocationPoint")),u=0;u<c.length;u++){var f=c[u].childNodes[0].id,g=SelectorID.index(f);document.getElementById(i._addUID("GPlocationPoint_"+g)).style.cssText=""}document.getElementById(i._addUID("GPlocationOriginCoords_"+l)).value="",document.getElementById(i._addUID("GPlocationOrigin_"+l)).value="",document.getElementById(i._addUID("GPlocationPoint_"+l)).style.cssText="",document.getElementById(i._addUID("GPlocationOriginPointer_"+l)).checked=!1,document.getElementById(i._addUID("GPlocationOrigin_"+l)).className="GPelementShow gpf-show  gpf-input fr-input",document.getElementById(i._addUID("GPlocationOriginCoords_"+l)).className="GPelementHidden gpf-hidden",document.getElementById(i._addUID("GPlocationStageRemove_"+l))&&(document.getElementById(i._addUID("GPlocationStageRemove_"+l)).className="GPlocationStageRemove gpf-btn gpf-btn-icon-remove fr-btn--sm fr-btn--secondary gpf-btn--secondary"),document.getElementById(i._addUID("GPlocationStageAdd"))&&(document.getElementById(i._addUID("GPlocationStageAdd")).className="GPlocationStageAdd gpf-btn gpf-btn-icon-add fr-btn--sm fr-btn--secondary gpf-btn--secondary fr-mt-2w"),i.onLocationClearPointClick(o)}),s},_createLocationAutoCompleteteInputElement:function(n){var e=this,i=document.createElement("input");return i.id=this._addUID("GPlocationOrigin_"+n),i.className="GPelementShow gpf-show gpf-input fr-input",i.type="text",i.placeholder="Saisir une adresse, un lieu...",i.autocomplete="off",i.addEventListener("keyup",function(s){var o=s.which||s.keyCode;if(!(o===13||o===10||o===38||o===40)){var l=SelectorID.index(this.id);document.getElementById(e._addUID("GPlocationOrigin_"+l)).value.length>2?(document.getElementById(e._addUID("GPlocationAutoCompleteList_"+l)).classList.replace("GPelementHidden","GPelementVisible"),document.getElementById(e._addUID("GPlocationAutoCompleteList_"+l)).classList.replace("gpf-hidden","gpf-visible")):(document.getElementById(e._addUID("GPlocationAutoCompleteList_"+l)).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(e._addUID("GPlocationAutoCompleteList_"+l)).classList.replace("gpf-visible","gpf-hidden")),e.onAutoCompleteSearchText(s)}}),i.addEventListener("keydown",function(s){var o=s.which||s.keyCode,l=document.getElementById(e._addUID("GPlocationAutoCompleteResult_"+n));if(l){var c=l.getElementsByClassName("GPautoCompleteProposal current"),u=l.getElementsByClassName("GPautoCompleteProposal"),f=u.length;if(f){var g=null;if(c.length)g=c[0];else{g=u[0],g.className="GPautoCompleteProposal current",g.style.color="#000000",g.style["background-color"]="#CEDBEF";return}var H=parseInt(SelectorID.index(g.id),10),Y=H===f-1?u[0]:u[H+1],ee=H===0?u[f-1]:u[H-1];switch(g.style["background-color"]="",g.style.color="",ee.style["background-color"]="",ee.style.color="",Y.style["background-color"]="",Y.style.color="",o){case 38:logger$s.log("arrow up"),g.className="GPautoCompleteProposal",ee.className="GPautoCompleteProposal current",ee.style.color="#000000",ee.style["background-color"]="#CEDBEF";break;case 40:logger$s.log("arrow down"),g.className="GPautoCompleteProposal",Y.className="GPautoCompleteProposal current",Y.style.color="#000000",Y.style["background-color"]="#CEDBEF";break;case 13:logger$s.log("enter"),g.click(s);break}g.focus()}}}),i},_createLocationCoordinateInputElement:function(n){var e=this,i=document.createElement("input");return i.id=this._addUID("GPlocationOriginCoords_"+n),i.className="GPelementHidden gpf-input gpf-hidden fr-input",i.type="text",i.disabled=!1,i.addEventListener("click",function(){var s=SelectorID.index(this.id);document.getElementById(e._addUID("GPlocationOriginLabel_"+s)).click()}),i},_createLocationPointerShowInputElement:function(n){var e=document.createElement("input");return e.id=this._addUID("GPlocationOriginPointer_"+n),e.className="GPelementHidden gpf-hidden",e.type="checkbox",e},_createLocationPointerInputElement:function(n){var e=this,i=document.createElement("button");return i.id=this._addUID("GPlocationOriginPointerImg_"+n),i.htmlFor=this._addUID("GPlocationOriginPointer_"+n),i.className="GPlocationOriginPointerImg gpf-btn gpf-btn-icon-pointer fr-btn",i.title="Pointer un lieu sur la carte",i.setAttribute("type","button"),i.addEventListener("click",function(s){s.preventDefault(),s.stopPropagation();var o=SelectorID.index(this.id),l=document.getElementsByClassName(e._addUID("GPlocationPoint")),c,u,f;for(c=0;c<l.length;c++)u=l[c].childNodes[0].id,f=SelectorID.index(u),o!==f&&(document.getElementById(e._addUID("GPlocationOriginPointer_"+f)).checked=!1,document.getElementById(e._addUID("GPlocationOriginCoords_"+f)).value==="Pointer un lieu sur la carte"&&(document.getElementById(e._addUID("GPlocationOriginCoords_"+f)).value="",document.getElementById(e._addUID("GPlocationOrigin_"+f)).className="GPelementShow gpf-show  gpf-input fr-input",document.getElementById(e._addUID("GPlocationOriginCoords_"+f)).className="GPelementHidden gpf-hidden"));if(document.getElementById(e._addUID("GPlocationOriginPointer_"+o)).checked){for(document.getElementById(e._addUID("GPlocationOriginCoords_"+o)).value="",c=0;c<l.length;c++)u=l[c].childNodes[0].id,f=SelectorID.index(u),document.getElementById(e._addUID("GPlocationPoint_"+f)).style.cssText="";document.getElementById(e._addUID("GPlocationStageRemove_"+o))&&(document.getElementById(e._addUID("GPlocationStageRemove_"+o)).className="GPlocationStageRemove  gpf-btn gpf-btn-icon-remove fr-btn--sm fr-btn--secondary gpf-btn--secondary"),document.getElementById(e._addUID("GPlocationStageAdd"))&&(document.getElementById(e._addUID("GPlocationStageAdd")).className="GPlocationStageAdd gpf-btn gpf-btn-icon-add fr-btn--sm fr-btn--secondary gpf-btn--secondary fr-mt-2w"),document.getElementById(e._addUID("GPlocationOriginPointer_"+o)).checked=!1,document.getElementById(e._addUID("GPlocationOrigin_"+o)).className="GPelementShow gpf-show  gpf-input fr-input",document.getElementById(e._addUID("GPlocationOriginCoords_"+o)).className="GPelementHidden gpf-hidden"}else{for(document.getElementById(e._addUID("GPlocationOriginCoords_"+o)).value="Pointer un lieu sur la carte",c=0;c<l.length;c++)u=l[c].childNodes[0].id,f=SelectorID.index(u),o===f?document.getElementById(e._addUID("GPlocationPoint_"+f)).style.cssText="":document.getElementById(e._addUID("GPlocationPoint_"+f)).style.display="none";document.getElementById(e._addUID("GPlocationStageRemove_"+o))&&(document.getElementById(e._addUID("GPlocationStageRemove_"+o)).className="GPelementHidden gpf-hidden"),document.getElementById(e._addUID("GPlocationStageAdd"))&&(document.getElementById(e._addUID("GPlocationStageAdd")).className="GPelementHidden gpf-hidden"),document.getElementById(e._addUID("GPlocationOriginPointer_"+o)).checked=!0,document.getElementById(e._addUID("GPlocationOrigin_"+o)).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPlocationOriginCoords_"+o)).className="GPelementShow gpf-show gpf-input fr-input",document.getElementById(e._addUID("GPlocationOriginCoords_"+o)).disabled=!0}e.onActivateMapPointClick(s)}),i},_createLocationRemovePointElement:function(n){var e=this,i=document.createElement("button");return i.id=this._addUID("GPlocationStageRemove_"+n),i.className="GPlocationOpen GPlocationStageRemove gpf-btn gpf-btn-icon-remove fr-btn--sm fr-btn--secondary gpf-btn--secondary",i.title="Supprimer l'tape",i.setAttribute("tabindex","0"),i.setAttribute("aria-pressed",!1),i.setAttribute("type","button"),i.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o);var l=document.getElementsByClassName(e._addUID("GPlocationPoint")),c=l.length-1,u=l[0].childNodes[0].id,f=l[c].childNodes[0].id,g=SelectorID.index(u),H=SelectorID.index(f);if(n!==g&&n!==H){var Y=SelectorID.index(this.id);document.getElementById(e._addUID("GPlocationPoint_"+Y)).className="GPflexInput GPelementHidden gpf-flex gpf-hidden",document.getElementById(e._addUID("GPlocationOrigin_"+Y)).value="",document.getElementById(e._addUID("GPlocationOrigin_"+Y)).className="GPelementShow gpf-show gpf-input fr-input",document.getElementById(e._addUID("GPlocationOriginCoords_"+Y)).value="",document.getElementById(e._addUID("GPlocationOriginCoords_"+Y)).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPlocationStageAdd")).style.display="",document.getElementById(e._addUID("GPlocationPoint_"+Y)).parentElement.previousSibling.classList.add("GPelementHidden","gpf-hidden"),e.onLocationRemovePointClick(s)}}),i},_createLocationAddPointElement:function(){var n=this,e=document.createElement("button");return e.id=this._addUID("GPlocationStageAdd"),e.className="GPlocationOpen GPlocationStageAdd gpf-btn gpf-btn-icon-add fr-btn--sm fr-btn--secondary gpf-btn--secondary fr-mt-2w",e.title="Ajouter une tape",checkDsfr()&&(e.innerText="Ajouter une tape"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener("click",function(i){for(var s=1,o=0,l=document.getElementsByClassName(n._addUID("GPlocationPoint")),c=1;c<l.length-1;c++){var u=l[c].childNodes[0].id,f=SelectorID.index(u);document.getElementById(n._addUID("GPlocationPoint_"+f))&&(document.getElementById(n._addUID("GPlocationPoint_"+f)).className==="GPflexInput GPelementHidden gpf-flex gpf-hidden"?s===1&&(s=f):o++)}s<l.length&&(document.getElementById(n._addUID("GPlocationPoint_"+s)).className="GPflexInput GPlocationStageFlexInput gpf-flex",document.getElementById(n._addUID("GPlocationPoint_"+s)).parentElement.previousSibling.classList.remove("GPelementHidden","gpf-hidden")),o===4&&(document.getElementById(n._addUID("GPlocationStageAdd")).style.display="none");var g=i.target.ariaPressed==="true";i.target.setAttribute("aria-pressed",!g),n.onLocationAddPointClick(i)}),e},_createLocationAutoCompleteElement:function(n){var e=document.createElement("div");return e.id=this._addUID("GPlocationAutoCompleteList_"+n),e.className="GPlocationAutoCompleteList GPelementHidden gpf-panel gpf-hidden fr-modal",e},_createLocationAutoCompleteResultElement:function(n){var e=this,i=document.createElement("div");return i.id=this._addUID("GPlocationAutoCompleteResult_"+n),i.className="GPadvancedAutoCompleteResult gpf-panel__list",i.addEventListener?i.addEventListener("click",function(s){e.onAutoCompletedResultsItemClick(s),document.getElementById(e._addUID("GPlocationAutoCompleteList_"+n)).classList.replace("GPelementHidden","GPelementVisible"),document.getElementById(e._addUID("GPlocationAutoCompleteList_"+n)).classList.replace("gpf-hidden","gpf-visible")},!1):i.attachEvent&&i.attachEvent("onclick",function(s){e.onAutoCompletedResultsItemClick(s),document.getElementById(e._addUID("GPlocationAutoCompleteList_"+n)).classList.replace("GPelementHidden","GPelementVisible"),document.getElementById(e._addUID("GPlocationAutoCompleteList_"+n)).classList.replace("gpf-hidden","gpf-visible")}),i},_createLocationAutoCompletedLocationElement:function(n,e,i){var s=document.getElementById(this._addUID("GPlocationAutoCompleteResult_"+n)),o=document.createElement("div");o.id=this._addUID("AutoCompletedLocation_"+i),o.className="GPautoCompleteProposal gpf-panel__items",o.title=GeocodeUtils.getSuggestedLocationFreeform(e),o.innerHTML=GeocodeUtils.getSuggestedLocationFreeform(e),s.appendChild(o)},GPdisplayCoordinate:function(n){for(var e=document.getElementsByClassName(this._addUID("GPlocationPoint")),i=0;i<e.length;i++){var s=e[i].childNodes[0].id,o=SelectorID.index(s);if(document.getElementById(this._addUID("GPlocationOriginPointer_"+o)).checked){document.getElementById(this._addUID("GPlocationOriginCoords_"+o)).value=n,document.getElementById(this._addUID("GPlocationOriginCoords_"+o)).disabled=!1;for(var l=0;l<e.length;l++){s=e[l].childNodes[0].id;var c=SelectorID.index(s);document.getElementById(this._addUID("GPlocationPoint_"+c)).style.cssText="",document.getElementById(this._addUID("GPlocationStageRemove_"+c))&&(document.getElementById(this._addUID("GPlocationStageRemove_"+c)).className="GPlocationStageRemove gpf-btn gpf-btn-icon-remove fr-btn--sm fr-btn--secondary gpf-btn--secondary")}document.getElementById(this._addUID("GPlocationOriginPointer_"+o)).checked=!1,document.getElementById(this._addUID("GPlocationStageAdd"))&&(document.getElementById(this._addUID("GPlocationStageAdd")).className="GPlocationStageAdd gpf-btn gpf-btn-icon-add fr-btn--sm");return}}}},logger$r=LoggerByDefault.getLogger("locationselector");class LocationSelector extends Control{constructor(e){if(e=e||{},super({element:e.element||document.createElement("div"),render:e.render,target:e.target}),!(this instanceof LocationSelector))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="LocationSelector",this.initialize(e),this._container=this._initContainer(),this.element?this.element.appendChild(this._container):this.element=this._container,this}initialize(e){this.options={tag:{id:1,groupId:null,label:">",display:!0,addOption:!1,removeOption:!1},displayInfo:!0,autocompleteOptions:{}},Helper.mergeParams(this.options,e),this._uid=this.options.tag.groupId||SelectorID.generate(),this._map=null,this._inputsContainer=null,this._buttonLabel=null,this._inputAutoComplete=null,this._inputShowPointerContainer=null,this._inputShowPointer=null,this._inputCoordinateContainer=null,this._addPointElement=null,this._removePointElement=null,this._coordinate=null,this._suggestedContainer=null,this._suggestedList=null,this._suggestedLocations=[],this._currentLocation=null,this._initMarker(),this._resources={},this.listenerKey=null}_initMarker(){if(this._marker=null,this._markerUrl="",this._markerOffset=[0,0],this.options.tag.markerOpts&&this.options.tag.markerOpts.url){this._markerUrl=this.options.tag.markerOpts.url;var e=this.options.tag.markerOpts.offset;e&&(Array.isArray(e)&&e.length===2?this._markerOffset=e:logger$r.log("markerOpts.offset should be an array. e.g. : [0,0]"))}else this._markerUrl=Marker.lightOrange,this._markerOffset=Marker.defaultOffset}getCoordinate(){return this._coordinate}setCoordinate(e,i){var s=this.getMap(),o=s.getView().getProjection().getCode();i||(i=o),this._setCoordinate(e,i),e=transform$1(e,i,o),this._setMarker([e[0],e[1]],null,!1)}clear(){this.clearResults(),this._buttonLabel.click()}clearResults(){this._currentLocation=null,this._coordinate=null,this._hideSuggestedLocation(),this._clearSuggestedLocation(),this._setMarker(),unByKey(this.listenerKey)}_initContainer(){var e=this.options.tag.id,i=this._createMainContainerElement(),s=this._inputsContainer=this._createLocationPointElement(e,this.options.tag.display);i.appendChild(s);var o=this._buttonLabel=this._createLocationPointLabelElement(e,this.options.tag.label);s.appendChild(o);var l=this._inputAutoComplete=this._createLocationAutoCompleteteInputElement(e);l.addEventListener?l.addEventListener("click",()=>this.onAutoCompleteInputClick()):l.attachEvent&&l.attachEvent("onclick",()=>this.onAutoCompleteInputClick()),s.appendChild(l);var c=this._inputCoordinateContainer=this._createLocationCoordinateInputElement(e);s.appendChild(c);var u=this._inputShowPointerContainer=this._createLocationPointerShowInputElement(e);s.appendChild(u);var f=this._inputShowPointer=this._createLocationPointerInputElement(e);if(s.appendChild(f),this.options.tag.addOption){var g=this._addPointElement=this._createLocationAddPointElement();s.appendChild(g)}if(this.options.tag.removeOption){var H=this._removePointElement=this._createLocationRemovePointElement(e);s.appendChild(H)}var Y=this._suggestedContainer=this._createLocationAutoCompleteElement(e),ee=this._suggestedList=this._createLocationAutoCompleteResultElement(e);return Y.appendChild(ee),i.appendChild(Y),i}onAutoCompleteInputClick(){this._inputAutoComplete&&this._inputAutoComplete.value.length>2&&this._displaySuggestedLocation()}onAutoCompleteSearchText(e){var i=e.target.value;if(i){var s=this.options.autocompleteOptions||{},o=s.onSuccess||null,l=s.onFailure||null;if(this._currentLocation=i,i.length<3){this._clearSuggestedLocation();return}var c=this;this._requestAutoComplete({text:i,maximumResponses:5,onSuccess:function(f){if(f){var g=f.suggestedLocations;c._fillAutoCompletedLocationListContainer(g),o&&o.call(this,f)}},onFailure:function(f){c._clearSuggestedLocation(),logger$r.log(f.message),l&&l.call(this,f)}});var u=this.getMap();u.on("click",()=>this._hideSuggestedLocation()),u.on("pointerdrag",()=>this._hideSuggestedLocation())}}onAutoCompletedResultsItemClick(e){var i=SelectorID.index(e.target.id);if(i){var s=[this._suggestedLocations[i].position.x,this._suggestedLocations[i].position.y];this._coordinate=s;var o={type:this._suggestedLocations[i].type,fields:this._suggestedLocations[i]},l=GeocodeUtils.getSuggestedLocationFreeform(this._suggestedLocations[i]);this._setLabel(l);var c=this.getMap().getView(),u=c.getProjection().getCode();u!=="EPSG:4326"&&(s=transform$1(s,"EPSG:4326",u)),this._setPosition(s),this._setMarker(s,o,this.options.displayInfo)}}onActivateMapPointClick(){var e=this.getMap();this._inputShowPointerContainer.checked?(this.clearResults(),this.listenerKey=e.on("click",i=>this.onMouseMapClick(i)),this._setCursor("crosshair")):(unByKey(this.listenerKey),this._setCursor())}onLocationClearPointClick(){this._setCursor(),this.clearResults()}onLocationRemovePointClick(){this._setCursor(),this.clearResults()}onLocationAddPointClick(e){logger$r.log("onRouteAddPointClick",e)}onMouseMapClick(e){var i=e.coordinate;if(!(!e.map||!e.map.getView())){var s=e.map.getView().getProjection();this._setCoordinate(i,s),this._setMarker([i[0],i[1]],null,!1),this.onActivateMapPointClick(e)}}_setLabel(e){this._inputAutoComplete.value=e}_setCursor(e){var i=this.getMap(),s=i.getTargetElement();e?s.style.cursor=e:s.style.cursor=null}_setCoordinate(e,i){this._coordinate=transform$1(e,i,"EPSG:4326");var s=this._coordinate[0].toFixed(4),o=this._coordinate[1].toFixed(4),l=o+" / "+s;this.GPdisplayCoordinate(l)}_setPosition(e){var i=this.getMap().getView();i.setCenter(e)}_setMarker(e,i,s){var o=this.getMap();if(this._marker!=null&&(o.removeOverlay(this._marker),this._marker=null),e){var l=document.createElement("img");l.src=this._markerUrl,this._marker=new Overlay({position:e,offset:this._markerOffset,element:l,stopEvent:!1}),o.addOverlay(this._marker),s&&logger$r.log("marker information : ",i)}}_clearSuggestedLocation(){if(this._suggestedLocations=[],this._suggestedList)for(;this._suggestedList.firstChild;)this._suggestedList.removeChild(this._suggestedList.firstChild)}_hideSuggestedLocation(){this._suggestedContainer&&(this._suggestedContainer.classList.replace("GPelementVisible","GPelementHidden"),this._suggestedContainer.classList.replace("gpf-visible","gpf-hidden"))}_displaySuggestedLocation(){this._suggestedContainer&&(this._suggestedContainer.classList.replace("GPelementHidden","GPelementVisible"),this._suggestedContainer.classList.replace("gpf-hidden","gpf-visible"))}_requestAutoComplete(e){if(logger$r.log("_requestAutoComplete()",e),!(!e||Object.keys(e).length===0)&&e.text){logger$r.log(e);var i={};Helper.assign(i,this.options.autocompleteOptions),Helper.assign(i,e);var s=this._resources.AutoCompletion||null;s&&Array.isArray(s)&&(i.filterOptions||(i.filterOptions={}),i.filterOptions.type=s),i.apiKey=i.apiKey||this.options.apiKey,typeof i.ssl!="boolean"&&(typeof this.options.ssl=="boolean"?i.ssl=this.options.ssl:i.ssl=!0),logger$r.log(i),Gp.Services.autoComplete(i)}}_fillAutoCompletedLocationListContainer(e){if(!(!e||e.length===0)){var i=this._suggestedList;if(i.childElementCount)for(;i.firstChild;)i.removeChild(i.firstChild);for(var s=0;s<e.length;s++)this._createLocationAutoCompletedLocationElement(this.options.tag.id,e[s],s);this._suggestedLocations=e}}}Object.assign(LocationSelector.prototype,LocationSelectorDOM);window.ol&&window.ol.control&&(window.ol.control.LocationSelector=LocationSelector);var ExportDOM={_addUID:function(n){var e=this.uid?n+"-"+this.uid:n;return e}},logger$q=LoggerByDefault.getLogger("export");class ButtonExport extends Control{constructor(e){if(e=e||{layer:null,control:null,target:null,format:"geojson",name:"export",description:"export",title:"Exporter",kind:"secondary",menu:!1,icons:{menu:" ",button:""},callback:null},logger$q.trace("[constructor] Export",e),super({element:document.createElement("div"),render:e.render,target:null}),!(this instanceof ButtonExport))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this.CLASSNAME="Export",this.EXPORT_ROUTE={},this.EXPORT_ISOCHRON={},this.EXPORT_PROFILE={},this.uid=e.id||SelectorID.generate(),this.extension=null,this.mimeType=null,this.container=null,this.button=null,this.buttonOptions=null,this.inputName=null,this.inputDesc=null,this.menu=null,this.menuClassHidden="GPelementHidden gpf-hidden",this.initOptions(e),this.initContainer(),this.BUTTON_EXPORT_CLICKED_EVENT="button:clicked"}render(){if(!this.options.target&&this.options.control){var e=this.options.control.getContainer(),i=e.querySelector(".container-buttons-plugin");this.options.target=i||e.lastChild}this.container&&this.options.target.appendChild(this.container)}initOptions(e){this.options={layer:null,control:null,target:null,download:!0,format:"geojson",name:"export",description:"export",title:"Exporter",kind:"secondary",direction:"row",menu:!1,menuOptions:{above:!1,outside:!1,labelName:!0,labelDesc:!0,selectFormat:!0},icons:{menu:" ",button:"export"},callback:null};var i=Helper.assign(this.options.icons,e.icons),s=Helper.assign(this.options.menuOptions,e.menuOptions);Helper.assign(this.options,e),Helper.assign(this.options.icons,i),Helper.assign(this.options.menuOptions,s),logger$q.debug(this.options),this.options.layer,this.options.control,this.options.target;var o=this.options.format;o?this.setFormat(o):this.setFormat(""),this.options.name||this.setName("export"),this.options.description||this.setDescription("export"),this.options.title||this.setTitle("Exporter"),this.options.kind||this.setKind("secondary"),this.options.menu===void 0&&this.setMenu(!1)}initContainer(){var e=this.options.title;this.options.menu&&(e=this.options.icons.menu+this.options.title);var i=document.createElement("div");i.id=this._addUID("GPexportContainer"),i.className="GPexportMenuContainer gpf-export-menu-container gpf-export-menu-container-row-reverse",this.options.direction==="column"&&i.classList.replace("gpf-export-menu-container-row-reverse","gpf-export-menu-container-column-reverse");var s=this.stringToHTML(`
            <div class="GPexportMenuHidden gpf-accordion fr-accordion ${this.menuClassHidden}">
                <h3 class="gpf-accordion__title fr-accordion__title">
                    <button type="button" 
                        id="GPexportBtnMenuContent-${this.uid}"
                        class="gpf-accordion__btn fr-accordion__btn" 
                        aria-expanded="false" aria-controls="GPexportMenuContent-${this.uid}">options</button>
                </h3>
                <div id="GPexportMenuContent-${this.uid}"
                    class="GPexportMenuContent fr-collapse fr-mx-2w">
                    <div id="GPexportMenuName-${this.uid}" 
                        class="GPexportMenuName">
                        <label class="GPlabel gpf-label fr-label" for="GPexportMenuInputName-${this.uid}" title="Nom">Nom</label>
                        <input type="text" id="GPexportMenuInputName-${this.uid}" class="GPinput gpf-input fr-input">
                    </div>
                    <div id="GPexportMenuDesc-${this.uid}"
                        class="GPexportMenuDesc">
                        <label class="GPlabel gpf-label fr-label" for="GPexportMenuInputDesc-${this.uid}" title="Description">Description</label>
                        <input type="text" id="GPexportMenuInputDesc-${this.uid}" class="GPinput gpf-input fr-input">
                    </div>
                    <div id="GPexportMenuFormat-${this.uid}">
                        <label class="GPlabel gpf-label fr-label" title="Formats">Formats</label>
                        <div class="GPexportMenuFormat fr-radio-group fr-m-1w">
                            <input type="radio" 
                                id="GPmenuFormatGeojson-${this.uid}"
                                name="format" 
                                value="geojson">
                            <label class="fr-label container" for="GPmenuFormatGeojson-${this.uid}">GeoJSON
                                <span class="checkmark"></span>
                            </label>
                        </div>
                        <div class="GPexportMenuFormat fr-radio-group fr-m-1w">
                            <input type="radio" 
                                id="GPmenuFormatKml-${this.uid}"
                                name="format" 
                                value="kml">
                            <label class="fr-label container" for="GPmenuFormatKml-${this.uid}">KML
                                <span class="checkmark"></span>
                            </label>
                        </div>
                        <div class="GPexportMenuFormat fr-radio-group fr-m-1w">
                            <input type="radio" 
                                id="GPmenuFormatGpx-${this.uid}"
                                name="format" 
                                value="gpx">
                            <label class="fr-label container" for="GPmenuFormatGpx-${this.uid}">GPX
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                    <div id="GPexportMenuButtons-${this.uid}" 
                        class="GPexportMenuButtons">
                        <button 
                            type="button"
                            id="GPexportMenuButtonValidate-${this.uid}" 
                            class="GPexportMenuButtonValidate GPsubmit gpf-btn gpf-btn-icon-export-validate fr-btn fr-btn--secondary fr-m-1w">
                            Valider
                        </button>
                        <button 
                            type="button"
                            id="GPexportMenuButtonCancel-${this.uid}" 
                            class="GPexportMenuButtonIconCancel GPsubmit gpf-btn gpf-btn-icon-export-cancel fr-btn fr-btn--secondary fr-m-1w">
                            Annuler
                        </button>
                    </div>
                </div>
            </div>
        `);if(this.menu=s.firstChild,this.menu){if(this.options.menu){var o=this.menu.className;this.menu.className=o.replace(this.menuClassHidden,"")}var l=this.options.format.toUpperCase(),c=this.menu.querySelectorAll('input[type=radio][name="format"]');for(let tt=0;tt<c.length;tt++){var u=c[tt];u.id.toUpperCase().includes(l)&&(u.checked=!0),u.addEventListener("change",et=>this.onChangeRadioFormat(et))}this.buttonOptions=this.menu.querySelector("#GPexportBtnMenuContent-"+this.uid),this.buttonOptions&&this.buttonOptions.addEventListener("click",tt=>this.onClickButtonToggleOptions(tt)),this.inputName=this.menu.querySelector("#GPexportMenuInputName-"+this.uid),this.inputDesc=this.menu.querySelector("#GPexportMenuInputDesc-"+this.uid),this.inputName.addEventListener("change",tt=>this.onChangeInputName(tt)),this.inputName.addEventListener("focusin",tt=>this.onFocusInputName(tt)),this.inputDesc.addEventListener("change",tt=>this.onChangeInputDesc(tt)),this.inputDesc.addEventListener("focusin",tt=>this.onFocusInputDesc(tt));var f=this.menu.querySelector("#GPexportMenuButtonValidate-"+this.uid);f.addEventListener("click",tt=>this.onClickButtonValidate(tt));var g=this.menu.querySelector("#GPexportMenuButtonCancel-"+this.uid);if(g.addEventListener("click",tt=>this.onClickButtonCancel(tt)),this.options.menuOptions){if(this.options.menuOptions.outside){this.menu.classList.remove("gpf-accordion","fr-accordion");var H=this.menu.querySelector("#GPexportBtnMenuContent-"+this.uid);H.classList.add("gpf-hidden");var Y=this.menu.querySelector("#GPexportMenuContent-"+this.uid);Y.classList.remove("fr-collapse");var ee=this.menu.querySelector("#GPexportMenuButtons-"+this.uid);ee.classList.add("gpf-hidden")}if(this.options.menuOptions.above&&(i.classList.replace("gpf-export-menu-container-row-reverse","gpf-export-menu-container-row"),i.classList.replace("gpf-export-menu-container-column-reverse","gpf-export-menu-container-column")),!this.options.menuOptions.labelName){var te=this.menu.querySelector("#GPexportMenuName-"+this.uid);te.classList.add("gpf-hidden")}if(!this.options.menuOptions.labelDesc){var ne=this.menu.querySelector("#GPexportMenuDesc-"+this.uid);ne.classList.add("gpf-hidden")}if(!this.options.menuOptions.selectFormat){var Ye=this.menu.querySelector("#GPexportMenuFormat-"+this.uid);Ye.classList.add("gpf-hidden")}}}i.appendChild(this.menu);var xe=this.stringToHTML(`
            <button 
                type="button"
                id="${this._addUID("GPexportButton")}" 
                class="GPexportButtonExportIcon GPsubmit gpf-btn gpf-btn-icon-export-submit fr-btn fr-m-1w">
                ${e}
            </button>
        `);switch(this.button=xe.firstChild,this.button&&this.button.addEventListener("click",tt=>this.onClickButtonExport(tt)),this.options.kind){case"tertiary":this.button.classList.add("fr-btn--tertiary","gpf-btn--tertiary");break;case"secondary":this.button.classList.add("fr-btn--secondary","gpf-btn--secondary");break;case"primary":default:this.button.classList.add("fr-btn--primary","gpf-btn--primary");break}if(!this.options.icons.button)this.button.classList.remove("GPexportButtonExportIcon","gpf-btn-icon-export-submit");else switch(this.options.icons.button){case"export":break;case"save":this.button.classList.replace("GPexportButtonExportIcon","GPexportButtonSaveIcon"),this.button.classList.replace("gpf-btn-icon-export-submit","gpf-btn-icon-save-submit");break;default:this.button.classList.remove("GPexportButtonExportIcon","gpf-btn-icon-export-submit");break}i.appendChild(this.button),this.container=i}stringToHTML(e){var i=function(){if(!window.DOMParser)return!1;var c=new DOMParser;try{c.parseFromString("x","text/html")}catch{return!1}return!0};if(i()){var s=new DOMParser,o=s.parseFromString(e,"text/html");return o.body}var l=document.createElement("div");return l.innerHTML=e,l}isPluggableControl(){return!!(this.options.control&&typeof this.options.control.getContainer=="function"&&typeof this.options.control.getLayer=="function")}exportFeatures(e,i,s){var o=null;if(!e)return logger$q.warn("Impossible to export : no layer is hosting features."),o;if(!e.getSource()||!e.getSource().getFeatures()||!e.getSource().getFeatures().length)return logger$q.warn("Impossible to export : no features found."),o;e.getSource().getFeatures().forEach(H=>{var Y=H.getStyle();!Y&&this.options.control&&typeof this.options.control.getStyle=="function"&&H.setStyle(this.options.control.getStyle())});var l={defaultStyle:s,extensions:{}};i&&(l.extensions={"geoportail:compute":i}),this.options.description&&(l.extensions.description=this.inputDesc&&this.inputDesc.value?this.inputDesc.value:this.options.description);var c=null;switch(this.options.format.toUpperCase()){case"KML":l.writeStyles=!0,l.showPointNames=!0,c=new KML(l);break;case"GPX":c=new GPX(l);break;case"GEOJSON":c=new GeoJSON(l);break}if(!c)return logger$q.warn("Impossible to export : format unknown !?"),o;var u=e.getSource().getProjection(),f=this.getMap();f&&(u=u||f.getView().getProjection());var g=e.getSource().getFeatures();return o=c.writeFeatures(g,{dataProjection:"EPSG:4326",featureProjection:u||"EPSG:3857"}),o}onClickButtonExport(e){this.isPluggableControl()||logger$q.warn("Componant not pluggable with the control !");var i=this.options.control&&this.options.control.getLayer!==void 0?this.options.control.getLayer():this.options.layer,s=this.options.control&&this.options.control.getData!==void 0?this.options.control.getData():{},o=this.options.control&&this.options.control.getStyle!==void 0?this.options.control.getStyle():{},l=this.exportFeatures(i,s,o);if(!(!l||l==="null")){if(this.dispatchEvent({type:this.BUTTON_EXPORT_CLICKED_EVENT,content:l,name:this.options.name,description:this.options.description,format:this.options.format,layer:i}),this.options.download){var c=document.createElement("a"),u="utf-8";if(c.setAttribute("href","data:"+this.mimeType+";charset="+u+","+encodeURIComponent(l)),c.setAttribute("download",this.options.name+this.extension),document.createEvent){var f=document.createEvent("MouseEvents");f.initEvent("click",!0,!0),c.dispatchEvent(f)}else c.click()}this.options.callback&&typeof this.options.callback=="function"&&this.options.callback(l,i)}}onChangeRadioFormat(e){this.setFormat(e.target.value)}onChangeInputName(e){this.setName(e.target.value)}onFocusInputName(e){var i=this.getMap();i&&this.options.control&&typeof this.options.control.disable=="function"&&this.options.control.disable()}onChangeInputDesc(e){this.setDescription(e.target.value)}onFocusInputDesc(e){var i=this.getMap();i&&this.options.control&&typeof this.options.control.disable=="function"&&this.options.control.disable()}onClickButtonToggleOptions(e){e.target.ariaExpanded=e.target.ariaExpanded!=="true";var i=this.menu.querySelector("#"+e.target.getAttribute("aria-controls"));i&&(e.target.ariaExpanded==="true"?(i.classList.add("fr-collapse--expanded"),this.menu.classList.add("gpf-full-container"),this.menu.classList.add("gpf-accordion--opened"),i.classList.remove("GPelementHidden")):(i.classList.remove("fr-collapse--expanded"),this.menu.classList.remove("gpf-full-container"),this.menu.classList.remove("gpf-accordion--opened"),i.classList.add("GPelementHidden")))}onClickButtonValidate(e){this.setName(this.inputName.value),this.setDescription(this.inputDesc.value),this.buttonOptions.click()}onClickButtonCancel(e){this.inputName.value="",this.inputDesc.value="",this.buttonOptions.click()}getContainer(){return this.container}setControl(e){this.options.control=e}setTarget(e){this.options.target=e}setFormat(e){switch(this.options.format=e.toUpperCase(),this.options.format){case"KML":this.extension=".kml",this.mimeType="application/vnd.google-earth.kml+xml";break;case"GPX":this.extension=".gpx",this.mimeType="application/gpx+xml";break;case"GEOJSON":this.extension=".geojson",this.mimeType="application/geo+json";break;default:this.options.format="GEOJSON",this.extension=".geojson",this.mimeType="application/geo+json";break}}setName(e){this.options.name=e}setDescription(e){this.options.description=e}setTitle(e){this.options.title=e,this.button&&(this.button.textContent=this.options.menu?this.options.icons.menu+e:e)}setKind(e){if(this.options.kind=e,this.button)switch(this.button.classList.remove("fr-btn--tertiary","gpf-btn--tertiary"),this.button.classList.remove("fr-btn--secondary","gpf-btn--secondary"),this.options.kind){case"tertiary":this.button.classList.add("fr-btn--tertiary","gpf-btn--tertiary");break;case"secondary":this.button.classList.add("fr-btn--secondary","gpf-btn--secondary");break;case"primary":default:this.button.classList.add("fr-btn--primary","gpf-btn--primary");break}}setMenu(e){if(this.options.menu=e,this.button&&(this.button.textContent=this.options.menu?this.options.icons.menu+this.options.title:this.options.title),this.menu&&this.options.menu){var i=this.menu.className;this.menu.className=i.replace(this.menuClassHidden,"");var s=this.options.format.toUpperCase(),o=this.menu.querySelectorAll('input[type=radio][name="format"]');for(let c=0;c<o.length;c++){var l=o[c];l.id.toUpperCase().includes(s)&&(l.checked=!0)}}}setMenuOptions(e){}setLayer(e){this.options.layer=e}setDownload(e){this.options.download=e}}Object.assign(ButtonExport.prototype,ExportDOM);Object.assign(ButtonExport.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.Export=ButtonExport);var logger$p=LoggerByDefault.getLogger("RouteDOM"),RouteDOM={_addUID:function(n){var e=this._uid?n+"-"+this._uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GProute"),n.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",n},_createShowRoutePictoElement:function(){var n=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowRoutePicto"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowRoutePicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-route fr-btn fr-btn--tertiary",e.setAttribute("aria-label","Ouvrir le calcul d'itinraire"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowRoutePanelClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowRoutePanelClick(s)}),e},_createRoutePanelElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GProutePanel"),n.className="GPpanel gpf-panel fr-modal",n},_createRoutePanelDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__body fr-modal__body",n},_createDrawingButtonsPluginDiv:function(){var n=document.createElement("div");return n.className="container-buttons-plugin fr-mx-2w",n},_createRoutePanelHeaderElement:function(){var n=this,e=document.createElement("div");e.className="GPpanelHeader gpf-panel__header fr-modal__header";var i=document.createElement("div");i.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",i.innerHTML="Calcul d'itinraire",e.appendChild(i);var s=document.createElement("button");s.id=this._addUID("GProutePanelClose"),s.className="GPpanelClose GProutePanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",s.title="Masquer le panneau",s.addEventListener?s.addEventListener("click",function(){document.getElementById(n._addUID("GPshowRoutePicto")).click()},!1):s.attachEvent&&s.attachEvent("onclick",function(){document.getElementById(n._addUID("GPshowRoutePicto")).click()});var o=document.createElement("span");return o.className="GPelementHidden gpf-visible",o.innerText="Fermer",s.appendChild(o),e.appendChild(s),e},_createRoutePanelFooterElement:function(){var n=document.createElement("div");return n.className="GPpanelFooter gpf-panel__footer fr-modal__footer",n},_createRoutePanelFormPointLabel:function(n,e=!0){var i=document.createElement("p");i.innerHTML=n;var s=e?"":" GPelementHidden gpf-hidden";return i.className="GProutePointLabelP gpf-label fr-label"+s,i},_createRoutePanelFormElement:function(){var n=this,e=document.createElement("form");return e.id=this._addUID("GProuteForm"),e.className="gpf-panel__content fr-modal__content",e.setAttribute("onkeypress","return event.keyCode != 13;"),e.addEventListener("submit",function(i){logger$p.log(i),i.preventDefault();var s=document.getElementsByClassName(n._addUID("GPlocationPoint")),o=s[0].childNodes[0].id,l=s[s.length-1].childNodes[0].id,c=SelectorID.index(o),u=SelectorID.index(l);if(document.getElementById(n._addUID("GPlocationOrigin_"+c)).value===""&&document.getElementById(n._addUID("GPlocationOriginCoords_"+c)).value===""||document.getElementById(n._addUID("GPlocationOrigin_"+u)).value===""&&document.getElementById(n._addUID("GPlocationOriginCoords_"+u)).value==="")return!1;n._addRouteResultsStagesValuesElement(s);var f=null;document.getElementById(n._addUID("GProuteComputationChoice"))&&(document.getElementById(n._addUID("GProuteComputationFastest"))&&document.getElementById(n._addUID("GProuteComputationFastest")).checked&&(f=document.getElementById(n._addUID("GProuteComputationFastest")).value),document.getElementById(n._addUID("GProuteComputationShortest"))&&document.getElementById(n._addUID("GProuteComputationShortest")).checked&&(f=document.getElementById(n._addUID("GProuteComputationShortest")).value));var g=null;document.getElementById(n._addUID("GProuteTransportCar"))&&document.getElementById(n._addUID("GProuteTransportCar")).checked&&(g=document.getElementById(n._addUID("GProuteTransportCar")).value),document.getElementById(n._addUID("GProuteTransportPedestrian"))&&document.getElementById(n._addUID("GProuteTransportPedestrian")).checked&&(g=document.getElementById(n._addUID("GProuteTransportPedestrian")).value);for(var H=[],Y=document.getElementsByClassName("GProuteExclusionsOption"),ee=0;ee<Y.length;ee++){var te=Y[ee].htmlFor,ne=document.getElementById(te);ne.checked||H.push(ne.value)}return n.onRouteComputationSubmit({computation:f,transport:g,exclusions:H}),!1}),e},_createRoutePanelResultsElement:function(){var n=document.createElement("div");return n.id=this._addUID("GProuteResultsPanel"),n.className="GPelementHidden gpf-hidden",n.appendChild(this._createRouteResultsStagesElement()),n.appendChild(this._createRouteResultsElement()),n.appendChild(this._createRouteShowResultsDetailsElement()),n.appendChild(this._createRouteResultsDetailsElement()),n},_createRouteWaitingElement:function(){var n=document.createElement("div");n.id=this._addUID("GProuteCalcWaitingContainer"),n.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden";var e=document.createElement("p");return e.className="GPwaitingContainerInfo gpf-waiting_info",e.innerHTML="Recherche en cours...",n.appendChild(e),n},_createRouteResultsStagesElement:function(){var n=document.createElement("div");return n.id=this._addUID("GProuteResultsStages"),n},_addRouteResultsStagesValuesElement:function(n){document.getElementById(this._addUID("GProuteResultsStages")).innerHTML="";for(var e=0;e<n.length;e++){var i=n[e].childNodes[0].id,s=SelectorID.index(i);if(document.getElementById(this._addUID("GPlocationPoint_"+s)).className==="GPflexInput GPlocationStageFlexInput gpf-flex"){var o=document.createElement("div");o.className="GProuteResultsStages fr-my-1w";var l=document.createElement("span");l.className="GProuteResultStageLabel",l.innerHTML=document.getElementById(this._addUID("GPlocationOriginLabel_"+s)).innerHTML+" : ",o.appendChild(l);var c=document.createElement("span");c.className="GProuteResultStageValue";var u=document.getElementById(this._addUID("GPlocationOriginCoords_"+s)),f=u.value;f!==null&&f!==""?c.innerHTML=f:c.innerHTML=document.getElementById(this._addUID("GPlocationOrigin_"+s)).value,o.appendChild(c),c.innerHTML!==""&&document.getElementById(this._addUID("GProuteResultsStages")).appendChild(o)}}},_createRouteResultsElement:function(){var n=this,e=document.createElement("div");e.id=this._addUID("GProuteResults");var i=document.createElement("div");i.id=this._addUID("GProuteResultsValues"),e.appendChild(i);var s=document.createElement("div");s.id=this._addUID("GProuteResultsMode");var o=document.createElement("select");o.id=this._addUID("GProuteResultsComputationSelect"),o.className="GPselect gpf-select fr-select",o.addEventListener("change",function(g){n.onRouteModeComputationChangeAndRun(g)});for(var l=[{code:"fastest",label:"Plus rapide"},{code:"shortest",label:"Plus court"}],c=0;c<l.length;c++){var u=document.createElement("option");u.value=l[c].code,u.text=l[c].label,o.appendChild(u)}s.appendChild(o),e.appendChild(s);var f=document.createElement("div");return f.id=this._addUID("GProuteResultsNew"),f.className="GPresetPicto gpf-btn gpf-btn-icon-reset fr-btn fr-btn--secondary gpf-btn--secondary",f.title="Modifier le calcul",f.addEventListener("click",function(g){document.getElementById(n._addUID("GProuteResultsPanel")).className="GPelementHidden gpf-hidden",document.getElementById(n._addUID("GProuteForm")).className="gpf-panel__content fr-modal__content",n.onShowRouteResultsNewClick(g)}),e.appendChild(f),e},_addRouteResultsValuesElement:function(n,e,i){var s=document.getElementById(this._addUID("GProuteResultsValues"));if(s.childElementCount)for(;s.firstChild;)s.removeChild(s.firstChild);var o=document.createElement("div");o.className="GProuteResultsValue";var l=document.createElement("label");l.className="GProuteResultsValueLabel",l.innerHTML="Distance :",o.appendChild(l);var c=0,u=parseInt(n/1e3,10);if(!u)c=Math.round(n)+" m";else{var f=Math.round(n);f=f/1e3,c=f+" km"}var g=document.createElement("div");g.id=this._addUID("GProuteResultsValueDist"),g.innerHTML=c,o.appendChild(g),s.appendChild(o);var H=document.createElement("div");H.className="GProuteResultsValue";var Y=document.createElement("label");Y.className="GProuteResultsValueLabel",Y.innerHTML="Dure :",H.appendChild(Y);var ee=document.createElement("div");return ee.id=this._addUID("GProuteResultsValueDist"),ee.innerHTML=i(e),H.appendChild(ee),s.appendChild(H),s},_createRouteShowResultsDetailsElement:function(){var n=document.createElement("div");if(n.className="GProuteResultsShowDetailsDiv gpf-flex fr-checkbox-group fr-m-1w",!checkDsfr()){var e=document.createElement("div");e.className="GPfakeBorder GPfakeBorderLeft",n.appendChild(e)}var i=document.createElement("input");i.id=this._addUID("GProuteResultsShowDetails"),i.type="checkbox",n.appendChild(i);var s=document.createElement("label");if(s.className="gpf-label fr-label",s.htmlFor=this._addUID("GProuteResultsShowDetails"),s.innerHTML="Afficher le dtail",n.appendChild(s),!checkDsfr()){var o=document.createElement("label");o.htmlFor=this._addUID("GProuteResultsShowDetails"),o.innerHTML="Masquer le dtail",n.appendChild(o);var l=document.createElement("div");l.className="GPfakeBorder",n.appendChild(l)}return n},_createRouteResultsDetailsElement:function(){var n=document.createElement("div");return n.id=this._addUID("GProuteResultsDetails"),n},_addRouteResultsDetailsElement:function(n,e){var i=this,s=document.getElementById(this._addUID("GProuteResultsDetails"));if(s.childElementCount)for(;s.firstChild;)s.removeChild(s.firstChild);for(var o=0,l=0,c=0;c<n.length;c++){var u=c+1,f=n[c],g=document.createElement("div");g.className="GProuteResultsDetailsNumber",g.innerHTML=u+".",s.appendChild(g),l+=parseFloat(f.duration),o+=parseFloat(f.distance);var H=0,Y=parseInt(o/1e3,10);if(!Y)H=Math.round(o)+" m";else{var ee=Math.round(o);ee=ee/1e3,H=ee+" km"}var te=document.createElement("div");te.className="GProuteResultsDetailsInstruction",te.id=this._addUID("GProuteResultsDetailsInstruction_"+u),te.title="distance : "+H+" / temps : "+e(l),te.innerHTML=f.instruction,te.addEventListener("mouseover",function(ne){i.onRouteResultsDetailsMouseOver(ne)}),te.addEventListener("mouseout",function(ne){i.onRouteResultsDetailsMouseOut(ne)}),te.addEventListener("click",function(ne){typeof i.onRouteResultsDetailsClick=="function"&&i.onRouteResultsDetailsClick(ne)}),s.appendChild(te)}return s},_createRoutePanelFormPointElement:function(n,e,i){var s=this,o=document.createElement("div");o.id="GProutePoint"+n,o.className=i?"GPflexInput GProuteStageFlexInput":"GPflexInput GProuteStageFlexInputHidden";var l=document.createElement("label");l.id="GProuteOriginLabel"+n,l.htmlFor="GProuteOrigin"+n,l.innerHTML=e,l.addEventListener("click",function(){var H=this.id.charAt(this.id.length-1);document.getElementById("GProuteOriginCoords"+H).value="";for(var Y=1;Y<8;Y++)document.getElementById("GProutePoint"+Y).style.display="flex";document.getElementById("GProuteForm").className="gpf-panel__content fr-modal__content",document.getElementById("GProuteOriginPointer"+H).checked=!1,document.getElementById("GProuteOrigin"+H).className="GPelementVisible gpf-visible",document.getElementById("GProuteOriginCoords"+H).className="GPelementHidden gpf-hidden"}),o.appendChild(l);var c=document.createElement("input");c.id="GProuteOrigin"+n,c.className="GPelementVisible gpf-visible",c.type="text",c.placeholder="Saisir une adresse, un lieu...",c.addEventListener("keyup",function(H){var Y=H.which||H.keyCode;if(!(Y===13||Y===10)){var ee=this.id.charAt(this.id.length-1);document.getElementById("GProuteOrigin"+ee).value.length>2?document.getElementById("GProuteAutoCompleteList"+ee).style.display="block":document.getElementById("GProuteAutoCompleteList"+ee).style.display="none",s.onAutoCompleteSearchText(H)}}),c.addEventListener("blur",function(){var H=this.id.charAt(this.id.length-1);document.getElementById("GProuteAutoCompleteList"+H).style.display="none"}),o.appendChild(c);var u=document.createElement("input");u.id="GProuteOriginCoords"+n,u.className="GPelementHidden gpf-hidden",u.type="text",u.disabled=!0,o.appendChild(u);var f=document.createElement("input");f.id="GProuteOriginPointer"+n,f.type="checkbox",o.appendChild(f);var g=document.createElement("label");return g.id="GProuteOriginPointerImg"+n,g.htmlFor="GProuteOriginPointer"+n,g.className="GProuteOriginPointerImg",g.title="Pointer un lieu sur la carte",g.addEventListener("click",function(H){H.preventDefault(),H.stopPropagation();var Y=this.id.charAt(this.id.length-1),ee;for(ee=1;ee<8;ee++)Y!==ee&&(document.getElementById("GProuteOriginPointer"+ee).checked=!1,document.getElementById("GProuteOriginCoords"+ee).value==="Pointer un lieu sur la carte"&&(document.getElementById("GProuteOriginCoords"+ee).value="",document.getElementById("GProuteOrigin"+ee).className="GPelementVisible gpf-visible",document.getElementById("GProuteOriginCoords"+ee).className="GPelementHidden gpf-hidden"));if(document.getElementById("GProuteOriginPointer"+Y).checked){for(document.getElementById("GProuteOriginCoords"+Y).value="",ee=1;ee<8;ee++)document.getElementById("GProutePoint"+ee).style.display="flex";document.getElementById("GProuteForm").className="gpf-panel__content fr-modal__content",document.getElementById("GProuteOriginPointer"+Y).checked=!1,document.getElementById("GProuteOrigin"+Y).className="GPelementVisible gpf-visible",document.getElementById("GProuteOriginCoords"+Y).className="GPelementHidden gpf-hidden"}else{for(document.getElementById("GProuteOriginCoords"+Y).value="Pointer un lieu sur la carte",ee=1;ee<8;ee++)Y===ee?document.getElementById("GProutePoint"+ee).style.display="flex":document.getElementById("GProutePoint"+ee).style.display="none";document.getElementById("GProuteForm").className="GProuteFormMini gpf-panel__content fr-modal__content",document.getElementById("GProuteOriginPointer"+Y).checked=!0,document.getElementById("GProuteOrigin"+Y).className="GPelementHidden gpf-hidden",document.getElementById("GProuteOriginCoords"+Y).className="GPelementVisible gpf-visible"}s.onRouteMapPointClick(H)}),o.appendChild(g),o},_createRoutePanelFormRemoveStageElement:function(n){var e=this,i=document.createElement("div");return i.id="GProuteStageRemove"+n,i.className="GProuteStageRemove",i.title="Supprimer l'tape",n!==1&&n!==7&&i.addEventListener("click",function(s){var o=this.id.charAt(this.id.length-1);document.getElementById("GProutePoint"+o).className="GPflexInput GProuteStageFlexInputHidden",document.getElementById("GProuteOrigin"+o).value="",document.getElementById("GProuteOrigin"+o).className="GPelementVisible gpf-visible",document.getElementById("GProuteOriginCoords"+o).value="",document.getElementById("GProuteOriginCoords"+o).className="GPelementHidden gpf-hidden",document.getElementById("GProuteStageAdd").style.display="",e.onRouteRemovePointClick(s)}),i},_createRoutePanelFormAddStageElement:function(){var n=this,e=document.createElement("div");return e.id="GProuteStageAdd",e.title="Ajouter une tape",e.addEventListener("click",function(i){for(var s=1,o=0,l=2;l<7;l++)document.getElementById("GProutePoint"+l).className==="GPflexInput GProuteStageFlexInputHidden"?s===1&&(s=l):o++;s<7&&(document.getElementById("GProutePoint"+s).className="GPflexInput GProuteStageFlexInput"),o===4&&(document.getElementById("GProuteStageAdd").style.display="none"),n.onRouteAddPointClick(i)}),e},_createRoutePanelFormAutoCompleteListElement:function(n){var e=this,i=document.createElement("div");return i.id="GProuteAutoCompleteList"+n,i.className="GPadvancedAutoCompleteList",i.addEventListener?i.addEventListener("click",function(s){e.onAutoCompletedResultsItemClick(s),document.getElementById("GProuteAutoCompleteList"+n).style.display="none"},!1):i.attachEvent&&i.attachEvent("onclick",function(s){e.onAutoCompletedResultsItemClick(s),document.getElementById("GProuteAutoCompleteList"+n).style.display="none"}),i},_createRouteAutoCompletedLocationElement:function(n,e,i){var s=document.getElementById("GProuteAutoCompleteList"+e),o=document.createElement("div");o.id="AutoCompletedLocation"+i,o.className="GPautoCompleteProposal",o.innerHTML=GeocodeUtils.getSuggestedLocationFreeform(n),s.appendChild(o)},_createRoutePanelFormModeChoiceTransportElement:function(n){var e=this,i=document.createElement("div");i.id=this._addUID("GProuteTransportChoice");var s=document.createElement("label");s.className="GProuteModeLabel gpf-label fr-label",s.innerHTML="Choisir un mode de dplacement",i.appendChild(s);var o=document.createElement("div");o.className="gpf-radio-btn-group";for(var l=0;l<n.length;l++){var c=n[l],u=document.createElement("div");if(u.className="GProuteTransportChoice gpf-flex gpf-radio-group fr-radio-group fr-my-1w",c==="Voiture"){var f=document.createElement("input");f.id=this._addUID("GProuteTransportCar"),f.type="radio",f.name="GProuteTransport",f.value="Voiture",l===0&&(f.checked=!0),f.addEventListener?f.addEventListener("change",function(ee){e.onRouteModeTransportChange(ee)}):f.attachEvent&&f.attachEvent("onchange",function(ee){e.onRouteModeTransportChange(ee)}),u.appendChild(f);var g=document.createElement("label");g.className="GProuteTransportImg gpf-label fr-label",g.htmlFor=this._addUID("GProuteTransportCar"),g.title="Voiture",g.innerHTML="Voiture",u.appendChild(g)}if(c==="Pieton"){var H=document.createElement("input");H.id=this._addUID("GProuteTransportPedestrian"),H.type="radio",H.name="GProuteTransport",H.value="Pieton",l===0&&(H.checked=!0),H.addEventListener?H.addEventListener("change",function(ee){e.onRouteModeTransportChange(ee)}):H.attachEvent&&H.attachEvent("onchange",function(ee){e.onRouteModeTransportChange(ee)}),u.appendChild(H);var Y=document.createElement("label");Y.className="GProuteTransportImg gpf-label fr-label",Y.htmlFor=this._addUID("GProuteTransportPedestrian"),Y.title="Piton",Y.innerHTML="Piton",u.appendChild(Y)}o.appendChild(u)}return i.appendChild(o),i},_createRoutePanelFormModeChoiceComputeElement:function(){var n=this,e=document.createElement("div");e.id=this._addUID("GProuteComputationChoice"),e.className="fr-mt-2w";var i=document.createElement("label");i.className="GProuteComputationLabel gpf-label fr-label",i.innerHTML="Mode de calcul",e.appendChild(i);var s=document.createElement("div");s.className="gpf-radio-btn-group";var o=document.createElement("div");o.className="GProuteComputationChoice gpf-flex gpf-radio-group fr-radio-group fr-my-1w";var l=document.createElement("input");l.id=this._addUID("GProuteComputationFastest"),l.type="radio",l.name="GProuteComputation",l.value="fastest",l.checked=!0,l.addEventListener?l.addEventListener("change",function(H){n.onRouteModeComputationChange(H)}):l.attachEvent&&l.attachEvent("onchange",function(H){n.onRouteModeComputationChange(H)}),o.appendChild(l);var c=document.createElement("label");c.className="gpf-label fr-label",c.htmlFor=this._addUID("GProuteComputationFastest"),c.title="Plus rapide",c.innerHTML="Plus rapide",o.appendChild(c),s.appendChild(o);var u=document.createElement("div");u.className="GProuteComputationChoice gpf-flex gpf-radio-group fr-radio-group fr-my-1w";var f=document.createElement("input");f.id=this._addUID("GProuteComputationShortest"),f.type="radio",f.name="GProuteComputation",f.value="shortest",f.addEventListener?f.addEventListener("change",function(H){n.onRouteModeComputationChange(H)}):f.attachEvent&&f.attachEvent("onchange",function(H){n.onRouteModeComputationChange(H)}),u.appendChild(f);var g=document.createElement("label");return g.className="gpf-label fr-label",g.htmlFor=this._addUID("GProuteComputationShortest"),g.title="Plus court",g.innerHTML="Plus court",u.appendChild(g),s.appendChild(u),e.appendChild(s),e},_createShowRouteExclusionsPictoElement:function(){var n=this,e=document.createElement("button");e.id=this._addUID("GPshowRouteExclusionsPicto");var i="";return checkDsfr()&&(i="GPelementHidden gpf-hidden"),e.className=`GPshowAdvancedToolPicto GPshowMoreOptionsImage GPshowMoreOptions GPshowRouteExclusionsPicto ${i} gpf-btn fr-btn--sm fr-btn--tertiary gpf-btn--tertiary fr-icon-arrow-down-fill`,e.title="Exclusions",e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!0),e.addEventListener?e.addEventListener("click",function(s){s.preventDefault();var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowRouteExclusionsClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){s.preventDefault();var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowRouteExclusionsClick(s)}),e},_createRoutePanelFormExclusionsElement:function(){var n=document.createElement("div");n.id=this._addUID("GProuteExclusions"),n.className="fr-mt-2w";var e=document.createElement("label");return e.className="GProuteExclusionsLabel fr-label",e.innerHTML="Passages autoriss",n.appendChild(e),n},_createRoutePanelFormExclusionOptionsElement:function(n){var e=this,i=document.createElement("div");i.className="GProuteExclusionsOptions gpf-flex fr-checkbox-group fr-m-1w";for(var s in n)if(n.hasOwnProperty(s)){var o=n[s];switch(s){case"toll":var l=document.createElement("input");l.id=this._addUID("GProuteExclusionsToll"),l.type="checkbox",l.value="Toll",l.name="Peage",l.checked=!o,l.addEventListener?l.addEventListener("change",function(Y){e.onRouteExclusionsChange(Y)}):l.attachEvent&&l.attachEvent("onchange",function(Y){e.onRouteExclusionsChange(Y)}),i.appendChild(l);var c=document.createElement("label");c.className="GProuteExclusionsOption",c.htmlFor=this._addUID("GProuteExclusionsToll"),c.innerHTML="Pages",i.appendChild(c);break;case"tunnel":var u=document.createElement("input");u.id=this._addUID("GProuteExclusionsTunnel"),u.type="checkbox",u.value="Tunnel",u.name="Tunnel",u.checked=!o,u.addEventListener?u.addEventListener("change",function(Y){e.onRouteExclusionsChange(Y)}):u.attachEvent&&u.attachEvent("onchange",function(Y){e.onRouteExclusionsChange(Y)}),i.appendChild(u);var f=document.createElement("label");f.className="GProuteExclusionsOption",f.htmlFor=this._addUID("GProuteExclusionsTunnel"),f.innerHTML="Tunnels",i.appendChild(f);break;case"bridge":var g=document.createElement("input");g.id=this._addUID("GProuteExclusionsBridge"),g.type="checkbox",g.value="Bridge",g.name="Ponts",g.checked=!o,g.addEventListener?g.addEventListener("change",function(Y){e.onRouteExclusionsChange(Y)}):g.attachEvent&&g.attachEvent("onchange",function(Y){e.onRouteExclusionsChange(Y)}),i.appendChild(g);var H=document.createElement("label");H.className="GProuteExclusionsOption",H.htmlFor=this._addUID("GProuteExclusionsBridge"),H.innerHTML="Ponts",i.appendChild(H);break}}return i},_createRouteSubmitFormElement:function(){var n=document.createElement("input");return n.id=this._addUID("GProuteSubmit"),n.className="GPsubmit gpf-btn gpf-btn-icon-submit fr-btn",n.type="submit",n.value="Calculer l'itinraire",n},_createRouteFormResetElement:function(){var n=this,e=document.createElement("button");return e.id=this._addUID("GProuteReset"),e.title="Rinitialiser les paramtres",e.className="GPresetPicto gpf-btn gpf-btn-icon-reset fr-btn fr-btn--secondary gpf-btn--secondary",e.title="Rinitialiser les paramtres",e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.addEventListener("click",function(i){var s=i.target.ariaPressed==="true";i.target.setAttribute("aria-pressed",!s),n.onRouteResetClick(i)}),e}},logger$o=LoggerByDefault.getLogger("route");class Route extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof Route))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="Route",this.initialize(e),this._container=this._createMainContainerElement(),this.element?this.element.appendChild(this._container):this.element=this._container,this}setMap(e){if(e){if(this._container=this._initContainer(e),this.element=this._container,this.options.export){var i=Helper.assign({control:this},this.options.export);this.export=new ButtonExport(i),this.export.render();var s=this;this.export.on("button:clicked",o=>{s.dispatchEvent({type:"export:compute",content:o.content})})}this.draggable&&Draggable.dragElement(this._panelRouteContainer,this._panelHeaderRouteContainer,e.getTargetElement()),this.collapsed||this._showRouteButton.setAttribute("aria-pressed",!0)}super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getCollapsed(){return this.collapsed}setCollapsed(e){if(e===void 0){logger$o.log("[ERROR] Route:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(e?document.getElementById("GProutePanelClose-"+this._uid).click():this._showRouteButton.click(),this.collapsed=e)}getLayer(){return this._geojsonSections}setLayer(e){if(!e){this._geojsonSections=null;return}if(!(e instanceof VectorLayer)){logger$o.log("no valid layer given for hosting drawn features.");return}e.setStyle(this._defaultFeatureStyle),this._geojsonSections=e}getGeoJSON(){return JSON.stringify(this._geojsonObject)}setGeoJSON(e){try{this._geojsonObject=JSON.parse(e)}catch(i){logger$o.log("no valid geojson given :"+i.message)}}getData(){var e=[];for(let s=0;s<this._currentPoints.length;s++){const o=this._currentPoints[s];e.push(o.getCoordinate())}var i={type:"route",points:e,transport:this._currentTransport,exclusions:this._currentExclusions,computation:this._currentComputation,results:{}};return Helper.assign(i.results,this._currentRouteInformations),i}setData(e){this._currentTransport=e.transport,this._currentComputation=e.computation,this._currentExclusions=e.exclusions;for(var i=0;i<e.points.length;i++){const u=e.points[i];u&&this._currentPoints[i].setCoordinate(u,"EPSG:4326")}for(var s=0;s<this._currentPoints.length;s++){var o=this._currentPoints[s];if(o.getCoordinate()){var l=s+1+"-"+this._uid,c=o.getCoordinate()[1].toFixed(4)+" / "+o.getCoordinate()[0].toFixed(4);document.getElementById("GPlocationOriginCoords_"+l).value=c,document.getElementById("GPlocationOrigin_"+l).value=c,s>0&&s<6&&(document.getElementById("GPlocationPoint_"+l).className="GPflexInput GPelementHidden gpf-flex gpf-hidden ")}}this._currentRouteInformations=e.results}getContainer(){return this._container}getStyle(){return this._defaultFeatureStyle}init(){for(let te=0;te<this._currentPoints.length;te++){const ne=this._currentPoints[te];var e=te+1,i=ne.getCoordinate();if(i){var s=document.getElementById("GPlocationOrigin_"+e+"-"+this._uid);s.value=i[1].toFixed(4)+" / "+i[0].toFixed(4),te>0&&te<6&&(document.getElementById("GPlocationPoint_"+e+"-"+this._uid).className="GPflexInput GPlocationStageFlexInput gpf-flex")}}var o=document.getElementsByClassName("GPlocationPoint-"+this._uid);this._addRouteResultsStagesValuesElement(o);var l;this._currentTransport==="Pieton"?(l=document.getElementById("GProuteTransportPedestrian-"+this._uid),l&&(l.checked="true")):(l=document.getElementById("GProuteTransportCar-"+this._uid),l&&(l.checked="true"));var c=document.getElementById("GProuteComputationSelect-"+this._uid);c&&(c.value=this._currentComputation);var u=document.getElementById("GProuteExclusionsToll-"+this._uid);u&&(this._currentExclusions.indexOf("toll")!==-1?u.checked=!1:u.checked=!0);var f=document.getElementById("GProuteExclusionsTunnel-"+this._uid);f&&(this._currentExclusions.indexOf("tunnel")!==-1?f.checked=!1:f.checked=!0);var g=document.getElementById("GProuteExclusionsBridge-"+this._uid);g&&(this._currentExclusions.indexOf("bridge")!==-1?g.checked=!1:g.checked=!0);var H=this._currentRouteInformations.totalDistance,Y=this._currentRouteInformations.totalTime,ee=this._simplifiedInstructions(this._currentRouteInformations.routeInstructions);ee&&this._fillRouteResultsDetailsContainer(H,Y,ee),this._formRouteContainer.className="GPelementHidden gpf-hidden gpf-panel__content fr-modal__content",this._hideWaitingContainer(),this._resultsRouteContainer.className=""}clean(){this._currentTransport=null,this._currentExclusions=[],this._currentComputation=null;for(var e=0;e<this._currentPoints.length;e++)this._currentPoints[e].clear();this._removeRouteStepLocations(),this._clearRouteInputOptions(),this._clearRouteResultsDetails(),this.setLayer(),this._formRouteContainer.className="gpf-panel__content fr-modal__content",this._resultsRouteContainer.className="GPelementHidden gpf-hidden"}initialize(e){this._checkInputOptions(e),this.options={collapsed:!0,draggable:!1,export:!1,graphs:["Pieton","Voiture"],exclusions:{toll:!1,tunnel:!1,bridge:!1},routeOptions:{},autocompleteOptions:{},layerDescription:{title:"Itinraire",description:"Itinraire bas sur un graphe"}},Helper.assign(this.options,e);var i={departure:{url:Marker.red,offset:Marker.defaultOffset},stages:{url:Marker.lightOrange,offset:Marker.defaultOffset},arrival:{url:Marker.darkOrange,offset:Marker.defaultOffset}};this.options.markersOpts=Helper.assign(i,e.markersOpts),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this._uid=this.options.id||SelectorID.generate(),this._showRouteButton=null,this._panelRouteContainer=null,this._panelHeaderRouteContainer=null,this._waitingContainer=null,this._formRouteContainer=null,this._resultsRouteContainer=null,this._showRouteExclusionsElement=null,this._currentPoints=[],this._currentTransport=null,this._initTransport(),this._currentComputation=null,this._initComputation(),this._currentExclusions=[],this._initExclusions(),this._waiting=!1,this._timer=null,this._geojsonRoute=null,this._geojsonSections=null,this._geojsonObject=null,this.export=null,this._popupContent=null,this._popupDiv=this._initPopupDiv(),this._popupOverlay=null,this._resultsSelectInteraction=null,this._resultsHoverInteraction=null,this._defaultFeatureStyle=new Style$1({stroke:new Stroke({color:"rgba(0,183,152,0.9)",width:12})}),this._selectedFeatureStyle=new Style$1({stroke:new Stroke({color:"rgba(255,102,0,0.9)",width:12})}),this._currentRouteInformations=null,this._resources={},this.listenerKey=null}_checkInputOptions(e){if(e.graphs)if(Array.isArray(e.graphs)&&e.graphs.length)for(var i=0;i<e.graphs.length;i++)typeof e.graphs[i]=="string"?(e.graphs[i].toLowerCase()==="pieton"&&(e.graphs[i]="Pieton"),e.graphs[i].toLowerCase()==="voiture"&&(e.graphs[i]="Voiture")):(logger$o.log("[ol.control.Route] ERROR : parameter 'graphs' elements should be of type 'string'"),e.graphs[i]=null);else logger$o.warn("'graphs' parameter should be an array"),e.graphs=null;e.collapsed==="true"&&(e.collapsed=!0),e.collapsed==="false"&&(e.collapsed=!1)}_initContainer(e){var i=this._container;if(i.childElementCount>0)return i;var s=this._showRouteButton=this._createShowRoutePictoElement();i.appendChild(s);var o=this._panelRouteContainer=this._createRoutePanelElement(),l=this._createRoutePanelDivElement();o.appendChild(l);var c=this._panelHeaderRouteContainer=this._createRoutePanelHeaderElement();l.appendChild(c);var u=this._formRouteContainer=this._createRoutePanelFormElement();u.appendChild(this._createRoutePanelFormModeChoiceTransportElement(this.options.graphs));for(var f=this._createRoutePanelFormPointsElement(e),g=0;g<f.length;g++)u.appendChild(f[g]);u.appendChild(this._createRoutePanelFormModeChoiceComputeElement()),this._showRouteExclusionsElement=this._createShowRouteExclusionsPictoElement(),u.appendChild(this._showRouteExclusionsElement);var H=this._createRoutePanelFormExclusionsElement();H.appendChild(this._createRoutePanelFormExclusionOptionsElement(this.options.exclusions)),u.appendChild(H);var Y=this._createRoutePanelFooterElement();if(u.appendChild(Y),!checkDsfr()){var ee=this._createRouteFormResetElement();Y.appendChild(ee)}var te=this._createRouteSubmitFormElement();Y.appendChild(te),l.appendChild(u);var ne=this._resultsRouteContainer=this._createRoutePanelResultsElement();l.appendChild(ne);var Ye=this._createDrawingButtonsPluginDiv();l.appendChild(Ye);var xe=this._waitingContainer=this._createRouteWaitingElement();return l.appendChild(xe),i.appendChild(o),i.addEventListener&&i.addEventListener("click",tt=>this._hideRouteSuggestedLocations(tt)),i}_initTransport(){this._currentTransport="Pieton";var e=this.options.graphs;(!e||e.length===0)&&(this.options.graphs=["Pieton","Voiture"]),Array.isArray(e)&&e.length&&(e[0]==="Voiture"||e[0]==="Pieton")&&(this._currentTransport=e[0]);var i=this.options.routeOptions;i.graph&&(this._currentTransport=i.graph)}_initComputation(){this._currentComputation="fastest";var e=this.options.routeOptions;e.routePreference&&(this._currentComputation=e.routePreference)}_initExclusions(){this._currentExclusions=[];var e=this.options.exclusions;if((!e||typeof e=="object"&&Object.keys(e).length===0)&&(this.options.exclusions={toll:!1,tunnel:!1,bridge:!1}),e&&typeof e=="object"&&Object.keys(e).length)for(var i in e)e.hasOwnProperty(i)&&e[i]&&this._currentExclusions.push(i);var s=this.options.routeOptions;Array.isArray(s.exclusions)&&(this._currentExclusions=s.exclusions)}_initPopupDiv(){var e=this,i=document.createElement("div");i.className="gp-feature-info-div";var s=document.createElement("button");return s.className="gp-styling-button closer",s.onclick=function(){return e._popupOverlay!=null&&e._popupOverlay.setPosition(void 0),!1},this._popupContent=document.createElement("div"),this._popupContent.className="gp-features-content-div",i.appendChild(this._popupContent),i.appendChild(s),i}_createRoutePanelFormPointsElement(e){var i=[],s=1,o=new LocationSelector({apiKey:this.options.apiKey||null,tag:{id:s,label:"Dpart",groupId:this._uid,markerOpts:this.options.markersOpts.departure,display:!0},autocompleteOptions:this.options.autocompleteOptions||null});for(o.setMap(e),this._addFormPointsEventListeners(o),i.push(this._createRoutePanelFormPointLabel("Dpart")),i.push(o._container),this._currentPoints.push(o),s=2;s<7;s++){var l=new LocationSelector({apiKey:this.options.apiKey||null,tag:{id:s,label:"Etape "+(s-1),groupId:this._uid,markerOpts:this.options.markersOpts.stages,display:!1,removeOption:!0},autocompleteOptions:this.options.autocompleteOptions||null});l.setMap(e),this._addFormPointsEventListeners(l),i.push(this._createRoutePanelFormPointLabel("tape",!1)),i.push(l._container),this._currentPoints.push(l)}var c=new LocationSelector({apiKey:this.options.apiKey||null,tag:{id:s,label:"Arrive",groupId:this._uid,markerOpts:this.options.markersOpts.arrival,display:!0,addOption:!0},autocompleteOptions:this.options.autocompleteOptions||null});return c.setMap(e),this._addFormPointsEventListeners(c),i.push(this._createRoutePanelFormPointLabel("Arrive")),i.push(c._container),this._currentPoints.push(c),i}_addFormPointsEventListeners(e){e&&(e._buttonLabel.addEventListener?(e._buttonLabel.addEventListener("click",i=>this.onRouteOriginLabelClick(i)),e._inputShowPointer.addEventListener("click",i=>this.onRouteOriginPointerClick(i,e)),e._removePointElement&&e._removePointElement.addEventListener("click",i=>{logger$o.trace("click on _removePointElement",i)}),e._addPointElement&&e._addPointElement.addEventListener("click",i=>{logger$o.trace("click on _addPointElement",i)})):e._buttonLabel.attachEvent&&(e._buttonLabel.attachEvent("onclick",i=>this.onRouteOriginLabelClick(i)),e._inputShowPointer.attachEvent("onclick",i=>this.onRouteOriginPointerClick(i,e)),e._removePointElement&&e._removePointElement.attachEvent("onclick",i=>{}),e._addPointElement&&e._addPointElement.attachEvent("onclick",i=>{})))}onRouteComputationSubmit(e){logger$o.log("onRouteComputationSubmit",e);var i=this._currentPoints,s;if(i[0]&&i[0].getCoordinate){var o=i[0].getCoordinate();s={x:o[0].toFixed(5),y:o[1].toFixed(5)},logger$o.log("start",s)}var l,c=i[i.length-1];if(c&&c.getCoordinate){var u=c.getCoordinate();l={x:u[0].toFixed(5),y:u[1].toFixed(5)},logger$o.log("end",l)}for(var f=[],g=1;g<i.length-1;g++)if(i[g]&&i[g].getCoordinate){var H=i[g].getCoordinate();if(H){var Y={x:H[0].toFixed(5),y:H[1].toFixed(5)};logger$o.log("step",Y),f.push(Y)}}this._currentTransport=e.transport,this._currentComputation=e.computation,this._currentExclusions=e.exclusions;var ee=this.options.routeOptions,te;ee.resource?te=ee.resource:this._currentComputation==="fastest"&&this._currentTransport==="Pieton"&&(te="bdtopo-valhalla");var ne=ee.protocol||"XHR",Ye=ee.timeOut||0;ne==="JSONP"&&Ye===0&&(Ye=15e3);var xe=ee.onFailure!==null&&typeof ee.onFailure=="function",tt=ee.onSuccess!==null&&typeof ee.onSuccess=="function",et=this;this._requestRouting({startPoint:s,endPoint:l,viaPoints:f,graph:ee.graph||this._currentTransport,routePreference:ee.routePreference||this._currentComputation,exclusions:ee.exclusions||this._currentExclusions,geometryInInstructions:!0,distanceUnit:"m",timeOut:Ye,protocol:ne,resource:te,onSuccess:function(it){logger$o.log(it),it&&et._fillRouteResultsDetails(it),tt&&ee.onSuccess.call(et,it)},onFailure:function(it){et._hideWaitingContainer(),et._clearRouteResultsDetails(),logger$o.log(it.message),xe&&ee.onFailure.call(et,it)}})}onRouteOriginLabelClick(){this._formRouteContainer.className="gpf-panel__content gpf-mobile-form fr-modal__content",unByKey(this.listenerKey),this.dispatchEvent("route:drawend")}onRouteOriginPointerClick(e,i){var s=this.getMap();i._inputShowPointerContainer.checked?(this._formRouteContainer.className="GProuteFormMini gpf-panel__content fr-modal__content",e.target.parentElement.parentElement.classList.add("selected"),this.listenerKey=s.on("click",()=>{e.target.parentElement.parentElement.classList.remove("selected"),this._formRouteContainer.className==="GProuteFormMini gpf-panel__content fr-modal__content"&&(this._formRouteContainer.className="gpf-panel__content fr-modal__content"),unByKey(this.listenerKey),this.dispatchEvent("route:drawend")}),this.dispatchEvent("route:drawstart")):(this._formRouteContainer.className="",unByKey(this.listenerKey),this.dispatchEvent("route:drawend"))}onShowRoutePanelClick(e){var i=this._showRouteButton.ariaPressed;i==="true"&&this.onPanelOpen();var s=this.getMap();Interactions.unset(s),!this._geojsonSections&&!this._waiting&&this._clear(),this.collapsed=i!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position)}onRouteModeComputationChange(e){var i=e.target.value;i&&(logger$o.log(i),this._currentComputation=i)}onRouteModeComputationChangeAndRun(e){this.onRouteModeComputationChange(e),this._clearRouteResultsDetails(),this._clearRouteResultsGeometry(),this._clearRouteResultsFeatureGeometry(),this.onRouteComputationSubmit({computation:this._currentComputation,transport:this._currentTransport,exclusions:this._currentExclusions})}onRouteModeTransportChange(e){var i=e.target.value;i&&(this._currentTransport=i)}onShowRouteExclusionsClick(e){logger$o.log("onShowRouteExclusionsClick",e)}onRouteExclusionsChange(e){var i=e.target.value,s=e.target.checked;if(!(!i||typeof i!="string")){i=i.toLowerCase();for(var o=!1,l=null,c=0;c<this._currentExclusions.length;c++)this._currentExclusions[c]===i&&(l=c,o=!0);!o&&!s&&this._currentExclusions.push(i),o&&s&&this._currentExclusions.splice(l,1)}}onRouteResetClick(){for(var e=this._currentPoints,i=0;i<e.length;i++)e[i].clear();this._clear(),this._clearRouteInputOptions()}onShowRouteResultsNewClick(){this._clearRouteResultsDetails(),this._clearRouteResultsGeometry(),this._clearRouteResultsFeatureGeometry(),this.dispatchEvent("route:newresults")}onRouteResultsDetailsMouseOver(e){var i=e.target.id,s=i.substring(i.indexOf("_")+1);if(e.target.classList&&e.target.classList.add("GProuteResultsDetailsInstructionHighlight"),!!this._geojsonSections){var o=this._geojsonSections.getSource().getFeatureById(parseInt(s,10));o.setStyle(this._selectedFeatureStyle)}}onRouteResultsDetailsMouseOut(e){var i=e.target.id,s=i.substring(i.indexOf("_")+1);if(e.target.classList&&e.target.classList.remove("GProuteResultsDetailsInstructionHighlight"),!!this._geojsonSections){var o=this._geojsonSections.getSource().getFeatureById(parseInt(s,10));o.setStyle(null)}}_requestRouting(e){!e||typeof e=="object"&&Object.keys(e).length===0||e.startPoint&&e.endPoint&&(e.apiKey=this.options.routeOptions.apiKey||this.options.apiKey,typeof e.ssl!="boolean"&&(typeof this.options.ssl=="boolean"?e.ssl=this.options.ssl:e.ssl=!0),logger$o.log(e),this._displayWaitingContainer(),Gp.Services.route(e))}_fillRouteResultsDetails(e){var i=e.totalDistance,s=e.totalTime,o=this._simplifiedInstructions(e.routeInstructions);o&&this._fillRouteResultsDetailsContainer(i,s,o);var l=e.routeGeometry;l&&this._fillRouteResultsDetailsGeometry(l,this._defaultFeatureStyle),o&&o[0].geometry&&this._fillRouteResultsDetailsFeatureGeometry(o,this._defaultFeatureStyle);var c=e.bbox;if(c){var u=this.getMap(),f=[c.left,c.bottom,c.right,c.top],g=u.getView().getProjection().getCode();g!=="EPSG:4326"&&(f=transformExtent(f,"EPSG:4326",g)),u.getView().fit(f,u.getSize())}this._currentRouteInformations=e,this.dispatchEvent({type:"route:compute"}),this._formRouteContainer.className="GPelementHidden gpf-hidden gpf-panel__content fr-modal__content",this._hideWaitingContainer(),this._resultsRouteContainer.className=""}_fillRouteResultsDetailsContainer(e,i,s){this._resultsRouteValuesContainer=this._addRouteResultsValuesElement(e,i,MathUtils.convertSecondsToTime),this._resultsRouteDetailsContainer=this._addRouteResultsDetailsElement(s,MathUtils.convertSecondsToTime)}_fillRouteResultsDetailsGeometry(e,i){this._clearRouteResultsGeometry();var s=this.getMap();if(e){var o={type:"FeatureCollection",features:[{type:"Feature",crs:{type:"name",properties:{name:"EPSG:4326"}},geometry:e}]},l=new GeoJSON({defaultDataProjection:"EPSG:4326",defaultStyle:i}),c=l.readFeatures(o,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});this._geojsonRoute=new VectorLayer({source:new VectorSource({features:c}),style:i,title:"Mon Itinraire"}),s.addLayer(this._geojsonRoute)}}_fillRouteResultsDetailsFeatureGeometry(e,i){this._clearRouteResultsFeatureGeometry();var s=this.getMap();this._geojsonObject={type:"FeatureCollection",crs:{type:"name",properties:{name:"EPSG:4326"}},features:[]};for(var o=0;o<e.length;o++){for(var l=e[o],c=o+1,u=l.geometry.coordinates,f=0;f<u.length;f++)typeof u[f][0]=="string"&&(u[f][0]=parseFloat(u[f][0]),u[f][1]=parseFloat(u[f][1]));this._geojsonObject.features.push({type:"Feature",geometry:l.geometry,properties:{popupContent:"("+c+") distance : "+MathUtils.convertDistance(l.distance)+" / temps : "+MathUtils.convertSecondsToTime(l.duration)},id:c})}this._geojsonObject.features.push({type:"Feature",geometry:{type:"Point",coordinates:this._currentPoints[0].getCoordinate()},properties:{description:"Point de dpart","marker-symbol":this.options.markersOpts.departure.url}});for(var g=1;g<this._currentPoints.length-1;g++)if(this._currentPoints[g]&&this._currentPoints[g].getCoordinate){var H=this._currentPoints[g].getCoordinate();H&&this._geojsonObject.features.push({type:"Feature",geometry:{type:"Point",coordinates:H},properties:{description:"Point d'tape","marker-symbol":this.options.markersOpts.stages.url}})}this._geojsonObject.features.push({type:"Feature",geometry:{type:"Point",coordinates:this._currentPoints[this._currentPoints.length-1].getCoordinate()},properties:{description:"Point d'arrive","marker-symbol":this.options.markersOpts.arrival.url}});var Y=new GeoJSON({defaultDataProjection:"EPSG:4326",defaultStyle:i}),ee=this.getMap().getView().getProjection().getCode(),te=Y.readFeatures(this._geojsonObject,{dataProjection:"EPSG:4326",featureProjection:ee});this._geojsonSections=new VectorLayer({source:new VectorSource({features:te}),style:i,opacity:.9,title:"Mon Itinraire"});var ne;this._currentTransport==="Pieton"?(ne="piton",this._geojsonSections.gpResultLayerId="compute:Pieton$OGC:OPENLS;Itineraire"):(ne="voiture",this._geojsonSections.gpResultLayerId="compute:Voiture$OGC:OPENLS;Itineraire"),s.addLayer(this._geojsonSections),s.getControls().forEach(Ye=>{if(Ye instanceof LayerSwitcher){var xe=this._geojsonSections.gpLayerId;Ye._layers[xe].title===xe&&Ye.addLayer(this._geojsonSections,{title:this.options.layerDescription.title+" ("+ne+")",description:this.options.layerDescription.description})}},this),this._resultsHoverInteraction=new Select({condition:pointerMove,layers:[this._geojsonSections],style:this._selectedFeatureStyle}),this._resultsHoverInteraction.on("select",Ye=>this._onResultsFeatureMouseOver(Ye)),s.addInteraction(this._resultsHoverInteraction),this._resultsSelectInteraction=new Select({layers:[this._geojsonSections],style:this._selectedFeatureStyle}),this._resultsSelectInteraction.on("select",Ye=>this._onResultsFeatureSelect(Ye)),s.addInteraction(this._resultsSelectInteraction)}_onResultsFeatureMouseOver(e){if(e.selected.length!==0){var i=e.selected[0],s=document.getElementById("GProuteResultsDetailsInstruction_"+i.getId()+"-"+this._uid);s&&s.classList&&s.classList.add("GProuteResultsDetailsInstructionHighlight")}if(e.deselected.length!==0){var o=e.deselected[0],l=document.getElementById("GProuteResultsDetailsInstruction_"+o.getId()+"-"+this._uid);l&&l.classList&&l.classList.remove("GProuteResultsDetailsInstructionHighlight")}}_onResultsFeatureSelect(e){var i=this.getMap();if(e.selected.length!==0){var s=e.selected[0];this._popupContent.innerHTML=s.getProperties().popupContent,this._popupOverlay?this._popupOverlay.setPosition(e.mapBrowserEvent.coordinate):(this._popupOverlay=new Overlay({element:this._popupDiv,positioning:"bottom-center",position:e.mapBrowserEvent.coordinate}),i.addOverlay(this._popupOverlay))}else this._popupOverlay!=null&&this._popupOverlay.setPosition(void 0)}_clear(){this._currentTransport=null,this._currentExclusions=[],this._currentComputation=null,this._clearRouteResultsDetails(),this._clearRouteResultsGeometry(),this._clearRouteResultsFeatureGeometry();for(var e=0;e<this._currentPoints.length;e++)this._currentPoints[e].clear();this._removeRouteStepLocations()}_clearRouteInputOptions(){this._initTransport(),this._initComputation(),this._initExclusions();var e;this._currentTransport==="Pieton"?(e=document.getElementById("GProuteTransportPedestrian-"+this._uid),e&&(e.checked="true")):(e=document.getElementById("GProuteTransportCar-"+this._uid),e&&(e.checked="true"));var i=document.getElementById("GProuteComputationSelect-"+this._uid);i&&(i.value=this._currentComputation);var s=document.getElementById("GProuteExclusionsToll-"+this._uid);s&&(this._currentExclusions.indexOf("toll")!==-1?s.checked=!1:s.checked=!0);var o=document.getElementById("GProuteExclusionsTunnel-"+this._uid);o&&(this._currentExclusions.indexOf("tunnel")!==-1?o.checked=!1:o.checked=!0);var l=document.getElementById("GProuteExclusionsBridge-"+this._uid);l&&(this._currentExclusions.indexOf("bridge")!==-1?l.checked=!1:l.checked=!0)}_removeRouteStepLocations(){var e=document.querySelectorAll('div[id^="GPlocationPoint"]');if(e.length!==0){for(var i=[],s=0;s<e.length;s++)e[s].id.indexOf(this._uid)!==-1&&i.push(e[s]);for(var o=1;o<i.length-1;o++){var l=i[o].classList;if(l.length!==0)for(var c=0;c<l.length;c++)l[c]==="GPlocationStageFlexInput"&&document.getElementById(this._addUID("GPlocationStageRemove_"+(o+1))).click()}}}_clearRouteResultsDetails(){if(this._currentRouteInformations=null,this._resultsRouteDetailsContainer){var e=this._resultsRouteDetailsContainer;if(e.childElementCount)for(;e.firstChild;)e.removeChild(e.firstChild)}if(this._resultsRouteValuesContainer){var i=this._resultsRouteValuesContainer;if(i.childElementCount)for(;i.firstChild;)i.removeChild(i.firstChild)}}_clearRouteResultsGeometry(){var e=this.getMap();this._geojsonRoute!=null&&(e.removeLayer(this._geojsonRoute),this._geojsonRoute=null)}_clearRouteResultsFeatureGeometry(){var e=this.getMap();this._geojsonSections!=null&&(e.removeLayer(this._geojsonSections),this._geojsonSections=null,this._geojsonObject=null),this._popupOverlay!=null&&(e.removeOverlay(this._popupOverlay),this._popupOverlay=null),this._resultsSelectInteraction!=null&&(e.removeInteraction(this._resultsSelectInteraction),this._resultsSelectInteraction=null),this._resultsHoverInteraction!=null&&(e.removeInteraction(this._resultsHoverInteraction),this._resultsHoverInteraction=null)}_hideRouteSuggestedLocations(e){if(e.target&&e.target.id&&e.target.id.indexOf("GPlocationOrigin_")!==-1)for(var i=parseInt(e.target.id.split("_")[1][0],10)-1,s=0;s<this._currentPoints.length;s++)s!==parseInt(i,10)&&this._currentPoints[s]._hideSuggestedLocation();else for(var o=0;o<this._currentPoints.length;o++)this._currentPoints[o]._hideSuggestedLocation()}_displayWaitingContainer(){this._waitingContainer.className="GPwaitingContainer GPwaitingContainerVisible gpf-waiting gpf-waiting--visible",this._waiting=!0;var e=this.options.routeOptions;if(e&&e.timeOut){this._timer&&(clearTimeout(this._timer),this._timer=null);var i=this;this._timer=setTimeout(function(){i._waiting===!0?i._hideWaitingContainer():i._timer&&clearTimeout(i._timer)},16e3)}}_hideWaitingContainer(){if(this._waiting){this._waitingContainer.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden",this._waiting=!1;var e=this.options.routeOptions;e&&e.timeOut&&(clearTimeout(this._timer),this._timer=null)}}_simplifiedInstructions(e){var i=[],s=e[0];e.length===1&&i.push(s);for(var o=1;o<e.length;o++){var l=e[o];if(l.instruction===s.instruction){s.distance=(parseFloat(l.distance)+parseFloat(s.distance)).toString(),s.duration=(parseFloat(l.duration)+parseFloat(s.duration)).toString();for(var c=1;c<l.geometry.coordinates.length;c++)s.geometry.coordinates.push(l.geometry.coordinates[c])}else i.push(s),s=l,o===e.length-1&&(i.push(l),s=null)}return logger$o.log(i),i}}Object.assign(Route.prototype,RouteDOM);Object.assign(Route.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.Route=Route);var IsoDOM={_addUID:function(n){var e=this._uid?n+"-"+this._uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPisochron"),n.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",n},_createShowIsoPictoElement:function(){var n=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowIsochronPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowIsochronPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-isocurve fr-btn fr-btn--tertiary",e.setAttribute("aria-label","Calculer une isochrone"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowIsoPanelClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowIsoPanelClick(s)}),e},_createIsoPanelElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPisochronPanel"),n.className="GPpanel gpf-panel fr-modal",n},_createIsoPanelDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__body fr-modal__body",n},_createDrawingButtonsPluginDiv:function(){var n=document.createElement("div");return n.className="container-buttons-plugin fr-mx-2w",n},_createIsoPanelHeaderElement:function(){var n=this,e=document.createElement("div");e.className="GPpanelHeader gpf-panel__header fr-modal__header";var i=document.createElement("div");i.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",i.innerHTML="Calcul d'isochrone",e.appendChild(i);var s=document.createElement("button");s.id=this._addUID("GPisochronPanelClose"),s.className="GPpanelClose GPisochronPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",s.title="Fermer le panneau",s.addEventListener?s.addEventListener("click",function(){document.getElementById(n._addUID("GPshowIsochronPicto")).click()},!1):s.attachEvent&&s.attachEvent("onclick",function(){document.getElementById(n._addUID("GPshowIsochronPicto")).click()});var o=document.createElement("span");return o.className="GPelementHidden gpf-visible",o.innerText="Fermer",s.appendChild(o),e.appendChild(s),e},_createIsoPanelFormElement:function(){var n=this,e=document.createElement("form");return e.id=this._addUID("GPisochronForm"),e.className="GPform gpf-panel__content gpf-mobile-form fr-modal__content",e.addEventListener("submit",function(i){return i.preventDefault(),n.onIsoComputationSubmit(i),!1}),e},_createIsoPanelResultsElement:function(){var n=this,e=document.createElement("div");e.id=this._addUID("GPisoResultsPanel"),e.className="GPelementHidden gpf-hidden";var i=document.createElement("div");return i.id=this._addUID("GPisoResultsNew"),i.className="GPresetPicto gpf-btn gpf-btn-icon-reset fr-btn fr-btn--secondary gpf-btn--secondary fr-m-2w",i.title="Modifier le calcul",i.addEventListener("click",function(s){document.getElementById(n._addUID("GPisoResultsPanel")).className="GPelementHidden gpf-hidden",document.getElementById(n._addUID("GPisochronForm")).className="gpf-panel__content fr-modal__content",n.onShowIsoResultsNewClick(s)}),e.appendChild(i),e},_addIsoResultsValuesElement:function(n,e,i){var s=n.distance,o=n.time,l=n.location,c=e.graph,u=e.method,f=e.exclusions,g=document.getElementById(this._addUID("GPisoResultsPanel"));g.childElementCount&&g.firstChild.id===this._addUID("GPisoResultsValueDiv")&&g.removeChild(g.firstChild);var H=document.createElement("div");H.id=this._addUID("GPisoResultsValueDiv"),H.className="fr-m-2w";var Y=document.createElement("div");Y.className="GPisoResultsValue";var ee=document.createElement("label");ee.className="GPisoResultsValueLabel",ee.innerHTML="Type :",Y.appendChild(ee);var te=document.createElement("div");te.id=this._addUID("GPisoResultsValueType"),u==="time"?te.innerHTML="temps":te.innerHTML="distance",Y.appendChild(te),H.appendChild(Y);var ne=document.createElement("div");ne.className="GPisoResultsValue";var Ye=document.createElement("label");Ye.className="GPisoResultsValueLabel",Ye.innerHTML="Mode :",ne.appendChild(Ye);var xe=document.createElement("div");xe.id=this._addUID("GPisoResultsValueMode"),xe.innerHTML=c,ne.appendChild(xe),H.appendChild(ne);var tt=document.createElement("div");tt.className="GPisoResultsValue";var et=document.createElement("label");et.className="GPisoResultsValueLabel",et.innerHTML="Centre :",tt.appendChild(et);var it=document.createElement("div");if(it.id=this._addUID("GPisoResultsValueOrigin"),it.innerHTML=parseFloat(l.y).toFixed(4)+", "+parseFloat(l.x).toFixed(4),tt.appendChild(it),H.appendChild(tt),s&&s.length!==0){var rt=document.createElement("div");rt.className="GPisoResultsValue";var nt=document.createElement("label");nt.className="GPisoResultsValueLabel",nt.innerHTML="Distance :",rt.appendChild(nt);var at=0,st=parseInt(s/1e3,10);if(!st)at=Math.round(s)+" m";else{var ot=Math.round(s);ot=ot/1e3,at=ot+" km"}var ut=document.createElement("div");ut.id=this._addUID("GPisoResultsValueDist"),ut.innerHTML=at,rt.appendChild(ut),H.appendChild(rt)}if(o&&o.length!==0){var ht=document.createElement("div");ht.className="GPisoResultsValue";var dt=document.createElement("label");dt.className="GPisoResultsValueLabel",dt.innerHTML="Dure :",ht.appendChild(dt);var pt=document.createElement("div");pt.id=this._addUID("GPisoResultsValueTime"),pt.innerHTML=i(o),ht.appendChild(pt),H.appendChild(ht)}if(f.length>0){var yt=document.createElement("div");yt.className="GPisoResultsValue";var mt=document.createElement("label");mt.className="GPisoResultsValueLabel",mt.innerHTML="Exclusions :",yt.appendChild(mt);var St=document.createElement("div");St.id=this._addUID("GPisoResultsValueExclusions"),St.innerHTML=f.join(", "),yt.appendChild(St),H.appendChild(yt)}return g.prepend(H),g},_createIsoWaitingElement:function(){var n=document.createElement("div");n.id=this._addUID("GPisochronCalcWaitingContainer"),n.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden";var e=document.createElement("p");return e.className="GPwaitingContainerInfo gpf-waiting_info",e.innerHTML="Recherche en cours...",n.appendChild(e),n},_createIsoPanelFooterElement:function(){var n=document.createElement("div");return n.className="GPpanelFooter gpf-panel__footer fr-modal__footer",n},_createIsoPanelFormPointLabel:function(){var n=document.createElement("p");return n.id=this._addUID("GPisochronPointLabelP"),n.className="gpf-label fr-label",n.innerHTML="Dpart",n},_createIsoPanelFormTypeChoiceElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPisochronChoice"),n.className="fr-mt-2w",n},_createIsoPanelFormTypeChoiceChronElement:function(n){var e=this,i=document.createElement("div");i.className="GPisochronChoiceAlt gpf-flex gpf-flex-isocurve gpf-radio-group fr-radio-group";var s=document.createElement("input");s.id=this._addUID("GPisochronChoiceAltChron"),s.name="GPisochronChoiceMode",s.type="radio",s.checked=!!n,s.addEventListener?s.addEventListener("change",function(c){document.getElementById(e._addUID("GPisochronValueChron")).className="GPflexInput gpf-flex fr-mt-1w",document.getElementById(e._addUID("GPisochronValueDist")).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPisochronValueChronLabelP")).className="gpf-label fr-label",document.getElementById(e._addUID("GPisochronValueDistLabelP")).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPisochronSubmit")).value="Calculer l'isochrone",e.onIsoTypeChoiceChange(c)},!1):s.attachEvent&&s.attachEvent("onchange",function(){document.getElementById(e._addUID("GPisochronValueChron")).className="GPflexInput gpf-flex fr-mt-1w",document.getElementById(e._addUID("GPisochronValueDist")).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPisochronValueChronLabelP")).className="gpf-label fr-label",document.getElementById(e._addUID("GPisochronValueDistLabelP")).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPisochronSubmit")).value="Calculer l'isochrone",e.onIsoTypeChoiceChange()}),s.value="isochron",i.appendChild(s);var o=document.createElement("label");o.className="GPisochronChoiceAltImg gpf-label fr-label",o.htmlFor=this._addUID("GPisochronChoiceAltChron"),o.innerHTML="Dure",o.title="Dure",i.appendChild(o);var l=document.createElement("span");return l.id=this._addUID("GPisochronChoiceAltChronTxt"),l.className="gpf-hidden",l.innerHTML="Dure",l.addEventListener?l.addEventListener("click",function(){document.getElementById(e._addUID("GPisochronChoiceAltChron")).click()},!1):l.attachEvent&&l.attachEvent("onclick",function(){document.getElementById(e._addUID("GPisochronChoiceAltChron")).click()}),i.appendChild(l),i},_createIsoPanelFormTypeChoiceDistElement:function(n){var e=this,i=document.createElement("div");i.className="GPisochronChoiceAlt gpf-flex gpf-flex-isocurve gpf-radio-group fr-radio-group";var s=document.createElement("input");s.id=this._addUID("GPisochronChoiceAltDist"),s.name="GPisochronChoiceMode",s.type="radio",s.checked=!!n,s.addEventListener?s.addEventListener("change",function(c){document.getElementById(e._addUID("GPisochronValueDist")).className="GPflexInput gpf-flex fr-mt-1w",document.getElementById(e._addUID("GPisochronValueChron")).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPisochronValueDistLabelP")).className="gpf-label fr-label",document.getElementById(e._addUID("GPisochronValueChronLabelP")).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPisochronSubmit")).value="Calculer l'isodistance",e.onIsoTypeChoiceChange(c)},!1):s.attachEvent&&s.attachEvent("onchange",function(){document.getElementById(e._addUID("GPisochronValueDist")).className="GPflexInput gpf-flex fr-mt-1w",document.getElementById(e._addUID("GPisochronValueChron")).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPisochronValueDistLabelP")).className="gpf-label fr-label",document.getElementById(e._addUID("GPisochronValueChronLabelP")).className="GPelementHidden gpf-hidden",document.getElementById(e._addUID("GPisochronSubmit")).value="Calculer l'isodistance",e.onIsoTypeChoiceChange()}),s.value="isodistance",i.appendChild(s);var o=document.createElement("label");o.className="GPisochronChoiceAltImg gpf-label fr-label",o.htmlFor=this._addUID("GPisochronChoiceAltDist"),o.innerHTML="Distance",o.title="Distance",i.appendChild(o);var l=document.createElement("span");return l.id=this._addUID("GPisochronChoiceAltDistTxt"),l.className="gpf-hidden",l.innerHTML="Distance",l.addEventListener?l.addEventListener("click",function(){document.getElementById(e._addUID("GPisochronChoiceAltDist")).click()},!1):l.attachEvent&&l.attachEvent("onclick",function(){document.getElementById(e._addUID("GPisochronChoiceAltDist")).click()}),i.appendChild(l),i},_createIsoPanelFormLabelIsochronElement:function(n){var e=document.createElement("p");return e.id=this._addUID("GPisochronValueChronLabelP"),e.className=n?"gpf-label fr-label":"GPelementHidden gpf-hidden",e.innerHTML="Dfinir un temps de trajet",e},_createIsoPanelFormValueIsochronElement:function(n){var e=this,i=document.createElement("div");i.id=this._addUID("GPisochronValueChron"),i.className=n?"GPflexInput gpf-flex fr-mt-1w":"GPelementHidden gpf-hidden";var s=document.createElement("input");s.id=this._addUID("GPisochronValueChronInput1"),s.className="gpf-input fr-input",s.min="0",s.step="1",s.value="0",s.type="number",s.title="Temps",s.addEventListener?s.addEventListener("change",function(u){typeof e.onIsoValueChronTimeMinuteChange=="function"&&e.onIsoValueChronTimeHourChange(u)}):s.attachEvent&&s.attachEvent("onchange",function(u){typeof e.onIsoValueChronTimeMinuteChange=="function"&&e.onIsoValueChronTimeHourChange(u)}),i.appendChild(s);var o=document.createElement("label");o.innerHTML="h",o.className="gpf-label fr-label",i.appendChild(o);var l=document.createElement("input");l.id=this._addUID("GPisochronValueChronInput2"),l.className="gpf-input fr-input",l.min="0",l.max="59",l.step="1",l.value="0",l.type="number",l.title="Heures",l.addEventListener?l.addEventListener("change",function(u){typeof e.onIsoValueChronTimeMinuteChange=="function"&&e.onIsoValueChronTimeMinuteChange(u)}):l.attachEvent&&l.attachEvent("onchange",function(u){typeof e.onIsoValueChronTimeMinuteChange=="function"&&e.onIsoValueChronTimeMinuteChange(u)}),i.appendChild(l);var c=document.createElement("label");return c.innerHTML="min",c.className="gpf-label fr-label",i.appendChild(c),i},_createIsoPanelFormLabelIsodistanceElement:function(n){var e=document.createElement("p");return e.id=this._addUID("GPisochronValueDistLabelP"),e.className=n?"gpf-label fr-label":"GPelementHidden gpf-hidden",e.innerHTML="Dfinir une distance",e},_createIsoPanelFormValueIsodistanceElement:function(n){var e=this,i=document.createElement("div");i.id=this._addUID("GPisochronValueDist"),i.className=n?"GPflexInput gpf-flex fr-mt-1w":"GPelementHidden gpf-hidden";var s=document.createElement("input");s.id=this._addUID("GPisochronValueDistInput"),s.className="gpf-input fr-input fr-ml-1w",s.min="0",s.step="any",s.value="0",s.type="number",s.title="Distance",s.addEventListener?s.addEventListener("change",function(l){typeof e.onIsoValueDistChange=="function"&&e.onIsoValueDistChange(l)}):s.attachEvent&&s.attachEvent("onchange",function(l){typeof e.onIsoValueDistChange=="function"&&e.onIsoValueDistChange(l)}),i.appendChild(s);var o=document.createElement("label");return o.innerHTML="km",o.className="gpf-label fr-label",i.appendChild(o),i},_createIsoPanelFormModeChoiceTransportElement:function(n){var e=this,i=document.createElement("div");i.id=this._addUID("GPisochronTransportChoice");var s=document.createElement("label");s.className="GPisochronModeLabel gpf-label fr-label",s.innerHTML="Choisir un mode de dplacement",i.appendChild(s);for(var o=document.createElement("div"),l=0;l<n.length;l++){var c=n[l],u=document.createElement("div");if(u.className="GPisochronTransportChoice gpf-flex gpf-radio-group fr-radio-group",c==="Voiture"){var f=document.createElement("input");f.id=this._addUID("GPisochronTransportCar"),f.type="radio",f.name="GPisochronTransport",l===0&&(f.checked=!0),f.addEventListener?f.addEventListener("change",function(ee){e.onIsoModeTransportChange(ee)}):f.attachEvent&&f.attachEvent("onchange",function(ee){e.onIsoModeTransportChange(ee)}),f.value="Voiture",u.appendChild(f);var g=document.createElement("label");g.className="GPisochronTransportImg gpf-label fr-label",g.htmlFor=this._addUID("GPisochronTransportCar"),g.title="Voiture",g.innerHTML="Voiture",u.appendChild(g)}if(c==="Pieton"){var H=document.createElement("input");H.id=this._addUID("GPisochronTransportPedestrian"),H.type="radio",H.name="GPisochronTransport",l===0&&(H.checked=!0),H.addEventListener?H.addEventListener("change",function(ee){e.onIsoModeTransportChange(ee)}):H.attachEvent&&H.attachEvent("onchange",function(ee){e.onIsoModeTransportChange(ee)}),H.value="Pieton",u.appendChild(H);var Y=document.createElement("label");Y.className="GPisochronTransportImg gpf-label fr-label",Y.htmlFor=this._addUID("GPisochronTransportPedestrian"),Y.title="Piton",Y.innerHTML="Piton",u.appendChild(Y)}o.appendChild(u)}return i.appendChild(o),i},_createIsoPanelFormModeChoiceDirectionElement:function(n){var e=this,i=document.createElement("div");i.id=this._addUID("GPisochronDirectionChoice"),i.className="fr-my-2w";var s=document.createElement("label");s.innerHTML="Dfinir un sens de parcours",s.className="fr-label",i.appendChild(s);var o=document.createElement("select");o.id=this._addUID("GPisochronDirectionSelect"),o.className="GPselect gpf-select fr-select",o.title="Sens de parcours",o.addEventListener("change",function(g){e.onIsoModeDirectionChange(g)});for(var l=0;l<n.length;l++){var c=n[l];if(c.toLowerCase()==="departure"){var u=document.createElement("option");l===0&&(u.selected="selected"),u.value="departure",u.text="Dpart",o.appendChild(u)}if(c.toLowerCase()==="arrival"){var f=document.createElement("option");l===0&&(f.selected="selected"),f.value="arrival",f.text="Arrive",o.appendChild(f)}}return i.appendChild(o),i},_createShowIsoExclusionsPictoElement:function(){var n=this,e=document.createElement("button");e.id=this._addUID("GPshowIsoExclusionsPicto");var i="";return checkDsfr()&&(i="GPelementHidden gpf-hidden"),e.className=`GPshowAdvancedToolPicto GPshowMoreOptionsImage GPshowMoreOptions GPshowIsoExclusionsPicto ${i} gpf-btn fr-btn--sm fr-btn--tertiary gpf-btn--tertiary fr-icon-arrow-down-fill`,e.title="Exclusions",e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!0),e.addEventListener?e.addEventListener("click",function(s){s.preventDefault();var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowIsoSettingsClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){s.preventDefault();var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowIsoSettingsClick(s)}),e},_createIsoPanelFormExclusionsElement:function(){var n=document.createElement("div");n.id=this._addUID("GPisoExclusions");var e=document.createElement("label");return e.className="GPisoExclusionsLabel gpf-label fr-label",e.innerHTML="Passages autoriss",n.appendChild(e),n},_createIsoPanelFormExclusionOptionsElement:function(n){var e=this,i=document.createElement("div");i.className="GPisoExclusionsOptions gpf-flex fr-checkbox-group fr-m-1w";for(var s in n)if(n.hasOwnProperty(s)){var o=n[s];switch(s){case"toll":var l=document.createElement("input");l.id=this._addUID("GPisoExclusionsToll"),l.type="checkbox",l.name="Pages",l.checked=!o,l.addEventListener?l.addEventListener("change",function(Y){e.onIsoExclusionsChange(Y)}):l.attachEvent&&l.attachEvent("onchange",function(Y){e.onIsoExclusionsChange(Y)}),l.value="Toll",i.appendChild(l);var c=document.createElement("label");c.className="GPisoExclusionsOption",c.htmlFor=this._addUID("GPisoExclusionsToll"),c.innerHTML="Pages",i.appendChild(c);break;case"tunnel":var u=document.createElement("input");u.id=this._addUID("GPisoExclusionsTunnel"),u.type="checkbox",u.name="Tunnel",u.checked=!o,u.addEventListener?u.addEventListener("change",function(Y){e.onIsoExclusionsChange(Y)}):u.attachEvent&&u.attachEvent("onchange",function(Y){e.onIsoExclusionsChange(Y)}),u.value="Tunnel",i.appendChild(u);var f=document.createElement("label");f.className="GPisoExclusionsOption",f.htmlFor=this._addUID("GPisoExclusionsTunnel"),f.innerHTML="Tunnels",i.appendChild(f);break;case"bridge":var g=document.createElement("input");g.id=this._addUID("GPisoExclusionsBridge"),g.type="checkbox",g.name="Ponts",g.checked=!o,g.addEventListener?g.addEventListener("change",function(Y){e.onIsoExclusionsChange(Y)}):g.attachEvent&&g.attachEvent("onchange",function(Y){e.onIsoExclusionsChange(Y)}),g.value="Bridge",i.appendChild(g);var H=document.createElement("label");H.className="GPisoExclusionsOption",H.htmlFor=this._addUID("GPisoExclusionsBridge"),H.innerHTML="Ponts",i.appendChild(H);break}}return i},_createIsoSubmitFormElement:function(){var n=document.createElement("input");return n.id=this._addUID("GPisochronSubmit"),n.className="GPsubmit gpf-btn fr-btn",n.type="submit",n.value="Calculer l'isochrone",n},_createIsoFormResetElement:function(){var n=this,e=document.createElement("button");return e.id=this._addUID("GPisochronReset"),e.className="GPresetPicto GPisochronReset gpf-btn gpf-btn-icon-reset gpf-btn-icon-isocurve-reset fr-btn fr-btn--secondary gpf-btn--secondary",e.title="Rinitialiser les paramtres",e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.addEventListener("click",function(i){var s=i.target.ariaPressed==="true";i.target.setAttribute("aria-pressed",!s),n.onIsoResetClick(i)}),e}},logger$n=LoggerByDefault.getLogger("isocurve");class Isocurve extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof Isocurve))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="Isocurve",this.initialize(e),this._container=this._createMainContainerElement(),this.element?this.element.appendChild(this._container):this.element=this._container,this}setMap(e){if(e){if(this._container=this._initContainer(e),this.options.export){var i=Helper.assign({control:this},this.options.export);this.export=new ButtonExport(i),this.export.render();var s=this;this.export.on("button:clicked",o=>{s.dispatchEvent({type:"export:compute",content:o.content})})}this.draggable&&Draggable.dragElement(this._IsoPanelContainer,this._IsoPanelHeaderContainer,e.getTargetElement()),this.collapsed||this._pictoIsoButton.setAttribute("aria-pressed",!0)}super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getCollapsed(){return this.collapsed}setCollapsed(e){if(e===void 0){logger$n.log("[ERROR] Isocurve:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(e?document.getElementById("GPisochronPanelClose-"+this._uid).click():this._pictoIsoButton.click(),this.collapsed=e)}getLayer(){return this._geojsonLayer}setLayer(e){if(!e){this._geojsonLayer=null;return}if(!(e instanceof VectorLayer)){logger$n.log("no valid layer given for hosting drawn features.");return}e.setStyle(this._defaultFeatureStyle),this._geojsonLayer=e}getGeoJSON(){return JSON.stringify(this._geojsonObject)}setGeoJSON(e){try{this._geojsonObject=JSON.parse(e)}catch(i){logger$n.log("no valid geojson given :"+i.message)}}getData(){var e={type:"isocurve",transport:this._currentTransport,computation:this._currentComputation,exclusions:this._currentExclusions,direction:this._currentDirection,point:this._originPoint.getCoordinate(),results:{}};return Helper.assign(e.results,this._currentIsoResults),e}setData(e){this._currentTransport=e.transport,this._currentComputation=e.computation,this._currentExclusions=e.exclusions,this._currentDirection=e.direction;var i=document.getElementById("GPlocationOriginPointer_1-"+this._uid);i.checked=!0;var s=document.getElementById("GPlocationOrigin_1-"+this._uid),o=document.getElementById("GPlocationOriginCoords_1-"+this._uid);o.value=e.point,s.value=e.point[1].toFixed(4)+" / "+e.point[0].toFixed(4),this._originPoint.setCoordinate(e.point,"EPSG:4326"),this._currentIsoResults=e.results}getContainer(){return this._container}getStyle(){return this._defaultFeatureStyle}compute(e,i,s){this._clear();var o=this._pictoIsoButton.ariaPressed;o!=="true"&&this._pictoIsoButton.click();var l=this.getMap();if(l){var c={direction:"departure",method:"time",transport:"Voiture",exclusions:[]};Helper.assign(c,s),this._originPoint.setCoordinate(e);var u=this._originPoint.getCoordinate(),f=document.getElementById("GPlocationOrigin_1-"+this._uid);if(f.value=u[0].toFixed(4)+" / "+u[1].toFixed(4),this._currentTransport=c.transport,c.transport==="Voiture"?document.getElementById("GPisochronTransportCar-"+this._uid).checked=!0:document.getElementById("GPisochronTransportPedestrian-"+this._uid).checked=!0,this._currentExclusions=c.exclusions,this._currentComputation=c.method,c.method==="time"){var g=i.split(".");this._currentTimeHour=g[0]||0,document.getElementById("GPisochronValueChronInput1-"+this._uid).value=this._currentTimeHour,this._currentTimeMinute=g[1]||0,document.getElementById("GPisochronValueChronInput2-"+this._uid).value=this._currentTimeMinute,document.getElementById("GPisochronChoiceAltChron-"+this._uid).click()}else this._currentDistance=i,document.getElementById("GPisochronValueDistInput-"+this._uid).value=this._currentDistance,document.getElementById("GPisochronChoiceAltDist-"+this._uid).click();this._currentDirection=c.direction,c.direction==="departure"?document.getElementById("GPisochronDirectionSelect-"+this._uid).selectedIndex=0:document.getElementById("GPisochronDirectionSelect-"+this._uid).selectedIndex=1,this.onIsoComputationSubmit()}}init(){var e=this._originPoint.getCoordinate(),i=document.getElementById("GPlocationOrigin_1-"+this._uid);if(i.value=e[1].toFixed(4)+" / "+e[0].toFixed(4),this._currentTransport==="Voiture"?document.getElementById("GPisochronTransportCar-"+this._uid).checked=!0:document.getElementById("GPisochronTransportPedestrian-"+this._uid).checked=!0,this._currentComputation==="time"){var s=this._currentIsoResults.time/60;this._currentTimeHour=Math.floor(s/60),document.getElementById("GPisochronValueChronInput1-"+this._uid).value=this._currentTimeHour,this._currentTimeMinute=Math.round((s/60-this._currentTimeHour)*60),document.getElementById("GPisochronValueChronInput2-"+this._uid).value=this._currentTimeMinute,document.getElementById("GPisochronChoiceAltChron-"+this._uid).click()}else this._currentDistance=this._currentIsoResults.distance/1e3,document.getElementById("GPisochronValueDistInput-"+this._uid).value=this._currentDistance,document.getElementById("GPisochronChoiceAltDist-"+this._uid).click();this._currentDirection==="departure"?document.getElementById("GPisochronDirectionSelect-"+this._uid).selectedIndex=0:document.getElementById("GPisochronDirectionSelect-"+this._uid).selectedIndex=1,this._fillIsoResultsDetails(this._currentIsoResults,{graph:this._currentTransport,exclusions:this._currentExclusions,method:this._currentComputation})}clean(){this._clearIsoInputs(),this._originPoint.clearResults(),document.getElementById("GPlocationPoint_1-"+this._uid).style.cssText="",document.getElementById("GPlocationOriginCoords_1-"+this._uid).value="",document.getElementById("GPlocationOrigin_1-"+this._uid).value="",document.getElementById("GPlocationPoint_1-"+this._uid).style.cssText="",document.getElementById("GPlocationOriginPointer_1-"+this._uid).checked=!1,document.getElementById("GPlocationOrigin_1-"+this._uid).className="GPlocationOriginVisible gpf-visible",document.getElementById("GPlocationOriginCoords_1-"+this._uid).className="GPlocationOriginHidden gpf-hidden",this._currentIsoResults=null,this.setLayer(),this._resultsIsoContainer.className="GPelementHidden gpf-hidden",this._formContainer.className="gpf-panel__content fr-modal__content"}initialize(e){this._checkInputOptions(e),this.options={collapsed:!0,draggable:!1,export:!1,methods:["time","distance"],graphs:["Pieton","Voiture"],exclusions:{toll:!1,tunnel:!1,bridge:!1},directions:["departure","arrival"],markerOpts:{url:Marker.lightOrange,offset:Marker.defaultOffset},isocurveOptions:{},autocompleteOptions:{},layerDescription:{title:"Isochrone/Isodistance",description:"isochrone/isodistance bas sur un graphe"}},Helper.assign(this.options,e),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this._uid=this.options.id||SelectorID.generate(),this._currentTransport=null,this._initTransport(),this._currentComputation=null,this._initComputation(),this._currentExclusions=[],this._initExclusions(),this._currentDirection=null,this._initDirection(),this._originPoint=null,this._pictoIsoButton=null,this._waitingContainer=null,this._formContainer=null,this._resultsIsoContainer=null,this._IsoPanelContainer=null,this._IsoPanelHeaderContainer=null,this._currentIsoResults=null,this._geojsonLayer=null,this._geojsonObject=null,this.export=null,this._waiting=!1,this._timer=null,this._defaultFeatureStyle=new Style$1({fill:new Fill({color:"rgba(0, 183, 152, 0.7)"}),stroke:new Stroke({color:"rgba(0, 183, 152, 0)",width:1})}),this._resources={},this.listenerKey=null,this.COMPUTE_ISOCURVE_EVENT="isocurve:comput",this.RESULTS_ISOCURVE_EVENT="isocurve:newresults",this.DRAW_START_ISOCURVE_EVENT="isocurve:drawstart",this.DRAW_END_ISOCURVE_EVENT="isocurve:drawend"}_checkInputOptions(e){var i;if(e.methods)if(Array.isArray(e.methods))if(e.methods.length===0)e.methods=null;else for(i=0;i<e.methods.length;i++)typeof e.methods[i]!="string"&&logger$n.log("[ol.control.Isocurve] ERROR : parameter 'methods' elements should be of type 'string'");else logger$n.warn("'methods' parameter should be an array"),e.methods=null;if(e.graphs)if(Array.isArray(e.graphs))if(e.graphs.length===0)e.graphs=null;else for(i=0;i<e.graphs.length;i++)typeof e.graphs[i]!="string"?logger$n.log("[ol.control.Isocurve] ERROR : parameter 'graphs' elements should be of type 'string'"):(e.graphs[i].toLowerCase()==="pieton"&&(e.graphs[i]="Pieton"),e.graphs[i].toLowerCase()==="voiture"&&(e.graphs[i]="Voiture"));else logger$n.warn("'graphs' parameter should be an array"),e.graphs=null;if(e.directions)if(Array.isArray(e.directions))if(e.directions.length===0)e.directions=null;else for(i=0;i<e.directions.length;i++)typeof e.directions[i]!="string"&&logger$n.log("[ol.control.Isocurve] ERROR : parameter 'directions' elements should be of type 'string'");else logger$n.warn("'directions' parameter should be an array"),e.directions=null;e.collapsed==="true"&&(e.collapsed=!0),e.collapsed==="false"&&(e.collapsed=!1)}_initTransport(){this._currentTransport="Piton";var e=this.options.graphs;(!e||e.length===0)&&(this.options.graphs=["Pieton","Voiture"]),Array.isArray(e)&&e.length&&(e[0]==="Voiture"||e[0]==="Pieton")&&(this._currentTransport=e[0]);var i=this.options.isocurveOptions;i.graph&&(this._currentTransport=i.graph)}_initComputation(){this._currentComputation="time";var e=this.options.methods;(!e||e.length===0)&&(this.options.methods=["time","distance"]),Array.isArray(e)&&e.length&&(e[0]==="time"||e[0]==="distance")&&(this._currentComputation=e[0]);var i=this.options.isocurveOptions;i.method&&(this._currentComputation=i.method),i.time&&(this._currentComputation="time"),i.distance&&(this._currentComputation="distance")}_initDirection(){this._currentDirection="departure";var e=this.options.directions;(!e||e.length===0)&&(this.options.directions=["departure","arrival"]),Array.isArray(e)&&e.length&&(e[0]==="departure"||e[0]==="arrival")&&(this._currentDirection=e[0]);var i=this.options.isocurveOptions;i.reverse||(this._currentDirection="departure"),i.reverse===!0&&(this._currentDirection="arrival",this.options.directions=["arrival","departure"])}_initExclusions(){this._currentExclusions=[];var e=this.options.exclusions;if((!e||typeof e=="object"&&Object.keys(e).length===0)&&(this.options.exclusions={toll:!1,tunnel:!1,bridge:!1}),e&&typeof e=="object"&&Object.keys(e).length)for(var i in e)e.hasOwnProperty(i)&&e.k&&this._currentExclusions.push(i);var s=this.options.isocurveOptions;Array.isArray(s.exclusions)&&(this._currentExclusions=s.exclusions)}_initContainer(e){var i=this._container;if(i.childElementCount>0)return i;var s=this._pictoIsoButton=this._createShowIsoPictoElement();i.appendChild(s);var o=this._IsoPanelContainer=this._createIsoPanelElement(),l=this._createIsoPanelDivElement();o.appendChild(l);var c=this._IsoPanelHeaderContainer=this._createIsoPanelHeaderElement();l.appendChild(c);var u=this._formContainer=this._createIsoPanelFormElement();u.appendChild(this._createIsoPanelFormModeChoiceTransportElement(this.options.graphs)),u.appendChild(this._createIsoPanelFormPointLabel());var f=this._createIsoPanelFormPointElement(e);u.appendChild(f);for(var g=!1,H=!1,Y=this._createIsoPanelFormTypeChoiceElement(),ee=0;ee<this.options.methods.length;ee++)this.options.methods[ee]==="time"&&(g=ee===0,Y.appendChild(this._createIsoPanelFormTypeChoiceChronElement(g))),this.options.methods[ee]==="distance"&&(H=ee===0,Y.appendChild(this._createIsoPanelFormTypeChoiceDistElement(H)));if(u.appendChild(Y),u.appendChild(this._createIsoPanelFormLabelIsochronElement(g)),u.appendChild(this._createIsoPanelFormValueIsochronElement(g)),u.appendChild(this._createIsoPanelFormLabelIsodistanceElement(H)),u.appendChild(this._createIsoPanelFormValueIsodistanceElement(H)),u.appendChild(this._createIsoPanelFormModeChoiceDirectionElement(this.options.directions)),this.options.exclusions&&typeof this.options.exclusions=="object"&&Object.keys(this.options.exclusions).length!==0){u.appendChild(this._createShowIsoExclusionsPictoElement());var te=this._createIsoPanelFormExclusionsElement();te.appendChild(this._createIsoPanelFormExclusionOptionsElement(this.options.exclusions)),u.appendChild(te)}var ne=this._createIsoPanelFooterElement();if(u.appendChild(ne),!checkDsfr()){var Ye=this._createIsoFormResetElement();ne.appendChild(Ye)}var xe=this._submitContainer=this._createIsoSubmitFormElement();ne.appendChild(xe),l.appendChild(u);var tt=this._resultsIsoContainer=this._createIsoPanelResultsElement();l.appendChild(tt);var et=this._createDrawingButtonsPluginDiv();l.appendChild(et);var it=this._waitingContainer=this._createIsoWaitingElement();return o.appendChild(it),i.appendChild(o),i.addEventListener&&i.addEventListener("click",rt=>this._hideIsoSuggestedLocations(rt)),i}_createIsoPanelFormPointElement(e){this._originPoint=new LocationSelector({apiKey:this.options.apiKey||null,tag:{id:1,groupId:this._uid,markerOpts:this.options.markerOpts,display:!0},autocompleteOptions:this.options.autocompleteOptions||null}),this._originPoint.setMap(e);var i=this;return document.getElementById("GPlocationOriginPointerImg_1-"+this._uid).onclick=function(){i._clearGeojsonLayer();var s=i.getMap();i._originPoint._inputShowPointerContainer.checked?(i._formContainer.className="GPisochronFormMini gpf-panel__content fr-modal__content",this.listenerKey=s.on("click",()=>{i._formContainer.className="gpf-panel__content fr-modal__content",i.dispatchEvent(i.DRAW_END_ISOCURVE_EVENT)})):(i._formContainer.className="gpf-panel__content fr-modal__content",unByKey(this.listenerKey)),i.dispatchEvent(i.DRAW_START_ISOCURVE_EVENT)},document.getElementById("GPlocationOriginLabel_1-"+this._uid).onclick=function(){i._clearGeojsonLayer(),i._formContainer.className="gpf-panel__content fr-modal__content",e.un("click",()=>{i._formContainer.className="gpf-panel__content fr-modal__content"}),i.dispatchEvent(i.DRAW_END_ISOCURVE_EVENT)},document.getElementById("GPlocationOrigin_1-"+this._uid).onclick=function(){i._clearGeojsonLayer(),i.dispatchEvent(i.DRAW_END_ISOCURVE_EVENT)},this._originPoint._container}onIsoComputationSubmit(){if(!this._originPoint||!this._originPoint.getCoordinate||!this._originPoint.getCoordinate()){logger$n.log("[Isocurve] Missing position parameter to submit isocurve request");return}var e=this._originPoint.getCoordinate(),i={x:e[0].toFixed(5),y:e[1].toFixed(5)};logger$n.log("origin : ",i);var s,o;if(this._currentComputation.toLowerCase()==="time"){var l=document.getElementById("GPisochronValueChronInput1-"+this._uid),c=parseInt(l.value,10);isNaN&&isNaN(c)&&(c=0);var u=document.getElementById("GPisochronValueChronInput2-"+this._uid),f=parseInt(u.value,10);isNaN&&isNaN(f)&&(f=0),s=c*3600+f*60,logger$n.log("time : "+s)}if(this._currentComputation.toLowerCase()==="distance"){var g=document.getElementById("GPisochronValueDistInput-"+this._uid);o=parseFloat(g.value)*1e3,logger$n.log("distance : "+o)}if(!s&&!o){logger$n.log("[Isocurve] Missing time or distance parameter to submit isocurve request");return}var H=this.options.isocurveOptions||{},Y=H.protocol||"XHR",ee=H.timeOut||0;Y==="JSONP"&&ee===0&&(ee=15e3);var te=H.onFailure!==null&&typeof H.onFailure=="function",ne=H.onSuccess!==null&&typeof H.onSuccess=="function",Ye=this,xe={position:i,graph:H.graph||this._currentTransport,exclusions:H.exclusions||this._currentExclusions,method:H.method||this._currentComputation,smoothing:H.smoothing||!0,timeOut:ee,protocol:Y,resource:H.resource,onSuccess:function(tt){logger$n.log(tt),tt&&(Ye._fillIsoResultsDetails(tt,xe),Ye._drawIsoResults(tt)),ne&&H.onSuccess.call(Ye,tt)},onFailure:function(tt){Ye._hideWaitingContainer(),logger$n.log(tt.message),te&&H.onFailure.call(Ye,tt)}};(this._currentDirection.toLowerCase()==="arrival"||H.reverse)&&(xe.reverse=!0),s&&(xe.time=s),o&&(xe.distance=o),this._requestIsoCurve(xe)}onShowIsoPanelClick(e){var i=this._pictoIsoButton.ariaPressed;i==="true"&&this.onPanelOpen();var s=this.getMap();Interactions.unset(s),this.collapsed=i!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position)}onIsoTypeChoiceChange(e){var i=e.target.value;i&&(i==="isodistance"&&(this._currentComputation="distance"),i==="isochron"&&(this._currentComputation="time"))}onIsoModeTransportChange(e){var i=e.target.value;i&&(this._currentTransport=i)}onIsoModeDirectionChange(e){var i=e.target.value;i&&(i.toLowerCase()==="arrival"?document.getElementById("GPisochronPointLabelP-"+this._uid).innerHTML="Arrive":document.getElementById("GPisochronPointLabelP-"+this._uid).innerHTML="Dpart",this._currentDirection=i)}onIsoExclusionsChange(e){var i=e.target.value,s=e.target.checked;if(i){for(var o=!1,l=null,c=0;c<this._currentExclusions.length;c++)deepEqual(this._currentExclusions[c],i.toLowerCase())&&(l=c,o=!0);!o&&!s&&this._currentExclusions.push(i.toLowerCase()),o&&s&&(this._currentExclusions[l]=null)}}onIsoResetClick(){this._clear()}onShowIsoResultsNewClick(){this._clearGeojsonLayer(),this.dispatchEvent(this.RESULTS_ISOCURVE_EVENT)}onShowIsoSettingsClick(){}_requestIsoCurve(e){!e||typeof e=="object"&&Object.keys(e).length===0||e.position&&(typeof e.ssl!="boolean"&&(typeof this.options.ssl=="boolean"?e.ssl=this.options.ssl:e.ssl=!0),logger$n.log(e),this._clearGeojsonLayer(),this._displayWaitingContainer(),Gp.Services.isoCurve(e))}_fillIsoResultsDetails(e,i){this._fillIsoResultsDetailsContainer(e,i),this._currentIsoInformations=e,this.dispatchEvent({type:this.COMPUTE_ISOCURVE_EVENT}),this._formContainer.className="GPelementHidden gpf-hidden gpf-panel__content fr-modal__content",this._hideWaitingContainer(),this._resultsIsoContainer.className="gpf-flex GPflex"}_fillIsoResultsDetailsContainer(e,i){this._resultsIsoValuesContainer=this._addIsoResultsValuesElement(e,i,MathUtils.convertSecondsToTime)}_drawIsoResults(e){if(this._currentIsoResults=e,this._hideWaitingContainer(),!!e.geometry){var i=this.getMap();this._geojsonObject={type:"FeatureCollection",crs:{type:"name",properties:{name:"EPSG:4326"}},features:[{type:"Feature",crs:{type:"name",properties:{name:"EPSG:4326"}},geometry:e.geometry}]},this._geojsonObject.features.push({type:"Feature",geometry:{type:"Point",coordinates:this._originPoint.getCoordinate()},properties:{description:"Point d'origine","marker-symbol":this.options.markerOpts.url}});var s=new GeoJSON({defaultDataProjection:"EPSG:4326",defaultStyle:this._defaultFeatureStyle}),o=i.getView().getProjection().getCode(),l=s.readFeatures(this._geojsonObject,{dataProjection:"EPSG:4326",featureProjection:o}),f=this._currentComputation==="time"?"Isochrone":"Isodistance";this._geojsonLayer=new VectorLayer({source:new VectorSource({features:l}),style:this._defaultFeatureStyle,opacity:.9,title:"Mon "+f});var c;if(this._currentTransport==="Pieton"?(c="piton",this._geojsonLayer.gpResultLayerId="compute:Pieton$GEOPORTAIL:GPP:Isocurve"):(c="voiture",this._geojsonLayer.gpResultLayerId="compute:Voiture$GEOPORTAIL:GPP:Isocurve"),i.addLayer(this._geojsonLayer),this.dispatchEvent({type:this.COMPUTE_ISOCURVE_EVENT}),l[0]&&l[0].getGeometry()&&l[0].getGeometry().getExtent()){var u=l[0].getGeometry().getExtent();i.getView().fit(u,i.getSize())}var f=this._currentComputation==="time"?"Isochrone":"Isodistance";i.getControls().forEach(g=>{if(g instanceof LayerSwitcher){var H=this._geojsonLayer.gpLayerId;g._layers[H].title===H&&g.addLayer(this._geojsonLayer,{title:this.options.layerDescription.title+" ("+f+"/"+c+")",description:this.options.layerDescription.description})}})}}_clear(){this._clearIsoInputs(),this._originPoint.clear(),this._clearGeojsonLayer(),this._currentIsoResults=null}_clearIsoInputs(){var e=document.getElementById("GPisochronValueChronInput1-"+this._uid);e&&(e.value="0");var i=document.getElementById("GPisochronValueChronInput2-"+this._uid);i&&(i.value="0");var s=document.getElementById("GPisochronValueDistInput-"+this._uid);s&&(s.value="0"),this._initTransport(),this._initComputation(),this._initDirection(),this._initExclusions();var o;this._currentTransport==="Pieton"?(o=document.getElementById("GPisochronTransportPedestrian-"+this._uid),o&&(o.checked="true")):(o=document.getElementById("GPisochronTransportCar-"+this._uid),o&&(o.checked="true"));var l;this._currentComputation.toLowerCase()==="distance"?(l=document.getElementById("GPisochronChoiceAltDist-"+this._uid),l&&(l.checked="true"),document.getElementById("GPisochronValueDist-"+this._uid)&&(document.getElementById("GPisochronValueDist-"+this._uid).className="GPflexInput gpf-flex"),document.getElementById("GPisochronValueChron-"+this._uid)&&(document.getElementById("GPisochronValueChron-"+this._uid).className="GPelementHidden gpf-hidden")):(l=document.getElementById("GPisochronChoiceAltChron-"+this._uid),l&&(l.checked="true"),document.getElementById("GPisochronValueChron-"+this._uid)&&(document.getElementById("GPisochronValueChron-"+this._uid).className="GPflexInput gpf-flex"),document.getElementById("GPisochronValueDist-"+this._uid)&&(document.getElementById("GPisochronValueDist-"+this._uid).className="GPelementHidden gpf-hidden"));var c=document.getElementById("GPisochronDirectionSelect-"+this._uid);c&&(c.value=this._currentDirection),c.value.toLowerCase()==="arrival"?document.getElementById("GPisochronPointLabelP-"+this._uid).innerHTML="Arrive":document.getElementById("GPisochronPointLabelP-"+this._uid).innerHTML="Dpart";var u=document.getElementById("GPisoExclusionsToll-"+this._uid);u&&(this._currentExclusions.indexOf("toll")!==-1?u.checked=!1:u.checked=!0);var f=document.getElementById("GPisoExclusionsTunnel-"+this._uid);f&&(this._currentExclusions.indexOf("tunnel")!==-1?f.checked=!1:f.checked=!0);var g=document.getElementById("GPisoExclusionsBridge-"+this._uid);g&&(this._currentExclusions.indexOf("bridge")!==-1?g.checked=!1:g.checked=!0)}_clearGeojsonLayer(){var e=this.getMap();this._geojsonLayer&&(e.removeLayer(this._geojsonLayer),this._geojsonLayer=null),this._geojsonObject=null}_hideIsoSuggestedLocations(e){e.target&&e.target.id&&e.target.id.indexOf("GPlocationOrigin_")!==-1||this._originPoint._hideSuggestedLocation()}_displayWaitingContainer(){this._waitingContainer.className="GPwaitingContainer GPwaitingContainerVisible gpf-waiting gpf-waiting--visible",this._waiting=!0;var e=this.options.isocurveOptions;if(e&&e.timeOut){this._timer&&(clearTimeout(this._timer),this._timer=null);var i=this;this._timer=setTimeout(function(){i._waiting===!0?i._hideWaitingContainer():i._timer&&clearTimeout(i._timer)},16e3)}}_hideWaitingContainer(){if(this._waiting){this._waitingContainer.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden",this._waiting=!1;var e=this.options.isocurveOptions;e&&e.timeOut&&(clearTimeout(this._timer),this._timer=null)}}}Object.assign(Isocurve.prototype,IsoDOM);Object.assign(Isocurve.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.Isocurve=Isocurve);const deepEqual=function(n,e){if(n===e)return!0;if(typeof n=="object"&&n!=null&&typeof e=="object"&&e!=null){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(var i in n)if(e.hasOwnProperty(i)){if(!deepEqual(n[i],e[i]))return!1}else return!1;return!0}else return!1};var ReverseGeocodeDOM={_addUID:function(n){var e=this._uid?n+"-"+this._uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPreverseGeocoding"),n.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",n},_createShowReverseGeocodingPictoElement:function(){var n=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowReverseGeocodingPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowReverseGeocodingPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-reverse fr-btn fr-btn--tertiary",e.setAttribute("aria-label","Ouvrir la recherche d'adresses"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowReverseGeocodingClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowReverseGeocodingClick(s)}),e},_createReverseGeocodingWaitingElement:function(){var n=document.createElement("div");n.id=this._addUID("GPreverseGeocodingCalcWaitingContainer"),n.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden";var e=document.createElement("p");return e.className="GPwaitingContainerInfo gpf-waiting_info",e.innerHTML="Recherche en cours...",n.appendChild(e),n},_createReverseGeocodingResultsPanelElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPreverseGeocodingResultsPanel"),n.className="GPpanel GPelementHidden gpf-panel gpf-panel-reverse gpf-panel--hidden",n},_createReverseGeocodingResultsListElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPreverseGeocodingResultsList"),n.className="gpf-panel__list",n.setAttribute("tabindex","0"),n},_createReverseGeocodingResultElement:function(n,e){var i=this,s=document.getElementById(this._addUID("GPreverseGeocodingResultsList")),o=document.createElement("div");if(n){o.id=this._addUID("GPreverseGeocodedLocationResultDiv_"+e);var l=document.createElement("div");l.id=this._addUID("GPreverseGeocodedLocation_"+e),l.setAttribute("tabindex","0"),l.className="GPautoCompleteProposal gpf-panel__items",l.innerHTML=n,l.title=n,l.addEventListener?(l.addEventListener("mouseover",function(f){i.onReverseGeocodingResultMouseOver(f)}),l.addEventListener("focus",function(f){i.onReverseGeocodingResultMouseOver(f)}),l.addEventListener("mouseout",function(f){i.onReverseGeocodingResultMouseOut(f)}),l.addEventListener("blur",function(f){i.onReverseGeocodingResultMouseOut(f)}),l.addEventListener("click",function(f){typeof i.onReverseGeocodingResultClick=="function"&&i.onReverseGeocodingResultClick(f)})):l.attachEvent&&(l.attachEvent("onmouseover",function(f){i.onReverseGeocodingResultMouseOver(f)}),l.attachEvent("onmouseout",function(f){i.onReverseGeocodingResultMouseOut(f)}),l.attachEvent("onclick",function(f){typeof i.onReverseGeocodingResultClick=="function"&&i.onReverseGeocodingResultClick(f)}));var c=document.createElement("button");c.type="button",c.id=this._addUID("GPreverseGeocodedLocationResultCopy_"+e),c.setAttribute("data-text-geolocate",l.innerHTML),c.setAttribute("title","Copier le rsultat"),c.classList.add("gpf-btn-icon-copy-result","fr-btn","fr-btn--tertiary","gpf-btn","gpf-btn--tertiary","gpf-btn-icon"),c.addEventListener?c.addEventListener("click",function(f){typeof i.onReverseGeocodingResultCopyButtonClick=="function"&&(i.onReverseGeocodingResultCopyButtonClick(f),c.classList.add("GPcopiedLocation"),setTimeout(()=>{c.classList.remove("GPcopiedLocation")},1e3))}):c.attachEvent&&c.attachEvent("onclick",function(f){typeof i.onReverseGeocodingResultCopyButtonClick=="function"&&i.onReverseGeocodingResultCopyButtonClick(f)}),o.appendChild(l),o.appendChild(c)}else{o.id=this._addUID("GPreverseGeocodedLocationNoResultDiv");var l=document.createElement("div");l.id=this._addUID("GPreverseGeocodedNoResult"),l.setAttribute("tabindex","0"),l.className="GPautoCompleteProposal gpf-panel__items",l.innerHTML="Aucun rsultat trouv",l.title="Aucun rsultat trouv",o.appendChild(l)}s.appendChild(o)},_createReverseGeocodingPanelElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPreverseGeocodingPanel"),n.className="GPpanel gpf-panel fr-modal",n},_createReverseGeocodingPanelDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__body fr-modal__body",n},_createReverseGeocodingPanelHeaderElement:function(){var n=document.createElement("div");return n.className="GPpanelHeader gpf-panel__header fr-modal__header",n},_createReverseGeocodingPanelReturnPictoElement:function(){var n=this,e=document.createElement("button");if(e.id=this._addUID("GPreverseGeocodingReturnPicto"),e.title="Nouvelle recherche",e.className="GPreturnPicto GPimportPanelReturnPicto gpf-btn gpf-btn-icon-return fr-btn fr-btn--close fr-btn--tertiary-no-outline fr-m-1w",e.classList.add("GPelementHidden"),e.classList.add("gpf-hidden"),checkDsfr()){var i=document.createElement("span");i.className="GPelementHidden gpf-visible",i.innerHTML="Retour",e.appendChild(i)}return e.addEventListener?e.addEventListener("click",function(s){document.getElementById(n._addUID("GPreverseGeocodingResultsPanel")).className="GPelementHidden gpf-panel--hidden",document.getElementById(n._addUID("GPreverseGeocodingForm")).className="GPform gpf-panel__content fr-modal__content",document.getElementById(n._addUID("GPreverseGeocodingHeaderTitle")).innerHTML="Trouver une adresse",document.getElementById(n._addUID("GPreverseGeocodingReturnPicto")).classList.add("GPelementHidden"),document.getElementById(n._addUID("GPreverseGeocodingReturnPicto")).classList.add("gpf-hidden"),n.onGPreverseGeocodingReturnPictoClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){document.getElementById(n._addUID("GPreverseGeocodingResultsPanel")).className="GPelementHidden gpf-panel--hidden",document.getElementById(n._addUID("GPreverseGeocodingForm")).className="GPform gpf-panel__content fr-modal__content",document.getElementById(n._addUID("GPreverseGeocodingHeaderTitle")).innerHTML="Trouver une adresse",document.getElementById(n._addUID("GPreverseGeocodingReturnPicto")).classList.add("GPelementHidden"),document.getElementById(n._addUID("GPreverseGeocodingReturnPicto")).classList.add("gpf-hidden"),n.onGPreverseGeocodingReturnPictoClick(s)}),e},_createReverseGeocodingPanelTitleElement:function(){var n=document.createElement("div");return n.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",n.id=this._addUID("GPreverseGeocodingHeaderTitle"),n.innerHTML="Trouver une adresse",n},_createReverseGeocodingPanelCloseElement:function(){var n=this,e=document.createElement("button");e.id=this._addUID("GPreverseGeocodingPanelClose"),e.className="GPpanelClose GPreverseGeocodingPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",e.title="Fermer le panneau",e.addEventListener?(e.addEventListener("click",function(){document.getElementById(n._addUID("GPshowReverseGeocodingPicto")).click()},!1),e.addEventListener("keydown",function(s){s.keyCode===13&&document.getElementById(n._addUID("GPshowReverseGeocodingPicto")).click()},!1)):e.attachEvent&&(e.attachEvent("onclick",function(){document.getElementById(n._addUID("GPshowReverseGeocodingPicto")).click()}),e.attachEvent("onkeydown",function(s){s.keyCode===13&&document.getElementById(n._addUID("GPshowReverseGeocodingPicto")).click()}));var i=document.createElement("span");return i.className="GPelementHidden gpf-visible",i.innerText="Fermer",e.appendChild(i),e},_createReverseGeocodingPanelFormElement:function(){var n=this,e=document.createElement("form");return e.id=this._addUID("GPreverseGeocodingForm"),e.className="GPform gpf-panel__content fr-modal__content",e.addEventListener?e.addEventListener("submit",function(i){i.preventDefault(),n.onReverseGeocodingSubmit()}):e.attachEvent&&e.attachEvent("onsubmit",function(i){i.preventDefault(),n.onReverseGeocodingSubmit()}),e},_createReverseGeocodingFormModeChoiceGeocodingTypeElement:function(n){var e=this,i=document.createElement("div");i.className="GPflexInput gpf-flex gpf-flex-reverse fr-mb-1w";var s=document.createElement("label");s.id="label-recherche-par",s.className="GPlabel gpf-label fr-label",s.innerHTML="Recherche par",s.title="Recherche par",i.appendChild(s);var o=document.createElement("select");o.setAttribute("aria-labelledby","label-recherche-par"),o.className="GPselect gpf-select fr-select",o.addEventListener?o.addEventListener("change",function(g){e.onReverseGeocodingTypeChange(g)}):o.attachEvent&&o.attachEvent("onchange",function(g){e.onReverseGeocodingTypeChange(g)}),(!n||!Array.isArray(n))&&(n=["StreetAddress","PositionOfInterest","CadastralParcel"]);for(var l=0;l<n.length;l++)switch(n[l]){case"PositionOfInterest":var c=document.createElement("option");c.value="PositionOfInterest",c.text="Lieux/toponymes",o.appendChild(c);break;case"StreetAddress":var u=document.createElement("option");u.value="StreetAddress",u.text="Adresses",o.appendChild(u);break;case"CadastralParcel":var f=document.createElement("option");f.value="CadastralParcel",f.text="Parcelles cadastrales",o.appendChild(f);break}return i.appendChild(o),i},_createReverseGeocodingFormModeChoiceGeocodingDelimitationElement:function(n){var e=this,i=document.createElement("div");i.className="GPflexInput gpf-flex gpf-flex-reverse fr-mb-2w";var s=document.createElement("label");s.id="label-delimitation",s.className="GPlabel gpf-label fr-label",s.innerHTML="Dlimitation",s.title="Dlimitation",i.appendChild(s);var o=document.createElement("select");o.setAttribute("aria-labelledby","label-delimitation"),o.className="GPselect gpf-select fr-select",o.addEventListener?o.addEventListener("change",function(g){e.onReverseGeocodingDelimitationChange(g)}):o.attachEvent&&o.attachEvent("onchange",function(g){e.onReverseGeocodingDelimitationChange(g)}),(!n||!Array.isArray(n))&&(n=["Point","Circle","Extent"]);for(var l=0;l<n.length;l++)switch(n[l].toLowerCase()){case"point":var c=document.createElement("option");c.value="point",c.text="Pointer un lieu",o.appendChild(c);break;case"circle":var u=document.createElement("option");u.value="circle",u.text="Dessiner un cercle",o.appendChild(u);break;case"extent":var f=document.createElement("option");f.value="extent",f.text="Dessiner une emprise",o.appendChild(f);break}return i.appendChild(o),i},_createReverseGeocodingSubmitFormElement:function(){var n=document.createElement("input");return n.id=this._addUID("GPreverseGeocodingSubmit"),n.className="GPsubmit gpf-btn fr-btn",n.type="submit",n.value="Rechercher",n}},logger$m=LoggerByDefault.getLogger("reversegeocoding");class ReverseGeocode extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof ReverseGeocode))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="ReverseGeocode",this.initialize(e),this.container=this._initContainer(),this.element?this.element.appendChild(this.container):this.element=this.container,this}getCollapsed(){return this.collapsed}setCollapsed(e){if(e===void 0){logger$m.log("[ERROR] ReverseGeocode:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(e?this._panelCloseButton.click():this._showReverseGeocodingButton.click(),this.collapsed=e)}setMap(e){if(e)this._activateMapInteraction(e),this.draggable&&Draggable.dragElement(this._panelContainer,this._panelHeaderContainer,e.getTargetElement()),this.collapsed||this._showReverseGeocodingButton.setAttribute("aria-pressed",!0);else{var i=this.getMap();this._clearResults(),this._clearInputFeatures(),this._removeMapInteraction(i),this._inputFeaturesLayer!=null&&(i.removeLayer(this._inputFeaturesLayer),this._inputFeaturesLayer=null,this._inputFeaturesSources=null,this._inputFeatures=null)}super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getData(){return this._reverseGeocodingLocations}getContainer(){return this.container}initialize(e){this._checkInputOptions(e),this.options={collapsed:!0,draggable:!1,resources:["StreetAddress","PositionOfInterest","CadastralParcel"],delimitations:["Point","Circle","Extent"],reverseGeocodeOptions:{},layerDescription:{title:"Saisie (recherche inverse)",description:"Couche de saisie d'une zone de recherche pour la recherche inverse"}},Helper.assign(this.options,e),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this._uid=this.options.id||SelectorID.generate(),this._currentGeocodingType=null,this._initGeocodingType(),this._currentGeocodingDelimitation=null,this._initGeocodingDelimitation(),this._showReverseGeocodingButton=null,this._panelContainer=null,this._panelHeaderContainer=null,this._panelTitleContainer=null,this._returnPictoContainer=null,this._panelCloseButton=null,this._formContainer=null,this._resultsContainer=null,this._resultsListContainer=null,this._waitingContainer=null,this._inputFeatures=null,this._inputFeaturesSource=null,this._inputFeaturesLayer=null,this._mapInteraction=null,this._requestOptions=null,this._requestGeom=null,this._requestPosition=null,this._waiting=!1,this._timer=null,this._reverseGeocodingLocations=[],this._reverseGeocodingLocationsMarkers=[],this._resultsDefaultStyle=new Style$1({image:new Icon({src:Marker.lightOrange,anchor:[.5,1]})}),this._resultsSelectedStyle=new Style$1({image:new Icon({src:Marker.red,anchor:[.5,1]})}),this._resultsHoverInteraction=null,this._resultsSelectInteraction=null,this._popupContent=null,this._popupDiv=this._initPopupDiv(),this._popupOverlay=null}_checkInputOptions(e){var i,s;if(e.resources){var o=e.resources;if(Array.isArray(o)){var l=["StreetAddress","PositionOfInterest","CadastralParcel"],c=[];for(i=0;i<o.length;i++)l.indexOf(o[i])===-1&&(c.push(i),logger$m.log("[ReverseGeocode] options.resources : "+o[i]+" is not a resource for reverse geocode"));if(c.length!==0)for(s=0;s<c.length;s++)o.splice(c[s],1)}else logger$m.log("[ReverseGeocode] 'options.resources' parameter should be an array"),o=null}if(e.delimitations){var u=e.delimitations;if(Array.isArray(u)){var f=["Circle","Point","Extent"],g=[];for(i=0;i<u.length;i++)f.indexOf(u[i])===-1&&(g.push(i),logger$m.log("[ReverseGeocode] options.delimitations : "+u[i]+" is not a delimitation for reverse geocode"));if(g.length!==0)for(s=0;s<g.length;s++)u.splice(g[s],1)}else logger$m.log("[ReverseGeocode] 'options.delimitations' parameter should be an array"),u=null}}_initGeocodingType(){this._currentGeocodingType="StreetAddress";var e=this.options.resources;(!e||e.length===0)&&(this.options.resources=["StreetAddress","PositionOfInterest","CadastralParcel"]),Array.isArray(e)&&e.length&&(e[0]==="StreetAddress"||e[0]==="PositionOfInterest"||e[0]==="CadastralParcel")&&(this._currentGeocodingType=e[0]);var i=this.options.reverseGeocodeOptions;i.filterOptions&&Array.isArray(i.filterOptions.type)&&i.filterOptions.type.length!==0&&(this._currentGeocodingType=i.filterOptions.type[0])}_initGeocodingDelimitation(){this._currentGeocodingDelimitation="Point";var e=this.options.delimitations;if((!e||e.length===0)&&(this.options.delimitations=["Point","Circle","Extent"]),Array.isArray(e)&&e.length){var i=e[0].toLowerCase();(i==="point"||i==="circle"||i==="extent")&&(this._currentGeocodingDelimitation=e[0])}}_initPopupDiv(){var e=this,i=document.createElement("div");i.className="gp-feature-info-div";var s=document.createElement("button");return s.className="gp-styling-button closer",s.onclick=function(){return e._popupOverlay!=null&&e._popupOverlay.setPosition(void 0),!1},this._popupContent=document.createElement("div"),this._popupContent.className="gp-features-content-div",i.appendChild(this._popupContent),i.appendChild(s),i}_initContainer(){var e=this._createMainContainerElement(),i=this._showReverseGeocodingButton=this._createShowReverseGeocodingPictoElement();e.appendChild(i);var s=this._panelContainer=this._createReverseGeocodingPanelElement(),o=this._createReverseGeocodingPanelDivElement();s.appendChild(o);var l=this._panelHeaderContainer=this._createReverseGeocodingPanelHeaderElement(),c=this._returnPictoContainer=this._createReverseGeocodingPanelReturnPictoElement();l.appendChild(c);var u=this._panelTitleContainer=this._createReverseGeocodingPanelTitleElement();l.appendChild(u);var f=this._panelCloseButton=this._createReverseGeocodingPanelCloseElement();l.appendChild(f),o.appendChild(l);var g=this._formContainer=this._createReverseGeocodingPanelFormElement();g.appendChild(this._createReverseGeocodingFormModeChoiceGeocodingTypeElement(this.options.resources)),g.appendChild(this._createReverseGeocodingFormModeChoiceGeocodingDelimitationElement(this.options.delimitations));var H=this._createReverseGeocodingSubmitFormElement();g.appendChild(H),o.appendChild(g);var Y=this._waitingContainer=this._createReverseGeocodingWaitingElement();o.appendChild(Y);var ee=this._resultsContainer=this._createReverseGeocodingResultsPanelElement(),te=this._resultsListContainer=this._createReverseGeocodingResultsListElement();return ee.appendChild(te),o.appendChild(ee),e.appendChild(s),logger$m.log(e),e}_activateMapInteraction(e){if(!this.collapsed){this._inputFeaturesLayer==null&&(this._inputFeatures=new Collection,this._inputFeaturesSource=new VectorSource({features:this._inputFeatures}),this._inputFeaturesLayer=new VectorLayer({source:this._inputFeaturesSource,style:new Style$1({fill:new Fill({color:"rgba(0, 183, 152, 0.3)"}),stroke:new Stroke({color:"rgba(0, 183, 152, 0.8)",width:3}),image:new Icon({src:Marker.turquoiseBlue,anchor:[.5,1]})})}),this._inputFeaturesLayer.gpResultLayerId="reverseGeocoding",e.addLayer(this._inputFeaturesLayer));var i=this._currentGeocodingDelimitation.toLowerCase();switch(i){case"point":this._activatePointInteraction(e);break;case"circle":this._activateCircleInteraction(e);break;case"extent":this._activateBoxInteraction(e);break}e.getControls().forEach(s=>{if(s instanceof LayerSwitcher){var o=this._inputFeaturesLayer.gpLayerId;s._layers[o].title===o&&(s.addLayer(this._inputFeaturesLayer,{title:this.options.layerDescription.title,description:this.options.layerDescription.description}),s.setRemovable(this._inputFeaturesLayer,!1))}})}}_activatePointInteraction(e){this._mapInteraction=new Draw({style:new Style$1({image:new CircleStyle({radius:0,fill:new Fill({color:"rgba(0, 183, 152, 0.8)"})})}),type:"Point",source:this._inputFeaturesSource}),this._mapInteraction.on("drawstart",i=>{logger$m.log("on drawstart ",i),this._inputFeatures.clear(),this._onDrawStart(i,"point")}),this._mapInteraction.on("drawend",i=>{logger$m.log("on drawend",i),i.feature&&i.feature.getGeometry&&(this._requestGeom={type:"Point",coordinates:[this._requestPosition.lon,this._requestPosition.lat]})}),e.addInteraction(this._mapInteraction),this._setCursor("crosshair",e)}_activateCircleInteraction(e){this._mapInteraction=new Draw({style:new Style$1({fill:new Fill({color:"rgba(0, 183, 152, 0.3)"}),stroke:new Stroke({color:"rgba(0, 183, 152, 0.8)",width:3}),image:new CircleStyle({radius:4,fill:new Fill({color:"rgba(0, 183, 152, 0.8)"})})}),type:"Circle",source:this._inputFeaturesSource,geometryFunction:function(i,s){const o=i[0],l=i[i.length-1],c=o[0]-l[0],u=o[1]-l[1],g=Math.min(Math.sqrt(c*c+u*u),500);return s?s.setCenterAndRadius(o,g):s=new Circle(o,g),s}}),this._mapInteraction.on("drawstart",i=>{logger$m.log("on drawstart ",i),this._inputFeatures.clear(),this._onDrawStart(i,"circle")}),this._mapInteraction.on("drawend",i=>{if(logger$m.log("on drawend",i),i.feature&&i.feature.getGeometry){var s=i.feature.getGeometry().getRadius();this._requestGeom={},this._requestGeom.type="Circle",this._requestGeom.radius=s,this._requestPosition&&(this._requestGeom.coordinates=[this._requestPosition.lon,this._requestPosition.lat]),logger$m.log("circle radius : ",s)}}),e.addInteraction(this._mapInteraction)}_activateBoxInteraction(e){var i=function(s,o){o||(o=new Polygon([]));var l=s[0],c=s[1];const u=l[0]-c[0],f=l[1]-c[1],g=1e3,H=Math.max(-g,Math.min(u,g)),Y=Math.max(-g,Math.min(f,g));return o.setCoordinates([[l,[l[0],l[1]-Y],[l[0]-H,l[1]-Y],[l[0]-H,l[1]],l]]),o};this._mapInteraction=new Draw({style:new Style$1({fill:new Fill({color:"rgba(0, 183, 152, 0.3)"}),stroke:new Stroke({color:"rgba(0, 183, 152, 0.8)",width:3}),image:new CircleStyle({radius:4,fill:new Fill({color:"rgba(0, 183, 152, 0.8)"})})}),type:"LineString",source:this._inputFeaturesSource,maxPoints:2,geometryFunction:i}),this._mapInteraction.on("drawstart",s=>{logger$m.log("on drawstart",s),this._inputFeatures.clear(),this._onDrawStart(s,"polygon")}),this._mapInteraction.on("drawend",s=>{logger$m.log("on drawend",s),this._onBoxDrawEnd(s)}),e.addInteraction(this._mapInteraction)}_removeMapInteraction(e){this._mapInteraction!=null&&(e.removeInteraction(this._mapInteraction),this._mapInteraction=null),this._setCursor()}_onDrawStart(e,i){var s;if(e.feature&&e.feature.getGeometry){var o=e.feature.getGeometry();i==="point"&&(s=o.getCoordinates()),i==="circle"&&(s=o.getCenter()),i==="polygon"&&(s=o.getFirstCoordinate())}if(s){var l;if(this.options.reverseGeocodeOptions&&this.options.reverseGeocodeOptions.srs)l=this.options.reverseGeocodeOptions.srs;else{var c=this.getMap();if(!c||!c.getView())return;l=c.getView().getProjection()}var u=transform$1(s,l,"EPSG:4326");this._requestPosition={lon:u[0],lat:u[1]},logger$m.log("position coordinates : ",this._requestPosition)}}_onBoxDrawEnd(e){if(e.feature&&e.feature.getGeometry){var i=e.feature.getGeometry().getCoordinates()[0],s=i[0],o=i[2],l;if(this.options.reverseGeocodeOptions&&this.options.reverseGeocodeOptions.srs)l=this.options.reverseGeocodeOptions.srs;else{var c=this.getMap();if(!c||!c.getView())return;l=c.getView().getProjection()}var u=transform$1(s,l,"EPSG:4326"),f=transform$1(o,l,"EPSG:4326"),g={};u[0]<f[0]?(g.left=u[0],g.right=f[0]):(g.left=f[0],g.right=u[0]),u[1]<f[1]?(g.bottom=u[1],g.top=f[1]):(g.bottom=f[1],g.top=u[1]),this._requestGeom={type:"Polygon",coordinates:[[[g.left,g.top],[g.left,g.bottom],[g.right,g.bottom],[g.right,g.top],[g.left,g.top]]]},logger$m.log("searchGeometry filter : ",this._requestGeom)}}_setCursor(e,i){if(i=i||this.getMap(),!!i){var s=i.getTargetElement();e?s.style.cursor=e:s.style.cursor=null}}_reverseGeocodingRequest(){var e=this.getMap();this._requestOptions=this._getReverseGeocodingRequestOptions(),this._removeMapInteraction(e),this._displayWaitingContainer(),Gp.Services.reverseGeocode(this._requestOptions)}_getReverseGeocodingRequestOptions(){var e=this.getMap(),i=this.options.reverseGeocodeOptions,s=this;typeof this.options.ssl!="boolean"&&(this.options.ssl=!0);var o=i.onFailure!==null&&typeof i.onFailure=="function",l=i.onSuccess!==null&&typeof i.onSuccess=="function",c={apiKey:i.apiKey||this.options.apiKey,ssl:this.options.ssl,position:this._requestPosition,filterOptions:{type:[this._currentGeocodingType]},srs:"CRS:84",returnFreeForm:!1,maximumResponses:i.maximumResponses||18,timeOut:i.timeOut||3e4,onSuccess:function(u){u.locations&&(logger$m.log("reverseGeocode results : ",u.locations),s._displayGeocodedLocations(u.locations)),l&&i.onSuccess.call(s,u.locations)},onFailure:function(u){s._hideWaitingContainer(),s._clearResults(),s._clearInputFeatures(),s._activateMapInteraction(e),logger$m.log(u.message),o&&i.onFailure.call(s,u)}};return this._requestGeom.type.toLowerCase()==="circle"?(this._requestGeom.radius>500&&(logger$m.log("INFO : initial circle radius ("+this._requestGeom.radius+") limited to 1000m."),this._requestGeom.radius=500),c.searchGeometry=this._requestGeom):this._requestGeom.type.toLowerCase()==="polygon"?c.searchGeometry=this._requestGeom:this._requestGeom.type.toLowerCase()==="point"&&(this._currentGeocodingType==="StreetAddress"?(c.searchGeometry={type:"Circle",radius:50,coordinates:this._requestGeom.coordinates},c.maximumResponses=1):c.searchGeometry=this._requestGeom),logger$m.log("reverseGeocode request options : ",c),c}_displayGeocodedLocations(e){this._clearResults(),this._reverseGeocodingLocations=e,this.dispatchEvent({type:"reversegeocode:compute"}),this._formContainer.className="GPelementHidden gpf-hidden",this._hideWaitingContainer(),this._panelTitleContainer.innerHTML="Rsultats de la recherche",this._returnPictoContainer.classList.remove("GPelementHidden"),this._returnPictoContainer.classList.remove("gpf-hidden"),this._resultsContainer.className="GPform gpf-panel__content fr-modal__content",this._fillGeocodedLocationListContainer(e),this._displayGeocodedLocationsOnMap(e)}_fillGeocodedLocationListContainer(e){e.length===0&&this._createReverseGeocodingResultElement();for(var i=0;i<e.length;i++){var s=e[i];logger$m.log(s);var o=this._fillGeocodedLocationDescription(s);o&&o.length!==0&&this._createReverseGeocodingResultElement(o,i)}}_fillGeocodedLocationDescription(e){if(!(!e||!e.placeAttributes)){var i=e.placeAttributes,s="";switch(e.type){case"StreetAddress":i.street&&(s+=i.housenumber?i.housenumber+" ":"",s+=i.street+", "),s+=i.postcode+" "+i.city;break;case"PositionOfInterest":s+=i.toponym,i.postcode&&i.postcode.length===1&&(s+=", "+i.postcode[0]),s+=" ("+i.category.join(",")+")";break;case"CadastralParcel":s+=i.id,s+=i.city?" ("+i.city+")":"";break;default:s+=i.city?i.city:"";break}return s}}_displayGeocodedLocationsOnMap(e){if(this._reverseGeocodingLocations.length!==0){var i=this.getMap();this._createResultsLayer();for(var s=0;s<e.length;s++)this._addResultFeature(e[s],s);if(this._resultsFeatures.getLength()>1){if(this._resultsFeaturesSource&&this._resultsFeaturesSource.getExtent){var o=this._resultsFeaturesSource.getExtent();i.getView().fit(o,i.getSize())}}else{var l=this._resultsFeatures.item(0),c=l.getGeometry().getCoordinates();i.getView().setCenter(c),i.getView().setZoom(17)}this._resultsHoverInteraction=new Select({condition:pointerMove,layers:[this._resultsFeaturesLayer]}),this._resultsHoverInteraction.on("select",f=>this._onResultsFeatureMouseOver(f)),i.addInteraction(this._resultsHoverInteraction),this._resultsSelectInteraction=new Select({layers:[this._resultsFeaturesLayer]}),this._resultsSelectInteraction.on("select",f=>this._onResultsFeatureSelect(f)),i.addInteraction(this._resultsSelectInteraction);var u="";switch(this._currentGeocodingType){case"StreetAddress":u="adresses";break;case"PositionOfInterest":u="toponymes";break;case"CadastralParcel":u="parcelles cadastrales";break}i.getControls().forEach(f=>{if(f instanceof LayerSwitcher){var g=this._resultsFeaturesLayer.gpLayerId;f._layers[g].title===g&&(f.addLayer(this._resultsFeaturesLayer,{title:"Rsultats de la recherche inverse",description:"Rsultats de la recherche inverse sur les "+u}),f.setRemovable(this._resultsFeaturesLayer,!1))}})}}_createResultsLayer(){var e=this.getMap();this._resultsFeatures=new Collection,this._resultsFeaturesSource=new VectorSource({features:this._resultsFeatures}),this._resultsFeaturesLayer=new VectorLayer({source:this._resultsFeaturesSource}),this._resultsFeaturesLayer.gpResultLayerId="reverseGeocodingResults",e.addLayer(this._resultsFeaturesLayer)}_addResultFeature(e,i){var s=this.getMap(),o=[e.position.lon,e.position.lat];if(o.length!==0){var l=s.getView(),c=l.getProjection().getCode();c!=="EPSG:4326"&&(o=transform$1(o,"EPSG:4326",c));var u=new Feature({geometry:new Point$1(o)});u.setStyle(this._resultsDefaultStyle),u.setId(i),u.setProperties({location:e,popupContent:this._fillPopupContent(e)}),this._resultsFeatures.push(u)}}_fillPopupContent(e){var i="<ul>",s=e.placeAttributes;for(var o in s)s.hasOwnProperty(o)&&o!=="trueGeometry"&&o!=="extraFields"&&o!=="houseNumberInfos"&&o!=="_count"&&(i+="<li>",i+='<span class="gp-attname-others-span">'+o.toUpperCase()+" : </span>",i+=s[o],i+=" </li>");return i+=" </ul>",i}_onResultsFeatureMouseOver(e){var i;if(e.selected.length!==0){if(i=e.selected[0],i.setStyle(this._resultsSelectedStyle),i.getId()!=null){var s=document.getElementById("GPreverseGeocodedLocation_"+i.getId()+"-"+this._uid);s&&s.classList&&s.classList.add("GPlocationHighlight")}document.getElementById("GPreverseGeocodedLocation_"+i.getId()+"-"+this._uid)}if(e.deselected.length!==0){i=e.deselected[0],i.setStyle(this._resultsDefaultStyle);var o=document.getElementById("GPreverseGeocodedLocation_"+i.getId()+"-"+this._uid);o&&o.classList&&o.classList.remove("GPlocationHighlight")}}_onResultsFeatureSelect(e){var i=this.getMap();if(e.selected.length!==0){var s=e.selected[0];this._popupContent.innerHTML=s.getProperties().popupContent,this._popupOverlay?this._popupOverlay.setPosition(e.mapBrowserEvent.coordinate):(this._popupOverlay=new Overlay({element:this._popupDiv,positioning:"bottom-center",position:e.mapBrowserEvent.coordinate}),i.addOverlay(this._popupOverlay)),this.dispatchEvent({type:"reversegeocode:onclickresult",location:s.getProperties().location})}else this._popupOverlay!=null&&this._popupOverlay.setPosition(void 0)}onShowReverseGeocodingClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen();var i=this.getMap();if(i){Interactions.unset(i);var s=this._showReverseGeocodingButton.ariaPressed;this.collapsed=s!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position),!this._waiting&&!this._reverseGeocodingLocations.length&&(this.collapsed?(this._clearResults(),this._clearInputFeatures(),this._removeMapInteraction(i),this._inputFeaturesLayer!=null&&(i.removeLayer(this._inputFeaturesLayer),this._inputFeaturesLayer=null,this._inputFeaturesSources=null,this._inputFeatures=null)):this._activateMapInteraction(i))}}onReverseGeocodingTypeChange(e){var i=e.target.selectedIndex,s=e.target.options[i].value;s&&(logger$m.log(s),this._currentGeocodingType=s)}onReverseGeocodingDelimitationChange(e){var i=e.target.selectedIndex,s=e.target.options[i].value;if(s){logger$m.log(s),this._currentGeocodingDelimitation=s;var o=this.getMap();this._clearInputFeatures(),this._removeMapInteraction(o),this._activateMapInteraction(o)}}onGPreverseGeocodingReturnPictoClick(){this._clearResults(),this._clearInputFeatures(),this._activateMapInteraction(this.getMap())}onReverseGeocodingSubmit(){if(!this._requestPosition){logger$m.log("missing position");return}this._reverseGeocodingRequest()}onReverseGeocodingResultClick(e){var i=e.target.id,s=i.substring(i.indexOf("_")+1),o=this._resultsFeaturesSource.getFeatureById(parseInt(s,10));this.dispatchEvent({type:"reversegeocode:onclickresult",location:o.getProperties().location})}onReverseGeocodingResultMouseOver(e){var i=e.target.id,s=i.substring(i.indexOf("_")+1);if(e.target.classList&&e.target.classList.add("GPlocationHighlight"),!!this._resultsFeaturesSource){var o=this._resultsFeaturesSource.getFeatureById(parseInt(s,10));o.setStyle(this._resultsSelectedStyle)}}onReverseGeocodingResultMouseOut(e){var i=e.target.id,s=i.substring(i.indexOf("_")+1);if(e.target.classList&&e.target.classList.remove("GPlocationHighlight"),!!this._resultsFeaturesSource){var o=this._resultsFeaturesSource.getFeatureById(parseInt(s,10));o.setStyle(this._resultsDefaultStyle)}}onReverseGeocodingResultCopyButtonClick(e){navigator.clipboard.writeText(e.target.getAttribute("data-text-geolocate")).then(()=>console.log("Texte copi !")).catch(i=>console.error("Erreur de copie :",i))}_clearResults(){var e=this.getMap();if(this._reverseGeocodingLocations=[],this._resultsListContainer)for(;this._resultsListContainer.firstChild;)this._resultsListContainer.removeChild(this._resultsListContainer.firstChild);this._resultsFeaturesLayer&&(e.removeLayer(this._resultsFeaturesLayer),this._resultsFeaturesLayer=null),this._popupOverlay!=null&&(e.removeOverlay(this._popupOverlay),this._popupOverlay=null),this._resultsSelectInteraction!=null&&(e.removeInteraction(this._resultsSelectInteraction),this._resultsSelectInteraction=null),this._resultsHoverInteraction!=null&&(e.removeInteraction(this._resultsHoverInteraction),this._resultsHoverInteraction=null)}_clearInputFeatures(){this._inputFeatures&&this._inputFeatures.clear(),this._requestGeom=null,this._requestPosition=null}_displayWaitingContainer(){this._waitingContainer.className="GPwaitingContainer GPwaitingContainerVisible gpf-waiting gpf-waiting--visible",this._waiting=!0,this._timer&&(clearTimeout(this._timer),this._timer=null);var e=this;this._timer=setTimeout(function(){e._waiting===!0?e._hideWaitingContainer():e._timer&&clearTimeout(e._timer)},16e3)}_hideWaitingContainer(){this._waiting&&(this._waitingContainer.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden",this._waiting=!1,clearTimeout(this._timer),this._timer=null)}}Object.assign(ReverseGeocode.prototype,ReverseGeocodeDOM);Object.assign(ReverseGeocode.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.ReverseGeocode=ReverseGeocode);class XML{read(e){if(!e)return null;if(typeof e=="string"){const i=parse$1(e);return this.readFromDocument(i)}return isDocument(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let i=e.firstChild;i;i=i.nextSibling)if(i.nodeType==Node.ELEMENT_NODE)return this.readFromNode(i);return null}readFromNode(e){abstract()}}const NAMESPACE_URI="http://www.w3.org/1999/xlink";function readHref(n){return n.getAttributeNS(NAMESPACE_URI,"href")}const NAMESPACE_URIS$2=[null,"http://www.opengis.net/wms","http://www.opengis.net/sld"];function isV13(n){return compareVersions(n[0].version,"1.3")>=0}const PARSERS$2=makeStructureNS(NAMESPACE_URIS$2,{Service:makeObjectPropertySetter(readService),Capability:makeObjectPropertySetter(readCapability)}),CAPABILITY_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{Request:makeObjectPropertySetter(readRequest),Exception:makeObjectPropertySetter(readException),Layer:makeObjectPropertySetter(readCapabilityLayer),UserDefinedSymbolization:makeObjectPropertySetter(readUserDefinedSymbolization)});class WMSCapabilities extends XML{constructor(){super(),this.version=void 0}readFromNode(e){this.version=e.getAttribute("version").trim();const i=pushParseAndPop({version:this.version},PARSERS$2,e,[]);return i||null}}const COMMON_SERVICE_PARSERS={Name:makeObjectPropertySetter(readString),Title:makeObjectPropertySetter(readString),Abstract:makeObjectPropertySetter(readString),KeywordList:makeObjectPropertySetter(readKeywordList),OnlineResource:makeObjectPropertySetter(readHref),ContactInformation:makeObjectPropertySetter(readContactInformation),Fees:makeObjectPropertySetter(readString),AccessConstraints:makeObjectPropertySetter(readString)},SERVICE_PARSERS=makeStructureNS(NAMESPACE_URIS$2,COMMON_SERVICE_PARSERS),SERVICE_PARSERS_V13=makeStructureNS(NAMESPACE_URIS$2,{...COMMON_SERVICE_PARSERS,LayerLimit:makeObjectPropertySetter(readPositiveInteger),MaxWidth:makeObjectPropertySetter(readPositiveInteger),MaxHeight:makeObjectPropertySetter(readPositiveInteger)}),CONTACT_INFORMATION_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{ContactPersonPrimary:makeObjectPropertySetter(readContactPersonPrimary),ContactPosition:makeObjectPropertySetter(readString),ContactAddress:makeObjectPropertySetter(readContactAddress),ContactVoiceTelephone:makeObjectPropertySetter(readString),ContactFacsimileTelephone:makeObjectPropertySetter(readString),ContactElectronicMailAddress:makeObjectPropertySetter(readString)}),CONTACT_PERSON_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{ContactPerson:makeObjectPropertySetter(readString),ContactOrganization:makeObjectPropertySetter(readString)}),CONTACT_ADDRESS_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{AddressType:makeObjectPropertySetter(readString),Address:makeObjectPropertySetter(readString),City:makeObjectPropertySetter(readString),StateOrProvince:makeObjectPropertySetter(readString),PostCode:makeObjectPropertySetter(readString),Country:makeObjectPropertySetter(readString)}),EXCEPTION_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{Format:makeArrayPusher(readString)}),COMMON_LAYER_PARSERS={Name:makeObjectPropertySetter(readString),Title:makeObjectPropertySetter(readString),Abstract:makeObjectPropertySetter(readString),KeywordList:makeObjectPropertySetter(readKeywordList),BoundingBox:makeObjectPropertyPusher(readBoundingBox$1),Dimension:makeObjectPropertyPusher(readDimension),Attribution:makeObjectPropertySetter(readAttribution),AuthorityURL:makeObjectPropertyPusher(readAuthorityURL),Identifier:makeObjectPropertyPusher(readString),MetadataURL:makeObjectPropertyPusher(readMetadataURL),DataURL:makeObjectPropertyPusher(readFormatOnlineresource),FeatureListURL:makeObjectPropertyPusher(readFormatOnlineresource),Style:makeObjectPropertyPusher(readStyle$1),Layer:makeObjectPropertyPusher(readLayer$1)},LAYER_PARSERS$1=makeStructureNS(NAMESPACE_URIS$2,{...COMMON_LAYER_PARSERS,SRS:makeObjectPropertyPusher(readString),Extent:makeObjectPropertySetter(readExtent),ScaleHint:makeObjectPropertyPusher(readScaleHint),LatLonBoundingBox:makeObjectPropertySetter((n,e)=>readBoundingBox$1(n,e,!1)),Layer:makeObjectPropertyPusher(readLayer$1)}),LAYER_PARSERS_V13=makeStructureNS(NAMESPACE_URIS$2,{...COMMON_LAYER_PARSERS,CRS:makeObjectPropertyPusher(readString),EX_GeographicBoundingBox:makeObjectPropertySetter(readEXGeographicBoundingBox),MinScaleDenominator:makeObjectPropertySetter(readDecimal),MaxScaleDenominator:makeObjectPropertySetter(readDecimal),Layer:makeObjectPropertyPusher(readLayer$1)}),ATTRIBUTION_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{Title:makeObjectPropertySetter(readString),OnlineResource:makeObjectPropertySetter(readHref),LogoURL:makeObjectPropertySetter(readSizedFormatOnlineresource)}),EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{westBoundLongitude:makeObjectPropertySetter(readDecimal),eastBoundLongitude:makeObjectPropertySetter(readDecimal),southBoundLatitude:makeObjectPropertySetter(readDecimal),northBoundLatitude:makeObjectPropertySetter(readDecimal)}),REQUEST_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{GetCapabilities:makeObjectPropertySetter(readOperationType),GetMap:makeObjectPropertySetter(readOperationType),GetFeatureInfo:makeObjectPropertySetter(readOperationType),DescribeLayer:makeObjectPropertySetter(readOperationType),GetLegendGraphic:makeObjectPropertySetter(readOperationType)}),OPERATIONTYPE_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{Format:makeObjectPropertyPusher(readString),DCPType:makeObjectPropertyPusher(readDCPType)}),DCPTYPE_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{HTTP:makeObjectPropertySetter(readHTTP)}),HTTP_PARSERS$1=makeStructureNS(NAMESPACE_URIS$2,{Get:makeObjectPropertySetter(readFormatOnlineresource),Post:makeObjectPropertySetter(readFormatOnlineresource)}),STYLE_PARSERS$1=makeStructureNS(NAMESPACE_URIS$2,{Name:makeObjectPropertySetter(readString),Title:makeObjectPropertySetter(readString),Abstract:makeObjectPropertySetter(readString),LegendURL:makeObjectPropertyPusher(readSizedFormatOnlineresource),StyleSheetURL:makeObjectPropertySetter(readFormatOnlineresource),StyleURL:makeObjectPropertySetter(readFormatOnlineresource)}),FORMAT_ONLINERESOURCE_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{Format:makeObjectPropertySetter(readString),OnlineResource:makeObjectPropertySetter(readHref)}),KEYWORDLIST_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{Keyword:makeArrayPusher(readString)});function readAttribution(n,e){return pushParseAndPop({},ATTRIBUTION_PARSERS,n,e)}function readUserDefinedSymbolization(n,e){return{SupportSLD:!!readBooleanString(n.getAttribute("SupportSLD")),UserLayer:!!readBooleanString(n.getAttribute("UserLayer")),UserStyle:!!readBooleanString(n.getAttribute("UserStyle")),RemoteWFS:!!readBooleanString(n.getAttribute("RemoteWFS")),InlineFeatureData:!!readBooleanString(n.getAttribute("InlineFeatureData")),RemoteWCS:!!readBooleanString(n.getAttribute("RemoteWCS"))}}function readBoundingBox$1(n,e,i=!0){const s=[readDecimalString(n.getAttribute("minx")),readDecimalString(n.getAttribute("miny")),readDecimalString(n.getAttribute("maxx")),readDecimalString(n.getAttribute("maxy"))],o=[readDecimalString(n.getAttribute("resx")),readDecimalString(n.getAttribute("resy"))],l={extent:s,res:o};return i&&(isV13(e)?l.crs=n.getAttribute("CRS"):l.srs=n.getAttribute("SRS")),l}function readEXGeographicBoundingBox(n,e){const i=pushParseAndPop({},EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS,n,e);if(!i)return;const s=i.westBoundLongitude,o=i.southBoundLatitude,l=i.eastBoundLongitude,c=i.northBoundLatitude;if(!(s===void 0||o===void 0||l===void 0||c===void 0))return[s,o,l,c]}function readCapability(n,e){return pushParseAndPop({},CAPABILITY_PARSERS,n,e)}function readService(n,e){return pushParseAndPop({},isV13(e)?SERVICE_PARSERS_V13:SERVICE_PARSERS,n,e)}function readContactInformation(n,e){return pushParseAndPop({},CONTACT_INFORMATION_PARSERS,n,e)}function readContactPersonPrimary(n,e){return pushParseAndPop({},CONTACT_PERSON_PARSERS,n,e)}function readContactAddress(n,e){return pushParseAndPop({},CONTACT_ADDRESS_PARSERS,n,e)}function readException(n,e){return pushParseAndPop([],EXCEPTION_PARSERS,n,e)}function readCapabilityLayer(n,e){const i=pushParseAndPop({},isV13(e)?LAYER_PARSERS_V13:LAYER_PARSERS$1,n,e);return i.Layer===void 0?Object.assign(i,readLayer$1(n,e)):i}function readLayer$1(n,e){const i=isV13(e),s=e[e.length-1],o=pushParseAndPop({},i?LAYER_PARSERS_V13:LAYER_PARSERS$1,n,e);if(!o)return;let l=readBooleanString(n.getAttribute("queryable"));l===void 0&&(l=s.queryable),o.queryable=l!==void 0?l:!1;let c=readNonNegativeIntegerString(n.getAttribute("cascaded"));c===void 0&&(c=s.cascaded),o.cascaded=c;let u=readBooleanString(n.getAttribute("opaque"));u===void 0&&(u=s.opaque),o.opaque=u!==void 0?u:!1;let f=readBooleanString(n.getAttribute("noSubsets"));f===void 0&&(f=s.noSubsets),o.noSubsets=f!==void 0?f:!1;let g=readDecimalString(n.getAttribute("fixedWidth"));g||(g=s.fixedWidth),o.fixedWidth=g;let H=readDecimalString(n.getAttribute("fixedHeight"));H||(H=s.fixedHeight),o.fixedHeight=H;const Y=["Style","AuthorityURL"];i?Y.push("CRS"):Y.push("SRS","Dimension"),Y.forEach(function(te){if(te in s){const ne=o[te]||[];o[te]=ne.concat(s[te])}});const ee=["BoundingBox","Attribution"];return i?ee.push("Dimension","EX_GeographicBoundingBox","MinScaleDenominator","MaxScaleDenominator"):ee.push("LatLonBoundingBox","ScaleHint","Extent"),ee.forEach(function(te){if(!(te in o)){const ne=s[te];o[te]=ne}}),o}function readDimension(n,e){const i={name:n.getAttribute("name"),units:n.getAttribute("units"),unitSymbol:n.getAttribute("unitSymbol")};return isV13(e)&&Object.assign(i,{default:n.getAttribute("default"),multipleValues:readBooleanString(n.getAttribute("multipleValues")),nearestValue:readBooleanString(n.getAttribute("nearestValue")),current:readBooleanString(n.getAttribute("current")),values:readString(n)}),i}function readExtent(n,e){return{name:n.getAttribute("name"),default:n.getAttribute("default"),nearestValue:readBooleanString(n.getAttribute("nearestValue"))}}function readScaleHint(n,e){return{min:readDecimalString(n.getAttribute("min")),max:readDecimalString(n.getAttribute("max"))}}function readFormatOnlineresource(n,e){return pushParseAndPop({},FORMAT_ONLINERESOURCE_PARSERS,n,e)}function readRequest(n,e){return pushParseAndPop({},REQUEST_PARSERS,n,e)}function readDCPType(n,e){return pushParseAndPop({},DCPTYPE_PARSERS,n,e)}function readHTTP(n,e){return pushParseAndPop({},HTTP_PARSERS$1,n,e)}function readOperationType(n,e){return pushParseAndPop({},OPERATIONTYPE_PARSERS,n,e)}function readSizedFormatOnlineresource(n,e){const i=readFormatOnlineresource(n,e);if(i){const s=[readNonNegativeIntegerString(n.getAttribute("width")),readNonNegativeIntegerString(n.getAttribute("height"))];return i.size=s,i}}function readAuthorityURL(n,e){const i=readFormatOnlineresource(n,e);if(i)return i.name=n.getAttribute("name"),i}function readMetadataURL(n,e){const i=readFormatOnlineresource(n,e);if(i)return i.type=n.getAttribute("type"),i}function readStyle$1(n,e){return pushParseAndPop({},STYLE_PARSERS$1,n,e)}function readKeywordList(n,e){return pushParseAndPop([],KEYWORDLIST_PARSERS,n,e)}const NAMESPACE_URIS$1=[null,"http://www.opengis.net/ows/1.1"],PARSERS$1=makeStructureNS(NAMESPACE_URIS$1,{ServiceIdentification:makeObjectPropertySetter(readServiceIdentification),ServiceProvider:makeObjectPropertySetter(readServiceProvider),OperationsMetadata:makeObjectPropertySetter(readOperationsMetadata)});class OWS extends XML{constructor(){super()}readFromNode(e){const i=pushParseAndPop({},PARSERS$1,e,[]);return i||null}}const ADDRESS_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{DeliveryPoint:makeObjectPropertySetter(readString),City:makeObjectPropertySetter(readString),AdministrativeArea:makeObjectPropertySetter(readString),PostalCode:makeObjectPropertySetter(readString),Country:makeObjectPropertySetter(readString),ElectronicMailAddress:makeObjectPropertySetter(readString)}),ALLOWED_VALUES_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Value:makeObjectPropertyPusher(readValue)}),CONSTRAINT_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{AllowedValues:makeObjectPropertySetter(readAllowedValues)}),CONTACT_INFO_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Phone:makeObjectPropertySetter(readPhone),Address:makeObjectPropertySetter(readAddress)}),DCP_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{HTTP:makeObjectPropertySetter(readHttp)}),HTTP_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Get:makeObjectPropertyPusher(readGet),Post:void 0}),OPERATION_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{DCP:makeObjectPropertySetter(readDcp)}),OPERATIONS_METADATA_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Operation:readOperation}),PHONE_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Voice:makeObjectPropertySetter(readString),Facsimile:makeObjectPropertySetter(readString)}),REQUEST_METHOD_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Constraint:makeObjectPropertyPusher(readConstraint)}),SERVICE_CONTACT_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{IndividualName:makeObjectPropertySetter(readString),PositionName:makeObjectPropertySetter(readString),ContactInfo:makeObjectPropertySetter(readContactInfo)}),SERVICE_IDENTIFICATION_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Abstract:makeObjectPropertySetter(readString),AccessConstraints:makeObjectPropertySetter(readString),Fees:makeObjectPropertySetter(readString),Title:makeObjectPropertySetter(readString),ServiceTypeVersion:makeObjectPropertySetter(readString),ServiceType:makeObjectPropertySetter(readString)}),SERVICE_PROVIDER_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{ProviderName:makeObjectPropertySetter(readString),ProviderSite:makeObjectPropertySetter(readHref),ServiceContact:makeObjectPropertySetter(readServiceContact)});function readAddress(n,e){return pushParseAndPop({},ADDRESS_PARSERS,n,e)}function readAllowedValues(n,e){return pushParseAndPop({},ALLOWED_VALUES_PARSERS,n,e)}function readConstraint(n,e){const i=n.getAttribute("name");if(i)return pushParseAndPop({name:i},CONSTRAINT_PARSERS,n,e)}function readContactInfo(n,e){return pushParseAndPop({},CONTACT_INFO_PARSERS,n,e)}function readDcp(n,e){return pushParseAndPop({},DCP_PARSERS,n,e)}function readGet(n,e){const i=readHref(n);if(i)return pushParseAndPop({href:i},REQUEST_METHOD_PARSERS,n,e)}function readHttp(n,e){return pushParseAndPop({},HTTP_PARSERS,n,e)}function readOperation(n,e){const i=n.getAttribute("name"),s=pushParseAndPop({},OPERATION_PARSERS,n,e);if(!s)return;const o=e[e.length-1];o[i]=s}function readOperationsMetadata(n,e){return pushParseAndPop({},OPERATIONS_METADATA_PARSERS,n,e)}function readPhone(n,e){return pushParseAndPop({},PHONE_PARSERS,n,e)}function readServiceIdentification(n,e){return pushParseAndPop({},SERVICE_IDENTIFICATION_PARSERS,n,e)}function readServiceContact(n,e){return pushParseAndPop({},SERVICE_CONTACT_PARSERS,n,e)}function readServiceProvider(n,e){return pushParseAndPop({},SERVICE_PROVIDER_PARSERS,n,e)}function readValue(n,e){return readString(n)}const NAMESPACE_URIS=[null,"http://www.opengis.net/wmts/1.0"],OWS_NAMESPACE_URIS=[null,"http://www.opengis.net/ows/1.1"],PARSERS=makeStructureNS(NAMESPACE_URIS,{Contents:makeObjectPropertySetter(readContents)});class WMTSCapabilities extends XML{constructor(){super(),this.owsParser_=new OWS}readFromNode(e){let i=e.getAttribute("version");i&&(i=i.trim());let s=this.owsParser_.readFromNode(e);return s?(s.version=i,s=pushParseAndPop(s,PARSERS,e,[]),s||null):null}}const CONTENTS_PARSERS=makeStructureNS(NAMESPACE_URIS,{Layer:makeObjectPropertyPusher(readLayer),TileMatrixSet:makeObjectPropertyPusher(readTileMatrixSet)}),LAYER_PARSERS=makeStructureNS(NAMESPACE_URIS,{Style:makeObjectPropertyPusher(readStyle),Format:makeObjectPropertyPusher(readString),TileMatrixSetLink:makeObjectPropertyPusher(readTileMatrixSetLink),Dimension:makeObjectPropertyPusher(readDimensions),ResourceURL:makeObjectPropertyPusher(readResourceUrl)},makeStructureNS(OWS_NAMESPACE_URIS,{Title:makeObjectPropertySetter(readString),Abstract:makeObjectPropertySetter(readString),WGS84BoundingBox:makeObjectPropertySetter(readBoundingBox),BoundingBox:makeObjectPropertyPusher(readBoundingBoxWithCrs),Identifier:makeObjectPropertySetter(readString)})),STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{LegendURL:makeObjectPropertyPusher(readLegendUrl)},makeStructureNS(OWS_NAMESPACE_URIS,{Title:makeObjectPropertySetter(readString),Identifier:makeObjectPropertySetter(readString)})),TMS_LINKS_PARSERS=makeStructureNS(NAMESPACE_URIS,{TileMatrixSet:makeObjectPropertySetter(readString),TileMatrixSetLimits:makeObjectPropertySetter(readTileMatrixLimitsList)}),TMS_LIMITS_LIST_PARSERS=makeStructureNS(NAMESPACE_URIS,{TileMatrixLimits:makeArrayPusher(readTileMatrixLimits)}),TMS_LIMITS_PARSERS=makeStructureNS(NAMESPACE_URIS,{TileMatrix:makeObjectPropertySetter(readString),MinTileRow:makeObjectPropertySetter(readPositiveInteger),MaxTileRow:makeObjectPropertySetter(readPositiveInteger),MinTileCol:makeObjectPropertySetter(readPositiveInteger),MaxTileCol:makeObjectPropertySetter(readPositiveInteger)}),DIMENSION_PARSERS=makeStructureNS(NAMESPACE_URIS,{Default:makeObjectPropertySetter(readString),Value:makeObjectPropertyPusher(readString)},makeStructureNS(OWS_NAMESPACE_URIS,{Identifier:makeObjectPropertySetter(readString)})),WGS84_BBOX_READERS=makeStructureNS(OWS_NAMESPACE_URIS,{LowerCorner:makeArrayPusher(readCoordinates),UpperCorner:makeArrayPusher(readCoordinates)}),TMS_PARSERS=makeStructureNS(NAMESPACE_URIS,{WellKnownScaleSet:makeObjectPropertySetter(readString),TileMatrix:makeObjectPropertyPusher(readTileMatrix)},makeStructureNS(OWS_NAMESPACE_URIS,{SupportedCRS:makeObjectPropertySetter(readString),Identifier:makeObjectPropertySetter(readString),BoundingBox:makeObjectPropertySetter(readBoundingBox)})),TM_PARSERS=makeStructureNS(NAMESPACE_URIS,{TopLeftCorner:makeObjectPropertySetter(readCoordinates),ScaleDenominator:makeObjectPropertySetter(readDecimal),TileWidth:makeObjectPropertySetter(readPositiveInteger),TileHeight:makeObjectPropertySetter(readPositiveInteger),MatrixWidth:makeObjectPropertySetter(readPositiveInteger),MatrixHeight:makeObjectPropertySetter(readPositiveInteger)},makeStructureNS(OWS_NAMESPACE_URIS,{Identifier:makeObjectPropertySetter(readString)}));function readContents(n,e){return pushParseAndPop({},CONTENTS_PARSERS,n,e)}function readLayer(n,e){return pushParseAndPop({},LAYER_PARSERS,n,e)}function readTileMatrixSet(n,e){return pushParseAndPop({},TMS_PARSERS,n,e)}function readStyle(n,e){const i=pushParseAndPop({},STYLE_PARSERS,n,e);if(!i)return;const s=n.getAttribute("isDefault")==="true";return i.isDefault=s,i}function readTileMatrixSetLink(n,e){return pushParseAndPop({},TMS_LINKS_PARSERS,n,e)}function readDimensions(n,e){return pushParseAndPop({},DIMENSION_PARSERS,n,e)}function readResourceUrl(n,e){const i=n.getAttribute("format"),s=n.getAttribute("template"),o=n.getAttribute("resourceType"),l={};return i&&(l.format=i),s&&(l.template=s),o&&(l.resourceType=o),l}function readBoundingBox(n,e){const i=pushParseAndPop([],WGS84_BBOX_READERS,n,e);if(i.length==2)return boundingExtent(i)}function readBoundingBoxWithCrs(n,e){const i=n.getAttribute("crs"),s=pushParseAndPop([],WGS84_BBOX_READERS,n,e);if(s.length==2)return{extent:boundingExtent(s),crs:i}}function readLegendUrl(n,e){const i={};return i.format=n.getAttribute("format"),i.href=readHref(n),i}function readCoordinates(n,e){const i=readString(n).split(/\s+/);if(!i||i.length!=2)return;const s=+i[0],o=+i[1];if(!(isNaN(s)||isNaN(o)))return[s,o]}function readTileMatrix(n,e){return pushParseAndPop({},TM_PARSERS,n,e)}function readTileMatrixLimitsList(n,e){return pushParseAndPop([],TMS_LIMITS_LIST_PARSERS,n,e)}function readTileMatrixLimits(n,e){return pushParseAndPop({},TMS_LIMITS_PARSERS,n,e)}var eventbus_min$1={exports:{}},eventbus_min=eventbus_min$1.exports,hasRequiredEventbus_min;function requireEventbus_min(){return hasRequiredEventbus_min||(hasRequiredEventbus_min=1,(function(n,e){(function(i,s){n.exports=s()})(eventbus_min,function(){var i={};i=function(){this.listeners={}},i.prototype={addEventListener:function(o,l,c){for(var u=[],f=arguments.length,g=0;g<f;g++)u.push(arguments[g]);u=u.length>3?u.splice(3,u.length-1):[],typeof this.listeners[o]<"u"?this.listeners[o].push({scope:c,callback:l,args:u}):this.listeners[o]=[{scope:c,callback:l,args:u}]},removeEventListener:function(o,l,c){if(typeof this.listeners[o]<"u"){for(var u=this.listeners[o].length,f=[],g=0;g<u;g++){var H=this.listeners[o][g];H.scope==c&&H.callback==l||f.push(H)}this.listeners[o]=f}},hasEventListener:function(o,l,c){if(typeof this.listeners[o]<"u"){var u=this.listeners[o].length;if(l===void 0&&c===void 0)return u>0;for(var f=0;f<u;f++){var g=this.listeners[o][f];if((!c||g.scope==c)&&g.callback==l)return!0}}return!1},dispatch:function(o,l){for(var c={type:o,target:l},u=[],f=arguments.length,g=0;g<f;g++)u.push(arguments[g]);if(u=u.length>2?u.splice(2,u.length-1):[],u=[c].concat(u),typeof this.listeners[o]<"u")for(var H=this.listeners[o].slice(),Y=H.length,g=0;g<Y;g++){var ee=H[g];if(ee&&ee.callback){var te=u.concat(ee.args);ee.callback.apply(ee.scope,te)}}},getEvents:function(){var o="";for(var l in this.listeners)for(var c=this.listeners[l].length,u=0;u<c;u++){var f=this.listeners[l][u];o+=f.scope&&f.scope.className?f.scope.className:"anonymous",o+=" listen for '"+l+`'
`}return o}};var s=new i;return s})})(eventbus_min$1)),eventbus_min$1.exports}var eventbus_minExports=requireEventbus_min();const EventBus=getDefaultExportFromCjs$1(eventbus_minExports);var EventEditor={onloaded:"editor:onloaded",layer:{onclickvisibility:"editor:layer:onclickvisibility",onclickclone:"editor:layer:onclickclone",onclickremove:"editor:layer:onclickremove"},legend:{onclickedition:"editor:legend:onclickedition",onchangevalue:"editor:legend:onchangevalue"},group:{oncollapse:"editor:group:oncollapse"},style:{oneditjson:"editor:style:oneditjson",scale:{onchangemin:"editor:style:scale:onchangemin",onchangemax:"editor:style:scale:onchangemax"}},filter:{oneditjson:"editor:filter:oneditjson"},themes:{onclickimage:"editor:themes:onclickimage",onclicktitle:"editor:themes:onclicktitle"},search:{onsubmit:"editor:search:onsubmit",onautocomplete:"editor:search:onautocomplete"}},logger$l=LoggerByDefault.getLogger("editor-style");class Style{constructor(e){if(logger$l.trace("[constructor] Style",e),this.options=e||{target:null,position:0,tools:null,title:null,obj:null},!(this instanceof Style))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this._initialize(),this._initContainer()}_initialize(){this.id=this.options.id||null,this.options.target,this.options.position||(this.options.position=0);var e={scale:!0,edition:!1};this.options.tools||(this.options.tools=e),Helper.mergeParams(this.options.tools,e,!1),this.options.obj||(this.options.obj={paint:{},layout:{}}),this.options.title||(this.options.title="JSON Styles :"),this.container=null,this.name={target:"GPEditorMapBoxStyleTarget",container:"GPEditorMapBoxStyleContainer",containerjson:"GPEditorMapBoxStyleJsonContainer",jsonlabel:"GPEditorMapBoxStyleJsonTitle",jsondisplay:"GPEditorMapBoxStyleJsonDisplay",containertoolsscale:"GPEditorMapBoxStyleToolsScaleContainer",scaletitle:"GPEditorMapBoxStyleScaleTitle",containertoolsminscale:"GPEditorMapBoxStyleToolsScaleMinContainer",scalelabelmin:"GPEditorMapBoxStyleScaleLabelMin",scaleinputmin:"GPEditorMapBoxStyleScaleInputMin",containertoolsmaxscale:"GPEditorMapBoxStyleToolsScaleMaxContainer",scalelabelmax:"GPEditorMapBoxStyleScaleLabelMax",scaleinputmax:"GPEditorMapBoxStyleScaleInputMax",containertoolsedit:"GPEditorMapBoxStyleToolsEditionContainer"}}_initContainer(){var e=this,i=!1,s=JSON.parse(JSON.stringify(this.options.obj)),o={};s.paint&&(i=!0,o.paint=s.paint,Object.keys(s.paint).length===0&&logger$l.info("tag 'paint' is empty !")),s.layout&&(i=!0,o.layout=s.layout,s.layout.visibility&&delete o.visibility,Object.keys(s.layout).length===0&&logger$l.info("tag 'layout' is empty !"));var l=document.createElement("div");l.className=this.name.container;var c=null;if(i){var u=JSON.stringify(o,null,4);c=this._syntaxHighlight(u)}var f=document.createElement("div");f.className=this.name.containerjson;var g=document.createElement("label");g.className=this.name.jsonlabel,g.innerHTML=this.options.title,f.appendChild(g);var H=document.createElement("pre");H.className=this.name.jsondisplay,H.innerHTML=c,H.addEventListener?H.addEventListener("click",function(Y){e.options.tools.edition&&e.onEditJsonStyleMapBox(Y)}):H.attachEvent&&H.attachEvent("onclick",function(Y){e.options.tools.edition&&e.onEditJsonStyleMapBox(Y)}),f.appendChild(H),l.appendChild(f),this.options.tools.scale&&l.appendChild(this._createElementToolsScale({min:o.layout?o.layout.minzoom:0,max:o.layout?o.layout.maxzoom:21})),this.options.tools.edition&&l.appendChild(this._createElementToolsEdition()),this.container=l}_createElementToolsScale(e){logger$l.trace("_createElementToolsScale");var i=this,s=this.options.obj,o=document.createElement("div");o.className=this.name.containertoolsscale;var l=document.createElement("div");l.className=this.name.containertoolsminscale;var c=document.createElement("label");c.className=this.name.scalelabelmin,c.innerHTML="min :",l.appendChild(c);var u=document.createElement("input");u.className=this.name.scaleinputmin,u.type="range",u.value=e.min||0,u.title=e.min||0,u.disabled=!1,u.min=0,u.max=21,u.data=s,u.addEventListener?u.addEventListener("change",function(Y){i.onChangeStyleScaleMinMapBox(Y)}):u.appendChild&&u.appendChild("onchange",function(Y){i.onChangeStyleScaleMinMapBox(Y)}),l.appendChild(u),o.appendChild(l);var f=document.createElement("div");f.className=this.name.containertoolsmaxscale;var g=document.createElement("label");g.className=this.name.scalelabelmax,g.innerHTML="max :",f.appendChild(g);var H=document.createElement("input");return H.className=this.name.scaleinputmin,H.type="range",H.value=e.max||21,H.title=e.max||21,H.disabled=!1,H.min=0,H.max=21,H.data=s,H.addEventListener?H.addEventListener("change",function(Y){i.onChangeStyleScaleMaxMapBox(Y)}):H.appendChild&&H.appendChild("onchange",function(Y){i.onChangeStyleScaleMaxMapBox(Y)}),f.appendChild(H),o.appendChild(f),o}_createElementToolsEdition(){logger$l.warn("_createElementToolsEdition, it's not yet implemented !");var e=document.createElement("div");return e.className=this.name.containertoolsedit,e}_syntaxHighlight(e){return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?)/g,function(i){var s="gp-json-number";return/^"/.test(i)?/:$/.test(i)?s="gp-json-key":s="gp-json-string":/true|false/.test(i)?s="gp-json-boolean":/null/.test(i)&&(s="gp-json-null"),"<span class='"+s+"'>"+i+"</span>"})}add(){if(!this.options.target){if(!document.getElementById(this.name.target)){var e=document.createElement("div");e.id=this.name.target;var i=document.documentElement||document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0];i.appendChild(e)}this.options.target=document.getElementById(this.name.target)}return this.container&&this.options.target.appendChild(this.container),this}display(e){return logger$l.trace("display()",e),typeof e<"u"&&(this.container.style.display=e?"flex":"none"),this.container.style.display==="flex"}getContainer(){return this.container}onEditJsonStyleMapBox(e){logger$l.trace("onEditJsonStyleMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.style.oneditjson,e)}onChangeStyleScaleMinMapBox(e){logger$l.trace("onChangeStyleScaleMinMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.style.scale.onchangemin,e)}onChangeStyleScaleMaxMapBox(e){logger$l.trace("onChangeStyleScaleMaxMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.style.scale.onchangemax,e)}}window.ol&&window.ol.style&&(window.ol.style.editor||(window.ol.style.editor={}),window.ol.style.editor.Style=Style);var logger$k=LoggerByDefault.getLogger("editor-themes");class Themes{constructor(e){if(logger$k.trace("[constructor] Themes",e),this.options=e||{},!(this instanceof Themes))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this._initialize(),this._initContainer()}_initialize(){this.id=this.options.id||null,this.options.target;var e={thumbnails:!0,button:{visible:!0,type:"radio"}};(!this.options.tools||Object.keys(this.options.tools).length===0)&&(this.options.tools=e),Helper.mergeParams(this.options.tools,e,!1),(typeof this.options.obj>"u"||this.options.obj===null||!this.options.obj)&&(this.options.obj={themesSummary:"",themes:[]}),this.container=null,this.name={target:"GPEditorMapBoxThemeTarget",container:"GPEditorMapBoxThemesContainer",containertheme:"GPEditorMapBoxThemeContainer",containerthemeID:"GPEditorMapBoxThemeContainer_ID_",input:"GPEditorMapBoxThemeInput",inputID:"GPEditorMapBoxThemeInput_ID_",label:"GPEditorMapBoxThemeTitle",labelID:"GPEditorMapBoxThemeTitle_ID_",image:"GPEditorMapBoxThemeImage",imageID:"GPEditorMapBoxThemeImage_ID_",message:"GPEditorMapBoxThemeMessage"}}_initContainer(){var e=this,i=this.options.obj,s=this.id||SelectorID.generate(),o=document.createElement("div");o.className=this.name.container,o.title=i.themesSummary||"";var l=i.themes;if(l)for(var c=0;c<l.length;c++){var u=l[c],f=document.createElement("div");f.id=this.name.containerthemeID+c+"_"+s,f.className=this.name.containertheme,f.tabIndex=c;var g=u.url,H=u.selected||!1;if(g){var Y=this.options.tools.button;if(Y.visible){var ee=Y.type==="checkbox"?"checkbox":"radio",te=document.createElement("input");te.type=ee,te.id=this.name.inputID+c+"_"+s,te.className=this.name.input,te.name=s,te.checked=H,te.data=g,te.addEventListener?te.addEventListener("click",function(tt){e.onClickThemeTitleMapBox(tt)}):te.attachEvent&&te.attachEvent("onclick",function(tt){e.onClickThemeTitleMapBox(tt)}),f.appendChild(te)}if(this.options.tools.thumbnails&&u.thumbnail){var ne=document.createElement("img");ne.id=this.name.imageID+c+"_"+s,ne.className=this.name.image,ne.src=u.thumbnail,ne.alt=u.thumbnail,ne.title=u.description||"",ne.data=g,ne.addEventListener?ne.addEventListener("click",function(tt){e.onClickThemeImageMapBox(tt);var et=tt.target.parentElement.childNodes;if(et){var it=et[0];it.tagName.toLowerCase()==="input"&&(it.checked=!it.checked)}}):ne.attachEvent&&ne.attachEvent("onclick",function(tt){e.onClickThemeImageMapBox(tt);var et=tt.target.parentElement.childNodes;if(et){var it=et[0];it.tagName.toLowerCase()==="input"&&(it.checked=!it.checked)}}),f.appendChild(ne)}if(u.name){var Ye=document.createElement("label");Ye.id=this.name.labelID+c+"_"+s,this.options.tools.button.visible&&(Ye.htmlFor=te.id),Ye.className=this.name.label,Ye.innerHTML=u.name,Ye.title=u.description||"",Ye.data=g,this.options.tools.button.visible||(Ye.addEventListener?Ye.addEventListener("click",function(tt){e.onClickThemeTitleMapBox(tt)}):Ye.attachEvent&&Ye.attachEvent("onclick",function(tt){e.onClickThemeTitleMapBox(tt)})),f.appendChild(Ye)}}else{var xe=document.createElement("label");xe.className=this.name.message,xe.innerHTML="Thme non disponible...",f.appendChild(xe)}o.appendChild(f)}this.container=o}add(){if(!this.options.target){if(!document.getElementById(this.name.target)){var e=document.createElement("div");e.id=this.name.target;var i=document.documentElement||document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0];i.appendChild(e)}this.options.target=document.getElementById(this.name.target)}return this.container&&this.options.target.appendChild(this.container),this}display(e){return logger$k.trace("display()",e),typeof e<"u"&&(this.container.style.display=e?"flex":"none"),this.container.style.display==="flex"}getContainer(){return this.container}onClickThemeImageMapBox(e){if(logger$k.trace("onClickThemeImageMapBox",e),e.editorID=this.id,e.data=this.options,this.options.tools.button.type==="checkbox")for(var i=e.target.previousSibling.id.substring(e.target.previousSibling.id.lastIndexOf("_")+1),s=document.getElementsByClassName(this.name.input),o=0;o<s.length;o++){var l=s[o];if(l.id!==e.target.previousSibling.id){var c=l.id.substring(l.id.lastIndexOf("_")+1);c===i&&(l.checked=!1)}}EventBus.dispatch(EventEditor.themes.onclickimage,e)}onClickThemeTitleMapBox(e){if(logger$k.trace("onClickThemeTitleMapBox",e),e.editorID=this.id,e.data=this.options,this.options.tools.button.type==="checkbox")for(var i=e.target.id.substring(e.target.id.lastIndexOf("_")+1),s=document.getElementsByClassName(this.name.input),o=0;o<s.length;o++){var l=s[o];if(l.id!==e.target.id){var c=l.id.substring(l.id.lastIndexOf("_")+1);c===i&&(l.checked=!1)}}EventBus.dispatch(EventEditor.themes.onclicktitle,e)}}window.ol&&window.ol.style&&(window.ol.style.editor||(window.ol.style.editor={}),window.ol.style.editor.Themes=Themes);var logger$j=LoggerByDefault.getLogger("editor-filter");class Filter{constructor(e){if(logger$j.trace("[constructor] Filter",e),this.options=e||{target:null,position:0,tools:null,title:null,obj:null},!(this instanceof Filter))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this._initialize(),this._initContainer()}_initialize(){this.id=this.options.id||null,this.options.target,this.options.position||(this.options.position=0);var e={edition:!1};this.options.tools||(this.options.tools=e),Helper.mergeParams(this.options.tools,e,!1),this.options.obj||(this.options.obj={filter:[]}),this.options.title||(this.options.title="JSON Filtres :"),this.container=null,this.name={target:"GPEditorMapBoxFilterTarget",container:"GPEditorMapBoxFilterContainer",containerjson:"GPEditorMapBoxFilterJsonContainer",jsonlabel:"GPEditorMapBoxFilterTitleJson",jsondisplay:"GPEditorMapBoxFilterDisplayJson",containertoolsedit:"GPEditorMapBoxFilterToolsEditionContainer"}}_initContainer(){var e=this,i=!1,s=JSON.parse(JSON.stringify(this.options.obj));s.filter&&(i=!0,s.filter.length===0&&logger$j.info("tag 'filter' is empty !"));var o=document.createElement("div");o.className=this.name.container;var l=null;i&&(l=JSON.stringify(s.filter,null,4));var c=document.createElement("div");c.className=this.name.containerjson;var u=document.createElement("label");u.className=this.name.jsonlabel,u.innerHTML=this.options.title,c.appendChild(u);var f=document.createElement("pre");if(f.className=this.name.jsondisplay,f.innerHTML=l,f.addEventListener?f.addEventListener("click",function(H){e.options.tools.edition&&e.onEditJsonFilterMapBox(H)}):f.attachEvent&&f.attachEvent("onclick",function(H){e.options.tools.edition&&e.onEditJsonFilterMapBox(H)}),c.appendChild(f),o.appendChild(c),this.options.tools.edition){var g=document.createElement("div");g.className=this.name.containertoolsedit,o.appendChild(g)}this.container=o}add(){if(!this.options.target){if(!document.getElementById(this.name.target)){var e=document.createElement("div");e.id=this.name.target;var i=document.documentElement||document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0];i.appendChild(e)}this.options.target=document.getElementById(this.name.target)}return this.container&&this.options.target.appendChild(this.container),this}display(e){return logger$j.trace("display()",e),typeof e<"u"&&(this.container.style.display=e?"flex":"none"),this.container.style.display==="flex"}getContainer(){return this.container}onEditJsonFilterMapBox(e){logger$j.trace("onEditJsonFilterMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.filter.oneditjson,e)}}window.ol&&window.ol.style&&(window.ol.style.editor||(window.ol.style.editor={}),window.ol.style.editor.Filter=Filter);var logger$i=LoggerByDefault.getLogger("editor-legend");class Legend{constructor(e){if(logger$i.trace("[constructor] Legend",e),this.options=e||{target:null,position:0,sprites:null,obj:null},!(this instanceof Legend))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this._initialize(),this._initContainer()}_initialize(){this.id=this.options.id||null,this.options.target,this.options.position||(this.options.position=0),this.options.obj||(this.options.obj={title:"vide...",editable:!0,paint:{"fill-color":"#FFFFFF"}});var e=this.options.obj.editable;this.editable=typeof e<"u"?e:!1,this.legendRender={type:"fill",values:{width:1,stroke:"#FFFFFF",color:"#000000",opacity:1}},this.container=null,this.rendercontainer=null,this.toolscontainer=null,this.name={target:"GPEditorMapBoxLegendTarget",container:"GPEditorMapBoxLegendContainer",containerlegendrender:"GPEditorMapBoxLegendRenderContainer",legendrender:"GPEditorMapBoxLegendRender",legendeditable:"GPEditorMapBoxLegendEditable",legendtitle:"GPEditorMapBoxLegendTitle",containerlegendtools:"GPEditorMapBoxLegendToolsContainer"},this.labels={"line-color":"Couleur du trait","line-width":"Epaisseur du trait","line-opacity":"Opacit du trait","fill-color":"Couleur de remplissage","fill-opacity":"Opacit du remplissage"}}_initContainer(){var e=this.options.obj,i=document.createElement("div");i.className=this.name.container;var s=Object.assign({},e.paint,e.layout),o=Object.keys(s);if(o.length===0){logger$i.info("tag 'paint' or 'layout' is empty !");return}for(var l={},c=!1,u=0;u<o.length;u++){var f=o[u];if(/fill-/.test(f)||/line-/.test(f)||/circle-/.test(f)||/background-/.test(f)||/text-/.test(f)||/icon-/.test(f)){c=!0;var g=e.title||"",H=f.split("-")[0];(H==="text"||H==="icon")&&(H="symbol"),this.legendRender=this._getProperties(H,s),l={edit:this.editable,title:g,type:this.legendRender.type,values:this.legendRender.values},i.appendChild(this._createElementIconLegend(l));break}}c||(l={edit:this.editable,title:"",type:this.legendRender.type,values:this.legendRender.values},i.appendChild(this._createElementIconLegend(l)),logger$i.warn("legend type unknown, default legend used...")),this.toolscontainer=this._createElementEditionLegend(l),i.appendChild(this.toolscontainer),this.container=i}_getProperties(e,i){if(e==="symbol"){var s=i["text-field"],o=i["icon-image"];if(e=s&&o?"icon":s?"text":o?"icon":"unknow",e==="unknow"){logger$i.warn("type unknow !?");return}}var l={};for(const g in i)if(Object.hasOwnProperty.call(i,g)){const H=i[g];if(Legend.PROPERTIES[e].includes(g)){var c=g.replace(e,"").slice(1),u=this._getValue(H);if(u){if((c==="pattern"||c==="image")&&(!this.options.sprites||!this.options.sprites.json||!this.options.sprites.json[u])){var f=e+":"+c;logger$i.warn("sprites mandatory for key ",f);break}l[c]=u}}else logger$i.warn("property not supported : ",g)}return{type:e,values:l}}_renderThumbnail(e,i){var s=this.rendercontainer;if(!s)return!1;var o=null,l=3;switch(i.color||(i.color="#FFFFFF"),e){case"text":var c="font-size: 5em;font-weight: bold;";o=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' preserveAspectRatio='none' viewBox='0 0 100 100'><text x='50' y='50' fill='%color%' fill-opacity='%opacity%'  text-anchor='middle' dominant-baseline='central' style='%style%'> T </text></svg>")`,s.style.background=o.replace("%color%",i.color.indexOf("rgb")===0?i.color:ColorUtils.hexToRgba(i.color,1)).replace("%opacity%",i.opacity||1).replace("%style%",c);break;case"icon":if(i.image)o="<svg xmlns='http://www.w3.org/2000/svg' version='1.1' preserveAspectRatio='none' width='27px' height='27px' x='0' y='0' viewBox='%x% %y% %w% %h%'><image width='%W%px' height='%H%px' href='%URL%'/></svg>".replace("%x%",this.options.sprites.json[i.image].x).replace("%y%",this.options.sprites.json[i.image].y).replace(/%w%/g,this.options.sprites.json[i.image].width).replace(/%h%/g,this.options.sprites.json[i.image].height).replace("%W%",this.options.sprites.size.w).replace("%H%",this.options.sprites.size.h).replace("%URL%",this.options.sprites.url),s.innerHTML=o;else{var u="fill: transparent;stroke-width: 10;";o=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' preserveAspectRatio='none' viewBox='0 0 100 100'><path d='M 50,20 80,82.5 20,82.5 z' stroke='%color%' style='%style%'/></svg>")`,s.style.background=o.replace("%color%",i.color.indexOf("rgb")===0?i.color:ColorUtils.hexToRgba(i.color,1)).replace("%style%",u)}break;case"line":var f=Array.isArray(i.dasharray)?i.dasharray.join(" "):0;o=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' preserveAspectRatio='none' viewBox='0 0 100 100'><line x1='0' y1='100' x2='100' y2='0' stroke='%color%' stroke-width='%stroke-width%' stroke-opacity='%stroke-opacity%' stroke-dasharray='%stroke-dasharray%' /></svg>")`,s.style.background=o.replace("%color%",i.color.indexOf("rgb")===0?i.color:ColorUtils.hexToRgba(i.color,1)).replace("%stroke-opacity%",i.opacity||1).replace("%stroke-dasharray%",f).replace("%stroke-width%",(i.width||0)*l);break;case"circle":var g=i["stroke-color"]||"#FFFFFF";o=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' preserveAspectRatio='none' viewBox='0 0 100 100'><circle cx='50' cy='50' r='40' stroke='%stroke-color%' stroke-width='%stroke-width%' stroke-opacity='%strock-opacity%' fill='%color%' fill-opacity='%opacity%' /></svg>")`,s.style.background=o.replace("%color%",i.color.indexOf("rgb")===0?i.color:ColorUtils.hexToRgba(i.color,1)).replace("%opacity%",i.opacity||1).replace("%stroke-color%",g.indexOf("rgb")===0?g:ColorUtils.hexToRgba(g,1)).replace("%stroke-opacity%",i["stroke-opacity"]||1).replace("%stroke-width%",(i["stroke-width"]||0)*l);break;case"background":case"fill":if(i.pattern)o="<svg xmlns='http://www.w3.org/2000/svg' version='1.1' preserveAspectRatio='none' width='27px' height='27px' x='0' y='0' viewBox='%x% %y% %w% %h%'><image width='%W%px' height='%H%px' href='%URL%'/></svg>".replace("%x%",this.options.sprites.json[i.pattern].x).replace("%y%",this.options.sprites.json[i.pattern].y).replace(/%w%/g,this.options.sprites.json[i.pattern].width).replace(/%h%/g,this.options.sprites.json[i.pattern].height).replace("%W%",this.options.sprites.size.w).replace("%H%",this.options.sprites.size.h).replace("%URL%",this.options.sprites.url),s.innerHTML=o;else{var H=i["outline-color"]||"#FFFFFF";o=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' preserveAspectRatio='none' viewBox='0 0 100 100'><rect x='0' y='0' width='100' height='100' rx='5' ry='5' stroke='%stroke-color%' stroke-width='3' fill='%color%' fill-opacity='%opacity%' /></svg>")`,s.style.background=o.replace("%color%",i.color.indexOf("rgb")===0?i.color:ColorUtils.hexToRgba(i.color,1)).replace("%opacity%",i.opacity||1).replace("%stroke-color%",H.indexOf("rgb")===0?H:ColorUtils.hexToRgba(H,1))}break;default:return logger$i.warn("type not found, no thumbnail..."),!1}return!0}_getValue(e){var i=null;if(typeof e=="string")i=e;else if(typeof e=="number")i=e;else if(Array.isArray(e)){var s=!0;e.forEach(l=>{typeof l!="number"&&(s=!1)}),s&&(i=e)}else if(typeof e=="object"){if(i=null,"stops"in e){e.stops.sort((l,c)=>{var u=l[0],f=c[0];return u>f?-1:u<f?1:0});var o=e.stops.slice(-1);i=o[0][1]}}else logger$i.warn("value not supported !");return i}_createElementIconLegend(e){var i=this,s=document.createElement("div");s.className=this.name.containerlegendrender;var o=this.rendercontainer=document.createElement("div");o.className=this.name.legendrender,e.edit&&(o.className+=" ",o.className+=this.name.legendeditable,o.addEventListener?o.addEventListener("click",function(u){i.onEditionLegendMapBox(u)}):o.attachEvent&&o.attachEvent("onclick",function(u){i.onEditionLegendMapBox(u)}));var l=e.type;this._renderThumbnail(l,e.values)?o.className+=e.edit?" legend-"+l:" legend-"+l+"-not-editable":o.className+=" legend-unknow",s.appendChild(o);var c=document.createElement("span");return c.className=this.name.legendtitle,c.innerHTML=e.title||"",s.appendChild(c),s}_createElementEditionLegend(e){var i=this,s=document.createElement("div");if(s.className=this.name.containerlegendtools,!e.edit)return s;switch(e.type){case"line":o.call(i),l.call(i),c.call(i);break;case"background":case"fill":u.call(i),f.call(i);break}function o(){var g=document.createElement("div");g.className="legend-styling-div";var H=document.createElement("label");H.className="legend-line",H.htmlFor=this.id?"line-color-"+this.id:"line-color",H.innerHTML=this.labels["line-color"];var Y=document.createElement("input");Y.className="legend-styling",Y.id=this.id?"line-color-"+this.id:"line-color",Y.title="Selectionner une couleur de trait",Y.type="color",Y.value=e.values.color,Y.setAttribute("data-id","line-color"),Y.addEventListener?Y.addEventListener("change",function(ee){i._renderThumbnail(e.type,Object.assign(e.values,{color:ee.target.value})),i.onChangeValueLegendMapBox(ee)}):Y.attachEvent&&Y.attachEvent("onchange",function(ee){i._renderThumbnail(e.type,Object.assign(e.values,{color:ee.target.value})),i.onChangeValueLegendMapBox(ee)}),g.appendChild(H),g.appendChild(Y),s.appendChild(g)}function l(){var g=document.createElement("div");g.className="legend-styling-div";var H=document.createElement("label");H.className="legend-line",H.htmlFor=this.id?"line-width-"+this.id:"line-width",H.innerHTML=this.labels["line-width"];var Y=document.createElement("input");Y.className="legend-styling",Y.id=this.id?"line-width-"+this.id:"line-width",Y.title=e.values.width,Y.type="range",Y.min="0",Y.max="10",Y.step="1",Y.defaultValue=e.values.width,Y.setAttribute("data-id","line-width"),Y.addEventListener?Y.addEventListener("change",function(ee){logger$i.trace(ee),ee.target.title=ee.target.value,i._renderThumbnail(e.type,Object.assign(e.values,{width:ee.target.value})),i.onChangeValueLegendMapBox(ee)}):Y.attachEvent&&Y.attachEvent("onchange",function(ee){logger$i.trace(ee),ee.target.title=ee.target.value,i._renderThumbnail(e.type,Object.assign(e.values,{width:ee.target.value})),i.onChangeValueLegendMapBox(ee)}),g.appendChild(H),g.appendChild(Y),s.appendChild(g)}function c(){var g=document.createElement("div");g.className="legend-styling-div";var H=document.createElement("label");H.className="legend-line",H.htmlFor=this.id?"line-opacity-"+this.id:"line-opacity",H.innerHTML=this.labels["line-opacity"];var Y=document.createElement("input");Y.className="legend-styling",Y.id=this.id?"line-opacity-"+this.id:"line-opacity",Y.title=e.values.opacity,Y.type="range",Y.min="0",Y.max="1",Y.step="0.1",Y.defaultValue=e.values.opacity,Y.setAttribute("data-id","line-opacity"),Y.addEventListener?Y.addEventListener("change",function(ee){logger$i.trace(ee),ee.target.title=ee.target.value,i._renderThumbnail(e.type,Object.assign(e.values,{opacity:ee.target.value})),i.onChangeValueLegendMapBox(ee)}):Y.attachEvent&&Y.attachEvent("onchange",function(ee){logger$i.trace(ee),ee.target.title=ee.target.value,i._renderThumbnail(e.type,Object.assign(e.values,{opacity:ee.target.value})),i.onChangeValueLegendMapBox(ee)}),g.appendChild(H),g.appendChild(Y),s.appendChild(g)}function u(){var g=document.createElement("div");g.className="legend-styling-div";var H=document.createElement("label");H.className="legend-fill",H.htmlFor=this.id?"fill-color-"+this.id:"fill-color",H.innerHTML=this.labels["fill-color"];var Y=document.createElement("input");Y.className="legend-styling",Y.id=this.id?"fill-color-"+this.id:"fill-color",Y.title="Selectionner une couleur de remplissage",Y.type="color",Y.value=e.values.color,Y.setAttribute("data-id","fill-color"),Y.addEventListener?Y.addEventListener("change",function(ee){i._renderThumbnail(e.type,Object.assign(e.values,{color:ee.target.value})),i.onChangeValueLegendMapBox(ee)}):Y.attachEvent&&Y.attachEvent("onchange",function(ee){i._renderThumbnail(e.type,Object.assign(e.values,{color:ee.target.value})),i.onChangeValueLegendMapBox(ee)}),g.appendChild(H),g.appendChild(Y),s.appendChild(g)}function f(){var g=document.createElement("div");g.className="legend-styling-div";var H=document.createElement("label");H.className="legend-fill",H.htmlFor=this.id?"fill-opacity-"+this.id:"fill-opacity",H.innerHTML=this.labels["fill-opacity"];var Y=document.createElement("input");Y.className="legend-styling",Y.id=this.id?"fill-opacity-"+this.id:"fill-opacity",Y.title=e.values.opacity,Y.type="range",Y.min="0",Y.max="1",Y.step="0.1",Y.defaultValue=e.values.opacity,Y.setAttribute("data-id","fill-opacity"),Y.addEventListener?Y.addEventListener("change",function(ee){ee.target.title=ee.target.value,i._renderThumbnail(e.type,Object.assign(e.values,{opacity:ee.target.value})),i.onChangeValueLegendMapBox(ee)}):Y.attachEvent&&Y.attachEvent("onchange",function(ee){ee.target.title=ee.target.value,i._renderThumbnail(e.type,Object.assign(e.values,{opacity:ee.target.value})),i.onChangeValueLegendMapBox(ee)}),g.appendChild(H),g.appendChild(Y),s.appendChild(g)}return s}add(){if(!this.options.target){if(!document.getElementById(this.name.target)){var e=document.createElement("div");e.id=this.name.target;var i=document.documentElement||document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0];i.appendChild(e)}this.options.target=document.getElementById(this.name.target)}return this.container&&this.options.target.appendChild(this.container),this}display(e){return logger$i.trace("display()",e),typeof e<"u"&&(this.container.style.display=e?"flex":"none"),this.container.style.display==="flex"}isEditable(){return this.editable}getRenderContainer(){return this.rendercontainer}getToolsContainer(){return this.toolscontainer}getContainer(){return this.container}onEditionLegendMapBox(e){logger$i.trace("onEditionLegendMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.legend.onclickedition,e)}onChangeValueLegendMapBox(e){logger$i.trace("onChangeValueLegendMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.legend.onchangevalue,e)}}Legend.PROPERTIES={line:["line-color","line-dasharray","line-opacity","line-width"],fill:["fill-color","fill-opacity","fill-outline-color","fill-pattern"],background:["background-color","background-opacity","background-pattern"],circle:["circle-color","circle-opacity","circle-stroke-color","circle-stroke-opacity","circle-stroke-width"],icon:["icon-color","icon-image","icon-opacity","__icon-size"],text:["__text-anchor","text-color","text-field","__text-font","__text-opacity","__text-size"]};window.ol&&window.ol.style&&(window.ol.style.editor||(window.ol.style.editor={}),window.ol.style.editor.Legend=Legend);var logger$h=LoggerByDefault.getLogger("editor-layer");class Layer{constructor(e){if(logger$h.trace("[constructor] Layer",e),this.options=e||{},!(this instanceof Layer))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this._initialize(),this._initContainer()}_initialize(){this.id=this.options.id||null,this.options.target,this.options.position||(this.options.position=0);var e={visibility:!0,icon:{image:!0,anchor:"end"},type:!0,pin:!0,remove:!1,clone:!1};this.options.tools||(this.options.tools=e),Helper.mergeParams(this.options.tools,e,!1);var i={id:"",type:"",source:"","source-layer":""};this.options.obj||(this.options.obj=i),Helper.mergeParams(this.options.obj,i,!1),this.bSlotLegend=!1,this.oFilter=null,this.oStyle=null,this.oLegend=null,this.container=null,this.DomVisibility=null,this.DomToggle=null,this.name={target:"GPEditorMapBoxLayerTarget",container:"GPEditorMapBoxLayerContainer",containerlegend:"GPEditorMapBoxLayerLegendContainer",containertitle:"GPEditorMapBoxLayerTitleContainer",imagelabelinput:"GPEditorMapBoxLayerImageInput",imagelabel:"GPEditorMapBoxLayerImageLabel",typeimg:"GPEditorMapBoxLayerTypeImage",titleinput:"GPEditorMapBoxLayerTitleInput",titlelabel:"GPEditorMapBoxLayerTitleLabel",containertools:"GPEditorMapBoxToolsContainer",visibilityinput:"GPEditorMapBoxToolsVisibilityInput",visibilitylabel:"GPEditorMapBoxToolsVisibilityLabel",visibilityinputdisable:"GPEditorMapBoxToolsVisibilityInputDisable",visibilitylabeldisable:"GPEditorMapBoxToolsVisibilityLabelDisable"}}_initContainer(){var e=this,i=this.options.obj,s=document.createElement("div");s.className=this.name.container;var o=document.createElement("div");if(o.id=this.name.containertitle+"-"+this.options.position,o.className=this.name.containertitle,this.options.tools.pin){var l=document.createElement("input");l.id=this.name.imagelabelinput+"-"+this.options.position,l.className=this.name.imagelabelinput,l.type="checkbox",o.appendChild(l);var c=document.createElement("label");c.className=this.name.imagelabel,c.htmlFor=l.id,c.addEventListener?c.addEventListener("click",function(ee){e.onClickLayerMapBox(ee)}):c.attachEvent&&c.attachEvent("onclick",function(ee){e.onClickLayerMapBox(ee)}),o.appendChild(c)}var u=function(){var ee=document.createElement("div");if(ee.id=this.name.containertools+"-"+this.options.position,ee.className=this.name.containertools,this.options.tools.visibility){var te=document.createElement("input");te.id=this.name.visibilityinput+"-"+this.options.position,te.className=this.options.tools.icon.image?this.name.visibilityinput:this.name.visibilityinputdisable,te.type="checkbox",te.checked="checked",te.addEventListener?te.addEventListener("click",function(Ye){e.onVisibilityLayerMapBox(Ye)}):te.attachEvent&&te.attachEvent("onclick",function(Ye){e.onVisibilityLayerMapBox(Ye)}),ee.appendChild(te),this.DomVisibility=te;var ne=document.createElement("label");ne.htmlFor=this.name.visibilityinput+"-"+this.options.position,ne.id=this.name.visibilitylabel+"-"+this.options.position,ne.className=this.options.tools.icon.image?this.name.visibilitylabel:this.name.visibilitylabeldisable,ne.title="Afficher/masquer la couche",ee.appendChild(ne),s.appendChild(ee)}this.options.tools.clone&&logger$h.warn("Dom for tools clone, it's not yet implemented !"),this.options.tools.remove&&logger$h.warn("Dom for tools remove, it's not yet implemented !")};if(this.options.tools.icon.anchor==="start"&&u.apply(this),this.options.tools.type&&i.type){var f=document.createElement("img");switch(f.className=this.name.typeimg,i.type.toUpperCase()){case"SYMBOL-ICON":f.style["background-position"]="0px 0";break;case"SYMBOL-TEXT":f.style["background-position"]="-194px 0";break;case"SYMBOL":f.style["background-position"]="-84px 0";break;case"LINE":f.style["background-position"]="-28px 0";break;case"FILL":f.style["background-position"]="-56px 0";break;case"BACKGROUND":f.style["background-position"]="-140px 0";break;case"CIRCLE":f.style["background-position"]="-168px 0";break;default:f.style["background-position"]="-112px 0"}o.appendChild(f)}var g=document.createElement("div");g.id=this.name.containerlegend+"-"+this.options.position,g.className=this.name.containerlegend,o.appendChild(g);var H=document.createElement("input");H.id=this.name.titleinput+"-"+this.options.position,H.className=this.name.titleinput,H.type="checkbox",o.appendChild(H);var Y=document.createElement("label");Y.className=this.name.titlelabel,Y.htmlFor=H.id,Y.innerHTML=i.id||i["source-layer"]||i.source,Y.title=i["source-layer"]||i.source||i.id,Y.addEventListener?Y.addEventListener("click",function(ee){e.onClickLayerMapBox(ee)}):Y.attachEvent&&Y.attachEvent("onclick",function(ee){e.onClickLayerMapBox(ee)}),o.appendChild(Y),this.DomToggle=Y,s.appendChild(o),this.options.tools.icon.anchor==="end"&&u.apply(this),this.container=s}add(){if(logger$h.trace("add()"),!this.options.target){if(!document.getElementById(this.name.target)){var e=document.createElement("div");e.id=this.name.target;var i=document.documentElement||document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0];i.appendChild(e)}this.options.target=document.getElementById(this.name.target)}return this.container&&this.options.target.appendChild(this.container),this}addStyle(e){logger$h.trace("addStyle()",e),e&&typeof e=="object"&&e instanceof Style&&(this.oStyle=e,this.oStyle.display(!1))}addFilter(e){logger$h.trace("addFilter()",e),e&&typeof e=="object"&&e instanceof Filter&&(this.oFilter=e,this.oFilter.display(!1))}addLegend(e){logger$h.trace("addLegend()",e),e&&typeof e=="object"&&e instanceof Legend&&(this.oLegend=e,this.oLegend.display(!1))}slotLegend(){var e=this.oLegend;if(e){var i=null,s=this.container.childNodes;if(s.length)for(var o=this.options.tools.icon.anchor==="start"?1:0,l=s[o].childNodes,c=0;c<l.length;c++){var u=l[c];u.id.indexOf(this.name.containerlegend)!==-1&&(i=u)}if(i){var f=e.getRenderContainer();f&&(i.appendChild(f),this.bSlotLegend=!0)}}}visibility(e){if(logger$h.trace("visibility()",e),!!this.options.tools.visibility)return typeof e<"u"&&(this.DomVisibility.checked=e?"checked":""),this.DomVisibility.checked}collapse(){logger$h.trace("collapse()"),this.DomToggle.click()}visible(){logger$h.trace("visible()"),this.options.tools.visibility&&this.DomVisibility.click()}display(e){logger$h.trace("display()",e);var i=document.getElementById(this.DomToggle.htmlFor).checked;return typeof e<"u"&&(this.container.style.display=e?"inline-flex":"none",this.oStyle&&this.oStyle.display(e&&i),this.oFilter&&this.oFilter.display(e&&i),this.oLegend&&this.oLegend.display(e&&i)),i}active(e){return logger$h.trace("active()",e),typeof e<"u"&&(this.container.className=e?this.name.container:this.name.container+" disabled"),this.container.className===this.name.container}getContainer(){return this.container}onClickLayerMapBox(e){logger$h.trace("onClickLayerMapBox",e);var i=e.target.htmlFor.substring(e.target.htmlFor.indexOf("-")),s=document.getElementById(e.target.htmlFor).checked;e.target.htmlFor===this.name.imagelabelinput+i&&(document.getElementById(this.name.titleinput+i).checked=!s),e.target.htmlFor===this.name.titleinput+i&&document.getElementById(this.name.imagelabelinput+i)&&(document.getElementById(this.name.imagelabelinput+i).checked=!s),this.oStyle&&this.oStyle.display(!s),this.oFilter&&this.oFilter.display(!s),this.oLegend&&this.oLegend.isEditable()&&this.oLegend.display(!s)}onVisibilityLayerMapBox(e){logger$h.trace("onVisibilityLayerMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.layer.onclickvisibility,e)}onCloneLayerMapBox(e){logger$h.trace("onCloneLayerMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.layer.onclickclone,e)}onRemoveLayerMapBox(e){logger$h.trace("onRemoveLayerMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.layer.onclickremove,e)}}window.ol&&window.ol.style&&(window.ol.style.editor||(window.ol.style.editor={}),window.ol.style.editor.Layer=Layer);var logger$g=LoggerByDefault.getLogger("editor-group");class Group{constructor(e){if(logger$g.trace("[constructor] Group",e),this.options=e||{},!(this instanceof Group))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this._initialize(),this._initContainer()}_initialize(){this.id=this.options.id||null,this.options.target,this.options.title||(this.options.title="Dtails du groupe..."),typeof this.options.collapse>"u"&&(this.options.collapse=!0),this.container=null,this.name={target:"GPEditorMapBoxGroupTarget",container:"GPEditorMapBoxGroupContainer",details:"GPEditorMapBoxGroupDetails",summary:"GPEditorMapBoxGroupSummary"}}_initContainer(){var e=document.createElement("div");e.className=this.name.container;var i=document.createElement("details");i.className=this.name.details,i.open=!this.options.collapse,e.appendChild(i);var s=document.createElement("summary");s.className=this.name.summary,s.innerHTML=this.options.title,i.appendChild(s),this.container=e}add(){if(!this.options.target){if(!document.getElementById(this.name.target)){var e=document.createElement("div");e.id=this.name.target;var i=document.documentElement||document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0];i.appendChild(e)}this.options.target=document.getElementById(this.name.target)}this.container&&this.options.target.appendChild(this.container)}display(e){this.container.style.display=e?"flex":"none"}getContainer(){var e=this.container.childNodes;return e.length?e[0]:this.container}onCollapseGroupMapBox(e){logger$g.trace("onCollapseGroupMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.group.oncollapse,e)}}var logger$f=LoggerByDefault.getLogger("editor-search");class Search{constructor(e){if(logger$f.trace("[constructor] Search",e),this.options=e||{target:null,tools:null,title:null,obj:null},!(this instanceof Search))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this._initialize(),this._initContainer()}_initialize(){this.id=this.options.id||null,this.options.target;var e={};this.options.tools||(this.options.tools=e),Helper.mergeParams(this.options.tools,e,!1),this.options.obj||(this.options.obj={}),this.options.title||(this.options.title="Recherche de couches :"),this.container=null,this.name={target:"GPEditorMapBoxSearchTarget",container:"GPEditorMapBoxSearchContainer"}}_initContainer(){var e=JSON.parse(JSON.stringify(this.options.obj));e.layers&&e.layers.length===0&&logger$f.info("tag 'layers' is empty !");var i=document.createElement("div");i.className=this.name.container,this.container=i}add(){if(!this.options.target){if(!document.getElementById(this.name.target)){var e=document.createElement("div");e.id=this.name.target;var i=document.documentElement||document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0];i.appendChild(e)}this.options.target=document.getElementById(this.name.target)}return this.container&&this.options.target.appendChild(this.container),this}display(e){return logger$f.trace("display()",e),typeof e<"u"&&(this.container.style.display=e?"flex":"none"),this.container.style.display==="flex"}getContainer(){return this.container}onSubmitSearchLayersMapBox(e){logger$f.trace("onSubmitSearchLayersMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.search.onsubmit,e)}onAutocompleteSearchLayersMapBox(e){logger$f.trace("onAutocompleteSearchLayersMapBox",e),e.editorID=this.id,e.data=this.options,EventBus.dispatch(EventEditor.search.onautocomplete,e)}}var EditorDOM={_addUID:function(n){var e=this._uid?n+"-"+this._uid:n;return e}},logger$e=LoggerByDefault.getLogger("editor");class Editor{constructor(e){if(logger$e.trace("[constructor] Editor",e),this.options=e||{},!(this instanceof Editor))throw new TypeError("ERROR CLASS_CONSTRUCTOR");this._initialize()}_initialize(){if(this.options.target||logger$e.info("La 'target' n'est pas renseigne (options.target)."),!this.options.style){logger$e.error("Le 'style' MapBox n'est pas renseign (options.style) !");return}this.options.events?this._initEvents():logger$e.warn("Les 'handlers' ne sont pas renseigns (options.events) !"),this.options.themes||logger$e.info("Les 'themes' MapBox ne sont pas renseigns (options.themes).");var e={themes:!1,layers:!0,search:!1,style:!1,filter:!1,legend:!1,group:!1,groupAuto:!1,sort:!0,sortBy:"id",sortOrder:"asc",title:!0,collapse:void 0,type:!0,pin:!0,visibility:!0,icon:{image:!0,anchor:"end"},editable:!0};this.options.tools||(logger$e.trace("Utilisation des outils MapBox par dfaut (options.tools)."),this.options.tools=e),Helper.mergeParams(this.options.tools,e,!1),this.id=this.options.id||SelectorID.generate(),this.context={},this.layers=[],this.container=null,this.name={target:"GPEditorMapBoxTarget",container:"GPEditorMapBoxContainer",containerID:"GPEditorMapBoxContainer_ID_",containerLayers:"GPEditorMapBoxLayersContainer",titleLayers:"GPEditorMapBoxLayersTitle",titleLayersID:"GPEditorMapBoxLayersTitle_ID_",titleThemes:"GPEditorMapBoxThemesTitle",titleThemesID:"GPEditorMapBoxThemesTitle_ID_",sep:"GPEditorMapBoxSep"},this.mapbox={},this.sprites={}}_initEvents(){var e=this.options.scope||this,i=this.options.events;if(i){for(var s in i)if(i.hasOwnProperty(s)){var o=i[s];o&&(EventBus.hasEventListener(s,o,e)||EventBus.addEventListener(s,o,e))}}}_initContainer(){logger$e.trace(this.mapbox);var e=document.createElement("div");e.id=this.name.containerID+this.id,e.className=this.name.container;var i=this.options.tools.themes;if(i&&this.options.themes){if(this.options.tools.title){var s=document.createElement("div");s.id=this.name.titleThemesID+this.id,s.className=this.name.titleThemes,s.innerHTML="Liste des 'thmes'",e.appendChild(s)}var o=new Themes({id:this.id,target:e,tools:typeof i=="object"?i:{},obj:this.options.themes});o.add()}if(this.options.tools.search){var l=new Search({id:this.id,target:e,tools:{},obj:this.mapbox.layers});l.add()}for(var c in this.mapbox.sources)if(this.mapbox.sources.hasOwnProperty(c)){if(this.options.tools.layers){var u=Object.keys(this.mapbox.sources).length>1?1:0;if(u){var f=document.createElement("hr");f.className=this.name.sep,e.appendChild(f)}if(this.options.tools.title){var g=document.createElement("div");g.id=this.name.titleLayersID+this.id,g.className=this.name.titleLayers,g.innerHTML=u?"Liste des 'couches' ("+c+")":"Liste des 'couches'",e.appendChild(g)}}var H=this.mapbox.layers.slice();if(H.forEach(function(Lt,Gt){var vt=Lt.metadata;vt?vt["geoportail:order"]=Gt:Lt.metadata={"geoportail:order":Gt}}),this.options.tools.sort){var Y=this.options.tools.sortBy,ee=this.options.tools.sortOrder,te=function(Lt,Gt){var vt=0;if(Lt.metadata&&Lt.metadata["geoportail:group"]&&Gt.metadata&&Gt.metadata["geoportail:group"]){var Et=null,_t=null;Et=Lt.metadata["geoportail:group"],_t=Gt.metadata["geoportail:group"],vt=Et.localeCompare(_t)}else switch(Y){case"geom":vt=ee==="asc"?Lt.type.localeCompare(Gt.type)||Lt.id.localeCompare(Gt.id):Gt.type.localeCompare(Lt.type)||Gt.id.localeCompare(Lt.id);break;case"class":vt=ee==="asc"?Lt["source-layer"].localeCompare(Gt["source-layer"])||Lt.id.localeCompare(Gt.id):Gt["source-layer"].localeCompare(Lt["source-layer"])||Gt.id.localeCompare(Lt.id);break;case"id":default:vt=ee==="asc"?Lt.id.localeCompare(Gt.id):Gt.id.localeCompare(Lt.id);break}return vt};H.sort(te)}logger$e.trace("Layers : ",H);var ne=this.options.tools.sortBy,Ye=this.options.tools.groupAuto,xe={};H.forEach(function(Lt){var Gt=Lt.metadata;if(Gt&&Gt["geoportail:group"]){var vt=Gt["geoportail:group"];xe[vt]=xe[vt]?xe[vt]+1:1}else{var Et=null;switch(ne){case"class":Et=Lt["source-layer"];break;case"geom":Et=Lt.type;break;case"id":default:Et=Lt.id;break}var _t=Et;if(Ye){var Ct=/_|-|:|=/,ct=Et.search(Ct);_t=ct!==-1?Et.substring(0,ct).trim():Et}xe[_t]=xe[_t]?xe[_t]+1:1,Gt?Gt["geoportail:group"]=_t:Lt.metadata={"geoportail:group":_t}}}),logger$e.trace("Groups : ",xe);var tt=document.createElement("div");tt.className=this.name.containerLayers,e.appendChild(tt);var et;if(this.options.tools.collapse!==void 0){et=document.createElement("details"),et.className="",et.open=!this.options.tools.collapse,tt.appendChild(et);var it=document.createElement("summary");it.className="",it.innerHTML="",et.appendChild(it)}for(var rt=this.options.tools.collapse!==void 0?et:tt,nt=-1,at=0;at<H.length;at++){var st=H[at];if(nt++,st.source===c){if(this.options.tools.group&&this.options.tools.sort){var ot=st.metadata;if(ot){var ut=st.metadata["geoportail:group"];if(ut)if(xe[ut]>1){xe[ut]=-1;var ht=new Group({id:this.id,target:this.options.tools.collapse!==void 0?et:tt,title:ut,collapse:!0});ht.add(),rt=ht.getContainer()}else xe[ut]===1&&(rt=this.options.tools.collapse!==void 0?et:tt);else rt=this.options.tools.collapse!==void 0?et:tt}else rt=this.options.tools.collapse!==void 0?et:tt}if(this.options.tools.layers){var dt=new Layer({id:this.id,target:rt,position:nt+"_"+this.id,tools:{visibility:this.options.tools.visibility,icon:this.options.tools.icon,type:this.options.tools.type,pin:this.options.tools.pin},obj:{id:st.id,type:st.type,source:st.source,"source-layer":st["source-layer"]}});dt.add(),st.layout&&st.layout.visibility&&st.layout.visibility==="none"&&dt.visibility(!1),this.layers.push(dt)}if(this.options.tools.legend){var pt=this.options.tools.editable;typeof pt>"u"&&(pt=st.editable);var yt=new Legend({id:this.id,target:rt,sprites:this.sprites,obj:{id:st.id,source:st.source,title:st.id,editable:typeof pt<"u"?pt:!1,paint:st.paint,layout:st.layout}});yt.add(),yt.display(!1),dt&&(dt.addLegend(yt),dt.slotLegend())}if(this.options.tools.style){var mt=new Style({id:this.id,target:rt,position:nt+"_"+this.id,obj:{id:st.id,source:st.source,layout:st.layout,paint:st.paint}});mt.add(),mt.display(!1),dt&&dt.addStyle(mt),st.layout&&st.layout.visibility&&st.layout.visibility==="none"&&dt.visibility(!1)}if(this.options.tools.filter){var St=new Filter({id:this.id,target:rt,position:nt+"_"+this.id,obj:{id:st.id,source:st.source,filter:st.Filter}});St.add(),St.display(!1),dt&&dt.addFilter(St)}}else nt>=0&&nt--}}if(this.container=e,!this.options.target){if(!document.getElementById(this.name.target)){var wt=document.createElement("div");wt.id=this.name.target;var Rt=document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0]||document.documentElement;Rt.appendChild(wt)}this.options.target=document.getElementById(this.name.target)}this.container&&this.options.target.appendChild(this.container),EventBus.dispatch(EventEditor.onloaded,this)}_getSprites(e){var i=this;if(e&&e.startsWith("mapbox://"))return new Promise((l,c)=>{logger$e.error("Protocole mapbox:// non gr !"),l(i)});if(!e)return new Promise((l,c)=>{logger$e.error("Auncun sprites disponibles !"),l(i)});var s=function(){var l=e+".png";return fetch(l,{credentials:"same-origin"}).then(function(c){if(c.ok)return c.blob().then(function(f){i.sprites.url=l;var g=new Image;return g.src=l,g.decode().then(function(){i.sprites.size={},i.sprites.size.h=g.height,i.sprites.size.w=g.width})}).catch(f=>{logger$e.warn("fetch image sprites exception :",f)});var u=new Error("HTTP status code: "+c.status);throw u}).catch(c=>new Promise((u,f)=>{logger$e.error("fetch image sprites exception :",c),f(c)}))},o=function(){var l=e+".json";return fetch(l,{credentials:"same-origin"}).then(function(c){if(c.ok)return c.json().then(function(f){i.sprites.json=f}).catch(f=>{logger$e.warn("fetch json sprites exception :",f)});var u=new Error("HTTP status code: "+c.status);throw u}).catch(c=>new Promise((u,f)=>{logger$e.error("fetch json sprites exception :",c),f(c)}))};return Promise.all([s(),o()])}createElement(){var e=this;if(typeof this.options.style=="object")return this.mapbox=this.options.style,this.options.tools.legend?this._getSprites(this.mapbox.sprite).then(function(){return e._initContainer(),e}).catch(i=>{logger$e.warn("fetch sprites exception :",i)}):new Promise((i,s)=>{e._initContainer(),i(e)});if(typeof this.options.style=="string")return fetch(this.options.style,{credentials:"same-origin"}).then(i=>i.json().then(s=>{e.mapbox=s}).then(function(){return e.options.tools.legend?e._getSprites(e.mapbox.sprite).then(function(){return e._initContainer(),e}).catch(s=>{logger$e.warn("fetch sprites exception :",s)}):new Promise((s,o)=>{e._initContainer(),s(e)})}).catch(s=>{logger$e.error("json exception :",s)})).catch(i=>{logger$e.error("fetch exception :",i)})}display(e){this.container.style.display=e?"block":"none"}setContext(e,i){this.context[e]=i}getContext(e){return this.context[e]}getID(){return this.id}getContainer(){return this.container}getStyle(){return this.mapbox}getStyleLayer(e){for(var i=null,s=this.getLayer(e),o=s.options.obj.id,l=0;l<this.mapbox.layers.length;l++){var c=this.mapbox.layers[l];if(c.id===o){i=c;break}}return i}getLayerFromStyle(e){for(var i=null,s=this.mapbox.layers[e],o=0;o<this.getLayers().length;o++){var l=this.getLayer(o);if(s.id===l.options.obj.id){i=l;break}}return i}getLayers(){return this.layers}getLayer(e){return this.layers[e]}}Helper.assign(Editor.prototype,EditorDOM);window.ol&&window.ol.style&&(window.ol.style.Editor=Editor);var LayerImportDOM={_addUID:function(n){var e=this._uid?n+"-"+this._uid:n;return e},_createLoadingElement:function(){var n=document.createElement("div");return n.id="GPmapLoading",n.className="",n},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPimport"),n.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",n},_createShowImportPictoElement:function(){var n=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowImportPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowImportPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-import fr-btn fr-btn--tertiary",e.setAttribute("aria-label","Ouvrir l'import de couches"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n._onShowImportClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n._onShowImportClick(s)}),e},_createImportPanelElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPimportPanel"),n.className="GPpanel gpf-panel fr-modal",n},_createImportPanelDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__body fr-modal__body",n},_createImportPanelHeaderElement:function(){var n=document.createElement("div");return n.className="GPpanelHeader GPelementVisible gpf-visible gpf-panel__header fr-modal__header",n},_createImportPanelReturnPictoElement:function(){var n=this,e=document.createElement("button");if(e.id=this._addUID("GPimportPanelReturnPicto"),e.title="Masquer le panneau",e.className="GPreturnPicto GPimportPanelReturnPicto GPelementHidden gpf-hidden gpf-btn gpf-btn-icon-return fr-btn fr-btn--close fr-btn--tertiary-no-outline",checkDsfr()){var i=document.createElement("span");i.className="GPelementHidden",i.innerHTML="Retour",e.appendChild(i)}return e.addEventListener?e.addEventListener("click",function(s){document.getElementById(n._addUID("GPshowImportPicto")).click(),n._onReturnPictoClick(s),document.getElementById(n._addUID("GPshowImportPicto")).click()}):e.attachEvent&&e.attachEvent("onclick",function(s){document.getElementById(n._addUID("GPshowImportPicto")).click(),n._onReturnPictoClick(s),document.getElementById(n._addUID("GPshowImportPicto")).click()}),e},_createImportPanelTitleElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPimportHeaderTitle"),n.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",n.innerHTML="Import de donnes",n},_createImportPanelCloseElement:function(){var n=this,e=document.createElement("button");e.id=this._addUID("GPimportPanelClose"),e.className="GPpanelClose GPimportPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline",e.title="Fermer le panneau",e.addEventListener?e.addEventListener("click",function(){document.getElementById(n._addUID("GPshowImportPicto")).click()},!1):e.attachEvent&&e.attachEvent("onclick",function(){document.getElementById(n._addUID("GPshowImportPicto")).click()});var i=document.createElement("span");return i.className="GPelementHidden gpf-visible",i.innerText="Fermer",e.appendChild(i),e},_createImportPanelFormElement:function(){var n=this,e=document.createElement("form");return e.id=this._addUID("GPimportForm"),e.className="GPform GPelementVisible gpf-visible gpf-mobile-form gpf-panel__content fr-modal__content",e.addEventListener?e.addEventListener("submit",function(i){i.preventDefault(),n._onImportSubmit()}):e.attachEvent&&e.attachEvent("onsubmit",function(i){i.preventDefault(),n._onImportSubmit()}),e},_createImportTypeLineElement:function(n){var e=this,i=document.createElement("div");i.id=this._addUID("GPimportTypeLine"),i.className="GPimportInputLine";var s=document.createElement("label");s.id=this._addUID("GPimportTypeLabel"),s.className="GPlabel gpf-label fr-label",s.innerHTML="Type de donne",s.title="Type de donne",i.appendChild(s);var o=document.createElement("select");o.setAttribute("aria-labelledby",this._addUID("GPimportTypeLabel")),o.className="GPselect gpf-select fr-select",o.addEventListener?o.addEventListener("change",function(u){this.value==="KML"||this.value==="GPX"||this.value==="GeoJSON"||this.value==="MAPBOX"?(document.getElementById(e._addUID("GPimportStaticParams")).className="GPelementVisible gpf-visible fr-my-4w",document.getElementById(e._addUID("GPimportServiceParams")).className="GPelementHidden gpf-hidden"):(this.value==="WMS"||this.value==="WMTS"||this.value==="WFS")&&(document.getElementById(e._addUID("GPimportServiceParams")).className="GPelementVisible gpf-visible fr-my-4w",document.getElementById(e._addUID("GPimportStaticParams")).className="GPelementHidden gpf-hidden"),e._onImportTypeChange(u)}):o.attachEvent&&o.attachEvent("onchange",function(){this.value==="KML"||this.value==="GPX"||this.value==="GeoJSON"||this.value==="MAPBOX"?(document.getElementById(e._addUID("GPimportStaticParams")).className="GPelementVisible gpf-visible fr-my-4w",document.getElementById(e._addUID("GPimportServiceParams")).className="GPelementHidden gpf-hidden"):(this.value==="WMS"||this.value==="WMTS"||this.value==="WFS")&&(document.getElementById(e._addUID("GPimportServiceParams")).className="GPelementVisible gpf-visible fr-my-4w",document.getElementById(e._addUID("GPimportStaticParams")).className="GPelementHidden gpf-hidden"),e._onImportTypeChange()}),o.id=this._addUID("GPimportTypeSelect"),(!n||!Array.isArray(n))&&(n=["KML","GPX","GeoJSON","MAPBOX","WMS","WMTS","WFS"]);for(var l,c=0;c<n.length;c++)l=document.createElement("option"),l.value=n[c],l.text=n[c]==="MAPBOX"?"Tuiles vectorielles":n[c],o.appendChild(l);return i.appendChild(o),i},_createImportWaitingElement:function(){var n=document.createElement("div");n.id=this._addUID("GPimportWaitingContainer"),n.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden";var e=document.createElement("p");return e.className="GPwaitingContainerInfo gpf-waiting_info",e.innerHTML="Recherche en cours...",n.appendChild(e),n},_createImportStaticParamsContainer:function(n){var e=document.createElement("div");return e.id=this._addUID("GPimportStaticParams"),n==="KML"||n==="GPX"||n==="GeoJSON"||n==="MAPBOX"?e.className="GPelementVisible gpf-visible fr-my-4w":e.className="GPelementHidden gpf-hidden",e},_createStaticNameLabel:function(){var n=document.createElement("div");n.className="GPimportInputLine fr-mb-1w";var e=document.createElement("label");e.className="GPlabel gpf-label fr-label",e.htmlFor=this._addUID("GPimportName"),e.innerHTML="Nom",e.title="Nom",n.appendChild(e);var i=document.createElement("input");return i.type="text",i.id=this._addUID("GPimportName"),i.className="GPinput gpf-input fr-input",n.appendChild(i),n},_createStaticModeChoiceDiv:function(){var n=document.createElement("div");return n.id=this._addUID("GPimportChoice"),n.className="fr-my-1w",n},_createStaticLocalChoiceDiv:function(){var n=this,e=document.createElement("div");e.className="GPimportChoiceAlt gpf-radio-group fr-radio-group";var i=document.createElement("input");i.type="radio",i.addEventListener?i.addEventListener("change",function(o){document.getElementById(n._addUID("GPimportValueLocal")).className="GPimportInputLine fr-mb-1w",document.getElementById(n._addUID("GPimportValueUrl")).className="GPelementHidden gpf-hidden",n._onStaticImportTypeChange(o)}):i.appendChild&&i.appendChild("onchange",function(){document.getElementById(n._addUID("GPimportValueLocal")).className="GPimportInputLine fr-mb-1w",document.getElementById(n._addUID("GPimportValueUrl")).className="GPelementHidden gpf-hidden",n._onStaticImportTypeChange()}),i.name="GPimportChoiceMode",i.value="local",i.checked=!0,i.id=this._addUID("GPimportChoiceAltLocal"),e.appendChild(i);var s=document.createElement("label");return s.className="GPimportChoiceAltTxt gpf-label fr-label",s.htmlFor=this._addUID("GPimportChoiceAltLocal"),s.innerHTML="par fichier local",s.title="par fichier local",e.appendChild(s),e},_createStaticUrlChoiceDiv:function(){var n=this,e=document.createElement("div");e.className="GPimportChoiceAlt gpf-radio-group fr-radio-group";var i=document.createElement("input");i.type="radio",i.addEventListener?i.addEventListener("change",function(o){document.getElementById(n._addUID("GPimportValueUrl")).className="GPimportInputLine",document.getElementById(n._addUID("GPimportValueLocal")).className="GPelementHidden gpf-hidden",n._onStaticImportTypeChange(o)}):i.appendChild&&i.appendChild("onchange",function(){document.getElementById(n._addUID("GPimportValueUrl")).className="GPimportInputLine",document.getElementById(n._addUID("GPimportValueLocal")).className="GPelementHidden gpf-hidden",n._onStaticImportTypeChange()}),i.id=this._addUID("GPimportChoiceAltUrl"),i.name="GPimportChoiceMode",i.value="url",i.checked=!1,e.appendChild(i);var s=document.createElement("label");return s.className="GPimportChoiceAltTxt gpf-label fr-label",s.htmlFor=this._addUID("GPimportChoiceAltUrl"),s.innerHTML="par URL",s.title="par URL",e.appendChild(s),e},_createStaticLocalInputDiv:function(){var n=document.createElement("div");return n.id=this._addUID("GPimportValueLocal"),n.className="GPimportInputLine",n},_createStaticLocalInputLabel:function(){var n=document.createElement("label");return n.className="GPlabel gpf-label fr-label fr-mb-1w",n.htmlFor=this._addUID("GPimportFile"),n.innerHTML="Fichier local",n.title="Fichier local",n},_createStaticLocalInput:function(){var n=document.createElement("input");return n.type="file",n.id=this._addUID("GPimportFile"),n.className="GPimportInputFile gpf-upload fr-upload",n},_createStaticUrlInputDiv:function(){var n=document.createElement("div");return n.id=this._addUID("GPimportValueUrl"),n.className="GPelementHidden gpf-hidden",n},_createStaticUrlInputLabel:function(){var n=document.createElement("label");return n.className="GPlabel gpf-label fr-label",n.htmlFor=this._addUID("GPimportUrl"),n.innerHTML="URL",n.title="URL",n},_createStaticUrlInput:function(){var n=document.createElement("input");return n.type="text",n.id=this._addUID("GPimportUrl"),n.className="GPinput gpf-input fr-input",n},_createServiceParamsContainer:function(n){var e=document.createElement("div");return e.id=this._addUID("GPimportServiceParams"),n==="WMS"||n==="WMTS"||n==="WFS"?e.className="GPelementVisible gpf-visible":e.className="GPelementHidden gpf-hidden",e},_createServiceUrlDiv:function(){var n=document.createElement("div");return n.className="GPimportInputLine",n},_createServiceUrlInputLabel:function(){var n=document.createElement("label");return n.className="GPlabel gpf-label fr-label",n.htmlFor=this._addUID("GPimportServiceUrl"),n.innerHTML="URL du service",n.title="URL du service",n},_createServiceUrlInput:function(){var n=document.createElement("input");return n.type="text",n.id=this._addUID("GPimportServiceUrl"),n.className="GPinput gpf-input fr-input",n},_createImportSubmitFormElement:function(){var n=document.createElement("input");return n.id=this._addUID("GPimportSubmit"),n.className="GPsubmit gpf-btn fr-btn",n.type="submit",n.value="Importer",n},_createImportGetCapPanelElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPimportGetCapPanel"),n.className="GPpanel GPelementHidden gpf-panel fr-modal gpf-hidden",n},_createImportGetCapPanelHeaderElement:function(){var n=this,e=document.createElement("div");e.className="GPpanelHeader gpf-panel__header fr-modal__header";var i=document.createElement("div");i.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",i.innerHTML="Couches accessibles",i.title="Couches accessibles",e.appendChild(i);var s=document.createElement("button");s.className="GPpanelClose GPimportGetCapPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",s.title="Fermer le panneau",s.id=this._addUID("GPimportGetCapPanelClose"),s.addEventListener?s.addEventListener("click",function(){document.getElementById(n._addUID("GPshowImportPicto")).click(),document.getElementById(n._addUID("GPimportGetCapPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPimportGetCapPanel")).classList.replace("gpf-visible","gpf-hidden"),n._onGetCapPanelClose()}):s.attachEvent&&s.attachEvent("click",function(){document.getElementById(n._addUID("GPshowImportPicto")).click(),document.getElementById(n._addUID("GPimportGetCapPanel")).classList.replace("GPelementVisible","GPelementHidden"),document.getElementById(n._addUID("GPimportGetCapPanel")).classList.replace("gpf-visible","gpf-hidden"),n._onGetCapPanelClose()});var o=document.createElement("span");return o.className="GPelementHidden gpf-visible",o.innerText="Fermer",s.appendChild(o),e.appendChild(s),e},_createImportGetCapResultsContainer:function(){var n=document.createElement("div");return n.className="GPimportGetCapRoot gpf-panel__list",n.id=this._addUID("GPimportGetCapResults"),n},_addImportGetCapResultListRubrique:function(n,e){var i=document.createElement("ul");return i.className="GPimportGetCapListRubrique",i.title=n,e.appendChild(i),e},_addImportGetCapResultRubrique:function(n,e){var i=document.createElement("li");i.className="GPimportGetCapRubrique gpf-panel__items_layerimport";var s=document.createElement("input");s.id="GPimportGetCapRubrique-"+SelectorID.generate(),s.className="GPimportGetCapRubrique",s.type="checkbox",i.appendChild(s);var o=document.createElement("label");return o.className="GPimportGetCapRubriqueTitle gpf-label fr-btn fr-btn--secondary",o.htmlFor=s.id,o.innerHTML=n,o.title=n,i.appendChild(o),e.appendChild(i),e},_addImportGetCapResultListLayer:function(n){var e=document.createElement("ul");return e.className="GPimportGetCapListLayer",n.appendChild(e),n},_addImportGetCapResultLayer:function(n,e,i){var s=document.createElement("li");s.className="GPimportGetCapProposal gpf-panel__items_layerimport gpf-panel__items",s.innerHTML=n.content,s.title=n.title,s.id="GPimportGetCapProposal_"+e;var o=this;return s.addEventListener?s.addEventListener("click",function(l){o._onGetCapResponseLayerClick(l)}):s.attachEvent&&s.attachEvent("onclick",function(){o._onGetCapResponseLayerClick()}),i.appendChild(s),i},_createImportMapBoxPanelElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPimportMapBoxPanel"),n.className="GPpanel GPelementHidden gpf-panel fr-modal gpf-hidden",n},_createImportMapBoxPanelHeaderElement:function(){var n=this,e=document.createElement("div");e.className="GPpanelHeader gpf-panel__header fr-modal__header";var i=document.createElement("button");i.id=this._addUID("GPimportMapBoxPanelReturnPicto"),i.title="Nouvel import",i.className="GPreturnPicto GPimportMapBoxPanelReturnPicto gpf-btn gpf-btn-icon-return fr-btn fr-btn--secondary gpf-btn--secondary",i.addEventListener?i.addEventListener("click",function(c){document.getElementById(n._addUID("GPshowImportPicto")).click(),n._onMapBoxReturnPictoClick(c)}):i.attachEvent&&i.attachEvent("onclick",function(c){document.getElementById(n._addUID("GPshowImportPicto")).click(),n._onMapBoxReturnPictoClick(c)}),e.appendChild(i);var s=document.createElement("div");s.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",s.innerHTML="Edition des styles",s.title="Edition des styles",e.appendChild(s);var o=document.createElement("button");o.className="GPpanelClose GPimportMapBoxPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",o.title="Fermer le panneau",o.id=this._addUID("GPimportMapBoxPanelClose"),o.addEventListener?o.addEventListener("click",function(){document.getElementById(n._addUID("GPshowImportPicto")).click(),document.getElementById(n._addUID("GPimportMapBoxPanel")).style.display="none",n._onMapBoxPanelClose()}):o.attachEvent&&o.attachEvent("click",function(){document.getElementById(n._addUID("GPshowImportPicto")).click(),document.getElementById(n._addUID("GPimportMapBoxPanel")).style.display="none",n._onMapBoxPanelClose()});var l=document.createElement("span");return l.className="GPelementHidden gpf-visible",l.innerText="Fermer",o.appendChild(l),e.appendChild(o),e},_createImportMapBoxResultsContainer:function(){var n=document.createElement("div");return n.className="GPimportMapBoxpRoot",n.id=this._addUID("GPimportMapBoxResults"),n}},MeasureToolBoxDOM={_toolboxId:"GPtoolbox-measure-main",_buttonId:"GPtoolbox-measure-button",_widgetId:"GPtoolbox-measure-widget",getToolBoxID:function(n){return n?this._toolboxId+"-"+n:this._toolboxId},getButtonID:function(n){return n?this._buttonId+"-"+n:this._buttonId},getWidgetID:function(n){return n?this._widgetId+"-"+n:this._widgetId},_createToolBoxContainerElement:function(n){var e=document.createElement("div");e.id=this.getToolBoxID(n),e.className="GPshowAdvancedToolPicto";var i=document.createElement("button");i.id=this.getButtonID(n),i.className="GPshowOpen GPshowAdvancedToolPicto GPshowToolBoxPicto gpf-btn gpf-btn-icon-toolbox fr-btn",i.setAttribute("tabindex","0"),i.setAttribute("aria-pressed",!1),i.setAttribute("type","button");var s=this;i.addEventListener("click",function(l){var c=l.target.ariaPressed==="true";l.target.setAttribute("aria-pressed",!c),this.blur();var u=document.getElementById(s.getWidgetID(n));u.style.display==="block"?u.style.display="none":u.style.display="block"}),e.appendChild(i);var o=document.createElement("div");return o.id=this.getWidgetID(n),o.addEventListener("click",function(){},!1),e.appendChild(o),e}},logger$d=LoggerByDefault.getLogger("toolbox"),MeasureToolBox={_toolbox:{},add:function(n,e){if(logger$d.trace("ToolBox.add()",e),!n){logger$d.trace("map doesn't exist !?");return}var i=typeof window<"u"?window:typeof self<"u"?self:null;i&&(this._toolbox=i.gpShareMeasureToolBox||{});var s=n.getTargetElement(),o=s.ownerDocument,l=s.id;!this._toolbox||Object.keys(this._toolbox).length===0?(this._toolbox={},this._toolbox[l]=SelectorID.generate()):this._toolbox[l]||(this._toolbox[l]=SelectorID.generate());var c=this._toolbox[l];if(!o.getElementById(this.getToolBoxID(c))){logger$d.trace("create toolbox !");var u=this._createToolBoxContainerElement(c);u.style.pointerEvents="auto";var f=s.getElementsByClassName("ol-overlaycontainer-stopevent");f[0].appendChild(u)}var g=o.getElementById(this.getWidgetID(c));e.setTarget(g),i&&(i.gpShareMeasureToolBox=this._toolbox),logger$d.trace("add control to toolbox !")}};Helper.assign(MeasureToolBox,MeasureToolBoxDOM);var logger$c=LoggerByDefault.getLogger("measures"),Measures={DEFAULT_POINTER_STYLE:new CircleStyle({radius:5,stroke:new Stroke({color:"#002A50",width:2}),fill:new Fill({color:"rgba(255, 155, 0, 0.7)"})}),DEFAULT_DRAW_START_STYLE:new Style$1({fill:new Fill({color:"rgba(0, 183, 152, 0.2)"}),stroke:new Stroke({color:"#002A50",lineDash:[10,10],width:2})}),DEFAULT_DRAW_FINISH_STYLE:new Style$1({fill:new Fill({color:"rgba(0, 183, 152, 0.3)"}),stroke:new Stroke({color:"#002A50",width:3})}),tools:{MeasureLength:[],MeasureArea:[],MeasureAzimuth:[]},measureDraw:null,measureSource:null,measureVector:null,eventLayerRemove:null,sketch:null,measureTooltipElement:null,measureTooltip:null,helpTooltipElement:null,helpTooltip:null,clean:function(){var n=this.CLASSNAME;logger$c.trace("["+n+"] deactived tool !"),this.clearMeasure(),this.clearMeasureToolTip(),this.removeMeasureEvents(),this._pictoContainer.setAttribute("aria-pressed",!1)},onPointerMoveHandler:function(n){if(!n.dragging){var e=n.coordinate;if(this.sketch){var i,s=this.sketch.getGeometry();if(i=this.format(s),s.getType()==="LineString")e=s.getLastCoordinate();else if(s.getType()==="Polygon")e=s.getInteriorPoint().getCoordinates();else return;this.measureTooltipElement.innerHTML=i,this.measureTooltip.setPosition(e)}}},onShowMeasureClick:function(n,e){n.target.ariaPressed==="true"&&this.onPanelOpen();var i=this.getMap(),s=i.getTargetElement().id,o=typeof window<"u"?window:typeof self<"u"?self:null;o&&(this.tools=o.gpShareMeasures||{});var l=this.CLASSNAME;for(var c in this.tools)if(this.tools.hasOwnProperty(c))for(var u=this.tools[c],f=0;f<u.length;f++){var g=u[f];g&&g.active&&c!==l&&g.map.id===s&&(g.active=!1,g.instance!==null&&g.instance.clean())}Interactions.unset(i,{current:"Measures"});var H=this._pictoContainer.ariaPressed;if(H==="true"){this.addMeasureEvents(),this.initMeasureInteraction(),this.addMeasureInteraction(e);for(var Y=0;Y<this.tools[l].length;Y++)this.tools[l][Y].map.id===s&&(this.tools[l][Y].active=!0)}else{this.clearMeasure(),this.clearMeasureToolTip(),this.removeMeasureEvents();for(var ee=0;ee<this.tools[l].length;ee++)this.tools[l][ee].map.id===s&&(this.tools[l][ee].active=!1)}},clearMeasureToolTip:function(){var n=this.getMap();if(n)for(var e=n.getTargetElement(),i=e.getElementsByClassName("ol-overlaycontainer"),s=0;s<i.length;s++){for(var o=i[s],l=o.children.length,c=[],u=0;u<l;u++){var f=o.children[u];if(f.children.length!==0){var g=f.children[0];(g.className==="GPmeasureTooltip GPmeasureTooltip-static"||g.className==="GPmeasureTooltip GPmeasureTooltip-measure")&&c.push(f)}}for(var H=0;H<c.length;H++)o.removeChild(c[H])}},clearMeasure:function(){var n=this.getMap();this.measureVector&&(n.removeLayer(this.measureVector),this.measureVector=null),this.measureDraw&&(n.removeInteraction(this.measureDraw),this.measureDraw=null)},createMeasureTooltip:function(n){this.measureTooltipElement&&this.measureTooltipElement.parentNode.removeChild(this.measureTooltipElement),this.measureTooltipElement=document.createElement("div"),this.measureTooltipElement.className="GPmeasureTooltip GPmeasureTooltip-measure",this.measureTooltip=new Overlay({element:this.measureTooltipElement,stopEvent:!1,offset:[0,-15],positioning:"bottom-center"}),n.addOverlay(this.measureTooltip)},createHelpTooltip:function(n){this.helpTooltipElement&&this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement),this.helpTooltipElement=document.createElement("div"),this.helpTooltipElement.className="tooltip hidden",this.helpTooltip=new Overlay({element:this.helpTooltipElement,stopEvent:!1,offset:[15,0],positioning:"center-left"}),n.addOverlay(this.helpTooltip)},createStylingMeasureInteraction:function(n){this.options.styles=n||{},logger$c.trace("style start",this.options.styles.start);var e={image:Measures.DEFAULT_POINTER_STYLE,fill:Measures.DEFAULT_DRAW_START_STYLE.getFill(),stroke:Measures.DEFAULT_DRAW_START_STYLE.getStroke()};this.options.styles.hasOwnProperty("pointer")&&this.options.styles.pointer instanceof Image&&(e.image=this.options.styles.pointer),this.options.styles.hasOwnProperty("start")&&this.options.styles.start instanceof Style$1&&(this.options.styles.start.getFill()!=null&&(e.fill=this.options.styles.start.getFill()),this.options.styles.start.getStroke()!=null&&(e.stroke=this.options.styles.start.getStroke())),this.options.styles.start=new Style$1(e),logger$c.trace("style finish",this.options.styles.finish);var i={fill:Measures.DEFAULT_DRAW_FINISH_STYLE.getFill(),stroke:Measures.DEFAULT_DRAW_FINISH_STYLE.getStroke()};this.options.styles.hasOwnProperty("finish")&&this.options.styles.finish instanceof Style$1&&(this.options.styles.finish.getFill()!=null&&(i.fill=this.options.styles.finish.getFill()),this.options.styles.finish.getStroke()!=null&&(i.stroke=this.options.styles.finish.getStroke())),this.options.styles.finish=new Style$1(i)},addMeasureInteraction:function(n){var e=this.getMap(),i=this;this.measureDraw=new Draw({source:this.measureSource,condition:function(s){return s.originalEvent.ctrlKey?(i.sketch&&this.removeLastPoint(),!1):!0},type:n,style:this.options.styles.start||Measures.DEFAULT_DRAW_START_STYLE}),this.measureDraw.setProperties({name:"Measures",source:this}),e.addInteraction(this.measureDraw),this.createMeasureTooltip(e),this.measureDraw.on("drawstart",s=>{i.sketch=s.feature}),this.measureDraw.on("drawend",()=>{if(i.sketch){var s,o,l=i.sketch.getGeometry();if(s=i.format(l),l.getType()==="LineString")o=l.getLastCoordinate();else if(l.getType()==="Polygon")o=l.getInteriorPoint().getCoordinates();else return;i.measureTooltipElement.innerHTML=s,i.measureTooltip.setPosition(o)}i.measureTooltipElement.className="GPmeasureTooltip GPmeasureTooltip-static",i.measureTooltip.setOffset([0,-7]),i.sketch=null,i.measureTooltipElement=null,i.createMeasureTooltip(e)})},initMeasureInteraction:function(){var n=this.getMap();this.measureSource=new VectorSource,this.measureVector=new VectorLayer({source:this.measureSource,style:this.options.styles.finish||Measures.DEFAULT_DRAW_FINISH_STYLE}),this.measureVector.gpResultLayerId="measure",n.addLayer(this.measureVector),n.getControls().forEach(e=>{if(e.CLASSNAME==="LayerSwitcher"){var i=this.measureVector.gpLayerId;e._layers[i].title===i&&e.addLayer(this.measureVector,{title:this.options.layerDescription.title,description:this.options.layerDescription.description})}})}},ElevationPathDOM={_addUID:function(n){var e=this._uid?n+"-"+this._uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPelevationPath"),n.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",n},_createShowElevationPathPictoElement:function(){var n=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowElevationPathPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-elevation fr-btn fr-btn--tertiary",e.setAttribute("aria-label","Calculer un profil altimtrique"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowElevationPathClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowElevationPathClick(s)}),e},_createElevationPathPanelElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPelevationPathPanel"),n.className="GPpanel gpf-panel fr-modal",n},_createElevationPathPanelDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__body fr-modal__body",n},_createDrawingButtonsPluginDiv:function(){var n=document.createElement("div");return n.className="container-buttons-plugin fr-mx-2w",n},_createElevationPathPanelHeaderElement:function(){var n=this,e=document.createElement("div");if(e.className="GPpanelHeader gpf-panel__header fr-modal__header",!checkDsfr()){var i=document.createElement("button");i.id=this._addUID("GPelevationPathPanelInfo"),i.className="GPpanelInfo gpf-btn gpf-btn-icon-info fr-btn fr-btn--secondary gpf-btn--secondary fr-m-1w",i.title="Informations",i.addEventListener?i.addEventListener("click",function(){n.onOpenElevationPathInfoClick()}):i.attachEvent&&i.attachEvent("onclick",function(){n.onOpenElevationPathInfoClick()}),e.appendChild(i)}var s=document.createElement("div");s.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",s.innerHTML="Profil Altimtrique",e.appendChild(s);var o=document.createElement("button");o.id=this._addUID("GPelevationPathPanelReduce"),o.className="GPpanelReduce gpf-btn gpf-btn-icon-reduce fr-btn fr-btn--secondary gpf-btn--secondary",o.title="Masquer le panneau",o.addEventListener?o.addEventListener("click",function(u){typeof n.onReduceElevationPathPanelClick=="function"&&n.onReduceElevationPathPanelClick()},!1):o.attachEvent&&o.attachEvent("onclick",function(u){typeof n.onReduceElevationPathPanelClick=="function"&&n.onReduceElevationPathPanelClick()}),e.appendChild(o);var l=document.createElement("button");l.id=this._addUID("GPelevationPathPanelClose"),l.className="GPpanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",l.title="Fermer le panneau",l.addEventListener?l.addEventListener("click",function(){document.getElementById(n._addUID("GPshowElevationPathPicto")).click()},!1):l.attachEvent&&l.attachEvent("onclick",function(){document.getElementById(n._addUID("GPshowElevationPathPicto")).click()});var c=document.createElement("span");return c.className="GPelementHidden gpf-visible",c.innerText="Fermer",l.appendChild(c),e.appendChild(l),e},_createElevationPathPanelProfilElement:function(){var n=document.createElement("div");n.className="GPelevationPathProfilWrapper";var e=document.createElement("div");return e.id="GPelevationPathProfil",n.appendChild(e),n},_createElevationPathWaitingElement:function(){var n=document.createElement("div");n.id=this._addUID("GPelevationPathCalcWaitingContainer"),n.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden";var e=document.createElement("p");return e.className="GPwaitingContainerInfo gpf-waiting_info",e.innerHTML="Recherche en cours...",n.appendChild(e),n},_createElevationPathInformationsElement:function(){var n=document.createElement("div");n.id=this._addUID("GPelevationPathInformationsContainer"),checkDsfr()||(n.className="GPelementHidden gpf-hidden");var e=document.createElement("p");return e.className="GPelevationPathInformations",e.innerHTML="Aucune information...",n.appendChild(e),n},_addElevationPathInformationsItem:function(n,e){var i=document.getElementById(this._addUID("GPelevationPathInformationsContainer"));if(i){var s=document.createElement("p");s.className="GPelevationPathInformations";var o=document.createElement("span");o.innerText=n;var l=document.createElement("span");l.innerText=e,s.appendChild(o),s.appendChild(l),i.appendChild(s)}return i}},ProfileElevationPathDOM={_getCssProperty:function(n,e){return window.getComputedStyle(n,null).getPropertyValue(e)},_getTextWidth:function(n,e,i=null){var s=this.canvas||(this.canvas=document.createElement("canvas")),o=s.getContext("2d");i===null?o.font=`${this._getCssProperty(e,"font-weight")} ${this._getCssProperty(e,"font-size")} ${this._getCssProperty(e,"font-family")}`:o.font=i;var l=o.measureText(n);return l.width},_dataZToSvgY:function(n,e,i,s){return e-(n-i)*s-.5},_dataDistToSvgX:function(n,e,i,s){return e-i+n*s},_svgXToDataDist:function(n,e,i,s){return(n+i-e)/s},_arrayBisect:function(n,e){let i;if(n.length===0)return 0;for(i=0;i<n.length;i++)if(e<n[i].dist)return i;return i-1},displayProfileByDefault:function(n,e,i,s){var o=i;if(!e||!n)return;const l={fontFamily:"Arial",strokeColor:"#0B6BA7",fillColor:"#00B798",focusLineColor:"#F90"};for(checkDsfr()&&(l.fontFamily="Marianne",l.strokeColor="#2F4077",l.fillColor="#2F4077",l.focusLineColor="#639f6a");e.firstChild;)e.removeChild(e.firstChild);const c={top:25,right:15,bottom:10,left:10};var u=o.options.displayProfileOptions,f=n.points,g=JSON.parse(JSON.stringify(f));g.sort(function(ti,_i){return ti.z-_i.z});var H=g[0].z,Y=g[g.length-1].z,ee=n.distance;let te="m";const ne=document.createElement("div");ne.id="profileElevationByDefault",e.appendChild(ne);var Ye=window.getComputedStyle(e).getPropertyValue("width").replace(/px/,""),xe=window.getComputedStyle(e).getPropertyValue("height").replace(/px/,"");const tt=xe-c.top-c.bottom,et=Ye-c.left-c.right,it=17,rt=this._getTextWidth(Math.round(Y).toLocaleString()+",88",e,`400 10 ${l.fontFamily}`),nt=17,at=15,st=15,ot=this._getTextWidth(Math.round(ee).toLocaleString()+",5",e),ut=1,ht=tt-nt-at,dt=et-it-rt,pt=document.createElementNS("http://www.w3.org/2000/svg","svg");pt.id="profileElevationByDefaultSvg",pt.setAttribute("style","display: block; margin: auto; overflow: visible;"),pt.setAttribute("viewBox",`0 0 ${Ye} ${xe}`),pt.setAttribute("width","100%"),pt.setAttribute("height","100%");const yt=Math.floor(ht/st);let mt;Y===H?mt=.1:mt=Math.pow(10,Math.ceil(Math.log((Y-H)/yt)/Math.log(10)))/2;let St=Math.floor(H/mt)*mt,wt=Math.ceil(Y/mt)*mt;wt===Y&&(wt+=mt),St=Math.round(St*100)/100,wt=Math.round(wt*100)/100;let Rt=Math.round((wt-St)/mt);Rt+1>yt&&(mt=Math.pow(10,Math.ceil(Math.log((Y-H)/yt)/Math.log(10))),St=Math.floor(H/mt)*mt,wt=Math.ceil(Y/mt)*mt,wt===Y&&(wt+=mt),St=Math.round(St*100)/100,wt=Math.round(wt*100)/100,Rt=Math.floor((wt-St)/mt)),Rt=Math.max(Math.round(Rt),1);const Lt=document.createElementNS("http://www.w3.org/2000/svg","g");Lt.setAttribute("class","profile-z-vertical");const Gt=document.createElementNS("http://www.w3.org/2000/svg","g"),vt=ht/Rt;let Et;Y===H?Et=ht/.2:Et=ht/(wt-St);let _t,Ct,ct,ft,bt,Ft;for(let ti=0;ti<=Rt;ti++)_t=document.createElementNS("http://www.w3.org/2000/svg","text"),_t.setAttribute("class","profile-z-graduation"),_t.setAttribute("font-family",l.fontFamily),_t.setAttribute("font-size","10px"),_t.setAttribute("fill","#5E5E5E"),_t.textContent=(Math.round(100*(St+ti*mt))/100).toLocaleString(),Ct=ht-ti*vt,_t.setAttribute("transform",`translate(${it+rt-8}, ${Ct+5})`),_t.setAttribute("text-anchor","end"),Lt.appendChild(_t),ct=Math.round(Ct)-.5,ft=document.createElementNS("http://www.w3.org/2000/svg","g"),bt=document.createElementNS("http://www.w3.org/2000/svg","path"),bt.setAttribute("cs","100,100"),bt.setAttribute("stroke-width","1"),ti!==0?bt.setAttribute("stroke-opacity","0.2"):bt.setAttribute("stroke-opacity","1"),bt.setAttribute("stroke","#000000"),bt.setAttribute("fill","none"),bt.setAttribute("d",`M${it+rt},${ct} L${dt+it+rt},${ct}`),Ft=document.createElementNS("http://www.w3.org/2000/svg","path"),Ft.setAttribute("cs","100,100"),Ft.setAttribute("stroke-width","1"),Ft.setAttribute("stroke-opacity","1"),Ft.setAttribute("stroke","#000000"),Ft.setAttribute("fill","none"),Ft.setAttribute("d",`M${it+rt},${ct} L${it+rt+5},${ct}`),Ft.setAttribute("transform","translate(-5, 0)"),ft.appendChild(Ft),ft.appendChild(bt),Gt.appendChild(ft);var Bt=document.createElementNS("http://www.w3.org/2000/svg","text");Bt.setAttribute("class","profile-z-legend"),Bt.setAttribute("font-family",l.fontFamily),Bt.setAttribute("font-size","11px"),Bt.setAttribute("fill","#5E5E5E"),Bt.textContent="Altitude (m)",Bt.setAttribute("transform",`translate(${it-8}, ${Math.round(ht/2)}) rotate(-90)`),Bt.setAttribute("text-anchor","middle"),Lt.appendChild(Bt),pt.appendChild(Lt),pt.appendChild(Gt),ee>2e3&&(ee/=1e3,te="km");const Xt=Math.floor(dt/ot);let Ot=Math.pow(10,Math.ceil(Math.log(ee/Xt)/Math.log(10)))/2;const It=ee;let xt=Math.floor(It/Ot);xt>Xt?(Ot=Math.pow(10,Math.ceil(Math.log(ee/Xt)/Math.log(10))),xt=Math.floor(It/Ot)):xt<ut&&(Ot=Math.pow(10,Math.ceil(Math.log(ee/Xt)/Math.log(10))-1),xt=Math.floor(It/Ot)),xt=Math.max(xt,1);const Tt=Ot*xt,Ht=document.createElementNS("http://www.w3.org/2000/svg","g");Ht.setAttribute("class","profile-x-vertical");const Dt=document.createElementNS("http://www.w3.org/2000/svg","g"),qt=dt/It,kt=(It-Tt)*qt,$t=Math.round((dt-kt)/xt);let Ut,zt,Yt,Jt,Pt,Mt;for(let ti=0;ti<=xt+1;ti++)Ut=document.createElementNS("http://www.w3.org/2000/svg","text"),Ut.setAttribute("class","profile-x-graduation"),Ut.setAttribute("font-family",l.fontFamily),Ut.setAttribute("font-size","10px"),Ut.setAttribute("fill","#5E5E5E"),ti!==xt+1&&(Ut.textContent=(Math.round(100*ti*Ot)/100).toLocaleString()),zt=it+rt+ti*$t,ti===xt+1&&(zt=it+rt+dt),Ut.setAttribute("transform",`translate(${zt}, ${ht+at+5})`),Ut.setAttribute("text-anchor","middle"),Ht.appendChild(Ut),Yt=zt-.5,Jt=document.createElementNS("http://www.w3.org/2000/svg","g"),Pt=document.createElementNS("http://www.w3.org/2000/svg","path"),Pt.setAttribute("cs","100,100"),Pt.setAttribute("stroke-width","1"),ti!==0?Pt.setAttribute("stroke-opacity","0.2"):Pt.setAttribute("stroke-opacity","1"),Pt.setAttribute("stroke","#000000"),Pt.setAttribute("fill","none"),Pt.setAttribute("d",`M${Yt},${ht} L${Yt},0`),Mt=document.createElementNS("http://www.w3.org/2000/svg","path"),Mt.setAttribute("cs","100,100"),Mt.setAttribute("stroke-width","1"),Mt.setAttribute("stroke-opacity","1"),Mt.setAttribute("stroke","#000000"),Mt.setAttribute("fill","none"),Mt.setAttribute("d",`M${Yt},${ht} L${Yt},${ht-5}`),Mt.setAttribute("transform","translate(0, 5)"),Jt.appendChild(Mt),Jt.appendChild(Pt),Dt.appendChild(Jt);var Nt=document.createElementNS("http://www.w3.org/2000/svg","text");Nt.setAttribute("class","profile-x-legend"),Nt.setAttribute("font-family",l.fontFamily),Nt.setAttribute("font-size","11px"),Nt.setAttribute("fill","#5E5E5E"),Nt.textContent=`Distance (${te})`,Nt.setAttribute("transform",`translate(${it+rt+dt/2}, ${ht+at+nt+3})`),Nt.setAttribute("text-anchor","middle"),Ht.appendChild(Nt),pt.appendChild(Ht),pt.appendChild(Dt);const Wt=document.createElementNS("http://www.w3.org/2000/svg","g");let Vt=1;te==="km"&&(Vt=1e3);let Kt=this._dataDistToSvgX(f[0].dist/Vt,et,dt,qt),Zt=this._dataZToSvgY(f[0].z,ht,St,Et),Qt=`M${Kt},${Zt}`;for(let ti=1;ti<f.length;ti++)Kt=this._dataDistToSvgX(f[ti].dist/Vt,et,dt,qt),Zt=this._dataZToSvgY(f[ti].z,ht,St,Et),Qt+=` L${Kt},${Zt}`;const ri=document.createElementNS("http://www.w3.org/2000/svg","path");ri.setAttribute("cs","100,100"),ri.setAttribute("stroke-width","1"),ri.setAttribute("stroke-opacity","1"),ri.setAttribute("stroke",l.strokeColor),ri.setAttribute("fill","none"),ri.setAttribute("d",Qt),Qt+=` L${Kt},${ht}`,Qt+=` L${et-dt},${ht}`;const ai=document.createElementNS("http://www.w3.org/2000/svg","path");ai.setAttribute("cs","100,100"),ai.setAttribute("stroke-width","1"),ai.setAttribute("stroke-opacity","0"),ai.setAttribute("stroke","#000000"),ai.setAttribute("fill",l.fillColor),ai.setAttribute("fill-opacity","0.2"),ai.setAttribute("d",Qt),Wt.appendChild(ri),Wt.appendChild(ai),pt.appendChild(Wt);const hi=document.createElementNS("http://www.w3.org/2000/svg","g"),ui=document.createElementNS("http://www.w3.org/2000/svg","rect");ui.setAttribute("width",dt),ui.setAttribute("height",ht),ui.setAttribute("transform",`translate(${et-dt},0)`),ui.setAttribute("visibility","hidden"),ui.setAttribute("pointer-events","all");const pi=JSON.parse(JSON.stringify(f));pi.sort(function(ti,_i){return ti.dist-_i.dist});const oi=document.createElementNS("http://www.w3.org/2000/svg","line");oi.setAttribute("id","focusLineX"),oi.setAttribute("class","focusLine-default"),oi.setAttribute("fill","none"),oi.setAttribute("stroke",l.focusLineColor),oi.setAttribute("stroke-width","0.5px"),oi.setAttribute("visibility","hidden");const ei=document.createElementNS("http://www.w3.org/2000/svg","line");ei.setAttribute("id","focusLineY"),ei.setAttribute("class","focusLine-default"),ei.setAttribute("fill","none"),ei.setAttribute("stroke",l.focusLineColor),ei.setAttribute("stroke-width","0.5px"),ei.setAttribute("visibility","hidden");const li=document.createElementNS("http://www.w3.org/2000/svg","circle");li.setAttribute("id","focusCircle"),li.setAttribute("r",4),li.setAttribute("class","circle-default focusCircle-default"),li.setAttribute("fill",l.focusLineColor),li.setAttribute("visibility","hidden"),hi.appendChild(li),hi.appendChild(oi),hi.appendChild(ei);const si=document.createElementNS("http://www.w3.org/2000/svg","text"),ni=document.createElementNS("http://www.w3.org/2000/svg","tspan"),fi=document.createElementNS("http://www.w3.org/2000/svg","tspan"),Ei=document.createElementNS("http://www.w3.org/2000/svg","tspan");si.setAttribute("style",`text-align:center; max-width:220px; font-size:10px; color:#000000; font-family:${l.fontFamily}; z-index:50;`),si.style.pointerEvents="none",si.style.position="fixed",si.setAttribute("class","tooltipInit"),si.setAttribute("text-anchor","middle"),ne.appendChild(si),ni.setAttribute("class","altiPathValue"),ni.setAttribute("x","0"),ni.setAttribute("dy","-.7em"),fi.setAttribute("class","altiPathValue"),fi.setAttribute("x","0"),fi.setAttribute("dy","1em"),Ei.setAttribute("class","altiPathCoords"),Ei.setAttribute("x","0"),Ei.setAttribute("dy","1em"),si.appendChild(ni),u.currentSlope&&si.appendChild(fi),si.appendChild(Ei);const mi=document.createElementNS("http://www.w3.org/2000/svg","g");hi.appendChild(mi);const Ci=document.createElementNS("http://www.w3.org/2000/svg","path");Ci.setAttribute("cs","100,100"),Ci.setAttribute("fill","#FFFFFF"),Ci.setAttribute("stroke","#CCCCCC"),Ci.setAttribute("fill-opacity","0.8"),Ci.setAttribute("stroke-width","1"),Ci.setAttribute("stroke-opacity","1");const di=document.createElementNS("http://www.w3.org/2000/svg","path");di.setAttribute("cs","100,100"),di.setAttribute("fill","#FFFFFF"),di.setAttribute("stroke","#000000"),di.setAttribute("fill-opacity","0"),di.setAttribute("stroke-width","1"),di.setAttribute("stroke-opacity","0.4"),di.setAttribute("transform","translate(1,1)"),mi.appendChild(di),mi.appendChild(Ci),mi.appendChild(si),mi.setAttribute("class","tooltipInit"),mi.style.pointerEvents="none";function xi(){oi.setAttribute("visibility","visible"),ei.setAttribute("visibility","visible"),li.setAttribute("visibility","visible"),s.__createProfileMarker(o,f[0]),si.classList.remove("tooltipInit"),mi.classList.remove("tooltipInit"),si.classList.remove("tooltipFadeOut"),mi.classList.remove("tooltipFadeOut"),si.classList.add("tooltipFadeIn"),mi.classList.add("tooltipFadeIn")}function Ai(){oi.setAttribute("visibility","hidden"),ei.setAttribute("visibility","hidden"),li.setAttribute("visibility","hidden"),s.__removeProfileMarker(o),si.classList.remove("tooltipFadeIn"),mi.classList.remove("tooltipFadeIn"),si.classList.add("tooltipFadeOut"),mi.classList.add("tooltipFadeOut")}function Ii(ti){const _i=pt.createSVGPoint();_i.x=ti.clientX,_i.y=ti.clientY;const wi=_i.matrixTransform(pt.getScreenCTM().inverse()),ci=this._svgXToDataDist(wi.x,et,dt,qt)*Vt,yi=Math.max(1,this._arrayBisect(pi,ci)),bi=f[yi-1],ki=f[yi];let Li=bi;ci-bi.dist>ki.dist-ci&&(Li=ki);const Di=this._dataDistToSvgX(Li.dist/Vt,et,dt,qt),Oi=this._dataZToSvgY(Li.z,ht,St,Et);li.setAttribute("cx",Di),li.setAttribute("cy",Oi),oi.setAttribute("x1",Di),oi.setAttribute("y1",ht),oi.setAttribute("x2",Di),oi.setAttribute("y2",0),ei.setAttribute("x1",it+rt),ei.setAttribute("y1",Oi),ei.setAttribute("x2",dt+it+rt),ei.setAttribute("y2",Oi),s.__updateProfileMarker(o,Li);const zi=`Altitude : ${Li.z.toLocaleString()} m`,er=`Pente : ${Li.slope} %`,Vi=`(lat : ${Li.lat.toLocaleString()} / lon : ${Li.lon.toLocaleString()})`;ni.innerHTML=zi,fi.innerHTML=er,Ei.innerHTML=Vi;const Ri=Math.max(this._getTextWidth(Vi,Ei),this._getTextWidth(zi,ni));let Ni;Li.dist>ee*Vt/2?(Ni=`M -0.5 -0.5 l -6 6 l 0 16 l -${Ri+10} 0 l 0 -44 l ${Ri+10} 0 l 0 16 l 6 6`,si.setAttribute("transform",`translate(${-(Ri/2+12)},0)`)):Li.dist<=ee*Vt/2&&(Ni=`M -0.5 -0.5 l 6 6 l 0 16 l ${Ri+10} 0 l 0 -44 l -${Ri+10} 0 l 0 16 l -6 6`,si.setAttribute("transform",`translate(${Ri/2+12},0)`)),Ci.setAttribute("d",Ni),di.setAttribute("d",Ni),mi.setAttribute("transform",`translate(${Di},${Oi})`),mi.style.transform=`translate(${Di}px,${Oi}px)`}return ui.addEventListener("pointerover",xi),ui.addEventListener("pointerout",Ai),ui.addEventListener("pointermove",Ii.bind(this)),hi.appendChild(ui),pt.appendChild(hi),ne.appendChild(pt),e},displayProfileRaw:function(n,e,i,s){if(e){for(;e.firstChild;)e.removeChild(e.firstChild);var o=n&&n.points?n.points:{},l=document.createElement("textarea");return l.id="profilElevationResults",l.rows=10,l.cols=50,l.style.width="100%",l.innerHTML=JSON.stringify(o,void 0,4),l.addEventListener("mouseover",function(c){s.__customRawProfileMouseOverEvent(i,c)}),e.appendChild(l),e}},displayProfileLibD3:function(n,e,i,s){var o=i;if(e&&n){for(;e.firstChild;)e.removeChild(e.firstChild);var l=n.points;if(n.distance>2e3){n.unit="km";for(let ot=0;ot<l.length;ot++)l[ot].dist/=1e3}var c=o.options.displayProfileOptions,u={top:20,right:20,bottom:30,left:40},f=window.getComputedStyle(e).getPropertyValue("width"),g=window.getComputedStyle(e).getPropertyValue("height"),H=f.replace(/px/,"")-u.left-u.right,Y=g.replace(/px/,"")-u.top-u.bottom,ee=d3.scale.linear().range([0,H]),te=d3.scale.linear().range([Y,0]),ne=d3.svg.axis().scale(ee).orient("bottom").ticks(5),Ye=d3.svg.axis().scale(te).orient("left").ticks(5),xe=d3.svg.line().interpolate("basis").x(function(ot){return ee(ot.dist)}).y(function(ot){return te(ot.z)}),tt=d3.svg.area().interpolate("basis").x(function(ot){return ee(ot.dist)}).y0(Y).y1(function(ot){return te(ot.z)}),et=d3.select(e).append("svg").attr("width",H+u.left+u.right).attr("height",Y+u.top+u.bottom).append("g").attr("transform","translate("+u.left+","+u.top+")"),it=d3.extent(l,function(ot){return ot.dist});ee.domain(it);var rt=[0,d3.max(l,function(ot){return ot.z})];te.domain(rt),et.append("path").datum(l).attr("class","area-d3").attr("d",tt),et.append("g").attr("class","x axis-d3").attr("transform","translate(0,"+Y+")").call(ne).append("text").attr("y",-15).attr("dy",".71em").attr("x",H).text("Distance ("+n.unit+")"),et.append("g").attr("class","y axis-d3").call(Ye).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").text("Altitude (m)"),et.append("g").attr("class","grid-d3 vertical").attr("transform","translate(0,"+Y+")").call(ne.orient("bottom").tickSize(-Y,0,0).tickFormat("")),et.append("g").attr("class","grid-d3 horizontal").call(Ye.orient("left").tickSize(-H,0,0).tickFormat("")),et.append("path").datum(l).attr("class","line-d3").attr("d",xe),et.selectAll("circle").data(l).enter().append("circle").attr("cx",function(ot){return ee(ot.dist)}).attr("cy",function(ot){return te(ot.z)}).attr("r",0).attr("class","circle-d3");var nt=et.append("g").style("display","none");nt.append("line").attr("id","focusLineX").attr("class","focusLine-d3"),nt.append("line").attr("id","focusLineY").attr("class","focusLine-d3"),nt.append("circle").attr("id","focusCircle").attr("r",4).attr("class","circle-d3 focusCircle-d3");var at=d3.select(e).append("div").attr("class","tooltip-d3").style("opacity",0),st=d3.bisector(function(ot){return ot.dist}).left;return et.append("rect").attr("class","overlay-d3").attr("width",H).attr("height",Y).on("mouseover",function(){nt.style("display",null),s.__createProfileMarker(o,l[0])}).on("mouseout",function(){nt.style("display","none"),s.__removeProfileMarker(o),at.transition().duration(500).style("opacity",0)}).on("mousemove",function(){var ot=d3.mouse(this),ut=ee.invert(ot[0]),ht=Math.max(1,st(l,ut)),dt=l[ht-1],pt=l[ht],yt=ut-dt[0]>pt[0]-ut?pt:dt,mt=ee(yt.dist),St=te(yt.z);nt.select("#focusCircle").attr("cx",mt).attr("cy",St),nt.select("#focusLineX").attr("x1",mt).attr("y1",te(rt[0])).attr("x2",mt).attr("y2",te(rt[1])),nt.select("#focusLineY").attr("x1",ee(it[0])).attr("y1",St).attr("x2",ee(it[1])).attr("y2",St),s.__updateProfileMarker(o,yt),at.transition().duration(200).style("opacity",.9);var wt="";wt+=" Altitude : "+yt.z+" m",c.currentSlope&&(wt+="<br/> Pente : "+yt.slope+" %"),wt+="<br/> (Lat : "+yt.lat+"/ Lon : "+yt.lon+")",at.html(wt).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}),et}},displayProfileLibAmCharts:function(n,e,i,s){var o=i;if(e&&n){var l=n.points,c="<span class='altiPathValue'>[[title]] : [[value]]m</span><br/>",u=o.options.displayProfileOptions.currentSlope;if(u&&(c+="<span class='altiPathValue'>Pente : [[slope]] %</span><br/>"),c+="<span class='altiPathCoords'>(Lat: [[lat]] / Lon:[[lon]])</span>",AmCharts.addInitHandler(function(){}),n.distance>2e3){n.unit="km";for(let ee=0;ee<l.length;ee++)l[ee].dist/=1e3}for(let ee=0;ee<l.length;ee++){var f=l[ee].dist,g=100;f>100?g=1:f>10&&(g=10),f=Math.round(f*g)/g,l[ee].dist=f}var H={type:"serial",pathToImages:"http://cdn.amcharts.com/lib/3/images/",categoryField:"dist",autoMarginOffset:0,marginRight:10,marginTop:10,startDuration:0,color:"#5E5E5E",fontSize:8,theme:"light",thousandsSeparator:"",numberFormatter:{precision:-1,decimalSeparator:",",thousandsSeparator:" "},categoryAxis:{color:"#5E5E5E",gridPosition:"start",minHorizontalGap:40,tickPosition:"start",title:"Distance ("+n.unit+")",titleColor:"#5E5E5E",labelOffset:0,startOnAxis:!0},chartCursor:{animationDuration:0,bulletsEnabled:!0,bulletSize:10,categoryBalloonEnabled:!1,cursorColor:"#F90",graphBulletAlpha:1,graphBulletSize:1,zoomable:!1},trendLines:[],graphs:[{balloonColor:"#CCCCCC",balloonText:c,bullet:"round",bulletAlpha:0,bulletBorderColor:"#FFF",bulletBorderThickness:2,bulletColor:"#F90",bulletSize:6,hidden:!1,id:"AmGraph-1",fillAlphas:.4,fillColors:"#C77A04",lineAlpha:1,lineColor:"#C77A04",lineThickness:1,title:"Altitude",valueField:"z"}],guides:[],valueAxes:[{id:"ValueAxis-1",minVerticalGap:20,title:"Altitude (m)"}],balloon:{borderColor:"#CCCCCC",borderThickness:1,fillColor:"#FFFFFF",showBullet:!0},titles:[],allLabels:[],dataProvider:l},Y=AmCharts.makeChart(e,H);return Y.addListener("changed",function(ee){var te=ee.chart.dataProvider[ee.index];s.__updateProfileMarker(o,te)}),Y}}},logger$b=LoggerByDefault.getLogger("elevationpath");const Si=class Si extends ControlExtended{constructor(e){if(logger$b.trace("ElevationPath()"),e=e||{},super(e),!(this instanceof Si))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="ElevationPath",this._uid=e.id||SelectorID.generate(),this._showContainer=null,this._pictoButton=null,this._panelContainer=null,this._profileContainer=null,this._waitingContainer=null,this._infoContainer=null,this._timerHdlr=null,this._drawStyleStart=null,this._drawStyleFinish=null,this._markerStyle=null,this._profile=null,this._data={},this._measureSource=null,this._measureVector=null,this._measureDraw=null,this._lastSketch=null,this._currentSketch=null,this._marker=null,this._initialize(e),this._container=this._initializeContainer(),this.element?this.element.appendChild(this._container):this.element=this._container,this}static __removeProfileMarker(e){var i=e;i._marker&&(i._measureSource.removeFeature(i._marker),i._marker=null)}static __createProfileMarker(e,i){var s=e;s._marker&&(s._measureSource.removeFeature(s._marker),s._marker=null);var o=s.getMap(),l=o.getView().getProjection(),c=transform$1([i.lon,i.lat],"EPSG:4326",l),u=s._measureSource.getFeatures()[0].getGeometry().getClosestPoint(c),f=new Point$1(u);s._marker=new Feature({geometry:f}),logger$b.trace(f),s._marker.setStyle(s._markerStyle),s._measureSource.addFeature(s._marker)}static __updateProfileMarker(e,i){var s=e;Si.__removeProfileMarker(s),Si.__createProfileMarker(s,i)}static __customRawProfileOperation(e,i){logger$b.log("__customRawProfileOperation");for(var s=e,o=i.points,l=s.getMap().getView().getProjection(),c=0;c<o.length;c++){var u=o[c],f=transform$1([u.lon,u.lat],"EPSG:4326",l),g=new Point$1(f);s._marker=new Feature({geometry:g}),logger$b.trace(g);var H=Si.DEFAULT_STYLES.RESULTS,Y=new CircleStyle({radius:H.imageRadius,stroke:new Stroke({color:H.imageStrokeColor,width:H.imageStrokeWidth}),fill:new Fill({color:H.imageFillColor})});s._marker.setStyle(new Style$1({image:Y})),s._measureSource.addFeature(s._marker)}}static __customRawProfileMouseOverEvent(e,i){logger$b.log("__customRawProfileMouseOverEvent",e,i)}static DISPLAY_PROFILE_LIB_AMCHARTS(e,i,s){if(logger$b.trace("ElevationPath.DISPLAY_PROFILE_LIB_AMCHARTS"),typeof AmCharts>"u"){logger$b.log("Lib. AmCharts is not loaded !");return}var o=ProfileElevationPathDOM.displayProfileLibAmCharts(e,i,s,Si);o&&(this._profile=o)}static DISPLAY_PROFILE_LIB_D3(e,i,s){if(logger$b.trace("ElevationPath.DISPLAY_PROFILE_LIB_D3"),typeof d3>"u"){logger$b.log("Lib. D3 is not loaded !");return}var o=ProfileElevationPathDOM.displayProfileLibD3(e,i,s,Si);o&&(this._profile=o)}static DISPLAY_PROFILE_RAW(e,i,s){logger$b.trace("ElevationPath.DISPLAY_PROFILE_RAW");var o=ProfileElevationPathDOM.displayProfileRaw(e,i,s,Si);o&&(this._profile=o)}static DISPLAY_PROFILE_BY_DEFAULT(e,i,s){logger$b.trace("ElevationPath.DISPLAY_PROFILE_BY_DEFAULT");var o=ProfileElevationPathDOM.displayProfileByDefault(e,i,s,Si);o&&(this._profile=o)}setMap(e){if(logger$b.trace("ElevationPath::setMap"),e&&(this.options.active&&(this._profile===null&&(this._panelContainer.style.display="none"),this._initMeasureInteraction(e),this._addMeasureInteraction(e)),!this.options.target&&!this.options.position&&MeasureToolBox.add(e,this),this.options.export)){var i=Helper.assign({control:this},this.options.export);this.export=new ButtonExport(i),this.export.render();var s=this;this.export.on("button:clicked",o=>{s.dispatchEvent({type:"export:compute",content:o.content})})}super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getActive(){return logger$b.trace("ElevationPath::getActive"),this.options.active}setActive(e){logger$b.trace("ElevationPath::setActive"),this.options.active=e}getData(){return Helper.assign({type:"elevationpath"},this._data)}setData(e){this._data=e}getContainer(){return this._container}getLayer(){return this._measureVector}setLayer(e){if(!e){this._measureVector=null;return}if(!(e instanceof VectorLayer)){logger$b.log("no valid layer given for hosting drawn features.");return}e.setStyle(this._drawStyleFinish),this._measureVector=e,this._measureSource=e.getSource()}getGeoJSON(){var e=this._measureVector.getSource().getFeatures(),i=new GeoJSON({defaultStyle:this._drawStyleFinish}),s=i.writeFeatures(e,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});return s}getStyle(){return this._drawStyleFinish}clean(e){logger$b.trace("ElevationPath::clean");var i=this.getMap();this._panelContainer.style.display="none",this._pictoButton.setAttribute("aria-pressed",!1),this._removeProfile(),this._removeMeasureInteraction(i,typeof e<"u"?e:!1),this.setLayer()}init(){this._pictoButton.setAttribute("aria-pressed",!0),this._panelContainer.style.display="block",this._displayProfile(this._data),this._waitingContainer.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden"}_initialize(e){logger$b.trace("ElevationPath::_initialize : ",e),this.options={target:null,render:null,active:!1,apiKey:null,export:!1,elevationOptions:{outputFormat:"json"},layerDescription:{title:"Profil altimtrique",description:"Mon profil altimtrique"},displayProfileOptions:{totalDistance:!0,greaterSlope:!0,meanSlope:!0,ascendingElevation:!0,descendingElevation:!0,currentSlope:!0,apply:null,target:null},stylesOptions:{profile:null,draw:null,marker:null}},Helper.mergeParams(this.options,e),this.options.target=e.target||null,this.options.apiKey=e.apiKey;var i=e.displayProfileOptions||{};this.export=null;var s=i.apply;this.options.displayProfileOptions.apply=typeof s=="function"?s:Si.DISPLAY_PROFILE_BY_DEFAULT;var o=i.target;this.options.displayProfileOptions.target=typeof o<"u"?o:null;var l=e.stylesOptions||{};this.options.stylesOptions.draw=l.draw||{},this._createStylingDraw(),this.options.stylesOptions.marker=l.marker||{},this._createStylingMarker(),this.COMPUTE_ELEVATION_EVENT="elevationpath:compute",this.DRAW_START_ELEVATION_EVENT="elevationpath:drawstart",this.DRAW_END_ELEVATION_EVENT="elevationpath:drawend"}_initializeContainer(){logger$b.trace("ElevationPath::_initializeContainer : ",this._uid);var e=this._createMainContainerElement(),i=this._pictoButton=this._createShowElevationPathPictoElement();e.appendChild(i),this.options.active&&this._pictoButton.click();var s=this._panelContainer=this._createElevationPathPanelElement(),o=this._createElevationPathPanelDivElement();s.appendChild(o);var l=this._createElevationPathPanelHeaderElement();o.appendChild(l);var c=this._createElevationPathPanelProfilElement();this._profileContainer=c.firstChild,o.appendChild(c);var u=this._waitingContainer=this._createElevationPathWaitingElement();o.appendChild(u);var f=this._infoContainer=this._createElevationPathInformationsElement();o.appendChild(f);var g=this._createDrawingButtonsPluginDiv();return o.appendChild(g),this.options.displayProfileOptions.target===null&&e.appendChild(s),e}_createStylingMarker(){logger$b.trace("ElevationPath::_createStylingMarker ");var e=Si.DEFAULT_STYLES.MARKER;logger$b.trace("style marker",e),this.options.stylesOptions.marker instanceof ImageStyle&&(e=this.options.stylesOptions.marker),this._markerStyle=new Style$1({image:e})}_createStylingDraw(){logger$b.trace("ElevationPath::_createStylingDraw");var e=this.options.stylesOptions.draw;logger$b.trace("style start",e.start);var i={image:Measures.DEFAULT_POINTER_STYLE,stroke:Measures.DEFAULT_DRAW_START_STYLE.getStroke()};e.hasOwnProperty("pointer")&&e.pointer instanceof ImageStyle&&(i.image=e.pointer),e.hasOwnProperty("start")&&e.start instanceof Stroke&&(i.stroke=e.start),this._drawStyleStart=new Style$1(i),logger$b.trace("style finish",e.finish);var s={stroke:Measures.DEFAULT_DRAW_FINISH_STYLE.getStroke()};e.hasOwnProperty("finish")&&e.finish instanceof Stroke&&(s.stroke=e.finish),this._drawStyleFinish=new Style$1(s)}_createStylingProfile(){logger$b.trace("ElevationPath::_createStylingProfile");var e=this.options.stylesOptions.profile;logger$b.trace("style profile",e);var i=Si.DEFAULT_STYLES.PROFILE;Object.keys(i).forEach(s=>{if(!e.hasOwnProperty(s))e[s]=i[s];else{var o=i[s];typeof o=="object"&&(Helper.mergeParams(o,e[s]),e[s]=o)}})}_initMeasureInteraction(e){logger$b.trace("ElevationPath::_initMeasureInteraction()"),e&&(this._measureSource=new VectorSource,this._measureVector=new VectorLayer({source:this._measureSource,style:this._drawStyleFinish}),this._measureVector.gpResultLayerId="measure:profil",e.addLayer(this._measureVector),e.getControls().forEach(i=>{if(i instanceof LayerSwitcher){var s=this._measureVector.gpLayerId;i._layers[s].title===s&&i.addLayer(this._measureVector,{title:this.options.layerDescription.title,description:this.options.layerDescription.description})}}))}_addMeasureInteraction(e){logger$b.trace("ElevationPath::_addMeasureInteraction()"),e&&(this._measureDraw=new Draw({source:this._measureSource,type:"LineString",style:this._drawStyleStart,stopClick:!0}),this._measureDraw.setProperties({name:"ElevationPath",source:this}),e.addInteraction(this._measureDraw),this._measureDraw.on("drawstart",i=>{logger$b.trace("drawstart",i),this._marker!==null&&(this._measureSource.removeFeature(this._marker),this._marker=null),this._lastSketch!==null&&(this._measureSource.removeFeature(this._lastSketch),this._lastSketch=null),this._currentSketch=i.feature;for(var s=this._measureSource.getFeatures(),o=0;o<s.length;o++)this._measureSource.removeFeature(s[o]);this.dispatchEvent(this.DRAW_START_ELEVATION_EVENT)}),this._measureDraw.on("drawend",i=>{logger$b.trace("drawend",i),this.dispatchEvent(this.DRAW_END_ELEVATION_EVENT),this._lastSketch=this._currentSketch,typeof this.options.elevationOptions.onSuccess>"u"&&this.options.displayProfileOptions.target===null&&(this._panelContainer.style.display="block"),this._measureDraw.setActive(!1),this._requestService()}))}_removeMeasureInteraction(e,i){logger$b.trace("ElevationPath::_removeMeasureInteraction()"),e&&(i&&this._measureVector&&(e.removeLayer(this._measureVector),this._measureVector=null),this._measureDraw&&(e.removeInteraction(this._measureDraw),this._measureDraw=null))}_getGeometry(){if(this._currentSketch===null){logger$b.warn("Current Feature undefined !?");return}for(var e=[],i=this.getMap(),s=i.getView().getProjection(),o="EPSG:4326",l=this._currentSketch.getGeometry().getCoordinates(),c=0;c<l.length;c++){var u=l[c],f=u;s!==o&&(f=transform$1(u,s,o)),e.push({lon:Math.round(f[0]*1e8)/1e8,lat:Math.round(f[1]*1e8)/1e8})}return e}_getLength(){if(this._currentSketch===null){logger$b.warn("Current Feature undefined !?");return}for(var e=0,i=this.getMap(),s=i.getView().getProjection(),o="EPSG:4326",l=this._currentSketch.getGeometry().getCoordinates(),c=0,u=l.length-1;c<u;++c){var f=transform$1(l[c],s,o),g=transform$1(l[c+1],s,o);f[0]=Math.round(f[0]*1e8)/1e8,f[1]=Math.round(f[1]*1e8)/1e8,g[0]=Math.round(g[0]*1e8)/1e8,g[1]=Math.round(g[1]*1e8)/1e8,e+=getDistance(f,g)}return e}_getSketchCoords(){if(this._currentSketch===null){logger$b.warn("Current Feature undefined !?");return}for(var e=this.getMap(),i=e.getView().getProjection(),s="EPSG:4326",o=[],l=this._currentSketch.getGeometry().getCoordinates(),c=0;c<l.length;c++){var u=transform$1(l[c],i,s);u[0]=Math.round(u[0]*1e8)/1e8,u[1]=Math.round(u[1]*1e8)/1e8,o.push(u)}return o}_requestService(){logger$b.trace("ElevationPath::_requestService");var e=this._getGeometry();if(logger$b.trace("geometry",e),!e){logger$b.warn("missing geometry !?");return}var i={};Helper.mergeParams(i,this.options.elevationOptions),Helper.mergeParams(i,{apiKey:i.apiKey||this.options.apiKey}),typeof i.ssl!="boolean"&&(typeof this.options.ssl=="boolean"?i.ssl=this.options.ssl:i.ssl=!0),Helper.mergeParams(i,{ssl:i.ssl});var s=this,o=this.options.elevationOptions.onFailure!==null&&typeof this.options.elevationOptions.onFailure=="function",l=this.options.elevationOptions.onSuccess!==null&&typeof this.options.elevationOptions.onSuccess=="function",c=function(H){logger$b.trace(H),H&&(s._panelContainer.style.display="block",s._data&&(s._data={}),s._data=s._computeElevationMeasure(H.elevations),s._displayProfile(s._data),s._waitingContainer.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden",s._waiting=!1,s._measureDraw.setActive(!0)),l&&s.options.elevationOptions.onSuccess.call(s,s.getData())},u=function(H){s._panelContainer.style.display="none",logger$b.error(H.message),s._waitingContainer.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden",s._waiting=!1,s._measureDraw.setActive(!0),o&&s.options.elevationOptions.onFailure.call(s,H)};Helper.mergeParams(i,{onSuccess:c,onFailure:u});var f=i.sampling||200,g=Math.max(50,Math.floor(this._getLength())/5);g>200?f=200:f=Math.floor(g),f>0&&Helper.mergeParams(i,{sampling:f}),Helper.mergeParams(i,{positions:e}),logger$b.trace("options du service",i),this._waitingContainer.className="GPwaitingContainer GPwaitingContainerVisible gpf-waiting gpf-waiting--visible",Gp.Services.getAltitude(i)}_computeElevationMeasure(e){logger$b.trace("ElevationPath::_computeElevationMeasure",e);var i=e,s="m",o=this._getSketchCoords();if(o){i[0].dist=0,i[0].slope=0,i[0].oldlat=i[0].lat,i[0].oldlon=i[0].lon,i[0].lat=Math.round(i[0].lat*1e5)/1e5,i[0].lon=Math.round(i[0].lon*1e5)/1e5;for(var l=0,c=0,u=0,f=0,g=0,H=0,Y=[],ee=1;ee<i.length;ee++){var te=[i[ee].lon,i[ee].lat],ne=getDistance(te,[i[ee-1].oldlon,i[ee-1].oldlat]),Ye=ne+g,xe=i[ee].z,tt=i[ee-1].z;xe<0&&(xe=0),tt<0&&(tt=0);var et=xe-tt;et<0?(l+=ne,f+=et):et>0&&(c+=ne,u+=et),g=Ye,i[ee].dist=Ye,H+=et?Math.abs(Math.round(et/ne*100)):0,i[ee].slope=et?Math.abs(Math.round(et/ne*100)):0;var it=i[ee].slope;it>15&&it<30?i[ee].color="#005b4c":it>30&&it<45?i[ee].color="#00362d":it>45?i[ee].color="#00120f":i[ee].color="#00B798",i[ee].oldlat=i[ee].lat,i[ee].oldlon=i[ee].lon,i[ee].lat=Math.round(i[ee].lat*1e5)/1e5,i[ee].lon=Math.round(i[ee].lon*1e5)/1e5}logger$b.trace("List Distances",Y);for(var rt=i[0].z,nt=i[0].z,at=i[0].slope,st=0;st<i.length;st++){var ot=i[st];ot.z<-100&&(ot.z=0),ot.z>nt&&(nt=ot.z),ot.z<rt&&(rt=ot.z),ot.slope>at&&(at=ot.slope)}return{greaterSlope:at,meanSlope:Math.round(H/i.length),distancePlus:c,distanceMinus:l,ascendingElevation:u,descendingElevation:f,altMin:rt.toLocaleString(),altMax:nt.toLocaleString(),distance:this._getLength(),unit:s,points:i}}}_displayProfile(e){logger$b.trace("ElevationPath::_displayProfile",e),this._updateInfoContainer();var i=this.options.displayProfileOptions.target;i&&i.appendChild(this._panelContainer),i=this._profileContainer;var s=this,o=this.options.displayProfileOptions.apply;o.call(this,e,i,s);var l=this.options.displayProfileOptions,c=document.getElementById("GPelevationPathPanelInfo-"+this._uid);c&&(l.totalDistance||l.greaterSlope||l.meanSlope||l.ascendingElevation||l.descendingElevation)&&(c.style.display="block"),this.dispatchEvent(this.COMPUTE_ELEVATION_EVENT)}_updateInfoContainer(){logger$b.trace("ElevationPath::_updateInfoContainer");var e=this.options.displayProfileOptions.totalDistance,i=this.options.displayProfileOptions.meanSlope,s=this.options.displayProfileOptions.greaterSlope,o=this.options.displayProfileOptions.ascendingElevation,l=this.options.displayProfileOptions.descendingElevation,c=this._infoContainer;if(c.childElementCount)for(;c.firstChild;)c.removeChild(c.firstChild);e&&this._addElevationPathInformationsItem("Distance totale",Math.round(this._data.distance).toLocaleString()+" m"),o&&this._addElevationPathInformationsItem("Dnivel positif",this._data.ascendingElevation.toLocaleString()+" m"),l&&this._addElevationPathInformationsItem("Dnivel ngatif",this._data.descendingElevation.toLocaleString()+" m"),i&&this._addElevationPathInformationsItem("Pente moyenne",this._data.meanSlope.toLocaleString()+" %"),s&&this._addElevationPathInformationsItem("Plus forte pente",this._data.greaterSlope.toLocaleString()+" %")}_removeMeasure(){if(this._lastSketch=null,this._currentSketch=null,this._measureSource){this._marker&&(this._measureSource.removeFeature(this._marker),this._marker=null);for(var e=this._measureSource.getFeatures(),i=0;i<e.length;i++)this._measureSource.removeFeature(e[i])}}_removeProfile(){if(this._profile=null,this._profileContainer)for(;this._profileContainer.firstChild;)this._profileContainer.removeChild(this._profileContainer.firstChild)}onShowElevationPathClick(e){var i=this._pictoButton.ariaPressed;i==="true"&&this.onPanelOpen();var s=this.getMap();Interactions.unset(s,{current:"ElevationPath"}),i==="true"?(this._profile===null&&(this._panelContainer.style.display="none"),this._initMeasureInteraction(s),this._addMeasureInteraction(s)):(this._panelContainer.style.display="none",e&&e.target.dataset&&e.target.dataset.removeMeasure?e.target.dataset.removeMeasure==="true"?this._removeMeasure():(this._lastSketch=null,this._currentSketch=null):this._removeMeasure(),this._removeProfile(),e&&e.target.dataset&&e.target.dataset.removeLayer?this._removeMeasureInteraction(s,e.target.dataset.removeLayer==="true"):this._removeMeasureInteraction(s,!0)),this.collapsed=i!=="true",this.dispatchEvent("change:collapsed")}onOpenElevationPathInfoClick(){var e=this._infoContainer;e.className==="GPelementVisible gpf-visible"?(clearTimeout(this._timerHdlr),e.className="GPelementHidden gpf-hidden"):e.className="GPelevationPathInformationsContainerVisible",this._timerHdlr=setTimeout(function(){e.className="GPelementHidden gpf-hidden"},4e3)}};ii(Si,"DEFAULT_STYLES",{MARKER:new Icon({src:Marker.lightOrange,anchor:[.5,1],snapToPixel:!0}),RESULTS:{imageRadius:5,imageFillColor:"rgba(128, 128, 128, 0.2)",imageStrokeColor:"rgba(0, 0, 0, 0.7)",imageStrokeWidth:2}});let ElevationPath=Si;Object.assign(ElevationPath.prototype,ElevationPathDOM);Object.assign(ElevationPath.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.ElevationPath=ElevationPath);var logger$a=LoggerByDefault.getLogger("layerimport");const gi=class gi extends ControlExtended{constructor(e){if(e=e||{},super(e),this.CLASSNAME="LayerImport",!(this instanceof gi))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this._initialize(e),this._container=this._initContainer(e),this.element?this.element.appendChild(this._container):this.element=this._container,this}setMap(e){if(e){var i=this;e.getLayers().on("remove",function(s){s.element.gpResultLayerId==="layerimport:MAPBOX"&&s.element.gpEditorId&&i._mapBoxPanel&&i._importPanel&&(i.cleanMapBoxResults(s.element.gpEditorId),i._mapBoxPanel.classList.replace("GPelementVisible","GPelementHidden"),i._mapBoxPanel.classList.replace("gpf-visible","gpf-hidden"))},i),this.draggable&&Draggable.dragElement(this._importPanel,this._importPanelHeader,e.getTargetElement()),this.collapsed||this._showImportButton.setAttribute("aria-pressed",!0)}super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getCollapsed(){return this.collapsed}setCollapsed(e){if(e===void 0){logger$a.error("[ERROR] LayerImport:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(e?this._panelCloseButton.click():this._showImportButton.click(),this.collapsed=e)}getStaticImportContent(){return this.contentStatic}getServiceImportContent(){return this.contentService}getName(){return this._name}getContainer(){return this._container}_initialize(e){if(this._checkInputOptions(e),this.options={collapsed:!0,draggable:!1,layerTypes:["KML","GPX","GeoJSON","WMS","WMTS","MAPBOX"],webServicesOptions:{},vectorStyleOptions:{KML:{extractStyles:!0,showPointNames:!0,defaultStyle:{}},GPX:{defaultStyle:{}},GeoJSON:{defaultStyle:{}},MapBox:{defaultStyle:{},editor:{}}}},e.vectorStyleOptions&&e.vectorStyleOptions.KML&&e.vectorStyleOptions.KML.extractStyles&&(this.options.vectorStyleOptions.KML.extractStyles=e.vectorStyleOptions.KML.extractStyles),e.vectorStyleOptions&&e.vectorStyleOptions.KML&&e.vectorStyleOptions.KML.showPointNames&&(this.options.vectorStyleOptions.KML.showPointNames=e.vectorStyleOptions.KML.showPointNames),e.vectorStyleOptions&&e.vectorStyleOptions.KML&&e.vectorStyleOptions.KML.defaultStyle?this.options.vectorStyleOptions.KML.defaultStyle=e.vectorStyleOptions.KML.defaultStyle:this.options.vectorStyleOptions.KML.defaultStyle=new Style$1({image:gi.DefaultStyles.image,stroke:gi.DefaultStyles.stroke,fill:gi.DefaultStyles.fill,text:gi.DefaultStyles.text}),e.vectorStyleOptions&&e.vectorStyleOptions.GPX&&e.vectorStyleOptions.GPX.defaultStyle?this.options.vectorStyleOptions.GPX.defaultStyle=e.vectorStyleOptions.GPX.defaultStyle:this.options.vectorStyleOptions.GPX.defaultStyle=new Style$1({image:gi.DefaultStyles.image,stroke:gi.DefaultStyles.stroke,fill:gi.DefaultStyles.fill,text:gi.DefaultStyles.text}),e.vectorStyleOptions&&e.vectorStyleOptions.GeoJSON&&e.vectorStyleOptions.GeoJSON.defaultStyle?this.options.vectorStyleOptions.GeoJSON.defaultStyle=e.vectorStyleOptions.GeoJSON.defaultStyle:this.options.vectorStyleOptions.GeoJSON.defaultStyle=new Style$1({image:gi.DefaultStyles.image,stroke:gi.DefaultStyles.stroke,fill:gi.DefaultStyles.fill,text:gi.DefaultStyles.text}),e.vectorStyleOptions&&e.vectorStyleOptions.MapBox&&e.vectorStyleOptions.MapBox.defaultStyle?this.options.vectorStyleOptions.MapBox.defaultStyle=e.vectorStyleOptions.MapBox.defaultStyle:this.options.vectorStyleOptions.MapBox.defaultStyle=new Style$1({image:gi.DefaultStyles.image,stroke:gi.DefaultStyles.stroke,fill:gi.DefaultStyles.fill,text:gi.DefaultStyles.text}),e.vectorStyleOptions&&e.vectorStyleOptions.MapBox&&e.vectorStyleOptions.MapBox.editor?this.options.vectorStyleOptions.MapBox.editor=e.vectorStyleOptions.MapBox.editor:this.options.vectorStyleOptions.MapBox.editor={title:!0,collapse:!1,themes:!1,layers:!0,style:!0,filter:!1,legend:!0,group:!1},e.vectorStyleOptions&&e.vectorStyleOptions.MapBox&&e.vectorStyleOptions.MapBox.hasOwnProperty("display")?this.options.vectorStyleOptions.MapBox.display=e.vectorStyleOptions.MapBox.display:this.options.vectorStyleOptions.MapBox.display=!0,Array.isArray(e.layerTypes)){for(var i=[],s=0;s<e.layerTypes.length;s++)i.push(e.layerTypes[s]);this.options.layerTypes=i}Helper.mergeParams(this.options,e),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this._uid=this.options.id||SelectorID.generate(),this._waiting=!1,this._timer=null,this._initImportTypes(),this._initDefaultStyles(),this._showImportButton=null,this._importPanel=null,this._panelCloseButton=null,this._importPanelHeader=null,this._importPanelTitle=null,this._importPanelReturnPicto=null,this._formContainer=null,this._staticLocalImportInput=null,this._staticUrlImportInput=null,this._serviceUrlImportInput=null,this._getCapPanel=null,this._getCapPanelHeader=null,this._getCapResultsListContainer=null,this._mapBoxPanel=null,this._mapBoxPanelHeader=null,this._mapBoxResultsListContainer=null,this._waitingContainer=null,this._loadingContainer=null,this._hasGetCapResults=!1,this._getCapRequestUrl=null,this._getCapResponseWMS=null,this._getCapResponseWMSLayers=[],this._getCapResponseWMTS=null,this._getCapResponseWMTSLayers=[],this._hasMapBoxResults=!1,this.contentStatic=null,this._url=null,this._file=null,this._name=null}_checkInputOptions(e){if(e.layerTypes){var i=e.layerTypes;if(!Array.isArray(i))logger$a.warn(`[ol.control.LayerImport] 'options.layerTypes' parameter should be an array. Set default values ["KML", "GPX", "GeoJSON", "WMS", "WMTS"]`),e.layerTypes=["KML","GPX","GeoJSON","WMS","WMTS","MAPBOX"];else{for(var s=["KML","GPX","GEOJSON","WMS","WMTS","WFS","MAPBOX"],o=[],l=0;l<i.length;l++)typeof i[l]!="string"?(o.push(l),logger$a.warn("[ol.control.LayerImport] 'options.layerTypes' elements should be of type string ("+i[l]+")")):(i[l]=i[l].toUpperCase(),s.indexOf(i[l])===-1&&(o.push(l),logger$a.log("[ol.control.LayerImport] options.layerTypes : "+i[l]+" is not a supported type")),i[l]==="GEOJSON"&&(i[l]="GeoJSON"),i[l]==="MAPBOX"&&(i[l]="MAPBOX"));if(o.length!==0)for(var c=o.length-1;c>=0;c--)i.splice(o[c],1)}}}_initDefaultStyles(){var e=this.options.vectorStyleOptions.KML.defaultStyle;this._defaultKMLStyle=new Style$1({image:e.image,stroke:e.stroke,fill:e.fill,text:e.text});var i=this.options.vectorStyleOptions.GPX.defaultStyle;this._defaultGPXStyle=new Style$1({image:i.image,stroke:i.stroke,fill:i.fill,text:i.text});var s=this.options.vectorStyleOptions.GeoJSON.defaultStyle;this._defaultGeoJSONStyle=new Style$1({image:s.image,stroke:s.stroke,fill:s.fill,text:s.text});var o=this.options.vectorStyleOptions.MapBox.defaultStyle;this._defaultMapBoxStyle=new Style$1({image:o.image,stroke:o.stroke,fill:o.fill,text:o.text})}_initImportTypes(){this._currentImportType=this.options.layerTypes[0]||"KML",this._currentImportType==="KML"||this._currentImportType==="GPX"||this._currentImportType==="GeoJSON"||this._currentImportType==="MAPBOX"?this._isCurrentImportTypeStatic=!0:(this._currentImportType==="WMS"||this._currentImportType==="WMTS"||this._currentImportType==="WFS")&&(this._isCurrentImportTypeStatic=!1),this._currentStaticImportType="local"}_initContainer(){var e=this._createMainContainerElement(),i=this._showImportButton=this._createShowImportPictoElement();e.appendChild(i);var s=this._importPanel=this._createImportPanelElement(),o=this._createImportPanelDivElement();s.appendChild(o);var l=this._importPanelHeader=this._createImportPanelHeaderElement(),c=this._importPanelReturnPicto=this._createImportPanelReturnPictoElement();l.appendChild(c);var u=this._importPanelTitle=this._createImportPanelTitleElement();l.appendChild(u);var f=this._panelCloseButton=this._createImportPanelCloseElement();l.appendChild(f),o.appendChild(l);var g=this._formContainer=this._initInputFormElement();o.appendChild(g);var H=this._getCapPanel=this._createImportGetCapPanelElement(),Y=this._getCapResultsListContainer=this._createImportGetCapResultsContainer();H.appendChild(Y),o.appendChild(H);var ee=this._mapBoxPanel=this._createImportMapBoxPanelElement(),te=this._mapBoxResultsListContainer=this._createImportMapBoxResultsContainer();ee.appendChild(te);var ne=this._loadingContainer=this._createLoadingElement();ee.appendChild(ne),o.appendChild(ee);var Ye=this._waitingContainer=this._createImportWaitingElement();return o.appendChild(Ye),e.appendChild(s),e}_initInputFormElement(){var e=this._createImportPanelFormElement(),i=this._createImportTypeLineElement(this.options.layerTypes);e.appendChild(i);var s=this._createImportStaticParamsContainer(this.options.layerTypes[0]),o=this._createStaticNameLabel();s.appendChild(o);var l=this._createStaticModeChoiceDiv(),c=this._createStaticLocalChoiceDiv();l.appendChild(c);var u=this._createStaticUrlChoiceDiv();l.appendChild(u),s.appendChild(l);var f=this._createStaticLocalInputDiv();f.appendChild(this._createStaticLocalInputLabel()),this._staticLocalImportInput=this._createStaticLocalInput(),f.appendChild(this._staticLocalImportInput),s.appendChild(f);var g=this._createStaticUrlInputDiv();g.appendChild(this._createStaticUrlInputLabel()),this._staticUrlImportInput=this._createStaticUrlInput(),g.appendChild(this._staticUrlImportInput),s.appendChild(g),e.appendChild(s);var H=this._createServiceParamsContainer(this.options.layerTypes[0]),Y=this._createServiceUrlDiv();Y.appendChild(this._createServiceUrlInputLabel()),this._serviceUrlImportInput=this._createServiceUrlInput(),Y.appendChild(this._serviceUrlImportInput),H.appendChild(Y),e.appendChild(H);var ee=this._createImportSubmitFormElement();return e.appendChild(ee),e}_onShowImportClick(e){var i=this._showImportButton.ariaPressed;i==="true"&&this.onPanelOpen();var s=this.getMap();Interactions.unset(s),this.collapsed=i!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position),this._hasMapBoxResults?(this._mapBoxPanel.classList.replace("GPelementHidden","GPelementVisible"),this._mapBoxPanel.classList.replace("gpf-hidden","gpf-visible"),this._hideFormContainer()):this._hasGetCapResults?(this._getCapPanel.classList.replace("GPelementHidden","GPelementVisible"),this._getCapPanel.classList.replace("gpf-hidden","gpf-visible"),this._hideFormContainer()):(this._getCapPanel.classList.replace("GPelementVisible","GPelementHidden"),this._getCapPanel.classList.replace("gpf-visible","gpf-hidden"),this._mapBoxPanel.classList.replace("GPelementVisible","GPelementHidden"),this._mapBoxPanel.classList.replace("gpf-visible","gpf-hidden"),this._displayFormContainer())}_onImportTypeChange(e){this._currentImportType=e.target.value,this._currentImportType==="KML"||this._currentImportType==="GPX"||this._currentImportType==="GeoJSON"||this._currentImportType==="MAPBOX"?this._isCurrentImportTypeStatic=!0:(this._currentImportType==="WMS"||this._currentImportType==="WMTS"||this._currentImportType==="WFS")&&(this._isCurrentImportTypeStatic=!1)}_onStaticImportTypeChange(e){this._currentStaticImportType=e.target.value}_onGetCapPanelClose(){(this._currentImportType==="WMS"||this._currentImportType==="WMTS"||this._currentImportType==="WFS")&&this.cleanGetCapResultsList()}_onMapBoxPanelClose(){this.cleanMapBoxResultsList(),this._loadingContainer.className="",this._importPanelReturnPicto.classList.replace("GPelementVisible","GPelementHidden"),this._importPanelReturnPicto.classList.replace("gpf-visible","gpf-hidden"),this._mapBoxPanel.classList.replace("GPelementVisible","GPelementHidden"),this._mapBoxPanel.classList.replace("gpf-visible","gpf-hidden")}_onReturnPictoClick(e){this._onGetCapPanelClose(),this._onMapBoxPanelClose(),this._loadingContainer.className=""}_onImportSubmit(){logger$a.log("import d'une couche de type : "+this._currentImportType),this.contentStatic=null,this.contentService=null,this._isCurrentImportTypeStatic?(this.setCollapsed(!0),this._importStaticLayer()):this._importServiceLayers()}_importStaticLayer(){var e,i=document.getElementById(this._addUID("GPimportName"));i&&(e=i.value||"",logger$a.log("import layer name : "+e)),this._currentStaticImportType==="local"?(logger$a.log("import static layer from local file"),this._importStaticLayerFromLocalFile(e)):this._currentStaticImportType==="url"&&(logger$a.log("import static layer from url"),this._importStaticLayerFromUrl(e))}_importStaticLayerFromUrl(e){var i=this._staticUrlImportInput.value;if(logger$a.log("url : ",i),i.length===0){logger$a.error("[ol.control.LayerImport] url parameter is mandatory");return}i.trim&&(i=i.trim()),this._url=i,e||(e=this._url.substring(this._url.lastIndexOf("/")+1,this._url.lastIndexOf("."))),this._name=e,this.options.webServicesOptions&&this.options.webServicesOptions.proxyUrl&&(i=ProxyUtils.proxifyUrl(i,this.options.webServicesOptions));var s=this;Gp.Protocols.XHR.call({url:i,method:"GET",timeOut:15e3,onResponse:function(o){s._hideWaitingContainer(),s._addFeaturesFromImportStaticLayer(o,e)},onFailure:function(o){s._hideWaitingContainer(),logger$a.error("[ol.control.LayerImport] KML/GPX/GeoJSON/MapBox request failed : ",o)}})}_importStaticLayerFromLocalFile(e){var i=this._staticLocalImportInput.files[0];if(!i){logger$a.warn("[ol.control.LayerImport] missing file");return}this._file=i,e||(e=this._file.name.substring(this._file.name.lastIndexOf("/")+1,this._file.name.lastIndexOf("."))),this._name=e;var s=new FileReader,o=this;s.onerror=l=>{o._hideWaitingContainer(),logger$a.error("error fileReader : ",l)},s.onprogress=()=>{logger$a.log("onprogress")},s.onloadstart=()=>{o._displayWaitingContainer(),logger$a.log("onloadstart")},s.onabort=()=>{o._hideWaitingContainer(),logger$a.log("onabort")},s.onloadend=l=>{logger$a.log("onloadend : ",l)},s.onload=l=>{logger$a.log("fileReader onload - file content : ",l.target.result),o._hideWaitingContainer(),o._addFeaturesFromImportStaticLayer(l.target.result,e)},s.readAsText(i)}_addFeaturesFromImportStaticLayer(e,i){var s=this.getMap();if(!(!s||!e)){var o=null,l=null,c=null,u=null;if(this.contentStatic=e,this._currentImportType==="MAPBOX"){this._hasMapBoxResults=!0;var f=this,g=JSON.parse(e);s.set("mapbox-style",g);var H=g.sources,Y=Object.keys(H).length>1?1:0;for(var ee in H)if(H.hasOwnProperty(ee)){var te="",ne="",Ye=null,xe=null,tt=null,et=null;if(g.metadata){for(var it in g.metadata)if(g.metadata.hasOwnProperty(it)){var rt=it.split(":");if(rt[0]==="geoportail"){var nt=rt[1];if(nt==="title"){te=g.metadata[it];continue}if(nt==="description"){ne=g.metadata[it];continue}if(nt==="quicklookUrl"){Ye=g.metadata[it];continue}if(nt==="legends"){xe=g.metadata[it];continue}if(nt==="metadata"){tt=g.metadata[it];continue}if(nt==="originators"){et=g.metadata[it];continue}}}}te||(te="Couche MapBox"),ne||(ne="Couche MapBox"),te=Y?te+"("+ee+")":te;var at=H[ee],st=at.type;if(st==="vector"){var ot=at.url,ut=at.tiles,ht=g.sprite;if(ot&&ot.indexOf("mapbox://")===0){var dt=this._url;if(dt){if(ut=["a","b","c","d"].map(function(Dt){var qt=ot.replace("mapbox://",""),kt=dt.split("?")[1];return"https://"+Dt+".tiles.mapbox.com/v4/"+qt+"/{z}/{x}/{y}.vector.pbf?"+kt}),ht.indexOf("mapbox://")===0){var pt=dt.split("?");g.sprite=pt[0]+"/sprite?"+pt[1]}}else logger$a.warn("Not yet implemented, can't use the local import scheme with a 'mapbox://' in the file.!")}if(ut)c=new MVT({featureClass:Feature}),l=new VectorTile({attributions:at.attribution,format:c,urls:ut}),l._title=te,l._description=ne,l._quicklookUrl=Ye,l._metadata=tt,l._legends=xe,l._originators=et,l.on("tileloadstart",function(Dt){f._loadingContainer.className="GPmapLoadingVisible"}),l.on("tileloadend",function(Dt){f._loadingContainer.className=""}),l.on("tileloaderror",function(Dt){f._loadingContainer.className=""}),o=new VectorTileLayer({source:l,visible:!1,declutter:!0}),o.id=ee,o.gpResultLayerId="layerimport:"+this._currentImportType;else if(ot){c=new MVT({featureClass:Feature}),o=new VectorTileLayer({visible:!1,declutter:!0}),o.id=ee,o.gpResultLayerId="layerimport:"+this._currentImportType;var yt=new TileJSON({url:ot}),mt=yt.on("change",function(){if(yt.getState()==="ready"){for(var Dt=yt.getTileJSON(),qt=Array.isArray(Dt.tiles)?Dt.tiles:[Dt.tiles],kt=0;kt<qt.length;kt++){var $t=qt[kt];$t.indexOf("http")!==0&&(qt[kt]=ot+$t)}l=new VectorTile({attributions:yt.getAttributions()||Dt.attribution,format:c,urls:qt}),l._title=te,l._description=ne,l._quicklookUrl=Ye,l._metadata=tt,l._legends=xe,l._originators=et,l.on("tileloadstart",function(Ut){f._loadingContainer.className="GPmapLoadingVisible"}),l.on("tileloadend",function(Ut){f._loadingContainer.className=""}),o.setSource(l),o.set("mapbox-extension",Dt.vector_layers),unByKey(mt)}})}}else if(st==="geojson"){var St=at.data;c=new GeoJSON,l=new VectorTile({attributions:at.attribution,format:c,url:St}),l._title=te,l._description=ne,l._quicklookUrl=Ye,l._metadata=tt,l._legends=xe,l._originators=et,o=new VectorTileLayer({source:l,visible:!1,declutter:!0}),o.id=ee,o.gpResultLayerId="layerimport:"+this._currentImportType}else{logger$a.warn("Type MapBox format unknown !");return}var wt=JSON.parse(JSON.stringify(g));if(Y){for(var Rt=wt.layers,Lt=0;Lt<Rt.length;Lt++){var Gt=Rt[Lt];if(Gt.source!==ee){Rt.splice(Lt,1);continue}}for(var vt in wt.sources)wt.sources.hasOwnProperty(vt)&&vt!==ee&&delete wt.sources[vt]}var Et={id:ee,styles:wt,layer:o,options:{title:i||te,description:ne,quicklookUrl:Ye,metadata:tt,legends:xe,originators:et}};(function(Dt){var qt=()=>{applyStyle(Dt.layer,Dt.styles,{source:Dt.id}).then(function(){var Ut=!0;Dt.layer.setVisible(Ut);var zt=1;Dt.layer.setOpacity(zt)}).then(function(){var Ut=s.getView().getProjection().getCode();s.getView()&&Dt.styles.center&&Dt.styles.center.length&&s.getView().setCenter(transform$1(Dt.styles.center,"EPSG:4326",Ut)),s.getView()&&(Dt.styles.zoom||Dt.styles.zoom===0)&&s.getView().setZoom(Dt.styles.zoom);var zt=Dt.layer.getSource();if(s.getView()&&s.getSize()){var Yt=null;zt&&zt.getExtent?Yt=zt.getExtent():Yt=zt.getTileGrid().getExtent(),Yt&&Yt[0]!==1/0&&s.getView().fit(Yt,s.getSize())}}).then(function(){f._hideFormContainer(),f._importPanelHeader.classList.replace("GPelementVisible","GPelementHidden"),f._importPanelHeader.classList.replace("gpf-visible","gpf-hidden"),f._importPanelTitle.innerHTML="Edition des styles";var Ut=new Editor({target:f._mapBoxResultsListContainer,style:JSON.parse(JSON.stringify(Dt.styles)),scope:this,events:{"editor:onloaded":f._onLoadedMapBox,"editor:layer:onclickvisibility":f._onChangeVisibilitySourceMapBox,"editor:style:scale:onchangemin":f._onChangeScaleMinSourceMapBox,"editor:style:scale:onchangemax":f._onChangeScaleMaxSourceMapBox,"editor:legend:onchangevalue":f._onChangeLegendValueSourceMapBox,"editor:legend:onclickedition":f._onDisplayLayerSourceMapBox},tools:f.options.vectorStyleOptions.MapBox.editor});return Ut.setContext("map",s),Ut.setContext("layer",Dt.layer),Ut.createElement().then(function(){if(Ut.getLayers().length===0)throw new Error("Il n'existe pas de styles pour la source demande !?")}).then(function(){f.options.vectorStyleOptions.MapBox.display&&(f._importPanelHeader.classList.replace("GPelementHidden","GPelementVisible"),f._importPanelHeader.classList.replace("gpf-hidden","gpf-visible"),f._mapBoxPanel.classList.replace("GPelementHidden","GPelementVisible"),f._mapBoxPanel.classList.replace("gpf-hidden","gpf-visible"),f._importPanelReturnPicto.classList.replace("GPelementHidden","GPelementVisible"),f._importPanelReturnPicto.classList.replace("gpf-hidden","gpf-visible"))}).then(function(){var zt=f._mapBoxResultsListContainer.getElementsByClassName("GPEditorMapBoxLayerTitleLabel");for(let Yt=0;Yt<zt.length;Yt++){const Jt=zt[Yt];Jt.textContent==="bckgrd"&&(Jt.textContent="Couleur de remplissage")}}).then(function(){Dt.layer.set("mapbox-editor",Ut.getID()),setTimeout(function(){s.dispatchEvent({id:Ut.getID(),type:"editor:loaded",style:Dt.styles,layer:Dt.layer})},100)}).catch(function(zt){throw zt})}).then(function(){s.dispatchEvent({id:Dt.id,type:"render:success",style:Dt.styles})}).catch(function(Ut){logger$a.error(Ut),s.dispatchEvent({id:Dt.id,type:"render:failure",error:Ut})})};logger$a.warn(Dt.layer);var kt=s.get("mapbox-styles")||{},$t=Dt.id;kt[$t]=Dt.styles,s.set("mapbox-styles",kt),Dt.layer.set("mapbox-styles",Dt.styles),s.addLayer(Dt.layer),f.dispatchEvent({type:"layerimport:mapbox:added",name:i,data:e,layer:Dt.layer,format:f._currentImportType.toLowerCase()||"mapbox"}),Dt.layer.getSource()?qt():Dt.layer.once("change:source",qt),s.getControls().forEach(Ut=>{Ut instanceof LayerSwitcher&&Ut.addLayer(Dt.layer,Dt.options)})})(Et)}}else{this._currentImportType==="KML"?(u=this.options.vectorStyleOptions.KML.defaultStyle,c=new KML({showPointNames:this.options.vectorStyleOptions.KML.showPointNames,extractStyles:this.options.vectorStyleOptions.KML.extractStyles,defaultStyle:[u]})):this._currentImportType==="GPX"?(u=this.options.vectorStyleOptions.GPX.defaultStyle,c=new GPX({defaultStyle:u})):this._currentImportType==="GeoJSON"&&(u=this.options.vectorStyleOptions.GeoJSON.defaultStyle,c=new GeoJSON({defaultStyle:u}));var _t=c.readProjection(e),Ct=this._getMapProjectionCode(),ct=null;ct=c.readFeatures(e,{dataProjection:_t,featureProjection:Ct}),logger$a.log("loaded features : ",ct),l=new VectorSource({features:new Collection}),l.addFeatures(ct),logger$a.trace(l),l._title=l._description=i,o=new VectorLayer({source:l,style:u}),o.gpResultLayerId="layerimport:"+this._currentImportType;var ft=c.readRootExtensions("geoportail:compute");if(ft&&Object.keys(ft).length!==0){var bt={route:{class:Route,name:"itineraire"},isocurve:{class:Isocurve,name:"isocurve"},elevationpath:{class:ElevationPath,name:"profil altimetrique"}},Ft=ft.type,Bt=ft.transport;if(Ft){var Xt=bt[Ft].name,Ot=Bt?Xt+" ("+Bt+")":Xt,It=bt[Ft].class;if(It){o.gpResultLayerId="layerimport:COMPUTE",o.set("control",Ft),o.set("name",Xt),o.set("graph",Bt),o.set("data",ft),o.set("title",Ot);var xt=new GeoJSON({defaultStyle:u}),Tt=xt.writeFeatures(ct,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});o.set("geojson",Tt),this.getMap().getControls().forEach(Dt=>{Dt instanceof It&&(Dt.setData(ft),Dt.setLayer(o),Dt.init())})}}}if(s.addLayer(o),s.getView()&&s.getSize()&&l.getExtent){var Ht=l.getExtent();Ht&&Ht[0]!==1/0&&s.getView().fit(Ht,s.getSize())}this.dispatchEvent({type:"layerimport:vector:added",name:i,data:e,layer:o,format:this._currentImportType.toLowerCase()})}}}_addFeaturesFromImportStaticLayerUrl(e,i){var s=this.getMap();if(!(!s||!e)){var o,l,c;if(this._currentImportType==="MAPBOX"?logger$a.trace("Not yet implemented !"):(this._currentImportType==="KML"?c=new KML({showPointNames:!0,extractStyles:this.options.vectorStyleOptions.KML.extractStyles,defaultStyle:[this.options.vectorStyleOptions.KML.defaultStyle]}):this._currentImportType==="GPX"?c=new GPX({defaultStyle:this.options.vectorStyleOptions.GPX.defaultStyle}):this._currentImportType==="GeoJSON"&&(c=new GeoJSON({defaultStyle:this.options.vectorStyleOptions.GeoJSON.defaultStyle})),o=new VectorSource({url:e,format:c}),this._currentImportType==="GPX"&&o.forEachFeature(function(f){f.getStyle()==null&&(logger$a.log("[ol.control.LayerImport] set default style for GPX feature"),f.setStyle(this.options.vectorStyleOptions.GPX.defaultStyle))}),this._currentImportType==="GeoJSON"&&o.forEachFeature(function(f){f.getStyle()==null&&(logger$a.log("[ol.control.LayerImport] set default style for GeoJSON feature"),f.setStyle(this.options.vectorStyleOptions.GeoJSON.defaultStyle))}),o._title=o._description=i,l=new VectorLayer({source:o})),l.gpResultLayerId="layerimport:"+this._currentImportType,s.addLayer(l),s.getView()&&s.getSize()&&o.getExtent){var u=o.getExtent();u&&u[0]!==1/0&&s.getView().fit(u,s.getSize())}this.dispatchEvent({type:"layerimport:vector:added",name:i,url:e,layer:l,format:this._currentImportType.toLowerCase()})}}_onLoadedMapBox(e){}_onChangeVisibilitySourceMapBox(e){var i=e.target.data.obj,s=e.target.srcElement,o=this.getContext("map"),l=this.getContext("layer");if(l.get("mapbox-source")===i.source&&l.get("mapbox-editor")===e.target.editorID){for(var c=l.get("mapbox-styles"),u,f=c.layers,g=0;g<f.length;g++)if(f[g].id===i.id){var H=f[g].layout;H?H.visibility=s.checked?"visible":"none":f[g].layout={visibility:s.checked?"visible":"none"},u=f[g];break}updateMapboxLayer(o,u),Promise.resolve()}}_onChangeScaleMinSourceMapBox(e){var i=e.target.data.obj,s=e.target.srcElement,o=this.getContext("map"),l=this.getContext("layer");if(l.get("mapbox-source")===i.source&&l.get("mapbox-editor")===e.target.editorID){for(var c=l.get("mapbox-styles"),u,f=c.layers,g=0;g<f.length;g++)if(f[g].id===i.id){f[g].minzoom=s.value,s.title=s.value,u=f[g];break}updateMapboxLayer(o,u),Promise.resolve()}}_onChangeScaleMaxSourceMapBox(e){var i=e.target.data.obj,s=e.target.srcElement,o=this.getContext("map"),l=this.getContext("layer");if(l.get("mapbox-source")===i.source&&l.get("mapbox-editor")===e.target.editorID){for(var c=l.get("mapbox-styles"),u,f=c.layers,g=0;g<f.length;g++)if(f[g].id===i.id){f[g].maxzoom=s.value,s.title=s.value,u=f[g];break}updateMapboxLayer(o,u),Promise.resolve()}}_onChangeLegendValueSourceMapBox(e){var i=e.target.data.obj,s=e.target.srcElement,o=this.getContext("map"),l=this.getContext("layer");if(l.get("mapbox-source")===i.source&&l.get("mapbox-editor")===e.target.editorID){for(var c=l.get("mapbox-styles"),u,f=c.layers,g=0;g<f.length;g++)if(f[g].id===i.id){var H=f[g].paint;H&&(H[s.dataset.id]=s.value),u=f[g];break}updateMapboxLayer(o,u),Promise.resolve()}}_onDisplayLayerSourceMapBox(e){var i=e.target.data.obj,s=this.getContext("layer");if(s.get("mapbox-source")===i.source&&s.get("mapbox-editor")===e.target.editorID){var o=e.target.currentTarget.parentNode.id,l=o.substring(o.indexOf("-")+1,o.indexOf("_")),c=this.getLayer(l);c.collapse()}}_importServiceLayers(){if(this._currentImportType==="WFS"){logger$a.warn("[ol.control.LayerImport] WFS layer import is not implemented yet");return}this.cleanGetCapResultsList();var e=this._getCapRequestUrl=this._serviceUrlImportInput.value;if(!e){logger$a.error("[ol.control.LayerImport] url parameter is mandatory");return}logger$a.log("url : ",e),e.trim&&(e=e.trim());var i=e.indexOf("?");i<0?e+="?SERVICE="+this._currentImportType+"&REQUEST=GetCapabilities":i===e.length-1&&(e+="SERVICE="+this._currentImportType+"&REQUEST=GetCapabilities"),this.options.webServicesOptions&&this.options.webServicesOptions.proxyUrl&&(e=ProxyUtils.proxifyUrl(e,this.options.webServicesOptions)),this._displayWaitingContainer();var s=this;Gp.Protocols.XHR.call({url:e,method:"GET",timeOut:15e3,onResponse:function(o){s._hideWaitingContainer(),s._displayGetCapResponseLayers(o)},onFailure:function(o){s._hideWaitingContainer(),logger$a.error("[ol.control.LayerImport] getCapabilities request failed : ",o)}})}_displayGetCapResponseLayers(e){var i,s,o={content:null,title:null},l;if(this._getCapResponseWMSLayers=[],this.contentService=e,this._hideFormContainer(),this._getCapPanel.classList.replace("GPelementHidden","GPelementVisible"),this._getCapPanel.classList.replace("gpf-hidden","gpf-visible"),this._importPanelTitle.innerHTML="Couches accessibles",this._importPanelReturnPicto.classList.replace("GPelementHidden","GPelementVisible"),this._importPanelReturnPicto.classList.replace("gpf-hidden","gpf-visible"),this._hasGetCapResults=!0,this._currentImportType==="WMS"){i=new WMSCapabilities;var c=this._getCapResponseWMS=i.read(e);if(logger$a.log("getCapabilities response : ",c),c&&c.Capability&&c.Capability.Layer){var u=c.Capability.Layer;if(Array.isArray(u))for(var f=0;f<u.length;f++)this._displayGetCapResponseWMSLayer(u[f]);else this._displayGetCapResponseWMSLayer(u)}}else if(this._currentImportType==="WMTS"){i=new WMTSCapabilities;var g=this._getCapResponseWMTS=i.read(e);if(logger$a.log("getCapabilities response : ",g),g&&g.Contents&&g.Contents.Layer&&(s=g.Contents.Layer,Array.isArray(s))){this._getCapResponseWMTSLayers=s;for(var H=0;H<s.length;H++)if(l=this._getWMTSLayerProjection(s[H],g),l&&typeof l=="string")if(get$3(l)||get$3(l.toUpperCase()))o={content:s[H].Title,title:s[H].Abstract||s[H].Title},this._getCapResultsListContainer&&this._addImportGetCapResultLayer(o,H,this._getCapResultsListContainer);else{logger$a.warn("[ol.control.LayerImport] wmts layer cannot be added to map : unknown projection",s[H]);continue}}}}_displayGetCapResponseWMSLayer(e,i){if(!e){logger$a.warn("[ol.control.LayerImport] _displayGetCapResponseWMSLayer : getCapabilities layer object not found");return}logger$a.log("[ol.control.LayerImport] _displayGetCapResponseWMSLayer - layerObj : ",e);var s=this._getMapProjectionCode(),o,l={content:null,title:null};if(i){var c,u,f=["CRS","Style"];for(u=0;u<f.length;u++)if(c=f[u],Array.isArray(i[c])&&i[c].length!==0)if(Array.isArray(e[c])&&e[c].length!==0)for(var g=0;g<i[c].length;g++)e[c].indexOf(i[c][g])===-1&&e[c].push(i[c][g]);else e[c]=i[c];var H=["BoundingBox","EX_GeographicBoundingBox","MaxScaleDenominator","MinScaleDenominator","Attribution","Dimension","queryable","cascaded","opaque","noSubsets","fixedWidth","fixedHeight"];for(u=0;u<H.length;u++)c=H[u],i[c]&&!e[c]&&(e[c]=i[c])}else e._isRootLayer=!0,e._container=this._getCapResultsListContainer,e.Title||(e.Title="Liste des couches");if(e.Layer){if(Array.isArray(e.Layer)){var Y=e?e._container:i._container,ee=e?e.Title:i.Title;e._container=this._addImportGetCapResultListRubrique(ee,Y).lastChild;for(var te=0;te<e.Layer.length;te++){for(var ne=!1,Ye=e._container.getElementsByClassName("GPimportGetCapRubriqueTitle"),xe=0;xe<Ye.length;xe++)Ye[xe].title===e.Title&&(ne=!0,e.Layer[te]._container=Ye[xe].parentElement);ne||(e.Layer[te]._container=this._addImportGetCapResultRubrique(e.Title,e._container).lastChild),this._displayGetCapResponseWMSLayer(e.Layer[te],e)}}}else{var tt=this._getCapResponseWMSLayers.length;if(o=this._getWMSLayerProjection(e,s),!o)logger$a.warn("[ol.control.LayerImport] wms layer cannot be added to map : unknown projection",e);else{e._projection=o,l={content:e.Title,title:e.Abstract||e.Title};var et=e._container;et.localName==="ul"&&(et=et.lastChild),this._addImportGetCapResultLayer(l,tt,et),this._getCapResponseWMSLayers[tt]=e}}}_onGetCapResponseLayerClick(e){if(e.target&&e.target.id){var i=parseInt(e.target.id.substr(23),10);if(isNaN(i))return;var s;this._currentImportType==="WMS"?(s=this._getCapResponseWMSLayers[i],this._addGetCapWMSLayer(s)):this._currentImportType==="WMTS"&&(s=this._getCapResponseWMTSLayers[i],this._addGetCapWMTSLayer(s))}}_addGetCapWMSLayer(e){var i=this.getMap();if(!i){logger$a.warn("[ol.control.LayerImport] _addGetCapWMSLayer error : map is not defined");return}if(!e){logger$a.warn("[ol.control.LayerImport] _addGetCapWMSLayer error : layerInfo is not defined");return}var s=this._getMapProjectionCode(),o={},l=this._getWMSLayerGetMapUrl();if(l)o.url=l;else{var c=this._getCapRequestUrl.indexOf("?");c!==-1?o.url=this._getCapRequestUrl.substring(0,c):o.url=this._getCapRequestUrl}if(e.Url=l||o.url,o.params={},e.Name)o.params.LAYERS=e.Name;else{logger$a.warn("[ol.control.LayerImport] unable to add wms layer : mandatory layer 'name' parameter cannot be found",e);return}o.params.SERVICE="WMS",this._getCapResponseWMS.version&&(o.params.VERSION=this._getCapResponseWMS.version),e.Version=this._getCapResponseWMS.version;var u=e._projection;if(u)u!==s&&(o.projection=u);else{logger$a.warn("[ol.control.LayerImport] wms layer cannot be added to map : unknown projection");return}e.Projection=u||o.projection;var f;if(e.Style&&Array.isArray(e.Style)){var g=e.Style[0];o.params.STYLES=g.Name,g.LegendURL&&Array.isArray(g.LegendURL)&&g.LegendURL.length!==0&&(f=g.LegendURL[0].OnlineResource)}var H=new TileWMS(o);this._getWMSLayerInfoForLayerSwitcher(e,f,H);var Y={};Y.source=H,this._getWMSLayerMinMaxResolution(e,s,Y),this._getWMSLayerExtent(e,s,Y);var ee=new TileLayer(Y);if(ee.setExtent(Y.extent),ee.gpResultLayerId="layerimport:WMS",e.queryable&&(ee.gpGFIparams={queryable:!0},this._getCapResponseWMS&&this._getCapResponseWMS.Capability&&this._getCapResponseWMS.Capability.Request&&this._getCapResponseWMS.Capability.Request.GetFeatureInfo&&this._getCapResponseWMS.Capability.Request.GetFeatureInfo.Format&&Array.isArray(this._getCapResponseWMS.Capability.Request.GetFeatureInfo.Format)&&(ee.gpGFIparams.formats=this._getCapResponseWMS.Capability.Request.GetFeatureInfo.Format)),i.addLayer(ee),i.getView()&&i.getSize()&&ee.getExtent){var te=ee.getExtent();te&&te[0]!==1/0&&i.getView().fit(te,i.getSize())}this.dispatchEvent({type:"layerimport:service:added",name:e.Name,data:e,layer:ee,format:"wms"})}_getWMSLayerGetMapUrl(){var e;if(this._getCapResponseWMS&&this._getCapResponseWMS.Capability&&this._getCapResponseWMS.Capability.Request&&this._getCapResponseWMS.Capability.Request.GetMap){var i=this._getCapResponseWMS.Capability.Request.GetMap;if(i.DCPType&&Array.isArray(i.DCPType)&&i.DCPType.length!==0){var s=i.DCPType[0];s&&s.HTTP&&s.HTTP.Get&&(e=s.HTTP.Get.OnlineResource)}}return e}_getWMSLayerProjection(e,i){var s;if(!e||typeof e!="object"){logger$a.warn("missing layer information (from getCapabilities)");return}var o=e.CRS;if(Array.isArray(o)){if(o.includes(i))return s=i,s;var l,c;for(c=0;c<o.length;c++)if(l=o[c],l&&typeof l=="string"&&(get$3(l)||get$3(l.toUpperCase())))return s=l,s}return s}_getWMSLayerMinMaxResolution(e,i,s){var o=get$3(i).getUnits();if(o==="m")e.MinScaleDenominator&&(s.minResolution=e.MinScaleDenominator*28e-5),e.MaxScaleDenominator&&(s.maxResolution=e.MaxScaleDenominator*28e-5);else if(o==="degrees"){var l=.05039999999999999/(Math.PI*6378137);e.MinScaleDenominator&&(s.minResolution=e.MinScaleDenominator*l),e.MaxScaleDenominator&&(s.maxResolution=e.MaxScaleDenominator*l)}}_getWMSLayerExtent(e,i,s){if(!e){logger$a.warn("[ol.control.LayerImport] _getWMSLayerExtent error : layerInfo is not defined");return}var o=e.EX_GeographicBoundingBox,l=e.BoundingBox;if(o&&Array.isArray(o))i==="EPSG:4326"?s.extent=o:s.extent=transformExtent(o,"EPSG:4326",i);else if(l&&Array.isArray(l)){for(var c,u,f=0;f<l.length;f++)if(c=l[f].crs,u=l[f].extent,c){if(c===i){s.extent=u;break}else if(typeof c=="string"){var g=get$3(c)?get$3(c):get$3(c.toUpperCase());if(g){if(g.getUnits()==="degrees"&&c.toUpperCase().indexOf("EPSG")===0){var H=[u[1],u[0],u[3],u[2]];s.extent=transformExtent(H,g,i)}else s.extent=transformExtent(u,g,i);break}}}}}_getWMSLayerInfoForLayerSwitcher(e,i,s){if(e.Title?(s._title=e.Title,s._description=e.Abstract?e.Abstract:e.Title):(s._title=e.Name,s._description=e.Abstract?e.Abstract:e.Name),i&&(s._legends=[{url:i}]),e.MetadataURL&&Array.isArray(e.MetadataURL)){s._metadata=[];for(var o=0;o<e.MetadataURL.length;o++){var l=e.MetadataURL[o].OnlineResource;l&&s._metadata.push({url:l})}}if(e.Attribution){var c=e.Attribution;s._originators={},c.OnlineResource&&(s._originators.url=c.OnlineResource),c.Title&&(s._originators.name=s._originators.attribution=c.Title),c.LogoURL&&c.LogoURL.OnlineResource&&(s._originators.logo=c.LogoURL.OnlineResource)}}_addGetCapWMTSLayer(e){if(!e||!e.Identifier){logger$a.warn("[ol.control.LayerImport] layer information not found in getCapabilities response for layer ");return}var i=this.getMap();if(i){var s={};s.layer=e.Identifier,this._getCapResponseWMTS.version&&(s.version=this._getCapResponseWMTS.version),e.Version=s.version;var o=this._getWMTSLayerGetTileUrl();if(o)s.url=o;else{var l=this._getCapRequestUrl.indexOf("?");l!==-1?s.url=this._getCapRequestUrl.substring(0,l):s.url=this._getCapRequestUrl}e.Url=o||s.url;var c=this._getTMSParams(e);s.matrixSet=c.tms,s.projection=c.projCode,s.tileGrid=new WMTSTileGrid({resolutions:c.resolutions,matrixIds:c.matrixIds,origin:c.origin}),e.MatrixIds=c.matrixIds,e.Projection=s.projection,e.Resolutions=c.resolutions,e.Origin=c.origin;var u,f;if(e.Style&&Array.isArray(e.Style))for(var g,H=0;H<e.Style.length&&(g=e.Style[H],u=g.Identifier,!g.isDefault);H++)g.LegendURL&&Array.isArray(g.LegendURL)&&g.LegendURL.length!==0&&(f=g.LegendURL[0].href);u==null&&logger$a.warn("[ol.control.LayerImport] style information not found in getCapabilities response for layer "+e.Identifier),s.style=u;var Y;e.Format&&Array.isArray(e.Format)&&(Y=e.Format[0]),Y==null&&logger$a.warn("[ol.control.LayerImport] format information not found in getCapabilities response for layer "+e.Identifier),s.format=Y;var ee=new WMTS$1(s);e.Title?(ee._title=e.Title,ee._description=e.Abstract?e.Abstract:e.Title):(ee._title=e.Identifier,ee._description=e.Abstract?e.Abstract:e.Identifier),f&&(ee._legends=[{url:f}]);var te={};te.source=ee,te.extent=this._getWMTSLayerExtent(e);var ne;try{ne=new TileLayer(te),ne.setExtent(te.extent)}catch(xe){logger$a.warn("[ol.control.LayerImport] an error occured while trying to create ol.layer.Tile from getCapabilities information. error : ",xe);return}if(ne.gpResultLayerId="layerimport:WMTS",i.addLayer(ne),i.getView()&&i.getSize()&&ne.getExtent){var Ye=ne.getExtent();Ye&&Ye[0]!==1/0&&i.getView().fit(Ye,i.getSize())}this.dispatchEvent({type:"layerimport:service:added",name:e.Identifier,data:e,layer:ne,format:"wmts"})}}_getWMTSLayerGetTileUrl(){var e;if(this._getCapResponseWMTS&&this._getCapResponseWMTS.OperationsMetadata&&this._getCapResponseWMTS.OperationsMetadata.GetTile){var i=this._getCapResponseWMTS.OperationsMetadata.GetTile;i.DCP&&i.DCP.HTTP&&i.DCP.HTTP.Get&&Array.isArray(i.DCP.HTTP.Get)&&i.DCP.HTTP.Get.length!==0&&(e=i.DCP.HTTP.Get[0].href)}return e}_getWMTSLayerProjection(e,i){var s;if(!e||typeof e!="object"){logger$a.warn("missing layer information (from getCapabilities)");return}if(!i||typeof i!="object"){logger$a.warn("missing getCapabilities response");return}if(e.TileMatrixSetLink&&Array.isArray(e.TileMatrixSetLink)){var o=e.TileMatrixSetLink[0].TileMatrixSet,l;if(i.Contents&&Array.isArray(i.Contents.TileMatrixSet)){for(var c=i.Contents.TileMatrixSet,u=0;u<c.length;u++)if(c[u].Identifier===o&&c[u].TileMatrix){var f=c[u];l=f.SupportedCRS,l&&typeof l=="string"&&(get$3(l)||get$3(l.toUpperCase()))&&(s=l);break}}}return s}_getTMSParams(e){var i={},s=[],o=[],l=[],c,u,f,g=this.getMap();if(g){if(e.TileMatrixSetLink&&Array.isArray(e.TileMatrixSetLink))if(c=e.TileMatrixSetLink[0].TileMatrixSet,this._getCapResponseWMTS.Contents&&Array.isArray(this._getCapResponseWMTS.Contents.TileMatrixSet)){for(var H=this._getCapResponseWMTS.Contents.TileMatrixSet,Y=0;Y<H.length;Y++)if(H[Y].Identifier===c&&H[Y].TileMatrix){var ee=H[Y],te,ne,Ye,xe,tt;if(ee.SupportedCRS&&(u=ee.SupportedCRS,f=get$3(u)),f&&f.getUnits&&(tt=f.getUnits()),Array.isArray(ee.TileMatrix))for(var et=0;et<ee.TileMatrix.length;et++)te=ee.TileMatrix[et],te.Identifier!=null&&(ne=parseInt(te.Identifier,10),s.push(ne)),Ye=te.ScaleDenominator,tt==="degrees"?xe=Ye*28e-5*180/(Math.PI*6378137):xe=Ye*28e-5,o.push(xe),l=te.TopLeftCorner;o.sort!==void 0&&o.sort(function(it,rt){return rt-it}),s.sort!==void 0&&s.sort(function(it,rt){return it-rt})}}else logger$a.warn("[ol.control.LayerImport] TileMatrixSet data not found in getCapabilities response for layer "+e.Identifier);else return;return i.tms=c,i.projCode=u,i.matrixIds=s,i.resolutions=o,i.origin=l,i}}_getWMTSLayerExtent(e){var i,s=this._getMapProjectionCode();return e.WGS84BoundingBox&&Array.isArray(e.WGS84BoundingBox)&&(i=transformExtent(e.WGS84BoundingBox,"EPSG:4326",s)),i}_getMapProjectionCode(){var e=this.getMap();if(!e||!e.getView||!e.getView().getProjection){logger$a.warn("unable to get layerimport's map");return}var i=e.getView().getProjection().getCode();return i}_displayWaitingContainer(){this._waitingContainer.className="GPwaitingContainer GPwaitingContainerVisible gpf-waiting gpf-waiting--visible",this._waiting=!0,this._timer&&(clearTimeout(this._timer),this._timer=null);var e=this;this._timer=setTimeout(function(){e._waiting===!0?e._hideWaitingContainer():e._timer&&clearTimeout(e._timer)},16e3)}_hideWaitingContainer(){this._waiting&&(this._waitingContainer.className="GPwaitingContainer GPwaitingContainerHidden gpf-waiting gpf-waiting--hidden",this._waiting=!1,clearTimeout(this._timer),this._timer=null)}_displayFormContainer(){this._formContainer.classList.replace("GPelementHidden","GPelementVisible"),this._formContainer.classList.replace("gpf-hidden","gpf-visible"),this._importPanelTitle.innerHTML="Import de donnes"}_hideFormContainer(){this._formContainer.classList.replace("GPelementVisible","GPelementHidden"),this._formContainer.classList.replace("gpf-visible","gpf-hidden")}cleanGetCapResultsList(){if(this._hasGetCapResults=!1,this._getCapRequestUrl=null,this._getCapResponseWMS=null,this._getCapResponseWMTS=null,this._getCapResponseWMSLayers=null,this._getCapResponseWMTSLayers=null,this._getCapResultsListContainer)for(;this._getCapResultsListContainer.firstChild;)this._getCapResultsListContainer.removeChild(this._getCapResultsListContainer.firstChild)}cleanMapBoxResultsList(){if(this._hasMapBoxResults=!1,this._mapBoxResultsListContainer)for(;this._mapBoxResultsListContainer.firstChild;)this._mapBoxResultsListContainer.removeChild(this._mapBoxResultsListContainer.firstChild)}cleanMapBoxResults(e){if(this._hasMapBoxResults=!1,this._mapBoxResultsListContainer){var i=this._mapBoxResultsListContainer.childNodes;for(let s=0;s<i.length;s++){const o=i[s];o.id==="GPEditorMapBoxContainer_ID_"+e&&o.remove()}}}};ii(gi,"DefaultStyles",{image:new Icon({src:Marker.lightOrange,anchor:[25.5,38],anchorOrigin:"top-left",anchorXUnits:"pixels",anchorYUnits:"pixels"}),stroke:new Stroke({color:"rgba(0,42,80,0.8)",width:4}),fill:new Fill({color:"rgba(0, 183, 152, 0.5)"}),text:new Text({font:"16px Sans",textAlign:"left",fill:new Fill({color:"rgba(255, 255, 255, 1)"}),stroke:new Stroke({color:"rgba(0, 0, 0, 1)",width:2})})});let LayerImport=gi;Object.assign(LayerImport.prototype,LayerImportDOM);Object.assign(LayerImport.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.LayerImport=LayerImport);var logger$9=LoggerByDefault.getLogger("geoportalattribution");class GeoportalAttribution extends Attribution{constructor(e){if(e=e||{},e.collapsible=!0,e.collapsed=!0,super(e),!(this instanceof GeoportalAttribution))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this}setMap(e){if(e!=null){var i=e.getControls();i.forEach(s=>{if(!(s instanceof GeoportalAttribution)&&s){for(var o=s.element.classList,l=0;l<o.length;l++)if(o[l]==="ol-attribution"){i.remove(s);break}}}),this._updateAttributions(e),e.on("moveend",()=>{this._updateAttributions(e)}),e.getLayers().on("add",()=>{this._updateAttributions(e)}),e.getLayers().on("remove",()=>{this._updateAttributions(e)})}super.setMap(e)}_updateAttributions(e){for(var i={},s=e.getView(),o=s.calculateExtent(e.getSize()),l=s.getProjection().getCode(),c=transformExtent(o,l,"EPSG:4326"),u=[c[3],c[0],c[1],c[2]],f=s.getZoom(),g=e.getLayers().getArray(),H=0;H<g.length;H++)if(g[H].getSource)this._updateLayerAttributions(g[H],i,u,l,f);else if(g[H].getLayers){var Y=g[H].getLayers();Y.forEach(ee=>{ee.getSource?this._updateLayerAttributions(ee,i,u,l,f):logger$9.log("cannot find layer source in layergroup ",g[H])})}}_updateLayerAttributions(e,i,s,o,l){if(!e){logger$9.trace("layer is null !?");return}var c=e.getSource();if(!c){logger$9.trace("source is not yet loaded !");return}i||(i={});var u=[],f=e.getVisible(),g=c._originators;if(typeof g<"u"&&c.setAttributions(),g&&f){for(var H=LayerUtils.getAttributions({extent:s,crs:o,zoom:l,visibility:f,originators:g}),Y=0;Y<H.length;Y++){var ee=H[Y];i.hasOwnProperty(ee)||(u.push(ee),i[ee]=!0)}u.length!==0&&(c.setAttributions(u),this.dispatchEvent({type:"attributions:update",attributions:u}))}}}window.ol&&window.ol.control&&(window.ol.control.GeoportalAttribution=GeoportalAttribution);var MeasureLengthDOM={_addUID:function(n){var e=this._uid?n+"-"+this._uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPmeasureLength"),n.className="GPwidget gpf-widget gpf-widget-button",n},_createShowMeasureLengthPictoElement:function(){var n=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowMeasureLengthPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-length fr-btn fr-btn--tertiary",e.setAttribute("aria-label","Mesurer une distance"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowMeasureLengthClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowMeasureLengthClick(s)}),e}},logger$8=LoggerByDefault.getLogger("measurelength");class MeasureLength extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof MeasureLength))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="MeasureLength",this._uid=e.id||SelectorID.generate(),this._pictoContainer=null,this._initialize(e),this._container=this._initializeContainer(),this.element?this.element.appendChild(this._container):this.element=this._container,this}setMap(e){logger$8.trace("setMap()");var i=this.CLASSNAME;e?!this.options.target&&!this.options.position&&MeasureToolBox.add(e,this):this.clean(),this.tools[i].push({instance:e?this:null,active:!1,map:e?e.getTargetElement():null});var s=typeof window<"u"?window:typeof self<"u"?self:null;s&&(s.gpShareMeasures||(s.gpShareMeasures={}),s.gpShareMeasures[i]=this.tools[i]),super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getContainer(){return this._container}_initialize(e){logger$8.trace("call MeasureLength::_initialize() : ",e),this.options={},this.options.geodesic=typeof e.geodesic<"u"?e.geodesic:!0,this.options.unit=typeof e.unit<"u"?e.unit:null,this.options.position=typeof e.position<"u"?e.position:null,this.options.target=typeof e.target<"u"?e.target:null,this.options.render=typeof e.render<"u"?e.render:null,this.options.gutter=typeof e.gutter<"u"?e.gutter:null,this.options.layerDescription=typeof e.layerDescription<"u"?e.layerDescription:{title:"Mesures de distance",description:"Mes mesures"},this.createStylingMeasureInteraction(e.styles)}_initializeContainer(){logger$8.trace("call MeasureLength::_initializeContainer() : ",this._uid);var e=this._createMainContainerElement(),i=this._pictoContainer=this._createShowMeasureLengthPictoElement();return e.appendChild(i),e}addMeasureEvents(){logger$8.trace("call MeasureLength::addMeasureEvents()");var e=this.getMap();e.on("singleclick",i=>this.onPointerMoveHandler(i)),e.on("pointermove",i=>this.onPointerMoveHandler(i)),this.eventLayerRemove=e.getLayers().on("remove",i=>{i.element===this.measureVector&&this.clean()})}removeMeasureEvents(){logger$8.trace("call MeasureLength::removeMeasureEvents()");var e=this.getMap();e.un("singleclick",i=>this.onPointerMoveHandle(i)),e.un("pointermove",i=>this.onPointerMoveHandler(i)),this.eventLayerRemove&&unByKey(this.eventLayerRemove)}format(e){logger$8.trace("call MeasureLength::format()");var i=this.getMap(),s;if(this.options.geodesic){var o=e.getCoordinates();s=0;for(var l=i.getView().getProjection(),c=0,u=o.length-1;c<u;++c){var f=transform$1(o[c],l,"EPSG:4326"),g=transform$1(o[c+1],l,"EPSG:4326");s+=getDistance(f,g)}}else s=Math.round(e.getLength()*100)/100;var H;return this.options.unit==="km"?H=Math.round(s/1e3*100)/100+" km":this.options.unit==="m"?H=Math.round(s*100)/100+" m":s>1e3?H=Math.round(s/1e3*100)/100+" km":H=Math.round(s*100)/100+" m",H}onShowMeasureLengthClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen(),logger$8.trace("call MeasureLength::onShowMeasureLengthClick()",e),this.onShowMeasureClick(e,"LineString")}}Object.assign(MeasureLength.prototype,Measures);Object.assign(MeasureLength.prototype,MeasureLengthDOM);Object.assign(MeasureLength.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.MeasureLength=MeasureLength);var MeasureAreaDOM={_addUID:function(n){var e=this._uid?n+"-"+this._uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPmeasureArea"),n.className="GPwidget gpf-widget gpf-widget-button",n},_createShowMeasureAreaPictoElement:function(){var n=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowMeasureAreaPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-area fr-btn fr-btn--tertiary",e.setAttribute("aria-label","Mesurer une surface"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowMeasureAreaClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowMeasureAreaClick(s)}),e}},logger$7=LoggerByDefault.getLogger("measurearea");class MeasureArea extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof MeasureArea))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="MeasureArea",this._uid=e.id||SelectorID.generate(),this._pictoContainer=null,this._initialize(e),this._container=this._initializeContainer(),this.element?this.element.appendChild(this._container):this.element=this._container,this}setMap(e){logger$7.trace("setMap()");var i=this.CLASSNAME;e?!this.options.target&&!this.options.position&&MeasureToolBox.add(e,this):this.clean(),this.tools[i].push({instance:e?this:null,active:!1,map:e?e.getTargetElement():null});var s=typeof window<"u"?window:typeof self<"u"?self:null;s&&(s.gpShareMeasures||(s.gpShareMeasures={}),s.gpShareMeasures[i]=this.tools[i]),super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getContainer(){return this._container}_initialize(e){logger$7.trace("call MeasureArea::_initialize() : ",e),this.options={},this.options.geodesic=typeof e.geodesic<"u"?e.geodesic:!0,this.options.position=typeof e.position<"u"?e.position:null,this.options.target=typeof e.target<"u"?e.target:null,this.options.render=typeof e.render<"u"?e.render:null,this.options.gutter=typeof e.gutter<"u"?e.gutter:null,this.options.layerDescription=typeof e.layerDescription<"u"?e.layerDescription:{title:"Mesures de surface",description:"Mes mesures"},this.createStylingMeasureInteraction(e.styles)}_initializeContainer(){logger$7.trace("call MeasureArea::_initializeContainer() : ",this._uid);var e=this._createMainContainerElement(),i=this._pictoContainer=this._createShowMeasureAreaPictoElement();return e.appendChild(i),e}addMeasureEvents(){logger$7.trace("call MeasureArea::addMeasureEvents()");var e=this.getMap();e.on("singleclick",i=>this.onPointerMoveHandler(i)),e.on("pointermove",i=>this.onPointerMoveHandler(i)),this.eventLayerRemove=e.getLayers().on("remove",i=>{i.element===this.measureVector&&this.clean()})}removeMeasureEvents(){logger$7.trace("call MeasureArea::removeMeasureEvents()");var e=this.getMap();e.un("singleclick",i=>this.onPointerMoveHandler(i)),e.un("pointermove",i=>this.onPointerMoveHandler(i)),this.eventLayerRemove&&unByKey(this.eventLayerRemove)}format(e){logger$7.trace("call MeasureArea::format()");var i;if(this.options.geodesic){var s=e.clone(),o=s.getLinearRing(0).getCoordinates();i=Math.abs(getArea(new Polygon([o])))}else i=e.getArea();var l;return i>1e6?l=Math.round(i/1e6*100)/100+" km<sup>2</sup>":i>1e5?l=Math.round(i/1e6*1e3)/1e3+" km<sup>2</sup>":i>1e3?l=Math.round(i/10)*10+" m<sup>2</sup>":l=Math.round(i*100)/100+" m<sup>2</sup>",l}onShowMeasureAreaClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen(),logger$7.trace("call MeasureArea::onShowMeasureAreaClick()",e),this.onShowMeasureClick(e,"Polygon")}}Object.assign(MeasureArea.prototype,Measures);Object.assign(MeasureArea.prototype,MeasureAreaDOM);Object.assign(MeasureArea.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.MeasureArea=MeasureArea);var MeasureAzimuthDOM={_addUID:function(n){var e=this._uid?n+"-"+this._uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPmeasureAzimuth"),n.className="GPwidget gpf-widget gpf-widget-button",n},_createShowMeasureAzimuthPictoElement:function(){var n=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowMeasureAzimuthPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-azimuth fr-btn fr-btn--tertiary",e.setAttribute("aria-label","Mesurer un azimut"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowMeasureAzimuthClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowMeasureAzimuthClick(s)}),e}},logger$6=LoggerByDefault.getLogger("measureazimut");class MeasureAzimuth extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof MeasureAzimuth))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="MeasureAzimuth",this._uid=e.id||SelectorID.generate(),this._pictoContainer=null,this._initialize(e),this._container=this._initializeContainer(),this.element?this.element.appendChild(this._container):this.element=this._container,this}setMap(e){logger$6.trace("setMap()");var i=this.CLASSNAME;e?!this.options.target&&!this.options.position&&MeasureToolBox.add(e,this):this.clean(),this.tools[i].push({instance:e?this:null,active:!1,map:e?e.getTargetElement():null});var s=typeof window<"u"?window:typeof self<"u"?self:null;s&&(s.gpShareMeasures||(s.gpShareMeasures={}),s.gpShareMeasures[i]=this.tools[i]),super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}setGeodesic(e){this.options.geodesic=typeof e<"u"?e:!1}isGeodesic(){return this.options.geodesic}getContainer(){return this._container}_initialize(e){logger$6.trace("call MeasureAzimuth::_initialize() : ",e),this.options={},this.options.geodesic=typeof e.geodesic<"u"?e.geodesic:!1,this.options.position=typeof e.position<"u"?e.position:null,this.options.target=typeof e.target<"u"?e.target:null,this.options.render=typeof e.render<"u"?e.render:null,this.options.gutter=typeof e.gutter<"u"?e.gutter:null,this.options.layerDescription=typeof e.layerDescription<"u"?e.layerDescription:{title:"Mesures d'azimuth",description:"Mes mesures"},this.createStylingMeasureInteraction(e.styles)}_initializeContainer(){logger$6.trace("call MeasureAzimuth::_initializeContainer() : ",this._uid);var e=this._createMainContainerElement(),i=this._pictoContainer=this._createShowMeasureAzimuthPictoElement();return e.appendChild(i),e}addMeasureEvents(){logger$6.trace("call MeasureAzimuth::addMeasureEvents()");var e=this.getMap();e.on("singleclick",i=>this.onPointerMoveAzimutHandler(i)),e.on("pointermove",i=>this.onPointerMoveAzimutHandler(i)),this.eventLayerRemove=e.getLayers().on("remove",i=>{i.element===this.measureVector&&this.clean()})}removeMeasureEvents(){logger$6.trace("call MeasureAzimuth::removeMeasureEvents()");var e=this.getMap();e.un("singleclick",i=>this.onPointerMoveAzimutHandler(i)),e.un("pointermove",i=>this.onPointerMoveAzimutHandler(i)),this.eventLayerRemove&&unByKey(this.eventLayerRemove)}format(e){logger$6.trace("call MeasureAzimuth::format()");var i=this.getMap(),s=i.getView().getProjection(),o=transform$1(e.getFirstCoordinate(),s,"EPSG:4326"),l=transform$1(e.getLastCoordinate(),s,"EPSG:4326");if(!this.options.geodesic){var c=getDistance(o,l);if(logger$6.trace("measure between 2 points with geodesic method",c),c>500){var u=500/c;logger$6.trace("%",u),l=transform$1(e.getCoordinateAt(u),s,"EPSG:4326")}}var f=Math.PI/180,g=180/Math.PI,H=f*o[0],Y=f*l[0],ee=f*o[1],te=f*l[1],ne=Math.sin(Y-H)*Math.cos(te),Ye=Math.cos(ee)*Math.sin(te)-Math.sin(ee)*Math.cos(te)*Math.cos(Y-H),xe=Math.atan2(ne,Ye),tt=g*xe;logger$6.trace("azimut",tt),tt<0&&(tt+=360);var et=Math.round(tt*100)/100+" ";return et}onShowMeasureAzimuthClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen(),logger$6.trace("call MeasureAzimuth::onShowMeasureAzimuthClick()",e),this.onShowMeasureClick(e,"LineString")}onPointerMoveAzimutHandler(e){if(this.onPointerMoveHandler(e),this.sketch){var i=this.sketch.getGeometry();i.getCoordinates().length>2&&this.measureDraw.finishDrawing()}}}Object.assign(MeasureAzimuth.prototype,Measures);Object.assign(MeasureAzimuth.prototype,MeasureAzimuthDOM);Object.assign(MeasureAzimuth.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.MeasureAzimuth=MeasureAzimuth);LoggerByDefault.getLogger("zoom");class GeoportalZoom extends Zoom{constructor(e){e=e||{};var i="ol-custom-zoom";e.className=i,super(e),this.container=null,this.options=e}_createContainerPosition(e){if(this.container=e.getOverlayContainerStopEvent(),this.options.position){this.options.target=this.container;var i="position-container-"+this.options.position;if(!document.getElementById(i)){var s=document.createElement("div");s.id=i,s.classList.add("position"),s.classList.add(i),this.container.appendChild(s)}this.options.target=this.container.children[i]}}_initContainer(){this._uid=this.options.id||SelectorID.generate(),this.element.id="GPzoom-"+this._uid,this.element.classList.add("GPwidget","gpf-widget","gpf-widget-button"),this.element.classList.add(this.options.className),this.element.classList.remove("ol-zoom","ol-unselectable","ol-control");var e=this,i=this.element.childNodes;for(let o=0;o<i.length;o++){const l=i[o];if(l.classList.contains(this.options.className+"-in")){l.classList.add("GPzoomIn","GPshowOpen","GPshowAdvancedToolPicto","gpf-btn-icon-zoom-in","fr-btn","fr-btn--tertiary","gpf-btn","gpf-btn--tertiary","gpf-btn-icon"),l.id="GPzoomIn",l.innerHTML="",l.removeAttribute("title"),l.setAttribute("aria-label","Zoomer");var s=document.createElement("span");l.appendChild(s),l.addEventListener?l.addEventListener("click",function(){e.dispatchEvent("zoom:in")}):l.attachEvent&&l.attachEvent("onclick",function(){e.dispatchEvent("zoom:in")})}if(l.classList.contains(this.options.className+"-out")){l.classList.add("GPzoomOut","GPshowOpen","GPshowAdvancedToolPicto","gpf-btn-icon-zoom-out","fr-btn","fr-btn--tertiary","gpf-btn","gpf-btn--tertiary","gpf-btn-icon"),l.id="GPzoomOut",l.innerHTML="",l.removeAttribute("title"),l.setAttribute("aria-label","Dzoomer");var s=document.createElement("span");l.appendChild(s),l.addEventListener?l.addEventListener("click",function(){e.dispatchEvent("zoom:out")}):l.attachEvent&&l.attachEvent("onclick",function(){e.dispatchEvent("zoom:out")})}}this.options.position&&(this.element.style.position="unset"),this.options.gutter===!1&&this.element.classList.add("gpf-button-no-gutter")}setMap(e){if(e){this._createContainerPosition(e),this._initContainer();var i=e.getControls();i.forEach(s=>{s.element.classList.contains("ol-zoom")&&(s.element.classList.add("ol-hidden"),s.element.style.display="none")})}this.setTarget(this.options.target),super.setMap(e)}getContainer(){return this.container}}window.ol&&window.ol.control&&(window.ol.control.GeoportalZoom=GeoportalZoom);const events=["fullscreenchange","webkitfullscreenchange"],FullScreenEventType={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class FullScreen extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const i=e.label!==void 0?e.label:"";this.labelNode_=typeof i=="string"?document.createTextNode(i):i;const s=e.labelActive!==void 0?e.labelActive:"";this.labelActiveNode_=typeof s=="string"?document.createTextNode(s):s;const o=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=o,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(EventType$1.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${CLASS_UNSELECTABLE} ${CLASS_CONTROL}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const i=e.getOwnerDocument();if(isFullScreenSupported(i))if(isFullScreen(i))exitFullScreen(i);else{let s;this.source_?s=typeof this.source_=="string"?i.getElementById(this.source_):this.source_:s=e.getTargetElement(),this.keys_?requestFullScreenWithKeys(s):requestFullScreen(s)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const i=this.isInFullscreen_;this.isInFullscreen_=isFullScreen(e.getOwnerDocument()),i!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(replaceNode(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(FullScreenEventType.ENTERFULLSCREEN)):(replaceNode(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(FullScreenEventType.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,i){i?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const i=this.getMap();i&&i.removeChangeListener(MapProperty.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(MapProperty.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let s=0,o=e.length;s<o;++s)unlistenByKey(e[s]);e.length=0;const i=this.getMap();if(i){const s=i.getOwnerDocument();isFullScreenSupported(s)?this.element.classList.remove(CLASS_UNSUPPORTED):this.element.classList.add(CLASS_UNSUPPORTED);for(let o=0,l=events.length;o<l;++o)e.push(listen(s,events[o],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function isFullScreenSupported(n){const e=n.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&n.fullscreenEnabled)}function isFullScreen(n){return!!(n.webkitIsFullScreen||n.fullscreenElement)}function requestFullScreen(n){n.requestFullscreen?n.requestFullscreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()}function requestFullScreenWithKeys(n){n.webkitRequestFullscreen?n.webkitRequestFullscreen():requestFullScreen(n)}function exitFullScreen(n){n.exitFullscreen?n.exitFullscreen():n.webkitExitFullscreen&&n.webkitExitFullscreen()}LoggerByDefault.getLogger("fullscreen");class GeoportalFullScreen extends FullScreen{constructor(e){e=e||{};var i="ol-custom-full-screen";e.className=e.className||i,e.label=e.label||"",e.labelActive=e.labelActive||"",e.activeClassName=e.activeClassName||i+"-true",e.inactiveClassName=e.inactiveClassName||i+"-false",e.tipLabel=e.tipLabel||"Basculer en mode plein cran",super(e),this.CLASSNAME="FullScreen",this.container=null,this.options=e}_createContainerPosition(e){if(this.container=e.getOverlayContainerStopEvent(),this.options.target=this.container,this.options.position){var i="position-container-"+this.options.position;if(!document.getElementById(i)){var s=document.createElement("div");s.id=i,s.classList.add("position"),s.classList.add(i),this.container.appendChild(s)}this.options.target=this.container.children[i]}}_initContainer(){this._uid=this.options.id||SelectorID.generate(),this.element.id="GPfullScreen-"+this._uid,this.element.classList.add("GPwidget","gpf-widget","gpf-widget-button"),this.element.classList.add(this.options.className),this.element.classList.remove("ol-full-screen","ol-unselectable","ol-control");var e=this.element.childNodes[0],i=document.createElement("span");e.appendChild(i),e.classList.add("GPshowOpen","GPshowAdvancedToolPicto","GPfullScreenPicto","fr-btn","fr-btn--tertiary","gpf-btn--tertiary","gpf-btn","gpf-btn-icon"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.removeAttribute("title"),e.setAttribute("aria-label",this.options.tipLabel),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o)}),this.options.position&&(this.element.style.position="unset"),this.options.gutter===!1&&this.element.classList.add("gpf-button-no-gutter")}setMap(e){if(e){this._createContainerPosition(e),this._initContainer();var i=e.getControls();i.forEach(s=>{s.element.classList.contains("ol-full-screen")&&(s.element.classList.add("ol-hidden"),s.element.style.display="none")})}this.setTarget(this.options.target),super.setMap(e)}getContainer(){return this.container}}window.ol&&window.ol.control&&(window.ol.control.GeoportalFullScreen=GeoportalFullScreen);const MAX_RATIO=.75,MIN_RATIO=.1;class OverviewMap extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const i=e.className!==void 0?e.className:"ol-overviewmap",s=e.tipLabel!==void 0?e.tipLabel:"Overview map",o=e.collapseLabel!==void 0?e.collapseLabel:"";typeof o=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o):this.collapseLabel_=o;const l=e.label!==void 0?e.label:"";typeof l=="string"?(this.label_=document.createElement("span"),this.label_.textContent=l):this.label_=l;const c=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,u=document.createElement("button");u.setAttribute("type","button"),u.title=s,u.appendChild(c),u.addEventListener(EventType$1.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const f=new Map$1({view:e.view,controls:new Collection,interactions:new Collection});this.ovmap_=f,e.layers&&e.layers.forEach(function(tt){f.addLayer(tt)});const g=document.createElement("div");g.className="ol-overviewmap-box",g.style.boxSizing="border-box",this.boxOverlay_=new Overlay({position:[0,0],positioning:"center-center",element:g}),this.ovmap_.addOverlay(this.boxOverlay_);const H=i+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" "+CLASS_COLLAPSED:"")+(this.collapsible_?"":" ol-uncollapsible"),Y=this.element;Y.className=H,Y.appendChild(this.ovmapDiv_),Y.appendChild(u);const ee=this.boxOverlay_,te=this.boxOverlay_.getElement(),ne=tt=>({clientX:tt.clientX,clientY:tt.clientY}),Ye=function(tt){const et=ne(tt),it=f.getEventCoordinate(et);ee.setPosition(it)},xe=tt=>{const et=f.getEventCoordinateInternal(tt),it=this.getMap();it.getView().setCenterInternal(et);const rt=it.getOwnerDocument();rt.removeEventListener("pointermove",Ye),rt.removeEventListener("pointerup",xe)};this.ovmapDiv_.addEventListener("pointerdown",tt=>{const et=this.getMap().getOwnerDocument();tt.target===te&&et.addEventListener("pointermove",Ye),et.addEventListener("pointerup",xe)})}setMap(e){const i=this.getMap();if(e!==i){if(i){const s=i.getView();s&&this.unbindView_(s),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(listen(e,ObjectEventType.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const s=e.getView();s&&this.bindView_(s),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===MapProperty.VIEW){const i=e.oldValue;i&&this.unbindView_(i);const s=this.getMap().getView();this.bindView_(s)}else!this.ovmap_.isRendered()&&(e.key===MapProperty.TARGET||e.key===MapProperty.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const i=new View({projection:e.getProjection()});this.ovmap_.setView(i)}e.addChangeListener(ViewProperty.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_(),e.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())}unbindView_(e){e.removeChangeListener(ViewProperty.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),i=this.ovmap_;if(!e.isRendered()||!i.isRendered())return;const s=e.getSize(),l=e.getView().calculateExtentInternal(s);if(this.viewExtent_&&equals$1(l,this.viewExtent_))return;this.viewExtent_=l;const c=i.getSize(),f=i.getView().calculateExtentInternal(c),g=i.getPixelFromCoordinateInternal(getTopLeft(l)),H=i.getPixelFromCoordinateInternal(getBottomRight(l)),Y=Math.abs(g[0]-H[0]),ee=Math.abs(g[1]-H[1]),te=c[0],ne=c[1];Y<te*MIN_RATIO||ee<ne*MIN_RATIO||Y>te*MAX_RATIO||ee>ne*MAX_RATIO?this.resetExtent_():containsExtent(f,l)||this.recenter_()}resetExtent_(){const e=this.getMap(),i=this.ovmap_,s=e.getSize(),l=e.getView().calculateExtentInternal(s),c=i.getView(),u=Math.log(MAX_RATIO/MIN_RATIO)/Math.LN2,f=1/(Math.pow(2,u/2)*MIN_RATIO);scaleFromCenter(l,f),c.fitInternal(fromExtent(l))}recenter_(){const e=this.getMap(),i=this.ovmap_,s=e.getView();i.getView().setCenterInternal(s.getCenterInternal())}updateBox_(){const e=this.getMap(),i=this.ovmap_;if(!e.isRendered()||!i.isRendered())return;const s=e.getSize(),o=e.getView(),l=i.getView(),c=this.rotateWithView_?0:-o.getRotation(),u=this.boxOverlay_,f=this.boxOverlay_.getElement(),g=o.getCenter(),H=o.getResolution(),Y=l.getResolution(),ee=s[0]*H/Y,te=s[1]*H/Y;if(u.setPosition(g),f){f.style.width=ee+"px",f.style.height=te+"px";const ne="rotate("+c+"rad)";f.style.transform=ne}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=listenOnce(this.ovmap_,MapEventType.POSTRENDER,e=>{delete this.ovmapPostrenderKey_,this.updateBox_()}))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(CLASS_COLLAPSED),this.collapsed_?replaceNode(this.collapseLabel_,this.label_):replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}}LoggerByDefault.getLogger("overviewMap");class GeoportalOverviewMap extends OverviewMap{constructor(e){e=e||{};const i={name:"GEOGRAPHICALGRIDSYSTEMS.MAPS.OVERVIEW",globalConstraint:{maxScaleDenominator:27954113201435894e-8,minScaleDenominator:2.1839150938621787e6,bbox:{left:-179.5,right:179.5,top:75,bottom:-75}},params:{url:"https://data.geopf.fr/wmts",styles:"normal",version:"1.0.0",format:"image/jpeg",projection:"EPSG:3857",minScale:2.1839150938621787e6,maxScale:27954113201435894e-8,extent:{left:-179.5,right:179.5,top:75,bottom:-75},legends:[{format:"image/jpeg",url:"https://data.geopf.fr/annexes/ressources/legendes/LEGEND.jpg",minScaleDenominator:"200"}],title:"Carte Mondiale pour la mini-vue",description:"Carte Mondiale pour la mini-vue",tileMatrixSetLimits:{1:{minTileRow:"0",maxTileRow:"1",minTileCol:"0",maxTileCol:"1"},2:{minTileRow:"0",maxTileRow:"3",minTileCol:"0",maxTileCol:"3"},3:{minTileRow:"1",maxTileRow:"6",minTileCol:"0",maxTileCol:"7"},4:{minTileRow:"2",maxTileRow:"13",minTileCol:"0",maxTileCol:"15"},5:{minTileRow:"5",maxTileRow:"26",minTileCol:"0",maxTileCol:"31"},6:{minTileRow:"11",maxTileRow:"52",minTileCol:"0",maxTileCol:"63"},7:{minTileRow:"22",maxTileRow:"105",minTileCol:"0",maxTileCol:"127"},8:{minTileRow:"45",maxTileRow:"210",minTileCol:"0",maxTileCol:"255"}},TMSLink:"PM_1_8",matrixIds:["1","2","3","4","5","6","7","8"],tileMatrices:{1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}},nativeResolutions:["78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100"]}};var s="ol-overviewmap";e.className=e.className||s,e.collapseLabel=e.collapseLabel||"",e.collapsed=e.collapsed,e.collapsed===void 0&&(e.collapsed=!0),e.label=e.label||"",e.tipLabel="Carte gnrale",e.layers=e.layers||[new LayerWMTS({layer:"GEOGRAPHICALGRIDSYSTEMS.MAPS.OVERVIEW",configuration:i})],e.view=e.view||new View({minZoom:1,maxZoom:8}),super(e),this.CLASSNAME="OverviewMap",this.container=null,this.options=e}_createContainerPosition(e){if(this.container=e.getOverlayContainerStopEvent(),this.options.target=this.container,this.options.position){var i="position-container-"+this.options.position;if(!document.getElementById(i)){var s=document.createElement("div");s.id=i,s.classList.add("position"),s.classList.add(i),this.container.appendChild(s)}this.options.target=this.container.children[i]}}_initContainer(){this._uid=this.options.id||SelectorID.generate(),this.element.id="GPoverviewMap-"+this._uid,this.element.classList.add("GPwidget","gpf-widget","gpf-widget-button"),this.element.classList.remove("ol-control");var e=this.element.childNodes,i=e[1];i.id="GPshowOverviewMap-"+this._uid,i.classList.add("GPshowOpen","GPshowAdvancedToolPicto","GPshowOverviewMap","gpf-btn-icon","gpf-btn-icon-overviewmap","fr-btn","fr-btn--tertiary","gpf-btn--tertiary"),i.setAttribute("tabindex","0"),i.setAttribute("aria-pressed",!this.options.collapsed),i.setAttribute("type","button"),i.removeAttribute("title"),i.setAttribute("aria-label",this.options.tipLabel);var s=this;i.addEventListener?i.addEventListener("click",function(o){var l=o.target.ariaPressed==="true";o.target.setAttribute("aria-pressed",!l),s.dispatchEvent({type:"overviewmap:toggle",status:l})}):i.attachEvent&&i.attachEvent("onclick",function(o){var l=o.target.ariaPressed==="true";o.target.setAttribute("aria-pressed",!l),s.dispatchEvent({type:"overviewmap:toggle",status:l})}),this.options.position&&(this.element.style.position="unset"),this.options.gutter===!1&&this.element.classList.add("gpf-button-no-gutter")}setMap(e){e&&(this._createContainerPosition(e),this._initContainer()),this.setTarget(this.options.target),super.setMap(e)}getContainer(){return this.container}}window.ol&&window.ol.control&&(window.ol.control.GeoportalOverviewMap=GeoportalOverviewMap);var LegendsDOM={_addUID:function(n){var e=this.uid?n+"-"+this.uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPlegends"),n.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",n},_createShowLegendsPictoElement:function(){var n=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowLegendsPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowLegendsPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-legends fr-btn fr-btn--tertiary",e.setAttribute("aria-label","Afficher les lgendes"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowLegendsClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowLegendsClick(s)}),e},_createLegendsPanelElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPlegendsPanel"),n.className="GPpanel gpf-panel fr-modal",n},_createLegendsPanelDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__legends",n},_createLegendsPanelHeaderElement:function(){var n=document.createElement("div");return n.className="gpf-panel__header_legends",n},_createLegendsPanelIconElement:function(){var n=document.createElement("label");return n.className="gpf-btn-header-legends gpf-btn-icon-header-legends",n.title="Lgendes",n},_createLegendsPanelTitleElement:function(){var n=document.createElement("div");return n.className="gpf-panel__title_legends",n.innerHTML="Lgendes",n},_createLegendsPanelCloseElement:function(){var n=this,e=document.createElement("button");e.className="gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline",e.title="Fermer le panneau";var i=document.createElement("span");return i.className="GPelementHidden gpf-visible",i.innerText="Fermer",e.appendChild(i),e.addEventListener?e.addEventListener("click",function(){document.getElementById(n._addUID("GPshowLegendsPicto")).click()},!1):e.attachEvent&&e.attachEvent("onclick",function(){document.getElementById(n._addUID("GPshowLegendsPicto")).click()}),e},_createLegendElement:function(){var n=document.createElement("div");return n.className="legends-entries gpf-panel__body fr-modal__body",n},_createLegendEntry:function(n){const e=l=>{var c=function(){if(!window.DOMParser)return!1;var H=new DOMParser;try{H.parseFromString("x","text/html")}catch{return!1}return!0};if(c()){var u=new DOMParser,f=u.parseFromString(l,"text/html");return f.body}var g=document.createElement("div");return g.innerHTML=l,g};if(n&&n.legends&&n.legends.length){var i=n.legends[0].url,s=e(`
                    <div
                        id="${n.id}"
                        class="legend-entry-container gpf-panel__content fr-modal__content">
                        <label class="legend-entry-title gpf-label-legends-name fr-label">${n.title}</label>
                        <button
                            id="GPcollapseLegend_ID_${n.id}"
                            class="legend-entry-show gpf-btn gpf-btn-icon gpf-btn-icon-legends-collapse fr-btn fr-btn--tertiary gpf-btn--tertiary"
                            type="button"
                            title=""
                            tabindex="0"
                            aria-pressed="false"></button>
                        <div id="GPlegend_ID_${n.id}" class="legend-entry-image gpf-hidden">
                            <img src="${i}" alt="${n.desc}">
                        </div>
                    </div>
                `),o=s.firstChild.querySelector("button");return o&&o.addEventListener("click",l=>{var c=l.target.ariaPressed==="true";l.target.setAttribute("aria-pressed",!c);var u=document.getElementById("GPlegend_ID_"+n.id);c?u.classList.replace("gpf-visible","gpf-hidden"):u.classList.replace("gpf-hidden","gpf-visible")}),s.firstChild}}},logger$5=LoggerByDefault.getLogger("legends");class Legends extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof Legends))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="Legends",this.initialize(e),this.container=this.initContainer(),this.element?this.element.appendChild(this.container):this.element=this.container,this}setMap(e){if(e){if(this.draggable&&Draggable.dragElement(this.panelLegendsContainer,this.panelLegendsHeaderContainer,e.getTargetElement()),this.collapsed||this.buttonLegendsShow.setAttribute("aria-pressed",!0),this.auto){var i=this;e.getLayers().forEach(s=>{i.add(s)})}this.auto&&this.addEventsListeners(e)}else this.auto&&this.removeEventsListeners();super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getContainer(){return this.container}getMetaInformations(e){if(e.hasOwnProperty("name"))return{id:e.name,title:e.getTitle(),legends:e.getLegends(),metadatas:e.getMetadata(),desc:e.getDescription(),url:e.getQuicklookUrl(),partners:e.getOriginators()}}adds(e){if(e)for(let i=0;i<e.length;i++)this.add(e[i])}add(e){if(e){var i=this._createLegendEntry(this.getMetaInformations(e));if(i)return this.exist(i)?!1:(this.panelLegendsEntriesContainer.prepend(i),this.legends.push({obj:e,dom:i}),!0)}return!1}remove(e){var i=!1;if(e)for(let s=0;s<this.legends.length;s++){const o=this.legends[s];if(e.name===o.obj.name&&e.service===o.obj.service){o.dom&&this.legends[s].dom.remove(),this.legends.splice(s,1),i=!0;break}}return i}exist(e){var i=!1;for(let s=0;s<this.legends.length;s++)if(this.legends[s].dom.id===e.id){i=!0;break}return i}initialize(e){this.uid=e.id||SelectorID.generate(),this.options={collapsed:!0,draggable:!1,auto:!0,panel:!1},Helper.assign(this.options,e),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this.auto=this.options.auto,this.buttonLegendsShow=null,this.panelLegendsContainer=null,this.panelLegendsEntriesContainer=null,this.panelLegendsHeaderContainer=null,this.buttonLegendsClose=null,this.eventsListeners=[],this.legends=[]}initContainer(){var e=this._createMainContainerElement(),i=this.buttonLegendsShow=this._createShowLegendsPictoElement();e.appendChild(i);var s=this.panelLegendsContainer=this._createLegendsPanelElement(),o=this._createLegendsPanelDivElement();s.appendChild(o);var l=this.panelLegendsEntriesContainer=this._createLegendElement();if(s.appendChild(l),this.options.panel){var c=this.panelLegendsHeaderContainer=this._createLegendsPanelHeaderElement(),u=this._createLegendsPanelIconElement();c.appendChild(u);var f=this._createLegendsPanelTitleElement();c.appendChild(f);var g=this.buttonLegendsClose=this._createLegendsPanelCloseElement();c.appendChild(g),o.appendChild(c)}return e.appendChild(s),logger$5.log(e),e}addEventsListeners(e){var i=this;this.eventsListeners["layer:add"]=function(s){if(logger$5.trace(s),!i.add(s.element)){logger$5.error("Layer already added...");return}},this.eventsListeners["layer:remove"]=function(s){if(logger$5.trace(s),!i.remove(s.element)){logger$5.error("Layer already removed...");return}},this.eventsListeners["layer:change:position"]=function(s){logger$5.trace(s)},this.eventsListeners["view:change:resolution"]=function(s){logger$5.trace(s);var o=i.getMap();for(let ee=0;ee<i.legends.length;ee++){const te=i.legends[ee];var l=i.getMetaInformations(te.obj);if(l){var c=o.getView().getResolution()||o.getView().getResolutionForZoom(o.getZoom()),u=c*3570,f=l.legends.slice(),g=f[0];for(let ne=0;ne<f.length;++ne){const Ye=f[ne];Ye.minScaleDenominator||(Ye.minScaleDenominator=0),(u>g.minScaleDenominator&&Ye.minScaleDenominator>g.minScaleDenominator&&Ye.minScaleDenominator<u||u<g.minScaleDenominator&&Ye.minScaleDenominator<g.minScaleDenominator)&&(g=Ye)}if(l.legends[0]!==g){l.legends=[],l.legends.push(g);var H=i._createLegendEntry(l),Y=te.dom;Y.replaceWith(H),te.dom=H}}}},e.getLayers().on("add",this.eventsListeners["layer:add"]),e.getLayers().on("remove",this.eventsListeners["layer:remove"]),e.getLayers().on("change:zIndex",this.eventsListeners["layer:change:position"]),e.getView().on("change:resolution",this.eventsListeners["view:change:resolution"])}removeEventsListeners(){var e=this.getMap();e.getLayers().un("add",this.eventsListeners["layer:add"]),e.getLayers().un("remove",this.eventsListeners["layer:remove"]),e.getLayers().un("change:zIndex",this.eventsListeners["layer:change:position"]),e.getView().un("change:resolution",this.eventsListeners["view:change:resolution"]),delete this.eventsListeners["layer:add"],delete this.eventsListeners["layer:remove"],delete this.eventsListeners["layer:change:position"],delete this.eventsListeners["view:change:resolution"]}onShowLegendsClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen(),logger$5.trace(e);var i=this.buttonLegendsShow.ariaPressed;this.collapsed=i!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position)}}Object.assign(Legends.prototype,LegendsDOM);Object.assign(Legends.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.Legends=Legends);const PM={projection:"EPSG:3857",nativeResolutions:["156543.0339280410","78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395","0.2985821417389697","0.1492910708694849","0.0746455354347424"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5590822640287179e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},19:{matrixId:"19",matrixHeight:524288,matrixWidth:524288,scaleDenominator:1066.364791924893,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},20:{matrixId:"20",matrixHeight:1048576,matrixWidth:1048576,scaleDenominator:533.1823959624465,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},21:{matrixId:"21",matrixHeight:2097152,matrixWidth:2097152,scaleDenominator:266.5911979812229,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_0_14={projection:"EPSG:3857",nativeResolutions:["156543.0339280410","78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5590822640287179e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_0_16={projection:"EPSG:3857",nativeResolutions:["156543.0339280410","78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5590822640287179e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_0_18={projection:"EPSG:3857",nativeResolutions:["156543.0339280410","78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5590822640287179e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_0_19={projection:"EPSG:3857",nativeResolutions:["156543.0339280410","78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395","0.2985821417389697"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5590822640287179e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},19:{matrixId:"19",matrixHeight:524288,matrixWidth:524288,scaleDenominator:1066.364791924893,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_0_21={projection:"EPSG:3857",nativeResolutions:["156543.0339280410","78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395","0.2985821417389697","0.1492910708694849","0.0746455354347424"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5590822640287179e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},19:{matrixId:"19",matrixHeight:524288,matrixWidth:524288,scaleDenominator:1066.364791924893,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},20:{matrixId:"20",matrixHeight:1048576,matrixWidth:1048576,scaleDenominator:533.1823959624465,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},21:{matrixId:"21",matrixHeight:2097152,matrixWidth:2097152,scaleDenominator:266.5911979812229,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_0_6={projection:"EPSG:3857",nativeResolutions:["156543.0339280410","78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5590822640287179e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_0_8={projection:"EPSG:3857",nativeResolutions:["156543.0339280410","78271.51696402048","39135.75848201023","19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5590822640287179e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},1:{matrixId:"1",matrixHeight:2,matrixWidth:2,scaleDenominator:27954113201435894e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},2:{matrixId:"2",matrixHeight:4,matrixWidth:4,scaleDenominator:1397705660071793e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_10_12={projection:"EPSG:3857",nativeResolutions:["152.8740565703525","76.43702828517624","38.21851414258813"],tileMatrices:{10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_15_18={projection:"EPSG:3857",nativeResolutions:["4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395"],tileMatrices:{15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_3_15={projection:"EPSG:3857",nativeResolutions:["19567.87924100512","9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516"],tileMatrices:{3:{matrixId:"3",matrixHeight:8,matrixWidth:8,scaleDenominator:6988528300358965e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_4_10={projection:"EPSG:3857",nativeResolutions:["9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525"],tileMatrices:{4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_4_18={projection:"EPSG:3857",nativeResolutions:["9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395"],tileMatrices:{4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_4_19={projection:"EPSG:3857",nativeResolutions:["9783.939620502561","4891.969810251280","2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395","0.2985821417389697"],tileMatrices:{4:{matrixId:"4",matrixHeight:16,matrixWidth:16,scaleDenominator:3494264150179486e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},5:{matrixId:"5",matrixHeight:32,matrixWidth:32,scaleDenominator:1747132075089743e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},19:{matrixId:"19",matrixHeight:524288,matrixWidth:524288,scaleDenominator:1066.364791924893,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_11={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_14={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_15={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_16={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_17={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_18={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_19={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395","0.2985821417389697"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},19:{matrixId:"19",matrixHeight:524288,matrixWidth:524288,scaleDenominator:1066.364791924893,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_21={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395","0.2985821417389697","0.1492910708694849","0.0746455354347424"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},19:{matrixId:"19",matrixHeight:524288,matrixWidth:524288,scaleDenominator:1066.364791924893,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},20:{matrixId:"20",matrixHeight:1048576,matrixWidth:1048576,scaleDenominator:533.1823959624465,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},21:{matrixId:"21",matrixHeight:2097152,matrixWidth:2097152,scaleDenominator:266.5911979812229,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_6_9={projection:"EPSG:3857",nativeResolutions:["2445.984905125640","1222.992452562820","611.4962262814100","305.7481131407048"],tileMatrices:{6:{matrixId:"6",matrixHeight:64,matrixWidth:64,scaleDenominator:8735660375448715e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_7_17={projection:"EPSG:3857",nativeResolutions:["1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879"],tileMatrices:{7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_7_18={projection:"EPSG:3857",nativeResolutions:["1222.992452562820","611.4962262814100","305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758","1.194328566955879","0.5971642834779395"],tileMatrices:{7:{matrixId:"7",matrixHeight:128,matrixWidth:128,scaleDenominator:4.3678301877243575e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},8:{matrixId:"8",matrixHeight:256,matrixWidth:256,scaleDenominator:2.1839150938621787e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},17:{matrixId:"17",matrixHeight:131072,matrixWidth:131072,scaleDenominator:4265.459167699572,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},18:{matrixId:"18",matrixHeight:262144,matrixWidth:262144,scaleDenominator:2132.7295838497826,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},PM_9_16={projection:"EPSG:3857",nativeResolutions:["305.7481131407048","152.8740565703525","76.43702828517624","38.21851414258813","19.10925707129406","9.554628535647032","4.777314267823516","2.388657133911758"],tileMatrices:{9:{matrixId:"9",matrixHeight:512,matrixWidth:512,scaleDenominator:1.0919575469310894e6,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},10:{matrixId:"10",matrixHeight:1024,matrixWidth:1024,scaleDenominator:545978.7734655464,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},11:{matrixId:"11",matrixHeight:2048,matrixWidth:2048,scaleDenominator:272989.38673277217,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},12:{matrixId:"12",matrixHeight:4096,matrixWidth:4096,scaleDenominator:136494.69336638608,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},13:{matrixId:"13",matrixHeight:8192,matrixWidth:8192,scaleDenominator:68247.34668319322,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},14:{matrixId:"14",matrixHeight:16384,matrixWidth:16384,scaleDenominator:34123.673341596535,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},15:{matrixId:"15",matrixHeight:32768,matrixWidth:32768,scaleDenominator:17061.83667079829,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}},16:{matrixId:"16",matrixHeight:65536,matrixWidth:65536,scaleDenominator:8530.918335399145,tileHeight:256,tileWidth:256,topLeftCorner:{x:-200375083427892e-7,y:200375083427892e-7}}}},TMS={"2154_10cm":{projection:"EPSG:2154",nativeResolutions:["209715.2","104857.6","52428.8","26214.4","13107.2","6553.6","3276.8","1638.4","819.2","409.6","204.8","102.4","51.2","25.6","12.8","6.4","3.2","1.6","0.8","0.4","0.2","0.1"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:7489828571428572e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},1:{matrixId:"1",matrixHeight:1,matrixWidth:1,scaleDenominator:3744914285714286e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},2:{matrixId:"2",matrixHeight:1,matrixWidth:1,scaleDenominator:1872457142857143e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},3:{matrixId:"3",matrixHeight:2,matrixWidth:1,scaleDenominator:9362285714285715e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},4:{matrixId:"4",matrixHeight:4,matrixWidth:1,scaleDenominator:46811428571428575e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},5:{matrixId:"5",matrixHeight:7,matrixWidth:1,scaleDenominator:23405714285714287e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},6:{matrixId:"6",matrixHeight:13,matrixWidth:2,scaleDenominator:11702857142857144e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},7:{matrixId:"7",matrixHeight:26,matrixWidth:4,scaleDenominator:5851428571428572e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},8:{matrixId:"8",matrixHeight:52,matrixWidth:7,scaleDenominator:2925714285714286e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},9:{matrixId:"9",matrixHeight:103,matrixWidth:13,scaleDenominator:1462857142857143e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},10:{matrixId:"10",matrixHeight:206,matrixWidth:25,scaleDenominator:731428.5714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},11:{matrixId:"11",matrixHeight:411,matrixWidth:50,scaleDenominator:365714.28571428574,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},12:{matrixId:"12",matrixHeight:822,matrixWidth:99,scaleDenominator:182857.14285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},13:{matrixId:"13",matrixHeight:1643,matrixWidth:197,scaleDenominator:91428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},14:{matrixId:"14",matrixHeight:3285,matrixWidth:394,scaleDenominator:45714.28571428572,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},15:{matrixId:"15",matrixHeight:6569,matrixWidth:788,scaleDenominator:22857.14285714286,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},16:{matrixId:"16",matrixHeight:13138,matrixWidth:1575,scaleDenominator:11428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},17:{matrixId:"17",matrixHeight:26276,matrixWidth:3150,scaleDenominator:5714.285714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},18:{matrixId:"18",matrixHeight:52552,matrixWidth:6300,scaleDenominator:2857.1428571428573,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},19:{matrixId:"19",matrixHeight:105102,matrixWidth:12600,scaleDenominator:1428.5714285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},20:{matrixId:"20",matrixHeight:210205,matrixWidth:25200,scaleDenominator:714.2857142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},21:{matrixId:"21",matrixHeight:420409,matrixWidth:50400,scaleDenominator:357.14285714285717,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}}}},"2154_10cm_10_20":{projection:"EPSG:2154",nativeResolutions:["204.8","102.4","51.2","25.6","12.8","6.4","3.2","1.6","0.8","0.4","0.2"],tileMatrices:{10:{matrixId:"10",matrixHeight:206,matrixWidth:25,scaleDenominator:731428.5714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},11:{matrixId:"11",matrixHeight:411,matrixWidth:50,scaleDenominator:365714.28571428574,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},12:{matrixId:"12",matrixHeight:822,matrixWidth:99,scaleDenominator:182857.14285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},13:{matrixId:"13",matrixHeight:1643,matrixWidth:197,scaleDenominator:91428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},14:{matrixId:"14",matrixHeight:3285,matrixWidth:394,scaleDenominator:45714.28571428572,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},15:{matrixId:"15",matrixHeight:6569,matrixWidth:788,scaleDenominator:22857.14285714286,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},16:{matrixId:"16",matrixHeight:13138,matrixWidth:1575,scaleDenominator:11428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},17:{matrixId:"17",matrixHeight:26276,matrixWidth:3150,scaleDenominator:5714.285714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},18:{matrixId:"18",matrixHeight:52552,matrixWidth:6300,scaleDenominator:2857.1428571428573,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},19:{matrixId:"19",matrixHeight:105102,matrixWidth:12600,scaleDenominator:1428.5714285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},20:{matrixId:"20",matrixHeight:210205,matrixWidth:25200,scaleDenominator:714.2857142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}}}},"2154_10cm_6_19":{projection:"EPSG:2154",nativeResolutions:["3276.8","1638.4","819.2","409.6","204.8","102.4","51.2","25.6","12.8","6.4","3.2","1.6","0.8","0.4"],tileMatrices:{6:{matrixId:"6",matrixHeight:13,matrixWidth:2,scaleDenominator:11702857142857144e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},7:{matrixId:"7",matrixHeight:26,matrixWidth:4,scaleDenominator:5851428571428572e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},8:{matrixId:"8",matrixHeight:52,matrixWidth:7,scaleDenominator:2925714285714286e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},9:{matrixId:"9",matrixHeight:103,matrixWidth:13,scaleDenominator:1462857142857143e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},10:{matrixId:"10",matrixHeight:206,matrixWidth:25,scaleDenominator:731428.5714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},11:{matrixId:"11",matrixHeight:411,matrixWidth:50,scaleDenominator:365714.28571428574,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},12:{matrixId:"12",matrixHeight:822,matrixWidth:99,scaleDenominator:182857.14285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},13:{matrixId:"13",matrixHeight:1643,matrixWidth:197,scaleDenominator:91428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},14:{matrixId:"14",matrixHeight:3285,matrixWidth:394,scaleDenominator:45714.28571428572,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},15:{matrixId:"15",matrixHeight:6569,matrixWidth:788,scaleDenominator:22857.14285714286,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},16:{matrixId:"16",matrixHeight:13138,matrixWidth:1575,scaleDenominator:11428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},17:{matrixId:"17",matrixHeight:26276,matrixWidth:3150,scaleDenominator:5714.285714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},18:{matrixId:"18",matrixHeight:52552,matrixWidth:6300,scaleDenominator:2857.1428571428573,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},19:{matrixId:"19",matrixHeight:105102,matrixWidth:12600,scaleDenominator:1428.5714285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}}}},"2154_10cm_6_20":{projection:"EPSG:2154",nativeResolutions:["3276.8","1638.4","819.2","409.6","204.8","102.4","51.2","25.6","12.8","6.4","3.2","1.6","0.8","0.4","0.2"],tileMatrices:{6:{matrixId:"6",matrixHeight:13,matrixWidth:2,scaleDenominator:11702857142857144e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},7:{matrixId:"7",matrixHeight:26,matrixWidth:4,scaleDenominator:5851428571428572e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},8:{matrixId:"8",matrixHeight:52,matrixWidth:7,scaleDenominator:2925714285714286e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},9:{matrixId:"9",matrixHeight:103,matrixWidth:13,scaleDenominator:1462857142857143e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},10:{matrixId:"10",matrixHeight:206,matrixWidth:25,scaleDenominator:731428.5714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},11:{matrixId:"11",matrixHeight:411,matrixWidth:50,scaleDenominator:365714.28571428574,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},12:{matrixId:"12",matrixHeight:822,matrixWidth:99,scaleDenominator:182857.14285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},13:{matrixId:"13",matrixHeight:1643,matrixWidth:197,scaleDenominator:91428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},14:{matrixId:"14",matrixHeight:3285,matrixWidth:394,scaleDenominator:45714.28571428572,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},15:{matrixId:"15",matrixHeight:6569,matrixWidth:788,scaleDenominator:22857.14285714286,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},16:{matrixId:"16",matrixHeight:13138,matrixWidth:1575,scaleDenominator:11428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},17:{matrixId:"17",matrixHeight:26276,matrixWidth:3150,scaleDenominator:5714.285714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},18:{matrixId:"18",matrixHeight:52552,matrixWidth:6300,scaleDenominator:2857.1428571428573,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},19:{matrixId:"19",matrixHeight:105102,matrixWidth:12600,scaleDenominator:1428.5714285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},20:{matrixId:"20",matrixHeight:210205,matrixWidth:25200,scaleDenominator:714.2857142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}}}},"2154_5cm":{projection:"EPSG:2154",nativeResolutions:["209715.2","104857.6","52428.8","26214.4","13107.2","6553.6","3276.8","1638.4","819.2","409.6","204.8","102.4","51.2","25.6","12.8","6.4","3.2","1.6","0.8","0.4","0.2","0.1","0.05"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:7489828571428572e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},1:{matrixId:"1",matrixHeight:1,matrixWidth:1,scaleDenominator:3744914285714286e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},2:{matrixId:"2",matrixHeight:1,matrixWidth:1,scaleDenominator:1872457142857143e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},3:{matrixId:"3",matrixHeight:2,matrixWidth:1,scaleDenominator:9362285714285715e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},4:{matrixId:"4",matrixHeight:4,matrixWidth:1,scaleDenominator:46811428571428575e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},5:{matrixId:"5",matrixHeight:7,matrixWidth:1,scaleDenominator:23405714285714287e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},6:{matrixId:"6",matrixHeight:13,matrixWidth:2,scaleDenominator:11702857142857144e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},7:{matrixId:"7",matrixHeight:26,matrixWidth:4,scaleDenominator:5851428571428572e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},8:{matrixId:"8",matrixHeight:52,matrixWidth:7,scaleDenominator:2925714285714286e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},9:{matrixId:"9",matrixHeight:103,matrixWidth:13,scaleDenominator:1462857142857143e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},10:{matrixId:"10",matrixHeight:206,matrixWidth:25,scaleDenominator:731428.5714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},11:{matrixId:"11",matrixHeight:411,matrixWidth:50,scaleDenominator:365714.28571428574,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},12:{matrixId:"12",matrixHeight:822,matrixWidth:99,scaleDenominator:182857.14285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},13:{matrixId:"13",matrixHeight:1643,matrixWidth:197,scaleDenominator:91428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},14:{matrixId:"14",matrixHeight:3285,matrixWidth:394,scaleDenominator:45714.28571428572,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},15:{matrixId:"15",matrixHeight:6569,matrixWidth:788,scaleDenominator:22857.14285714286,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},16:{matrixId:"16",matrixHeight:13138,matrixWidth:1575,scaleDenominator:11428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},17:{matrixId:"17",matrixHeight:26276,matrixWidth:3150,scaleDenominator:5714.285714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},18:{matrixId:"18",matrixHeight:52552,matrixWidth:6300,scaleDenominator:2857.1428571428573,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},19:{matrixId:"19",matrixHeight:105102,matrixWidth:12600,scaleDenominator:1428.5714285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},20:{matrixId:"20",matrixHeight:210205,matrixWidth:25200,scaleDenominator:714.2857142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},21:{matrixId:"21",matrixHeight:420409,matrixWidth:50400,scaleDenominator:357.14285714285717,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},22:{matrixId:"22",matrixHeight:840818,matrixWidth:100800,scaleDenominator:178.57142857142858,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}}}},"2154_5cm_6_22":{projection:"EPSG:2154",nativeResolutions:["3276.8","1638.4","819.2","409.6","204.8","102.4","51.2","25.6","12.8","6.4","3.2","1.6","0.8","0.4","0.2","0.1","0.05"],tileMatrices:{6:{matrixId:"6",matrixHeight:13,matrixWidth:2,scaleDenominator:11702857142857144e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},7:{matrixId:"7",matrixHeight:26,matrixWidth:4,scaleDenominator:5851428571428572e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},8:{matrixId:"8",matrixHeight:52,matrixWidth:7,scaleDenominator:2925714285714286e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},9:{matrixId:"9",matrixHeight:103,matrixWidth:13,scaleDenominator:1462857142857143e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},10:{matrixId:"10",matrixHeight:206,matrixWidth:25,scaleDenominator:731428.5714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},11:{matrixId:"11",matrixHeight:411,matrixWidth:50,scaleDenominator:365714.28571428574,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},12:{matrixId:"12",matrixHeight:822,matrixWidth:99,scaleDenominator:182857.14285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},13:{matrixId:"13",matrixHeight:1643,matrixWidth:197,scaleDenominator:91428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},14:{matrixId:"14",matrixHeight:3285,matrixWidth:394,scaleDenominator:45714.28571428572,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},15:{matrixId:"15",matrixHeight:6569,matrixWidth:788,scaleDenominator:22857.14285714286,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},16:{matrixId:"16",matrixHeight:13138,matrixWidth:1575,scaleDenominator:11428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},17:{matrixId:"17",matrixHeight:26276,matrixWidth:3150,scaleDenominator:5714.285714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},18:{matrixId:"18",matrixHeight:52552,matrixWidth:6300,scaleDenominator:2857.1428571428573,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},19:{matrixId:"19",matrixHeight:105102,matrixWidth:12600,scaleDenominator:1428.5714285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},20:{matrixId:"20",matrixHeight:210205,matrixWidth:25200,scaleDenominator:714.2857142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},21:{matrixId:"21",matrixHeight:420409,matrixWidth:50400,scaleDenominator:357.14285714285717,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},22:{matrixId:"22",matrixHeight:840818,matrixWidth:100800,scaleDenominator:178.57142857142858,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}}}},"LAMB93_2.5m":{projection:"IGNF:LAMB93",nativeResolutions:["163840","81920","40960","20480","10240","5120","2560","1280","640","320","160","80","40","20","10","5","2.5"],tileMatrices:{0:{matrixId:"0",matrixHeight:1,matrixWidth:1,scaleDenominator:5851428571428572e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},1:{matrixId:"1",matrixHeight:1,matrixWidth:1,scaleDenominator:2925714285714286e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},2:{matrixId:"2",matrixHeight:2,matrixWidth:1,scaleDenominator:1462857142857143e-7,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},3:{matrixId:"3",matrixHeight:3,matrixWidth:1,scaleDenominator:7314285714285715e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},4:{matrixId:"4",matrixHeight:5,matrixWidth:1,scaleDenominator:36571428571428575e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},5:{matrixId:"5",matrixHeight:9,matrixWidth:1,scaleDenominator:18285714285714287e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},6:{matrixId:"6",matrixHeight:17,matrixWidth:2,scaleDenominator:9142857142857144e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},7:{matrixId:"7",matrixHeight:33,matrixWidth:4,scaleDenominator:4571428571428572e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},8:{matrixId:"8",matrixHeight:66,matrixWidth:8,scaleDenominator:2285714285714286e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},9:{matrixId:"9",matrixHeight:132,matrixWidth:16,scaleDenominator:1142857142857143e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},10:{matrixId:"10",matrixHeight:263,matrixWidth:32,scaleDenominator:571428.5714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},11:{matrixId:"11",matrixHeight:526,matrixWidth:63,scaleDenominator:285714.28571428574,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},12:{matrixId:"12",matrixHeight:1051,matrixWidth:126,scaleDenominator:142857.14285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},13:{matrixId:"13",matrixHeight:2102,matrixWidth:252,scaleDenominator:71428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},14:{matrixId:"14",matrixHeight:4204,matrixWidth:504,scaleDenominator:35714.28571428572,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},15:{matrixId:"15",matrixHeight:8408,matrixWidth:1008,scaleDenominator:17857.14285714286,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},16:{matrixId:"16",matrixHeight:16816,matrixWidth:2016,scaleDenominator:8928.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}}}},"LAMB93_2.5m_3_16":{projection:"IGNF:LAMB93",nativeResolutions:["20480","10240","5120","2560","1280","640","320","160","80","40","20","10","5","2.5"],tileMatrices:{3:{matrixId:"3",matrixHeight:3,matrixWidth:1,scaleDenominator:7314285714285715e-8,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},4:{matrixId:"4",matrixHeight:5,matrixWidth:1,scaleDenominator:36571428571428575e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},5:{matrixId:"5",matrixHeight:9,matrixWidth:1,scaleDenominator:18285714285714287e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},6:{matrixId:"6",matrixHeight:17,matrixWidth:2,scaleDenominator:9142857142857144e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},7:{matrixId:"7",matrixHeight:33,matrixWidth:4,scaleDenominator:4571428571428572e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},8:{matrixId:"8",matrixHeight:66,matrixWidth:8,scaleDenominator:2285714285714286e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},9:{matrixId:"9",matrixHeight:132,matrixWidth:16,scaleDenominator:1142857142857143e-9,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},10:{matrixId:"10",matrixHeight:263,matrixWidth:32,scaleDenominator:571428.5714285715,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},11:{matrixId:"11",matrixHeight:526,matrixWidth:63,scaleDenominator:285714.28571428574,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},12:{matrixId:"12",matrixHeight:1051,matrixWidth:126,scaleDenominator:142857.14285714287,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},13:{matrixId:"13",matrixHeight:2102,matrixWidth:252,scaleDenominator:71428.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},14:{matrixId:"14",matrixHeight:4204,matrixWidth:504,scaleDenominator:35714.28571428572,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},15:{matrixId:"15",matrixHeight:8408,matrixWidth:1008,scaleDenominator:17857.14285714286,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}},16:{matrixId:"16",matrixHeight:16816,matrixWidth:2016,scaleDenominator:8928.57142857143,tileHeight:256,tileWidth:256,topLeftCorner:{x:0,y:12e6}}}},PM,PM_0_14,PM_0_16,PM_0_18,PM_0_19,PM_0_21,PM_0_6,PM_0_8,PM_10_12,PM_15_18,PM_3_15,PM_4_10,PM_4_18,PM_4_19,PM_6_11,PM_6_14,PM_6_15,PM_6_16,PM_6_17,PM_6_18,PM_6_19,PM_6_21,PM_6_9,PM_7_17,PM_7_18,PM_9_16};var LayerConfigUtils={getLayerConfig:function(n){var e={};if(n){var i=n.serviceParams.id.split(/:/)[1],s=Object.keys(n.serviceParams.serverUrl)[0];if(e.url=n.serviceParams.serverUrl[s],i!=="WFS"&&(/\/v\//.test(e.url)?e.styles=" ":e.styles=n.styles[0].name),e.version=n.serviceParams.version,e.format=n.formats&&n.formats.length?n.formats[0].name:"",e.projection=n.defaultProjection,e.minScale=n.globalConstraint?n.globalConstraint.minScaleDenominator:null,e.maxScale=n.globalConstraint?n.globalConstraint.maxScaleDenominator:null,e.extent=n.globalConstraint?n.globalConstraint.bbox:null,e.legends=n.legends,e.title=n.title,e.description=n.description,i==="WMS"&&(e.metadata=n.metadata),n.wmtsOptions){e.tileMatrixSetLimits=n.wmtsOptions.tileMatrixSetLimits;var o=n.wmtsOptions.tileMatrixSetLink;if(o){e.TMSLink=o;var l=this.getTMSConfig(o);e.matrixIds=Object.keys(l.tileMatrices),e.tileMatrices=l.tileMatrices,e.nativeResolutions=l.nativeResolutions||this.getTMSConfig("PM").nativeResolutions}}}return{params:e}},getTMSConfig:function(n){return TMS[n]}};const stringToHTML$2=n=>{var e=function(){if(!window.DOMParser)return!1;var l=new DOMParser;try{l.parseFromString("x","text/html")}catch{return!1}return!0};if(e()){var i=new DOMParser,s=i.parseFromString(n,"text/html");return s.body}var o=document.createElement("div");return o.innerHTML=n,o};var CatalogDOM={generateID:function(n){return Math.abs(Array.from(n).reduce((e,i)=>Math.imul(31,e)+i.charCodeAt(0)|0,0))},_addUID:function(n){var e=this.uid?n+"-"+this.uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPcatalog"),n.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",n},_createShowCatalogPictoElement:function(){var n=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowCatalogPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowCatalogPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-catalog fr-btn fr-btn--tertiary",e.setAttribute("aria-label","Catalogue de donnes"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowCatalogClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowCatalogClick(s)}),e},_createCatalogPanelElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPcatalogPanel"),n.className="GPpanel gpf-panel fr-modal",n},_createCatalogPanelDivSizeElement:function(n){n||(n="md");var e="";switch(n){case"sm":e="fr-col-8";break;case"md":e="fr-col-10";break;case"lg":e="fr-col-12";break;case"xl":e="fr-col-14";break}var i=document.createElement("div");return i.className=e,i},_createCatalogPanelDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__body fr-modal__body",n},_createCatalogPanelContentDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__content fr-modal__content",n},_createCatalogPanelHeaderElement:function(){var n=document.createElement("div");return n.className="GPpanelHeader gpf-panel__header_catalog",n},_createCatalogPanelTitleElement:function(n){var e=document.createElement("div");return e.className="GPpanelTitle gpf-panel__title_catalog",e.innerHTML=n,e},_createCatalogPanelIconElement:function(n){var e=document.createElement("label");return e.className="gpf-btn-header-catalog gpf-btn-icon-header-catalog",e.title=n,e},_createCatalogPanelCloseElement:function(){var n=this,e=document.createElement("button");e.id=this._addUID("GPcatalogPanelClose"),e.className="GPpanelClose GPcatalogPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline",e.title="Fermer le panneau",e.addEventListener?e.addEventListener("click",function(){document.getElementById(n._addUID("GPshowCatalogPicto")).click(),n.onCloseCatalogClick()},!1):e.attachEvent&&e.attachEvent("onclick",function(){document.getElementById(n._addUID("GPshowCatalogPicto")).click(),n.onCloseCatalogClick()});var i=document.createElement("span");return i.className="GPelementHidden gpf-hidden",i.innerText="Fermer",e.appendChild(i),e},_createCatalogContentDivElement:function(){var n=stringToHTML$2('<div class="catalog-container-content" style=""></div>');return n.firstChild},_createCatalogContentTitleElement:function(n){var e=stringToHTML$2(`
        <!-- titre -->
        <div class="catalog-container-title">
            <div class="fr-title">
                <h5 style="margin:unset">${n}</h5>
            </div>
        </div>
        `);return e.firstChild},_createCatalogContentSearchGlobalElement:function(n){var e=`
        <!-- barre de recherche globale -->
        <!-- https://www.systeme-de-design.gouv.fr/composants-et-modeles/composants/barre-de-recherche -->
        <div class="catalog-container-search-global" style="padding:10px;">
            <div class="fr-search-bar" id="catalog-header-search-global" role="search" style="justify-content: center;">
                <label class="fr-label" for="catalog-input-search-global">
                    Recherche
                </label>
                <div class="input-wrapper" style="width:100%;">
                    <input class="fr-input" placeholder="${n}" type="text" id="catalog-input-search-global" name="search-input" incremental>
                    <button type="button" id="catalog-button-reset-search-global" class="clear-btn" aria-label="Effacer le texte">
                        <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-opacity="0.8"/>
                            <line x1="6" y1="6" x2="14" y2="14"/>
                            <line x1="14" y1="6" x2="6" y2="14"/>
                        </svg>
                    </button>
                </div>
                <button id="catalog-button-search-global" class="fr-btn" title="${n}">
                    Rechercher
                </button>
            </div>
        </div>
        `,i=stringToHTML$2(e);const s=i.attachShadow({mode:"open"});s.innerHTML=e.trim();var o=s.getElementById("catalog-button-search-global");o&&o.addEventListener("click",u=>{u.target.value=c.value,this.onSearchGlobalCatalogButtonClick(u)});var l=s.getElementById("catalog-button-reset-search-global");l&&l.addEventListener("click",u=>{c.value="",this.onSearchGlobalCatalogButtonResetClick(u)});var c=s.getElementById("catalog-input-search-global");return c&&c.addEventListener("input",u=>{u.target.value.length<3||this.onSearchGlobalCatalogInputChange(u)}),s},_createCatalogWaitingElement:function(){var n=document.createElement("div");n.id=this._addUID("GPcatalogCalcWaitingContainer"),n.className="GPwaitingContainerHidden gpf-waiting--hidden";var e=document.createElement("p");return e.className="GPwaitingContainerInfo gpf-waiting_info",e.innerHTML="Recherche en cours...",n.appendChild(e),n},_createCatalogContentCategoriesTabs:function(n){var e="",i=(st,ot,ut,ht)=>{var dt="GPtabButton fr-tabs__tab",pt="false",yt=-1;return ht&&(dt="GPtabButton GPtabButtonActive fr-tabs__tab",pt="true",yt=0),`
            <li class="GPtabList" role="presentation">
                <button id="tabbutton-${st}_${ot}" class="${dt}" tabindex="${yt}" role="tabbutton" aria-selected="${pt}" aria-controls="tabpanel-${st}-panel_${ot}">${ut}</button>
            </li>
            `},s=(st,ot)=>{var ut="gpf-hidden";return st&&(ut="fr-tabs__panel--selected"),`
            <!-- barre de recherche spcifique  la catgorie -->
            <div id="catalog-container-search-specific" class="fr-tabs__list ${ut}" style="padding:10px;justify-content:center;">
                <div class="fr-search-bar" id="catalog-header-search-specific" role="search" style="width:100%;">
                    <label class="fr-label" for="catalog-input-search-specific">
                        Recherche dans la catgorie
                    </label>
                    <div class="input-wrapper" style="width:100%">
                        <input class="fr-input" placeholder="${ot}" type="text" id="catalog-input-search-specific" name="search-input-specific" incremental>
                        <button type="button" id="catalog-button-reset-search-specific" class="clear-btn" aria-label="Effacer le texte">
                            <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-opacity="0.8"/>
                                <line x1="6" y1="6" x2="14" y2="14"/>
                                <line x1="14" y1="6" x2="6" y2="14"/>
                            </svg>
                        </button>
                    </div>
                    <button id="catalog-button-search-specific" class="fr-btn" title="${ot}">
                        Rechercher
                    </button>
                </div>
            </div>
            `},o=(st,ot)=>{var ut=ot.default?"checked":"";return`
            <div class="fr-fieldset__element fr-fieldset__element--inline">
                <div class="fr-radio-group fr-radio-group--sm">
                    <input 
                        type="radio" 
                        ${ut} 
                        id="radio-inline_${ot.id}" 
                        name="radio-inline-${st}" 
                        role="radio-inline-section"
                        aria-controls="tabcontent-${ot.id}">
                    <label class="fr-label" for="radio-inline_${ot.id}">
                        ${ot.title}
                    </label>
                </div>
            </div>
            `},l=(st,ot)=>{var ut="",ht="";for(let pt=0;pt<ot.length;pt++){const yt=ot[pt];ht+=o(st,yt);var dt="";yt.default||(dt="GPelementHidden gpf-hidden"),ut+=`<div class="tabcontent ${dt}" data-category="${st}" role="tabpanel-section" id="tabcontent-${yt.id}"></div>`}return`
            <!-- boutons radio des sous categories -->
            <fieldset class="fr-fieldset" id="radio-inline_${st}" aria-labelledby="radio-inline-legend radio-inline-messages" style="margin:unset;">
                ${ht}
                <div class="fr-messages-group" id="radio-inline-messages" aria-live="assertive"></div>
            </fieldset>
            <!-- panneaux des sous categories -->
            ${ut}
            `},c="",u=(st,ot,ut,ht,dt,pt)=>{var yt="GPtabContent fr-tabs__panel",mt=-1;ut&&(yt="GPtabContent GPtabContentSelected fr-tabs__panel fr-tabs__panel--selected",mt=0);var St=`<div class="tabcontent" data-category="${ot}" style="content-visibility: auto;contain-intrinsic-size:50px;"></div>`;dt&&(St=l(ot,dt));var wt="330px";return pt&&!ht&&(wt="390px"),`
            <!-- panneaux -->
            <div id="tabpanel-${st}-panel_${ot}" 
                class="${yt}" 
                role="tabpanel" 
                aria-labelledby="tabbutton-${st}_${ot}" 
                tabindex="${mt}" 
                style="max-height: ${wt};overflow-y: auto; padding: 1em; contain: content;">
                ${St}
            </div>
            `},f=!1,g=!1;for(let st=0;st<n.length;st++){const ot=n[st];ot.search&&(g=!0),ot.default&&ot.search&&(f=!0)}for(let st=0;st<n.length;st++){const ot=n[st];e+=i(st,ot.id,ot.title,ot.default),c+=u(st,ot.id,ot.default,ot.search,ot.items,g)}var Y=s(f,"Rechercher une donne dans la catgorie"),ee="369px";g&&(ee="434px");var te=`
        <!-- onglets -->
        <div id="GPcatalogContainerTabs" class="catalog-container-tabs">
            <div class="GPtabs fr-tabs" style="--tabs-height: ${ee};">
                <ul class="GPtabsList fr-tabs__list" role="tablist" aria-label="presentation">
                    ${e}
                </ul>
                ${Y}
                ${c}
            </div>
        </div>
        `,ne=stringToHTML$2(te.trim());const Ye=ne.attachShadow({mode:"open"});Ye.innerHTML=te.trim();var xe=Ye.querySelectorAll('[role="tabpanel-section"]'),tt=Ye.querySelectorAll('[role="radio-inline-section"]');tt&&tt.forEach(st=>{var ot=st.getAttribute("checked");ot!==null&&st.click(),st.addEventListener("change",ut=>{for(let pt=0;pt<xe.length;pt++){const yt=xe[pt];var ht=yt.getAttribute("data-category");ht===ut.target.name.split("-")[2]&&(yt.classList.add("gpf-hidden"),yt.classList.add("GPelementHidden"))}var dt=document.getElementById(ut.target.getAttribute("aria-controls"));dt.classList.remove("gpf-hidden"),dt.classList.remove("GPelementHidden")})});var et=Ye.querySelectorAll('[role="tabpanel"]'),it=Ye.querySelectorAll('[role="tabbutton"]');it&&it.forEach(st=>{st.addEventListener("click",ot=>{for(let ht=0;ht<it.length;ht++){const dt=it[ht];dt.setAttribute("tabindex",-1),dt.ariaSelected=!1,dt.classList.remove("GPtabButtonActive")}ot.target.setAttribute("tabindex",0),ot.target.ariaSelected=!0,ot.target.classList.add("GPtabButtonActive");for(let ht=0;ht<et.length;ht++){const dt=et[ht];dt.setAttribute("tabindex",-1),dt.classList.remove("fr-tabs__panel--selected"),dt.classList.remove("GPtabContentSelected"),dt.classList.add("gpf-hidden"),dt.classList.add("GPelementHidden")}var ut=document.getElementById(ot.target.getAttribute("aria-controls"));ut.setAttribute("tabindex",0),ut.classList.add("fr-tabs__panel--selected"),ut.classList.add("GPtabContentSelected"),ut.classList.remove("gpf-hidden"),ut.classList.remove("GPelementHidden"),this.onSelectCatalogTabClick(ot)})});var rt=Ye.getElementById("catalog-button-search-specific");rt&&rt.addEventListener("click",st=>{st.target.value=at.value,this.onSearchSpecificCatalogButtonClick(st)});var nt=Ye.getElementById("catalog-button-reset-search-specific");nt&&nt.addEventListener("click",st=>{at.value="",this.onSearchSpecificCatalogButtonResetClick(st)});var at=Ye.getElementById("catalog-input-search-specific");return at&&at.addEventListener("input",st=>{st.target.value.length<3||this.onSearchSpecificCatalogInputChange(st)}),Ye},_createCatalogContentCategoryTabContent:async function(n,e){var i=Object.values(e).sort((st,ot)=>st.title.localeCompare(ot.title,"fr",{sensitivity:"base"}));const s=10;var o=[],l=[],c="",u=(st,ot,ut,ht,dt,pt,yt,mt)=>{var St=Gt=>{if(Gt){if(Gt.startsWith("data:")||Gt.startsWith("http"))return`
                        <div class="catalog-thumbnail" style="width:50px; height:50px; margin-right:10px; flex-shrink:0; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                            <img src="${Gt}" alt="Aperu de la couche" style="min-width:100%;min-height:100%;object-fit:cover;"/>
                        </div>
                        `;if(Gt="default",Gt==="default")return'<div class="catalog-thumbnail-default" style="width:50px; height:50px; margin-right:10px; flex-shrink:0; display:flex; align-items:center; justify-content:center; overflow:hidden;"></div>'}return""},wt=pt.producers?pt.producers[0].name:"",Rt=Gt=>{if(!Gt)return"";var vt="";for(let Et=0;Et<Gt.length;Et++){const _t=Gt[Et];vt+=`
                        <a href="${_t.url}" target="_blank" class="fr-tag fr-tag--sm fr-icon-arrow-right-line fr-tag--icon-left">
                            ${_t.name}
                        </a>
                    `}return vt},Lt=Gt=>{if(!Gt)return"";var vt="";for(let Et=0;Et<Gt.length;Et++){const _t=Gt[Et];if(_t.includes("catalogue/dataset"))return`
                            <a href="${_t}" target="_blank" class="fr-link fr-icon-arrow-right-line fr-link--icon-right">
                                Voir la fiche dtaille
                            </a>
                        `}return vt};return`
            <div 
                class="fr-fieldset__element" 
                id="fieldset-${mt}_${ot}-${ht}"
                style="contain: content;">
                <div class="fr-checkbox-group gpf-flex" style="justify-content:flex-start;padding-top:5px;padding-bottom:5px;box-shadow: inset 0 1px 0 0 var(--border-default-grey),0 0 0 0 var(--border-default-grey);">
                    <input
                        class="fr-input"
                        name="checkboxes-${mt}"
                        id="checkboxes-${mt}-${st}_${ot}-${ht}"
                        type="checkbox"
                        data-layer="${ot}:${ht}"/>
                    <label 
                        for="checkboxes-${mt}-${st}_${ot}-${ht}"
                        style="position: relative; bottom: 12px;">
                    </label>
                    <div class="catalog-thumbnail-container" style="">
                        ${St(yt)}
                    </div>
                    <label 
                        class="GPlabelActive fr-label"
                        role="label-collapse-more-${mt}"
                        aria-controls="catalog-collapse-more-${st}-${mt}"
                        title="${ot}"
                        style="display: inline-block; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; cursor: pointer;">
                        ${ut}
                        <span class="GPlabelActive fr-label fr-hint-text">${wt}</span>
                    </label>
                    <button 
                        id="catalog-collapse-more-${st}-${mt}"
                        role="button-collapse-more-${mt}"
                        class="catalog-collapse-show gpf-btn gpf-btn-icon gpf-btn-icon-catalog-collapse fr-btn fr-btn--tertiary gpf-btn--tertiary" 
                        type="button" 
                        title="En savoir plus sur la couche" 
                        tabindex="0" 
                        aria-pressed="false"
                        aria-controls="catalog-info-more-${st}-${mt}"
                        style="">
                    </button>
                </div>
                <div class="gpf-hidden" id="catalog-info-more-${st}-${mt}">
                    <p>
                        <span class="fr-label fr-message">${ot} - ${ht}</span>
                        ${Rt(pt.producers)}
                    </p>
                    ${dt}
                    ${Lt(pt.metadatas)}
                </div>
            </div>
            `},f="",g=(st,ot,ut,ht,dt,pt)=>{var yt=ht&&ht.startsWith("fr-icon")?ht:"",mt=`accordion-${ot}-${st}`;return`
            <!-- section -->
            <section id="section-${ot}-${st}" class="fr-accordion" style="contain: content;">
                <h3 class="fr-accordion__title">
                    <button class="GPcatalogButtonSection fr-accordion__btn gpf-accordion__btn" role="section-collapse-${ot}" aria-expanded="false" aria-controls="${mt}">
                        <span class="GPshowCatalogAdvancedTools gpf-hidden"></span>
                        <span class="catalog-section-icon ${yt}" role="section-icon-collapse-${ot}" style="width: calc(100% - 2rem);">${ut}</span>
                        <span class="catalog-section-count" role="section-count-collapse-${ot}" id="section-count-${ot}-${st}" style="position: absolute; right: 1.25rem;">${dt}</span>
                    </button>
                </h3>
                <div class="fr-collapse GPelementHidden" id="${mt}">
                    ${pt}
                </div>
            </section>
            `},H=n.section;H&&(i=i.sort((st,ot)=>st[n.filter.field][0].localeCompare(ot[n.filter.field][0])));var Y={};for(let st=0;st<i.length;st+=s){for(let ot=st;ot<Math.min(st+s,i.length);ot++){const ut=i[ot],ht={producers:ut.producer_urls,thematics:ut.thematic_urls,metadatas:ut.metadata_urls};var ee=u(ot,ut.name,ut.label,ut.service,ut.description,ht,ut.thumbnail,n.id);if(H){var te=ut[n.filter.field];Array.isArray(te)&&(te=te[0]),te?(Y.hasOwnProperty(te)||(Y[te]=""),Y[te]+=ee):Y.Autres+=ee}else c+=ee,l.push(ee)}await new Promise(ot=>setTimeout(ot,0))}if(c!==""){var rt=`
            <!-- liste de couches -->
            <div class="fr-accordions-group" 
                id="layers-${n.id}"
                data-category="${n.id}"
                data-sections="false"
                aria-labelledby="checkboxes-legend checkboxes-messages"
                style="contain: content;">
                ${c}
            </div>
            `,nt=stringToHTML$2(rt);o.push({id:n.id,dom:nt.firstChild,type:"layers",desc:"liste des couches pour une categorie",rows:l,title:n.title})}if(H){n.sections=[];for(const st in Y)if(Object.prototype.hasOwnProperty.call(Y,st)){const ot=Y[st];var ne=[],Ye=[...ot.matchAll(/"fr-fieldset__element"/g)];for(let ut=0;ut<Ye.length;ut++){const ht=Ye[ut];ne.push(ht.input)}var xe=Ye.length,tt=this.generateID(st),et="";if(n.icon&&n.iconJson){const ut=n.iconJson.find(ht=>ht.name===st);ut?et=ut.icon:et="fr-icon-arrow-right-s-line"}if(c=g(tt,n.id,st,et,xe,ot),f+=c,n.sections.push(st),c!==""){var it=`
                        <!-- liste de sections -->
                        <div class="fr-accordions-group" 
                            id="sections-${n.id}-${tt}"
                            data-category="${n.id}"
                            data-section="true"
                            data-id="${tt}"
                            data-title="${st}"
                            aria-labelledby="checkboxes-legend checkboxes-messages"
                            style="contain: content;">
                            ${c}
                        </div>
                        `,nt=stringToHTML$2(it);o.push({id:`${n.id}-${tt}`,dom:nt.firstChild,type:"sections",rows:ne,desc:"liste des couches pour une section",title:st}),c=""}}}var rt=`
            <!-- liste de donnes -->
            <div class="fr-accordions-group" 
                id="checkboxes-${n.id}" 
                data-category="${n.id}"
                data-sections="${!!f}"
                aria-labelledby="checkboxes-legend checkboxes-messages"
                style="contain: content;">
                ${f||c}
            </div>
        `,nt=stringToHTML$2(rt);const at=nt.attachShadow({mode:"open"});return at.innerHTML=rt.trim(),{dom:at,blocks:o}},_updateListenersLayersDOM:function(n,e){var i=`checkboxes-${e}`,s=n.querySelectorAll('[name="'+i+'"]');s&&s.forEach(ne=>{ne.addEventListener("click",Ye=>{this.onSelectCatalogEntryClick(Ye)})});var o=`section-collapse-${e}`,l=n.querySelectorAll('[role="'+o+'"]');l&&l.forEach(ne=>{ne.addEventListener("click",Ye=>{Ye.target.ariaExpanded=Ye.target.ariaExpanded!=="true";var xe=document.getElementById(Ye.target.getAttribute("aria-controls"));if(xe)if(Ye.target.ariaExpanded==="true"){xe.classList.add("fr-collapse--expanded"),xe.classList.remove("GPelementHidden");const tt=ne.closest('div[id^="tabpanel-"]'),et=ne.getBoundingClientRect(),it=tt.getBoundingClientRect(),rt=et.top-it.top;tt.scrollTo({top:tt.scrollTop+rt,behavior:"smooth"})}else xe.classList.remove("fr-collapse--expanded"),xe.classList.add("GPelementHidden")},!1)});var c=`button-collapse-more-${e}`,u=n.querySelectorAll('[role="'+c+'"]');u&&u.forEach(ne=>{ne.addEventListener("click",Ye=>{Ye.target.ariaPressed=Ye.target.ariaPressed!=="true";var xe=document.getElementById(Ye.target.getAttribute("aria-controls"));if(xe){if(Ye.target.ariaPressed==="true"){xe.classList.add("gpf-visible"),xe.classList.remove("gpf-hidden"),ne.closest('div[id^="tabpanel-"]');const tt=ne.closest('div[id^="tabpanel-"]'),et=ne.getBoundingClientRect(),it=tt.getBoundingClientRect(),rt=et.top-it.top;tt.scrollTo({top:tt.scrollTop+rt,behavior:"smooth"})}else xe.classList.remove("gpf-visible"),xe.classList.add("gpf-hidden");this.onToggleCatalogMoreLearnClick(Ye)}},!1)});var f=`label-collapse-more-${e}`,g=n.querySelectorAll('[role="'+f+'"]');g&&g.forEach(ne=>{ne.addEventListener("click",Ye=>{var xe=document.getElementById(Ye.target.getAttribute("aria-controls"));xe&&xe.click()},!1)});var H=`section-icon-collapse-${e}`,Y=n.querySelectorAll('[role="'+H+'"]');Y&&Y.forEach(ne=>{ne.addEventListener("click",Ye=>{Ye.target.parentElement.click()})});var ee=`section-count-collapse-${e}`,te=n.querySelectorAll('[role="'+ee+'"]');te&&te.forEach(ne=>{ne.addEventListener("click",Ye=>{Ye.target.parentElement.click()})})}};const thematic=[{id:"biota",name:"Biologie, faune et flore",icon:"fr-icon-leaf-file"},{id:"boundaries",name:"Limites politiques et administratives",icon:"fr-icon-france-line"},{id:"climatologyMeteorologyAtmosphere",name:"Climatologie, mtorologie, atmosphre",icon:"fr-icon-heavy-showers-fill"},{id:"economy",name:"conomie",icon:"fr-icon-line-chart-fill"},{id:"elevation",name:"Altimtrie",icon:"fr-icon-map-pin-2-fill"},{id:"environment",name:"Environnement",icon:"fr-icon-seedling-fill"},{id:"farming",name:"Agriculture",icon:"fr-icon-plant-fill"},{id:"geoscientificInformation",name:"Sciences de la terre, gosciences",icon:"fr-icon-earth-fill"},{id:"health",name:"Sant",icon:"fr-icon-capsule-fill"},{id:"imageryBaseMapsEarthCover",name:"Carte de rfrence de la couverture terrestre",icon:"fr-icon-france-fill"},{id:"intelligenceMilitary",name:"Infrastructures militaires",icon:"fr-icon-medal-fill"},{id:"inlandWaters",name:"Eaux intrieures, Hydrographie",icon:"fr-icon-flood-fill"},{id:"location",name:"Localisation",icon:"fr-icon-road-map-fill"},{id:"oceans",name:"Ocans",icon:"fr-icon-fr--submersion-fill"},{id:"planningCadastre",name:"Cadastre, amnagement",icon:"fr-icon-community-fill"},{id:"society",name:"Socit",icon:"fr-icon-group-fill"},{id:"structure",name:"Constructions et ouvrages",icon:"fr-icon-compasses-2-fill"},{id:"transportation",name:"Infrastructures de transport",icon:"fr-icon-bus-fill"},{id:"utilitiesCommunication",name:"Tlcommunication, approvisionnement et nergie",icon:"fr-icon-radar-fill"}],service=[{id:"wmts",name:"WMTS",icon:"fr-icon-earth-line"},{id:"wfs",name:"WFS",icon:"fr-icon-earth-fill"},{id:"wms",name:"WMS",icon:"fr-icon-earth-line"},{id:"tms",name:"TMS",icon:"fr-icon-earth-fill"}],producer=[{id:"ign",name:"IGN",icon:"fr-icon-government-fill"}],Topics={thematic,service,producer};function L$1(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var T=L$1();function G(n){T=n}var I$1={exec:()=>null};function h(n,e=""){let i=typeof n=="string"?n:n.source,s={replace:(o,l)=>{let c=typeof l=="string"?l:l.source;return c=c.replace(m.caret,"$1"),i=i.replace(o,c),s},getRegex:()=>new RegExp(i,e)};return s}var m={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:n=>new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}#`),htmlBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}<(?:[a-z].*>|!--)`,"i")},be=/^(?:[ \t]*(?:\n|$))+/,Re=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Te=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,E=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Oe=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,F=/(?:[*+-]|\d{1,9}[.)])/,ie=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,oe=h(ie).replace(/bull/g,F).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),we=h(ie).replace(/bull/g,F).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),j=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,ye=/^[^\n]+/,Q=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Pe=h(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Q).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Se=h(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,F).getRegex(),v="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",U=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,$e=h("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",U).replace("tag",v).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),ae=h(j).replace("hr",E).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v).getRegex(),_e=h(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",ae).getRegex(),K={blockquote:_e,code:Re,def:Pe,fences:Te,heading:Oe,hr:E,html:$e,lheading:oe,list:Se,newline:be,paragraph:ae,table:I$1,text:ye},re=h("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",E).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v).getRegex(),Le={...K,lheading:we,table:re,paragraph:h(j).replace("hr",E).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",re).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v).getRegex()},Me={...K,html:h(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",U).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:I$1,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:h(j).replace("hr",E).replace("heading",` *#{1,6} *[^
]`).replace("lheading",oe).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},ze=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Ae=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,le=/^( {2,}|\\)\n(?!\s*$)/,Ie=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,D=/[\p{P}\p{S}]/u,W=/[\s\p{P}\p{S}]/u,ue=/[^\s\p{P}\p{S}]/u,Ee=h(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,W).getRegex(),pe=/(?!~)[\p{P}\p{S}]/u,Ce=/(?!~)[\s\p{P}\p{S}]/u,Be=/(?:[^\s\p{P}\p{S}]|~)/u,qe=h(/link|code|html/,"g").replace("link",new RegExp("\\[(?:[^\\[\\]`]|(?<!`)(?<a>`+)[^`]+\\k<a>(?!`))*?\\]\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)]|\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)])*\\))*\\)")).replace("code",new RegExp("(?<!`)(?<b>`+)[^`]+\\k<b>(?!`)")).replace("html",/<(?! )[^<>]*?>/).getRegex(),ce=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,ve=h(ce,"u").replace(/punct/g,D).getRegex(),De=h(ce,"u").replace(/punct/g,pe).getRegex(),he="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",He=h(he,"gu").replace(/notPunctSpace/g,ue).replace(/punctSpace/g,W).replace(/punct/g,D).getRegex(),Ze=h(he,"gu").replace(/notPunctSpace/g,Be).replace(/punctSpace/g,Ce).replace(/punct/g,pe).getRegex(),Ge=h("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,ue).replace(/punctSpace/g,W).replace(/punct/g,D).getRegex(),Ne=h(/\\(punct)/,"gu").replace(/punct/g,D).getRegex(),Fe=h(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),je=h(U).replace("(?:-->|$)","-->").getRegex(),Qe=h("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",je).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),q=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Ue=h(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",q).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),de=h(/^!?\[(label)\]\[(ref)\]/).replace("label",q).replace("ref",Q).getRegex(),ke=h(/^!?\[(ref)\](?:\[\])?/).replace("ref",Q).getRegex(),Ke=h("reflink|nolink(?!\\()","g").replace("reflink",de).replace("nolink",ke).getRegex(),se=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,X={_backpedal:I$1,anyPunctuation:Ne,autolink:Fe,blockSkip:qe,br:le,code:Ae,del:I$1,emStrongLDelim:ve,emStrongRDelimAst:He,emStrongRDelimUnd:Ge,escape:ze,link:Ue,nolink:ke,punctuation:Ee,reflink:de,reflinkSearch:Ke,tag:Qe,text:Ie,url:I$1},We={...X,link:h(/^!?\[(label)\]\((.*?)\)/).replace("label",q).getRegex(),reflink:h(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",q).getRegex()},N$1={...X,emStrongRDelimAst:Ze,emStrongLDelim:De,url:h(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",se).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:h(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",se).getRegex()},Xe={...N$1,br:h(le).replace("{2,}","*").getRegex(),text:h(N$1.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},C$1={normal:K,gfm:Le,pedantic:Me},M$1={normal:X,gfm:N$1,breaks:Xe,pedantic:We},Je={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ge=n=>Je[n];function w$1(n,e){if(e){if(m.escapeTest.test(n))return n.replace(m.escapeReplace,ge)}else if(m.escapeTestNoEncode.test(n))return n.replace(m.escapeReplaceNoEncode,ge);return n}function J(n){try{n=encodeURI(n).replace(m.percentDecode,"%")}catch{return null}return n}function V(n,e){var l;let i=n.replace(m.findPipe,(c,u,f)=>{let g=!1,H=u;for(;--H>=0&&f[H]==="\\";)g=!g;return g?"|":" |"}),s=i.split(m.splitPipe),o=0;if(s[0].trim()||s.shift(),s.length>0&&!((l=s.at(-1))!=null&&l.trim())&&s.pop(),e)if(s.length>e)s.splice(e);else for(;s.length<e;)s.push("");for(;o<s.length;o++)s[o]=s[o].trim().replace(m.slashPipe,"|");return s}function z$1(n,e,i){let s=n.length;if(s===0)return"";let o=0;for(;o<s&&n.charAt(s-o-1)===e;)o++;return n.slice(0,s-o)}function fe(n,e){if(n.indexOf(e[1])===-1)return-1;let i=0;for(let s=0;s<n.length;s++)if(n[s]==="\\")s++;else if(n[s]===e[0])i++;else if(n[s]===e[1]&&(i--,i<0))return s;return i>0?-2:-1}function me(n,e,i,s,o){let l=e.href,c=e.title||null,u=n[1].replace(o.other.outputLinkReplace,"$1");s.state.inLink=!0;let f={type:n[0].charAt(0)==="!"?"image":"link",raw:i,href:l,title:c,text:u,tokens:s.inlineTokens(u)};return s.state.inLink=!1,f}function Ve(n,e,i){let s=n.match(i.other.indentCodeCompensation);if(s===null)return e;let o=s[1];return e.split(`
`).map(l=>{let c=l.match(i.other.beginningSpace);if(c===null)return l;let[u]=c;return u.length>=o.length?l.slice(o.length):l}).join(`
`)}var y$1=class{constructor(e){ii(this,"options");ii(this,"rules");ii(this,"lexer");this.options=e||T}space(e){let i=this.rules.block.newline.exec(e);if(i&&i[0].length>0)return{type:"space",raw:i[0]}}code(e){let i=this.rules.block.code.exec(e);if(i){let s=i[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:i[0],codeBlockStyle:"indented",text:this.options.pedantic?s:z$1(s,`
`)}}}fences(e){let i=this.rules.block.fences.exec(e);if(i){let s=i[0],o=Ve(s,i[3]||"",this.rules);return{type:"code",raw:s,lang:i[2]?i[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):i[2],text:o}}}heading(e){let i=this.rules.block.heading.exec(e);if(i){let s=i[2].trim();if(this.rules.other.endingHash.test(s)){let o=z$1(s,"#");(this.options.pedantic||!o||this.rules.other.endingSpaceChar.test(o))&&(s=o.trim())}return{type:"heading",raw:i[0],depth:i[1].length,text:s,tokens:this.lexer.inline(s)}}}hr(e){let i=this.rules.block.hr.exec(e);if(i)return{type:"hr",raw:z$1(i[0],`
`)}}blockquote(e){let i=this.rules.block.blockquote.exec(e);if(i){let s=z$1(i[0],`
`).split(`
`),o="",l="",c=[];for(;s.length>0;){let u=!1,f=[],g;for(g=0;g<s.length;g++)if(this.rules.other.blockquoteStart.test(s[g]))f.push(s[g]),u=!0;else if(!u)f.push(s[g]);else break;s=s.slice(g);let H=f.join(`
`),Y=H.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");o=o?`${o}
${H}`:H,l=l?`${l}
${Y}`:Y;let ee=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(Y,c,!0),this.lexer.state.top=ee,s.length===0)break;let te=c.at(-1);if((te==null?void 0:te.type)==="code")break;if((te==null?void 0:te.type)==="blockquote"){let ne=te,Ye=ne.raw+`
`+s.join(`
`),xe=this.blockquote(Ye);c[c.length-1]=xe,o=o.substring(0,o.length-ne.raw.length)+xe.raw,l=l.substring(0,l.length-ne.text.length)+xe.text;break}else if((te==null?void 0:te.type)==="list"){let ne=te,Ye=ne.raw+`
`+s.join(`
`),xe=this.list(Ye);c[c.length-1]=xe,o=o.substring(0,o.length-te.raw.length)+xe.raw,l=l.substring(0,l.length-ne.raw.length)+xe.raw,s=Ye.substring(c.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:o,tokens:c,text:l}}}list(e){let i=this.rules.block.list.exec(e);if(i){let s=i[1].trim(),o=s.length>1,l={type:"list",raw:"",ordered:o,start:o?+s.slice(0,-1):"",loose:!1,items:[]};s=o?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=o?s:"[*+-]");let c=this.rules.other.listItemRegex(s),u=!1;for(;e;){let g=!1,H="",Y="";if(!(i=c.exec(e))||this.rules.block.hr.test(e))break;H=i[0],e=e.substring(H.length);let ee=i[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,et=>" ".repeat(3*et.length)),te=e.split(`
`,1)[0],ne=!ee.trim(),Ye=0;if(this.options.pedantic?(Ye=2,Y=ee.trimStart()):ne?Ye=i[1].length+1:(Ye=i[2].search(this.rules.other.nonSpaceChar),Ye=Ye>4?1:Ye,Y=ee.slice(Ye),Ye+=i[1].length),ne&&this.rules.other.blankLine.test(te)&&(H+=te+`
`,e=e.substring(te.length+1),g=!0),!g){let et=this.rules.other.nextBulletRegex(Ye),it=this.rules.other.hrRegex(Ye),rt=this.rules.other.fencesBeginRegex(Ye),nt=this.rules.other.headingBeginRegex(Ye),at=this.rules.other.htmlBeginRegex(Ye);for(;e;){let st=e.split(`
`,1)[0],ot;if(te=st,this.options.pedantic?(te=te.replace(this.rules.other.listReplaceNesting,"  "),ot=te):ot=te.replace(this.rules.other.tabCharGlobal,"    "),rt.test(te)||nt.test(te)||at.test(te)||et.test(te)||it.test(te))break;if(ot.search(this.rules.other.nonSpaceChar)>=Ye||!te.trim())Y+=`
`+ot.slice(Ye);else{if(ne||ee.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||rt.test(ee)||nt.test(ee)||it.test(ee))break;Y+=`
`+te}!ne&&!te.trim()&&(ne=!0),H+=st+`
`,e=e.substring(st.length+1),ee=ot.slice(Ye)}}l.loose||(u?l.loose=!0:this.rules.other.doubleBlankLine.test(H)&&(u=!0));let xe=null,tt;this.options.gfm&&(xe=this.rules.other.listIsTask.exec(Y),xe&&(tt=xe[0]!=="[ ] ",Y=Y.replace(this.rules.other.listReplaceTask,""))),l.items.push({type:"list_item",raw:H,task:!!xe,checked:tt,loose:!1,text:Y,tokens:[]}),l.raw+=H}let f=l.items.at(-1);if(f)f.raw=f.raw.trimEnd(),f.text=f.text.trimEnd();else return;l.raw=l.raw.trimEnd();for(let g=0;g<l.items.length;g++)if(this.lexer.state.top=!1,l.items[g].tokens=this.lexer.blockTokens(l.items[g].text,[]),!l.loose){let H=l.items[g].tokens.filter(ee=>ee.type==="space"),Y=H.length>0&&H.some(ee=>this.rules.other.anyLine.test(ee.raw));l.loose=Y}if(l.loose)for(let g=0;g<l.items.length;g++)l.items[g].loose=!0;return l}}html(e){let i=this.rules.block.html.exec(e);if(i)return{type:"html",block:!0,raw:i[0],pre:i[1]==="pre"||i[1]==="script"||i[1]==="style",text:i[0]}}def(e){let i=this.rules.block.def.exec(e);if(i){let s=i[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),o=i[2]?i[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",l=i[3]?i[3].substring(1,i[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):i[3];return{type:"def",tag:s,raw:i[0],href:o,title:l}}}table(e){var u;let i=this.rules.block.table.exec(e);if(!i||!this.rules.other.tableDelimiter.test(i[2]))return;let s=V(i[1]),o=i[2].replace(this.rules.other.tableAlignChars,"").split("|"),l=(u=i[3])!=null&&u.trim()?i[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],c={type:"table",raw:i[0],header:[],align:[],rows:[]};if(s.length===o.length){for(let f of o)this.rules.other.tableAlignRight.test(f)?c.align.push("right"):this.rules.other.tableAlignCenter.test(f)?c.align.push("center"):this.rules.other.tableAlignLeft.test(f)?c.align.push("left"):c.align.push(null);for(let f=0;f<s.length;f++)c.header.push({text:s[f],tokens:this.lexer.inline(s[f]),header:!0,align:c.align[f]});for(let f of l)c.rows.push(V(f,c.header.length).map((g,H)=>({text:g,tokens:this.lexer.inline(g),header:!1,align:c.align[H]})));return c}}lheading(e){let i=this.rules.block.lheading.exec(e);if(i)return{type:"heading",raw:i[0],depth:i[2].charAt(0)==="="?1:2,text:i[1],tokens:this.lexer.inline(i[1])}}paragraph(e){let i=this.rules.block.paragraph.exec(e);if(i){let s=i[1].charAt(i[1].length-1)===`
`?i[1].slice(0,-1):i[1];return{type:"paragraph",raw:i[0],text:s,tokens:this.lexer.inline(s)}}}text(e){let i=this.rules.block.text.exec(e);if(i)return{type:"text",raw:i[0],text:i[0],tokens:this.lexer.inline(i[0])}}escape(e){let i=this.rules.inline.escape.exec(e);if(i)return{type:"escape",raw:i[0],text:i[1]}}tag(e){let i=this.rules.inline.tag.exec(e);if(i)return!this.lexer.state.inLink&&this.rules.other.startATag.test(i[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(i[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(i[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(i[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:i[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:i[0]}}link(e){let i=this.rules.inline.link.exec(e);if(i){let s=i[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(s)){if(!this.rules.other.endAngleBracket.test(s))return;let c=z$1(s.slice(0,-1),"\\");if((s.length-c.length)%2===0)return}else{let c=fe(i[2],"()");if(c===-2)return;if(c>-1){let u=(i[0].indexOf("!")===0?5:4)+i[1].length+c;i[2]=i[2].substring(0,c),i[0]=i[0].substring(0,u).trim(),i[3]=""}}let o=i[2],l="";if(this.options.pedantic){let c=this.rules.other.pedanticHrefTitle.exec(o);c&&(o=c[1],l=c[3])}else l=i[3]?i[3].slice(1,-1):"";return o=o.trim(),this.rules.other.startAngleBracket.test(o)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(s)?o=o.slice(1):o=o.slice(1,-1)),me(i,{href:o&&o.replace(this.rules.inline.anyPunctuation,"$1"),title:l&&l.replace(this.rules.inline.anyPunctuation,"$1")},i[0],this.lexer,this.rules)}}reflink(e,i){let s;if((s=this.rules.inline.reflink.exec(e))||(s=this.rules.inline.nolink.exec(e))){let o=(s[2]||s[1]).replace(this.rules.other.multipleSpaceGlobal," "),l=i[o.toLowerCase()];if(!l){let c=s[0].charAt(0);return{type:"text",raw:c,text:c}}return me(s,l,s[0],this.lexer,this.rules)}}emStrong(e,i,s=""){let o=this.rules.inline.emStrongLDelim.exec(e);if(!(!o||o[3]&&s.match(this.rules.other.unicodeAlphaNumeric))&&(!(o[1]||o[2])||!s||this.rules.inline.punctuation.exec(s))){let l=[...o[0]].length-1,c,u,f=l,g=0,H=o[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(H.lastIndex=0,i=i.slice(-1*e.length+l);(o=H.exec(i))!=null;){if(c=o[1]||o[2]||o[3]||o[4]||o[5]||o[6],!c)continue;if(u=[...c].length,o[3]||o[4]){f+=u;continue}else if((o[5]||o[6])&&l%3&&!((l+u)%3)){g+=u;continue}if(f-=u,f>0)continue;u=Math.min(u,u+f+g);let Y=[...o[0]][0].length,ee=e.slice(0,l+o.index+Y+u);if(Math.min(l,u)%2){let ne=ee.slice(1,-1);return{type:"em",raw:ee,text:ne,tokens:this.lexer.inlineTokens(ne)}}let te=ee.slice(2,-2);return{type:"strong",raw:ee,text:te,tokens:this.lexer.inlineTokens(te)}}}}codespan(e){let i=this.rules.inline.code.exec(e);if(i){let s=i[2].replace(this.rules.other.newLineCharGlobal," "),o=this.rules.other.nonSpaceChar.test(s),l=this.rules.other.startingSpaceChar.test(s)&&this.rules.other.endingSpaceChar.test(s);return o&&l&&(s=s.substring(1,s.length-1)),{type:"codespan",raw:i[0],text:s}}}br(e){let i=this.rules.inline.br.exec(e);if(i)return{type:"br",raw:i[0]}}del(e){let i=this.rules.inline.del.exec(e);if(i)return{type:"del",raw:i[0],text:i[2],tokens:this.lexer.inlineTokens(i[2])}}autolink(e){let i=this.rules.inline.autolink.exec(e);if(i){let s,o;return i[2]==="@"?(s=i[1],o="mailto:"+s):(s=i[1],o=s),{type:"link",raw:i[0],text:s,href:o,tokens:[{type:"text",raw:s,text:s}]}}}url(e){var s;let i;if(i=this.rules.inline.url.exec(e)){let o,l;if(i[2]==="@")o=i[0],l="mailto:"+o;else{let c;do c=i[0],i[0]=((s=this.rules.inline._backpedal.exec(i[0]))==null?void 0:s[0])??"";while(c!==i[0]);o=i[0],i[1]==="www."?l="http://"+i[0]:l=i[0]}return{type:"link",raw:i[0],text:o,href:l,tokens:[{type:"text",raw:o,text:o}]}}}inlineText(e){let i=this.rules.inline.text.exec(e);if(i){let s=this.lexer.state.inRawBlock;return{type:"text",raw:i[0],text:i[0],escaped:s}}}},x$1=class $i{constructor(e){ii(this,"tokens");ii(this,"options");ii(this,"state");ii(this,"tokenizer");ii(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||T,this.options.tokenizer=this.options.tokenizer||new y$1,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let i={other:m,block:C$1.normal,inline:M$1.normal};this.options.pedantic?(i.block=C$1.pedantic,i.inline=M$1.pedantic):this.options.gfm&&(i.block=C$1.gfm,this.options.breaks?i.inline=M$1.breaks:i.inline=M$1.gfm),this.tokenizer.rules=i}static get rules(){return{block:C$1,inline:M$1}}static lex(e,i){return new $i(i).lex(e)}static lexInline(e,i){return new $i(i).inlineTokens(e)}lex(e){e=e.replace(m.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let i=0;i<this.inlineQueue.length;i++){let s=this.inlineQueue[i];this.inlineTokens(s.src,s.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,i=[],s=!1){var o,l,c;for(this.options.pedantic&&(e=e.replace(m.tabCharGlobal,"    ").replace(m.spaceLine,""));e;){let u;if((l=(o=this.options.extensions)==null?void 0:o.block)!=null&&l.some(g=>(u=g.call({lexer:this},e,i))?(e=e.substring(u.raw.length),i.push(u),!0):!1))continue;if(u=this.tokenizer.space(e)){e=e.substring(u.raw.length);let g=i.at(-1);u.raw.length===1&&g!==void 0?g.raw+=`
`:i.push(u);continue}if(u=this.tokenizer.code(e)){e=e.substring(u.raw.length);let g=i.at(-1);(g==null?void 0:g.type)==="paragraph"||(g==null?void 0:g.type)==="text"?(g.raw+=(g.raw.endsWith(`
`)?"":`
`)+u.raw,g.text+=`
`+u.text,this.inlineQueue.at(-1).src=g.text):i.push(u);continue}if(u=this.tokenizer.fences(e)){e=e.substring(u.raw.length),i.push(u);continue}if(u=this.tokenizer.heading(e)){e=e.substring(u.raw.length),i.push(u);continue}if(u=this.tokenizer.hr(e)){e=e.substring(u.raw.length),i.push(u);continue}if(u=this.tokenizer.blockquote(e)){e=e.substring(u.raw.length),i.push(u);continue}if(u=this.tokenizer.list(e)){e=e.substring(u.raw.length),i.push(u);continue}if(u=this.tokenizer.html(e)){e=e.substring(u.raw.length),i.push(u);continue}if(u=this.tokenizer.def(e)){e=e.substring(u.raw.length);let g=i.at(-1);(g==null?void 0:g.type)==="paragraph"||(g==null?void 0:g.type)==="text"?(g.raw+=(g.raw.endsWith(`
`)?"":`
`)+u.raw,g.text+=`
`+u.raw,this.inlineQueue.at(-1).src=g.text):this.tokens.links[u.tag]||(this.tokens.links[u.tag]={href:u.href,title:u.title},i.push(u));continue}if(u=this.tokenizer.table(e)){e=e.substring(u.raw.length),i.push(u);continue}if(u=this.tokenizer.lheading(e)){e=e.substring(u.raw.length),i.push(u);continue}let f=e;if((c=this.options.extensions)!=null&&c.startBlock){let g=1/0,H=e.slice(1),Y;this.options.extensions.startBlock.forEach(ee=>{Y=ee.call({lexer:this},H),typeof Y=="number"&&Y>=0&&(g=Math.min(g,Y))}),g<1/0&&g>=0&&(f=e.substring(0,g+1))}if(this.state.top&&(u=this.tokenizer.paragraph(f))){let g=i.at(-1);s&&(g==null?void 0:g.type)==="paragraph"?(g.raw+=(g.raw.endsWith(`
`)?"":`
`)+u.raw,g.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=g.text):i.push(u),s=f.length!==e.length,e=e.substring(u.raw.length);continue}if(u=this.tokenizer.text(e)){e=e.substring(u.raw.length);let g=i.at(-1);(g==null?void 0:g.type)==="text"?(g.raw+=(g.raw.endsWith(`
`)?"":`
`)+u.raw,g.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=g.text):i.push(u);continue}if(e){let g="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(g);break}else throw new Error(g)}}return this.state.top=!0,i}inline(e,i=[]){return this.inlineQueue.push({src:e,tokens:i}),i}inlineTokens(e,i=[]){var u,f,g,H,Y;let s=e,o=null;if(this.tokens.links){let ee=Object.keys(this.tokens.links);if(ee.length>0)for(;(o=this.tokenizer.rules.inline.reflinkSearch.exec(s))!=null;)ee.includes(o[0].slice(o[0].lastIndexOf("[")+1,-1))&&(s=s.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(o=this.tokenizer.rules.inline.anyPunctuation.exec(s))!=null;)s=s.slice(0,o.index)+"++"+s.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(o=this.tokenizer.rules.inline.blockSkip.exec(s))!=null;)s=s.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);s=((f=(u=this.options.hooks)==null?void 0:u.emStrongMask)==null?void 0:f.call({lexer:this},s))??s;let l=!1,c="";for(;e;){l||(c=""),l=!1;let ee;if((H=(g=this.options.extensions)==null?void 0:g.inline)!=null&&H.some(ne=>(ee=ne.call({lexer:this},e,i))?(e=e.substring(ee.raw.length),i.push(ee),!0):!1))continue;if(ee=this.tokenizer.escape(e)){e=e.substring(ee.raw.length),i.push(ee);continue}if(ee=this.tokenizer.tag(e)){e=e.substring(ee.raw.length),i.push(ee);continue}if(ee=this.tokenizer.link(e)){e=e.substring(ee.raw.length),i.push(ee);continue}if(ee=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(ee.raw.length);let ne=i.at(-1);ee.type==="text"&&(ne==null?void 0:ne.type)==="text"?(ne.raw+=ee.raw,ne.text+=ee.text):i.push(ee);continue}if(ee=this.tokenizer.emStrong(e,s,c)){e=e.substring(ee.raw.length),i.push(ee);continue}if(ee=this.tokenizer.codespan(e)){e=e.substring(ee.raw.length),i.push(ee);continue}if(ee=this.tokenizer.br(e)){e=e.substring(ee.raw.length),i.push(ee);continue}if(ee=this.tokenizer.del(e)){e=e.substring(ee.raw.length),i.push(ee);continue}if(ee=this.tokenizer.autolink(e)){e=e.substring(ee.raw.length),i.push(ee);continue}if(!this.state.inLink&&(ee=this.tokenizer.url(e))){e=e.substring(ee.raw.length),i.push(ee);continue}let te=e;if((Y=this.options.extensions)!=null&&Y.startInline){let ne=1/0,Ye=e.slice(1),xe;this.options.extensions.startInline.forEach(tt=>{xe=tt.call({lexer:this},Ye),typeof xe=="number"&&xe>=0&&(ne=Math.min(ne,xe))}),ne<1/0&&ne>=0&&(te=e.substring(0,ne+1))}if(ee=this.tokenizer.inlineText(te)){e=e.substring(ee.raw.length),ee.raw.slice(-1)!=="_"&&(c=ee.raw.slice(-1)),l=!0;let ne=i.at(-1);(ne==null?void 0:ne.type)==="text"?(ne.raw+=ee.raw,ne.text+=ee.text):i.push(ee);continue}if(e){let ne="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(ne);break}else throw new Error(ne)}}return i}},P$1=class{constructor(e){ii(this,"options");ii(this,"parser");this.options=e||T}space(e){return""}code({text:e,lang:i,escaped:s}){var c;let o=(c=(i||"").match(m.notSpaceStart))==null?void 0:c[0],l=e.replace(m.endingNewline,"")+`
`;return o?'<pre><code class="language-'+w$1(o)+'">'+(s?l:w$1(l,!0))+`</code></pre>
`:"<pre><code>"+(s?l:w$1(l,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}def(e){return""}heading({tokens:e,depth:i}){return`<h${i}>${this.parser.parseInline(e)}</h${i}>
`}hr(e){return`<hr>
`}list(e){let i=e.ordered,s=e.start,o="";for(let u=0;u<e.items.length;u++){let f=e.items[u];o+=this.listitem(f)}let l=i?"ol":"ul",c=i&&s!==1?' start="'+s+'"':"";return"<"+l+c+`>
`+o+"</"+l+`>
`}listitem(e){var s;let i="";if(e.task){let o=this.checkbox({checked:!!e.checked});e.loose?((s=e.tokens[0])==null?void 0:s.type)==="paragraph"?(e.tokens[0].text=o+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=o+" "+w$1(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:o+" ",text:o+" ",escaped:!0}):i+=o+" "}return i+=this.parser.parse(e.tokens,!!e.loose),`<li>${i}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let i="",s="";for(let l=0;l<e.header.length;l++)s+=this.tablecell(e.header[l]);i+=this.tablerow({text:s});let o="";for(let l=0;l<e.rows.length;l++){let c=e.rows[l];s="";for(let u=0;u<c.length;u++)s+=this.tablecell(c[u]);o+=this.tablerow({text:s})}return o&&(o=`<tbody>${o}</tbody>`),`<table>
<thead>
`+i+`</thead>
`+o+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let i=this.parser.parseInline(e.tokens),s=e.header?"th":"td";return(e.align?`<${s} align="${e.align}">`:`<${s}>`)+i+`</${s}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${w$1(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:i,tokens:s}){let o=this.parser.parseInline(s),l=J(e);if(l===null)return o;e=l;let c='<a href="'+e+'"';return i&&(c+=' title="'+w$1(i)+'"'),c+=">"+o+"</a>",c}image({href:e,title:i,text:s,tokens:o}){o&&(s=this.parser.parseInline(o,this.parser.textRenderer));let l=J(e);if(l===null)return w$1(s);e=l;let c=`<img src="${e}" alt="${s}"`;return i&&(c+=` title="${w$1(i)}"`),c+=">",c}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:w$1(e.text)}},$=class{strong({text:n}){return n}em({text:n}){return n}codespan({text:n}){return n}del({text:n}){return n}html({text:n}){return n}text({text:n}){return n}link({text:n}){return""+n}image({text:n}){return""+n}br(){return""}},b$1=class Hi{constructor(e){ii(this,"options");ii(this,"renderer");ii(this,"textRenderer");this.options=e||T,this.options.renderer=this.options.renderer||new P$1,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new $}static parse(e,i){return new Hi(i).parse(e)}static parseInline(e,i){return new Hi(i).parseInline(e)}parse(e,i=!0){var o,l;let s="";for(let c=0;c<e.length;c++){let u=e[c];if((l=(o=this.options.extensions)==null?void 0:o.renderers)!=null&&l[u.type]){let g=u,H=this.options.extensions.renderers[g.type].call({parser:this},g);if(H!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(g.type)){s+=H||"";continue}}let f=u;switch(f.type){case"space":{s+=this.renderer.space(f);continue}case"hr":{s+=this.renderer.hr(f);continue}case"heading":{s+=this.renderer.heading(f);continue}case"code":{s+=this.renderer.code(f);continue}case"table":{s+=this.renderer.table(f);continue}case"blockquote":{s+=this.renderer.blockquote(f);continue}case"list":{s+=this.renderer.list(f);continue}case"html":{s+=this.renderer.html(f);continue}case"def":{s+=this.renderer.def(f);continue}case"paragraph":{s+=this.renderer.paragraph(f);continue}case"text":{let g=f,H=this.renderer.text(g);for(;c+1<e.length&&e[c+1].type==="text";)g=e[++c],H+=`
`+this.renderer.text(g);i?s+=this.renderer.paragraph({type:"paragraph",raw:H,text:H,tokens:[{type:"text",raw:H,text:H,escaped:!0}]}):s+=H;continue}default:{let g='Token with "'+f.type+'" type was not found.';if(this.options.silent)return console.error(g),"";throw new Error(g)}}}return s}parseInline(e,i=this.renderer){var o,l;let s="";for(let c=0;c<e.length;c++){let u=e[c];if((l=(o=this.options.extensions)==null?void 0:o.renderers)!=null&&l[u.type]){let g=this.options.extensions.renderers[u.type].call({parser:this},u);if(g!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(u.type)){s+=g||"";continue}}let f=u;switch(f.type){case"escape":{s+=i.text(f);break}case"html":{s+=i.html(f);break}case"link":{s+=i.link(f);break}case"image":{s+=i.image(f);break}case"strong":{s+=i.strong(f);break}case"em":{s+=i.em(f);break}case"codespan":{s+=i.codespan(f);break}case"br":{s+=i.br(f);break}case"del":{s+=i.del(f);break}case"text":{s+=i.text(f);break}default:{let g='Token with "'+f.type+'" type was not found.';if(this.options.silent)return console.error(g),"";throw new Error(g)}}}return s}},Fi,S$1=(Fi=class{constructor(e){ii(this,"options");ii(this,"block");this.options=e||T}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}emStrongMask(e){return e}provideLexer(){return this.block?x$1.lex:x$1.lexInline}provideParser(){return this.block?b$1.parse:b$1.parseInline}},ii(Fi,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),ii(Fi,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),Fi),B=class{constructor(...n){ii(this,"defaults",L$1());ii(this,"options",this.setOptions);ii(this,"parse",this.parseMarkdown(!0));ii(this,"parseInline",this.parseMarkdown(!1));ii(this,"Parser",b$1);ii(this,"Renderer",P$1);ii(this,"TextRenderer",$);ii(this,"Lexer",x$1);ii(this,"Tokenizer",y$1);ii(this,"Hooks",S$1);this.use(...n)}walkTokens(n,e){var s,o;let i=[];for(let l of n)switch(i=i.concat(e.call(this,l)),l.type){case"table":{let c=l;for(let u of c.header)i=i.concat(this.walkTokens(u.tokens,e));for(let u of c.rows)for(let f of u)i=i.concat(this.walkTokens(f.tokens,e));break}case"list":{let c=l;i=i.concat(this.walkTokens(c.items,e));break}default:{let c=l;(o=(s=this.defaults.extensions)==null?void 0:s.childTokens)!=null&&o[c.type]?this.defaults.extensions.childTokens[c.type].forEach(u=>{let f=c[u].flat(1/0);i=i.concat(this.walkTokens(f,e))}):c.tokens&&(i=i.concat(this.walkTokens(c.tokens,e)))}}return i}use(...n){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return n.forEach(i=>{let s={...i};if(s.async=this.defaults.async||s.async||!1,i.extensions&&(i.extensions.forEach(o=>{if(!o.name)throw new Error("extension name required");if("renderer"in o){let l=e.renderers[o.name];l?e.renderers[o.name]=function(...c){let u=o.renderer.apply(this,c);return u===!1&&(u=l.apply(this,c)),u}:e.renderers[o.name]=o.renderer}if("tokenizer"in o){if(!o.level||o.level!=="block"&&o.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let l=e[o.level];l?l.unshift(o.tokenizer):e[o.level]=[o.tokenizer],o.start&&(o.level==="block"?e.startBlock?e.startBlock.push(o.start):e.startBlock=[o.start]:o.level==="inline"&&(e.startInline?e.startInline.push(o.start):e.startInline=[o.start]))}"childTokens"in o&&o.childTokens&&(e.childTokens[o.name]=o.childTokens)}),s.extensions=e),i.renderer){let o=this.defaults.renderer||new P$1(this.defaults);for(let l in i.renderer){if(!(l in o))throw new Error(`renderer '${l}' does not exist`);if(["options","parser"].includes(l))continue;let c=l,u=i.renderer[c],f=o[c];o[c]=(...g)=>{let H=u.apply(o,g);return H===!1&&(H=f.apply(o,g)),H||""}}s.renderer=o}if(i.tokenizer){let o=this.defaults.tokenizer||new y$1(this.defaults);for(let l in i.tokenizer){if(!(l in o))throw new Error(`tokenizer '${l}' does not exist`);if(["options","rules","lexer"].includes(l))continue;let c=l,u=i.tokenizer[c],f=o[c];o[c]=(...g)=>{let H=u.apply(o,g);return H===!1&&(H=f.apply(o,g)),H}}s.tokenizer=o}if(i.hooks){let o=this.defaults.hooks||new S$1;for(let l in i.hooks){if(!(l in o))throw new Error(`hook '${l}' does not exist`);if(["options","block"].includes(l))continue;let c=l,u=i.hooks[c],f=o[c];S$1.passThroughHooks.has(l)?o[c]=g=>{if(this.defaults.async&&S$1.passThroughHooksRespectAsync.has(l))return(async()=>{let Y=await u.call(o,g);return f.call(o,Y)})();let H=u.call(o,g);return f.call(o,H)}:o[c]=(...g)=>{if(this.defaults.async)return(async()=>{let Y=await u.apply(o,g);return Y===!1&&(Y=await f.apply(o,g)),Y})();let H=u.apply(o,g);return H===!1&&(H=f.apply(o,g)),H}}s.hooks=o}if(i.walkTokens){let o=this.defaults.walkTokens,l=i.walkTokens;s.walkTokens=function(c){let u=[];return u.push(l.call(this,c)),o&&(u=u.concat(o.call(this,c))),u}}this.defaults={...this.defaults,...s}}),this}setOptions(n){return this.defaults={...this.defaults,...n},this}lexer(n,e){return x$1.lex(n,e??this.defaults)}parser(n,e){return b$1.parse(n,e??this.defaults)}parseMarkdown(n){return(e,i)=>{let s={...i},o={...this.defaults,...s},l=this.onError(!!o.silent,!!o.async);if(this.defaults.async===!0&&s.async===!1)return l(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return l(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return l(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(o.hooks&&(o.hooks.options=o,o.hooks.block=n),o.async)return(async()=>{let c=o.hooks?await o.hooks.preprocess(e):e,u=await(o.hooks?await o.hooks.provideLexer():n?x$1.lex:x$1.lexInline)(c,o),f=o.hooks?await o.hooks.processAllTokens(u):u;o.walkTokens&&await Promise.all(this.walkTokens(f,o.walkTokens));let g=await(o.hooks?await o.hooks.provideParser():n?b$1.parse:b$1.parseInline)(f,o);return o.hooks?await o.hooks.postprocess(g):g})().catch(l);try{o.hooks&&(e=o.hooks.preprocess(e));let c=(o.hooks?o.hooks.provideLexer():n?x$1.lex:x$1.lexInline)(e,o);o.hooks&&(c=o.hooks.processAllTokens(c)),o.walkTokens&&this.walkTokens(c,o.walkTokens);let u=(o.hooks?o.hooks.provideParser():n?b$1.parse:b$1.parseInline)(c,o);return o.hooks&&(u=o.hooks.postprocess(u)),u}catch(c){return l(c)}}}onError(n,e){return i=>{if(i.message+=`
Please report this to https://github.com/markedjs/marked.`,n){let s="<p>An error occurred:</p><pre>"+w$1(i.message+"",!0)+"</pre>";return e?Promise.resolve(s):s}if(e)return Promise.reject(i);throw i}}},_$1=new B;function k$1(n,e){return _$1.parse(n,e)}k$1.options=k$1.setOptions=function(n){return _$1.setOptions(n),k$1.defaults=_$1.defaults,G(k$1.defaults),k$1};k$1.getDefaults=L$1;k$1.defaults=T;k$1.use=function(...n){return _$1.use(...n),k$1.defaults=_$1.defaults,G(k$1.defaults),k$1};k$1.walkTokens=function(n,e){return _$1.walkTokens(n,e)};k$1.parseInline=_$1.parseInline;k$1.Parser=b$1;k$1.parser=b$1.parse;k$1.Renderer=P$1;k$1.TextRenderer=$;k$1.Lexer=x$1;k$1.lexer=x$1.lex;k$1.Tokenizer=y$1;k$1.Hooks=S$1;k$1.parse=k$1;k$1.options;k$1.setOptions;k$1.use;k$1.walkTokens;k$1.parseInline;b$1.parse;x$1.lex;var clusterize={exports:{}},hasRequiredClusterize;function requireClusterize(){return hasRequiredClusterize||(hasRequiredClusterize=1,(function(n){(function(e,i){n.exports=i()})("Clusterize",function(){var e=(function(){for(var f=3,g=document.createElement("b"),H=g.all||[];g.innerHTML="<!--[if gt IE "+ ++f+"]><i><![endif]-->",H[0];);return f>4?f:document.documentMode})(),i=navigator.platform.toLowerCase().indexOf("mac")+1,s=function(f){if(!(this instanceof s))return new s(f);var g=this,H={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};g.options={};for(var Y=["rows_in_block","blocks_in_cluster","show_no_data_row","no_data_class","no_data_text","keep_parity","tag","callbacks"],ee=0,te;te=Y[ee];ee++)g.options[te]=typeof f[te]<"u"&&f[te]!=null?f[te]:H[te];for(var ne=["scroll","content"],ee=0,Ye;Ye=ne[ee];ee++)if(g[Ye+"_elem"]=f[Ye+"Id"]?document.getElementById(f[Ye+"Id"]):f[Ye+"Elem"],!g[Ye+"_elem"])throw new Error("Error! Could not find "+Ye+" element");g.content_elem.hasAttribute("tabindex")||g.content_elem.setAttribute("tabindex",0);var xe=c(f.rows)?f.rows:g.fetchMarkup(),tt={},et=g.scroll_elem.scrollTop;g.insertToDOM(xe,tt),g.scroll_elem.scrollTop=et;var it=!1,rt=0,nt=!1,at=function(){i&&(nt||(g.content_elem.style.pointerEvents="none"),nt=!0,clearTimeout(rt),rt=setTimeout(function(){g.content_elem.style.pointerEvents="auto",nt=!1},50)),it!=(it=g.getClusterNum(xe))&&g.insertToDOM(xe,tt),g.options.callbacks.scrollingProgress&&g.options.callbacks.scrollingProgress(g.getScrollProgress())},st=0,ot=function(){clearTimeout(st),st=setTimeout(g.refresh,100)};o("scroll",g.scroll_elem,at),o("resize",window,ot),g.destroy=function(ht){l("scroll",g.scroll_elem,at),l("resize",window,ot),g.html((ht?g.generateEmptyRow():xe).join(""))},g.refresh=function(ht){(g.getRowsHeight(xe)||ht)&&g.update(xe)},g.update=function(ht){xe=c(ht)?ht:[];var dt=g.scroll_elem.scrollTop;xe.length*g.options.item_height<dt&&(g.scroll_elem.scrollTop=0,it=0),g.insertToDOM(xe,tt),g.scroll_elem.scrollTop=dt},g.clear=function(){g.update([])},g.getRowsAmount=function(){return xe.length},g.getScrollProgress=function(){return this.options.scroll_top/(xe.length*this.options.item_height)*100||0};var ut=function(ht,dt){var pt=c(dt)?dt:[];pt.length&&(xe=ht=="append"?xe.concat(pt):pt.concat(xe),g.insertToDOM(xe,tt))};g.append=function(ht){ut("append",ht)},g.prepend=function(ht){ut("prepend",ht)}};s.prototype={constructor:s,fetchMarkup:function(){for(var f=[],g=this.getChildNodes(this.content_elem);g.length;)f.push(g.shift().outerHTML);return f},exploreEnvironment:function(f,g){var H=this.options;H.content_tag=this.content_elem.tagName.toLowerCase(),f.length&&(e&&e<=9&&!H.tag&&(H.tag=f[0].match(/<([^>\s/]*)/)[1].toLowerCase()),this.content_elem.children.length<=1&&(g.data=this.html(f[0]+f[0]+f[0])),H.tag||(H.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(f))},getRowsHeight:function(f){var g=this.options,H=g.item_height;if(g.cluster_height=0,!!f.length){var Y=this.content_elem.children;if(Y.length){var ee=Y[Math.floor(Y.length/2)];if(g.item_height=ee.offsetHeight,g.tag=="tr"&&u("borderCollapse",this.content_elem)!="collapse"&&(g.item_height+=parseInt(u("borderSpacing",this.content_elem),10)||0),g.tag!="tr"){var te=parseInt(u("marginTop",ee),10)||0,ne=parseInt(u("marginBottom",ee),10)||0;g.item_height+=Math.max(te,ne)}return g.block_height=g.item_height*g.rows_in_block,g.rows_in_cluster=g.blocks_in_cluster*g.rows_in_block,g.cluster_height=g.blocks_in_cluster*g.block_height,H!=g.item_height}}},getClusterNum:function(f){var g=this.options;g.scroll_top=this.scroll_elem.scrollTop;var H=g.cluster_height-g.block_height,Y=Math.floor(g.scroll_top/H),ee=Math.floor(f.length*g.item_height/H);return Math.min(Y,ee)},generateEmptyRow:function(){var f=this.options;if(!f.tag||!f.show_no_data_row)return[];var g=document.createElement(f.tag),H=document.createTextNode(f.no_data_text),Y;return g.className=f.no_data_class,f.tag=="tr"&&(Y=document.createElement("td"),Y.colSpan=100,Y.appendChild(H)),g.appendChild(Y||H),[g.outerHTML]},generate:function(f){var g=this.options,H=f.length;if(H<g.rows_in_block)return{top_offset:0,bottom_offset:0,rows_above:0,rows:H?f:this.generateEmptyRow()};var Y=Math.max((g.rows_in_cluster-g.rows_in_block)*this.getClusterNum(f),0),ee=Y+g.rows_in_cluster,te=Math.max(Y*g.item_height,0),ne=Math.max((H-ee)*g.item_height,0),Ye=[],xe=Y;te<1&&xe++;for(var tt=Y;tt<ee;tt++)f[tt]&&Ye.push(f[tt]);return{top_offset:te,bottom_offset:ne,rows_above:xe,rows:Ye}},renderExtraTag:function(f,g){var H=document.createElement(this.options.tag),Y="clusterize-";return H.className=[Y+"extra-row",Y+f].join(" "),g&&(H.style.height=g+"px"),H.outerHTML},insertToDOM:function(f,g){this.options.cluster_height||this.exploreEnvironment(f,g);var H=this.generate(f),Y=H.rows.join(""),ee=this.checkChanges("data",Y,g),te=this.checkChanges("top",H.top_offset,g),ne=this.checkChanges("bottom",H.bottom_offset,g),Ye=this.options.callbacks,xe=[];ee||te?(H.top_offset&&(this.options.keep_parity&&xe.push(this.renderExtraTag("keep-parity")),xe.push(this.renderExtraTag("top-space",H.top_offset))),xe.push(Y),H.bottom_offset&&xe.push(this.renderExtraTag("bottom-space",H.bottom_offset)),Ye.clusterWillChange&&Ye.clusterWillChange(),this.html(xe.join("")),this.options.content_tag=="ol"&&this.content_elem.setAttribute("start",H.rows_above),this.content_elem.style["counter-increment"]="clusterize-counter "+(H.rows_above-1),Ye.clusterChanged&&Ye.clusterChanged()):ne&&(this.content_elem.lastChild.style.height=H.bottom_offset+"px")},html:function(f){var g=this.content_elem;if(e&&e<=9&&this.options.tag=="tr"){var H=document.createElement("div"),Y;for(H.innerHTML="<table><tbody>"+f+"</tbody></table>";Y=g.lastChild;)g.removeChild(Y);for(var ee=this.getChildNodes(H.firstChild.firstChild);ee.length;)g.appendChild(ee.shift())}else g.innerHTML=f},getChildNodes:function(f){for(var g=f.children,H=[],Y=0,ee=g.length;Y<ee;Y++)H.push(g[Y]);return H},checkChanges:function(f,g,H){var Y=g!=H[f];return H[f]=g,Y}};function o(f,g,H){return g.addEventListener?g.addEventListener(f,H,!1):g.attachEvent("on"+f,H)}function l(f,g,H){return g.removeEventListener?g.removeEventListener(f,H,!1):g.detachEvent("on"+f,H)}function c(f){return Object.prototype.toString.call(f)==="[object Array]"}function u(f,g){return window.getComputedStyle?window.getComputedStyle(g)[f]:g.currentStyle[f]}return s})})(clusterize)),clusterize.exports}var clusterizeExports=requireClusterize();const Clusterize=getDefaultExportFromCjs$1(clusterizeExports);Clusterize.default;var logger$4=LoggerByDefault.getLogger("widget");class Catalog extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof Catalog))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="Catalog",this.initialize(e),this.container=this.initContainer(),this.element?this.element.appendChild(this.container):this.element=this.container,this.showWaiting(),this.initConfigData().then(i=>{logger$4.trace(this,i),this.hideWaiting(),this.configData=i,this.dispatchEvent({type:this.LOADED_CATALOG_EVENT,data:i})}).catch(i=>{this.hideWaiting(),logger$4.error(i)}),this}setMap(e){e?(this.on("catalog:loaded",this.checkLayersOnMap),this.draggable&&Draggable.dragElement(this.panelCatalogContainer,this.panelCatalogHeaderContainer,e.getTargetElement()),this.collapsed||this.buttonCatalogShow.setAttribute("aria-pressed",!0),this.auto&&this.addEventsListeners(e)):(this.un("catalog:loaded",this.checkLayersOnMap),this.auto&&this.removeEventsListeners()),super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getCollapsed(){return this.collapsed}setCollapsed(e){if(e===void 0){logger$4.error("[ERROR] Catalog:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(e?this.buttonCatalogClose.click():this.buttonCatalogShow.click(),this.collapsed=e)}addLayerConfig(e){for(const o in e)if(Object.prototype.hasOwnProperty.call(e,o)){const l=e[o];if(l.serviceParams){var i=l.serviceParams.id.split(":").slice(-1)[0];l.service=i,l.categories=[],l.producer_urls=this.createCatalogLinks("producer",l.producer),l.thematic_urls=this.createCatalogLinks("thematic",l.thematic),this.layersList[o]=l}}var s=document.getElementById("GPcatalogContainerTabs");s&&s.remove(),this.layersList.sort((o,l)=>o.title.localeCompare(l.title,"fr",{sensitivity:"base"})),this.createCatalogContentEntries(this.layersList)}activeLayerByID(e){var i=e.split("$")[0],s=e.split(":").slice(-1)[0];this.activeLayer(i,s)}disableLayerByID(e){var i=e.split("$")[0],s=e.split(":").slice(-1)[0];this.disableLayer(i,s)}activeLayer(e,i){var s=this.getLayerId(e,i);if(s){var o={};this.options.addToMap&&(o=this.addLayer(e,i)),this.dispatchEvent({type:this.ADD_CATALOG_LAYER_EVENT,name:e,service:i,layer:o})}}disableLayer(e,i){var s=this.getLayerId(e,i);if(s){var o={};this.options.addToMap&&(o=this.removeLayer(e,i)),this.dispatchEvent({type:this.REMOVE_CATALOG_LAYER_EVENT,name:e,service:i,layer:o})}}getLayerId(e,i){if(!this.layersList||typeof this.layersList!="object")return null;var s=new RegExp(e+".*"+i);for(const o in this.layersList)if(Object.prototype.hasOwnProperty.call(this.layersList,o)&&s.test(o))return o;return null}getLayersByCategory(e,i){var s=i,o=e.filter;if(o){s={};for(const c in i)if(Object.prototype.hasOwnProperty.call(i,c)){const u=i[c];if(u[o.field]){var l=Array.isArray(o.value)?o.value.includes(u[o.field].toString()):o.value==="*"||u[o.field].toString()===o.value;l&&(s[c]=u,this.layersList[c].categories.push(e.id))}}}return s}getContainer(){return this.container}initialize(e){this.uid=e.id||SelectorID.generate(),this.clusterOptions={rows_in_block:50,blocks_in_cluster:4},this.options={collapsed:!0,draggable:!1,auto:!0,titlePrimary:"Grer vos couches de donnes",titleSecondary:"",layerLabel:"title",layerThumbnail:!1,size:"md",search:{display:!0,label:"Rechercher une donne",criteria:["name","title","description"]},addToMap:!0,categories:[{title:"Donnes",id:"data",cluster:!0,clusterOptions:this.clusterOptions,default:!0,filter:null}],configuration:{type:"json",urls:["https://raw.githubusercontent.com/IGNF/geoportal-configuration/new-url/dist/entreeCarto.json"]}};var i=Helper.assign(this.options.search,e.search);Helper.assign(this.options,e),Helper.assign(this.options.search,i),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this.auto=this.options.auto,this.eventsListeners=[],this.buttonCatalogShow=null,this.panelCatalogContainer=null,this.panelCatalogHeaderContainer=null,this.buttonCatalogClose=null,this.contentCatalogContainer=null,this.waitingContainer=null,this.configData={},this.layersList={},this.clusterize={},this.categories=this.options.categories.map(s=>{var o=s.items;return s.items&&(o=s.items.map(l=>{var c=l.hasOwnProperty("cluster")?l.cluster:!1;return l.hasOwnProperty("section")&&l.section&&(c=!1),{title:l.title,id:l.id||this.generateID(l.title),section:l.hasOwnProperty("section")?l.section:!1,sections:[],icon:l.hasOwnProperty("icon")?l.icon:!1,iconJson:l.iconJson||[],default:l.hasOwnProperty("default")?l.default:!1,cluster:c,clusterOptions:l.hasOwnProperty("clusterOptions")?l.clusterOptions:this.clusterOptions,filter:l.filter||null}})),{title:s.title,id:s.id||this.generateID(s.title),default:s.hasOwnProperty("default")?s.default:!1,search:s.hasOwnProperty("search")?s.search:!1,cluster:s.hasOwnProperty("cluster")?s.cluster:!1,clusterOptions:s.hasOwnProperty("clusterOptions")?s.clusterOptions:this.clusterOptions,filter:s.filter||null,items:o||null}}),this.categoryId=(()=>{var s=this.categories.findIndex(o=>o.default);return s===-1&&(s=0,this.categories[s].default=!0),this.categories[s].id})(),this.layersListOnMap={},this._searchTimeout=null,this.ADD_CATALOG_LAYER_EVENT="catalog:layer:add",this.REMOVE_CATALOG_LAYER_EVENT="catalog:layer:remove",this.LOADED_CATALOG_EVENT="catalog:loaded"}initContainer(){var e=this._createMainContainerElement(),i=this.buttonCatalogShow=this._createShowCatalogPictoElement();e.appendChild(i);var s=this.panelCatalogContainer=this._createCatalogPanelElement(),o=this._createCatalogPanelDivSizeElement(this.options.size);s.appendChild(o);var l=this._createCatalogPanelDivElement();o.appendChild(l);var c=this.panelCatalogHeaderContainer=this._createCatalogPanelHeaderElement(),u=this._createCatalogPanelIconElement(this.options.titlePrimary);c.appendChild(u);var f=this._createCatalogPanelTitleElement(this.options.titlePrimary);c.appendChild(f);var g=this.buttonCatalogClose=this._createCatalogPanelCloseElement();c.appendChild(g),l.appendChild(c);var H=this._createCatalogPanelContentDivElement(),Y=this.contentCatalogContainer=this._createCatalogContentDivElement();Y.appendChild(this._createCatalogContentTitleElement(this.options.titleSecondary)),this.options.search.display&&Y.appendChild(this._createCatalogContentSearchGlobalElement(this.options.search.label));var ee=this.waitingContainer=this._createCatalogWaitingElement();return Y.appendChild(ee),H.appendChild(Y),l.appendChild(H),e.appendChild(s),e}checkLayersOnMap(){var e=this.getMap();if(e){var i=e.getLayers();i.forEach(s=>{if(s.name&&s.service){this.layersListOnMap[s.name+":"+s.service]=s;var o=document.querySelectorAll(`input[data-layer="${s.name}:${s.service}"]`);o&&o.forEach(l=>{l.checked=!0})}})}}async initConfigData(){var e=null;if(this.options.configuration.data)return e=this.options.configuration.data||{},Config.isConfigLoaded()&&Helper.mergeParams(e,Config.configuration),this.checkConfigLayers(e.layers),this.layersList=e.layers,this.createCatalogContentEntries(e),new Promise((s,o)=>{s(e)});if(this.options.configuration.urls){var i=[];for(let s=0;s<this.options.configuration.urls.length;s++){const o=this.options.configuration.urls[s],l=function(){return fetch(o,{}).then(function(c){if(c.ok)return c.json().then(function(f){return f}).catch(f=>{logger$4.warn("fetch json exception :",f)});var u=new Error("HTTP status code: "+c.status);throw u}).catch(c=>new Promise((u,f)=>{logger$4.error("fetch json exception :",c),f(c)}))};i.push(l())}try{const s=await Promise.all(i);e=s[0];for(let o=1;o<s.length;o++){const l=s[o];Helper.mergeParams(e,l)}return Config.isConfigLoaded()&&Helper.mergeParams(e,Config.configuration),this.checkConfigLayers(e.layers),this.layersList=e.layers,this.createCatalogContentEntries(e),await new Promise((o,l)=>{o(e)})}catch(s){return await new Promise((o,l)=>{l(s)})}}}checkConfigLayers(e){for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)){const o=e[s];if(o.serviceParams){var i=o.serviceParams.id.split(":").slice(-1)[0];o.service=i,o.categories=[],o.producer_urls=this.createCatalogProducerLinks(o.producer),o.thematic_urls=this.createCatalogThematicLinks(o.thematic),o.label=this.options.layerLabel&&o[this.options.layerLabel]||o.title,o.description=k$1.parse(o.description),this.options.layerThumbnail?o.thumbnail||(o.thumbnail="default"):o.thumbnail&&delete o.thumbnail}else delete e[s]}}createCatalogContentEntries(e){var i=this.contentCatalogContainer,s=this._createCatalogContentCategoriesTabs(this.categories);i.appendChild(s);var o=[];this.categories.forEach(u=>{if(u.items)for(let f=0;f<u.items.length;f++){const g=u.items[f];if(g.icon&&g.iconJson.length===0&&g.section&&g.filter){const H=g.filter.field;e.topics&&e.topics[H]?g.iconJson=e.topics[H]:e[H]?g.iconJson=e[H]:Topics[H]?g.iconJson=Topics[H]:g.iconJson=[]}g.subcategory=!0,o.push(g)}else o.push(u)}),o.findIndex(u=>u.id===this.categoryId);var l=i.querySelectorAll(".tabcontent");for(let u=0;u<l.length;u++){const f=l[u];var c=this.getLayersByCategory(o[u],e.layers);this._createCatalogContentCategoryTabContent(o[u],c).then(g=>{const H=document.createDocumentFragment();g.blocks,g.dom&&(H.appendChild(g.dom),f.appendChild(H),console.log(`Content for category ${o[u].title} created.`),o[u].cluster?this.clusterize[o[u].id]=new Clusterize({scrollId:f.parentElement.id,contentId:f.children[0].id,rows_in_block:o[u].clusterOptions.rows_in_block,blocks_in_cluster:o[u].clusterOptions.blocks_in_cluster,callbacks:{clusterChanged:()=>{logger$4.trace("cluster changed"),this._updateListenersLayersDOM(f,o[u].id),this.checkLayersOnMap()}}}):(this._updateListenersLayersDOM(f,o[u].id),this.checkLayersOnMap()))})}}createCatalogThematicLinks(e){if(!e)return null;var i="https://cartes.gouv.fr/catalogue/search?",s=[];for(let l=0;l<e.length;l++){const c=e[l];if(c!=="Autres"){var o=Topics.thematic.find(u=>u.name===c);o&&s.push({name:c,url:i+"topic="+o.id})}}return s.length===0&&(s=null),s}createCatalogProducerLinks(e){if(!e)return null;var i="https://cartes.gouv.fr/catalogue/search?",s=[];for(let o=0;o<e.length;o++){const l=e[o];l!=="Autres"&&s.push({name:l,url:i+"organization="+l})}return s.length===0&&(s=null),s}addEventsListeners(e){var i=this;this.eventsListeners["map:add"]=function(s){logger$4.trace(s);var o=s.element.name,l=s.element.service;i.layersListOnMap[o+":"+l]=s.element;var c=document.querySelectorAll(`input[data-layer="${o}:${l}"]`);c&&c.forEach(u=>{u.checked=!0})},e.getLayers().on("add",this.eventsListeners["map:add"]),this.eventsListeners["map:remove"]=function(s){logger$4.trace(s);var o=s.element.name,l=s.element.service;delete i.layersListOnMap[o+":"+l];var c=document.querySelectorAll(`input[data-layer="${o}:${l}"]`);c&&c.forEach(u=>{u.checked=!1})},e.getLayers().on("remove",this.eventsListeners["map:remove"])}removeEventsListeners(){var e=this.getMap();e.getLayers().un("add",this.eventsListeners["map:add"]),delete this.eventsListeners["map:add"],e.getLayers().un("remove",this.eventsListeners["map:remove"]),delete this.eventsListeners["map:remove"]}addLayer(e,i){var s=null,o=null,l=this.getLayerId(e,i);if(l){var c=Config.isConfigLoaded()?null:LayerConfigUtils.getLayerConfig(this.layersList[l]);switch(i){case"WMS":o=new LayerWMS({layer:e,configuration:c});break;case"WMTS":o=new LayerWMTS({layer:e,configuration:c});break;case"TMS":o=new LayerMapBox({layer:e,configuration:c},{declutter:!0});break;case"WFS":o=new LayerWFS({layer:e,configuration:c});break}if(o){var u=this.getMap();u.addLayer(o),this.layersListOnMap[e+":"+i]=o,s=o.getConfiguration()}return s}}removeLayer(e,i){var s=null,o=this.layersListOnMap[e+":"+i];if(o){s=o.getConfiguration();var l=this.getMap();l.removeLayer(o),delete this.layersListOnMap[e+":"+i]}return s}hideWaiting(){this.waitingContainer.className="GPwaitingContainerHidden  gpf-waiting--hidden"}showWaiting(){this.waitingContainer.className="GPwaitingContainerVisible gpf-waiting--visible"}resetFilteredLayersList(){for(const e in this.layersList)if(Object.prototype.hasOwnProperty.call(this.layersList,e)){const i=this.layersList[e];i.hidden=!1,this.updateVisibilityFilteredLayersDOM(i.name,i.service,i.hidden)}}setFilteredLayersList(e){var i=this.options.search.criteria;for(const o in this.layersList)if(Object.prototype.hasOwnProperty.call(this.layersList,o)){const l=this.layersList[o];var s="";for(let c=0;c<i.length;c++){const u=i[c];l[u]&&(s+=l[u].toLowerCase())}l.hidden=!s.includes(e.toLowerCase()),this.updateVisibilityFilteredLayersDOM(l.name,l.service,l.hidden)}this.updateVisibilityFilteredSectionsDOM()}updateVisibilityFilteredLayersDOM(e,i,s){var o=[];this.categories.forEach(c=>{if(c.items)for(let u=0;u<c.items.length;u++){const f=c.items[u];o.push(f.id)}else o.push(c.id)});for(let c=0;c<o.length;c++){const u=o[c];var l=document.getElementById(`fieldset-${u}_${e}-${i}`);l&&(s?(l.classList.add("gpf-hidden"),l.classList.add("GPelementHidden")):(l.classList.remove("gpf-hidden"),l.classList.remove("GPelementHidden")))}}updateVisibilityFilteredSectionsDOM(){for(let c=0;c<this.categories.length;c++){const u=this.categories[c];if(u.items)for(let f=0;f<u.items.length;f++){const g=u.items[f];if(g.section)for(let H=0;H<g.sections.length;H++){const Y=g.sections[H];var e=`section-${g.id}-${this.generateID(Y)}`,i=document.getElementById(e);if(i){var s=i.innerHTML,o=[...s.matchAll(/"fr-fieldset__element"/g)].length,l=document.getElementById(`section-count-${g.id}-${this.generateID(Y)}`);o===0?(i.classList.add("gpf-hidden"),i.classList.add("GPelementHidden")):(l&&(l.textContent=o),i.classList.remove("gpf-hidden"),i.classList.remove("GPelementHidden"))}}}}}onShowCatalogClick(e){var i=e.target.ariaPressed;i==="true"&&this.onPanelOpen(),this.collapsed=i!=="true",this.dispatchEvent("change:collapsed"),logger$4.trace(e)}onCloseCatalogClick(e){logger$4.trace(e)}onSelectCatalogTabClick(e){logger$4.trace(e);var i=e.target.id,s=i.split("_")[1];this.categoryId=s;var o=this.categories.find(u=>u.id===s),l=document.getElementById("catalog-container-search-specific");l&&(o&&o.search?(l.classList.remove("gpf-hidden"),l.classList.add("fr-tabs__panel--selected")):(l.classList.add("gpf-hidden"),l.classList.remove("fr-tabs__panel--selected")));var c=document.getElementById("catalog-input-search-specific");c&&c.value!==""&&(c.value="",this.setFilteredLayersList(""))}onSelectCatalogEntryClick(e){logger$4.trace(e);var i=e.target.dataset.layer,s=i.substring(0,i.lastIndexOf(":")),o=i.substring(i.lastIndexOf(":")+1),l={};e.target.checked?(this.options.addToMap&&(l=this.addLayer(s,o)),this.dispatchEvent({type:this.ADD_CATALOG_LAYER_EVENT,name:s,service:o,layer:l})):(this.options.addToMap&&(l=this.removeLayer(s,o)),this.dispatchEvent({type:this.REMOVE_CATALOG_LAYER_EVENT,name:s,service:o,layer:l}))}onToggleCatalogMoreLearnClick(e){logger$4.trace(e)}onSearchGlobalCatalogButtonClick(e){var i=e.target.value;this.setFilteredLayersList(i)}onSearchGlobalCatalogInputChange(e){clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(()=>{this.onSearchGlobalCatalogButtonClick(e)},200)}onSearchGlobalCatalogButtonResetClick(e){this.resetFilteredLayersList(),this.updateVisibilityFilteredSectionsDOM()}onSearchSpecificCatalogButtonClick(e){var i=e.target.value;this.setFilteredLayersList(i)}onSearchSpecificCatalogInputChange(e){clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(()=>{this.onSearchSpecificCatalogButtonClick(e)},200)}onSearchSpecificCatalogButtonResetClick(e){this.resetFilteredLayersList(),this.updateVisibilityFilteredSectionsDOM()}}Object.assign(Catalog.prototype,CatalogDOM);Object.assign(Catalog.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.Catalog=Catalog);const TerritoriesJson=[{id:"FXX",title:"France mtropolitaine",description:"",zoom:null,bbox:[-9.86,41.15,10.38,51.56],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/fxx.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/fxx.svg"},{id:"GLP",title:"Guadeloupe",description:"",zoom:null,bbox:[-61.97,15.72,-60.93,16.66],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/glp.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/glp.svg"},{id:"GUF",title:"Guyane",description:"",zoom:null,bbox:[-55.65,1.49,-51.2,6.21],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/guf.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/guf.svg"},{id:"MTQ",title:"Martinique",description:"",zoom:null,bbox:[-61.4,14.25,-60.67,15.04],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/mtq.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/mtq.svg"},{id:"REU",title:"Runion",description:"",zoom:10,bbox:[55.07,-21.46,55.86,-20.79],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/reu.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/reu.svg"},{id:"SPM",title:"Saint-Pierre-et-Miquelon",description:"",zoom:null,bbox:[-56.48,46.69,-56.07,47.19],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/spm.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/spm.svg"},{id:"IDF",title:"Paris petite couronne",description:"",zoom:12,bbox:[2.18,48.77,2.52,48.95],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/idf.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/idf.svg"},{id:"MYT",title:"Mayotte",description:"",zoom:null,bbox:[44.95,-13.049,45.32,-12.57],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/myt.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/myt.svg"},{id:"NCL",title:"Nouvelle Caldonie",description:"",zoom:null,bbox:[163.02,-23.08,167.86,-19.5],thumbnail:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/thumbnails/ncl.png",icon:"https://data.geopf.fr/annexes/cartes.gouv.fr-config/public/resources/territories/ncl.svg"}],stringToHTML$1=n=>{var e=function(){if(!window.DOMParser)return!1;var l=new DOMParser;try{l.parseFromString("x","text/html")}catch{return!1}return!0};if(e()){var i=new DOMParser,s=i.parseFromString(n,"text/html");return s.body}var o=document.createElement("div");return o.innerHTML=n,o};var TerritoriesDOM={_addUID:function(n){var e=this.uid?n+"-"+this.uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPterritories"),n.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",n},_createShowTerritoriesPictoElement:function(){var n=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowTerritoriesPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowTerritoriesPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-territories fr-btn fr-btn--tertiary",e.setAttribute("aria-label","Slecteur de territoire"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowTerritoriesClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowTerritoriesClick(s)}),e},_createTerritoriesPanelElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPterritoriesPanel"),n.className="GPpanel gpf-panel fr-modal",n},_createTerritoriesPanelDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__territories",n},_createTerritoriesPanelHeaderElement:function(){var n=document.createElement("div");return n.className="gpf-panel__header_territories",n},_createTerritoriesPanelIconElement:function(){var n=document.createElement("label");return n.className="gpf-btn-header-territories gpf-btn-icon-header-territories",n.title="Selecteur de territoires",n},_createTerritoriesPanelTitleElement:function(n){var e=document.createElement("div");return e.className="gpf-panel__title_territories",e.innerHTML=n,e},_createTerritoriesPanelCloseElement:function(){var n=this,e=document.createElement("button");e.id="GPterritoriesPanelClose",e.className="gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",e.title="Fermer le panneau";var i=document.createElement("span");return i.className="GPelementHidden gpf-visible",i.innerText="Fermer",e.appendChild(i),e.addEventListener?e.addEventListener("click",function(){document.getElementById(n._addUID("GPshowTerritoriesPicto")).click(),n.onCloseTerritoriesClick()},!1):e.attachEvent&&e.attachEvent("onclick",function(){document.getElementById(n._addUID("GPshowTerritoriesPicto")).click(),n.onCloseTerritoriesClick()}),e},_createTerritoriesPanelOptionsElement:function(n,e){var i=this,s="&#x2630",o="gpf-territories-button-option-id",l="gpf-territories-upload-id",c="gpf-territories-upload-close-id",u="gpf-territories-toggle-messages",f=`
        <div>
            <button type="button" 
                id="${o}"
                class="fr-btn fr-btn--tertiary-no-outline" 
                role="territories-button-options" 
                aria-expanded="false" 
                aria-controls="gpf-territories-upload-container-id">
                ${s}
            </button>
            <dialog id="gpf-territories-upload-container-id" class="fr-modal__body fr-upload-group gpf-hidden">
                <div class="gpf-territories-header-upload">
                    <button 
                        id="${c}"
                        type="button" 
                        class="gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w"
                        aria-expanded="false"
                        title="Fermer le panneau">
                        <span>Fermer</span>
                    </button>
                </div>
                <label class="fr-label" for="gpf-territories-upload-id">
                    ${n}
                    <span class="fr-hint-text">${e}</span>
                </label>
                <div class="fr-toggle fr-m-2v">
                    <input 
                        id="${u}" 
                        class="fr-toggle__input" 
                        type="checkbox" 
                        aria-describedby="gpf-territories-toggle-messages">
                    <label class="fr-toggle__label" for="${u}">Complter la liste</label>
                    <div class="fr-messages-group" id="gpf-territories-toggle-messages" aria-live="polite"></div>
                </div>
                <input 
                    id="${l}" 
                    class="fr-upload" 
                    aria-describedby="gpf-territories-upload-id-messages" 
                    type="file" 
                    name="upload">
                <div class="fr-messages-group" id="gpf-territories-upload-id-messages" aria-live="polite"></div>
            </dialog>
        </div>
        `,g=stringToHTML$1(f);const H=g.attachShadow({mode:"open"});H.innerHTML=f.trim();var Y=H.getElementById(o);Y&&Y.addEventListener("click",Ye=>{Ye.target.ariaExpanded=Ye.target.ariaExpanded!=="true";var xe=document.getElementById(Ye.target.getAttribute("aria-controls"));xe&&(Ye.target.ariaExpanded==="true"?(xe.classList.add("gpf-visible"),xe.classList.remove("gpf-hidden")):(xe.classList.remove("gpf-visible"),xe.classList.add("gpf-hidden")))},!1);var ee=H.getElementById(c);ee&&ee.addEventListener("click",Ye=>{Ye.target.ariaExpanded=Ye.target.ariaExpanded!=="true";var xe=document.getElementById(o);xe.click()});var te=H.getElementById(l);te&&te.addEventListener("change",Ye=>{i.onUploadFileClick(Ye)},!1);var ne=H.getElementById(u);return ne.addEventListener("click",Ye=>{console.log(Ye.target.checked),i.onUploadToggleClick(Ye)}),H.firstChild},_createTerritoriesElement:function(){var n=document.createElement("div");return n.className="territories-entries gpf-panel__body_territories fr-modal__body",n},_createTerritoryEntry:function(n){var e=this;if(n){var i="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDIwMDEwOTA0Ly9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAxL1JFQy1TVkctMjAwMTA5MDQvRFREL3N2ZzEwLmR0ZCI+CjxzdmcgdmVyc2lvbj0iMS4wIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiB3aWR0aD0iNTgxLjAwMDAwMHB0IiBoZWlnaHQ9IjM1Ni4wMDAwMDBwdCIgdmlld0JveD0iMCAwIDU4MS4wMDAwMDAgMzU2LjAwMDAwMCIKIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIG1lZXQiPgoKPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsMzU2LjAwMDAwMCkgc2NhbGUoMC4xMDAwMDAsLTAuMTAwMDAwKSIKZmlsbD0iI2I0YjNiMyIgc3Ryb2tlPSJub25lIj4KPHBhdGggZD0iTTAgMTc4MCBsMCAtMTc4MCAyOTA1IDAgMjkwNSAwIDAgMTc4MCAwIDE3ODAgLTI5MDUgMCAtMjkwNSAwIDAKLTE3ODB6Ii8+CjwvZz4KPC9zdmc+Cg==",s=n.thumbnail||i,o=n.icon||i,l=n.id.toLowerCase(),c=stringToHTML$1(`
            <div class="gpf-tile fr-tile fr-tile--sm">
                <div class="fr-tile__body">
                    <div class="fr-tile__content">
                        <p class="fr-tile__title">
                            <label class="gpf-label fr-label" title="${n.description}">${n.title}</label>
                        </p>
                    </div>
                </div>
                <div class="gpf-tile__header fr-tile__header">
                    <div class="fr-tile__pictogram fr-tile__thumbnail">
                        <img id="thumbnail-${n.id}" src="${s}" width="100%" height="100%" title="${n.description}"/>
                    </div>
                    <div class="fr-tile__pictogram fr-tile__icon fr-tile__icon--${l}">
                        <svg>       
                            <image id="icon-${n.id}" xlink:href="${o}" style="width:100%;"/>    
                        </svg>
                    </div>
                </div>
            </div>
            `),u=c.firstChild;return u&&u.addEventListener("click",f=>{e.onImageTerritoriesClick(f,n.id)}),c.firstChild}}},logger$3=LoggerByDefault.getLogger("territories");class Territories extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof Territories))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="Territories",this.initialize(e),this.container=this.initContainer(),this.element?this.element.appendChild(this.container):this.element=this.container,this}setMap(e){if(e){this.draggable&&Draggable.dragElement(this.panelTerritoriesContainer,this.panelTerritoriesHeaderContainer,e.getTargetElement()),this.collapsed||this.buttonTerritoriesShow.setAttribute("aria-pressed",!0);var i=this.auto?TerritoriesJson:this.options.territories;for(let s=0;s<i.length;s++){const o=i[s];this.setTerritory(o)}}super.setMap(e),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}setTerritory(e){var i=this.territories.some(o=>o.data.id===e.id);if(e&&!i){var s=this._createTerritoryEntry(e);if(s)return this.panelTerritoriesEntriesContainer.appendChild(s),this.territories.push({data:e,dom:s}),!0}return!1}setTerritories(e){for(let i=0;i<e.length;i++){const s=e[i];this.setTerritory(s)}}removeTerritory(e){var i=!1;if(e){for(let s=0;s<this.territories.length;s++)if(this.territories[s].data.id===e.data.id){this.territories[s].dom.remove(),this.territories.splice(s,1),i=!0;break}}return i}removeTerritories(){for(let e=0;e<this.territories.length;e++)this.territories[e].dom.remove();this.territories=[]}setCollapse(e){if(e===void 0){logger$3.log("[ERROR] Territory:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(e?document.getElementById("GPterritoriesPanelClose").click():this.buttonTerritoriesShow.click(),this.collapsed=e)}setReduce(e){e?this.panelTerritoriesEntriesContainer.classList.add("tiles-reduce"):this.panelTerritoriesEntriesContainer.classList.remove("tiles-reduce")}getContainer(){return this.container}initialize(e){this.uid=e.id||SelectorID.generate(),this.options={collapsed:!0,draggable:!1,panel:!0,upload:{active:!1,title:"Ajouter un fichier de configuration",description:""},title:"Slectionner un territoire",auto:!1,thumbnail:!1,reduce:!1,tiles:3,territories:[]};var i=Helper.assign(this.options.upload,e.upload);Helper.assign(this.options,e),Helper.assign(this.options.upload,i),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this.auto=this.options.auto,this.territories=[],this.append=!1,this.buttonTerritoriesShow=null,this.panelTerritoriesContainer=null,this.panelTerritoriesHeaderContainer=null,this.buttonTerritoriesClose=null,this.containerTerritoriesOptions=null,this.panelTerritoriesEntriesContainer=null}initContainer(){var e=this._createMainContainerElement(),i=this.buttonTerritoriesShow=this._createShowTerritoriesPictoElement();e.appendChild(i);var s=this.panelTerritoriesContainer=this._createTerritoriesPanelElement();s.classList.add("tiles-direction"),s.classList.add("tiles-"+this.options.tiles);var o=this._createTerritoriesPanelDivElement();s.appendChild(o);var l=this.panelTerritoriesEntriesContainer=this._createTerritoriesElement();if(l.classList.add("tiles-direction"),l.classList.add("tiles-"+this.options.tiles),this.options.reduce&&l.classList.add("tiles-reduce"),this.options.thumbnail?l.classList.add("tiles-thumbnail"):l.classList.add("tiles-icon"),s.appendChild(l),this.options.panel){var c=this.panelTerritoriesHeaderContainer=this._createTerritoriesPanelHeaderElement(),u=this._createTerritoriesPanelIconElement();c.appendChild(u);var f=this._createTerritoriesPanelTitleElement(this.options.title);if(c.appendChild(f),this.options.upload&&this.options.upload.active){var g=this.containerTerritoriesOptions=this._createTerritoriesPanelOptionsElement(this.options.upload.title,this.options.upload.description);c.appendChild(g)}var H=this.buttonTerritoriesClose=this._createTerritoriesPanelCloseElement();c.appendChild(H),o.appendChild(c)}return e.appendChild(s),logger$3.log(e),e}closePanelUpLoad(){this.containerTerritoriesOptions.children[0].click()}onShowTerritoriesClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen(),logger$3.trace(e),this.collapsed=!this.collapsed}onCloseTerritoriesClick(e){logger$3.trace(e)}onImageTerritoriesClick(e,i){logger$3.trace(e,i);var s=this.territories.find(Y=>Y.data.id===i);if(s){var o=s.data.zoom,l=s.data.bbox,c=s.data.point;if(l&&!l.length||!c&&!l)return;var u=this.getMap(),f=u.getView().getProjection().getCode();if(l){var g=transformExtent(l,"EPSG:4326",f);u.getView().fit(g,u.getSize())}if(c){var H=transform$1(c,"EPSG:4326",f);u.getView().setCenter(H)}o&&u.getView().setZoom(o),this.setCollapse(!0),this.dispatchEvent({type:"territories:change",territory:s})}}onUploadFileClick(e){var i=e.target.files[0],s=e.target;if(!i){logger$3.warn("Missing file to upload !");return}var o=new FileReader,l=this;o.onerror=c=>{logger$3.log("onerror")},o.onprogress=c=>{logger$3.log("onprogress")},o.onloadstart=c=>{logger$3.log("onloadstart")},o.onabort=c=>{logger$3.log("onabort")},o.onloadend=c=>{logger$3.log("onloadend : ",c)},o.onload=c=>{logger$3.log("file content : ",c.target.result),l.closePanelUpLoad(s);var u=JSON.parse(c.target.result);l.append||l.removeTerritories(),l.setTerritories(u)},o.readAsText(i)}onUploadToggleClick(e){this.append=e.target.checked}}Object.assign(Territories.prototype,TerritoriesDOM);Object.assign(Territories.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.Territories=Territories);var ControlListDOM={_addUID:function(n){var e=this._uid?n+"-"+this._uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPcontrolList"),n.className="GPwidget gpf-widget gpf-widget-button gpf-mobile-fullscreen",n},_createShowControlListPictoElement:function(){var n=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowControlListPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowControlListPicto gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-controllist fr-btn fr-btn--tertiary",e.setAttribute("aria-label","Tous mes outils"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowControlListPanelClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowControlListPanelClick(s)}),e},_createControlListPanelElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPcontrolListPanel"),n.className="GPpanel gpf-panel fr-modal",n},_createControlListPanelDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__body fr-modal__body",n},_createControlListPanelHeaderElement:function(){var n=this,e=document.createElement("div");e.className="GPpanelHeader gpf-panel__header fr-modal__header";var i=document.createElement("div");i.className="GPpanelTitle gpf-panel__title fr-modal__title fr-pt-4w",i.innerHTML="Mes outils",e.appendChild(i);var s=document.createElement("button");s.id=this._addUID("GPcontrolListPanelClose"),s.className="GPpanelClose GPcontrolListPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",s.title="Fermer le panneau",s.addEventListener?s.addEventListener("click",function(){document.getElementById(n._addUID("GPshowControlListPicto")).click()},!1):s.attachEvent&&s.attachEvent("onclick",function(){document.getElementById(n._addUID("GPshowControlListPicto")).click()});var o=document.createElement("span");return o.className="GPelementHidden gpf-visible",o.innerText="Fermer",s.appendChild(o),e.appendChild(s),e},_createControlListPanelContentElement:function(){var n=document.createElement("div");return n.className="gpf-panel__content fr-modal__content",n},_createControlListPanelFooterElement:function(n){var e=document.createElement("div");e.className="GPpanelFooter gpf-panel__footer fr-modal__footer";var i=document.createElement("button");return i.classList.add("gpf-btn","gpf-btn--tertiary","fr-btn","fr-btn--tertiary"),i.innerText="+ Ajouter plus d'outils",i.addEventListener("click",function(){n.click()}),e.appendChild(i),e},_createControlListPanelControl:function(n){let e;try{e=n.getContainer()}catch{e=n.container}var i=document.createElement("div"),s=e.querySelector(".GPshowOpen").cloneNode();s.id=s.id+"-controllist",s.classList.add("inside-control-list"),i.appendChild(s);var o=document.createElement("div"),l=document.createElement("span");if(o.appendChild(l),e.querySelector(".GPshowOpen").ariaLabel?l.innerText=e.querySelector(".GPshowOpen").ariaLabel:e.querySelector(".GPpanelTitle")?l.innerText=e.querySelector(".GPpanelTitle").innerText:e.querySelector("[class^='gpf-btn-header-']")&&(l.innerText=e.querySelector("[class^='gpf-btn-header-']").title),n.description){var c=document.createElement("span");c.innerText=n.description,o.appendChild(c)}return i.appendChild(o),i.addEventListener("click",function(){e.querySelector(".GPshowOpen").click()}),i}},logger$2=LoggerByDefault.getLogger("controlList");class ControlList extends ControlExtended{constructor(e){if(e=e||{},super(e),!(this instanceof ControlList))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return e.controlCatalogElement?this.controlCatalogElement=e.controlCatalogElement:this.controlCatalogElement=null,this.CLASSNAME="ControlList",this.initialize(e),this._container=this._initContainer(),this.element?this.element.appendChild(this._container):this.element=this._container,this}setMap(e){e&&(this.draggable&&Draggable.dragElement(this._ControlListPanelContainer,this._ControlListPanelHeaderContainer,e.getTargetElement()),this.collapsed||this._pictoControlListButton.setAttribute("aria-pressed",!0)),super.setMap(e),this.options.position&&this.setPosition(this.options.position)}getCollapsed(){return this.collapsed}setCollapsed(e){if(e===void 0){logger$2.log("[ERROR] ControlList:setCollapsed - missing collapsed parameter");return}e&&this.collapsed||!e&&!this.collapsed||(e?document.getElementById("GPcontrolListPanelClose-"+this._uid).click():this._pictoIsoButton.click(),this.collapsed=e)}getContainer(){return this._container}clean(){this._clearIsoInputs(),this._originPoint.clearResults(),document.getElementById("GPlocationPoint_1-"+this._uid).style.cssText="",document.getElementById("GPlocationOriginCoords_1-"+this._uid).value="",document.getElementById("GPlocationOrigin_1-"+this._uid).value="",document.getElementById("GPlocationPoint_1-"+this._uid).style.cssText="",document.getElementById("GPlocationOriginPointer_1-"+this._uid).checked=!1,document.getElementById("GPlocationOrigin_1-"+this._uid).className="GPlocationOriginVisible gpf-visible",document.getElementById("GPlocationOriginCoords_1-"+this._uid).className="GPlocationOriginHidden gpf-hidden",this._currentIsoResults=null,this.setLayer()}initialize(e){e.collapsed==="true"&&(e.collapsed=!0),e.collapsed==="false"&&(e.collapsed=!1),this.options={collapsed:!0,draggable:!1},Helper.assign(this.options,e),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this._uid=this.options.id||SelectorID.generate()}_initContainer(){var e=this._createMainContainerElement(),i=this._pictoControlListButton=this._createShowControlListPictoElement();e.appendChild(i);var s=this._ControlListPanelContainer=this._createControlListPanelElement(),o=this._createControlListPanelDivElement();s.appendChild(o);var l=this._ControlListPanelHeaderContainer=this._createControlListPanelHeaderElement();o.appendChild(l);var c=this._ControlListPanelContentContainer=this._createControlListPanelContentElement();if(o.appendChild(c),this.controlCatalogElement){var u=this._createControlListPanelFooterElement(this.controlCatalogElement);o.appendChild(u)}return e.appendChild(s),e}onShowControlListPanelClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen();var i=this.getMap();Interactions.unset(i);var s=this._pictoControlListButton.ariaPressed;this.collapsed=s!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position),this.collapsed?this._ControlListPanelContentContainer.innerHTML="":this.getMap().getControls().getArray().forEach(l=>{if(l.listable){let c=this._createControlListPanelControl(l);this._ControlListPanelContentContainer.appendChild(c)}})}}Object.assign(ControlList.prototype,ControlListDOM);Object.assign(ControlList.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.ControlList=ControlList);var OGCRequest={computeGenericGPFWFS:async function(n,e,i=0,s="geom",o="",l=4326,c=!1,u,f){let g=f,H=u;l!==4326&&([g,H]=proj4(proj4.defs("EPSG:4326"),proj4.defs(`EPSG:${l}`),[f,u]));let Y=`INTERSECTS(${s},Point(${g}%20${H}))`;i>0&&(Y=`DWITHIN(${s},Point(${g}%20${H}),${i},kilometers)`),o&&(Y+=` ${o}`);const te=await(await fetch(`https://data.geopf.fr/wfs/ows?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&typename=${n}&outputFormat=json&count=50&CQL_FILTER=${Y}`)).json(),ne=[];return te.features.forEach(Ye=>{const xe=[];e.forEach(tt=>{xe.push(Ye.properties[tt])}),c&&xe.push(Ye.geometry),e.length===1&&xe[0]!==null&&!c?ne.push(xe[0]):(e.length>1||c)&&ne.push(xe)}),ne}},title$3="contextMenu",ContextMenuDOM={_addUID:function(n){var e=this.uid?n+"-"+this.uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPpointInfo"),n.className="GPpointInfo GPwidget gpf-widget",n},_createShowPointInfoPictoElement:function(){var n=this,e=document.createElement("button");return e.id=this._addUID("GPshowPointInfoPicto"),e.className="GPshowOpen GPshowAdvancedToolPicto GPshowPointInfoPicto gpf-btn gpf-btn-icon gpf-btn-icon-widget fr-btn",e.title=`${title$3}`,e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(i){var s=i.target.ariaPressed==="true";i.target.setAttribute("aria-pressed",!s),n.onShowPointInfoClick(i)}):e.attachEvent&&e.attachEvent("onclick",function(i){var s=i.target.ariaPressed==="true";i.target.setAttribute("aria-pressed",!s),n.onShowPointInfoClick(i)}),e},_createPointInfoPanelElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPpointInfoPanel"),n.className="GPpanel gpf-panel fr-modal",n},_createPointInfoPanelDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__pointInfo",n},_createPointInfoPanelHeaderElement:function(){var n=document.createElement("div");return n.className="GPpointInfoHeader gpf-panel__header_pointInfo",n},_createPointInfoPanelIconElement:function(){var n=document.createElement("label");return n.className="GPpanelHeader gpf-btn-header-pointInfo gpf-btn-icon-header-pointInfo",n.title="Adresse et coordonnes",n},_createPointInfoPanelTitleElement:function(){var n=document.createElement("div");return n.className="GPpanelTitle gpf-panel__title_pointInfo fr-pt-4w",n.innerHTML="Adresse et coordonnes",n},_createPointInfoPanelCloseElement:function(){var n=this,e=document.createElement("button");e.className="GPpanelClose GPpointInfoPanelClose gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline",e.title="Fermer le panneau";var i=document.createElement("span");return i.className="GPelementHidden gpf-visible",i.innerText="Fermer",e.appendChild(i),e.addEventListener?e.addEventListener("click",function(){document.getElementById(n._addUID("GPshowPointInfoPicto")).click(),n.onClosePointInfoClick()},!1):e.attachEvent&&e.attachEvent("onclick",function(){document.getElementById(n._addUID("GPshowPointInfoPicto")).click(),n.onClosePointInfoClick()}),e},_createEntriesElement:function(){var n=document.createElement("div");n.className="point-info-content gpf-panel__body fr-modal__body";var e=document.createElement("div");return n.appendChild(e),n},_createPinDOMOverlay:function(n){var e=document.createElement("div"),i=document.createElement("img");return i.src=n,e.appendChild(i),e}};/*!
  * ol-contextmenu - v5.5.0
  * https://github.com/jonataswalker/ol-contextmenu
  * Built: Wed Aug 07 2024 12:29:18 GMT+0000 (Coordinated Universal Time)
  */var k=Object.defineProperty,I=(n,e,i)=>e in n?k(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,a=(n,e,i)=>I(n,typeof e!="symbol"?e+"":e,i),S={exports:{}};function x(){}x.prototype={on:function(n,e,i){var s=this.e||(this.e={});return(s[n]||(s[n]=[])).push({fn:e,ctx:i}),this},once:function(n,e,i){var s=this;function o(){s.off(n,o),e.apply(i,arguments)}return o._=e,this.on(n,o,i)},emit:function(n){var e=[].slice.call(arguments,1),i=((this.e||(this.e={}))[n]||[]).slice(),s=0,o=i.length;for(s;s<o;s++)i[s].fn.apply(i[s].ctx,e);return this},off:function(n,e){var i=this.e||(this.e={}),s=i[n],o=[];if(s&&e)for(var l=0,c=s.length;l<c;l++)s[l].fn!==e&&s[l].fn._!==e&&o.push(s[l]);return o.length?i[n]=o:delete i[n],this}};S.exports=x;var _=S.exports.TinyEmitter=x,L=(n=>(n.CONTEXTMENU="contextmenu",n.CLICK="click",n.DBLCLICK="dblclick",n))(L||{}),p=(n=>(n.BEFOREOPEN="beforeopen",n.OPEN="open",n.CLOSE="close",n.ADD_MENU_ENTRY="add-menu-entry",n))(p||{});class w extends MapBrowserEvent{constructor(e){super(e.type,e.map,e.originalEvent)}}const z={width:150,scrollAt:4,eventType:L.CONTEXTMENU,defaultItems:!0,items:[]},d="ol-ctx-menu",r={container:`${d}-container`,separator:`${d}-separator`,submenu:`${d}-submenu`,hidden:`${d}-hidden`,icon:`${d}-icon`,zoomIn:`${d}-zoom-in`,zoomOut:`${d}-zoom-out`,unselectable:"ol-unselectable"},C=[{text:"Zoom In",classname:`${r.zoomIn} ${r.icon}`,callback:(n,e)=>{const i=e.getView();i.animate({zoom:Number(i.getZoom())+1,duration:700,center:n.coordinate})}},{text:"Zoom Out",classname:`${r.zoomOut} ${r.icon}`,callback:(n,e)=>{const i=e.getView();i.animate({zoom:Number(i.getZoom())-1,duration:700,center:n.coordinate})}}];function y(n){const e=document.createDocumentFragment(),i=document.createElement("div");for(i.innerHTML=n;i.firstChild;)e.append(i.firstChild);return e}function P(n){var f,g;const e=document.importNode(n),i=n.offsetWidth;e.style.cssText=`position: fixed; top: 0; left: 0; overflow: auto; visibility: hidden; pointer-events: none; height: unset; max-height: unset; width: ${i}px`;const s=y("<span>Foo</span>"),o=y("<span>Foo</span>"),l=document.createElement("li"),c=document.createElement("li");l.append(s),c.append(o),e.append(l),e.append(c),(f=n.parentNode)==null||f.append(e);const u=e.offsetHeight/2;return(g=n.parentNode)==null||g.removeChild(e),u}function N({parentNode:n,item:e,isSubmenu:i=!1,isInsideSubmenu:s=!1,emitter:o}){const l=`_${Math.random().toString(36).slice(2,11)}`;if(typeof e!="string"&&"text"in e){const H=`<span>${e.text}</span>`,Y=y(H),ee=document.createElement("li");e.classname=e.classname||"",e.icon&&(e.classname===""?e.classname=r.icon:e.classname.includes(r.icon)===!1&&(e.classname+=` ${r.icon}`),ee.setAttribute("style",`background-image:url(${e.icon})`)),ee.id=l,ee.className=e.classname,ee.append(Y),n.append(ee);const te={id:l,isSubmenu:i,isInsideSubmenu:s,isSeparator:!1,callback:"callback"in e?e.callback:null,data:"data"in e?e.data:null};return o.emit(p.ADD_MENU_ENTRY,te,ee),ee}const c=`<li id="${l}" class="${r.separator}"><hr></li>`,u=y(c);n.append(u);const f=n.lastChild,g={id:l,isSubmenu:!1,isInsideSubmenu:!1,isSeparator:!0,callback:null,data:null};return o.emit(p.ADD_MENU_ENTRY,g,f),f}function M({container:n,items:e,menuWidth:i,isInsideSubmenu:s,emitter:o}){e.forEach(l=>{if(typeof l!="string"&&"items"in l&&Array.isArray(l.items)){const c=N({parentNode:n,item:l,isSubmenu:!0,emitter:o});c.classList.add(r.submenu);const u=document.createElement("ul");u.classList.add(r.container),u.style.width=`${i}px`,c.append(u),M({emitter:o,menuWidth:i,container:u,items:l.items,isInsideSubmenu:!0})}else N({parentNode:n,item:l,isSubmenu:!1,isInsideSubmenu:s,emitter:o})})}function b(n,e){if(!n)throw new Error(e)}class R extends Control{constructor(e={}){b(typeof e=="object","@param `opts` should be object type!");const i=document.createElement("div");super({element:i}),a(this,"map"),a(this,"emitter",new _),a(this,"container"),a(this,"coordinate",[]),a(this,"pixel",[]),a(this,"contextMenuEventListener"),a(this,"entryCallbackEventListener"),a(this,"mapMoveListener"),a(this,"lineHeight",0),a(this,"disabled"),a(this,"opened"),a(this,"items",[]),a(this,"menuEntries",new Map),a(this,"options"),this.options={...z,...e};const s=document.createElement("ul");i.append(s),i.style.width=`${this.options.width}px`,i.classList.add(r.container,r.unselectable,r.hidden),this.container=i,this.contextMenuEventListener=o=>{this.handleContextMenu(o)},this.entryCallbackEventListener=o=>{this.handleEntryCallback(o)},this.mapMoveListener=()=>{this.handleMapMove()},this.disabled=!1,this.opened=!1,window.addEventListener("beforeunload",()=>{this.removeListeners()},{once:!0})}clear(){for(const e of this.menuEntries.keys())this.removeMenuEntry(e);this.container.replaceChildren(),this.container.append(document.createElement("ul"))}enable(){this.disabled=!1}disable(){this.disabled=!0}getDefaultItems(){return C}countItems(){return this.menuEntries.size}extend(e){b(Array.isArray(e),"@param `items` should be an Array."),M({items:e,emitter:this.emitter,menuWidth:this.options.width,container:this.container.firstElementChild})}closeMenu(){this.opened=!1,this.container.classList.add(r.hidden),this.dispatchEvent(p.CLOSE)}isOpen(){return this.opened}updatePosition(e){b(Array.isArray(e),"@param `pixel` should be an Array."),this.isOpen()&&(this.pixel=e,this.positionContainer())}pop(){const e=Array.from(this.menuEntries.keys()).pop();e&&this.removeMenuEntry(e)}shift(){const e=Array.from(this.menuEntries.keys()).shift();e&&this.removeMenuEntry(e)}push(e){e&&this.extend([e])}setMap(e){if(super.setMap(e),e){this.map=e,e.getViewport().addEventListener(this.options.eventType,this.contextMenuEventListener,!1),e.on("movestart",()=>{this.handleMapMove()}),this.emitter.on(p.ADD_MENU_ENTRY,(s,o)=>{this.handleAddMenuEntry(s,o)},this),this.items=this.options.defaultItems?this.options.items.concat(C):this.options.items,M({items:this.items,emitter:this.emitter,menuWidth:this.options.width,container:this.container.firstElementChild});const i=this.getMenuEntriesLength();this.lineHeight=i>0?this.container.offsetHeight/i:P(this.container)}else this.removeListeners(),this.clear()}removeListeners(){this.map.getViewport().removeEventListener(this.options.eventType,this.contextMenuEventListener,!1),this.emitter.off(p.ADD_MENU_ENTRY)}removeMenuEntry(e){let i=document.getElementById(e);i==null||i.remove(),i=null,this.menuEntries.delete(e)}handleContextMenu(e){var i;this.coordinate=this.map.getEventCoordinate(e),this.pixel=this.map.getEventPixel(e),this.dispatchEvent(new w({map:this.map,originalEvent:e,type:p.BEFOREOPEN})),!this.disabled&&(this.options.eventType===L.CONTEXTMENU&&(e.stopPropagation(),e.preventDefault()),setTimeout(()=>{this.openMenu(e)}),(i=e.target)==null||i.addEventListener("pointerdown",s=>{this.opened&&(s.stopPropagation(),this.closeMenu())},{once:!0}))}openMenu(e){this.opened=!0,this.positionContainer(),this.container.classList.remove(r.hidden),this.dispatchEvent(new w({map:this.map,originalEvent:e,type:p.OPEN}))}getMenuEntriesLength(){return Array.from(this.menuEntries).filter(([,e])=>e.isSeparator===!1&&e.isSubmenu===!1&&e.isInsideSubmenu===!1).length}positionContainer(){const e=this.map.getSize()||[0,0],i={w:e[0]-this.pixel[0],h:e[1]-this.pixel[1]},s=this.getMenuEntriesLength(),o={w:this.container.offsetWidth,h:Math.round(this.lineHeight*s)},l=i.w>=o.w?this.pixel[0]+5:this.pixel[0]-o.w;this.container.style.left=`${l}px`,this.container.style.top=i.h>=o.h?`${this.pixel[1]-10}px`:`${this.pixel[1]-o.h}px`,this.container.style.right="auto",this.container.style.bottom="auto",i.w-=o.w;const c=g=>Array.from(g.children).filter(H=>H.tagName==="LI"&&H.classList.contains(r.submenu));let u=0;const f=(g,H)=>{u+=1,c(g).forEach(Y=>{const ee=H>=o.w?o.w-8:(o.w+8)*-1,te=Y.querySelector(`ul.${r.container}`),ne=Math.round(this.lineHeight*Array.from(te.children).filter(Ye=>Ye.tagName==="LI").length);te.style.left=`${ee}px`,te.style.right="auto",te.style.top=i.h>=ne+o.h?"0":`-${te.offsetHeight-25}px`,te.style.bottom="auto",te.style.zIndex=String(u),c(te).length>0&&f(te,H-o.w)})};f(this.container.firstElementChild,i.w)}handleMapMove(){this.closeMenu()}handleEntryCallback(e){var l;e.preventDefault(),e.stopPropagation();const i=e.currentTarget,s=this.menuEntries.get(i.id);if(!s)return;const o={data:s.data,coordinate:this.coordinate};this.closeMenu(),(l=s.callback)==null||l.call(s,o,this.map)}handleAddMenuEntry(e,i){this.menuEntries.set(e.id,e),this.positionContainer(),"callback"in e&&typeof e.callback=="function"&&i.addEventListener("click",this.entryCallbackEventListener,!1)}}var logger$1=LoggerByDefault.getLogger("contextMenu");class ContextMenu extends ControlExtended{constructor(e){if(e=e||{},super({element:e.element,target:e.target,render:e.render}),!(this instanceof ContextMenu))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return this.CLASSNAME="ContextMenu",this.initialize(e),this.container=this.initContainer(),this.element?this.element.appendChild(this.container):this.element=this.container,this}setMap(e){e?(e.addControl(this.contextmenu),e.addOverlay(this._marker),this.auto&&this.addEventsListeners()):this.auto&&this.removeEventsListeners(),super.setMap(e)}initialize(e){this.uid=SelectorID.generate(),this.options={collapsed:!0,draggable:!1,auto:!0,panel:!0,contextMenuItemsOptions:[]},Helper.assign(this.options,e),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this.auto=this.options.auto,this.buttonContextMenuShow=null,this.panelContextMenuContainer=null,this.panelContextMenuHeaderContainer=null,this.buttonContextMenuClose=null,this.panelContextMenuEntriesContainer=null,this.eventsListeners=[],this.controlList=[],this.itiPoints=new Array(7),this._marker=new Overlay({element:this._createPinDOMOverlay(Marker.lightOrange),stopEvent:!1,offset:Marker.defaultOffset});var i=this.getAvailableContextMenuControls.call(this);this.contextMenuItemsOptions=[],e.contextMenuItemsOptions instanceof Array&&e.contextMenuItemsOptions&&e.contextMenuItemsOptions.length>0&&(this.contextMenuItemsOptions=e.contextMenuItemsOptions.map(s=>({...s,classname:"ol-context-menu-custom fr-text--md"}))),this.contextmenu=new R({defaultItems:!1,width:250,items:i})}initContainer(){var e=this._createMainContainerElement(),i=this.buttonPointInfoShow=this._createShowPointInfoPictoElement();e.appendChild(i);var s=this.panelPointInfoContainer=this._createPointInfoPanelElement(),o=this._createPointInfoPanelDivElement();s.appendChild(o);var l=this.panelPointInfoEntriesContainer=this._createEntriesElement();s.appendChild(l);var c=this.panelPointInfoHeaderContainer=this._createPointInfoPanelHeaderElement(),u=this._createPointInfoPanelIconElement();c.appendChild(u);var f=this._createPointInfoPanelTitleElement();c.appendChild(f);var g=this.buttonPointInfoClose=this._createPointInfoPanelCloseElement();return c.appendChild(g),o.appendChild(c),e.appendChild(s),logger$1.log(e),e}addEventsListeners(){this.contextmenu.on("open",e=>{e.this=this,this.onOpenContextMenu(e)}),this.contextmenu.on("close",e=>{e.this=this,this.onCloseContextMenu(e)})}removeEventsListeners(){}getAvailableContextMenuControls(){var e=[{text:"Informations sur des couches",classname:"ol-context-menu-custom fr-text--md",callback:this.getFeatureInfo.bind(this),control_CLASSNAME:"GetFeatureInfo"},{text:"Adresse / Coordonnes",classname:"ol-context-menu-custom fr-text--md",callback:this.displayAdressAndCoordinate.bind(this),control_CLASSNAME:"ContextMenu"},{text:"Itinraire depuis ce lieu",classname:"ol-context-menu-custom fr-text--md",callback:this.defineStartPoint.bind(this),control_CLASSNAME:"Route"},{text:"Itinraire vers ce lieu",classname:"ol-context-menu-custom fr-text--md",callback:this.defineEndPoint.bind(this),control_CLASSNAME:"Route"},{text:"Zone selon temps de trajet",classname:"ol-context-menu-custom fr-text--md",callback:this.computeIsochrone.bind(this),control_CLASSNAME:"Isocurve"},{text:"Ajouter des cartes / donnes",classname:"ol-context-menu-custom fr-text--md",callback:this.openCatalogue.bind(this),control_CLASSNAME:"Catalog"},"separator",{text:"Afficher la lgende",classname:"ol-context-menu-custom fr-text--md",callback:this.displayLegend.bind(this),control_CLASSNAME:"Legends"}],i=this.getMap(),s=[];i&&(s=i.getControls().getArray());var o=e.filter(l=>{if(s.filter(u=>u.CLASSNAME&&u.CLASSNAME==l.control_CLASSNAME).length>0||l=="separator")return l});return Array.prototype.push.apply(o,this.contextMenuItemsOptions),o}defineStartPoint(e){let i=this.to4326(e.coordinate);var s=this.getMap().getControls().getArray().filter(o=>o.CLASSNAME=="Route")[0];s._showRouteButton.click(),s._showRouteButton.setAttribute("aria-pressed",!0),this.itiPoints[0]=i,s.setData({points:this.itiPoints})}defineEndPoint(e){let i=this.to4326(e.coordinate);var s=this.getMap().getControls().getArray().filter(o=>o.CLASSNAME=="Route")[0];s._showRouteButton.click(),s._showRouteButton.setAttribute("aria-pressed",!0),this.itiPoints[6]=i,s.setData({points:this.itiPoints})}to4326(e){return transform$1([parseFloat(e[0]),parseFloat(e[1])],"EPSG:3857","EPSG:4326")}computeIsochrone(e){var i=this.getMap().getControls().getArray().filter(l=>l.CLASSNAME=="Isocurve")[0];i._pictoIsoButton.click(),i._pictoIsoButton.setAttribute("aria-pressed",!0);let s=this.to4326(e.coordinate);var o=i.getData();o.point=s,i.setData(o)}getFeatureInfo(e){var i=this.getMap().getControls().getArray().filter(c=>c.CLASSNAME=="GetFeatureInfo")[0],s;i.buttonGetFeatureInfoShow.getAttribute("aria-pressed")==="false"&&(s=!1),i.buttonGetFeatureInfoShow.click(),i.buttonGetFeatureInfoShow.setAttribute("aria-pressed",!0);let l={pixel:this.getMap().getPixelFromCoordinate(e.coordinate),map:this.getMap(),coordinate:e.coordinate};this.getMap().dispatchEvent({type:"singleclick",...l}),s===!1&&i.buttonGetFeatureInfoShow.setAttribute("aria-pressed",!1)}displayLegend(e){var i=this.getMap().getControls().getArray().filter(s=>s.CLASSNAME=="Legends")[0];i.buttonLegendsShow.click(),i.buttonLegendsShow.setAttribute("aria-pressed",!0)}openCatalogue(e){var i=this.getMap().getControls().getArray().filter(s=>s.CLASSNAME=="Catalog")[0];i.buttonCatalogShow.click(),i.buttonCatalogShow.setAttribute("aria-pressed",!0)}displayAdressAndCoordinate(e){let i=this.to4326(e.coordinate);this.panelPointInfoEntriesContainer.innerHTML="",this._marker.setPosition(fromLonLat(i)),this.buttonPointInfoShow.click(),this.buttonPointInfoShow.setAttribute("aria-pressed",!0);var s=document.createElement("div");s.innerHTML=i[1].toFixed(6)+", "+i[0].toFixed(6);var o=document.createElement("div"),l=document.createElement("div"),c=document.createElement("div");this.panelPointInfoEntriesContainer.appendChild(s),this.panelPointInfoEntriesContainer.appendChild(o),this.panelPointInfoEntriesContainer.appendChild(l),this.panelPointInfoEntriesContainer.appendChild(c);var u={rawResponse:!1,scope:null,onSuccess:function(Y){Y.elevations.length>0&&Y.elevations[0].z&&(c.innerHTML="Altitude : "+Y.elevations[0].z+"m")},onFailure:function(Y){},positions:[{lon:i[0],lat:i[1]}],outputFormat:"json"};Gp.Services.getAltitude(u);var f={onSuccess:function(Y){Y.locations.length>0&&(l.innerHTML="Parcelle : "+Y.locations[0].placeAttributes.districtcode+" / "+Y.locations[0].placeAttributes.section+" / "+Y.locations[0].placeAttributes.number)},onFailure:function(Y){},position:{lon:i[1],lat:i[0]},searchGeometry:{type:"Circle",coordinates:[i[1],i[0]],radius:100},index:"CadastralParcel",maximumResponses:1};Gp.Services.reverseGeocode(f);var g=async function(){let Y={layer:"LIMITES_ADMINISTRATIVES_EXPRESS.LATEST:commune",attributes:["code_postal","nom_officiel"]};const ee=await OGCRequest.computeGenericGPFWFS(Y.layer,Y.attributes,Y.around||0,Y.geom_name||"geometrie",Y.additional_cql||"",Y.epsg||4326,Y.get_geom||!1,i[0],i[1]);ee.length&&(o.innerHTML=ee[0].join(", "))},H={onSuccess:function(Y){Y.locations.length>0?o.innerHTML=Y.locations[0].placeAttributes.label:g()},onFailure:function(Y){g()},position:{lon:i[0],lat:i[1]},searchGeometry:{type:"Circle",coordinates:[i[0],i[1]],radius:100},index:"StreetAddress",maximumResponses:1};Gp.Services.reverseGeocode(H)}onShowPointInfoClick(e){e.target.ariaPressed==="true"&&this.onPanelOpen(),logger$1.trace(e);var i=this.buttonPointInfoShow.ariaPressed;this.collapsed=i!=="true",this.dispatchEvent("change:collapsed"),this.options.position&&!this.collapsed&&this.updatePosition(this.options.position)}onClosePointInfoClick(e){logger$1.trace(e),this._marker.setPosition(void 0)}onCloseContextMenu(e){e.target.clear()}onOpenContextMenu(e){var i=()=>{e.this.controlList=[];var o=e.this.getMap().getControls().getArray().filter(l=>l.CLASSNAME=="Route");o.length>0&&o[0].on("route:newresults",()=>{e.this.itiPoints=new Array(7)})},s=e.this.getAvailableContextMenuControls();e.target.clear(),e.target.extend(s),i()}}Object.assign(ContextMenu.prototype,ContextMenuDOM);Object.assign(ContextMenu.prototype,ContextMenu);Object.assign(ContextMenu.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.ContextMenu=ContextMenu);var title$2="reporting";const stringToHTML=n=>{var e=function(){if(!window.DOMParser)return!1;var l=new DOMParser;try{l.parseFromString("x","text/html")}catch{return!1}return!0};if(e()){var i=new DOMParser,s=i.parseFromString(n,"text/html");return s.body}var o=document.createElement("div");return o.innerHTML=n,o};var ReportingDOM={_addUID:function(n){var e=this.uid?n+"-"+this.uid:n;return e},_createMainContainerElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPreporting"),n.className="gpf-widget gpf-widget-button gpf-mobile-fullscreen gpf-button-no-gutter",n},_createShowReportingPictoElement:function(){var n=this,e=document.createElement("button"),i=document.createElement("span");return e.appendChild(i),e.id=this._addUID("GPshowReportingPicto"),e.className="gpf-btn gpf-btn--tertiary gpf-btn-icon gpf-btn-icon-reporting fr-btn fr-btn--tertiary ",e.title=`${title$2}`,e.setAttribute("aria-label","Signalement"),e.setAttribute("tabindex","0"),e.setAttribute("aria-pressed",!1),e.setAttribute("type","button"),e.addEventListener?e.addEventListener("click",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowReportingClick(s)}):e.attachEvent&&e.attachEvent("onclick",function(s){var o=s.target.ariaPressed==="true";s.target.setAttribute("aria-pressed",!o),n.onShowReportingClick(s)}),e},_createReportingPanelElement:function(){var n=document.createElement("dialog");return n.id=this._addUID("GPreportingPanel"),n.className="GPpanel gpf-panel fr-modal",n},_createReportingPanelDivElement:function(){var n=document.createElement("div");return n.className="gpf-panel__body fr-modal__body",n},_createReportingPanelHeaderElement:function(){var n=document.createElement("div");return n.className="gpf-panel__header fr-modal__header gpf-panel__header_reporting",n},_createReportingPanelIconElement:function(){var n=this,e=document.createElement("label");return e.className="gpf-btn-header gpf-btn-icon-header-reporting",e.title="Retour  l'tape prcdente",e.addEventListener("click",function(i){n.onPrevReportingClick(i)}),e},_createReportingPanelTitleElement:function(n){var e=document.createElement("div");return e.className="gpf-panel__title fr-modal__title fr-pt-4w",e.innerHTML=n||"",e},_createReportingPanelCloseElement:function(){var n=this,e=document.createElement("button");e.className="gpf-btn gpf-btn-icon-close fr-btn--close fr-btn fr-btn--tertiary-no-outline fr-m-1w",e.title="Fermer le panneau",e.addEventListener?e.addEventListener("click",function(s){document.getElementById(n._addUID("GPshowReportingPicto")).click(),n.onCloseReportingClick(s)},!1):e.attachEvent&&e.attachEvent("onclick",function(s){document.getElementById(n._addUID("GPshowReportingPicto")).click(),n.onCloseReportingClick(s)});var i=document.createElement("span");return i.className="gpf-visible",i.innerText="Fermer",e.appendChild(i),e},_createReportingPanelFooterElement:function(){var n=document.createElement("div");return n.className="gpf-panel__footer fr-modal__footer gpf-panel__footer_reporting gpf-visible",n},_createReportingButtonAnnulerFooterElement:function(){var n=this,e=document.createElement("button");return e.className="gpf-btn gpf-btn--tertiary gpf-btn-icon-annuler fr-btn fr-btn--tertiary fr-m-1w",e.title="Annuler",e.textContent="Annuler",e.addEventListener?e.addEventListener("click",function(i){n.onCancelReportingClick(i)},!1):e.attachEvent&&e.attachEvent("onclick",function(i){n.onCancelReportingClick(i)}),e},_createReportingButtonSuivantFooterElement:function(){var n=this,e=document.createElement("button");return e.className="gpf-btn gpf-btn--primary gpf-btn-icon-suivant fr-btn fr-btn--primary fr-m-1w",e.title="Suivant",e.textContent="Suivant",e.addEventListener?e.addEventListener("click",function(i){n.onNextReportingClick(i)},!1):e.attachEvent&&e.attachEvent("onclick",function(i){n.onNextReportingClick(i)}),e},_createReportingPanelInputElement:function(){var n=document.createElement("div");n.id=this._addUID("GPreportingPanelInput"),n.className="gpf-panel__content fr-modal__content fr-px-3w gpf-hidden";var e=document.createElement("p");return e.innerHTML="Cliquez sur la carte  l'endroit que vous souhaitez corriger.",e.className="gpf-label fr-label",n.appendChild(e),n},_createReportingPanelFormElement:function(n){var e=this,i=document.createElement("form");i.id=this._addUID("GPreportingForm"),i.className="gpf-panel__content fr-modal__content gpf-hidden",i.addEventListener("submit",function(et){et.preventDefault();var it=document.getElementById(s).value,rt=document.getElementById(u).value,nt=document.getElementById(l),at=nt.options[nt.selectedIndex].textContent;return e.onReportingFormSubmit({target:et.target,name:it,desc:rt,theme:at}),!1});var s=this._addUID("GPreportingFormLabelName"),o=`
        <div class="fr-input-group">
            <label class="gpf-label fr-label" for="${s}">Titre (obligatoire)</label>
            <input class="gpf-input fr-input" type="text" id="${s}" name="GPreportingLabelName" required>
        </div>
        `,l=this._addUID("GPreportingFormSelectTheme"),c=`
        <div class="fr-select-group">
            <label class="gpf-label fr-label" for="${l}">
                Objet du signalement (obligatoire)
            </label>
            <select class="gpf-select fr-select" id="${l}" name="GPreportingSelectTheme" required>
                <option value="" selected disabled >Slectionner une option</option>
                ${n.map(et=>`<option value="${et}">${et}</option>`).join("")}
            </select>
        </div>
        `,u=this._addUID("GPreportingFormTextDesc"),f=`
        <div class="fr-input-group">
            <label class="gpf-label fr-label" for="${u}">
                Description (obligatoire)
            </label>
            <textarea class="gpf-input fr-input" id="${u}" name="GPreportingTextDesc" required></textarea>
        </div>
        `,g=this._addUID("GPreportingFormButtonDrawing"),H=`
        <div class="gpf-btn-group">
            <button id="${g}" class="gpf-btn fr-btn fr-btn--secondary fr-btn--icon-left fr-icon-edit-box-line">
                Dessiner sur la carte
            </button>
        </div>
        `,Y=`
        <fieldset class="fr-fieldset" id="GPreportingFormFieldset" role="group" aria-labelledby="GPreportingFormFieldsetMessages">
            ${o}
            ${c}
            ${f}
            <div class="fr-messages-group gpf-hidden" id="GPreportingFormFieldsetMessages" aria-live="polite">
                <p class="fr-message fr-message--error" id="GPreportingFormFieldsetMessage">Les champs sont obligatoires</p>
            </div>
            ${H}
        </fieldset>
        `,ee=stringToHTML(Y);const te=ee.attachShadow({mode:"open"});te.innerHTML=Y.trim();var ne=te.getElementById(g);ne&&ne.addEventListener("click",et=>{this.onShowFormDrawingReportingClick(et)});var Ye=te.getElementById(s);Ye&&Ye.addEventListener("change",et=>{this.onEntryFormNameReportingChange(et)});var xe=te.getElementById(l);xe&&xe.addEventListener("change",et=>{this.onSelectFormThemeReportingChange(et)});var tt=te.getElementById(u);return tt&&tt.addEventListener("change",et=>{this.onEntryFormDescReportingChange(et)}),i.appendChild(te),i},_createReportingSubmitFormElement:function(){var n=document.createElement("input");return n.id=this._addUID("GPreportingSubmit"),n.className="gpf-btn fr-btn gpf-hidden",n.type="submit",n.value="",n},_createReportingPanelDrawingElement:function(){var n=document.createElement("div");return n.id=this._addUID("GPreportingPanelDrawing"),n.className="gpf-panel__content fr-modal__content gpf-hidden",n},_createReportingPanelSendElement:function(){var n=document.createElement("div");n.id=this._addUID("GPreportingPanelSend"),n.className="gpf-panel__content fr-modal__content fr-px-3w gpf-hidden";var e=this._addUID("GPreportingLabelEmail"),i=`
        <div class="fr-input-group">
            <label class="gpf-label fr-label" for="${e}">Adresse courriel
                <span class="fr-hint-text">Pour valider le signalement, renseignez votre adresse courriel. Nous vous tiendrons informs de sa prise en compte.</span>
            </label>
            <input class="gpf-input fr-input" type="text" id="${e}" name="GPreportingLabelEmail" required>
        </div>
        `,s=this._addUID("GPreportingButtonEnvoyer"),o=`
        <div class="gpf-btn-group fr-pb-1w">
            <button id="${s}" class="gpf-btn fr-btn fr-btn--primary">
                Envoyer
            </button>
        </div>
        `,l=`
        <fieldset class="fr-fieldset" id="GPreportingSendFieldset" role="group" aria-labelledby="GPreportingSendFieldsetMessages">
            ${i}
            ${o}
            <div class="fr-messages-group gpf-hidden" id="GPreportingSendFieldsetMessages" aria-live="polite">
                <p class="fr-message fr-message--error" id="GPreportingSendFieldsetMessage">Le champ est obligatoire</p>
            </div>
        </fieldset>
        `,c=stringToHTML(l);const u=c.attachShadow({mode:"open"});u.innerHTML=l.trim();var f=u.getElementById(s);f&&f.addEventListener("click",H=>{this.onShowSendReportingClick({target:H.target,mail:document.getElementById(e).value})});var g=u.getElementById(e);return g&&g.addEventListener("change",H=>{this.onEntrySendMailReportingChange(H)}),n.appendChild(u),n},_createReportingErrorSendElement:function(){var n=this._addUID("GPreportingSpanError"),e=document.createElement("span");return e.id=n,e.className="gpf-error fr-error fr-error-text gpf-hidden",e.innerHTML="Une erreur est survenue lors de l'envoi du signalement. <br> Veuillez ressayer plus tard.",e}},logger=LoggerByDefault.getLogger("reporting");class InputActionByDefaut{constructor(e){logger.info("InputActionByDefaut constructor"),this.map=e||null,this.data=null,this.coordinate=null,this.listener=null,this.icon="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAzNiIgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4Ij48cGF0aCBmaWxsPSIjMDAwMDkxIiBkPSJNMTguMzY0IDMuNjM2YTkgOSAwIDAgMSAwIDEyLjcyOEwxMiAyMi43MjhsLTYuMzY0LTYuMzY0QTkgOSAwIDAgMSAxOC4zNjQgMy42MzZaTTEyIDhhMiAyIDAgMSAwIDAgNCAyIDIgMCAwIDAgMC00WiIvPjwvc3ZnPg=="}setMap(e){logger.info("InputActionByDefaut map"),this.map=e}setIcon(e){logger.info("InputActionByDefaut icon"),e&&(this.icon=e)}getData(){logger.info("InputActionByDefaut data");var e=this.map.getView().getProjection();this.coordinate||(this.coordinate=this.map.getView().getCenter());var i={type:"FeatureCollection",crs:{type:"name",properties:{name:e.getCode()}},features:[{type:"Feature",crs:{type:"name",properties:{name:e.getCode()}},geometry:{type:"Point",coordinates:this.coordinate||[0,0]},properties:{description:"Point de signalement",date:new Date().toISOString(),author:"Anonyme"}}]};return this.data={location:i},this.data||{location:null}}clear(){logger.info("InputActionByDefaut clear"),this.data=null,this.coordinate=null,this.listener&&(unByKey(this.listener),this.listener=null),this.marker!=null&&(this.map.removeOverlay(this.marker),this.marker=null)}active(){this._addEventsListeners()}disable(){this._removeEventsListeners()}_addEventsListeners(){logger.info("InputActionByDefaut active"),this.map&&(this.listener=this.map.on("singleclick",this._handler.bind(this)))}_removeEventsListeners(){logger.info("InputActionByDefaut disable"),this.map&&unByKey(this.listener)}_handler(e){if(logger.info("InputActionByDefaut handler",e),!!this.map){this.coordinate=e.coordinate,this.marker!=null&&(this.map.removeOverlay(this.marker),this.marker=null);var i=document.createElement("img");i.src=this.icon,this.marker=new Overlay({position:this.coordinate,positioning:"center-center",element:i,stopEvent:!1}),this.map.addOverlay(this.marker)}}}class FormActionByDefaut{constructor(e){logger.info("FormActionByDefaut constructor"),this.data=null,this.form=null,this.submit=null,this.error=null,this.message=null}active(){logger.info("FormActionByDefaut active"),this._addEventsListeners()}disable(){logger.info("FormActionByDefaut disable")}setForm(e){logger.info("FormActionByDefaut form"),this.form=e,this.submit=this.form.querySelector('input[type="submit"]'),this.error=this.form.querySelector("#GPreportingFormFieldset"),this.message=this.form.querySelector("#GPreportingFormFieldsetMessages")}getData(){return logger.info("FormActionByDefaut data"),this.submit.click(),this.data?(this.error.classList.remove("fr-fieldset--error"),this.message.classList.replace("gpf-visible","gpf-hidden")):(this.error.classList.add("fr-fieldset--error"),this.message.classList.replace("gpf-hidden","gpf-visible")),this.data}clear(){logger.info("FormActionByDefaut clear"),this.data=null}_addEventsListeners(){this.form.addEventListener("submit",this._handler.bind(this),{once:!0})}_handler(e){logger.info("FormActionByDefaut handler",e),e.preventDefault();var i=new FormData(e.target),s=i.get("GPreportingLabelName"),o=i.get("GPreportingTextDesc"),l=i.get("GPreportingSelectTheme");return s&&o&&l&&(this.data={name:s,desc:o,theme:l}),!1}}class DrawingActionByDefaut{constructor(e){logger.info("DrawingActionByDefaut constructor"),this.data=null,this.format="geojson",this.map=e||null,this.dom=null,this.Drawing=null,this.DrawingBtn=null,this.DrawingPanel=null}active(){logger.info("ServiceActionByDefaut active"),this.Drawing||this._initializeDrawing(),this.Drawing.setCollapsed(!1),this.DrawingPanel.style.position="relative",this.DrawingPanel.style.left="0px",this.DrawingPanel.style.top="0px",this.DrawingPanel.style.bottom="unset",this.DrawingPanel.style.right="unset"}disable(){logger.info("DrawingActionByDefaut disable"),this.Drawing&&this.Drawing.setCollapsed(!0)}clear(){logger.info("DrawingActionByDefaut clear"),this.data=null}getData(){if(logger.info("DrawingActionByDefaut data"),this.Drawing){var e=this.Drawing.exportFeatures();this.data={drawing:this.format.toLowerCase()==="geojson"?JSON.parse(e):e}}return this.data||{drawing:null}}setMap(e){logger.info("DrawingActionByDefaut map"),this.map=e}setTarget(e){if(logger.info("DrawingActionByDefaut target"),!e){logger.warn("DrawingActionByDefaut target is null");return}this.dom=e}setFormat(e){logger.info("DrawingActionByDefaut format"),e&&(this.format=e)}_initializeDrawing(){if(logger.info("DrawingActionByDefaut initializeDrawing"),!!this.map){var e=1e3;this.Drawing=new Drawing({target:this.dom,id:e,layerDescription:{title:"Signalement",description:"Dessin de signalement"},popup:{display:!1},tools:{export:!1}}),this.Drawing.setExportFormat(this.format);var i=this.Drawing.getContainer();i.className="";var s=this.DrawingBtn=i.querySelector("#GPshowDrawingPicto-"+e);s&&(s.style.display="none");var o=this.DrawingPanel=i.querySelector("#GPdrawingPanel-"+e);o&&(o.style.position="relative",o.style.left="0px",o.style.top="0px",o.style.bottom="unset",o.style.right="unset",o.style.margin="auto");var l=i.querySelector(".gpf-panel__header");l&&(l.style.display="none"),this.map.addControl(this.Drawing)}}}class ServiceActionByDefaut{constructor(){logger.info("ServiceActionByDefaut constructor")}active(){logger.info("ServiceActionByDefaut active")}disable(){logger.info("ServiceActionByDefaut disable")}send(e){return logger.info("ServiceActionByDefaut send"),Promise.reject(new Error("ServiceActionByDefaut send not implemented"))}clear(){logger.info("ServiceActionByDefaut clear")}}var Mi,Ji,Qi;const Wi=class Wi extends ControlExtended{constructor(i){i=i||{};super({element:i.element,target:i.target,render:i.render});Bi(this,Mi);if(!(this instanceof Wi))throw new TypeError("ERROR CLASS_CONSTRUCTOR");return Ti(this,Mi,Ji).call(this,i),this.container=Ti(this,Mi,Qi).call(this),this.element?this.element.appendChild(this.container):this.element=this.container,this}setMap(i){i?(this.setStep(0),this._setComponents(i),this.draggable&&Draggable.dragElement(this.panelReportingContainer,this.panelReportingHeaderContainer,this.options.position?null:i.getTargetElement()),this.collapsed||this.buttonReportingShow.click(),this.auto&&this._addEventsListeners(i)):this.auto&&this._removeEventsListeners(),super.setMap(i),this.options.position&&this.setPosition(this.options.position),this.options.gutter===!1&&this.getContainer().classList.add("gpf-button-no-gutter")}getContainer(){return this.container}getCollapsed(){return this.collapsed}setCollapsed(i){i!==void 0&&(i&&this.collapsed||!i&&!this.collapsed||(i?this.buttonReportingClose.click():this.buttonReportingShow.click(),this.collapsed=i))}_setComponents(i){this.iocInput||(this.iocInput=new InputActionByDefaut),this.iocInput.setMap(i),this.iocInput.setIcon(this.options.icon||null),this.iocForm||(this.iocForm=new FormActionByDefaut),this.iocForm.setForm(this.formReportingContainer),this.iocService||(this.iocService=new ServiceActionByDefaut),this.iocDrawing||(this.iocDrawing=new DrawingActionByDefaut),this.iocDrawing.setFormat(this.options.format||"geojson"),this.iocDrawing.setMap(i),this.iocDrawing.setTarget(this.drawingReportingContainer),this.stepContainer[0].action=this.iocInput,this.stepContainer[1].action=this.iocForm,this.stepContainer[2].action=this.iocService,this.stepContainer[3].action=this.iocDrawing}setComponentInput(i){this.iocInput=i}setComponentForm(i){this.iocForm=i}setComponentService(i){this.iocService=i}setComponentDrawing(i){this.iocDrawing=i}_addEventsListeners(i){this.eventsListeners["custom:action"]=function(s){logger.trace(s)},i.getLayers().on("some:event",this.eventsListeners["custom:action"])}_removeEventsListeners(){var i=this.getMap();i.getLayers().un("some:event",this.eventsListeners["custom:action"]),delete this.eventsListeners["custom:action"]}setStep(i){if(i!==void 0){for(let l=0;l<this.stepContainer.length;l++){this.stepContainer[l].container.classList.replace("gpf-visible","gpf-hidden");var o=this.stepContainer[l].action;o&&(o.disable(),o.clear())}this.step=i;var s=this.stepContainer[i].container;s.classList.replace("gpf-hidden","gpf-visible");var o=this.stepContainer[i].action;o&&o.active(),this.divReportingTitle.innerHTML=this.stepContainer[i].name,this.panelReportingFooterContainer.style.display=this.stepContainer[i].footer?"flex":"none",this.reportingBtnAnnulerFooter.style.display=this.stepContainer[i].prev===-1?"none":"flex",this.reportingBtnSuivantFooter.style.display=this.stepContainer[i].next===-1?"none":"flex",this.labelReportingIcon.style.display=this.stepContainer[i].prev===-1?"none":"flex"}}nextStep(){var i=this.step,s=this.stepContainer[i].next;if(s!==-1){var o=this.stepContainer[i].action;if(o){var l=o.getData();if(!l)return;logger.trace("Reporting nextStep",l),this.data=Object.assign({},this.data,l),o.disable(),o.clear()}this.setStep(s)}}prevStep(){var i=this.step,s=this.stepContainer[i].prev;if(s!==-1){var o=this.stepContainer[i].action;o&&o.clear(),this.setStep(s)}}clear(){for(let c=0;c<this.stepContainer.length;c++){this.stepContainer[c].container.classList.replace("gpf-visible","gpf-hidden");var i=this.stepContainer[c].action;i&&(i.disable(),i.clear())}var s=this.iocDrawing.Drawing;if(s){var o=s.getLayer(),l=this.getMap();o&&(l.removeLayer(o),s.setLayer())}}onShowReportingClick(i){logger.trace("onShowReportingClick",i);var s=this.buttonReportingShow.ariaPressed;s==="true"&&this.onPanelOpen(),this.collapsed=s!=="true",this.dispatchEvent("change:collapsed"),this.collapsed?this.clear():(this.setStep(0),this.dispatchEvent(this.OPENED_REPORTING_EVENT))}onPrevReportingClick(i){logger.trace("onPrevReportingClick",i),this.prevStep()}onNextReportingClick(i){logger.trace("onNextReportingClick",i),this.nextStep()}onCloseReportingClick(i){logger.trace("onCloseReportingClick",i),this.clear()}onCancelReportingClick(i){logger.trace("onCancelReportingClick",i),this.clear(),this.setStep(0)}onReportingFormSubmit(i){logger.trace("onReportingFormSubmit",i)}onShowFormDrawingReportingClick(i){logger.trace("onShowFormDrawingReportingClick",i),this.setStep(3)}onEntryFormNameReportingChange(i){logger.trace("onEntryFormNameReportingChange",i)}onSelectFormThemeReportingChange(i){logger.trace("onSelectFormThemeReportingChange",i)}onEntryFormDescReportingChange(i){logger.trace("onEntryFormDescReportingChange",i)}onEntrySendMailReportingChange(i){logger.trace("onEntrySendMailReportingChange",i)}onShowSendReportingClick(i){logger.trace("onShowSendReportingClick",i),this.data=Object.assign({},this.data,{mail:i.mail});var s=this.sendReportingContainer.querySelector("#GPreportingSendFieldset"),o=this.sendReportingContainer.querySelector("#GPreportingSendFieldsetMessages");if(i.mail)s.classList.remove("fr-fieldset--error"),o.classList.replace("gpf-visible","gpf-hidden");else{s.classList.add("fr-fieldset--error"),o.classList.replace("gpf-hidden","gpf-visible");return}logger.info("Reporting data to send:",this.data),this.iocService.send(this.data).then(()=>{this.data=null;var l=this.iocDrawing.Drawing;if(l){var c=l.getLayer(),u=this.getMap();c&&(u.removeLayer(c),l.setLayer())}}).then(()=>{this.setStep(0)}).then(()=>{this.dispatchEvent({type:this.SEND_REPORTING_EVENT,data:this.data})}).catch(l=>{this.spanReportingError.classList.replace("gpf-hidden","gpf-visible"),setTimeout(()=>{this.spanReportingError.classList.replace("gpf-visible","gpf-hidden")},5e3),logger.error(l)})}};Mi=new WeakSet,Ji=function(i){this.uid=SelectorID.generate(),this.options={collapsed:!0,draggable:!1,auto:!0,thematics:["Rseau routier","Btiment","Toponyme","Touristique/randonne","Borne cadastrale","Hydrographie","Vgtation","Autre"]},Helper.assign(this.options,i),this.collapsed=this.options.collapsed,this.draggable=this.options.draggable,this.auto=this.options.auto,this.buttonReportingShow=null,this.panelReportingContainer=null,this.panelReportingHeaderContainer=null,this.panelReportingFooterContainer=null,this.reportingBtnAnnulerFooter=null,this.reportingBtnSuivantFooter=null,this.buttonReportingClose=null,this.divReportingTitle=null,this.labelReportingIcon=null,this.buttonReportingSubmit=null,this.spanReportingError=null,this.inputReportingContainer=null,this.formReportingContainer=null,this.sendReportingContainer=null,this.drawingReportingContainer=null,this.step=0,this.stepContainer=[{name:"",footer:!0,header:!0,next:1,prev:-1,action:null,container:null},{name:"Dcrire le signalement",footer:!0,header:!0,next:2,prev:0,action:null,container:null},{name:"Envoyer un signalement",footer:!1,header:!0,next:-1,prev:1,action:null,container:null},{name:"Dessiner sur la carte",footer:!0,header:!0,next:1,prev:1,action:null,container:null}],this.iocInput=null,this.iocForm=null,this.iocService=null,this.iocDrawing=null,this.data=null,this.eventsListeners=[],this.OPENED_REPORTING_EVENT="reporting:opened",this.SEND_REPORTING_EVENT="reporting:sending"},Qi=function(){var i=this._createMainContainerElement(),s=this.buttonReportingShow=this._createShowReportingPictoElement();i.appendChild(s);var o=this.panelReportingContainer=this._createReportingPanelElement(),l=this._createReportingPanelDivElement();o.appendChild(l);var c=this.panelReportingHeaderContainer=this._createReportingPanelHeaderElement(),u=this.labelReportingIcon=this._createReportingPanelIconElement();c.appendChild(u);var f=this.divReportingTitle=this._createReportingPanelTitleElement();c.appendChild(f);var g=this.buttonReportingClose=this._createReportingPanelCloseElement();c.appendChild(g);var H=this.panelReportingFooterContainer=this._createReportingPanelFooterElement(),Y=this.reportingBtnAnnulerFooter=this._createReportingButtonAnnulerFooterElement(),ee=this.reportingBtnSuivantFooter=this._createReportingButtonSuivantFooterElement();H.appendChild(Y),H.appendChild(ee);var te=this.inputReportingContainer=this._createReportingPanelInputElement();this.stepContainer[0].container=te;var ne=this.formReportingContainer=this._createReportingPanelFormElement(this.options.thematics);this.stepContainer[1].container=ne;var Ye=this.sendReportingContainer=this._createReportingPanelSendElement();this.stepContainer[2].container=Ye;var xe=this.drawingReportingContainer=this._createReportingPanelDrawingElement();this.stepContainer[3].container=xe;var tt=this.buttonReportingSubmit=this._createReportingSubmitFormElement();ne.appendChild(tt);var et=this.spanReportingError=this._createReportingErrorSendElement();return Ye.appendChild(et),l.appendChild(c),l.appendChild(te),l.appendChild(ne),l.appendChild(Ye),l.appendChild(xe),l.appendChild(H),i.appendChild(o),logger.log(i),i};let Reporting=Wi;Object.assign(Reporting.prototype,ReportingDOM);Object.assign(Reporting.prototype,Widget);window.ol&&window.ol.control&&(window.ol.control.Reporting=Reporting);var ajv={exports:{}},core$1={},validate={},boolSchema={},errors={},codegen={},code$1={},hasRequiredCode$1;function requireCode$1(){return hasRequiredCode$1||(hasRequiredCode$1=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.regexpCode=n.getEsmExportName=n.getProperty=n.safeStringify=n.stringify=n.strConcat=n.addCodeArg=n.str=n._=n.nil=n._Code=n.Name=n.IDENTIFIER=n._CodeOrName=void 0;class e{}n._CodeOrName=e,n.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class i extends e{constructor(et){if(super(),!n.IDENTIFIER.test(et))throw new Error("CodeGen: name must be a valid identifier");this.str=et}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}n.Name=i;class s extends e{constructor(et){super(),this._items=typeof et=="string"?[et]:et}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const et=this._items[0];return et===""||et==='""'}get str(){var et;return(et=this._str)!==null&&et!==void 0?et:this._str=this._items.reduce((it,rt)=>`${it}${rt}`,"")}get names(){var et;return(et=this._names)!==null&&et!==void 0?et:this._names=this._items.reduce((it,rt)=>(rt instanceof i&&(it[rt.str]=(it[rt.str]||0)+1),it),{})}}n._Code=s,n.nil=new s("");function o(tt,...et){const it=[tt[0]];let rt=0;for(;rt<et.length;)u(it,et[rt]),it.push(tt[++rt]);return new s(it)}n._=o;const l=new s("+");function c(tt,...et){const it=[te(tt[0])];let rt=0;for(;rt<et.length;)it.push(l),u(it,et[rt]),it.push(l,te(tt[++rt]));return f(it),new s(it)}n.str=c;function u(tt,et){et instanceof s?tt.push(...et._items):et instanceof i?tt.push(et):tt.push(Y(et))}n.addCodeArg=u;function f(tt){let et=1;for(;et<tt.length-1;){if(tt[et]===l){const it=g(tt[et-1],tt[et+1]);if(it!==void 0){tt.splice(et-1,3,it);continue}tt[et++]="+"}et++}}function g(tt,et){if(et==='""')return tt;if(tt==='""')return et;if(typeof tt=="string")return et instanceof i||tt[tt.length-1]!=='"'?void 0:typeof et!="string"?`${tt.slice(0,-1)}${et}"`:et[0]==='"'?tt.slice(0,-1)+et.slice(1):void 0;if(typeof et=="string"&&et[0]==='"'&&!(tt instanceof i))return`"${tt}${et.slice(1)}`}function H(tt,et){return et.emptyStr()?tt:tt.emptyStr()?et:c`${tt}${et}`}n.strConcat=H;function Y(tt){return typeof tt=="number"||typeof tt=="boolean"||tt===null?tt:te(Array.isArray(tt)?tt.join(","):tt)}function ee(tt){return new s(te(tt))}n.stringify=ee;function te(tt){return JSON.stringify(tt).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}n.safeStringify=te;function ne(tt){return typeof tt=="string"&&n.IDENTIFIER.test(tt)?new s(`.${tt}`):o`[${tt}]`}n.getProperty=ne;function Ye(tt){if(typeof tt=="string"&&n.IDENTIFIER.test(tt))return new s(`${tt}`);throw new Error(`CodeGen: invalid export name: ${tt}, use explicit $id name mapping`)}n.getEsmExportName=Ye;function xe(tt){return new s(tt.toString())}n.regexpCode=xe})(code$1)),code$1}var scope={},hasRequiredScope;function requireScope(){return hasRequiredScope||(hasRequiredScope=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ValueScope=n.ValueScopeName=n.Scope=n.varKinds=n.UsedValueState=void 0;const e=requireCode$1();class i extends Error{constructor(g){super(`CodeGen: "code" for ${g} not defined`),this.value=g.value}}var s;(function(f){f[f.Started=0]="Started",f[f.Completed=1]="Completed"})(s||(n.UsedValueState=s={})),n.varKinds={const:new e.Name("const"),let:new e.Name("let"),var:new e.Name("var")};class o{constructor({prefixes:g,parent:H}={}){this._names={},this._prefixes=g,this._parent=H}toName(g){return g instanceof e.Name?g:this.name(g)}name(g){return new e.Name(this._newName(g))}_newName(g){const H=this._names[g]||this._nameGroup(g);return`${g}${H.index++}`}_nameGroup(g){var H,Y;if(!((Y=(H=this._parent)===null||H===void 0?void 0:H._prefixes)===null||Y===void 0)&&Y.has(g)||this._prefixes&&!this._prefixes.has(g))throw new Error(`CodeGen: prefix "${g}" is not allowed in this scope`);return this._names[g]={prefix:g,index:0}}}n.Scope=o;class l extends e.Name{constructor(g,H){super(H),this.prefix=g}setValue(g,{property:H,itemIndex:Y}){this.value=g,this.scopePath=(0,e._)`.${new e.Name(H)}[${Y}]`}}n.ValueScopeName=l;const c=(0,e._)`\n`;class u extends o{constructor(g){super(g),this._values={},this._scope=g.scope,this.opts={...g,_n:g.lines?c:e.nil}}get(){return this._scope}name(g){return new l(g,this._newName(g))}value(g,H){var Y;if(H.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const ee=this.toName(g),{prefix:te}=ee,ne=(Y=H.key)!==null&&Y!==void 0?Y:H.ref;let Ye=this._values[te];if(Ye){const et=Ye.get(ne);if(et)return et}else Ye=this._values[te]=new Map;Ye.set(ne,ee);const xe=this._scope[te]||(this._scope[te]=[]),tt=xe.length;return xe[tt]=H.ref,ee.setValue(H,{property:te,itemIndex:tt}),ee}getValue(g,H){const Y=this._values[g];if(Y)return Y.get(H)}scopeRefs(g,H=this._values){return this._reduceValues(H,Y=>{if(Y.scopePath===void 0)throw new Error(`CodeGen: name "${Y}" has no value`);return(0,e._)`${g}${Y.scopePath}`})}scopeCode(g=this._values,H,Y){return this._reduceValues(g,ee=>{if(ee.value===void 0)throw new Error(`CodeGen: name "${ee}" has no value`);return ee.value.code},H,Y)}_reduceValues(g,H,Y={},ee){let te=e.nil;for(const ne in g){const Ye=g[ne];if(!Ye)continue;const xe=Y[ne]=Y[ne]||new Map;Ye.forEach(tt=>{if(xe.has(tt))return;xe.set(tt,s.Started);let et=H(tt);if(et){const it=this.opts.es5?n.varKinds.var:n.varKinds.const;te=(0,e._)`${te}${it} ${tt} = ${et};${this.opts._n}`}else if(et=ee==null?void 0:ee(tt))te=(0,e._)`${te}${et}${this.opts._n}`;else throw new i(tt);xe.set(tt,s.Completed)})}return te}}n.ValueScope=u})(scope)),scope}var hasRequiredCodegen;function requireCodegen(){return hasRequiredCodegen||(hasRequiredCodegen=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.or=n.and=n.not=n.CodeGen=n.operators=n.varKinds=n.ValueScopeName=n.ValueScope=n.Scope=n.Name=n.regexpCode=n.stringify=n.getProperty=n.nil=n.strConcat=n.str=n._=void 0;const e=requireCode$1(),i=requireScope();var s=requireCode$1();Object.defineProperty(n,"_",{enumerable:!0,get:function(){return s._}}),Object.defineProperty(n,"str",{enumerable:!0,get:function(){return s.str}}),Object.defineProperty(n,"strConcat",{enumerable:!0,get:function(){return s.strConcat}}),Object.defineProperty(n,"nil",{enumerable:!0,get:function(){return s.nil}}),Object.defineProperty(n,"getProperty",{enumerable:!0,get:function(){return s.getProperty}}),Object.defineProperty(n,"stringify",{enumerable:!0,get:function(){return s.stringify}}),Object.defineProperty(n,"regexpCode",{enumerable:!0,get:function(){return s.regexpCode}}),Object.defineProperty(n,"Name",{enumerable:!0,get:function(){return s.Name}});var o=requireScope();Object.defineProperty(n,"Scope",{enumerable:!0,get:function(){return o.Scope}}),Object.defineProperty(n,"ValueScope",{enumerable:!0,get:function(){return o.ValueScope}}),Object.defineProperty(n,"ValueScopeName",{enumerable:!0,get:function(){return o.ValueScopeName}}),Object.defineProperty(n,"varKinds",{enumerable:!0,get:function(){return o.varKinds}}),n.operators={GT:new e._Code(">"),GTE:new e._Code(">="),LT:new e._Code("<"),LTE:new e._Code("<="),EQ:new e._Code("==="),NEQ:new e._Code("!=="),NOT:new e._Code("!"),OR:new e._Code("||"),AND:new e._Code("&&"),ADD:new e._Code("+")};class l{optimizeNodes(){return this}optimizeNames(ct,ft){return this}}class c extends l{constructor(ct,ft,bt){super(),this.varKind=ct,this.name=ft,this.rhs=bt}render({es5:ct,_n:ft}){const bt=ct?i.varKinds.var:this.varKind,Ft=this.rhs===void 0?"":` = ${this.rhs}`;return`${bt} ${this.name}${Ft};`+ft}optimizeNames(ct,ft){if(ct[this.name.str])return this.rhs&&(this.rhs=mt(this.rhs,ct,ft)),this}get names(){return this.rhs instanceof e._CodeOrName?this.rhs.names:{}}}class u extends l{constructor(ct,ft,bt){super(),this.lhs=ct,this.rhs=ft,this.sideEffects=bt}render({_n:ct}){return`${this.lhs} = ${this.rhs};`+ct}optimizeNames(ct,ft){if(!(this.lhs instanceof e.Name&&!ct[this.lhs.str]&&!this.sideEffects))return this.rhs=mt(this.rhs,ct,ft),this}get names(){const ct=this.lhs instanceof e.Name?{}:{...this.lhs.names};return yt(ct,this.rhs)}}class f extends u{constructor(ct,ft,bt,Ft){super(ct,bt,Ft),this.op=ft}render({_n:ct}){return`${this.lhs} ${this.op}= ${this.rhs};`+ct}}class g extends l{constructor(ct){super(),this.label=ct,this.names={}}render({_n:ct}){return`${this.label}:`+ct}}class H extends l{constructor(ct){super(),this.label=ct,this.names={}}render({_n:ct}){return`break${this.label?` ${this.label}`:""};`+ct}}class Y extends l{constructor(ct){super(),this.error=ct}render({_n:ct}){return`throw ${this.error};`+ct}get names(){return this.error.names}}class ee extends l{constructor(ct){super(),this.code=ct}render({_n:ct}){return`${this.code};`+ct}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(ct,ft){return this.code=mt(this.code,ct,ft),this}get names(){return this.code instanceof e._CodeOrName?this.code.names:{}}}class te extends l{constructor(ct=[]){super(),this.nodes=ct}render(ct){return this.nodes.reduce((ft,bt)=>ft+bt.render(ct),"")}optimizeNodes(){const{nodes:ct}=this;let ft=ct.length;for(;ft--;){const bt=ct[ft].optimizeNodes();Array.isArray(bt)?ct.splice(ft,1,...bt):bt?ct[ft]=bt:ct.splice(ft,1)}return ct.length>0?this:void 0}optimizeNames(ct,ft){const{nodes:bt}=this;let Ft=bt.length;for(;Ft--;){const Bt=bt[Ft];Bt.optimizeNames(ct,ft)||(St(ct,Bt.names),bt.splice(Ft,1))}return bt.length>0?this:void 0}get names(){return this.nodes.reduce((ct,ft)=>pt(ct,ft.names),{})}}class ne extends te{render(ct){return"{"+ct._n+super.render(ct)+"}"+ct._n}}class Ye extends te{}class xe extends ne{}xe.kind="else";class tt extends ne{constructor(ct,ft){super(ft),this.condition=ct}render(ct){let ft=`if(${this.condition})`+super.render(ct);return this.else&&(ft+="else "+this.else.render(ct)),ft}optimizeNodes(){super.optimizeNodes();const ct=this.condition;if(ct===!0)return this.nodes;let ft=this.else;if(ft){const bt=ft.optimizeNodes();ft=this.else=Array.isArray(bt)?new xe(bt):bt}if(ft)return ct===!1?ft instanceof tt?ft:ft.nodes:this.nodes.length?this:new tt(wt(ct),ft instanceof tt?[ft]:ft.nodes);if(!(ct===!1||!this.nodes.length))return this}optimizeNames(ct,ft){var bt;if(this.else=(bt=this.else)===null||bt===void 0?void 0:bt.optimizeNames(ct,ft),!!(super.optimizeNames(ct,ft)||this.else))return this.condition=mt(this.condition,ct,ft),this}get names(){const ct=super.names;return yt(ct,this.condition),this.else&&pt(ct,this.else.names),ct}}tt.kind="if";class et extends ne{}et.kind="for";class it extends et{constructor(ct){super(),this.iteration=ct}render(ct){return`for(${this.iteration})`+super.render(ct)}optimizeNames(ct,ft){if(super.optimizeNames(ct,ft))return this.iteration=mt(this.iteration,ct,ft),this}get names(){return pt(super.names,this.iteration.names)}}class rt extends et{constructor(ct,ft,bt,Ft){super(),this.varKind=ct,this.name=ft,this.from=bt,this.to=Ft}render(ct){const ft=ct.es5?i.varKinds.var:this.varKind,{name:bt,from:Ft,to:Bt}=this;return`for(${ft} ${bt}=${Ft}; ${bt}<${Bt}; ${bt}++)`+super.render(ct)}get names(){const ct=yt(super.names,this.from);return yt(ct,this.to)}}class nt extends et{constructor(ct,ft,bt,Ft){super(),this.loop=ct,this.varKind=ft,this.name=bt,this.iterable=Ft}render(ct){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(ct)}optimizeNames(ct,ft){if(super.optimizeNames(ct,ft))return this.iterable=mt(this.iterable,ct,ft),this}get names(){return pt(super.names,this.iterable.names)}}class at extends ne{constructor(ct,ft,bt){super(),this.name=ct,this.args=ft,this.async=bt}render(ct){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(ct)}}at.kind="func";class st extends te{render(ct){return"return "+super.render(ct)}}st.kind="return";class ot extends ne{render(ct){let ft="try"+super.render(ct);return this.catch&&(ft+=this.catch.render(ct)),this.finally&&(ft+=this.finally.render(ct)),ft}optimizeNodes(){var ct,ft;return super.optimizeNodes(),(ct=this.catch)===null||ct===void 0||ct.optimizeNodes(),(ft=this.finally)===null||ft===void 0||ft.optimizeNodes(),this}optimizeNames(ct,ft){var bt,Ft;return super.optimizeNames(ct,ft),(bt=this.catch)===null||bt===void 0||bt.optimizeNames(ct,ft),(Ft=this.finally)===null||Ft===void 0||Ft.optimizeNames(ct,ft),this}get names(){const ct=super.names;return this.catch&&pt(ct,this.catch.names),this.finally&&pt(ct,this.finally.names),ct}}class ut extends ne{constructor(ct){super(),this.error=ct}render(ct){return`catch(${this.error})`+super.render(ct)}}ut.kind="catch";class ht extends ne{render(ct){return"finally"+super.render(ct)}}ht.kind="finally";class dt{constructor(ct,ft={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...ft,_n:ft.lines?`
`:""},this._extScope=ct,this._scope=new i.Scope({parent:ct}),this._nodes=[new Ye]}toString(){return this._root.render(this.opts)}name(ct){return this._scope.name(ct)}scopeName(ct){return this._extScope.name(ct)}scopeValue(ct,ft){const bt=this._extScope.value(ct,ft);return(this._values[bt.prefix]||(this._values[bt.prefix]=new Set)).add(bt),bt}getScopeValue(ct,ft){return this._extScope.getValue(ct,ft)}scopeRefs(ct){return this._extScope.scopeRefs(ct,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(ct,ft,bt,Ft){const Bt=this._scope.toName(ft);return bt!==void 0&&Ft&&(this._constants[Bt.str]=bt),this._leafNode(new c(ct,Bt,bt)),Bt}const(ct,ft,bt){return this._def(i.varKinds.const,ct,ft,bt)}let(ct,ft,bt){return this._def(i.varKinds.let,ct,ft,bt)}var(ct,ft,bt){return this._def(i.varKinds.var,ct,ft,bt)}assign(ct,ft,bt){return this._leafNode(new u(ct,ft,bt))}add(ct,ft){return this._leafNode(new f(ct,n.operators.ADD,ft))}code(ct){return typeof ct=="function"?ct():ct!==e.nil&&this._leafNode(new ee(ct)),this}object(...ct){const ft=["{"];for(const[bt,Ft]of ct)ft.length>1&&ft.push(","),ft.push(bt),(bt!==Ft||this.opts.es5)&&(ft.push(":"),(0,e.addCodeArg)(ft,Ft));return ft.push("}"),new e._Code(ft)}if(ct,ft,bt){if(this._blockNode(new tt(ct)),ft&&bt)this.code(ft).else().code(bt).endIf();else if(ft)this.code(ft).endIf();else if(bt)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(ct){return this._elseNode(new tt(ct))}else(){return this._elseNode(new xe)}endIf(){return this._endBlockNode(tt,xe)}_for(ct,ft){return this._blockNode(ct),ft&&this.code(ft).endFor(),this}for(ct,ft){return this._for(new it(ct),ft)}forRange(ct,ft,bt,Ft,Bt=this.opts.es5?i.varKinds.var:i.varKinds.let){const Xt=this._scope.toName(ct);return this._for(new rt(Bt,Xt,ft,bt),()=>Ft(Xt))}forOf(ct,ft,bt,Ft=i.varKinds.const){const Bt=this._scope.toName(ct);if(this.opts.es5){const Xt=ft instanceof e.Name?ft:this.var("_arr",ft);return this.forRange("_i",0,(0,e._)`${Xt}.length`,Ot=>{this.var(Bt,(0,e._)`${Xt}[${Ot}]`),bt(Bt)})}return this._for(new nt("of",Ft,Bt,ft),()=>bt(Bt))}forIn(ct,ft,bt,Ft=this.opts.es5?i.varKinds.var:i.varKinds.const){if(this.opts.ownProperties)return this.forOf(ct,(0,e._)`Object.keys(${ft})`,bt);const Bt=this._scope.toName(ct);return this._for(new nt("in",Ft,Bt,ft),()=>bt(Bt))}endFor(){return this._endBlockNode(et)}label(ct){return this._leafNode(new g(ct))}break(ct){return this._leafNode(new H(ct))}return(ct){const ft=new st;if(this._blockNode(ft),this.code(ct),ft.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(st)}try(ct,ft,bt){if(!ft&&!bt)throw new Error('CodeGen: "try" without "catch" and "finally"');const Ft=new ot;if(this._blockNode(Ft),this.code(ct),ft){const Bt=this.name("e");this._currNode=Ft.catch=new ut(Bt),ft(Bt)}return bt&&(this._currNode=Ft.finally=new ht,this.code(bt)),this._endBlockNode(ut,ht)}throw(ct){return this._leafNode(new Y(ct))}block(ct,ft){return this._blockStarts.push(this._nodes.length),ct&&this.code(ct).endBlock(ft),this}endBlock(ct){const ft=this._blockStarts.pop();if(ft===void 0)throw new Error("CodeGen: not in self-balancing block");const bt=this._nodes.length-ft;if(bt<0||ct!==void 0&&bt!==ct)throw new Error(`CodeGen: wrong number of nodes: ${bt} vs ${ct} expected`);return this._nodes.length=ft,this}func(ct,ft=e.nil,bt,Ft){return this._blockNode(new at(ct,ft,bt)),Ft&&this.code(Ft).endFunc(),this}endFunc(){return this._endBlockNode(at)}optimize(ct=1){for(;ct-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(ct){return this._currNode.nodes.push(ct),this}_blockNode(ct){this._currNode.nodes.push(ct),this._nodes.push(ct)}_endBlockNode(ct,ft){const bt=this._currNode;if(bt instanceof ct||ft&&bt instanceof ft)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${ft?`${ct.kind}/${ft.kind}`:ct.kind}"`)}_elseNode(ct){const ft=this._currNode;if(!(ft instanceof tt))throw new Error('CodeGen: "else" without "if"');return this._currNode=ft.else=ct,this}get _root(){return this._nodes[0]}get _currNode(){const ct=this._nodes;return ct[ct.length-1]}set _currNode(ct){const ft=this._nodes;ft[ft.length-1]=ct}}n.CodeGen=dt;function pt(Ct,ct){for(const ft in ct)Ct[ft]=(Ct[ft]||0)+(ct[ft]||0);return Ct}function yt(Ct,ct){return ct instanceof e._CodeOrName?pt(Ct,ct.names):Ct}function mt(Ct,ct,ft){if(Ct instanceof e.Name)return bt(Ct);if(!Ft(Ct))return Ct;return new e._Code(Ct._items.reduce((Bt,Xt)=>(Xt instanceof e.Name&&(Xt=bt(Xt)),Xt instanceof e._Code?Bt.push(...Xt._items):Bt.push(Xt),Bt),[]));function bt(Bt){const Xt=ft[Bt.str];return Xt===void 0||ct[Bt.str]!==1?Bt:(delete ct[Bt.str],Xt)}function Ft(Bt){return Bt instanceof e._Code&&Bt._items.some(Xt=>Xt instanceof e.Name&&ct[Xt.str]===1&&ft[Xt.str]!==void 0)}}function St(Ct,ct){for(const ft in ct)Ct[ft]=(Ct[ft]||0)-(ct[ft]||0)}function wt(Ct){return typeof Ct=="boolean"||typeof Ct=="number"||Ct===null?!Ct:(0,e._)`!${_t(Ct)}`}n.not=wt;const Rt=Et(n.operators.AND);function Lt(...Ct){return Ct.reduce(Rt)}n.and=Lt;const Gt=Et(n.operators.OR);function vt(...Ct){return Ct.reduce(Gt)}n.or=vt;function Et(Ct){return(ct,ft)=>ct===e.nil?ft:ft===e.nil?ct:(0,e._)`${_t(ct)} ${Ct} ${_t(ft)}`}function _t(Ct){return Ct instanceof e.Name?Ct:(0,e._)`(${Ct})`}})(codegen)),codegen}var util={},hasRequiredUtil;function requireUtil(){if(hasRequiredUtil)return util;hasRequiredUtil=1,Object.defineProperty(util,"__esModule",{value:!0}),util.checkStrictMode=util.getErrorPath=util.Type=util.useFunc=util.setEvaluated=util.evaluatedPropsToName=util.mergeEvaluated=util.eachItem=util.unescapeJsonPointer=util.escapeJsonPointer=util.escapeFragment=util.unescapeFragment=util.schemaRefOrVal=util.schemaHasRulesButRef=util.schemaHasRules=util.checkUnknownRules=util.alwaysValidSchema=util.toHash=void 0;const n=requireCodegen(),e=requireCode$1();function i(nt){const at={};for(const st of nt)at[st]=!0;return at}util.toHash=i;function s(nt,at){return typeof at=="boolean"?at:Object.keys(at).length===0?!0:(o(nt,at),!l(at,nt.self.RULES.all))}util.alwaysValidSchema=s;function o(nt,at=nt.schema){const{opts:st,self:ot}=nt;if(!st.strictSchema||typeof at=="boolean")return;const ut=ot.RULES.keywords;for(const ht in at)ut[ht]||rt(nt,`unknown keyword: "${ht}"`)}util.checkUnknownRules=o;function l(nt,at){if(typeof nt=="boolean")return!nt;for(const st in nt)if(at[st])return!0;return!1}util.schemaHasRules=l;function c(nt,at){if(typeof nt=="boolean")return!nt;for(const st in nt)if(st!=="$ref"&&at.all[st])return!0;return!1}util.schemaHasRulesButRef=c;function u({topSchemaRef:nt,schemaPath:at},st,ot,ut){if(!ut){if(typeof st=="number"||typeof st=="boolean")return st;if(typeof st=="string")return(0,n._)`${st}`}return(0,n._)`${nt}${at}${(0,n.getProperty)(ot)}`}util.schemaRefOrVal=u;function f(nt){return Y(decodeURIComponent(nt))}util.unescapeFragment=f;function g(nt){return encodeURIComponent(H(nt))}util.escapeFragment=g;function H(nt){return typeof nt=="number"?`${nt}`:nt.replace(/~/g,"~0").replace(/\//g,"~1")}util.escapeJsonPointer=H;function Y(nt){return nt.replace(/~1/g,"/").replace(/~0/g,"~")}util.unescapeJsonPointer=Y;function ee(nt,at){if(Array.isArray(nt))for(const st of nt)at(st);else at(nt)}util.eachItem=ee;function te({mergeNames:nt,mergeToName:at,mergeValues:st,resultToName:ot}){return(ut,ht,dt,pt)=>{const yt=dt===void 0?ht:dt instanceof n.Name?(ht instanceof n.Name?nt(ut,ht,dt):at(ut,ht,dt),dt):ht instanceof n.Name?(at(ut,dt,ht),ht):st(ht,dt);return pt===n.Name&&!(yt instanceof n.Name)?ot(ut,yt):yt}}util.mergeEvaluated={props:te({mergeNames:(nt,at,st)=>nt.if((0,n._)`${st} !== true && ${at} !== undefined`,()=>{nt.if((0,n._)`${at} === true`,()=>nt.assign(st,!0),()=>nt.assign(st,(0,n._)`${st} || {}`).code((0,n._)`Object.assign(${st}, ${at})`))}),mergeToName:(nt,at,st)=>nt.if((0,n._)`${st} !== true`,()=>{at===!0?nt.assign(st,!0):(nt.assign(st,(0,n._)`${st} || {}`),Ye(nt,st,at))}),mergeValues:(nt,at)=>nt===!0?!0:{...nt,...at},resultToName:ne}),items:te({mergeNames:(nt,at,st)=>nt.if((0,n._)`${st} !== true && ${at} !== undefined`,()=>nt.assign(st,(0,n._)`${at} === true ? true : ${st} > ${at} ? ${st} : ${at}`)),mergeToName:(nt,at,st)=>nt.if((0,n._)`${st} !== true`,()=>nt.assign(st,at===!0?!0:(0,n._)`${st} > ${at} ? ${st} : ${at}`)),mergeValues:(nt,at)=>nt===!0?!0:Math.max(nt,at),resultToName:(nt,at)=>nt.var("items",at)})};function ne(nt,at){if(at===!0)return nt.var("props",!0);const st=nt.var("props",(0,n._)`{}`);return at!==void 0&&Ye(nt,st,at),st}util.evaluatedPropsToName=ne;function Ye(nt,at,st){Object.keys(st).forEach(ot=>nt.assign((0,n._)`${at}${(0,n.getProperty)(ot)}`,!0))}util.setEvaluated=Ye;const xe={};function tt(nt,at){return nt.scopeValue("func",{ref:at,code:xe[at.code]||(xe[at.code]=new e._Code(at.code))})}util.useFunc=tt;var et;(function(nt){nt[nt.Num=0]="Num",nt[nt.Str=1]="Str"})(et||(util.Type=et={}));function it(nt,at,st){if(nt instanceof n.Name){const ot=at===et.Num;return st?ot?(0,n._)`"[" + ${nt} + "]"`:(0,n._)`"['" + ${nt} + "']"`:ot?(0,n._)`"/" + ${nt}`:(0,n._)`"/" + ${nt}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return st?(0,n.getProperty)(nt).toString():"/"+H(nt)}util.getErrorPath=it;function rt(nt,at,st=nt.opts.strictSchema){if(st){if(at=`strict mode: ${at}`,st===!0)throw new Error(at);nt.self.logger.warn(at)}}return util.checkStrictMode=rt,util}var names={},hasRequiredNames;function requireNames(){if(hasRequiredNames)return names;hasRequiredNames=1,Object.defineProperty(names,"__esModule",{value:!0});const n=requireCodegen(),e={data:new n.Name("data"),valCxt:new n.Name("valCxt"),instancePath:new n.Name("instancePath"),parentData:new n.Name("parentData"),parentDataProperty:new n.Name("parentDataProperty"),rootData:new n.Name("rootData"),dynamicAnchors:new n.Name("dynamicAnchors"),vErrors:new n.Name("vErrors"),errors:new n.Name("errors"),this:new n.Name("this"),self:new n.Name("self"),scope:new n.Name("scope"),json:new n.Name("json"),jsonPos:new n.Name("jsonPos"),jsonLen:new n.Name("jsonLen"),jsonPart:new n.Name("jsonPart")};return names.default=e,names}var hasRequiredErrors;function requireErrors(){return hasRequiredErrors||(hasRequiredErrors=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.extendErrors=n.resetErrorsCount=n.reportExtraError=n.reportError=n.keyword$DataError=n.keywordError=void 0;const e=requireCodegen(),i=requireUtil(),s=requireNames();n.keywordError={message:({keyword:xe})=>(0,e.str)`must pass "${xe}" keyword validation`},n.keyword$DataError={message:({keyword:xe,schemaType:tt})=>tt?(0,e.str)`"${xe}" keyword must be ${tt} ($data)`:(0,e.str)`"${xe}" keyword is invalid ($data)`};function o(xe,tt=n.keywordError,et,it){const{it:rt}=xe,{gen:nt,compositeRule:at,allErrors:st}=rt,ot=Y(xe,tt,et);it??(at||st)?f(nt,ot):g(rt,(0,e._)`[${ot}]`)}n.reportError=o;function l(xe,tt=n.keywordError,et){const{it}=xe,{gen:rt,compositeRule:nt,allErrors:at}=it,st=Y(xe,tt,et);f(rt,st),nt||at||g(it,s.default.vErrors)}n.reportExtraError=l;function c(xe,tt){xe.assign(s.default.errors,tt),xe.if((0,e._)`${s.default.vErrors} !== null`,()=>xe.if(tt,()=>xe.assign((0,e._)`${s.default.vErrors}.length`,tt),()=>xe.assign(s.default.vErrors,null)))}n.resetErrorsCount=c;function u({gen:xe,keyword:tt,schemaValue:et,data:it,errsCount:rt,it:nt}){if(rt===void 0)throw new Error("ajv implementation error");const at=xe.name("err");xe.forRange("i",rt,s.default.errors,st=>{xe.const(at,(0,e._)`${s.default.vErrors}[${st}]`),xe.if((0,e._)`${at}.instancePath === undefined`,()=>xe.assign((0,e._)`${at}.instancePath`,(0,e.strConcat)(s.default.instancePath,nt.errorPath))),xe.assign((0,e._)`${at}.schemaPath`,(0,e.str)`${nt.errSchemaPath}/${tt}`),nt.opts.verbose&&(xe.assign((0,e._)`${at}.schema`,et),xe.assign((0,e._)`${at}.data`,it))})}n.extendErrors=u;function f(xe,tt){const et=xe.const("err",tt);xe.if((0,e._)`${s.default.vErrors} === null`,()=>xe.assign(s.default.vErrors,(0,e._)`[${et}]`),(0,e._)`${s.default.vErrors}.push(${et})`),xe.code((0,e._)`${s.default.errors}++`)}function g(xe,tt){const{gen:et,validateName:it,schemaEnv:rt}=xe;rt.$async?et.throw((0,e._)`new ${xe.ValidationError}(${tt})`):(et.assign((0,e._)`${it}.errors`,tt),et.return(!1))}const H={keyword:new e.Name("keyword"),schemaPath:new e.Name("schemaPath"),params:new e.Name("params"),propertyName:new e.Name("propertyName"),message:new e.Name("message"),schema:new e.Name("schema"),parentSchema:new e.Name("parentSchema")};function Y(xe,tt,et){const{createErrors:it}=xe.it;return it===!1?(0,e._)`{}`:ee(xe,tt,et)}function ee(xe,tt,et={}){const{gen:it,it:rt}=xe,nt=[te(rt,et),ne(xe,et)];return Ye(xe,tt,nt),it.object(...nt)}function te({errorPath:xe},{instancePath:tt}){const et=tt?(0,e.str)`${xe}${(0,i.getErrorPath)(tt,i.Type.Str)}`:xe;return[s.default.instancePath,(0,e.strConcat)(s.default.instancePath,et)]}function ne({keyword:xe,it:{errSchemaPath:tt}},{schemaPath:et,parentSchema:it}){let rt=it?tt:(0,e.str)`${tt}/${xe}`;return et&&(rt=(0,e.str)`${rt}${(0,i.getErrorPath)(et,i.Type.Str)}`),[H.schemaPath,rt]}function Ye(xe,{params:tt,message:et},it){const{keyword:rt,data:nt,schemaValue:at,it:st}=xe,{opts:ot,propertyName:ut,topSchemaRef:ht,schemaPath:dt}=st;it.push([H.keyword,rt],[H.params,typeof tt=="function"?tt(xe):tt||(0,e._)`{}`]),ot.messages&&it.push([H.message,typeof et=="function"?et(xe):et]),ot.verbose&&it.push([H.schema,at],[H.parentSchema,(0,e._)`${ht}${dt}`],[s.default.data,nt]),ut&&it.push([H.propertyName,ut])}})(errors)),errors}var hasRequiredBoolSchema;function requireBoolSchema(){if(hasRequiredBoolSchema)return boolSchema;hasRequiredBoolSchema=1,Object.defineProperty(boolSchema,"__esModule",{value:!0}),boolSchema.boolOrEmptySchema=boolSchema.topBoolOrEmptySchema=void 0;const n=requireErrors(),e=requireCodegen(),i=requireNames(),s={message:"boolean schema is false"};function o(u){const{gen:f,schema:g,validateName:H}=u;g===!1?c(u,!1):typeof g=="object"&&g.$async===!0?f.return(i.default.data):(f.assign((0,e._)`${H}.errors`,null),f.return(!0))}boolSchema.topBoolOrEmptySchema=o;function l(u,f){const{gen:g,schema:H}=u;H===!1?(g.var(f,!1),c(u)):g.var(f,!0)}boolSchema.boolOrEmptySchema=l;function c(u,f){const{gen:g,data:H}=u,Y={gen:g,keyword:"false schema",data:H,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:u};(0,n.reportError)(Y,s,void 0,f)}return boolSchema}var dataType={},rules={},hasRequiredRules;function requireRules(){if(hasRequiredRules)return rules;hasRequiredRules=1,Object.defineProperty(rules,"__esModule",{value:!0}),rules.getRules=rules.isJSONType=void 0;const n=["string","number","integer","boolean","null","object","array"],e=new Set(n);function i(o){return typeof o=="string"&&e.has(o)}rules.isJSONType=i;function s(){const o={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...o,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},o.number,o.string,o.array,o.object],post:{rules:[]},all:{},keywords:{}}}return rules.getRules=s,rules}var applicability={},hasRequiredApplicability;function requireApplicability(){if(hasRequiredApplicability)return applicability;hasRequiredApplicability=1,Object.defineProperty(applicability,"__esModule",{value:!0}),applicability.shouldUseRule=applicability.shouldUseGroup=applicability.schemaHasRulesForType=void 0;function n({schema:s,self:o},l){const c=o.RULES.types[l];return c&&c!==!0&&e(s,c)}applicability.schemaHasRulesForType=n;function e(s,o){return o.rules.some(l=>i(s,l))}applicability.shouldUseGroup=e;function i(s,o){var l;return s[o.keyword]!==void 0||((l=o.definition.implements)===null||l===void 0?void 0:l.some(c=>s[c]!==void 0))}return applicability.shouldUseRule=i,applicability}var hasRequiredDataType;function requireDataType(){if(hasRequiredDataType)return dataType;hasRequiredDataType=1,Object.defineProperty(dataType,"__esModule",{value:!0}),dataType.reportTypeError=dataType.checkDataTypes=dataType.checkDataType=dataType.coerceAndCheckDataType=dataType.getJSONTypes=dataType.getSchemaTypes=dataType.DataType=void 0;const n=requireRules(),e=requireApplicability(),i=requireErrors(),s=requireCodegen(),o=requireUtil();var l;(function(et){et[et.Correct=0]="Correct",et[et.Wrong=1]="Wrong"})(l||(dataType.DataType=l={}));function c(et){const it=u(et.type);if(it.includes("null")){if(et.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!it.length&&et.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');et.nullable===!0&&it.push("null")}return it}dataType.getSchemaTypes=c;function u(et){const it=Array.isArray(et)?et:et?[et]:[];if(it.every(n.isJSONType))return it;throw new Error("type must be JSONType or JSONType[]: "+it.join(","))}dataType.getJSONTypes=u;function f(et,it){const{gen:rt,data:nt,opts:at}=et,st=H(it,at.coerceTypes),ot=it.length>0&&!(st.length===0&&it.length===1&&(0,e.schemaHasRulesForType)(et,it[0]));if(ot){const ut=ne(it,nt,at.strictNumbers,l.Wrong);rt.if(ut,()=>{st.length?Y(et,it,st):xe(et)})}return ot}dataType.coerceAndCheckDataType=f;const g=new Set(["string","number","integer","boolean","null"]);function H(et,it){return it?et.filter(rt=>g.has(rt)||it==="array"&&rt==="array"):[]}function Y(et,it,rt){const{gen:nt,data:at,opts:st}=et,ot=nt.let("dataType",(0,s._)`typeof ${at}`),ut=nt.let("coerced",(0,s._)`undefined`);st.coerceTypes==="array"&&nt.if((0,s._)`${ot} == 'object' && Array.isArray(${at}) && ${at}.length == 1`,()=>nt.assign(at,(0,s._)`${at}[0]`).assign(ot,(0,s._)`typeof ${at}`).if(ne(it,at,st.strictNumbers),()=>nt.assign(ut,at))),nt.if((0,s._)`${ut} !== undefined`);for(const dt of rt)(g.has(dt)||dt==="array"&&st.coerceTypes==="array")&&ht(dt);nt.else(),xe(et),nt.endIf(),nt.if((0,s._)`${ut} !== undefined`,()=>{nt.assign(at,ut),ee(et,ut)});function ht(dt){switch(dt){case"string":nt.elseIf((0,s._)`${ot} == "number" || ${ot} == "boolean"`).assign(ut,(0,s._)`"" + ${at}`).elseIf((0,s._)`${at} === null`).assign(ut,(0,s._)`""`);return;case"number":nt.elseIf((0,s._)`${ot} == "boolean" || ${at} === null
              || (${ot} == "string" && ${at} && ${at} == +${at})`).assign(ut,(0,s._)`+${at}`);return;case"integer":nt.elseIf((0,s._)`${ot} === "boolean" || ${at} === null
              || (${ot} === "string" && ${at} && ${at} == +${at} && !(${at} % 1))`).assign(ut,(0,s._)`+${at}`);return;case"boolean":nt.elseIf((0,s._)`${at} === "false" || ${at} === 0 || ${at} === null`).assign(ut,!1).elseIf((0,s._)`${at} === "true" || ${at} === 1`).assign(ut,!0);return;case"null":nt.elseIf((0,s._)`${at} === "" || ${at} === 0 || ${at} === false`),nt.assign(ut,null);return;case"array":nt.elseIf((0,s._)`${ot} === "string" || ${ot} === "number"
              || ${ot} === "boolean" || ${at} === null`).assign(ut,(0,s._)`[${at}]`)}}}function ee({gen:et,parentData:it,parentDataProperty:rt},nt){et.if((0,s._)`${it} !== undefined`,()=>et.assign((0,s._)`${it}[${rt}]`,nt))}function te(et,it,rt,nt=l.Correct){const at=nt===l.Correct?s.operators.EQ:s.operators.NEQ;let st;switch(et){case"null":return(0,s._)`${it} ${at} null`;case"array":st=(0,s._)`Array.isArray(${it})`;break;case"object":st=(0,s._)`${it} && typeof ${it} == "object" && !Array.isArray(${it})`;break;case"integer":st=ot((0,s._)`!(${it} % 1) && !isNaN(${it})`);break;case"number":st=ot();break;default:return(0,s._)`typeof ${it} ${at} ${et}`}return nt===l.Correct?st:(0,s.not)(st);function ot(ut=s.nil){return(0,s.and)((0,s._)`typeof ${it} == "number"`,ut,rt?(0,s._)`isFinite(${it})`:s.nil)}}dataType.checkDataType=te;function ne(et,it,rt,nt){if(et.length===1)return te(et[0],it,rt,nt);let at;const st=(0,o.toHash)(et);if(st.array&&st.object){const ot=(0,s._)`typeof ${it} != "object"`;at=st.null?ot:(0,s._)`!${it} || ${ot}`,delete st.null,delete st.array,delete st.object}else at=s.nil;st.number&&delete st.integer;for(const ot in st)at=(0,s.and)(at,te(ot,it,rt,nt));return at}dataType.checkDataTypes=ne;const Ye={message:({schema:et})=>`must be ${et}`,params:({schema:et,schemaValue:it})=>typeof et=="string"?(0,s._)`{type: ${et}}`:(0,s._)`{type: ${it}}`};function xe(et){const it=tt(et);(0,i.reportError)(it,Ye)}dataType.reportTypeError=xe;function tt(et){const{gen:it,data:rt,schema:nt}=et,at=(0,o.schemaRefOrVal)(et,nt,"type");return{gen:it,keyword:"type",data:rt,schema:nt.type,schemaCode:at,schemaValue:at,parentSchema:nt,params:{},it:et}}return dataType}var defaults={},hasRequiredDefaults;function requireDefaults(){if(hasRequiredDefaults)return defaults;hasRequiredDefaults=1,Object.defineProperty(defaults,"__esModule",{value:!0}),defaults.assignDefaults=void 0;const n=requireCodegen(),e=requireUtil();function i(o,l){const{properties:c,items:u}=o.schema;if(l==="object"&&c)for(const f in c)s(o,f,c[f].default);else l==="array"&&Array.isArray(u)&&u.forEach((f,g)=>s(o,g,f.default))}defaults.assignDefaults=i;function s(o,l,c){const{gen:u,compositeRule:f,data:g,opts:H}=o;if(c===void 0)return;const Y=(0,n._)`${g}${(0,n.getProperty)(l)}`;if(f){(0,e.checkStrictMode)(o,`default is ignored for: ${Y}`);return}let ee=(0,n._)`${Y} === undefined`;H.useDefaults==="empty"&&(ee=(0,n._)`${ee} || ${Y} === null || ${Y} === ""`),u.if(ee,(0,n._)`${Y} = ${(0,n.stringify)(c)}`)}return defaults}var keyword={},code={},hasRequiredCode;function requireCode(){if(hasRequiredCode)return code;hasRequiredCode=1,Object.defineProperty(code,"__esModule",{value:!0}),code.validateUnion=code.validateArray=code.usePattern=code.callValidateCode=code.schemaProperties=code.allSchemaProperties=code.noPropertyInData=code.propertyInData=code.isOwnProperty=code.hasPropFunc=code.reportMissingProp=code.checkMissingProp=code.checkReportMissingProp=void 0;const n=requireCodegen(),e=requireUtil(),i=requireNames(),s=requireUtil();function o(et,it){const{gen:rt,data:nt,it:at}=et;rt.if(H(rt,nt,it,at.opts.ownProperties),()=>{et.setParams({missingProperty:(0,n._)`${it}`},!0),et.error()})}code.checkReportMissingProp=o;function l({gen:et,data:it,it:{opts:rt}},nt,at){return(0,n.or)(...nt.map(st=>(0,n.and)(H(et,it,st,rt.ownProperties),(0,n._)`${at} = ${st}`)))}code.checkMissingProp=l;function c(et,it){et.setParams({missingProperty:it},!0),et.error()}code.reportMissingProp=c;function u(et){return et.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,n._)`Object.prototype.hasOwnProperty`})}code.hasPropFunc=u;function f(et,it,rt){return(0,n._)`${u(et)}.call(${it}, ${rt})`}code.isOwnProperty=f;function g(et,it,rt,nt){const at=(0,n._)`${it}${(0,n.getProperty)(rt)} !== undefined`;return nt?(0,n._)`${at} && ${f(et,it,rt)}`:at}code.propertyInData=g;function H(et,it,rt,nt){const at=(0,n._)`${it}${(0,n.getProperty)(rt)} === undefined`;return nt?(0,n.or)(at,(0,n.not)(f(et,it,rt))):at}code.noPropertyInData=H;function Y(et){return et?Object.keys(et).filter(it=>it!=="__proto__"):[]}code.allSchemaProperties=Y;function ee(et,it){return Y(it).filter(rt=>!(0,e.alwaysValidSchema)(et,it[rt]))}code.schemaProperties=ee;function te({schemaCode:et,data:it,it:{gen:rt,topSchemaRef:nt,schemaPath:at,errorPath:st},it:ot},ut,ht,dt){const pt=dt?(0,n._)`${et}, ${it}, ${nt}${at}`:it,yt=[[i.default.instancePath,(0,n.strConcat)(i.default.instancePath,st)],[i.default.parentData,ot.parentData],[i.default.parentDataProperty,ot.parentDataProperty],[i.default.rootData,i.default.rootData]];ot.opts.dynamicRef&&yt.push([i.default.dynamicAnchors,i.default.dynamicAnchors]);const mt=(0,n._)`${pt}, ${rt.object(...yt)}`;return ht!==n.nil?(0,n._)`${ut}.call(${ht}, ${mt})`:(0,n._)`${ut}(${mt})`}code.callValidateCode=te;const ne=(0,n._)`new RegExp`;function Ye({gen:et,it:{opts:it}},rt){const nt=it.unicodeRegExp?"u":"",{regExp:at}=it.code,st=at(rt,nt);return et.scopeValue("pattern",{key:st.toString(),ref:st,code:(0,n._)`${at.code==="new RegExp"?ne:(0,s.useFunc)(et,at)}(${rt}, ${nt})`})}code.usePattern=Ye;function xe(et){const{gen:it,data:rt,keyword:nt,it:at}=et,st=it.name("valid");if(at.allErrors){const ut=it.let("valid",!0);return ot(()=>it.assign(ut,!1)),ut}return it.var(st,!0),ot(()=>it.break()),st;function ot(ut){const ht=it.const("len",(0,n._)`${rt}.length`);it.forRange("i",0,ht,dt=>{et.subschema({keyword:nt,dataProp:dt,dataPropType:e.Type.Num},st),it.if((0,n.not)(st),ut)})}}code.validateArray=xe;function tt(et){const{gen:it,schema:rt,keyword:nt,it:at}=et;if(!Array.isArray(rt))throw new Error("ajv implementation error");if(rt.some(ht=>(0,e.alwaysValidSchema)(at,ht))&&!at.opts.unevaluated)return;const ot=it.let("valid",!1),ut=it.name("_valid");it.block(()=>rt.forEach((ht,dt)=>{const pt=et.subschema({keyword:nt,schemaProp:dt,compositeRule:!0},ut);it.assign(ot,(0,n._)`${ot} || ${ut}`),et.mergeValidEvaluated(pt,ut)||it.if((0,n.not)(ot))})),et.result(ot,()=>et.reset(),()=>et.error(!0))}return code.validateUnion=tt,code}var hasRequiredKeyword;function requireKeyword(){if(hasRequiredKeyword)return keyword;hasRequiredKeyword=1,Object.defineProperty(keyword,"__esModule",{value:!0}),keyword.validateKeywordUsage=keyword.validSchemaType=keyword.funcKeywordCode=keyword.macroKeywordCode=void 0;const n=requireCodegen(),e=requireNames(),i=requireCode(),s=requireErrors();function o(ee,te){const{gen:ne,keyword:Ye,schema:xe,parentSchema:tt,it:et}=ee,it=te.macro.call(et.self,xe,tt,et),rt=g(ne,Ye,it);et.opts.validateSchema!==!1&&et.self.validateSchema(it,!0);const nt=ne.name("valid");ee.subschema({schema:it,schemaPath:n.nil,errSchemaPath:`${et.errSchemaPath}/${Ye}`,topSchemaRef:rt,compositeRule:!0},nt),ee.pass(nt,()=>ee.error(!0))}keyword.macroKeywordCode=o;function l(ee,te){var ne;const{gen:Ye,keyword:xe,schema:tt,parentSchema:et,$data:it,it:rt}=ee;f(rt,te);const nt=!it&&te.compile?te.compile.call(rt.self,tt,et,rt):te.validate,at=g(Ye,xe,nt),st=Ye.let("valid");ee.block$data(st,ot),ee.ok((ne=te.valid)!==null&&ne!==void 0?ne:st);function ot(){if(te.errors===!1)dt(),te.modifying&&c(ee),pt(()=>ee.error());else{const yt=te.async?ut():ht();te.modifying&&c(ee),pt(()=>u(ee,yt))}}function ut(){const yt=Ye.let("ruleErrs",null);return Ye.try(()=>dt((0,n._)`await `),mt=>Ye.assign(st,!1).if((0,n._)`${mt} instanceof ${rt.ValidationError}`,()=>Ye.assign(yt,(0,n._)`${mt}.errors`),()=>Ye.throw(mt))),yt}function ht(){const yt=(0,n._)`${at}.errors`;return Ye.assign(yt,null),dt(n.nil),yt}function dt(yt=te.async?(0,n._)`await `:n.nil){const mt=rt.opts.passContext?e.default.this:e.default.self,St=!("compile"in te&&!it||te.schema===!1);Ye.assign(st,(0,n._)`${yt}${(0,i.callValidateCode)(ee,at,mt,St)}`,te.modifying)}function pt(yt){var mt;Ye.if((0,n.not)((mt=te.valid)!==null&&mt!==void 0?mt:st),yt)}}keyword.funcKeywordCode=l;function c(ee){const{gen:te,data:ne,it:Ye}=ee;te.if(Ye.parentData,()=>te.assign(ne,(0,n._)`${Ye.parentData}[${Ye.parentDataProperty}]`))}function u(ee,te){const{gen:ne}=ee;ne.if((0,n._)`Array.isArray(${te})`,()=>{ne.assign(e.default.vErrors,(0,n._)`${e.default.vErrors} === null ? ${te} : ${e.default.vErrors}.concat(${te})`).assign(e.default.errors,(0,n._)`${e.default.vErrors}.length`),(0,s.extendErrors)(ee)},()=>ee.error())}function f({schemaEnv:ee},te){if(te.async&&!ee.$async)throw new Error("async keyword in sync schema")}function g(ee,te,ne){if(ne===void 0)throw new Error(`keyword "${te}" failed to compile`);return ee.scopeValue("keyword",typeof ne=="function"?{ref:ne}:{ref:ne,code:(0,n.stringify)(ne)})}function H(ee,te,ne=!1){return!te.length||te.some(Ye=>Ye==="array"?Array.isArray(ee):Ye==="object"?ee&&typeof ee=="object"&&!Array.isArray(ee):typeof ee==Ye||ne&&typeof ee>"u")}keyword.validSchemaType=H;function Y({schema:ee,opts:te,self:ne,errSchemaPath:Ye},xe,tt){if(Array.isArray(xe.keyword)?!xe.keyword.includes(tt):xe.keyword!==tt)throw new Error("ajv implementation error");const et=xe.dependencies;if(et!=null&&et.some(it=>!Object.prototype.hasOwnProperty.call(ee,it)))throw new Error(`parent schema must have dependencies of ${tt}: ${et.join(",")}`);if(xe.validateSchema&&!xe.validateSchema(ee[tt])){const rt=`keyword "${tt}" value is invalid at path "${Ye}": `+ne.errorsText(xe.validateSchema.errors);if(te.validateSchema==="log")ne.logger.error(rt);else throw new Error(rt)}}return keyword.validateKeywordUsage=Y,keyword}var subschema={},hasRequiredSubschema;function requireSubschema(){if(hasRequiredSubschema)return subschema;hasRequiredSubschema=1,Object.defineProperty(subschema,"__esModule",{value:!0}),subschema.extendSubschemaMode=subschema.extendSubschemaData=subschema.getSubschema=void 0;const n=requireCodegen(),e=requireUtil();function i(l,{keyword:c,schemaProp:u,schema:f,schemaPath:g,errSchemaPath:H,topSchemaRef:Y}){if(c!==void 0&&f!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(c!==void 0){const ee=l.schema[c];return u===void 0?{schema:ee,schemaPath:(0,n._)`${l.schemaPath}${(0,n.getProperty)(c)}`,errSchemaPath:`${l.errSchemaPath}/${c}`}:{schema:ee[u],schemaPath:(0,n._)`${l.schemaPath}${(0,n.getProperty)(c)}${(0,n.getProperty)(u)}`,errSchemaPath:`${l.errSchemaPath}/${c}/${(0,e.escapeFragment)(u)}`}}if(f!==void 0){if(g===void 0||H===void 0||Y===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:f,schemaPath:g,topSchemaRef:Y,errSchemaPath:H}}throw new Error('either "keyword" or "schema" must be passed')}subschema.getSubschema=i;function s(l,c,{dataProp:u,dataPropType:f,data:g,dataTypes:H,propertyName:Y}){if(g!==void 0&&u!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:ee}=c;if(u!==void 0){const{errorPath:ne,dataPathArr:Ye,opts:xe}=c,tt=ee.let("data",(0,n._)`${c.data}${(0,n.getProperty)(u)}`,!0);te(tt),l.errorPath=(0,n.str)`${ne}${(0,e.getErrorPath)(u,f,xe.jsPropertySyntax)}`,l.parentDataProperty=(0,n._)`${u}`,l.dataPathArr=[...Ye,l.parentDataProperty]}if(g!==void 0){const ne=g instanceof n.Name?g:ee.let("data",g,!0);te(ne),Y!==void 0&&(l.propertyName=Y)}H&&(l.dataTypes=H);function te(ne){l.data=ne,l.dataLevel=c.dataLevel+1,l.dataTypes=[],c.definedProperties=new Set,l.parentData=c.data,l.dataNames=[...c.dataNames,ne]}}subschema.extendSubschemaData=s;function o(l,{jtdDiscriminator:c,jtdMetadata:u,compositeRule:f,createErrors:g,allErrors:H}){f!==void 0&&(l.compositeRule=f),g!==void 0&&(l.createErrors=g),H!==void 0&&(l.allErrors=H),l.jtdDiscriminator=c,l.jtdMetadata=u}return subschema.extendSubschemaMode=o,subschema}var resolve={},fastDeepEqual,hasRequiredFastDeepEqual;function requireFastDeepEqual(){return hasRequiredFastDeepEqual||(hasRequiredFastDeepEqual=1,fastDeepEqual=function n(e,i){if(e===i)return!0;if(e&&i&&typeof e=="object"&&typeof i=="object"){if(e.constructor!==i.constructor)return!1;var s,o,l;if(Array.isArray(e)){if(s=e.length,s!=i.length)return!1;for(o=s;o--!==0;)if(!n(e[o],i[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===i.source&&e.flags===i.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===i.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===i.toString();if(l=Object.keys(e),s=l.length,s!==Object.keys(i).length)return!1;for(o=s;o--!==0;)if(!Object.prototype.hasOwnProperty.call(i,l[o]))return!1;for(o=s;o--!==0;){var c=l[o];if(!n(e[c],i[c]))return!1}return!0}return e!==e&&i!==i}),fastDeepEqual}var jsonSchemaTraverse={exports:{}},hasRequiredJsonSchemaTraverse;function requireJsonSchemaTraverse(){if(hasRequiredJsonSchemaTraverse)return jsonSchemaTraverse.exports;hasRequiredJsonSchemaTraverse=1;var n=jsonSchemaTraverse.exports=function(s,o,l){typeof o=="function"&&(l=o,o={}),l=o.cb||l;var c=typeof l=="function"?l:l.pre||function(){},u=l.post||function(){};e(o,c,u,s,"",s)};n.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},n.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},n.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},n.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function e(s,o,l,c,u,f,g,H,Y,ee){if(c&&typeof c=="object"&&!Array.isArray(c)){o(c,u,f,g,H,Y,ee);for(var te in c){var ne=c[te];if(Array.isArray(ne)){if(te in n.arrayKeywords)for(var Ye=0;Ye<ne.length;Ye++)e(s,o,l,ne[Ye],u+"/"+te+"/"+Ye,f,u,te,c,Ye)}else if(te in n.propsKeywords){if(ne&&typeof ne=="object")for(var xe in ne)e(s,o,l,ne[xe],u+"/"+te+"/"+i(xe),f,u,te,c,xe)}else(te in n.keywords||s.allKeys&&!(te in n.skipKeywords))&&e(s,o,l,ne,u+"/"+te,f,u,te,c)}l(c,u,f,g,H,Y,ee)}}function i(s){return s.replace(/~/g,"~0").replace(/\//g,"~1")}return jsonSchemaTraverse.exports}var hasRequiredResolve;function requireResolve(){if(hasRequiredResolve)return resolve;hasRequiredResolve=1,Object.defineProperty(resolve,"__esModule",{value:!0}),resolve.getSchemaRefs=resolve.resolveUrl=resolve.normalizeId=resolve._getFullPath=resolve.getFullPath=resolve.inlineRef=void 0;const n=requireUtil(),e=requireFastDeepEqual(),i=requireJsonSchemaTraverse(),s=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function o(Ye,xe=!0){return typeof Ye=="boolean"?!0:xe===!0?!c(Ye):xe?u(Ye)<=xe:!1}resolve.inlineRef=o;const l=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function c(Ye){for(const xe in Ye){if(l.has(xe))return!0;const tt=Ye[xe];if(Array.isArray(tt)&&tt.some(c)||typeof tt=="object"&&c(tt))return!0}return!1}function u(Ye){let xe=0;for(const tt in Ye){if(tt==="$ref")return 1/0;if(xe++,!s.has(tt)&&(typeof Ye[tt]=="object"&&(0,n.eachItem)(Ye[tt],et=>xe+=u(et)),xe===1/0))return 1/0}return xe}function f(Ye,xe="",tt){tt!==!1&&(xe=Y(xe));const et=Ye.parse(xe);return g(Ye,et)}resolve.getFullPath=f;function g(Ye,xe){return Ye.serialize(xe).split("#")[0]+"#"}resolve._getFullPath=g;const H=/#\/?$/;function Y(Ye){return Ye?Ye.replace(H,""):""}resolve.normalizeId=Y;function ee(Ye,xe,tt){return tt=Y(tt),Ye.resolve(xe,tt)}resolve.resolveUrl=ee;const te=/^[a-z_][-a-z0-9._]*$/i;function ne(Ye,xe){if(typeof Ye=="boolean")return{};const{schemaId:tt,uriResolver:et}=this.opts,it=Y(Ye[tt]||xe),rt={"":it},nt=f(et,it,!1),at={},st=new Set;return i(Ye,{allKeys:!0},(ht,dt,pt,yt)=>{if(yt===void 0)return;const mt=nt+dt;let St=rt[yt];typeof ht[tt]=="string"&&(St=wt.call(this,ht[tt])),Rt.call(this,ht.$anchor),Rt.call(this,ht.$dynamicAnchor),rt[dt]=St;function wt(Lt){const Gt=this.opts.uriResolver.resolve;if(Lt=Y(St?Gt(St,Lt):Lt),st.has(Lt))throw ut(Lt);st.add(Lt);let vt=this.refs[Lt];return typeof vt=="string"&&(vt=this.refs[vt]),typeof vt=="object"?ot(ht,vt.schema,Lt):Lt!==Y(mt)&&(Lt[0]==="#"?(ot(ht,at[Lt],Lt),at[Lt]=ht):this.refs[Lt]=mt),Lt}function Rt(Lt){if(typeof Lt=="string"){if(!te.test(Lt))throw new Error(`invalid anchor "${Lt}"`);wt.call(this,`#${Lt}`)}}}),at;function ot(ht,dt,pt){if(dt!==void 0&&!e(ht,dt))throw ut(pt)}function ut(ht){return new Error(`reference "${ht}" resolves to more than one schema`)}}return resolve.getSchemaRefs=ne,resolve}var hasRequiredValidate;function requireValidate(){if(hasRequiredValidate)return validate;hasRequiredValidate=1,Object.defineProperty(validate,"__esModule",{value:!0}),validate.getData=validate.KeywordCxt=validate.validateFunctionCode=void 0;const n=requireBoolSchema(),e=requireDataType(),i=requireApplicability(),s=requireDataType(),o=requireDefaults(),l=requireKeyword(),c=requireSubschema(),u=requireCodegen(),f=requireNames(),g=requireResolve(),H=requireUtil(),Y=requireErrors();function ee(It){if(nt(It)&&(st(It),rt(It))){xe(It);return}te(It,()=>(0,n.topBoolOrEmptySchema)(It))}validate.validateFunctionCode=ee;function te({gen:It,validateName:xt,schema:Tt,schemaEnv:Ht,opts:Dt},qt){Dt.code.es5?It.func(xt,(0,u._)`${f.default.data}, ${f.default.valCxt}`,Ht.$async,()=>{It.code((0,u._)`"use strict"; ${et(Tt,Dt)}`),Ye(It,Dt),It.code(qt)}):It.func(xt,(0,u._)`${f.default.data}, ${ne(Dt)}`,Ht.$async,()=>It.code(et(Tt,Dt)).code(qt))}function ne(It){return(0,u._)`{${f.default.instancePath}="", ${f.default.parentData}, ${f.default.parentDataProperty}, ${f.default.rootData}=${f.default.data}${It.dynamicRef?(0,u._)`, ${f.default.dynamicAnchors}={}`:u.nil}}={}`}function Ye(It,xt){It.if(f.default.valCxt,()=>{It.var(f.default.instancePath,(0,u._)`${f.default.valCxt}.${f.default.instancePath}`),It.var(f.default.parentData,(0,u._)`${f.default.valCxt}.${f.default.parentData}`),It.var(f.default.parentDataProperty,(0,u._)`${f.default.valCxt}.${f.default.parentDataProperty}`),It.var(f.default.rootData,(0,u._)`${f.default.valCxt}.${f.default.rootData}`),xt.dynamicRef&&It.var(f.default.dynamicAnchors,(0,u._)`${f.default.valCxt}.${f.default.dynamicAnchors}`)},()=>{It.var(f.default.instancePath,(0,u._)`""`),It.var(f.default.parentData,(0,u._)`undefined`),It.var(f.default.parentDataProperty,(0,u._)`undefined`),It.var(f.default.rootData,f.default.data),xt.dynamicRef&&It.var(f.default.dynamicAnchors,(0,u._)`{}`)})}function xe(It){const{schema:xt,opts:Tt,gen:Ht}=It;te(It,()=>{Tt.$comment&&xt.$comment&&yt(It),ht(It),Ht.let(f.default.vErrors,null),Ht.let(f.default.errors,0),Tt.unevaluated&&tt(It),ot(It),mt(It)})}function tt(It){const{gen:xt,validateName:Tt}=It;It.evaluated=xt.const("evaluated",(0,u._)`${Tt}.evaluated`),xt.if((0,u._)`${It.evaluated}.dynamicProps`,()=>xt.assign((0,u._)`${It.evaluated}.props`,(0,u._)`undefined`)),xt.if((0,u._)`${It.evaluated}.dynamicItems`,()=>xt.assign((0,u._)`${It.evaluated}.items`,(0,u._)`undefined`))}function et(It,xt){const Tt=typeof It=="object"&&It[xt.schemaId];return Tt&&(xt.code.source||xt.code.process)?(0,u._)`/*# sourceURL=${Tt} */`:u.nil}function it(It,xt){if(nt(It)&&(st(It),rt(It))){at(It,xt);return}(0,n.boolOrEmptySchema)(It,xt)}function rt({schema:It,self:xt}){if(typeof It=="boolean")return!It;for(const Tt in It)if(xt.RULES.all[Tt])return!0;return!1}function nt(It){return typeof It.schema!="boolean"}function at(It,xt){const{schema:Tt,gen:Ht,opts:Dt}=It;Dt.$comment&&Tt.$comment&&yt(It),dt(It),pt(It);const qt=Ht.const("_errs",f.default.errors);ot(It,qt),Ht.var(xt,(0,u._)`${qt} === ${f.default.errors}`)}function st(It){(0,H.checkUnknownRules)(It),ut(It)}function ot(It,xt){if(It.opts.jtd)return wt(It,[],!1,xt);const Tt=(0,e.getSchemaTypes)(It.schema),Ht=(0,e.coerceAndCheckDataType)(It,Tt);wt(It,Tt,!Ht,xt)}function ut(It){const{schema:xt,errSchemaPath:Tt,opts:Ht,self:Dt}=It;xt.$ref&&Ht.ignoreKeywordsWithRef&&(0,H.schemaHasRulesButRef)(xt,Dt.RULES)&&Dt.logger.warn(`$ref: keywords ignored in schema at path "${Tt}"`)}function ht(It){const{schema:xt,opts:Tt}=It;xt.default!==void 0&&Tt.useDefaults&&Tt.strictSchema&&(0,H.checkStrictMode)(It,"default is ignored in the schema root")}function dt(It){const xt=It.schema[It.opts.schemaId];xt&&(It.baseId=(0,g.resolveUrl)(It.opts.uriResolver,It.baseId,xt))}function pt(It){if(It.schema.$async&&!It.schemaEnv.$async)throw new Error("async schema in sync schema")}function yt({gen:It,schemaEnv:xt,schema:Tt,errSchemaPath:Ht,opts:Dt}){const qt=Tt.$comment;if(Dt.$comment===!0)It.code((0,u._)`${f.default.self}.logger.log(${qt})`);else if(typeof Dt.$comment=="function"){const kt=(0,u.str)`${Ht}/$comment`,$t=It.scopeValue("root",{ref:xt.root});It.code((0,u._)`${f.default.self}.opts.$comment(${qt}, ${kt}, ${$t}.schema)`)}}function mt(It){const{gen:xt,schemaEnv:Tt,validateName:Ht,ValidationError:Dt,opts:qt}=It;Tt.$async?xt.if((0,u._)`${f.default.errors} === 0`,()=>xt.return(f.default.data),()=>xt.throw((0,u._)`new ${Dt}(${f.default.vErrors})`)):(xt.assign((0,u._)`${Ht}.errors`,f.default.vErrors),qt.unevaluated&&St(It),xt.return((0,u._)`${f.default.errors} === 0`))}function St({gen:It,evaluated:xt,props:Tt,items:Ht}){Tt instanceof u.Name&&It.assign((0,u._)`${xt}.props`,Tt),Ht instanceof u.Name&&It.assign((0,u._)`${xt}.items`,Ht)}function wt(It,xt,Tt,Ht){const{gen:Dt,schema:qt,data:kt,allErrors:$t,opts:Ut,self:zt}=It,{RULES:Yt}=zt;if(qt.$ref&&(Ut.ignoreKeywordsWithRef||!(0,H.schemaHasRulesButRef)(qt,Yt))){Dt.block(()=>Ft(It,"$ref",Yt.all.$ref.definition));return}Ut.jtd||Lt(It,xt),Dt.block(()=>{for(const Pt of Yt.rules)Jt(Pt);Jt(Yt.post)});function Jt(Pt){(0,i.shouldUseGroup)(qt,Pt)&&(Pt.type?(Dt.if((0,s.checkDataType)(Pt.type,kt,Ut.strictNumbers)),Rt(It,Pt),xt.length===1&&xt[0]===Pt.type&&Tt&&(Dt.else(),(0,s.reportTypeError)(It)),Dt.endIf()):Rt(It,Pt),$t||Dt.if((0,u._)`${f.default.errors} === ${Ht||0}`))}}function Rt(It,xt){const{gen:Tt,schema:Ht,opts:{useDefaults:Dt}}=It;Dt&&(0,o.assignDefaults)(It,xt.type),Tt.block(()=>{for(const qt of xt.rules)(0,i.shouldUseRule)(Ht,qt)&&Ft(It,qt.keyword,qt.definition,xt.type)})}function Lt(It,xt){It.schemaEnv.meta||!It.opts.strictTypes||(Gt(It,xt),It.opts.allowUnionTypes||vt(It,xt),Et(It,It.dataTypes))}function Gt(It,xt){if(xt.length){if(!It.dataTypes.length){It.dataTypes=xt;return}xt.forEach(Tt=>{Ct(It.dataTypes,Tt)||ft(It,`type "${Tt}" not allowed by context "${It.dataTypes.join(",")}"`)}),ct(It,xt)}}function vt(It,xt){xt.length>1&&!(xt.length===2&&xt.includes("null"))&&ft(It,"use allowUnionTypes to allow union type keyword")}function Et(It,xt){const Tt=It.self.RULES.all;for(const Ht in Tt){const Dt=Tt[Ht];if(typeof Dt=="object"&&(0,i.shouldUseRule)(It.schema,Dt)){const{type:qt}=Dt.definition;qt.length&&!qt.some(kt=>_t(xt,kt))&&ft(It,`missing type "${qt.join(",")}" for keyword "${Ht}"`)}}}function _t(It,xt){return It.includes(xt)||xt==="number"&&It.includes("integer")}function Ct(It,xt){return It.includes(xt)||xt==="integer"&&It.includes("number")}function ct(It,xt){const Tt=[];for(const Ht of It.dataTypes)Ct(xt,Ht)?Tt.push(Ht):xt.includes("integer")&&Ht==="number"&&Tt.push("integer");It.dataTypes=Tt}function ft(It,xt){const Tt=It.schemaEnv.baseId+It.errSchemaPath;xt+=` at "${Tt}" (strictTypes)`,(0,H.checkStrictMode)(It,xt,It.opts.strictTypes)}class bt{constructor(xt,Tt,Ht){if((0,l.validateKeywordUsage)(xt,Tt,Ht),this.gen=xt.gen,this.allErrors=xt.allErrors,this.keyword=Ht,this.data=xt.data,this.schema=xt.schema[Ht],this.$data=Tt.$data&&xt.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,H.schemaRefOrVal)(xt,this.schema,Ht,this.$data),this.schemaType=Tt.schemaType,this.parentSchema=xt.schema,this.params={},this.it=xt,this.def=Tt,this.$data)this.schemaCode=xt.gen.const("vSchema",Ot(this.$data,xt));else if(this.schemaCode=this.schemaValue,!(0,l.validSchemaType)(this.schema,Tt.schemaType,Tt.allowUndefined))throw new Error(`${Ht} value must be ${JSON.stringify(Tt.schemaType)}`);("code"in Tt?Tt.trackErrors:Tt.errors!==!1)&&(this.errsCount=xt.gen.const("_errs",f.default.errors))}result(xt,Tt,Ht){this.failResult((0,u.not)(xt),Tt,Ht)}failResult(xt,Tt,Ht){this.gen.if(xt),Ht?Ht():this.error(),Tt?(this.gen.else(),Tt(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(xt,Tt){this.failResult((0,u.not)(xt),void 0,Tt)}fail(xt){if(xt===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(xt),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(xt){if(!this.$data)return this.fail(xt);const{schemaCode:Tt}=this;this.fail((0,u._)`${Tt} !== undefined && (${(0,u.or)(this.invalid$data(),xt)})`)}error(xt,Tt,Ht){if(Tt){this.setParams(Tt),this._error(xt,Ht),this.setParams({});return}this._error(xt,Ht)}_error(xt,Tt){(xt?Y.reportExtraError:Y.reportError)(this,this.def.error,Tt)}$dataError(){(0,Y.reportError)(this,this.def.$dataError||Y.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,Y.resetErrorsCount)(this.gen,this.errsCount)}ok(xt){this.allErrors||this.gen.if(xt)}setParams(xt,Tt){Tt?Object.assign(this.params,xt):this.params=xt}block$data(xt,Tt,Ht=u.nil){this.gen.block(()=>{this.check$data(xt,Ht),Tt()})}check$data(xt=u.nil,Tt=u.nil){if(!this.$data)return;const{gen:Ht,schemaCode:Dt,schemaType:qt,def:kt}=this;Ht.if((0,u.or)((0,u._)`${Dt} === undefined`,Tt)),xt!==u.nil&&Ht.assign(xt,!0),(qt.length||kt.validateSchema)&&(Ht.elseIf(this.invalid$data()),this.$dataError(),xt!==u.nil&&Ht.assign(xt,!1)),Ht.else()}invalid$data(){const{gen:xt,schemaCode:Tt,schemaType:Ht,def:Dt,it:qt}=this;return(0,u.or)(kt(),$t());function kt(){if(Ht.length){if(!(Tt instanceof u.Name))throw new Error("ajv implementation error");const Ut=Array.isArray(Ht)?Ht:[Ht];return(0,u._)`${(0,s.checkDataTypes)(Ut,Tt,qt.opts.strictNumbers,s.DataType.Wrong)}`}return u.nil}function $t(){if(Dt.validateSchema){const Ut=xt.scopeValue("validate$data",{ref:Dt.validateSchema});return(0,u._)`!${Ut}(${Tt})`}return u.nil}}subschema(xt,Tt){const Ht=(0,c.getSubschema)(this.it,xt);(0,c.extendSubschemaData)(Ht,this.it,xt),(0,c.extendSubschemaMode)(Ht,xt);const Dt={...this.it,...Ht,items:void 0,props:void 0};return it(Dt,Tt),Dt}mergeEvaluated(xt,Tt){const{it:Ht,gen:Dt}=this;Ht.opts.unevaluated&&(Ht.props!==!0&&xt.props!==void 0&&(Ht.props=H.mergeEvaluated.props(Dt,xt.props,Ht.props,Tt)),Ht.items!==!0&&xt.items!==void 0&&(Ht.items=H.mergeEvaluated.items(Dt,xt.items,Ht.items,Tt)))}mergeValidEvaluated(xt,Tt){const{it:Ht,gen:Dt}=this;if(Ht.opts.unevaluated&&(Ht.props!==!0||Ht.items!==!0))return Dt.if(Tt,()=>this.mergeEvaluated(xt,u.Name)),!0}}validate.KeywordCxt=bt;function Ft(It,xt,Tt,Ht){const Dt=new bt(It,Tt,xt);"code"in Tt?Tt.code(Dt,Ht):Dt.$data&&Tt.validate?(0,l.funcKeywordCode)(Dt,Tt):"macro"in Tt?(0,l.macroKeywordCode)(Dt,Tt):(Tt.compile||Tt.validate)&&(0,l.funcKeywordCode)(Dt,Tt)}const Bt=/^\/(?:[^~]|~0|~1)*$/,Xt=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function Ot(It,{dataLevel:xt,dataNames:Tt,dataPathArr:Ht}){let Dt,qt;if(It==="")return f.default.rootData;if(It[0]==="/"){if(!Bt.test(It))throw new Error(`Invalid JSON-pointer: ${It}`);Dt=It,qt=f.default.rootData}else{const zt=Xt.exec(It);if(!zt)throw new Error(`Invalid JSON-pointer: ${It}`);const Yt=+zt[1];if(Dt=zt[2],Dt==="#"){if(Yt>=xt)throw new Error(Ut("property/index",Yt));return Ht[xt-Yt]}if(Yt>xt)throw new Error(Ut("data",Yt));if(qt=Tt[xt-Yt],!Dt)return qt}let kt=qt;const $t=Dt.split("/");for(const zt of $t)zt&&(qt=(0,u._)`${qt}${(0,u.getProperty)((0,H.unescapeJsonPointer)(zt))}`,kt=(0,u._)`${kt} && ${qt}`);return kt;function Ut(zt,Yt){return`Cannot access ${zt} ${Yt} levels up, current level is ${xt}`}}return validate.getData=Ot,validate}var validation_error={},hasRequiredValidation_error;function requireValidation_error(){if(hasRequiredValidation_error)return validation_error;hasRequiredValidation_error=1,Object.defineProperty(validation_error,"__esModule",{value:!0});class n extends Error{constructor(i){super("validation failed"),this.errors=i,this.ajv=this.validation=!0}}return validation_error.default=n,validation_error}var ref_error={},hasRequiredRef_error;function requireRef_error(){if(hasRequiredRef_error)return ref_error;hasRequiredRef_error=1,Object.defineProperty(ref_error,"__esModule",{value:!0});const n=requireResolve();class e extends Error{constructor(s,o,l,c){super(c||`can't resolve reference ${l} from id ${o}`),this.missingRef=(0,n.resolveUrl)(s,o,l),this.missingSchema=(0,n.normalizeId)((0,n.getFullPath)(s,this.missingRef))}}return ref_error.default=e,ref_error}var compile={},hasRequiredCompile;function requireCompile(){if(hasRequiredCompile)return compile;hasRequiredCompile=1,Object.defineProperty(compile,"__esModule",{value:!0}),compile.resolveSchema=compile.getCompilingSchema=compile.resolveRef=compile.compileSchema=compile.SchemaEnv=void 0;const n=requireCodegen(),e=requireValidation_error(),i=requireNames(),s=requireResolve(),o=requireUtil(),l=requireValidate();class c{constructor(tt){var et;this.refs={},this.dynamicAnchors={};let it;typeof tt.schema=="object"&&(it=tt.schema),this.schema=tt.schema,this.schemaId=tt.schemaId,this.root=tt.root||this,this.baseId=(et=tt.baseId)!==null&&et!==void 0?et:(0,s.normalizeId)(it==null?void 0:it[tt.schemaId||"$id"]),this.schemaPath=tt.schemaPath,this.localRefs=tt.localRefs,this.meta=tt.meta,this.$async=it==null?void 0:it.$async,this.refs={}}}compile.SchemaEnv=c;function u(xe){const tt=H.call(this,xe);if(tt)return tt;const et=(0,s.getFullPath)(this.opts.uriResolver,xe.root.baseId),{es5:it,lines:rt}=this.opts.code,{ownProperties:nt}=this.opts,at=new n.CodeGen(this.scope,{es5:it,lines:rt,ownProperties:nt});let st;xe.$async&&(st=at.scopeValue("Error",{ref:e.default,code:(0,n._)`require("ajv/dist/runtime/validation_error").default`}));const ot=at.scopeName("validate");xe.validateName=ot;const ut={gen:at,allErrors:this.opts.allErrors,data:i.default.data,parentData:i.default.parentData,parentDataProperty:i.default.parentDataProperty,dataNames:[i.default.data],dataPathArr:[n.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:at.scopeValue("schema",this.opts.code.source===!0?{ref:xe.schema,code:(0,n.stringify)(xe.schema)}:{ref:xe.schema}),validateName:ot,ValidationError:st,schema:xe.schema,schemaEnv:xe,rootId:et,baseId:xe.baseId||et,schemaPath:n.nil,errSchemaPath:xe.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,n._)`""`,opts:this.opts,self:this};let ht;try{this._compilations.add(xe),(0,l.validateFunctionCode)(ut),at.optimize(this.opts.code.optimize);const dt=at.toString();ht=`${at.scopeRefs(i.default.scope)}return ${dt}`,this.opts.code.process&&(ht=this.opts.code.process(ht,xe));const yt=new Function(`${i.default.self}`,`${i.default.scope}`,ht)(this,this.scope.get());if(this.scope.value(ot,{ref:yt}),yt.errors=null,yt.schema=xe.schema,yt.schemaEnv=xe,xe.$async&&(yt.$async=!0),this.opts.code.source===!0&&(yt.source={validateName:ot,validateCode:dt,scopeValues:at._values}),this.opts.unevaluated){const{props:mt,items:St}=ut;yt.evaluated={props:mt instanceof n.Name?void 0:mt,items:St instanceof n.Name?void 0:St,dynamicProps:mt instanceof n.Name,dynamicItems:St instanceof n.Name},yt.source&&(yt.source.evaluated=(0,n.stringify)(yt.evaluated))}return xe.validate=yt,xe}catch(dt){throw delete xe.validate,delete xe.validateName,ht&&this.logger.error("Error compiling schema, function code:",ht),dt}finally{this._compilations.delete(xe)}}compile.compileSchema=u;function f(xe,tt,et){var it;et=(0,s.resolveUrl)(this.opts.uriResolver,tt,et);const rt=xe.refs[et];if(rt)return rt;let nt=ee.call(this,xe,et);if(nt===void 0){const at=(it=xe.localRefs)===null||it===void 0?void 0:it[et],{schemaId:st}=this.opts;at&&(nt=new c({schema:at,schemaId:st,root:xe,baseId:tt}))}if(nt!==void 0)return xe.refs[et]=g.call(this,nt)}compile.resolveRef=f;function g(xe){return(0,s.inlineRef)(xe.schema,this.opts.inlineRefs)?xe.schema:xe.validate?xe:u.call(this,xe)}function H(xe){for(const tt of this._compilations)if(Y(tt,xe))return tt}compile.getCompilingSchema=H;function Y(xe,tt){return xe.schema===tt.schema&&xe.root===tt.root&&xe.baseId===tt.baseId}function ee(xe,tt){let et;for(;typeof(et=this.refs[tt])=="string";)tt=et;return et||this.schemas[tt]||te.call(this,xe,tt)}function te(xe,tt){const et=this.opts.uriResolver.parse(tt),it=(0,s._getFullPath)(this.opts.uriResolver,et);let rt=(0,s.getFullPath)(this.opts.uriResolver,xe.baseId,void 0);if(Object.keys(xe.schema).length>0&&it===rt)return Ye.call(this,et,xe);const nt=(0,s.normalizeId)(it),at=this.refs[nt]||this.schemas[nt];if(typeof at=="string"){const st=te.call(this,xe,at);return typeof(st==null?void 0:st.schema)!="object"?void 0:Ye.call(this,et,st)}if(typeof(at==null?void 0:at.schema)=="object"){if(at.validate||u.call(this,at),nt===(0,s.normalizeId)(tt)){const{schema:st}=at,{schemaId:ot}=this.opts,ut=st[ot];return ut&&(rt=(0,s.resolveUrl)(this.opts.uriResolver,rt,ut)),new c({schema:st,schemaId:ot,root:xe,baseId:rt})}return Ye.call(this,et,at)}}compile.resolveSchema=te;const ne=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function Ye(xe,{baseId:tt,schema:et,root:it}){var rt;if(((rt=xe.fragment)===null||rt===void 0?void 0:rt[0])!=="/")return;for(const st of xe.fragment.slice(1).split("/")){if(typeof et=="boolean")return;const ot=et[(0,o.unescapeFragment)(st)];if(ot===void 0)return;et=ot;const ut=typeof et=="object"&&et[this.opts.schemaId];!ne.has(st)&&ut&&(tt=(0,s.resolveUrl)(this.opts.uriResolver,tt,ut))}let nt;if(typeof et!="boolean"&&et.$ref&&!(0,o.schemaHasRulesButRef)(et,this.RULES)){const st=(0,s.resolveUrl)(this.opts.uriResolver,tt,et.$ref);nt=te.call(this,it,st)}const{schemaId:at}=this.opts;if(nt=nt||new c({schema:et,schemaId:at,root:it,baseId:tt}),nt.schema!==nt.root.schema)return nt}return compile}const $id$7="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description="Meta-schema for $data reference (JSON AnySchema extension proposal)",type$7="object",required$5=["$data"],properties$6={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties$4=!1,require$$9={$id:$id$7,description,type:type$7,required:required$5,properties:properties$6,additionalProperties:additionalProperties$4};var uri={},fastUri={exports:{}},utils,hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1;const n=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),e=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function i(ee){let te="",ne=0,Ye=0;for(Ye=0;Ye<ee.length;Ye++)if(ne=ee[Ye].charCodeAt(0),ne!==48){if(!(ne>=48&&ne<=57||ne>=65&&ne<=70||ne>=97&&ne<=102))return"";te+=ee[Ye];break}for(Ye+=1;Ye<ee.length;Ye++){if(ne=ee[Ye].charCodeAt(0),!(ne>=48&&ne<=57||ne>=65&&ne<=70||ne>=97&&ne<=102))return"";te+=ee[Ye]}return te}const s=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function o(ee){return ee.length=0,!0}function l(ee,te,ne){if(ee.length){const Ye=i(ee);if(Ye!=="")te.push(Ye);else return ne.error=!0,!1;ee.length=0}return!0}function c(ee){let te=0;const ne={error:!1,address:"",zone:""},Ye=[],xe=[];let tt=!1,et=!1,it=l;for(let rt=0;rt<ee.length;rt++){const nt=ee[rt];if(!(nt==="["||nt==="]"))if(nt===":"){if(tt===!0&&(et=!0),!it(xe,Ye,ne))break;if(++te>7){ne.error=!0;break}rt>0&&ee[rt-1]===":"&&(tt=!0),Ye.push(":");continue}else if(nt==="%"){if(!it(xe,Ye,ne))break;it=o}else{xe.push(nt);continue}}return xe.length&&(it===o?ne.zone=xe.join(""):et?Ye.push(xe.join("")):Ye.push(i(xe))),ne.address=Ye.join(""),ne}function u(ee){if(f(ee,":")<2)return{host:ee,isIPV6:!1};const te=c(ee);if(te.error)return{host:ee,isIPV6:!1};{let ne=te.address,Ye=te.address;return te.zone&&(ne+="%"+te.zone,Ye+="%25"+te.zone),{host:ne,isIPV6:!0,escapedHost:Ye}}}function f(ee,te){let ne=0;for(let Ye=0;Ye<ee.length;Ye++)ee[Ye]===te&&ne++;return ne}function g(ee){let te=ee;const ne=[];let Ye=-1,xe=0;for(;xe=te.length;){if(xe===1){if(te===".")break;if(te==="/"){ne.push("/");break}else{ne.push(te);break}}else if(xe===2){if(te[0]==="."){if(te[1]===".")break;if(te[1]==="/"){te=te.slice(2);continue}}else if(te[0]==="/"&&(te[1]==="."||te[1]==="/")){ne.push("/");break}}else if(xe===3&&te==="/.."){ne.length!==0&&ne.pop(),ne.push("/");break}if(te[0]==="."){if(te[1]==="."){if(te[2]==="/"){te=te.slice(3);continue}}else if(te[1]==="/"){te=te.slice(2);continue}}else if(te[0]==="/"&&te[1]==="."){if(te[2]==="/"){te=te.slice(2);continue}else if(te[2]==="."&&te[3]==="/"){te=te.slice(3),ne.length!==0&&ne.pop();continue}}if((Ye=te.indexOf("/",1))===-1){ne.push(te);break}else ne.push(te.slice(0,Ye)),te=te.slice(Ye)}return ne.join("")}function H(ee,te){const ne=te!==!0?escape:unescape;return ee.scheme!==void 0&&(ee.scheme=ne(ee.scheme)),ee.userinfo!==void 0&&(ee.userinfo=ne(ee.userinfo)),ee.host!==void 0&&(ee.host=ne(ee.host)),ee.path!==void 0&&(ee.path=ne(ee.path)),ee.query!==void 0&&(ee.query=ne(ee.query)),ee.fragment!==void 0&&(ee.fragment=ne(ee.fragment)),ee}function Y(ee){const te=[];if(ee.userinfo!==void 0&&(te.push(ee.userinfo),te.push("@")),ee.host!==void 0){let ne=unescape(ee.host);if(!e(ne)){const Ye=u(ne);Ye.isIPV6===!0?ne=`[${Ye.escapedHost}]`:ne=ee.host}te.push(ne)}return(typeof ee.port=="number"||typeof ee.port=="string")&&(te.push(":"),te.push(String(ee.port))),te.length?te.join(""):void 0}return utils={nonSimpleDomain:s,recomposeAuthority:Y,normalizeComponentEncoding:H,removeDotSegments:g,isIPv4:e,isUUID:n,normalizeIPv6:u,stringArrayToHexStripped:i},utils}var schemes,hasRequiredSchemes;function requireSchemes(){if(hasRequiredSchemes)return schemes;hasRequiredSchemes=1;const{isUUID:n}=requireUtils(),e=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,i=["http","https","ws","wss","urn","urn:uuid"];function s(nt){return i.indexOf(nt)!==-1}function o(nt){return nt.secure===!0?!0:nt.secure===!1?!1:nt.scheme?nt.scheme.length===3&&(nt.scheme[0]==="w"||nt.scheme[0]==="W")&&(nt.scheme[1]==="s"||nt.scheme[1]==="S")&&(nt.scheme[2]==="s"||nt.scheme[2]==="S"):!1}function l(nt){return nt.host||(nt.error=nt.error||"HTTP URIs must have a host."),nt}function c(nt){const at=String(nt.scheme).toLowerCase()==="https";return(nt.port===(at?443:80)||nt.port==="")&&(nt.port=void 0),nt.path||(nt.path="/"),nt}function u(nt){return nt.secure=o(nt),nt.resourceName=(nt.path||"/")+(nt.query?"?"+nt.query:""),nt.path=void 0,nt.query=void 0,nt}function f(nt){if((nt.port===(o(nt)?443:80)||nt.port==="")&&(nt.port=void 0),typeof nt.secure=="boolean"&&(nt.scheme=nt.secure?"wss":"ws",nt.secure=void 0),nt.resourceName){const[at,st]=nt.resourceName.split("?");nt.path=at&&at!=="/"?at:void 0,nt.query=st,nt.resourceName=void 0}return nt.fragment=void 0,nt}function g(nt,at){if(!nt.path)return nt.error="URN can not be parsed",nt;const st=nt.path.match(e);if(st){const ot=at.scheme||nt.scheme||"urn";nt.nid=st[1].toLowerCase(),nt.nss=st[2];const ut=`${ot}:${at.nid||nt.nid}`,ht=rt(ut);nt.path=void 0,ht&&(nt=ht.parse(nt,at))}else nt.error=nt.error||"URN can not be parsed.";return nt}function H(nt,at){if(nt.nid===void 0)throw new Error("URN without nid cannot be serialized");const st=at.scheme||nt.scheme||"urn",ot=nt.nid.toLowerCase(),ut=`${st}:${at.nid||ot}`,ht=rt(ut);ht&&(nt=ht.serialize(nt,at));const dt=nt,pt=nt.nss;return dt.path=`${ot||at.nid}:${pt}`,at.skipEscape=!0,dt}function Y(nt,at){const st=nt;return st.uuid=st.nss,st.nss=void 0,!at.tolerant&&(!st.uuid||!n(st.uuid))&&(st.error=st.error||"UUID is not valid."),st}function ee(nt){const at=nt;return at.nss=(nt.uuid||"").toLowerCase(),at}const te={scheme:"http",domainHost:!0,parse:l,serialize:c},ne={scheme:"https",domainHost:te.domainHost,parse:l,serialize:c},Ye={scheme:"ws",domainHost:!0,parse:u,serialize:f},xe={scheme:"wss",domainHost:Ye.domainHost,parse:Ye.parse,serialize:Ye.serialize},it={http:te,https:ne,ws:Ye,wss:xe,urn:{scheme:"urn",parse:g,serialize:H,skipNormalize:!0},"urn:uuid":{scheme:"urn:uuid",parse:Y,serialize:ee,skipNormalize:!0}};Object.setPrototypeOf(it,null);function rt(nt){return nt&&(it[nt]||it[nt.toLowerCase()])||void 0}return schemes={wsIsSecure:o,SCHEMES:it,isValidSchemeName:s,getSchemeHandler:rt},schemes}var hasRequiredFastUri;function requireFastUri(){if(hasRequiredFastUri)return fastUri.exports;hasRequiredFastUri=1;const{normalizeIPv6:n,removeDotSegments:e,recomposeAuthority:i,normalizeComponentEncoding:s,isIPv4:o,nonSimpleDomain:l}=requireUtils(),{SCHEMES:c,getSchemeHandler:u}=requireSchemes();function f(xe,tt){return typeof xe=="string"?xe=ee(ne(xe,tt),tt):typeof xe=="object"&&(xe=ne(ee(xe,tt),tt)),xe}function g(xe,tt,et){const it=et?Object.assign({scheme:"null"},et):{scheme:"null"},rt=H(ne(xe,it),ne(tt,it),it,!0);return it.skipEscape=!0,ee(rt,it)}function H(xe,tt,et,it){const rt={};return it||(xe=ne(ee(xe,et),et),tt=ne(ee(tt,et),et)),et=et||{},!et.tolerant&&tt.scheme?(rt.scheme=tt.scheme,rt.userinfo=tt.userinfo,rt.host=tt.host,rt.port=tt.port,rt.path=e(tt.path||""),rt.query=tt.query):(tt.userinfo!==void 0||tt.host!==void 0||tt.port!==void 0?(rt.userinfo=tt.userinfo,rt.host=tt.host,rt.port=tt.port,rt.path=e(tt.path||""),rt.query=tt.query):(tt.path?(tt.path[0]==="/"?rt.path=e(tt.path):((xe.userinfo!==void 0||xe.host!==void 0||xe.port!==void 0)&&!xe.path?rt.path="/"+tt.path:xe.path?rt.path=xe.path.slice(0,xe.path.lastIndexOf("/")+1)+tt.path:rt.path=tt.path,rt.path=e(rt.path)),rt.query=tt.query):(rt.path=xe.path,tt.query!==void 0?rt.query=tt.query:rt.query=xe.query),rt.userinfo=xe.userinfo,rt.host=xe.host,rt.port=xe.port),rt.scheme=xe.scheme),rt.fragment=tt.fragment,rt}function Y(xe,tt,et){return typeof xe=="string"?(xe=unescape(xe),xe=ee(s(ne(xe,et),!0),{...et,skipEscape:!0})):typeof xe=="object"&&(xe=ee(s(xe,!0),{...et,skipEscape:!0})),typeof tt=="string"?(tt=unescape(tt),tt=ee(s(ne(tt,et),!0),{...et,skipEscape:!0})):typeof tt=="object"&&(tt=ee(s(tt,!0),{...et,skipEscape:!0})),xe.toLowerCase()===tt.toLowerCase()}function ee(xe,tt){const et={host:xe.host,scheme:xe.scheme,userinfo:xe.userinfo,port:xe.port,path:xe.path,query:xe.query,nid:xe.nid,nss:xe.nss,uuid:xe.uuid,fragment:xe.fragment,reference:xe.reference,resourceName:xe.resourceName,secure:xe.secure,error:""},it=Object.assign({},tt),rt=[],nt=u(it.scheme||et.scheme);nt&&nt.serialize&&nt.serialize(et,it),et.path!==void 0&&(it.skipEscape?et.path=unescape(et.path):(et.path=escape(et.path),et.scheme!==void 0&&(et.path=et.path.split("%3A").join(":")))),it.reference!=="suffix"&&et.scheme&&rt.push(et.scheme,":");const at=i(et);if(at!==void 0&&(it.reference!=="suffix"&&rt.push("//"),rt.push(at),et.path&&et.path[0]!=="/"&&rt.push("/")),et.path!==void 0){let st=et.path;!it.absolutePath&&(!nt||!nt.absolutePath)&&(st=e(st)),at===void 0&&st[0]==="/"&&st[1]==="/"&&(st="/%2F"+st.slice(2)),rt.push(st)}return et.query!==void 0&&rt.push("?",et.query),et.fragment!==void 0&&rt.push("#",et.fragment),rt.join("")}const te=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function ne(xe,tt){const et=Object.assign({},tt),it={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0};let rt=!1;et.reference==="suffix"&&(et.scheme?xe=et.scheme+":"+xe:xe="//"+xe);const nt=xe.match(te);if(nt){if(it.scheme=nt[1],it.userinfo=nt[3],it.host=nt[4],it.port=parseInt(nt[5],10),it.path=nt[6]||"",it.query=nt[7],it.fragment=nt[8],isNaN(it.port)&&(it.port=nt[5]),it.host)if(o(it.host)===!1){const ot=n(it.host);it.host=ot.host.toLowerCase(),rt=ot.isIPV6}else rt=!0;it.scheme===void 0&&it.userinfo===void 0&&it.host===void 0&&it.port===void 0&&it.query===void 0&&!it.path?it.reference="same-document":it.scheme===void 0?it.reference="relative":it.fragment===void 0?it.reference="absolute":it.reference="uri",et.reference&&et.reference!=="suffix"&&et.reference!==it.reference&&(it.error=it.error||"URI is not a "+et.reference+" reference.");const at=u(et.scheme||it.scheme);if(!et.unicodeSupport&&(!at||!at.unicodeSupport)&&it.host&&(et.domainHost||at&&at.domainHost)&&rt===!1&&l(it.host))try{it.host=URL.domainToASCII(it.host.toLowerCase())}catch(st){it.error=it.error||"Host's domain name can not be converted to ASCII: "+st}(!at||at&&!at.skipNormalize)&&(xe.indexOf("%")!==-1&&(it.scheme!==void 0&&(it.scheme=unescape(it.scheme)),it.host!==void 0&&(it.host=unescape(it.host))),it.path&&(it.path=escape(unescape(it.path))),it.fragment&&(it.fragment=encodeURI(decodeURIComponent(it.fragment)))),at&&at.parse&&at.parse(it,et)}else it.error=it.error||"URI can not be parsed.";return it}const Ye={SCHEMES:c,normalize:f,resolve:g,resolveComponent:H,equal:Y,serialize:ee,parse:ne};return fastUri.exports=Ye,fastUri.exports.default=Ye,fastUri.exports.fastUri=Ye,fastUri.exports}var hasRequiredUri;function requireUri(){if(hasRequiredUri)return uri;hasRequiredUri=1,Object.defineProperty(uri,"__esModule",{value:!0});const n=requireFastUri();return n.code='require("ajv/dist/runtime/uri").default',uri.default=n,uri}var hasRequiredCore$1;function requireCore$1(){return hasRequiredCore$1||(hasRequiredCore$1=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.CodeGen=n.Name=n.nil=n.stringify=n.str=n._=n.KeywordCxt=void 0;var e=requireValidate();Object.defineProperty(n,"KeywordCxt",{enumerable:!0,get:function(){return e.KeywordCxt}});var i=requireCodegen();Object.defineProperty(n,"_",{enumerable:!0,get:function(){return i._}}),Object.defineProperty(n,"str",{enumerable:!0,get:function(){return i.str}}),Object.defineProperty(n,"stringify",{enumerable:!0,get:function(){return i.stringify}}),Object.defineProperty(n,"nil",{enumerable:!0,get:function(){return i.nil}}),Object.defineProperty(n,"Name",{enumerable:!0,get:function(){return i.Name}}),Object.defineProperty(n,"CodeGen",{enumerable:!0,get:function(){return i.CodeGen}});const s=requireValidation_error(),o=requireRef_error(),l=requireRules(),c=requireCompile(),u=requireCodegen(),f=requireResolve(),g=requireDataType(),H=requireUtil(),Y=require$$9,ee=requireUri(),te=(vt,Et)=>new RegExp(vt,Et);te.code="new RegExp";const ne=["removeAdditional","useDefaults","coerceTypes"],Ye=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),xe={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},tt={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},et=200;function it(vt){var Et,_t,Ct,ct,ft,bt,Ft,Bt,Xt,Ot,It,xt,Tt,Ht,Dt,qt,kt,$t,Ut,zt,Yt,Jt,Pt,Mt,Nt;const Wt=vt.strict,Vt=(Et=vt.code)===null||Et===void 0?void 0:Et.optimize,Kt=Vt===!0||Vt===void 0?1:Vt||0,Zt=(Ct=(_t=vt.code)===null||_t===void 0?void 0:_t.regExp)!==null&&Ct!==void 0?Ct:te,Qt=(ct=vt.uriResolver)!==null&&ct!==void 0?ct:ee.default;return{strictSchema:(bt=(ft=vt.strictSchema)!==null&&ft!==void 0?ft:Wt)!==null&&bt!==void 0?bt:!0,strictNumbers:(Bt=(Ft=vt.strictNumbers)!==null&&Ft!==void 0?Ft:Wt)!==null&&Bt!==void 0?Bt:!0,strictTypes:(Ot=(Xt=vt.strictTypes)!==null&&Xt!==void 0?Xt:Wt)!==null&&Ot!==void 0?Ot:"log",strictTuples:(xt=(It=vt.strictTuples)!==null&&It!==void 0?It:Wt)!==null&&xt!==void 0?xt:"log",strictRequired:(Ht=(Tt=vt.strictRequired)!==null&&Tt!==void 0?Tt:Wt)!==null&&Ht!==void 0?Ht:!1,code:vt.code?{...vt.code,optimize:Kt,regExp:Zt}:{optimize:Kt,regExp:Zt},loopRequired:(Dt=vt.loopRequired)!==null&&Dt!==void 0?Dt:et,loopEnum:(qt=vt.loopEnum)!==null&&qt!==void 0?qt:et,meta:(kt=vt.meta)!==null&&kt!==void 0?kt:!0,messages:($t=vt.messages)!==null&&$t!==void 0?$t:!0,inlineRefs:(Ut=vt.inlineRefs)!==null&&Ut!==void 0?Ut:!0,schemaId:(zt=vt.schemaId)!==null&&zt!==void 0?zt:"$id",addUsedSchema:(Yt=vt.addUsedSchema)!==null&&Yt!==void 0?Yt:!0,validateSchema:(Jt=vt.validateSchema)!==null&&Jt!==void 0?Jt:!0,validateFormats:(Pt=vt.validateFormats)!==null&&Pt!==void 0?Pt:!0,unicodeRegExp:(Mt=vt.unicodeRegExp)!==null&&Mt!==void 0?Mt:!0,int32range:(Nt=vt.int32range)!==null&&Nt!==void 0?Nt:!0,uriResolver:Qt}}class rt{constructor(Et={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,Et=this.opts={...Et,...it(Et)};const{es5:_t,lines:Ct}=this.opts.code;this.scope=new u.ValueScope({scope:{},prefixes:Ye,es5:_t,lines:Ct}),this.logger=pt(Et.logger);const ct=Et.validateFormats;Et.validateFormats=!1,this.RULES=(0,l.getRules)(),nt.call(this,xe,Et,"NOT SUPPORTED"),nt.call(this,tt,Et,"DEPRECATED","warn"),this._metaOpts=ht.call(this),Et.formats&&ot.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),Et.keywords&&ut.call(this,Et.keywords),typeof Et.meta=="object"&&this.addMetaSchema(Et.meta),st.call(this),Et.validateFormats=ct}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:Et,meta:_t,schemaId:Ct}=this.opts;let ct=Y;Ct==="id"&&(ct={...Y},ct.id=ct.$id,delete ct.$id),_t&&Et&&this.addMetaSchema(ct,ct[Ct],!1)}defaultMeta(){const{meta:Et,schemaId:_t}=this.opts;return this.opts.defaultMeta=typeof Et=="object"?Et[_t]||Et:void 0}validate(Et,_t){let Ct;if(typeof Et=="string"){if(Ct=this.getSchema(Et),!Ct)throw new Error(`no schema with key or ref "${Et}"`)}else Ct=this.compile(Et);const ct=Ct(_t);return"$async"in Ct||(this.errors=Ct.errors),ct}compile(Et,_t){const Ct=this._addSchema(Et,_t);return Ct.validate||this._compileSchemaEnv(Ct)}compileAsync(Et,_t){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:Ct}=this.opts;return ct.call(this,Et,_t);async function ct(Ot,It){await ft.call(this,Ot.$schema);const xt=this._addSchema(Ot,It);return xt.validate||bt.call(this,xt)}async function ft(Ot){Ot&&!this.getSchema(Ot)&&await ct.call(this,{$ref:Ot},!0)}async function bt(Ot){try{return this._compileSchemaEnv(Ot)}catch(It){if(!(It instanceof o.default))throw It;return Ft.call(this,It),await Bt.call(this,It.missingSchema),bt.call(this,Ot)}}function Ft({missingSchema:Ot,missingRef:It}){if(this.refs[Ot])throw new Error(`AnySchema ${Ot} is loaded but ${It} cannot be resolved`)}async function Bt(Ot){const It=await Xt.call(this,Ot);this.refs[Ot]||await ft.call(this,It.$schema),this.refs[Ot]||this.addSchema(It,Ot,_t)}async function Xt(Ot){const It=this._loading[Ot];if(It)return It;try{return await(this._loading[Ot]=Ct(Ot))}finally{delete this._loading[Ot]}}}addSchema(Et,_t,Ct,ct=this.opts.validateSchema){if(Array.isArray(Et)){for(const bt of Et)this.addSchema(bt,void 0,Ct,ct);return this}let ft;if(typeof Et=="object"){const{schemaId:bt}=this.opts;if(ft=Et[bt],ft!==void 0&&typeof ft!="string")throw new Error(`schema ${bt} must be string`)}return _t=(0,f.normalizeId)(_t||ft),this._checkUnique(_t),this.schemas[_t]=this._addSchema(Et,Ct,_t,ct,!0),this}addMetaSchema(Et,_t,Ct=this.opts.validateSchema){return this.addSchema(Et,_t,!0,Ct),this}validateSchema(Et,_t){if(typeof Et=="boolean")return!0;let Ct;if(Ct=Et.$schema,Ct!==void 0&&typeof Ct!="string")throw new Error("$schema must be a string");if(Ct=Ct||this.opts.defaultMeta||this.defaultMeta(),!Ct)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const ct=this.validate(Ct,Et);if(!ct&&_t){const ft="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(ft);else throw new Error(ft)}return ct}getSchema(Et){let _t;for(;typeof(_t=at.call(this,Et))=="string";)Et=_t;if(_t===void 0){const{schemaId:Ct}=this.opts,ct=new c.SchemaEnv({schema:{},schemaId:Ct});if(_t=c.resolveSchema.call(this,ct,Et),!_t)return;this.refs[Et]=_t}return _t.validate||this._compileSchemaEnv(_t)}removeSchema(Et){if(Et instanceof RegExp)return this._removeAllSchemas(this.schemas,Et),this._removeAllSchemas(this.refs,Et),this;switch(typeof Et){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const _t=at.call(this,Et);return typeof _t=="object"&&this._cache.delete(_t.schema),delete this.schemas[Et],delete this.refs[Et],this}case"object":{const _t=Et;this._cache.delete(_t);let Ct=Et[this.opts.schemaId];return Ct&&(Ct=(0,f.normalizeId)(Ct),delete this.schemas[Ct],delete this.refs[Ct]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(Et){for(const _t of Et)this.addKeyword(_t);return this}addKeyword(Et,_t){let Ct;if(typeof Et=="string")Ct=Et,typeof _t=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),_t.keyword=Ct);else if(typeof Et=="object"&&_t===void 0){if(_t=Et,Ct=_t.keyword,Array.isArray(Ct)&&!Ct.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(mt.call(this,Ct,_t),!_t)return(0,H.eachItem)(Ct,ft=>St.call(this,ft)),this;Rt.call(this,_t);const ct={..._t,type:(0,g.getJSONTypes)(_t.type),schemaType:(0,g.getJSONTypes)(_t.schemaType)};return(0,H.eachItem)(Ct,ct.type.length===0?ft=>St.call(this,ft,ct):ft=>ct.type.forEach(bt=>St.call(this,ft,ct,bt))),this}getKeyword(Et){const _t=this.RULES.all[Et];return typeof _t=="object"?_t.definition:!!_t}removeKeyword(Et){const{RULES:_t}=this;delete _t.keywords[Et],delete _t.all[Et];for(const Ct of _t.rules){const ct=Ct.rules.findIndex(ft=>ft.keyword===Et);ct>=0&&Ct.rules.splice(ct,1)}return this}addFormat(Et,_t){return typeof _t=="string"&&(_t=new RegExp(_t)),this.formats[Et]=_t,this}errorsText(Et=this.errors,{separator:_t=", ",dataVar:Ct="data"}={}){return!Et||Et.length===0?"No errors":Et.map(ct=>`${Ct}${ct.instancePath} ${ct.message}`).reduce((ct,ft)=>ct+_t+ft)}$dataMetaSchema(Et,_t){const Ct=this.RULES.all;Et=JSON.parse(JSON.stringify(Et));for(const ct of _t){const ft=ct.split("/").slice(1);let bt=Et;for(const Ft of ft)bt=bt[Ft];for(const Ft in Ct){const Bt=Ct[Ft];if(typeof Bt!="object")continue;const{$data:Xt}=Bt.definition,Ot=bt[Ft];Xt&&Ot&&(bt[Ft]=Gt(Ot))}}return Et}_removeAllSchemas(Et,_t){for(const Ct in Et){const ct=Et[Ct];(!_t||_t.test(Ct))&&(typeof ct=="string"?delete Et[Ct]:ct&&!ct.meta&&(this._cache.delete(ct.schema),delete Et[Ct]))}}_addSchema(Et,_t,Ct,ct=this.opts.validateSchema,ft=this.opts.addUsedSchema){let bt;const{schemaId:Ft}=this.opts;if(typeof Et=="object")bt=Et[Ft];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof Et!="boolean")throw new Error("schema must be object or boolean")}let Bt=this._cache.get(Et);if(Bt!==void 0)return Bt;Ct=(0,f.normalizeId)(bt||Ct);const Xt=f.getSchemaRefs.call(this,Et,Ct);return Bt=new c.SchemaEnv({schema:Et,schemaId:Ft,meta:_t,baseId:Ct,localRefs:Xt}),this._cache.set(Bt.schema,Bt),ft&&!Ct.startsWith("#")&&(Ct&&this._checkUnique(Ct),this.refs[Ct]=Bt),ct&&this.validateSchema(Et,!0),Bt}_checkUnique(Et){if(this.schemas[Et]||this.refs[Et])throw new Error(`schema with key or id "${Et}" already exists`)}_compileSchemaEnv(Et){if(Et.meta?this._compileMetaSchema(Et):c.compileSchema.call(this,Et),!Et.validate)throw new Error("ajv implementation error");return Et.validate}_compileMetaSchema(Et){const _t=this.opts;this.opts=this._metaOpts;try{c.compileSchema.call(this,Et)}finally{this.opts=_t}}}rt.ValidationError=s.default,rt.MissingRefError=o.default,n.default=rt;function nt(vt,Et,_t,Ct="error"){for(const ct in vt){const ft=ct;ft in Et&&this.logger[Ct](`${_t}: option ${ct}. ${vt[ft]}`)}}function at(vt){return vt=(0,f.normalizeId)(vt),this.schemas[vt]||this.refs[vt]}function st(){const vt=this.opts.schemas;if(vt)if(Array.isArray(vt))this.addSchema(vt);else for(const Et in vt)this.addSchema(vt[Et],Et)}function ot(){for(const vt in this.opts.formats){const Et=this.opts.formats[vt];Et&&this.addFormat(vt,Et)}}function ut(vt){if(Array.isArray(vt)){this.addVocabulary(vt);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const Et in vt){const _t=vt[Et];_t.keyword||(_t.keyword=Et),this.addKeyword(_t)}}function ht(){const vt={...this.opts};for(const Et of ne)delete vt[Et];return vt}const dt={log(){},warn(){},error(){}};function pt(vt){if(vt===!1)return dt;if(vt===void 0)return console;if(vt.log&&vt.warn&&vt.error)return vt;throw new Error("logger must implement log, warn and error methods")}const yt=/^[a-z_$][a-z0-9_$:-]*$/i;function mt(vt,Et){const{RULES:_t}=this;if((0,H.eachItem)(vt,Ct=>{if(_t.keywords[Ct])throw new Error(`Keyword ${Ct} is already defined`);if(!yt.test(Ct))throw new Error(`Keyword ${Ct} has invalid name`)}),!!Et&&Et.$data&&!("code"in Et||"validate"in Et))throw new Error('$data keyword must have "code" or "validate" function')}function St(vt,Et,_t){var Ct;const ct=Et==null?void 0:Et.post;if(_t&&ct)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:ft}=this;let bt=ct?ft.post:ft.rules.find(({type:Bt})=>Bt===_t);if(bt||(bt={type:_t,rules:[]},ft.rules.push(bt)),ft.keywords[vt]=!0,!Et)return;const Ft={keyword:vt,definition:{...Et,type:(0,g.getJSONTypes)(Et.type),schemaType:(0,g.getJSONTypes)(Et.schemaType)}};Et.before?wt.call(this,bt,Ft,Et.before):bt.rules.push(Ft),ft.all[vt]=Ft,(Ct=Et.implements)===null||Ct===void 0||Ct.forEach(Bt=>this.addKeyword(Bt))}function wt(vt,Et,_t){const Ct=vt.rules.findIndex(ct=>ct.keyword===_t);Ct>=0?vt.rules.splice(Ct,0,Et):(vt.rules.push(Et),this.logger.warn(`rule ${_t} is not defined`))}function Rt(vt){let{metaSchema:Et}=vt;Et!==void 0&&(vt.$data&&this.opts.$data&&(Et=Gt(Et)),vt.validateSchema=this.compile(Et,!0))}const Lt={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function Gt(vt){return{anyOf:[vt,Lt]}}})(core$1)),core$1}var draft7={},core={},id={},hasRequiredId;function requireId(){if(hasRequiredId)return id;hasRequiredId=1,Object.defineProperty(id,"__esModule",{value:!0});const n={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};return id.default=n,id}var ref={},hasRequiredRef;function requireRef(){if(hasRequiredRef)return ref;hasRequiredRef=1,Object.defineProperty(ref,"__esModule",{value:!0}),ref.callRef=ref.getValidate=void 0;const n=requireRef_error(),e=requireCode(),i=requireCodegen(),s=requireNames(),o=requireCompile(),l=requireUtil(),c={keyword:"$ref",schemaType:"string",code(g){const{gen:H,schema:Y,it:ee}=g,{baseId:te,schemaEnv:ne,validateName:Ye,opts:xe,self:tt}=ee,{root:et}=ne;if((Y==="#"||Y==="#/")&&te===et.baseId)return rt();const it=o.resolveRef.call(tt,et,te,Y);if(it===void 0)throw new n.default(ee.opts.uriResolver,te,Y);if(it instanceof o.SchemaEnv)return nt(it);return at(it);function rt(){if(ne===et)return f(g,Ye,ne,ne.$async);const st=H.scopeValue("root",{ref:et});return f(g,(0,i._)`${st}.validate`,et,et.$async)}function nt(st){const ot=u(g,st);f(g,ot,st,st.$async)}function at(st){const ot=H.scopeValue("schema",xe.code.source===!0?{ref:st,code:(0,i.stringify)(st)}:{ref:st}),ut=H.name("valid"),ht=g.subschema({schema:st,dataTypes:[],schemaPath:i.nil,topSchemaRef:ot,errSchemaPath:Y},ut);g.mergeEvaluated(ht),g.ok(ut)}}};function u(g,H){const{gen:Y}=g;return H.validate?Y.scopeValue("validate",{ref:H.validate}):(0,i._)`${Y.scopeValue("wrapper",{ref:H})}.validate`}ref.getValidate=u;function f(g,H,Y,ee){const{gen:te,it:ne}=g,{allErrors:Ye,schemaEnv:xe,opts:tt}=ne,et=tt.passContext?s.default.this:i.nil;ee?it():rt();function it(){if(!xe.$async)throw new Error("async schema referenced by sync schema");const st=te.let("valid");te.try(()=>{te.code((0,i._)`await ${(0,e.callValidateCode)(g,H,et)}`),at(H),Ye||te.assign(st,!0)},ot=>{te.if((0,i._)`!(${ot} instanceof ${ne.ValidationError})`,()=>te.throw(ot)),nt(ot),Ye||te.assign(st,!1)}),g.ok(st)}function rt(){g.result((0,e.callValidateCode)(g,H,et),()=>at(H),()=>nt(H))}function nt(st){const ot=(0,i._)`${st}.errors`;te.assign(s.default.vErrors,(0,i._)`${s.default.vErrors} === null ? ${ot} : ${s.default.vErrors}.concat(${ot})`),te.assign(s.default.errors,(0,i._)`${s.default.vErrors}.length`)}function at(st){var ot;if(!ne.opts.unevaluated)return;const ut=(ot=Y==null?void 0:Y.validate)===null||ot===void 0?void 0:ot.evaluated;if(ne.props!==!0)if(ut&&!ut.dynamicProps)ut.props!==void 0&&(ne.props=l.mergeEvaluated.props(te,ut.props,ne.props));else{const ht=te.var("props",(0,i._)`${st}.evaluated.props`);ne.props=l.mergeEvaluated.props(te,ht,ne.props,i.Name)}if(ne.items!==!0)if(ut&&!ut.dynamicItems)ut.items!==void 0&&(ne.items=l.mergeEvaluated.items(te,ut.items,ne.items));else{const ht=te.var("items",(0,i._)`${st}.evaluated.items`);ne.items=l.mergeEvaluated.items(te,ht,ne.items,i.Name)}}}return ref.callRef=f,ref.default=c,ref}var hasRequiredCore;function requireCore(){if(hasRequiredCore)return core;hasRequiredCore=1,Object.defineProperty(core,"__esModule",{value:!0});const n=requireId(),e=requireRef(),i=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",n.default,e.default];return core.default=i,core}var validation={},limitNumber={},hasRequiredLimitNumber;function requireLimitNumber(){if(hasRequiredLimitNumber)return limitNumber;hasRequiredLimitNumber=1,Object.defineProperty(limitNumber,"__esModule",{value:!0});const n=requireCodegen(),e=n.operators,i={maximum:{okStr:"<=",ok:e.LTE,fail:e.GT},minimum:{okStr:">=",ok:e.GTE,fail:e.LT},exclusiveMaximum:{okStr:"<",ok:e.LT,fail:e.GTE},exclusiveMinimum:{okStr:">",ok:e.GT,fail:e.LTE}},s={message:({keyword:l,schemaCode:c})=>(0,n.str)`must be ${i[l].okStr} ${c}`,params:({keyword:l,schemaCode:c})=>(0,n._)`{comparison: ${i[l].okStr}, limit: ${c}}`},o={keyword:Object.keys(i),type:"number",schemaType:"number",$data:!0,error:s,code(l){const{keyword:c,data:u,schemaCode:f}=l;l.fail$data((0,n._)`${u} ${i[c].fail} ${f} || isNaN(${u})`)}};return limitNumber.default=o,limitNumber}var multipleOf={},hasRequiredMultipleOf;function requireMultipleOf(){if(hasRequiredMultipleOf)return multipleOf;hasRequiredMultipleOf=1,Object.defineProperty(multipleOf,"__esModule",{value:!0});const n=requireCodegen(),i={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:{message:({schemaCode:s})=>(0,n.str)`must be multiple of ${s}`,params:({schemaCode:s})=>(0,n._)`{multipleOf: ${s}}`},code(s){const{gen:o,data:l,schemaCode:c,it:u}=s,f=u.opts.multipleOfPrecision,g=o.let("res"),H=f?(0,n._)`Math.abs(Math.round(${g}) - ${g}) > 1e-${f}`:(0,n._)`${g} !== parseInt(${g})`;s.fail$data((0,n._)`(${c} === 0 || (${g} = ${l}/${c}, ${H}))`)}};return multipleOf.default=i,multipleOf}var limitLength={},ucs2length={},hasRequiredUcs2length;function requireUcs2length(){if(hasRequiredUcs2length)return ucs2length;hasRequiredUcs2length=1,Object.defineProperty(ucs2length,"__esModule",{value:!0});function n(e){const i=e.length;let s=0,o=0,l;for(;o<i;)s++,l=e.charCodeAt(o++),l>=55296&&l<=56319&&o<i&&(l=e.charCodeAt(o),(l&64512)===56320&&o++);return s}return ucs2length.default=n,n.code='require("ajv/dist/runtime/ucs2length").default',ucs2length}var hasRequiredLimitLength;function requireLimitLength(){if(hasRequiredLimitLength)return limitLength;hasRequiredLimitLength=1,Object.defineProperty(limitLength,"__esModule",{value:!0});const n=requireCodegen(),e=requireUtil(),i=requireUcs2length(),o={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:{message({keyword:l,schemaCode:c}){const u=l==="maxLength"?"more":"fewer";return(0,n.str)`must NOT have ${u} than ${c} characters`},params:({schemaCode:l})=>(0,n._)`{limit: ${l}}`},code(l){const{keyword:c,data:u,schemaCode:f,it:g}=l,H=c==="maxLength"?n.operators.GT:n.operators.LT,Y=g.opts.unicode===!1?(0,n._)`${u}.length`:(0,n._)`${(0,e.useFunc)(l.gen,i.default)}(${u})`;l.fail$data((0,n._)`${Y} ${H} ${f}`)}};return limitLength.default=o,limitLength}var pattern={},hasRequiredPattern;function requirePattern(){if(hasRequiredPattern)return pattern;hasRequiredPattern=1,Object.defineProperty(pattern,"__esModule",{value:!0});const n=requireCode(),e=requireCodegen(),s={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:{message:({schemaCode:o})=>(0,e.str)`must match pattern "${o}"`,params:({schemaCode:o})=>(0,e._)`{pattern: ${o}}`},code(o){const{data:l,$data:c,schema:u,schemaCode:f,it:g}=o,H=g.opts.unicodeRegExp?"u":"",Y=c?(0,e._)`(new RegExp(${f}, ${H}))`:(0,n.usePattern)(o,u);o.fail$data((0,e._)`!${Y}.test(${l})`)}};return pattern.default=s,pattern}var limitProperties={},hasRequiredLimitProperties;function requireLimitProperties(){if(hasRequiredLimitProperties)return limitProperties;hasRequiredLimitProperties=1,Object.defineProperty(limitProperties,"__esModule",{value:!0});const n=requireCodegen(),i={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:{message({keyword:s,schemaCode:o}){const l=s==="maxProperties"?"more":"fewer";return(0,n.str)`must NOT have ${l} than ${o} properties`},params:({schemaCode:s})=>(0,n._)`{limit: ${s}}`},code(s){const{keyword:o,data:l,schemaCode:c}=s,u=o==="maxProperties"?n.operators.GT:n.operators.LT;s.fail$data((0,n._)`Object.keys(${l}).length ${u} ${c}`)}};return limitProperties.default=i,limitProperties}var required$4={},hasRequiredRequired;function requireRequired(){if(hasRequiredRequired)return required$4;hasRequiredRequired=1,Object.defineProperty(required$4,"__esModule",{value:!0});const n=requireCode(),e=requireCodegen(),i=requireUtil(),o={keyword:"required",type:"object",schemaType:"array",$data:!0,error:{message:({params:{missingProperty:l}})=>(0,e.str)`must have required property '${l}'`,params:({params:{missingProperty:l}})=>(0,e._)`{missingProperty: ${l}}`},code(l){const{gen:c,schema:u,schemaCode:f,data:g,$data:H,it:Y}=l,{opts:ee}=Y;if(!H&&u.length===0)return;const te=u.length>=ee.loopRequired;if(Y.allErrors?ne():Ye(),ee.strictRequired){const et=l.parentSchema.properties,{definedProperties:it}=l.it;for(const rt of u)if((et==null?void 0:et[rt])===void 0&&!it.has(rt)){const nt=Y.schemaEnv.baseId+Y.errSchemaPath,at=`required property "${rt}" is not defined at "${nt}" (strictRequired)`;(0,i.checkStrictMode)(Y,at,Y.opts.strictRequired)}}function ne(){if(te||H)l.block$data(e.nil,xe);else for(const et of u)(0,n.checkReportMissingProp)(l,et)}function Ye(){const et=c.let("missing");if(te||H){const it=c.let("valid",!0);l.block$data(it,()=>tt(et,it)),l.ok(it)}else c.if((0,n.checkMissingProp)(l,u,et)),(0,n.reportMissingProp)(l,et),c.else()}function xe(){c.forOf("prop",f,et=>{l.setParams({missingProperty:et}),c.if((0,n.noPropertyInData)(c,g,et,ee.ownProperties),()=>l.error())})}function tt(et,it){l.setParams({missingProperty:et}),c.forOf(et,f,()=>{c.assign(it,(0,n.propertyInData)(c,g,et,ee.ownProperties)),c.if((0,e.not)(it),()=>{l.error(),c.break()})},e.nil)}}};return required$4.default=o,required$4}var limitItems={},hasRequiredLimitItems;function requireLimitItems(){if(hasRequiredLimitItems)return limitItems;hasRequiredLimitItems=1,Object.defineProperty(limitItems,"__esModule",{value:!0});const n=requireCodegen(),i={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:{message({keyword:s,schemaCode:o}){const l=s==="maxItems"?"more":"fewer";return(0,n.str)`must NOT have ${l} than ${o} items`},params:({schemaCode:s})=>(0,n._)`{limit: ${s}}`},code(s){const{keyword:o,data:l,schemaCode:c}=s,u=o==="maxItems"?n.operators.GT:n.operators.LT;s.fail$data((0,n._)`${l}.length ${u} ${c}`)}};return limitItems.default=i,limitItems}var uniqueItems={},equal={},hasRequiredEqual;function requireEqual(){if(hasRequiredEqual)return equal;hasRequiredEqual=1,Object.defineProperty(equal,"__esModule",{value:!0});const n=requireFastDeepEqual();return n.code='require("ajv/dist/runtime/equal").default',equal.default=n,equal}var hasRequiredUniqueItems;function requireUniqueItems(){if(hasRequiredUniqueItems)return uniqueItems;hasRequiredUniqueItems=1,Object.defineProperty(uniqueItems,"__esModule",{value:!0});const n=requireDataType(),e=requireCodegen(),i=requireUtil(),s=requireEqual(),l={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:{message:({params:{i:c,j:u}})=>(0,e.str)`must NOT have duplicate items (items ## ${u} and ${c} are identical)`,params:({params:{i:c,j:u}})=>(0,e._)`{i: ${c}, j: ${u}}`},code(c){const{gen:u,data:f,$data:g,schema:H,parentSchema:Y,schemaCode:ee,it:te}=c;if(!g&&!H)return;const ne=u.let("valid"),Ye=Y.items?(0,n.getSchemaTypes)(Y.items):[];c.block$data(ne,xe,(0,e._)`${ee} === false`),c.ok(ne);function xe(){const rt=u.let("i",(0,e._)`${f}.length`),nt=u.let("j");c.setParams({i:rt,j:nt}),u.assign(ne,!0),u.if((0,e._)`${rt} > 1`,()=>(tt()?et:it)(rt,nt))}function tt(){return Ye.length>0&&!Ye.some(rt=>rt==="object"||rt==="array")}function et(rt,nt){const at=u.name("item"),st=(0,n.checkDataTypes)(Ye,at,te.opts.strictNumbers,n.DataType.Wrong),ot=u.const("indices",(0,e._)`{}`);u.for((0,e._)`;${rt}--;`,()=>{u.let(at,(0,e._)`${f}[${rt}]`),u.if(st,(0,e._)`continue`),Ye.length>1&&u.if((0,e._)`typeof ${at} == "string"`,(0,e._)`${at} += "_"`),u.if((0,e._)`typeof ${ot}[${at}] == "number"`,()=>{u.assign(nt,(0,e._)`${ot}[${at}]`),c.error(),u.assign(ne,!1).break()}).code((0,e._)`${ot}[${at}] = ${rt}`)})}function it(rt,nt){const at=(0,i.useFunc)(u,s.default),st=u.name("outer");u.label(st).for((0,e._)`;${rt}--;`,()=>u.for((0,e._)`${nt} = ${rt}; ${nt}--;`,()=>u.if((0,e._)`${at}(${f}[${rt}], ${f}[${nt}])`,()=>{c.error(),u.assign(ne,!1).break(st)})))}}};return uniqueItems.default=l,uniqueItems}var _const={},hasRequired_const;function require_const(){if(hasRequired_const)return _const;hasRequired_const=1,Object.defineProperty(_const,"__esModule",{value:!0});const n=requireCodegen(),e=requireUtil(),i=requireEqual(),o={keyword:"const",$data:!0,error:{message:"must be equal to constant",params:({schemaCode:l})=>(0,n._)`{allowedValue: ${l}}`},code(l){const{gen:c,data:u,$data:f,schemaCode:g,schema:H}=l;f||H&&typeof H=="object"?l.fail$data((0,n._)`!${(0,e.useFunc)(c,i.default)}(${u}, ${g})`):l.fail((0,n._)`${H} !== ${u}`)}};return _const.default=o,_const}var _enum={},hasRequired_enum;function require_enum(){if(hasRequired_enum)return _enum;hasRequired_enum=1,Object.defineProperty(_enum,"__esModule",{value:!0});const n=requireCodegen(),e=requireUtil(),i=requireEqual(),o={keyword:"enum",schemaType:"array",$data:!0,error:{message:"must be equal to one of the allowed values",params:({schemaCode:l})=>(0,n._)`{allowedValues: ${l}}`},code(l){const{gen:c,data:u,$data:f,schema:g,schemaCode:H,it:Y}=l;if(!f&&g.length===0)throw new Error("enum must have non-empty array");const ee=g.length>=Y.opts.loopEnum;let te;const ne=()=>te??(te=(0,e.useFunc)(c,i.default));let Ye;if(ee||f)Ye=c.let("valid"),l.block$data(Ye,xe);else{if(!Array.isArray(g))throw new Error("ajv implementation error");const et=c.const("vSchema",H);Ye=(0,n.or)(...g.map((it,rt)=>tt(et,rt)))}l.pass(Ye);function xe(){c.assign(Ye,!1),c.forOf("v",H,et=>c.if((0,n._)`${ne()}(${u}, ${et})`,()=>c.assign(Ye,!0).break()))}function tt(et,it){const rt=g[it];return typeof rt=="object"&&rt!==null?(0,n._)`${ne()}(${u}, ${et}[${it}])`:(0,n._)`${u} === ${rt}`}}};return _enum.default=o,_enum}var hasRequiredValidation;function requireValidation(){if(hasRequiredValidation)return validation;hasRequiredValidation=1,Object.defineProperty(validation,"__esModule",{value:!0});const n=requireLimitNumber(),e=requireMultipleOf(),i=requireLimitLength(),s=requirePattern(),o=requireLimitProperties(),l=requireRequired(),c=requireLimitItems(),u=requireUniqueItems(),f=require_const(),g=require_enum(),H=[n.default,e.default,i.default,s.default,o.default,l.default,c.default,u.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},f.default,g.default];return validation.default=H,validation}var applicator={},additionalItems={},hasRequiredAdditionalItems;function requireAdditionalItems(){if(hasRequiredAdditionalItems)return additionalItems;hasRequiredAdditionalItems=1,Object.defineProperty(additionalItems,"__esModule",{value:!0}),additionalItems.validateAdditionalItems=void 0;const n=requireCodegen(),e=requireUtil(),s={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:{message:({params:{len:l}})=>(0,n.str)`must NOT have more than ${l} items`,params:({params:{len:l}})=>(0,n._)`{limit: ${l}}`},code(l){const{parentSchema:c,it:u}=l,{items:f}=c;if(!Array.isArray(f)){(0,e.checkStrictMode)(u,'"additionalItems" is ignored when "items" is not an array of schemas');return}o(l,f)}};function o(l,c){const{gen:u,schema:f,data:g,keyword:H,it:Y}=l;Y.items=!0;const ee=u.const("len",(0,n._)`${g}.length`);if(f===!1)l.setParams({len:c.length}),l.pass((0,n._)`${ee} <= ${c.length}`);else if(typeof f=="object"&&!(0,e.alwaysValidSchema)(Y,f)){const ne=u.var("valid",(0,n._)`${ee} <= ${c.length}`);u.if((0,n.not)(ne),()=>te(ne)),l.ok(ne)}function te(ne){u.forRange("i",c.length,ee,Ye=>{l.subschema({keyword:H,dataProp:Ye,dataPropType:e.Type.Num},ne),Y.allErrors||u.if((0,n.not)(ne),()=>u.break())})}}return additionalItems.validateAdditionalItems=o,additionalItems.default=s,additionalItems}var prefixItems={},items$1={},hasRequiredItems;function requireItems(){if(hasRequiredItems)return items$1;hasRequiredItems=1,Object.defineProperty(items$1,"__esModule",{value:!0}),items$1.validateTuple=void 0;const n=requireCodegen(),e=requireUtil(),i=requireCode(),s={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(l){const{schema:c,it:u}=l;if(Array.isArray(c))return o(l,"additionalItems",c);u.items=!0,!(0,e.alwaysValidSchema)(u,c)&&l.ok((0,i.validateArray)(l))}};function o(l,c,u=l.schema){const{gen:f,parentSchema:g,data:H,keyword:Y,it:ee}=l;Ye(g),ee.opts.unevaluated&&u.length&&ee.items!==!0&&(ee.items=e.mergeEvaluated.items(f,u.length,ee.items));const te=f.name("valid"),ne=f.const("len",(0,n._)`${H}.length`);u.forEach((xe,tt)=>{(0,e.alwaysValidSchema)(ee,xe)||(f.if((0,n._)`${ne} > ${tt}`,()=>l.subschema({keyword:Y,schemaProp:tt,dataProp:tt},te)),l.ok(te))});function Ye(xe){const{opts:tt,errSchemaPath:et}=ee,it=u.length,rt=it===xe.minItems&&(it===xe.maxItems||xe[c]===!1);if(tt.strictTuples&&!rt){const nt=`"${Y}" is ${it}-tuple, but minItems or maxItems/${c} are not specified or different at path "${et}"`;(0,e.checkStrictMode)(ee,nt,tt.strictTuples)}}}return items$1.validateTuple=o,items$1.default=s,items$1}var hasRequiredPrefixItems;function requirePrefixItems(){if(hasRequiredPrefixItems)return prefixItems;hasRequiredPrefixItems=1,Object.defineProperty(prefixItems,"__esModule",{value:!0});const n=requireItems(),e={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:i=>(0,n.validateTuple)(i,"items")};return prefixItems.default=e,prefixItems}var items2020={},hasRequiredItems2020;function requireItems2020(){if(hasRequiredItems2020)return items2020;hasRequiredItems2020=1,Object.defineProperty(items2020,"__esModule",{value:!0});const n=requireCodegen(),e=requireUtil(),i=requireCode(),s=requireAdditionalItems(),l={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:{message:({params:{len:c}})=>(0,n.str)`must NOT have more than ${c} items`,params:({params:{len:c}})=>(0,n._)`{limit: ${c}}`},code(c){const{schema:u,parentSchema:f,it:g}=c,{prefixItems:H}=f;g.items=!0,!(0,e.alwaysValidSchema)(g,u)&&(H?(0,s.validateAdditionalItems)(c,H):c.ok((0,i.validateArray)(c)))}};return items2020.default=l,items2020}var contains={},hasRequiredContains;function requireContains(){if(hasRequiredContains)return contains;hasRequiredContains=1,Object.defineProperty(contains,"__esModule",{value:!0});const n=requireCodegen(),e=requireUtil(),s={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:{message:({params:{min:o,max:l}})=>l===void 0?(0,n.str)`must contain at least ${o} valid item(s)`:(0,n.str)`must contain at least ${o} and no more than ${l} valid item(s)`,params:({params:{min:o,max:l}})=>l===void 0?(0,n._)`{minContains: ${o}}`:(0,n._)`{minContains: ${o}, maxContains: ${l}}`},code(o){const{gen:l,schema:c,parentSchema:u,data:f,it:g}=o;let H,Y;const{minContains:ee,maxContains:te}=u;g.opts.next?(H=ee===void 0?1:ee,Y=te):H=1;const ne=l.const("len",(0,n._)`${f}.length`);if(o.setParams({min:H,max:Y}),Y===void 0&&H===0){(0,e.checkStrictMode)(g,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(Y!==void 0&&H>Y){(0,e.checkStrictMode)(g,'"minContains" > "maxContains" is always invalid'),o.fail();return}if((0,e.alwaysValidSchema)(g,c)){let it=(0,n._)`${ne} >= ${H}`;Y!==void 0&&(it=(0,n._)`${it} && ${ne} <= ${Y}`),o.pass(it);return}g.items=!0;const Ye=l.name("valid");Y===void 0&&H===1?tt(Ye,()=>l.if(Ye,()=>l.break())):H===0?(l.let(Ye,!0),Y!==void 0&&l.if((0,n._)`${f}.length > 0`,xe)):(l.let(Ye,!1),xe()),o.result(Ye,()=>o.reset());function xe(){const it=l.name("_valid"),rt=l.let("count",0);tt(it,()=>l.if(it,()=>et(rt)))}function tt(it,rt){l.forRange("i",0,ne,nt=>{o.subschema({keyword:"contains",dataProp:nt,dataPropType:e.Type.Num,compositeRule:!0},it),rt()})}function et(it){l.code((0,n._)`${it}++`),Y===void 0?l.if((0,n._)`${it} >= ${H}`,()=>l.assign(Ye,!0).break()):(l.if((0,n._)`${it} > ${Y}`,()=>l.assign(Ye,!1).break()),H===1?l.assign(Ye,!0):l.if((0,n._)`${it} >= ${H}`,()=>l.assign(Ye,!0)))}}};return contains.default=s,contains}var dependencies={},hasRequiredDependencies;function requireDependencies(){return hasRequiredDependencies||(hasRequiredDependencies=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateSchemaDeps=n.validatePropertyDeps=n.error=void 0;const e=requireCodegen(),i=requireUtil(),s=requireCode();n.error={message:({params:{property:f,depsCount:g,deps:H}})=>{const Y=g===1?"property":"properties";return(0,e.str)`must have ${Y} ${H} when property ${f} is present`},params:({params:{property:f,depsCount:g,deps:H,missingProperty:Y}})=>(0,e._)`{property: ${f},
    missingProperty: ${Y},
    depsCount: ${g},
    deps: ${H}}`};const o={keyword:"dependencies",type:"object",schemaType:"object",error:n.error,code(f){const[g,H]=l(f);c(f,g),u(f,H)}};function l({schema:f}){const g={},H={};for(const Y in f){if(Y==="__proto__")continue;const ee=Array.isArray(f[Y])?g:H;ee[Y]=f[Y]}return[g,H]}function c(f,g=f.schema){const{gen:H,data:Y,it:ee}=f;if(Object.keys(g).length===0)return;const te=H.let("missing");for(const ne in g){const Ye=g[ne];if(Ye.length===0)continue;const xe=(0,s.propertyInData)(H,Y,ne,ee.opts.ownProperties);f.setParams({property:ne,depsCount:Ye.length,deps:Ye.join(", ")}),ee.allErrors?H.if(xe,()=>{for(const tt of Ye)(0,s.checkReportMissingProp)(f,tt)}):(H.if((0,e._)`${xe} && (${(0,s.checkMissingProp)(f,Ye,te)})`),(0,s.reportMissingProp)(f,te),H.else())}}n.validatePropertyDeps=c;function u(f,g=f.schema){const{gen:H,data:Y,keyword:ee,it:te}=f,ne=H.name("valid");for(const Ye in g)(0,i.alwaysValidSchema)(te,g[Ye])||(H.if((0,s.propertyInData)(H,Y,Ye,te.opts.ownProperties),()=>{const xe=f.subschema({keyword:ee,schemaProp:Ye},ne);f.mergeValidEvaluated(xe,ne)},()=>H.var(ne,!0)),f.ok(ne))}n.validateSchemaDeps=u,n.default=o})(dependencies)),dependencies}var propertyNames={},hasRequiredPropertyNames;function requirePropertyNames(){if(hasRequiredPropertyNames)return propertyNames;hasRequiredPropertyNames=1,Object.defineProperty(propertyNames,"__esModule",{value:!0});const n=requireCodegen(),e=requireUtil(),s={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:{message:"property name must be valid",params:({params:o})=>(0,n._)`{propertyName: ${o.propertyName}}`},code(o){const{gen:l,schema:c,data:u,it:f}=o;if((0,e.alwaysValidSchema)(f,c))return;const g=l.name("valid");l.forIn("key",u,H=>{o.setParams({propertyName:H}),o.subschema({keyword:"propertyNames",data:H,dataTypes:["string"],propertyName:H,compositeRule:!0},g),l.if((0,n.not)(g),()=>{o.error(!0),f.allErrors||l.break()})}),o.ok(g)}};return propertyNames.default=s,propertyNames}var additionalProperties$3={},hasRequiredAdditionalProperties;function requireAdditionalProperties(){if(hasRequiredAdditionalProperties)return additionalProperties$3;hasRequiredAdditionalProperties=1,Object.defineProperty(additionalProperties$3,"__esModule",{value:!0});const n=requireCode(),e=requireCodegen(),i=requireNames(),s=requireUtil(),l={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:{message:"must NOT have additional properties",params:({params:c})=>(0,e._)`{additionalProperty: ${c.additionalProperty}}`},code(c){const{gen:u,schema:f,parentSchema:g,data:H,errsCount:Y,it:ee}=c;if(!Y)throw new Error("ajv implementation error");const{allErrors:te,opts:ne}=ee;if(ee.props=!0,ne.removeAdditional!=="all"&&(0,s.alwaysValidSchema)(ee,f))return;const Ye=(0,n.allSchemaProperties)(g.properties),xe=(0,n.allSchemaProperties)(g.patternProperties);tt(),c.ok((0,e._)`${Y} === ${i.default.errors}`);function tt(){u.forIn("key",H,at=>{!Ye.length&&!xe.length?rt(at):u.if(et(at),()=>rt(at))})}function et(at){let st;if(Ye.length>8){const ot=(0,s.schemaRefOrVal)(ee,g.properties,"properties");st=(0,n.isOwnProperty)(u,ot,at)}else Ye.length?st=(0,e.or)(...Ye.map(ot=>(0,e._)`${at} === ${ot}`)):st=e.nil;return xe.length&&(st=(0,e.or)(st,...xe.map(ot=>(0,e._)`${(0,n.usePattern)(c,ot)}.test(${at})`))),(0,e.not)(st)}function it(at){u.code((0,e._)`delete ${H}[${at}]`)}function rt(at){if(ne.removeAdditional==="all"||ne.removeAdditional&&f===!1){it(at);return}if(f===!1){c.setParams({additionalProperty:at}),c.error(),te||u.break();return}if(typeof f=="object"&&!(0,s.alwaysValidSchema)(ee,f)){const st=u.name("valid");ne.removeAdditional==="failing"?(nt(at,st,!1),u.if((0,e.not)(st),()=>{c.reset(),it(at)})):(nt(at,st),te||u.if((0,e.not)(st),()=>u.break()))}}function nt(at,st,ot){const ut={keyword:"additionalProperties",dataProp:at,dataPropType:s.Type.Str};ot===!1&&Object.assign(ut,{compositeRule:!0,createErrors:!1,allErrors:!1}),c.subschema(ut,st)}}};return additionalProperties$3.default=l,additionalProperties$3}var properties$5={},hasRequiredProperties;function requireProperties(){if(hasRequiredProperties)return properties$5;hasRequiredProperties=1,Object.defineProperty(properties$5,"__esModule",{value:!0});const n=requireValidate(),e=requireCode(),i=requireUtil(),s=requireAdditionalProperties(),o={keyword:"properties",type:"object",schemaType:"object",code(l){const{gen:c,schema:u,parentSchema:f,data:g,it:H}=l;H.opts.removeAdditional==="all"&&f.additionalProperties===void 0&&s.default.code(new n.KeywordCxt(H,s.default,"additionalProperties"));const Y=(0,e.allSchemaProperties)(u);for(const xe of Y)H.definedProperties.add(xe);H.opts.unevaluated&&Y.length&&H.props!==!0&&(H.props=i.mergeEvaluated.props(c,(0,i.toHash)(Y),H.props));const ee=Y.filter(xe=>!(0,i.alwaysValidSchema)(H,u[xe]));if(ee.length===0)return;const te=c.name("valid");for(const xe of ee)ne(xe)?Ye(xe):(c.if((0,e.propertyInData)(c,g,xe,H.opts.ownProperties)),Ye(xe),H.allErrors||c.else().var(te,!0),c.endIf()),l.it.definedProperties.add(xe),l.ok(te);function ne(xe){return H.opts.useDefaults&&!H.compositeRule&&u[xe].default!==void 0}function Ye(xe){l.subschema({keyword:"properties",schemaProp:xe,dataProp:xe},te)}}};return properties$5.default=o,properties$5}var patternProperties={},hasRequiredPatternProperties;function requirePatternProperties(){if(hasRequiredPatternProperties)return patternProperties;hasRequiredPatternProperties=1,Object.defineProperty(patternProperties,"__esModule",{value:!0});const n=requireCode(),e=requireCodegen(),i=requireUtil(),s=requireUtil(),o={keyword:"patternProperties",type:"object",schemaType:"object",code(l){const{gen:c,schema:u,data:f,parentSchema:g,it:H}=l,{opts:Y}=H,ee=(0,n.allSchemaProperties)(u),te=ee.filter(rt=>(0,i.alwaysValidSchema)(H,u[rt]));if(ee.length===0||te.length===ee.length&&(!H.opts.unevaluated||H.props===!0))return;const ne=Y.strictSchema&&!Y.allowMatchingProperties&&g.properties,Ye=c.name("valid");H.props!==!0&&!(H.props instanceof e.Name)&&(H.props=(0,s.evaluatedPropsToName)(c,H.props));const{props:xe}=H;tt();function tt(){for(const rt of ee)ne&&et(rt),H.allErrors?it(rt):(c.var(Ye,!0),it(rt),c.if(Ye))}function et(rt){for(const nt in ne)new RegExp(rt).test(nt)&&(0,i.checkStrictMode)(H,`property ${nt} matches pattern ${rt} (use allowMatchingProperties)`)}function it(rt){c.forIn("key",f,nt=>{c.if((0,e._)`${(0,n.usePattern)(l,rt)}.test(${nt})`,()=>{const at=te.includes(rt);at||l.subschema({keyword:"patternProperties",schemaProp:rt,dataProp:nt,dataPropType:s.Type.Str},Ye),H.opts.unevaluated&&xe!==!0?c.assign((0,e._)`${xe}[${nt}]`,!0):!at&&!H.allErrors&&c.if((0,e.not)(Ye),()=>c.break())})})}}};return patternProperties.default=o,patternProperties}var not={},hasRequiredNot;function requireNot(){if(hasRequiredNot)return not;hasRequiredNot=1,Object.defineProperty(not,"__esModule",{value:!0});const n=requireUtil(),e={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(i){const{gen:s,schema:o,it:l}=i;if((0,n.alwaysValidSchema)(l,o)){i.fail();return}const c=s.name("valid");i.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},c),i.failResult(c,()=>i.reset(),()=>i.error())},error:{message:"must NOT be valid"}};return not.default=e,not}var anyOf={},hasRequiredAnyOf;function requireAnyOf(){if(hasRequiredAnyOf)return anyOf;hasRequiredAnyOf=1,Object.defineProperty(anyOf,"__esModule",{value:!0});const e={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:requireCode().validateUnion,error:{message:"must match a schema in anyOf"}};return anyOf.default=e,anyOf}var oneOf={},hasRequiredOneOf;function requireOneOf(){if(hasRequiredOneOf)return oneOf;hasRequiredOneOf=1,Object.defineProperty(oneOf,"__esModule",{value:!0});const n=requireCodegen(),e=requireUtil(),s={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:{message:"must match exactly one schema in oneOf",params:({params:o})=>(0,n._)`{passingSchemas: ${o.passing}}`},code(o){const{gen:l,schema:c,parentSchema:u,it:f}=o;if(!Array.isArray(c))throw new Error("ajv implementation error");if(f.opts.discriminator&&u.discriminator)return;const g=c,H=l.let("valid",!1),Y=l.let("passing",null),ee=l.name("_valid");o.setParams({passing:Y}),l.block(te),o.result(H,()=>o.reset(),()=>o.error(!0));function te(){g.forEach((ne,Ye)=>{let xe;(0,e.alwaysValidSchema)(f,ne)?l.var(ee,!0):xe=o.subschema({keyword:"oneOf",schemaProp:Ye,compositeRule:!0},ee),Ye>0&&l.if((0,n._)`${ee} && ${H}`).assign(H,!1).assign(Y,(0,n._)`[${Y}, ${Ye}]`).else(),l.if(ee,()=>{l.assign(H,!0),l.assign(Y,Ye),xe&&o.mergeEvaluated(xe,n.Name)})})}}};return oneOf.default=s,oneOf}var allOf={},hasRequiredAllOf;function requireAllOf(){if(hasRequiredAllOf)return allOf;hasRequiredAllOf=1,Object.defineProperty(allOf,"__esModule",{value:!0});const n=requireUtil(),e={keyword:"allOf",schemaType:"array",code(i){const{gen:s,schema:o,it:l}=i;if(!Array.isArray(o))throw new Error("ajv implementation error");const c=s.name("valid");o.forEach((u,f)=>{if((0,n.alwaysValidSchema)(l,u))return;const g=i.subschema({keyword:"allOf",schemaProp:f},c);i.ok(c),i.mergeEvaluated(g)})}};return allOf.default=e,allOf}var _if={},hasRequired_if;function require_if(){if(hasRequired_if)return _if;hasRequired_if=1,Object.defineProperty(_if,"__esModule",{value:!0});const n=requireCodegen(),e=requireUtil(),s={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:{message:({params:l})=>(0,n.str)`must match "${l.ifClause}" schema`,params:({params:l})=>(0,n._)`{failingKeyword: ${l.ifClause}}`},code(l){const{gen:c,parentSchema:u,it:f}=l;u.then===void 0&&u.else===void 0&&(0,e.checkStrictMode)(f,'"if" without "then" and "else" is ignored');const g=o(f,"then"),H=o(f,"else");if(!g&&!H)return;const Y=c.let("valid",!0),ee=c.name("_valid");if(te(),l.reset(),g&&H){const Ye=c.let("ifClause");l.setParams({ifClause:Ye}),c.if(ee,ne("then",Ye),ne("else",Ye))}else g?c.if(ee,ne("then")):c.if((0,n.not)(ee),ne("else"));l.pass(Y,()=>l.error(!0));function te(){const Ye=l.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},ee);l.mergeEvaluated(Ye)}function ne(Ye,xe){return()=>{const tt=l.subschema({keyword:Ye},ee);c.assign(Y,ee),l.mergeValidEvaluated(tt,Y),xe?c.assign(xe,(0,n._)`${Ye}`):l.setParams({ifClause:Ye})}}}};function o(l,c){const u=l.schema[c];return u!==void 0&&!(0,e.alwaysValidSchema)(l,u)}return _if.default=s,_if}var thenElse={},hasRequiredThenElse;function requireThenElse(){if(hasRequiredThenElse)return thenElse;hasRequiredThenElse=1,Object.defineProperty(thenElse,"__esModule",{value:!0});const n=requireUtil(),e={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:i,parentSchema:s,it:o}){s.if===void 0&&(0,n.checkStrictMode)(o,`"${i}" without "if" is ignored`)}};return thenElse.default=e,thenElse}var hasRequiredApplicator;function requireApplicator(){if(hasRequiredApplicator)return applicator;hasRequiredApplicator=1,Object.defineProperty(applicator,"__esModule",{value:!0});const n=requireAdditionalItems(),e=requirePrefixItems(),i=requireItems(),s=requireItems2020(),o=requireContains(),l=requireDependencies(),c=requirePropertyNames(),u=requireAdditionalProperties(),f=requireProperties(),g=requirePatternProperties(),H=requireNot(),Y=requireAnyOf(),ee=requireOneOf(),te=requireAllOf(),ne=require_if(),Ye=requireThenElse();function xe(tt=!1){const et=[H.default,Y.default,ee.default,te.default,ne.default,Ye.default,c.default,u.default,l.default,f.default,g.default];return tt?et.push(e.default,s.default):et.push(n.default,i.default),et.push(o.default),et}return applicator.default=xe,applicator}var format$1={},format={},hasRequiredFormat$1;function requireFormat$1(){if(hasRequiredFormat$1)return format;hasRequiredFormat$1=1,Object.defineProperty(format,"__esModule",{value:!0});const n=requireCodegen(),i={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:{message:({schemaCode:s})=>(0,n.str)`must match format "${s}"`,params:({schemaCode:s})=>(0,n._)`{format: ${s}}`},code(s,o){const{gen:l,data:c,$data:u,schema:f,schemaCode:g,it:H}=s,{opts:Y,errSchemaPath:ee,schemaEnv:te,self:ne}=H;if(!Y.validateFormats)return;u?Ye():xe();function Ye(){const tt=l.scopeValue("formats",{ref:ne.formats,code:Y.code.formats}),et=l.const("fDef",(0,n._)`${tt}[${g}]`),it=l.let("fType"),rt=l.let("format");l.if((0,n._)`typeof ${et} == "object" && !(${et} instanceof RegExp)`,()=>l.assign(it,(0,n._)`${et}.type || "string"`).assign(rt,(0,n._)`${et}.validate`),()=>l.assign(it,(0,n._)`"string"`).assign(rt,et)),s.fail$data((0,n.or)(nt(),at()));function nt(){return Y.strictSchema===!1?n.nil:(0,n._)`${g} && !${rt}`}function at(){const st=te.$async?(0,n._)`(${et}.async ? await ${rt}(${c}) : ${rt}(${c}))`:(0,n._)`${rt}(${c})`,ot=(0,n._)`(typeof ${rt} == "function" ? ${st} : ${rt}.test(${c}))`;return(0,n._)`${rt} && ${rt} !== true && ${it} === ${o} && !${ot}`}}function xe(){const tt=ne.formats[f];if(!tt){nt();return}if(tt===!0)return;const[et,it,rt]=at(tt);et===o&&s.pass(st());function nt(){if(Y.strictSchema===!1){ne.logger.warn(ot());return}throw new Error(ot());function ot(){return`unknown format "${f}" ignored in schema at path "${ee}"`}}function at(ot){const ut=ot instanceof RegExp?(0,n.regexpCode)(ot):Y.code.formats?(0,n._)`${Y.code.formats}${(0,n.getProperty)(f)}`:void 0,ht=l.scopeValue("formats",{key:f,ref:ot,code:ut});return typeof ot=="object"&&!(ot instanceof RegExp)?[ot.type||"string",ot.validate,(0,n._)`${ht}.validate`]:["string",ot,ht]}function st(){if(typeof tt=="object"&&!(tt instanceof RegExp)&&tt.async){if(!te.$async)throw new Error("async format in sync schema");return(0,n._)`await ${rt}(${c})`}return typeof it=="function"?(0,n._)`${rt}(${c})`:(0,n._)`${rt}.test(${c})`}}}};return format.default=i,format}var hasRequiredFormat;function requireFormat(){if(hasRequiredFormat)return format$1;hasRequiredFormat=1,Object.defineProperty(format$1,"__esModule",{value:!0});const e=[requireFormat$1().default];return format$1.default=e,format$1}var metadata={},hasRequiredMetadata;function requireMetadata(){return hasRequiredMetadata||(hasRequiredMetadata=1,Object.defineProperty(metadata,"__esModule",{value:!0}),metadata.contentVocabulary=metadata.metadataVocabulary=void 0,metadata.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"],metadata.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]),metadata}var hasRequiredDraft7;function requireDraft7(){if(hasRequiredDraft7)return draft7;hasRequiredDraft7=1,Object.defineProperty(draft7,"__esModule",{value:!0});const n=requireCore(),e=requireValidation(),i=requireApplicator(),s=requireFormat(),o=requireMetadata(),l=[n.default,e.default,(0,i.default)(),s.default,o.metadataVocabulary,o.contentVocabulary];return draft7.default=l,draft7}var discriminator={},types={},hasRequiredTypes;function requireTypes(){if(hasRequiredTypes)return types;hasRequiredTypes=1,Object.defineProperty(types,"__esModule",{value:!0}),types.DiscrError=void 0;var n;return(function(e){e.Tag="tag",e.Mapping="mapping"})(n||(types.DiscrError=n={})),types}var hasRequiredDiscriminator;function requireDiscriminator(){if(hasRequiredDiscriminator)return discriminator;hasRequiredDiscriminator=1,Object.defineProperty(discriminator,"__esModule",{value:!0});const n=requireCodegen(),e=requireTypes(),i=requireCompile(),s=requireRef_error(),o=requireUtil(),c={keyword:"discriminator",type:"object",schemaType:"object",error:{message:({params:{discrError:u,tagName:f}})=>u===e.DiscrError.Tag?`tag "${f}" must be string`:`value of tag "${f}" must be in oneOf`,params:({params:{discrError:u,tag:f,tagName:g}})=>(0,n._)`{error: ${u}, tag: ${g}, tagValue: ${f}}`},code(u){const{gen:f,data:g,schema:H,parentSchema:Y,it:ee}=u,{oneOf:te}=Y;if(!ee.opts.discriminator)throw new Error("discriminator: requires discriminator option");const ne=H.propertyName;if(typeof ne!="string")throw new Error("discriminator: requires propertyName");if(H.mapping)throw new Error("discriminator: mapping is not supported");if(!te)throw new Error("discriminator: requires oneOf keyword");const Ye=f.let("valid",!1),xe=f.const("tag",(0,n._)`${g}${(0,n.getProperty)(ne)}`);f.if((0,n._)`typeof ${xe} == "string"`,()=>tt(),()=>u.error(!1,{discrError:e.DiscrError.Tag,tag:xe,tagName:ne})),u.ok(Ye);function tt(){const rt=it();f.if(!1);for(const nt in rt)f.elseIf((0,n._)`${xe} === ${nt}`),f.assign(Ye,et(rt[nt]));f.else(),u.error(!1,{discrError:e.DiscrError.Mapping,tag:xe,tagName:ne}),f.endIf()}function et(rt){const nt=f.name("valid"),at=u.subschema({keyword:"oneOf",schemaProp:rt},nt);return u.mergeEvaluated(at,n.Name),nt}function it(){var rt;const nt={},at=ot(Y);let st=!0;for(let dt=0;dt<te.length;dt++){let pt=te[dt];if(pt!=null&&pt.$ref&&!(0,o.schemaHasRulesButRef)(pt,ee.self.RULES)){const mt=pt.$ref;if(pt=i.resolveRef.call(ee.self,ee.schemaEnv.root,ee.baseId,mt),pt instanceof i.SchemaEnv&&(pt=pt.schema),pt===void 0)throw new s.default(ee.opts.uriResolver,ee.baseId,mt)}const yt=(rt=pt==null?void 0:pt.properties)===null||rt===void 0?void 0:rt[ne];if(typeof yt!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${ne}"`);st=st&&(at||ot(pt)),ut(yt,dt)}if(!st)throw new Error(`discriminator: "${ne}" must be required`);return nt;function ot({required:dt}){return Array.isArray(dt)&&dt.includes(ne)}function ut(dt,pt){if(dt.const)ht(dt.const,pt);else if(dt.enum)for(const yt of dt.enum)ht(yt,pt);else throw new Error(`discriminator: "properties/${ne}" must have "const" or "enum"`)}function ht(dt,pt){if(typeof dt!="string"||dt in nt)throw new Error(`discriminator: "${ne}" values must be unique strings`);nt[dt]=pt}}}};return discriminator.default=c,discriminator}const $schema$6="http://json-schema.org/draft-07/schema#",$id$6="http://json-schema.org/draft-07/schema#",title$1="Core schema meta-schema",definitions={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type$6=["object","boolean"],properties$4={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},require$$3={$schema:$schema$6,$id:$id$6,title:title$1,definitions,type:type$6,properties:properties$4,default:!0};var hasRequiredAjv;function requireAjv(){return hasRequiredAjv||(hasRequiredAjv=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.MissingRefError=e.ValidationError=e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=e.Ajv=void 0;const i=requireCore$1(),s=requireDraft7(),o=requireDiscriminator(),l=require$$3,c=["/properties"],u="http://json-schema.org/draft-07/schema";class f extends i.default{_addVocabularies(){super._addVocabularies(),s.default.forEach(ne=>this.addVocabulary(ne)),this.opts.discriminator&&this.addKeyword(o.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const ne=this.opts.$data?this.$dataMetaSchema(l,c):l;this.addMetaSchema(ne,u,!1),this.refs["http://json-schema.org/schema"]=u}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(u)?u:void 0)}}e.Ajv=f,n.exports=e=f,n.exports.Ajv=f,Object.defineProperty(e,"__esModule",{value:!0}),e.default=f;var g=requireValidate();Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return g.KeywordCxt}});var H=requireCodegen();Object.defineProperty(e,"_",{enumerable:!0,get:function(){return H._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return H.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return H.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return H.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return H.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return H.CodeGen}});var Y=requireValidation_error();Object.defineProperty(e,"ValidationError",{enumerable:!0,get:function(){return Y.default}});var ee=requireRef_error();Object.defineProperty(e,"MissingRefError",{enumerable:!0,get:function(){return ee.default}})})(ajv,ajv.exports)),ajv.exports}var ajvExports=requireAjv();const Ajv=getDefaultExportFromCjs$1(ajvExports);var dist={exports:{}},formats={},hasRequiredFormats;function requireFormats(){return hasRequiredFormats||(hasRequiredFormats=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.formatNames=n.fastFormats=n.fullFormats=void 0;function e(dt,pt){return{validate:dt,compare:pt}}n.fullFormats={date:e(l,c),time:e(f(!0),g),"date-time":e(ee(!0),te),"iso-time":e(f(),H),"iso-date-time":e(ee(),ne),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:tt,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:ht,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:it,int32:{type:"number",validate:at},int64:{type:"number",validate:st},float:{type:"number",validate:ot},double:{type:"number",validate:ot},password:!0,binary:!0},n.fastFormats={...n.fullFormats,date:e(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,c),time:e(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,g),"date-time":e(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,te),"iso-time":e(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,H),"iso-date-time":e(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,ne),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i},n.formatNames=Object.keys(n.fullFormats);function i(dt){return dt%4===0&&(dt%100!==0||dt%400===0)}const s=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,o=[0,31,28,31,30,31,30,31,31,30,31,30,31];function l(dt){const pt=s.exec(dt);if(!pt)return!1;const yt=+pt[1],mt=+pt[2],St=+pt[3];return mt>=1&&mt<=12&&St>=1&&St<=(mt===2&&i(yt)?29:o[mt])}function c(dt,pt){if(dt&&pt)return dt>pt?1:dt<pt?-1:0}const u=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function f(dt){return function(yt){const mt=u.exec(yt);if(!mt)return!1;const St=+mt[1],wt=+mt[2],Rt=+mt[3],Lt=mt[4],Gt=mt[5]==="-"?-1:1,vt=+(mt[6]||0),Et=+(mt[7]||0);if(vt>23||Et>59||dt&&!Lt)return!1;if(St<=23&&wt<=59&&Rt<60)return!0;const _t=wt-Et*Gt,Ct=St-vt*Gt-(_t<0?1:0);return(Ct===23||Ct===-1)&&(_t===59||_t===-1)&&Rt<61}}function g(dt,pt){if(!(dt&&pt))return;const yt=new Date("2020-01-01T"+dt).valueOf(),mt=new Date("2020-01-01T"+pt).valueOf();if(yt&&mt)return yt-mt}function H(dt,pt){if(!(dt&&pt))return;const yt=u.exec(dt),mt=u.exec(pt);if(yt&&mt)return dt=yt[1]+yt[2]+yt[3],pt=mt[1]+mt[2]+mt[3],dt>pt?1:dt<pt?-1:0}const Y=/t|\s/i;function ee(dt){const pt=f(dt);return function(mt){const St=mt.split(Y);return St.length===2&&l(St[0])&&pt(St[1])}}function te(dt,pt){if(!(dt&&pt))return;const yt=new Date(dt).valueOf(),mt=new Date(pt).valueOf();if(yt&&mt)return yt-mt}function ne(dt,pt){if(!(dt&&pt))return;const[yt,mt]=dt.split(Y),[St,wt]=pt.split(Y),Rt=c(yt,St);if(Rt!==void 0)return Rt||g(mt,wt)}const Ye=/\/|:/,xe=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function tt(dt){return Ye.test(dt)&&xe.test(dt)}const et=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function it(dt){return et.lastIndex=0,et.test(dt)}const rt=-2147483648,nt=2**31-1;function at(dt){return Number.isInteger(dt)&&dt<=nt&&dt>=rt}function st(dt){return Number.isInteger(dt)}function ot(){return!0}const ut=/[^\\]\\Z/;function ht(dt){if(ut.test(dt))return!1;try{return new RegExp(dt),!0}catch{return!1}}})(formats)),formats}var limit={},hasRequiredLimit;function requireLimit(){return hasRequiredLimit||(hasRequiredLimit=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.formatLimitDefinition=void 0;const e=requireAjv(),i=requireCodegen(),s=i.operators,o={formatMaximum:{okStr:"<=",ok:s.LTE,fail:s.GT},formatMinimum:{okStr:">=",ok:s.GTE,fail:s.LT},formatExclusiveMaximum:{okStr:"<",ok:s.LT,fail:s.GTE},formatExclusiveMinimum:{okStr:">",ok:s.GT,fail:s.LTE}},l={message:({keyword:u,schemaCode:f})=>(0,i.str)`should be ${o[u].okStr} ${f}`,params:({keyword:u,schemaCode:f})=>(0,i._)`{comparison: ${o[u].okStr}, limit: ${f}}`};n.formatLimitDefinition={keyword:Object.keys(o),type:"string",schemaType:"string",$data:!0,error:l,code(u){const{gen:f,data:g,schemaCode:H,keyword:Y,it:ee}=u,{opts:te,self:ne}=ee;if(!te.validateFormats)return;const Ye=new e.KeywordCxt(ee,ne.RULES.all.format.definition,"format");Ye.$data?xe():tt();function xe(){const it=f.scopeValue("formats",{ref:ne.formats,code:te.code.formats}),rt=f.const("fmt",(0,i._)`${it}[${Ye.schemaCode}]`);u.fail$data((0,i.or)((0,i._)`typeof ${rt} != "object"`,(0,i._)`${rt} instanceof RegExp`,(0,i._)`typeof ${rt}.compare != "function"`,et(rt)))}function tt(){const it=Ye.schema,rt=ne.formats[it];if(!rt||rt===!0)return;if(typeof rt!="object"||rt instanceof RegExp||typeof rt.compare!="function")throw new Error(`"${Y}": format "${it}" does not define "compare" function`);const nt=f.scopeValue("formats",{key:it,ref:rt,code:te.code.formats?(0,i._)`${te.code.formats}${(0,i.getProperty)(it)}`:void 0});u.fail$data(et(nt))}function et(it){return(0,i._)`${it}.compare(${g}, ${H}) ${o[Y].fail} 0`}},dependencies:["format"]};const c=u=>(u.addKeyword(n.formatLimitDefinition),u);n.default=c})(limit)),limit}var hasRequiredDist;function requireDist(){return hasRequiredDist||(hasRequiredDist=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0});const i=requireFormats(),s=requireLimit(),o=requireCodegen(),l=new o.Name("fullFormats"),c=new o.Name("fastFormats"),u=(g,H={keywords:!0})=>{if(Array.isArray(H))return f(g,H,i.fullFormats,l),g;const[Y,ee]=H.mode==="fast"?[i.fastFormats,c]:[i.fullFormats,l],te=H.formats||i.formatNames;return f(g,te,Y,ee),H.keywords&&(0,s.default)(g),g};u.get=(g,H="full")=>{const ee=(H==="fast"?i.fastFormats:i.fullFormats)[g];if(!ee)throw new Error(`Unknown format "${g}"`);return ee};function f(g,H,Y,ee){var te,ne;(te=(ne=g.opts.code).formats)!==null&&te!==void 0||(ne.formats=(0,o._)`require("ajv-formats/dist/formats").${ee}`);for(const Ye of H)g.addFormat(Ye,Y[Ye])}n.exports=e=u,Object.defineProperty(e,"__esModule",{value:!0}),e.default=u})(dist,dist.exports)),dist.exports}var distExports=requireDist();const addFormats=getDefaultExportFromCjs$1(distExports),$id$5="catalog",$schema$5="http://json-schema.org/draft-07/schema#",jsdoc="schema.jsdoc",title="Generated schema for configuration service",type$5="object",properties$3={generalOptions:{type:"object",properties:{apiKeys:{type:"object",properties:{$apikey:{type:"array",items:{}}},required:[]}},required:["apiKeys"]},layers:{type:"object",properties:{"$GEOPORTAIL:OGC:WMTS":{type:"object",properties:{name:{type:"string"},title:{type:"string"},description:{type:"string"},globalConstraint:{type:"object",properties:{maxScaleDenominator:{type:"number"},minScaleDenominator:{type:"number"},bbox:{type:"object",properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},required:["left","right","top","bottom"]}},required:["maxScaleDenominator","minScaleDenominator","bbox"]},serviceParams:{type:"object",properties:{id:{type:"string"},version:{type:"string"},serverUrl:{type:"object",properties:{$apikey:{type:"string"}},required:["$apikey"]}},required:["id","version","serverUrl"]},defaultProjection:{type:"string"},wmtsOptions:{type:"object",properties:{tileMatrixSetLink:{type:"string"},tileMatrixSetLimits:{type:"object",properties:{$level:{type:"object",properties:{minTileRow:{type:"string"},maxTileRow:{type:"string"},minTileCol:{type:"string"},maxTileCol:{type:"string"}},required:["minTileRow","maxTileRow","minTileCol","maxTileCol"]}},required:["$level"]}},required:["tileMatrixSetLink","tileMatrixSetLimits"]},styles:{type:"array",items:{type:"object",properties:{name:{type:"string"},title:{type:"string"},current:{type:"boolean"},url:{}},required:["name","title","current","url"]}},legends:{type:"array",items:{type:"object",properties:{format:{type:"string"},url:{type:"string"},minScaleDenominator:{type:"string"}},required:["format","url","minScaleDenominator"]}},formats:{type:"array",items:{type:"object",properties:{name:{type:"string"},current:{type:"boolean"}},required:["name","current"]}}},required:["name","title","description","globalConstraint","serviceParams","defaultProjection","wmtsOptions","styles","legends","formats"]},"$GEOPORTAIL:OGC:WMS":{type:"object",properties:{name:{type:"string"},title:{type:"string"},description:{type:"string"},globalConstraint:{type:"object",properties:{minScaleDenominator:{type:"number"},maxScaleDenominator:{type:"number"},bbox:{type:"object",properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},required:["left","right","top","bottom"]}},required:["minScaleDenominator","maxScaleDenominator","bbox"]},serviceParams:{type:"object",properties:{id:{type:"string"},version:{type:"string"},serverUrl:{type:"object",properties:{$apikey:{type:"string"}},required:["$apikey"]}},required:["id","version","serverUrl"]},defaultProjection:{type:"string"},queryable:{type:"boolean"},metadata:{type:"array",items:{}},styles:{type:"array",items:{type:"object",properties:{name:{type:"string"},title:{type:"string"}},required:["name","title"]}},legends:{type:"array",items:{type:"object",properties:{format:{type:"string"},url:{type:"string"}},required:["format","url"]}},formats:{type:"array",items:{type:"object",properties:{name:{type:"string"},current:{type:"boolean"}},required:["name","current"]}}},required:["name","title","description","globalConstraint","serviceParams","defaultProjection","queryable","metadata","styles","legends","formats"]},"$GEOPORTAIL:GPP:TMS":{type:"object",properties:{hidden:{type:"boolean"},queryable:{type:"boolean"},serviceParams:{type:"object",properties:{id:{type:"string"},version:{type:"string"},serverUrl:{type:"object",properties:{$apikey:{type:"string"}},required:["$apikey"]}},required:["id","version","serverUrl"]},name:{type:"string"},title:{type:"string"},description:{type:"string"},formats:{type:"array",items:{type:"object",properties:{current:{type:"boolean"},name:{type:"string"}},required:["current","name"]}},styles:{type:"array",items:{type:"object",properties:{name:{type:"string"},title:{type:"string"},current:{type:"boolean"},url:{type:"string"}},required:["name","title","current","url"]}},globalConstraint:{type:"object",properties:{crs:{type:"string"},bbox:{type:"object",properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},required:["left","right","top","bottom"]},minScaleDenominator:{},maxScaleDenominator:{}},required:["crs","bbox","minScaleDenominator","maxScaleDenominator"]},layerId:{type:"string"},defaultProjection:{type:"string"}},required:["hidden","queryable","serviceParams","name","title","description","formats","styles","globalConstraint","layerId","defaultProjection"]}},required:[]},tileMatrixSets:{type:"object",properties:{$tmsid:{type:"object",properties:{projection:{type:"string"},nativeResolutions:{type:"array",items:{type:"string"}},tileMatrices:{type:"object",properties:{$level:{type:"object",properties:{matrixId:{type:"string"},matrixHeight:{type:"number"},matrixWidth:{type:"number"},scaleDenominator:{type:"number"},tileHeight:{type:"number"},tileWidth:{type:"number"},topLeftCorner:{type:"object",properties:{x:{type:"number"},y:{type:"number"}},required:["x","y"]}},required:["matrixId","matrixHeight","matrixWidth","scaleDenominator","tileHeight","tileWidth","topLeftCorner"]}},required:["$level"]}},required:["projection","nativeResolutions","tileMatrices"]}},required:[]}},required$3=["generalOptions","layers","tileMatrixSets"],CatalogSchema={$id:$id$5,$schema:$schema$5,jsdoc,title,type:type$5,properties:properties$3,required:required$3},$id$4="territories",$schema$4="http://json-schema.org/draft-07/schema#",type$4="array",items={type:"object",required:["id","title","description","zoom","thumbnail","icon"],oneOf:[{required:["bbox"]},{required:["point"]}],properties:{id:{type:"string",description:"Code du territoire"},title:{type:"string",description:"Nom affich du territoire"},description:{type:"string"},zoom:{type:["integer","null"],minimum:0},bbox:{type:"array",minItems:4,maxItems:4,items:{type:"number"},description:"Bounding box au format [minX, minY, maxX, maxY]"},point:{type:"array",minItems:2,maxItems:2,items:{type:"number"},description:"Coordonnes"},thumbnail:{anyOf:[{type:"string",format:"uri"},{type:"string"}]},icon:{anyOf:[{type:"string",format:"uri"},{type:"string"}]}},additionalProperties:!1},TerrotoriesSchema={$id:$id$4,$schema:$schema$4,type:type$4,items},$id$3="layer-wmts",$schema$3="http://json-schema.org/draft-07/schema#",type$3="object",required$2=["name","globalConstraint","params"],properties$2={name:{type:"string"},globalConstraint:{type:"object",required:["maxScaleDenominator","minScaleDenominator","bbox"],properties:{maxScaleDenominator:{type:"number"},minScaleDenominator:{type:"number"},bbox:{type:"object",required:["left","right","top","bottom"],properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},additionalProperties:!1}},additionalProperties:!1},params:{type:"object",required:["url","styles","version","format","projection","minScale","maxScale","extent","legends","title","description","tileMatrixSetLimits","TMSLink","matrixIds","tileMatrices","nativeResolutions"],properties:{url:{type:"string",format:"uri"},styles:{type:"string"},version:{type:"string"},format:{type:"string"},projection:{type:"string"},minScale:{type:"number"},maxScale:{type:"number"},extent:{type:"object",required:["left","right","top","bottom"],properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},additionalProperties:!1},legends:{type:"array",items:{type:"object",required:["format","url","minScaleDenominator"],properties:{format:{type:"string"},url:{type:"string"},minScaleDenominator:{type:["string","number"]}},additionalProperties:!1}},title:{type:"string"},description:{type:"string"},tileMatrixSetLimits:{type:"object",patternProperties:{"^[0-9]+$":{type:"object",required:["minTileRow","maxTileRow","minTileCol","maxTileCol"],properties:{minTileRow:{type:"string"},maxTileRow:{type:"string"},minTileCol:{type:"string"},maxTileCol:{type:"string"}},additionalProperties:!1}},additionalProperties:!1},TMSLink:{type:"string"},matrixIds:{type:"array",items:{type:"string"}},tileMatrices:{type:"object",patternProperties:{"^[0-9]+$":{type:"object",required:["matrixId","matrixHeight","matrixWidth","scaleDenominator","tileHeight","tileWidth","topLeftCorner"],properties:{matrixId:{type:"string"},matrixHeight:{type:"integer"},matrixWidth:{type:"integer"},scaleDenominator:{type:"number"},tileHeight:{type:"integer"},tileWidth:{type:"integer"},topLeftCorner:{type:"object",required:["x","y"],properties:{x:{type:"number"},y:{type:"number"}},additionalProperties:!1}},additionalProperties:!1}},additionalProperties:!1},nativeResolutions:{type:"array",items:{type:"string"}}},additionalProperties:!1}},additionalProperties$2=!1,LayerWmtsSchema={$id:$id$3,$schema:$schema$3,type:type$3,required:required$2,properties:properties$2,additionalProperties:additionalProperties$2},$id$2="layer-wms",$schema$2="http://json-schema.org/draft-07/schema#",type$2="object",required$1=["name","title","description","globalConstraint","serviceParams","defaultProjection","queryable","metadata","styles","legends","formats","producer","thematic","base","key","position","opacity","visible","grayscale","params"],properties$1={name:{type:"string"},title:{type:"string"},description:{type:"string"},globalConstraint:{type:"object",required:["minScaleDenominator","maxScaleDenominator","bbox"],properties:{minScaleDenominator:{type:"number"},maxScaleDenominator:{type:"number"},bbox:{type:"object",required:["left","right","top","bottom"],properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},additionalProperties:!1}},additionalProperties:!1},serviceParams:{type:"object",required:["id","version","serverUrl"],properties:{id:{type:"string"},version:{type:"string"},serverUrl:{type:"object",required:["full"],properties:{full:{type:"string",format:"uri"}},additionalProperties:!1}},additionalProperties:!1},defaultProjection:{type:"string"},queryable:{type:"boolean"},metadata:{type:"array",items:{}},styles:{type:"array",items:{type:"object",required:["name","title"],properties:{name:{type:"string"},title:{type:"string"}},additionalProperties:!1}},legends:{type:"array",items:{type:"object",required:["format","url"],properties:{format:{type:"string"},url:{type:"string",format:"uri"}},additionalProperties:!1}},formats:{type:"array",items:{type:"object",required:["name","current"],properties:{name:{type:"string"},current:{type:"boolean"}},additionalProperties:!1}},producer:{type:"array",items:{type:"string"}},thematic:{type:"array",items:{type:"string"}},base:{type:"boolean"},key:{type:"string"},position:{type:"integer"},opacity:{type:"number"},visible:{type:"boolean"},grayscale:{type:"boolean"},params:{type:"object",required:["url","styles","version","format","projection","minScale","maxScale","extent","legends","title","description"],properties:{url:{type:"string",format:"uri"},styles:{type:"string"},version:{type:"string"},format:{type:"string"},projection:{type:"string"},minScale:{type:"number"},maxScale:{type:"number"},extent:{type:"object",required:["left","right","top","bottom"],properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},additionalProperties:!1},legends:{type:"array",items:{type:"object",required:["format","url"],properties:{format:{type:"string"},url:{type:"string",format:"uri"}},additionalProperties:!1}},title:{type:"string"},description:{type:"string"}},additionalProperties:!1}},additionalProperties$1=!1,LayerWmsSchema={$id:$id$2,$schema:$schema$2,type:type$2,required:required$1,properties:properties$1,additionalProperties:additionalProperties$1},$id$1="layer-wfs",$schema$1="http://json-schema.org/draft-07/schema#",type$1="object",LayerWfsSchema={$id:$id$1,$schema:$schema$1,type:type$1},$id="layer-tms",$schema="http://json-schema.org/draft-07/schema#",type="object",required=["name","title","description","params","formats","styles","globalConstraint"],properties={hidden:{type:"boolean"},queryable:{type:"boolean"},serviceParams:{type:"object",required:["id","version","serverUrl"],properties:{id:{type:"string"},version:{type:"string"},serverUrl:{type:"object",required:["full"],properties:{full:{type:"string",format:"uri"}},additionalProperties:!1}},additionalProperties:!1},name:{type:"string"},title:{type:"string"},description:{type:"string"},formats:{type:"array",items:{type:"object",required:["name","current"],properties:{name:{type:"string"},current:{type:"boolean"}},additionalProperties:!1}},styles:{type:"array",items:{type:"object",required:["name","title","url"],properties:{name:{type:"string"},title:{type:"string"},current:{type:"boolean"},url:{type:"string",format:"uri"}},additionalProperties:!1}},globalConstraint:{type:"object",required:["crs","bbox","minScaleDenominator","maxScaleDenominator"],properties:{crs:{type:"string"},bbox:{type:"object",required:["left","right","top","bottom"],properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},additionalProperties:!1},minScaleDenominator:{type:"number"},maxScaleDenominator:{type:"number"}},additionalProperties:!1},defaultProjection:{type:"string"},thematic:{type:"array",items:{type:"string"}},base:{type:"boolean"},producer:{type:"array",items:{type:"string"}},key:{type:"string"},position:{type:"integer"},opacity:{type:"number"},visible:{type:"boolean"},grayscale:{type:"boolean"},params:{type:"object",required:["url","styles","version","format","projection","minScale","maxScale","extent","title","description"],properties:{url:{type:"string",format:"uri"},styles:{type:"string"},version:{type:"string"},format:{type:"string"},projection:{type:"string"},minScale:{type:"number"},maxScale:{type:"number"},extent:{type:"object",required:["left","right","top","bottom"],properties:{left:{type:"number"},right:{type:"number"},top:{type:"number"},bottom:{type:"number"}},additionalProperties:!1},title:{type:"string"},description:{type:"string"}},additionalProperties:!1}},additionalProperties=!1,LayerTmsSchema={$id,$schema,type,required,properties,additionalProperties};class JsonValidatorUtils{constructor(){this.ajv=new Ajv({strict:!1,allErrors:!0}),addFormats(this.ajv,{mode:"fast",formats:["uri"],keywords:!0}),this.schemas={},this.loadSchemas()}loadSchemas(){this.ajv.addSchema(CatalogSchema,CatalogSchema.$id),this.schemas[CatalogSchema.$id]=CatalogSchema,this.ajv.addSchema(TerrotoriesSchema,TerrotoriesSchema.$id),this.schemas[TerrotoriesSchema.$id]=TerrotoriesSchema,this.ajv.addSchema(LayerWmtsSchema,LayerWmtsSchema.$id),this.schemas[LayerWmtsSchema.$id]=LayerWmtsSchema,this.ajv.addSchema(LayerWmsSchema,LayerWmsSchema.$id),this.schemas[LayerWmsSchema.$id]=LayerWmsSchema,this.ajv.addSchema(LayerWfsSchema,LayerWfsSchema.$id),this.schemas[LayerWfsSchema.$id]=LayerWfsSchema,this.ajv.addSchema(LayerTmsSchema,LayerTmsSchema.$id),this.schemas[LayerTmsSchema.$id]=LayerTmsSchema}validate(e,i){if(!this.schemas[e])throw new Error(`Aucun schma trouv pour le type "${e}"`);const s=this.ajv.getSchema(e);return s(i)?{valid:!0}:{valid:!1,errors:s.errors}}}window.Gp&&(window.Gp.JsonValidatorUtils=JsonValidatorUtils);const useControls={OverviewMap:{id:"OverviewMap",active:!1,disable:!1,analytic:!0,default:!1},SearchEngine:{id:"SearchEngine",active:!0,disable:!0,analytic:!1,default:!0},ScaleLine:{id:"ScaleLine",active:!0,disable:!0,analytic:!1,default:!0},LayerSwitcher:{id:"LayerSwitcher",active:!0,disable:!0,analytic:!0,default:!0},GetFeatureInfo:{id:"GetFeatureInfo",active:!0,disable:!0,analytic:!0,default:!0},Legends:{id:"Legends",active:!0,disable:!0,analytic:!0,default:!0},Drawing:{id:"Drawing",active:!0,disable:!1,analytic:!0,default:!1},Isocurve:{id:"Isocurve",active:!0,disable:!1,analytic:!0,default:!1},ReverseGeocode:{id:"ReverseGeocode",active:!0,disable:!1,analytic:!0,default:!1},Zoom:{id:"Zoom",active:!0,disable:!1,analytic:!1,default:!0},Route:{id:"Route",active:!0,disable:!1,analytic:!0,default:!1},FullScreen:{id:"FullScreen",active:!0,disable:!0,analytic:!1,default:!0},MeasureLength:{id:"MeasureLength",active:!0,disable:!1,analytic:!0,default:!1},MeasureArea:{id:"MeasureArea",active:!0,disable:!1,analytic:!0,default:!1},MeasureAzimuth:{id:"MeasureAzimuth",active:!0,disable:!1,analytic:!0,default:!1},Share:{id:"Share",active:!0,disable:!0,analytic:!0,default:!0},Print:{id:"Print",active:!0,disable:!0,analytic:!0,default:!0},MousePosition:{id:"MousePosition",active:!0,disable:!1,analytic:!1,default:!1},Territories:{id:"Territories",active:!0,disable:!0,analytic:!0,default:!0},ElevationPath:{id:"ElevationPath",active:!0,disable:!1,analytic:!1,default:!1},LayerImport:{id:"LayerImport",active:!0,disable:!0,analytic:!0,default:!0},ControlList:{id:"ControlList",active:!0,disable:!0,analytic:!0,default:!0},ContextMenu:{id:"ContextMenu",active:!0,disable:!0,analytic:!0,default:!0},Reporting:{id:"Reporting",active:!0,disable:!0,analytic:!0,default:!0}};function useDefaultControls(){var n=[];for(var e in useControls)(useControls[e].default==!0||useControls[e].active===!0&&useControls[e].disable===!0)&&n.push(useControls[e].id);return n}function useControlsMenuOptions(){return[{label:"Barre de Recherche",id:"searchEngine",name:useControls.SearchEngine.id,hint:"Barre de recherche sur la carte",disabled:useControls.SearchEngine.disable,tooltip:""},{label:"Mini carte",id:"overview",name:useControls.OverviewMap.id,hint:"Petite carte pour se reprer",disabled:useControls.OverviewMap.disable,tooltip:"Mini Carte pour contextualiser la zone cartographique",icon:"ri-map-2-line"},{label:"Scale Line",id:"scaleLine",name:useControls.ScaleLine.id,hint:"Echelle",disabled:useControls.ScaleLine.disable,tooltip:""},{label:"Gestionnaire de couches",id:"layerSwitcher",name:useControls.LayerSwitcher.id,hint:"Gestionnaire de couches",disabled:useControls.LayerSwitcher.disable,tooltip:""},{label:"GetFeatureInfo",id:"getFeatureInfo",name:useControls.GetFeatureInfo.id,hint:"Informations sur les couches",disabled:useControls.GetFeatureInfo.disable,tooltip:""},{label:"Lgendes",id:"legends",name:useControls.Legends.id,hint:"Lgendes",disabled:useControls.Legends.disable,tooltip:""},{label:"Annoter la carte",id:"drawing",name:useControls.Drawing.id,hint:"Annoter la carte",disabled:useControls.Drawing.disable,tooltip:"Ajouter des points, lignes, formes ou textes directement sur la carte",icon:"ri-pencil-line"},{label:"Trouver une adresse",id:"reverseGeocode",name:useControls.ReverseGeocode.id,hint:"Geocodage inverse",disabled:useControls.ReverseGeocode.disable,tooltip:"Obtenir l'adresse ou le nom d'un lieu  partir d'un point ou d'une zone sur la carte",svg:`<svg width="24" height="28" viewBox="0 0 24 28" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6.75 1.01001H4.81L3.43 3.06001L2.05 1.01001H0.13L2.36 4.26001L0 7.69001H1.93L3.43 5.45001L4.95 7.69001H6.87L4.51 4.26001L6.75 1.01001Z" fill="currentColor"/>
<path d="M12.7402 1.01L10.9002 5.51L9.07019 1.01H7.2002L10.0102 7.68L9.6402 8.57C9.3602 9.25 8.9502 9.47 8.2902 9.47C8.0002 9.47 7.6802 9.4 7.4702 9.31V10.79C7.7902 10.92 8.15019 11 8.66019 11C9.93019 11 10.6902 10.31 11.1502 9.21L14.5202 1H12.7402V1.01Z" fill="currentColor"/>
<path d="M4.08755 11.018L2.08763 11C2.04303 15.9598 5.68601 20.0927 10.4497 20.8156C10.1859 20.1232 10.0124 19.4016 9.93897 18.6709C6.54684 17.7803 4.05464 14.6778 4.08755 11.018Z" fill="currentColor"/>
<path d="M23.8808 20.02C24.1108 18.88 23.9908 17.7 23.5408 16.63C23.0908 15.56 22.3208 14.64 21.3308 13.99C20.3408 13.34 19.1808 13 18.0008 13C16.8208 13 15.6508 13.34 14.6708 13.99C13.6808 14.64 12.9108 15.55 12.4608 16.63C12.0008 17.7 11.8808 18.88 12.1208 20.02C12.3508 21.16 12.9208 22.21 13.7608 23.03L18.0008 27.18L22.2408 23.03C23.0808 22.21 23.6508 21.16 23.8808 20.02ZM21.9208 19.64C21.7708 20.4 21.3808 21.1 20.8308 21.65L18.0008 24.42L15.1708 21.65C14.6108 21.1 14.2308 20.4 14.0708 19.64C13.9208 18.88 13.9908 18.09 14.3008 17.38C14.6008 16.66 15.1208 16.05 15.7708 15.62C16.4208 15.19 17.2008 14.96 17.9908 14.96C18.7808 14.96 19.5508 15.19 20.2108 15.62C20.8708 16.05 21.3808 16.66 21.6808 17.38C21.9808 18.1 22.0608 18.88 21.9108 19.64H21.9208Z" fill="currentColor"/>
<path d="M18.0008 17.28C17.3508 17.28 16.8308 17.81 16.8308 18.45C16.8308 19.09 17.3608 19.62 18.0008 19.62C18.6408 19.62 19.1708 19.09 19.1708 18.45C19.1708 17.81 18.6408 17.28 18.0008 17.28Z" fill="currentColor"/>
</svg>
`},{label:"Zone selon temps de trajet",id:"isocurve",name:useControls.Isocurve.id,hint:"Calcul d'isochrone",disabled:useControls.Isocurve.disable,tooltip:"Afficher la zone que l'on peut atteindre en un temps donn depuis un point de dpart",svg:`<svg width="18" height="20" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1174_22932)">
<path d="M8 9.9V15C8 15.55 8.45 16 9 16C9.55 16 10 15.55 10 15V9.9C12.71 9.35 14.45 6.71 13.9 4C13.35 1.3 10.71 -0.450004 8 0.0999962C5.29 0.649996 3.55 3.29 4.1 6C4.5 7.96 6.04 9.5 8 9.9ZM9 2C10.66 2 12 3.34 12 5C12 6.66 10.66 8 9 8C7.34 8 6 6.66 6 5C6 3.34 7.34 2 9 2ZM13.21 12.42C12.66 12.3 12.12 12.66 12 13.21C11.88 13.76 12.24 14.3 12.79 14.42C15.06 14.87 16 15.68 16 16C16 16.58 13.55 18 9 18C4.45 18 2 16.58 2 16C2 15.68 2.94 14.87 5.21 14.38C5.76 14.26 6.12 13.72 6 13.17C5.88 12.62 5.34 12.26 4.79 12.38C1.75 13.08 0 14.39 0 16C0 18.63 4.53 20 9 20C13.47 20 18 18.63 18 16C18 14.39 16.25 13.08 13.21 12.42Z" fill="currentColor"/>
</g>
<defs>
<clipPath id="clip0_1174_22932">
<rect width="18" height="20" fill="currentColor"/>
</clipPath>
</defs>
</svg>`},{label:"Itinraire",id:"route",name:useControls.Route.id,hint:"Calcul d'itinraire",disabled:useControls.Route.disable,tooltip:"Trouver le meilleur trajet entre deux ou plusieurs points",svg:`
      <svg width="18" height="15" viewBox="0 0 18 15" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M2.69953 4.39903C1.76092 4.39903 1.00002 3.63813 1.00002 2.69951C1.00002 1.7609 1.76092 1 2.69953 1C3.63815 1 4.39905 1.7609 4.39905 2.69951C4.39905 3.63813 3.63815 4.39903 2.69953 4.39903Z" stroke="currentColor" stroke-width="2" stroke-miterlimit="10"/>
<path d="M2.69959 4.95987V10.6278C2.69959 12.2678 4.03371 13.6019 5.67374 13.6019C7.31377 13.6019 8.64789 12.2678 8.64789 10.6278V4.80691C8.64789 3.16688 9.98201 1.83276 11.622 1.83276C13.2621 1.83276 14.5962 3.16688 14.5962 4.80691V10.2029" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10"/>
<path d="M12.1924 8.948L14.5959 11.3515" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M14.5966 11.3514L17 8.94796" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`},{label:"Zoom",id:"zoom",name:useControls.Zoom.id,hint:"Zoomer - dzoomer",disabled:useControls.Zoom.disable,tooltip:"Zoomer dzoomer sur la carte",icon:"ri-zoom-in-line"},{label:"Plein cran",id:"fullscreen",name:useControls.FullScreen.id,hint:"Plein cran",disabled:useControls.FullScreen.disable,tooltip:""},{label:"Mesurer une distance",id:"measureLength",name:useControls.MeasureLength.id,hint:"Mesures",disabled:useControls.MeasureLength.disable,tooltip:"Tracer un trajet pour connatre sa longueur",svg:`
      <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6.89379 6.18676C6.69853 6.38202 6.69853 6.6986 6.89379 6.89387C7.08906 7.08913 7.40564 7.08913 7.6009 6.89387L6.89379 6.18676ZM8.30801 4.77255L6.89379 6.18676L7.6009 6.89387L9.01511 5.47965L8.30801 4.77255Z" fill="currentColor"/>
<path d="M8.97357 8.26647C8.7783 8.46173 8.7783 8.77832 8.97357 8.97358C9.16883 9.16884 9.48541 9.16884 9.68067 8.97358L8.97357 8.26647ZM10.3878 6.85226L8.97357 8.26647L9.68067 8.97358L11.0949 7.55936L10.3878 6.85226Z" fill="currentColor"/>
<path d="M11.0533 10.3462C10.858 10.5414 10.858 10.858 11.0533 11.0533C11.2485 11.2486 11.5651 11.2486 11.7604 11.0533L11.0533 10.3462ZM12.4675 8.93197L11.0533 10.3462L11.7604 11.0533L13.1746 9.63908L12.4675 8.93197Z" fill="currentColor"/>
<path d="M13.133 12.4259C12.9377 12.6212 12.9377 12.9377 13.133 13.133C13.3283 13.3283 13.6448 13.3283 13.8401 13.133L13.133 12.4259ZM14.5472 11.0117L13.133 12.4259L13.8401 13.133L15.2543 11.7188L14.5472 11.0117Z" fill="currentColor"/>
<path d="M16.9805 13.4449L15.5663 14.8592" stroke="currentColor" stroke-miterlimit="10" stroke-linecap="round"/>
<rect x="5.53552" y="2" width="20" height="5" transform="rotate(45 5.53552 2)" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10"/>
</svg>
`},{label:"Mesurer une surface",id:"measureArea",name:useControls.MeasureArea.id,hint:"Mesures",disabled:useControls.MeasureArea.disable,tooltip:"Tracer une zone pour connatre son aire",svg:`
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17.9922 16.3915C17.6994 16.0987 17.2245 16.0987 16.9316 16.3915C16.6387 16.6844 16.6387 17.1593 16.9316 17.4522L17.9922 16.3915ZM19.4695 19.9901L19.9998 20.5204L21.0605 19.4598L20.5301 18.9294L19.4695 19.9901ZM16.9316 17.4522L19.4695 19.9901L20.5301 18.9294L17.9922 16.3915L16.9316 17.4522Z" fill="currentColor"/>
<path d="M20.5303 19.9902L21.0607 19.4598L20 18.3992L19.4697 18.9295L20.5303 19.9902ZM16.9317 21.4674C16.6388 21.7603 16.6388 22.2352 16.9317 22.5281C17.2246 22.821 17.6995 22.821 17.9924 22.5281L16.9317 21.4674ZM19.4697 18.9295L16.9317 21.4674L17.9924 22.5281L20.5303 19.9902L19.4697 18.9295Z" fill="currentColor"/>
<path d="M1.46967 5.67804C1.17678 5.97094 1.17678 6.44581 1.46967 6.7387C1.76256 7.0316 2.23744 7.0316 2.53033 6.7387L1.46967 5.67804ZM4.73858 4.53045L5.26891 4.00012L4.20825 2.93946L3.67792 3.46979L4.73858 4.53045ZM2.53033 6.7387L4.73858 4.53045L3.67792 3.46979L1.46967 5.67804L2.53033 6.7387Z" fill="currentColor"/>
<path d="M4.73883 3.47059L4.2085 2.94026L3.14784 4.00092L3.67817 4.53125L4.73883 3.47059ZM5.88646 6.73954C6.17935 7.03243 6.65423 7.03243 6.94712 6.73954C7.24001 6.44665 7.24001 5.97177 6.94712 5.67888L5.88646 6.73954ZM3.67817 4.53125L5.88646 6.73954L6.94712 5.67888L4.73883 3.47059L3.67817 4.53125Z" fill="currentColor"/>
<path d="M4.20898 5.10455V16.9843C4.20898 18.3781 5.15458 19.4621 6.37035 19.4621H19.1188" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M19.6709 12.8356L19.6709 6.06495C19.6709 4.9035 18.8829 4.00015 17.8698 4.00015L10.8355 4.00015" stroke="currentColor" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M16.3574 11.9835L12.2343 16.0697" stroke="currentColor" stroke-linecap="round"/>
<path d="M16.2773 7.3927L7.52215 16.0695" stroke="currentColor" stroke-linecap="round"/>
<path d="M11.645 7.3136L7.52187 11.3998" stroke="currentColor" stroke-linecap="round"/>
</svg>
`},{label:"Mesurer un angle",id:"measureAzimuth",name:useControls.MeasureAzimuth.id,hint:"Mesures",disabled:useControls.MeasureAzimuth.disable,tooltip:"Tracer un trait pour connatre l'angle par rapport au Nord",svg:`
      <svg width="24" height="21" viewBox="0 0 24 21" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1174_22921)">
<path d="M18.97 10.18C18.61 10.18 18.33 10.03 18.11 9.74C17.89 9.45 17.78 9.02 17.78 8.47C17.78 7.87 17.88 7.31 18.09 6.77C18.29 6.24 18.57 5.76 18.92 5.35C19.27 4.93 19.65 4.61 20.08 4.38C20.51 4.15 20.95 4.03 21.4 4.03C21.63 4.03 21.84 4.06 22.04 4.11C22.24 4.17 22.42 4.24 22.57 4.34L23.15 4.08H23.44L22.66 8.45C22.59 8.88 22.66 9.1 22.88 9.1C23.01 9.1 23.15 9.03 23.31 8.88C23.47 8.73 23.62 8.49 23.78 8.15L23.99 8.23C23.5 9.54 22.89 10.19 22.13 10.19C21.76 10.19 21.49 10.06 21.32 9.8C21.15 9.54 21.1 9.17 21.17 8.68H21.14C20.78 9.18 20.43 9.56 20.09 9.81C19.75 10.06 19.38 10.19 18.98 10.19L18.97 10.18ZM19.28 7.81C19.28 8.24 19.32 8.56 19.41 8.77C19.5 8.98 19.66 9.08 19.9 9.08C20.14 9.08 20.38 8.97 20.61 8.75C20.84 8.53 21.06 8.28 21.25 8L21.78 5C21.67 4.86 21.55 4.75 21.42 4.68C21.29 4.61 21.13 4.57 20.95 4.57C20.61 4.57 20.32 4.72 20.07 5.03C19.82 5.34 19.62 5.74 19.49 6.23C19.35 6.72 19.28 7.25 19.28 7.8V7.81Z" fill="currentColor"/>
<path d="M20.9 15.72H15.38C15.31 12.48 13.87 9.57 11.61 7.55L17.06 1.32L15.55 0L9.99999 6.35C8.26999 5.28 6.24999 4.66 4.07999 4.66H3.07999V6.66H4.07999C5.74999 6.66 7.30999 7.11 8.66999 7.88L5.05999 12.01C4.74999 11.93 4.41999 11.88 4.07999 11.88C1.82999 11.88 -0.0100098 13.71 -0.0100098 15.97C-0.0100098 18.23 1.81999 20.06 4.07999 20.06C5.69999 20.06 7.09999 19.1 7.75999 17.73H20.9V15.73V15.72ZM10.3 9.05C12.14 10.7 13.31 13.07 13.38 15.71H8.14999C8.07999 14.63 7.60999 13.67 6.86999 12.98L10.31 9.05H10.3ZM4.08999 18.05C2.93999 18.05 1.99999 17.11 1.99999 15.96C1.99999 14.81 2.93999 13.87 4.08999 13.87C5.23999 13.87 6.17999 14.81 6.17999 15.96C6.17999 17.11 5.23999 18.05 4.08999 18.05Z" fill="currentColor"/>
</g>
<defs>
<clipPath id="clip0_1174_22921">
<rect width="23.98" height="20.05" fill="currentColor"/>
</clipPath>
</defs>
</svg>

`},{label:"Partager une carte",id:"share",name:useControls.Share.id,hint:"Partages",disabled:useControls.Share.disable,tooltip:""},{label:"Coordonnes du curseur",id:"mousePosition",name:useControls.MousePosition.id,hint:"Position de la souris",disabled:useControls.MousePosition.disable,tooltip:"Voir les coordonnes du curseur",svg:`
      <svg width="22" height="24" viewBox="0 0 22 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M7.39995 15.33V2.43L12.09 4.78V11.83H14.08V4.72L18 3.04V3.23H17.99V11.83H19.99V0.76C19.99 0.68 19.98 0.6 19.94 0.52C19.9 0.45 19.84 0.38 19.77 0.34C19.7 0.3 19.62 0.27 19.54 0.26C19.46 0.26 19.37 0.26 19.3 0.3L13 3L7.00995 0L0.00995442 3V19.61C-4.55808e-05 19.69 0.00995442 19.77 0.0599544 19.85C0.0999544 19.92 0.159954 19.99 0.219954 20.03C0.279954 20.07 0.369954 20.1 0.449954 20.11C0.529954 20.11 0.619954 20.11 0.689954 20.07L6.98995 17.37L7.38995 17.19V15.33H7.39995ZM5.40995 15.87L1.99995 17.33V17.14H2.00995V4.32L5.40995 2.86V15.87Z" fill="currentColor"/>
<path d="M21.4222 18.5953L13.6339 13.0711C13.3622 12.8899 13 13.0711 13 13.4333L13.9056 22.9422C13.9056 23.3044 14.449 23.395 14.6301 23.1233L16.0791 20.5876L17.528 23.1233C17.7092 23.4855 18.162 23.6667 18.5242 23.6667C18.7053 23.6667 18.8865 23.5761 19.0676 23.4855C19.6109 23.1233 19.7921 22.4894 19.5204 21.946L18.0714 19.4103H21.0599C21.5127 19.3197 21.6938 18.8669 21.4222 18.5953Z" fill="currentColor"/>
</svg>
`},{label:"Selectionner un territoire",id:"territories",name:useControls.Territories.id,hint:"Territoires",disabled:useControls.Territories.disable,tooltip:""},{label:"Courbe d'altitude le long d'un trajet",id:"elevationPath",name:useControls.ElevationPath.id,hint:"Profil altimtrique",disabled:useControls.ElevationPath.disable,tooltip:"Afficher le profil altimtrique le long d'un trajet",svg:`
      <svg width="24" height="22" viewBox="0 0 24 22" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1174_22927)">
<path d="M13.74 19.83H2.52998L7.82998 8.6L11.68 15.67L13.4 14.73L10.24 8.92L12.98 3.19L17.34 11.78C17.92 11.48 18.55 11.27 19.22 11.14L13.83 0.54C13.66 0.21 13.31 0.02 12.94 0C12.57 0 12.23 0.22 12.07 0.56L9.08998 6.8L8.63998 5.97C8.45998 5.65 8.10998 5.46 7.74998 5.46C7.37998 5.47 7.04998 5.69 6.88998 6.02L0.0899829 20.39C-0.0500171 20.69 -0.0300171 21.05 0.149983 21.33C0.329983 21.61 0.639983 21.79 0.979983 21.79H14.6C14.22 21.19 13.93 20.53 13.74 19.83Z" fill="currentColor"/>
<path d="M16.48 13.69V15.23H21.39L15.83 20.78L15.76 20.85L16.84 21.94L22.47 16.31V21.22H24V13.69H16.48Z" fill="currentColor"/>
</g>
<defs>
<clipPath id="clip0_1174_22927">
<rect width="24" height="21.94" fill="currentColor"/>
</clipPath>
</defs>
</svg>`},{label:"Importer des donnes",id:"layerImport",name:useControls.LayerImport.id,hint:"Import de donnes",disabled:useControls.LayerImport.disable,tooltip:""},{label:"Imprimer une carte",id:"print",name:useControls.Print.id,hint:"Impression",disabled:useControls.Print.disable,tooltip:""},{label:"Liste des controles",id:"controlList",name:useControls.ControlList.id,hint:"Liste des controles supplmentaires non affichs",disabled:useControls.ControlList.disable,tooltip:""},{label:"Menu contextuel",id:"contextMenu",name:useControls.ContextMenu.id,hint:"Menu contextuel au clic droit sur la carte",disabled:useControls.ContextMenu.disable,tooltip:""},{label:"Signaler une anomalie",id:"reporting",name:useControls.Reporting.id,hint:"Outil de signalement d'anomalie",disabled:useControls.Reporting.disable,tooltip:""}].filter(n=>Object.keys(useControls).includes(n.name)).filter(n=>!n.disabled)}function useControlsExtensionPosition(){return{shareOptions:"top-left",printOptions:"top-right",territoriesOptions:"bottom-left",layerSwitcherOptions:"top-right",legendsOptions:"bottom-left",getFeatureInfoOptions:"bottom-left",overviewMapOptions:"bottom-left",zoomOptions:"bottom-right",controlListOptions:"top-right",isocurveOptions:"top-right",routeOptions:"top-right",reverseGeocodeOptions:"top-right",fullscreenOptions:"bottom-right",measureLengthOptions:"top-right",measureAreaOptions:"top-right",measureAzimuthOptions:"top-right",elevationPathOptions:"top-right",layerImportOptions:"top-left",mousePositionOptions:"top-right",drawingOptions:"top-right",reportingOptions:"top-left"}}function useControlsPosition(){let n=[],e=[];return useControlsExtensionPosition().shareOptions.includes("left")&&n.push(useControls.Share.id),useControlsExtensionPosition().shareOptions.includes("right")&&e.push(useControls.Share.id),useControlsExtensionPosition().printOptions.includes("left")&&n.push(useControls.Print.id),useControlsExtensionPosition().printOptions.includes("right")&&e.push(useControls.Print.id),useControlsExtensionPosition().layerSwitcherOptions.includes("left")&&n.push(useControls.LayerSwitcher.id),useControlsExtensionPosition().layerSwitcherOptions.includes("right")&&e.push(useControls.LayerSwitcher.id),useControlsExtensionPosition().legendsOptions.includes("left")&&n.push(useControls.Legends.id),useControlsExtensionPosition().legendsOptions.includes("right")&&e.push(useControls.Legends.id),useControlsExtensionPosition().routeOptions.includes("left")&&n.push(useControls.Route.id),useControlsExtensionPosition().routeOptions.includes("right")&&e.push(useControls.Route.id),useControlsExtensionPosition().isocurveOptions.includes("left")&&n.push(useControls.Isocurve.id),useControlsExtensionPosition().isocurveOptions.includes("right")&&e.push(useControls.Isocurve.id),useControlsExtensionPosition().reverseGeocodeOptions.includes("left")&&n.push(useControls.ReverseGeocode.id),useControlsExtensionPosition().reverseGeocodeOptions.includes("right")&&e.push(useControls.ReverseGeocode.id),useControlsExtensionPosition().drawingOptions.includes("left")&&n.push(useControls.Drawing.id),useControlsExtensionPosition().drawingOptions.includes("right")&&e.push(useControls.Drawing.id),useControlsExtensionPosition().getFeatureInfoOptions.includes("left")&&n.push(useControls.GetFeatureInfo.id),useControlsExtensionPosition().getFeatureInfoOptions.includes("right")&&e.push(useControls.GetFeatureInfo.id),useControlsExtensionPosition().territoriesOptions.includes("left")&&n.push(useControls.Territories.id),useControlsExtensionPosition().territoriesOptions.includes("right")&&e.push(useControls.Territories.id),useControlsExtensionPosition().measureLengthOptions.includes("left")&&n.push(useControls.MeasureLength.id),useControlsExtensionPosition().measureLengthOptions.includes("right")&&e.push(useControls.MeasureLength.id),useControlsExtensionPosition().measureAreaOptions.includes("left")&&n.push(useControls.MeasureArea.id),useControlsExtensionPosition().measureAreaOptions.includes("right")&&e.push(useControls.MeasureArea.id),useControlsExtensionPosition().measureAzimuthOptions.includes("left")&&n.push(useControls.MeasureAzimuth.id),useControlsExtensionPosition().measureAzimuthOptions.includes("right")&&e.push(useControls.MeasureAzimuth.id),useControlsExtensionPosition().mousePositionOptions.includes("left")&&n.push(useControls.MousePosition.id),useControlsExtensionPosition().mousePositionOptions.includes("right")&&e.push(useControls.MousePosition.id),useControlsExtensionPosition().elevationPathOptions.includes("left")&&n.push(useControls.ElevationPath.id),useControlsExtensionPosition().elevationPathOptions.includes("right")&&e.push(useControls.ElevationPath.id),useControlsExtensionPosition().layerImportOptions.includes("left")&&n.push(useControls.LayerImport.id),useControlsExtensionPosition().layerImportOptions.includes("right")&&e.push(useControls.LayerImport.id),useControlsExtensionPosition().controlListOptions.includes("left")&&n.push(useControls.ControlList.id),useControlsExtensionPosition().controlListOptions.includes("right")&&e.push(useControls.ControlList.id),useControlsExtensionPosition().reportingOptions.includes("left")&&n.push(useControls.Reporting.id),useControlsExtensionPosition().reportingOptions.includes("right")&&e.push(useControls.Reporting.id),{left:n,right:e}}function useUrlParams(n){var e={},i={};if(n){const l=new URL(n),c=new URLSearchParams(l.search);for(const[u,f]of c.entries())i[u]=f}else i=useUrlSearchParams("history");if(i)try{const l=Object.keys(i);for(let c=0;c<l.length;c++){const u=l[c];switch(u){case"c":var s=i[u].split(",");e.lon=parseFloat(s[0]),e.lat=parseFloat(s[1]);var o=fromLonLat(s);e.x=o[0],e.y=o[1],e.center=[e.lon,e.lat];break;case"l":e.layers=i[u];break;case"w":e.controls=i[u]+","+useDefaultControls().toString();break;case"d":e.bookmarks=i[u];break;case"z":e.zoom=parseInt(i[u],10);break;case"p":e.geolocation=i[u];break;case"permalink":e.permalink=i[u];break;default:break}}}catch(l){throw new Error(`Erreur de parsing du permalien : ${l.message} !`)}return e}var defaultControls=useDefaultControls();const DEFAULT={LAYERS:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2$GEOPORTAIL:OGC:WMTS(1;1;1;0)",CONTROLS:defaultControls.toString(),X:289739.8968702704,Y:5859851607344459e-9,LON:2.602777,LAT:46.493888,ZOOM:6,FIRSTVISIT:!1},NAMESPACE="cartes.gouv.fr",ns=(n=>NAMESPACE+"."+n),useMapStore=defineStore("map",()=>{const n=inject("emitter"),e=ref$1({});try{var i=useUrlParams(),s=DEFAULT.CONTROLS.split(",");const kt=i.permalink;for(const $t in i)if(Object.prototype.hasOwnProperty.call(i,$t)){if($t==="permalink")continue;if($t==="controls"){var o=i[$t].split(",");s.forEach(function(Ut){o.includes(Ut)||(i[$t]=i[$t]+","+Ut)})}var l=i[$t];if($t==="layers"&&kt==="no"){var c="",u=localStorage.getItem(ns($t)),f=u.split(",").length+1,g=l.split(",");for(let Ut=0;Ut<g.length;Ut++){const zt=g[Ut];var H=zt.substring(0,zt.indexOf("(")),Y=zt.substring(zt.indexOf("(")+1,zt.indexOf(")")),ee=Y.split(";");ee[0]=f+Ut;var te=H+"("+ee.join(";")+")";u=u.concat(",",te)}l=u}localStorage.setItem(ns($t),l)}}catch(kt){console.error(kt)}setTimeout(()=>{if(localStorage.getItem(ns("geolocation"))!==""){var kt=localStorage.getItem(ns("geolocation")).split(",");n.dispatchEvent("searchengine:open:displayed",{position:kt})}},100);var ne=useStorage(ns("zoom"),DEFAULT.ZOOM),Ye=useStorage(ns("x"),DEFAULT.X),xe=useStorage(ns("y"),DEFAULT.Y),tt=useStorage(ns("lon"),DEFAULT.LON),et=useStorage(ns("lat"),DEFAULT.LAT),it=useStorage(ns("firstVisit"),DEFAULT.FIRSTVISIT),rt=useStorage(ns("geolocation"),"");localStorage.setItem(ns("noLoginInformation"),!1);var nt=useStorage(ns("noLoginInformation"),!1),at=computed(()=>location.search.includes("permalink=yes")),st=computed(()=>{var kt="",$t=pt.value.split(",").filter(Jt=>!s.includes(Jt)).toString(),Ut=location.pathname.slice(-1),zt=Ut==="/"?location.pathname.slice(0,-1):location.pathname,Yt=location.origin+zt.replace("/embed","");return kt=`${Yt}?c=${ut.value}&z=${Math.round(ne.value)}`,rt.value!==""&&(rt.value.split(",").map(Jt=>Number(Jt).toFixed(6)).join(","),kt+=`&p=${rt.value}`),kt+=mt.value.length>0?`&l=${ht.value}&w=${$t}&d=${mt.value.replace(/%26s%3D1/g,"")}`:`&l=${ht.value}&w=${$t}`,kt+"&permalink=yes"}),ot=computed(()=>{var kt="",$t=location.pathname.slice(-1),Ut=$t==="/"?location.pathname.slice(0,-1):location.pathname,zt=location.origin+(Ut.includes("/embed")?Ut:Ut+"/embed");return kt=`${zt}?c=${ut.value}&z=${Math.round(ne.value)}`,rt.value!==""&&(rt.value.split(",").map(Yt=>Number(Yt).toFixed(6)).join(","),kt+=`&p=${rt.value}`),kt+=mt.value.length>0?`&l=${ht.value}&d=${mt.value.replace(/%26s%3D1/g,"")}`:`&l=${ht.value}`,kt+"&permalinkShare=yes"}),ut=computed(()=>[tt.value.toFixed(6),et.value.toFixed(6)]),ht=useStorage(ns("layers"),DEFAULT.LAYERS);if(!ht.value){var dt=DEFAULT.LAYERS.split(",").filter(function(kt){return!!kt});for(let kt=0;kt<dt.length;kt++){const $t=/\(.*\)/gm;var H=dt[kt].replace($t,""),ee=dt[kt].match($t)||null;H&&Gt(H,ee)}}var pt=useStorage(ns("controls"),DEFAULT.CONTROLS);if(!pt.value){var yt=DEFAULT.CONTROLS.split(",").filter(function(kt){return!!kt});for(let kt=0;kt<yt.length;kt++)Dt(yt[kt])}var mt=useStorage(ns("bookmarks"),"");mt.value?mt.value=mt.value.replace(/%26s%3D1/g,""):mt.value="",localStorage.setItem(ns("center"),ut.value),localStorage.setItem(ns("permalink"),st.value),localStorage.setItem(ns("permalinkShare"),ot.value),watch(ne,()=>{localStorage.setItem(ns("zoom"),Math.round(ne.value))}),watch(Ye,()=>{localStorage.setItem(ns("x"),Ye.value)}),watch(xe,()=>{localStorage.setItem(ns("y"),xe.value)}),watch(tt,()=>{localStorage.setItem(ns("lon"),tt.value)}),watch(et,()=>{localStorage.setItem(ns("lat"),et.value)}),watch(ht,()=>{localStorage.setItem(ns("layers"),ht.value.toString())}),watch(st,()=>{localStorage.setItem(ns("permalink"),st.value.toString())}),watch(ot,()=>{localStorage.setItem(ns("permalinkShare"),ot.value.toString())}),watch(ut,()=>{localStorage.setItem(ns("center"),ut.value.toString())}),watch(it,()=>{localStorage.setItem(ns("firstVisit"),it.value)}),watch(pt,()=>{localStorage.setItem(ns("controls"),pt.value.toString())}),watch(mt,()=>{localStorage.setItem(ns("bookmarks"),mt.value.toString())}),watch(rt,()=>{localStorage.setItem(ns("geolocation"),rt.value.toString())}),watch(nt,()=>{localStorage.setItem(ns("noLoginInformation"),nt.value)});function St(){return e.value}function wt(kt){e.value=kt}function Rt(){return ht.value.split(",").map(function(kt){const $t=/\(.*\)/gm;return kt.replace($t,"")}).filter(kt=>kt!="")}function Lt(){ht.value=""}function Gt(kt,$t){if(kt&&!Rt().includes(kt)){var Ut=ht.value===""?[]:ht.value.split(",");Ut.push($t?kt+$t:kt+"(-1;1;1;0)"),ht.value=Ut.toString()}}function vt(kt){const $t=Rt().indexOf(kt);if($t!==-1){var Ut=ht.value.split(",");Ut.splice($t,1),ht.value=Ut.toString()}}function Et(kt,$t){const Ut=Rt().indexOf(kt);if(Ut!==-1){var zt=ht.value.split(","),Yt=zt[Ut],Jt=Yt.substring(Yt.indexOf("(")+1,Yt.indexOf(")")),Pt=Jt.split(";");for(const Mt in $t)if(Object.prototype.hasOwnProperty.call($t,Mt)){const Nt=$t[Mt];Mt==="position"&&(Pt[0]=Nt),Mt==="opacity"&&(Pt[1]=Nt),Mt==="visible"&&(Pt[2]=+Nt),Mt==="grayscale"&&(Pt[3]=+Nt),Mt==="style"&&(Pt[4]=Nt)}ht.value=ht.value.replace(zt[Ut],kt+"("+Pt.join(";")+")")}}function _t(kt){if(kt){var $t=[];for(let zt=0;zt<kt.length;zt++){const Yt=kt[zt],Jt=Rt().indexOf(Yt);if(Jt!==-1){var Ut=ht.value.split(",")[Jt];$t.push(Ut)}}ht.value=$t.join(",")}}function Ct(kt){const $t=Rt().indexOf(kt);if($t!==-1){var Ut=ht.value.split(","),zt=Ut[$t],Yt=zt.substring(zt.indexOf("(")+1,zt.indexOf(")")),Jt=Yt.split(";");return{position:Number(Jt[0]),opacity:Number(Jt[1]),visible:!!Number(Jt[2]),grayscale:!!Number(Jt[3]),style:Jt[4]}}}function ct(){return mt.value.split(",").filter(kt=>kt!="")}function ft(){return mt.value.split(",").map(kt=>decodeURIComponent(kt).split("?")[0]).filter(kt=>kt!="")}function bt(){return mt.value.split(",").map(kt=>{var $t=decodeURIComponent(kt).split("?")[1],Ut=new URLSearchParams($t),zt=Ut.get("i");return zt||(zt=decodeURIComponent(kt).split("?")[0].split(".")[0]),zt}).filter(kt=>kt!="")}function Ft(kt){if(kt){var $t=decodeURIComponent(kt).split("?")[0];if(!ft().includes($t)){var Ut=mt.value===""?[]:mt.value.split(","),zt=encodeURIComponent(kt);Ut.push(zt),mt.value=Ut.toString()}}}function Bt(kt){var $t=decodeURIComponent(kt).split("?")[0];const Ut=ft().indexOf($t);if(Ut!==-1){var zt=mt.value.split(",");zt.splice(Ut,1),mt.value=zt.toString()}}function Xt(kt){const $t=bt().indexOf(kt);if($t!==-1){var Ut=mt.value.split(",");Ut.splice($t,1),mt.value=Ut.toString()}}function Ot(kt){var $t=kt.split("?")[0];const Ut=ft().indexOf($t);if(Ut!==-1){var zt=mt.value.split(",");zt[Ut]=encodeURIComponent(kt),mt.value=zt.toString()}}function It(kt,$t){const Ut=bt().indexOf(kt);if(Ut!==-1){var zt=mt.value.split(","),Yt=decodeURIComponent(zt[Ut]),Jt=new URLSearchParams(Yt.split("?")[1]);for(const Pt in $t)if(Object.prototype.hasOwnProperty.call($t,Pt)){const Mt=$t[Pt];Jt.set(Pt,Mt)}zt[Ut]=encodeURIComponent(Yt.split("?")[0]+"?"+Jt.toString()),mt.value=zt.toString()}}function xt(kt){var $t={};if(ft().indexOf(kt.split("?")[0])!==-1){var zt=new URLSearchParams(kt.split("?")[1]);zt.forEach((Yt,Jt)=>{$t[Jt]=Yt})}return $t}function Tt(){return pt.value.split(",").filter(function(kt){return!!kt})}function Ht(){pt.value=""}function Dt(kt){if(!Tt().includes(kt)){var $t=pt.value===""?[]:pt.value.split(",");$t.push(kt),pt.value=$t.toString()}}function qt(kt){const $t=Tt().indexOf(kt);if($t!==-1){var Ut=pt.value.split(",");Ut.splice($t,1),pt.value=Ut.toString()}}return{map:e,layers:ht,controls:pt,bookmarks:mt,zoom:ne,center:ut,x:Ye,y:xe,lon:tt,lat:et,firstVisit:it,permalink:st,permalinkShare:ot,geolocation:rt,isPermalink:at,noLoginInformation:nt,getMap:St,setMap:wt,getLayers:Rt,cleanLayers:Lt,addLayer:Gt,removeLayer:vt,updateLayerProperty:Et,updateLayerPosition:_t,getLayerProperty:Ct,getBookmarks:ct,addBookmark:Ft,removeBookmark:Bt,removeBookmarkByID:Xt,updateBookmark:Ot,updateBookmarkPropertyByID:It,getBookmarkProperty:xt,getControls:Tt,cleanControls:Ht,addControl:Dt,removeControl:qt}}),mainMap="mainMap",printMap="printMap",_hoisted_1$1=["id"],__default__$7={name:"Map"},_sfc_main$w=Object.assign(__default__$7,{props:{mapId:String},setup(n,{expose:e}){const i=useMapStore(),s=n,o=ref$1(null),l=new Map$1({target:s.mapId,controls:[],interactions:defaults$3().extend([new MouseWheelZoom({constrainResolution:!0,condition:shiftKeyOnly})])}),c=new Set,u=5e3,f=location.origin+location.pathname;function g(){const te=setTimeout(()=>{console.warn("Fallback loadend dclench"),H(),c.delete(te)},u);c.add(te)}function H(){history.pushState(null,"",f)}l.on("loadstart",g),l.on("loadend",()=>{const te=c.values().next().value;te&&(clearTimeout(te),c.delete(te)),H()}),provide(s.mapId,l),onMounted(()=>{CRS.loadByDefault(),l.setTarget(o.value);const te=o.value.getElementsByTagName("canvas");te.length&&(te[0].tabIndex=0),s.mapId==mainMap&&i.setMap(l)});const Y=()=>{document.activeElement.tagName!=="INPUT"&&document.activeElement.tagName!=="SELECT"&&o.value.focus()};return e({mapRef:o,updateSize:()=>{l.updateSize()}}),(te,ne)=>(openBlock(),createElementBlock("div",{id:n.mapId,ref_key:"mapRef",ref:o,tabindex:"0",onMouseover:Y},[renderSlot(te.$slots,"default")],40,_hoisted_1$1))}}),__default__$6={name:"View"},_sfc_main$v=Object.assign(__default__$6,{props:{zoom:Number,center:Array,mapId:String},setup(n){const e=useMapStore(),i=n,s=inject(i.mapId),o=new View({zoom:i.zoom,center:fromLonLat(i.center),minZoom:0,maxZoom:21,projection:"EPSG:3857"});return o.on("change:center",l=>{if(i.mapId==mainMap){e.x=l.target.getCenter()[0],e.y=l.target.getCenter()[1];var c=toLonLat(l.target.getCenter());e.lon=c[0],e.lat=c[1]}}),o.on("change:resolution",l=>{e.zoom=o.getZoom()}),onMounted(()=>{s&&s.setView(o)}),(l,c)=>null}}),useDataStore=defineStore("data",()=>{const n=ref$1({}),e=ref$1({}),i=ref$1({}),s=ref$1({}),o=ref$1([]),l=ref$1([]),c=ref$1([]),u=ref$1([]),f=ref$1(!1),g=ref$1(""),H="WMTS,WMS,TMS",Y="IGNF:LAMB93,EPSG:2154",ee=ref$1([]),te=ref$1([]),ne=computed(()=>{let Ct=[];return Ct=[...new Set(Object.values(n.value).flatMap(ct=>(ct==null?void 0:ct.thematic)||[]).filter(ct=>typeof ct=="string"))].sort((ct,ft)=>ct==="Autres"?1:ft==="Autres"?-1:ct.localeCompare(ft,"fr",{sensitivity:"base"})),Ct=Ct.map(ct=>[ct,nt(ct)]),Ct}),Ye=computed(()=>{let Ct=[];return Ct=[...new Set(Object.values(n.value).flatMap(ct=>(ct==null?void 0:ct.producer)||[]).filter(ct=>typeof ct=="string"))].sort((ct,ft)=>ct==="Autres"?1:ft==="Autres"?-1:ct.localeCompare(ft,"fr",{sensitivity:"base"})),Ct.map(ct=>[ct,st(ct)])});async function xe(){try{var Ct=null;try{const Bt=window.__ENV__.VITE_GPF_CONF_ALERTS;if(Ct=await fetch(Bt),!Ct.ok)throw new Error("Erreur HTTP")}catch{Ct=await fetch("data/alerts.json")}const ct=await Ct.json();c.value=ct;const ft=window.__ENV__.VITE_GPF_CONF_ENTREE_CARTO,Ft=await(await fetch(ft)).json();return o.value=Ft.territories,s.value=Ft.contacts,l.value=Ft.featured||[],n.value=Ft.layers,e.value.apiKeys={...Ft.generalOptions.apiKeys},i.value=Ft.tileMatrixSets,u.value=Ft.topics||[],this.isLoaded=!0,Ft.layers}catch(ct){console.log(ct),this.isLoaded=!1,g.value=ct.message}}function tt(){return o.value}function et(){return s.value}function it(){return c.value.filter(Ct=>Ct.visibility.map)}function rt(){return ne.value}function nt(Ct){return Object.keys(n.value).filter(ct=>n.value[ct].thematic.includes(Ct)).map(ct=>ct)}function at(){return Ye.value}function st(Ct){return Object.keys(n.value).filter(ct=>n.value[ct].producer.includes(Ct)).map(ct=>ct)}function ot(){return l.value}function ut(){return n.value}function ht(){return Object.fromEntries(Object.entries(n.value).map(([Ct,ct])=>[ct.name,ct.serviceParams.id.split(":")[1]]))}function dt(Ct,ct){for(const ft in n.value)if(Object.hasOwnProperty.call(n.value,ft)){const bt=n.value[ft];if(bt.name===Ct&&bt.serviceParams.id.split(":")[1]===ct)return bt.name+"$GEOPORTAIL:"+bt.serviceParams.id}}function pt(Ct,ct){const ft=this.getLayerIdByName(Ct,ct);return this.getLayerByID(ft)}function yt(Ct){return n.value[Ct]}function mt(Ct){return Object.values(n.value).filter(ct=>{if(Ct&&ct.title==Ct)return ct})}function St(Ct){var ct=[],ft=e.value.apiKeys;for(var bt in ft){var Ft=ft[bt];Ft.forEach(function(Bt){Bt===Ct&&ct.push(bt)})}return ct}function wt(Ct,ct){var ft=null;if((ct==="WMS"||Object.keys(this.getTileMatrixSets()).length!==0)&&Object.keys(this.getLayers()).length!==0){var bt=this.getLayerIdByName(Ct,ct);ft=this.getLayerParamsByID(bt)}return ft}function Rt(Ct){var ct=null;if(Ct){ct={};var ft=this.getLayerByID(Ct),bt=this.getLayerKeysByID(Ct);if(bt.length===0)return;for(var Ft=0;Ft<bt.length;Ft++)ft.serviceParams.serverUrl[bt[Ft]]&&(ct.url=ft.serviceParams.serverUrl[bt[Ft]]);if(/\/v\//.test(ct.url)?ct.styles=" ":ct.styles=ft.styles[0].name,ct.version=ft.serviceParams.version,ct.format=ft.formats[0].name,ct.projection=ft.defaultProjection,ct.minScale=ft.globalConstraint.minScaleDenominator,ct.maxScale=ft.globalConstraint.maxScaleDenominator,ct.extent=ft.globalConstraint.bbox,ct.legends=ft.legends,ct.title=ft.title,ct.description=ft.description,ft.wmtsOptions){ct.tileMatrixSetLimits=ft.wmtsOptions.tileMatrixSetLimits;var Bt=ft.wmtsOptions.tileMatrixSetLink;if(Bt){ct.TMSLink=Bt;var Xt=this.getTileMatrixSetByID(Bt);ct.matrixIds=Object.keys(Xt.tileMatrices),ct.tileMatrices=Xt.tileMatrices,ct.nativeResolutions=Xt.nativeResolutions}}}return ct}function Lt(Ct){var ct=null;if(Ct){var ft=this.getLayerByID(Ct);ct={},ct.projection=ft.globalConstraint.crs,ct.minScale=ft.globalConstraint.minScaleDenominator,ct.maxScale=ft.globalConstraint.maxScaleDenominator,ct.extent=ft.globalConstraint.bbox}return ct}function Gt(Ct,ct){var ft=this.getLayerIdByName(Ct,ct);return this.getGlobalConstraintsByID(ft)}function vt(){return i.value}function Et(Ct){return i.value[Ct]}function _t(){return u.value}return{error:g,isLoaded:f,filterProjections:Y,filterServices:H,producers:te,themes:ee,fetchData:xe,getTerritories:tt,getContacts:et,getAlerts:it,getLayersByThematic:nt,getThematics:rt,getLayersByProducer:st,getProducers:at,getFeatured:ot,getLayers:ut,getLayersSignatures:ht,getLayerKeysByID:St,getLayerIdByName:dt,getLayerByName:pt,getLayerByID:yt,getLayerByTitle:mt,getTileMatrixSets:vt,getTileMatrixSetByID:Et,getLayerParamsByName:wt,getLayerParamsByID:Rt,getGlobalConstraintsByID:Lt,getGlobalConstraintsByName:Gt,getTopics:_t}}),_sfc_main$u={__name:"SearchEngine",props:{mapId:String,visibility:Boolean,analytic:Boolean,searchEngineOptions:Object},setup(n){const e=inject("emitter"),i=n,s=distExports$1.useLogger(),o=useMapStore(),l=useDataStore(),c=inject(i.mapId),u=ref$1(new SearchEngine(i.searchEngineOptions));onMounted(()=>{i.visibility&&(c.addControl(u.value),u.value.on("searchengine:search:click",f),u.value.on("searchengine:autocomplete:click",g),u.value.on("searchengine:geocode:click",H),u.value.on("searchengine:coordinates:click",Y),u.value.on("searchengine:geolocation:click",ee),u.value.on("searchengine:geolocation:remove",te))}),onBeforeUpdate(()=>{i.visibility||c.removeControl(u.value)}),onUpdated(()=>{i.visibility&&c.addControl(u.value)}),onUnmounted(()=>{}),e.addEventListener("searchengine:open:displayed",ne=>{if(u.value){var Ye=ne.position,xe=`<h6> Ma position </h6> longitude : ${Ye[0]}<br/> latitude : ${Ye[1]}`;u.value._setMarker(fromLonLat(ne.position),xe)}});const f=ne=>{var Ye=l.getLayerIdByName(ne.suggest.name,ne.suggest.service);o.addLayer(Ye),s.debug("onClickSearch",Ye)},g=ne=>{},H=ne=>{},Y=ne=>{},ee=ne=>{o.geolocation=toLonLat(ne.coordinates).toString()},te=ne=>{o.geolocation=""};return(ne,Ye)=>null}},UNITS_PROP="units",LEADING_DIGITS=[1,2,5],DEFAULT_DPI=25.4/.28;class ScaleLine extends Control{constructor(e){e=e||{};const i=document.createElement("div");i.style.pointerEvents="none",super({element:i,render:e.render,target:e.target}),this.on,this.once,this.un;const s=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=s+"-inner",this.element.className=s+" "+CLASS_UNSELECTABLE,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(UNITS_PROP,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(UNITS_PROP)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(UNITS_PROP,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const i=e.center,s=e.projection,o=this.getUnits(),l=o=="degrees"?"degrees":"m";let c=getPointResolution(s,e.resolution,i,l);const u=this.minWidth_*(this.dpi_||DEFAULT_DPI)/DEFAULT_DPI,f=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||DEFAULT_DPI)/DEFAULT_DPI:void 0;let g=u*c,H="";if(o=="degrees"){const it=METERS_PER_UNIT$1.degrees;g*=it,g<it/60?(H="",c*=3600):g<it?(H="",c*=60):H=""}else if(o=="imperial")g<.9144?(H="in",c/=.0254):g<1609.344?(H="ft",c/=.3048):(H="mi",c/=1609.344);else if(o=="nautical")c/=1852,H="NM";else if(o=="metric")g<1e-6?(H="nm",c*=1e9):g<.001?(H="m",c*=1e6):g<1?(H="mm",c*=1e3):g<1e3?H="m":(H="km",c/=1e3);else if(o=="us")g<.9144?(H="in",c*=39.37):g<1609.344?(H="ft",c/=.30480061):(H="mi",c/=1609.3472);else throw new Error("Invalid units");let Y=3*Math.floor(Math.log(u*c)/Math.log(10)),ee,te,ne,Ye=0,xe,tt;for(;;){ne=Math.floor(Y/3);const it=Math.pow(10,ne);if(ee=LEADING_DIGITS[(Y%3+3)%3]*it,te=Math.round(ee/c),isNaN(te)){this.element.style.display="none",this.renderedVisible_=!1;return}if(f!==void 0&&te>=f){ee=Ye,te=xe,ne=tt;break}else if(te>=u)break;Ye=ee,xe=te,tt=ne,++Y}const et=this.scaleBar_?this.createScaleBar(te,ee,H):ee.toFixed(ne<0?-ne:0)+" "+H;this.renderedHTML_!=et&&(this.innerElement_.innerHTML=et,this.renderedHTML_=et),this.renderedWidth_!=te&&(this.innerElement_.style.width=te+"px",this.renderedWidth_=te),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,i,s){const o=this.getScaleForResolution(),l=o<1?Math.round(1/o).toLocaleString()+" : 1":"1 : "+Math.round(o).toLocaleString(),c=this.scaleBarSteps_,u=e/c,f=[this.createMarker("absolute")];for(let H=0;H<c;++H){const Y=H%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";f.push(`<div><div class="ol-scale-singlebar ${Y}" style="width: ${u}px;"></div>`+this.createMarker("relative")+(H%2===0||c===2?this.createStepText(H,e,!1,i,s):"")+"</div>")}return f.push(this.createStepText(c,e,!0,i,s)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+l+"</div>":"")+f.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,i,s,o,l){const u=(e===0?0:Math.round(o/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+l),f=e===0?-3:i/this.scaleBarSteps_*-1,g=e===0?0:i/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${f}px;text-align: ${e===0?"left":"center"};min-width: ${g}px;left: ${s?i+"px":"unset"};">`+u+"</div>"}getScaleForResolution(){const e=getPointResolution(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),i=this.dpi_||DEFAULT_DPI,s=1e3/25.4;return e*s*i}render(e){const i=e.frameState;i?this.viewState_=i.viewState:this.viewState_=null,this.updateElement_()}}const _sfc_main$t={__name:"ScaleLine",props:{mapId:String,visibility:Boolean,analytic:Boolean,scaleLineOptions:Object},setup(n){const e=n,i=inject(e.mapId),s=ref$1(new ScaleLine(e.scaleLineOptions));return onMounted(()=>{e.visibility&&i.addControl(s.value)}),onBeforeUpdate(()=>{e.visibility||i.removeControl(s.value)}),onUpdated(()=>{e.visibility&&i.addControl(s.value)}),(o,l)=>null}};function useActionButtonEulerian(n){n.setAttribute("data-fr-analytics-action",n.title),n.setAttribute("data-fr-js-button-actionee",!0)}const _sfc_main$s={__name:"OverviewMap",props:{mapId:String,visibility:Boolean,analytic:Boolean,overviewMapOptions:Object},setup(n){const e=n,i=distExports$1.useLogger(),s=inject(e.mapId),o=ref$1(new GeoportalOverviewMap(e.overviewMapOptions)),l=useMatchMedia("SM");watch(l,()=>{if(e.visibility&&!l.value){if(s.addControl(o.value),e.analytic){var u=o.value.element.querySelector("button[id^=GPshowOverviewMap-]");useActionButtonEulerian(u)}}else s.removeControl(o.value)}),onMounted(()=>{if(e.visibility&&!l.value&&(s.addControl(o.value),o.value.on("overviewmap:toggle",c),e.analytic)){var u=o.value.element.querySelector("button[id^=GPshowOverviewMap-]");useActionButtonEulerian(u)}}),onBeforeUpdate(()=>{if(e.visibility&&!l.value){if(s.addControl(o.value),e.analytic){var u=o.value.element.querySelector("button[id^=GPshowOverviewMap-]");useActionButtonEulerian(u)}}else s.removeControl(o.value)});function c(u){i.debug(u)}return(u,f)=>null}},_sfc_main$r={__name:"Zoom",props:{mapId:String,visibility:Boolean,analytic:Boolean,zoomOptions:Object},setup(n){const e=n,i=distExports$1.useLogger(),s=inject(e.mapId),o=ref$1(new GeoportalZoom(e.zoomOptions));onMounted(()=>{e.visibility&&(s.addControl(o.value),o.value.on("zoom:in",l),o.value.on("zoom:out",c))}),onBeforeUpdate(()=>{e.visibility||s.removeControl(o.value)}),onUpdated(()=>{e.visibility&&s.addControl(o.value)});function l(u){i.debug(u)}function c(u){i.debug(u)}return(u,f)=>null}},_sfc_main$q={__name:"LayerSwitcher",props:{mapId:String,visibility:Boolean,analytic:Boolean,layerSwitcherOptions:Object},setup(n){const e=n,i=distExports$1.useLogger(),s=useMapStore(),o=useDataStore(),l=inject("emitter"),c=inject(e.mapId),u=ref$1(new LayerSwitcher(e.layerSwitcherOptions));onMounted(()=>{if(e.visibility){if(c.addControl(u.value),e.analytic){var tt=u.value.element.querySelector("button[id^=GPshowLayersListPicto-]");useActionButtonEulerian(tt)}u.value.on("layerswitcher:add",f),u.value.on("layerswitcher:remove",g),u.value.on("layerswitcher:edit",xe),u.value.on("layerswitcher:extent",H),u.value.on("layerswitcher:change:opacity",Y),u.value.on("layerswitcher:change:visibility",ee),u.value.on("layerswitcher:change:position",te),u.value.on("layerswitcher:change:grayscale",ne),u.value.on("layerswitcher:change:style",Ye)}}),onBeforeUpdate(()=>{if(!e.visibility&&(c.removeControl(u.value),e.analytic)){var tt=u.value.element.querySelector("button[id^=GPshowLayersListPicto-]");useActionButtonEulerian(tt)}}),onUpdated(()=>{e.visibility&&c.addControl(u.value)});const f=tt=>{i.debug("onAddLayer",tt);var et=tt.layer,it=null;if(et.name&&et.service){if(it=o.getLayerIdByName(et.name,et.service),i.debug(et.name,"| position",et.layer.getZIndex()),s.updateLayerProperty(it,{position:et.layer.getZIndex()}),et.service==="TMS"){var rt=et.layer.styleName,nt=et.layer.styleUrl;i.debug("TMS",rt,nt),rt&&nt&&s.updateLayerProperty(it,{style:rt})}}else{var at=et.layer.gpResultLayerId;it=at,at&&(et.layer.gpResultLayerDiv=et.div,at.startsWith("bookmark")&&(it=at.split(":").pop(),i.debug(it,"| position",et.layer.getZIndex()),s.updateBookmarkPropertyByID(it,{p:et.layer.getZIndex()})))}i.debug("onAddLayer",it),it?push$1.success({title:t$1.layerswitcher.title,message:t$1.layerswitcher.add_success}):push$1.warning({title:t$1.layerswitcher.title,message:t$1.layerswitcher.add_failed})},g=tt=>{i.debug("onRemoveLayer",tt);var et=tt.layer,it=null;if(et.name&&et.service)it=o.getLayerIdByName(et.name,et.service),it&&s.removeLayer(it);else{var rt=et.layer.gpResultLayerId;rt&&(it=rt.split(":").pop(),rt.startsWith("bookmark")&&it&&s.removeBookmarkByID(it))}var nt=tt.target._layersOrder;if(nt){for(const at in nt)if(Object.prototype.hasOwnProperty.call(nt,at)){const st=nt[at];if(st.layer.name&&st.layer.service)it=o.getLayerIdByName(st.layer.name,st.layer.service),it&&s.updateLayerProperty(it,{position:st.layer.getZIndex()});else{var rt=st.layer.gpResultLayerId;rt&&rt.startsWith("bookmark")&&(it=rt.split(":").pop(),it&&s.updateBookmarkPropertyByID(it,{p:st.layer.getZIndex()}))}}}i.debug("onRemoveLayer",it),it?push$1.success({title:t$1.layerswitcher.title,message:t$1.layerswitcher.remove_success}):push$1.warning({title:t$1.layerswitcher.title,message:t$1.layerswitcher.remove_failed})},H=tt=>{i.debug("onZoomToExtentLayer",tt);var et=tt.layer;if(tt.error){var it=o.getGlobalConstraintsByName(et.name,et.service);if(it){var rt=c.getView(),nt=rt.getProjection(),at=[it.extent.left,it.extent.bottom,it.extent.right,it.extent.top],st=it.projection;st||(st="EPSG:4326");var ot=transformExtent(at,st,nt);ot&&rt.fit(ot)}}},Y=tt=>{i.debug("onChangeOpacityLayer",tt);var et=tt.layer,it=null;if(et.name&&et.service)it=o.getLayerIdByName(et.name,et.service),it&&s.updateLayerProperty(it,{opacity:tt.opacity});else{var rt=et.layer.gpResultLayerId;rt&&rt.startsWith("bookmark")&&(it=rt.split(":").pop(),it&&s.updateBookmarkPropertyByID(it,{o:tt.opacity}))}},ee=tt=>{i.debug("onChangeVisibilityLayer",tt);var et=tt.layer,it=null;if(et.name&&et.service)it=o.getLayerIdByName(et.name,et.service),it&&s.updateLayerProperty(it,{visible:tt.visibility});else{var rt=et.layer.gpResultLayerId;rt&&rt.startsWith("bookmark")&&(it=rt.split(":").pop(),it&&s.updateBookmarkPropertyByID(it,{v:tt.visibility}))}},te=tt=>{i.debug("onChangePositionLayer",tt),s.updateLayerPosition(tt.layers.reverse().map(et=>{if(et.name&&et.service)return o.getLayerIdByName(et.name,et.service)}))},ne=tt=>{i.debug("onChangeGrayScaleLayer",tt);var et=tt.layer,it=null;if(et.name&&et.service)it=o.getLayerIdByName(et.name,et.service),it&&s.updateLayerProperty(it,{grayscale:tt.grayscale||!1});else{var rt=et.layer.gpResultLayerId;rt&&rt.startsWith("bookmark")&&(it=rt.split(":").pop(),it&&s.updateBookmarkPropertyByID(it,{g:tt.grayscale||!1}))}},Ye=tt=>{if(i.debug("onChangeStyleMapboxLayer",tt),tt.layer.name&&tt.layer.service){var et=o.getLayerIdByName(tt.layer.name,tt.layer.service),it=tt.name,rt=tt.url;i.debug("TMS",it,rt),it&&rt&&s.updateLayerProperty(et,{style:it})}},xe=tt=>{if(i.debug("onClickEditLayer",tt),tt.layer.gpResultLayerId){var et=tt.layer.gpResultLayerId.toLowerCase();if(et){if(et.toLowerCase().includes("drawing")||et.toLowerCase().includes("layerimport:kml")||et.toLowerCase().includes("layerimport:gpx")||et.toLowerCase().includes("layerimport:geojson")||et.toLowerCase().includes("bookmark:drawing-kml")||et.toLowerCase().includes("bookmark:import-kml")||et.toLowerCase().includes("bookmark:import-gpx")||et.toLowerCase().includes("bookmark:import-geojson")){s.addControl("Drawing"),setTimeout(function(){l.dispatchEvent("vector:edit:clicked",tt)},0);return}if(et.toLowerCase().includes("bookmark:compute-route")||et.toLowerCase().includes("compute:pieton$ogc:openls;itineraire")||et.toLowerCase().includes("compute:voiture$ogc:openls;itineraire")||et.toLowerCase().includes("layerimport:compute")&&tt.layer.get("control")==="route"){s.addControl("Route"),setTimeout(function(){l.dispatchEvent("compute-route:edit:clicked",tt)},0);return}if(et.toLowerCase().includes("bookmark:compute-isocurve")||et.toLowerCase().includes("compute:pieton$geoportail:gpp:isocurve")||et.toLowerCase().includes("compute:voiture$geoportail:gpp:isocurve")||et.toLowerCase().includes("layerimport:compute")&&tt.layer.get("control")==="isocurve"){s.addControl("Isocurve"),setTimeout(function(){l.dispatchEvent("compute-isocurve:edit:clicked",tt)},0);return}if(et.toLowerCase().includes("bookmark:compute-profil")||et.toLowerCase().includes("measure:profil")||et.toLowerCase().includes("layerimport:compute")&&tt.layer.get("control")==="elevationpath"){s.addControl("ElevationPath"),setTimeout(function(){l.dispatchEvent("compute-profil:edit:clicked",tt)},0);return}}}push$1.warning({title:t$1.layerswitcher.title,message:t$1.layerswitcher.failed_not_yet_implemented})};return(tt,et)=>null}},_sfc_main$p={__name:"Legends",props:{mapId:String,visibility:Boolean,analytic:Boolean,legendsOptions:Object},setup(n){const e=n,i=inject(e.mapId),s=ref$1(new Legends(e.legendsOptions));return onMounted(()=>{if(e.visibility&&(i.addControl(s.value),e.analytic)){var o=s.value.element.querySelector("button[id^=GPshowLegendsPicto-]");useActionButtonEulerian(o)}}),onBeforeUpdate(()=>{if(e.visibility){if(i.addControl(s.value),e.analytic){var o=s.value.element.querySelector("button[id^=GPshowLegendsPicto-]");useActionButtonEulerian(o)}}else i.removeControl(s.value)}),(o,l)=>null}},useCreateDocument=async(n,e,i)=>{try{const c=await i.setDocument(n);var s=c.uuid,o=c.action;if(n.layer.gpResultLayerId&&(n.layer.gpResultLayerId=`bookmark:${n.type}-${n.compute||n.format}:${s}`),n.layer.gpResultLayerDiv){var l=n.layer.gpResultLayerDiv.querySelector("label[id^=GPname_ID_]");l&&(l.innerHTML=n.name,l.title=n.description)}const u=await i.sharingDocument({uuid:s,type:n.type});console.debug(u);const f=await i.updateMetadataDocument({uuid:s,type:n.type,name:n.name,description:n.description,extra:{format:n.format.toLowerCase(),target:"internal",date:new Date().toLocaleDateString()}});return console.debug(f),e.dispatchEvent("document:saved",{uuid:s,action:o}),c}catch(c){throw console.error(c),c}},useUpdateDocument=async(n,e,i)=>{try{const c=await i.updateGeometryDocument(n);var s=c.uuid,o=c.action;if(n.layer.gpResultLayerDiv){var l=n.layer.gpResultLayerDiv.querySelector("label[id^=GPname_ID_]");l&&(l.innerHTML=n.name,l.title=n.description)}const u=i.find(s);if(u&&!u.public_url){const g=await i.sharingDocument({uuid:s,type:n.type});console.debug(g)}const f=await i.updateMetadataDocument({uuid:s,type:n.type,name:n.name,description:n.description,extra:{format:n.format.toLowerCase(),target:"internal",date:new Date().toLocaleDateString()}});return console.debug(f),e.dispatchEvent("document:updated",{uuid:s,action:o}),c}catch(c){throw console.error(c),c}},toShare=(n,e)=>{var i=useServiceStore(),s=i.getService();if(!n){console.debug("toShare: Document non dfini !");return}var o=null;if(n.public_url){var o=n.public_url,l=new URLSearchParams;l.append("id",n._id),l.append("name",n.name),l.append("description",n.description),l.append("format",n.labels.find(u=>s.labelsFormats.includes(u))),l.append("type",n.labels.find(u=>s.labels.includes(u))),l.append("target",n.labels.find(u=>s.labelsTarget.includes(u))),l.append("kind",n.labels.find(u=>s.labelsService.includes(u))),l.append("compute",n.labels.find(u=>s.labelsCompute.includes(u))),e&&Object.keys(e).forEach(u=>l.append(u,e[u])),o+="?"+l.toString()}if(!o){console.debug("toShare: URL publique non dfinie !");return}return _reduce(o)},fromShare=n=>{var e={};if(!n){console.debug("toShare: URL publique non dfinie !");return}var i,s;i=n.split(SEPARATOR_REDUCED_URL)[0],s=n.split(SEPARATOR_REDUCED_URL)[1];var o=new URLSearchParams(s);if(o.forEach((l,c)=>{e[c]=l}),Object.keys(e).length===0){console.debug("fromShare: Document non dfini !");return}return e.u=i.split("?")[0],e.i=e.i||e.u.split(".")[0],_extend(e)},SEPARATOR_REDUCED_URL="?",SEPARATOR_REDUCED_PARAMS="&",REDUCED_BASE_URL=window.__ENV__.VITE_GPF_BASE_URL_DOCUMENT||"https://data.geopf.fr/documents/",REDUCED_KVP={url:{k:"u",opt:!1},id:{k:"i",opt:!1},name:{k:"n",opt:!1},description:{k:"d",opt:!0},format:{k:"f",opt:!1},type:{k:"t",opt:!1},target:{k:"c",opt:!1},kind:{k:"k",opt:!1},compute:{k:"w",opt:!1},position:{k:"p",opt:!1},opacity:{k:"o",opt:!1},visible:{k:"v",opt:!1},grayscale:{k:"g",opt:!1},stop:{k:"s",opt:!1}},_reduce=n=>{var e=new URL(n),i=new URLSearchParams(e.search),s=new URLSearchParams;i.forEach((l,c)=>{if(!(l===""||l===void 0||l==="undefined"))if(REDUCED_KVP[c]){if(REDUCED_KVP[c].opt)return;s.append(REDUCED_KVP[c].k,l)}else s.append(c,l)});var o=(e.origin+e.pathname).replace(REDUCED_BASE_URL,"")+SEPARATOR_REDUCED_URL+""+s.toString().replace("&",SEPARATOR_REDUCED_PARAMS);return o},_extend=n=>{var e={};Object.keys(REDUCED_KVP).forEach(s=>{e[REDUCED_KVP[s].k]=s});var i={};return Object.keys(n).forEach(s=>{var o=n[s];e[s]?i[e[s]]=o:i[s]=o}),i.url=REDUCED_BASE_URL+i.url,i},__default__$5={name:"Drawing"},_sfc_main$o=Object.assign(__default__$5,{props:{mapId:String,visibility:Boolean,analytic:Boolean,drawingOptions:Object},setup(n){const e=inject("emitter");var i=inject("services");const s=useMapStore(),o=distExports$1.useLogger(),l=n,c=inject(l.mapId),u=ref$1(new Drawing(l.drawingOptions)),f="kml",g=ref$1(new ButtonExport({title:"Exporter",kind:"secondary",download:!0,name:"Mon croquis",description:"",control:u.value,menu:!0,menuOptions:{outside:!0,above:!0,selectFormat:!1,labelDesc:!1},direction:"column",format:f,icons:{menu:"",button:"export"}})),H=ref$1(new ButtonExport({title:"Enregistrer",kind:"primary",download:!1,name:"Mon croquis",description:"",control:u.value,menu:!1,format:f,icons:{menu:"",button:"save"}}));e.addEventListener("vector:edit:clicked",ne=>{u.value&&(u.value.setCollapsed(!1),u.value.setLayer(ne.layer),g.value.inputName.value=ne.options.title||"");var Ye=ne.layer.gpResultLayerId.toLowerCase();if(Ye){var xe;Ye.includes("drawing")||Ye.includes("kml")?xe="kml":Ye.includes("geojson")?xe="geojson":Ye.includes("gpx")?xe="gpx":xe="kml",g.value.setFormat(xe),H.value.setFormat(xe)}}),e.addEventListener("drawing:open:clicked",ne=>{u.value&&u.value.setCollapsed(!ne.open)}),onMounted(()=>{if(l.visibility){if(c.addControl(u.value),c.addControl(g.value),window.__ENV__.IAM_DISABLE==="1"&&(H.value.getContainer().style.display="none"),c.addControl(H.value),l.analytic){var ne=u.value.element.querySelector("button[id^=GPshowDrawingPicto-]");useActionButtonEulerian(ne)}H.value.on("button:clicked",ee),g.value.on("button:clicked",te),u.value.on("change:collapsed",Y)}}),onBeforeUpdate(()=>{if(l.visibility){if(c.addControl(u.value),c.addControl(g.value),window.__ENV__.IAM_DISABLE==="1"&&(H.value.getContainer().style.display="none"),c.addControl(H.value),l.analytic){var ne=u.value.element.querySelector("button[id^=GPshowDrawingPicto-]");useActionButtonEulerian(ne)}H.value.on("button:clicked",ee),g.value.on("button:clicked",te),u.value.on("change:collapsed",Y)}else c.removeControl(H.value),c.removeControl(u.value),c.removeControl(g.value)});const Y=ne=>{o.debug(ne),ne.target.collapsed&&(u.value.setLayer(),g.value.inputName.value="",g.value.setFormat(f),H.value.setFormat(f))},ee=ne=>{if(o.debug(ne),!i.authenticated){push$1.warning({title:t$1.auth.title,message:t$1.auth.not_authentificated});return}var Ye=ne.layer.gpResultLayerId.toLowerCase(),xe=Ye.split(":")[0],tt={layer:ne.layer,content:ne.content,name:g.value.inputName.value||ne.name,description:ne.description,format:ne.format.toLowerCase(),target:"internal",type:Ye.split(":")[0].replace("layer","")},et;if(xe!=="bookmark")et=useCreateDocument(tt,e,i);else{var it=Ye.split(":")[2],xe=Ye.split(":")[1].split("-")[0];tt.type=xe,tt.uuid=it,et=useUpdateDocument(tt,e,i)}et.then(rt=>{var nt=i.find(rt.uuid);if(nt){var at=toShare(nt,{opacity:tt.layer.get("opacity"),visible:tt.layer.get("visible"),grayscale:tt.layer.get("grayscale"),stop:1});if(rt.action==="added")s.addBookmark(at);else if(rt.action==="updated")s.updateBookmark(at);else throw new Error("Action not yet implemented !")}}).then(()=>{push$1.success({title:t$1.drawing.title,message:t$1.drawing.save_success})}).catch(rt=>{console.error(rt),push$1.error({title:t$1.drawing.title,message:t$1.drawing.save_failed})})},te=ne=>{};return(ne,Ye)=>null}});function useActionEdit(n,e){n&&(e.get("geojson")&&typeof n.setGeoJSON=="function"&&n.setGeoJSON(e.get("geojson")),e.get("data")&&n.setData(e.get("data")),(e.get("control")==="route"||e.get("control")==="isocurve"||e.get("control")==="elevationpath"||n.CLASSNAME==="Isocurve"||n.CLASSNAME==="Route"||n.CLASSNAME==="ElevationPath")&&(n.setLayer(e),n.init()),typeof n.setCollapsed=="function"&&n.setCollapsed(!1))}const _sfc_main$n={__name:"Isocurve",props:{mapId:String,visibility:Boolean,analytic:Boolean,isocurveOptions:Object},setup(n){const e=inject("emitter");var i=inject("services");const s=n,o=distExports$1.useLogger();useDataStore();const l=useMapStore(),c=inject(s.mapId),u=ref$1(new Isocurve(s.isocurveOptions)),f=ref$1(new ButtonExport({title:"Exporter",kind:"secondary",download:!0,name:"Mon iso",description:"",control:u.value,menu:!0,menuOptions:{outside:!0,above:!0,selectFormat:!1,labelDesc:!1},direction:"column",format:"geojson",icons:{menu:"",button:"export"}})),g=ref$1(new ButtonExport({title:"Enregistrer",kind:"primary",download:!1,control:u.value,format:"geojson",menu:!1,direction:"column",icons:{menu:"",button:"save"}}));e.addEventListener("compute-isocurve:edit:clicked",xe=>{o.debug(xe),f.value.inputName.value=xe.options.title||"",useActionEdit(u.value,xe.layer)}),onMounted(()=>{if(s.visibility){if(c.addControl(u.value),c.addControl(f.value),window.__ENV__.IAM_DISABLE==="1"&&(g.value.getContainer().style.display="none"),c.addControl(g.value),s.analytic){var xe=u.value.element.querySelector("button[id^=GPshowIsochronPicto-]");useActionButtonEulerian(xe)}u.value.on("isocurve:drawstart",Y),u.value.on("socurve:drawend",ee),u.value.on("isocurve:compute",te),u.value.on("change:collapsed",H),f.value.on("button:clicked",Ye),g.value.on("button:clicked",ne)}}),onBeforeUpdate(()=>{s.visibility||(c.removeControl(u.value),c.removeControl(g.value),c.removeControl(f.value))}),onUpdated(()=>{if(s.visibility){if(c.addControl(u.value),c.addControl(f.value),window.__ENV__.IAM_DISABLE==="1"&&(g.value.getContainer().style.display="none"),c.addControl(g.value),s.analytic){var xe=u.value.element.querySelector("button[id^=GPshowIsochronPicto-]");useActionButtonEulerian(xe)}u.value.on("isocurve:drawstart",Y),u.value.on("socurve:drawend",ee),u.value.on("isocurve:compute",te),u.value.on("change:collapsed",H),f.value.on("button:clicked",Ye),g.value.on("button:clicked",ne)}});const H=xe=>{o.debug(xe),xe.target.collapsed&&u.value.clean()},Y=xe=>{o.debug(xe)},ee=xe=>{o.debug(xe)},te=xe=>{o.debug(xe);var tt=xe.target,et=tt.getLayer();et.set("control",tt.CLASSNAME.toLowerCase()),et.set("data",tt.getData()),et.set("geojson",tt.getGeoJSON())},ne=xe=>{if(o.debug(xe),!i.authenticated){push$1.warning({title:t$1.auth.title,message:t$1.auth.not_authentificated});return}var tt=xe.layer.gpResultLayerId.toLowerCase(),et=tt.split(":")[0];if(et==="layerimport"&&(et=tt.split(":")[1],et!=="compute")){push$1.error({title:t$1.iso.title,message:t$1.iso.failed_import});return}var it={layer:xe.layer,content:xe.content,name:f.value.inputName.value||xe.name,description:xe.description,format:xe.format.toLowerCase(),compute:"isocurve",target:"internal",type:et},rt;if(et!=="bookmark")rt=useCreateDocument(it,e,i);else{push$1.info({title:t$1.iso.title,message:t$1.iso.save_already});return}rt.then(nt=>{var at=i.find(nt.uuid);if(at){var st=toShare(at,{opacity:it.layer.get("opacity"),visible:it.layer.get("visible"),grayscale:it.layer.get("grayscale"),stop:1});if(nt.action==="added")l.addBookmark(st);else throw new Error("Action not yet implemented !")}}).then(()=>{push$1.success({title:t$1.iso.title,message:t$1.iso.save_success})}).catch(nt=>{console.error(nt),push$1.error({title:t$1.iso.title,message:t$1.iso.save_failed})})},Ye=xe=>{o.debug(xe),f.value.options.name=f.value.inputName.value||xe.name};return(xe,tt)=>null}},_sfc_main$m={__name:"Route",props:{mapId:String,visibility:Boolean,analytic:Boolean,routeOptions:Object},setup(n){const e=inject("emitter");var i=inject("services");const s=n,o=distExports$1.useLogger();useDataStore();const l=useMapStore(),c=inject(s.mapId),u=ref$1(new Route(s.routeOptions)),f=ref$1(new ButtonExport({title:"Exporter",kind:"secondary",download:!0,name:"Mon itineraire",description:"",control:u.value,menu:!0,menuOptions:{outside:!0,above:!0,selectFormat:!1,labelDesc:!1},direction:"column",format:"geojson",icons:{menu:"",button:"export"}})),g=ref$1(new ButtonExport({title:"Enregistrer",kind:"primary",download:!1,name:"Mon itineraire",control:u.value,format:"geojson",menu:!1,direction:"column",icons:{menu:"",button:"save"}}));e.addEventListener("compute-route:edit:clicked",xe=>{o.debug(xe),f.value.inputName.value=xe.options.title||"",useActionEdit(u.value,xe.layer)}),onMounted(()=>{if(s.visibility&&(c.addControl(u.value),c.addControl(f.value),window.__ENV__.IAM_DISABLE==="1"&&(g.value.getContainer().style.display="none"),c.addControl(g.value),u.value.on("route:drawstart",Y),u.value.on("route:drawend",ee),u.value.on("route:compute",te),u.value.on("change:collapsed",H),f.value.on("button:clicked",Ye),g.value.on("button:clicked",ne),s.analytic)){var xe=u.value.element.querySelector("button[id^=GPshowRoutePicto-]");useActionButtonEulerian(xe)}}),onBeforeUpdate(()=>{s.visibility||(c.removeControl(u.value),c.removeControl(g.value),c.removeControl(f.value))}),onUpdated(()=>{if(s.visibility){if(c.addControl(u.value),c.addControl(f.value),window.__ENV__.IAM_DISABLE==="1"&&(g.value.getContainer().style.display="none"),c.addControl(g.value),s.analytic){var xe=u.value.element.querySelector("button[id^=GPshowRoutePicto-]");useActionButtonEulerian(xe)}u.value.on("route:drawstart",Y),u.value.on("route:drawend",ee),u.value.on("route:compute",te),u.value.on("change:collapsed",H),f.value.on("button:clicked",Ye),g.value.on("button:clicked",ne)}});const H=xe=>{o.debug(xe),xe.target.collapsed&&u.value.clean()},Y=xe=>{o.debug(xe)},ee=xe=>{o.debug(xe)},te=xe=>{o.debug(xe);var tt=xe.target,et=tt.getLayer();et.set("control",tt.CLASSNAME.toLowerCase()),et.set("data",tt.getData()),et.set("geojson",tt.getGeoJSON())},ne=xe=>{if(o.debug(xe),!i.authenticated){push$1.warning({title:t$1.auth.title,message:t$1.auth.not_authentificated});return}var tt=xe.layer.gpResultLayerId.toLowerCase(),et=tt.split(":")[0];if(et==="layerimport"&&(et=tt.split(":")[1],et!=="compute")){push$1.error({title:t$1.route.title,message:t$1.route.failed_import});return}var it={layer:xe.layer,content:xe.content,name:f.value.inputName.value||xe.name,description:xe.description,format:xe.format.toLowerCase(),compute:"route",target:"internal",type:et},rt;if(et!=="bookmark")rt=useCreateDocument(it,e,i);else{push$1.info({title:t$1.route.title,message:t$1.route.save_already});return}rt.then(nt=>{var at=i.find(nt.uuid);if(at){var st=toShare(at,{opacity:it.layer.get("opacity"),visible:it.layer.get("visible"),grayscale:it.layer.get("grayscale"),stop:1});if(nt.action==="added")l.addBookmark(st);else throw new Error("Action not yet implemented !")}}).then(()=>{push$1.success({title:t$1.route.title,message:t$1.route.save_success})}).catch(nt=>{console.error(nt),push$1.error({title:t$1.route.title,message:t$1.route.save_failed})})},Ye=xe=>{o.debug(xe),f.value.options.name=f.value.inputName.value||xe.name};return(xe,tt)=>null}},_sfc_main$l={__name:"MeasureLength",props:{mapId:String,visibility:Boolean,analytic:Boolean,measureLengthOptions:Object},setup(n){const e=n,i=inject(e.mapId),s=ref$1(new MeasureLength(e.measureLengthOptions));return onMounted(()=>{if(e.visibility&&(i.addControl(s.value),e.analytic)){var o=s.value.element.querySelector("button[id^=GPshowMeasureLengthPicto-]");useActionButtonEulerian(o)}}),onBeforeUpdate(()=>{if(e.visibility){if(i.addControl(s.value),e.analytic){var o=s.value.element.querySelector("button[id^=GPshowMeasureLengthPicto-]");useActionButtonEulerian(o)}}else i.removeControl(s.value)}),(o,l)=>null}},_sfc_main$k={__name:"MeasureArea",props:{mapId:String,visibility:Boolean,analytic:Boolean,measureAreaOptions:Object},setup(n){const e=n,i=inject(e.mapId),s=ref$1(new MeasureArea(e.measureAreaOptions));return onMounted(()=>{if(e.visibility&&(i.addControl(s.value),e.analytic)){var o=s.value.element.querySelector("button[id^=GPshowMeasureAreaPicto-]");useActionButtonEulerian(o)}}),onBeforeUpdate(()=>{if(e.visibility){if(i.addControl(s.value),e.analytic){var o=s.value.element.querySelector("button[id^=GPshowMeasureAreaPicto-]");useActionButtonEulerian(o)}}else i.removeControl(s.value)}),(o,l)=>null}},_sfc_main$j={__name:"MeasureAzimuth",props:{mapId:String,visibility:Boolean,analytic:Boolean,measureAzimuthOptions:Object},setup(n){const e=n,i=inject(e.mapId),s=ref$1(new MeasureAzimuth(e.measureAzimuthOptions));return onMounted(()=>{if(e.visibility&&(i.addControl(s.value),e.analytic)){var o=s.value.element.querySelector("button[id^=GPshowMeasureAzimuthPicto-]");useActionButtonEulerian(o)}}),onBeforeUpdate(()=>{if(e.visibility){if(i.addControl(s.value),e.analytic){var o=s.value.element.querySelector("button[id^=GPshowMeasureAzimuthPicto-]");useActionButtonEulerian(o)}}else i.removeControl(s.value)}),(o,l)=>null}},_sfc_main$i={__name:"MousePosition",props:{mapId:String,visibility:Boolean,analytic:Boolean,mousePositionOptions:Object},setup(n){const e=n;distExports$1.useLogger();const i=inject(e.mapId),s=ref$1(new MousePosition(e.mousePositionOptions));return onMounted(()=>{if(e.visibility&&(i.addControl(s.value),e.analytic)){var o=s.value.element.querySelector("button[id^=GPshowMousePositionPicto-]");useActionButtonEulerian(o)}}),onBeforeUpdate(()=>{e.visibility||i.removeControl(s.value)}),onUpdated(()=>{if(e.visibility&&(i.addControl(s.value),e.analytic)){var o=s.value.element.querySelector("button[id^=GPshowMousePositionPicto-]");useActionButtonEulerian(o)}}),(o,l)=>null}},_sfc_main$h={__name:"ElevationPath",props:{mapId:String,visibility:Boolean,analytic:Boolean,elevationPathOptions:Object},setup(n){const e=inject("emitter");var i=inject("services");const s=n,o=distExports$1.useLogger();useDataStore();const l=useMapStore(),c=inject(s.mapId),u=ref$1(new ElevationPath(s.elevationPathOptions)),f=ref$1(new ButtonExport({title:"Exporter",kind:"secondary",download:!0,name:"Mon profil",description:"",control:u.value,menu:!0,menuOptions:{outside:!0,above:!0,selectFormat:!1,labelDesc:!1},direction:"column",format:"geojson",icons:{menu:"",button:"export"}})),g=ref$1(new ButtonExport({title:"Enregistrer",kind:"primary",name:"Mon profil",download:!1,control:u.value,format:"geojson",menu:!1,icons:{menu:"",button:"save"}}));e.addEventListener("compute-profil:edit:clicked",xe=>{o.debug(xe),f.value.inputName.value=xe.options.title||"",useActionEdit(u.value,xe.layer)}),onMounted(()=>{if(s.visibility){c.addControl(u.value),window.__ENV__.IAM_DISABLE==="1"&&(g.value.getContainer().style.display="none"),c.addControl(f.value),c.addControl(g.value),u.value.on("elevationpath:drawstart",Y),u.value.on("elevationpath:drawend",ee),u.value.on("elevationpath:compute",te),u.value.on("change:collapsed",H),f.value.on("button:clicked",Ye),g.value.on("button:clicked",ne);var xe=u.value.element.querySelector("button[id^=GPshowElevationPathPicto-]");s.analytic&&useActionButtonEulerian(xe),xe.dataset.removeMeasure="false",xe.dataset.removeLayer="false"}}),onBeforeUpdate(()=>{s.visibility||(c.removeControl(u.value),c.removeControl(g.value),c.removeControl(f.value))}),onUpdated(()=>{if(s.visibility){c.addControl(u.value),c.addControl(f.value),window.__ENV__.IAM_DISABLE==="1"&&(g.value.getContainer().style.display="none"),c.addControl(g.value);var xe=u.value.element.querySelector("button[id^=GPshowElevationPathPicto-]");s.analytic&&useActionButtonEulerian(xe),xe.dataset.removeMeasure="false",xe.dataset.removeLayer="false",u.value.on("elevationpath:drawstart",Y),u.value.on("elevationpath:drawend",ee),u.value.on("elevationpath:compute",te),u.value.on("change:collapsed",H),f.value.on("button:clicked",Ye),g.value.on("button:clicked",ne)}});const H=xe=>{o.debug(xe),xe.target.collapsed&&u.value.clean(!1)},Y=xe=>{o.debug(xe)},ee=xe=>{o.debug(xe)},te=xe=>{o.debug(xe);var tt=xe.target,et=tt.getLayer();et.set("control",tt.CLASSNAME.toLowerCase()),et.set("data",tt.getData())},ne=xe=>{if(o.debug(xe),!i.authenticated){push$1.warning({title:t$1.auth.title,message:t$1.auth.not_authentificated});return}var tt=xe.layer.gpResultLayerId.toLowerCase(),et=tt.split(":")[0];if(et==="measure"&&(et=tt.split(":")[1],et!=="profil")){push$1.error({title:t$1.profil.title,message:t$1.profil.failed_import});return}var it={layer:xe.layer,content:xe.content,name:f.value.inputName.value||xe.name,description:xe.description,format:xe.format.toLowerCase(),compute:"profil",target:"internal",type:"compute"},rt;if(et!=="bookmark")rt=useCreateDocument(it,e,i);else{push$1.info({title:t$1.iso.title,message:t$1.iso.save_already});return}rt.then(nt=>{var at=i.find(nt.uuid);if(at){var st=toShare(at,{opacity:it.layer.get("opacity"),visible:it.layer.get("visible"),grayscale:it.layer.get("grayscale"),stop:1});if(nt.action==="added")l.addBookmark(st);else throw new Error("Action not yet implemented !")}}).then(()=>{push$1.success({title:t$1.profil.title,message:t$1.profil.save_success})}).catch(nt=>{console.error(nt),push$1.error({title:t$1.profil.title,message:t$1.profil.save_failed})})},Ye=xe=>{o.debug(xe),f.value.options.name=f.value.inputName.value||xe.name};return(xe,tt)=>null}},_sfc_main$g={__name:"Territories",props:{mapId:String,visibility:Boolean,analytic:Boolean,territoriesOptions:Object},setup(n){const e=n,i=distExports$1.useLogger(),s=useDataStore(),o=inject(e.mapId),l=ref$1(new Territories(e.territoriesOptions));function c(){var f=s.getTerritories();for(let g=0;g<f.length;g++){const H=f[g];l.value.setTerritory(H)}}onMounted(()=>{if(e.visibility){if(c(),o.addControl(l.value),e.analytic){var f=l.value.element.querySelector("button[id^=GPshowTerritoriesPicto-]");useActionButtonEulerian(f)}l.value.on("territories:change",u)}}),onBeforeUpdate(()=>{e.visibility||o.removeControl(l.value)}),onUpdated(()=>{if(e.visibility){if(c(),o.addControl(l.value),e.analytic){var f=l.value.element.querySelector("button[id^=GPshowTerritoriesPicto-]");useActionButtonEulerian(f)}l.value.on("territories:change",u)}});const u=f=>{i.debug(f)};return(f,g)=>null}},_sfc_main$f={__name:"GetFeatureInfo",props:{mapId:String,visibility:Boolean,analytic:Boolean,getFeatureInfoOptions:Object},setup(n){const e=n,i=distExports$1.useLogger(),s=inject(e.mapId),o=ref$1(new GetFeatureInfo(e.getFeatureInfoOptions)),l=useMatchMedia("SM");watch(l,()=>{if(e.visibility&&!l.value){if(s.addControl(o.value),e.analytic){var u=o.value.element.querySelector("button[id^=GPgetFeatureInfoPicto-]");useActionButtonEulerian(u)}}else s.removeControl(o.value)}),onMounted(()=>{if(e.visibility&&!l.value&&(s.addControl(o.value),o.value.on("GetFeatureInfo:toggle",c),e.analytic)){var u=o.value.element.querySelector("button[id^=GPgetFeatureInfoPicto-]");useActionButtonEulerian(u)}}),onBeforeUpdate(()=>{if(e.visibility&&!l.value){if(s.addControl(o.value),e.analytic){var u=o.value.element.querySelector("button[id^=GPgetFeatureInfoPicto-]");useActionButtonEulerian(u)}}else s.removeControl(o.value)});function c(u){i.debug(u)}return(u,f)=>null}},__default__$4={name:"LayerImport"},_sfc_main$e=Object.assign(__default__$4,{props:{mapId:String,visibility:Boolean,analytic:Boolean,layerImportOptions:Object},setup(n){const e=inject("emitter"),i=inject("services"),s=inject("refModalLogin"),o=inject("refModalSave"),l=n,c=useMapStore(),u=distExports$1.useLogger(),f=inject(l.mapId),g=ref$1(new LayerImport(l.layerImportOptions));e.addEventListener("layerimport:open:clicked",rt=>{g.value&&g.value.setCollapsed(!rt.open)}),onMounted(()=>{if(l.visibility){if(f.addControl(g.value),l.analytic){var rt=g.value.element.querySelector("button[id^=GPshowImportPicto-]");useActionButtonEulerian(rt)}g.value.on("layerimport:vector:added",te),g.value.on("layerimport:service:added",ne),g.value.on("layerimport:mapbox:added",Ye),g.value.on("layerimport:compute:added",xe)}}),onBeforeUpdate(()=>{l.visibility||f.removeControl(g.value)}),onUpdated(()=>{if(l.visibility){if(f.addControl(g.value),l.analytic){var rt=g.value.element.querySelector("button[id^=GPshowImportPicto-]");useActionButtonEulerian(rt)}g.value.on("layerimport:vector:added",te),g.value.on("layerimport:service:added",ne),g.value.on("layerimport:mapbox:added",Ye),g.value.on("layerimport:compute:added",xe)}});const H=rt=>{u.debug(rt),s&&s.value.openModalLogin(!0)},Y=()=>{o&&o.value.openModalSave()},ee=rt=>{console.log("saveImportVector",rt);var nt={layer:rt.layer,content:rt.data,name:rt.name,description:"",format:rt.format.toLowerCase(),target:"internal",type:"import"},at=useCreateDocument(nt,e,i);at.then(st=>{var ot=i.find(st.uuid);if(ot){var ut=toShare(ot,{opacity:nt.layer.get("opacity"),visible:nt.layer.get("visible"),grayscale:nt.layer.get("grayscale"),stop:1});if(st.action==="added")c.addBookmark(ut);else throw new Error("Action not yet implemented !")}}).then(()=>{g.value.setCollapsed(!0)}).then(()=>{push$1.success({title:t$1.layerimport.title,message:t$1.layerimport.save_success})}).catch(st=>{console.error(st),push$1.error({title:t$1.layerimport.title,message:t$1.layerimport.save_failed})})},te=rt=>{u.debug(rt),i.authenticated?(o.value.onDelegateCbk(()=>{ee(rt)}),i.authenticated&&Y()):c.noLoginInformation||H(rt)},ne=rt=>{if(u.debug(rt),!!i.authenticated){var nt={};if(rt.format.toLowerCase()==="wmts"&&(nt=et(rt.data)),rt.format.toLowerCase()==="wms"&&(nt=tt(rt.data)),rt.format.toLowerCase()==="wfs"){console.error("WFS not implemented !");return}if(!nt.url){push$1.error({title:t$1.layerimport.title,message:t$1.layerimport.add_failed_service(rt.format.toUpperCase())});return}var at={content:JSON.stringify(nt),name:nt.title||rt.name,description:nt.description,format:"json",type:"service",kind:nt.format.toLowerCase(),target:"external",layer:rt.layer};it(at).then(st=>{var ot=i.find(st.uuid);if(ot){var ut=toShare(ot,{opacity:1,visible:!0,grayscale:!1,stop:1});c.addBookmark(ut)}}).then(()=>{push$1.success({title:t$1.layerimport.title,message:t$1.layerimport.add_success_service(rt.format.toUpperCase())})}).catch(st=>{console.error(st),push$1.warning({title:t$1.layerimport.title,message:t$1.layerimport.add_failed_service(rt.format.toUpperCase())})})}},Ye=rt=>{if(u.debug(rt),!!i.authenticated){var nt={content:rt.data,name:rt.name,description:"Import Mapbox",format:"json",type:"service",kind:"mapbox",target:"internal",layer:rt.layer};it(nt).then(at=>{var st=i.find(at.uuid);if(st){var ot=toShare(st,{opacity:1,visible:!0,grayscale:!1,stop:1});c.addBookmark(ot)}}).then(()=>{push$1.success({title:t$1.layerimport.title,message:t$1.layerimport.add_success_mapbox})}).catch(at=>{console.error(at),push$1.warning({title:t$1.layerimport.title,message:t$1.layerimport.add_failed_mapbox})})}},xe=rt=>{u.debug(rt)},tt=rt=>({url:rt.Url,format:"WMS",title:rt.Title,description:rt.Abstract,layers:[rt.Name],version:rt.Version,stylesName:rt.Style.map(nt=>nt.Name),queryable:rt.queryable,gfiFormat:"text/html",projection:rt.Projection}),et=rt=>({url:rt.Url,format:"WMTS",version:rt.Version,layer:rt.Identifier,outputFormat:rt.Format[0],styleName:rt.Style[0].Identifier,tileMatrixSet:rt.TileMatrixSetLink[0].TileMatrixSet,topLeftCorner:{x:rt.Origin[0],y:rt.Origin[1]},resolutions:rt.Resolutions,matrixIds:rt.MatrixIds,title:rt.Title,description:rt.Abstract}),it=async rt=>{try{const st=await i.setDocument(rt);var nt=st.uuid,at=st.action;const ot=await i.sharingDocument({uuid:nt,type:rt.type});return console.debug(ot),rt.layer.gpResultLayerId&&(rt.layer.gpResultLayerId=`bookmark:${rt.kind}:${nt}`),e.dispatchEvent("document:saved",{uuid:nt,action:at}),st}catch(st){throw console.error(st),st}};return(rt,nt)=>null}}),selectedControls=computed(()=>useMapStore().getControls()),_sfc_main$d={__name:"ControlList",props:{mapId:String,visibility:Boolean,analytic:Boolean,controlListOptions:Object},setup(n){const e=n;distExports$1.useLogger();const i=inject(e.mapId),s=ref$1(new ControlList(e.controlListOptions));return watch(selectedControls,()=>{setTimeout(()=>{if(i.removeControl(s.value),e.visibility&&(i.addControl(s.value),e.analytic)){var o=s.value.element.querySelector("button[id^=GPshowControlListPicto-]");useActionButtonEulerian(o)}},10)}),onMounted(()=>{if(e.visibility&&(i.addControl(s.value),e.analytic)){var o=s.value.element.querySelector("button[id^=GPshowControlListPicto-]");useActionButtonEulerian(o)}}),onBeforeUpdate(()=>{e.visibility||i.removeControl(s.value)}),onUpdated(()=>{if(e.visibility&&(i.addControl(s.value),e.analytic)){var o=s.value.element.querySelector("button[id^=GPshowControlListPicto-]");useActionButtonEulerian(o)}}),(o,l)=>null}},_sfc_main$c={__name:"ContextMenu",props:{mapId:String,visibility:Boolean,analytic:Boolean,contextMenuOptions:Object},setup(n){const e=useMatchMedia("SM"),i=n,s=inject(i.mapId),o=ref$1(new ContextMenu(i.contextMenuOptions));return onMounted(()=>{i.visibility&&!e.value&&s.addControl(o.value)}),onBeforeUpdate(()=>{i.visibility&&!e.value?s.addControl(o.value):s.removeControl(o.value)}),(l,c)=>null}},_sfc_main$b={__name:"FullScreen",props:{mapId:String,visibility:Boolean,analytic:Boolean,fullscreenOptions:Object},setup(n){const e=n,i=inject(e.mapId),s=ref$1(new GeoportalFullScreen(e.fullscreenOptions));return onMounted(()=>{e.visibility&&i.addControl(s.value)}),onBeforeUpdate(()=>{e.visibility?i.addControl(s.value):i.removeControl(s.value)}),(o,l)=>null}},_sfc_main$a={__name:"ReverseGeocode",props:{mapId:String,visibility:Boolean,analytic:Boolean,reverseGeocodeOptions:Object},setup(n){const e=n,i=distExports$1.useLogger();useDataStore();const s=inject(e.mapId),o=ref$1(new ReverseGeocode(e.reverseGeocodeOptions));onMounted(()=>{if(e.visibility&&(s.addControl(o.value),o.value.on("reverseGeocode:onclickresult",l),o.value.on("reverseGeocode:compute",c),e.analytic)){var u=o.value.element.querySelector("button[id^=GPshowReverseGeocodingPicto-]");useActionButtonEulerian(u)}}),onBeforeUpdate(()=>{e.visibility||s.removeControl(o.value)}),onUpdated(()=>{if(e.visibility&&(s.addControl(o.value),e.analytic)){var u=o.value.element.querySelector("button[id^=GPshowReverseGeocodingPicto-]");useActionButtonEulerian(u)}});const l=u=>{i.debug(u)},c=u=>{i.debug(u)};return(u,f)=>null}},__default__$3={name:"ModalReportingSuccessSent"},_sfc_main$9=Object.assign(__default__$3,{setup(n,{expose:e}){const i=inject("emitter"),s=useEulerian();useRouter();const o="Merci de contribuer  amliorer cartes.gouv.fr !",l="fr-icon-feedback-line",c=[{label:"Retour  la carte",onClick(){u.value=!1,i.dispatchEvent("reporting:open:clicked",{open:!1,componentName:"Reporting"})}},{label:"Autre contribution",tertiary:!0,onClick(){u.value=!1}}],u=ref$1(!1),f=ref$1({display:"none"});u.value&&s.pause();const g=Y=>{f.value=Y?{display:"block"}:{display:"none"},u.value=!0,s.pause()},H=()=>{u.value=!1,s.resume()};return e({openModalReportingSent:g,onModalReportingSentClose:H}),(Y,ee)=>{const te=jt;return openBlock(),createBlock(te,{opened:unref(u),title:o,size:"md",icon:l,"is-alert":!0,actions:c,onClose:H},{default:withCtx(()=>[...ee[0]||(ee[0]=[createBaseVNode("p",null," Nous vous tiendrons inform par courriel de la prise en compte de votre signalement par nos quipes. ",-1)])]),_:1},8,["opened"])}}}),__default__$2={name:"ModalReportingStart"},_sfc_main$8=Object.assign(__default__$2,{setup(n,{expose:e}){const i=useEulerian();useRouter();const s=useMapStore(),o=useDataStore(),l=`${useBaseUrl()}/faq`,c="Avant d'effectuer un signalement",u="fr-icon-feedback-line",f=[{label:"J'ai compris",onClick(){g.value=!1}},{label:"Afficher Plan IGN J+1",tertiary:!0,onClick(){g.value=!1;var te=o.getLayerIdByName("GEOGRAPHICALGRIDSYSTEMS.MAPS.BDUNI.J1","WMTS");s.addLayer(te)}}],g=ref$1(!1),H=ref$1({display:"none"});g.value&&i.pause();const Y=te=>{H.value=te?{display:"block"}:{display:"none"},g.value=!0,i.pause()},ee=()=>{g.value=!1,i.resume()};return e({openModalReportingStart:Y,onModalReportingStartClose:ee}),(te,ne)=>{const Ye=qe$1,xe=jt;return openBlock(),createBlock(xe,{opened:unref(g),title:c,size:"md",icon:u,"is-alert":!0,onClose:ee},{default:withCtx(()=>[createBaseVNode("p",null,[ne[0]||(ne[0]=createTextVNode(" Avant de dbuter, nous vous recommandons de prendre connaissance de notre ",-1)),createBaseVNode("a",{href:l,target:"_blank"},"foire aux questions"),ne[1]||(ne[1]=createTextVNode(" ddie et d'afficher la carte la plus  jour, afin de vrifier que l'anomalie n'a pas dj t prise en compte. ",-1))])]),footer:withCtx(()=>[createVNode(Ye,{align:"center",buttons:f,"inline-layout-when":"large"})]),_:1},8,["opened"])}}});class MyServiceAction{constructor(){console.info("MyServiceAction constructor"),this.url=window.__ENV__.VITE_GPF_SERVICE_ANOMALY||"https://www.geoportail.gouv.fr/wp-json/wp/v2"}active(){console.info("MyServiceAction active")}disable(){console.info("MyServiceAction disable")}send(e){return console.info("MyServiceAction send"),this._send(e)}clear(){console.info("MyServiceAction clear")}async _send(e){console.info("MyServiceAction #send",e);var i=e.location.features[0].geometry.coordinates;e.location.crs.properties.name!=="EPSG::4326"&&(i=transform$1(e.location.features[0].geometry.coordinates,e.location.crs.properties.name,"EPSG:4326"));const s=`https://cartes.gouv.fr/cartes?c=${i[0]},${i[1]}&p=${i[0]},${i[1]}&z=11&l=GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2$GEOPORTAIL:OGC:WMTS(1;1;1;0)&w=OverviewMap,SearchEngine,ScaleLine,LayerSwitcher,GetFeatureInfo,Legends,Zoom,FullScreen,Share,Print,Territories,LayerImport,ControlList,ContextMenu&permalink=yes`,o={name:e.name+" (Anomalie) (cartes.gouv.fr)",description:e.desc,theme:e.theme,permalink:s,id_drawing:"",mail:e.mail};var l=`
        <kml xmlns="http://www.opengis.net/kml/2.2" xmlns:gx="http://www.google.com/kml/ext/2.2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd">
          <ExtendedData>
            <Data name="description">"Signalement (cartes.gouv.fr)"</Data>
          </ExtendedData>
          <Placemark>
            <name>Signalement</name>
            <Style>
              <IconStyle>
                <scale>0.03125</scale>
                <Icon>
                  <href>data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNiYAAAAAkAAxkR2eQAAAAASUVORK5CYII=</href>
                  <gx:w>1</gx:w>
                  <gx:h>1</gx:h>
                </Icon>
                <hotSpot x="0" y="1" xunits="pixels" yunits="pixels"/>
              </IconStyle>
              <LabelStyle>
                <color>ff000000</color>
                <LabelStyleSimpleExtensionGroup fontSize="16px" fontFamily="sans" haloColor="ffffffff" haloRadius="3" haloOpacity="1"/>
              </LabelStyle>
            </Style>
            <Point>
              <coordinates>${i[0]},${i[1]}</coordinates>
            </Point>
          </Placemark>
        </kml>`;const u={drawing:{is_anomaly:1,kml:e.drawing||l,layername:e.name,name:e.name}},g=await(await fetch(this.url+"/drawing",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},mode:"cors",credentials:"same-origin",body:JSON.stringify(u)})).json();o.id_drawing=g.drawing[0].id;const H={anomaly:o};await fetch(this.url+"/anomaly",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},mode:"cors",credentials:"same-origin",body:JSON.stringify(H)})}}typeof window<"u"&&(window.MyServiceAction=MyServiceAction);const _sfc_main$7={__name:"Reporting",props:{mapId:String,visibility:Boolean,analytic:Boolean,reportingOptions:Object},setup(n){const e=inject("emitter"),i=n,s=distExports$1.useLogger(),o=inject(i.mapId),l=ref$1(new Reporting(i.reportingOptions)),c=ref$1({}),u=ref$1({});e.addEventListener("reporting:open:clicked",H=>{l.value&&l.value.setCollapsed(!H.open)}),onMounted(()=>{if(i.visibility){if(l.value.setComponentService(new MyServiceAction),o.addControl(l.value),i.analytic){var H=l.value.element.querySelector("button[id^=GPshowReportingPicto-]");useActionButtonEulerian(H)}l.value.on("reporting:opened",f),l.value.on("reporting:sending",g)}}),onBeforeUpdate(()=>{i.visibility||o.removeControl(l.value)}),onUpdated(()=>{if(i.visibility){if(l.value.setComponentService(new MyServiceAction),o.addControl(l.value),i.analytic){var H=l.value.element.querySelector("button[id^=GPshowReportingPicto-]");useActionButtonEulerian(H)}l.value.on("reporting:opened",f),l.value.on("reporting:sending",g)}});const f=H=>{s.debug(H),u.value.openModalReportingStart(!0)},g=H=>{s.debug(H),c.value.openModalReportingSent()};return(H,Y)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(_sfc_main$9,{ref_key:"refModalReportingSent",ref:c},null,512),createVNode(_sfc_main$8,{ref_key:"refModalReportingStart",ref:u},null,512)],64))}},_sfc_main$6={__name:"CatalogManager",props:{mapId:{type:String,default:""},visibility:Boolean,analytic:Boolean,catalogManagerOptions:{type:Object,default:()=>({})}},setup(n){const e=n,i=distExports$1.useLogger(),s=useDataStore(),o=useMapStore(),l=inject("emitter"),c=inject(e.mapId),u=ref$1(new Catalog(e.catalogManagerOptions));l.addEventListener("catalog:open:clicked",Y=>{u.value&&u.value.setCollapsed(!Y.open)}),onMounted(()=>{if(e.visibility){if(c.addControl(u.value),i.info("CatalogManager mounted",u.value),e.analytic){var Y=u.value.element.querySelector("button[id^=GPshowCatalogPicto-]");useActionButtonEulerian(Y)}u.value.on("catalog:loaded",f),u.value.on("catalog:layer:add",g),u.value.on("catalog:layer:remove",H)}}),onBeforeUpdate(()=>{i.info("CatalogManager updated",u.value),e.visibility||c.removeControl(u.value)}),onUpdated(()=>{if(e.visibility){if(c.addControl(u.value),i.info("CatalogManager updated",u.value),e.analytic){var Y=u.value.element.querySelector("button[id^=GPshowCatalogPicto-]");useActionButtonEulerian(Y)}u.value.on("catalog:loaded",f),u.value.on("catalog:layer:add",g),u.value.on("catalog:layer:remove",H)}});const f=Y=>{i.info("catalog:loaded",Y)},g=Y=>{i.info("catalog:layer:add",Y);var ee=s.getLayerIdByName(Y.name,Y.service);ee&&o.addLayer(ee)},H=Y=>{i.info("catalog:layer:remove",Y);var ee=s.getLayerIdByName(Y.name,Y.service);ee&&o.removeLayer(ee)};return(Y,ee)=>(openBlock(),createElementBlock("div"))}},useDomStore=defineStore("dom",()=>{var n=ref$1(),e=ref$1(),i=ref$1();function s(){return e.value}function o(g){e.value=g}function l(){return n.value}function c(g){n.value=g}function u(){return i.value}function f(g){console.log("setleftControlMenu",g),i.value=g}return{menuCatalogueButton:n,leftControlMenu:i,BookmarksButton:e,getmenuCatalogueButton:l,setmenuCatalogueButton:c,getBookmarksButton:s,setBookmarksButton:o,getleftControlMenu:u,setleftControlMenu:f}}),IconGeolocationSVG="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2036'%20width='48'%20height='48'%3e%3cpath%20fill='%23000091'%20d='M18.364%203.636a9%209%200%200%201%200%2012.728L12%2022.728l-6.364-6.364A9%209%200%200%201%2018.364%203.636ZM12%208a2%202%200%201%200%200%204%202%202%200%200%200%200-4Z'/%3e%3c/svg%3e",__default__$1={name:"Controls"},_sfc_main$5=Object.assign(__default__$1,{props:{controlOptions:{type:Array,default:()=>[]},mapId:{type:String,default:""}},setup(n){const e=inject("emitter");LoggerByDefault.enableAll();const i=n,s=useMapStore(),o=useDomStore(),l=useDataStore();distExports$1.useLogger().debug(i.controlOptions);const u={id:"1",collapsed:!1,collapsible:!1,displayButtonAdvancedSearch:!0,displayButtonGeolocate:!0,displayButtonCoordinateSearch:!0,coordinateSearchInAdvancedSearch:!0,displayButtonClose:!1,resources:{search:!0},searchOptions:{addToMap:!1,filterServices:l.filterServices,filterWMTSPriority:!0,filterProjections:l.filterProjections,filterLayersPriority:l.getFeatured().toString(),filterLayers:!0,filterTMS:!0,filterLayersList:l.getLayersSignatures(),serviceOptions:{maximumResponses:50},maximumEntries:5},autocompleteOptions:{serviceOptions:{maximumResponses:10},prettifyResults:!0,maximumEntries:5},markerUrl:IconGeolocationSVG},f={options:{id:"2",position:useControlsExtensionPosition().layerSwitcherOptions,collapsed:!0,panel:!0,counter:!0,allowEdit:!0,allowGrayScale:!0}},g={id:"3",position:useControlsExtensionPosition().legendsOptions,panel:!0,auto:!0,draggable:!1},H={id:"4",units:"metric",bar:!1},Y={id:"5",position:useControlsExtensionPosition().territoriesOptions,panel:!0,title:"Slectionner un territoire",auto:!1,thumbnail:!1,reduce:!1,tiles:3},ee={id:"6",position:useControlsExtensionPosition().getFeatureInfoOptions,noDataMessage:"<h6 style='text-align: center;'> Pas d'infos disponibles </h6> <p style='text-align: center;'> Il n'y a pas de donnes interrogeables ici </p>"},te={id:"7",collapsed:!1,position:useControlsExtensionPosition().overviewMapOptions,layers:[new LayerWMTS({layer:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2",configuration:{...l.getLayerByName("GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2","WMTS"),params:l.getLayerParamsByName("GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2","WMTS")}})]},ne={id:"8",position:useControlsExtensionPosition().fullscreenOptions,source:"map-and-tools-container"},Ye={position:useControlsExtensionPosition().zoomOptions,id:"9"},xe={position:useControlsExtensionPosition().controlListOptions,id:"10",gutter:!1,controlCatalogElement:document.getElementById("MenuControl")},tt={id:"11",position:useControlsExtensionPosition().drawingOptions,gutter:!1,listable:!0,tools:{export:!1}},et={id:"12",position:useControlsExtensionPosition().reverseGeocodeOptions,gutter:!1,listable:!0},it={position:useControlsExtensionPosition().isocurveOptions,id:"13",gutter:!1,listable:!0},rt={position:useControlsExtensionPosition().routeOptions,id:"14",gutter:!1,listable:!0},nt={id:"15",position:useControlsExtensionPosition().measureLengthOptions,gutter:!1,listable:!0},at={position:useControlsExtensionPosition().measureAreaOptions,id:"16",gutter:!1,listable:!0},st={position:useControlsExtensionPosition().measureAzimuthOptions,gutter:!1,listable:!0,id:"17"},ot={position:useControlsExtensionPosition().mousePositionOptions,id:"18",gutter:!1,listable:!0,editCoordinates:!0,systems:[{label:"Gographique",crs:"EPSG:4326",type:"Geographical"},{label:"Web Mercator",crs:"EPSG:3857",type:"Metric"},{label:"Lambert 93",crs:"EPSG:2154",type:"Metric",geoBBox:{left:-9.86,bottom:41.15,right:10.38,top:51.56}},{label:"Lambert II tendu",crs:"EPSG:27572",type:"Metric",geoBBox:{left:-4.87,bottom:42.33,right:8.23,top:51.14}},{crs:"EPSG:32620",label:"UTM 20N (Guadeloupe, Martinique)",type:"Metric",geoBBox:{left:-66,bottom:0,right:-60,top:84}},{crs:"EPSG:4467",label:"UTM 21N (Saint-Pierre-et-Miquelon)",type:"Metric",geoBBox:{left:-57.1,bottom:43.41,right:-55.9,top:47.37}},{crs:"EPSG:2972",label:"UTM 22N (Guyane)",type:"Metric",geoBBox:{left:-54.6,bottom:2.11,right:-49.46,top:8.88}},{crs:"EPSG:32630",label:"UTM 30N (France mtropolitaine)",type:"Metric",geoBBox:{left:-6,bottom:0,right:0,top:84}},{crs:"EPSG:32631",label:"UTM 31N (France mtropolitaine)",type:"Metric",geoBBox:{left:0,bottom:0,right:6,top:84}},{crs:"EPSG:32632",label:"UTM 32N (France mtropolitaine)",type:"Metric",geoBBox:{left:6,bottom:0,right:12,top:84}},{crs:"EPSG:4471",label:"UTM 38S (Mayotte)",type:"Metric",geoBBox:{left:43.68,bottom:-14.49,right:46.7,top:-11.33}},{crs:"EPSG:2975",label:"UTM 40S (Runion)",type:"Metric",geoBBox:{left:51.83,bottom:-24.72,right:58.24,top:-18.28}},{crs:"EPSG:3296",label:"UTM 5S (Polynsie)",type:"Metric",geoBBox:{left:-158.13,bottom:-26.7,right:-150,top:-12.5}},{crs:"EPSG:3297",label:"UTM 6S (Polynsie)",type:"Metric",geoBBox:{left:-150,bottom:-31.2,right:-144,top:-7.29}},{crs:"EPSG:32707",label:"UTM 7S (Polynsie)",type:"Metric",geoBBox:{left:-144,bottom:-80,right:-138,top:0}},{crs:"EPSG:32708",label:"UTM 8S (Polynsie)",type:"Metric",geoBBox:{left:-138,bottom:-80,right:-132,top:0}},{crs:"EPSG:26912",label:"UTM 12N (le de Clipperton)",type:"Metric",geoBBox:{left:-109.5,bottom:10.17,right:-109,top:10.5}},{crs:"EPSG:32742",label:"UTM 42S (les Kerguelen)",type:"Metric",geoBBox:{left:66,bottom:-80,right:72,top:0}},{crs:"EPSG:32739",label:"UTM 39S (les Crozet)",type:"Metric",geoBBox:{left:48,bottom:-80,right:54,top:0}},{crs:"EPSG:32743",label:"UTM 43S (les St-Paul et Amsterdam)",type:"Metric",geoBBox:{left:72,bottom:-80,right:78,top:0}},{crs:"EPSG:2986",label:"Strographique polaire (Terre Adlie)",type:"Metric",geoBBox:{left:136,bottom:-67.13,right:142,top:-65.61}},{crs:"EPSG:32737",label:"UTM 37S (les du canal de Mozambique)",type:"Metric",geoBBox:{left:36,bottom:-80,right:42,top:0}},{crs:"EPSG:32738",label:"UTM 38S (les du canal de Mozambique)",type:"Metric",geoBBox:{left:42,bottom:-80,right:48,top:0}},{crs:"EPSG:2988",label:"UTM 1S (Wallis-et-Futuna)",type:"Metric",geoBBox:{left:-176.25,bottom:-13.41,right:-176.07,top:-13.16}},{crs:"EPSG:3163",label:"RGNC91-93 (Nouvelle-Caldonie)",type:"Metric",geoBBox:{left:156.25,bottom:-26.45,right:174.28,top:-14.83}}]},ut={id:"19",position:useControlsExtensionPosition().elevationPathOptions,gutter:!1,listable:!0},ht={id:"20",position:useControlsExtensionPosition().layerImportOptions,gutter:!1,listable:!0},dt={id:"21",position:useControlsExtensionPosition().reportingOptions,gutter:!1,listable:!0,format:"kml"},pt={id:"22",position:"top-right",gutter:!1,listable:!0,titlePrimary:"Catalogue de cartes",layerLabel:"title",layerThumbnail:!0,size:"xl",addToMap:!1,search:{display:!1,criteria:["name","title","description"]},categories:[{title:"Cartes de rfrence",id:"base",filter:{field:"base",value:"true"}},{title:"Toutes les cartes",id:"data",search:!0,items:[{title:"Thme",default:!0,section:!0,icon:!0,filter:{field:"thematic",value:"*"}},{title:"Producteur",section:!0,icon:!1,filter:{field:"producer",value:"*"}},{title:"Service",section:!0,icon:!0,filter:{field:"service",value:"*"}}]}],configuration:{type:"json",data:{layers:l.getLayers(),topics:l.getTopics()}}};inject("refModalPrint"),inject("refModalShare");const yt=computed(()=>({contextMenuItemsOptions:[{text:"Signaler une anomalie",callback:()=>{s.addControl("Reporting"),setTimeout(()=>{e.dispatchEvent("reporting:open:clicked",{open:!0,componentName:"Reporting"}),e.dispatchEvent("leftmenu:close",{open:!1,componentName:"ContextMenu"})},0)}}]}));return onMounted(()=>{o.setleftControlMenu(document.getElementById("position-container-bottom-left"))}),(mt,St)=>(openBlock(),createElementBlock(Fragment,null,[n.controlOptions?(openBlock(),createBlock(_sfc_main$q,{key:0,visibility:i.controlOptions.includes(unref(useControls).LayerSwitcher.id),analytic:unref(useControls).LayerSwitcher.analytic,"layer-switcher-options":f,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$p,{key:1,visibility:i.controlOptions.includes(unref(useControls).Legends.id),analytic:unref(useControls).Legends.analytic,"legends-options":g,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$m,{key:2,visibility:i.controlOptions.includes(unref(useControls).Route.id),analytic:unref(useControls).Route.analytic,"route-options":rt,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$n,{key:3,visibility:i.controlOptions.includes(unref(useControls).Isocurve.id),analytic:unref(useControls).Isocurve.analytic,"isocurve-options":it,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$a,{key:4,visibility:i.controlOptions.includes(unref(useControls).ReverseGeocode.id),analytic:unref(useControls).ReverseGeocode.analytic,"reverse-geocode-options":et,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$b,{key:5,visibility:i.controlOptions.includes(unref(useControls).FullScreen.id),analytic:unref(useControls).FullScreen.analytic,"fullscreen-options":ne,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$r,{key:6,visibility:i.controlOptions.includes(unref(useControls).Zoom.id),analytic:unref(useControls).Zoom.analytic,"zoom-options":Ye,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$u,{key:7,visibility:i.controlOptions.includes(unref(useControls).SearchEngine.id),analytic:unref(useControls).SearchEngine.analytic,"search-engine-options":u,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$f,{key:8,visibility:i.controlOptions.includes(unref(useControls).GetFeatureInfo.id),analytic:unref(useControls).GetFeatureInfo.analytic,"get-feature-info-options":ee,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$t,{key:9,visibility:i.controlOptions.includes(unref(useControls).ScaleLine.id),analytic:unref(useControls).ScaleLine.analytic,"scale-line-options":H,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$s,{key:10,visibility:i.controlOptions.includes(unref(useControls).OverviewMap.id),analytic:unref(useControls).OverviewMap.analytic,"overview-map-options":te,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$g,{key:11,visibility:i.controlOptions.includes(unref(useControls).Territories.id),analytic:unref(useControls).Territories.analytic,"territories-options":Y,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$l,{key:12,visibility:i.controlOptions.includes(unref(useControls).MeasureLength.id),analytic:unref(useControls).MeasureLength.analytic,"measure-length-options":nt,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$k,{key:13,visibility:i.controlOptions.includes(unref(useControls).MeasureArea.id),analytic:unref(useControls).MeasureArea.analytic,"measure-area-options":at,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$j,{key:14,visibility:i.controlOptions.includes(unref(useControls).MeasureAzimuth.id),analytic:unref(useControls).MeasureAzimuth.analytic,"measure-azimuth-options":st,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$i,{key:15,visibility:i.controlOptions.includes(unref(useControls).MousePosition.id),analytic:unref(useControls).MousePosition.analytic,"mouse-position-options":ot,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$o,{key:16,visibility:i.controlOptions.includes(unref(useControls).Drawing.id),analytic:unref(useControls).Drawing.analytic,"drawing-options":tt,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$h,{key:17,visibility:i.controlOptions.includes(unref(useControls).ElevationPath.id),analytic:unref(useControls).ElevationPath.analytic,"elevation-path-options":ut,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$e,{key:18,visibility:i.controlOptions.includes(unref(useControls).LayerImport.id),analytic:unref(useControls).LayerImport.analytic,"layer-import-options":ht,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$d,{key:19,visibility:i.controlOptions.includes(unref(useControls).ControlList.id),analytic:unref(useControls).ControlList.analytic,"control-list-options":xe,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$c,{key:20,visibility:i.controlOptions.includes(unref(useControls).ContextMenu.id),analytic:unref(useControls).ContextMenu.analytic,"context-menu-options":unref(yt),"map-id":n.mapId},null,8,["visibility","analytic","context-menu-options","map-id"])):createCommentVNode("",!0),n.controlOptions?(openBlock(),createBlock(_sfc_main$7,{key:21,visibility:i.controlOptions.includes(unref(useControls).Reporting.id),analytic:unref(useControls).Reporting.analytic,"reporting-options":dt,"map-id":n.mapId},null,8,["visibility","analytic","map-id"])):createCommentVNode("",!0),createVNode(_sfc_main$6,{visibility:!0,analytic:!1,"catalog-manager-options":pt,"map-id":n.mapId},null,8,["map-id"])],64))}}),DEFAULT_STYLE=new Style$1({image:new Icon({src:Marker.lightOrange,anchor:[25.5,38],anchorOrigin:"top-left",anchorXUnits:"pixels",anchorYUnits:"pixels"}),stroke:new Stroke({color:"rgba(0,42,80,0.8)",width:4}),fill:new Fill({color:"rgba(0, 183, 152, 0.5)"}),text:new Text({font:"16px Sans",textAlign:"left",fill:new Fill({color:"rgba(255, 255, 255, 1)"}),stroke:new Stroke({color:"rgba(0, 0, 0, 1)",width:2})})}),createVectorLayer=n=>{try{var e=null,i=null,s=null,o=n.extended===void 0?!0:n.extended;switch(n.format.toLowerCase()){case"geojson":e=new GeoJSON$1,o&&(e=new GeoJSON({defaultStyle:DEFAULT_STYLE}));break;case"kml":e=new KML$1,o&&(e=new KML({defaultStyle:DEFAULT_STYLE}));break;case"gpx":e=new GPX$1,o&&(e=new GPX({defaultStyle:DEFAULT_STYLE,readExtensions:function(l,c){this.readExtensions(l,c)}}));break;default:break}if(!e)throw new Error(t.ol.failed_format(n.format));if(n.data){const l=e.readProjection(n.data);i=new VectorSource({features:e.readFeatures(n.data,{dataProjection:l,featureProjection:"EPSG:3857"})})}if(n.url&&(i=new VectorSource({format:e,url:n.url})),!i)throw new Error(t.ol.failed_source("vecteur"));if(i._title=n.name,i._description=n.description,s=new VectorLayer({source:i,visible:getVisible(n.visible),opacity:getOpacity(n.opacity)}),!s)throw new Error(t.ol.failed_layer("vecteur"));return s.gpResultLayerId="bookmark:"+n.type+"-"+n.format.toLowerCase()+":"+n.id,Promise.resolve(s)}catch(l){return Promise.reject(l)}},createComputeLayer=n=>{try{var e=null,i=null,s=null;e=new GeoJSON$1;var o=n.extended===void 0?!0:n.extended;if(o&&(e=new GeoJSON({defaultStyle:DEFAULT_STYLE})),!e)throw new Error(t.ol.failed_format(n.format));if(n.data){const u=e.readProjection(n.data);i=new VectorSource({features:e.readFeatures(n.data,{dataProjection:u,featureProjection:"EPSG:3857"})})}if(n.url&&(i=new VectorSource({format:e,loader:function(u,f,g,H,Y){const ee=g.getCode(),te=new XMLHttpRequest;te.open("GET",n.url);const ne=function(){i.removeLoadedExtent(u),Y()};te.onerror=ne,te.onload=function(){if(te.status===200){var Ye=e.readProjection(te.responseText);const xe=e.readFeatures(te.responseText,{dataProjection:Ye,featureProjection:ee});i.addFeatures(xe),H(xe)}else ne()},te.send()}})),!i)throw new Error(t.ol.failed_source("compute"));if(i._title=n.name,i._description=n.description,s=new VectorLayer({source:i,visible:getVisible(n.visible),opacity:getOpacity(n.opacity)}),!s)throw new Error(t.ol.failed_layer("compute"));s.gpResultLayerId="bookmark:"+n.type+"-"+n.compute.toLowerCase()+":"+n.id;const l=()=>{throw new Error(t.ol.failed_layer("compute"))},c=u=>{var f=e.readRootExtensions("geoportail:compute");if(!f||Object.keys(f).length===0)throw new Error(t.ol.failed_layer("compute"));s.set("control",n.compute),s.set("data",f);var g=new GeoJSON({defaultStyle:DEFAULT_STYLE}),H=g.writeFeatures(u.features,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});s.set("geojson",H)};return s.getSource().once("featuresloadend",c),s.getSource().once("featuresloaderror",l),Promise.resolve(s)}catch(l){return Promise.reject(l)}},createServiceLayer=n=>{var e=s=>{var o=null;if(typeof s.data=="string"&&(s.data=JSON.parse(s.data)),s.kind==="wmts"){const u=new WMTSTileGrid({origin:[s.data.topLeftCorner.x,s.data.topLeftCorner.y],resolutions:s.data.resolutions,matrixIds:s.data.matrixIds});var l=new WMTS$1({url:s.data.url,version:s.data.version,layer:s.data.layer,matrixSet:s.data.tileMatrixSet,format:s.data.outputFormat,projection:"EPSG:3857",tileGrid:u,style:s.data.styleName,attributions:""}),o=null;if(typeof s.data=="string"&&(s.data=JSON.parse(s.data)),s.kind==="wmts"){const g=new WMTSTileGrid({origin:[s.data.topLeftCorner.x,s.data.topLeftCorner.y],resolutions:s.data.resolutions,matrixIds:s.data.matrixIds});var l=new WMTS$1({url:s.data.url,version:s.data.version,layer:s.data.layer,matrixSet:s.data.tileMatrixSet,format:s.data.outputFormat,projection:"EPSG:3857",tileGrid:g,style:s.data.styleName,attributions:""});if(!l)throw new Error(t.ol.failed_source("service wmts"));if(l._title=s.data.name||s.name,l._description=s.data.description||s.description,o=new TileLayer({source:l}),!o)throw new Error(t.ol.failed_layer("service wmts"))}else if(s.kind==="wms"){var c=new TileWMS({url:s.data.url,params:{LAYERS:s.data.layers,SERVICE:s.data.format,VERSION:s.data.version,STYLES:s.data.stylesName},projection:s.data.projection||"EPSG:3857",attributions:""});if(!c)throw new Error(t.ol.failed_source("service wms"));if(c._title=s.data.name||s.name,c._description=s.data.description||s.description,o=new TileLayer({source:c}),!o)throw new Error(t.ol.failed_layer("service wms"));o.gpGFIparams={queryable:s.data.queryable,formats:s.data.gfiFormat}}else throw new Error(t.ol.failed_source("service non reconnu"));if(o&&!o.getExtent()){const g=get$3("EPSG:3857");o.setExtent(g.getExtent())}return o&&(o.gpResultLayerId="bookmark:"+s.kind.toLowerCase()+":"+s.id),o.setVisible(getVisible(s.visible)),o.setOpacity(getOpacity(s.opacity)),o}else if(s.kind==="wms"){var c=new TileWMS({url:s.data.url,params:{LAYERS:s.data.layers,SERVICE:s.data.format,VERSION:s.data.version,STYLES:s.data.stylesName},projection:s.data.projection||"EPSG:3857",attributions:""});if(!c)throw new Error(t.ol.failed_source("service wms"));if(c._title=s.data.name||s.name,c._description=s.data.description||s.description,o=new TileLayer({source:c}),!o)throw new Error(t.ol.failed_layer("service wms"));o.gpGFIparams={queryable:s.data.queryable,formats:s.data.gfiFormat}}else throw new Error(t.ol.failed_source("service non reconnu"));if(o&&!o.getExtent()){const u=get$3("EPSG:3857");o.setExtent(u.getExtent())}return o&&(o.gpResultLayerId="bookmark:"+s.kind.toLowerCase()+":"+s.id),o};if(n.url)return fetch(n.url).then(s=>{if(s.ok)return s.json().then(o=>e({...n,data:o})).catch(o=>{throw o})}).catch(s=>{throw s});if(n.data)try{var i=e(n);return Promise.resolve(i)}catch(s){return Promise.reject(s)}},createMapBoxLayer=n=>{const e=s=>{var o=null,l=s.data,c=l.sources,u=Object.keys(c)[0],f=c[u],g=f.type;if(g==="vector"){var H=f.tiles;if(!H)throw new Error("Source 'tiles' uniquement !");var Y=new MVT({featureClass:Feature}),ee=new VectorTile({state:"loading",attributions:"",format:Y,urls:H});ee._title=s.name,ee._description=s.description,o=new VectorTileLayer({source:ee,visible:!1,declutter:!0}),o.gpResultLayerId="bookmark:"+s.format.toLowerCase()+":"+s.id,o.styleUrl=s.url;var te=()=>{applyStyle(o,l,{source:u}).then(()=>{o.getSource().setState("ready"),o.set("mapbox-styles",l)}).then(()=>{o.setVisible(getVisible(s.visible)),o.setOpacity(getOpacity(s.opacity))}).catch(ne=>{throw ne})};o.getSource()?te():o.once("change:source",te)}else throw new Error("Type 'vector' uniquement !");return o};if(n.url)return fetch(n.url).then(s=>{if(s.ok)return s.json().then(o=>e({...n,data:o})).catch(o=>{throw o})}).catch(s=>{throw s});if(n.data)try{var i=e(n);return Promise.resolve(i)}catch(s){return Promise.reject(s)}},getVisible=n=>{var e=n===void 0?!0:n;return typeof e=="string"&&(e==="true"?e=!0:e==="false"?e=!1:e=!0),e},getOpacity=n=>{var e=n===void 0?1:n;return typeof e=="string"&&(e=parseFloat(e)),isNaN(e)&&(e=1),e<0&&(e=0),e>1&&(e=1),e},_sfc_main$4={__name:"Layer",props:{layerOptions:Object,mapId:String},setup(n){const e=n,i=distExports$1.useLogger();i.debug(e.layerOptions);const s=useDataStore(),o=useMapStore(),l=inject(e.mapId);var c=null;return onMounted(()=>{if(!e.layerOptions||Object.keys(e.layerOptions).length===0)return;const u=e.layerOptions.service,f=e.layerOptions.name,g=e.layerOptions.position;if(f&&u){var H=s.getLayerByName(e.layerOptions.name,e.layerOptions.service),Y=s.getLayerParamsByName(e.layerOptions.name,e.layerOptions.service);H.params=Y;var ee={position:e.layerOptions.position,visible:e.layerOptions.visible,opacity:e.layerOptions.opacity,grayscale:e.layerOptions.grayscale,sourceParams:{crossOrigin:"anonymous"}},te={preload:1/0,cacheSize:1024};switch(i.debug("layer to add (catalog)",f,u,ee,H),u){case"WMS":c=new LayerWMS({layer:f,configuration:H,apiKey:"entree-carto",olParams:Object.assign(ee,te)});break;case"WMTS":c=new LayerWMTS({layer:f,configuration:H,apiKey:"entree-carto",olParams:Object.assign(ee,te)});break;case"TMS":ee.declutter=!0,ee.styleName=e.layerOptions.style||"default",c=new LayerMapBox({layer:f,style:e.layerOptions.style,configuration:H,apiKey:"entree-carto"},ee);break}c&&(i.debug(f,"| position (props - zindex)",g,c.getZIndex()),g!==c.getZIndex()&&(g===-1?i.debug(f,"| position auto"):(i.debug(f,"| change position",g),c.setZIndex(Number(g)))),l.addLayer(c))}const ne=e.layerOptions.url,Ye=e.layerOptions.format;if(ne&&Ye){var xe=null;const et=e.layerOptions.type.toLowerCase();switch(i.debug("layer to add (bookmark)",f,et,Ye),et){case"service":var tt=e.layerOptions.kind.toLowerCase();if(tt==="mapbox")xe=createMapBoxLayer(e.layerOptions);else if(tt==="wmts"||tt==="wms")xe=createServiceLayer(e.layerOptions);else throw new Error("Le service est inconnu !");break;case"carte":throw"Not yet implemented !";case"compute":xe=createComputeLayer(e.layerOptions);break;case"import":Ye.toLowerCase()==="mapbox"?xe=createMapBoxLayer(e.layerOptions):xe=createVectorLayer(e.layerOptions);break;case"drawing":xe=createVectorLayer(e.layerOptions);break}xe&&xe.then(it=>(l.addLayer(it),it)).then(it=>(i.debug(f,"| position (props - zindex)",g,it.getZIndex()),g!==it.getZIndex()&&(g===-1?i.debug(f,"| position auto"):(i.debug(f,"| change position",g),it.setZIndex(Number(g)))),it)).then(it=>{c=it}).then(()=>{if(!o.isPermalink){var it=c.getSource();if(l.getView()&&l.getSize()){var rt=null;it&&it.getExtent?rt=it.getExtent():it&&it.getTileGrid&&(rt=it.getTileGrid().getExtent()),rt&&rt[0]!==1/0?l.getView().fit(rt,l.getSize()):c.once("change",()=>{c.getSource().getExtent()&&l.getView().fit(c.getSource().getExtent(),l.getSize())})}}}).catch(it=>{throw it})}}),onUnmounted(()=>{l&&c&&l.removeLayer(c)}),(u,f)=>(openBlock(),createElementBlock("div",null,[renderSlot(u.$slots,"default")]))}},_sfc_main$3={__name:"Layers",props:{selectedLayers:Object,selectedBookmarks:Object,mapId:String},setup(n){const e=n,i=distExports$1.useLogger();var s=computed(()=>toRaw(e.selectedLayers).map(l=>{i.debug(l.name,l.position);var c={name:l.name,service:l.service||l.serviceParams.id.split(":")[1],key:l.key,position:l.hasOwnProperty("position")?l.position:-1,opacity:l.hasOwnProperty("opacity")?l.opacity:1,visible:l.hasOwnProperty("visible")?l.visible:!0,grayscale:l.hasOwnProperty("grayscale")?l.grayscale:!1};return l.hasOwnProperty("style")&&(c.style=l.style),c})),o=computed(()=>toRaw(e.selectedBookmarks).map(l=>(i.debug(l.name,l.position),{position:l.hasOwnProperty("position")?l.position:-1,opacity:l.hasOwnProperty("opacity")?l.opacity:1,visible:l.hasOwnProperty("visible")?l.visible:!0,grayscale:l.hasOwnProperty("grayscale")?l.grayscale:!1,...l})));return(l,c)=>(openBlock(!0),createElementBlock(Fragment,null,renderList([...unref(s),...unref(o)],u=>(openBlock(),createBlock(_sfc_main$4,{key:u.key,"layer-options":u,"map-id":n.mapId},null,8,["layer-options","map-id"]))),128))}},__default__={name:"Carto"},_sfc_main$2=Object.assign(__default__,{props:{selectedControls:{type:Array,default:()=>[]},selectedLayers:{type:Object,default:()=>({})},selectedBookmarks:{type:Object,default:()=>({})}},setup(n){const e=n,i=useMapStore(),s=ref$1(null),o=computed(()=>s.value&&s.value.mapRef);return(l,c)=>(openBlock(),createBlock(_sfc_main$w,{ref_key:"refMap",ref:s,class:"map","map-id":unref(mainMap)},{default:withCtx(()=>[createVNode(_sfc_main$v,{"map-id":unref(mainMap),center:unref(i).center,zoom:unref(i).zoom},null,8,["map-id","center","zoom"]),unref(o)?(openBlock(),createBlock(_sfc_main$5,{key:0,"control-options":e.selectedControls,"map-id":unref(mainMap)},null,8,["control-options","map-id"])):createCommentVNode("",!0),createVNode(_sfc_main$3,{"map-id":unref(mainMap),"selected-layers":e.selectedLayers,"selected-bookmarks":e.selectedBookmarks},null,8,["map-id","selected-layers","selected-bookmarks"])]),_:1},8,["map-id"]))}}),Carto=_export_sfc(_sfc_main$2,[["__scopeId","data-v-debf6fb7"]]),_sfc_main$1={},_hoisted_1={class:"loader"};function _sfc_render(n,e){return openBlock(),createElementBlock("span",_hoisted_1)}const Patience=_export_sfc(_sfc_main$1,[["render",_sfc_render],["__scopeId","data-v-1ebaa4fc"]]),_sfc_main={__name:"StoreData",props:{},async setup(n){let e,i;const s=distExports$1.useLogger(),o=useDataStore(),{fetchData:l}=o,c=([e,i]=withAsyncContext(()=>l()),e=await e,i(),e);return s.debug(c),(u,f)=>unref(o).isLoaded&&!unref(o).error?renderSlot(u.$slots,"default",{key:0}):createCommentVNode("",!0)}};export{Carto as C,Patience as P,_sfc_main$w as _,useControlsPosition as a,useDomStore as b,useUrlParams as c,useControlsMenuOptions as d,useDataStore as e,_sfc_main$v as f,_sfc_main$3 as g,_sfc_main$t as h,fromShare as i,_sfc_main as j,printMap as p,toShare as t,useMapStore as u};
//# sourceMappingURL=StoreData-BIkWR-RX.js.map
