<script lang="js">
  /**
   * @description
   * 
   * @property {Object} selectedControls Tableau des contrôles sélectionnés ajoutés à la carte
   * 
   */
  export default {
    name: 'MenuControl'
  };
</script>

<script setup lang="js">
import { useControlsMenuOptions } from '@/composables/controls';
import { useLogger } from 'vue-logger-plugin';
import { useMapStore } from "@/stores/mapStore";
import ControlListElement from './ControlListElement.vue';

const log = useLogger();
const mapStore = useMapStore();;

const props = defineProps({
  selectedControls : Array
});

const selectedControls = defineModel();

const disabled = false;
const inline = false;
const required = false;
const small = false;
const opts = useControlsMenuOptions();

const allOptions = computed(() => {
  return opts.filter((opt) => {
    if (opt.label.toLowerCase().includes(searchString.value.toLowerCase()) || 
        opt.hint.toLowerCase().includes(searchString.value.toLowerCase())  ||
        opt.name.toLowerCase().includes(searchString.value.toLowerCase()))
      return opt;
  })
});

const favOptions = computed(() => {
  if (props.selectedControls) {
    return allOptions.value.filter((opt) => {
      if (props.selectedControls.includes(opt.name))
        return opt;
      })
  } else {
    return [];
  }
})

const tabListName = "Gestion d'outils";
const tabTitles = [
  {
    title : "Ajouter des outils",
    tabId : "tab-0",
    panelId : "tab-content-0"
  },
  {
    title : "Mes Outils",
    tabId : "tab-1",
    panelId : "tab-content-1"
  }
];
const selectedTabIndex = ref(0);
const asc = ref(true);
const initialSelectedIndex = 0;
function selectTab (idx) {
  asc.value = selectedTabIndex.value < idx;
  selectedTabIndex.value = idx;
}
const searchString = ref("");
function updateSearch(e) {
  searchString.value = e;
}

watch(selectedControls, (values) => {
  console.log("selectedControls changed", values);
  mapStore.cleanControls();
  values.map((key) => {
    console.log("key", key);
    mapStore.addControl(key);
  })
  // for (let index = 0; index < values.length; index++) {
  //   const key = values[index];
  //   mapStore.addControl(key);
  // }
})
onMounted(() => {})
onUpdated(() => {
  console.log("MenuControl updated AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA");
})

</script>

<template>
  <div class="control-container">
    <h4>Gestion d'outils</h4>
    <div class="control-search-bar">
      <DsfrSearchBar
        :model-value="searchString"
        @update:model-value="updateSearch"
      />
    </div>



    <div class="control-content">
      <table>
        <ControlListElement
          v-for="(opt, idx) in allOptions"
          :key="idx"
          v-model="selectedControls"
          :model-value="props.selectedControls"
          :control-list-element-options="opt"
        />
      </table>
    </div>
  </div>
</template>

<style scoped>
table {
  border-spacing: 30px 1rem;
  border-collapse: separate;
}
.control-search-bar {
  margin-bottom: 30px;
  margin-right: 40px;
  top: 0px;
}

.control-content {
  overflow-y: scroll;
  scrollbar-width: thin;
  overflow-x: hidden;
}

.control-container {
  position: absolute;
  display: flex;
  flex-direction: column;
  width: calc(100% - 60px);
  max-height: calc(76.8vh - 96px);
}
</style>